jn.define("call/callList/createGroupCallView",((e,t,a)=>{const{NotifyManager:s}=e("notify-manager");const{SocialNetworkUserSelector:r}=e("selector/widget/entity/socialnetwork/user");const{restCall:o}=e("call/callList/utils");const i="IMMOBILE_UPDATE_GROUP_CHAT_PARTICIPANT";class n{constructor(){this.participants=[];this.selectorWidget=null}async open(e=PageManager){this.parentWidget=e;const t=env.userId;this.selector=r.make({initSelectedIds:[t],undeselectableIds:[t],widgetParams:{title:BX.message("MOBILEAPP_CALL_LIST_CREATE_GROUP_CALL_TITLE"),sendButtonName:BX.message("MOBILEAPP_CALL_LIST_CREATE_GROUP_CALL_BUTTON")},leftButtons:[{type:"back",callback:()=>{if(this.selectorWidget){this.selectorWidget.back()}}}],allowMultipleSelection:true,closeOnSelect:true,events:{onClose:e=>{this.onCloseParticipantSelector(e)}},createOptions:{enableCreation:false},selectOptions:{canUnselectLast:true},canUseRecent:false,provider:{context:i,options:{useLettersForEmptyAvatar:true}}});this.selector.show({},e).then((e=>{this.selectorWidget=e})).catch((e=>{console.error("[CreateGroupCallView] selector.show() Error:",e)}))}onCloseParticipantSelector(e){this.participants=e;this.createAndCall().catch((e=>{s.hideLoadingIndicator(false);console.error("[CreateGroupCallView] onCloseParticipantSelector Error:",e)}))}async createAndCall(){s.showLoadingIndicator();try{const e=this.getMemberEntities();const t=await o("im.v2.Chat.add",{fields:{memberEntities:e,type:"CHAT",title:""}});s.hideLoadingIndicatorWithoutFallback();const a=t.chatId;const r=`chat${a}`;const i={dialogId:r,video:false,chatData:{dialogId:r,chatId:a,name:BX.message("MOBILEAPP_CALL_LIST_CREATE_GROUP_CALL_TITLE"),userCounter:this.getUserCounter()},userData:this.getUserDataMap()};BX.postComponentEvent("onCallInvite",[i],"calls");if(this.parentWidget?.close){this.parentWidget.close()}}catch(e){s.hideLoadingIndicator(false);console.error("[CreateGroupCallView] createAndCall Error:",e)}}getMemberEntities(){const e=Number(env.userId);const t=this.participants.map((e=>["user",Number(e.id)]));const a=t.some((([t,a])=>Number(a)===e));if(!a){t.push(["user",e])}return t}getUserCounter(){return this.participants.length}getUserDataMap(){const e={};this.participants.forEach((t=>{e[t.id]={id:t.id,name:t.title||"",avatar:t.avatar||""}}));return e}}function c(e=PageManager){const t=new n;t.open(e)}a.exports={CreateGroupCall:n,openCreateGroupCallView:c}}));
//# sourceMappingURL=extension.map.js