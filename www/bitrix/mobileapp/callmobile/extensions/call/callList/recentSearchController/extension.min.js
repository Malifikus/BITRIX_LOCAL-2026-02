jn.define("call/callList/recentSearchController",((e,t,r)=>{const{CallListSearchView:s}=e("call/callList/searchView");const{searchUsers:c}=e("call/callList/utils");const i=350;const n=Number(BX.componentParameters.get("SEARCH_MIN_SIZE",3));const a=10;class h{constructor(e){this.component=e;this.searchView=null;this.searchTimer=null}openSearch(e){if(!e||!e.search){return}this.searchView=new s({onItemClick:e=>this.handleItemClick(e)});const t=e.search;t.mode="layout";t.show(this.searchView);t.on("textChanged",(({text:e})=>this.onSearchTextChanged(e)));t.on("cancel",(()=>this.resetSearch()));t.on("hide",(()=>this.resetSearch()))}onSearchTextChanged(e){const t=String(e||"").trim();this.clearSearchTimer();if(!t||t.length<n){this.resetSearch();return}this.searchTimer=setTimeout((()=>this.performSearch(t)),i)}async performSearch(e){this.setLoading(true);let t=[];let r=[];try{t=this.filterRecentItems(e)}catch(e){console.error("[RecentSearchController][performSearch][filterRecentItems][error]",e)}try{const s=this.extractUserIds(t);r=await this.searchRemote(e,s)}catch(e){console.error("[RecentSearchController][performSearch][searchRemote][error]",e)}this.setItems([...t,...r]);this.setLoading(false)}extractUserIds(e){const t=new Set;e.forEach((e=>{const r=e.userId||e.dialogId;if(r){t.add(String(r))}}));return t}filterRecentItems(e){const t=this.component.state.items||[];const r=e.toLowerCase().trim();if(!r||t.length===0){return[]}const s=t.filter((e=>{const t=String(e.title||"").toLowerCase();const s=String(e.workPosition||"").toLowerCase();return t.includes(r)||s.includes(r)}));return s.map((e=>({...e,sourceType:"user"})))}async searchRemote(e,t){return c(e,{limit:a,excludeUserIds:t,includeUserId:true})}handleItemClick(e){if(this.component.onUserClick){this.component.onUserClick(e)}}setLoading(e){if(this.searchView?.setLoading){this.searchView.setLoading(e)}}setItems(e){if(this.searchView?.setItems){const t=e?Array.isArray(e)?e:[]:null;this.searchView.setItems(t)}}clearSearchTimer(){if(this.searchTimer){clearTimeout(this.searchTimer);this.searchTimer=null}}resetSearch(){this.clearSearchTimer();this.setItems(null);this.setLoading(false)}cleanup(){this.clearSearchTimer()}}r.exports={RecentSearchController:h}}));
//# sourceMappingURL=extension.map.js