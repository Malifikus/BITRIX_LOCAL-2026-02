jn.define("mail/opener",((e,t,n)=>{const s=e("apptheme");const{showEmailBanner:a}=e("communication/email-menu");const{Loc:i}=e("loc");const{NotifyManager:o}=e("notify-manager");const{mergeImmutable:r}=e("utils/object");const{getContactsPromise:l}=e("mail/message/tools/connector");const c=60*60*4;const u="mail_not_active";let g;let d=null;let m=null;class p{static openSend(e,t={},n=null){this.preloadInfo(e).then(((s={})=>{e=r(e,s);t=r(this.getModalWidgetParams(),t);t.titleParams=this.prepareTitleParams(e,t.titleParams);ComponentHelper.openLayout({name:"mail:mail.message.send",componentParams:e,widgetParams:t},n)})).catch((s=>{if(s===u){a(n,this.openSend.bind(this,e,t,n,true))}else{console.error(s)}}))}static getStorage(){if(!g){g=Application.storageById(`mail/opener/${env.languageId}`)}return g}static updateStorage(e){this.setIsActiveMail(e);this.setTtlValue(this.getCurrentTimeInSeconds())}static isActiveMail(){if(d===null){d=this.getStorage().getBoolean("isActive")}return d}static setIsActiveMail(e){d=Boolean(e);return this.getStorage().setBoolean("isActive",d)}static getTtlValue(){if(m===null){m=this.getStorage().getNumber("ttl",0)}return m}static setTtlValue(e){m=e;return this.getStorage().setNumber("ttl",e)}static cacheExpired(e=c){const t=this.getTtlValue();const n=this.getCurrentTimeInSeconds();return n>t+e}static getCurrentTimeInSeconds(){return Math.floor(Date.now()/1e3)}static preloadInfo(e){const{owner:{ownerId:t,ownerType:n}={},uploadSenders:s=true,isCrmMessage:a=true}=e;if(t&&n||!a){o.showLoadingIndicator();return l(t,n,true,s,a).then((({data:e})=>{const t={};const{clients:n,clientIdsByType:s,senders:a}=e;if(Array.isArray(n)){t.clients=n}if(typeof s==="object"&&s!==null&&s!==undefined&&"contacts"in s&&"company"in s){t.clientIdsByType=s}if(Array.isArray(a)){t.senders=a}return t})).catch(console.error).finally((()=>o.hideLoadingIndicatorWithoutFallback()))}return Promise.resolve()}static getModalWidgetParams(){return{modal:true,leftButtons:[{svg:{content:'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.722 6.79175L10.9495 10.5643L9.99907 11.5L9.06666 10.5643L5.29411 6.79175L3.96289 8.12297L10.008 14.1681L16.0532 8.12297L14.722 6.79175Z" fill="#A8ADB4"/></svg>'},isCloseButton:true}]}}static prepareTitleParams(e,t={}){const n={useLargeTitleMode:false,detailTextColor:s.colors.base4,text:i.getMessage("MCRM_MAIL_OPENER_TITLE_NEW")};return r(n,t)}}n.exports={MailOpener:p}}));
//# sourceMappingURL=extension.map.js