jn.define("mail/mailbox/connector/steps/imap",((e,t,s)=>{const{Haptics:i}=e("haptics");const{WizardStep:a}=e("layout/ui/wizard/step");const{Loc:o}=e("loc");const{ProgressBarNumber:n}=e("crm/salescenter/progress-bar-number");const{StringField:r}=e("layout/ui/fields/string");const{EmailField:l}=e("layout/ui/fields/email");const{NumberField:d}=e("layout/ui/fields/number");const{useCallback:p}=e("utils/function");const{clone:g}=e("utils/object");const{stringify:c}=e("utils/string");const{NotifyManager:m}=e("notify-manager");const{Switcher:u}=e("layout/ui/switcher");const{throttle:h}=e("utils/function");const f=Application.getPlatform()==="ios";const C=e("apptheme");class O extends LayoutComponent{getEmptyFieldsData(){return{login:{value:""},password:{value:""},imapPort:{value:""},smtpPort:{value:""},server:{value:""},ssl:{value:true},sslSmtp:{value:true},addressSmtp:{value:""}}}constructor(e){super(e);this.fieldRefs={};this.constants={fields:{imapAddress:{ref:e=>this.fieldRefs.imapAddress=e},smtpAddress:{ref:e=>this.fieldRefs.smtpAddress=e},imapPort:{ref:e=>this.fieldRefs.imapPort=e},smtpPort:{ref:e=>this.fieldRefs.smtpPort=e},login:{ref:e=>this.fieldRefs.login=e},password:{ref:e=>this.fieldRefs.password=e}}};this.state={fields:this.getEmptyFieldsData()}}onChangeField(e,t,s=true){const i=g(this.state.fields);if(s){t=c(t)}i[e].value=t;this.setState({fields:i})}render(){const e=this.state.fields.ssl.value;let t=this.onChangeField.bind(this,"ssl",!e,false);t=h(t,500,this);const s=this.state.fields.sslSmtp.value;let i=this.onChangeField.bind(this,"sslSmtp",!s,false);i=h(i,500,this);return View({},View({style:{borderRadius:12,backgroundColor:C.colors.bgContentSecondary,paddingLeft:20,paddingRight:15,paddingBottom:37,paddingTop:27,marginBottom:15}},l({testId:"connecting-mailboxes-connecting-mailbox-imap-smtp-email",ref:this.constants.fields.login.ref,showLeftIcon:false,showRequired:false,required:true,value:this.state.fields.login.value,onChange:p((e=>this.onChangeField("login",e)),["login"]),title:o.getMessage("MAILBOX_CONNECTOR_IMAP_LOGIN_TITLE"),placeholder:o.getMessage("MAILBOX_CONNECTOR_IMAP_LOGIN_PLACEHOLDER")}),r({testId:"connecting-mailboxes-connecting-mailbox-imap-smtp-password",ref:this.constants.fields.password.ref,showRequired:false,required:true,value:this.state.fields.password.value,onChange:p((e=>this.onChangeField("password",e)),["password"]),title:o.getMessage("MAILBOX_CONNECTOR_IMAP_PASSWORD_TITLE"),placeholder:o.getMessage("MAILBOX_CONNECTOR_IMAP_PASSWORD_PLACEHOLDER"),isPassword:true})),View({style:{borderRadius:12,backgroundColor:C.colors.bgContentSecondary,paddingLeft:20,paddingRight:15,paddingBottom:37,paddingTop:27,marginBottom:15}},r({testId:"connecting-mailboxes-connecting-mailbox-imap-smtp-imap-address",ref:this.constants.fields.imapAddress.ref,showRequired:false,required:true,value:this.state.fields.server.value,onChange:p((e=>this.onChangeField("server",e)),["server"]),title:o.getMessage("MAILBOX_CONNECTOR_IMAP_LOGIN_ADDRESS_TITLE"),placeholder:o.getMessage("MAILBOX_CONNECTOR_IMAP_LOGIN_ADDRESS_PLACEHOLDER")}),d({testId:"connecting-mailboxes-connecting-mailbox-imap-smtp-imap-port",ref:this.constants.fields.imapPort.ref,showRequired:false,required:true,value:this.state.fields.imapPort.value,onChange:p((e=>this.onChangeField("imapPort",e)),["imapPort"]),title:o.getMessage("MAILBOX_CONNECTOR_IMAP_PORT_TITLE"),placeholder:o.getMessage("MAILBOX_CONNECTOR_IMAP_PORT_PLACEHOLDER")}),View({onClick:t,style:{paddingBottom:10}},Text({style:{paddingBottom:6,color:C.colors.base3,fontSize:10,fontWeight:"500"},text:o.getMessage("MAILBOX_CONNECTOR_USE_SECURE_CONNECTION").toLocaleUpperCase(env.languageId)}),new u({testId:"connecting-mailboxes-connecting-mailbox-imap-smtp-imap-ssl-switcher",checked:e}))),View({style:{borderRadius:12,backgroundColor:C.colors.bgContentSecondary,paddingLeft:20,paddingRight:15,paddingBottom:37,paddingTop:27}},r({testId:"connecting-mailboxes-connecting-mailbox-imap-smtp-smtp-address",ref:this.constants.fields.smtpAddress.ref,showRequired:false,required:true,value:this.state.fields.addressSmtp.value,onChange:p((e=>this.onChangeField("addressSmtp",e)),["addressSmtp"]),title:o.getMessage("MAILBOX_CONNECTOR_SMTP_ADDRESS_TITLE"),placeholder:o.getMessage("MAILBOX_CONNECTOR_SMTP_ADDRESS_PLACEHOLDER")}),d({testId:"connecting-mailboxes-connecting-mailbox-imap-smtp-smtp-port",ref:this.constants.fields.smtpPort.ref,showRequired:false,required:true,value:this.state.fields.smtpPort.value,onChange:p((e=>this.onChangeField("smtpPort",e)),["smtpPort"]),title:o.getMessage("MAILBOX_CONNECTOR_IMAP_PORT_TITLE"),placeholder:o.getMessage("MAILBOX_CONNECTOR_SMTP_PORT_PLACEHOLDER")}),View({onClick:i,style:{paddingBottom:10}},Text({style:{paddingBottom:6,color:C.colors.base3,fontSize:10,fontWeight:"500"},text:o.getMessage("MAILBOX_CONNECTOR_USE_SECURE_CONNECTION").toLocaleUpperCase(env.languageId)}),new u({testId:"connecting-mailboxes-connecting-mailbox-imap-smtp-smtp-ssl-switcher",checked:s}))))}}class _ extends a{checkMailboxCanConnected(){const e=this.props.parent.validateFields(this.fieldsLayout.fieldRefs);if(!e){i.notifyWarning()}return e}constructor(e){super();this.props=e}async onMoveToNextStep(){const e={finish:false,next:false};if(!this.checkMailboxCanConnected()){return e}const{login:t,password:s,server:i,addressSmtp:a,imapPort:o,smtpPort:n,ssl:r,sslSmtp:l}=this.fieldsLayout.state.fields;if(t!==""&&s!==""&&o!==""&&n!==""&&i!==""&&a!==""){m.showLoadingIndicator();await this.props.parent.connectMailbox({useSmtp:1,login:t.value,password:s.value,server:i.value,port:Number(o.value),ssl:r.value,serverSmtp:a.value,portSmtp:Number(n.value),sslSmtp:l.value,loginSmtp:t.value,passwordSMTP:s.value}).then((({data:e})=>{this.props.parent.onConnectMailbox(e.id,e.email)})).catch((({errors:e})=>{m.showErrors(e)}))}return e}getProgressBarSettings(){return{...super.getProgressBarSettings(),isEnabled:true,title:{text:o.getMessage("MAILBOX_CONNECTOR_IMAP_TITLE_1")},number:2,count:2}}getTitle(){return o.getMessage("MAILBOX_CONNECTOR_LOGIN_PASSWORD_HEADER_TITLE")}renderNumberBlock(){return new n({number:"2"})}resizableByKeyboard(){return true}createLayout(e){this.fieldsLayout=new O;return View({style:{flex:1,paddingBottom:f?16:0}},View({style:{marginLeft:16,marginRight:16,marginTop:16,marginBottom:20,borderRadius:12,flex:1}},ScrollView({style:{flex:1}},View({},this.fieldsLayout))))}}s.exports={Imap:_}}));
//# sourceMappingURL=extension.map.js