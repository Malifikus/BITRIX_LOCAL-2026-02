jn.define("mail/message/tools/connector",((e,t,a)=>{function n(e,t){let a=e;Object.entries(t).some((([,t])=>{if(t.email===e&&t.name){a=t.name;return true}}));return`${a} <${e}>`}function s(e={},t=""){return e.fields.map((e=>{const{email:a=[{value:""}],type:n="",id:s=0,title:i="",customData:o={},selectedEmailId:c}=e;let l="";if(a.length>0){if(a[c]&&a[c].value){l=a[c].value}else if(a[0].value){l=a[0].value}}if(!l&&o&&o.email){l=o.email}return JSON.stringify({email:l,entityId:s,name:i,...r(n,s,t)})})).filter(Boolean)}function i(e){if(e){if(e.fields[0]&&e.fields[0].value){return e.fields[0].value}if(typeof e.fields==="string"){return e.fields}if(typeof e==="string"){return e}}return""}function r(e,t,a){const n={entityType:"contacts"};switch(e){case"contact":n.entityType="contacts";break;case"company":n.entityType="companies";break;case"user":n.entityType="contacts";n.entityId=0;break;default:n.entityType=a;break}if(t===0){n.entityType="contacts"}return n}function o(e){const{senders:t,fileTokens:a,message:r,from:o,to:c,ownerType:l,ownerId:u,inResponseToMessage:m,isForward:f=0,isCrmMessage:d=true}=e;const g=i(e.subject);const p=3;const y=3;const I={fileTokens:a,from:n(i(o),t),to:s(c,l),subject:g,ownerType:l,ownerId:u,storageTypeID:y,message:i(r),content_type:p,bindings:[{entityType:l,entityId:u}]};const T=s(e.cc,l);const b=s(e.bcc,l);if(T){I.cc=T}if(b){I.bcc=b}if(m){I.REPLIED_ID=m}if(f===1){I.IS_FORWARD=1}else{I.IS_FORWARD=0}const M=d?"crm.api.mail.message.sendMessage":"mailmobile.api.Message.sendMessage";const A={data:{data:I}};return BX.ajax.runAction(M,A)}function c(e){const{id:t,ownerType:a,ownerId:n,successAction:s,failureAction:i}=e;let{excludeFromCrm:r=false,markAsSpam:o=false}=e;r=r===true?"Y":"N";o=o===true?"Y":"N";const c={OWNER_ID:n,OWNER_TYPE:a,IS_SKIP:r,IS_SPAM:o,ITEM_ID:t};return BX.ajax.runAction("crm.api.mail.message.deleteMessage",{data:{data:c}}).then((e=>{if(Number(t)===Number(e.data.DELETED_ITEM_ID)){s()}else{i()}})).catch((e=>{i()}))}function l(e,t,a=true,n=true,s=true){if(a===false&&n===false){return Promise.resolve({data:{}})}if(s){return BX.ajax.runAction("crm.api.mail.message.getEntityContacts",{data:{ownerId:e,ownerTypeName:t,uploadClients:a?1:0,uploadSenders:a?1:0}})}return BX.ajax.runAction("mailmobile.api.Message.getUserContacts",{json:{}})}function u(e,t=1){return BX.ajax.runAction("mailmobile.api.Message.getChain",{data:{id:e,messageType:t}})}function m(e,t,a){return BX.ajax.runAction("crm.api.mail.message.getNeighbors",{data:{ownerId:e,ownerTypeId:t,elementId:a}})}function f(e,t=false,a=false,n=1){return BX.ajax.runAction("mailmobile.api.Message.getMessage",{data:{id:e,takeBody:t,takeFiles:a,messageType:n}})}a.exports={getContactsPromise:l,getMessagePromise:f,getChainPromise:u,getMessageNeighbors:m,sendMessage:o,deleteMessage:c}}));
//# sourceMappingURL=extension.map.js