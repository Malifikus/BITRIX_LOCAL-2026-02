jn.define("mail/addressbook/add-address",((e,t,s)=>{const{StringInput:i,InputDesign:a,InputMode:n,InputSize:o}=e("ui-system/form/inputs/string");const{EmailInput:l}=e("ui-system/form/inputs/email");const{PureComponent:d}=e("layout/pure-component");const{Loc:r}=e("loc");const{clone:c}=e("utils/object");const{stringify:u}=e("utils/string");const{useCallback:h}=e("utils/function");const{isValidEmail:m}=e("utils/email");const{Haptics:f}=e("haptics");const{AjaxMethod:g}=e("mail/const");const{NotifyManager:A}=e("notify-manager");const{stringToColor:D,getInitials:S}=e("mail/message/elements/avatar");const{ButtonSize:p,ButtonDesign:I,Button:E}=e("ui-system/form/buttons/button");class L extends d{constructor(e){super(e);const{onClose:t=()=>{},onSuccess:s=e=>{},textFromSearch:i=""}=e;this.textFromSearch=i;this.onSuccess=s;this.onClose=t;this.layoutWidget=e.layoutWidget;this.fieldRefs={};this.constants={fields:{email:{ref:e=>this.fieldRefs.email=e},name:{ref:e=>this.fieldRefs.name=e}}};this.state={fields:this.#e()}}#e(){let e="";let t="";if(m(this.textFromSearch)){e=this.textFromSearch}else{t=this.textFromSearch}return{email:{value:e},name:{value:t}}}#t(e,t){const s=c(this.state.fields);s[e].value=u(t);this.setState({fields:s})}#s(){const{email:e}=this.state.fields;if(!m(e.value)){const e=this.fieldRefs.email;if(e){return e}}return null}render(){return View({style:{paddingTop:10,paddingLeft:18,paddingRight:18,flex:1}},i({size:o.L,design:a.GREY,mode:n.STROKE,testId:"mail-addressbook-add-address-name",ref:this.constants.fields.name.ref,showRequired:false,required:true,showTitle:false,value:this.state.fields.name.value,onChange:h((e=>this.#t("name",e)),["name"]),label:r.getMessage("MAIL_ADDRESS_BOOK_ADD_ADDRESS_NAME_LABEL"),placeholder:""}),View({style:{height:20}}),l({label:r.getMessage("MAIL_ADDRESS_BOOK_ADD_ADDRESS_EMAIL_LABEL"),size:o.L,design:a.GREY,mode:n.STROKE,showTitle:false,validation:true,testId:"mail-addressbook-add-address-email",ref:this.constants.fields.email.ref,showLeftIcon:false,showRequired:false,required:true,value:this.state.fields.email.value,onChange:h((e=>this.#t("email",e)),["email"]),onValid:m,placeholder:r.getMessage("MAIL_ADDRESS_BOOK_ADD_ADDRESS_EMAIL_PLACEHOLDER")}),View({style:{height:40}}),E({testId:"add-new-email-to-addressbook-button",text:r.getMessage("MAIL_ADDRESS_BOOK_ADD_ADDRESS_BUTTON"),size:p.XL,design:I.FILLED,disabled:false,stretched:true,onClick:this.onAddAddress.bind(this)}))}onAddAddress(){const e=this.#s();if(e){e?.focus();f.notifyWarning();return}const{name:t,email:s}=this.state.fields;const i=s.value.trim();let a=t.value.trim();if(i===""){this.onClose()}else{if(a.length===0){a=i.split("@")[0]}A.showLoadingIndicator();const e={ID:"new",EMAIL:i,NAME:a,COLOR:D(i),INITIALS:S(a,i)};BX.ajax.runAction(g.saveContactInAddressBook,{data:{contactData:e}}).then((({data:e})=>{if(Array.isArray(e)&&e.length>0){const t=e[0];const{customData:s}=t;A.hideLoadingIndicatorWithoutFallback();this.onSuccess(s)}})).catch((({errors:e})=>{A.hideLoadingIndicatorWithoutFallback();this.onClose()}))}}static show(e){const{parentWidget:t,successCallback:s=()=>{}}=e;t.openWidget("layout",{titleParams:{text:r.getMessage("MAIL_ADDRESS_BOOK_ADD_ADDRESS"),largeMode:false,useLargeTitleMode:true},backdrop:{mediumPositionPercent:45,hideNavigationBar:false,forceDismissOnSwipeDown:true,shouldResizeContent:true,swipeAllowed:true}}).then((t=>{const i=new L({...e,layoutWidget:t,successCallback:s});t.showComponent(i)})).catch(console.error)}componentWillUnmount(){this.onClose()}}s.exports={AddAddress:L}}));
//# sourceMappingURL=extension.map.js