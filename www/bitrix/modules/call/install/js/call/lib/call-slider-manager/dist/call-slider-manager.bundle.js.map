{"version":3,"file":"call-slider-manager.bundle.js","sources":["../src/call-slider-manager.js"],"sourcesContent":["import { EventEmitter } from 'main.core.events';\nimport { showCloseWithActiveCallConfirm } from 'im.v2.lib.confirm';\nimport { CallManager } from 'call.lib.call-manager';\n\nexport class CallSliderManager\n{\n\tstatic instance: CallSliderManager;\n\t#sliderIdWithCall: string;\n\n\tstatic getInstance(): CallSliderManager\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#sliderIdWithCall = '';\n\n\t\tthis.#subscribeToEvents();\n\t}\n\n\t#subscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', this.#onCloseSliderWithCall.bind(this));\n\t}\n\n\tsetTopSliderId(): void\n\t{\n\t\tif (!BX.SidePanel.Instance.isOpen())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#sliderIdWithCall = BX.SidePanel.Instance.getTopSlider().getUrl().toString();\n\t}\n\n\tclearSliderId(): void\n\t{\n\t\tthis.#sliderIdWithCall = '';\n\t}\n\n\tasync #onCloseSliderWithCall({ data: event })\n\t{\n\t\t[event] = event;\n\t\tconst sliderId = event.getSlider().getUrl().toString();\n\n\t\tif (sliderId !== this.#sliderIdWithCall || sliderId.startsWith('im:slider'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasCall = CallManager.getInstance().hasCurrentCall();\n\t\tif (hasCall)\n\t\t{\n\t\t\tevent.denyAction();\n\n\t\t\tconst result = await showCloseWithActiveCallConfirm();\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tCallManager.getInstance().leaveCurrentCall();\n\t\t\t\tevent.slider.close();\n\t\t\t}\n\t\t}\n\t}\n}\n"],"names":["CallSliderManager","getInstance","instance","constructor","setTopSliderId","BX","SidePanel","Instance","isOpen","getTopSlider","getUrl","toString","clearSliderId","EventEmitter","subscribe","bind","data","event","sliderId","getSlider","startsWith","hasCall","CallManager","hasCurrentCall","denyAction","result","showCloseWithActiveCallConfirm","leaveCurrentCall","slider","close"],"mappings":";;;;;;CAEoD;CAAA;CAAA;AAEpD,CAAO,MAAMA,iBAAiB,CAC9B;GAIC,OAAOC,WAAW,GAClB;KACC,IAAI,CAAC,IAAI,CAACC,QAAQ,EAClB;OACC,IAAI,CAACA,QAAQ,GAAG,IAAI,IAAI,EAAE;;KAG3B,OAAO,IAAI,CAACA,QAAQ;;GAGrBC,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,0CAAqB,EAAE;KAE3B,4CAAI;;GAQLC,cAAc,GACd;KACC,IAAI,CAACC,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACC,MAAM,EAAE,EACnC;OACC;;KAGD,4CAAI,0CAAqBH,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACE,YAAY,EAAE,CAACC,MAAM,EAAE,CAACC,QAAQ,EAAE;;GAGlFC,aAAa,GACb;KACC,4CAAI,0CAAqB,EAAE;;CA0B7B;CAAC,+BA1CA;GACCC,6BAAY,CAACC,SAAS,CAAC,0BAA0B,EAAE,4CAAI,kDAAwBC,IAAI,CAAC,IAAI,CAAC,CAAC;CAC3F;CAAC,uCAiB4B;GAAEC,IAAI,EAAEC;CAAM,CAAC,EAC5C;GACC,CAACA,KAAK,CAAC,GAAGA,KAAK;GACf,MAAMC,QAAQ,GAAGD,KAAK,CAACE,SAAS,EAAE,CAACT,MAAM,EAAE,CAACC,QAAQ,EAAE;GAEtD,IAAIO,QAAQ,6CAAK,IAAI,uCAAkB,IAAIA,QAAQ,CAACE,UAAU,CAAC,WAAW,CAAC,EAC3E;KACC;;GAGD,MAAMC,OAAO,GAAGC,gCAAW,CAACrB,WAAW,EAAE,CAACsB,cAAc,EAAE;GAC1D,IAAIF,OAAO,EACX;KACCJ,KAAK,CAACO,UAAU,EAAE;KAElB,MAAMC,MAAM,GAAG,MAAMC,gDAA8B,EAAE;KACrD,IAAID,MAAM,EACV;OACCH,gCAAW,CAACrB,WAAW,EAAE,CAAC0B,gBAAgB,EAAE;OAC5CV,KAAK,CAACW,MAAM,CAACC,KAAK,EAAE;;;CAGvB;;;;;;;;"}