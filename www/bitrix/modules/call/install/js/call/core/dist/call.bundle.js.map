{"version":3,"file":"call.bundle.js","sources":["../src/hacks.js","../src/dialogs/background_dialog.js","../src/stream_quality.js","../../lib/settings-manager/src/settings-manager.js","../../lib/hardware/src/hardware.js","../src/noiseSuppressionService.js","../src/call_hardware.js","../src/media-stream-manager.js","../src/call_api.js","../src/engine/logger.js","../src/call_common_record.js","../src/engine/abstract_call.js","../src/view/tools.js","../src/view/user-registry.js","../src/view/svg.js","../src/view/buttons.js","../src/view/mobile.js","../src/view/call-user.js","../src/view/floor-request.js","../src/view/notifications.js","../src/view/device-selector.js","../src/call_ai.js","../src/view/copilot-notify.js","../src/view/media-renderer.js","../src/engine/unsupported_features_in_browsers.js","../src/view/pictureInPictureWindow.js","../src/view/user-selector.js","../src/view/aha-moment-notify.js","../src/view/cloud-record-info-popup.js","../src/view/common-record-menu-popup.js","../src/view/confirm-modal.js","../src/view/talking-popup.js","../src/view/talking-service.js","../src/view/view.js","../src/engine/simple_vad.js","../src/engine/server_plain_call.js","../src/engine/bitrix_call.js","../src/engine/stub.js","../src/call_multi_channel.js","../src/engine/engine.js","../src/engine/plain_call.js","../src/engine/bitrix_call_legacy.js","../src/engine/engine_legacy.js","../src/util.js","../src/dialogs/incoming_notification.js","../src/dialogs/conference_notification.js","../src/floating_screenshare.js","../src/call_hint_popup.js","../src/dialogs/promo_popup.js","../src/sidebar.js","../src/web_screenshare_popup.js","../src/engine/voximplant_call.js","../src/video_strategy.js","../src/view/copilot-popup.js","../src/view/participants-permission-popup.js","../src/controller.js","../src/index.js"],"sourcesContent":["// screensharing workaround\nexport function applyHacks() {\n\tif (window[\"BXDesktopSystem\"])\n\t{\n\t\tnavigator['getDisplayMedia'] = function ()\n\t\t{\n\t\t\tvar mediaParams = {\n\t\t\t\taudio: false,\n\t\t\t\tvideo: {\n\t\t\t\t\tmandatory: {\n\t\t\t\t\t\tchromeMediaSource: 'desktop',\n\t\t\t\t\t\tmaxWidth: screen.width > 1920 ? screen.width : 1920,\n\t\t\t\t\t\tmaxHeight: screen.height > 1080 ? screen.height : 1080,\n\t\t\t\t\t},\n\t\t\t\t\toptional: [{googTemporalLayeredScreencast: true}],\n\t\t\t\t},\n\t\t\t};\n\t\t\treturn navigator.mediaDevices.getUserMedia(mediaParams);\n\t\t};\n\t}\n}\n","import { Type } from 'main.core';\nimport { Utils as MessengerUtils } from 'im.lib.utils';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nexport class BackgroundDialog\n{\n\tstatic isAvailable()\n\t{\n\t\treturn MessengerUtils.platform.getDesktopVersion() >= 52;\n\t}\n\n\tstatic isMaskAvailable()\n\t{\n\t\treturn MessengerUtils.platform.isDesktopFeatureEnabled('mask');\n\t}\n\n\tstatic open(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\t\tconst tab = Type.isStringFilled(options.tab) ? options.tab : 'background'; // mask, background\n\n\t\tif (!this.isAvailable())\n\t\t{\n\t\t\tif (window.BX.Helper)\n\t\t\t{\n\t\t\t\twindow.BX.Helper.show(\"redirect=detail&code=12398124\");\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tconst html =\n\t\t\t`<div id=\"bx-desktop-loader\" class=\"bx-desktop-loader-wrap\">\n\t\t\t\t<div class=\"bx-desktop-loader\">\n\t\t\t\t\t<svg class=\"bx-desktop-loader-circular\" viewBox=\"25 25 50 50\">\n\t\t\t\t\t\t<circle class=\"bx-desktop-loader-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div id=\"placeholder\"></div>`\n\t\t;\n\n\t\tconst js = `BX.Runtime.loadExtension(\"call.component.v2.call-background\").then(function(exports) {\n\t\t\t\tBX.Vue3.BitrixVue.createApp({\n\t\t\t\t\tcomponents: {CallBackground: exports.CallBackground},\n\t\t\t\t\ttemplate: '<CallBackground tab=\"${tab}\"/>',\n\t\t\t\t}).mount(\"#placeholder\");\n\t\t\t});`;\n\n\t\tDesktopApi.createWindow(\"callBackground\", (controller) =>\n\t\t{\n\t\t\tconst title = this.isMaskAvailable() ? BX.message('BXD_CALL_BG_MASK_TITLE') : BX.message('BXD_CALL_BG_TITLE');\n\t\t\tcontroller.SetProperty(\"title\", title);\n\t\t\tcontroller.SetProperty(\"clientSize\", {Width: 943, Height: 670});\n\t\t\tcontroller.SetProperty(\"minClientSize\", {Width: 943, Height: 670});\n\t\t\tcontroller.SetProperty(\"backgroundColor\", \"#2B3038\");\n\t\t\tcontroller.ExecuteCommand(\"center\");\n\t\t\tcontroller.ExecuteCommand(\"html.load\", DesktopApi.prepareHtml(html, js));\n\t\t});\n\n\t\treturn true;\n\t}\n}\n","export const STREAM_QUALITY = {\n\tHIGH: 2,\n\tMEDIUM: 1,\n\tLOW: 0,\n\tNO_VIDEO: -1,\n}\n\nexport const LOCAL_STREAM_QUALITY_HEIGHT = {\n\tHIGH: 720,\n\tMEDIUM: 360,\n\tLOW: 180,\n\tNO_VIDEO: 0,\n}\n","import { Extension } from 'main.core';\n\nexport type CallSettingsType = {\n\tjwtCallsEnabled?: boolean,\n\tplainCallsUseJwt?: boolean,\n\tplainCallFollowUpEnabled ?: boolean,\n\tplainCallCloudRecordingEnabled ?: boolean,\n\tcallBalancerUrl?: string,\n\tnoiseSuppressionEnabled?: boolean,\n};\n\nconst defaultNoiseSuppressionEnabled = false;\n\nclass CallSettings\n{\n\t#noiseSuppressionEnabled = defaultNoiseSuppressionEnabled;\n\tconstructor()\n\t{\n\t\tthis.jwtCallsEnabled = false;\n\t\tthis.plainCallsUseJwt = false;\n\t\tthis.plainCallFollowUpEnabled = false;\n\t\tthis.plainCallCloudRecordingEnabled = false;\n\t\tthis.callBalancerUrl = '';\n\n\t\tif (Extension.getSettings('call.core').call)\n\t\t{\n\t\t\tthis.setup(Extension.getSettings('call.core').call);\n\t\t}\n\t}\n\n\tsetup(settings: CallSettingsType)\n\t{\n\t\tif (settings.jwtCallsEnabled !== undefined)\n\t\t{\n\t\t\tthis.jwtCallsEnabled = settings.jwtCallsEnabled;\n\t\t}\n\n\t\tif (settings.noiseSuppressionEnabled !== undefined)\n\t\t{\n\t\t\tthis.noiseSuppressionEnabled = settings.noiseSuppressionEnabled;\n\t\t}\n\n\t\tif (settings.plainCallsUseJwt !== undefined)\n\t\t{\n\t\t\tthis.plainCallsUseJwt = settings.plainCallsUseJwt;\n\t\t}\n\n\t\tif (settings.plainCallFollowUpEnabled !== undefined)\n\t\t{\n\t\t\tthis.plainCallFollowUpEnabled = settings.plainCallFollowUpEnabled;\n\t\t}\n\n\t\tif (settings.plainCallCloudRecordingEnabled !== undefined)\n\t\t{\n\t\t\tthis.plainCallCloudRecordingEnabled = settings.plainCallCloudRecordingEnabled;\n\t\t}\n\n\t\tif (settings.callBalancerUrl !== undefined)\n\t\t{\n\t\t\tthis.callBalancerUrl = settings.callBalancerUrl;\n\t\t}\n\t}\n\n\tget jwtCallsEnabled(): boolean\n\t{\n\t\treturn this._jwtCallsEnabled;\n\t}\n\n\tset jwtCallsEnabled(value: boolean)\n\t{\n\t\tthis._jwtCallsEnabled = value;\n\t}\n\n\tget plainCallsUseJwt(): boolean\n\t{\n\t\treturn this._plainCallsUseJwt;\n\t}\n\n\tset plainCallsUseJwt(value: boolean)\n\t{\n\t\tthis._plainCallsUseJwt = value;\n\t}\n\n\tget callBalancerUrl(): string\n\t{\n\t\treturn this._callBalancerUrl;\n\t}\n\n\tset callBalancerUrl(value: string)\n\t{\n\t\tthis._callBalancerUrl = value;\n\t}\n\n\tget plainCallFollowUpEnabled(): boolean\n\t{\n\t\treturn this.isJwtInPlainCallsEnabled && this._plainCallFollowUpEnabled;\n\t}\n\n\tset plainCallFollowUpEnabled(value: boolean)\n\t{\n\t\tthis._plainCallFollowUpEnabled = value;\n\t}\n\n\tget plainCallCloudRecordingEnabled(): boolean\n\t{\n\t\treturn this.isJwtInPlainCallsEnabled && this._plainCallCloudRecordingEnabled;\n\t}\n\n\tset plainCallCloudRecordingEnabled(value: boolean)\n\t{\n\t\tthis._plainCallCloudRecordingEnabled = value;\n\t}\n\n\tisJwtInPlainCallsEnabled(): boolean\n\t{\n\t\treturn this.jwtCallsEnabled && this.plainCallsUseJwt;\n\t}\n\n\tget noiseSuppressionEnabled(): boolean\n\t{\n\t\treturn this.#noiseSuppressionEnabled ?? defaultNoiseSuppressionEnabled;\n\t}\n\n\tset noiseSuppressionEnabled(value: boolean)\n\t{\n\t\tthis.#noiseSuppressionEnabled = value;\n\t}\n}\n\nexport const CallSettingsManager = new CallSettings();\n","import { EventEmitter } from 'main.core.events';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nconst lsKey = {\n\tdefaultMicrophone: 'bx-im-settings-default-microphone',\n\tdefaultCamera: 'bx-im-settings-default-camera',\n\tdefaultSpeaker: 'bx-im-settings-default-speaker',\n};\n\nconst Events = {\n\tinitialized: 'initialized',\n\tdeviceChanged: 'deviceChange',\n};\n\nexport class HardwareManager extends EventEmitter\n{\n\tEvents = Events\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Call.HardwareManager');\n\n\t\tthis.initialized = false;\n\t\tthis._currentDeviceList = [];\n\t\tthis.updating = false;\n\t}\n\n\tinit()\n\t{\n\t\tif (this.initialized)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (this.initPromise)\n\t\t{\n\t\t\treturn this.initPromise;\n\t\t}\n\n\t\tthis._checkPermissions();\n\n\t\tthis.initPromise = new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.enumerateDevices()\n\t\t\t\t.then((deviceList) =>\n\t\t\t\t{\n\t\t\t\t\tthis._currentDeviceList = this.filterDeviceList(deviceList);\n\n\t\t\t\t\tnavigator.mediaDevices.addEventListener('devicechange', BX.debounce(this.onNavigatorDeviceChanged.bind(this), 500));\n\t\t\t\t\tthis.initialized = true;\n\t\t\t\t\tthis.initPromise = null;\n\t\t\t\t\tthis.emit(Events.initialized, {});\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.initPromise = null;\n\t\t\t\t\treject(e)\n\t\t\t\t});\n\t\t})\n\n\t\treturn this.initPromise;\n\t}\n\n\tasync _checkPermissions()\n\t{\n\t\tconst cameraPermission = await navigator.permissions.query({ name: 'camera' });\n\t\tconst microphonePermission = await navigator.permissions.query({ name: 'microphone' });\n\n\t\tcameraPermission.onchange = (status) => {\n\t\t\tthis.getCurrentDeviceList();\n\t\t};\n\n\t\tmicrophonePermission.onchange = (status) => {\n\t\t\tthis.getCurrentDeviceList();\n\t\t};\n\t}\n\n\tasync getUserMedia(constraints)\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia)\n\t\t\t{\n\t\t\t\tconst error = new Error(\"NO_WEBRTC\");\n\t\t\t\terror.code = \"NO_WEBRTC\";\n\t\t\t\tthrow error;\n\t\t\t}\n\n\t\t\tnavigator.mediaDevices.getUserMedia(constraints)\n\t\t\t\t.then(stream => {\n\t\t\t\t\tresolve(stream);\n\t\t\t\t})\n\t\t\t\t.catch(err => {\n\t\t\t\t\treject(err);\n\t\t\t\t});\n\t\t});\n\t}\n\n\tasync enumerateDevices() {\n\t\tif (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices)\n\t\t{\n\t\t\tconst error = new Error(\"NO_WEBRTC\");\n\t\t\terror.code = \"NO_WEBRTC\";\n\t\t\tthrow error;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst devices = await navigator.mediaDevices.enumerateDevices();\n\t\t\treturn devices;\n\t\t} catch (e) {\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tget cameraList()\n\t{\n\t\treturn this._getDeviceMap('videoinput');\n\t}\n\n\tget microphoneList()\n\t{\n\t\treturn this._getDeviceMap('audioinput');\n\t}\n\n\tget audioOutputList()\n\t{\n\t\treturn this._getDeviceMap('audiooutput');\n\t}\n\n\tget defaultMicrophone()\n\t{\n\t\tlet microphoneId = localStorage ? localStorage.getItem(lsKey.defaultMicrophone) : '';\n\n\t\tif (\n\t\t\t(!microphoneId || !this.microphoneList[microphoneId])\n\t\t\t&& Object.keys(this.microphoneList).length\n\t\t)\n\t\t{\n\t\t\t// previous solution with ternary operator\n\t\t\t// has been replaced with two separate conditions\n\t\t\t// because some systems / browsers don't create a duplicate for the default audio device\n\t\t\tif (Object.keys(this.microphoneList).includes('default'))\n\t\t\t{\n\t\t\t\tmicrophoneId = this.getDefaultDeviceIdByGroupId(this.getDeviceGroupIdByDeviceId('default', 'audioinput'), 'audioinput');\n\t\t\t}\n\n\t\t\tif (!microphoneId)\n\t\t\t{\n\t\t\t\tmicrophoneId = Object.keys(this.microphoneList)[0];\n\t\t\t}\n\n\t\t\treturn  microphoneId;\n\t\t}\n\t\treturn this.microphoneList[microphoneId] ? microphoneId : '';\n\t}\n\n\tset defaultMicrophone(microphoneId)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultMicrophone, microphoneId)\n\t\t}\n\t}\n\n\tget defaultCamera()\n\t{\n\t\tconst cameraId = localStorage ? localStorage.getItem(lsKey.defaultCamera) : '';\n\n\t\tif (\n\t\t\t(!cameraId || !this.cameraList[cameraId])\n\t\t\t&& Object.keys(this.cameraList).length\n\t\t)\n\t\t{\n\t\t\treturn Object.keys(this.cameraList)[0];\n\t\t}\n\n\t\treturn this.cameraList[cameraId] ? cameraId : '';\n\t}\n\n\tset defaultCamera(cameraId)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultCamera, cameraId)\n\t\t}\n\t}\n\n\tget defaultSpeaker()\n\t{\n\t\tlet speakerId = localStorage ? localStorage.getItem(lsKey.defaultSpeaker) : '';\n\n\t\tif (\n\t\t\t(!speakerId || this.audioOutputList[speakerId])\n\t\t\t&& Object.keys(this.audioOutputList).length\n\t\t)\n\t\t{\n\t\t\tspeakerId = Object.keys(this.audioOutputList).includes('default')\n\t\t\t\t? this.getDefaultDeviceIdByGroupId(this.getDeviceGroupIdByDeviceId('default', 'audiooutput'), 'audiooutput')\n\t\t\t\t: Object.keys(this.audioOutputList)[0]\n\t\t\t;\n\n\t\t\treturn  speakerId;\n\t\t}\n\t\treturn this.audioOutputList[speakerId] ? speakerId : '';\n\t}\n\n\tset defaultSpeaker(speakerId: string)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.defaultSpeaker, speakerId)\n\t\t}\n\t}\n\n\thasCamera()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\n\t\treturn Object.keys(this.cameraList).length > 0;\n\t}\n\n\thasMicrophone()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\n\t\treturn Object.keys(this.microphoneList).length > 0;\n\t}\n\n\tgetMicrophoneList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => (\n\t\t\tdeviceInfo.kind === 'audioinput' && deviceInfo.deviceId !== 'default'\n\t\t));\n\t}\n\n\tgetCameraList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => deviceInfo.kind == 'videoinput')\n\t}\n\n\tgetSpeakerList()\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\n\t\treturn Object.values(this._currentDeviceList).filter(deviceInfo => (\n\t\t\tdeviceInfo.kind === 'audiooutput' && deviceInfo.deviceId !== 'default'\n\t\t));\n\t}\n\n\tcanSelectSpeaker()\n\t{\n\t\treturn 'setSinkId' in HTMLMediaElement.prototype;\n\t}\n\n\tupdateDeviceList(e)\n\t{\n\t\tif (this.updating)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.updating = true;\n\t\tlet removedDevices = this._currentDeviceList;\n\t\tlet addedDevices = [];\n\n\t\tconst shouldSkipDeviceChangedEvent = this._currentDeviceList.every(deviceInfo => deviceInfo.deviceId == '' && deviceInfo.label == '');\n\n\t\tthis.enumerateDevices().then(devices =>\n\t\t{\n\t\t\tdevices = this.filterDeviceList(devices);\n\t\t\tdevices.forEach(deviceInfo =>\n\t\t\t{\n\t\t\t\tconst index = removedDevices.findIndex(dev => (\n\t\t\t\t\tdev.kind === deviceInfo.kind\n\t\t\t\t\t&& dev.deviceId === deviceInfo.deviceId\n\t\t\t\t\t&& dev.groupId === deviceInfo.groupId\n\t\t\t\t))\n\t\t\t\tif (index != -1)\n\t\t\t\t{\n\t\t\t\t\t// device found in previous version\n\t\t\t\t\tremovedDevices.splice(index, 1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\taddedDevices.push(deviceInfo);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._currentDeviceList = devices;\n\n\t\t\tif (!shouldSkipDeviceChangedEvent)\n\t\t\t{\n\t\t\t\tthis.emit(Events.deviceChanged, {\n\t\t\t\t\tadded: addedDevices,\n\t\t\t\t\tremoved: removedDevices\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.updating = false;\n\t\t})\n\t}\n\n\tfilterDeviceList(browserDeviceList)\n\t{\n\t\treturn browserDeviceList.filter(device =>\n\t\t{\n\t\t\tswitch (device.kind)\n\t\t\t{\n\t\t\t\tcase 'audioinput':\n\t\t\t\t\treturn device.deviceId !== 'communications' && !this.isDeviceInBlackList(device);\n\t\t\t\tcase 'audiooutput':\n\t\t\t\t\treturn device.deviceId !== 'communications' && !this.isDeviceInBlackList(device);\n\t\t\t\tdefault:\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t})\n\t}\n\n\tisDeviceInBlackList(device)\n\t{\n\t\tconst deviceBlackList = [\n\t\t\t'(virtual)',\n\t\t\t'zoomaudiodevice',\n\t\t\t'microsoft teams audio',\n\t\t\t'bitrixaudio',\n\t\t];\n\t\tlet result = false;\n\n\t\tdeviceBlackList.forEach(item => {\n\t\t\tif (device.label.toLowerCase().includes(item))\n\t\t\t{\n\t\t\t\tresult = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tonNavigatorDeviceChanged(e)\n\t{\n\t\tif (!this.initialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateDeviceList();\n\t}\n\n\t_getDeviceMap(deviceKind)\n\t{\n\t\tlet result = {};\n\t\tif (!this.initialized)\n\t\t{\n\t\t\tthrow new Error('HardwareManager is not initialized yet');\n\t\t}\n\t\tfor (let i = 0; i < this._currentDeviceList.length; i++)\n\t\t{\n\t\t\tif (this._currentDeviceList[i].kind == deviceKind)\n\t\t\t{\n\t\t\t\tresult[this._currentDeviceList[i].deviceId] = this._currentDeviceList[i].label;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetDefaultDeviceIdByGroupId(groupId, deviceKind)\n\t{\n\t\tlet deviceId;\n\n\t\tthis._currentDeviceList.forEach(device => {\n\t\t\tif (\n\t\t\t\tdevice.groupId === groupId\n\t\t\t\t&& device.deviceId !== 'default'\n\t\t\t\t&& device.kind === deviceKind\n\t\t\t)\n\t\t\t{\n\t\t\t\tdeviceId = device.deviceId;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn deviceId;\n\t}\n\n\tgetDeviceGroupIdByDeviceId(deviceId, deviceKind)\n\t{\n\t\tlet groupId;\n\n\t\tthis._currentDeviceList.forEach(device => {\n\t\t\tif (device.deviceId === deviceId && device.kind === deviceKind)\n\t\t\t{\n\t\t\t\tgroupId = device.groupId;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn groupId;\n\t}\n\n\tremoveDevicesByDefaultGroup(devices)\n\t{\n\t\tlet resultDeviceList = devices;\n\n\t\tdevices.forEach(device => {\n\t\t\tif (device.deviceId === 'default')\n\t\t\t{\n\t\t\t\tresultDeviceList = resultDeviceList.filter(item => (\n\t\t\t\t\titem.kind !== device.kind\n\t\t\t\t\t|| item.groupId !== device.groupId\n\t\t\t\t));\n\t\t\t}\n\t\t});\n\n\t\treturn resultDeviceList;\n\t}\n\n\tgetCurrentDeviceList()\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.enumerateDevices().then(deviceList => {\n\t\t\t\tthis._currentDeviceList = this.filterDeviceList(deviceList);\n\t\t\t\tresolve(this._currentDeviceList, deviceList);\n\t\t\t})\n\t\t});\n\t}\n\n\tgetRemovedUsedDevices(devices, currentDevices)\n\t{\n\t\treturn devices.filter(device =>\n\t\t{\n\t\t\tswitch (device.kind)\n\t\t\t{\n\t\t\t\tcase 'audioinput':\n\t\t\t\t\treturn device.deviceId === currentDevices.microphoneId;\n\t\t\t\tcase 'audiooutput':\n\t\t\t\t\treturn device.deviceId === currentDevices.speakerId;\n\t\t\t\tcase 'videoinput':\n\t\t\t\t\treturn device.deviceId === currentDevices.cameraId;\n\t\t\t\tdefault:\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t})\n\t}\n}","const lsKey = {\n\tenableNoiseSuppression: 'bx-call-settings-enable-noise-suppression',\n};\n\nconst NOISE_SUPPRESSION_WORKLET_PATH = '/bitrix/js/call/lib/noise-suppression-worklet/src/noise-suppression-worklet.js';\n\nexport class NoiseSuppressionService\n{\n\tasync turn(stream)\n\t{\n\t\tif (!this.audioCtx)\n\t\t{\n\t\t\tthis.audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n\t\t\tthis.destination = this.audioCtx.createMediaStreamDestination();\n\t\t}\n\n\t\tif (this.audioCtx.state === 'suspended')\n\t\t{\n\t\t\tawait this.audioCtx.resume();\n\t\t}\n\n\t\tif (stream && (!this.inputSource || this.inputStream !== stream))\n\t\t{\n\t\t\tthis.inputStream?.getAudioTracks().forEach(track => {\n\t\t\t\tconst trackInNewStream = stream.getTrackById(track.id);\n\t\t\t\tif (!trackInNewStream)\n\t\t\t\t{\n\t\t\t\t\ttrack.stop();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.inputSource = this.audioCtx.createMediaStreamSource(stream);\n\t\t\tthis.inputStream = stream;\n\t\t}\n\t\telse if (!stream && !this.inputSource)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.noiseSuppressionNode)\n\t\t{\n\t\t\tawait this.audioCtx.audioWorklet.addModule(NOISE_SUPPRESSION_WORKLET_PATH);\n\t\t\tthis.noiseSuppressionNode = new AudioWorkletNode(this.audioCtx, 'NoiseSuppressorWorklet');\n\t\t}\n\n\t\tif (this.previousEnable === Boolean(this.previousEnable)\n\t\t\t&& this.previousEnable !== this.enable)\n\t\t{\n\t\t\tthis.inputSource.disconnect();\n\t\t}\n\n\t\tif (this.enable)\n\t\t{\n\t\t\tthis.inputSource.connect(this.noiseSuppressionNode);\n\t\t\tthis.noiseSuppressionNode.connect(this.destination);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.inputSource.connect(this.destination);\n\t\t}\n\n\t\tthis.previousEnable = this.enable;\n\t}\n\n\tstop()\n\t{\n\t\tif (this.audioCtx)\n\t\t{\n\t\t\tthis.audioCtx.close();\n\t\t\tthis.audioCtx = null;\n\t\t\tthis.destination = null;\n\t\t}\n\n\t\tif (this.inputSource)\n\t\t{\n\t\t\tthis.inputSource = null;\n\t\t\tthis.inputStream.getAudioTracks().forEach(track => {\n\t\t\t\ttrack.stop();\n\t\t\t});\n\t\t\tthis.inputStream = null;\n\t\t}\n\n\t\tif (this.noiseSuppressionNode)\n\t\t{\n\t\t\tthis.noiseSuppressionNode = null;\n\t\t}\n\n\t\tif (this.previousEnable === Boolean(this.previousEnable))\n\t\t{\n\t\t\tthis.previousEnable = null;\n\t\t}\n\t}\n\n\tget enable(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.enableNoiseSuppression) === 'Y') : false;\n\t}\n\n\tset enable(enableNoiseSuppression: boolean)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.enableNoiseSuppression, enableNoiseSuppression ? 'Y' : 'N');\n\t\t}\n\t}\n}","import { CallSettingsManager } from '../../lib/settings-manager/src/settings-manager';\nimport { HardwareManager } from '../../lib/hardware/src/hardware.js'\nimport { NoiseSuppressionService } from './noiseSuppressionService';\n\nconst lsKey = {\n\tenableMicAutoParameters: 'bx-im-settings-enable-mic-auto-parameters',\n\tpreferHd: 'bx-im-settings-camera-prefer-hd',\n\tenableMirroring: 'bx-im-settings-camera-enable-mirroring',\n};\n\nconst CallEvents = {\n\tonChangeMirroringVideo: 'onChangeMirroringVideo',\n\tonChangeMicrophoneMuted: 'onChangeMicrophoneMuted',\n\tonChangeCameraOn: 'onChangeCameraOn',\n};\n\nclass CallHardwareManager extends HardwareManager\n{\n\t#noiseSuppression: NoiseSuppressionService;\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis._isCameraOn = false;\n\t\tthis._isMicrophoneMuted = false;\n\t\tthis.Events = Object.assign(this.Events, CallEvents);\n\t\tthis.#noiseSuppression = new NoiseSuppressionService();\n\t}\n\n\tget enableMicAutoParameters(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.enableMicAutoParameters) !== 'N') : true;\n\t}\n\n\tset enableMicAutoParameters(enableMicAutoParameters: boolean)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.enableMicAutoParameters, enableMicAutoParameters ? 'Y' : 'N')\n\t\t}\n\t}\n\n\tget preferHdQuality(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.preferHd) !== 'N') : true;\n\t}\n\n\tset preferHdQuality(preferHdQuality: boolean)\n\t{\n\t\tif (localStorage)\n\t\t{\n\t\t\tlocalStorage.setItem(lsKey.preferHd, preferHdQuality ? 'Y' : 'N')\n\t\t}\n\t}\n\n\tget enableMirroring(): boolean\n\t{\n\t\treturn localStorage ? (localStorage.getItem(lsKey.enableMirroring) !== 'N') : true;\n\t}\n\n\tset enableMirroring(enableMirroring: boolean)\n\t{\n\t\tif (this.enableMirroring !== enableMirroring)\n\t\t{\n\t\t\tthis.emit(this.Events.onChangeMirroringVideo, {enableMirroring: enableMirroring});\n\n\t\t\tif (DesktopApi.isDesktop())\n\t\t\t{\n\t\t\t\tDesktopApi.emit(this.Events.onChangeMirroringVideo, [enableMirroring]);\n\t\t\t}\n\t\t\tif (localStorage)\n\t\t\t{\n\t\t\t\tlocalStorage.setItem(lsKey.enableMirroring, enableMirroring ? 'Y' : 'N');\n\t\t\t}\n\t\t}\n\t}\n\n\tget isCameraOn()\n\t{\n\t\treturn this._isCameraOn;\n\t}\n\n\tset isCameraOn(isCameraOn)\n\t{\n\t\tif (this._isCameraOn !== isCameraOn)\n\t\t{\n\t\t\tthis._isCameraOn = isCameraOn;\n\t\t\tthis.emit(this.Events.onChangeCameraOn, {isCameraOn: this._isCameraOn});\n\t\t}\n\t}\n\n\t/*\n\n\tthe setter 'isCameraOn' is duplicated by that function\n\tto emit additional params in 'onChangeCameraOn' event\n\n\tfor task-565624 off all participants mic/cam/screenshare\n\n\t*/\n\n\tsetIsCameraOn(options)\n\t{\n\t\tif (this._isCameraOn !== options.isCameraOn)\n\t\t{\n\t\t\tthis._isCameraOn = options.isCameraOn;\n\t\t\tthis.emit(this.Events.onChangeCameraOn, options);\n\t\t}\n\t}\n\n\tget isMicrophoneMuted()\n\t{\n\t\treturn this._isMicrophoneMuted;\n\t}\n\n\tset isMicrophoneMuted(isMicrophoneMuted)\n\t{\n\t\tif (this._isMicrophoneMuted !== isMicrophoneMuted)\n\t\t{\n\t\t\tthis._isMicrophoneMuted = isMicrophoneMuted;\n\t\t\tthis.emit(this.Events.onChangeMicrophoneMuted, {isMicrophoneMuted: this._isMicrophoneMuted});\n\t\t}\n\t}\n\n\t/*\n\n\tthe setter 'isMicrophoneMuted' is duplicated by that function\n\tto emit additional params in 'onChangeMicrophoneMuted' event\n\n\tfor task-565624 off all participants mic/cam/screenshare\n\n\t*/\n\n\tsetIsMicrophoneMuted(options)\n\t{\n\t\tif (this._isMicrophoneMuted !== options.isMicrophoneMuted)\n\t\t{\n\t\t\tthis._isMicrophoneMuted = options.isMicrophoneMuted;\n\t\t\tthis.emit(this.Events.onChangeMicrophoneMuted, options);\n\t\t}\n\t}\n\n\tasync getUserMedia(constraints)\n\t{\n\t\tconst stream = await super.getUserMedia(constraints);\n\t\tif (!stream\n\t\t\t|| stream.getAudioTracks?.()?.length === 0\n\t\t\t|| !CallSettingsManager.noiseSuppressionEnabled)\n\t\t{\n\t\t\treturn stream;\n\t\t}\n\n\t\treturn this.addNoiseSuppression(stream);\n\t}\n\n\tasync addNoiseSuppression(stream)\n\t{\n\t\tif (this.noiseSuppressionInputStream !== stream)\n\t\t{\n\t\t\tthis.stopNoiseSuppression();\n\t\t}\n\n\t\tawait this.turnNoiseSuppression(stream);\n\n\t\tconst processedAudioTracks = this.#noiseSuppression.destination.stream.getAudioTracks();\n\t\tconst videoTracks = stream.getVideoTracks();\n\n\t\treturn new MediaStream([...videoTracks, ...processedAudioTracks]);\n\t}\n\n\tasync turnNoiseSuppression(stream)\n\t{\n\t\tawait this.#noiseSuppression.turn(stream);\n\t}\n\n\tstopNoiseSuppression()\n\t{\n\t\tthis.#noiseSuppression.stop();\n\t}\n\n\tget enableNoiseSuppression(): boolean\n\t{\n\t\treturn this.#noiseSuppression.enable;\n\t}\n\n\tset enableNoiseSuppression(enableNoiseSuppression: boolean)\n\t{\n\t\tthis.#noiseSuppression.enable = enableNoiseSuppression;\n\t}\n\n\tget noiseSuppressionInputStream(): ?MediaStream\n\t{\n\t\treturn this.#noiseSuppression.inputStream;\n\t}\n}\n\nexport const Hardware = new CallHardwareManager();\n","import { CallSettingsManager } from 'call.lib.settings-manager';\nimport { MediaStreamsKinds } from './call_api';\nimport { Hardware } from './call_hardware';\n\nclass StreamManager\n{\n\t#streams;\n\t#tracks;\n\t#trackRequests;\n\t#isLegacyDesktop: Boolean;\n\n\tconstructor()\n\t{\n\t\tthis.#streams = {};\n\t\tthis.#tracks = {};\n\t\tthis.#trackRequests = {};\n\t\tthis.#isLegacyDesktop = window?.BXDesktopSystem?.GetProperty('versionParts')?.[3] < 78;\n\t}\n\n\tgetLocalStream(mediaStreamKind): ?MediaStreamTrack\n\t{\n\t\treturn this.#tracks[mediaStreamKind]?.track || null;\n\t}\n\n\tasync getUserMedia(constraints): Promise<MediaStream>\n\t{\n\t\tconst promises = this.#getUserMedia(constraints);\n\n\t\treturn this.#processGetUserMediaPromises(promises);\n\t}\n\n\tasync getUserScreen(): Promise<MediaStream>\n\t{\n\t\tconst promises = this.#getUserScreen();\n\n\t\treturn this.#processGetUserMediaPromises(promises);\n\t}\n\n\tstopStream(mediaStreamKind): void\n\t{\n\t\tif (this.#trackRequests[mediaStreamKind])\n\t\t{\n\t\t\tthis.#trackRequests[mediaStreamKind]?.then(() => {\n\t\t\t\tthis.stopStream(mediaStreamKind);\n\t\t\t});\n\t\t\tdelete this.#trackRequests[mediaStreamKind];\n\t\t}\n\n\t\tif (this.#tracks[mediaStreamKind])\n\t\t{\n\t\t\tif (mediaStreamKind === MediaStreamsKinds.Microphone)\n\t\t\t{\n\t\t\t\tHardware.stopNoiseSuppression();\n\t\t\t}\n\t\t\tthis.#tracks[mediaStreamKind].track.stop();\n\t\t\tdelete this.#tracks[mediaStreamKind];\n\t\t}\n\t}\n\n\t#processGetUserMediaPromises(promises): Promise<MediaStream>\n\t{\n\t\treturn Promise.allSettled(promises)\n\t\t\t.then((results) => {\n\t\t\t\tconst tracks = new Map();\n\n\t\t\t\tresults.forEach((result) => {\n\t\t\t\t\tif (result.reason)\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error(result.reason);\n\t\t\t\t\t}\n\n\t\t\t\t\tresult.value.forEach((track) => {\n\t\t\t\t\t\ttracks.set(track.id, track);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tif (tracks.size > 0)\n\t\t\t\t{\n\t\t\t\t\treturn new MediaStream([...tracks.values()]);\n\t\t\t\t}\n\n\t\t\t\tthrow new Error('Could not get any media stream');\n\t\t\t});\n\t}\n\n\t#getUserMedia(constraints): Promise<?MediaStreamTrack>[]\n\t{\n\t\tconst promises = [];\n\t\tconst newConstraints = { video: false, audio: false };\n\t\tconst videoPromise = this.#getMediaPromise(constraints.video, MediaStreamsKinds.Camera);\n\t\tconst audioPromise = this.#getMediaPromise(constraints.audio, MediaStreamsKinds.Microphone);\n\n\t\tif (videoPromise)\n\t\t{\n\t\t\tpromises.push(videoPromise);\n\t\t}\n\t\telse if (constraints.video)\n\t\t{\n\t\t\tnewConstraints.video = constraints.video;\n\t\t}\n\n\t\tif (audioPromise)\n\t\t{\n\t\t\tpromises.push(audioPromise);\n\t\t}\n\t\telse if (constraints.audio)\n\t\t{\n\t\t\tnewConstraints.audio = constraints.audio;\n\t\t}\n\n\t\tif (promises.length === (Number(Boolean(constraints.video)) + Number(Boolean(constraints.audio))))\n\t\t{\n\t\t\treturn promises;\n\t\t}\n\n\t\tconst streamPromise = new Promise((resolve, reject) => {\n\t\t\tHardware.getUserMedia(newConstraints)\n\t\t\t\t.then((stream) => {\n\t\t\t\t\tconst videoTrack = stream.getVideoTracks()?.[0];\n\t\t\t\t\tconst audioTrack = stream.getAudioTracks()?.[0];\n\n\t\t\t\t\tif (videoTrack)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#tracks[MediaStreamsKinds.Camera]?.track?.stop();\n\t\t\t\t\t\tthis.#tracks[MediaStreamsKinds.Camera] = {\n\t\t\t\t\t\t\ttrack: videoTrack,\n\t\t\t\t\t\t\tconstraints: constraints.video,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tdelete this.#trackRequests[MediaStreamsKinds.Camera];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (audioTrack)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (audioTrack.id !== this.#tracks[MediaStreamsKinds.Microphone]?.track.id)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#tracks[MediaStreamsKinds.Microphone]?.track?.stop();\n\t\t\t\t\t\t\tthis.#tracks[MediaStreamsKinds.Microphone] = {\n\t\t\t\t\t\t\t\ttrack: audioTrack,\n\t\t\t\t\t\t\t\tconstraints: constraints.audio,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdelete this.#trackRequests[MediaStreamsKinds.Microphone];\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(stream.getTracks());\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tif (newConstraints.video)\n\t\t\t\t\t{\n\t\t\t\t\t\tdelete this.#tracks[MediaStreamsKinds.Camera];\n\t\t\t\t\t\tdelete this.#trackRequests[MediaStreamsKinds.Camera];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (newConstraints.audio)\n\t\t\t\t\t{\n\t\t\t\t\t\tdelete this.#tracks[MediaStreamsKinds.Microphone];\n\t\t\t\t\t\tdelete this.#trackRequests[MediaStreamsKinds.Microphone];\n\t\t\t\t\t}\n\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\n\t\tif (newConstraints.video)\n\t\t{\n\t\t\tthis.#trackRequests[MediaStreamsKinds.Camera] = streamPromise;\n\t\t}\n\n\t\tif (newConstraints.audio)\n\t\t{\n\t\t\tthis.#trackRequests[MediaStreamsKinds.Microphone] = streamPromise;\n\t\t}\n\n\t\tpromises.push(streamPromise);\n\n\t\treturn promises;\n\t}\n\n\t#getUserScreen(): Promise<?MediaStreamTrack>[]\n\t{\n\t\tconst promises = [];\n\t\tlet streamRequest = null;\n\t\tconst videoPromise = this.#getMediaPromise(undefined, MediaStreamsKinds.Screen);\n\t\tconst audioPromise = this.#getMediaPromise(undefined, MediaStreamsKinds.ScreenAudio);\n\n\t\tif (videoPromise)\n\t\t{\n\t\t\tpromises.push(videoPromise);\n\t\t}\n\n\t\tif (audioPromise)\n\t\t{\n\t\t\tpromises.push(audioPromise);\n\t\t}\n\n\t\tif (promises.length > 0)\n\t\t{\n\t\t\treturn promises;\n\t\t}\n\n\t\tconst screenConstraints = this.#getScreenConstraints();\n\n\t\tif (this.#isLegacyDesktop)\n\t\t{\n\t\t\tstreamRequest = Hardware.getUserMedia(screenConstraints);\n\t\t}\n\t\telse if (navigator.mediaDevices.getDisplayMedia)\n\t\t{\n\t\t\tstreamRequest = navigator.mediaDevices.getDisplayMedia(screenConstraints);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst error = {\n\t\t\t\tmessage: 'Screen sharing is not supported',\n\t\t\t};\n\t\t\tpromises.push(Promise.reject(error));\n\n\t\t\treturn promises;\n\t\t}\n\n\t\tconst streamPromise = new Promise((resolve, reject) => {\n\t\t\tstreamRequest\n\t\t\t\t.then((stream) => {\n\t\t\t\t\tconst videoTrack = stream.getVideoTracks()?.[0];\n\t\t\t\t\tconst audioTrack = stream.getAudioTracks()?.[0];\n\n\t\t\t\t\tif (videoTrack)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#tracks[MediaStreamsKinds.Screen]?.track?.stop();\n\t\t\t\t\t\tthis.#tracks[MediaStreamsKinds.Screen] = {\n\t\t\t\t\t\t\ttrack: videoTrack,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tdelete this.#trackRequests[MediaStreamsKinds.Screen];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (audioTrack)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#tracks[MediaStreamsKinds.ScreenAudio]?.track?.stop();\n\t\t\t\t\t\tthis.#tracks[MediaStreamsKinds.ScreenAudio] = {\n\t\t\t\t\t\t\ttrack: audioTrack,\n\t\t\t\t\t\t};\n\t\t\t\t\t\tdelete this.#trackRequests[MediaStreamsKinds.ScreenAudio];\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve(stream.getTracks());\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tdelete this.#tracks[MediaStreamsKinds.Screen];\n\t\t\t\t\tdelete this.#tracks[MediaStreamsKinds.ScreenAudio];\n\t\t\t\t\tdelete this.#trackRequests[MediaStreamsKinds.Screen];\n\t\t\t\t\tdelete this.#trackRequests[MediaStreamsKinds.ScreenAudio];\n\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\n\t\tthis.#trackRequests[MediaStreamsKinds.Screen] = streamPromise;\n\t\tthis.#trackRequests[MediaStreamsKinds.ScreenAudio] = streamPromise;\n\n\t\tpromises.push(streamPromise);\n\n\t\treturn promises;\n\t}\n\n\t#isSameConstraints(constraintsA, constraintsB): boolean\n\t{\n\t\tif (!constraintsA && !constraintsB)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (!constraintsA || !constraintsB)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst keys1 = Object.keys(constraintsA);\n\t\tconst keys2 = Object.keys(constraintsB);\n\n\t\tif (keys1.length !== keys2.length)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (const key of keys1)\n\t\t{\n\t\t\tif (JSON.stringify(constraintsA[key]) !== JSON.stringify(constraintsB[key]))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#getMediaPromise(constraints, kind): ?Promise<?MediaStreamTrack>\n\t{\n\t\tconst trackRequest = this.#trackRequests[kind];\n\n\t\tif (constraints && trackRequest)\n\t\t{\n\t\t\treturn trackRequest;\n\t\t}\n\n\t\tconst localTrack = this.#tracks[kind];\n\t\tconst isSameConstraints = this.#isSameConstraints(constraints, localTrack?.constraints);\n\t\tconst isInputTrackLived = !CallSettingsManager.noiseSuppressionEnabled\n\t\t\t|| kind !== MediaStreamsKinds.Microphone\n\t\t\t|| (Hardware.noiseSuppressionInputStream\n\t\t\t\t&& Hardware.noiseSuppressionInputStream.getAudioTracks().length > 0\n\t\t\t\t&& Hardware.noiseSuppressionInputStream.getAudioTracks()[0].readyState === 'live');\n\t\tif (\n\t\t\tlocalTrack?.track?.readyState === 'live'\n\t\t\t&& isInputTrackLived\n\t\t\t&& isSameConstraints\n\t\t)\n\t\t{\n\t\t\treturn Promise.resolve([localTrack.track]);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#getScreenConstraints(): MediaStreamConstraints\n\t{\n\t\tconst screenShareWidth = 1920;\n\t\tconst screenShareHeight = 1080;\n\n\t\tif (this.#isLegacyDesktop)\n\t\t{\n\t\t\treturn {\n\t\t\t\tvideo: {\n\t\t\t\t\tmandatory: {\n\t\t\t\t\t\tchromeMediaSource: 'screen',\n\t\t\t\t\t\tmaxWidth: screenShareWidth,\n\t\t\t\t\t\tmaxHeight: screenShareHeight,\n\t\t\t\t\t\tmaxFrameRate: 5,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tvideo: {\n\t\t\t\tcursor: 'always',\n\t\t\t\twidth: {\n\t\t\t\t\tideal: screenShareWidth,\n\t\t\t\t},\n\t\t\t\theight: {\n\t\t\t\t\tideal: screenShareHeight,\n\t\t\t\t},\n\t\t\t},\n\t\t\tsystemAudio: 'include',\n\t\t\taudio: true,\n\t\t};\n\t}\n}\n\nexport const CallStreamManager = new StreamManager();\n","import { CallSettingsManager } from 'call.lib.settings-manager';\nimport { STREAM_QUALITY, LOCAL_STREAM_QUALITY_HEIGHT } from './stream_quality';\nimport { Event, Type } from 'main.core';\n\nimport Util from './util';\nimport { RoomType } from './engine/engine';\nimport { Hardware } from './call_hardware';\nimport { CallStreamManager } from './media-stream-manager';\n\nexport const ClientPlatform = 'web';\n\nexport const ClientVersion = '1.0.0';\n\nexport const MediaStreamsKinds = {\n\tCamera: 1,\n\tMicrophone: 2,\n\tScreen: 3,\n\tScreenAudio: 4,\n}\n\nclass Track {\n\tid = null;\n\tsource = '';\n\ttrack = {};\n\n\tconstructor(id, track) {\n\t\tthis.id = id;\n\t\tthis.source = track.source;\n\t\tthis.track = track\n\t}\n}\n\nclass Message {\n\ttext\n\tfrom\n\ttimestamp\n\n\tconstructor(message) {\n\t\tthis.text = message.message\n\t\tthis.from = message.senderSid\n\t\tthis.timestamp = Math.floor(Date.now() / 1000)\n\t}\n}\n\nexport const CALL_STATE = {\n\tCONNECTED: 'Connected',\n\tPROGRESSING: 'Progressing',\n\tTERMINATED: 'Terminated',\n}\n\nconst VIDEO_QUEUE = {\n\tINITIAL: '',\n\tENABLE: 'enable',\n\tDISABLE: 'disable',\n};\n\nconst LOG_LEVEL = {\n\tINFO: 'INFO',\n\tWARNING: 'WARNING',\n\tERROR: 'ERROR',\n};\n\nconst MONITORING_EVENTS_NAME_LIST = {\n\tTRACK_SUBSCRIPTION_FAILED: 'webrtc_track_subscription_failed',\n\tTRACK_SUBSCRIPTION_DELAY: 'webrtc_track_subscription_delay',\n\tHIGH_PACKET_LOSS_SEND: 'webrtc_high_packet_loss_send',\n\tHIGH_PACKET_LOSS_RECEIVE: 'webrtc_high_packet_loss_receive',\n\tCPU_ISSUES: 'webrtc_cpu_issues',\n\tNETWORK_ISSUES: 'webrtc_network_issues',\n\tNETWORK_LATENCY_MS: 'webrtc_network_latency_ms',\n\tPEER_CONNECTION_REFUSED: 'webrtc_peer_connection_refused',\n\t//PEER_CONNECTION_ISSUES: 'webrtc_peer_connection_issues', // removed\n\tPEER_CONNECTION_ISSUES_HANDLING_OFFER: 'webrtc_peer_connection_issues_handling_offer',\n\tPEER_CONNECTION_ISSUES_HANDLING_ANSWER: 'webrtc_peer_connection_issues_handling_answer',\n\tPEER_CONNECTION_ISSUES_ADDING_ICE_CANDIDATE: 'webrtc_peer_connection_issues_adding_ice_candidate',\n\tUSER_CAMERA_DISABLED: 'webrtc_user_camera_disabled',\n\tUSER_RECONNECTED: 'webrtc_user_reconnected',\n\tLOCAL_VIDEO_STREAM_RECEIVING_FAILED: 'webrtc_local_video_stream_receiving_failed',\n\tLOCAL_MICROPHONE_STREAM_RECEIVING_FAILED: 'webrtc_local_microphone_stream_receiving_failed',\n\tLOCAL_SCREEN_STREAM_RECEIVING_FAILED: 'webrtc_local_screen_stream_receiving_failed',\n\tLOCAL_VIDEO_STREAM_PUBLICATION_FAILED: 'webrtc_local_video_stream_publication_failed',\n\tLOCAL_MICROPHONE_STREAM_PUBLICATION_FAILED: 'webrtc_local_microphone_stream_publication_failed',\n\tLOCAL_SCREEN_STREAM_PUBLICATION_FAILED: 'webrtc_local_screen_stream_publication_failed',\n\n\tSTREAM_FAILURE_TOTAL: 'webrtc_stream_failure_total', // not implemented yet\n\tRECONNECT_ATTEMPTS: 'webrtc_reconnect_attempts', // not implemented yet\n\tRECONNECT_DURATION_SECONDS: 'webrtc_reconnect_duration_seconds', // not implemented yet\n\tCPU_USAGE_PERCENT: 'webrtc_cpu_usage_percent', // not implemented yet\n\tHIGH_PACKET_LOSS_PERCENT: 'webrtc_packet_loss_percent', // not implemented yet\n\tSUBSCRIPTION_DELAY_MS: 'webrtc_subscription_delay_ms', // not implemented yet\n};\n\nconst MONITORING_METRICS = {\n\tCOUNT_TRACKS: 'COUNT_TRACKS',\n\tCOUNT_VIDEO_TRACKS: 'COUNT_VIDEO_TRACKS',\n\tCOUNT_AUDIO_TRACKS: 'COUNT_AUDIO_TRACKS',\n\tPACKET_LOST_RECEIVE: 'PACKET_LOST_RECEIVE',\n\tPACKET_LOST_SEND: 'PACKET_LOST_SEND',\n\tBITRATE_IN: 'BITRATE_IN',\n\tBITRATE_OUT: 'BITRATE_OUT',\n\tCONN_SCORE_CURRENT: 'CONN_SCORE_CURRENT',\n\tFRAMES_LOSS: 'FRAMES_LOSS',\n\tFREEZE_COUNT: 'FREEZE_COUNT',\n\tTOTAL_FREEZE_DURATION: 'TOTAL_FREEZE_DURATION',\n\tJITTER: 'JITTER',\n\tFRAMES_DECODED: 'FRAMES_DECODED',\n\tFRAMES_DROPPED: 'FRAMES_DROPPED',\n\tFRAMES_RECEIVED: 'FRAMES_RECEIVED',\n};\n\nconst MONITORING_METRICS_PHROMETEUS = {\n\tCOUNT_TRACKS: 'webrtc_active_tracks',\n\tCOUNT_VIDEO_TRACKS: 'webrtc_active_video_tracks',\n\tCOUNT_AUDIO_TRACKS: 'webrtc_active_audio_tracks',\n\tPACKET_LOST_RECEIVE: 'webrtc_packets_lost_receive_total',\n\tPACKET_LOST_SEND: 'webrtc_packets_lost_send_total',\n\tBITRATE_IN: 'webrtc_bitrate_receive_bps',\n\tBITRATE_OUT: 'webrtc_bitrate_send_bps',\n\tCONN_SCORE_CURRENT: 'webrtc_connection_score',\n\tFRAMES_LOSS: 'webrtc_frames_lost_total',\n\tFREEZE_COUNT: 'webrtc_freeze_count_total',\n\tTOTAL_FREEZE_DURATION: 'webrtc_freeze_duration_seconds_total',\n\tJITTER: 'webrtc_jitter_seconds',\n\tFRAMES_DECODED: 'webrtc_frames_decoded_total',\n\tFRAMES_DROPPED: 'webrtc_frames_dropped_total',\n\tFRAMES_RECEIVED: 'webrtc_frames_received_total',\n};\n\nexport const RecorderStatus = {\n\tUNAVAILABLE: 0, // recording not available at the moment\n\tNONE: 1, // recording not started but available\n\tENABLED: 2, // recording started and not paused\n\tDISABLED: 3, // recording stopped and can not be resumed\n\tPAUSED: 4, // recording started and paused\n\tDESTROYED: 5, // recording will be aborted and no results will be provided\n};\n\nexport const CloudRecordStatus = {\n\tNONE: 1, // record not started\n\tSTARTED: 2, // record started and not paused\n\tSTOPPED: 3, // record stopped and can not be resumed\n\tPAUSED: 4, // record started and paused\n\tDESTROYED: 5, // record will be aborted and no results will be provided\n};\n\nexport const CloudRecordKind = {\n\tAUDIO: 1,\n\tVIDEO: 2,\n};\n\nconst ReconnectionReason = {\n\tNetworkError: 'NetworkError',\n\tPingPongMissed: 'PingPongMissed',\n\tPeerConnectionFailed: 'PeerConnectionFailed',\n\tWsTransportClosed: 'WsTransportClosed',\n\tLeaveCommand: 'LeaveCommand',\n\tJoinResponseError: 'JoinResponseError',\n};\n\nexport const JoinRequestFailedCodes = {\n\tCanNotCreateRoom: 1,\n\tInputError: 2,\n\tAccessDenied: 3,\n\tRoomNotFound: 5,\n\tMalfunctioningSignaling: 7,\n\tJsonParsingError: 'JsonParsingError',\n\tUnexpectedResponse: 'UnexpectedResponse',\n\tUnknownError: 'UnknownError',\n};\n\nexport const ConnectionType = {\n\tPeerToPeer: 0,\n\tMediaServer: 1,\n};\n\nconst CloseCode = {\n\tNormal: 1000,\n\tReconnect: 4001,\n};\n\nexport class JoinResponseError extends Error\n{\n\tconstructor(message, code) {\n\t\tlet errorCode = null;\n\t\tlet name = null;\n\t\tconst fondedCodePair = Object\n\t\t\t.entries(JoinRequestFailedCodes)\n\t\t\t.find(([_, failedCode]) => failedCode === code);\n\t\tif (fondedCodePair)\n\t\t{\n\t\t\t[name, errorCode] = fondedCodePair;\n\t\t}\n\n\t\tif (!name)\n\t\t{\n\t\t\tname = 'UnknownError';\n\t\t}\n\n\t\tsuper(message);\n\t\tthis.name = name;\n\t\tthis.code = errorCode ?? code;\n\t}\n}\n\nconst CallApiEvent = {\n\tReconnected: 'Reconnected',\n\tConnected: 'Connected',\n};\n\nexport class Call {\n\tsender = null;\n\trecipient = null;\n\t#privateProperties = {\n\t\tcodec: 'vp8',\n\t\tcanReconnect: true,\n\t\tlogs: {},\n\t\tisloggingEnable: true,\n\t\tloggerCallback: null,\n\t\tabortController: new AbortController(),\n\t\tisWaitAnswer: false,\n\t\treportsForIncomingTracks: {},\n\t\toutgoingTracksReports: {},\n\t\tprevParticipantsWithLargeDataLoss: new Set(),\n\t\ttracksDataFromSocket: {},\n\t\trealTracksIds: {}, // todo: check why track ids are different in a stream and in the track itself\n\t\tmediaServerUrl: null,\n\t\tmonitoringServerUrl: '',\n\t\tmonitoringLogsServerUrl: '',\n\t\tmonitoringJwtToken: '',\n\t\tmonitoringEnvironment: '',\n\t\tmonitoringRegion: '',\n\t\troomData: null,\n\t\troomType: RoomType.Small,\n\t\troomId: null,\n\t\tisLegacy: false,\n\t\ttoken: null,\n\t\tendpoint: null,\n\t\tjwt: null,\n\t\toptions: null,\n\t\ticeServers: null,\n\t\tsocketConnect: null,\n\t\tpeerConnectionFailed: false,\n\t\tpendingOffer: null,\n\t\tpendingCandidates: {\n\t\t\trecipient: [],\n\t\t\tsender: [],\n\t\t},\n\t\tpendingPublications: {},\n\t\tpendingSubscriptions: {},\n\t\tpublicationTimeout: 10000,\n\t\tsubscriptionTimeout: 1500,\n\t\tsubscriptionTries: 5,\n\t\tcameraStream: null,\n\t\tmicrophoneStream: null,\n\t\tscreenStream: null,\n\t\tneedToStopStreams: true,\n\t\tmediaMutedBySystem: false,\n\t\tneedToEnableAudioAfterSystemMuted: false,\n\t\tneedToDisableAudioAfterPublish: false,\n\t\tlocalTracks: {},\n\t\tlocalConnectionQuality: 0,\n\t\tminimalConnectionQuality: 2,\n\t\trtt: 0,\n\t\tpingIntervalDuration: 0,\n\t\tpingTimeoutDuration: 0,\n\t\tontrackData: {},\n\t\tremoteTracks: {},\n\t\tremoteParticipants: {},\n\t\tparticipantsToUpdateTrackAvailability: {},\n\t\tmainStream: {},\n\t\tpingPongTimeout: null,\n\t\tpingPongInterval: null,\n\t\tuserId: '',\n\t\tlocalParticipantSid: '',\n\t\tdefaultVideoResolution: {\n\t\t\twidth: 1280,\n\t\t\theight: 720\n\t\t},\n\t\tdefaultSimulcastBitrate: {\n\t\t\tq: 120000,\n\t\t\th: 300000,\n\t\t\tf: 1000000\n\t\t},\n\t\tdefaultRemoteStreamsQuality: STREAM_QUALITY.MEDIUM,\n\t\taudioBitrate: 70000,\n\t\tvideoBitrate: 1500000,\n\t\tscreenBitrate: 1500000,\n\t\tvideoSimulcast: true,\n\t\tscreenSimulcast: false,\n\t\tevents: new Map(),\n\t\toffersStack: 0,\n\t\taudioDeviceId: '',\n\t\tswitchActiveAudioDeviceInProgress: null,\n\t\tswitchActiveAudioDevicePending: null,\n\t\tvideoDeviceId: '',\n\t\tswitchActiveVideoDeviceInProgress: null,\n\t\tswitchActiveVideoDevicePending: null,\n\t\tisReconnecting: false,\n\t\treconnectionAttempt: 0,\n\t\treconnectionTimeout: null,\n\t\tlastReconnectionReason: null,\n\t\tfastReconnectionDelay: 1000,\n\t\treconnectionDelay: 5000,\n\t\tcallStatsInterval: null,\n\t\tcallState: '',\n\t\twasConnected: false,\n\t\tpacketLostThreshold: 7,\n\t\tstatsTimeout: 3000,\n\t\tvideoQueue: VIDEO_QUEUE.INITIAL,\n\t\tvideoStreamSetupErrorList: {},\n\t}\n\n\tconstructor() {\n\t\tthis.sendLeaveBound = this.#sendLeave.bind(this);\n\t\tthis.beforeDisconnectBound = this.#beforeDisconnect.bind(this);\n\n\t\tthis.monitoringEvents = [];\n\t\tthis.monitoringDelayTime = 30000;\n\t\tthis.monitoringIntervalTime = 5000;\n\t\tthis.countMetricsInMetricsInterval = this.monitoringDelayTime / this.#privateProperties.statsTimeout;\n\t\tthis.monitoringInterval = null;\n\n\t\tthis.currentMonitoringEventsObject =\n\t\t{\n\t\t\tmetrics: [],\n\t\t\tevents: [],\n\t\t\tlogs: [],\n\t\t\tincreasingEvents: [],\n\t\t};\n\n\t\tthis.currentMonitoringRtcStatsObject = {};\n\n\t\tthis.prevInboundRtpStatsSum = {\n\t\t\tfreezeCount: 0,\n\t\t\ttotalFreezesDuration: 0,\n\t\t\tjitter: 0,\n\t\t\tframesDecoded: 0,\n\t\t\tframesDropped: 0,\n\t\t\tframesReceived: 0,\n\t\t};\n\n\t\tEvent.EventEmitter.subscribe('BX.Call.Logger:sendLog', (event) => {\n\t\t\tthis.setLog(event.data);\n\t\t});\n\n\t\tthis.initConnectionEvent();\n\n\t\tHardware.maxLocalStreamQualityHeight = LOCAL_STREAM_QUALITY_HEIGHT.HIGH;\n\t}\n\n\tget iceServers()\n\t{\n\t\treturn this.#privateProperties.iceServers;\n\t}\n\n\tget remoteParticipantsCount()\n\t{\n\t\treturn Object.keys(this.#privateProperties.remoteParticipants).length;\n\t}\n\n\tget isMediaMutedBySystem()\n\t{\n\t\treturn this.#privateProperties.mediaMutedBySystem;\n\t}\n\n\tset needToStopStreams(needToStopStreams)\n\t{\n\t\tthis.#privateProperties.needToStopStreams = Boolean(needToStopStreams);\n\t}\n\n\tonChangeConnection(connection)\n\t{\n\t\tconst rtt = connection.rtt;\n\n\t\tif (!rtt && !this.#privateProperties.isReconnecting)\n\t\t{\n\t\t\tthis.#beforeDisconnect();\n\t\t\tthis.#reconnect({\n\t\t\t\treconnectionReason: 'ON_CHANGE_CONNECTION',\n\t\t\t\treconnectionReasonInfo: `RTT: ${rtt}`,\n\t\t\t});\n\t\t}\n\t}\n\n\tinitConnectionEvent()\n\t{\n\t\tconst connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;\n\n\t\tif (!connection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconnection.addEventListener('change', () =>\n\t\t{\n\t\t\tthis.onChangeConnection(connection);\n\t\t});\n\t}\n\n\tcheckMetricsFeatureAndExecutionCallback(callback)\n\t{\n\t\tif (typeof callback === 'function' && Util.isMetricsEnabled())\n\t\t{\n\t\t\tcallback();\n\t\t}\n\t}\n\n\tclearMonitoringEvents()\n\t{\n\t\tthis.monitoringEvents = [];\n\t}\n\n\tcalcBitrateSumFromArray({ bitrateArray })\n\t{\n\t\tif (bitrateArray && Array.isArray(bitrateArray))\n\t\t{\n\t\t\treturn bitrateArray.reduce((acc, currentValue) => acc + currentValue.bitrate || 0, 0);\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\taddValidatedMonitoringMetric({ additionalData, metricValue, metricKey })\n\t{\n\t\tif (!this.currentMonitoringRtcStatsObject[metricKey])\n\t\t{\n\t\t\tthis.currentMonitoringRtcStatsObject[metricKey] = {\n\t\t\t\tmetric:\n\t\t\t\t\t{\t__name__: MONITORING_METRICS_PHROMETEUS[metricKey] || metricKey,\n\t\t\t\t\t\tuser_id: String(this.#privateProperties.userId),\n\t\t\t\t\t\tsession_id: String(this.#privateProperties.roomId),\n\t\t\t\t\t\tenv: String(this.#privateProperties.monitoringEnvironment),\n\t\t\t\t\t\tregion: String(this.#privateProperties.monitoringRegion),\n\t\t\t\t\t\tplatform: ClientPlatform,\n\t\t\t\t\t},\n\t\t\t\tvalues: [],\n\t\t\t\ttimestamps: [],\n\t\t\t};\n\t\t}\n\n\t\tthis.currentMonitoringRtcStatsObject[metricKey].values.push(metricValue);\n\t\tthis.currentMonitoringRtcStatsObject[metricKey].timestamps.push(Date.now());\n\n\t\tif (this.currentMonitoringEventsObject.metrics[metricKey])\n\t\t{\n\t\t\tthis.currentMonitoringEventsObject.metrics[metricKey].push(metricValue);\n\t\t}\n\t}\n\n\taddMonitoringEvents({ name, value = 1, withCounter = false })\n\t{\n\t\tconst currentEventIndex = this.currentMonitoringEventsObject.events.findIndex(evt => evt.name === name);\n\n\t\tif (withCounter)\n\t\t{\n\t\t\tconst currentIncreasingEventIndex = this.currentMonitoringEventsObject.increasingEvents.findIndex(evt => evt.name === name);\n\n\t\t\tif (currentIncreasingEventIndex === -1)\n\t\t\t{\n\t\t\t\tthis.currentMonitoringEventsObject.increasingEvents.push({name, value});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.currentMonitoringEventsObject.increasingEvents[currentIncreasingEventIndex].value += 1;\n\t\t\t\tvalue = this.currentMonitoringEventsObject.increasingEvents[currentIncreasingEventIndex].value;\n\t\t\t}\n\t\t}\n\n\t\tthis.addValidatedMonitoringMetric({\n\t\t\tmetricKey: name,\n\t\t\tmetricValue: value,\n\t\t});\n\t}\n\n\tsetClearValuesForCurrentMonitoringEventsObject()\n\t{\n\t\tthis.currentMonitoringEventsObject.events = [];\n\t\tthis.currentMonitoringEventsObject.logs = [];\n\t\tthis.currentMonitoringEventsObject.metrics = this.fillDefaultValueMonitoringMetrics();\n\t}\n\n\tgetCountRemoteTracks()\n\t{\n\t\tlet countVideoTracks = 0;\n\t\tlet countAudioTracks = 0;\n\n\t\tObject.values(this.#privateProperties.remoteParticipants).forEach(participant =>\n\t\t{\n\t\t\tif (participant.getTrack(MediaStreamsKinds.Camera) && !participant.isMutedVideo && !participant.isLocalVideoMute)\n\t\t\t{\n\t\t\t\tcountVideoTracks += 1;\n\t\t\t}\n\n\t\t\tif (participant.getTrack(MediaStreamsKinds.Microphone) && !participant.isMutedAudio)\n\t\t\t{\n\t\t\t\tcountAudioTracks += 1;\n\t\t\t}\n\n\t\t\tif (participant.getTrack(MediaStreamsKinds.Screen))\n\t\t\t{\n\t\t\t\tcountVideoTracks += 1;\n\t\t\t}\n\n\t\t\tif (participant.getTrack(MediaStreamsKinds.ScreenAudio))\n\t\t\t{\n\t\t\t\tcountAudioTracks += 1;\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tcountVideoTracks,\n\t\t\tcountAudioTracks,\n\t\t}\n\t}\n\n\tgetDefaultValueMonitoringMetric(key)\n\t{\n\t\tswitch (key)\n\t\t{\n\t\t\tcase 'COUNT_TRACKS':\n\t\t\t\treturn {\n\t\t\t\t\tvideo: 0,\n\t\t\t\t\taudio: 0,\n\t\t\t\t};\n\t\t\tdefault:\n\t\t\t\treturn [];\n\t\t}\n\t}\n\n\tfillDefaultValueMonitoringMetrics()\n\t{\n\t\treturn Object.entries(MONITORING_METRICS).reduce((acc, [key, value]) => {\n\t\t\tacc[value] = this.getDefaultValueMonitoringMetric(key);\n\t\t\treturn acc;\n\t\t}, {});\n\t}\n\n\tstartAggregateMonitoringEvents()\n\t{\n\t\tthis.setClearValuesForCurrentMonitoringEventsObject();\n\n\t\tif (Util.isMetricsEnabled())\n\t\t{\n\t\t\tthis.monitoringInterval = setInterval(() => {\n\t\t\t\tconst { countVideoTracks, countAudioTracks } = this.getCountRemoteTracks();\n\n\t\t\t\tthis.currentMonitoringEventsObject.metrics[MONITORING_METRICS.COUNT_TRACKS] = {\n\t\t\t\t\tvideo: countVideoTracks,\n\t\t\t\t\taudio: countAudioTracks,\n\t\t\t\t};\n\t\t\t}, this.monitoringIntervalTime);\n\t\t}\n\n\t\tthis.monitoringTimeout = setTimeout(() => {\n\t\t\tclearTimeout(this.monitoringTimeout);\n\t\t\tthis.monitoringTimeout = null;\n\n\t\t\tif (this.#privateProperties.isReconnecting)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.sendMonitoringEvents();\n\t\t}, this.monitoringDelayTime);\n\n\t}\n\n\tsendLogMonitoringRtcStats()\n\t{\n\t\tif (Util.isMetricsEnabled())\n\t\t{\n\t\t\tconst isRtcStatsNotEmpty = !!Object.keys(this.currentMonitoringRtcStatsObject);\n\n\t\t\tlet metricsResultString = '';\n\n\t\t\tif (isRtcStatsNotEmpty)\n\t\t\t{\n\t\t\t\tfor (let key in this.currentMonitoringRtcStatsObject)\n\t\t\t\t{\n\t\t\t\t   if (this.currentMonitoringRtcStatsObject.hasOwnProperty(key))\n\t\t\t\t   {\n\t\t\t\t\t\tmetricsResultString += JSON.stringify(this.currentMonitoringRtcStatsObject[key]) + '\\r\\n';\n\t\t\t\t   }\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (let key in this.currentMonitoringEventsObject.events)\n\t\t\t{\n\t\t\t   if (this.currentMonitoringEventsObject.events.hasOwnProperty(key))\n\t\t\t   {\n\t\t\t\t\tmetricsResultString += JSON.stringify(this.currentMonitoringEventsObject.events[key]) + '\\r\\n';\n\t\t\t   }\n\t\t\t}\n\n\t\t\tif (metricsResultString)\n\t\t\t{\n\t\t\t\tthis.sendMonitoringHandler(metricsResultString, this.#privateProperties.monitoringServerUrl, this.#privateProperties.monitoringJwtToken);\n\t\t\t}\n\t\t}\n\n\t\tif (Util.isMetricsLogsEnabled() && this.currentMonitoringEventsObject.logs.length)\n\t\t{\n\t\t\tconst otplLogsStructure =\n\t\t\t{\n\t\t\t\tresourceLogs:\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t resource: {\n\t\t\t\t\t\tattributes:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'service.name': 'call-logs',\n\t\t\t\t\t\t\t'service.version': 'v0.0.1',\n\t\t\t\t\t\t\tplatform: ClientPlatform,\n\t\t\t\t\t\t},\n\t\t\t\t\t },\n\t\t\t\t\t\tscopeLogs:\n\t\t\t\t\t\t[{\n\t\t\t\t\t\t\tscope:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname: 'call-logs',\n\t\t\t\t\t\t\t\tversion: 'v0.0.1',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlogRecords: this.currentMonitoringEventsObject.logs,\n\t\t\t\t\t\t}],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t};\n\n\t\t\tconst resultLogsStr = JSON.stringify(otplLogsStructure);\n\n\t\t\tthis.sendMonitoringHandler(resultLogsStr, this.#privateProperties.monitoringLogsServerUrl, this.#privateProperties.monitoringJwtToken);\n\t\t}\n\n\t\tthis.currentMonitoringRtcStatsObject = {};\n\t}\n\n\tsendMonitoringHandler(data, url, token)\n\t{\n\t\tif (!url)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst xhr = new XMLHttpRequest();\n\t\txhr.open('POST', url, true);\n\t\txhr.setRequestHeader('Content-Type', 'application/json');\n\n\t\tif (token)\n\t\t{\n\t\t\txhr.setRequestHeader('Authorization', 'Bearer ' + token);\n\t\t}\n\n\t\txhr.send(data);\n\t}\n\n\tsendMonitoringEvents(withRestart = true)\n\t{\n\t\tthis.sendLogMonitoringRtcStats();\n\n\t\tclearInterval(this.monitoringInterval);\n\t\tthis.monitoringInterval = null;\n\t\tclearTimeout(this.monitoringTimeout);\n\t\tthis.monitoringTimeout = null;\n\n\t\tif (withRestart)\n\t\t{\n\t\t\tthis.startAggregateMonitoringEvents();\n\t\t}\n\t}\n\n\tonPublishFailed(kind)\n\t{\n\t\tthis.triggerEvents('PublishFailed', [kind]);\n\t\tlet eventName;\n\t\tif (kind === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\teventName = MONITORING_EVENTS_NAME_LIST.LOCAL_VIDEO_STREAM_PUBLICATION_FAILED;\n\t\t}\n\t\telse if (kind === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\teventName = MONITORING_EVENTS_NAME_LIST.LOCAL_MICROPHONE_STREAM_PUBLICATION_FAILED;\n\t\t}\n\t\telse if (kind === MediaStreamsKinds.Screen)\n\t\t{\n\t\t\teventName = MONITORING_EVENTS_NAME_LIST.LOCAL_SCREEN_STREAM_PUBLICATION_FAILED;\n\t\t}\n\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t{\n\t\t\tthis.addMonitoringEvents({\n\t\t\t\tname: eventName,\n\t\t\t\twithCounter: true,\n\t\t\t});\n\t\t});\n\t}\n\n\tasync connect(options) {\n\t\tthis.setLog(`Connecting to the call (desktop: ${Util.isDesktop()})`, LOG_LEVEL.INFO);\n\t\tthis.#privateProperties.callState = CALL_STATE.PROGRESSING\n\n\t\tfor (let key in options) {\n\t\t\tthis.#privateProperties[`${key}`] = options[key]\n\t\t}\n\n\t\tif (this.#privateProperties.isLegacy)\n\t\t{\n\t\t\tif (!this.#privateProperties.endpoint)\n\t\t\t{\n\t\t\t\tthis.setLog(`Missing required param 'endpoint' from backend, disconnecting`, LOG_LEVEL.ERROR);\n\t\t\t\tthis.triggerEvents('Failed', [{name: 'AUTHORIZE_ERROR', message: `Missing required param 'endpoint'`}]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!this.#privateProperties.jwt)\n\t\t\t{\n\t\t\t\tthis.setLog(`Missing required param 'jwt' from backend, disconnecting`, LOG_LEVEL.ERROR);\n\t\t\t\tthis.triggerEvents('Failed', [{name: 'AUTHORIZE_ERROR', message: `Missing required param 'jwt'`}]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#privateProperties.endpoint = this.#privateProperties.endpoint.replace(/\\/+$/, '');\n\t\t}\n\n\t\tconst canConnect = this.#privateProperties.mediaServerUrl && this.#privateProperties.roomData;\n\n\t\tif (!canConnect)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst mediaServerInfo = await this.getMediaServerInfo();\n\n\t\t\t\tthis.#privateProperties.mediaServerUrl = mediaServerInfo.mediaServerUrl;\n\t\t\t\tthis.#privateProperties.roomData = mediaServerInfo.roomData;\n\t\t\t\tthis.#privateProperties.roomType = mediaServerInfo.roomType;\n\t\t\t\tthis.#privateProperties.monitoringServerUrl = mediaServerInfo.monitoringServerUrl;\n\t\t\t\tthis.#privateProperties.monitoringLogsServerUrl = mediaServerInfo.monitoringLogsServerUrl;\n\t\t\t\tthis.#privateProperties.monitoringJwtToken = mediaServerInfo.monitoringJwtToken;\n\t\t\t\tthis.#privateProperties.monitoringEnvironment = mediaServerInfo.monitoringEnvironment;\n\t\t\t\tthis.#privateProperties.monitoringRegion = mediaServerInfo.monitoringRegion;\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tif (error.name !== 'AbortError' && !this.#privateProperties.abortController.signal.aborted)\n\t\t\t\t{\n\t\t\t\t\t// don't write error.name and error.message to analytics now,\n\t\t\t\t\t// because we don't watch failed reconnecting requests now\n\n\t\t\t\t\tthis.#reconnect({\n\t\t\t\t\t\treconnectionReason: 'GET_MEDIASERVER_INFO',\n\t\t\t\t\t\treconnectionReasonInfo: error?.name || '',\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse if (this.#privateProperties.abortController.signal.aborted)\n\t\t\t\t{\n\t\t\t\t\tthis.triggerEvents('Failed', [error]);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#privateProperties.abortController.signal.aborted)\n\t\t{\n\t\t\tthis.#beforeDisconnect();\n\t\t\treturn;\n\t\t}\n\t\tthis.#privateProperties.abortController.signal.addEventListener('abort', this.beforeDisconnectBound);\n\n\t\tthis.#privateProperties.socketConnect = new WebSocket(\n\t\t\t`${this.#privateProperties.mediaServerUrl}?auto_subscribe=1&sdk=js&version=1.6.7&protocol=8`\n\t\t\t+`&roomData=${this.#privateProperties.roomData}`\n\t\t\t+`&clientVersion=${ClientVersion}`\n\t\t\t+`&clientPlatform=${ClientPlatform}`);\n\n\t\tthis.#privateProperties.socketConnect.onmessage = (e) => this.socketOnMessageHandler(e);\n\t\tthis.#privateProperties.socketConnect.onopen = () => this.socketOnOpenHandler();\n\t\tthis.#privateProperties.socketConnect.onerror = () => this.socketOnErrorHandler();\n\t\tthis.#privateProperties.socketConnect.onclose = (e) => this.socketOnCloseHandler(e);\n\t};\n\n\t#reconnect(data) {\n\t\tthis.#privateProperties.isReconnecting = true;\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\n\t\tconst reconnect = () =>\n\t\t{\n\t\t\tconst reconnectionDelay = this.#privateProperties.lastReconnectionReason !== ReconnectionReason.JoinResponseError\n\t\t\t\t? this.#privateProperties.fastReconnectionDelay\n\t\t\t\t: this.#privateProperties.reconnectionDelay;\n\t\t\tthis.setLog(`Reconnecting attempt: ${++this.#privateProperties.reconnectionAttempt}`, LOG_LEVEL.WARNING);\n\t\t\tthis.#privateProperties.reconnectionTimeout = setTimeout(this.connect.bind(this), reconnectionDelay);\n\t\t};\n\n\t\treconnect();\n\n\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t{\n\t\t\tthis.addMonitoringEvents({\n\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.USER_RECONNECTED,\n\t\t\t\twithCounter: true,\n\t\t\t});\n\t\t});\n\n\t\tthis.triggerEvents('Reconnecting', [data]);\n\t};\n\n\t#beforeDisconnect(options: Object): void\n\t{\n\t\tconst disconnectOptions = Type.isObject(options) ? options : {};\n\t\twindow.removeEventListener('unload', this.sendLeaveBound);\n\t\tthis.#clearPingInterval();\n\t\tthis.#clearPingTimeout();\n\t\tclearInterval(this.#privateProperties.callStatsInterval);\n\n\t\tthis.#privateProperties.mediaServerUrl = '';\n\t\tthis.#privateProperties.roomData = '';\n\t\tthis.#privateProperties.pendingOffer = null;\n\t\tthis.#privateProperties.pendingCandidates = { recipient: [], sender: [] };\n\n\t\tthis.#privateProperties.localTracks = {};\n\t\tthis.#privateProperties.isWaitAnswer = false;\n\n\t\tif (this.#privateProperties.socketConnect)\n\t\t{\n\t\t\tconst closeCode = disconnectOptions.initiatedByUser ? CloseCode.Normal : CloseCode.Reconnect;\n\t\t\tthis.#privateProperties.socketConnect.onmessage = null;\n\t\t\tthis.#privateProperties.socketConnect.onopen = null;\n\t\t\tthis.#privateProperties.socketConnect.onerror = null;\n\t\t\tthis.#privateProperties.socketConnect.onclose = null;\n\t\t\tthis.#privateProperties.socketConnect.close(closeCode);\n\t\t\tthis.#privateProperties.socketConnect = null;\n\t\t}\n\t}\n\n\tgetMediaServerInfo()\n\t{\n\t\tlet request = null;\n\n\t\tif (this.#privateProperties.isLegacy)\n\t\t{\n\t\t\tlet url = `${this.#privateProperties.endpoint}/join`;\n\t\t\turl += `?token=${this.#privateProperties.jwt}`;\n\t\t\turl += `&clientVersion=${ClientVersion}`;\n\t\t\turl += `&clientPlatform=${ClientPlatform}`;\n\n\t\t\trequest = new Promise((resolve, reject) => {\n\t\t\t\tfetch(url, {\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t\tsignal: this.#privateProperties.abortController.signal,\n\t\t\t\t})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\treturn response.json();\n\t\t\t\t\t})\n\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\trequest = Util.getCallConnectionDataById(this.#privateProperties.roomId);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst isErrorPreventingReconnection = (code) => {\n\t\t\t\tconst reconnectionStoppableCodeNames = new Set(['InputError', 'AccessDenied', 'RoomNotFound', 'MalfunctioningSignaling', 'CanNotCreateRoom']);\n\n\t\t\t\treturn Object.entries(JoinRequestFailedCodes)\n\t\t\t\t\t.some(([failedName, failedCode]) => reconnectionStoppableCodeNames.has(failedName) && failedCode === code);\n\t\t\t};\n\n\t\t\trequest\n\t\t\t\t.then((data) => {\n\t\t\t\t\tif (data.error)\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow data.error;\n\t\t\t\t\t}\n\t\t\t\t\telse if (!data?.result?.mediaServerUrl || !data?.result?.roomData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow {\n\t\t\t\t\t\t\tname: 'MEDIASERVER_MISSING_PARAMS',\n\t\t\t\t\t\t\tmessage: 'Incorrect signaling response',\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\tconst {\n\t\t\t\t\t\tmediaServerUrl,\n\t\t\t\t\t\troomData,\n\t\t\t\t\t\troomType,\n\t\t\t\t\t} = data.result;\n\n\t\t\t\t\tconst monitoringServerUrl = data.result.monitoring?.metricsServerUrl;\n\t\t\t\t\tconst monitoringLogsServerUrl = data.result.monitoring?.logsServerUrl;\n\t\t\t\t\tconst monitoringJwtToken = data.result.monitoring?.token;\n\t\t\t\t\tconst monitoringEnvironment = data.result.monitoring?.env;\n\t\t\t\t\tconst monitoringRegion = data.result.monitoring?.region;\n\n\t\t\t\t\tresolve(\n\t\t\t\t\t{\n\t\t\t\t\t\tmediaServerUrl,\n\t\t\t\t\t\troomData,\n\t\t\t\t\t\troomType,\n\t\t\t\t\t\tmonitoringServerUrl,\n\t\t\t\t\t\tmonitoringLogsServerUrl,\n\t\t\t\t\t\tmonitoringJwtToken,\n\t\t\t\t\t\tmonitoringEnvironment,\n\t\t\t\t\t\tmonitoringRegion,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(error.code && isErrorPreventingReconnection(error.code))\n\t\t\t\t\t\t|| error.name === 'AbortError'\n\t\t\t\t\t\t|| error.name === 'SyntaxError'\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#privateProperties.abortController.abort();\n\t\t\t\t\t\t/*\n\t\t\t\t\t\tlet errorCode = 'UNKNOWN_ERROR';\n\t\t\t\t\t\tif (Type.isObject(error) && error instanceof JoinResponseError)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\terrorCode = error.name;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (Type.isObject(error) && error.code)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\terrorCode = error.code === 'access_denied' 'ACCESS_DENIED' : error.code;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.triggerEvents('ReconnectingFailed', [null, {\n\t\t\t\t\t\t\tcode: errorCode,\n\t\t\t\t\t\t\tmessage: error?.message,\n\t\t\t\t\t\t}]);\n\t\t\t\t\t\t*/\n\n\t\t\t\t\t\treject({\n\t\t\t\t\t\t\tname: 'MEDIASERVER_UNEXPECTED_ANSWER',\n\t\t\t\t\t\t\tmessage: error?.message,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#privateProperties.lastReconnectionReason = error.code\n\t\t\t\t\t\t\t? ReconnectionReason.JoinResponseError\n\t\t\t\t\t\t\t: ReconnectionReason.NetworkError;\n\n\t\t\t\t\t\t// don't write error.name and error.message to analytics now,\n\t\t\t\t\t\t// because we don't watch failed reconnecting requests now\n\n\t\t\t\t\t\treject({\n\t\t\t\t\t\t\tname: 'MEDIASERVER_ERROR',\n\t\t\t\t\t\t\tmessage: `Reason: ${error?.message}`,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t}\n\n\tasync sendOffer() {\n\t\tif (this.#privateProperties.offersStack > 0 && !this.#privateProperties.isWaitAnswer) {\n\t\t\tthis.setLog('Start sending an offer', LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.isWaitAnswer = true;\n\t\t\tthis.#privateProperties.offersStack--;\n\n\t\t\ttry {\n\t\t\t\tlet offer = await this.sender.createOffer();\n\t\t\t\tif (Util.useTcpSdp())\n\t\t\t\t{\n\t\t\t\t\toffer = {\n\t\t\t\t\t\ttype: offer.type,\n\t\t\t\t\t\tsdp: this.#removeUdpFromSdp(offer.sdp),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tawait this.sender.setLocalDescription(offer);\n\t\t\t\tthis.#sendSignal({ offer });\n\t\t\t\tthis.setLog('Sending an offer succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.setLog(`Sending an offer failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t\tthis.#beforeDisconnect();\n\t\t\t\tthis.#reconnect({\n\t\t\t\t\treconnectionReason: 'SENDING_OFFER',\n\t\t\t\t\treconnectionReasonInfo: `Sending an offer failed: ${e}`,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tasync startStream() {\n\t\tconst videoTrack = await this.getLocalVideo();\n\t\tif (videoTrack) {\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Camera, videoTrack);\n\t\t} else {\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Camera);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.Camera);\n\t\t}\n\n\t\tconst audioTrack = await this.getLocalAudio();\n\t\tif (audioTrack) {\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Microphone, audioTrack);\n\t\t} else {\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Microphone);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.Microphone);\n\t\t}\n\t}\n\n\tasync socketOnMessageHandler(event) {\n\t\tif (typeof event.data !== 'string') return;\n\n\t\tlet data\n\n\t\ttry\n\t\t{\n\t\t\tdata = JSON.parse(event.data);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tthis.setLog(`Could not parse a socket message: ${event.data}`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\n\t\tif (data?.answer){\n\t\t\tawait this.#answerHandler(data);\n\t\t}\n\t\telse if (data?.offer)\n\t\t{\n\t\t\tawait this.#offerHandler(data);\n\t\t}\n\t\telse if (data?.joinResponse) {\n\t\t\tif (data.joinResponse.role)\n\t\t\t{\n\t\t\t\tUtil.setCurrentUserRole(data.joinResponse.role);\n\t\t\t}\n\n\t\t\tthis.#privateProperties.abortController.signal.removeEventListener('abort', this.beforeDisconnectBound);\n\n\t\t\tthis.#privateProperties.iceServers = data.joinResponse.iceServers;\n\t\t\tthis.#privateProperties.localParticipantSid = data.joinResponse.localParticipant.sid;\n\n\t\t\tthis.#createPeerConnection();\n\n\t\t\tconst connectedEvent = this.#privateProperties.isReconnecting && this.wasConnected\n\t\t\t\t? CallApiEvent.Reconnected\n\t\t\t\t: CallApiEvent.Connected;\n\n\t\t\tthis.#privateProperties.callState = CALL_STATE.CONNECTED;\n\t\t\tthis.wasConnected = true;\n\t\t\tthis.setLog(`${connectedEvent} to the call ${this.#privateProperties.roomId} on the mediaserver after ${this.#privateProperties.reconnectionAttempt} attempts`, LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.isReconnecting = false;\n\t\t\tthis.#privateProperties.reconnectionAttempt = 0;\n\n\t\t\tif (data.joinResponse.oneToOneType)\n\t\t\t{\n\t\t\t\tthis.triggerEvents('ConnectionTypeChanged', [{\n\t\t\t\t\ttype: data.joinResponse.oneToOneType,\n\t\t\t\t}]);\n\t\t\t}\n\n\t\t\tif (data.joinResponse.permissions && connectedEvent === CallApiEvent.Connected)\n\t\t\t{\n\t\t\t\tthis.#setUserPermissions(data.joinResponse.permissions);\n\t\t\t}\n\n\t\t\tif (data.joinResponse.roomState && connectedEvent === CallApiEvent.Connected)\n\t\t\t{\n\t\t\t\tUtil.setRoomPermissions(data.joinResponse.roomState);\n\t\t\t\tUtil.setUserPermissionsByRoomPermissions(data.joinResponse.roomState);\n\t\t\t}\n\n\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tif (connectedEvent === CallApiEvent.Reconnected && this.monitoringEvents.length)\n\t\t\t\t{\n\t\t\t\t\tthis.sendMonitoringEvents();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst participantsToDelete = { ...this.#privateProperties.remoteParticipants };\n\t\t\tObject.values(data.joinResponse.otherParticipants).forEach((p) => {\n\t\t\t\tif (participantsToDelete[p.userId])\n\t\t\t\t{\n\t\t\t\t\tdelete participantsToDelete[p.userId];\n\t\t\t\t}\n\t\t\t\tthis.setLog(`Adding an early connected participant with id ${p.userId} (sid: ${p.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.#setRemoteParticipant(p);\n\t\t\t});\n\n\t\t\tif (connectedEvent === CallApiEvent.Reconnected)\n\t\t\t{\n\t\t\t\tfor (let userId in participantsToDelete)\n\t\t\t\t{\n\t\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\t\t\t\tthis.setLog(`Deleting a missing participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t\t\t\tthis.triggerEvents('ParticipantLeaved', [participant]);\n\t\t\t\t\tdelete this.#privateProperties.remoteTracks[userId];\n\t\t\t\t\tdelete this.#privateProperties.remoteParticipants[userId];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ('recorderStatus' in data.joinResponse)\n\t\t\t{\n\t\t\t\tconst recorderStatus = { code: data.joinResponse.recorderStatus };\n\t\t\t\tif (data.joinResponse.recorderRespStatus)\n\t\t\t\t{\n\t\t\t\t\trecorderStatus.errMsg = data.joinResponse.recorderRespStatus;\n\t\t\t\t}\n\n\t\t\t\tthis.triggerEvents('RecorderStatusChanged', [recorderStatus]);\n\t\t\t}\n\n\t\t\tthis.#privateProperties.pingIntervalDuration = data.joinResponse.pingInterval * 1000;\n\t\t\tthis.#privateProperties.pingTimeoutDuration = this.#privateProperties.pingIntervalDuration * 2;\n\n\t\t\tthis.#startPingInterval();\n\n\t\t\tthis.triggerEvents(connectedEvent);\n\t\t} else if (data?.participantJoined) {\n\t\t\tthis.setLog(`Adding a new participant with id ${data.participantJoined.participant.userId} (sid: ${data.participantJoined.participant.sid})`, LOG_LEVEL.INFO);\n\t\t\tthis.#setRemoteParticipant(data.participantJoined.participant);\n\t\t} else if (data?.participantLeft) {\n\t\t\tconst participantId = data.participantLeft.userId;\n\t\t\tconst participant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\tconst pendingSubscriptions = this.#privateProperties.pendingSubscriptions[participantId];\n\n\t\t\tif (pendingSubscriptions)\n\t\t\t{\n\t\t\t\tfor (let trackId in pendingSubscriptions)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(pendingSubscriptions[trackId].timeout);\n\t\t\t\t\tthis.setLog(`A participant with id ${participantId} (sid: ${data.participantLeft.sid}) left during subscription attempt, cancel it`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\n\t\t\t\tdelete this.#privateProperties.pendingSubscriptions[participantId];\n\t\t\t}\n\n\t\t\tif (participant)\n\t\t\t{\n\t\t\t\tthis.setLog(`Deleting a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.triggerEvents('ParticipantLeaved', [participant]);\n\t\t\t\tdelete this.#privateProperties.remoteTracks[participantId];\n\t\t\t\tdelete this.#privateProperties.remoteParticipants[participantId];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog(`Got participantLeft signal for a non-existent participant with id ${participantId} (sid: ${data.participantLeft.sid})`, LOG_LEVEL.WARNING);\n\t\t\t}\n\t\t} else if (data?.trackCreated) {\n\t\t\tconst participantId = data.trackCreated.userId;\n\t\t\tconst cid = data.trackCreated.cid;\n\t\t\tconst track = data.trackCreated.track;\n\t\t\tconst trackId = track.sid;\n\t\t\ttrack.userId = participantId;\n\n\t\t\tif (participantId == this.#privateProperties.userId)\n\t\t\t{\n\t\t\t\tconst timeout = this.#privateProperties.pendingPublications[cid];\n\t\t\t\tif (timeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.#privateProperties.pendingPublications[cid]);\n\t\t\t\t\tdelete this.#privateProperties.pendingPublications[cid];\n\n\t\t\t\t\tthis.setLog(`Publishing a local track with kind ${track.source} (sid: ${trackId}) succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\tthis.#privateProperties.localTracks[track.source] = track;\n\t\t\t\t\tthis.triggerEvents('PublishSucceed', [track.source]);\n\n\t\t\t\t\tif (track.source === MediaStreamsKinds.Microphone && this.#privateProperties.needToDisableAudioAfterPublish)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#privateProperties.needToDisableAudioAfterPublish = false;\n\t\t\t\t\t\tthis.disableAudio({ calledFrom: 'data.trackCreated' });\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.source === MediaStreamsKinds.Camera && this.#privateProperties.videoQueue)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#processVideoQueue();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.setLog(`Got trackCreated signal for a non-existent local track with kind ${track.source} (sid: ${trackId})`, LOG_LEVEL.WARNING);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.#privateProperties.tracksDataFromSocket[trackId] = track;\n\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\t\tif (participant)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Got a track info with kind ${track.source} (sid: ${data.trackCreated.track.sid}) for a participant with id ${participantId} (sid: ${participant.sid}), waiting for it`, LOG_LEVEL.INFO);\n\t\t\t\t\tswitch (track.source)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\t\t\t\tparticipant.videoEnabled = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\t\t\t\tparticipant.audioEnabled = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\t\t\t\tparticipant.screenSharingEnabled = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst ontrackData = this.#privateProperties.ontrackData[trackId];\n\t\t\t\t\tdelete this.#privateProperties.ontrackData[trackId];\n\n\t\t\t\t\tif (ontrackData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#createRemoteTrack(trackId, ontrackData);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#addPendingSubscription(participant, track);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Got a track info with kind ${track.source} (sid: ${data.trackCreated.track.sid}) for a non-existent participant with id ${participantId}`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (data?.trackDeleted) {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst participantId = data.trackDeleted.publisher;\n\t\t\t\tconst trackId = data.trackDeleted.shortId;\n\t\t\t\tconst pendingSubscription = this.#privateProperties.pendingSubscriptions[participantId]?.[trackId];\n\n\t\t\t\tif (pendingSubscription)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(pendingSubscription.timeout);\n\t\t\t\t\tdelete this.#privateProperties.pendingSubscriptions[participantId][trackId];\n\t\t\t\t\tthis.setLog(`Track with id ${trackId} was deleted during subscription attempt, cancel it`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\n\t\t\t\tif (participantId == this.#privateProperties.userId) return;\n\t\t\t\tthis.setLog(`Start deleting a track with id ${trackId} from a participant with id ${participantId} `, LOG_LEVEL.INFO);\n\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\t\tif (!participant)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} failed: can't find a participant with id ${participantId}`, LOG_LEVEL.WARNING);\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst track = Object.values(participant.tracks)?.find(track => track?.id === trackId);\n\t\t\t\tdelete this.#privateProperties.tracksDataFromSocket[trackId];\n\n\t\t\t\tif (track)\n\t\t\t\t{\n\t\t\t\t\tif (track.source === MediaStreamsKinds.Microphone)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipant.audioEnabled = false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipant.videoEnabled = false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.source === MediaStreamsKinds.Screen)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipant.screenSharingEnabled = false;\n\t\t\t\t\t}\n\t\t\t\t\tparticipant.removeTrack(track.source);\n\t\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} from a participant with id ${participantId} (sid: ${participant.sid}) succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\tthis.triggerEvents('RemoteMediaRemoved', [participant, track]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} from a participant with id ${participantId} (sid: ${participant.sid}) failed: can't find a track`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.setLog(`Deleting a track with id ${trackId} from a participant with id ${participantId} failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t}\n\t\t} \n\t\telse if (data?.trackMuted)\n\t\t{\n\t\t\tthis.#trackMutedHandler(data.trackMuted);\n\t\t}\n\t\telse if (data.recorderStatus)\n\t\t{\n\t\t\tthis.triggerEvents('RecorderStatusChanged', [data.recorderStatus]);\n\t\t}\n\t\telse if (data?.videoRecorderStatus)\n\t\t{\n\t\t\tthis.triggerEvents('CloudRecordStatusChanged', [data.videoRecorderStatus]);\n\t\t}\n\t\telse if (data?.trickle) {\n\t\t\tthis.#addIceCandidate(data.trickle);\n\t\t}\n\t\telse if (data?.newMessage)\n\t\t{\n\t\t\tconst message = new Message(data.newMessage);\n\t\t\tthis.triggerEvents('MessageReceived', [message]);\n\t\t}\n\t\telse if (data?.handRaised) {\n\t\t\tconst participant = this.#privateProperties.remoteParticipants[data.handRaised.participantId];\n\t\t\tif (participant)\n\t\t\t{\n\t\t\t\tparticipant.isHandRaised = data.handRaised.isHandRaised;\n\t\t\t\tthis.triggerEvents('HandRaised', [participant]);\n\t\t\t}\n\t\t} else if (data?.speakersChanged) {\n\t\t\tthis.#speakerChangedHandler(data)\n\t\t} else if (data?.connectionQuality) {\n\t\t\tif (!data.connectionQuality.updates)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst participants = {};\n\t\t\tconst participantsToUpdate = { ...this.#privateProperties.remoteParticipants };\n\n\t\t\tdata.connectionQuality.updates.forEach(participant => {\n\t\t\t\tObject.values(participantsToUpdate).forEach(remoteParticipant => {\n\n\t\t\t\t\tconst hasGoodQuality = participant.score > this.#privateProperties.minimalConnectionQuality;\n\t\t\t\t\tif (\n\t\t\t\t\t\tparticipant.participantSid === remoteParticipant.sid\n\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t!remoteParticipant.isMutedVideo\n\t\t\t\t\t\t\t|| !remoteParticipant.connectionQuality\n\t\t\t\t\t\t)\n\t\t\t\t\t\t&& !remoteParticipant.screenSharingEnabled\n\t\t\t\t\t) {\n\t\t\t\t\t\tparticipants[remoteParticipant.userId] = participant.score;\n\t\t\t\t\t\t// commented out for now, since a lot of log generated by this\n\t\t\t\t\t\t//this.setLog(`Quality of connection with a participant with id ${remoteParticipant.userId} (sid: ${remoteParticipant.sid}) changed to ${participant.score}`, hasGoodQuality ? LOG_LEVEL.INFO : LOG_LEVEL.WARNING);\n\t\t\t\t\t\tthis.#privateProperties.remoteParticipants[remoteParticipant.userId].connectionQuality = participant.score;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst isLocalVideoMuted = this.#privateProperties.localTracks[MediaStreamsKinds.Camera]\n\t\t\t\t\t\t&& this.#privateProperties.localTracks[MediaStreamsKinds.Camera].muted;\n\n\t\t\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (participant.participantSid === this.#privateProperties.localParticipantSid)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetric({\n\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS.CONN_SCORE_CURRENT,\n\t\t\t\t\t\t\t\tmetricValue: participant.score,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tparticipant.participantSid === this.#privateProperties.localParticipantSid\n\t\t\t\t\t\t&& (\n\t\t\t\t\t\t\t!isLocalVideoMuted\n\t\t\t\t\t\t\t|| !this.#privateProperties.localConnectionQuality\n\t\t\t\t\t\t)\n\t\t\t\t\t\t&& !this.#privateProperties.localTracks[MediaStreamsKinds.Screen]\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipants[this.#privateProperties.userId] = participant.score;\n\t\t\t\t\t\tthis.#privateProperties.localConnectionQuality =  participant.score;\n\t\t\t\t\t\t// commented out for now, since a lot of log generated by this\n\t\t\t\t\t\t//this.setLog(`Quality of connection with a mediaserver changed to ${participant.score}`, hasGoodQuality ? LOG_LEVEL.INFO : LOG_LEVEL.WARNING);\n\t\t\t\t\t\t// this.#toggleRemoteParticipantVideo(Object.keys(participantsToUpdate), hasGoodQuality);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.triggerEvents('ConnectionQualityChanged', [participants]);\n\t\t} else if (data.pongResp) {\n\t\t\tthis.#privateProperties.rtt = Date.now() - data.pongResp.lastPingTimestamp\n\t\t\tthis.#resetPingTimeout()\n\t\t} else if (data.leave) {\n\t\t\tthis.setLog(`Got leave signal with ${data.leave.reason} reason`, LOG_LEVEL.WARNING);\n\t\t\tthis.#beforeDisconnect({ initiatedByUser: true });\n\n\t\t\tconst reasonsToReconnect = ['CHANGING_MEDIA_SERVER', 'FULL_RECONNECT_NEEDED', 'STATE_MISMATCH'];\n\n\t\t\tif (\n\t\t\t\t(data.leave.canReconnect || reasonsToReconnect.includes(data.leave.reason)) &&\n\t\t\t\tdata.leave.reason !== \"SIGNALING_DUPLICATE_PARTICIPANT\")\n\t\t\t{\n\t\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.LeaveCommand;\n\t\t\t\tthis.#reconnect({\n\t\t\t\t\treconnectionReason: 'GOT_LEAVE_SIGNAL',\n\t\t\t\t\treconnectionReasonInfo: `Leave reason ${data.leave.reason}`,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#privateProperties.canReconnect = false;\n\t\t\t\tthis.triggerEvents('Failed', [\n\t\t\t\t\t{\n\t\t\t\t\t\tname: data.leave.reason,\n\t\t\t\t\t\tleaveInformation: {code: data.leave.code, reason: data.leave.reason}\n\t\t\t\t\t}]);\n\t\t\t}\n\t\t}\n\t\telse if (data?.onErrorResponse)\n\t\t{\n\t\t\tthis.setLog(`Got signaling error: ${data.onErrorResponse.message}`, LOG_LEVEL.ERROR);\n\t\t}\n\t\telse if (data?.onActionSent)\n\t\t{\n\t\t\tif (data?.onActionSent.changeSettings)\n\t\t\t{\n\t\t\t\tthis.#settingsChangedHandler(data.onActionSent.changeSettings);\n\t\t\t}\n\t\t\telse if (data?.onActionSent.givePermissions)\n\t\t\t{\n\t\t\t\tthis.#userPermissionsChanged(data.onActionSent.givePermissions);\n\t\t\t}\n\t\t\telse if (data?.onActionSent.participantMuted)\n\t\t\t{\n\t\t\t\tthis.#participantMutedHandler(data.onActionSent.participantMuted);\n\t\t\t}\n\t\t\telse if (data?.onActionSent.allParticipantsMuted)\n\t\t\t{\n\t\t\t\tthis.#allParticipantsMutedHandler(data.onActionSent.allParticipantsMuted);\n\t\t\t}\n\t\t\telse if (data?.onActionSent.updateRole)\n\t\t\t{\n\t\t\t\tthis.#updateRoleHandler(data.onActionSent.updateRole);\n\t\t\t}\n\t\t\telse if (data?.onActionSent.switchConnectionType)\n\t\t\t{\n\t\t\t\tthis.triggerEvents('ConnectionTypeChanged', [data?.onActionSent.switchConnectionType]);\n\t\t\t}\n\t\t}\n\t};\n\n\tsocketOnOpenHandler() {\n\t\twindow.addEventListener('unload', this.sendLeaveBound);\n\t};\n\n\tsocketOnCloseHandler(e) {\n\t\tthis.#beforeDisconnect();\n\n\t\tif (e?.code && e?.code !== 1005)\n\t\t{\n\t\t\tthis.setLog(`Socket closed with a code ${e.code}, reconnecting`, LOG_LEVEL.ERROR);\n\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.WsTransportClosed;\n\t\t\tthis.#reconnect({\n\t\t\t\treconnectionReason: 'WS_CONNECTION_CLOSED',\n\t\t\t\treconnectionReasonInfo: `Socket closed with a code ${e.code}`,\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Socket closed with a code ${e.code}`, LOG_LEVEL.ERROR);\n\t\t}\n\t};\n\tsocketOnErrorHandler() {\n\t\tthis.setLog(`Got a socket error`, LOG_LEVEL.ERROR);\n\t};\n\tasync onIceCandidate(target, event) {\n\t\tif (!event.candidate) return;\n\n\t\tif (Util.useTcpSdp() && event.candidate.protocol !== 'tcp')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst trickle = {\n\t\t\tcandidateInit: JSON.stringify({\n\t\t\t\tcandidate: event.candidate.candidate,\n\t\t\t\tsdpMid: event.candidate?.sdpMid,\n\t\t\t\tsdpMLineIndex: event.candidate?.sdpMLineIndex,\n\t\t\t\tusernameFragment: event.candidate?.usernameFragment\n\t\t\t})\n\t\t};\n\n\t\tif (target) {\n\t\t\ttrickle.target = target;\n\t\t}\n\n\t\tthis.#sendSignal({ trickle });\n\t};\n\tonConnectionStateChange(subscriber) {\n\t\tconst state = subscriber\n\t\t\t? this.recipient.connectionState\n\t\t\t: this.sender.connectionState\n\n\t\tif (state === 'failed' && !this.#privateProperties.isReconnecting)\n\t\t{\n\t\t\tthis.setLog(`State of ${subscriber ? 'recipient' : 'sender'} peer connection changed to ${state}, reconnecting`, LOG_LEVEL.WARNING);\n\t\t\tif (this.#privateProperties.peerConnectionFailed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#privateProperties.peerConnectionFailed = true;\n\n\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_REFUSED,\n\t\t\t\t\twithCounter: true,\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis.#beforeDisconnect();\n\t\t\tif (this.#privateProperties.canReconnect)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.PeerConnectionFailed;\n\t\t\t\tthis.#reconnect({\n\t\t\t\t\treconnectionReason: 'ON_CONNECTION_STATE_CHANGED',\n\t\t\t\t\treconnectionReasonInfo: `State of ${subscriber ? 'recipient' : 'sender'} peer connection changed to ${state}`,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (state === 'failed' || state === 'disconnected')\n\t\t{\n\t\t\tconst logMessage = `State of ${subscriber ? 'recipient' : 'sender'} PEER CONNECTION changed to ${state}`;\n\t\t\tthis.setLog(logMessage, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\tonIceConnectionStateChange(subscriber)\n\t{\n\t\tconst state = subscriber\n\t\t\t? this.recipient.iceConnectionState\n\t\t\t: this.sender.iceConnectionState;\n\n\t\tif (state === 'failed' || state === 'disconnected')\n\t\t{\n\t\t\tconst logMessage = `State of ${subscriber ? 'recipient' : 'sender'} ICE connection changed to ${state}`;\n\t\t\tthis.setLog(logMessage, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\t#resetPingTimeout() {\n\t\tthis.#clearPingTimeout()\n\t\tif (!this.#privateProperties.pingTimeoutDuration) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#privateProperties.pingTimeout = setTimeout(() => {\n\t\t\tthis.setLog('Ping signal was not received, reconnecting', LOG_LEVEL.WARNING);\n\t\t\tthis.#beforeDisconnect();\n\t\t\tthis.#privateProperties.lastReconnectionReason = ReconnectionReason.PingPongMissed;\n\t\t\tthis.#reconnect({\n\t\t\t\treconnectionReason: 'PING_SIGNAL_NOT_RECEIVED',\n\t\t\t\treconnectionReasonInfo: ``,\n\t\t\t});\n\t\t}, this.#privateProperties.pingTimeoutDuration);\n\t}\n\n\n\t#clearPingTimeout() {\n\t\tif (this.#privateProperties.pingTimeout) {\n\t\t\tclearTimeout(this.#privateProperties.pingTimeout);\n\t\t}\n\t}\n\n\t#startPingInterval() {\n\t\tthis.#clearPingInterval()\n\t\tthis.#resetPingTimeout()\n\t\tif (!this.#privateProperties.pingIntervalDuration) {\n\t\t\treturn;\n\t\t}\n\t\tthis.#privateProperties.pingPongInterval = setInterval(() => {\n\t\t\tthis.#sendPing();\n\t\t}, this.#privateProperties.pingIntervalDuration);\n\t}\n\n\t#clearPingInterval() {\n\t\tthis.#clearPingTimeout();\n\t\tif (this.#privateProperties.pingPongInterval) {\n\t\t\tclearInterval(this.#privateProperties.pingPongInterval);\n\t\t}\n\t}\n\n\t#sendPing() {\n\t\tthis.#sendSignal({\n\t\t\tpingReq: {\n\t\t\t\ttimestamp: Date.now(),\n\t\t\t\trtt: this.#privateProperties.rtt\n\t\t\t}\n\t\t});\n\t}\n\n\ton(eventType, handler) {\n\t\tthis.#privateProperties.events.set(eventType, handler)\n\t\treturn this\n\t}\n\toff(eventType) {\n\t\tif (this.#privateProperties.events.has(eventType)) {\n\t\t\treturn this.#privateProperties.events.delete(eventType)\n\t\t}\n\t\treturn this\n\t}\n\n\ttriggerEvents(eventType, args) {\n\t\tif (this.#privateProperties.events.has(eventType)) {\n\t\t\tconst event = this.#privateProperties.events.get(eventType)\n\t\t\tif (args) {\n\t\t\t\tevent(...args)\n\t\t\t} else {\n\t\t\t\tevent()\n\t\t\t}\n\t\t}\n\t}\n\n\tisRecordable() {\n\t\tconsole.log('isRecordable')\n\t}\n\n\tsetBitrate(bitrate, MediaStreamKind) {\n\t\tthis.setLog('Start setting bitrate', LOG_LEVEL.INFO);\n\t\tlet track;\n\t\tlet isSimulcast;\n\t\tswitch (MediaStreamKind) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\ttrack = this.#privateProperties.cameraStream.getVideoTracks[0];\n\t\t\t\tisSimulcast = this.#privateProperties.videoSimulcast;\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\ttrack = this.#privateProperties.microphoneStream.getAudioTracks[0];\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\ttrack = this.#privateProperties.screenStream.getVideoTracks[0];\n\t\t\t\tbreak;\n\t\t}\n\t\tconst senders = this.sender.getSenders()\n\n\t\tsenders.forEach( (sender) => {\n\t\t\tconst params = sender.getParameters();\n\t\t\tif(!params || !params.encodings || params.encodings.length === 0)\n\t\t\t{\n\t\t\t\tthis.setLog('Setting bitrate failed: has no encodings in the sender parameters', LOG_LEVEL.WARNING);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tparams.encodings.forEach(encoding => {\n\t\t\t\t\tif (isSimulcast) {\n\t\t\t\t\t\tencoding.maxBitrate = bitrate < this.#privateProperties.defaultSimulcastBitrate[encoding.rid] ? bitrate : this.#privateProperties.defaultSimulcastBitrate[encoding.rid]\n\t\t\t\t\t} else {\n\t\t\t\t\t\tencoding.maxBitrate = bitrate\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tsender.setParameters(params);\n\t\t\t\tthis.setLog('Setting bitrate succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t});\n\t}\n\n\t#addPendingPublication(trackId, source)\n\t{\n\t\tthis.#privateProperties.pendingPublications[trackId] = setTimeout(() =>\n\t\t{\n\t\t\tdelete this.#privateProperties.pendingPublications[trackId];\n\t\t\tthis.onPublishFailed(source);\n\t\t}, this.#privateProperties.publicationTimeout);\n\t}\n\n\t#addPendingSubscription(participant, track, tries)\n\t{\n\t\tclearTimeout(this.#privateProperties.pendingSubscriptions[participant.userId]?.[track.sid]?.timeout);\n\t\tif (!this.#privateProperties.pendingSubscriptions[participant.userId])\n\t\t{\n\t\t\tthis.#privateProperties.pendingSubscriptions[participant.userId] = {};\n\t\t}\n\n\t\tif (tries === undefined)\n\t\t{\n\t\t\ttries = this.#privateProperties.subscriptionTries;\n\t\t}\n\n\t\tconst timeout = setTimeout(() => {\n\t\t\tthis.setLog(`Track ${track.sid} with kind ${track.source} for a participant with id ${participant.userId} (sid: ${participant.sid}) was not received, trying to subscribe to it`, LOG_LEVEL.WARNING);\n\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.TRACK_SUBSCRIPTION_DELAY,\n\t\t\t\t\twithCounter: true,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (tries)\n\t\t\t{\n\t\t\t\tthis.#addPendingSubscription(participant, track, tries - 1)\n\t\t\t\tthis.#changeSubscriptionToTrack(track.sid, participant.sid, true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog(`Subscription to track ${track.sid} with kind ${track.source} for a participant with id ${participant.userId} (sid: ${participant.sid}) failed`, LOG_LEVEL.ERROR);\n\t\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.TRACK_SUBSCRIPTION_FAILED,\n\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tthis.triggerEvents('TrackSubscriptionFailed', [{participant: participant, track: track}]);\n\t\t\t}\n\t\t}, this.#privateProperties.subscriptionTimeout);\n\n\t\tthis.#privateProperties.pendingSubscriptions[participant.userId][track.sid] = {\n\t\t\ttimeout,\n\t\t\ttries,\n\t\t};\n\t}\n\n\tsetCodec(transceiver)\n\t{\n\t\tif (!('getCapabilities' in RTCRtpReceiver)) {\n\t\t\treturn;\n\t\t}\n\t\tconst cap = RTCRtpReceiver.getCapabilities('video');\n\t\tif (!cap) return;\n\t\tconst matched = [];\n\t\tconst partialMatched = [];\n\t\tconst unmatched = [];\n\t\tcap.codecs.forEach((c) => {\n\t\t\tconst codec = c.mimeType.toLowerCase();\n\t\t\tif (codec === 'audio/opus') {\n\t\t\t\tmatched.push(c);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst matchesVideoCodec = codec === `video/${this.#privateProperties.codec}`;\n\t\t\tif (!matchesVideoCodec) {\n\t\t\t\tunmatched.push(c);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// for h264 codecs that have sdpFmtpLine available, use only if the\n\t\t\t// profile-level-id is 42e01f for cross-browser compatibility\n\t\t\tif (this.#privateProperties.codec === 'h264') {\n\t\t\t\tif (c.sdpFmtpLine && c.sdpFmtpLine.includes('profile-level-id=42e01f')) {\n\t\t\t\t\tmatched.push(c);\n\t\t\t\t} else {\n\t\t\t\t\tpartialMatched.push(c);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tmatched.push(c);\n\t\t});\n\n\t\tif ('setCodecPreferences' in transceiver) {\n\t\t\t// console.log('setCodecPreferences', this.#privateProperties.codec, matched, partialMatched, unmatched);\n\t\t\ttransceiver.setCodecPreferences(matched.concat(partialMatched, unmatched));\n\t\t}\n\t}\n\n\tasync publishTrack(MediaStreamKind, MediaStreamTrack, StreamQualityOptions = {}) {\n\t\tif (!this.sender)\n\t\t{\n\t\t\tthis.setLog(`Publishing a track before a peer connection was created, ignoring`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog(`Start publishing a track with kind ${MediaStreamKind}`, LOG_LEVEL.INFO);\n\n\t\ttry {\n\t\t\tfor (let keys in StreamQualityOptions ) {\n\t\t\t\tthis.#privateProperties[`${keys}`] = StreamQualityOptions[keys]\n\t\t\t}\n\n\t\t\tconst source = MediaStreamKind;\n\t\t\tMediaStreamTrack.source = source;\n\t\t\tif (source === MediaStreamsKinds.Camera) {\n\t\t\t\tif( this.#privateProperties.videoSimulcast) {\n\t\t\t\t\tconst width = MediaStreamTrack.getSettings().width;\n\t\t\t\t\tconst height = MediaStreamTrack.getSettings().height;\n\n\t\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Camera);\n\t\t\t\t\tif (sender)\n\t\t\t\t\t{\n\t\t\t\t\t\tawait sender.replaceTrack(MediaStreamTrack);\n\t\t\t\t\t\tthis.#updateVideoEncodings(sender, MediaStreamTrack);\n\t\t\t\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} via replace track succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\t\tthis.triggerEvents('PublishSucceed', [MediaStreamsKinds.Camera]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst encodings = this.#getEncodingsFromVideoWidth(width);\n\n\t\t\t\t\t\tthis.setLog('Add sender transceiver - direction: sendonly', LOG_LEVEL.INFO);\n\t\t\t\t\t\tconst transceiver = this.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\t\t\tdirection: 'sendonly',\n\t\t\t\t\t\t\tstreams: [this.#privateProperties.cameraStream],\n\t\t\t\t\t\t\tsendEncodings: MediaStreamTrack.sendEncodings || encodings,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.setCodec(transceiver)\n\n\t\t\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\t\t\"cid\":  MediaStreamTrack.id,\n\t\t\t\t\t\t\t\t\"type\":  \"VIDEO\",\n\t\t\t\t\t\t\t\t\"width\":  width,\n\t\t\t\t\t\t\t\t\"height\":  height,\n\t\t\t\t\t\t\t\t\"source\":  source,\n\t\t\t\t\t\t\t\t\"layers\":  this.#getLayersFromEncodings(width, height, encodings),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Camera);\n\t\t\t\t\tif (sender)\n\t\t\t\t\t{\n\t\t\t\t\t\tawait sender.replaceTrack(MediaStreamTrack);\n\t\t\t\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} via replace track succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\t\tthis.triggerEvents('PublishSucceed', [MediaStreamsKinds.Camera]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setLog('Add sender transceiver - direction: sendonly', LOG_LEVEL.INFO);\n\t\t\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.setBitrate(this.#privateProperties.videoBitrate, MediaStreamsKinds.Camera)\n\n\t\t\t\t\t\tconst width = MediaStreamTrack.getSettings().width\n\t\t\t\t\t\tconst height = MediaStreamTrack.getSettings().height\n\n\t\t\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\t\t\"cid\":  MediaStreamTrack.id,\n\t\t\t\t\t\t\t\t\"type\":  \"VIDEO\",\n\t\t\t\t\t\t\t\t\"width\":  width,\n\t\t\t\t\t\t\t\t\"height\":  height,\n\t\t\t\t\t\t\t\t\"source\":  source,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (source === MediaStreamsKinds.Microphone) {\n\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Microphone);\n\t\t\t\tif (sender)\n\t\t\t\t{\n\t\t\t\t\tawait sender.replaceTrack(MediaStreamTrack);\n\t\t\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} via replace track succeeded`, LOG_LEVEL.INFO);\n\t\t\t\t\tthis.triggerEvents('PublishSucceed', [MediaStreamsKinds.Microphone]);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\t\"cid\" : MediaStreamTrack.id,\n\t\t\t\t\t\t\t\"source\":  source\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (source === MediaStreamsKinds.Screen) {\n\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t});\n\t\t\t\tconst width = MediaStreamTrack.getSettings().width\n\t\t\t\tconst height = MediaStreamTrack.getSettings().height\n\n\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\"cid\":  MediaStreamTrack.id,\n\t\t\t\t\t\t\"type\":  \"VIDEO\",\n\t\t\t\t\t\t\"width\":  width,\n\t\t\t\t\t\t\"height\":  height,\n\t\t\t\t\t\t\"source\":  source,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (source === MediaStreamsKinds.ScreenAudio) {\n\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t});\n\t\t\t\tthis.sender.addTransceiver(MediaStreamTrack, {\n\t\t\t\t\tdirection: 'sendonly'\n\t\t\t\t});\n\n\t\t\t\tthis.#addPendingPublication(MediaStreamTrack.id, source);\n\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\t\"addTrack\":  {\n\t\t\t\t\t\t\"cid\" : MediaStreamTrack.id,\n\t\t\t\t\t\t\"source\":  source\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.#privateProperties.offersStack++;\n\t\t\tawait this.sendOffer();\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tif (MediaStreamKind === MediaStreamsKinds.Microphone)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.needToDisableAudioAfterPublish = false;\n\t\t\t}\n\t\t\tthis.setLog(`Publishing a track with kind ${MediaStreamKind} failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamKind);\n\t\t\tthis.onPublishFailed(MediaStreamKind);\n\t\t}\n\t}\n\n\t#getMaxEncodingsByVideoWidth(width)\n\t{\n\t\tconst aspectRation = 16 / 9;\n\t\tlet maxWidth = Math.ceil(Hardware.maxLocalStreamQualityHeight * aspectRation);\n\n\t\tif (maxWidth <= width)\n\t\t{\n\t\t\twidth = maxWidth;\n\t\t}\n\n\t\t// https://source.chromium.org/chromium/chromium/src/+/main:third_party/webrtc/video/config/simulcast.cc;l=76;\n\n\t\tif (width >= 960)\n\t\t{\n\t\t\treturn 3;\n\t\t}\n\t\telse if (width >= 480)\n\t\t{\n\t\t\treturn 2;\n\t\t}\n\t\treturn 1;\n\t}\n\n\t#getEncodingsFromVideoWidth(width)\n\t{\n\t\tconst maxEncodings = this.#getMaxEncodingsByVideoWidth(width);\n\t\tconst rids = ['q', 'h', 'f'];\n\t\tconst encodings = [];\n\n\t\tfor (let i = 0; i < 3; i++)\n\t\t{\n\t\t\tconst rid = rids[i];\n\t\t\tencodings.push({\n\t\t\t\trid,\n\t\t\t\tactive: i < maxEncodings,\n\t\t\t\tmaxBitrate: this.#privateProperties.defaultSimulcastBitrate[rid],\n\t\t\t\tscaleResolutionDownBy: 2 ** Math.max(0, (maxEncodings - 1 - i))\n\t\t\t});\n\t\t}\n\n\t\treturn encodings;\n\t};\n\n\t#getLayersFromEncodings(width, height, encodings)\n\t{\n\t\treturn encodings.map((encoding, index) =>\n\t\t{\n\t\t\treturn {\n\t\t\t\tquality: index,\n\t\t\t\twidth: width / encoding.scaleResolutionDownBy,\n\t\t\t\theight: height / encoding.scaleResolutionDownBy,\n\t\t\t\tbitrate: this.#privateProperties.defaultSimulcastBitrate[encoding.rid],\n\t\t\t}\n\t\t});\n\t}\n\n\t#updateVideoEncodings(sender, track)\n\t{\n\t\tconst params = sender.getParameters();\n\t\tconst width = track?.getSettings().width || Hardware.maxLocalStreamQualityHeight;\n\t\tconst encodings = this.#getEncodingsFromVideoWidth(width);\n\n\t\tif (params && params.encodings && params.encodings.length)\n\t\t{\n\t\t\tparams.encodings.forEach((encoding) =>\n\t\t\t{\n\t\t\t\tconst encodingByRid = encodings.find(el => el.rid === encoding.rid);\n\t\t\t\tif (encodingByRid)\n\t\t\t\t{\n\t\t\t\t\tencoding.active = encodingByRid.active;\n\t\t\t\t\tencoding.maxBitrate = encodingByRid.maxBitrate;\n\t\t\t\t\tencoding.scaleResolutionDownBy = encodingByRid.scaleResolutionDownBy;\n\t\t\t\t}\n\t\t\t});\n\t\t\tsender.setParameters(params);\n\t\t}\n\t}\n\n\tasync changeStreamQuality(StreamQualityOptions) {\n\t\tfor (let key in StreamQualityOptions) {\n\t\t\tif (this.#privateProperties[`${key}`] !== StreamQualityOptions[key]) {\n\t\t\t\tthis.#privateProperties[`${key}`] = StreamQualityOptions[key]\n\n\t\t\t\tif (key === 'videoSimulcast' || (key === 'screenSimulcast' && this.#privateProperties.screenStream)) {\n\t\t\t\t\tconst kind = key === 'videoSimulcast'\n\t\t\t\t\t\t? MediaStreamsKinds.Camera\n\t\t\t\t\t\t: MediaStreamsKinds.Screen\n\n\t\t\t\t\tif (this.#getSender(kind)) {\n\t\t\t\t\t\tawait this.republishTrack(kind)\n\t\t\t\t\t}\n\t\t\t\t} else if ( ['videoBitrate', 'audioBitrate', 'screenBitrate'].includes(key)) {\n\t\t\t\t\tconst kind = key === 'videoBitrate'\n\t\t\t\t\t\t? MediaStreamsKinds.Camera\n\t\t\t\t\t\t: key === 'screenBitrate'\n\t\t\t\t\t\t\t? MediaStreamsKinds.Screen\n\t\t\t\t\t\t\t: MediaStreamsKinds.Microphone\n\n\t\t\t\t\tawait this.setBitrate(StreamQualityOptions[key], kind)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tasync republishTrack(MediaStreamKind) {\n\t\tthis.setLog(`Start republishing a track with kind ${MediaStreamKind}`, LOG_LEVEL.INFO);\n\t\tawait this.unpublishTrack(MediaStreamKind);\n\t\tconst track = await this.getTrack(MediaStreamKind);\n\t\tif (track) {\n\t\t\tawait this.publishTrack(MediaStreamKind, track);\n\t\t} else {\n\t\t\tthis.setLog(`Republishing a track with kind ${MediaStreamKind} failed: ${error}`, LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamKind);\n\t\t\tthis.triggerEvents('PublishFailed', [MediaStreamKind])\n\t\t}\n\t}\n\n\tasync unpublishTrack(MediaStreamKind) {\n\t\tthis.setLog(`Start unpublishing a track with kind ${MediaStreamKind}`, LOG_LEVEL.INFO);\n\t\tconst sender = this.#getSender(MediaStreamKind);\n\n\t\tif (sender) {\n\t\t\tthis.sender.removeTrack(sender);\n\t\t\tthis.#privateProperties.offersStack++;\n\t\t\tawait this.sendOffer();\n\t\t\tthis.setLog(`Unpublishing a track with kind ${MediaStreamKind} succeeded`, LOG_LEVEL.INFO);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Unpublishing a track with kind ${MediaStreamKind} failed: has no sender for a track`, LOG_LEVEL.ERROR);\n\t\t}\n\t}\n\n\ttoggleRemoteParticipantVideo(participants, showVideo, isPaginateToggle = false) {\n\t\tthis.#toggleRemoteParticipantVideo(participants, showVideo, isPaginateToggle);\n\t}\n\n\t#changeSubscriptionToTrack(trackId, participantId, subscribe)\n\t{\n\t\tthis.#sendSignal({\n\t\t\tsubscription: {\n\t\t\t\ttrackSids: [trackId],\n\t\t\t\tsubscribe,\n\t\t\t\tparticipantTracks: [\n\t\t\t\t\t{\n\t\t\t\t\t\tparticipantSid: participantId,\n\t\t\t\t\t\ttrackSids: [trackId],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t}\n\t\t});\n\t}\n\n\t#pauseRemoteTrack(userId, trackId, trackSource, pause)\n\t{\n\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\tif (!participant)\n\t\t{\n\t\t\tthis.setLog(`Trying to pause a track with kind ${trackSource} (sid: ${trackId}) for a non-existent participant with id ${userId}`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\n\t\tparticipant.videoPaused = pause;\n\t\tthis.#sendSignal({\n\t\t\ttrackSetting: {\n\t\t\t\ttrackSids: [trackId],\n\t\t\t\tdisabled: pause,\n\t\t\t\tquality: this.#calculateVideoQualityForUser(userId, trackSource),\n\t\t\t}\n\t\t});\n\t}\n\n\t#calculateVideoQualityForUser(userId, source)\n\t{\n\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\tconst exactUser = this.#privateProperties.mainStream.userId == userId;\n\t\tconst exactTrack = this.#privateProperties.mainStream.kind === source;\n\n\t\tlet quality = STREAM_QUALITY.LOW;\n\t\tif (exactUser && (exactTrack || !participant.screenSharingEnabled))\n\t\t{\n\t\t\tquality = STREAM_QUALITY.HIGH;\n\t\t}\n\t\telse if (!this.#privateProperties.mainStream.userId)\n\t\t{\n\t\t\tquality = this.#privateProperties.defaultRemoteStreamsQuality;\n\t\t}\n\n\t\treturn quality;\n\t}\n\n\t#changeRoomStreamsQuality(users, kind)\n\t{\n\t\tthis.setLog(`Changing quality of streams; main stream: ${users.userId}, other users: ${users.otherUsers}`, LOG_LEVEL.INFO);\n\n\t\tusers.otherUsers?.forEach((userId) => {\n\t\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\t\tif (participant)\n\t\t\t{\n\t\t\t\tconst quality = this.#calculateVideoQualityForUser(userId, MediaStreamsKinds.Camera);\n\t\t\t\tthis.#setStreamQualityFoParticipant(participant, quality);\n\t\t\t}\n\t\t});\n\n\t\tif (users.userId)\n\t\t{\n\t\t\tconst participant = this.#privateProperties.remoteParticipants[users.userId];\n\t\t\tif (participant)\n\t\t\t{\n\t\t\t\tlet quality = this.#privateProperties.defaultRemoteStreamsQuality;\n\t\t\t\tif (kind === MediaStreamsKinds.Camera && this.#privateProperties.defaultRemoteStreamsQuality >= STREAM_QUALITY.HIGH)\n\t\t\t\t{\n\t\t\t\t\tquality = STREAM_QUALITY.HIGH;\n\t\t\t\t}\n\n\t\t\t\tthis.#privateProperties.mainStream = { userId: users.userId, kind };\n\t\t\t\tthis.#setStreamQualityFoParticipant(participant, quality);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#privateProperties.mainStream = {};\n\t\t}\n\t}\n\n\n\t#setStreamQualityFoParticipant(participant, quality)\n\t{\n\t\tif (!participant.setStreamQuality(quality))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#sendSignal({\n\t\t\trequestLayers: {\n\t\t\t\ttargetUserId: participant.userId,\n\t\t\t\tlayers: {\n\t\t\t\t\tq: quality === STREAM_QUALITY.LOW,\n\t\t\t\t\th: quality === STREAM_QUALITY.MEDIUM,\n\t\t\t\t\tf: quality === STREAM_QUALITY.HIGH,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis.#sendSignal({\n\t\t\ttrackSetting: {\n\t\t\t\tquality,\n\t\t\t\ttrackSids: [participant.getTrack(MediaStreamsKinds.Camera).id],\n\t\t\t},\n\t\t}, participant.mediaServerId);\n\t}\n\n\t#toggleRemoteParticipantVideo(participants, showVideo, isPaginateToggle = false)\n\t{\n\t\tparticipants.forEach((participant) => {\n\t\t\tconst participantId = participant.userId;\n\t\t\tconst remoteParticipant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\tconst cameraTrack = remoteParticipant?.tracks?.[MediaStreamsKinds.Camera];\n\t\t\tconst trackSubscribed = cameraTrack?.subscribed === true;\n\t\t\tconst needChangeLocalVideoMute = remoteParticipant?.isLocalVideoMute === showVideo;\n\n\t\t\tif (\n\t\t\t\ttrackSubscribed\n\t\t\t\t&& showVideo\n\t\t\t\t&& !remoteParticipant.isLocalVideoMute\n\t\t\t\t&& !remoteParticipant.isMutedVideo\n\t\t\t)\n\t\t\t{\n\t\t\t\t//remoteParticipant.setVideoWidth(participant.videoWidth);\n\t\t\t\tthis.#setStreamQualityFoParticipant(remoteParticipant);\n\t\t\t}\n\t\t\telse if (trackSubscribed && needChangeLocalVideoMute)\n\t\t\t{\n\t\t\t\tremoteParticipant.isLocalVideoMute = !showVideo;\n\n\t\t\t\tif (remoteParticipant.isMutedVideo)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#pauseRemoteTrack(\n\t\t\t\t\tremoteParticipant.userId,\n\t\t\t\t\tremoteParticipant.tracks[MediaStreamsKinds.Camera].id,\n\t\t\t\t\tremoteParticipant.tracks[MediaStreamsKinds.Camera].source,\n\t\t\t\t\tremoteParticipant.isLocalVideoMute,\n\t\t\t\t);\n\t\t\t}\n\t\t\telse if (\n\t\t\t\tremoteParticipant\n\t\t\t\t&& cameraTrack\n\t\t\t\t&& !trackSubscribed\n\t\t\t\t&& showVideo\n\t\t\t\t&& needChangeLocalVideoMute\n\t\t\t)\n\t\t\t{\n\t\t\t\tremoteParticipant.isLocalVideoMute = !showVideo;\n\n\t\t\t\tif (remoteParticipant.isMutedVideo)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#changeSubscriptionToTrack(\n\t\t\t\t\tremoteParticipant.tracks[MediaStreamsKinds.Camera].id,\n\t\t\t\t\tremoteParticipant.sid,\n\t\t\t\t\t!remoteParticipant.isLocalVideoMute,\n\t\t\t\t\tremoteParticipant.mediaServerId,\n\t\t\t\t);\n\t\t\t}\n\t\t\telse if (remoteParticipant && !showVideo)\n\t\t\t{\n\t\t\t\tremoteParticipant.isLocalVideoMute = !showVideo;\n\t\t\t}\n\t\t\telse if (!remoteParticipant || !remoteParticipant.tracks[MediaStreamsKinds.Camera])\n\t\t\t{\n\t\t\t\tthis.#privateProperties.participantsToUpdateTrackAvailability[participantId] = showVideo;\n\t\t\t}\n\t\t});\n\n\t\tif (!isPaginateToggle)\n\t\t{\n\t\t\tthis.triggerEvents('ToggleRemoteParticipantVideo', [showVideo]);\n\t\t}\n\t}\n\n\t/*\n\t#toggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle = false)\n\t{\n\t\tparticipantIds.forEach(participantId => {\n\t\t\tconst remoteParticipant = this.#privateProperties.remoteParticipants[participantId];\n\t\t\tif (remoteParticipant && remoteParticipant.tracks[MediaStreamsKinds.Camera] && remoteParticipant.isLocalVideoMute === showVideo)\n\t\t\t{\n\t\t\t\tremoteParticipant.isLocalVideoMute = !showVideo;\n\n\t\t\t\tif (remoteParticipant.isMutedVideo)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#pauseRemoteTrack(\n\t\t\t\t\tremoteParticipant.userId,\n\t\t\t\t\tremoteParticipant.tracks[MediaStreamsKinds.Camera].id,\n\t\t\t\t\tremoteParticipant.tracks[MediaStreamsKinds.Camera].source,\n\t\t\t\t\tremoteParticipant.isLocalVideoMute\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\tif (!isPaginateToggle)\n\t\t{\n\t\t\tthis.triggerEvents('ToggleRemoteParticipantVideo', [showVideo]);\n\t\t}\n\t}*/\n\n\thangup(closeRoom = false) {\n\t\tif (this.#privateProperties.callState === CALL_STATE.TERMINATED)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#privateProperties.abortController.abort();\n\n\t\tthis.#privateProperties.callState = CALL_STATE.TERMINATED;\n\n\t\tthis.setLog(`Disconnecting from the call`, LOG_LEVEL.INFO);\n\t\tif (closeRoom)\n\t\t{\n\t\t\tthis.#sendSignal({\n\t\t\t\tcloseRoom: {\n\t\t\t\t\ttimestamp: Math.floor(Date.now() / 1000)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#sendLeave();\n\t\t}\n\t\tthis.#beforeDisconnect({ initiatedByUser: true });\n\t\tthis.#destroyPeerConnection();\n\n\t\tclearTimeout(this.#privateProperties.reconnectionTimeout);\n\n\t\tfor (let trackId in this.#privateProperties.pendingPublications)\n\t\t{\n\t\t\tclearTimeout(this.#privateProperties.pendingPublications[trackId]);\n\t\t}\n\t\tthis.#privateProperties.pendingPublications = {};\n\n\t\tfor (let userId in this.#privateProperties.pendingSubscriptions)\n\t\t{\n\t\t\tfor (let trackId in this.#privateProperties.pendingSubscriptions[userId])\n\t\t\t{\n\t\t\t\tclearTimeout(this.#privateProperties.pendingSubscriptions[userId][trackId].timeout);\n\t\t\t}\n\t\t}\n\t\tthis.#privateProperties.pendingSubscriptions = {};\n\n\t\tthis.#privateProperties.options = null;\n\t\tthis.#privateProperties.iceServers = null;\n\t\tthis.#privateProperties.lastReconnectionReason = null;\n\n\t\tthis.#releaseStream(MediaStreamsKinds.Camera);\n\t\tthis.#releaseStream(MediaStreamsKinds.Microphone);\n\t\tthis.#releaseStream(MediaStreamsKinds.Screen);\n\n\t\tthis.#privateProperties.rtt = 0;\n\t\tthis.#privateProperties.remoteTracks = {};\n\t\tthis.#privateProperties.isReconnecting = false;\n\t\tthis.#privateProperties.reconnectionAttempt = 0;\n\t\tthis.#privateProperties.mainStream = {};\n\n\t\tthis.triggerEvents('Disconnected');\n\t}\n\n\tisConnected() {\n\t\treturn this.#privateProperties.callState === CALL_STATE.CONNECTED\n\t}\n\n\tsetVideoStreamSetupErrorList(userId, kind)\n\t{\n\t\tconst errorInVideoStreamSetupErrorList = this.#privateProperties.videoStreamSetupErrorList[userId];\n\t\tconst kindInListKinds = !!errorInVideoStreamSetupErrorList && errorInVideoStreamSetupErrorList.includes(kind);\n\t\tconst kindsArray = errorInVideoStreamSetupErrorList || [];\n\n\t\tif (!kindInListKinds)\n\t\t{\n\t\t\tthis.#privateProperties.videoStreamSetupErrorList[userId] = [kind, ...kindsArray];\n\t\t}\n\t}\n\n/*\n\tsetMainStream(userId, kind)\n\t{\n\t\t// userId always exists, check in bitrix_call\n\t\tif (!this.#privateProperties.remoteParticipants[userId])\n\t\t{\n\t\t\tthis.setVideoStreamSetupErrorList(userId, kind);\n\t\t\tthis.setLog(`Setting main stream error (No remoteParticipant with ID - ${userId} in list)`, LOG_LEVEL.ERROR);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog(`Setting main stream for a participant width id ${userId} (sid: ${this.#privateProperties.remoteParticipants[userId].sid})`, LOG_LEVEL.INFO);\n\t\tthis.#changeRoomStreamsQuality(userId, kind);\n\t}\n\n\t*/\n\n\tsetMainStream(users, kind)\n\t{\n\t\t// userId always exists, check in bitrix_call\n\t\tconst participant = this.#privateProperties.remoteParticipants[users.userId];\n\t\tif (!participant)\n\t\t{\n\t\t\tthis.setVideoStreamSetupErrorList(users.userId, kind);\n\t\t\tthis.setLog(`Setting main stream error (No remoteParticipant with ID - ${users.userId} in list)`, LOG_LEVEL.ERROR);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#changeRoomStreamsQuality(users, kind);\n\t}\n\n\tsetVideoQualityForStreams(params)\n\t{\n\t\tthis.#privateProperties.defaultRemoteStreamsQuality = params.videoQuality;\n\n\t\tthis.#changeRoomStreamsQuality(params);\n\n\t\tif (this.#privateProperties.defaultRemoteStreamsQuality === STREAM_QUALITY.NO_VIDEO)\n\t\t{\n\t\t\tthis.disableVideo({calledFrom: 'setVideoQuality'});\n\t\t\tHardware.maxLocalStreamQualityHeight = LOCAL_STREAM_QUALITY_HEIGHT.NO_VIDEO;\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.isCameraWasEnabledBeforeQualityChanged && this.#privateProperties.defaultRemoteStreamsQuality !== STREAM_QUALITY.NO_VIDEO)\n\t\t{\n\t\t\tthis.triggerEvents('TurnOnCamera');\n\t\t}\n\n\t\tswitch (this.#privateProperties.defaultRemoteStreamsQuality)\n\t\t{\n\t\t\tcase STREAM_QUALITY.HIGH:\n\t\t\t\tHardware.maxLocalStreamQualityHeight = LOCAL_STREAM_QUALITY_HEIGHT.HIGH;\n\t\t\t\tbreak;\n\t\t\tcase STREAM_QUALITY.MEDIUM:\n\t\t\t\tHardware.maxLocalStreamQualityHeight = LOCAL_STREAM_QUALITY_HEIGHT.MEDIUM;\n\t\t\t\tbreak;\n\t\t\tcase STREAM_QUALITY.LOW:\n\t\t\t\tHardware.maxLocalStreamQualityHeight = LOCAL_STREAM_QUALITY_HEIGHT.LOW;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconst sender = this.#getSender(MediaStreamsKinds.Camera);\n\t\tif (sender)\n\t\t{\n\t\t\tthis.#updateVideoEncodings(sender);\n\t\t}\n\t}\n\n\tresetMainStream(users) {\n\t\tthis.setLog(`Resetting main stream`, LOG_LEVEL.INFO);\n\t\tthis.#changeRoomStreamsQuality(users)\n\t}\n\n\tremoveTrack(mediaStreamKind) {\n\t\tconst trackSid = this.#privateProperties.localTracks[mediaStreamKind]?.sid\n\t\tif (trackSid)\n\t\t{\n\t\t\tthis.setLog(`Sending removeTrack signal for a track with kind ${mediaStreamKind} (sid: ${trackSid})`, LOG_LEVEL.INFO);\n\t\t\tdelete this.#privateProperties.localTracks[mediaStreamKind];\n\t\t\tthis.#sendSignal({\n\t\t\t\tremoveTrack: {\n\t\t\t\t\tsid: trackSid\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Sending removeTrack signal for a non-existent track with kind ${mediaStreamKind}`, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\tpauseTrack(mediaStreamKind, keepTrack) {\n\t\tconst trackSid = this.#privateProperties.localTracks[mediaStreamKind]?.sid;\n\t\tif (trackSid)\n\t\t{\n\t\t\tthis.setLog(`Sending pause signal (keep: ${keepTrack}) for a track with kind ${mediaStreamKind} (sid: ${trackSid})`, LOG_LEVEL.INFO);\n\t\t\tif (!keepTrack)\n\t\t\t{\n\t\t\t\tdelete this.#privateProperties.localTracks[mediaStreamKind];\n\t\t\t}\n\t\t\tthis.#sendSignal({\n\t\t\t\tmute: {\n\t\t\t\t\tsid: trackSid,\n\t\t\t\t\tmuted: true\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Sending pause signal for a non-existent track with kind ${mediaStreamKind}`, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\tunpauseTrack(mediaStreamKind) {\n\t\tconst trackSid = this.#privateProperties.localTracks[mediaStreamKind]?.sid;\n\t\tif (trackSid)\n\t\t{\n\t\t\tthis.setLog(`Sending unpause signal for a track with kind ${mediaStreamKind} (sid: ${trackSid})`, LOG_LEVEL.INFO);\n\t\t\tthis.#sendSignal({\n\t\t\t\tmute: {\n\t\t\t\t\tsid: trackSid,\n\t\t\t\t\tmuted: false\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog(`Sending unpause signal for a non-existent track with kind ${mediaStreamKind}`, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\tdisableAudio(options) {\n\t\tconst bySystem = options?.bySystem || false;\n\t\tconst calledFrom = options?.calledFrom || '';\n\n\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog(`Start disabling audio - calledFrom: ${calledFrom}, isReconnecting: ${this.#privateProperties.isReconnecting}, bySystem: ${bySystem}`);\n\t\tconst track = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\tif (track)\n\t\t{\n\t\t\tthis.#privateProperties.needToEnableAudioAfterSystemMuted = bySystem ? track.enabled : false;\n\t\t\ttrack.enabled = false;\n\t\t\tif (this.#privateProperties.localTracks[MediaStreamsKinds.Microphone])\n\t\t\t{\n\t\t\t\tthis.#privateProperties.localTracks[MediaStreamsKinds.Microphone].muted = true;\n\t\t\t}\n\t\t\tthis.pauseTrack(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Disabling audio failed: has no track', LOG_LEVEL.ERROR);\n\t\t}\n\t}\n\n\tasync enableAudio(options)\n\t{\n\t\tconst disabled = options?.disabled || false;\n\t\tconst calledFrom = options?.calledFrom || '';\n\n\t\tif (!Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog(`Start enabling audio - calledFrom: ${calledFrom}, isReconnecting: ${this.#privateProperties.isReconnecting}, disabled: ${disabled}`);\n\n\t\tthis.#privateProperties.needToEnableAudioAfterSystemMuted = false;\n\t\tif (this.#privateProperties.switchActiveAudioDeviceInProgress)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait this.#privateProperties.switchActiveAudioDeviceInProgress;\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.onPublishFailed(MediaStreamsKinds.Microphone);\n\t\t\t}\n\t\t}\n\t\tlet track = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\tconst needToGetNewTrack = !track\n\t\t\t|| track.readyState !== 'live'\n\t\t\t|| this.#isNoiseSuppressionInputTrackOff();\n\n\t\tif (needToGetNewTrack)\n\t\t{\n\t\t\ttrack = await this.getLocalAudio();\n\t\t}\n\n\t\tif (!track)\n\t\t{\n\t\t\tthis.setLog('Enabling audio failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Microphone);\n\t\t\tthis.triggerEvents('PublishFailed', [MediaStreamsKinds.Microphone]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#privateProperties.localTracks[MediaStreamsKinds.Microphone])\n\t\t{\n\t\t\tthis.setLog('Enabling audio via unpause signal', LOG_LEVEL.INFO);\n\t\t\ttrack.enabled = true;\n\t\t\tthis.#privateProperties.localTracks[MediaStreamsKinds.Microphone].muted = false;\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Microphone, track);\n\t\t\tthis.unpauseTrack(MediaStreamsKinds.Microphone);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Enabling audio via publish', LOG_LEVEL.INFO);\n\t\t\ttrack.enabled = !disabled;\n\t\t\tif (disabled)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.needToDisableAudioAfterPublish = true;\n\t\t\t}\n\n\t\t\tif (this.#privateProperties.localTracks[MediaStreamsKinds.Microphone])\n\t\t\t{\n\t\t\t\tthis.#privateProperties.localTracks[MediaStreamsKinds.Microphone].muted = false;\n\t\t\t}\n\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Microphone, track);\n\t\t}\n\t}\n\n\tasync disableVideo(options)\n\t{\n\t\tconst bySystem = options?.bySystem || false;\n\t\tconst calledFrom = options?.calledFrom || '';\n\t\tconst hasQueue = this.#privateProperties.videoQueue !== VIDEO_QUEUE.INITIAL;\n\n\t\tthis.setLog(`Start disabling video - calledFrom: ${calledFrom}, isReconnecting: ${this.#privateProperties.isReconnecting}, bySystem: ${bySystem}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}, hasQueue: ${hasQueue}, videoQueue: ${this.#privateProperties.videoQueue} `, LOG_LEVEL.INFO);\n\t\t//console.warn(`Start disabling video - isReconnecting: ${this.#privateProperties.isReconnecting}, bySystem: ${bySystem}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}, calledFrom: ${calledFrom}, hasQueue: ${hasQueue}, videoQueue: ${this.#privateProperties.videoQueue} `);\n\t\tif (this.#privateProperties.isReconnecting)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.DISABLE;\n\n\t\tif (hasQueue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst track = this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t\tif (track && this.#privateProperties.localTracks[MediaStreamsKinds.Camera])\n\t\t{\n\t\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\n\t\t\t\tthis.setLog(`Video disabling stops track - bySystem: ${bySystem}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}`, LOG_LEVEL.INFO);\n\t\t\t\ttrack.stop();\n\t\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.USER_CAMERA_DISABLED,\n\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tthis.triggerEvents('MediaMutedBySystem', [false]);\n\t\t\t\tthis.triggerEvents('PublishEnded', [MediaStreamsKinds.Camera]);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#privateProperties.localTracks[MediaStreamsKinds.Camera].muted = true;\n\n\t\t\tthis.setLog(`Video disabling pauses track - bySystem: ${bySystem}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}`, LOG_LEVEL.INFO);\n\t\t\tthis.pauseTrack(MediaStreamsKinds.Camera, true);\n\t\t\tif (this.#privateProperties.needToStopStreams)\n\t\t\t{\n\t\t\t\tCallStreamManager.stopStream(MediaStreamsKinds.Camera);\n\t\t\t}\n\n\t\t\tif (!bySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\n\t\t\t\tthis.setLog(`Video disabling stops track - bySystem: ${bySystem}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}`, LOG_LEVEL.INFO);\n\t\t\t\ttrack.stop();\n\t\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.USER_CAMERA_DISABLED,\n\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tthis.triggerEvents('PublishEnded', [MediaStreamsKinds.Camera]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Disabling video failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t}\n\t}\n\n\tasync enableVideo(options) /* {calledFrom: 'processVideoQueue', skipUnpause: true} */\n\t{\n\t\tconst skipUnpause = options?.skipUnpause || false;\n\t\tconst calledFrom = options?.calledFrom || '';\n\t\tconst hasQueue = this.#privateProperties.videoQueue !== VIDEO_QUEUE.INITIAL;\n\n\t\tthis.setLog(`Start enabling video - calledFrom: ${calledFrom}, isReconnecting: ${this.#privateProperties.isReconnecting}, skipUnpause: ${skipUnpause}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}, hasQueue: ${hasQueue}, videoQueue: ${this.#privateProperties.videoQueue} `, LOG_LEVEL.INFO);\n\t\t//console.warn(`Start enabling video - calledFrom: ${calledFrom}, isReconnecting: ${this.#privateProperties.isReconnecting}, skipUnpause: ${skipUnpause}, mediaMutedBySystem: ${this.#privateProperties.mediaMutedBySystem}, hasQueue: ${hasQueue}, videoQueue: ${this.#privateProperties.videoQueue} `, LOG_LEVEL.INFO);\n\n\t\tif (this.#privateProperties.isReconnecting)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Util.havePermissionToBroadcast('cam'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.ENABLE;\n\t\tif (hasQueue)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.#privateProperties.switchActiveVideoDeviceInProgress)\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait this.#privateProperties.switchActiveVideoDeviceInProgress;\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.onPublishFailed(MediaStreamsKinds.Camera);\n\t\t\t}\n\t\t}\n\n\t\tlet hasTrack = !!this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t\tlet track = await this.getLocalVideo();\n\n\t\tif (track && hasTrack && this.#privateProperties.localTracks[MediaStreamsKinds.Camera])\n\t\t{\n\t\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\t\t\t\tthis.triggerEvents('MediaMutedBySystem', [false]);\n\t\t\t}\n\t\t\tif (skipUnpause)\n\t\t\t{\n\t\t\t\tthis.setLog('Re-enabling video after automatic camera change', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog('Enabling video via unpause signal', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tthis.#privateProperties.localTracks[MediaStreamsKinds.Camera].muted = false;\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Camera, track);\n\t\t\tif (skipUnpause)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.#privateProperties.localTracks[MediaStreamsKinds.Camera].muted = false;\n\t\t\t\tthis.unpauseTrack(MediaStreamsKinds.Camera);\n\t\t\t}\n\t\t}\n\t\telse if (track)\n\t\t{\n\t\t\tif (this.#privateProperties.localTracks[MediaStreamsKinds.Camera])\n\t\t\t{\n\t\t\t\tthis.#privateProperties.localTracks[MediaStreamsKinds.Camera].muted = false;\n\t\t\t}\n\n\t\t\tthis.setLog('Enabling video via publish', LOG_LEVEL.INFO);\n\t\t\tawait this.publishTrack(MediaStreamsKinds.Camera, track);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLog('Enabling video failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Camera);\n\t\t\tthis.triggerEvents('PublishFailed', [MediaStreamsKinds.Camera]);\n\t\t}\n\t}\n\n\t#processVideoQueue()\n\t{\n\t\tconst videoQueue = this.#privateProperties.videoQueue;\n\t\tthis.#privateProperties.videoQueue = VIDEO_QUEUE.INITIAL;\n\t\tif (videoQueue === VIDEO_QUEUE.ENABLE && this.#privateProperties.cameraStream?.getVideoTracks()[0]?.readyState !== 'live')\n\t\t{\n\t\t\tthis.enableVideo({calledFrom: 'processVideoQueue'});\n\t\t}\n\t\telse if (videoQueue === VIDEO_QUEUE.DISABLE && this.#privateProperties.cameraStream?.getVideoTracks()[0]?.readyState === 'live' && !this.#privateProperties.mediaMutedBySystem)\n\t\t{\n\t\t\tthis.disableVideo({calledFrom: 'processVideoQueue'});\n\t\t}\n\t}\n\n\tasync startScreenShare() {\n\t\tif (!Util.havePermissionToBroadcast('screenshare'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLog('Start enabling screen sharing', LOG_LEVEL.INFO);\n\t\tconst tracks = await this.getLocalScreen()\n\t\tconst videoTrack = tracks?.video;\n\t\tconst audioTrack = tracks?.audio;\n\n\t\tif (!videoTrack)\n\t\t{\n\t\t\tthis.setLog('Enabling screen sharing failed: has no track', LOG_LEVEL.ERROR);\n\t\t\tthis.#releaseStream(MediaStreamsKinds.Screen);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.Screen);\n\t\t\tthis.onPublishFailed(MediaStreamsKinds.ScreenAudio);\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.publishTrack(MediaStreamsKinds.Screen, videoTrack);\n\n\t\tif (audioTrack)\n\t\t{\n\t\t\tawait this.publishTrack(MediaStreamsKinds.ScreenAudio, audioTrack);\n\t\t}\n\t}\n\n\tasync stopScreenShare() {\n\t\tthis.setLog('Start disabling screen sharing', LOG_LEVEL.INFO);\n\t\tthis.#releaseStream(MediaStreamsKinds.Screen);\n\t\tthis.#releaseStream(MediaStreamsKinds.ScreenAudio);\n\t\tthis.removeTrack(MediaStreamsKinds.Screen);\n\t\tthis.removeTrack(MediaStreamsKinds.ScreenAudio);\n\t\tawait this.unpublishTrack(MediaStreamsKinds.Screen);\n\t\tawait this.unpublishTrack(MediaStreamsKinds.ScreenAudio);\n\t}\n\n\tsendMessage(message) {\n\t\tthis.#sendSignal({ sendMessage: { message } });\n\t}\n\n\tswitchConnectionType(type)\n\t{\n\t\tthis.#sendSignal({ switchConnectionType: { type } });\n\t}\n\n\traiseHand(raised) {\n\t\tthis.#sendSignal({ raiseHand: { raised } });\n\t}\n\n\tupdateUserData(data: Object): void\n\t{\n\t\tthis.#sendSignal({ updateUserData: data });\n\t}\n\n\tchangeSettings(options)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet settingsObj = {};\n\n\t\tswitch (options.typeOfSetting){\n\t\t\tcase 'mic':\n\t\t\t\tsettingsObj =  { 'audioMutedEvent': { 'muted': !options.settingEnabled } };\n\t\t\t\tbreak;\n\t\t\tcase 'cam':\n\t\t\t\tthis.setLog(`Settings changes send videoMutedEvent (act: 'change_settings') - muted: ${!options.settingEnabled}`, LOG_LEVEL.INFO);\n\t\t\t\tsettingsObj =  { 'videoMutedEvent': { 'muted': !options.settingEnabled } };\n\t\t\t\tbreak;\n\t\t\tcase 'screenshare':\n\t\t\t\tsettingsObj =  { 'screenShareMutedEvent': { 'muted': !options.settingEnabled } };\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.#sendSignal( { sendAction: {\n\t\t\tact: 'change_settings',\n\t\t\tchangeSettingsPayload: settingsObj\n\t\t}});\n\t}\n\n\tturnOffAllParticipansStream(options)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(options?.data)\n\t\t{\n\t\t\tif(options.data?.typeOfStream)\n\t\t\t{\n\t\t\t\tswitch (options.data.typeOfStream)\n\t\t\t\t{\n\t\t\t\t\tcase 'mic':\n\t\t\t\t\t\tthis.#sendSignal(\n\t\t\t\t\t\t{\tsendAction:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\t\t\tmuteAllParticipantPayload:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\taudioMutedEvent:\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t'muted': true\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'cam':\n\t\t\t\t\t\tthis.setLog('turnOffAllParticipansStream send videoMutedEvent (act: \\'mute_others\\') - muted: true', LOG_LEVEL.INFO);\n\t\t\t\t\t\tthis.#sendSignal(\n\t\t\t\t\t\t{\tsendAction:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\t\t\tmuteAllParticipantPayload:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvideoMutedEvent:\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t'muted': true\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'screenshare':\n\t\t\t\t\t\tthis.#sendSignal(\n\t\t\t\t\t\t{\tsendAction:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\t\t\tmuteAllParticipantPayload:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tscreenShareMutedEvent:\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t'muted': true\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tturnOffParticipantStream(options)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(!options.typeOfStream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (options.typeOfStream)\n\t\t{\n\t\t\tcase 'mic':\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\tsendAction:\n\t\t\t\t\t{\n\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\tmuteParticipantPayload:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'participantID': String(options.userId), // must be a String type\n\t\t\t\t\t\t\t'audioMutedEvent': { 'muted': true }\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\tcase 'cam':\n\t\t\t\tthis.setLog(`turnOffParticipantStream send videoMutedEvent (act: 'mute_others') - muted: true, participantID: ${options.userId}`, LOG_LEVEL.INFO);\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\tsendAction:\n\t\t\t\t\t{\n\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\tmuteParticipantPayload:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'participantID': String(options.userId), // must be a String type\n\t\t\t\t\t\t\t'videoMutedEvent': { 'muted': true }\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\tcase 'screenshare':\n\t\t\t\tthis.#sendSignal({\n\t\t\t\t\tsendAction:\n\t\t\t\t\t{\n\t\t\t\t\t\tact: 'mute_others',\n\t\t\t\t\t\tmuteParticipantPayload:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'participantID': String(options.userId), // must be a String type\n\t\t\t\t\t\t\t'screenShareMutedEvent': { 'muted': true }\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tallowSpeakPermission(options)\n\t{\n\t\tif (Util.canControlGiveSpeakPermission())\n\t\t{\n\t\t\tthis.#sendSignal( { sendAction: {\n\t\t\t\t'act': 'give_permissions',\n\t\t\t\t'givePermissionsPayload':\n\t\t\t\t{\n\t\t\t\t\t'forUserId': String(options.userId),\n\t\t\t\t\t'allow': options.allow,\n\t\t\t\t},\n\t\t\t}});\n\t\t}\n\t}\n\n\tasync getLocalVideo(): Promise<?MediaStreamTrack>\n\t{\n\t\tconst readyState = this.#privateProperties.cameraStream?.getVideoTracks()[0]?.readyState;\n\t\tconst readyStateInfo = readyState ? ` - readyState: ${readyState}` : '';\n\t\tthis.setLog(`Local video getting${readyStateInfo}`, LOG_LEVEL.INFO);\n\t\tif (readyState !== 'live')\n\t\t{\n\t\t\tawait this.getTrack(MediaStreamsKinds.Camera);\n\t\t}\n\n\t\treturn this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t}\n\n\tasync getLocalAudio(): Promise<?MediaStreamTrack>\n\t{\n\t\tconst track = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\tif (!track || track.readyState !== 'live' || this.#isNoiseSuppressionInputTrackOff())\n\t\t{\n\t\t\tawait this.getTrack(MediaStreamsKinds.Microphone);\n\t\t}\n\n\t\treturn this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t}\n\n\tasync getLocalScreen(): Promise<?MediaStreamTrack[]>\n\t{\n\t\tif (!this.#privateProperties.screenStream)\n\t\t{\n\t\t\tawait this.getTrack(MediaStreamsKinds.Screen);\n\t\t}\n\n\t\treturn {\n\t\t\tvideo: this.#privateProperties.screenStream?.getVideoTracks()[0],\n\t\t\taudio: this.#privateProperties.screenStream?.getAudioTracks()[0],\n\t\t};\n\t}\n\n\t#getUserMediaConstraints(options, fallbackMode = false)\n\t{\n\t\tconst constraints = {\n\t\t\taudio: false,\n\t\t\tvideo: false,\n\t\t};\n\n\t\tif (options.video)\n\t\t{\n\t\t\tconstraints.video = {};\n\n\t\t\tif (!fallbackMode)\n\t\t\t{\n\t\t\t\tconstraints.video.width = { ideal: this.#privateProperties.defaultVideoResolution.width };\n\t\t\t\tconstraints.video.height = { ideal: this.#privateProperties.defaultVideoResolution.height };\n\n\t\t\t\tif (this.#privateProperties.videoDeviceId)\n\t\t\t\t{\n\t\t\t\t\tconstraints.video.deviceId = { exact: this.#privateProperties.videoDeviceId };\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn constraints;\n\t\t}\n\n\t\tif (this.#privateProperties.audioDeviceId)\n\t\t{\n\t\t\tconstraints.audio = {\n\t\t\t\tdeviceId: { exact: this.#privateProperties.audioDeviceId },\n\t\t\t};\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconstraints.audio = true;\n\t\t}\n\n\t\treturn constraints;\n\t}\n\n\tasync #getUserMedia(options, fallbackMode = false): Promise<?MediaStream>\n\t{\n\t\tthis.setLog(`Start getting user media with options: ${JSON.stringify(options)}`);\n\t\tthis.triggerEvents('GetUserMediaStarted', [options]);\n\t\tconst constraints = this.#getUserMediaConstraints(options, fallbackMode);\n\n\t\ttry\n\t\t{\n\t\t\tconst mediaStream = await CallStreamManager.getUserMedia(constraints);\n\t\t\tconst stream = mediaStream.clone();\n\n\t\t\tif (options.video && stream.getVideoTracks()[0])\n\t\t\t{\n\t\t\t\tthis.#addTrackMuteHandlers(stream.getVideoTracks()[0]);\n\t\t\t\tthis.triggerEvents('GetUserMediaSuccess', [{ video: true }]);\n\t\t\t}\n\n\t\t\tif (options.audio && stream.getAudioTracks()[0])\n\t\t\t{\n\t\t\t\tthis.triggerEvents('GetUserMediaSuccess', [{ audio: true }]);\n\t\t\t}\n\t\t\tconst trackMuteHandlersAreAddedInfo = options.video ? ' - trackMuteHandlersAreAdded: true' : '';\n\t\t\tthis.setLog(`Getting user media with constraints: ${JSON.stringify(constraints)} succeeded${trackMuteHandlersAreAddedInfo}`);\n\t\t\tthis.triggerEvents('GetUserMediaEnded');\n\n\t\t\treturn stream;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tif (options.video)\n\t\t\t{\n\t\t\t\tthis.setLog(`Getting user media with constraints: ${JSON.stringify(constraints)} failed (fallbackMode: ${fallbackMode}): ${error}`, LOG_LEVEL.ERROR);\n\n\t\t\t\tif (!fallbackMode)\n\t\t\t\t{\n\t\t\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.LOCAL_VIDEO_STREAM_RECEIVING_FAILED,\n\t\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\tconst stream = await this.#getUserMedia(options, true);\n\n\t\t\t\t\treturn stream;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (options.audio)\n\t\t\t{\n\t\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.LOCAL_MICROPHONE_STREAM_RECEIVING_FAILED,\n\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.setLog(`Getting user media with constraints: ${JSON.stringify(constraints)} failed: ${error}`, LOG_LEVEL.ERROR);\n\t\t\t/*this.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.GET_LOCAL_TRACK_ERROR,\n\t\t\t\t\tvalue: { type: 'main' },\n\t\t\t\t});\n\t\t\t});*/\n\n\t\t\tthis.triggerEvents('GetUserMediaEnded');\n\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tasync #getDisplayMedia(): Promise<?MediaStream>\n\t{\n\t\tthis.setLog('Start getting display media');\n\n\t\ttry\n\t\t{\n\t\t\tconst mediaStream = await CallStreamManager.getUserScreen();\n\t\t\tconst stream = mediaStream.clone();\n\t\t\tthis.setLog('Getting display media succeeded');\n\n\t\t\treturn stream;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.setLog(`Getting display media failed: ${error}`, LOG_LEVEL.ERROR);\n\n\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() => {\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.LOCAL_SCREEN_STREAM_RECEIVING_FAILED,\n\t\t\t\t\twithCounter: true,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tasync getTrack(MediaStreamKind) {\n\t\tif (MediaStreamKind === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tconst readyState = this.#privateProperties.cameraStream?.getVideoTracks()[0]?.readyState;\n\t\t\tconst readyStateInfo = readyState ? ` - readyState: ${readyState}` : '';\n\t\t\tthis.setLog(`Video rack getting${readyStateInfo}`, LOG_LEVEL.INFO);\n\t\t}\n\n\t\tif (MediaStreamKind === MediaStreamsKinds.Camera && this.#privateProperties.cameraStream?.getVideoTracks()[0]?.readyState !== 'live')\n\t\t{\n\t\t\tthis.#privateProperties.cameraStream = await this.#getUserMedia({video: true});\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Microphone && !this.#privateProperties.microphoneStream)\n\t\t{\n\t\t\tthis.#privateProperties.microphoneStream = await this.#getUserMedia({audio: true});\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Screen && !this.#privateProperties.screenStream)\n\t\t{\n\t\t\tthis.#privateProperties.screenStream = await this.#getDisplayMedia();\n\t\t}\n\n\t\tif (this.#privateProperties.abortController.signal.aborted)\n\t\t{\n\t\t\tthis.#releaseStream(MediaStreamKind);\n\t\t\treturn;\n\t\t}\n\n\t\tlet track;\n\n\t\tif (MediaStreamKind === MediaStreamsKinds.Screen)\n\t\t{\n\t\t\ttrack = this.#privateProperties.screenStream?.getVideoTracks()[0];\n\t\t\tif (track && track.readyState !== 'live')\n\t\t\t{\n\t\t\t\tthis.#privateProperties.screenStream = null;\n\t\t\t\ttrack = this.getLocalScreen();\n\t\t\t}\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\ttrack = this.#privateProperties.cameraStream?.getVideoTracks()[0];\n\t\t\tconst readyState = track?.readyState;\n\t\t\tconst readyStateInfo = readyState ? ` - readyState: ${readyState}` : '';\n\t\t\tthis.setLog(`New video track getting${readyStateInfo}`, LOG_LEVEL.INFO);\n\t\t\tif (track && track.readyState !== 'live')\n\t\t\t{\n\t\t\t\tthis.#privateProperties.cameraStream = null;\n\t\t\t\ttrack = this.getLocalVideo();\n\t\t\t}\n\t\t}\n\t\telse if (MediaStreamKind === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\ttrack = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\t\tif (track && (track.readyState !== 'live' || this.#isNoiseSuppressionInputTrackOff()))\n\t\t\t{\n\t\t\t\tthis.#privateProperties.microphoneStream = null;\n\t\t\t\ttrack = this.getLocalAudio();\n\t\t\t}\n\n\t\t\tconst noInputTrackEndHandler = CallSettingsManager.noiseSuppressionEnabled\n\t\t\t\t&& Hardware.noiseSuppressionInputStream\n\t\t\t\t&& Hardware.noiseSuppressionInputStream.getAudioTracks().length > 0\n\t\t\t\t&& !Hardware.noiseSuppressionInputStream.getAudioTracks()[0].onended;\n\t\t\tif (track && noInputTrackEndHandler)\n\t\t\t{\n\t\t\t\tHardware.noiseSuppressionInputStream.getAudioTracks()[0].onended = () => {\n\t\t\t\t\ttrack.onended();\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tthis.#addOnEndedHandler(track, MediaStreamKind);\n\n\t\treturn track;\n\t}\n\n\t#addOnEndedHandler(track, mediaStreamKind)\n\t{\n\t\tif (track && !track.onended)\n\t\t{\n\t\t\ttrack.onended = () => {\n\t\t\t\tlet interrupted = false;\n\t\t\t\tlet permissionDescriptor = null;\n\n\t\t\t\tif (mediaStreamKind === MediaStreamsKinds.Microphone)\n\t\t\t\t{\n\t\t\t\t\tpermissionDescriptor = 'microphone';\n\t\t\t\t}\n\t\t\t\telse if (mediaStreamKind === MediaStreamsKinds.Camera)\n\t\t\t\t{\n\t\t\t\t\tpermissionDescriptor = 'camera';\n\t\t\t\t}\n\n\t\t\t\tif (this.#privateProperties.localTracks[mediaStreamKind])\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.localTracks[mediaStreamKind].muted = true;\n\n\t\t\t\t\tif (mediaStreamKind === MediaStreamsKinds.Camera)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setLog('Video track is ended - muted: true', LOG_LEVEL.INFO);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst permissionPromise = navigator?.permissions?.query\n\t\t\t\t\t? navigator.permissions.query({ name: permissionDescriptor })\n\t\t\t\t\t: Promise.resolve();\n\n\t\t\t\tpermissionPromise\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tinterrupted = result?.state === 'granted';\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\t// no need to do anything\n\t\t\t\t\t})\n\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\tthis.triggerEvents('PublishEnded', [mediaStreamKind, interrupted]);\n\t\t\t\t\t});\n\t\t\t};\n\t\t}\n\t}\n\n\tasync switchActiveAudioDevice(deviceId, force) {\n\t\tif (this.#privateProperties.switchActiveAudioDeviceInProgress && !force)\n\t\t{\n\t\t\tthis.setLog(`Got another request to switch an audio device to ${deviceId}, saving it`, LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.switchActiveAudioDevicePending = deviceId;\n\t\t\treturn;\n\t\t}\n\n\t\tlet error = null;\n\t\tlet fulfilled = false;\n\t\tthis.setLog(`Start switching an audio device to ${deviceId}`, LOG_LEVEL.INFO);\n\n\t\tconst promise = new Promise(async (resolve, reject) => {\n\t\t\tthis.#privateProperties.audioDeviceId = deviceId;\n\t\t\tconst prevStream = this.#privateProperties.microphoneStream;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Microphone);\n\n\t\t\t\tif (!sender)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog('Switching an audio device skipped - no sender', LOG_LEVEL.WARNING);\n\t\t\t\t\terror = 'No sender for audio';\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst prevTrack = this.#privateProperties.microphoneStream?.getAudioTracks()[0];\n\t\t\t\tthis.#privateProperties.microphoneStream = null;\n\t\t\t\tlet prevTrackEnabledState = true;\n\t\t\t\tlet prevTrackId = '';\n\t\t\t\tif (prevTrack)\n\t\t\t\t{\n\t\t\t\t\tprevTrackEnabledState = prevTrack.enabled;\n\t\t\t\t\tprevTrackId = prevTrack.id;\n\t\t\t\t\tprevTrack.stop();\n\t\t\t\t}\n\t\t\t\tconst audioTrack = await this.getLocalAudio();\n\t\t\t\taudioTrack.source = MediaStreamsKinds.Microphone;\n\t\t\t\taudioTrack.enabled = prevTrackEnabledState;\n\t\t\t\tif ((this.isAudioPublished() || sender.track.id !== audioTrack.id || audioTrack.id !== prevTrackId))\n\t\t\t\t{\n\t\t\t\t\tthis.setLog('Have sender for audio, start replacing track', LOG_LEVEL.INFO);\n\t\t\t\t\tawait sender.replaceTrack(audioTrack);\n\t\t\t\t}\n\t\t\t\tthis.setLog('Switching an audio device succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\terror = e;\n\t\t\t\tthis.setLog(`Switching an audio device failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t\tif (!this.#privateProperties.microphoneStream)\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.microphoneStream = prevStream;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tif (this.#privateProperties.switchActiveAudioDevicePending)\n\t\t\t\t{\n\t\t\t\t\tconst deviceId = this.#privateProperties.switchActiveAudioDevicePending;\n\t\t\t\t\tthis.#privateProperties.switchActiveAudioDevicePending = null;\n\t\t\t\t\tresolve(this.switchActiveAudioDevice(deviceId , true));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfulfilled = true;\n\t\t\t\t\tthis.#privateProperties.switchActiveAudioDeviceInProgress = null;\n\t\t\t\t\treturn error ? reject(error) : resolve();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!force && !fulfilled)\n\t\t{\n\t\t\tthis.#privateProperties.switchActiveAudioDeviceInProgress = promise;\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tasync switchActiveVideoDevice(deviceId, force) {\n\t\tif (this.#privateProperties.switchActiveVideoDeviceInProgress && !force)\n\t\t{\n\t\t\tthis.setLog(`Got another request to switch a video device to ${deviceId}, saving it`, LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.switchActiveVideoDevicePending = deviceId;\n\t\t\treturn;\n\t\t}\n\n\t\tlet error = null;\n\t\tlet fulfilled = false;\n\t\tthis.setLog(`Start switching a video device to ${deviceId}`, LOG_LEVEL.INFO);\n\n\t\tconst promise = new Promise(async (resolve, reject) => {\n\t\t\tthis.#privateProperties.videoDeviceId = deviceId;\n\t\t\tconst prevStream = this.#privateProperties.cameraStream;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst sender = this.#getSender(MediaStreamsKinds.Camera);\n\n\t\t\t\tif (!sender)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog('Switching a video device skipped - no sender', LOG_LEVEL.WARNING);\n\t\t\t\t\terror = 'No sender for video';\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.isVideoPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.setLog('Have sender for video, start replacing track', LOG_LEVEL.INFO);\n\t\t\t\t\tthis.#privateProperties.cameraStream?.getVideoTracks()[0].stop();\n\t\t\t\t\tthis.#privateProperties.cameraStream = null;\n\n\t\t\t\t\tconst videoTrack = await this.getLocalVideo();\n\t\t\t\t\tvideoTrack.source = MediaStreamsKinds.Camera;\n\t\t\t\t\tawait sender.replaceTrack(videoTrack);\n\t\t\t\t\tthis.#updateVideoEncodings(sender, videoTrack);\n\t\t\t\t}\n\t\t\t\tthis.setLog('Switching a video device succeeded', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\terror = e;\n\t\t\t\tthis.setLog(`Switching a video device failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\t\tif (!this.#privateProperties.cameraStream)\n\t\t\t\t{\n\t\t\t\t\tthis.#privateProperties.cameraStream = prevStream;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tif (this.#privateProperties.switchActiveVideoDevicePending)\n\t\t\t\t{\n\t\t\t\t\tconst deviceId = this.#privateProperties.switchActiveVideoDevicePending;\n\t\t\t\t\tthis.#privateProperties.switchActiveVideoDevicePending = null;\n\t\t\t\t\tresolve(this.switchActiveVideoDevice(deviceId , true));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfulfilled = true;\n\t\t\t\t\tthis.#privateProperties.switchActiveVideoDeviceInProgress = null;\n\t\t\t\t\treturn error ? reject(error) : resolve();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!force && !fulfilled)\n\t\t{\n\t\t\tthis.#privateProperties.switchActiveVideoDeviceInProgress = promise;\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tisAudioPublished(): boolean\n\t{\n\t\treturn this.#isTrackPublished(MediaStreamsKinds.Microphone);\n\t}\n\n\tisVideoPublished(): boolean\n\t{\n\t\treturn this.#isTrackPublished(MediaStreamsKinds.Camera);\n\t}\n\n\tisScreenPublished(): boolean\n\t{\n\t\treturn this.#isTrackPublished(MediaStreamsKinds.Screen);\n\t}\n\n\t#isTrackPublished(kind: number): boolean\n\t{\n\t\treturn this.#privateProperties.localTracks[kind] && this.#privateProperties.localTracks[kind]?.muted !== true;\n\t}\n\n\t#addTrackMuteHandlers(track)\n\t{\n\t\ttrack.onmute = (event) =>\n\t\t{\n\t\t\tthis.setLog('Video track event \"mute\" was triggered', LOG_LEVEL.INFO);\n\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\t\t\tthis.disableVideo({ calledFrom: 'track.onmute', bySystem: true });\n\t\t\tthis.disableAudio({ calledFrom: 'track.onmute', bySystem: true });\n\t\t\tthis.#privateProperties.mediaMutedBySystem = true;\n\t\t\tthis.triggerEvents('MediaMutedBySystem', [true]);\n\t\t};\n\n\t\ttrack.onunmute = (event) =>\n\t\t{\n\t\t\tthis.setLog('Video track event \"unmute\" was triggered', LOG_LEVEL.INFO);\n\t\t\tif (this.#privateProperties.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.mediaMutedBySystem = false;\n\t\t\t\tthis.triggerEvents('MediaMutedBySystem', [false]);\n\t\t\t}\n\t\t\tthis.enableVideo({calledFrom: 'track.onunmute'});\n\t\t\tif (this.#privateProperties.needToEnableAudioAfterSystemMuted)\n\t\t\t{\n\t\t\t\tthis.enableAudio();\n\t\t\t}\n\t\t};\n\t}\n\n\tgetParticipants() {\n\t\treturn this.#privateProperties.remoteParticipants\n\t}\n\n\tgetState() {\n\t\treturn this.#privateProperties.callState\n\t}\n\n\tsetRecorderState(status)\n\t{\n\t\tif (!Object.values(RecorderStatus).includes(status))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst signal = {\n\t\t\trecorderControl: {\n\t\t\t\tstatus: status,\n\t\t\t}\n\t\t};\n\n\t\treturn this.isConnected() ? this.#sendSignal(signal) : false;\n\t}\n\n\t/**\n\t * @param {number} status\n\t * @param {CloudRecordKind | null} kind\n\t */\n\tsetCloudRecordState(status, kind = null) {\n\t\tif (!Object.values(CloudRecordStatus).includes(status))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst signal = {\n\t\t\tvideoRecorderControl: {\n\t\t\t\tstatus,\n\t\t\t\tkind,\n\t\t\t},\n\t\t};\n\n\t\tif (Util.isCloudRecordLogEnabled())\n\t\t{\n\t\t\tconsole.warn(`CloudRecord: videoRecorderControl`, signal);\n\t\t}\n\n\t\tif (this.isConnected())\n\t\t{\n\t\t\tthis.#sendSignal(signal);\n\t\t}\n\t}\n\n\tsetLog(log, level) {\n\t\tlevel = LOG_LEVEL[level] || LOG_LEVEL.INFO;\n\n\t\tconst desktopVersion = window['BXDesktopSystem']?.ApiVersion?.();\n\t\tconst version = ClientVersion + (desktopVersion ? ` (desktopApi: ${desktopVersion})` : '');\n\t\tconst currentTime = Date.now();\n\t\tconst data = {\n\t\t\ttimestamp: Math.floor(currentTime / 1000),\n\t\t\ttimestampMS: currentTime,\n\t\t\tevent: log,\n\t\t\tclient: ClientPlatform,\n\t\t\tappVersion: version,\n\t\t};\n\n\t\tif (Util.isMetricsLogsEnabled())\n\t\t{\n\t\t\treturn this.#sendLog(data, level);\n\t\t}\n\n\t\tif (this.#privateProperties.isloggingEnable)\n\t\t{\n\t\t\tconst logLength = Object.values(this.#privateProperties.logs).length;\n\t\t\tthis.#privateProperties.logs[logLength] = {\n\t\t\t\tlevel,\n\t\t\t\tdata,\n\t\t\t};\n\t\t\tlet lastSentLog = 0;\n\n\t\t\tfor (let index in this.#privateProperties.logs)\n\t\t\t{\n\t\t\t\tif (!this.#sendLog(this.#privateProperties.logs[index].data, this.#privateProperties.logs[index].level))\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tlastSentLog = index;\n\t\t\t}\n\n\t\t\tif (lastSentLog)\n\t\t\t{\n\t\t\t\tthis.#privateProperties.logs = Object.values(this.#privateProperties.logs).slice(lastSentLog + 1);\n\t\t\t}\n\n\t\t\tif (this.#privateProperties.loggerCallback) {\n\t\t\t\tthis.#privateProperties.loggerCallback();\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareMetricsLogs({logData, level})\n\t{\n\t\tconst logObject =\n\t\t{\n\t\t\ttimeUnixNano: logData.timestampMS * 1000000, // ms -> nanoseconds\n\t\t\tseverityNumber: 9,\n\t\t\tseverityText: 'INFO',\n\t\t\tbody:\n\t\t\t{\n\t\t\t\tstringValue: logData.event,\n\t\t\t},\n\t\t\tattributes:\n\t\t\t{\n\t\t\t\tlevel: level,\n\t\t\t\tsession_id: String(this.#privateProperties.roomId),\n\t\t\t\tpeer_id: String(this.#privateProperties.userId),\n\t\t\t\tapp_version: logData.appVersion,\n\t\t\t\tenv: String(this.#privateProperties.monitoringEnvironment),\n\t\t\t\tregion: String(this.#privateProperties.monitoringRegion),\n\t\t\t},\n\t\t\t//traceId: '',\n\t\t\t//spanId: '',\n\t\t};\n\n\t\tthis.currentMonitoringEventsObject.logs.push(logObject);\n\t}\n\n\t#sendLog(logData, level)\n\t{\n\t\tif (Util.isMetricsLogsEnabled())\n\t\t{\n\t\t\treturn this.prepareMetricsLogs({logData, level});\n\t\t}\n\t\tif (!Util.isKibanaLogsEnabled())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst signal = {\n\t\t\tsendLog: {\n\t\t\t\tuserName: `${this.#privateProperties.userId}`,\n\t\t\t\tdata: JSON.stringify(logData),\n\t\t\t\tmsgLevel: level,\n\t\t\t}\n\t\t};\n\n\t\treturn this.isConnected() ? this.#sendSignal(signal) : false;\n\t}\n\n\tsetLoggerCallback(callback) {\n\t\tthis.#privateProperties.loggerCallback = callback;\n\t}\n\n\tenableSilentLogging(enable) {\n\t\tthis.#privateProperties.isloggingEnable = enable;\n\t}\n\n\t#removeUdpFromSdp(sdp)\n\t{\n\t\tconst updatedSdp = [];\n\t\tsdp.split(/(\\r\\n|\\r|\\n)/).filter(RegExp.prototype.test.bind(/^([a-z])=(.*)/)).forEach((el) =>\n\t\t{\n\t\t\tif (!el.startsWith('a=candidate') || el.includes('tcp'))\n\t\t\t{\n\t\t\t\tupdatedSdp.push(el);\n\t\t\t}\n\t\t});\n\n\t\tsdp = updatedSdp.join('\\r\\n') + '\\r\\n';\n\n\t\treturn sdp;\n\t}\n\n\tasync #answerHandler(data) {\n\t\tthis.setLog('Start handling a remote answer', LOG_LEVEL.INFO);\n\t\tlet hasError = false;\n\t\ttry\n\t\t{\n\t\t\tif (Util.useTcpSdp())\n\t\t\t{\n\t\t\t\tdata.answer.sdp = this.#removeUdpFromSdp(data.answer.sdp);\n\t\t\t}\n\t\t\tawait this.sender.setRemoteDescription(data.answer);\n\t\t\tthis.#privateProperties.pendingCandidates.sender.forEach((candidate) =>\n\t\t\t{\n\t\t\t\tthis.sender.addIceCandidate(candidate);\n\t\t\t\tthis.setLog('Added a deferred ICE candidate', LOG_LEVEL.INFO);\n\t\t\t});\n\t\t\tthis.#privateProperties.pendingCandidates.sender = [];\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.setLog(`Handling a remote answer failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\thasError = true;\n\t\t\tthis.#beforeDisconnect();\n\t\t\tthis.#reconnect({\n\t\t\t\treconnectionReason: 'HANDLING_ANSWER',\n\t\t\t\treconnectionReasonInfo: `Handling a remote answer failed: ${e}`,\n\t\t\t});\n\n\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_ISSUES_HANDLING_ANSWER,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tif (!hasError)\n\t\t\t{\n\t\t\t\tthis.setLog('Handling a remote answer succeeded', LOG_LEVEL.INFO);\n\t\t\t\tthis.#privateProperties.isWaitAnswer = false;\n\t\t\t\tawait this.sendOffer();\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #offerHandler(data)\n\t{\n\t\tthis.setLog('Handling a remote offer', LOG_LEVEL.INFO);\n\n\t\tif (!this.recipient)\n\t\t{\n\t\t\tthis.setLog('Handling a remote offer deferred');\n\t\t\tthis.#privateProperties.pendingOffer = data;\n\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tif (Util.useTcpSdp())\n\t\t\t{\n\t\t\t\tdata.offer.sdp = this.#removeUdpFromSdp(data.offer.sdp);\n\t\t\t}\n\t\t\tawait this.recipient.setRemoteDescription(data.offer);\n\t\t\tthis.#privateProperties.pendingCandidates.recipient.forEach((candidate) => {\n\t\t\t\tthis.recipient.addIceCandidate(candidate);\n\t\t\t\tthis.setLog('Added a deferred ICE candidate', LOG_LEVEL.INFO);\n\t\t\t});\n\t\t\tthis.#privateProperties.pendingCandidates.recipient = [];\n\t\t\tlet answer = await this.recipient.createAnswer();\n\t\t\tif (Util.useTcpSdp())\n\t\t\t{\n\t\t\t\tanswer = {\n\t\t\t\t\ttype: answer.type,\n\t\t\t\t\tsdp: this.#removeUdpFromSdp(answer.sdp),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tawait this.recipient.setLocalDescription(answer);\n\t\t\tthis.#sendSignal({ answer });\n\t\t\tthis.setLog('Handling a remote offer succeeded', LOG_LEVEL.INFO);\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.setLog(`Handling a remote offer failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.#beforeDisconnect();\n\n\t\t\tthis.#reconnect({\n\t\t\t\treconnectionReason: 'HANDLING_OFFER',\n\t\t\t\treconnectionReasonInfo: `Handling a remote offer failed: ${e}`,\n\t\t\t});\n\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_ISSUES_HANDLING_OFFER,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#addIceCandidate(trickle)\n\t{\n\t\tthis.setLog('Start adding an ICE candidate', LOG_LEVEL.INFO);\n\t\ttry\n\t\t{\n\t\t\tconst candidate = JSON.parse(trickle.candidateInit);\n\n\t\t\tif (Util.useTcpSdp() && !candidate.candidate.includes('tcp'))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (trickle.target)\n\t\t\t{\n\t\t\t\tif (this.recipient?.remoteDescription)\n\t\t\t\t{\n\t\t\t\t\tthis.recipient.addIceCandidate(candidate);\n\t\t\t\t\tthis.setLog('Adding an ICE candidate succeeded', LOG_LEVEL.INFO);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#privateProperties.pendingCandidates.recipient.push(candidate);\n\t\t\t\tthis.setLog('Adding an ICE candidate deferred: has no remote description', LOG_LEVEL.INFO);\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.sender?.remoteDescription)\n\t\t\t\t{\n\t\t\t\t\tthis.sender.addIceCandidate(candidate);\n\t\t\t\t\tthis.setLog('Adding an ICE candidate succeeded', LOG_LEVEL.INFO);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#privateProperties.pendingCandidates.sender.push(candidate);\n\t\t\t\tthis.setLog('Adding an ICE candidate deferred: has no remote description', LOG_LEVEL.INFO);\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tthis.setLog(`Adding an ICE candidate failed: ${e}`, LOG_LEVEL.ERROR);\n\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t{\n\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.PEER_CONNECTION_ISSUES_ADDING_ICE_CANDIDATE,\n\t\t\t\t\tvalue: 3,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t#setUserPermissions(_permissionsJSON)\n\t{\n\t\ttry\n\t\t{\n\t\t\tlet permissions = JSON.parse(_permissionsJSON);\n\n\t\t\tUtil.setUserPermissions(permissions);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tthis.setLog(`Could not parse a permissions JSON: ${_permissionsJSON}  ${err.message}`, LOG_LEVEL.WARNING);\n\t\t}\n\t}\n\n\t#setRemoteParticipant(participant) {\n\t\tconst userId = participant.userId\n\t\tconst participantEvent = this.#privateProperties.remoteParticipants[userId]\n\t\t\t? 'ParticipantStateUpdated'\n\t\t\t: 'ParticipantJoined'\n\t\tconst remoteParticipant = new Participant(participant, this.#privateProperties.socketConnect)\n\t\tthis.#privateProperties.remoteParticipants[userId] = remoteParticipant;\n\n\t\tthis.triggerEvents(participantEvent, [remoteParticipant]);\n\t\tif (participant.participantTracks)\n\t\t{\n\t\t\tObject.values(participant.participantTracks).forEach( track => {\n\t\t\t\ttrack.userId = userId\n\t\t\t\tthis.#privateProperties.tracksDataFromSocket[track.sid] = track\n\t\t\t\tif (track.muted && track.source === MediaStreamsKinds.Microphone)\n\t\t\t\t{\n\t\t\t\t\tremoteParticipant.isMutedAudio = true;\n\t\t\t\t}\n\t\t\t\tif (track.muted && track.source === MediaStreamsKinds.Camera)\n\t\t\t\t{\n\t\t\t\t\tremoteParticipant.isMutedVideo = true;\n\t\t\t\t}\n\t\t\t\tswitch (track.source)\n\t\t\t\t{\n\t\t\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\t\t\tremoteParticipant.videoEnabled = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\t\t\tremoteParticipant.audioEnabled = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\t\t\tremoteParticipant.screenSharingEnabled = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthis.setLog(`A participant with id ${userId} (sid: ${participant.sid}) has a track info with kind ${track.source} (sid: ${track.sid}, waiting for it`, LOG_LEVEL.INFO);\n\n\t\t\t\tconst ontrackData = this.#privateProperties.ontrackData[track.sid];\n\t\t\t\tdelete this.#privateProperties.ontrackData[track.sid];\n\n\t\t\t\tif (ontrackData)\n\t\t\t\t{\n\t\t\t\t\tthis.#createRemoteTrack(track.sid, ontrackData);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#addPendingSubscription(participant, track);\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\n\t\tif (this.#privateProperties.videoStreamSetupErrorList[userId]) {\n\t\t\tconst kindArray = [...this.#privateProperties.videoStreamSetupErrorList[userId]];\n\t\t\tdelete this.#privateProperties.videoStreamSetupErrorList[userId];\n\n\t\t\tkindArray.forEach((kind) =>\n\t\t\t{\n\t\t\t\tthis.setMainStream(userId, kind);\n\t\t\t});\n\t\t}\n\t};\n\n\t#createRemoteTrack(trackId, ontrackData)\n\t{\n\t\tconst trackData = this.#privateProperties.tracksDataFromSocket[trackId];\n\t\tconst userId = trackData.userId;\n\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\tconst track = ontrackData.track;\n\t\tconst trackMuted = !!trackData.muted;\n\n\t\tthis.#privateProperties.realTracksIds[track.id] = trackId;\n\t\ttrack.source = trackData.source;\n\t\ttrack.layers = trackData.layers || null;\n\n\t\tif (!this.#privateProperties.remoteTracks?.[userId])\n\t\t{\n\t\t\tthis.#privateProperties.remoteTracks[userId] = {}\n\t\t}\n\t\tconst remoteTrack = new Track(trackId, track);\n\t\tthis.#privateProperties.remoteTracks[userId][trackId] = remoteTrack;\n\n\t\tif (remoteTrack.source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tparticipant.isMutedVideo = trackMuted;\n\t\t}\n\t\telse if (remoteTrack.source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tparticipant.isMutedAudio = trackMuted;\n\t\t\tif (trackMuted)\n\t\t\t{\n\t\t\t\tthis.setLog(`Trigger mute signal (${trackMuted}) for received audio from a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t\t\tthis.triggerEvents('RemoteMediaMuted', [participant, remoteTrack]);\n\t\t\t}\n\t\t}\n\n\t\tif (this.#privateProperties.pendingSubscriptions[userId]?.[trackId]?.timeout)\n\t\t{\n\t\t\tclearTimeout(this.#privateProperties.pendingSubscriptions[userId][trackId].timeout);\n\t\t\tdelete this.#privateProperties.pendingSubscriptions[userId][trackId];\n\t\t}\n\n\t\tthis.setLog(`Got an expected track with kind ${remoteTrack.source} (sid: ${trackId}) for a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\tparticipant.addTrack(remoteTrack.source, remoteTrack);\n\t\tif (remoteTrack.source !== MediaStreamsKinds.Camera || !participant.isMutedVideo)\n\t\t{\n\t\t\tthis.triggerEvents('RemoteMediaAdded', [participant, remoteTrack]);\n\t\t}\n\n\t\tif (remoteTrack.source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tconst quality = this.#calculateVideoQualityForUser(userId, remoteTrack.source);\n\t\t\tthis.setLog(`Quality of video for a participant with id ${participant.userId} (sid: ${participant.sid}) was changed to ${quality} after receiving`, LOG_LEVEL.INFO);\n\t\t\tparticipant.setStreamQuality(quality);\n\t\t}\n\n\t\tif (track.kind === 'video')\n\t\t{\n\t\t\tconst streamRemovingId = Util.getUuidv4();\n\t\t\tparticipant.streamRemovingId = streamRemovingId;\n\t\t\tontrackData.streams[0].onremovetrack = () =>\n\t\t\t{\n\t\t\t\t// we need to check if a participant is still exists\n\t\t\t\t// otherwise tracks were deleted when participant left room\n\t\t\t\tconst participant = this.#privateProperties.remoteParticipants[userId];\n\t\t\t\tif (participant?.streamRemovingId === streamRemovingId)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Track with kind ${track.source} (sid: ${track.id}) for a participant with id ${userId} (sid: ${participant.sid || 'unknown'}) was removed from peer connection`, LOG_LEVEL.WARNING);\n\t\t\t\t\tthis.triggerEvents('RemoteMediaRemoved', [participant, remoteTrack]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Track with kind ${track.source} (sid: ${track.id}) was removed from a disconnected participant with id ${userId} (sid: unknown) before it was removed from peer connection`, LOG_LEVEL.WARNING);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\t#speakerChangedHandler(data) {\n\t\tdata.speakersChanged.speakers.forEach((speaker) => {\n\t\t\tconst participant = Object.values(this.#privateProperties.remoteParticipants).find(p => p.sid === speaker.sid)\n\t\t\tif (participant && participant?.userId != this.#privateProperties.userId) {\n\t\t\t\tparticipant.isSpeaking = speaker?.active || false\n\t\t\t\tif (speaker?.active) {\n\t\t\t\t\tthis.triggerEvents('VoiceStarted', [participant]);\n\t\t\t\t} else {\n\t\t\t\t\tthis.triggerEvents('VoiceEnded', [participant]);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t#trackMutedHandler(data) {\n\t\tconst participant = this.#privateProperties.remoteParticipants[data.track.publisher];\n\t\tconst trackId = data.track.shortId;\n\t\tthis.setLog(`Got socket message \"trackMuted\" - trackId: ${trackId}, muted: ${data?.muted}`, LOG_LEVEL.INFO);\n\n\t\tif (data.track.publisher == this.#privateProperties.userId)\n\t\t{\n\t\t\tconst track = Object.values(this.#privateProperties.localTracks)?.find(track => track?.sid === trackId);\n\t\t\tif (track)\n\t\t\t{\n\t\t\t\tif (track.source === MediaStreamsKinds.Camera)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Got mute self video signal (${data.muted}) - trackId: ${trackId}`, LOG_LEVEL.INFO);\n\n\t\t\t\t\tif (!data.muted && track.muted && !this.#privateProperties.mediaMutedBySystem)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.triggerEvents('PublishSucceed', [track.source]);\n\t\t\t\t\t}\n\t\t\t\t\telse if (!this.#privateProperties.mediaMutedBySystem)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.triggerEvents('PublishPaused', [track.source]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.#privateProperties.videoQueue)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#processVideoQueue();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if(track.source === MediaStreamsKinds.Microphone)\n\t\t\t\t{\n\t\t\t\t\tthis.triggerEvents('PublishPaused', [track.source, data.muted]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog(`Mute self signal (${data.muted}) getting failed - trackId: ${trackId}`, LOG_LEVEL.INFO);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!participant) {\n\t\t\tif (data.track.publisher != this.#privateProperties.userId)\n\t\t\t{\n\t\t\t\tthis.setLog(`Got mute signal (${data.muted}) for a non-existent participant with id ${data.track.publisher}`, LOG_LEVEL.WARNING);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst track = Object.values(participant.tracks)?.find(track => track?.id === trackId);\n\t\tconst awaitedTrack = this.#privateProperties.tracksDataFromSocket[trackId];\n\t\tif (awaitedTrack && !track)\n\t\t{\n\t\t\tthis.#privateProperties.tracksDataFromSocket[trackId].muted = data.muted;\n\t\t\tthis.setLog(`Got mute signal (${data.muted}) for a non-received track with id ${trackId}`, LOG_LEVEL.WARNING);\n\t\t\tparticipant.isMutedVideo = data.muted;\n\t\t\tthis.triggerEvents('AwaitedRemoteMediaMuted', [participant, this.#privateProperties.tracksDataFromSocket[trackId]]);\n\t\t\t\n\t\t\treturn;\n\t\t}\n\t\telse if (!track)\n\t\t{\n\t\t\tthis.setLog(`Got mute signal (${data.muted}) for a non-existent track with id ${trackId}`, LOG_LEVEL.WARNING);\n\t\t\treturn;\n\t\t}\n\n\t\tif (track.source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.#microphoneMuteUnmuteHandler({track: track, isMuted: data.muted, participant: participant});\n\t\t\tthis.setLog(`Got mute signal (${data.muted}) for audio from a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\t\t}\n\t\telse if (track.source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.#cameraMuteUnmuteHandler({track: track, isMuted: data.muted, participant: participant});\n\t\t\tthis.setLog(`Got mute signal (${data.muted}) for video from a participant with id ${participant.userId} (sid: ${participant.sid})`, LOG_LEVEL.INFO);\n\n\t\t}\n\t}\n\n\t#microphoneMuteUnmuteHandler(options) {\n\t\toptions.participant.isMutedAudio = options.isMuted;\n\n\t\tconst eventName = options.isMuted\n\t\t\t? 'RemoteMediaMuted'\n\t\t\t: 'RemoteMediaUnmuted';\n\n\t\tthis.triggerEvents(eventName, [options.participant, options.track]);\n\t}\n\n\t#cameraMuteUnmuteHandler(options) {\n\t\tthis.setLog(`Camera muting was changed (${options?.isMuted}) - trackSid: ${options?.track?.sid}, participantUserId: ${options?.participant?.userId}, trackSource: ${options?.track?.source}`, LOG_LEVEL.INFO);\n\n\t\toptions.participant.isMutedVideo = options.isMuted;\n\n\t\tconst eventName = options.isMuted\n\t\t\t? 'RemoteMediaRemoved'\n\t\t\t: 'RemoteMediaAdded';\n\n\t\tif (this.#privateProperties.tracksDataFromSocket[options.track.sid])\n\t\t{\n\t\t\tthis.#privateProperties.tracksDataFromSocket[options.track.sid].muted = options.isMuted;\n\t\t}\n\n\t\tthis.triggerEvents(eventName, [options.participant, options.track]);\n\t}\n\n\t#participantMutedHandler(data)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (data.toUserId === data.fromUserId) // we not accept mute participant by himself by this method\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (data.toUserId != this.#privateProperties.userId)\n\t\t{\n\t\t\tconst participant = this.#privateProperties.remoteParticipants[data.toUserId];\n\n\t\t\tif (!participant)\n\t\t\t{\n\t\t\t\tthis.setLog(`Got a onParticipantMuted event for non-existent user (toUserId: ${data.toUserId})`, LOG_LEVEL.WARNING);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (data?.track.muted) // tbh always should be in \"true\"..\n\t\t\t{\n\t\t\t\tif (data.track.type === 0 && participant.audioEnabled)\n\t\t\t\t{ // audio\n\t\t\t\t\tparticipant.audioEnabled = false;\n\n\t\t\t\t\tconst track = Object.values(participant.tracks)?.find(track => track?.source === MediaStreamsKinds.Microphone);\n\n\t\t\t\t\tthis.#microphoneMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\t\t\t\t}\n\t\t\t\telse if (data.track.type === 1 && participant.videoEnabled)\n\t\t\t\t{ // video\n\t\t\t\t\tthis.setLog(`Mute participant video - from: ${data?.fromUserId}, to: ${data?.toUserId}`, LOG_LEVEL.INFO);\n\t\t\t\t\tparticipant.videoEnabled = false;\n\t\t\t\t\tconst track = Object.values(participant.tracks)?.find(track => track?.source === MediaStreamsKinds.Camera);\n\n\t\t\t\t\tthis.#cameraMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\t\t\t\t}\n\t\t\t\telse if (data.track.type === 1 && !participant.videoEnabled)\n\t\t\t\t{\n\t\t\t\t\tthis.setLog(`Cancel participant video muting - from: ${data?.fromUserId}, to: ${data?.toUserId}`, LOG_LEVEL.INFO);\n\t\t\t\t}\n\t\t\t\telse if (data.track.type === 2 && participant.screenSharingEnabled)\n\t\t\t\t{ // screenshare\n\t\t\t\t\tparticipant.screenSharingEnabled = false;\n\n\t\t\t\t\tconst track = Object.values(participant.tracks)?.find(track => track?.source === MediaStreamsKinds.Screen);\n\t\t\t\t\tconst screenAudioTrack = participant.getTrack(MediaStreamsKinds.ScreenAudio);\n\n\t\t\t\t\tthis.#cameraMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\n\t\t\t\t\tif (screenAudioTrack)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#microphoneMuteUnmuteHandler({track: screenAudioTrack, isMuted: true, participant: participant});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.triggerEvents('ParticipantMuted', [data]);\n\t}\n\n\t#allParticipantsMutedHandler(data)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (data.fromUserId == this.#privateProperties.userId)\n\t\t{\n\t\t\tif (!data.reason || (data.reason && data.reason != 'settings'))\n\t\t\t{\n\t\t\t\tthis.triggerEvents('YouMuteAllParticipants', [data]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (data?.track.type === 0)\n\t\t\t{\n\t\t\t\tthis.triggerEvents('AllParticipantsAudioMuted', [data]);\n\t\t\t}\n\t\t\telse if (data.track.type === 1)\n\t\t\t{\n\t\t\t\tthis.setLog(`Try to mute all participant videos - from: ${data?.fromUserId}`, LOG_LEVEL.INFO);\n\t\t\t\tthis.triggerEvents('AllParticipantsVideoMuted', [data]);\n\t\t\t}\n\t\t\telse if (data.track.type === 2)\n\t\t\t{\n\t\t\t\tthis.triggerEvents('AllParticipantsScreenshareMuted', [data]);\n\t\t\t}\n\t\t}\n\n\t\tif (data?.track.muted) // tbh always should be in \"true\"..\n\t\t{\n\t\t\tfor (let i in this.#privateProperties.remoteParticipants)\n\t\t\t{\n\t\t\t\tif (this.#privateProperties.remoteParticipants.hasOwnProperty(i))\n\t\t\t\t{\n\t\t\t\t\tlet  participant = this.#privateProperties.remoteParticipants[i];\n\n\t\t\t\t\tif (participant.userId != data.fromUserId && Util.isRegularUser(Util.getUserRoleByUserId(participant.userId)))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (data.track.type === 0 && participant.audioEnabled)\n\t\t\t\t\t\t{ // audio\n\t\t\t\t\t\t\tparticipant.audioEnabled = false;\n\n\t\t\t\t\t\t\tconst track = participant.getTrack(MediaStreamsKinds.Microphone);\n\n\t\t\t\t\t\t\tthis.#microphoneMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(data.track.type === 1 && participant.videoEnabled)\n\t\t\t\t\t\t{ // video\n\t\t\t\t\t\t\tparticipant.videoEnabled = false;\n\n\t\t\t\t\t\t\tthis.setLog(`Mute participant video - from: ${data?.fromUserId}, to: ${participant?.userId}`, LOG_LEVEL.INFO);\n\n\t\t\t\t\t\t\tconst track = participant.getTrack(MediaStreamsKinds.Camera);\n\n\t\t\t\t\t\t\tthis.#cameraMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (data.track.type === 1 && !participant.videoEnabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.setLog(`Cancel participant video muting - from: ${data?.fromUserId}, to: ${participant?.userId}`, LOG_LEVEL.INFO);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(data.track.type === 2)\n\t\t\t\t\t\t{ // screenshare\n\t\t\t\t\t\t\tparticipant.screenSharingEnabled = false;\n\n\t\t\t\t\t\t\tconst track = participant.getTrack(MediaStreamsKinds.Screen);\n\t\t\t\t\t\t\tconst screenAudioTrack = participant.getTrack(MediaStreamsKinds.ScreenAudio);\n\n\t\t\t\t\t\t\tthis.#cameraMuteUnmuteHandler({track: track, isMuted: true, participant: participant});\n\t\t\t\t\t\t\tif (screenAudioTrack)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#microphoneMuteUnmuteHandler({track: screenAudioTrack, isMuted: true, participant: participant});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#updateRoleHandler(data)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (data.toUserId == this.#privateProperties.userId)\n\t\t{\n\t\t\tUtil.setCurrentUserRole(data.role);\n\t\t\tthis.#setUserPermissions(data.permissions);\n\t\t}\n\n\t\tthis.triggerEvents('UserRoleChanged', [data]);\n\t}\n\n\t#userPermissionsChanged(data)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (data.allow === true && Util.isRegularUser(Util.getCurrentUserRole()))\n\t\t{\n\t\t\tlet permissions = Util.getUserPermissions();\n\n\t\t\tpermissions.audio = data.allow;\n\t\t\tpermissions.video = data.allow;\n\t\t\tpermissions.screen_share = data.allow;\n\n\t\t\tUtil.setUserPermissions(permissions);\n\t\t}\n\n\t\tthis.triggerEvents('UserPermissionsChanged', [data]);\n\t}\n\n\t#settingsChangedHandler(data)\n\t{\n\t\tif (!Util.isUserControlFeatureEnabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tdata.calledFrom = 'settingsChanged';\n\n\t\tlet newRoomSettings = Util.getRoomPermissions();\n\t\tlet options = {reason: 'settings', eft: data.eft, fromUserId: data.fromUserId, track: {type: 0}};\n\n\t\tswitch (data.act)\n\t\t{\n\t\t\tcase 'audio':\n\t\t\t\toptions.track.type = 0;\n\t\t\t\tnewRoomSettings.AudioEnabled = data.roomState.AudioEnabled;\n\t\t\t\tbreak\n\t\t\tcase 'video':\n\t\t\t\toptions.track.type = 1;\n\t\t\t\tnewRoomSettings.VideoEnabled = data.roomState.VideoEnabled;\n\t\t\t\tbreak\n\t\t\tcase 'screen_share':\n\t\t\t\toptions.track.type = 2;\n\t\t\t\tnewRoomSettings.ScreenShareEnabled = data.roomState.ScreenShareEnabled;\n\t\t\t\tbreak\n\t\t}\n\n\t\tUtil.setRoomPermissions(newRoomSettings);\n\t\tUtil.updateUserPermissionByNewRoomPermission(data.act, !data.eft);\n\n\t\tif (data.eft === true)\n\t\t{\n\t\t\tthis.#allParticipantsMutedHandler(options);\n\t\t}\n\n\t\tthis.triggerEvents('RoomSettingsChanged', [data]);\n\t}\n\n\t#createPeerConnection() {\n\t\tthis.#destroyPeerConnection()\n\n\t\tconst config = {};\n\t\tif (this.#privateProperties.iceServers)\n\t\t{\n\t\t\tconfig.iceServers = this.#privateProperties.iceServers;\n\t\t}\n\n\t\tthis.sender = new RTCPeerConnection(config);\n\t\tthis.sender.addEventListener('icecandidate', e => this.onIceCandidate(null, e));\n\t\tthis.sender.addEventListener('connectionstatechange', e => this.onConnectionStateChange());\n\t\tthis.sender.addEventListener('iceconnectionstatechange', e => this.onIceConnectionStateChange());\n\n\t\tthis.recipient = new RTCPeerConnection(config);\n\t\tthis.recipient.ontrack = (event) => {\n\t\t\tconst ids = event.streams[0].id.split('|');\n\t\t\tconst trackId = ids[1];\n\t\t\tconst userId = this.#privateProperties.tracksDataFromSocket[trackId]?.userId;\n\n\t\t\tif (this.#privateProperties.remoteParticipants[userId] && this.#privateProperties.tracksDataFromSocket[trackId])\n\t\t\t{\n\t\t\t\tthis.#createRemoteTrack(trackId, event);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setLog(`Got a track with kind ${event.track.kind} (sid: ${trackId}) without a participant, saving it`, LOG_LEVEL.WARNING);\n\t\t\t\tthis.#privateProperties.ontrackData[trackId] = event;\n\t\t\t}\n\t\t};\n\t\tthis.recipient.addEventListener('icecandidate', e => this.onIceCandidate('SUBSCRIBER', e));\n\t\tthis.recipient.addEventListener('connectionstatechange', e => this.onConnectionStateChange(true));\n\t\tthis.recipient.addEventListener('iceconnectionstatechange', e => this.onIceConnectionStateChange(true));\n\n\t\tif (this.#privateProperties.pendingOffer)\n\t\t{\n\t\t\tthis.#offerHandler(this.#privateProperties.pendingOffer);\n\t\t\tthis.#privateProperties.pendingOffer = null;\n\t\t}\n\n\t\tconst getStatsHandle = async () => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst statsAll = {};\n\t\t\t\tlet packetLostEventAdded = false;\n\t\t\t\tawait this.sender.getStats(null).then((stats) => {\n\t\t\t\t\tconst statsOutput = [];\n\t\t\t\t\tconst codecs = {};\n\t\t\t\t\tconst reportsWithoutCodecs = {};\n\t\t\t\t\tconst remoteReports = {};\n\t\t\t\t\tconst reportsWithoutRemoteInfo = {};\n\t\t\t\t\tlet audioReport = null;\n\t\t\t\t\tlet isQualityLimitationSent = false;\n\t\t\t\t\tconst totalBitrateOut = [];\n\n\t\t\t\t\tstats.forEach((rawReport) => {\n\t\t\t\t\t\tconst report = { ...rawReport };\n\t\t\t\t\t\tstatsOutput.push(report);\n\n\t\t\t\t\t\tif (report.type === 'codec')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (report.type === 'remote-inbound-rtp')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst reportId = report.localId;\n\t\t\t\t\t\t\tif (!reportsWithoutRemoteInfo[reportId])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tremoteReports[reportId] = report;\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!this.#privateProperties.outgoingTracksReports[reportId])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#privateProperties.outgoingTracksReports[reportId] = {};\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst prevReport = this.#privateProperties.outgoingTracksReports[reportId];\n\t\t\t\t\t\t\tconst packetsLostData = Util.calcLocalPacketsLost(reportsWithoutRemoteInfo[reportId], prevReport, report);\n\t\t\t\t\t\t\tconst { currentPercentPacketLost } = packetsLostData;\n\n\t\t\t\t\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.addValidatedMonitoringMetric({\n\t\t\t\t\t\t\t\t\tadditionalData: {\n\t\t\t\t\t\t\t\t\t\tcurrentReportPacketsSent: reportsWithoutRemoteInfo[reportId]?.packetsSent,\n\t\t\t\t\t\t\t\t\t\tprevReportPacketsSent: this.#privateProperties.outgoingTracksReports[reportId]?.packetsSent,\n\t\t\t\t\t\t\t\t\t\tprevReportPacketsLost: this.#privateProperties.outgoingTracksReports[reportId]?.packetsLost,\n\t\t\t\t\t\t\t\t\t\tremoteReportPacketsLost: report?.packetsLost,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS.PACKET_LOST_SEND,\n\t\t\t\t\t\t\t\t\tmetricValue: currentPercentPacketLost,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (!packetLostEventAdded && currentPercentPacketLost > this.#privateProperties.packetLostThreshold)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tpacketLostEventAdded = true;\n\t\t\t\t\t\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() => {\n\t\t\t\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.HIGH_PACKET_LOSS_SEND,\n\t\t\t\t\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tprevReport.packetsLostData = packetsLostData;\n\t\t\t\t\t\t\tprevReport.packetsLost = { ...packetsLostData };\n\t\t\t\t\t\t\tprevReport.packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\n\t\t\t\t\t\t\tdelete reportsWithoutRemoteInfo[reportId];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (report.type === 'outbound-rtp')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst reportId = report.id;\n\n\t\t\t\t\t\t\tif (!this.#privateProperties.outgoingTracksReports[reportId])\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#privateProperties.outgoingTracksReports[reportId] = {};\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst prevReport = this.#privateProperties.outgoingTracksReports[reportId];\n\t\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, prevReport, true);\n\n\t\t\t\t\t\t\tthis.#privateProperties.outgoingTracksReports[reportId] = {\n\t\t\t\t\t\t\t\t...prevReport,\n\t\t\t\t\t\t\t\t...report,\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\treport.userId = this.#privateProperties.userId;\n\n\t\t\t\t\t\t\tif (report.kind === 'audio')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Microphone;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (report.kind === 'video')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treport.source = report.contentType === 'screenshare'\n\t\t\t\t\t\t\t\t\t? MediaStreamsKinds.Screen\n\t\t\t\t\t\t\t\t\t: MediaStreamsKinds.Camera;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttotalBitrateOut.push({\n\t\t\t\t\t\t\t\tbitrate: report.bitrate,\n\t\t\t\t\t\t\t\tkind: report.kind,\n\t\t\t\t\t\t\t\tcontentType: report.contentType,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (report.qualityLimitationReason && report.qualityLimitationReason !== 'none' && !isQualityLimitationSent)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() => {\n\t\t\t\t\t\t\t\t\tif (report.qualityLimitationReason === 'cpu')\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.CPU_ISSUES,\n\t\t\t\t\t\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (report.qualityLimitationReason === 'bandwidth')\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.addMonitoringEvents({\n\t\t\t\t\t\t\t\t\t\t\tname: MONITORING_EVENTS_NAME_LIST.NETWORK_ISSUES,\n\t\t\t\t\t\t\t\t\t\t\twithCounter: true,\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tisQualityLimitationSent = true;\n\t\t\t\t\t\t\t\tconst limitations = Object.entries(report.qualityLimitationDurations).reduce(\n\t\t\t\t\t\t\t\t\t(accumulator, value, index) => `${accumulator}${index ? ', ' : ''}${value[0]}: ${value[1]}`,\n\t\t\t\t\t\t\t\t\t'',\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tthis.setLog(`Local user have problems with sending video: ${report.qualityLimitationReason} (${limitations})`, LOG_LEVEL.WARNING);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tUtil.setLocalPacketsLostOrSaveReport(report, remoteReports, reportsWithoutRemoteInfo);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() => {\n\t\t\t\t\t\tconst bitrateSumOut = this.calcBitrateSumFromArray({ bitrateArray: totalBitrateOut });\n\t\t\t\t\t\tconst formattedBitrateOut = Number.parseFloat((bitrateSumOut / 1_000_000).toFixed(2));\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics[MONITORING_METRICS.BITRATE_OUT].length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetric({\n\t\t\t\t\t\t\t\tadditionalData: {\n\t\t\t\t\t\t\t\t\tbitrateList: totalBitrateOut,\n\t\t\t\t\t\t\t\t\tbitrateSumOut,\n\t\t\t\t\t\t\t\t\tformattedBitrateOut,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS.BITRATE_OUT,\n\t\t\t\t\t\t\t\tmetricValue: bitrateSumOut,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tstatsAll.sender = statsOutput;\n\t\t\t\t});\n\n\t\t\t\tawait this.recipient.getStats(null).then((stats) =>\n\t\t\t\t{\n\t\t\t\t\tlet statsOutput = [];\n\t\t\t\t\tconst participantsWithLargeDataLoss = new Map();\n\t\t\t\t\tconst codecs = {};\n\t\t\t\t\tconst reportsWithoutCodecs = {};\n\t\t\t\t\tlet totalBitrateIn = [];\n\t\t\t\t\tlet currentPacketLostReceiveCount = 0;\n\n\t\t\t\t\tconst inboundRtpStatsArray = {\n\t\t\t\t\t\tfreezeCount: [],\n\t\t\t\t\t\ttotalFreezesDuration: [],\n\t\t\t\t\t\tjitter: [],\n\t\t\t\t\t\tframesDecoded: [],\n\t\t\t\t\t\tframesDropped: [],\n\t\t\t\t\t\tframesReceived: [],\n\t\t\t\t\t\tframesLoss: [],\n\t\t\t\t\t};\n\n\t\t\t\t\tstats.forEach((report) =>\n\t\t\t\t\t{\n\n\t\t\t\t\t\tif (report.type === 'inbound-rtp' && report.kind === 'video')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst { freezeCount, totalFreezesDuration, jitter, framesDecoded, framesDropped, framesReceived } = report;\n\n\t\t\t\t\t\t\tinboundRtpStatsArray.jitter.push(jitter);\n\t\t\t\t\t\t\tinboundRtpStatsArray.totalFreezesDuration.push(totalFreezesDuration);\n\t\t\t\t\t\t\tinboundRtpStatsArray.freezeCount.push(freezeCount);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesDecoded.push(framesDecoded);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesDropped.push(framesDropped);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesReceived.push(framesReceived);\n\t\t\t\t\t\t\tinboundRtpStatsArray.framesLoss.push((framesDropped / framesReceived) * 100);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstatsOutput.push(report);\n\n\t\t\t\t\t\tconst needCheckPacketLosts = (report?.trackIdentifier\n\t\t\t\t\t\t\t&& report.hasOwnProperty('packetsLost')\n\t\t\t\t\t\t\t&& report.hasOwnProperty('packetsReceived'));\n\n\t\t\t\t\t\tif (needCheckPacketLosts)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst packetsLostData = Util.calcRemotePacketsLost(report, this.#privateProperties.reportsForIncomingTracks[report.trackIdentifier]);\n\n\t\t\t\t\t\t\treport.packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\n\n\t\t\t\t\t\t\tthis.#privateProperties.reportsForIncomingTracks[report.trackIdentifier] = report;\n\n\t\t\t\t\t\t\tconst realTrackId = this.#privateProperties.realTracksIds[report.trackIdentifier];\n\t\t\t\t\t\t\tconst track = this.#privateProperties.tracksDataFromSocket[realTrackId];\n\t\t\t\t\t\t\tif (track)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst prevReport = track.report || {};\n\t\t\t\t\t\t\t\ttrack.report = report;\n\n\t\t\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, prevReport);\n\t\t\t\t\t\t\t\treport.userId = track.userId;\n\t\t\t\t\t\t\t\treport.source = track.source;\n\n\t\t\t\t\t\t\t\tconst { currentPercentPacketLost } = packetsLostData;\n\n\t\t\t\t\t\t\t\tif (track.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcurrentPacketLostReceiveCount = currentPercentPacketLost;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\ttotalBitrateIn.push({\n\t\t\t\t\t\t\t\t\tbitrate: report.bitrate,\n\t\t\t\t\t\t\t\t\tkind: report.kind,\n\t\t\t\t\t\t\t\t\tcontentType: report.contentType,\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treport.inRemoteTracks = (!!(this.#privateProperties.remoteTracks[track.userId] && this.#privateProperties.remoteTracks[track.userId][realTrackId]) ? 'Y' : 'N');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (packetsLostData.currentPercentPacketLost > this.#privateProperties.packetLostThreshold)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst participant = Object.values(this.#privateProperties.remoteParticipants)\n\t\t\t\t\t\t\t\t\t.find(p => p?.tracks?.[MediaStreamsKinds.Camera]?.track?.id === report.trackIdentifier);\n\t\t\t\t\t\t\t\tif (participant && participant.userId != this.#privateProperties.userId)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tparticipantsWithLargeDataLoss.set(participant.userId, `userId: ${ participant.userId} (${packetsLostData.currentPercentPacketLost}%)`);\n\t\t\t\t\t\t\t\t\tthis.#privateProperties.prevParticipantsWithLargeDataLoss.delete(participant.userId);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (report.type === 'codec')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconst { countVideoTracks, countAudioTracks } = this.getCountRemoteTracks();\n\n\t\t\t\t\t\tconst round = (number, decimal) => Math.round(number * Math.pow(10, decimal)) / Math.pow(10, decimal);\n\n\t\t\t\t\t\tconst addValueInboundRTCStatsToMetrics = ({ key, metricsKey, isSum, decimal = 0, interval }) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics[MONITORING_METRICS[metricsKey]].length >= this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst inboundRtpStatsArraySumByKey = inboundRtpStatsArray[key].reduce((acc, number) => acc + number, 0) / (interval ? (this.#privateProperties.statsTimeout / 1000) : 1);\n\t\t\t\t\t\t\tconst prevInboundRtpStatsArraySumByKey = this.prevInboundRtpStatsSum[key];\n\t\t\t\t\t\t\tconst diffInboundRtpStatsArraySumByKey = prevInboundRtpStatsArraySumByKey && !!isSum ? inboundRtpStatsArraySumByKey - prevInboundRtpStatsArraySumByKey : inboundRtpStatsArraySumByKey;\n\t\t\t\t\t\t\tconst metricValue = !!countVideoTracks ? diffInboundRtpStatsArraySumByKey / countVideoTracks : 0;\n\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetric({\n\t\t\t\t\t\t\t\tadditionalData: {\n\t\t\t\t\t\t\t\t\tinboundRtpStatsArrayByKey: inboundRtpStatsArray[key],\n\t\t\t\t\t\t\t\t\tinboundRtpStatsArraySumByKey,\n\t\t\t\t\t\t\t\t\tprevInboundRtpStatsArraySumByKey: prevInboundRtpStatsArraySumByKey,\n\t\t\t\t\t\t\t\t\tdiffInboundRtpStatsArraySumByKey,\n\t\t\t\t\t\t\t\t\tmetricValue,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetricKey: metricsKey,\n\t\t\t\t\t\t\t\tmetricValue: round(metricValue, decimal),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.prevInboundRtpStatsSum[key] = inboundRtpStatsArraySumByKey;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key: 'jitter', metricsKey: MONITORING_METRICS.JITTER, isSum: false, decimal: 3 });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key: 'freezeCount', metricsKey: MONITORING_METRICS.FREEZE_COUNT, isSum: true, interval: true });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key: 'totalFreezesDuration', metricsKey: MONITORING_METRICS.TOTAL_FREEZE_DURATION, isSum: true, decimal: 3, interval: true });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key:'framesDecoded', metricsKey:MONITORING_METRICS.FRAMES_DECODED, isSum:true, interval: true });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key:'framesReceived', metricsKey:MONITORING_METRICS.FRAMES_RECEIVED, isSum:true, interval: true });\n\t\t\t\t\t\taddValueInboundRTCStatsToMetrics({ key:'framesDropped', metricsKey: MONITORING_METRICS.FRAMES_DROPPED, isSum: true, interval: true });\n\t\t\t\t\t\t// addValueInboundRTCStatsToMetrics({ key: 'framesLoss', metricsKey: 'FRAMES_LOSS', isSum: true });\n\n\t\t\t\t\t\tthis.addValidatedMonitoringMetric({\n\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS.COUNT_VIDEO_TRACKS,\n\t\t\t\t\t\t\tmetricValue: countVideoTracks,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.addValidatedMonitoringMetric({\n\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS.COUNT_AUDIO_TRACKS,\n\t\t\t\t\t\t\tmetricValue: countAudioTracks,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics[MONITORING_METRICS.FRAMES_LOSS].length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst currentFramesReceivedArray = this.currentMonitoringEventsObject.metrics[MONITORING_METRICS.FRAMES_RECEIVED];\n\t\t\t\t\t\t\tconst currentFramesDroppedArray = this.currentMonitoringEventsObject.metrics[MONITORING_METRICS.FRAMES_DROPPED];\n\t\t\t\t\t\t\tconst currentFramesReceived = currentFramesReceivedArray.slice(-1)[0];\n\t\t\t\t\t\t\tconst currentFramesDropped = currentFramesDroppedArray.slice(-1)[0];\n\t\t\t\t\t\t\tconst currentFramesLoss = !!currentFramesReceived ? currentFramesDropped / currentFramesReceived : 0;\n\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetric({\n\t\t\t\t\t\t\t\tadditionalData: {\n\t\t\t\t\t\t\t\t\tcurrentFramesReceivedArray,\n\t\t\t\t\t\t\t\t\tcurrentFramesDroppedArray,\n\t\t\t\t\t\t\t\t\tcurrentFramesReceived,\n\t\t\t\t\t\t\t\t\tcurrentFramesDropped,\n\t\t\t\t\t\t\t\t\tcurrentFramesLoss,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS.FRAMES_LOSS,\n\t\t\t\t\t\t\t\tmetricValue: currentFramesLoss > 0 ? round(currentFramesLoss * 100, 0)  : 0,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst bitrateSumIn = this.calcBitrateSumFromArray({ bitrateArray: totalBitrateIn });\n\t\t\t\t\t\tconst formattedBitrateIn = Number.parseFloat((bitrateSumIn / 1000000).toFixed(2));\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics[MONITORING_METRICS.BITRATE_IN].length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetric({\n\t\t\t\t\t\t\t\tadditionalData: {\n\t\t\t\t\t\t\t\t\tbitrateList: totalBitrateIn,\n\t\t\t\t\t\t\t\t\tbitrateSumIn,\n\t\t\t\t\t\t\t\t\tformattedBitrateIn,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS.BITRATE_IN,\n\t\t\t\t\t\t\t\tmetricValue: bitrateSumIn,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.currentMonitoringEventsObject.metrics[MONITORING_METRICS.PACKET_LOST_RECEIVE].length < this.countMetricsInMetricsInterval)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addValidatedMonitoringMetric({\n\t\t\t\t\t\t\t\tmetricKey: MONITORING_METRICS.PACKET_LOST_RECEIVE,\n\t\t\t\t\t\t\t\tmetricValue: currentPacketLostReceiveCount,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (currentPacketLostReceiveCount > this.#privateProperties.packetLostThreshold)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.addMonitoringEvents({name: MONITORING_EVENTS_NAME_LIST.HIGH_PACKET_LOSS_RECEIVE, withCounter: true} )\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tstatsAll.recipient = statsOutput;\n\t\t\t\t\tif (participantsWithLargeDataLoss.size || this.#privateProperties.prevParticipantsWithLargeDataLoss.size)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (participantsWithLargeDataLoss.size)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.setLog(`Have high packetsLost on users: ${[...participantsWithLargeDataLoss.values()]}`, LOG_LEVEL.WARNING);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.triggerEvents('UpdatePacketLoss', [[...participantsWithLargeDataLoss.keys()]] );\n\t\t\t\t\t}\n\t\t\t\t\tthis.#privateProperties.prevParticipantsWithLargeDataLoss = participantsWithLargeDataLoss;\n\t\t\t\t});\n\n\t\t\t\tthis.triggerEvents('CallStatsReceived', [statsAll]);\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\t// if we're here it's almost okay\n\t\t\t\t// we tried to get stats during reconnection\n\t\t\t}\n\t\t}\n\n\n\t\tgetStatsHandle().finally(() => {\n\t\t\tif (Util.isMetricsEnabled() || Util.isMetricsLogsEnabled())\n\t\t\t{\n\t\t\t\tthis.startAggregateMonitoringEvents();\n\t\t\t}\n\n\t\t\tthis.#privateProperties.callStatsInterval = setInterval( async () => {\n\t\t\t\tawait getStatsHandle()\n\t\t\t}, this.#privateProperties.statsTimeout);\n\t\t});\n\t}\n\n\t#destroyPeerConnection() {\n\t\tif (this.sender) {\n\t\t\tthis.sender.close()\n\t\t\tthis.sender = null\n\t\t}\n\n\t\tif (this.recipient) {\n\t\t\tthis.recipient.close()\n\t\t\tthis.recipient = null\n\t\t}\n\n\t\tthis.#privateProperties.peerConnectionFailed = false;\n\t}\n\n\t#releaseStream(mediaStreamKind): void\n\t{\n\t\tconst streamTypes = {\n\t\t\t[MediaStreamsKinds.Camera]: 'cameraStream',\n\t\t\t[MediaStreamsKinds.Microphone]: 'microphoneStream',\n\t\t\t[MediaStreamsKinds.Screen]: 'screenStream',\n\t\t\t[MediaStreamsKinds.ScreenAudio]: 'screenStream',\n\t\t};\n\n\t\tconst streamType = streamTypes[mediaStreamKind];\n\n\t\tif (streamType)\n\t\t{\n\t\t\tthis.#privateProperties[streamType]?.getTracks?.()?.forEach((track) => {\n\t\t\t\ttrack.onended = null;\n\t\t\t\ttrack.stop();\n\t\t\t});\n\t\t\tthis.#privateProperties[streamType] = null;\n\t\t\tif (this.#privateProperties.needToStopStreams)\n\t\t\t{\n\t\t\t\tCallStreamManager.stopStream(mediaStreamKind);\n\t\t\t}\n\t\t}\n\t}\n\n\t#getSender(kind) {\n\t\tconst senders = this.sender?.getSenders?.();\n\t\tlet sender = null;\n\n\t\tif (senders?.length > 0) {\n\t\t\tfor (const s of senders) {\n\t\t\t\tif (s.track?.source === kind) {\n\t\t\t\t\tsender = s\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn sender;\n\t}\n\n\t#sendSignal(signal)\n\t{\n\t\tif (this.#privateProperties.socketConnect?.readyState === 1)\n\t\t{\n\t\t\tthis.#privateProperties.socketConnect.send(JSON.stringify(signal));\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t#sendLeave()\n\t{\n\t\tthis.checkMetricsFeatureAndExecutionCallback(() =>\n\t\t{\n\t\t\tthis.sendMonitoringEvents(false);\n\t\t});\n\t\tif (this.#privateProperties.socketConnect?.readyState === 1)\n\t\t{\n\t\t\tthis.#sendSignal({\n\t\t\t\tleave:  {\n\t\t\t\t\treason: 'CLIENT_INITIATED',\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t#isNoiseSuppressionInputTrackOff() {\n\t\treturn CallSettingsManager.noiseSuppressionEnabled\n\t\t\t&& Hardware.noiseSuppressionInputStream\n\t\t\t&& Hardware.noiseSuppressionInputStream.getAudioTracks().length > 0\n\t\t\t&& Hardware.noiseSuppressionInputStream.getAudioTracks()[0].readyState !== 'live';\n\t}\n}\n\nclass Participant {\n\t#socketConnect;\n\n\tname = '';\n\timage = '';\n\tuserId = '';\n\tvideoEnabled = false;\n\taudioEnabled = false;\n\tscreenSharingEnabled = false;\n\tisSpeaking = false;\n\ttracks = {};\n\tsid = '';\n\tisMutedVideo = false;\n\tisMutedAudio = false;\n\tisHandRaised = false;\n\tvideoPaused = false;\n\tisLocalVideoMute = false;\n\tstreamRemovingId = '';\n\tcameraStreamQuality: STREAM_QUALITY.MEDIUM;\n\n\tconstructor(participant, socket) {\n\t\tthis.name = participant?.name || '';\n\t\tthis.image = participant?.image || '';\n\t\tthis.userId = participant?.userId || '';\n\t\tthis.sid = participant?.sid || '';\n\t\tthis.videoEnabled = participant?.videoEnabled || false;\n\t\tthis.audioEnabled = participant?.audioEnabled || false;\n\t\tthis.screenSharingEnabled = participant?.screenSharingEnabled || false;\n\t\tthis.isSpeaking = participant?.isSpeaking || false;\n\t\tthis.isHandRaised = participant?.isHandRaised || false;\n\t\tthis.#socketConnect = socket;\n\t}\n\n\tsubscribeTrack(MediaStreamKind) {};\n\n\tunsubscribeTrack(MediaStreamKind) {};\n\n\tattachTrack(MediaStreamKind) {};\n\n\tdetachTrack(MediaStreamKind) {};\n\n\tdisableAudio() {\n\t\tthis.tracks[MediaStreamsKinds.Microphone].track.enabled = false;\n\t\tthis.isMutedAudio = true;\n\t};\n\n\tenableAudio() {\n\t\tthis.tracks[MediaStreamsKinds.Microphone].track.enabled = true;\n\t\tthis.isMutedAudio = false;\n\t};\n\n\tdisableVideo() {\n\t\tthis.tracks[MediaStreamsKinds.Camera].track.enabled = false;\n\t\tthis.isMutedVideo = true;\n\t};\n\n\tenableVideo() {\n\t\tthis.tracks[MediaStreamsKinds.Camera].track.enabled = true;\n\t\tthis.isMutedVideo = false;\n\t};\n\n\taddTrack(MediaStreamKind, Track) {\n\t\tthis.tracks[MediaStreamKind] = Track;\n\t};\n\n\tremoveTrack(MediaStreamKind, Track) {\n\t\tdelete this.tracks[MediaStreamKind];\n\t};\n\n\tgetTrack(MediaStreamKind) {\n\t\treturn this.tracks?.[MediaStreamKind]\n\t}\n\n\tsetStreamQuality(quality) {\n\t\tif (this.cameraStreamQuality === quality || this.videoPaused)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.tracks?.[MediaStreamsKinds.Camera]) {\n\t\t\tthis.cameraStreamQuality = quality;\n\t\t\tconst trackId = this.tracks[MediaStreamsKinds.Camera].id;\n\t\t\tthis.tracks[MediaStreamsKinds.Camera].track.currentVideoQuality = quality;\n\t\t\tconst signal = {\n\t\t\t\ttrackSetting: {\n\t\t\t\t\ttrackSids: [trackId],\n\t\t\t\t\tquality: quality,\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.#socketConnect.send(JSON.stringify(signal));\n\t\t}\n\t}\n}\n","export class Logger\n{\n\tconstructor(serviceUrl, token)\n\t{\n\t\tthis.serviceUrl = serviceUrl;\n\t\tthis.token = token;\n\n\t\tthis.socket = null;\n\t\tthis.attempt = 0;\n\t\tthis.reconnectTimeout = null;\n\t\tthis.unsentMessages = [];\n\n\t\tthis.onSocketOpenHandler = this.onSocketOpen.bind(this);\n\t\tthis.onSocketCloseHandler = this.onSocketClose.bind(this);\n\t\tthis.onSocketErrorHandler = this.onSocketError.bind(this);\n\n\t\tthis.connect();\n\t}\n\n\tget isConnected()\n\t{\n\t\treturn this.socket && this.socket.readyState === 1;\n\t}\n\n\tlog(message)\n\t{\n\t\tif ((typeof message) != 'string')\n\t\t{\n\t\t\tconsole.error(\"Message should be string\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isConnected)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'log',\n\t\t\t\tmessage: message\n\t\t\t}));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.unsentMessages.push(message);\n\t\t}\n\t}\n\n\tsendStat(statRecord)\n\t{\n\t\tif ((typeof statRecord) == 'object')\n\t\t{\n\t\t\tstatRecord = JSON.stringify(statRecord)\n\t\t}\n\n\t\tif (this.isConnected)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'stat',\n\t\t\t\tmessage: statRecord\n\t\t\t}));\n\t\t}\n\t}\n\n\tconnect()\n\t{\n\t\tif (this.socket)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.serviceUrl)\n\t\t{\n\t\t\tconsole.error('Logging service url is empty');\n\t\t\treturn;\n\t\t}\n\t\tif (!this.serviceUrl.startsWith('ws://') && !this.serviceUrl.startsWith('wss://'))\n\t\t{\n\t\t\tconsole.error('Logging service url should start with ws:// or wss://');\n\t\t\treturn;\n\t\t}\n\t\tif (!this.token)\n\t\t{\n\t\t\tconsole.error('Logging token is empty');\n\t\t\treturn;\n\t\t}\n\n\t\tthis.attempt++;\n\t\tthis.socket = new WebSocket(this.serviceUrl + '?token=' + this.token);\n\n\t\tthis.bindSocketEvents();\n\t}\n\n\tscheduleReconnect()\n\t{\n\t\tclearTimeout(this.reconnectTimeout);\n\n\t\tif (this.attempt > 3)\n\t\t{\n\t\t\tconsole.error(\"Could not connect to the logging service, giving up\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reconnectTimeout = setTimeout(this.connect.bind(this), this.getConnectionDelay(this.attempt) * 1000);\n\t}\n\n\tgetConnectionDelay(attempt)\n\t{\n\t\tswitch (attempt)\n\t\t{\n\t\t\tcase 0:\n\t\t\tcase 1:\n\t\t\t\treturn 15;\n\t\t\tcase 2:\n\t\t\t\treturn 30;\n\t\t\tdefault:\n\t\t\t\treturn 60;\n\t\t}\n\t}\n\n\tdisconnect()\n\t{\n\t\tclearTimeout(this.reconnectTimeout);\n\t\tif (this.socket)\n\t\t{\n\t\t\tthis.removeSocketEvents();\n\t\t\tthis.socket.close(1000);\n\t\t\tthis.socket = null;\n\t\t}\n\t}\n\n\tbindSocketEvents()\n\t{\n\t\tthis.socket.addEventListener('open', this.onSocketOpenHandler);\n\t\tthis.socket.addEventListener('close', this.onSocketCloseHandler);\n\t\tthis.socket.addEventListener('error', this.onSocketErrorHandler);\n\t}\n\n\tremoveSocketEvents()\n\t{\n\t\tthis.socket.removeEventListener('open', this.onSocketOpenHandler);\n\t\tthis.socket.removeEventListener('close', this.onSocketCloseHandler);\n\t\tthis.socket.removeEventListener('error', this.onSocketErrorHandler);\n\t}\n\n\tonSocketOpen()\n\t{\n\t\tthis.attempt = 0;\n\t\tfor (let i = 0; i < this.unsentMessages.length; i++)\n\t\t{\n\t\t\tthis.socket.send(JSON.stringify({\n\t\t\t\taction: 'log',\n\t\t\t\tmessage: this.unsentMessages[i]\n\t\t\t}));\n\t\t}\n\t\tthis.unsentMessages = [];\n\t}\n\n\tonSocketClose()\n\t{\n\t\tthis.socket = null;\n\t\tthis.scheduleReconnect();\n\t}\n\n\tonSocketError()\n\t{\n\t\tthis.socket = null;\n\t\tthis.scheduleReconnect();\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.disconnect();\n\t\tthis.unsentMessages = null;\n\t}\n}","import { Extension } from 'main.core';\n\nexport type CallCloudRecordOptions = {\n\tserviceEnabled?: boolean;\n\ttariffAvailable?: boolean;\n\tisCisRegion?: boolean;\n\ttariffSlider?: boolean;\n};\n\nexport const CallCommonRecordState = {\n\tStarted: 'started',\n\tResumed: 'resumed',\n\tPaused: 'paused',\n\tStopped: 'stopped',\n\tDestroyed: 'destroyed',\n};\n\nexport const CallCommonRecordType = {\n\tNone: 'none',\n\tVideo: 'video',\n\tAudio: 'audio',\n};\n\nclass CallCloudRecordClass\n{\n\tconstructor()\n\t{\n\t\tthis.serviceEnabled = false;\n\t\tthis.tariffAvailable = false;\n\t\tthis.isCisRegion = false;\n\t\tthis.tariffSlider = false;\n\n\t\tif (Extension.getSettings('call.core').cloudRecord)\n\t\t{\n\t\t\tthis.setup(Extension.getSettings('call.core').cloudRecord);\n\t\t}\n\t}\n\n\tsetup(options: CallCloudRecordOptions)\n\t{\n\t\tconst { serviceEnabled, tariffAvailable, isCisRegion, tariffSlider } = options;\n\n\t\tif (serviceEnabled !== undefined)\n\t\t{\n\t\t\tthis.serviceEnabled = serviceEnabled;\n\t\t}\n\n\t\tif (tariffAvailable !== undefined)\n\t\t{\n\t\t\tthis.tariffAvailable = tariffAvailable;\n\t\t}\n\n\t\tif (isCisRegion !== undefined)\n\t\t{\n\t\t\tthis.isCisRegion = isCisRegion;\n\t\t}\n\n\t\tif (tariffSlider !== undefined)\n\t\t{\n\t\t\tthis.tariffSlider = tariffSlider;\n\t\t}\n\t}\n}\n\nexport const CallCloudRecord = new CallCloudRecordClass();\n","import {Type} from 'main.core'\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport {Logger} from './logger'\nimport {CallType, CallEvent, CallState, CallEngine, Provider} from './engine'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\nimport { CallCommonRecordState, CallCommonRecordType } from '../call_common_record';\n\n/**\n * Abstract call class\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onJoin\n * - onLeave\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onCallFailure\n * - onDestroy\n */\nexport class AbstractCall\n{\n\tlogger: ?Logger\n\tlocalStreams: {[key: string]: ?MediaStream}\n\n\tconstructor(params)\n\t{\n\t\tthis.id = params.id;\n\t\tthis.uuid = params.uuid;\n\t\tthis.instanceId = params.instanceId;\n\t\tthis.parentId = params.parentId || null;\n\t\tthis.parentUuid = params.parentUuid || null;\n\t\tthis.direction = params.direction;\n\t\tthis.scheme = params.scheme;\n\t\tthis.type = BX.prop.getInteger(params, \"type\", CallType.Instant); // @see {BX.Call.Type}\n\t\tthis.state = BX.prop.getString(params, \"state\", CallState.Idle);\n\n\t\tthis.ready = false;\n\t\tthis.userId = CallEngine.getCurrentUserId();\n\t\tthis.userData = Type.isPlainObject(params.userData) ? params.userData : {};\n\n\t\tthis.initiatorId = params.initiatorId || '';\n\t\tthis.users = Type.isArray(params.users) ? params.users.filter(userId => userId != this.userId) : [];\n\n\t\tthis.associatedEntity = Type.isPlainObject(params.associatedEntity) ? params.associatedEntity : {};\n\t\tthis.startDate = new Date(BX.prop.getString(params, \"startDate\", \"\"));\n\n\t\t// media constraints\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.videoHd = params.videoHd === true;\n\t\tthis.cameraId = params.cameraId || '';\n\t\tthis.microphoneId = params.microphoneId || '';\n\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\n\t\tthis.wasConnected = false;\n\n\t\tthis.logToken = params.logToken || '';\n\t\tif (CallEngine.getLogService() && this.logToken)\n\t\t{\n\t\t\tthis.logger = new Logger(CallEngine.getLogService(), this.logToken);\n\t\t}\n\n\t\tthis.localStreams = {\n\t\t\tmain: null,\n\t\t\tscreen: null\n\t\t};\n\n\t\tthis.eventListeners = {};\n\n\t\tif (Type.isPlainObject(params.events))\n\t\t{\n\t\t\tthis.initEventListeners(params.events);\n\t\t}\n\n\t\tthis.connectionData = params.connectionData || {};\n\n\t\tthis._microphoneLevel = 0;\n\n\t\tthis.commonRecordState = {\n\t\t\tstate: CallCommonRecordState.Stopped,\n\t\t\ttype: CallCommonRecordType.None,\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: [],\n\t\t\t},\n\t\t};\n\t};\n\n\tget provider()\n\t{\n\t\tthrow new Error(\"must be overwritten\")\n\t}\n\n\tget microphoneLevel()\n\t{\n\t\treturn this._microphoneLevel\n\t}\n\n\tset microphoneLevel(level)\n\t{\n\t\tif (level != this._microphoneLevel)\n\t\t{\n\t\t\tthis._microphoneLevel = level;\n\t\t\tthis.runCallback(CallEvent.onMicrophoneLevel, {\n\t\t\t\tlevel: level\n\t\t\t});\n\t\t}\n\t}\n\n\taddDialogInfo(dialogInfo)\n\t{\n\t\tthis.associatedEntity = Type.isPlainObject(dialogInfo) ? dialogInfo : {};\n\t}\n\n\tinitEventListeners(eventListeners)\n\t{\n\t\tfor (var eventName in eventListeners)\n\t\t{\n\t\t\tthis.addEventListener(eventName, eventListeners[eventName]);\n\t\t}\n\t};\n\n\taddEventListener(eventName, listener)\n\t{\n\t\tif (!Type.isArray(this.eventListeners[eventName]))\n\t\t{\n\t\t\tthis.eventListeners[eventName] = [];\n\t\t}\n\n\t\tif (Type.isArray(this.eventListeners[eventName]) && this.eventListeners[eventName].includes(listener))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isFunction(listener))\n\t\t{\n\t\t\tthis.eventListeners[eventName].push(listener);\n\t\t}\n\t};\n\n\tremoveEventListener(eventName, listener)\n\t{\n\t\tif (Type.isArray(this.eventListeners[eventName]) && this.eventListeners[eventName].indexOf(listener) >= 0)\n\t\t{\n\t\t\tvar listenerIndex = this.eventListeners[eventName].indexOf(listener);\n\t\t\tif (listenerIndex >= 0)\n\t\t\t{\n\t\t\t\tthis.eventListeners[eventName].splice(listenerIndex, 1);\n\t\t\t}\n\t\t}\n\t};\n\n\trunCallback(eventName, eventFields)\n\t{\n\t\t//console.log(eventName, eventFields);\n\t\tif (Type.isArray(this.eventListeners[eventName]) && this.eventListeners[eventName].length > 0)\n\t\t{\n\t\t\tif (eventName === null || typeof (eventFields) !== \"object\")\n\t\t\t{\n\t\t\t\teventFields = {};\n\t\t\t}\n\t\t\teventFields.call = this;\n\t\t\tfor (let i = 0; i < this.eventListeners[eventName].length; i++)\n\t\t\t{\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tthis.eventListeners[eventName][i].call(this, eventFields);\n\t\t\t\t} catch (err)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(eventName + \" callback error: \", err);\n\t\t\t\t\tthis.log(eventName + \" callback error: \", err);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tgetLocalStream(tag)\n\t{\n\t\treturn this.localStreams[tag];\n\t};\n\n\tsetLocalStream(mediaStream, tag)\n\t{\n\t\ttag = tag || \"main\";\n\n\t\tthis.localStreams[tag] = mediaStream;\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tthrow new Error(\"isAnyoneParticipating should be implemented\");\n\t};\n\n\t__onPullEvent(command, params)\n\t{\n\t\tthrow new Error(\"__onPullEvent should be implemented\");\n\t};\n\n\tinviteUsers()\n\t{\n\t\tthrow new Error(\"inviteUsers is not implemented\");\n\t};\n\n\tcancel()\n\t{\n\t\tthrow new Error(\"cancel is not implemented\");\n\t};\n\n\tanswer()\n\t{\n\t\tthrow new Error(\"answer is not implemented\");\n\t};\n\n\tdecline(code, reason)\n\t{\n\t\tthrow new Error(\"decline is not implemented\");\n\t};\n\n\thangup()\n\t{\n\t\tthrow new Error(\"hangup is not implemented\");\n\t};\n\n\tlog()\n\t{\n\t\tlet text = Util.getLogMessage.apply(null, arguments);\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.writeToLogFile(BX.message('USER_ID') + '.video.log', text.substr(3));\n\t\t}\n\t\tif (CallEngine.debugFlag && console)\n\t\t{\n\t\t\tlet a = ['Call log [' + Util.getTimeForLog() + ']: '];\n\t\t\tconsole.log.apply(this, a.concat(Array.prototype.slice.call(arguments)));\n\t\t}\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.log(text);\n\t\t}\n\n\t\tif (BX.MessengerDebug)\n\t\t{\n\t\t\tBX.MessengerDebug.addLog(this.id, text);\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.destroy();\n\t\t\tthis.logger = null;\n\t\t}\n\n\t\tthis.state = CallState.Finished;\n\t\tthis.runCallback(CallEvent.onDestroy);\n\t}\n\n\tupdateCommonRecordState({ action, type, senderId, date })\n\t{\n\t\tconst { state, userId } = this.commonRecordState;\n\n\t\tif (action !== CallCommonRecordState.Started && userId !== senderId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase CallCommonRecordState.Started:\n\t\t\t{\n\t\t\t\tif (!Util.isCommonRecordStateInactive(state))\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tObject.assign(this.commonRecordState, {\n\t\t\t\t\tstate: CallCommonRecordState.Started,\n\t\t\t\t\ttype,\n\t\t\t\t\tuserId: senderId,\n\t\t\t\t\tdate: { start: date, pause: [] },\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase CallCommonRecordState.Paused:\n\t\t\t{\n\t\t\t\tif (state !== CallCommonRecordState.Started)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.commonRecordState.state = CallCommonRecordState.Paused;\n\t\t\t\tthis.commonRecordState.date.pause.push({ start: date, finish: null });\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase CallCommonRecordState.Resumed:\n\t\t\t{\n\t\t\t\tif (state !== CallCommonRecordState.Paused)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tthis.commonRecordState.state = CallCommonRecordState.Started;\n\n\t\t\t\tconst lastPause = [...this.commonRecordState.date.pause].reverse().find((item) => item.finish === null);\n\n\t\t\t\tif (lastPause)\n\t\t\t\t{\n\t\t\t\t\tlastPause.finish = date;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase CallCommonRecordState.Stopped:\n\t\t\t{\n\t\t\t\tObject.assign(this.commonRecordState, {\n\t\t\t\t\tstate: CallCommonRecordState.Stopped,\n\t\t\t\t\ttype: CallCommonRecordType.None,\n\t\t\t\t\tuserId: 0,\n\t\t\t\t\tdate: { start: null, pause: [] },\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n}\n","import Util from '../util';\n\nexport function logPlaybackError(error)\n{\n\tconsole.error(\"Playback start error: \", error);\n\t\n\tUtil.sendLog({\n\t\tdescription: 'Playback start error',\n\t\terror: error,\n\t});\n}\n\nexport function checkAndEncodeURI(uri)\n{\n\treturn decodeURI(uri) === uri ? encodeURI(uri) : uri;\n}","import {Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {EndpointDirection, UserState} from '../engine/engine';\nimport { checkAndEncodeURI } from './tools';\n\ntype UserModelMap = Record<string, UserModel>;\n\nexport class UserModel\n{\n\tid: number\n\tname: string\n\tavatar: string\n\tgender: string\n\tstate: string\n\ttalking: boolean\n\tcameraState: boolean\n\tprevCameraState: boolean\n\tmicrophoneState: boolean\n\tscreenState: boolean\n\tvideoPaused: boolean\n\tfloorRequestState: boolean\n\tpermissionToSpeak: boolean\n\tlocalUser: boolean\n\tcentralUser: boolean\n\tpinned: boolean\n\tpresenter: boolean\n\torder: number\n\tprevOrder: number\n\tallowRename: boolean\n\twasRenamed: boolean\n\trenameRequested: boolean\n\tdirection: string\n\n\tconstructor(config)\n\t{\n\t\tthis.data = {\n\t\t\tid: BX.prop.getInteger(config, \"id\", 0),\n\t\t\tname: BX.prop.getString(config, \"name\", \"\"),\n\t\t\tavatar: checkAndEncodeURI(BX.prop.getString(config, \"avatar\", \"\")),\n\t\t\tgender: BX.prop.getString(config, \"gender\", \"\"),\n\t\t\tstate: BX.prop.getString(config, \"state\", UserState.Idle),\n\t\t\ttalking: BX.prop.getBoolean(config, \"talking\", false),\n\t\t\tcameraState: BX.prop.getBoolean(config, \"cameraState\", true),\n\t\t\tprevCameraState: BX.prop.getBoolean(config, \"cameraState\", true),\n\t\t\tmicrophoneState: BX.prop.getBoolean(config, \"microphoneState\", true),\n\t\t\tscreenState: BX.prop.getBoolean(config, \"screenState\", false),\n\t\t\tvideoPaused: BX.prop.getBoolean(config, \"videoPaused\", false),\n\t\t\tfloorRequestState: BX.prop.getBoolean(config, \"floorRequestState\", false),\n\t\t\tpermissionToSpeak: BX.prop.getBoolean(config, \"permissionToSpeak\", false),\n\t\t\tlocalUser: BX.prop.getBoolean(config, \"localUser\", false),\n\t\t\tcentralUser: BX.prop.getBoolean(config, \"centralUser\", false),\n\t\t\tpinned: BX.prop.getBoolean(config, \"pinned\", false),\n\t\t\tpresenter: BX.prop.getBoolean(config, \"presenter\", false),\n\t\t\torder: BX.prop.getInteger(config, \"order\", false),\n\t\t\tprevOrder: BX.prop.getInteger(config, \"prevOrder\", false),\n\t\t\tallowRename: BX.prop.getBoolean(config, \"allowRename\", false),\n\t\t\twasRenamed: BX.prop.getBoolean(config, \"wasRenamed\", false),\n\t\t\trenameRequested: BX.prop.getBoolean(config, \"renameRequested\", false),\n\t\t\tdirection: BX.prop.getString(config, \"direction\", EndpointDirection.SendRecv),\n\t\t};\n\n\t\tfor (let fieldName in this.data)\n\t\t{\n\t\t\tif (this.data.hasOwnProperty(fieldName))\n\t\t\t{\n\t\t\t\tObject.defineProperty(this, fieldName, {\n\t\t\t\t\tget: this._getField(fieldName).bind(this),\n\t\t\t\t\tset: this._setField(fieldName).bind(this),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.onUpdate = {\n\t\t\ttalking: this._onUpdateTalking.bind(this),\n\t\t\tstate: this._onUpdateState.bind(this),\n\t\t};\n\n\t\tthis.talkingStop = null;\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'UserModel');\n\t};\n\n\t_getField(fieldName)\n\t{\n\t\treturn function ()\n\t\t{\n\t\t\treturn this.data[fieldName];\n\t\t}\n\t};\n\n\t_setField(fieldName)\n\t{\n\t\treturn function (newValue)\n\t\t{\n\t\t\tvar oldValue = this.data[fieldName];\n\t\t\tif (oldValue == newValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.data[fieldName] = newValue;\n\n\t\t\tif (this.onUpdate.hasOwnProperty(fieldName))\n\t\t\t{\n\t\t\t\tthis.onUpdate[fieldName](newValue, oldValue);\n\t\t\t}\n\n\t\t\tthis.eventEmitter.emit(\"changed\", {\n\t\t\t\tuser: this,\n\t\t\t\tfieldName: fieldName,\n\t\t\t\toldValue: oldValue,\n\t\t\t\tnewValue: newValue,\n\t\t\t});\n\t\t}\n\t};\n\n\t_onUpdateTalking(talking)\n\t{\n\t\tif (!talking)\n\t\t{\n\t\t\tthis.talkingStop = (new Date()).getTime();\n\t\t}\n\t};\n\n\t_onUpdateState(newValue)\n\t{\n\t\tif (newValue != UserState.Connected)\n\t\t{\n\t\t\tthis.talking = false;\n\t\t\tthis.screenState = false;\n\t\t}\n\t};\n\n\twasTalkingAgo()\n\t{\n\t\tif (this.state != UserState.Connected)\n\t\t{\n\t\t\treturn +Infinity;\n\t\t}\n\t\tif (this.talking)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\tif (!this.talkingStop)\n\t\t{\n\t\t\treturn +Infinity;\n\t\t}\n\n\t\treturn ((new Date()).getTime() - this.talkingStop);\n\t};\n\n\tsubscribe(event, handler)\n\t{\n\t\tthis.eventEmitter.subscribe(event, handler);\n\t};\n\n\tunsubscribe(event, handler)\n\t{\n\t\tthis.eventEmitter.unsubscribe(event, handler);\n\t};\n}\n\nexport class UserRegistry extends EventEmitter\n{\n\tusers: UserModelMap;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.UserRegistry');\n\t\tthis.users = new Map();\n\t};\n\n\t/**\n\t *\n\t * @param {int} userId\n\t * @returns {UserModel|null}\n\t */\n\tget(userId): ?UserModel\n\t{\n\t\treturn this.users.get(Number(userId)) || null;\n\t};\n\n\tpush(user: UserModel)\n\t{\n\t\tif (!(user instanceof UserModel))\n\t\t{\n\t\t\tthrow Error(\"user should be instance of UserModel\")\n\t\t}\n\n\t\tthis.users.set(Number(user.id), user);\n\n\t\tuser.subscribe(\"changed\", this._onUserChanged.bind(this));\n\t\tthis.emit(\"userAdded\", {\n\t\t\tuser: user\n\t\t});\n\t};\n\n\t_onUserChanged(event)\n\t{\n\t\tif (event.data.fieldName === 'order')\n\t\t{\n\t\t\tthis._sort();\n\t\t}\n\t\tthis.emit(\"userChanged\", event.data)\n\t};\n\n\t_sort()\n\t{\n\t\tthis.users = new Map([...this.users].sort((a, b) => a[1].order - b[1].order));\n\t}\n}","import {Dom, Type} from 'main.core'\n\nexport function createSVG(elementName, config)\n{\n\tlet element = document.createElementNS('http://www.w3.org/2000/svg', elementName);\n\n\tif (\"attrNS\" in config && Type.isObject(config.attrNS))\n\t{\n\t\tfor (let key in config.attrNS)\n\t\t{\n\t\t\tif (config.attrNS.hasOwnProperty(key))\n\t\t\t{\n\t\t\t\telement.setAttributeNS(null, key, config.attrNS[key]);\n\t\t\t}\n\t\t}\n\t}\n\n\tDom.adjust(element, config);\n\treturn element;\n}","import { Dom, Text, Type } from 'main.core';\n\nimport Util from '../util';\nimport { createSVG } from './svg';\nimport { CallCommonRecordState } from '../call_common_record';\n\n\n\nconst createCssTooltip = (options = {}) => {\n\tconst {\n\t\twidth: tooltipWidth = 'max-content',\n\t\tposition: tooltipPosition = 'top',\n\t\tgetText: getTooltipText = () => ''\n\t} = options;\n\n\tconst hasTooltip = Boolean(Object.keys(options).length);\n\tconst tooltipText = getTooltipText();\n\tconst tooltipPositionClass = tooltipPosition === 'bottom' ? '-bottom' : '-top';\n\tconst tooltipClass = `bx-videocall-tooltip ${tooltipPositionClass}`;\n\tconst tooltipTextVarName = '--data-tooltip-text';\n\n\treturn {\n\t\thasTooltip,\n\t\ttooltipClass: hasTooltip ? tooltipClass : '',\n\t\ttooltipText,\n\t\ttooltipStyle: `--data-tooltip-width:${tooltipWidth}; ${tooltipTextVarName}:'${tooltipText}'`,\n\t\tgetTooltipText,\n\t\ttooltipTextVarName,\n\t}\n}\nexport class TitleButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.elements = {\n\t\t\troot: null\n\t\t};\n\n\t\tthis.text = Type.isStringFilled(config.text) ? config.text : '';\n\t\tthis.isGroupCall = config.isGroupCall;\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-title\"},\n\t\t\thtml: this.getTitle()\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tgetTitle()\n\t{\n\t\tconst prettyName = '<span class=\"bx-messenger-videocall-panel-title-name\">' + Text.encode(this.text) + '</span>';\n\n\t\tif (this.isGroupCall)\n\t\t{\n\t\t\treturn BX.message(\"IM_M_GROUP_CALL_WITH\").replace(\"#CHAT_NAME#\", prettyName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn BX.message(\"IM_M_CALL_WITH\").replace(\"#USER_NAME#\", prettyName);\n\t\t}\n\t};\n\n\tupdate(config)\n\t{\n\t\tthis.text = Type.isStringFilled(config.text) ? config.text : '';\n\t\tthis.isGroupCall = config.isGroupCall;\n\t\tthis.elements.root.innerHTML = this.getTitle();\n\t}\n}\n\nexport class SimpleButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.class = config.class;\n\t\tthis.backgroundClass = BX.prop.getString(config, \"backgroundClass\", \"\");\n\t\tthis.backgroundClass = \"bx-messenger-videocall-panel-icon-background\" + (this.backgroundClass ? \" \" : \"\") + this.backgroundClass;\n\t\tthis.blocked = config.blocked === true;\n\n\t\tthis.tooltip = createCssTooltip(BX.prop.getObject(config, 'tooltip', {}));\n\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\t\tthis.isActive = false;\n\t\tthis.counter = BX.prop.getInteger(config, \"counter\", 0);\n\t\tthis.isComingSoon = config.isComingSoon || false;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tcounter: null,\n\t\t\tcomingSoon: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tlet textNode;\n\t\tif (this.text !== '')\n\t\t{\n\t\t\ttextNode = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-text' },\n\t\t\t\ttext: this.text,\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-text-content' },\n\t\t\t\t\t\ttext: this.text,\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttextNode = null;\n\t\t}\n\n\t\tconst {\n\t\t\ttooltipClass, tooltipStyle,\n\t\t} = this.tooltip;\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: `bx-messenger-videocall-panel-item ${tooltipClass}${\n\t\t\t\t\tthis.blocked ? ' blocked' : ''}${\n\t\t\t\t\tthis.isComingSoon ? ' coming-soon' : ''}`,\n\t\t\t},\n\t\t\tattrs: {\n\t\t\t\tstyle: tooltipStyle,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: this.backgroundClass },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: `bx-messenger-videocall-panel-icon bx-messenger-videocall-panel-icon-${\n\t\t\t\t\t\t\t\t\tthis.class}`,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.counter = Dom.create('span', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-item-counter' },\n\t\t\t\t\t\t\ttext: 0,\n\t\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\t\tcounter: 0,\n\t\t\t\t\t\t\t\tcounterType: 'digits',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.comingSoon = Dom.create('span', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-item-coming-soon' },\n\t\t\t\t\t\t\ttext: BX.message('CALL_FEATURES_COMING_SOON_MSGVER_1'),\n\t\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\t\tvisible: this.isComingSoon ? 'Y' : 'N',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\ttextNode,\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t},\n\t\t});\n\n\t\tif (this.isActive)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"active\");\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tsetActive(isActive)\n\t{\n\t\tif (this.isActive == isActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.isActive = isActive;\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.isActive)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"active\");\n\t\t}\n\n\t\tconst {\n\t\t\thasTooltip, getTooltipText, tooltipTextVarName,\n\t\t} = this.tooltip;\n\n\t\thasTooltip && this.elements.root.style.setProperty(tooltipTextVarName, `'${getTooltipText()}'`);\n\n\t};\n\n\tsetBlocked(isBlocked)\n\t{\n\t\tif (this.blocked == isBlocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.blocked = isBlocked;\n\t\tif (this.blocked)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"blocked\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"blocked\");\n\t\t}\n\t};\n\n\tsetCounter(counter)\n\t{\n\t\tthis.counter = parseInt(counter, 10);\n\n\t\tif (Number.isNaN(this.counter))\n\t\t{\n\t\t\tthis.counter = 0;\n\t\t\tthis.elements.counter.dataset.counter = 0;\n\t\t\tthis.elements.counter.dataset.counterType = 'digits';\n\t\t\tthis.elements.counter.innerText = 0;\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet counterLabel = this.counter;\n\t\tconst counterData = counterLabel;\n\n\t\tif (counterLabel > 99)\n\t\t{\n\t\t\tcounterLabel = '99+';\n\t\t}\n\n\t\tlet counterType = 'digits';\n\t\tif (counterLabel.toString().length === 2)\n\t\t{\n\t\t\tcounterType = 'dozens';\n\t\t}\n\t\telse if (counterLabel.toString().length > 2)\n\t\t{\n\t\t\tcounterType = 'hundreds';\n\t\t}\n\n\t\tthis.elements.counter.dataset.counter = counterData;\n\t\tthis.elements.counter.dataset.counterType = counterType;\n\t\tthis.elements.counter.innerText = counterLabel;\n\t};\n\n\tsetIsComingSoon(isActive)\n\t{\n\t\tthis.isComingSoon = isActive;\n\n\t\tthis.isComingSoon\n\t\t\t? this.elements.comingSoon.dataset.visible = 'Y'\n\t\t\t: this.elements.comingSoon.dataset.visible = 'N';\n\n\t\tif (this.isComingSoon)\n\t\t{\n\t\t\tthis.elements.root?.classList.add('coming-soon');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root?.classList.remove('coming-soon');\n\t\t}\n\t}\n}\n\nexport class DeviceButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.class = config.class;\n\t\tthis.text = config.text;\n\n\t\tthis.enabled = (config.enabled === true);\n\t\tthis.arrowEnabled = (config.arrowEnabled === true);\n\t\tthis.arrowHidden = (config.arrowHidden === true);\n\t\tthis.blocked = (config.blocked === true);\n\n\t\tthis.tooltip = createCssTooltip(BX.prop.getObject(config, 'tooltip', {}));\n\n\t\tthis.backgroundClass = BX.prop.getString(config, \"backgroundClass\", \"\");\n\n\t\tthis.showLevel = (config.showLevel === true);\n\t\tthis.level = config.level || 0;\n\n\t\tthis.sideIcon = BX.prop.getString(config, \"sideIcon\", \"\");\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticonContainer: null,\n\t\t\ticon: null,\n\t\t\tarrow: null,\n\t\t\tlevelMeter: null,\n\t\t\tpointer: null,\n\t\t\tellipsis: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tonArrowClick: BX.prop.getFunction(config, \"onArrowClick\", BX.DoNothing),\n\t\t\tonSideIconClick: BX.prop.getFunction(config, \"onSideIconClick\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tconst {\n\t\t\ttooltipClass, tooltipStyle,\n\t\t} = this.tooltip;\n\n\t\tthis.elements.arrow = Dom.create('div', {\n\t\t\tprops: { className: 'bx-messenger-videocall-panel-item-with-arrow-right' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-item-with-arrow-right-icon' },\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.arrow?.classList.add('rotate');\n\t\t\t\t\tthis.callbacks.onArrowClick.apply(this, arguments);\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t}.bind(this),\n\t\t\t},\n\t\t});\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tid: `bx-messenger-videocall-panel-item-with-arrow-${\n\t\t\t\t\tthis.class}`,\n\t\t\t\tclassName: `bx-messenger-videocall-panel-item-with-arrow ${tooltipClass}${\n\t\t\t\t\tthis.blocked ? ' blocked' : ''}`,\n\t\t\t},\n\t\t\tattrs: {\n\t\t\t\tstyle: tooltipStyle,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-item-with-arrow-left' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.iconContainer = Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: this.getIconContainerClass() },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.icon = Dom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: this.getIconClass() },\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t...(this.arrowHidden ? [] : [this.elements.arrow]),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-text' },\n\t\t\t\t\ttext: this.text,\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-text-content' },\n\t\t\t\t\t\t\ttext: this.text,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t},\n\t\t});\n\n\t\tif (this.showLevel)\n\t\t{\n\t\t\tthis.elements.icon.appendChild(createSVG(\"svg\", {\n\t\t\t\tattrNS: {\n\t\t\t\t\tclass: \"bx-messenger-videocall-panel-item-level-meter-container\",\n\t\t\t\t\twidth: \"28\",\n\t\t\t\t\theight: \"28\",\n\t\t\t\t\tviewBox: \"0 0 28 28\",\n\t\t\t\t\tfill: \"none\",\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tcreateSVG(\"defs\", {\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tcreateSVG(\"linearGradient\", {\n\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\tid: \"volumeGradient\",\n\t\t\t\t\t\t\t\t\tx1: \"0%\",\n\t\t\t\t\t\t\t\t\ty1: \"100%\",\n\t\t\t\t\t\t\t\t\tx2: \"0%\",\n\t\t\t\t\t\t\t\t\ty2: \"0%\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tthis.elements.gradientStop1 = createSVG(\"stop\", {\n\t\t\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\t\t\toffset: \"0\",\n\t\t\t\t\t\t\t\t\t\t\tid: \"gradientStop1\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tthis.elements.gradientStop2 = createSVG(\"stop\", {\n\t\t\t\t\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\t\t\t\toffset: \"0\",\n\t\t\t\t\t\t\t\t\t\t\t\"stop-color\": \"transparent\",\n\t\t\t\t\t\t\t\t\t\t\tid: \"gradientStop2\"\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t]\n\t\t\t\t\t}),\n\t\t\t\t\tcreateSVG(\"path\", {\n\t\t\t\t\t\tattrNS: {\n\t\t\t\t\t\t\t\"fill-rule\": \"evenodd\",\n\t\t\t\t\t\t\t\"clip-rule\": \"evenodd\",\n\t\t\t\t\t\t\td: 'M7.01843 12.8394C7.46936 12.8492 7.82709 13.2234 7.81726 13.6743C7.76065 16.2837 9.9066 19.8267 13.9882 19.8267C18.0865 19.8265 20.3038 16.2334 20.1805 13.6987C20.1586 13.2483 20.5056 12.8654 20.9559 12.8433C21.4064 12.8213 21.7894 13.1682 21.8114 13.6187C21.9638 16.7444 19.4696 20.9702 14.8124 21.4204V23.1763H16.7714C17.2222 23.1765 17.5878 23.5427 17.5878 23.9937C17.5875 24.4443 17.2221 24.8099 16.7714 24.8101H11.2206C10.7699 24.8098 10.4044 24.4443 10.4042 23.9937C10.4042 23.5428 10.7698 23.1765 11.2206 23.1763H13.1796V21.4224C8.50848 20.9829 6.11622 16.768 6.18445 13.6382C6.1943 13.1874 6.56769 12.8297 7.01843 12.8394ZM13.9921 3.30518C16.1622 3.30518 17.9218 5.06469 17.9218 7.23486V13.5396C17.9218 15.7097 16.1622 17.4692 13.9921 17.4692C11.8221 17.469 10.0634 15.7096 10.0634 13.5396V7.23486C10.0634 5.06481 11.8221 3.30537 13.9921 3.30518ZM13.9921 4.93896C12.7241 4.93916 11.6962 5.96687 11.6962 7.23486V13.5396C11.6962 14.8075 12.7241 15.8353 13.9921 15.8354C15.2602 15.8354 16.2889 14.8077 16.2889 13.5396V7.23486C16.2889 5.96676 15.2602 4.93896 13.9921 4.93896Z',\n\t\t\t\t\t\t\tfill: \"url(#volumeGradient)\"\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t]\n\t\t\t}));\n\t\t}\n\n\t\tthis.elements.ellipsis = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-icon-ellipsis\"},\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onSideIconClick\n\t\t\t}\n\t\t})\n\n\t\tthis.elements.pointer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-panel-icon-pointer\"},\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onSideIconClick\n\t\t\t}\n\t\t})\n\n\t\tif (this.sideIcon == \"pointer\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.pointer, this.elements.icon);\n\t\t}\n\t\telse if (this.sideIcon == \"ellipsis\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.ellipsis, this.elements.icon);\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tgetIconClass()\n\t{\n\t\treturn \"bx-messenger-videocall-panel-item-with-arrow-icon bx-messenger-videocall-panel-item-with-arrow-icon-\" + this.class + (this.enabled ? \"\" : \"-off\");\n\t};\n\n\tgetIconContainerClass()\n\t{\n\t\treturn \"bx-messenger-videocall-panel-item-with-arrow-icon-container\" + \" bx-messenger-videocall-panel-item-with-arrow-icon-container-\" + this.class + (this.enabled ? \"\" : \"-off\") + (this.arrowHidden ? \" bx-messenger-videocall-panel-item-with-arrow-icon-container-arrow-hidden\" : \"\") + (this.backgroundClass ? ` ${this.backgroundClass}` : \"\");\n\t};\n\n\tenable()\n\t{\n\t\tif (this.enabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.enabled = true;\n\t\tthis.elements.iconContainer.className = this.getIconContainerClass();\n\t\tthis.elements.icon.className = this.getIconClass();\n\n\t\tif (this.elements.gradientStop1 && this.elements.gradientStop2)\n\t\t{\n\t\t\tthis.elements.gradientStop1.setAttribute('offset', '0%');\n\t\t\tthis.elements.gradientStop2.setAttribute('offset', '0%');\n\t\t}\n\t\telse if (this.elements.levelMeter)\n\t\t{\n\t\t\tthis.elements.levelMeter.setAttribute('y', Math.round((1 - this.level) * 20));\n\t\t}\n\n\t\tconst {\n\t\t\thasTooltip, getTooltipText, tooltipTextVarName,\n\t\t} = this.tooltip;\n\n\t\thasTooltip && this.elements.root.style.setProperty(tooltipTextVarName, `'${getTooltipText()}'`);\n\t};\n\n\tdisable()\n\t{\n\t\tif (!this.enabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.enabled = false;\n\t\tthis.elements.iconContainer.className = this.getIconContainerClass();\n\t\tthis.elements.icon.className = this.getIconClass();\n\n\t\tif (this.elements.gradientStop1 && this.elements.gradientStop2)\n\t\t{\n\t\t\tthis.elements.gradientStop1.setAttribute('offset', '0%');\n\t\t\tthis.elements.gradientStop2.setAttribute('offset', '0%');\n\t\t}\n\t\telse if (this.elements.levelMeter)\n\t\t{\n\t\t\tthis.elements.levelMeter.setAttribute('y', Math.round((1 - this.level) * 20));\n\t\t}\n\n\t\tconst {\n\t\t\thasTooltip, getTooltipText, tooltipTextVarName,\n\t\t} = this.tooltip;\n\n\t\thasTooltip && this.elements.root.style.setProperty(tooltipTextVarName, `'${getTooltipText()}'`);\n\t};\n\n\tsetBlocked(blocked)\n\t{\n\t\tif (this.blocked == blocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.blocked = blocked;\n\t\tthis.elements.iconContainer.className = this.getIconContainerClass();\n\t\tthis.elements.icon.className = this.getIconClass();\n\t\tif (this.blocked)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"blocked\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"blocked\");\n\t\t}\n\t};\n\n\tsetSideIcon(sideIcon)\n\t{\n\t\tif (this.sideIcon == sideIcon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.sideIcon = sideIcon;\n\n\t\tBX.Dom.remove(this.elements.pointer);\n\t\tBX.Dom.remove(this.elements.ellipsis);\n\n\t\tif (this.sideIcon == \"pointer\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.pointer, this.elements.icon);\n\t\t}\n\t\telse if (this.sideIcon == \"ellipsis\")\n\t\t{\n\t\t\tBX.Dom.insertAfter(this.elements.ellipsis, this.elements.icon);\n\t\t}\n\t}\n\n\tshowArrow()\n\t{\n\t\tif (!this.arrowHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.arrowHidden = false;\n\n\t\tthis.elements.iconContainer.className = this.getIconContainerClass();\n\n\t\tif (!this.elements.root.querySelector('.bx-messenger-videocall-panel-item-with-arrow-right-icon'))\n\t\t{\n\t\t\tthis.elements.root.children[0].appendChild(this.elements.arrow);\n\t\t}\n\t};\n\n\thideArrow()\n\t{\n\t\tif (this.arrowHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.arrowHidden = true;\n\n\t\tthis.elements.iconContainer.className = this.getIconContainerClass();\n\n\t\tif (this.elements.root.querySelector('.bx-messenger-videocall-panel-item-with-arrow-right-icon'))\n\t\t{\n\t\t\tthis.elements.root.children[0].removeChild(this.elements.arrow);\n\t\t}\n\t};\n\n\tsetLevel(level)\n\t{\n\t\tthis.level = Math.log(level * 100) / 4.6;\n\t\tif (this.showLevel && this.enabled)\n\t\t{\n\t\t\tconst offset = `${100 - Math.round((1 - this.level) * 100)}%`;\n\t\t\tthis.elements.gradientStop1.setAttribute('offset', offset);\n\t\t\tthis.elements.gradientStop2.setAttribute('offset', offset);\n\t\t}\n\t}\n}\n\nexport class WaterMarkButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.language = config.language;\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t};\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: { className: 'bx-messenger-videocall-watermark' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('img', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-watermark-img',\n\t\t\t\t\t\tsrc: this.getWatermarkUrl(this.language),\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\treturn this.elements.root;\n\t}\n\n\tgetWatermarkUrl(language)\n\t{\n\t\tswitch (language)\n\t\t{\n\t\t\tcase 'ru':\n\t\t\tcase 'kz':\n\t\t\tcase 'by':\n\t\t\t\treturn '/bitrix/js/call/images/new-logo-white-ru.svg';\n\t\t\tdefault:\n\t\t\t\treturn '/bitrix/js/call/images/new-logo-white-en.svg';\n\t\t}\n\t};\n}\n\nexport class TopButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.iconClass = BX.prop.getString(config, 'iconClass', '');\n\t\tthis.text = BX.prop.getString(config, 'text', '');\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticon: null,\n\t\t\ttext: null,\n\t\t};\n\t\tthis.tooltip = createCssTooltip(BX.prop.getObject(config, 'tooltip', {}));\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, 'onClick', BX.DoNothing),\n\t\t};\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tconst {\n\t\t\ttooltipClass, tooltipStyle,\n\t\t} = this.tooltip;\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: { className: `bx-messenger-videocall-top-button ${tooltipClass}` },\n\t\t\tattrs: {\n\t\t\t\tstyle: tooltipStyle,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.icon = Dom.create('div', {\n\t\t\t\t\tprops: { className: `bx-messenger-videocall-top-button-icon ${this.iconClass}` },\n\t\t\t\t}),\n\t\t\t\tthis.elements.text = Dom.create('div', {\n\t\t\t\t\tprops: { className: `bx-messenger-videocall-top-button-text ${this.iconClass}` },\n\t\t\t\t\ttext: this.text,\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t},\n\t\t});\n\n\t\treturn this.elements.root;\n\t}\n\n\tupdate(config)\n\t{\n\t\tconst iconClass = BX.prop.getString(config, 'iconClass', this.iconClass);\n\t\tconst text = BX.prop.getString(config, 'text', this.text);\n\n\t\tif (this.iconClass !== iconClass)\n\t\t{\n\t\t\tthis.iconClass = iconClass;\n\t\t\tthis.elements.icon.className = `bx-messenger-videocall-top-button-icon ${this.iconClass}`;\n\t\t}\n\n\t\tif (this.text !== text)\n\t\t{\n\t\t\tthis.text = text;\n\t\t\tthis.elements.text.innerText = this.text;\n\t\t\tthis.elements.text.className = `bx-messenger-videocall-top-button-text ${this.iconClass}`;\n\t\t}\n\t}\n}\n\nexport class TopFramelessButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.iconClass = BX.prop.getString(config, 'iconClass', '');\n\t\tthis.textClass = BX.prop.getString(config, 'textClass', '');\n\t\tthis.text = BX.prop.getString(config, 'text', '');\n\t\tthis.tooltip = createCssTooltip(BX.prop.getObject(config, 'tooltip', {}));\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, 'onClick', BX.DoNothing),\n\t\t};\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tconst {\n\t\t\ttooltipClass, tooltipStyle,\n\t\t} = this.tooltip;\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: { className: `bx-messenger-videocall-top-button-frameless ${tooltipClass}` },\n\t\t\tattrs: {\n\t\t\t\tstyle: tooltipStyle,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: `bx-messenger-videocall-top-button-icon ${this.iconClass}` },\n\t\t\t\t}),\n\t\t\t\t(this.text === ''\n\t\t\t\t\t\t? null\n\t\t\t\t\t\t: Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: `bx-messenger-videocall-top-button-text ${this.textClass}` },\n\t\t\t\t\t\t\ttext: this.text,\n\t\t\t\t\t\t})\n\t\t\t\t),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick,\n\t\t\t},\n\t\t});\n\n\t\treturn this.elements.root;\n\t}\n}\n\nexport class ParticipantsButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", 0);\n\t\tthis.foldButtonState = BX.prop.getString(config, \"foldButtonState\", ParticipantsButton.FoldButtonState.Hidden);\n\t\tthis.allowAdding = BX.prop.getBoolean(config, \"allowAdding\", false);\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tleftContainer: null,\n\t\t\trightContainer: null,\n\t\t\tfoldIcon: null,\n\t\t\tcount: null,\n\t\t\tseparator: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonListClick: BX.prop.getFunction(config, \"onListClick\", BX.DoNothing),\n\t\t\tonAddClick: BX.prop.getFunction(config, \"onAddClick\", BX.DoNothing)\n\t\t}\n\t};\n\n\tstatic FoldButtonState = {\n\t\tActive: \"active\",\n\t\tFold: \"fold\",\n\t\tUnfold: \"unfold\",\n\t\tHidden: \"hidden\"\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.leftContainer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-inner left\" + (this.foldButtonState != ParticipantsButton.FoldButtonState.Hidden ? \" active\" : \"\")},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon participants\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.count = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-text-count\"},\n\t\t\t\t\t\t\ttext: this.count\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.foldIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-fold-icon \" + this.foldButtonState},\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this.callbacks.onListClick\n\t\t\t\t\t}\n\t\t\t\t}),\n\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.separator = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-separator\"}\n\t\t});\n\t\tthis.elements.rightContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-inner active\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-participants-text\"},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_ADD\")\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-button-icon add\"}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onAddClick\n\t\t\t}\n\t\t});\n\n\t\tif (this.allowAdding)\n\t\t{\n\t\t\tthis.elements.root.appendChild(this.elements.separator);\n\t\t\tthis.elements.root.appendChild(this.elements.rightContainer);\n\t\t}\n\t\treturn this.elements.root;\n\t};\n\n\tupdate(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", this.count);\n\t\tthis.foldButtonState = BX.prop.getString(config, \"foldButtonState\", this.foldButtonState);\n\t\tthis.allowAdding = BX.prop.getBoolean(config, \"allowAdding\", this.allowAdding);\n\n\t\tthis.elements.count.innerText = this.count;\n\n\t\tthis.elements.foldIcon.className = \"bx-messenger-videocall-top-participants-fold-icon \" + this.foldButtonState;\n\t\tif (this.foldButtonState == ParticipantsButton.FoldButtonState.Hidden)\n\t\t{\n\t\t\tthis.elements.leftContainer.classList.remove(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.leftContainer.classList.add(\"active\");\n\t\t}\n\n\t\tif (this.allowAdding && !this.elements.separator.parentElement)\n\t\t{\n\t\t\tthis.elements.root.appendChild(this.elements.separator);\n\t\t\tthis.elements.root.appendChild(this.elements.rightContainer);\n\t\t}\n\t\tif (!this.allowAdding && this.elements.separator.parentElement)\n\t\t{\n\t\t\tBX.remove(this.elements.separator);\n\t\t\tBX.remove(this.elements.rightContainer);\n\t\t}\n\t};\n}\n\nexport class ParticipantsButtonMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.count = BX.prop.getInteger(config, \"count\", 0);\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticon: null,\n\t\t\ttext: null,\n\t\t\tarrow: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.icon = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-icon\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.text = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-text\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_PARTICIPANTS\").replace(\"#COUNT#\", this.count)\n\t\t\t\t}),\n\t\t\t\tthis.elements.arrow = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-top-participants-mobile-arrow\"\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tsetCount(count)\n\t{\n\t\tif (this.count == count || !this.elements.text)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.count = count;\n\t\tthis.elements.text.innerText = BX.message(\"IM_M_CALL_PARTICIPANTS\").replace(\"#COUNT#\", this.count);\n\t};\n}\n\nexport class RecordStatusButton\n{\n\tconstructor(config)\n\t{\n\t\tthis.userId = config.userId;\n\t\tthis.commonRecordState = config.commonRecordState;\n\n\t\tthis.updateViewInterval = null;\n\n\t\tthis.tooltip = createCssTooltip(BX.prop.getObject(config, 'tooltip', {}));\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ttimeText: null,\n\t\t\tstateText: null,\n\t\t};\n\t}\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tconst { tooltipStyle } = this.tooltip;\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: `bx-messenger-videocall-top-recordstatus record-status-${this.commonRecordState.state}`,\n\t\t\t},\n\t\t\tattrs: {\n\t\t\t\tstyle: tooltipStyle,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-top-recordstatus-status' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-top-button-icon record-status' },\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-top-recordstatus-time' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t(this.elements.timeText = Dom.create('span', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-top-recordstatus-time-text' },\n\t\t\t\t\t\t\ttext: Util.getRecordTimeText(this.commonRecordState),\n\t\t\t\t\t\t})),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\treturn this.elements.root;\n\t}\n\n\tupdate(commonRecordState)\n\t{\n\t\tconst prevState = this.commonRecordState?.state;\n\n\t\tif (prevState !== commonRecordState.state)\n\t\t{\n\t\t\tclearInterval(this.updateViewInterval);\n\t\t\tthis.updateViewInterval = null;\n\n\t\t\tif (commonRecordState.state === CallCommonRecordState.Started)\n\t\t\t{\n\t\t\t\tthis.updateViewInterval = setInterval(() => this.updateView(), 1000);\n\t\t\t}\n\t\t}\n\n\t\tthis.commonRecordState = commonRecordState;\n\t\tthis.updateView();\n\t}\n\n\tupdateView()\n\t{\n\t\tconst timeText = Util.getRecordTimeText(this.commonRecordState);\n\n\t\tif (this.elements.timeText.innerText !== timeText)\n\t\t{\n\t\t\tthis.elements.timeText.innerText = timeText;\n\t\t}\n\n\t\tconst currentClass = `record-status-${this.commonRecordState.state}`;\n\t\tif (!this.elements.root.classList.contains(currentClass))\n\t\t{\n\t\t\tconst { tooltipClass, hasTooltip, tooltipTextVarName, getTooltipText } = this.tooltip;\n\t\t\tconst tooltipText = getTooltipText();\n\n\t\t\tif (hasTooltip && tooltipText)\n\t\t\t{\n\t\t\t\tthis.elements.root.style.setProperty(tooltipTextVarName, `'${tooltipText}'`);\n\t\t\t}\n\n\t\t\tconst classes = [\n\t\t\t\ttooltipText ? tooltipClass : '',\n\t\t\t\t'bx-messenger-videocall-top-recordstatus',\n\t\t\t\tcurrentClass,\n\t\t\t].filter(Boolean);\n\n\t\t\tthis.elements.root.className = classes.join(' ');\n\t\t}\n\t}\n\n\tstopViewUpdate()\n\t{\n\t\tif (this.updateViewInterval)\n\t\t{\n\t\t\tclearInterval(this.updateViewInterval);\n\t\t\tthis.updateViewInterval = null;\n\t\t}\n\t};\n}","import {Dom} from 'main.core';\nimport {createSVG} from './svg'\nimport {UserState} from '../engine/engine';\nimport Util from '../util'\nimport { Utils } from 'im.v2.lib.utils';\n\nexport class CallUserMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.userModel = config.userModel;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null,\n\t\t\tavatarOutline: null,\n\t\t\tuserName: null,\n\t\t\tuserStatus: null,\n\t\t\tmenuArrow: null,\n\t\t\tfloorRequest: null,\n\t\t\tmic: null,\n\t\t\tcam: null,\n\t\t};\n\n\t\tthis._onUserFieldChangeHandler = this._onUserFieldChange.bind(this);\n\t\tthis.userModel.subscribe(\"changed\", this._onUserFieldChangeHandler);\n\n\t\tthis.callbacks = {\n\t\t\tonClick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing)\n\t\t}\n\n\t\tthis.avatarBackground = Util.getAvatarBackground();\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-avatar\" + (this.userModel.talking ? \" talking\" : \"\")\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.floorRequest = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-floor-request bx-messenger-videocall-floor-request-icon\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-body\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-text\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.mic = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-icon\" + (this.userModel.microphoneState ? \"\" : \" bx-call-view-icon-red-microphone-off\")\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.cam = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-icon\" + (this.userModel.cameraState ? \"\" : \" bx-call-view-icon-red-camera-off\")\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.userName = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-username\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttext: this.userModel.name\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-menu-arrow\"\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.userStatus = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"bx-messenger-videocall-user-mobile-user-status\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: this.userModel.pinned ? BX.message(\"IM_M_CALL_PINNED_USER\") : BX.message(\"IM_M_CALL_CURRENT_PRESENTER\")\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.callbacks.onClick\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tupdate()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.userName.innerText = this.userModel.name;\n\n\t\tif (this.userModel.avatar !== '')\n\t\t{\n\t\t\tthis.elements.root.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t\tthis.elements.avatar.innerText = '';\n\t\t\tthis.elements.root.style.removeProperty(\"--avatar-background\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty(\"--avatar\");\n\t\t\tthis.elements.root.style.setProperty(\"--avatar-background\", this.avatarBackground);\n\t\t\tthis.elements.avatar.innerText = Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t\t}\n\t\tthis.elements.avatar.classList.toggle(\"talking\", this.userModel.talking);\n\t\tthis.elements.floorRequest.classList.toggle(\"active\", this.userModel.floorRequestState);\n\t\tthis.elements.mic.classList.toggle(\"bx-call-view-icon-red-microphone-off\", !this.userModel.microphoneState);\n\t\tthis.elements.cam.classList.toggle(\"bx-call-view-icon-red-camera-off\", !this.userModel.cameraState);\n\n\t\tthis.elements.userStatus.innerText = this.userModel.pinned ? BX.message(\"IM_M_CALL_PINNED_USER\") : BX.message(\"IM_M_CALL_CURRENT_PRESENTER\");\n\t};\n\n\tmount(parentElement)\n\t{\n\t\tparentElement.appendChild(this.render());\n\t};\n\n\tdismount()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tDom.remove(this.elements.root);\n\t};\n\n\tsetUserModel(userModel: UserModel)\n\t{\n\t\tthis.userModel.unsubscribe(\"changed\", this._onUserFieldChangeHandler);\n\t\tthis.userModel = userModel;\n\t\tthis.userModel.subscribe(\"changed\", this._onUserFieldChangeHandler);\n\t\tthis.update();\n\t};\n\n\t_onUserFieldChange(event)\n\t{\n\t\tthis.update();\n\t};\n}\n\nexport class UserSelectorMobile\n{\n\tconstructor(config)\n\t{\n\t\tthis.userRegistry = config.userRegistry;\n\t\tthis.userRegistry.subscribe(\"userAdded\", this._onUserAdded.bind(this));\n\t\tthis.userRegistry.subscribe(\"userChanged\", this._onUserChanged.bind(this));\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tusers: {}\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-selector-mobile\",\n\t\t\t},\n\t\t});\n\n\t\tthis.updateUsers();\n\n\t\treturn this.elements.root;\n\t};\n\n\trenderUser(userFields)\n\t{\n\t\treturn createSVG(\"svg\", {\n\t\t\tattrNS: {\n\t\t\t\twidth: 14.5, height: 11.6\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\torder: userFields.order\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tcreateSVG(\"circle\", {\n\t\t\t\t\tattrNS: {\n\t\t\t\t\t\tclass: \"bx-messenger-videocall-user-selector-mobile-border\" + (userFields.talking ? \" talking\" : \"\"),\n\t\t\t\t\t\tcx: 7.25, cy: 5.8, r: 4.6,\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tcreateSVG(\"circle\", {\n\t\t\t\t\tattrNS: {\n\t\t\t\t\t\tclass: \"bx-messenger-videocall-user-selector-mobile-dot\" + (userFields.centralUser ? \" pinned\" : \"\"),\n\t\t\t\t\t\tcx: 7.25, cy: 5.8, r: 3.3\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tupdateUsers()\n\t{\n\t\tthis.userRegistry.users.forEach(function (userFields)\n\t\t{\n\t\t\tif (userFields.localUser || userFields.state != UserState.Connected)\n\t\t\t{\n\t\t\t\tif (this.elements.users[userFields.id])\n\t\t\t\t{\n\t\t\t\t\tBX.remove(this.elements.users[userFields.id]);\n\t\t\t\t\tthis.elements.users[userFields.id] = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar newNode = this.renderUser(userFields);\n\t\t\t\tif (this.elements.users[userFields.id])\n\t\t\t\t{\n\t\t\t\t\tBX.replace(this.elements.users[userFields.id], newNode)\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.elements.root.appendChild(newNode)\n\t\t\t\t}\n\t\t\t\tthis.elements.users[userFields.id] = newNode;\n\t\t\t}\n\t\t}, this)\n\t};\n\n\t_onUserAdded(event)\n\t{\n\t\tthis.updateUsers();\n\t};\n\n\t_onUserChanged(event)\n\t{\n\t\tthis.updateUsers();\n\t};\n\n\tmount(parentElement)\n\t{\n\t\tparentElement.appendChild(this.render());\n\t};\n\n\tdismount()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tBX.remove(this.elements.root);\n\t};\n}\n\nexport class MobileSlider\n{\n\tconstructor(config)\n\t{\n\t\tthis.parent = config.parent || null;\n\t\tthis.content = config.content || null;\n\n\t\tthis.elements = {\n\t\t\tbackground: null,\n\t\t\troot: null,\n\t\t\thandle: null,\n\t\t\tbody: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(config, \"onClose\", BX.DoNothing),\n\t\t\tonDestroy: BX.prop.getFunction(config, \"onDestroy\", BX.DoNothing),\n\t\t};\n\n\t\tthis.touchStartY = 0;\n\t\tthis.processedTouchId = 0;\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.background = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-background\"\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: this._onBackgroundClick.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-container\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.handle = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-handle\"\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tthis.elements.body = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu\"\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.content\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\ttouchstart: this._onTouchStart.bind(this),\n\t\t\t\ttouchmove: this._onTouchMove.bind(this),\n\t\t\t\ttouchend: this._onTouchEnd.bind(this),\n\t\t\t}\n\t\t});\n\n\t\treturn this.elements.root;\n\t};\n\n\tshow()\n\t{\n\t\tif (this.parent)\n\t\t{\n\t\t\tthis.render();\n\t\t\tthis.parent.appendChild(this.elements.root);\n\t\t\tthis.parent.appendChild(this.elements.background);\n\t\t}\n\t};\n\n\tclose()\n\t{\n\t\tBX.remove(this.elements.root);\n\t\tBX.remove(this.elements.background);\n\t\tthis.callbacks.onClose();\n\t};\n\n\tcloseWithAnimation()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.root.classList.add(\"closing\");\n\t\tthis.elements.background.classList.add(\"closing\");\n\t\tthis.elements.root.addEventListener(\"animationend\", function ()\n\t\t{\n\t\t\tthis.close();\n\t\t}.bind(this));\n\t};\n\n\t_onTouchStart(e)\n\t{\n\t\tthis.touchStartY = e.pageY;\n\t\tif (this.processedTouchId || e.touches.length > 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.target == this.elements.header || e.target == this.elements.root || this.elements.body.scrollTop === 0)\n\t\t{\n\t\t\tthis.processedTouchId = e.touches[0].identifier;\n\t\t}\n\t};\n\n\t_onTouchMove(e)\n\t{\n\t\tif (e.touches.length > 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.touches[0].identifier != this.processedTouchId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tvar delta = this.touchStartY - e.pageY;\n\t\tif (delta > 0)\n\t\t{\n\t\t\tdelta = 0;\n\t\t}\n\t\tthis.elements.root.style.bottom = delta + \"px\";\n\t\tif (delta)\n\t\t{\n\t\t\te.preventDefault();\n\t\t}\n\t};\n\n\t_onTouchEnd(e)\n\t{\n\t\tvar allowProcessing = false;\n\t\tfor (var i = 0; i < e.changedTouches.length; i++)\n\t\t{\n\t\t\tif (e.changedTouches[i].identifier == this.processedTouchId)\n\t\t\t{\n\t\t\t\tallowProcessing = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!allowProcessing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvar delta = e.pageY - this.touchStartY;\n\t\tif (delta > 100)\n\t\t{\n\t\t\tthis.closeWithAnimation();\n\t\t\te.preventDefault();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty(\"bottom\");\n\t\t}\n\n\t\tthis.processedTouchId = 0;\n\t\tthis.touchStartY = 0;\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.callbacks.onDestroy();\n\t\tthis.elements = {};\n\t\tthis.callbacks = {};\n\t\tthis.parent = null;\n\t};\n\n\t_onBackgroundClick()\n\t{\n\t\tthis.closeWithAnimation();\n\t};\n}\n\nexport class MobileMenu\n{\n\tconstructor(config)\n\t{\n\t\tthis.parent = config.parent || null;\n\t\tthis.header = BX.prop.getString(config, \"header\", \"\");\n\t\tthis.largeIcons = BX.prop.getBoolean(config, \"largeIcons\", false);\n\n\t\tthis.slider = null;\n\n\t\tvar items = BX.prop.getArray(config, \"items\", []);\n\t\tif (items.length === 0)\n\t\t{\n\t\t\tthrow Error(\"Items array should not be empty\");\n\t\t}\n\n\t\tthis.items = items\n\t\t\t.filter(item => typeof (item) === \"object\" && !!item)\n\t\t\t.map(item => new MobileMenuItem(item))\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\theader: null,\n\t\t\tbody: null\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(config, \"onClose\", BX.DoNothing),\n\t\t\tonDestroy: BX.prop.getFunction(config, \"onDestroy\", BX.DoNothing),\n\t\t};\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.header = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-header\"\n\t\t\t},\n\t\t\ttext: this.header\n\t\t});\n\t\tthis.elements.body = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-menu-body\" + (this.largeIcons ? \" bx-videocall-mobile-menu-large\" : \"\")\n\t\t\t}\n\t\t});\n\n\t\tthis.items.forEach(item =>\n\t\t{\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\tthis.elements.body.appendChild(item.render());\n\t\t\t}\n\t\t});\n\n\t\treturn BX.createFragment([\n\t\t\tthis.elements.header,\n\t\t\tthis.elements.body\n\t\t]);\n\t};\n\n\tsetHeader(header)\n\t{\n\t\tthis.header = header;\n\t\tif (this.elements.header)\n\t\t{\n\t\t\tthis.elements.header.innerText = header;\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.slider)\n\t\t{\n\t\t\tthis.slider = new MobileSlider({\n\t\t\t\tparent: this.parent,\n\t\t\t\tcontent: this.render(),\n\t\t\t\tonClose: this.onSliderClose.bind(this),\n\t\t\t\tonDestroy: this.onSliderDestroy.bind(this),\n\t\t\t});\n\t\t}\n\n\t\tthis.slider.show()\n\t};\n\n\tclose()\n\t{\n\t\tif (this.slider)\n\t\t{\n\t\t\tthis.slider.close()\n\t\t}\n\t};\n\n\tonSliderClose()\n\t{\n\t\tthis.slider.destroy();\n\t};\n\n\tonSliderDestroy()\n\t{\n\t\tthis.slider = null;\n\t\tthis.destroy();\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.slider)\n\t\t{\n\t\t\tthis.slider.destroy();\n\t\t}\n\t\tthis.slider = null;\n\t\tthis.items.forEach(function (item)\n\t\t{\n\t\t\titem.destroy();\n\t\t});\n\t\tthis.items = [];\n\n\t\tthis.callbacks.onDestroy();\n\t\tthis.elements = {};\n\t\tthis.callbacks = {};\n\t\tthis.parent = null;\n\t};\n}\n\nclass MobileMenuItem\n{\n\tconstructor(config)\n\t{\n\t\tthis.id = BX.prop.getString(config, \"id\", Util.getUuidv4());\n\t\tthis.icon = BX.prop.getString(config, \"icon\", \"\");\n\t\tthis.iconClass = BX.prop.getString(config, \"iconClass\", \"\");\n\t\tthis.text = BX.prop.getString(config, \"text\", \"\");\n\t\tthis.showSubMenu = BX.prop.getBoolean(config, \"showSubMenu\", false);\n\t\tthis.separator = BX.prop.getBoolean(config, \"separator\", false);\n\t\tthis.enabled = BX.prop.getBoolean(config, \"enabled\", true);\n\t\tthis.userModel = BX.prop.get(config, \"userModel\", null);\n\t\tthis.avatarBackground = Util.getAvatarBackground();\n\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis._userChangeHandler = this._onUserChange.bind(this);\n\t\t\tthis.subscribeUserEvents();\n\t\t\tthis.text = this.userModel.name;\n\t\t\tthis.icon = this.userModel.avatar;\n\t\t\tthis.iconClass = \"user-avatar\";\n\t\t\tthis.iconText = Utils.text.getFirstLetters(this.userModel.name);\n\t\t\tthis.iconBackground = Util.getAvatarBackground();\n\t\t}\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\ticon: null,\n\t\t\tcontent: null,\n\t\t\tsubmenu: null,\n\t\t\tseparator: null,\n\t\t\tmic: null,\n\t\t\tcam: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tclick: BX.prop.getFunction(config, \"onClick\", BX.DoNothing),\n\t\t\tclickSubMenu: BX.prop.getFunction(config, \"onClickSubMenu\", BX.DoNothing),\n\t\t};\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tif (this.separator)\n\t\t{\n\t\t\tthis.elements.root = Dom.create(\"hr\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-separator\",\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item\" + (this.enabled ? \"\" : \" disabled\"),\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tthis.elements.icon = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-icon \" + this.iconClass\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tthis.elements.content = Dom.create(\"div\", {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-content\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\ttext: this.text\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t]\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this.callbacks.click\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.icon != \"\")\n\t\t\t{\n\t\t\t\tthis.elements.icon.style.backgroundImage = \"url(\\\"\" + this.icon + \"\\\")\";\n\t\t\t\tthis.elements.icon.innerText = '';\n\t\t\t}\n\t\t\telse if (this.iconText)\n\t\t\t{\n\t\t\t\tthis.elements.icon.innerText = this.iconText;\n\t\t\t\tthis.elements.root.style.setProperty(\"--avatar-background\", this.avatarBackground);\n\t\t\t}\n\n\t\t\tif (this.showSubMenu)\n\t\t\t{\n\t\t\t\tthis.elements.submenu = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-item-submenu-icon\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.elements.root.appendChild(this.elements.submenu);\n\t\t\t}\n\n\t\t\tif (this.userModel)\n\t\t\t{\n\t\t\t\tthis.elements.mic = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-icon-user bx-call-view-icon-red-microphone-off\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.elements.cam = Dom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-menu-icon-user bx-call-view-icon-red-camera-off\"\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (!this.userModel.cameraState)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.content.prepend(this.elements.cam);\n\t\t\t\t}\n\t\t\t\tif (!this.userModel.microphoneState)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.content.prepend(this.elements.mic);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this.elements.root;\n\t};\n\n\tupdateUserIcons()\n\t{\n\t\tif (!this.userModel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.microphoneState)\n\t\t{\n\t\t\tBX.remove(this.elements.mic);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.content.prepend(this.elements.mic);\n\t\t}\n\t\tif (this.userModel.cameraState)\n\t\t{\n\t\t\tBX.remove(this.elements.cam);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.content.prepend(this.elements.cam);\n\t\t}\n\t};\n\n\tsubscribeUserEvents()\n\t{\n\t\tthis.userModel.subscribe(\"changed\", this._userChangeHandler);\n\t};\n\n\t_onUserChange(event)\n\t{\n\t\tthis.updateUserIcons();\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis.userModel.unsubscribe(\"changed\", this._userChangeHandler);\n\t\t\tthis.userModel = null;\n\t\t}\n\t\tthis.callbacks = null;\n\t\tthis.elements = null;\n\t};\n}\n","import {Dom, Type} from 'main.core';\nimport {Menu} from 'main.popup';\nimport {UserState, Provider} from '../engine/engine';\nimport {BackgroundDialog} from '../dialogs/background_dialog';\nimport {logPlaybackError} from './tools';\nimport type {UserModel} from './user-registry'\nimport {MediaStreamsKinds} from '../call_api';\nimport Util from '../util';\nimport { Utils } from 'im.v2.lib.utils';\nimport { LOCAL_STREAM_QUALITY_HEIGHT } from '../stream_quality';\nimport { Hardware } from '../call_hardware';\n\ntype CallUserElements = {\n\troot?: HTMLElement,\n\tcontainer?: HTMLElement,\n\tvideoContainer?: HTMLElement,\n\tvideo?: HTMLVideoElement,\n\taudio?: HTMLAudioElement,\n\tscreenAudio?: HTMLAudioElement,\n\tpreview?: HTMLVideoElement,\n\tvideoBorder?: HTMLElement,\n\tavatarContainer?: HTMLElement,\n\tavatar?: HTMLElement,\n\tnameContainer?: HTMLElement,\n\tname?: HTMLElement,\n\tchangeNameIcon?: HTMLElement,\n\tchangeNameContainer?: HTMLElement,\n\tchangeNameCancel?: HTMLElement,\n\tchangeNameInput?: HTMLInputElement,\n\tchangeNameConfirm?: HTMLElement,\n\tchangeNameLoader?: HTMLElement,\n\tintroduceYourselfContainer?: HTMLElement,\n\tfloorRequest?: HTMLElement,\n\tbadNetworkIndicator?: HTMLElement,\n\tstate?: HTMLElement,\n\tremoveButton?: HTMLElement,\n\tmicState?: HTMLElement,\n\tcameraState?: HTMLElement,\n\tpanel?: HTMLElement,\n\tbuttonMenu?: HTMLElement,\n\tremoteParticipantButtonMenu?: HTMLElement,\n\tbuttonBackground?: HTMLElement,\n\tbuttonPin?: HTMLElement,\n\tbuttonUnPin?: HTMLElement,\n\tconnectionProblem?: HTMLElement,\n\tstatsOverlay?: HTMLElement,\n\tconnectionQualityIcon?: HTMLElement,\n}\n\ntype CallUserParams = {\n\tparentContainer: HTMLElement,\n\tuserModel: UserModel,\n\tscreenAudioElement: ?HTMLAudioElement,\n\taudioElement: ?HTMLAudioElement,\n\tallowBackgroundItem: ?boolean,\n\tallowMaskItem: ?boolean,\n\tallowPinButton: ?boolean,\n\tscreenSharingUser: ?boolean,\n\taudioTrack: ?MediaStreamTrack,\n\tscreenAudioTrack: ?MediaStreamTrack,\n\tvideoTrack: ?MediaStreamTrack,\n\n\tonClick: () => void,\n\tonPin: () => void,\n\tonTurnOffParticipantMic: () => void,\n\tonTurnOffParticipantCam: () => void,\n\tonTurnOffParticipantScreenshare: () => void,\n\tonUnPin: () => void,\n\tonUserRename: () => void,\n\tonUserRenameInputFocus: () => void,\n\tonUserRenameInputBlur: () => void,\n\n\tavatarBackground: ?string,\n\talwaysShowName?: boolean;\n\tflipVideo: ?boolean;\n\thiddenFloorRequest: ?boolean;\n\thiddenRemoteParticipantButtonMenu: ?boolean;\n}\n\nexport class CallUser\n{\n\tuserModel: UserModel\n\telements: CallUserElements = {}\n\tmenu: ?Menu\n\tremoteParticipantMenu: ?Menu\n\n\tconstructor(config: CallUserParams = {})\n\t{\n\t\tthis._onUserFieldChangedHandler = this._onUserFieldChanged.bind(this);\n\t\tthis.userModel = config.userModel;\n\t\tthis.userModel.subscribe('changed', this._onUserFieldChangedHandler);\n\t\tthis.parentContainer = config.parentContainer;\n\t\tthis.screenSharingUser = Type.isBoolean(config.screenSharingUser) ? config.screenSharingUser : false;\n\t\tthis.allowBackgroundItem = Type.isBoolean(config.allowBackgroundItem) ? config.allowBackgroundItem : true;\n\t\tthis.allowMaskItem = Type.isBoolean(config.allowMaskItem) ? config.allowMaskItem : true;\n\t\tthis._allowPinButton = Type.isBoolean(config.allowPinButton) ? config.allowPinButton : true;\n\t\tthis._visible = true;\n\t\tthis._audioTrack = config.audioTrack;\n\t\tthis._screenAudioTrack = config.screenAudioTrack;\n\t\tthis._audioStream = this._audioTrack ? new MediaStream([this._audioTrack]) : null;\n\t\tthis._screenAudioStream = this._screenAudioTrack ? new MediaStream([this._screenAudioTrack]) : null;\n\t\tthis._videoTrack = config.videoTrack;\n\t\tthis._stream = this._videoTrack ? new MediaStream([this._videoTrack]) : null;\n\t\tthis._videoRenderer = null;\n\t\tthis._previewRenderer = null;\n\t\tthis._flipVideo = config.flipVideo || false;\n\t\tthis._tracksSubscriptionFailed = {};\n\t\tthis._alwaysShowName = config.alwaysShowName;\n\t\tthis._hiddenFloorRequest = config.hiddenFloorRequest;\n\t\tthis._hiddenRemoteParticipantButtonMenu = config.hiddenRemoteParticipantButtonMenu\n\t\tthis.hidden = false;\n\t\tthis.videoBlurState = false;\n\t\tthis.isChangingName = false;\n\n\t\tthis._badNetworkIndicator = false;\n\n\t\tthis.incomingVideoConstraints = {\n\t\t\twidth: 0, height: 0\n\t\t}\n\t\tif (config.audioElement)\n\t\t{\n\t\t\tthis.elements.audio = config.audioElement;\n\t\t}\n\n\t\tif (config.screenAudioElement)\n\t\t{\n\t\t\tthis.elements.screenAudio = config.screenAudioElement;\n\t\t}\n\n\t\tthis.callBacks = {\n\t\t\tonClick: Type.isFunction(config.onClick) ? config.onClick : BX.DoNothing,\n\t\t\tonUserRename: Type.isFunction(config.onUserRename) ? config.onUserRename : BX.DoNothing,\n\t\t\tonUserRenameInputFocus: Type.isFunction(config.onUserRenameInputFocus) ? config.onUserRenameInputFocus : BX.DoNothing,\n\t\t\tonUserRenameInputBlur: Type.isFunction(config.onUserRenameInputBlur) ? config.onUserRenameInputBlur : BX.DoNothing,\n\t\t\tonPin: Type.isFunction(config.onPin) ? config.onPin : BX.DoNothing,\n\t\t\tonUnPin: Type.isFunction(config.onUnPin) ? config.onUnPin : BX.DoNothing,\n\t\t\tonTurnOffParticipantMic: Type.isFunction(config.onTurnOffParticipantMic) ? config.onTurnOffParticipantMic : BX.DoNothing,\n\t\t\tonTurnOffParticipantCam: Type.isFunction(config.onTurnOffParticipantCam) ? config.onTurnOffParticipantCam : BX.DoNothing,\n\t\t\tonTurnOffParticipantScreenshare: Type.isFunction(config.onTurnOffParticipantScreenshare) ? config.onTurnOffParticipantScreenshare : BX.DoNothing,\n\t\t};\n\t\tthis.checkAspectInterval = setInterval(this.checkVideoAspect.bind(this), 500);\n\n\t\tthis.hintManager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tclassName: `bx-messenger-videocall-panel-item-hotkey-hint ${this.userModel.id}`,\n\t\t\t\tbindOptions: {forceBindPosition: true}\n\t\t\t}\n\t\t});\n\n\t\tthis.connectionStats = {};\n\t\tthis.connectionStatsVisible = false;\n\n\t\tthis.avatarBackground = config.avatarBackground || Util.getAvatarBackground();\n\n\t\tthis.removeAvatarPulseTimer = null;\n\t\tthis.hideUserNameTimer = null;\n\t};\n\n\tinitUserNameState()\n\t{\n\t\tif (this._alwaysShowName)\n\t\t{\n\t\t\tthis.toggleStateUserName(true);\n\t\t}\n\t}\n\n\tget id()\n\t{\n\t\treturn this.userModel.id\n\t}\n\n\tget allowPinButton()\n\t{\n\t\treturn this._allowPinButton;\n\t}\n\n\tset allowPinButton(allowPinButton)\n\t{\n\t\tif (this._allowPinButton == allowPinButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._allowPinButton = allowPinButton;\n\t\tthis.update()\n\t}\n\n\tget audioTrack()\n\t{\n\t\treturn this._audioTrack;\n\t}\n\n\tset audioTrack(audioTrack: ?MediaStreamTrack)\n\t{\n\t\tif (this._audioTrack === audioTrack)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._audioTrack = audioTrack;\n\n\t\tif (!this._audioTrack)\n\t\t{\n\t\t\tUtil.sendLog({\n\t\t\t\tdescription: 'trying to set not defined audioTrack!',\n\t\t\t\tuserModelId: this.userModel?.id,\n\t\t\t});\n\t\t}\n\n\t\tthis._audioStream = this._audioTrack ? new MediaStream([this._audioTrack]) : null;\n\t\tthis.playAudio()\n\t}\n\n\tget audioStream()\n\t{\n\t\treturn this._audioStream;\n\t}\n\n\tget screenAudioTrack()\n\t{\n\t\treturn this._screenAudioTrack;\n\t}\n\n\tset screenAudioTrack(screenAudioTrack: ?MediaStreamTrack)\n\t{\n\t\tif (this._screenAudioTrack === screenAudioTrack)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._screenAudioTrack = screenAudioTrack;\n\t\tthis._screenAudioStream = this._screenAudioTrack ? new MediaStream([this._screenAudioTrack]) : null;\n\t\tthis.playScreenAudio()\n\t}\n\n\tget screenAudioStream()\n\t{\n\t\treturn this._screenAudioStream;\n\t}\n\n\tget flipVideo()\n\t{\n\t\treturn this._flipVideo;\n\t}\n\n\tset flipVideo(flipVideo)\n\t{\n\t\tthis._flipVideo = flipVideo;\n\t\tthis.update()\n\t}\n\n\tget stream(): ?MediaStream\n\t{\n\t\treturn this._stream;\n\t}\n\n\tget visible()\n\t{\n\t\treturn this._visible;\n\t}\n\n\tset visible(visible)\n\t{\n\t\tif (this._visible !== visible)\n\t\t{\n\t\t\tthis._visible = visible;\n\t\t\tthis.update();\n\t\t\tthis.updateRendererState();\n\t\t}\n\t}\n\n\tget videoRenderer()\n\t{\n\t\treturn this._videoRenderer;\n\t}\n\n\tset videoRenderer(videoRenderer)\n\t{\n\t\t// we should to reset old video track after switching from a plain call\n\t\t// in order to properly check the camera video in hasCameraVideo\n\t\tif (this._videoTrack)\n\t\t{\n\t\t\tthis._videoTrack = null;\n\t\t}\n\n\t\tif (this._badNetworkIndicator)\n\t\t{\n\t\t\t// Voximplant calls logic with support of streams disabling\n\t\t\tif (videoRenderer.stream)\n\t\t\t{\n\t\t\t\tthis._tempVideoRenderer = videoRenderer;\n\t\t\t\tthis._videoRenderer = null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._tempVideoRenderer = this._videoRenderer = null;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Bitrix calls logic with support of preview\n\t\t\tthis._tempVideoRenderer = null;\n\t\t\tconst currentVideoRendererKind = this._videoRenderer?.kind;\n\t\t\tconst newVideoRendererKind = videoRenderer?.kind;\n\n\t\t\tif (videoRenderer?.stream)\n\t\t\t{\n\t\t\t\tif (newVideoRendererKind === 'sharing' && currentVideoRendererKind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis._previewRenderer = this._videoRenderer;\n\t\t\t\t\tthis._videoRenderer = videoRenderer;\n\t\t\t\t}\n\t\t\t\telse if (newVideoRendererKind === 'video' && currentVideoRendererKind === 'sharing')\n\t\t\t\t{\n\t\t\t\t\tthis._previewRenderer = videoRenderer;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._videoRenderer = videoRenderer;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (newVideoRendererKind === 'sharing')\n\t\t\t\t{\n\t\t\t\t\tif (currentVideoRendererKind === 'sharing')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._videoRenderer = this._previewRenderer;\n\t\t\t\t\t}\n\t\t\t\t\tthis._previewRenderer = null;\n\t\t\t\t\tdelete this.connectionStats[MediaStreamsKinds.Screen];\n\t\t\t\t}\n\t\t\t\telse if (newVideoRendererKind === 'video')\n\t\t\t\t{\n\t\t\t\t\tif (currentVideoRendererKind === 'sharing')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._previewRenderer = null;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._videoRenderer = null;\n\t\t\t\t\t}\n\t\t\t\t\tdelete this.connectionStats[MediaStreamsKinds.Camera];\n\t\t\t\t}\n\t\t\t\tthis.showConnectionStats();\n\t\t\t}\n\t\t}\n\n\t\tthis.update();\n\t\tthis.updateRendererState();\n\t}\n\n\tget previewRenderer()\n\t{\n\t\treturn this._previewRenderer;\n\t}\n\n\tget videoTrack()\n\t{\n\t\treturn this._videoTrack;\n\t}\n\n\tset videoTrack(videoTrack: MediaStreamTrack)\n\t{\n\t\tif (this._videoTrack === videoTrack)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._videoTrack = videoTrack;\n\t\tif (this._videoTrack && this._stream)\n\t\t{\n\t\t\tthis._stream.removeTrack(this._stream.getVideoTracks()[0]);\n\t\t\tthis._stream.addTrack(this._videoTrack);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._stream = this._videoTrack ? new MediaStream([this._videoTrack]) : null;\n\t\t}\n\n\t\tthis.update();\n\t}\n\n\tset badNetworkIndicator(badNetworkIndicator)\n\t{\n\t\tif (this._badNetworkIndicator === badNetworkIndicator)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._badNetworkIndicator = badNetworkIndicator;\n\t\tif (this._badNetworkIndicator)\n\t\t{\n\t\t\tif (this._videoRenderer)\n\t\t\t{\n\t\t\t\tthis._tempVideoRenderer = this._videoRenderer;\n\t\t\t\tthis._videoRenderer = null;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this._tempVideoRenderer)\n\t\t\t{\n\t\t\t\tthis._videoRenderer = this._tempVideoRenderer;\n\t\t\t\tthis._tempVideoRenderer = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.update();\n\t}\n\n\tset hasConnectionProblem(hasConnectionProblem)\n\t{\n\t\tthis._hasConnectionProblem = hasConnectionProblem;\n\t\tif (this._hasConnectionProblem)\n\t\t{\n\t\t\tthis.elements.connectionProblem.classList.add('connection-problem-visible');\n\t\t}\n\t\telse {\n\t\t\tthis.elements.connectionProblem.classList.remove('connection-problem-visible');\n\t\t}\n\t}\n\n\tset connectionQuality(connectionQuality)\n\t{\n\t\tthis._connectionQuality = connectionQuality;\n\n\t\tconst connectionQualityIcons = {\n\t\t\texcellent: '--excellent-quality-icon',\n\t\t\tgood: '--good-quality-icon',\n\t\t\tpoor: '--poor-quality-icon',\n\t\t\tbad: '--bad-quality-icon',\n\t\t}\n\n\t\tif (this._connectionQuality !== undefined && this.elements.connectionQualityIcon)\n\t\t{\n\t\t\tlet resultIcon = connectionQualityIcons.bad;\n\n\t\t\tif (this._connectionQuality >= 4)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.excellent;\n\t\t\t}\n\n\t\t\tif (this._connectionQuality >= 3 && this._connectionQuality < 4)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.good;\n\t\t\t}\n\n\t\t\tif (this._connectionQuality >= 2 && this._connectionQuality < 3)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.poor;\n\t\t\t}\n\n\t\t\tif (this._connectionQuality < 2)\n\t\t\t{\n\t\t\t\tresultIcon = connectionQualityIcons.bad;\n\t\t\t}\n\n\t\t\tthis.elements.connectionQualityIcon.style.setProperty('--connection-quality-icon', `var(${resultIcon})`);\n\t\t}\n\t}\n\n\tisVisibleMediaStateIcon(isActive)\n\t{\n\t\treturn !isActive && this.userModel.state === UserState.Connected;\n\t};\n\n\tisVisibleCameraStateIcon()\n\t{\n\t\treturn this.isVisibleMediaStateIcon(this.userModel.cameraState);\n\t};\n\n\tisVisibleMicStateIcon()\n\t{\n\t\treturn this.isVisibleMediaStateIcon(this.userModel.microphoneState);\n\t};\n\n\tshowStats(stats)\n\t{\n\t\tthis.connectionStats = stats;\n\t\tif (this.elements.statsOverlay && this.connectionStatsVisible)\n\t\t{\n\t\t\tthis.showConnectionStats();\n\t\t}\n\t}\n\n\tshowTrackSubscriptionFailed(track)\n\t{\n\t\tthis._tracksSubscriptionFailed[track.sid] = track;\n\t}\n\n\t_formatFailedSubscribtionTracks()\n\t{\n\t\tlet result = '';\n\n\t\tfor (let track in this._tracksSubscriptionFailed)\n\t\t{\n\t\t\tresult += (this._tracksSubscriptionFailed[track].source + ` ` + track + `\\n`);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: {className: 'bx-messenger-videocall-user'},\n\t\t\tdataset: {userId: this.userModel.id, order: this.userModel.order},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.videoBorder = Dom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-border',\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\tthis.elements.container = Dom.create('div', {\n\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-inner'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.avatarContainer = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-border'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar'},\n\t\t\t\t\t\t\t\t\ttext: ''\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-overlay-border'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-pulse-element', style: 'animation-delay: -2s;'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-pulse-element', style: 'animation-delay: -1.5s;'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-pulse-element', style: 'animation-delay: -1s;'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-avatar-pulse-element', style: 'animation-delay: -0.5s;'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.panel = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-panel'}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.state = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-status-text'},\n\t\t\t\t\t\t\ttext: this.getStateMessage(this.userModel.state)\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-user-bottom-gradient' },\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.userBottomContainer = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-bottom'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.nameContainer = Dom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-name-container' + ((this.userModel.allowRename && !this.userModel.wasRenamed) ? ' hidden' : '')},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.name = Dom.create('span', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-name', title: (this.screenSharingUser ? BX.message('IM_CALL_USERS_SCREEN').replace('#NAME#', this.userModel.name) : this.userModel.name)},\n\t\t\t\t\t\t\t\t\t\t\ttext: (this.screenSharingUser ? BX.message('IM_CALL_USERS_SCREEN').replace('#NAME#', this.userModel.name) : this.userModel.name),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameIcon = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-name-icon bx-messenger-videocall-user-change-name-icon hidden'},\n\t\t\t\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.changeNameContainer = Dom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-change-name-container hidden'},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameCancel = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-change-name-cancel'},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameInput = Dom.create('input', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-change-name-input'\n\t\t\t\t\t\t\t\t\t\t\t}, attrs: {\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'text', value: this.userModel.name, placeholder: BX.message('IM_CALL_GUEST_INPUT_NAME')\n\t\t\t\t\t\t\t\t\t\t\t}, events: {\n\t\t\t\t\t\t\t\t\t\t\t\tkeydown: this.onNameInputKeyDown.bind(this),\n\t\t\t\t\t\t\t\t\t\t\t\tfocus: this.callBacks.onUserRenameInputFocus,\n\t\t\t\t\t\t\t\t\t\t\t\tblur: this.callBacks.onUserRenameInputBlur,\n\t\t\t\t\t\t\t\t\t\t\t\tclick: function(event) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameConfirm = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-change-name-confirm'},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tclick: this.changeName.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tthis.elements.changeNameLoader = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-change-name-loader hidden'},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-change-name-loader-icon'}\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.introduceYourselfContainer = Dom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-introduce-yourself-container' + (!this.userModel.allowRename || this.userModel.wasRenamed ? ' hidden' : '')},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-introduce-yourself-text'},\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('IM_CALL_GUEST_INTRODUCE_YOURSELF'),\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.toggleNameInput.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.floorRequest = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-floor-request bx-messenger-videocall-floor-request-icon'}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.statsOverlay = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-videocall-user-stats-overlay'},\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t],\n\t\t\tstyle: {\n\t\t\t\torder: this.userModel.order\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: function (e)\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onClick({\n\t\t\t\t\t\tuserId: this.id\n\t\t\t\t\t});\n\t\t\t\t}.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (this.userModel.talking)\n\t\t{\n\t\t\tthis.updateAvatarPulseState()\n\t\t}\n\n\t\tthis.elements.debugPanel = Dom.create('div', {\n\t\t\tprops: {className: 'bx-messenger-videocall-user-debug-panel'},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-debug-panel-button connection-stats'\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.connectionQualityIcon = Dom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-debug-panel-button-icon connection-quality-icon',\n\t\t\t\t\t\t\t\ttitle: BX.message('IM_M_CALL_CONNECTION_QUALITY_HINT'),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: e => {\n\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\tthis.connectionStatsVisible = !this.connectionStatsVisible;\n\t\t\t\t\t\t\tif (this.connectionStatsVisible)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.showConnectionStats();\n\t\t\t\t\t\t\t\tthis.elements.statsOverlay.classList.add('stats-overlay-visble');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.elements.statsOverlay.classList.remove('stats-overlay-visble');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.connectionProblem = Dom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-debug-panel-button connection-problem'\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-debug-panel-button-icon connection-problem-icon'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tmouseover: (e) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.hintManager.show(e.currentTarget, BX.message('IM_M_CALL_POOR_CONNECTION_WITH_USER'));\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tmouseout: (e) =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.hintManager.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.userModel.localUser)\n\t\t{\n\t\t\tthis.elements.root.classList.add('bx-messenger-videocall-user-self');\n\t\t}\n\n\t\tif (this.userModel.avatar !== '')\n\t\t{\n\t\t\tthis.elements.root.style.setProperty('--avatar', `url('${this.userModel.avatar}')`);\n\t\t\tthis.elements.avatar.innerText = '';\n\t\t\tthis.elements.root.style.removeProperty('--avatar-background');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.removeProperty('--avatar');\n\t\t\tthis.elements.root.style.setProperty('--avatar-background', this.avatarBackground);\n\t\t\tthis.elements.avatar.innerText = this.getAvatarInnerText();\n\t\t}\n\n\t\tthis.elements.videoContainer = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-messenger-videocall-video-container',\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.video = Dom.create('video', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-video', volume: 0, autoplay: true\n\t\t\t\t\t},\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tplaysinline: true, muted: true\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-preview',\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-preview-container',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.preview = Dom.create('video', {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-preview-video', volume: 0, autoplay: true,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\tplaysinline: true, muted: true\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t\tthis.elements.container.appendChild(this.elements.videoContainer);\n\n\t\tif (this.stream && this.stream.active)\n\t\t{\n\t\t\tthis.elements.video.srcObject = this.stream;\n\t\t}\n\n\t\tif (this.flipVideo)\n\t\t{\n\t\t\tthis.elements.video.classList.add('bx-messenger-videocall-video-flipped');\n\t\t}\n\t\tif (this.userModel.screenState)\n\t\t{\n\t\t\tthis.elements.video.classList.add('bx-messenger-videocall-video-contain');\n\t\t}\n\n\t\tif (this.isVisibleCameraStateIcon() && this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add('extra-padding');\n\t\t}\n\n\t\t//this.elements.nameContainer.appendChild(this.elements.micState);\n\n\t\t// todo: show button only if user have the permission to remove user\n\t\t/*this.elements.removeButton = Dom.create('div', {\n\t\t\tprops: {className: 'bx-messenger-videocall-user-close'}\n\t\t});\n\n\t\tthis.elements.container.appendChild(this.elements.removeButton);*/\n\n\t\tthis.elements.buttonBackground = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-icon background'\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-text'\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message('IM_CALL_CHANGE_BACKGROUND')\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: e => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tBackgroundDialog.open();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.elements.buttonMenu = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-icon menu'\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: e => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.showMenu();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!this._hiddenRemoteParticipantButtonMenu)\n\t\t{\n\t\t\tthis.elements.remoteParticipantButtonMenu = Dom.create('div', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button'\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-icon menu'\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: e => {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tthis.showRemoteParticipantMenu();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.elements.buttonPin = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-icon pin'\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-text'\n\t\t\t\t\t}, text: BX.message('IM_CALL_PIN')\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: (e) =>\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onPin({userId: this.userModel.id});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.elements.buttonUnPin = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button'\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-icon unpin'\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-messenger-videocall-user-panel-button-text'\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message('IM_CALL_UNPIN')\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick:  (e) =>\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tthis.callBacks.onUnPin();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.elements.userBottomContainer.appendChild(\n\t\t\tDom.create('div', {\n\t\t\t\tprops: {className: 'bx-messenger-videocall-user-device-state-container'},\n\t\t\t\tchildren: [\n\t\t\t\t\tthis.elements.micState = Dom.create('div', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: `bx-messenger-videocall-user-name-icon bx-messenger-videocall-user-device-state mic${\n\t\t\t\t\t\t\tthis.isVisibleMicStateIcon() ? '' : ' hidden'}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\tthis.elements.cameraState = Dom.create('div', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: `bx-messenger-videocall-user-name-icon bx-messenger-videocall-user-device-state camera${\n\t\t\t\t\t\t\tthis.isVisibleCameraStateIcon() ? '' : ' hidden'}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t}),\n\t\t);\n\n\t\tthis.updatePanelDeferred();\n\t\treturn this.elements.root;\n\t};\n\n\tshowConnectionStats()\n\t{\n\t\tif (!this.elements.statsOverlay)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet statsString = '';\n\n\t\tconst cameraStats = this.connectionStats?.[MediaStreamsKinds.Camera];\n\t\tconst screenStats = this.connectionStats?.[MediaStreamsKinds.Screen];\n\t\tconst audioStats = this.connectionStats?.[MediaStreamsKinds.Microphone];\n\n\t\tconst failedTracksResult = this._formatFailedSubscribtionTracks();\n\n\t\tif (failedTracksResult)\n\t\t{\n\t\t\tstatsString += 'Failed subscribe to:\\n';\n\t\t\tstatsString += failedTracksResult;\n\t\t}\n\n\t\tif (cameraStats || !screenStats)\n\t\t{\n\t\t\tstatsString += 'Video stats:\\n';\n\t\t\tstatsString += this._formatVideoStats(cameraStats);\n\t\t}\n\n\t\tif (screenStats)\n\t\t{\n\t\t\tstatsString += '\\n\\nScreen share stats:\\n';\n\t\t\tstatsString += this._formatVideoStats(screenStats);\n\t\t}\n\n\t\tif (audioStats)\n\t\t{\n\t\t\tstatsString += '\\n\\nAudio stats:\\n';\n\t\t\tstatsString += `Bitrate: ${audioStats?.bitrate || 0}\\n`;\n\t\t\tstatsString += `PacketsLost: ${audioStats?.packetsLostExtended || 0}\\n`;\n\t\t\tstatsString += `Codec: ${audioStats?.codecName || '-'}`;\n\t\t}\n\n\t\tthis.elements.statsOverlay.innerText = statsString;\n\t}\n\n\tsetIncomingVideoConstraints(width, height)\n\t{\n\t\tthis.incomingVideoConstraints.width = typeof (width) === 'undefined' ? this.incomingVideoConstraints.width : width;\n\t\tthis.incomingVideoConstraints.height = typeof (height) === 'undefined' ? this.incomingVideoConstraints.height : height;\n\n\t\tif (!this.videoRenderer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// vox low quality temporary workaround\n\t\t// (disabled to test quality)\n\t\t// if (this.incomingVideoConstraints.width >= 320 && this.incomingVideoConstraints.width <= 640)\n\t\t// {\n\t\t// \tthis.incomingVideoConstraints.width = 640;\n\t\t// }\n\t\t// if (this.incomingVideoConstraints.height >= 180 && this.incomingVideoConstraints.height <= 360)\n\t\t// {\n\t\t// \tthis.incomingVideoConstraints.height = 360;\n\t\t// }\n\n\t\tthis.videoRenderer.requestVideoSize(this.incomingVideoConstraints.width, this.incomingVideoConstraints.height);\n\t};\n\n\tupdateRendererState()\n\t{\n\t\t/*if (this.videoRenderer)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tthis.videoRenderer.enable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.videoRenderer.disable();\n\t\t\t}\n\t\t}*/\n\n\t\t/*if (this.elements.video && this.elements.video.srcObject)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tthis.elements.video.play();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.video.pause();\n\t\t\t}\n\t\t}*/\n\t};\n\n\t_onUserFieldChanged(event)\n\t{\n\t\tconst eventData = event.data;\n\n\t\tswitch (eventData.fieldName)\n\t\t{\n\t\t\tcase 'id':\n\t\t\t\treturn this.updateId();\n\t\t\tcase 'name':\n\t\t\t\treturn this.updateName();\n\t\t\tcase 'avatar':\n\t\t\t\treturn this.updateAvatar();\n\t\t\tcase 'state':\n\t\t\t\treturn this.updateState();\n\t\t\tcase 'talking':\n\t\t\t\treturn this.updateTalking();\n\t\t\tcase 'microphoneState':\n\t\t\t\treturn this.updateMicrophoneState();\n\t\t\tcase 'cameraState':\n\t\t\t\treturn this.updateCameraState();\n\t\t\tcase 'videoPaused':\n\t\t\t\treturn this.updateVideoPaused();\n\t\t\tcase 'floorRequestState':\n\t\t\t\treturn this.updateFloorRequestState();\n\t\t\tcase 'screenState':\n\t\t\t\treturn this.updateScreenState();\n\t\t\tcase 'pinned':\n\t\t\t\treturn this.updatePanel();\n\t\t\tcase 'allowRename':\n\t\t\t\treturn this.updateRenameAllowed();\n\t\t\tcase 'wasRenamed':\n\t\t\t\treturn this.updateWasRenamed();\n\t\t\tcase 'renameRequested':\n\t\t\t\treturn this.updateRenameRequested();\n\t\t\tcase 'order':\n\t\t\t\treturn this.updateOrder();\n\n\t\t}\n\t};\n\n\ttoggleRenameIcon()\n\t{\n\t\tif (!this.userModel.allowRename)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.changeNameIcon.classList.toggle('hidden');\n\t};\n\n\ttoggleNameInput(event)\n\t{\n\t\tif (!this.userModel.allowRename || !this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\n\t\tif (this.isChangingName)\n\t\t{\n\t\t\tthis.isChangingName = false;\n\t\t\tif (!this.userModel.wasRenamed)\n\t\t\t{\n\t\t\t\tthis.elements.introduceYourselfContainer.classList.remove('hidden');\n\t\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.userModel.wasRenamed)\n\t\t\t{\n\t\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t\t}\n\t\t\tthis.isChangingName = true;\n\t\t\tthis.elements.nameContainer.classList.add('hidden');\n\t\t\tthis.elements.changeNameContainer.classList.remove('hidden');\n\t\t\tthis.elements.changeNameInput.value = this.userModel.name;\n\t\t\tthis.elements.changeNameInput.focus();\n\t\t\tthis.elements.changeNameInput.select();\n\t\t}\n\t};\n\n\tonNameInputKeyDown(event)\n\t{\n\t\tif (!this.userModel.allowRename)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t//enter\n\t\tif (event.keyCode === 13)\n\t\t{\n\t\t\tthis.changeName(event);\n\t\t}\n\t\t//escape\n\t\telse if (event.keyCode === 27)\n\t\t{\n\t\t\tthis.toggleNameInput(event);\n\t\t}\n\t};\n\n\tonNameInputFocus(event)\n\t{\n\n\t};\n\n\tonNameInputBlur(event)\n\t{\n\n\t};\n\n\tchangeName(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tconst inputValue = this.elements.changeNameInput.value;\n\t\tconst newName = inputValue.trim();\n\t\tlet needToUpdate = true;\n\t\tif (newName === this.userModel.name || newName === '')\n\t\t{\n\t\t\tneedToUpdate = false;\n\t\t}\n\n\t\tif (needToUpdate)\n\t\t{\n\t\t\tthis.elements.changeNameConfirm.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameLoader.classList.toggle('hidden');\n\t\t\tthis.callBacks.onUserRename(newName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleNameInput(event);\n\t\t}\n\t};\n\n\tshowMenu()\n\t{\n\t\tconst menuItems = [];\n\n\t\tif (this.userModel.localUser && this.allowBackgroundItem)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: (this.allowMaskItem ? BX.message('IM_CALL_CHANGE_BG_MASK') : BX.message('IM_CALL_CHANGE_BACKGROUND')),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.close();\n\t\t\t\t\tBackgroundDialog.open();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (menuItems.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet rect = Dom.getRelativePosition(this.elements.buttonMenu, this.parentContainer)\n\t\tthis.menu = new Menu({\n\t\t\tid: 'call-view-user-menu-' + this.userModel.id,\n\t\t\tclassName: 'bx-call-user-context-menu',\n\t\t\tbackground: '#00428F',\n\t\t\tcontentBackground: '#00428F',\n\t\t\tdarkMode: true,\n\t\t\tcontentBorderRadius: '6px',\n\t\t\tborderRadius: '6px',\n\t\t\tbindElement: {\n\t\t\t\tleft: rect.left,\n\t\t\t\ttop: rect.top,\n\t\t\t\tbottom: rect.bottom\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t\ttargetContainer: this.parentContainer,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\tangle: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white', opacity: 0\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonPopupDestroy: () => this.menu = null\n\t\t\t}\n\t\t});\n\t\tthis.menu.show();\n\t};\n\n\tshowRemoteParticipantMenu()\n\t{\n\t\tif\t(this.remoteParticipantMenu)\n\t\t{\n\t\t\tthis.remoteParticipantMenu.destroy();\n\t\t\tthis.remoteParticipantMenu = null;\n\t\t}\n\n\t\tconst menuItems = [];\n\n\t\tif (!this.userModel.localUser)\n\t\t{\n\t\t\tif (this.userModel.microphoneState)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: BX.message('CALL_REMOTE_USER_DROPDOWN_MENU_TURN_OFF_MIC'),\n\t\t\t\t\tclassName: 'bx-call-remote-user-turn-off-mic',\n\t\t\t\t\tdisabled: !this.userModel.microphoneState,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.remoteParticipantMenu.destroy();\n\t\t\t\t\t\tthis.callBacks.onTurnOffParticipantMic({userId: this.userModel.id});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.userModel.cameraState)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: BX.message('CALL_REMOTE_USER_DROPDOWN_MENU_TURN_OFF_CAM'),\n\t\t\t\t\tclassName: 'bx-call-remote-user-turn-off-cam',\n\t\t\t\t\tdisabled: !this.userModel.cameraState,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.remoteParticipantMenu.destroy();\n\t\t\t\t\t\tthis.callBacks.onTurnOffParticipantCam({userId: this.userModel.id});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (this.userModel.screenState)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: BX.message('CALL_REMOTE_USER_DROPDOWN_MENU_TURN_OFF_SCREENSHARE'),\n\t\t\t\t\tclassName: 'bx-call-remote-user-turn-off-screenshare',\n\t\t\t\t\tdisabled: !this.userModel.screenState,\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.remoteParticipantMenu.destroy();\n\t\t\t\t\t\tthis.callBacks.onTurnOffParticipantScreenshare({userId: this.userModel.id});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (menuItems.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet rect = Dom.getRelativePosition(this.elements.remoteParticipantButtonMenu, this.parentContainer);\n\n\t\tthis.remoteParticipantMenu = new Menu({\n\t\t\tid: 'call-view-user-menu-' + this.userModel.id,\n\t\t\tclassName: 'bx-call-remote-user-menu-container',\n\t\t\tbackground: '#00428F',\n\t\t\tcontentBackground: '#00428F',\n\t\t\tcontentBorderRadius: '6px',\n\t\t\tborderRadius: '6px',\n\t\t\tbindElement: {\n\t\t\t\tleft: rect.left,\n\t\t\t\ttop: rect.top,\n\t\t\t\tbottom: rect.bottom\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t\ttargetContainer: this.parentContainer,\n\t\t\tdarkMode: true,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tangle: true,\n\t\t\toffsetTop: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white', opacity: 0\n\t\t\t},\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonShow: (event) =>\n\t\t\t\t{\n\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\tpopup.adjustPosition();\n\n\t\t\t\t\tthis.elements.root.classList.add('bx-messenger-videocall-user-dropdown-menu-opened');\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.elements.root.classList.remove('bx-messenger-videocall-user-dropdown-menu-opened');\n\t\t\t\t\tthis.remoteParticipantMenu = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.remoteParticipantMenu.show();\n\t};\n\n\tupdateAvatar()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tif (this.userModel.avatar !== '')\n\t\t\t{\n\t\t\t\tthis.elements.root.style.setProperty('--avatar', `url('${this.userModel.avatar}')`);\n\t\t\t\tthis.elements.avatar.innerText = '';\n\t\t\t\tthis.elements.root.style.removeProperty('--avatar-background');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.root.style.removeProperty('--avatar');\n\t\t\t\tthis.elements.root.style.setProperty('--avatar-background', this.avatarBackground);\n\t\t\t\tthis.elements.avatar.innerText = this.getAvatarInnerText();\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateId()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.root.dataset.userId = this.userModel.id;\n\t\t}\n\t};\n\n\tupdateName()\n\t{\n\t\tif (this.isChangingName)\n\t\t{\n\t\t\tthis.isChangingName = false;\n\t\t\tthis.elements.changeNameConfirm.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameLoader.classList.toggle('hidden');\n\t\t\tthis.elements.changeNameContainer.classList.add('hidden');\n\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t}\n\n\t\tif (this.elements.name)\n\t\t{\n\t\t\tthis.elements.name.innerText = this.screenSharingUser ? BX.message('IM_CALL_USERS_SCREEN').replace('#NAME#', this.userModel.name) : this.userModel.name;\n\t\t}\n\t\tif (this.userModel.avatar === '' && this.elements.avatar)\n\t\t{\n\t\t\tthis.elements.avatar.innerText = this.getAvatarInnerText();\n\t\t}\n\n\t};\n\n\tgetAvatarInnerText()\n\t{\n\t\treturn Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t}\n\n\tupdateRenameAllowed()\n\t{\n\t\tif (this.userModel.allowRename && this.elements.nameContainer && this.elements.introduceYourselfContainer)\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add('hidden');\n\t\t\tthis.elements.introduceYourselfContainer.classList.remove('hidden');\n\t\t}\n\t};\n\n\tupdateWasRenamed()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.allowRename)\n\t\t{\n\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t\tthis.elements.changeNameIcon.classList.remove('hidden');\n\t\t\tif (this.elements.changeNameContainer.classList.contains('hidden'))\n\t\t\t{\n\t\t\t\tthis.elements.nameContainer.classList.remove('hidden');\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateRenameRequested()\n\t{\n\t\tif (this.userModel.allowRename)\n\t\t{\n\t\t\tthis.elements.introduceYourselfContainer.classList.add('hidden');\n\t\t}\n\t};\n\n\tupdateOrder()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.root.dataset.order = this.userModel.order;\n\t\t\tthis.elements.root.style.order = this.userModel.order;\n\t\t}\n\t};\n\n\tupdatePanelDeferred()\n\t{\n\t\tsetTimeout(this.updatePanel.bind(this), 0);\n\t};\n\n\tupdatePanel()\n\t{\n\t\tif (!this.isMounted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst width = this.elements.root.offsetWidth;\n\t\tconst initialUpdate = !this.elements.panel.hasChildNodes();\n\n\t\tif (this.lastWIdth && this.lastWIdth === width && !initialUpdate)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst canChangeBackground = this.userModel.localUser && this.allowBackgroundItem;\n\t\tconst needChangeBackgroundButton = this.lastWIdth\n\t\t\t|| (this.lastWIdth <= 300 && width > 300)\n\t\t\t|| (this.lastWIdth > 300 && width <= 300);\n\t\tconst needChangePinButton = this.userModel.pinned && Boolean(this.elements.buttonPin.parentElement);\n\t\tconst needChangeUnPinButton = !this.userModel.pinned && Boolean(this.elements.buttonUnPin.parentElement);\n\t\tconst needToUpdate = initialUpdate\n\t\t\t|| (canChangeBackground && needChangeBackgroundButton)\n\t\t\t|| needChangePinButton\n\t\t\t|| needChangeUnPinButton;\n\n\t\tthis.lastWIdth = width;\n\n\t\tif (needToUpdate)\n\t\t{\n\t\t\tDom.clean(this.elements.panel);\n\t\t}\n\n\t\tif (canChangeBackground && (needChangeBackgroundButton || initialUpdate))\n\t\t{\n\t\t\tif (width > 300)\n\t\t\t{\n\t\t\t\tDom.append(this.elements.buttonBackground, this.elements.panel);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.append(this.elements.buttonMenu, this.elements.panel);\n\t\t\t}\n\t\t}\n\n\t\tif (this.allowPinButton)\n\t\t{\n\t\t\tif (initialUpdate || needChangePinButton || needChangeUnPinButton)\n\t\t\t{\n\t\t\t\tif (this.userModel.pinned)\n\t\t\t\t{\n\t\t\t\t\tDom.append(this.elements.buttonUnPin, this.elements.panel);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.append(this.elements.buttonPin, this.elements.panel);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (width > 250)\n\t\t\t{\n\t\t\t\tthis.elements.buttonPin.classList.remove('no-text');\n\t\t\t\tthis.elements.buttonUnPin.classList.remove('no-text');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.buttonPin.classList.add('no-text');\n\t\t\t\tthis.elements.buttonUnPin.classList.add('no-text');\n\t\t\t}\n\t\t}\n\n\t\tif (!this.userModel.localUser)\n\t\t{\n\t\t\tthis.currentBitrixCall = Util.getCurrentBitrixCall();\n\n\t\t\tthis.isShowRemoteParticipantButtonMenu =\n\t\t\t\tUtil.isUserControlFeatureEnabled()\n\t\t\t\t&& Util.canControlChangeSettings()\n\t\t\t\t&& (this.userModel.microphoneState || this.userModel.cameraState || this.userModel.screenState)\n\t\t\t\t&& this.currentBitrixCall\n\t\t\t\t&& this.currentBitrixCall.provider !== Provider.Plain;\n\t\t\t//&& !(this.currentBitrixCall.associatedEntity.type === 'chat' && this.currentBitrixCall.associatedEntity.advanced['chatType'] === 'videoconf');\n\n\t\t\tif (this.isShowRemoteParticipantButtonMenu && this.elements.remoteParticipantButtonMenu)\n\t\t\t{\n\t\t\t\tthis.elements.panel.appendChild(this.elements.remoteParticipantButtonMenu);\n\t\t\t}\n\t\t}\n\t};\n\n\tplayVideoElements(videoElement)\n\t{\n\t\tconst hasVideoEl = Boolean(videoElement);\n\t\tconst isCanPlaying = hasVideoEl && Boolean(videoElement.srcObject);\n\t\tconst isReadyPlaying = hasVideoEl && videoElement.readyState >= videoElement.HAVE_CURRENT_DATA;\n\t\tconst isEnded = hasVideoEl && videoElement.ended;\n\n\t\tif (isCanPlaying && isReadyPlaying && !isEnded)\n\t\t{\n\t\t\tvideoElement.play().catch(logPlaybackError);\n\t\t}\n\n\t\tif (isCanPlaying && isEnded)\n\t\t{\n\t\t\tvideoElement.load();\n\t\t}\n\n\t\tif (isCanPlaying && !isReadyPlaying && !isEnded && !videoElement.onloadeddata)\n\t\t{\n\t\t\tvideoElement.onloadeddata = () => {\n\t\t\t\tthis.playVideoElements(videoElement);\n\t\t\t};\n\t\t}\n\t}\n\n\tupdate()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.hasVideo()/* && this.visible*/)\n\t\t{\n\t\t\tif (this.visible)\n\t\t\t{\n\t\t\t\tif (this.videoRenderer)\n\t\t\t\t{\n\t\t\t\t\tthis.videoRenderer.render(this.elements.video);\n\t\t\t\t\tthis.playVideoElements(this.elements.video);\n\t\t\t\t\tif (this._previewRenderer)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._previewRenderer.render(this.elements.preview);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.elements.preview.srcObject = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (this.stream && this.elements.video.srcObject?.id !== this.stream?.id)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.video.srcObject = this.stream;\n\t\t\t\t\tthis.playVideoElements(this.elements.video);\n\t\t\t\t}\n\n\t\t\t\tif (this.elements.avatarContainer)\n\t\t\t\t{\n\t\t\t\t\tthis.elements.avatarContainer.classList.add('bx-messenger-videocall-hidden-avatar');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.videoRenderer?.kind === 'video' && this.flipVideo)\n\t\t\t{\n\t\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-flipped', this.flipVideo);\n\t\t\t\tthis.elements.preview.classList.toggle('bx-messenger-videocall-video-flipped', !this.flipVideo);\n\t\t\t}\n\t\t\telse if (this.videoRenderer?.kind === 'sharing' && this.flipVideo)\n\t\t\t{\n\t\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-flipped', !this.flipVideo);\n\t\t\t\tthis.elements.preview.classList.toggle('bx-messenger-videocall-video-flipped', this.flipVideo);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-flipped', this.flipVideo);\n\t\t\t}\n\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-contain', this.userModel.screenState);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.srcObject = null;\n\t\t\tthis.elements.preview.srcObject = null;\n\t\t\tif (this.elements.avatarContainer)\n\t\t\t{\n\t\t\t\tthis.elements.avatarContainer.classList.remove('bx-messenger-videocall-hidden-avatar');\n\t\t\t}\n\t\t}\n\t\tif (\n\t\t\tUtil.isCallServerAllowed()\n\t\t\t&& this.userModel.state === UserState.Connected\n\t\t\t&& !this.elements.debugPanel.parentElement\n\t\t\t&& !this.screenSharingUser\n\t\t)\n\t\t{\n\t\t\tthis.elements.container.appendChild(this.elements.debugPanel);\n\t\t}\n\t\tthis.updatePanelDeferred();\n\t};\n\n\tplayAudio()\n\t{\n\t\tif (!this.audioStream)\n\t\t{\n\t\t\tthis.elements.audio.srcObject = null;\n\n\t\t\tUtil.sendLog({\n\t\t\t\tdescription: 'no audioStream to play',\n\t\t\t\tuserModelId: this.userModel?.id,\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.speakerId && Type.isFunction(this.elements.audio.setSinkId))\n\t\t{\n\t\t\tthis.elements.audio.setSinkId(this.speakerId).then(function ()\n\t\t\t{\n\t\t\t\tthis.elements.audio.srcObject = this.audioStream;\n\t\t\t\tthis.elements.audio.play().catch(logPlaybackError);\n\t\t\t}.bind(this)).catch(console.error);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.audio.srcObject = this.audioStream;\n\t\t\tthis.elements.audio.play().catch(logPlaybackError);\n\t\t}\n\t};\n\n\tplayScreenAudio()\n\t{\n\t\tif (!this.screenAudioStream)\n\t\t{\n\t\t\tthis.elements.screenAudio.srcObject = null;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.screenAudio.srcObject = this.screenAudioStream;\n\t\tthis.elements.screenAudio.play().catch(logPlaybackError);\n\t}\n\n\tplayVideo()\n\t{\n\t\tthis.playVideoElements(this.elements.video);\n\t\tthis.playVideoElements(this.elements.preview);\n\t};\n\n\tblurVideo(blurState)\n\t{\n\t\tblurState = !!blurState;\n\n\t\tif (this.videoBlurState == blurState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoBlurState = blurState;\n\t\tif (this.elements.video)\n\t\t{\n\t\t\tthis.elements.video.classList.toggle('bx-messenger-videocall-video-blurred');\n\t\t}\n\t};\n\n\tgetStateMessage(userState, videoPaused)\n\t{\n\t\tswitch (userState)\n\t\t{\n\t\t\tcase UserState.Idle:\n\t\t\t\treturn '';\n\t\t\tcase UserState.Calling:\n\t\t\t\treturn BX.message('IM_M_CALL_STATUS_WAIT_ANSWER');\n\t\t\tcase UserState.Declined:\n\t\t\t\treturn BX.message('IM_M_CALL_STATUS_DECLINED');\n\t\t\tcase UserState.Ready:\n\t\t\tcase UserState.Connecting:\n\t\t\t\treturn BX.message('IM_M_CALL_STATUS_WAIT_CONNECT');\n\t\t\tcase UserState.Connected:\n\t\t\t\treturn videoPaused ? BX.message('IM_M_CALL_STATUS_VIDEO_PAUSED') : '';\n\t\t\tcase UserState.Failed:\n\t\t\t\treturn BX.message('IM_M_CALL_STATUS_CONNECTION_ERROR');\n\t\t\tcase UserState.Unavailable:\n\t\t\t\treturn BX.message('IM_M_CALL_STATUS_UNAVAILABLE');\n\t\t\tdefault:\n\t\t\t\treturn '';\n\t\t}\n\t};\n\n\n\tmount(parent, force)\n\t{\n\t\tforce = force === true;\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t\tthis.initUserNameState();\n\t\t}\n\n\t\tif (this.isMounted() && this.elements.root.parentElement == parent && !force)\n\t\t{\n\t\t\tthis.updatePanelDeferred();\n\t\t\treturn false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.checkAspectInterval = setInterval(this.checkVideoAspect.bind(this), 500);\n\t\t}\n\n\t\tparent.appendChild(this.elements.root);\n\t\tthis.update();\n\t};\n\n\tdismount()\n\t{\n\t\t// this.visible = false;\n\t\tif (!this.isMounted())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tclearInterval(this.checkAspectInterval);\n\t\tthis.elements.video.srcObject = null;\n\t\tthis.elements.preview.srcObject = null;\n\t\tDom.remove(this.elements.root);\n\t};\n\n\tisMounted()\n\t{\n\t\treturn !!(this.elements.root && this.elements.root.parentElement);\n\t};\n\n\tupdateState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.userModel.state == UserState.Calling || this.userModel.state == UserState.Connecting)\n\t\t{\n\t\t\tthis.updateAvatarPulseState();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addAvatarPulseTimer();\n\t\t}\n\n\t\tif (this.userModel.state == UserState.Idle)\n\t\t{\n\t\t\tthis._videoRenderer = null;\n\t\t\tthis._previewRenderer = null;\n\t\t\tthis._audioTrack = null;\n\t\t\tthis._audioStream = null;\n\t\t}\n\n\t\tthis.elements.state.innerText = this.getStateMessage(this.userModel.state, this.userModel.videoPaused);\n\n\t\tthis.updateMicrophoneState()\n\t\tthis.updateCameraState()\n\n\t\tthis.update();\n\t};\n\n\tupdateTalking()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.talking)\n\t\t{\n\t\t\tthis.updateAvatarPulseState();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addAvatarPulseTimer();\n\t\t}\n\t};\n\n\tupdateMicrophoneState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.micState.classList.add('hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.micState.classList.remove('hidden');\n\t\t\tthis.clearAvatarPulseTimer();\n\t\t}\n\n\t\tif (this.isVisibleCameraStateIcon() && this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add('extra-padding');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.remove('extra-padding');\n\t\t}\n\n\t\tthis.updateRemoteParticipantMenuState();\n\t};\n\n\tupdateCameraState()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.isVisibleCameraStateIcon())\n\t\t{\n\t\t\tthis.elements.cameraState.classList.add('hidden');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.cameraState.classList.remove('hidden');\n\t\t}\n\n\t\tif (this.isVisibleCameraStateIcon() && this.isVisibleMicStateIcon())\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.add('extra-padding');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.remove('extra-padding');\n\t\t}\n\n\t\tthis.updateRemoteParticipantMenuState();\n\t};\n\n\tupdateRemoteParticipantMenuState()\n\t{\n\t\tif (this.remoteParticipantMenu)\n\t\t{\n\t\t\tthis.showRemoteParticipantMenu();\n\t\t}\n\n\t\tthis.updatePanelDeferred();\n\t}\n\n\tupdateVideoPaused()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\n\t\t}\n\t\tif (this.stream && this.hasVideo())\n\t\t{\n\t\t\tthis.blurVideo(this.userModel.videoPaused);\n\t\t}\n\t\tthis.updateState();\n\t};\n\n\tupdateFloorRequestState()\n\t{\n\t\tif (!this.elements.floorRequest || this._hiddenFloorRequest)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.floorRequestState)\n\t\t{\n\t\t\tthis.elements.floorRequest.classList.add('active');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.floorRequest.classList.remove('active');\n\t\t}\n\t};\n\n\tupdateScreenState()\n\t{\n\t\tif (!this.elements.video)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.userModel.screenState)\n\t\t{\n\t\t\tthis.elements.video.classList.add('bx-messenger-videocall-video-contain');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.classList.remove('bx-messenger-videocall-video-contain');\n\t\t}\n\t};\n\n\thide()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.root.dataset.hidden = 1;\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdelete this.elements.root.dataset.hidden;\n\t};\n\n\thasAudio()\n\t{\n\t\tconst isConnected = this.userModel.state === UserState.Connected;\n\t\tconst hasAudioTrack = Boolean(this._audioTrack) || Boolean(this._screenAudioTrack);\n\t\treturn isConnected && hasAudioTrack;\n\t}\n\n\thasVideo()\n\t{\n\t\tif (Hardware.maxLocalStreamQualityHeight === LOCAL_STREAM_QUALITY_HEIGHT.NO_VIDEO)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.userModel.state == UserState.Connected && (!!this._videoTrack || !!this._videoRenderer);\n\t}\n\n\thasCameraVideo()\n\t{\n\t\treturn this.userModel.state == UserState.Connected && (!!this._videoTrack || this._videoRenderer?.kind === 'video' || this._previewRenderer?.kind === 'video');\n\t}\n\n\tcheckVideoAspect()\n\t{\n\t\tif (!this.elements.video)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.elements.video.videoHeight > this.elements.video.videoWidth)\n\t\t{\n\t\t\tthis.elements.video.classList.add('bx-messenger-videocall-video-vertical');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.video.classList.remove('bx-messenger-videocall-video-vertical');\n\t\t}\n\t};\n\n\treleaseStream()\n\t{\n\t\tif (this._videoRenderer && !this._previewRenderer)\n\t\t{\n\t\t\tif (this.elements.video)\n\t\t\t{\n\t\t\t\tthis.elements.video.srcObject = null;\n\t\t\t}\n\t\t\tthis._videoRenderer = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.elements.video)\n\t\t\t{\n\t\t\t\tthis.elements.video.srcObject = null;\n\t\t\t}\n\t\t\tthis.videoTrack = null;\n\t\t}\n\t};\n\n\t_getVideoStats(videoStats) {\n\t\tlet resultString = '';\n\t\tlet limitationsString = '';\n\n\t\tresultString += `Bitrate: ${videoStats?.bitrate || 0}\\n`;\n\t\tresultString += `Track ID: ${videoStats?.trackIdentifier || 'no track id!'}\\n`;\n\t\tresultString += `PacketsLost: ${videoStats?.packetsLostExtended || 0}\\n`;\n\t\tresultString += `Codec: ${videoStats?.codecName || '-'}\\n`;\n\t\tresultString += `Resolution: ${videoStats?.frameWidth || 0}x${videoStats?.frameHeight || 0} \\n`;\n\t\tresultString += `In Remote Tracks: ${videoStats?.inRemoteTracks || 'U'} \\n`;\n\n\t\tif (videoStats?.qualityLimitationReason)\n\t\t{\n\t\t\tresultString += `(changes:${videoStats.qualityLimitationResolutionChanges}, FPS: ${videoStats?.framesPerSecond || 0})`;\n\t\t\tlimitationsString = `Limitation: ${videoStats.qualityLimitationReason}`;\n\t\t\tlimitationsString += ` (duration: ${Object.entries(videoStats.qualityLimitationDurations || {}).reduce(\n\t\t\t\t(accumulator, value, index) => accumulator + `${index ? ', ' : ''}` + `${value[0]}: ${value[1]}`,\n\t\t\t\t'',\n\t\t\t)})`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresultString += `(${videoStats?.framesPerSecond || 0} FPS)`;\n\t\t}\n\n\t\treturn ({\n\t\t\tresultString,\n\t\t\tlimitationsString,\n\t\t})\n\t}\n\n\t_formatVideoStats(videoStats)\n\t{\n\t\tlet result = '';\n\t\tlet limitations = '';\n\t\tif (Type.isArray(videoStats))\n\t\t{\n\t\t\tvideoStats.forEach((stats, trackIndex) =>\n\t\t\t{\n\t\t\t\tif (trackIndex)\n\t\t\t\t{\n\t\t\t\t\tresult += `\\n\\n`;\n\t\t\t\t}\n\n\t\t\t\tif (videoStats.length > 1)\n\t\t\t\t{\n\t\t\t\t\tresult += `Track ${trackIndex+1}\\n`;\n\t\t\t\t}\n\n\t\t\t\tconst {resultString, limitationsString} = this._getVideoStats(stats);\n\n\t\t\t\tif (resultString)\n\t\t\t\t{\n\t\t\t\t\tresult += resultString;\n\t\t\t\t}\n\n\t\t\t\tif (limitationsString)\n\t\t\t\t{\n\t\t\t\t\tlimitations = limitationsString;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst {resultString, limitationsString} = this._getVideoStats(videoStats);\n\n\t\t\tif (resultString)\n\t\t\t{\n\t\t\t\tresult += resultString;\n\t\t\t}\n\n\t\t\tif (limitationsString)\n\t\t\t{\n\t\t\t\tlimitations = limitationsString;\n\t\t\t}\n\t\t}\n\n\t\treturn limitations ? `${limitations}\\n\\n${result}` : result;\n\t};\n\n\ttoggleStateUserName(isActive)\n\t{\n\t\tif (!this.elements.nameContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst activeClassName = 'active';\n\t\tconst hasActiveClass = this.elements.nameContainer.classList.contains(activeClassName);\n\n\t\tif (hasActiveClass !== isActive)\n\t\t{\n\t\t\tthis.elements.nameContainer.classList.toggle(activeClassName);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.hintManager)\n\t\t{\n\t\t\tthis.hintManager.hide();\n\t\t\tthis.hintManager = null;\n\t\t}\n\t\tthis.userModel.unsubscribe('changed', this._onUserFieldChangedHandler);\n\t\tthis.releaseStream();\n\t\tclearInterval(this.checkAspectInterval);\n\t};\n\n\taddAvatarPulseTimer()\n\t{\n\t\tif (this.removeAvatarPulseTimer)\n\t\t{\n\t\t\tclearTimeout(this.removeAvatarPulseTimer);\n\t\t\tthis.removeAvatarPulseTimer = null;\n\t\t}\n\n\t\tthis.removeAvatarPulseTimer = setTimeout(() => {\n\t\t\tthis.elements.avatarContainer.classList.remove('bx-messenger-videocall-user-avatar-pulse');\n\t\t\tthis.elements.root.classList.remove('bx-messenger-videocall-user-talking');\n\t\t}, 1000);\n\t}\n\n\tclearAvatarPulseTimer()\n\t{\n\t\tif (this.removeAvatarPulseTimer)\n\t\t{\n\t\t\tclearTimeout(this.removeAvatarPulseTimer);\n\t\t\tthis.removeAvatarPulseTimer = null;\n\t\t}\n\n\t\tthis.elements.avatarContainer.classList.remove('bx-messenger-videocall-user-avatar-pulse');\n\t\tthis.elements.root.classList.remove('bx-messenger-videocall-user-talking');\n\t}\n\n\tupdateAvatarPulseState()\n\t{\n\t\tif (this.removeAvatarPulseTimer)\n\t\t{\n\t\t\tclearTimeout(this.removeAvatarPulseTimer);\n\t\t\tthis.removeAvatarPulseTimer = null;\n\t\t}\n\n\t\tthis.elements.avatarContainer.classList.add('bx-messenger-videocall-user-avatar-pulse');\n\n\t\tif (this.userModel.talking)\n\t\t{\n\t\t\tthis.elements.root.classList.add('bx-messenger-videocall-user-talking');\n\t\t}\n\t}\n}","import {Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Util } from 'call.core';\n\nexport class FloorRequest extends EventEmitter\n{\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(\"BX.Call.FloorRequest\");\n\n\t\tthis.hideTime = BX.prop.getInteger(config, \"hideTime\", 10);\n\t\t//this.isShowAllowPermissionButton = BX.prop.getBoolean(config, 'isShowAllowPermissionButton', false);\n\t\tthis.userModel = config.userModel;\n\t\t\n\t\tthis.isShowAllowPermissionButton = this._canChangeSpeakPermission();\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonAllowSpeakPermissionClicked:\n\t\t\t\tBX.type.isFunction(config.onAllowSpeakPermissionClicked)\n\t\t\t\t\t? config.onAllowSpeakPermissionClicked\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonDisallowSpeakPermissionClicked:\n\t\t\t\tBX.type.isFunction(config.onDisallowSpeakPermissionClicked)\n\t\t\t\t\t? config.onDisallowSpeakPermissionClicked\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonDestroy:\n\t\t\t\tBX.type.isFunction(config.onDestroy)\n\t\t\t\t\t? config.onDestroy\n\t\t\t\t\t: BX.DoNothing,\n\t\t};\n\n\t\tthis._hideTimeout = null;\n\t\tthis.container = null;\n\t\tthis._onUserModelChangedHandler = this._onUserModelChanged.bind(this);\n\t\tthis.userModel.subscribe(\"changed\", this._onUserModelChangedHandler);\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new FloorRequest(config);\n\t};\n\t\n\t_canChangeSpeakPermission()\n\t{\n\t\treturn (\n\t\t\tUtil.isUserControlFeatureEnabled()\n\t\t\t&& !this.userModel.permissionToSpeak\n\t\t\t&& !Util.getRoomPermissions().AudioEnabled\n\t\t\t&& Util.canControlGiveSpeakPermission()\n\t\t);\n\t}\n\n\tmount(container)\n\t{\n\t\tthis.container = container;\n\t\tthis.container.appendChild(this.render());\n\t\tthis.scheduleDismount();\n\t};\n\t\n\tupdatePermissionButtonState()\n\t{\n\t\tthis.isShowAllowPermissionButton = this._canChangeSpeakPermission();\n\t\t\n\t\tif (this.elements)\n\t\t{\n\t\t\tBX.remove(this.elements.root);\n\t\t\tthis.elements.root = null;\n\t\t}\n\t\t\n\t\tthis.container.appendChild(this.render());\n\t}\n\n\tdismount()\n\t{\n\t\tif (this.elements)\n\t\t{\n\t\t\tBX.remove(this.elements.root);\t\t\t\n\t\t}\n\n\t\tthis.destroy();\n\t};\n\n\tonCloseClicked(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif(this.isShowAllowPermissionButton)\n\t\t{\n\t\t\tthis.callbacks.onDisallowSpeakPermissionClicked(this.userModel);\n\t\t}\n\t\tthis.dismount();\n\t}\n\n\tdismountWithAnimation()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.elements.root.classList.add(\"closing\");\n\n\t\tthis.elements.root.addEventListener(\"animationend\", () => this.dismount());\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\t\t\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-floor-request-notification\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-icon-container\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.avatar = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-avatar\"},\n\t\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-icon bx-messenger-videocall-floor-request-icon\"}\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\n\t\t\t\tthis.elements.name = Dom.create(\"span\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-text-container\"},\n\t\t\t\t\thtml: BX.message(\"IM_CALL_WANTS_TO_SAY_\" + (this.userModel.gender == \"F\" ? \"F\" : \"M\")).replace(\"#NAME#\", '<span class =\"bx-call-view-floor-request-notification-text-name\">' + BX.util.htmlspecialchars(this.userModel.name) + '</span>')\n\t\t\t\t}),\n\n\t\t\t\t(this.isShowAllowPermissionButton ? this.createAllowPermissionButton() : null),\n\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-floor-request-notification-close\"},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this.onCloseClicked.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tif (this.userModel.avatar)\n\t\t{\n\t\t\tthis.elements.avatar.style.setProperty(\"--avatar\", \"url('\" + this.userModel.avatar + \"')\");\n\t\t\tthis.elements.avatar.innerText = '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.avatar.style.setProperty(\"--avatar-background\", \"var(--call-view__floor-request-notification-avatar-background-color)\");\n\t\t\tthis.elements.avatar.innerText = Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t\t}\n\n\t\treturn this.elements.root\n\t};\n\n\tscheduleDismount()\n\t{\n\t\treturn;\n\t\tthis._hideTimeout = setTimeout(this.dismountWithAnimation.bind(this), this.hideTime * 1000);\n\t};\n\n\tcreateAllowPermissionButton()\n\t{\n\t\treturn new BX.UI.Button({\n\t\t\tbaseClass: \"ui-btn ui-btn-icon-mic\",\n\t\t\ttext: BX.message(\"CALL_RAISE_HAND_NOTIFY_ALLOW\"),\n\t\t\tsize: BX.UI.Button.Size.EXTRA_SMALL,\n\t\t\tcolor: BX.UI.Button.Color.LIGHT_BORDER,\n\t\t\tnoCaps: true,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis._allowPermissionHandler();\n\t\t\t\t}\n\t\t\t}\n\t\t}).render();\n\t}\n\n\t_allowPermissionHandler()\n\t{\n\t\tthis.callbacks.onAllowSpeakPermissionClicked(this.userModel);\n\t\tthis.dismount();\n\t};\n\n\t_onUserModelChanged(event)\n\t{\n\t\tvar eventData = event.data;\n\n\t\tif (eventData.fieldName == \"floorRequestState\" && !this.userModel.floorRequestState)\n\t\t{\n\t\t\tthis.dismountWithAnimation();\n\t\t}\n\n\t\tif (this.userModel.avatar === '' && this.elements.avatar)\n\t\t{\n\t\t\tthis.elements.avatar.innerText = Utils.text.getFirstLetters(this.userModel.name).toUpperCase();\n\t\t}\n\n\t\tif (this.elements.name)\n\t\t{\n\t\t\tthis.elements.name.innerHtml = BX.message(\"IM_CALL_WANTS_TO_SAY_\" + (this.userModel.gender == \"F\" ? \"F\" : \"M\")).replace(\"#NAME#\", '<span class =\"bx-call-view-floor-request-notification-text-name\">' + BX.util.htmlspecialchars(this.userModel.name) + '</span>');\n\t\t}\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.callbacks.onDestroy();\n\n\t\tclearTimeout(this._hideTimeout);\n\t\tthis._hideTimeout = null;\n\t\tthis.elements = null;\n\t\tif (this.userModel)\n\t\t{\n\t\t\tthis.userModel.unsubscribe(\"changed\", this._onUserModelChangedHandler);\n\t\t\tthis.userModel = null;\n\t\t}\n\t\tthis.emit(\"onDestroy\", {});\n\t}\n}\n","const maximumNotifications = 5;\n\nlet instance;\n\nexport class NotificationManager\n{\n\tconstructor()\n\t{\n\t\tthis.maxNotification = maximumNotifications;\n\t\tthis.notifications = [];\n\t};\n\n\tstatic get Instance()\n\t{\n\t\tif (!instance)\n\t\t{\n\t\t\tinstance = new NotificationManager()\n\t\t}\n\n\t\treturn instance;\n\t}\n\n\taddNotification(notification)\n\t{\n\t\tnotification.subscribe(\"onDestroy\", () => this.onNotificationDestroy(notification));\n\t\tthis.notifications.push(notification);\n\n\t\tif (this.notifications.length > this.maxNotification)\n\t\t{\n\t\t\tconst firstNotification = this.notifications.shift();\n\t\t\tfirstNotification.dismount();\n\t\t}\n\t};\n\n\tonNotificationDestroy(notification)\n\t{\n\t\tconst index = this.notifications.indexOf(notification);\n\n\t\tif (index != -1)\n\t\t{\n\t\t\tthis.notifications.splice(index, 1);\n\t\t}\n\t};\n}","import { Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Hardware } from '../call_hardware';\nimport { BackgroundDialog } from '../dialogs/background_dialog';\nimport 'ui.switcher';\nimport Util from '../util';\nimport { CallSettingsManager } from 'call.lib.settings-manager';\nimport { STREAM_QUALITY } from '../stream_quality';\nimport { Provider } from '../engine/engine';\n\nconst DeviceSelectorEvents = {\n\tonMicrophoneSelect: 'onMicrophoneSelect',\n\tonMicrophoneSwitch: 'onMicrophoneSwitch',\n\tonCameraSelect: 'onCameraSelect',\n\tonCameraSwitch: 'onCameraSwitch',\n\tonSpeakerSelect: 'onSpeakerSelect',\n\tonSpeakerSwitch: 'onSpeakerSwitch',\n\tonChangeHdVideo: 'onChangeHdVideo',\n\tonChangeMicAutoParams: 'onChangeMicAutoParams',\n\tonChangeFaceImprove: 'onChangeFaceImprove',\n\tonChangeVideoQuality: 'onChangeVideoQuality',\n\tonAdvancedSettingsClick: 'onOpenAdvancedSettingsClick',\n\tonShow: 'onShow',\n\tonDestroy: 'onDestroy',\n\tonChangeNoiseSuppression: 'onChangeNoiseSuppression',\n};\n\n/**\n * @param config\n * @param {Node} config.parentElement\n * @param {boolean} config.cameraEnabled\n * @param {boolean} config.microphoneEnabled\n * @param {boolean} config.speakerEnabled\n * @param {boolean} config.allowHdVideo\n * @param {boolean} config.faceImproveEnabled\n * @param {object} config.events\n\n * @returns {DeviceSelector}\n */\n\n/**\n * @param config\n * @param {Node} config.parentElement\n * @param {number} config.zIndex\n * @param {boolean} config.cameraEnabled\n * @param {boolean} config.microphoneEnabled\n * @param {boolean} config.speakerEnabled\n * @param {boolean} config.allowHdVideo\n * @param {boolean} config.allowNoiseSuppression\n * @param {boolean} config.noiseSuppressionVisible\n * @param {boolean} config.faceImproveEnabled\n * @constructor\n */\nexport class DeviceSelector\n{\n\tstatic Events = DeviceSelectorEvents;\n\n\tconstructor(config)\n\t{\n\t\tthis.viewElement = config.viewElement || null;\n\t\tthis.parentElement = config.parentElement;\n\t\tthis.zIndex = config.zIndex;\n\n\t\tthis.cameraEnabled = BX.prop.getBoolean(config, 'cameraEnabled', false);\n\t\tthis.cameraId = BX.prop.getString(config, 'cameraId', false);\n\t\tthis.microphoneEnabled = BX.prop.getBoolean(config, 'microphoneEnabled', false);\n\t\tthis.microphoneId = BX.prop.getString(config, 'microphoneId', false);\n\t\tthis.speakerEnabled = BX.prop.getBoolean(config, 'speakerEnabled', false);\n\t\tthis.speakerId = BX.prop.getString(config, 'speakerId', false);\n\t\tthis.allowHdVideo = BX.prop.getBoolean(config, 'allowHdVideo', false);\n\t\tthis.allowNoiseSuppression = BX.prop.getBoolean(config, 'allowNoiseSuppression', false);\n\t\tthis.noiseSuppressionVisible = BX.prop.getBoolean(config, 'noiseSuppressionVisible', false);\n\t\tthis.faceImproveEnabled = BX.prop.getBoolean(config, 'faceImproveEnabled', false);\n\t\tthis.allowFaceImprove = BX.prop.getBoolean(config, 'allowFaceImprove', false);\n\t\tthis.allowBackground = BX.prop.getBoolean(config, 'allowBackground', true);\n\t\tthis.allowMask = BX.prop.getBoolean(config, 'allowMask', true);\n\t\tthis.allowAdvancedSettings = BX.prop.getBoolean(config, 'allowAdvancedSettings', false);\n\t\tthis.switchCameraBlocked = config.switchCameraBlocked || false;\n\t\tthis.switchMicrophoneBlocked = config.switchMicrophoneBlocked || false;\n\t\tthis.isDestroying = false;\n\t\tthis.isCameraWasEnabledBeforeQualityChanged = false;\n\n\t\tthis.popup = null;\n\t\tthis.eventEmitter = new BX.Event.EventEmitter(this, \"DeviceSelector\");\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tmicContainer: null,\n\t\t\tcameraContainer: null,\n\t\t\tspeakerContainer: null,\n\t\t};\n\n\t\tconst eventListeners = BX.prop.getObject(config, \"events\", {});\n\t\tObject.values(DeviceSelectorEvents).forEach((eventName) =>\n\t\t{\n\t\t\tif (eventListeners[eventName])\n\t\t\t{\n\t\t\t\tthis.eventEmitter.subscribe(eventName, eventListeners[eventName]);\n\t\t\t}\n\t\t})\n\t};\n\n\t// static create(config)\n\t// {\n\t// \treturn new DeviceSelector(config);\n\t// };\n\n\tshow()\n\t{\n\t\tthis.isCameraWasEnabledBeforeQualityChanged = Hardware.isCameraOn;\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\t\tthis.popup = new Popup({\n\t\t\tid: 'call-view-device-selector',\n\t\t\tclassName: 'call-view-device-selector-popup',\n\t\t\tbackground: '#00428F',\n\t\t\tcontentBackground: '#00428F',\n\t\t\tdarkMode: true,\n\t\t\tcontentBorderRadius: '6px',\n\t\t\tborderRadius: '6px',\n\t\t\tbindElement: this.parentElement,\n\t\t\ttargetContainer: this.viewElement,\n\t\t\tautoHide: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tcloseByEsc: true,\n\t\t\tangle: false,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: '#22272B',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tcontent: this.render(),\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => this.popup.destroy(),\n\t\t\t\tonPopupDestroy: () => this.destroy(),\n\t\t\t}\n\t\t});\n\t\tthis.popup.show();\n\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onShow, {});\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-top\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t(this.microphoneContainer = DeviceMenu.create({\n\t\t\t\t\t\t\tblocked: this.switchMicrophoneBlocked,\n\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_MIC\"),\n\t\t\t\t\t\t\tdeviceList: Hardware.getMicrophoneList(),\n\t\t\t\t\t\t\tselectedDevice: this.microphoneId,\n\t\t\t\t\t\t\tdeviceEnabled: this.microphoneEnabled,\n\t\t\t\t\t\t\ticons: [\"microphone\", \"microphone-off\"],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonSwitch: this.onMicrophoneSwitch.bind(this),\n\t\t\t\t\t\t\t\tonSelect: this.onMicrophoneSelect.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})).render(),\n\t\t\t\t\t\t(this.cameraContainer = DeviceMenu.create({\n\t\t\t\t\t\t\tblocked: this.switchCameraBlocked,\n\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_CAMERA\"),\n\t\t\t\t\t\t\tdeviceList: Hardware.getCameraList(),\n\t\t\t\t\t\t\tselectedDevice: this.cameraId,\n\t\t\t\t\t\t\tdeviceEnabled: this.cameraEnabled,\n\t\t\t\t\t\t\ticons: [\"camera\", \"camera-off\"],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonSwitch: this.onCameraSwitch.bind(this),\n\t\t\t\t\t\t\t\tonSelect: this.onCameraSelect.bind(this),\n\t\t\t\t\t\t\t\tonChangeVideoQuality: this.onVideoQualityChanged.bind(this),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})).render(),\n\t\t\t\t\t\tHardware.canSelectSpeaker() ?\n\t\t\t\t\t\t\tDeviceMenu.create({\n\t\t\t\t\t\t\t\tdeviceLabel: BX.message(\"IM_M_CALL_BTN_SPEAKER\"),\n\t\t\t\t\t\t\t\tdeviceList: Hardware.getSpeakerList(),\n\t\t\t\t\t\t\t\tselectedDevice: this.speakerId,\n\t\t\t\t\t\t\t\tdeviceEnabled: this.speakerEnabled,\n\t\t\t\t\t\t\t\ticons: [\"speaker\", \"speaker-off\"],\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tonSwitch: this.onSpeakerSwitch.bind(this),\n\t\t\t\t\t\t\t\t\tonSelect: this.onSpeakerSelect.bind(this)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}).render()\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t],\n\t\t\t\t}),\n\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.noiseSuppressionVisible\n\t\t\t\t\t\t\t? Dom.create('div', {\n\t\t\t\t\t\t\t\tprops: { className: 'bx-call-view-device-selector-bottom-item' },\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create('input', {\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tid: 'device-selector-noise-suppression',\n\t\t\t\t\t\t\t\t\t\t\tclassName: 'bx-call-view-device-selector-bottom-item-checkbox'\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\t\ttype: 'checkbox',\n\t\t\t\t\t\t\t\t\t\t\tchecked: this.allowNoiseSuppression,\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tchange: this.onAllowNoiseSuppression.bind(this)\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-view-device-selector-bottom-item-checkbox-checked' },\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create('label', {\n\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-view-device-selector-bottom-item-label' },\n\t\t\t\t\t\t\t\t\t\tattrs: { for: 'device-selector-noise-suppression' },\n\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_NOISE_SUPPRESSION'),\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tid: \"device-selector-hd-video\",\n\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-view-device-selector-bottom-item-checkbox\"\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\t\t\t\t\t\tchecked: this.allowHdVideo\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tchange: this.onAllowHdVideoChange.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-view-device-selector-bottom-item-checkbox-checked' },\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-label\"},\n\t\t\t\t\t\t\t\t\tattrs: {for: \"device-selector-hd-video\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_HD_VIDEO\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.allowFaceImprove ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tid: \"device-selector-mic-auto-params\",\n\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-view-device-selector-bottom-item-checkbox\"\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\t\t\t\ttype: \"checkbox\",\n\t\t\t\t\t\t\t\t\t\t\tchecked: this.faceImproveEnabled\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tchange: this.onFaceImproveChange.bind(this)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-label\"},\n\t\t\t\t\t\t\t\t\t\tattrs: {for: \"device-selector-mic-auto-params\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_SETTINGS_HARDWARE_CAMERA_FACE_IMPROVE\")\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tthis.allowBackground ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-action\"},\n\t\t\t\t\t\t\t\t\t\ttext: this.allowMask ? BX.message(\"IM_M_CALL_BG_MASK_CHANGE\") : BX.message(\"IM_M_CALL_BACKGROUND_CHANGE\"),\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tBackgroundDialog.open();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-action\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"CALL_RUN_SELF_TEST\"),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tUtil.startSelfTest();\n\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t(this.allowAdvancedSettings && !!BX.MessengerCommon) ?\n\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item\"},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-bottom-item-action\"},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_ADVANCED_SETTINGS\"),\n\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\tclick: (e) =>\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t// to prevent BX.IM.autoHide\n\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onAdvancedSettingsClick);\n\t\t\t\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t};\n\n\ttoggleCameraAvailability(available)\n\t{\n\t\tif (available)\n\t\t{\n\t\t\tthis.cameraContainer.unblock();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cameraContainer.block();\n\t};\n\n\ttoggleMicrophoneAvailability(available)\n\t{\n\t\tif (available)\n\t\t{\n\t\t\tthis.microphoneContainer.unblock();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneContainer.block();\n\t};\n\n\tonMicrophoneSwitch()\n\t{\n\t\tthis.microphoneEnabled = !this.microphoneEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onMicrophoneSwitch, {\n\t\t\tmicrophoneEnabled: this.microphoneEnabled\n\t\t})\n\t};\n\n\tonMicrophoneSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onMicrophoneSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t})\n\t};\n\n\tonCameraSwitch()\n\t{\n\t\tthis.cameraEnabled = !this.cameraEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onCameraSwitch, {\n\t\t\tcameraEnabled: this.cameraEnabled\n\t\t})\n\t};\n\n\tonCameraSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onCameraSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\tonVideoQualityChanged(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onChangeVideoQuality, {\n\t\t\tvideoQuality: e.data.videoQuality,\n\t\t\tisCameraWasEnabledBeforeQualityChanged: this.isCameraWasEnabledBeforeQualityChanged,\n\t\t});\n\t};\n\n\tonSpeakerSwitch()\n\t{\n\t\tthis.speakerEnabled = !this.speakerEnabled;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onSpeakerSwitch, {\n\t\t\tspeakerEnabled: this.speakerEnabled\n\t\t})\n\t};\n\n\tonSpeakerSelect(e)\n\t{\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onSpeakerSelect, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\tonAllowHdVideoChange(e)\n\t{\n\t\tthis.allowHdVideo = e.currentTarget.checked;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onChangeHdVideo, {\n\t\t\tallowHdVideo: this.allowHdVideo\n\t\t})\n\t};\n\n\tonAllowNoiseSuppression(e)\n\t{\n\t\tthis.allowNoiseSuppression = e.currentTarget.checked;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onChangeNoiseSuppression, {\n\t\t\tallowNoiseSuppression: this.allowNoiseSuppression,\n\t\t});\n\t}\n\n\tonAllowMirroringVideoChange(e)\n\t{\n\t\tHardware.enableMirroring = e.target.checked;\n\t};\n\n\tonFaceImproveChange(e)\n\t{\n\t\tthis.faceImproveEnabled = e.currentTarget.checked;\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onChangeFaceImprove, {\n\t\t\tfaceImproveEnabled: this.faceImproveEnabled\n\t\t})\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.isDestroying)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isDestroying = true;\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\t\tthis.eventEmitter.emit(DeviceSelectorEvents.onDestroy, {});\n\t};\n}\n\nconst DeviceMenuEvents = {\n\tonSelect: 'onSelect',\n\tonSwitch: 'onSwitch',\n\tonChangeVideoQuality: 'onChangeVideoQuality',\n};\n\nclass DeviceMenu\n{\n\tconstructor(config)\n\t{\n\t\tconfig = BX.type.isObject(config) ? config : {};\n\n\t\tthis.menuBlocked = config.blocked || false;\n\t\tthis.deviceList = BX.prop.getArray(config, \"deviceList\", []);\n\t\tthis.selectedDevice = BX.prop.getString(config, \"selectedDevice\", \"\");\n\t\tthis.deviceEnabled = BX.prop.getBoolean(config, \"deviceEnabled\", false);\n\t\tthis.deviceLabel = BX.prop.getString(config, \"deviceLabel\", \"\");\n\t\tthis.icons = BX.prop.getArray(config, \"icons\", []);\n\t\tthis.eventEmitter = new EventEmitter(this, 'DeviceMenu');\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tswitchIcon: null,\n\t\t\tmenuInner: null,\n\t\t\tmenuItems: {}  // deviceId => {root: element, icon: element}\n\t\t};\n\t\t\n\t\tthis.currentBitrixCall = Util.getCurrentBitrixCall();\n\n\t\tthis.isShowVideoQuality =\n\t\t\tUtil.isStreamQualityFeatureEnabled()\n\t\t\t&& this.icons[0] === 'camera'\n\t\t\t&& this.currentBitrixCall\n\t\t\t&& this.currentBitrixCall.provider !== Provider.Plain;\n\n\t\tvar events = BX.prop.getObject(config, \"events\", {});\n\t\tfor (var eventName in events)\n\t\t{\n\t\t\tif (!events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t}\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new DeviceMenu(config);\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector-menu-container\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-switch-wrapper\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.switchIcon = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-icon \" + this.getDeviceIconClass()}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-text\"},\n\t\t\t\t\t\t\ttext: this.deviceLabel\n\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-device-switch\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t(new BX.UI.Switcher({\n\t\t\t\t\t\t\t\t\tsize: 'small',\n\t\t\t\t\t\t\t\t\tchecked: this.deviceEnabled,\n\t\t\t\t\t\t\t\t\thandlers: {\n\t\t\t\t\t\t\t\t\t\ttoggled: this.onSwitchToggled.bind(this)\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdisabled: this.menuBlocked,\n\t\t\t\t\t\t\t\t})).getNode()\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.menuInner = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-inner\" + (this.menuBlocked ? ' inactive' : '')},\n\t\t\t\t\tchildren: this.deviceList.map(this.renderDevice.bind(this))\n\t\t\t\t}),\n\t\t\t\t(this.isShowVideoQuality ? VideoQualityRange.create({\n\t\t\t\t\ttitle: BX.message('CALL_VIDEO_QUALITY_TITLE'),\n\t\t\t\t\tonVideoQualityChanged: (videoQuality) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.eventEmitter.emit(DeviceMenuEvents.onChangeVideoQuality, {\n\t\t\t\t\t\t\tvideoQuality: videoQuality,\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tvideoQualityList: [\n\t\t\t\t\t\t{label: BX.message('CALL_VIDEO_QUALITY_WITHOUT_VIDEO'), height: 0, value: STREAM_QUALITY.NO_VIDEO},\n\t\t\t\t\t\t{label: '180p', height: 180, value: STREAM_QUALITY.LOW},\n\t\t\t\t\t\t{label: '360p', height: 360, value: STREAM_QUALITY.MEDIUM},\n\t\t\t\t\t\t{label: '720p', height: 720, value: STREAM_QUALITY.HIGH},\n\t\t\t\t\t],\n\t\t\t\t}).render() : null),\n\t\t\t]\n\t\t});\n\t\treturn this.elements.root;\n\t};\n\n\trenderDevice(deviceInfo)\n\t{\n\t\tvar iconClass = this.selectedDevice === deviceInfo.deviceId ? \"selected\" : \"\";\n\t\tvar deviceElements = {};\n\t\tdeviceElements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item\"},\n\t\t\tdataset: {\n\t\t\t\tdeviceId: deviceInfo.deviceId\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tdeviceElements.icon = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item-icon \" + iconClass},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-device-selector-menu-item-text\"},\n\t\t\t\t\ttext: deviceInfo.label || \"(\" + BX.message(\"IM_M_CALL_DEVICE_NO_NAME\") + \")\",\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this.onMenuItemClick.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.elements.menuItems[deviceInfo.deviceId] = deviceElements;\n\t\treturn deviceElements.root;\n\t};\n\n\tblock()\n\t{\n\t\tthis.menuBlocked = true;\n\t\tthis.elements.root.classList.add(\"bx-call-view-device-selector-menu-container-blocked\");\n\t};\n\n\tunblock()\n\t{\n\t\tthis.menuBlocked = false;\n\t\tthis.elements.root.classList.remove(\"bx-call-view-device-selector-menu-container-blocked\");\n\t};\n\n\tgetDeviceIconClass()\n\t{\n\t\tvar result = \"\";\n\t\tif (this.deviceEnabled && this.icons.length > 0)\n\t\t{\n\t\t\tresult = this.icons[0];\n\t\t}\n\t\telse if (!this.deviceEnabled && this.icons.length > 1)\n\t\t{\n\t\t\tresult = this.icons[1];\n\t\t}\n\t\treturn result;\n\t};\n\n\tonSwitchToggled()\n\t{\n\t\tif (this.menuBlocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deviceEnabled = !this.deviceEnabled;\n\t\tthis.elements.switchIcon.className = \"bx-call-view-device-selector-device-icon \" + this.getDeviceIconClass();\n\n\t\tthis.eventEmitter.emit(DeviceMenuEvents.onSwitch, {\n\t\t\tdeviceEnabled: this.deviceEnabled\n\t\t})\n\t};\n\n\tonMenuItemClick(e)\n\t{\n\t\tvar currentDevice = this.selectedDevice;\n\t\tvar selectedDevice = e.currentTarget.dataset.deviceId;\n\n\t\tthis.selectedDevice = selectedDevice;\n\t\tif (this.elements.menuItems[currentDevice])\n\t\t{\n\t\t\tthis.elements.menuItems[currentDevice]['icon'].classList.remove('selected');\n\t\t}\n\t\tif (this.elements.menuItems[this.selectedDevice])\n\t\t{\n\t\t\tthis.elements.menuItems[this.selectedDevice]['icon'].classList.add('selected');\n\t\t}\n\n\t\tthis.eventEmitter.emit(DeviceMenuEvents.onSelect, {\n\t\t\tdeviceId: this.selectedDevice\n\t\t})\n\t};\n};\n\nclass VideoQualityRange\n{\n\tconstructor(config)\n\t{\n\t\tconfig = BX.type.isObject(config) ? config : {};\n\n\t\tthis.id = BX.prop.getString(config, 'id', Math.random().toString(16).slice(2));\n\t\tthis.title = BX.prop.getString(config, 'title', '');\n\t\tthis.videoQualityList = BX.prop.getArray(config, 'videoQualityList', []);\n\t\tthis.currentVideoQualityIndex = this.videoQualityList.findIndex(item => item.height === Hardware.maxLocalStreamQualityHeight);\n\t\tthis.inputId = 'video_quality_values_' + this.id;\n\n\t\tthis.callbacks = {\n\t\t\tonVideoQualityChanged: BX.prop.getFunction(config, 'onVideoQualityChanged', BX.DoNothing),\n\t\t};\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t};\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new VideoQualityRange(config);\n\t};\n\n\trenderRangeItem(item)\n\t{\n\t\treturn Dom.create('option', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-call-view-video-quality-datalist-option',\n\t\t\t\tvalue: item.value,\n\t\t\t\tlabel: item.label,\n\t\t\t},\n\t\t});\n\t};\n\n\tonVideoQualityChange(e)\n\t{\n\t\tthis.currentVideoQualityIndex = e.target.value;\n\n\t\tthis.callbacks.onVideoQualityChanged(this.videoQualityList[this.currentVideoQualityIndex].value);\n\t};\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tif (!this.videoQualityList.length)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: {className: 'bx-call-view-video-quality-container'},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {className: 'bx-call-view-video-quality-title'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: {className: 'bx-call-view-video-quality-title-icon'},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\t\tprops: {className: 'bx-call-view-video-quality-title-text'},\n\t\t\t\t\t\t\ttext: this.title,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {className: 'bx-call-view-video-quality'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.input = Dom.create('input', {\n\t\t\t\t\t\t\tprops:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tclassName: 'bx-call-view-video-quality-input',\n\t\t\t\t\t\t\t\tid: 'bx-call-view-video-quality-input',\n\t\t\t\t\t\t\t\ttype: 'range',\n\t\t\t\t\t\t\t\tstep: 1,\n\t\t\t\t\t\t\t\tvalue: this.currentVideoQualityIndex,\n\t\t\t\t\t\t\t\tmin: 0,\n\t\t\t\t\t\t\t\tmax: (this.videoQualityList?.length - 1 || 1),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create('datalist', {\n\t\t\t\t\t\t\tprops:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tclassName: 'bx-call-view-video-quality-datalist',\n\t\t\t\t\t\t\t\tid: this.inputId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: this.videoQualityList.map(this.renderRangeItem.bind(this)),\n\t\t\t\t\t\t}),\n\t\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tchange: this.onVideoQualityChange.bind(this),\n\t\t\t},\n\t\t});\n\n\t\tthis.elements.input.setAttribute('list', this.inputId);\n\n\t\treturn this.elements.root;\n\t};\n};\n","import { Extension, Type } from 'main.core';\n\nexport type CallAiOptions = {\n\tserviceEnabled?: boolean;\n\tsettingsEnabled?: boolean;\n\trecordingMinUsers?: number;\n\tagreementAccepted?: boolean;\n\ttariffAvailable?: boolean;\n\tbaasAvailable?: boolean;\n\tfeedBackLink?: string;\n\tbaasPromoSlider?: string;\n\thelpSlider?: string;\n\tdisclaimerArticleCode?: string;\n\tmarketSubscriptionEnabled?: boolean;\n\tmarketSubscriptionSlider?: string;\n};\n\nexport const CallAiError = {\n\tAI_MODULE_ERROR: 'AI_MODULE_ERROR',\n\tAI_UNAVAILABLE_ERROR: 'AI_UNAVAILABLE_ERROR',\n\tAI_SETTINGS_ERROR: 'AI_SETTINGS_ERROR',\n\tAI_AGREEMENT_ERROR: 'AI_AGREEMENT_ERROR',\n\tAI_NOT_ENOUGH_BAAS_ERROR: 'AI_NOT_ENOUGH_BAAS_ERROR',\n\tAI_MARKET_SUBSCRIPTION: 'AI_MARKET_SUBSCRIPTION',\n};\n\nclass CallAi\n{\n\tconstructor()\n\t{\n\t\tthis.serviceEnabled = false;\n\t\tthis.settingsEnabled = false;\n\t\tthis.recordingMinUsers = 1000;\n\t\tthis.agreementAccepted = false;\n\t\tthis.tariffAvailable = false;\n\t\tthis.baasAvailable = false;\n\t\tthis.feedBackLink = '';\n\t\tthis.baasPromoSlider = '';\n\t\tthis.helpSlider = '';\n\t\tthis.disclaimerArticleCode = '';\n\t\tthis.marketSubscriptionEnabled = false;\n\t\tthis.marketSubscriptionSlider = '';\n\n\t\tif (Extension.getSettings('call.core').ai)\n\t\t{\n\t\t\tthis.setup(Extension.getSettings('call.core').ai);\n\t\t}\n\t}\n\n\tsetup(options: CallAiOptions)\n\t{\n\t\tif (!Type.isObject(options))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (options.serviceEnabled !== undefined)\n\t\t{\n\t\t\tthis.serviceEnabled = options.serviceEnabled;\n\t\t}\n\n\t\tif (options.settingsEnabled !== undefined)\n\t\t{\n\t\t\tthis.settingsEnabled = options.settingsEnabled;\n\t\t}\n\n\t\tif (options.recordingMinUsers)\n\t\t{\n\t\t\tthis.recordingMinUsers = options.recordingMinUsers;\n\t\t}\n\n\t\tif (options.agreementAccepted !== undefined)\n\t\t{\n\t\t\tthis.agreementAccepted = options.agreementAccepted;\n\t\t}\n\n\t\tif (options.tariffAvailable !== undefined)\n\t\t{\n\t\t\tthis.tariffAvailable = options.tariffAvailable;\n\t\t}\n\n\t\tif (options.baasAvailable !== undefined)\n\t\t{\n\t\t\tthis.baasAvailable = options.baasAvailable;\n\t\t}\n\n\t\tif (options.feedBackLink)\n\t\t{\n\t\t\tthis.feedBackLink = options.feedBackLink;\n\t\t}\n\n\t\tif (options.baasPromoSlider)\n\t\t{\n\t\t\tthis.baasPromoSlider = options.baasPromoSlider;\n\t\t}\n\n\t\tif (options.helpSlider)\n\t\t{\n\t\t\tthis.helpSlider = options.helpSlider;\n\t\t}\n\n\t\tif (options.disclaimerArticleCode)\n\t\t{\n\t\t\tthis.disclaimerArticleCode = options.disclaimerArticleCode;\n\t\t}\n\n\t\tif (options.marketSubscriptionEnabled)\n\t\t{\n\t\t\tthis.marketSubscriptionEnabled = options.marketSubscriptionEnabled;\n\t\t}\n\n\t\tif (options.marketSubscriptionSlider)\n\t\t{\n\t\t\tthis.marketSubscriptionSlider = options.marketSubscriptionSlider;\n\t\t}\n\t}\n\n\tget serviceEnabled(): boolean\n\t{\n\t\treturn this._serviceEnabled;\n\t}\n\tset serviceEnabled(flag: boolean)\n\t{\n\t\tthis._serviceEnabled = flag;\n\t}\n\n\tget settingsEnabled(): boolean\n\t{\n\t\treturn this._settingsEnabled;\n\t}\n\tset settingsEnabled(flag: boolean)\n\t{\n\t\tthis._settingsEnabled = flag;\n\t}\n\n\tget recordingMinUsers(): number\n\t{\n\t\treturn this._recordingMinUsers;\n\t}\n\tset recordingMinUsers(value: number)\n\t{\n\t\tthis._recordingMinUsers = value;\n\t}\n\n\tget agreementAccepted(): boolean\n\t{\n\t\treturn this._agreementAccepted;\n\t}\n\tset agreementAccepted(flag: boolean)\n\t{\n\t\tthis._agreementAccepted = flag;\n\t}\n\n\tget tariffAvailable(): boolean\n\t{\n\t\treturn this._tariffAvailable;\n\t}\n\tset tariffAvailable(flag: boolean)\n\t{\n\t\tthis._tariffAvailable = flag;\n\t}\n\n\tget baasAvailable(): boolean\n\t{\n\t\treturn this._baasAvailable;\n\t}\n\tset baasAvailable(flag: boolean)\n\t{\n\t\tthis._baasAvailable = flag;\n\t}\n\n\tget feedBackLink(): string\n\t{\n\t\treturn this._feedBackLink;\n\t}\n\tset feedBackLink(value: string)\n\t{\n\t\tthis._feedBackLink = value;\n\t}\n\n\tget baasPromoSlider(): string\n\t{\n\t\treturn this._baasPromoSlider;\n\t}\n\tset baasPromoSlider(value: string)\n\t{\n\t\tthis._baasPromoSlider = value;\n\t}\n\n\tget helpSlider(): string\n\t{\n\t\treturn this._helpSlider;\n\t}\n\tset helpSlider(value: string)\n\t{\n\t\tthis._helpSlider = value;\n\t}\n\n\tget disclaimerArticleCode(): string\n\t{\n\t\treturn this._disclaimerArticleCode;\n\t}\n\tset disclaimerArticleCode(value: string)\n\t{\n\t\tthis._disclaimerArticleCode = value;\n\t}\n\n\tget marketSubscriptionEnabled(): boolean\n\t{\n\t\treturn this._marketSubscriptionEnabled;\n\t}\n\tset marketSubscriptionEnabled(flag: boolean)\n\t{\n\t\tthis._marketSubscriptionEnabled = flag;\n\t}\n\n\tget marketSubscriptionSlider(): string\n\t{\n\t\treturn this._marketSubscriptionSlider;\n\t}\n\tset marketSubscriptionSlider(value: string)\n\t{\n\t\tthis._marketSubscriptionSlider = value;\n\t}\n\n\thandleCopilotError(errorType: string)\n\t{\n\t\tswitch (errorType)\n\t\t{\n\t\t\tcase CallAiError.AI_UNAVAILABLE_ERROR:\n\t\t\t\tthis.tariffAvailable = false;\n\t\t\t\tbreak;\n\t\t\tcase CallAiError.AI_MODULE_ERROR:\n\t\t\tcase CallAiError.AI_SETTINGS_ERROR:\n\t\t\t\tthis.settingsEnabled = false;\n\t\t\t\tbreak;\n\t\t\tcase CallAiError.AI_AGREEMENT_ERROR:\n\t\t\t\tthis.agreementAccepted = false;\n\t\t\t\tbreak;\n\t\t\tcase CallAiError.AI_NOT_ENOUGH_BAAS_ERROR:\n\t\t\t\tthis.baasAvailable = false;\n\t\t\t\tbreak;\n\t\t\tcase CallAiError.AI_MARKET_SUBSCRIPTION:\n\t\t\t\tthis.marketSubscriptionEnabled = false;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconsole.error('there are no such errorTypes');\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n\nexport const CallAI = new CallAi();","import { Dom, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { PromoManager } from 'im.v2.lib.promo';\n\nimport { Analytics } from 'call.lib.analytics';\n\nimport '../css/copilot-notify.css';\n\nexport const CopilotNotifyType = {\n\tCOPILOT_ENABLED: 'COPILOT_ENABLED',\n\tCOPILOT_DISABLED: 'COPILOT_DISABLED',\n\tCOPILOT_RESULT: 'COPILOT_RESULT',\n\tAI_UNAVAILABLE_ERROR: 'AI_UNAVAILABLE_ERROR',\n\tAI_SETTINGS_ERROR: 'AI_SETTINGS_ERROR',\n\tAI_AGREEMENT_ERROR: 'AI_AGREEMENT_ERROR',\n\tAI_NOT_ENOUGH_BAAS_ERROR: 'AI_NOT_ENOUGH_BAAS_ERROR',\n\tAI_MODULE_ERROR: 'AI_MODULE_ERROR',\n\tENABLE_AI_INTERNAL_ERROR: 'ENABLE_AI_INTERNAL_ERROR',\n\tDISABLE_AI_INTERNAL_ERROR: 'DISABLE_AI_INTERNAL_ERROR',\n};\n\nexport class CopilotNotify\n{\n\tconstructor(config) {\n\t\tthis.callId = config.callId || 0;\n\t\tthis.type = config.type || '';\n\t\tthis.code = config.code || '';\n\t\tthis.popup = null;\n\t\tthis.notifyText = '';\n\t\tthis.promoId = '';\n\t\tthis.popupTemplate = null;\n\t\tthis.bindElement = config.bindElement;\n\t\tthis.notifyColor = '';\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t};\n\t}\n\n\tgetPopupTemplate() {\n\t\tif (!this.notifyText)\n\t\t{\n\t\t\tthis.popupTemplate = null;\n\t\t}\n\n\t\tthis.popupTemplate = Dom.create('div', {\n\t\t\tprops: { className: 'bx-call-copilot-notify__content' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-notify__icon' },\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-notify__message' },\n\t\t\t\t\ttext: this.notifyText,\n\t\t\t\t}),\n\t\t\t\tDom.create('button', {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-notify__close-btn' },\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t}\n\n\tsetAdditionalInformation() {\n\t\tswitch (this.type)\n\t\t{\n\t\t\tcase CopilotNotifyType.COPILOT_ENABLED:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_WARNING_ENABLED');\n\t\t\t\tthis.promoId = 'call:copilot-notify-warning:21112024:all';\n\t\t\t\tthis.notifyColor = '#8E52EC';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.COPILOT_DISABLED:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_PROMO_ENABLED');\n\t\t\t\tthis.promoId = 'call:copilot-notify-promo:21112024:all';\n\t\t\t\tthis.notifyColor = '#8E52EC';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.COPILOT_RESULT:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_RESULT_WARNING');\n\t\t\t\tthis.promoId = 'call:copilot-notify-result:24112024:all';\n\t\t\t\tthis.notifyColor = '#8E52EC';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_UNAVAILABLE_ERROR:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_AI_UNAVAILABLE_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_MODULE_ERROR:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_AI_MODULE_ERROR').replace('#ERROR_CODE#', this.code);\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_SETTINGS_ERROR:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_AI_SETTINGS_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_AGREEMENT_ERROR:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_AI_AGREEMENT_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.AI_NOT_ENOUGH_BAAS_ERROR:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_AI_NOT_ENOUGH_BAAS_ERROR');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.ENABLE_AI_INTERNAL_ERROR:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_ENABLE_AI_INTERNAL_ERROR').replace(\n\t\t\t\t\t'#ERROR_CODE#',\n\t\t\t\t\tthis.code,\n\t\t\t\t);\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tcase CopilotNotifyType.DISABLE_AI_INTERNAL_ERROR:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_DISABLE_AI_INTERNAL_ERROR').replace(\n\t\t\t\t\t'#ERROR_CODE#',\n\t\t\t\t\tthis.code,\n\t\t\t\t);\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.notifyText = Loc.getMessage('CALL_POPUP_AI_DEFAULT_TEXT');\n\t\t\t\tthis.notifyColor = '#FF5752';\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tcreate() {\n\t\tthis.getPopupTemplate();\n\n\t\tif (!this.bindElement || !this.popupTemplate)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName: 'bx-call-copilot-notify',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.popupTemplate,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top',\n\t\t\t},\n\t\t\tpadding: 0,\n\t\t\tcontentBorderRadius: '1024px',\n\t\t\tbackground: this.notifyColor,\n\t\t\tcontentBackground: this.notifyColor,\n\t\t\tdarkMode: true,\n\t\t\tcontentNoPaddings: true,\n\t\t\tanimation: 'fading',\n\t\t\tautoHide: true,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\tthis.popup.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => {\n\t\t\t\t\tthis.popup = null;\n\t\t\t\t},\n\t\t\t\tonShow: () => {\n\t\t\t\t\tconst popupWidth = this.popup.getPopupContainer().offsetWidth;\n\t\t\t\t\tconst elementWidth = this.popup.bindElement.offsetWidth;\n\t\t\t\t\tconst offsetFix = 7;\n\n\t\t\t\t\tthis.popup.setOffset({\n\t\t\t\t\t\toffsetLeft: elementWidth - offsetFix - popupWidth / 2,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.popup.setAngle({\n\t\t\t\t\t\toffset: popupWidth / 2,\n\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t});\n\t\t\t\t\tthis.popup.adjustPosition();\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tif (this.promoId)\n\t\t\t\t\t{\n\t\t\t\t\t\tPromoManager.getInstance().markAsWatched(this.promoId);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tshow() {\n\t\tthis.close();\n\t\tthis.setAdditionalInformation();\n\n\t\tif (this.promoId && !PromoManager.getInstance().needToShow(this.promoId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.create();\n\n\t\tif (this.type === CopilotNotifyType.COPILOT_ENABLED || this.type === CopilotNotifyType.COPILOT_DISABLED)\n\t\t{\n\t\t\tAnalytics.getInstance().copilot.onCopilotNotifyShow({\n\t\t\t\tisCopilotActive: this.type === CopilotNotifyType.COPILOT_ENABLED,\n\t\t\t\tcallId: this.callId,\n\t\t\t});\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t}\n\t}\n\n\tclose() {\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n}\n","export class MediaRenderer\n{\n\telement = null;\n\n\tconstructor(params)\n\t{\n\t\tparams = params || {};\n\t\tthis.kind = params.kind || 'video';\n\t\tif (params.track)\n\t\t{\n\t\t\tthis.stream = new MediaStream([params.track]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.stream = null;\n\t\t}\n\t}\n\n\trender(el)\n\t{\n\t\tif (!el.srcObject || !el.srcObject.active || el.srcObject.id !== this.stream.id)\n\t\t{\n\t\t\tel.srcObject = this.stream;\n\t\t}\n\t}\n\n\trequestVideoSize()\n\t{\n\t}\n}\n","import { DesktopApi } from 'im.v2.lib.desktop-api';\n\nexport class UnsupportedBrowserFeatures\n{\n\tstatic listOfDevicesBeforeStream: boolean[] = [BX.browser.IsFirefox()];\n\tstatic listOfPiPAvailable: boolean[] = [BX.browser.IsChrome(), DesktopApi.isDesktop()];\n\n\tstatic get isNotSupportDevicesListBeforeStream(): boolean\n\t{\n\t\treturn this.listOfDevicesBeforeStream.some((browser) => browser);\n\t}\n\n\tstatic get isPiPAvailable(): boolean\n\t{\n\t\treturn this.listOfPiPAvailable.some(device => device);\n\t}\n}","import { Dom } from 'main.core';\nimport { Hardware } from '../call_hardware';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport * as Buttons from './buttons';\nimport { CallUser } from './call-user';\nimport { FloorRequest } from './floor-request';\n\nimport '../css/picture-in-picture-window.css'\nimport { UnsupportedBrowserFeatures } from '../engine/unsupported_features_in_browsers';\n\nexport class PictureInPictureWindow {\n\tconstructor(config)\n\t{\n\t\tthis.pictureWindow = null;\n\t\tthis.template = null;\n\t\tthis.userPanel = null;\n\t\tthis.actionsPanel = null;\n\t\tthis.notificationPanel = null;\n\n\t\tthis.buttons = {\n\t\t\tmicrophone: null,\n\t\t\tcamera: null,\n\t\t\treturnToCall: null,\n\t\t\tstopScreen: null,\n\t\t\tcopilot: null,\n\t\t};\n\n\t\tthis.preferInitialWindowPlacement = config.preferInitialWindowPlacement;\n\n\t\tthis.user = null;\n\t\tthis.userData = config.currentUser;\n\n\t\tthis.buttons = config.buttons || [];\n\t\tthis.blockedButtons = config.blockedButtons || [];\n\n\t\tthis.previousFloorRequestNotifications = config.floorRequestNotifications || [];\n\n\t\tthis.callbacks = {\n\t\t\tonButtonClick: BX.type.isFunction(config.onButtonClick) ? config.onButtonClick : BX.DoNothing,\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t}\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'BX.Call.View');\n\n\t\tthis.isMinHeight = false;\n\t\tthis.isMinWidth = false;\n\n\t\tthis.floorRequestElements = {\n\t\t\tcounter: null,\n\t\t\tmainNotification: null,\n\t\t\tpopup: null,\n\t\t\tpopupTemplate: null,\n\t\t};\n\n\t\tthis.floorRequestsList = [];\n\t\tthis.floorRequestTimeForHidden = 5000;\n\t\tthis.floorRequestTimeout = null;\n\t\tthis.baseWidthPopup = 244;\n\t}\n\n\t_onButtonClick({ buttonName, event })\n\t{\n\t\tthis.callbacks.onButtonClick({\n\t\t\tbuttonName,\n\t\t\tevent,\n\t\t})\n\t}\n\n\tsetUserMedia(userId, track)\n\t{\n\t\tif (!this.user || +userId !== this.user.userModel.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.user.videoTrack = track;\n\t};\n\n\tsetStats(userId, stats)\n\t{\n\t\tif (!this.user || +userId !== this.user.userModel.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.user.showStats(stats);\n\t}\n\n\tshowFloorRequestNotification(userModel)\n\t{\n\t\tlet notification = FloorRequest.create({\n\t\t\tuserModel: userModel\n\t\t});\n\n\t\tnotification.mount(this.notificationPanel);\n\t}\n\n\tsetVideoRenderer(userId, mediaRenderer)\n\t{\n\t\tif (!this.user || +userId !== this.user.userModel.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.user.videoRenderer = mediaRenderer;\n\t}\n\n\treleaseLocalStream(userId)\n\t{\n\t\tif (!this.user || +userId !== this.user.userModel.id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.user.releaseStream();\n\t}\n\n\tsetCurrentUser(user)\n\t{\n\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userData = user;\n\t\tconst hasUser = !!this.user;\n\t\tconst isCurrentUser = this.userData.userModel.id === this.user.userModel.id;\n\n\t\tif (hasUser && !isCurrentUser)\n\t\t{\n\t\t\tthis.destroyCurrentUser();\n\t\t}\n\n\t\tif (!hasUser || !isCurrentUser)\n\t\t{\n\t\t\tthis.renderUserPanel();\n\t\t}\n\t}\n\n\tdestroyCurrentUser()\n\t{\n\t\tif (!this.user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.user.dismount();\n\t\tthis.user.destroy();\n\t\tthis.user = null;\n\t}\n\n\tgetCurrentUserId()\n\t{\n\t\treturn this.user?.userModel.id || null;\n\t}\n\n\tisButtonBlocked(buttonName)\n\t{\n\t\treturn this.blockedButtons.includes(buttonName);\n\t}\n\n\tupdateBlockButtons(buttonsList)\n\t{\n\t\tthis.blockedButtons = buttonsList;\n\t\treturn this;\n\t}\n\n\tsetButtons(buttonsList)\n\t{\n\t\tthis.buttons = buttonsList;\n\t\treturn this;\n\t}\n\n\tupdateButtons()\n\t{\n\t\tDom.clean(this.actionsPanel);\n\t\tthis.renderButtons();\n\t}\n\n\tgetButtonTextBySizePictureWindow(text)\n\t{\n\t\treturn (this.isMinHeight || this.isMinWidth) ? '' : text;\n\t}\n\n\trenderButtons()\n\t{\n\t\tif (!this.actionsPanel && this.buttons.length)\n\t\t{\n\t\t\tthis.actionsPanel = Dom.create('div', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: 'bx-call-picture-in-picture-window__actions',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tfor (let i = 0; i < this.buttons.length; i++)\n\t\t{\n\t\t\tswitch (this.buttons[i]) {\n\t\t\t\tcase 'microphone':\n\t\t\t\t\tthis.buttons.microphone = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: 'microphone',\n\t\t\t\t\t\tbackgroundClass: 'bx-call-picture-in-picture-window__button-background',\n\t\t\t\t\t\ttext: this.getButtonTextBySizePictureWindow(BX.message('IM_M_CALL_BTN_MIC')),\n\t\t\t\t\t\tenabled: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\tarrowHidden: true,\n\t\t\t\t\t\tarrowEnabled: false,\n\t\t\t\t\t\tshowPointer: true, //todo\n\t\t\t\t\t\tblocked: this.isButtonBlocked('microphone'),\n\t\t\t\t\t\tshowLevel: true,\n\t\t\t\t\t\tsideIcon: null,\n\t\t\t\t\t\tonClick: (event) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\tthis._onButtonClick({ buttonName: 'microphone', event });\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.actionsPanel.appendChild(this.buttons.microphone.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'camera':\n\t\t\t\t\tthis.buttons.camera = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: 'camera',\n\t\t\t\t\t\tbackgroundClass: 'bx-call-picture-in-picture-window__button-background',\n\t\t\t\t\t\ttext: this.getButtonTextBySizePictureWindow(BX.message('IM_M_CALL_BTN_CAMERA')),\n\t\t\t\t\t\tenabled: Hardware.isCameraOn,\n\t\t\t\t\t\tarrowHidden: true,\n\t\t\t\t\t\tblocked: this.isButtonBlocked('camera'),\n\t\t\t\t\t\tonClick: (event) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\tthis._onButtonClick({ buttonName: 'camera', event });\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.actionsPanel.appendChild(this.buttons.camera.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'returnToCall':\n\t\t\t\t\tthis.buttons.returnToCall = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: 'go-to-call',\n\t\t\t\t\t\tbackgroundClass: 'bx-call-picture-in-picture-window__button-background bx-messenger-videocall-panel-icon-background-go-to-call',\n\t\t\t\t\t\ttext: this.getButtonTextBySizePictureWindow(BX.message('CALL_BUTTON_GO_TO_CALL')),\n\t\t\t\t\t\tonClick: (event) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\tthis._onButtonClick({ buttonName: 'returnToCall', event });\n\t\t\t\t\t\t\twindow.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.actionsPanel.appendChild(this.buttons.returnToCall.render());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'stop-screen':\n\t\t\t\t\tthis.buttons.stopScreen = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: 'stop-screen',\n\t\t\t\t\t\tbackgroundClass: 'bx-call-picture-in-picture-window__button-background',\n\t\t\t\t\t\ttext: this.getButtonTextBySizePictureWindow(BX.message('CALL_BUTTON_STOP_SCREEN')),\n\t\t\t\t\t\tblocked: this.isButtonBlocked('screen'),\n\t\t\t\t\t\tonClick: (event) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\tthis._onButtonClick({ buttonName: 'stop-screen', event });\n\t\t\t\t\t\t\twindow.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.actionsPanel.appendChild(this.buttons.stopScreen.render());\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\trenderUserPanel()\n\t{\n\t\tif (!this.userPanel)\n\t\t{\n\t\t\tthis.userPanel = Dom.create('div', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: 'bx-call-picture-in-picture-window__user',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (!this.user)\n\t\t{\n\t\t\tthis.user = new CallUser({\n\t\t\t\tparentContainer: this.userPanel,\n\t\t\t\tuserModel: this.userData.userModel,\n\t\t\t\tavatarBackground: this.userData.avatarBackground,\n\t\t\t\tallowPinButton: false,\n\t\t\t\tallowBackgroundItem: false,\n\t\t\t\tallowMaskItem: false,\n\t\t\t\talwaysShowName: true,\n\t\t\t\tflipVideo: this.userData.userModel.localUser,\n\t\t\t\thiddenFloorRequest: true,\n\t\t\t\thiddenRemoteParticipantButtonMenu: true,\n\t\t\t\tonClick: (event) =>\n\t\t\t\t{\n\t\t\t\t\tthis._onButtonClick({ buttonName: 'returnToCall', event });\n\t\t\t\t\twindow.focus();\n\t\t\t\t},\n\t\t\t});\n\t\t\tthis.user.mount(this.userPanel);\n\t\t}\n\n\t\tif (this.userData.previewRenderer)\n\t\t{\n\t\t\tthis.user.videoRenderer = this.userData.previewRenderer;\n\t\t}\n\n\t\tif (this.userData.videoRenderer)\n\t\t{\n\t\t\tthis.user.videoRenderer = this.userData.videoRenderer\n\t\t}\n\t}\n\n\trenderNotificationPanel()\n\t{\n\t\tif (!this.notificationPanel)\n\t\t{\n\t\t\tthis.notificationPanel = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-call-picture-in-picture-window__notifications bx-messenger-videocall-notification-panel' },\n\t\t\t});\n\t\t}\n\t}\n\n\tupdateFloorRequestsList({ floorRequestsList, user })\n\t{\n\t\tif (floorRequestsList)\n\t\t{\n\t\t\tthis.floorRequestsList = [...floorRequestsList.map(floorRequestsListItem =>\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tuserModel: floorRequestsListItem.userModel,\n\t\t\t\t\tavatarBackgroundColor: floorRequestsListItem.avatarBackgroundColor,\n\t\t\t\t\tinitials: Utils.text.getFirstLetters(floorRequestsListItem.userModel.name).toUpperCase(),\n\t\t\t\t}\n\t\t\t})];\n\t\t\tthis.updateFloorRequestCounter();\n\t\t\treturn;\n\t\t}\n\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userInFloorRequestsListIndex = this.floorRequestsList.findIndex(el => el.userModel.id === user.userModel.id);\n\t\tconst hasUserInFloorRequestsList = userInFloorRequestsListIndex !== -1;\n\t\tconst isActiveFloorRequestState = user.userModel.floorRequestState;\n\n\t\tif (hasUserInFloorRequestsList === isActiveFloorRequestState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isActiveFloorRequestState)\n\t\t{\n\t\t\tthis.floorRequestsList.push({\n\t\t\t\tuserModel: user.userModel,\n\t\t\t\tavatarBackgroundColor: user.avatarBackgroundColor,\n\t\t\t\tinitials: Utils.text.getFirstLetters(user.userModel.name).toUpperCase(),\n\t\t\t});\n\t\t}\n\n\t\tif (!isActiveFloorRequestState)\n\t\t{\n\t\t\tthis.floorRequestsList.splice(userInFloorRequestsListIndex, 1);\n\t\t}\n\n\t\tthis.updateFloorRequestCounter();\n\t}\n\n\tupdateFloorRequestCounter(withoutRenderTemplate = false)\n\t{\n\t\tif (this.floorRequestElements.counter)\n\t\t{\n\t\t\tthis.floorRequestElements.counter.innerText = this.floorRequestsList.length;\n\t\t\tthis.updateVisibilityFloorRequestCounter();\n\t\t}\n\n\t\tif (!withoutRenderTemplate)\n\t\t{\n\t\t\tthis.updateTemplateForFloorRequestsPopup();\n\t\t}\n\t}\n\n\tgetTemplateForFloorRequestsPopup()\n\t{\n\t\tconst self = this;\n\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: { className: 'bx-call-picture-in-picture-window__popup-template' },\n\t\t\tchildren: (\n\t\t\t\tfunction()\n\t\t\t\t{\n\t\t\t\t\tconst items = [];\n\n\t\t\t\t\tself.floorRequestsList.forEach((floorRequestsListItem, floorRequestsListItemIndex) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tlet avatarElement;\n\n\t\t\t\t\t\titems.push(\n\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\tprops: { className: 'bx-call-picture-in-picture-window__floor-request-item' },\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tavatarElement = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\tclassName: 'bx-call-picture-in-picture-window__floor-request-avatar',\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-picture-in-picture-window__floor-request-name' },\n\t\t\t\t\t\t\t\t\t\ttext: floorRequestsListItem.userModel.name,\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-picture-in-picture-window__floor-request-index' },\n\t\t\t\t\t\t\t\t\t\ttext: floorRequestsListItemIndex + 1,\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (floorRequestsListItem.userModel.avatar)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tavatarElement.style.setProperty('--avatar', `url('${floorRequestsListItem.userModel.avatar}')`);\n\t\t\t\t\t\t\tavatarElement.innerText = '';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tavatarElement.style.setProperty(\"--avatar-color\", floorRequestsListItem.avatarBackgroundColor);\n\t\t\t\t\t\t\tavatarElement.innerText = floorRequestsListItem.initials;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn items;\n\t\t\t\t}\n\t\t\t)(),\n\t\t});\n\t}\n\n\tupdateTemplateForFloorRequestsPopup()\n\t{\n\t\tconst tmpTemplate = this.getTemplateForFloorRequestsPopup();\n\n\t\tif (this.floorRequestElements.template)\n\t\t{\n\t\t\tDom.remove(this.floorRequestElements.template)\n\t\t}\n\n\t\tthis.floorRequestElements.popupTemplate = tmpTemplate;\n\n\t\tif (!this.floorRequestElements.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.floorRequestsList.length)\n\t\t{\n\t\t\tthis.floorRequestElements.popup.close();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.floorRequestElements.popup.setContent(this.floorRequestElements.popupTemplate);\n\t}\n\n\tcloseFloorRequestMainNotification({ withoutAdditionInList, user, withoutDismount })\n\t{\n\t\tif (this.floorRequestTimeout)\n\t\t{\n\t\t\tclearTimeout(this.floorRequestTimeout);\n\t\t\tthis.floorRequestTimeout = null;\n\t\t}\n\n\t\tif (this.floorRequestElements.mainNotification && !withoutDismount)\n\t\t{\n\t\t\tthis.floorRequestElements.mainNotification.dismount();\n\t\t}\n\n\t\tif (!withoutAdditionInList && user)\n\t\t{\n\t\t\tthis.updateFloorRequestsList({ user });\n\t\t}\n\t}\n\n\tupdateFloorRequestState({ userModel, avatarBackgroundColor })\n\t{\n\t\tif (\n\t\t\tthis.floorRequestElements.mainNotification\n\t\t\t&& this.floorRequestElements.mainNotification.userModel\n\t\t\t&& this.floorRequestElements.mainNotification.userModel.id === userModel.id\n\t\t\t&& !userModel.floorRequestState)\n\t\t{\n\t\t\tthis.floorRequestElements.mainNotification = null;\n\t\t}\n\n\t\tif (userModel.floorRequestState)\n\t\t{\n\t\t\tthis.updateFloorRequestMainNotification({\n\t\t\t\tuserModel,\n\t\t\t\tavatarBackgroundColor\n\t\t\t});\n\t\t}\n\n\t\tif (!userModel.floorRequestState)\n\t\t{\n\t\t\tthis.updateFloorRequestsList({\n\t\t\t\tuser: {\n\t\t\t\t\tuserModel,\n\t\t\t\t\tavatarBackgroundColor,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tupdateFloorRequestMainNotification({ userModel, avatarBackgroundColor })\n\t{\n\t\tif (!this.notificationPanel)\n\t\t{\n\t\t\tthis.renderNotificationPanel();\n\t\t}\n\n\t\tif (this.floorRequestElements.mainNotification)\n\t\t{\n\t\t\tthis.closeFloorRequestMainNotification({\n\t\t\t\twithoutAdditionInList: false,\n\t\t\t\tuser: {\n\t\t\t\t\tuserModel: this.floorRequestElements.mainNotification.userModel,\n\t\t\t\t\tavatarBackgroundColor: this.floorRequestElements.mainNotification.avatarBackgroundColor,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tthis.floorRequestElements.mainNotification = FloorRequest.create({\n\t\t\tuserModel: userModel,\n\t\t\tonDestroy: () =>\n\t\t\t{\n\t\t\t\tthis.closeFloorRequestMainNotification({\n\t\t\t\t\twithoutAdditionInList: !userModel.floorRequestState,\n\t\t\t\t\tuser: {\n\t\t\t\t\t\tuserModel,\n\t\t\t\t\t\tavatarBackgroundColor\n\t\t\t\t\t},\n\t\t\t\t\twithoutDismount: true\n\t\t\t\t});\n\t\t\t\tthis.floorRequestElements.mainNotification = null;\n\t\t\t},\n\t\t});\n\n\t\tthis.floorRequestElements.mainNotification.mount(this.notificationPanel);\n\n\t\tthis.floorRequestTimeout = setTimeout(() => {\n\t\t\tthis.closeFloorRequestMainNotification({\n\t\t\t\twithoutAdditionInList: false,\n\t\t\t\tuser: {\n\t\t\t\t\tuserModel,\n\t\t\t\t\tavatarBackgroundColor,\n\t\t\t\t},\n\t\t\t})\n\t\t}, this.floorRequestTimeForHidden);\n\t}\n\n\tupdateVisibilityFloorRequestCounter()\n\t{\n\t\tconst isHidden = !this.floorRequestsList.length;\n\n\t\tif (!this.floorRequestElements.counter)\n\t\t{\n\t\t\tthis.renderFloorRequestCounter();\n\t\t}\n\n\t\tconst hiddenClass = 'bx-call-picture-in-picture-window__floor-requests_hidden';\n\t\tconst hasHiddenClass = this.floorRequestElements.counter.classList.contains(hiddenClass);\n\n\t\tif (hasHiddenClass === isHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.floorRequestElements.counter.classList.toggle(hiddenClass);\n\t}\n\n\tonMouseOutCallbackForPopup(event)\n\t{\n\t\tif (!this.floorRequestElements.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst composedPath = event.composedPath();\n\t\tif (composedPath.some(element => element.classList && (element.classList.contains('bx-call-picture-in-picture-window__floor-requests') || element.classList.contains('bx-call-picture-in-picture-window__popup'))))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.floorRequestElements.popup.close();\n\t}\n\n\tsetNewSettingForPopup()\n\t{\n\t\tif (!this.pictureWindow.document.body || !this.floorRequestElements.popup || !this.floorRequestElements.counter)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { clientHeight, clientWidth } = this.pictureWindow.document.body;\n\t\tconst bindElement = this.floorRequestElements.counter;\n\t\tconst bindElementPos = bindElement.getBoundingClientRect();\n\t\tconst { bottom } = bindElementPos;\n\t\tconst baseOffsetHorizontalPopup = 16;\n\t\tconst baseOffsetVerticalPopup = baseOffsetHorizontalPopup / 2;\n\t\tconst maxWidthPopup = clientWidth - baseOffsetHorizontalPopup * 2;\n\t\tconst widthPopup = this.baseWidthPopup <= maxWidthPopup ? this.baseWidthPopup : maxWidthPopup;\n\t\tconst heightWidth = clientHeight - bottom - (baseOffsetVerticalPopup * 2);\n\n\t\tthis.floorRequestElements.popup.setOffset({\n\t\t\toffsetLeft: clientWidth - baseOffsetHorizontalPopup - widthPopup,\n\t\t\toffsetTop: baseOffsetVerticalPopup,\n\t\t});\n\n\t\tthis.floorRequestElements.popup.setWidth(widthPopup);\n\t\tthis.floorRequestElements.popup.setMaxHeight(heightWidth);\n\t}\n\n\trenderFloorRequestCounter()\n\t{\n\t\tif (!!this.floorRequestElements.counter)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.floorRequestElements.counter = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-call-picture-in-picture-window__floor-requests',\n\t\t\t},\n\t\t\ttext: this.floorRequestsList.length,\n\t\t\tevents: {\n\t\t\t\tmouseover: (event) => {\n\t\t\t\t\tevent.stopPropagation();\n\n\t\t\t\t\tconst self = this;\n\n\t\t\t\t\tif (!this.floorRequestElements.popup && !this.isMinHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateTemplateForFloorRequestsPopup();\n\t\t\t\t\t\tthis.floorRequestElements.popup = new Popup({\n\t\t\t\t\t\t\tclassName: \"bx-call-picture-in-picture-window__popup\",\n\t\t\t\t\t\t\tbindElement: this.floorRequestElements.counter,\n\t\t\t\t\t\t\ttargetContainer: this.pictureWindow.document.body,\n\t\t\t\t\t\t\tcontent: this.floorRequestElements.popupTemplate,\n\t\t\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\t\t\tposition: \"top\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\t\tbackground: '#00428F',\n\t\t\t\t\t\t\tcontentBackground: '#00428F',\n\t\t\t\t\t\t\tdarkMode: true,\n\t\t\t\t\t\t\tcontentNoPaddings: true,\n\t\t\t\t\t\t\tanimation: \"fading\",\n\t\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\t\tcontentBorderRadius: '18px',\n\t\t\t\t\t\t\tzIndex: 11,\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonPopupClose: function ()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tself.floorRequestElements.popup = null;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.setNewSettingForPopup();\n\t\t\t\t\tthis.floorRequestElements.popup.show();\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\n\t\tthis.updateFloorRequestCounter(true);\n\t}\n\n\trender()\n\t{\n\t\tthis.renderButtons();\n\t\tthis.renderUserPanel();\n\t\tthis.renderNotificationPanel();\n\t\tthis.renderFloorRequestCounter();\n\t\tthis.updateFloorRequestsList({\n\t\t\tfloorRequestsList: this.previousFloorRequestNotifications,\n\t\t})\n\n\t\tthis.template = Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-call-picture-in-picture-window',\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: (event) =>\n\t\t\t\t{\n\t\t\t\t\tthis._onButtonClick({ buttonName: 'returnToCall', event });\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tif (!!this.userPanel)\n\t\t{\n\t\t\tthis.template.appendChild(this.userPanel);\n\t\t}\n\n\t\tif (!!this.actionsPanel)\n\t\t{\n\t\t\tthis.template.appendChild(this.actionsPanel);\n\t\t}\n\n\t\tif (!!this.notificationPanel)\n\t\t{\n\t\t\tthis.template.appendChild(this.notificationPanel);\n\t\t}\n\n\t\tif (!!this.floorRequestElements.counter)\n\t\t{\n\t\t\tthis.template.appendChild(this.floorRequestElements.counter);\n\t\t}\n\t}\n\n\tsetHeightPictureWindow()\n\t{\n\t\t// TODO: debounce/throttle\n\t\tif (!this.template)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst pictureWindowHeight = this.template.clientHeight;\n\t\tconst isMinHeight = pictureWindowHeight <= 80;\n\n\t\tif (this.isMinHeight === isMinHeight)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isMinHeight && !!this.floorRequestElements.popup)\n\t\t{\n\t\t\tthis.floorRequestElements.popup.close();\n\t\t}\n\n\t\tthis.isMinHeight = isMinHeight;\n\n\t\tthis.template.classList[this.isMinHeight ? 'add' : 'remove']('bx-call-picture-in-picture-window_min');\n\n\t\treturn true;\n\t}\n\n\tsetWidthPictureWindow()\n\t{\n\t\t// TODO: debounce/throttle\n\t\tif (!this.template)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst pictureWindowWidth = this.template.clientWidth;\n\t\tconst isMinWidth = pictureWindowWidth <= 310;\n\n\t\tif (this.isMinWidth === isMinWidth)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.isMinWidth = isMinWidth;\n\n\t\tthis.template.classList[this.isMinWidth ? 'add' : 'remove']('bx-call-picture-in-picture-window_thin');\n\n\t\treturn true;\n\t}\n\n\tsetAvatarSettings()\n\t{\n\t\tif (!this.userPanel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst avatarSize = this.userPanel.clientHeight * 0.45;\n\t\tconst avatarTextSize = avatarSize * 0.45;\n\n\t\tthis.userPanel.style.setProperty('--avatar-size', avatarSize + 'px');\n\t\tthis.userPanel.style.setProperty('--avatar-text-size', avatarTextSize + 'px');\n\t}\n\n\tonMouseMove(event)\n\t{\n\t\tthis.onMouseOutCallbackForPopup(event);\n\t}\n\n\tonResize()\n\t{\n\t\tthis.setAvatarSettings();\n\t\tconst isHeightUpdated = this.setHeightPictureWindow();\n\t\tconst isWidthUpdated = this.setWidthPictureWindow();\n\n\t\tif (isHeightUpdated || isWidthUpdated)\n\t\t{\n\t\t\tthis.updateButtons();\n\t\t}\n\n\t\tif (this.floorRequestElements.popup)\n\t\t{\n\t\t\tthis.floorRequestElements.popup.close();\n\t\t}\n\t}\n\n\ttoggleEvents(isActive)\n\t{\n\t\tconst eventName = isActive ? 'addEventListener' : 'removeEventListener';\n\n\t\tif (this.pictureWindow)\n\t\t{\n\t\t\tthis.pictureWindow[eventName]('pagehide', (event) => {\n\t\t\t\tthis.onClose();\n\t\t\t});\n\n\t\t\tthis.pictureWindow[eventName]('resize', (event) => {\n\t\t\t\tthis.onResize();\n\t\t\t});\n\n\t\t\tthis.pictureWindow[eventName]('mousemove', (event) => {\n\t\t\t\tthis.onMouseMove(event);\n\t\t\t});\n\t\t}\n\t}\n\n\tasync checkAvailableAndCreate()\n\t{\n\t\tif (this.pictureWindow)\n\t\t{\n\t\t\treturn this.pictureWindow;\n\t\t}\n\n\t\tif (window.documentPictureInPicture?.requestWindow)\n\t\t{\n\t\t\tthis.render();\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.pictureWindow = await window.documentPictureInPicture.requestWindow({\n\t\t\t\t\tdisallowReturnToOpener: true,\n\t\t\t\t\twidth: 370,\n\t\t\t\t\theight: 215,\n\t\t\t\t\tpreferInitialWindowPlacement: false,\n\t\t\t\t});\n\n\t\t\t\tthis.toggleEvents(true);\n\n\t\t\t\t[...document.styleSheets].forEach((styleSheet) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst cssRules = [...styleSheet.cssRules].map((rule) => rule.cssText).join('');\n\t\t\t\t\t\tconst style = document.createElement('style');\n\n\t\t\t\t\t\tstyle.textContent = cssRules;\n\t\t\t\t\t\tthis.pictureWindow.document.head.appendChild(style);\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconst link = document.createElement('link');\n\n\t\t\t\t\t\tlink.rel = 'stylesheet';\n\t\t\t\t\t\tlink.type = styleSheet.type;\n\t\t\t\t\t\tlink.media = styleSheet.media;\n\t\t\t\t\t\tlink.href = styleSheet.href;\n\t\t\t\t\t\tthis.pictureWindow.document.head.appendChild(link);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.pictureWindow.document.body.append(this.template);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tthis.onClose();\n\t\t\t}\n\n\t\t} else {\n\t\t\tthis.onClose();\n\t\t}\n\t}\n\n\tonClose()\n\t{\n\t\tif (typeof this.callbacks?.onClose === 'function')\n\t\t{\n\t\t\tthis.callbacks.onClose();\n\t\t}\n\n\t\tif (this.template)\n\t\t{\n\t\t\tBX.remove(this.template);\n\t\t}\n\n\t\tthis.destroyCurrentUser();\n\n\t\tthis.close();\n\t\tthis.pictureWindow = null;\n\n\t\tthis.template = null;\n\t\tthis.toggleEvents(false);\n\t}\n\n\tclose()\n\t{\n\t\tif (this.pictureWindow)\n\t\t{\n\t\t\tthis.pictureWindow.close();\n\t\t}\n\t}\n\n\tstatic get isAvailable(): boolean\n\t{\n\t\treturn UnsupportedBrowserFeatures.isPiPAvailable\n\t}\n}","import {Type} from 'main.core';\nimport {Menu, MenuManager} from 'main.popup';\n\nexport class UserSelector\n{\n\tconstructor(config)\n\t{\n\t\tthis.userList = config.userList;\n\t\tthis.current = config.current;\n\t\tthis.parentElement = config.parentElement;\n\t\tthis.zIndex = config.zIndex;\n\n\t\tthis.menu = null;\n\n\t\tthis.callbacks = {\n\t\t\tonSelect: Type.isFunction(config.onSelect) ? config.onSelect : BX.DoNothing\n\t\t}\n\t};\n\n\tstatic create(config)\n\t{\n\t\treturn new UserSelector(config);\n\t}\n\n\tshow()\n\t{\n\t\tlet menuItems = [];\n\n\t\tthis.userList.forEach((user) =>\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\tid: user.id,\n\t\t\t\ttext: user.name || \"unknown (\" + user.id + \")\",\n\t\t\t\tclassName: (this.current == user.id ? \"menu-popup-item-accept\" : \"device-selector-empty\"),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.close();\n\t\t\t\t\tthis.callbacks.onSelect(user.id);\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tthis.menu = new Menu({\n\t\t\tid: 'call-view-select-user',\n\t\t\tbindElement: this.parentElement,\n\t\t\titems: menuItems,\n\t\t\tautoHide: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tcloseByEsc: true,\n\t\t\toffsetTop: 0,\n\t\t\toffsetLeft: 0,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\tangle: false,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: 'white',\n\t\t\t\topacity: 0\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu.popupWindow.destroy();\n\t\t\t\t\tMenuManager.destroy('call-view-select-device');\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.menu = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.menu.popupWindow.show();\n\t}\n}","import { Dom, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { PromoManager } from 'im.v2.lib.promo';\n\nimport '../css/aha-moment-notify.css';\n\nconst SPOTLIGHT_ID_PREFIX = 'bx-call-aha-moment-notify_spotlight';\n\nexport class AhaMomentNotify {\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\t\tthis.id = config.id || Math.random().toString(16).slice(2);\n\t\tthis.notifyText = config.notifyText || '';\n\t\tthis.notifyTitle = config.notifyTitle || '';\n\t\tthis.promoId = config.promoId || '';\n\t\tthis.popupTemplate = null;\n\t\tthis.bindElement = config.bindElement;\n\t\tthis.notifyColor = '#22272B';\n\t\tthis.spotlight = null;\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t}\n\t}\n\n\tgetPopupTemplate()\n\t{\n\t\tif (this.popupTemplate)\n\t\t{\n\t\t\treturn;\n\t\t}\t\t\t\n\t\t\n\t\tthis.popupTemplate = Dom.create('div', {\n\t\t\tprops: {className: 'bx-call-aha-moment-notify__content'},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-call-aha-moment-line-top'},\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-call-aha-moment-notify__title'},\n\t\t\t\t\ttext: this.notifyTitle,\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-call-aha-moment-notify__message'},\n\t\t\t\t\ttext: this.notifyText,\n\t\t\t\t}),\n\t\t\t\tDom.create(\"span\", {\n\t\t\t\t\tprops: {className: 'popup-window-close-icon'},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tif (this.promoId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tPromoManager.getInstance().markAsWatched(this.promoId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t}\n\t\n\tgetSpotlight()\n\t{\n\t\tif (!this.bindElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif (this.spotlight)\n\t\t{\n\t\t\tthis.spotlight.close();\n\t\t\tthis.spotlight = null;\n\t\t}\t\t\n\t\t\n\t\tconst id = `${SPOTLIGHT_ID_PREFIX}_${this.id}`;\n\n\t\tthis.spotlight = new BX.SpotLight({\n\t\t\tid,\n\t\t\ttargetElement: this.bindElement,\n\t\t\ttargetVertex: 'middle-center',\n\t\t\tlightMode: true,\n\t\t\tzIndex: 1500,\n\t\t});\t\t\n\n\t\treturn this.spotlight;\n\t}\n\n\tcreate()\n\t{\n\t\tconst self = this;\n\n\t\tthis.getPopupTemplate();\n\n\t\tif (!this.bindElement || !this.popupTemplate || this.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName : 'bx-call-aha-moment-notify',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.popupTemplate,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom',\n\t\t\t\tforceBindPosition: true,\n\t\t\t},\n\t\t\toffsetTop: 23,\n\t\t\tbackground: this.notifyColor,\n\t\t\tcontentBackground: this.notifyColor,\n\t\t\tdarkMode: true,\n\t\t\tanimation: 'fading',\n\t\t\tautoHide: false,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\tself.callbacks.onClose();\n\t\t\t\t\tif (self.spotlight)\n\t\t\t\t\t{\n\t\t\t\t\t\tself.spotlight.close();\n\t\t\t\t\t}\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tself.popup = null;\n\t\t\t\t},\n\t\t\t\tonShow: () => {\n\t\t\t\t\tconst popupWidth = this.popup.getPopupContainer().offsetWidth;\n\t\t\t\t\tconst elementWidth = this.popup.bindElement.offsetWidth;\n\t\t\t\t\tconst offsetFix = 0;\n\n\t\t\t\t\tthis.popup.setOffset({\n\t\t\t\t\t\toffsetLeft: elementWidth - offsetFix - popupWidth / 2\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.popup.setAngle({\n\t\t\t\t\t\toffset: (popupWidth / 2) - 33,\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t});\n\t\t\t\t\tthis.popup.adjustPosition();\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tif (self.spotlight)\n\t\t\t\t\t{\n\t\t\t\t\t\tself.spotlight.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.create();\n\n\t\tif (!this.bindElement || !this.popupTemplate)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif(!this.spotlight)\n\t\t{\n\t\t\tthis.getSpotlight();\n\t\t}\n\t\t\n\t\tthis.spotlight.show();\n\t\tthis.spotlight.getTargetContainer().hidden = false;\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t}\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t\t\n\t\tif (this.spotlight)\n\t\t{\n\t\t\tthis.spotlight.close();\n\t\t}\n\t}\n}\n","import { Dom, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { CallCloudRecord } from '../call_common_record';\nimport { Analytics } from 'call.lib.analytics';\n\nimport '../css/cloud-record-info-popup.css';\nimport Util from '../util';\n\nexport class CloudRecordInfoPopup\n{\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\t\tthis.popupTemplate = null;\n\t\tthis.isCloudRecordFeaturesEnabled = config.isCloudRecordFeaturesEnabled;\n\t\tthis.callId = config.callId;\n\n\t\tthis.callbacks = {\n\t\t\tturnOn: BX.type.isFunction(config.turnOn) ? config.turnOn : BX.DoNothing,\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t};\n\t}\n\n\t#getTemplateButton()\n\t{\n\t\tif (!this.isCloudRecordFeaturesEnabled)\n\t\t{\n\t\t\tthis.sendAnalytics('private_coming_soon');\n\n\t\t\treturn Dom.create('span', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: 'call-cloud-record-info-popup__coming-soon',\n\t\t\t\t},\n\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_BUTTON_COMING_SOON'),\n\t\t\t});\n\t\t}\n\n\t\treturn Dom.create('button', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'call-cloud-record-info-popup__button --primary',\n\t\t\t},\n\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_BUTTON_TURN_ON'),\n\t\t\tevents: {\n\t\t\t\tclick: () => {\n\t\t\t\t\tthis.callbacks.turnOn();\n\t\t\t\t\tthis.close();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#setTariffTemplate()\n\t{\n\t\tthis.popupTemplate = Dom.create('div', {\n\t\t\tprops: { className: 'call-cloud-record-info-popup' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__wrapper' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__icon' },\n\t\t\t\t\t\t}),\n\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__text' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__title' },\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_TARIFF_TITLE'),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__subtitle' },\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_TARIFF_SUBTITLE'),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\n\t\t\t\t\t\tDom.create('ul', {\n\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__list' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('li', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_icon --like',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_text',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_TARIFF_ITEM_LIKE'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('li', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_icon --devices',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_text',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_TARIFF_ITEM_DEVICE'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('li', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_icon --cloud',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_text',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_TARIFF_ITEM_CLOUD'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__action' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('button', {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__button --secondary',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__button_wrapper',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__button_icon',\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__button_text',\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_BUTTON_BUY'),\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\t\t\t\tUtil.openArticle(CallCloudRecord.tariffSlider);\n\t\t\t\t\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.sendAnalytics('tariff_limit');\n\t}\n\n\t#setMainTemplate()\n\t{\n\t\tthis.popupTemplate = Dom.create('div', {\n\t\t\tprops: { className: 'call-cloud-record-info-popup' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__wrapper' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__icon' },\n\t\t\t\t\t\t}),\n\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__text' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__title' },\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_MAIN_TITLE'),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__subtitle' },\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_MAIN_SUBTITLE'),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\n\t\t\t\t\t\tDom.create('ul', {\n\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__list' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('li', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_icon --cloud',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_text',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_MAIN_ITEM_CLOUD'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('li', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_icon --like',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_text',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_MAIN_ITEM_LIKE'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('li', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_icon --devices',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-info-popup__list-item_text',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_INFO_POPUP_MAIN_ITEM_DEVICE'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'call-cloud-record-info-popup__action' },\n\t\t\t\t\t\t\tchildren: [this.#getTemplateButton()],\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\t}\n\n\t#create()\n\t{\n\t\tconst bindElement = document.querySelector('.bx-messenger-videocall-panel-background-record');\n\n\t\tif (!bindElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (CallCloudRecord.tariffAvailable)\n\t\t{\n\t\t\tthis.#setMainTemplate();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#setTariffTemplate();\n\t\t}\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName: 'call-cloud-record-info-popup',\n\t\t\tbindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.popupTemplate,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top',\n\t\t\t},\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbackground: '#1f51ae',\n\t\t\tborderRadius: '18px',\n\t\t\tcontentBackground: '#0D2F70',\n\t\t\tdarkMode: true,\n\t\t\tcontentNoPaddings: true,\n\t\t\tanimation: 'fading',\n\t\t\twidth: 406,\n\t\t\tpadding: 0,\n\t\t\tangle: {\n\t\t\t\toffset: 183,\n\t\t\t\tposition: 'bottom',\n\t\t\t},\n\t\t\toffsetLeft: -139,\n\t\t\tcontentBorderRadius: '18px',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\tthis.popup.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => {\n\t\t\t\t\tthis.popup = null;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.#create();\n\t\tthis.popup.show();\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\ttoggle()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.close();\n\t}\n\n\tsendAnalytics(popupType)\n\t{\n\t\tAnalytics.getInstance().onCloudRecordPopupShow({\n\t\t\tcallId: this.callId,\n\t\t\tpopupType,\n\t\t});\n\t}\n}\n","import { Dom, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\n\nimport '../css/common-record-menu-popup.css';\n\nexport class CommonRecordMenuPopup\n{\n\t#popupType;\n\t#state;\n\t#isDesktopRecord;\n\tconstructor(config) {\n\t\tthis.popup = null;\n\t\tthis.popupTemplate = null;\n\t\tthis.#popupType = config.popupType || 'kind'; // kind || control\n\t\tthis.#state = config.state;\n\t\tthis.#isDesktopRecord = config.isDesktopRecord;\n\n\t\tthis.callbacks = {\n\t\t\tonStart: BX.type.isFunction(config.onStart) ? config.onStart : BX.DoNothing,\n\t\t\tonStop: BX.type.isFunction(config.onStop) ? config.onStop : BX.DoNothing,\n\t\t\tonPause: BX.type.isFunction(config.onPause) ? config.onPause : BX.DoNothing,\n\t\t\tonDestroy: BX.type.isFunction(config.onDestroy) ? config.onDestroy : BX.DoNothing,\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t};\n\t}\n\n\t#getKindButtons() {\n\t\treturn [\n\t\t\tDom.create('div', {\n\t\t\t\tprops: { className: 'call-common-record-menu-popup__button' },\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: { className: 'call-common-record-menu-popup__button_text' },\n\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_MENU_RECORD_AUDIO'),\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.callbacks.onStart('audio');\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t\tDom.create('div', {\n\t\t\t\tprops: { className: 'call-common-record-menu-popup__button' },\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: { className: 'call-common-record-menu-popup__button_text' },\n\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_MENU_RECORD_VIDEO'),\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.callbacks.onStart('video');\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t];\n\t}\n\n\t#getControlButtons() {\n\t\tconst buttons = [];\n\n\t\tif (!this.#isDesktopRecord)\n\t\t{\n\t\t\tbuttons.push(\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'call-common-record-menu-popup__button  --destroy' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\t\tprops: { className: 'call-common-record-menu-popup__button_text' },\n\t\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_MENU_DESTROY_RECORD'),\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\t\tprops: { className: 'call-common-record-menu-popup__button_icon --destroy' },\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.callbacks.onDestroy();\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tbuttons.push(\n\t\t\tDom.create('div', {\n\t\t\t\tprops: { className: 'call-common-record-menu-popup__button' },\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: { className: 'call-common-record-menu-popup__button_text' },\n\t\t\t\t\t\ttext:\n\t\t\t\t\t\t\tthis.#state === 'paused'\n\t\t\t\t\t\t\t\t? Loc.getMessage('CALL_CLOUD_RECORD_MENU_RESUME_RECORD')\n\t\t\t\t\t\t\t\t: Loc.getMessage('CALL_CLOUD_RECORD_MENU_PAUSE_RECORD'),\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: `call-common-record-menu-popup__button_icon ${this.#state === 'paused' ? '--resume' : '--pause'}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.callbacks.onPause();\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\n\t\t\tDom.create('div', {\n\t\t\t\tprops: { className: 'call-common-record-menu-popup__button' },\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: { className: 'call-common-record-menu-popup__button_text' },\n\t\t\t\t\t\ttext: Loc.getMessage('CALL_CLOUD_RECORD_MENU_STOP_RECORD'),\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\tprops: { className: 'call-common-record-menu-popup__button_icon --stop' },\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.callbacks.onStop();\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\n\t\treturn buttons;\n\t}\n\n\t#getTemplateButtons() {\n\t\tif (this.#popupType === 'kind')\n\t\t{\n\t\t\treturn this.#getKindButtons();\n\t\t}\n\n\t\treturn this.#getControlButtons();\n\t}\n\n\t#getPopupTemplate() {\n\t\tthis.popupTemplate = Dom.create('div', {\n\t\t\tprops: { className: `call-common-record-menu-popup__wrapper --${this.#popupType}` },\n\t\t\tchildren: this.#getTemplateButtons(),\n\t\t});\n\t}\n\n\t#create() {\n\t\tconst copilotButton = document.querySelector('.bx-messenger-videocall-panel-background-record');\n\n\t\tif (!copilotButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#getPopupTemplate();\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName: 'call-common-record-menu-popup',\n\t\t\tbindElement: copilotButton,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.popupTemplate,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top',\n\t\t\t},\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbackground: '#00428F',\n\t\t\tcontentBackground: '#00428F',\n\t\t\tdarkMode: true,\n\t\t\tcontentNoPaddings: true,\n\t\t\tanimation: 'fading',\n\t\t\tpadding: 0,\n\t\t\tangle: {\n\t\t\t\tposition: 'bottom',\n\t\t\t},\n\t\t\toffsetLeft: 20,\n\t\t\tcontentBorderRadius: '6px',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\tthis.popup.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => {\n\t\t\t\t\tthis.popup = null;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tshow() {\n\t\tthis.#create();\n\t\tthis.popup.show();\n\t}\n\n\tclose() {\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\ttoggle() {\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.close();\n\t}\n}\n","import { Dom } from 'main.core';\n\nimport '../css/confirm-modal.css';\n\ntype ConfirmModalOptions = {\n\tonClickYesButton?: 'function',\n\tonClickNoButton?: 'function',\n\tonClose?: 'function',\n\ttitle: string,\n\tmessage: string,\n\tyesButtonText: string,\n\tnoButtonText: string,\n};\n\nexport class ConfirmModal\n{\n\tconstructor(config: ConfirmModalOptions)\n\t{\n\t\tthis.popup = null;\n\n\t\tthis.callbacks = {\n\t\t\tonClickYesButton: BX.type.isFunction(config.onClickYesButton) ? config.onClickYesButton : BX.DoNothing,\n\t\t\tonClickNoButton: BX.type.isFunction(config.onClickNoButton) ? config.onClickNoButton : BX.DoNothing,\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t};\n\n\t\tthis.title = BX.type.isString(config.title) ? config.title : '';\n\t\tthis.message = BX.type.isString(config.message) ? config.message : '';\n\t\tthis.yesButtonText = BX.type.isString(config.yesButtonText) ? config.yesButtonText : '';\n\t\tthis.noButtonText = BX.type.isString(config.noButtonText) ? config.noButtonText : '';\n\t}\n\n\t#getButtons()\n\t{\n\t\tconst buttons = [];\n\n\t\tif (this.yesButtonText)\n\t\t{\n\t\t\tbuttons.push(Dom.create('button', {\n\t\t\t\tprops: { className: 'call-confirm-modal__button call-confirm-modal__button-yes' },\n\t\t\t\ttext: this.yesButtonText,\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.callbacks.onClickYesButton();\n\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}));\n\t\t}\n\n\t\tif (this.noButtonText)\n\t\t{\n\t\t\tbuttons.push(\n\t\t\t\tDom.create('button', {\n\t\t\t\t\tprops: { className: 'call-confirm-modal__button call-confirm-modal__button-no' },\n\t\t\t\t\ttext: this.noButtonText,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.callbacks.onClickNoButton();\n\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\treturn buttons;\n\t}\n\n\tcreate()\n\t{\n\t\tthis.popup = BX.UI.Dialogs.MessageBox.create({\n\t\t\tmodal: true,\n\t\t\tpopupOptions: {\n\t\t\t\tcontent: Dom.create('div', {\n\t\t\t\t\tprops: { className: 'call-confirm-modal__content' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'call-confirm-modal__title' },\n\t\t\t\t\t\t\ttext: this.title,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'call-confirm-modal__message' },\n\t\t\t\t\t\t\ttext: this.message,\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'call-confirm-modal__actions' },\n\t\t\t\t\t\t\tchildren: this.#getButtons(),\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tclassName: 'call-confirm-modal',\n\t\t\t\tdarkMode: true,\n\t\t\t\tcontentBackground: '#22272B',\n\t\t\t\tcontentBorderRadius: '10px',\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcloseIcon: true,\n\t\t\t\tcontentNoPaddings: true,\n\t\t\t\twidth: 420,\n\t\t\t\tmaxWidth: 420,\n\t\t\t\tanimation: 'fading',\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupClose: () => {\n\t\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\t\tthis.popup = null;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.close();\n\t\tthis.create();\n\n\t\tthis.popup.show();\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n}\n","import { Utils } from 'im.v2.lib.utils';\nimport { Dom, Loc, Type } from 'main.core';\nimport { Popup } from 'main.popup';\nimport '../css/talking-popup.css';\n\nexport class TalkingPopup\n{\n\tconstructor(options)\n\t{\n\t\tthis.popup = null;\n\t\tthis.customClassName = BX.prop.getString(options, 'customClassName', '');\n\t\tthis.bindElement = BX.prop.getElementNode(options, 'bindElement', null);\n\t\tthis.targetContainer = BX.prop.getElementNode(options, 'targetContainer', null);\n\n\t\tthis.content = options.content;\n\n\t\tthis.closingDelay = 1500;\n\t\tthis.closingDuration = 500;\n\t\tthis.closingTimeout = null;\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(options, 'onClose', BX.DoNothing),\n\t\t};\n\t}\n\n\tshow()\n\t{\n\t\tif (Type.isNumber(this.closingTimeout) || Dom.hasClass(this.popup?.getPopupContainer(), 'closing'))\n\t\t{\n\t\t\tthis.clearClosingTimeout();\n\t\t\tif (Dom.hasClass(this.popup?.getPopupContainer(), 'closing'))\n\t\t\t{\n\t\t\t\tDom.removeClass(this.popup?.getPopupContainer(), 'closing');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\tif (!Dom.hasClass(this.popup?.getPopupContainer(), 'opening'))\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.popup?.getPopupContainer(), 'opening');\n\t\t\t\t}\n\n\t\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\t\tDom.removeClass(this.popup?.getPopupContainer(), 'opening');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.popup = new Popup({\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\ttargetContainer: this.targetContainer,\n\t\t\t\tcontent: this.render(),\n\t\t\t\tpadding: 0,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tclassName: (`bx-call-view-popup-talking ${this.customClassName} opening`),\n\t\t\t\tzIndexOptions: { alwaysOnTop: true },\n\t\t\t\tbackground: '#085DC1',\n\t\t\t\tcontentBackground: '#085DC1',\n\t\t\t\tdarkMode: true,\n\t\t\t\tcontentBorderRadius: '18px',\n\t\t\t\tborderRadius: '18px',\n\t\t\t\tangle: false,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t},\n\t\t\t\t\tonDestroy: () => this.popup = null,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tthis.popup.show();\n\t}\n\n\trender()\n\t{\n\t\tconst avatarText = Utils.text.getFirstLetters(this.content.name).toUpperCase();\n\n\t\treturn Dom.create('div', {\n\t\t\tprops: { className: 'bx-call-view-popup-talking-body' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: `bx-call-view-popup-talking-avatar ${this.content.avatar ? '' : 'no-photo'}`,\n\n\t\t\t\t\t},\n\t\t\t\t\tstyle: { 'background-image': `url(\"${this.content.avatar}\")` },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'bx-call-view-popup-talking-avatar-text',\n\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: this.content.avatar ? '' : avatarText,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-call-view-popup-talking-text' },\n\t\t\t\t\ttext: Loc.getMessage('CALL_TALKING_POPUP_TEXT', {\n\t\t\t\t\t\t'#NAME#': this.content.name,\n\t\t\t\t\t}),\n\t\t\t\t}),\n\n\t\t\t],\n\t\t});\n\t}\n\n\tsetContent(content)\n\t{\n\t\tthis.content = content;\n\t\tif (!this.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.popup.setContent(this.render());\n\t}\n\n\tclose(callback) {\n\t\tthis.clearClosingTimeout();\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t\tthis.callbacks.onClose();\n\t\t}\n\n\t\tif (callback)\n\t\t{\n\t\t\tcallback();\n\t\t}\n\t\tthis.destroy();\n\t}\n\n\tanimatedClose(callback)\n\t{\n\t\tthis.clearClosingTimeout();\n\t\tif (!Dom.hasClass(this.popup?.getPopupContainer(), 'closing'))\n\t\t{\n\t\t\tDom.addClass(this.popup?.getPopupContainer(), 'closing');\n\t\t}\n\n\t\tthis.closingTimeout = setTimeout(() => {\n\t\t\tthis.close(callback);\n\t\t}, this.closingDuration);\n\t}\n\n\tclearClosingTimeout() {\n\t\tclearTimeout(this.closingTimeout);\n\t\tthis.closingTimeout = null;\n\t}\n\n\tcloseWithDelay(isForce, callback)\n\t{\n\t\tif (isForce)\n\t\t{\n\t\t\tthis.close(callback);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.clearClosingTimeout();\n\t\t\tif (Dom.hasClass(this.popup?.getPopupContainer(), 'closing'))\n\t\t\t{\n\t\t\t\tDom.removeClass(this.popup?.getPopupContainer(), 'closing');\n\t\t\t}\n\t\t\tthis.closingTimeout = setTimeout(() => {\n\t\t\t\tthis.animatedClose(callback);\n\t\t\t}, this.closingDelay);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.clearClosingTimeout();\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\t}\n}\n","import { CallUser } from './call-user';\nimport { TalkingPopup } from './talking-popup';\n\nexport class TalkingService\n{\n\ttalkingPopup: ?TalkingPopup;\n\tactiveId: ?number | null;\n\tqueue: number[];\n\tusers: { [key: number]: CallUser; };\n\troot: ?HTMLElement | null;\n\n\tconstructor(config)\n\t{\n\t\tthis.hasQueue = this.hasQueue.bind(this);\n\t\tthis.refreshQueue = this.refreshQueue.bind(this);\n\t\tthis.watchTalking = this.watchTalking.bind(this);\n\t\tthis.deleteFromQueue = this.deleteFromQueue.bind(this);\n\t\tthis.updateQueue = this.updateQueue.bind(this);\n\t\tthis.showPopup = this.showPopup.bind(this);\n\t\tthis.hidePopup = this.hidePopup.bind(this);\n\n\t\tthis.root = config?.root ?? null;\n\t\tthis.users = {};\n\t\tthis.activeId = null;\n\t\tthis.queue = [];\n\t}\n\n\tinit(config) {\n\t\tthis.root = config?.root ?? null;\n\t}\n\n\thasQueue() {\n\t\treturn this.queue.length > 0;\n\t}\n\n\trefreshQueue() {\n\t\tif (this.hasQueue())\n\t\t{\n\t\t\tthis.updateQueue();\n\t\t}\n\t}\n\n\twatchTalking(event) {\n\t\tconst eventData = event.data;\n\n\t\tconst userId = BX.prop.getInteger(eventData.user.data, 'id', 0);\n\n\t\tif (userId < 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (eventData.fieldName === 'talking')\n\t\t{\n\t\t\tthis.updateQueue({ user: eventData.user.data, isUserTalking: eventData.newValue });\n\t\t}\n\t\telse if (eventData.fieldName === 'order')\n\t\t{\n\t\t\tthis.refreshQueue();\n\t\t}\n\t}\n\n\tdeleteFromQueue(userId) {\n\t\tconst index = this.queue.indexOf(userId);\n\t\tif (index > -1)\n\t\t{\n\t\t\tthis.queue.splice(index, 1);\n\t\t\tdelete this.users[userId];\n\t\t}\n\t}\n\n\tupdateQueue(config) {\n\t\tlet user = null;\n\t\tlet isUserTalking = false;\n\t\tif (config)\n\t\t{\n\t\t\tuser = config.user;\n\t\t\tisUserTalking = config.isUserTalking;\n\t\t}\n\n\t\tlet mutedUserId = null;\n\t\tlet newActiveId = null;\n\t\tconst deleteUserFromQueue = () => {\n\t\t\tif (mutedUserId)\n\t\t\t{\n\t\t\t\tthis.deleteFromQueue(mutedUserId);\n\t\t\t}\n\t\t};\n\n\t\tif (user)\n\t\t{\n\t\t\tif (isUserTalking)\n\t\t\t{\n\t\t\t\tif (!this.users[user.id])\n\t\t\t\t{\n\t\t\t\t\tthis.queue.push(user.id);\n\t\t\t\t\tthis.users[user.id] = user;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmutedUserId = user.id;\n\t\t\t}\n\t\t}\n\n\t\tlet activeUserCard = null;\n\n\t\tif (this.activeId)\n\t\t{\n\t\t\tactiveUserCard = this.root?.querySelector(`.bx-messenger-videocall-user[data-user-id=\"${this.activeId}\"]`);\n\t\t}\n\n\t\tlet canPopupClose = false;\n\t\tconst userTalkAgain = user && user?.id === this.activeId && isUserTalking && this.talkingPopup?.closingTimeout;\n\n\t\tif (!this.activeId || activeUserCard || (mutedUserId && mutedUserId === this.activeId))\n\t\t{\n\t\t\tcanPopupClose = true;\n\n\t\t\tfor (const userId of this.queue)\n\t\t\t{\n\t\t\t\tif (userId === mutedUserId || userId === this.activeId)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst userCard = this.root?.querySelector(`.bx-messenger-videocall-user[data-user-id=\"${userId}\"]`);\n\n\t\t\t\tif (!userCard)\n\t\t\t\t{\n\t\t\t\t\tnewActiveId = userId;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (!userTalkAgain)\n\t\t{\n\t\t\tdeleteUserFromQueue();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.activeId && !newActiveId && canPopupClose)\n\t\t{\n\t\t\tthis.hidePopup(this.activeId !== mutedUserId, () => {\n\t\t\t\tdeleteUserFromQueue();\n\n\t\t\t\tthis.activeId = null;\n\t\t\t}, true);\n\t\t}\n\t\telse if ((this.activeId && newActiveId && this.activeId !== newActiveId)\n\t\t\t|| (!this.activeId && newActiveId))\n\t\t{\n\t\t\tthis.showPopup(this.users[newActiveId]);\n\t\t\tdeleteUserFromQueue();\n\t\t\tthis.activeId = newActiveId;\n\t\t}\n\t\telse if (userTalkAgain)\n\t\t{\n\t\t\tthis.showPopup(this.users[user?.id]);\n\t\t\tdeleteUserFromQueue();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdeleteUserFromQueue();\n\t\t}\n\t}\n\n\tshowPopup(user) {\n\t\tif (!this.talkingPopup)\n\t\t{\n\t\t\tthis.talkingPopup = new TalkingPopup({\n\t\t\t\tbindElement: document.body,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tcontent: user,\n\t\t\t});\n\t\t}\n\t\telse if (this.talkingPopup && this.activeId !== user.id)\n\t\t{\n\t\t\tthis.talkingPopup.setContent(user);\n\t\t}\n\n\t\tthis.talkingPopup.show();\n\t}\n\n\thidePopup(isForce, callback) {\n\t\tif (!this.talkingPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.talkingPopup.closeWithDelay(isForce, callback);\n\t}\n\n\tdestroy() {\n\t\tthis.hidePopup(true);\n\t\tthis.talkingPopup?.destroy();\n\t\tthis.users = {};\n\t\tthis.activeId = null;\n\t\tthis.queue = [];\n\t}\n}\n","import { Browser, Dom, Runtime, Text, Type, Loc } from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\n\nimport {UserModel, UserRegistry} from './user-registry'\nimport * as Buttons from './buttons';\nimport {BackgroundDialog} from '../dialogs/background_dialog';\nimport {CallUserMobile, MobileMenu, MobileSlider, UserSelectorMobile} from './mobile';\nimport {CallUser} from './call-user';\nimport {Hardware} from '../call_hardware';\nimport {FloorRequest} from './floor-request';\nimport {NotificationManager} from './notifications';\nimport {DeviceSelector} from './device-selector';\nimport {EndpointDirection, UserState} from '../engine/engine';\nimport Util from '../util';\nimport { CallAI } from '../call_ai';\nimport { CopilotNotify, CopilotNotifyType } from './copilot-notify';\nimport { MediaRenderer } from './media-renderer';\nimport { PictureInPictureWindow } from './pictureInPictureWindow';\nimport { Utils } from 'im.v2.lib.utils';\nimport {UserSelector} from './user-selector';\nimport { checkAndEncodeURI } from './tools';\n\nimport { PromoManager } from 'im.v2.lib.promo';\nimport { AhaMomentNotify } from './aha-moment-notify';\n\nimport '../css/view.css';\nimport { CloudRecordInfoPopup } from './cloud-record-info-popup';\nimport { CommonRecordMenuPopup } from './common-record-menu-popup';\nimport { ConfirmModal } from './confirm-modal';\nimport { Analytics } from 'call.lib.analytics';\nimport { CallCommonRecordState, CallCommonRecordType, CallCloudRecord } from '../call_common_record';\n\nimport { TalkingService } from './talking-service';\n\nimport { CallSettingsManager } from 'call.lib.settings-manager';\n\nconst Layouts = {\n\tGrid: 1,\n\tCentered: 2,\n\tMobile: 3\n};\n\nconst RerenderReason = {\n\tVideoEnabled: 'videoEnabled',\n\tVideoDisabled: 'videoDisabled',\n\tUserDisconnected: 'userDisconnected',\n};\n\nconst SwapType = {\n\tDirect: 'direct',\n\tReplace: 'replace',\n};\n\nconst UiState = {\n\tPreparing: 1,\n\tInitializing: 2,\n\tCalling: 3,\n\tConnected: 4,\n\tError: 5\n};\n\nconst Size = {\n\tFolded: 'folded',\n\tFull: 'full'\n};\n\nconst RoomState = {\n\tNone: 1,\n\tSpeaker: 2,\n\tNonSpeaker: 3,\n}\n\nconst EventName = {\n\tonShow: 'onShow',\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonButtonClick: 'onButtonClick',\n\tonBodyClick: 'onBodyClick',\n\tonReplaceCamera: 'onReplaceCamera',\n\tonReplaceMicrophone: 'onReplaceMicrophone',\n\tonReplaceSpeaker: 'onReplaceSpeaker',\n\tonSetCentralUser: 'onSetCentralUser',\n\tonLayoutChange: 'onLayoutChange',\n\tonChangeHdVideo: 'onChangeHdVideo',\n\tonChangeNoiseSuppression: 'onChangeNoiseSuppression',\n\tonChangeMicAutoParams: 'onChangeMicAutoParams',\n\tonChangeFaceImprove: 'onChangeFaceImprove',\n\tonChangeVideoQuality: 'onChangeVideoQuality',\n\tonUserClick: 'onUserClick',\n\tonUserRename: 'onUserRename',\n\tonUserPinned: 'onUserPinned',\n\tonDeviceSelectorShow: 'onDeviceSelectorShow',\n\tonOpenAdvancedSettings: 'onOpenAdvancedSettings',\n\tonHasMainStream: 'onHasMainStream',\n\tonTurnOffParticipantMic: 'onTurnOffParticipantMic',\n\tonTurnOffParticipantCam: 'onTurnOffParticipantCam',\n\tonTurnOffParticipantScreenshare: 'onTurnOffParticipantScreenshare',\n\tonAllowSpeakPermission: 'onAllowSpeakPermission',\n\tonDisallowSpeakPermission: 'onDisallowSpeakPermission',\n\tonToggleSubscribe: 'onToggleSubscribe',\n\tonUnfold: 'onUnfold',\n\tonPiPClose: 'onPiPClose',\n\tonCommonRecordMenu: 'onCommonRecordMenu',\n\tonPiPBodyClick: 'onPiPBodyClick',\n};\n\nconst beginingPosition = -1;\nconst newUserPosition = 999;\nconst addButtonPosition = 1001;\n\nconst MIN_WIDTH = 250;\n\nconst SIDE_USER_WIDTH = 160; // keep in sync with .bx-messenger-videocall-user-block .bx-messenger-videocall-user width\nconst SIDE_USER_HEIGHT = 90; // keep in sync with .bx-messenger-videocall-user height\n\nconst MAX_USERS_PER_PAGE = 19;\nconst MIN_GRID_USER_WIDTH = 180;\nconst MIN_GRID_USER_HEIGHT = 100;\n\nconst CHANGE_VIDEO_RERENDER_DELAY = 3000;\nconst WAITING_VIDEO_DELAY = 3000;\n\nconst CALLCONTROL_PROMO_ID = 'call:callcontrol-notify-promo:07052025:all';\nconst CLOUD_RECORD_PROMO_ID = 'call:cloud-record-info-popup:09092025:all';\n\ntype ViewOptions = {\n\ttitle: ?string,\n\tcontainer: HTMLElement,\n\tbaseZIndex: number,\n\tcameraId: string,\n\tmicrophoneId: string,\n\tshowChatButtons: boolean,\n\tshowUsersButton: boolean,\n\tshowShareButton: boolean,\n\tshowRecordButton: boolean,\n\tshowDocumentButton: boolean,\n\tshowButtonPanel: boolean,\n\tbroadcastingMode: boolean,\n\tbroadcastingPresenters: number[],\n\tlanguage: string,\n\tuserData: {},\n\tuserLimit: number,\n\tisIntranetOrExtranet: boolean,\n\tmediaSelectionBlocked: boolean,\n\tblockedButtons: string[],\n\thiddenButtons: string[],\n\thiddenTopButtons: string[],\n\tuiState: string,\n\tlayout: string,\n\tuserStates: {},\n\tshowAddUserButtonInList?: boolean,\n\tisCopilotFeaturesEnabled: boolean,\n\tisCopilotActive: boolean,\n\tisWindowFocus?: boolean,\n\tisVideoconf: boolean,\n}\n\nconst DocumentVisibilityState = {\n\thidden: 'hidden',\n\tvisible: 'visible',\n};\n\nexport class View\n{\n\tcentralUser: CallUser\n\tcallMenu: ?MobileMenu\n\tparticipantsMenu: ?MobileMenu\n\tpinnedUser: ?CallUser\n\tuserMenu: ?MobileMenu\n\tuserRegistry: UserRegistry\n\tusers: { [key: number]: CallUser; }\n\tscreenUsers: { [key: number]: CallUser; }\n\n\t#commonRecord;\n\t#confirmModal;\n\n\tconstructor(config: ViewOptions)\n\t{\n\t\tthis.title = config.title;\n\t\tthis.container = config.container;\n\t\tthis.baseZIndex = config.baseZIndex;\n\t\tthis.cameraId = config.cameraId;\n\t\tthis.microphoneId = config.microphoneId;\n\n\t\tthis.speakerId = '';\n\t\tthis.speakerMuted = false;\n\t\tthis.showChatButtons = (config.showChatButtons === true);\n\t\tthis.showUsersButton = (config.showUsersButton === true);\n\t\tthis.showShareButton = (config.showShareButton !== false);\n\t\tthis.showRecordButton = (config.showRecordButton !== false);\n\t\tthis.showDocumentButton = (config.showDocumentButton !== false);\n\t\tthis.showCopilotButton = (config.showCopilotButton !== false);\n\t\tthis.showButtonPanel = (config.showButtonPanel !== false);\n\t\tthis.showAddUserButtonInList = config.showAddUserButtonInList || false;\n\t\tthis.preferInitialWindowPlacementPictureInPicture = true;\n\n\t\tthis.limitation = null;\n\t\tthis.inactiveUsers = [];\n\t\tthis.activeUsers = [];\n\t\tthis.rerenderTimeout = null;\n\t\tthis.waitingForUserMediaTimeouts = new Map();\n\t\tthis.rerenderQueue = new Map();\n\t\tthis.shelvedRerenderQueue = new Map();\n\n\t\tthis.broadcastingMode = BX.prop.getBoolean(config, \"broadcastingMode\", false);\n\t\tthis.broadcastingPresenters = BX.prop.getArray(config, \"broadcastingPresenters\", []);\n\n\t\tthis.currentPage = 1;\n\t\tthis.pagesCount = 1;\n\n\t\tthis.usersPerPage = 0; // initializes after rendering and on resize\n\n\t\tthis.language = config.language || '';\n\n\t\tthis.lastPosition = 1;\n\n\t\tthis.userData = {};\n\t\tif (config.userData)\n\t\t{\n\t\t\tthis.updateUserData(config.userData);\n\t\t}\n\t\tthis.userLimit = config.userLimit || 1;\n\t\tthis.userId = BX.message('USER_ID');\n\t\tthis.isIntranetOrExtranet = BX.prop.getBoolean(config, \"isIntranetOrExtranet\", true);\n\t\tthis.users = {}; // Call participants. The key is the user id.\n\t\tthis.screenUsers = {}; // Screen sharing participants. The key is the user id.\n\t\tthis.userRegistry = new UserRegistry();\n\t\tthis.talkingService = new TalkingService();\n\n\t\tthis.userRegistry.subscribe('changed', this.talkingService.refreshQueue);\n\n\t\tlet localUserModel = new UserModel({\n\t\t\tid: this.userId,\n\t\t\tstate: BX.prop.getString(config, \"localUserState\", UserState.Connected),\n\t\t\tlocalUser: true,\n\t\t\torder: beginingPosition,\n\t\t\tname: this.userData[this.userId] ? this.userData[this.userId].name : '',\n\t\t\tavatar: this.userData[this.userId] ? this.userData[this.userId].avatar_hr : '',\n\t\t});\n\n\t\tif (this.userId)\n\t\t{\n\t\t\tthis.userRegistry.push(localUserModel);\n\t\t}\n\n\t\tthis.cache = new Map();\n\n\t\tthis.localUser = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: localUserModel,\n\t\t\tallowBackgroundItem: BackgroundDialog.isAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowMaskItem: BackgroundDialog.isMaskAvailable() && this.isIntranetOrExtranet,\n\t\t\tonUserRename: this._onUserRename.bind(this),\n\t\t\tonUserRenameInputFocus: this._onUserRenameInputFocus.bind(this),\n\t\t\tonUserRenameInputBlur: this._onUserRenameInputBlur.bind(this),\n\t\t\tonClick: this._onUserClick.bind(this),\n\t\t\tonTurnOffParticipantMic: this._onTurnOffParticipantMic.bind(this),\n\t\t\tonTurnOffParticipantCam: this._onTurnOffParticipantCam.bind(this),\n\t\t\tonTurnOffParticipantScreenshare: this._onTurnOffParticipantScreenshare.bind(this),\n\t\t\tonPin: this._onUserPin.bind(this),\n\t\t\tonUnPin: this._onUserUnPin.bind(this),\n\t\t});\n\n\t\tthis.centralUser = this.localUser; //show local user until someone is connected\n\t\tthis.centralUserMobile = null;\n\t\tthis.pinnedUser = null;\n\t\tthis.presenterId = null;\n\n\t\tthis.localUserReceivedStats = false;\n\n\t\tthis.returnToGridAfterScreenStopped = false;\n\n\t\tthis.mediaSelectionBlocked = (config.mediaSelectionBlocked === true);\n\n\t\tthis.visible = false;\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\twrap: null,\n\t\t\twatermark: null,\n\t\t\tcontainer: null,\n\t\t\toverlay: null,\n\t\t\ttopPanel: null,\n\t\t\tbottom: null,\n\t\t\tnotificationPanel: null,\n\t\t\tpanel: null,\n\t\t\taudioContainer: null,\n\t\t\tscreenAudioContainer: null,\n\t\t\taudio: {\n\t\t\t\t// userId: <audio> for this user's stream\n\t\t\t},\n\t\t\tscreenAudio: {\n\t\t\t\t// userId: <audio> for this user's stream\n\t\t\t},\n\t\t\tcenter: null,\n\t\t\tlocalUserMobile: null,\n\t\t\tuserBlock: null,\n\t\t\tear: {\n\t\t\t\tleft: null,\n\t\t\t\tright: null\n\t\t\t},\n\t\t\tuserList: {\n\t\t\t\tcontainer: null,\n\t\t\t\taddButton: null\n\t\t\t},\n\t\t\tuserSelectorContainer: null,\n\t\t\tpinnedUserContainer: null,\n\t\t\trenameSlider: {\n\t\t\t\tinput: null,\n\t\t\t\tbutton: null\n\t\t\t},\n\t\t\tpageNavigatorLeft: null,\n\t\t\tpageNavigatorLeftCounter: null,\n\t\t\tpageNavigatorRight: null,\n\t\t\tpageNavigatorRightCounter: null,\n\t\t};\n\n\t\tthis.buttons = {\n\t\t\ttitle: null,\n\t\t\tgrid: null,\n\t\t\tadd: null,\n\t\t\tshare: null,\n\t\t\trecord: null,\n\t\t\tdocument: null,\n\t\t\tcopilot: null,\n\t\t\tmicrophone: null,\n\t\t\tcamera: null,\n\t\t\tspeaker: null,\n\t\t\tscreen: null,\n\t\t\tmobileMenu: null,\n\t\t\tchat: null,\n\t\t\tusers: null,\n\t\t\thistory: null,\n\t\t\thangup: null,\n\t\t\tfullscreen: null,\n\t\t\toverlay: null,\n\t\t\tstatus: null,\n\t\t\treturnToCall: null,\n\t\t\trecordStatus: null,\n\t\t\tparticipants: null,\n\t\t\tparticipantsMobile: null,\n\t\t\twatermark: null,\n\t\t\thd: null,\n\t\t\tprotected: null,\n\t\t\tmore: null,\n\t\t\thangupOptions: null,\n\t\t};\n\n\t\tthis.previousTopButtonList = [];\n\t\tthis.needToRerenderTopButtonList = false;\n\t\tthis.previousButtonList = [];\n\t\tthis.needToRerenderButtonList = false;\n\n\t\tthis.size = Size.Full;\n\t\tthis.maxWidth = null;\n\t\tthis.isMuted = Hardware.isMicrophoneMuted;\n\t\tthis.isCameraOn = Hardware.isCameraOn;\n\t\tthis.isFullScreen = false;\n\t\tthis.isUserBlockFolded = false;\n\n\t\tthis.commonRecordState = this.getDefaultCommonRecordState();\n\n\t\tthis.blockedButtons = {};\n\t\tlet configBlockedButtons = BX.prop.getArray(config, \"blockedButtons\", []);\n\t\tconfigBlockedButtons.forEach(buttonCode => this.blockedButtons[buttonCode] = true);\n\n\t\tthis.hiddenButtons = {};\n\t\tthis.overflownButtons = {};\n\t\tif (!this.showUsersButton)\n\t\t{\n\t\t\tthis.hiddenButtons['users'] = true;\n\t\t}\n\t\tlet configHiddenButtons = BX.prop.getArray(config, \"hiddenButtons\", []);\n\t\tconfigHiddenButtons.forEach(buttonCode => this.hiddenButtons[buttonCode] = true);\n\n\t\tthis.hiddenTopButtons = {};\n\t\tlet configHiddenTopButtons = BX.prop.getArray(config, \"hiddenTopButtons\", []);\n\t\tconfigHiddenTopButtons.forEach(buttonCode => this.hiddenTopButtons[buttonCode] = true);\n\n\t\tthis.uiState = config.uiState || UiState.Calling;\n\t\tthis.layout = config.layout || Layouts.Centered;\n\t\tthis.whiteSpaceInUserGrid = 0;\n\t\tthis.roomState = RoomState.None;\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'BX.Call.View');\n\n\t\tthis.scrollInterval = 0;\n\n\t\t// Event handlers\n\t\tthis._onFullScreenChangeHandler = this._onFullScreenChange.bind(this);\n\t\t//this._onResizeHandler = BX.throttle(this._onResize.bind(this), 500);\n\t\tthis._onResizeHandler = this._onResize.bind(this);\n\t\tthis._onOrientationChangeHandler = BX.debounce(this._onOrientationChange.bind(this), 500);\n\t\tthis._onKeyDownHandler = this._onKeyDown.bind(this);\n\t\tthis._onKeyUpHandler = this._onKeyUp.bind(this);\n\n\t\tthis.resizeObserver = new BX.ResizeObserver(this._onResizeHandler);\n\t\tthis.intersectionObserver = null;\n\n\t\t// timers\n\t\tthis.switchPresenterTimeout = 0;\n\n\t\tthis.deviceSelector = null;\n\t\tthis.userSelector = null;\n\t\tthis.pinnedUserContainer = null;\n\n\t\tthis.renameSlider = null;\n\n\t\tthis.userSize = {width: 0, height: 0};\n\n\t\tthis.hintManager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tclassName: 'bx-messenger-videocall-panel-item-hotkey-hint',\n\t\t\t\tbindOptions: {forceBindPosition: true},\n\t\t\t\tangle: false\n\t\t\t}\n\t\t});\n\n\t\tthis.hotKey = {\n\t\t\tall: Util.isDesktop(),\n\t\t\tmicrophone: true,\n\t\t\tmicrophoneSpace: true,\n\t\t\tcamera: true,\n\t\t\tscreen: true,\n\t\t\trecord: true,\n\t\t\tspeaker: true,\n\t\t\tchat: true,\n\t\t\tusers: true,\n\t\t\tfloorRequest: true,\n\t\t\tmuteSpeaker: true,\n\t\t\tgrid: true,\n\t\t};\n\t\tthis.hotKeyTemporaryBlock = 0;\n\n\t\tthis._isPreparing = false;\n\t\tthis._videoRerenderDelay = 0;\n\n\t\tthis.isWindowFocus = config.isWindowFocus || false;\n\t\tthis._isActivePiPFromController = false;\n\n\t\tthis.enableAutoPip = false;\n\n\t\tconst pictureInPictureUpdateButtonHandler = () => {\n\t\t\tif (this.pictureInPictureCallWindow)\n\t\t\t{\n\t\t\t\tthis.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t\t}\n\t\t};\n\n\t\tconst openPiPHandler = (event, visibility) => {\n\t\t\tif (visibility === DocumentVisibilityState.hidden)\n\t\t\t{\n\t\t\t\tif (this.isVideoconf && (this.uiState !== UiState.Connected || !this.visible))\n\t\t\t\t{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tthis.toggleStatePictureInPictureCallWindow(true);\n\n\t\t\t\tthis.enableAutoPip = true;\n\t\t\t}\n\n\t\t\tconst isFolded = this.size === View.Size.Folded;\n\t\t\tconst isUserScreenSharing = this.hasCurrentUserScreenSharing();\n\t\t\tif (visibility === DocumentVisibilityState.visible)\n\t\t\t{\n\t\t\t\tthis.enableAutoPip = false;\n\t\t\t\tif (isUserScreenSharing)\n\t\t\t\t{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tif (isFolded)\n\t\t\t\t{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tthis.toggleStatePictureInPictureCallWindow(false);\n\t\t\t}\n\t\t};\n\n\t\tthis.viewVisibility = this.#getViewVisibilityChange([pictureInPictureUpdateButtonHandler, openPiPHandler]);\n\n\t\tthis.init();\n\t\tthis.subscribeEvents(config);\n\t\tif (Type.isPlainObject(config.userStates))\n\t\t{\n\t\t\tthis.appendUsers(config.userStates);\n\t\t}\n\n\t\t/*this.resizeCalled = 0;\n\t\tthis.reportResizeCalled = BX.debounce(function()\n\t\t{\n\t\t\tconsole.log('resizeCalled ' + this.resizeCalled + ' times');\n\t\t\tthis.resizeCalled = 0;\n\t\t}.bind(this), 100)*/\n\n\t\tthis.hideEarTimer = null;\n\n\t\tthis.isCopilotFeaturesEnabled = config.isCopilotFeaturesEnabled || false;\n\t\tthis.isCopilotActive = config.isCopilotActive || false;\n\t\tthis.copilotNotify = null;\n\n\t\tthis.ahaMomentNotify = null;\n\n\t\tthis.pictureInPictureCallWindow = null;\n\n\t\tthis.floorRequestNotifications = [];\n\t\tthis.currentPiPUserId = null;\n\n\t\tthis.isVideoconf = config.isVideoconf || false;\n\n\t\tthis.needToShowCallcontrolPromo = this.isVideoconf ? false : PromoManager.getInstance().needToShow(CALLCONTROL_PROMO_ID);\n\n\t\tthis.#commonRecord = {\n\t\t\tinfoPopup: null,\n\t\t\tmenuPopup: null,\n\t\t\tnotify: null,\n\t\t};\n\n\t\tthis.#confirmModal = null;\n\t};\n\n\topenArticle(articleCode)\n\t{\n\t\tconst infoHelper = BX.UI.InfoHelper;\n\n\t\tif (infoHelper.isOpen())\n\t\t{\n\t\t\tinfoHelper.close()\n\t\t}\n\n\t\tinfoHelper.show(articleCode);\n\t}\n\n\tonClickButtonWithLimit(limitObj, handle)\n\t{\n\t\tconst {enabled, articleCode} = limitObj;\n\n\t\tif (enabled && typeof handle === \"function\") {\n\t\t\thandle()\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!enabled && articleCode) {\n\t\t\tif (this.size === View.Size.Folded)\n\t\t\t{\n\t\t\t\tthis._onBodyClick();\n\t\t\t}\n\n\t\t\tthis.openArticle(articleCode)\n\t\t}\n\t}\n\n\tgetLimitation()\n\t{\n\t\tthis.limitation = Util.getCallFeatures();\n\t}\n\n\tgetLimitationByType(type)\n\t{\n\t\tconst defaultLimitation = {enable: true};\n\n\t\tconst currentLimitation = this.limitation?.[`call_${type}`];\n\n\t\tif (!currentLimitation) {\n\t\t\treturn defaultLimitation;\n\t\t}\n\n\t\treturn {\n\t\t\tenabled: currentLimitation.enable,\n\t\t\tarticleCode: currentLimitation.articleCode\n\t\t}\n\t}\n\n\tgetBackgroundLimitation()\n\t{\n\t\treturn this.getLimitationByType('background')\n\t}\n\n\tgetBackgroundBlurLimitation()\n\t{\n\t\treturn this.getLimitationByType('background_blur')\n\t}\n\n\tgetRecordLimitation()\n\t{\n\t\treturn this.getLimitationByType('record')\n\t}\n\n\tgetScreenSharingLimitation()\n\t{\n\t\treturn this.getLimitationByType('screen_sharing')\n\t}\n\n\tisDesktopCall()\n\t{\n\t\treturn DesktopApi.isDesktop();\n\t}\n\tcheckAvailableBackgroundImage()\n\t{\n\t\tif (!this.isDesktopCall())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {id: backgroundId} = DesktopApi.getBackgroundImage();\n\n\t\tif (!backgroundId || backgroundId === 'none') {\n\t\t\tDesktopApi.setCallBackground('none', 'none')\n\t\t}\n\t}\n\n\ttoggleVisibilityEar()\n\t{\n\t\tif (this.hideEarTimer)\n\t\t{\n\t\t\tclearTimeout(this.hideEarTimer);\n\t\t\tthis.hideEarTimer = null;\n\t\t}\n\n\t\tDom.addClass(this.elements.root, 'on-mouse-move');\n\t\tthis.elements.ear.top?.classList.add(\"force-visible\");\n\t\tthis.elements.ear.bottom?.classList.add(\"force-visible\");\n\t\tthis.elements.pageNavigatorLeft?.classList.add(\"force-visible\");\n\t\tthis.elements.pageNavigatorRight?.classList.add(\"force-visible\");\n\n\t\tthis.hideEarTimer = setTimeout(() =>\n\t\t{\n\t\t\tDom.removeClass(this.elements.root, 'on-mouse-move');\n\t\t\tthis.elements.ear.top?.classList.remove(\"force-visible\");\n\t\t\tthis.elements.ear.bottom?.classList.remove(\"force-visible\");\n\t\t\tthis.elements.pageNavigatorLeft?.classList.remove(\"force-visible\");\n\t\t\tthis.elements.pageNavigatorRight?.classList.remove(\"force-visible\");\n\t\t}, 5000);\n\t}\n\n\tinit()\n\t{\n\t\tthis.getLimitation();\n\t\tthis.checkAvailableBackgroundImage();\n\n\t\tif (this.isFullScreenSupported())\n\t\t{\n\t\t\tif (Browser.isChrome() || Browser.isSafari())\n\t\t\t{\n\t\t\t\twindow.addEventListener(\"fullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t\twindow.addEventListener(\"webkitfullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t}\n\t\t\telse if (Browser.isFirefox())\n\t\t\t{\n\t\t\t\twindow.addEventListener(\"mozfullscreenchange\", this._onFullScreenChangeHandler);\n\t\t\t}\n\t\t}\n\t\tif (Browser.isMobile())\n\t\t{\n\t\t\tdocument.documentElement.style.setProperty('--view-height', window.innerHeight + 'px');\n\t\t\twindow.addEventListener(\"orientationchange\", this._onOrientationChangeHandler);\n\t\t}\n\n\t\tthis.elements.audioContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-audio-container\"}\n\t\t});\n\n\t\tthis.elements.screenAudioContainer = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-audio-container\"}\n\t\t});\n\n\t\tif (Hardware.initialized)\n\t\t{\n\t\t\tthis.setSpeakerId(Hardware.defaultSpeaker);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHardware.subscribe(Hardware.Events.initialized, function ()\n\t\t\t{\n\t\t\t\tthis.setSpeakerId(Hardware.defaultSpeaker);\n\t\t\t}.bind(this))\n\t\t}\n\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setCameraState);\n\n\t\twindow.addEventListener(\"keydown\", this._onKeyDownHandler);\n\t\twindow.addEventListener(\"keyup\", this._onKeyUpHandler);\n\n\t\tthis.onMouseMoveHandler = this.toggleVisibilityEar.bind(this);\n\t\tdocument.addEventListener('mousemove', this.onMouseMoveHandler);\n\n\t\tthis.keyModifierForCss = Browser.isMac() ? '\\\\2318 + Shift' : 'Ctrl + Shift';\n\n\t\tthis.container.appendChild(this.elements.audioContainer);\n\t\tthis.container.appendChild(this.elements.screenAudioContainer);\n\n\t\tthis.viewVisibility.startViewVisibilityChange()\n\t};\n\n\tget isActivePiPFromController()\n\t{\n\t\treturn this._isActivePiPFromController;\n\t}\n\n\tset isActivePiPFromController(isActive)\n\t{\n\t\tthis._isActivePiPFromController = isActive;\n\t}\n\n\tget isPreparing()\n\t{\n\t\treturn this._isPreparing;\n\t};\n\n\tset isPreparing(isPreparing)\n\t{\n\t\tthis._isPreparing = !!isPreparing;\n\t};\n\n\t// for testing different delay values\n\tget videoRerenderDelay()\n\t{\n\t\treturn this._videoRerenderDelay > 0 ? this._videoRerenderDelay : CHANGE_VIDEO_RERENDER_DELAY;\n\t};\n\n\tset videoRerenderDelay(videoRerenderDelay)\n\t{\n\t\tthis._videoRerenderDelay = videoRerenderDelay;\n\t};\n\n\tsubscribeEvents(config)\n\t{\n\t\tfor (let event in EventName)\n\t\t{\n\t\t\tif (EventName.hasOwnProperty(event) && Type.isFunction(config[event]))\n\t\t\t{\n\t\t\t\tthis.setCallback(event, config[event]);\n\t\t\t}\n\t\t}\n\t};\n\n\tsetCallback(name, cb)\n\t{\n\t\tif (Type.isFunction(cb) && EventName.hasOwnProperty(name))\n\t\t{\n\t\t\tthis.eventEmitter.subscribe(name, function (event)\n\t\t\t{\n\t\t\t\tcb(event.data);\n\t\t\t});\n\t\t}\n\t};\n\n\tsubscribe(eventName, listener)\n\t{\n\t\treturn this.eventEmitter.subscribe(eventName, listener);\n\t};\n\n\tunsubscribe(eventName, listener)\n\t{\n\t\treturn this.eventEmitter.unsubscribe(eventName, listener);\n\t};\n\n\tgetNextPosition()\n\t{\n\t\treturn this.lastPosition++;\n\t};\n\n\t/**\n\t * @param {object} userStates {userId -> state}\n\t */\n\tappendUsers(userStates)\n\t{\n\t\tif (!Type.isPlainObject(userStates))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet userIds = Object.keys(userStates);\n\t\tfor (let i = 0; i < userIds.length; i++)\n\t\t{\n\t\t\tlet userId = userIds[i];\n\t\t\tthis.addUser(userId, userStates[userId] ? userStates[userId] : UserState.Idle);\n\t\t}\n\t};\n\n\tsetCentralUser(userId): void\n\t{\n\t\tif (this.centralUser.id == userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.users[userId] && userId != this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst previousCentralUser = this.centralUser;\n\t\tthis.centralUser = (userId == this.userId ? this.localUser : this.users[userId]);\n\t\tif (this.layout === Layouts.Centered || this.layout === Layouts.Mobile)\n\t\t{\n\t\t\tif (this.layout === Layouts.Mobile)\n\t\t\t{\n\t\t\t\tpreviousCentralUser.dismount();\n\t\t\t}\n\n\t\t\tthis.updateUserList();\n\n\t\t\tif (previousCentralUser.id != this.centralUser.id)\n\t\t\t{\n\t\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\t\tuserId: this.centralUser.id,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (this.layout === Layouts.Mobile)\n\t\t{\n\t\t\tif (this.centralUserMobile)\n\t\t\t{\n\t\t\t\tthis.centralUserMobile.setUserModel(this.userRegistry.get(userId));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.centralUserMobile = new CallUserMobile({\n\t\t\t\t\tuserModel: this.userRegistry.get(userId),\n\t\t\t\t\tonClick: () => this.showUserMenu(this.centralUser.id)\n\t\t\t\t})\n\t\t\t\tthis.centralUserMobile.mount(this.elements.pinnedUserContainer);\n\t\t\t}\n\t\t}\n\n\t\tthis.userRegistry.get(previousCentralUser.id).centralUser = false;\n\t\tthis.userRegistry.get(this.centralUser.id).centralUser = true;\n\n\t\tthis.eventEmitter.emit(EventName.onSetCentralUser, {\n\t\t\tuserId: userId,\n\t\t\tstream: userId == this.userId ? this.localUser.stream : this.users[userId].stream\n\t\t})\n\n\t\tthis.talkingService.refreshQueue();\n\t};\n\n\tgetLeftUser(userId): ?number\n\t{\n\t\tlet candidateUserId = null;\n\t\tconst keys = [...this.userRegistry.users.keys()];\n\t\tconst index = keys.indexOf(userId);\n\n\t\tif (index === -1)\n\t\t{\n\t\t\treturn candidateUserId;\n\t\t}\n\n\t\tconst userModels = [...this.userRegistry.users.values()].slice(0, index);\n\t\tconst totalUserModels = userModels.length;\n\n\t\tfor (let i = totalUserModels - 1; i >= 0; i--)\n\t\t{\n\t\t\tconst userModel = userModels[i];\n\t\t\tif (!userModel.localUser && userModel.state === UserState.Connected)\n\t\t\t{\n\t\t\t\tcandidateUserId = userModel.id;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn candidateUserId;\n\t}\n\n\tgetRightUser(userId): ?number\n\t{\n\t\tlet candidateUserId = null;\n\t\tconst keys = [...this.userRegistry.users.keys()];\n\t\tconst index = keys.indexOf(userId);\n\n\t\tif (index === -1)\n\t\t{\n\t\t\treturn candidateUserId;\n\t\t}\n\n\t\tconst userModels = [...this.userRegistry.users.values()].slice(index + 1);\n\t\tconst totalUserModels = userModels.length;\n\n\t\tfor (let i = 0; i < totalUserModels; i++)\n\t\t{\n\t\t\tconst userModel = userModels[i];\n\n\t\t\tif (!userModel.localUser && userModel.state === UserState.Connected)\n\t\t\t{\n\t\t\t\tcandidateUserId = userModel.id;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn candidateUserId;\n\t}\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.users).length;\n\t};\n\n\tgetConnectedUserCount(withYou)\n\t{\n\t\tlet count = this.getConnectedUsers().length;\n\n\t\tif (withYou)\n\t\t{\n\t\t\tconst userId = parseInt(this.userId);\n\t\t\tif (!this.broadcastingMode || this.broadcastingPresenters.includes(userId))\n\t\t\t{\n\t\t\t\tcount += 1;\n\t\t\t}\n\t\t}\n\n\t\treturn count;\n\t};\n\n\tgetUsersWithVideo(): Array\n\t{\n\t\tif (this.cache.has('usersWithVideo'))\n\t\t{\n\t\t\treturn this.cache.get('usersWithVideo');\n\t\t}\n\n\t\tconst users = Object.keys(this.users);\n\t\tconst result = [];\n\n\t\tusers.forEach((userId) => {\n\t\t\tif (this.users[userId].hasVideo())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t});\n\n\t\tthis.cache.set('usersWithVideo', result);\n\n\t\treturn result;\n\t}\n\n\tgetConnectedUsers(): Array\n\t{\n\t\tif (this.cache.has('currentConnectedUser'))\n\t\t{\n\t\t\treturn this.cache.get('currentConnectedUser');\n\t\t}\n\n\t\tconst result = [];\n\t\tconst userModels = [...this.userRegistry.users.values()];\n\t\tuserModels.forEach((userModel) => {\n\t\t\tif (userModel.id != this.userId && userModel.state === UserState.Connected)\n\t\t\t{\n\t\t\t\tresult.push(userModel.id);\n\t\t\t}\n\t\t});\n\n\t\tthis.cache.set('previousConnectedUserCount', 0);\n\t\tthis.cache.set('currentConnectedUser', result);\n\n\t\treturn result;\n\t}\n\n\tgetDisplayedUsers(): Array\n\t{\n\t\tconst result = [];\n\t\tconst userModels = [...this.userRegistry.users.values()];\n\t\tuserModels.forEach((userModel) => {\n\t\t\tif (\n\t\t\t\tuserModel.id != this.userId\n\t\t\t\t&& ((userModel.id != this.centralUser.id && this.layout === Layouts.Centered) || this.layout !== Layouts.Centered)\n\t\t\t\t&& ([UserState.Connected, UserState.Connecting, UserState.Calling].includes(userModel.state))\n\t\t\t)\n\t\t\t{\n\t\t\t\tresult.push(userModel.id);\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tgetActiveUsers(): Array\n\t{\n\t\tif (this.cache.has('activeUsers'))\n\t\t{\n\t\t\treturn this.cache.get('activeUsers');\n\t\t}\n\n\t\tconst result = [];\n\t\tconst userModels = [...this.userRegistry.users.values()];\n\t\tuserModels.forEach((userModel) => {\n\t\t\tif (this.isUserHasActiveState(userModel) && Object.hasOwn(this.users, userModel.id))\n\t\t\t{\n\t\t\t\tresult.push(userModel.id);\n\t\t\t}\n\t\t});\n\n\t\tthis.cache.set('activeUsers', result);\n\n\t\treturn result;\n\t}\n\n\tgetUsersWithCamera(): Array\n\t{\n\t\t// since we don't receive streams from inactive pages\n\t\t// we can't use this.getUsersWithVideo() to get number of users with video\n\t\treturn [...this.userRegistry.users.values()].filter((userModel) => {\n\t\t\treturn userModel.id != this.userId\n\t\t\t\t&& userModel.cameraState\n\t\t\t\t&& this.isUserHasActiveState(userModel)\n\t\t\t\t&& userModel.state !== UserState.Calling;\n\t\t});\n\t}\n\n\thasUserWithScreenSharing(): Boolean\n\t{\n\t\treturn [...this.userRegistry.users.values()].some((userModel) => userModel.screenState);\n\t}\n\n\thasCurrentUserScreenSharing(): Boolean\n\t{\n\t\tconst currentUser = this.userRegistry.get(this.userId);\n\n\t\tif (currentUser)\n\t\t{\n\t\t\treturn currentUser.screenState;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetPresenterUserId(): ?number\n\t{\n\t\tlet currentPresenterId = this.presenterId || 0;\n\t\tif (!this.getConnectedUserCount())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (currentPresenterId == this.localUser.id)\n\t\t{\n\t\t\tcurrentPresenterId = 0;\n\t\t}\n\n\t\tconst currentPresenterModel = this.userRegistry.get(currentPresenterId);\n\n\t\t// 1. Current user, who is sharing screen has top priority\n\t\tif (currentPresenterModel?.screenState === true)\n\t\t{\n\t\t\treturn currentPresenterId;\n\t\t}\n\n\t\t// 2. If current user is not sharing screen, but someone is sharing - he should become presenter\n\t\tconst users = Object.keys(this.users);\n\t\tfor (const userId of users)\n\t\t{\n\t\t\tif (Object.hasOwn(this.users, userId) && this.userRegistry.get(userId).screenState === true)\n\t\t\t{\n\t\t\t\treturn parseInt(userId, 10);\n\t\t\t}\n\t\t}\n\n\t\t// 3. If current user is talking, or stopped talking less then one second ago - he should stay presenter\n\t\tif (currentPresenterModel && currentPresenterModel.wasTalkingAgo() < 1000)\n\t\t{\n\t\t\treturn currentPresenterId;\n\t\t}\n\n\t\t// 4. Return currently talking user\n\t\tconst minTalkingAgo = 0;\n\t\tlet minTalkingAgoUserId = 0;\n\t\tfor (const userId of users)\n\t\t{\n\t\t\tif (!Object.hasOwn(this.users, userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst userWasTalkingAgo = this.userRegistry.get(userId).wasTalkingAgo();\n\t\t\tif (userWasTalkingAgo < 1000)\n\t\t\t{\n\t\t\t\treturn parseInt(userId, 10);\n\t\t\t}\n\n\t\t\tif (userWasTalkingAgo < minTalkingAgo)\n\t\t\t{\n\t\t\t\tminTalkingAgoUserId = parseInt(userId, 10);\n\t\t\t}\n\t\t}\n\n\t\t// Return last talking user or current user in center\n\t\treturn minTalkingAgoUserId || this.centralUser.id;\n\t}\n\n\tswitchPresenter()\n\t{\n\t\tconst currentPresenterId = this.presenterId || 0;\n\t\tconst newPresenterId = this.getPresenterUserId();\n\n\t\tif (!newPresenterId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.presenterId = newPresenterId;\n\n\t\tif (currentPresenterId)\n\t\t{\n\t\t\tthis.userRegistry.get(currentPresenterId).presenter = false;\n\t\t}\n\t\tthis.userRegistry.get(newPresenterId).presenter = true;\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setCurrentUser(this.getPictureInPictureCallWindowUser());\n\t\t}\n\n\t\tif (this.pinnedUser === null)\n\t\t{\n\t\t\tthis.setCentralUser(newPresenterId);\n\t\t}\n\t\telse if (currentPresenterId !== newPresenterId)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\tuserId: this.centralUser.id,\n\t\t\t});\n\t\t}\n\t}\n\n\tswitchPresenterDeferred()\n\t{\n\t\tclearTimeout(this.switchPresenterTimeout);\n\t\tthis.switchPresenterTimeout = setTimeout(this.switchPresenter.bind(this), 1000);\n\t};\n\n\tcancelSwitchPresenter()\n\t{\n\t\tclearTimeout(this.switchPresenterTimeout);\n\t};\n\n\tsetUiState(uiState)\n\t{\n\t\tif (this.uiState == uiState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.uiState = uiState;\n\t\tif (this.uiState == UiState.Error && this.elements.container)\n\t\t{\n\t\t\tDom.clean(this.elements.container);\n\t\t\tthis.elements.container.appendChild(this.elements.overlay);\n\t\t}\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.updateButtons();\n\t};\n\n\tsetLayout(newLayout)\n\t{\n\t\tif (newLayout == this.layout)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet useShelvedRerenderQueue = this.layout === Layouts.Centered && newLayout === Layouts.Grid;\n\n\t\tthis.layout = newLayout;\n\n\t\tif (this.layout == Layouts.Centered || this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-grid\");\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-centered\");\n\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\tthis.elements.container.appendChild(this.elements.userBlock);\n\n\t\t\tif (this.layout != Layouts.Mobile)\n\t\t\t{\n\t\t\t\tthis.elements.userBlock.appendChild(this.elements.userList.container);\n\t\t\t}\n\n\t\t\tthis.centralUser.playVideo();\n\t\t\t//this.centralUser.updateAvatarWidth();\n\t\t}\n\n\t\tif (this.layout === Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.remove('bx-messenger-videocall-centered');\n\t\t\tthis.elements.root.classList.add('bx-messenger-videocall-grid');\n\n\t\t\tthis.elements.container.appendChild(this.elements.userList.container);\n\t\t\tthis.elements.container.removeChild(this.elements.userBlock);\n\n\t\t\tthis.centralUser.dismount();\n\n\t\t\tif (this.isFullScreen && this.buttons.participants)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: Buttons.ParticipantsButton.FoldButtonState.Hidden,\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.unpinUser();\n\t\t}\n\n\t\tif (this.layout === Layouts.Centered && this.isFullScreen)\n\t\t{\n\t\t\tthis.setUserBlockFolded(true);\n\t\t}\n\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-fullscreen-mobile\", (this.layout == Layouts.Mobile));\n\n\t\tthis.updateUserList(useShelvedRerenderQueue);\n\t\tthis.toggleEars();\n\t\tthis.updateButtons();\n\n\t\tthis.talkingService.refreshQueue();\n\n\t\tthis.eventEmitter.emit(EventName.onLayoutChange, {\n\t\t\tlayout: this.layout\n\t\t});\n\t};\n\n\tsetRoomState(roomState)\n\t{\n\t\tif (this.roomState === roomState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.roomState = roomState;\n\t\tif (this.buttons.microphone)\n\t\t{\n\t\t\tthis.buttons.microphone.setSideIcon(this.getMicrophoneSideIcon(this.roomState));\n\t\t}\n\t}\n\n\tgetMicrophoneSideIcon(roomState)\n\t{\n\t\tswitch (roomState)\n\t\t{\n\t\t\tcase RoomState.Speaker:\n\t\t\t\treturn 'ellipsis';\n\t\t\tcase RoomState.NonSpeaker:\n\t\t\t\treturn 'pointer';\n\t\t\tcase RoomState.None:\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n\n\tsetCurrentPage(pageNumber)\n\t{\n\t\tif (pageNumber < 1 || pageNumber > this.pagesCount || pageNumber == this.currentPage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.currentPage = pageNumber;\n\n\t\tthis.recalculateUsersPerPage()\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeftCounter.innerHTML = (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t\tthis.elements.pageNavigatorRightCounter.innerHTML = (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t}\n\t\tif (!(this.layout === Layouts.Grid || this.layout === Layouts.Centered))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.renderUserList(true);\n\t\tthis.toggleEars();\n\t\tthis.talkingService.refreshQueue();\n\t};\n\n\tcalculateUsersPerPage()\n\t{\n\t\tif (!this.elements.userList)\n\t\t{\n\t\t\treturn 1000;\n\t\t}\n\n\t\tconst containerSize = this.elements.userList.container.getBoundingClientRect();\n\t\tlet columns = Math.floor(containerSize.width / MIN_GRID_USER_WIDTH) || 1;\n\t\tlet rows = Math.floor(containerSize.height / MIN_GRID_USER_HEIGHT) || 1;\n\n\t\tif (this.layout === Layouts.Centered)\n\t\t{\n\t\t\tconst rowsWithoutGap = Math.floor(containerSize.height / SIDE_USER_HEIGHT) || 1;\n\t\t\tconst rowGap = 6;\n\n\t\t\tthis.whiteSpaceInUserGrid = containerSize.height - rowsWithoutGap * SIDE_USER_HEIGHT + (rowsWithoutGap - 1) * rowGap;\n\n\t\t\tcolumns = 1;\n\t\t\trows = this.whiteSpaceInUserGrid < 0 ? rowsWithoutGap - 1 : rowsWithoutGap;\n\t\t}\n\n\t\tlet usersPerPage = columns * rows - 1;\n\n\t\tif (this.userId == this.centralUser.id && this.layout === Layouts.Centered)\n\t\t{\n\t\t\tusersPerPage += 1;\n\t\t}\n\n\t\tif (!usersPerPage)\n\t\t{\n\t\t\treturn 1000;\n\t\t}\n\n\t\tif (usersPerPage >= MAX_USERS_PER_PAGE)\n\t\t{\n\t\t\t// check if the last row should be filled up\n\t\t\tconst elementSize = Util.findBestElementSize(\n\t\t\t\tcontainerSize.width,\n\t\t\t\tcontainerSize.height,\n\t\t\t\tMAX_USERS_PER_PAGE + 1,\n\t\t\t\tMIN_GRID_USER_WIDTH,\n\t\t\t\tMIN_GRID_USER_HEIGHT,\n\t\t\t);\n\t\t\t// console.log('Optimal element size: width '+elementSize.width+' height '+elementSize.height);\n\t\t\tcolumns = Math.floor(containerSize.width / elementSize.width);\n\t\t\trows = Math.floor(containerSize.height / elementSize.height);\n\t\t\tusersPerPage = columns * rows - 1;\n\t\t}\n\n\t\treturn usersPerPage;\n\t}\n\n\tcalculatePagesCount(usersPerPage)\n\t{\n\t\tconst pages = Math.ceil((this.getDisplayedUsers().length) / usersPerPage);\n\t\treturn pages > 0 ? pages : 1;\n\t};\n\n\trecalculateUsersPerPage()\n\t{\n\t\tthis.usersPerPage = this.calculateUsersPerPage();\n\n\t\tif (this.currentPage < this.pagesCount && this.layout === Layouts.Centered && this.whiteSpaceInUserGrid > 0)\n\t\t{\n\t\t\tthis.usersPerPage = this.usersPerPage + 1;\n\t\t}\n\t}\n\n\trecalculatePages()\n\t{\n\t\tthis.usersPerPage = this.calculateUsersPerPage();\n\t\tthis.pagesCount = this.calculatePagesCount(this.usersPerPage);\n\n\t\tif (this.currentPage > this.pagesCount)\n\t\t{\n\t\t\tthis.currentPage = this.pagesCount;\n\t\t}\n\n\t\tthis.recalculateUsersPerPage();\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeftCounter.innerHTML = (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t\tthis.elements.pageNavigatorRightCounter.innerHTML = (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount;\n\t\t}\n\t};\n\n\t/**\n\t * Returns page number, where the user is displayed, or 0 if user is not found\n\t * @param {int} userId Id of the user\n\t * @return {int}\n\t */\n\tfindUsersPage(userId)\n\t{\n\t\tif (userId == this.userId || this.usersPerPage === 0)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\t\tconst displayedUsers = this.getDisplayedUsers();\n\t\tlet userPosition = 0;\n\n\t\tfor (let i = 0; i < displayedUsers.length; i++)\n\t\t{\n\t\t\tif (displayedUsers[i] == userId)\n\t\t\t{\n\t\t\t\tuserPosition = i + 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn (userPosition ? Math.ceil(userPosition / this.usersPerPage) : 0);\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.localUser.stream && this.localUser.stream.getVideoTracks().length > 0)\n\t\t{\n\t\t\tthrow new Error(\"Can not set camera id while having active stream\")\n\t\t}\n\t\tthis.cameraId = cameraId;\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.localUser.stream && this.localUser.stream.getAudioTracks().length > 0)\n\t\t{\n\t\t\tthrow new Error(\"Can not set microphone id while having active stream\")\n\t\t}\n\t\tthis.microphoneId = microphoneId;\n\t};\n\n\tsetMicrophoneLevel(level)\n\t{\n\t\tthis.microphoneLevel = level;\n\t\tthis.buttons.microphone?.setLevel(level);\n\t};\n\n\tsetCameraState = (event) =>\n\t{\n\t\tif (this.isCameraOn == event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isCameraOn = event.data.isCameraOn;\n\n\t\tif (this.buttons.camera)\n\t\t{\n\t\t\tif (this.isCameraOn)\n\t\t\t{\n\t\t\t\tthis.buttons.camera.enable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.buttons.camera.disable();\n\t\t\t}\n\t\t}\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t}\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.isMuted == event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isMuted = event.data.isMicrophoneMuted\n\n\t\tif (this.buttons.microphone)\n\t\t{\n\t\t\tif (this.isMuted)\n\t\t\t{\n\t\t\t\tthis.buttons.microphone.disable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.buttons.microphone.enable();\n\t\t\t}\n\t\t}\n\t\tthis.userRegistry.get(this.userId).microphoneState = !this.isMuted;\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t}\n\t};\n\n\tsetLocalUserId(userId)\n\t{\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userId = parseInt(userId);\n\t\tthis.localUser.userModel.id = this.userId;\n\t\tthis.localUser.userModel.name = this.userData[this.userId] ? this.userData[this.userId].name : '';\n\t\tthis.localUser.userModel.avatar = this.userData[this.userId] ? checkAndEncodeURI(this.userData[this.userId].avatar_hr) : '';\n\n\t\tthis.userRegistry.push(this.localUser.userModel);\n\t};\n\n\tsetUserBlockFolded(isUserBlockFolded)\n\t{\n\t\tthis.isUserBlockFolded = isUserBlockFolded;\n\n\t\tthis.elements.userBlock?.classList.toggle(\"folded\", this.isUserBlockFolded);\n\t\tthis.elements.root?.classList.toggle(\"bx-messenger-videocall-userblock-folded\", this.isUserBlockFolded);\n\t\tif (this.isUserBlockFolded)\n\t\t{\n\t\t\tif (this.buttons.participants && this.layout == Layouts.Centered)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: Buttons.ParticipantsButton.FoldButtonState.Unfold\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.buttons.participants)\n\t\t\t{\n\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\tfoldButtonState: (this.isFullScreen && this.layout == Layouts.Centered) ? Buttons.ParticipantsButton.FoldButtonState.Fold : Buttons.ParticipantsButton.FoldButtonState.Hidden\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\taddUser(userId, state, direction)\n\t{\n\t\tuserId = Number(userId);\n\t\tif (this.users[userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstate = state || UserState.Idle;\n\t\tif (!direction)\n\t\t{\n\t\t\tif (this.broadcastingPresenters.length > 0 && !this.broadcastingPresenters.includes(userId))\n\t\t\t{\n\t\t\t\tdirection = EndpointDirection.RecvOnly;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdirection = EndpointDirection.SendRecv\n\t\t\t}\n\t\t}\n\n\t\tlet userModel = new UserModel({\n\t\t\tid: userId,\n\t\t\tname: this.userData[userId] ? this.userData[userId].name : '',\n\t\t\tavatar: this.userData[userId] ? this.userData[userId].avatar_hr : '',\n\t\t\tstate: state,\n\t\t\torder: state == UserState.Connected ? this.getNextPosition() : newUserPosition,\n\t\t\tdirection: direction,\n\t\t});\n\n\t\tthis.userRegistry.push(userModel);\n\n\t\tif (!this.elements.audio[userId])\n\t\t{\n\t\t\tthis.elements.audio[userId] = Dom.create('audio');\n\t\t\tDom.append(this.elements.audio[userId], this.elements.audioContainer);\n\t\t}\n\n\t\tif (!this.elements.screenAudio[userId])\n\t\t{\n\t\t\tthis.elements.screenAudio[userId] = Dom.create('audio');\n\t\t\tDom.append(this.elements.screenAudio[userId], this.elements.screenAudioContainer);\n\t\t}\n\n\t\tthis.users[userId] = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: userModel,\n\t\t\taudioElement: this.elements.audio[userId],\n\t\t\tscreenAudioElement: this.elements.screenAudio[userId],\n\t\t\tallowPinButton: this.getConnectedUserCount() > 1,\n\t\t\tonClick: this._onUserClick.bind(this),\n\t\t\tonPin: this._onUserPin.bind(this),\n\t\t\tonUnPin: this._onUserUnPin.bind(this),\n\t\t\tonTurnOffParticipantMic: this._onTurnOffParticipantMic.bind(this),\n\t\t\tonTurnOffParticipantCam: this._onTurnOffParticipantCam.bind(this),\n\t\t\tonTurnOffParticipantScreenshare: this._onTurnOffParticipantScreenshare.bind(this),\n\t\t});\n\t\tuserModel.subscribe('changed', this.talkingService.watchTalking);\n\n\t\tthis.screenUsers[userId] = new CallUser({\n\t\t\tparentContainer: this.container,\n\t\t\tuserModel: userModel,\n\t\t\tallowPinButton: false,\n\t\t\tscreenSharingUser: true,\n\t\t});\n\n\t\tif (this.elements.root && state !== UserState.Idle)\n\t\t{\n\t\t\tif (state === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.cache.set('previousConnectedUserCount', this.cache.get('currentConnectedUser')?.length || 0);\n\t\t\t\tthis.cache.delete('currentConnectedUser');\n\t\t\t\tthis.cache.delete('activeUsers');\n\t\t\t}\n\n\t\t\tthis.updateUserList();\n\t\t\tthis.updateButtons();\n\t\t\tthis.updateUserButtons();\n\t\t\tthis.muteSpeaker(this.speakerMuted);\n\t\t}\n\t};\n\n\tsetUserDirection(userId, direction)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user || user.direction == direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tuser.direction = direction;\n\t\tthis.updateUserList();\n\t};\n\n\tsetLocalUserDirection(direction)\n\t{\n\t\tif (this.localUser.userModel.direction != direction)\n\t\t{\n\t\t\tthis.localUser.userModel.direction = direction;\n\t\t\tthis.updateUserList();\n\t\t}\n\t};\n\n\tsetUserState(userId, newState)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user || user.state === newState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t(user.state === UserState.Connected || user.state === UserState.Connecting)\n\t\t\t&& newState === UserState.Declined\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif ((user.state === UserState.Connected || newState === UserState.Connected))\n\t\t{\n\t\t\tthis.cache.set('previousConnectedUserCount', this.cache.get('currentConnectedUser')?.length || 0);\n\t\t\tthis.cache.delete('currentConnectedUser');\n\t\t\tthis.cache.delete('activeUsers');\n\t\t}\n\n\t\tuser.state = newState;\n\n\t\tif (newState === UserState.Connected && this.uiState === UiState.Calling)\n\t\t{\n\t\t\tthis.setUiState(UiState.Connected);\n\t\t}\n\n\t\t// maybe switch central user\n\t\tif (this.centralUser.id == this.userId && newState == UserState.Connected)\n\t\t{\n\t\t\tthis.setCentralUser(userId);\n\t\t}\n\t\telse if (userId == this.centralUser.id)\n\t\t{\n\t\t\tif (newState == UserState.Connecting || newState == UserState.Failed)\n\t\t\t{\n\t\t\t\tthis.centralUser.blurVideo();\n\t\t\t}\n\t\t\telse if (newState == UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.centralUser.blurVideo(false);\n\t\t\t}\n\t\t\telse if (newState == UserState.Idle)\n\t\t\t{\n\t\t\t\tconst usersWithVideo = this.getUsersWithVideo();\n\t\t\t\tconst connectedUsers = this.getConnectedUsers();\n\n\t\t\t\tif (connectedUsers.length === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(this.userId);\n\t\t\t\t}\n\t\t\t\telse if (usersWithVideo.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(usersWithVideo[0]);\n\t\t\t\t}\n\t\t\t\telse //if (connectedUsers.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.setCentralUser(connectedUsers[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (newState === UserState.Connected)\n\t\t{\n\t\t\tconst timer = setTimeout(() => {\n\t\t\t\tthis.waitingForUserMediaTimeouts.delete(userId);\n\t\t\t}, WAITING_VIDEO_DELAY);\n\t\t\tthis.waitingForUserMediaTimeouts.set(userId, timer);\n\t\t}\n\t\telse if (newState === UserState.Idle)\n\t\t{\n\t\t\tthis.setUserFloorRequestState(userId, false);\n\t\t\tthis.setUserPermissionToSpeakState(userId, false);\n\t\t\tclearTimeout(this.waitingForUserMediaTimeouts.get(userId));\n\t\t\tthis.waitingForUserMediaTimeouts.delete(userId);\n\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\tuserId,\n\t\t\t\treason: RerenderReason.UserDisconnected,\n\t\t\t});\n\t\t}\n\n\t\tif (newState == UserState.Connected && user.order == newUserPosition)\n\t\t{\n\t\t\tuser.order = this.getNextPosition();\n\t\t}\n\t\telse if (newState == UserState.Idle)\n\t\t{\n\t\t\t// reset user position to add them in the end after they reconnect\n\t\t\tuser.prevOrder = user.order;\n\t\t\tuser.order = newUserPosition;\n\t\t\tuser.prevCameraState = user.cameraState;\n\t\t\tuser.cameraState = false;\n\t\t}\n\n\t\tif (userId == this.localUser.id)\n\t\t{\n\t\t\tthis.localUser.userModel.cameraState = this.localUser.hasCameraVideo();\n\t\t}\n\n\t\tconst skippedElementsList = userId === this.localUser.id ? [] : ['panel'];\n\n\t\tif (userId == this.presenterId && newState !== UserState.Connected)\n\t\t{\n\t\t\tthis.switchPresenter();\n\t\t}\n\n\t\tthis.updateUserList();\n\t\tthis.updateButtons(skippedElementsList);\n\t\tthis.updateUserButtons();\n\t};\n\n\tsetTitle(title)\n\t{\n\t\tthis.title = title;\n\t};\n\n\tgetUserTalking(userId)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!user.talking;\n\t}\n\n\tsetUserTalking(userId, talking): void\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tuser.talking = talking;\n\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (userId == this.presenterId && !talking)\n\t\t{\n\t\t\tthis.switchPresenterDeferred();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.switchPresenter();\n\t\t}\n\t}\n\n\tsetUserStats(userId, stats)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].showStats(stats);\n\t\t}\n\t\tif (this.screenUsers[userId])\n\t\t{\n\t\t\tthis.screenUsers[userId].showStats(stats);\n\t\t}\n\t\tif (userId == this.localUser.id)\n\t\t{\n\t\t\tthis.localUser.showStats(stats);\n\t\t\tthis.localUserReceivedStats = true;\n\t\t}\n\n\t\tthis.pictureInPictureCallWindow?.setStats(userId, stats);\n\n\t\tthis.updateButtons()\n\t}\n\n\tsetTrackSubscriptionFailed(data)\n\t{\n\t\tif (this.users[data.participant.userId])\n\t\t{\n\t\t\tif(data.participant.userId && data.track){\n\t\t\t\tthis.users[data.participant.userId].showTrackSubscriptionFailed(data.track);\n\t\t\t}\n\t\t}\n\t}\n\n\tsetUserMicrophoneState(userId, isMicrophoneOn)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.microphoneState = isMicrophoneOn;\n\t\t}\n\t};\n\n\tsetUserCameraState(userId, cameraState)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.cameraState = cameraState;\n\t\t}\n\t};\n\n\tsetUserVideoPaused(userId, videoPaused)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\t\tif (user)\n\t\t{\n\t\t\tuser.videoPaused = videoPaused;\n\t\t\tuser.cameraState = !videoPaused;\n\n\t\t\tif (!user.videoPaused !== videoPaused)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvideoPaused\n\t\t\t\t? this.updateRerenderQueue(userId, RerenderReason.VideoDisabled)\n\t\t\t\t: this.updateRerenderQueue(userId, RerenderReason.VideoEnabled);\n\t\t}\n\t};\n\n\tgetUserFloorRequestState(userId)\n\t{\n\t\tconst user = this.userRegistry.get(userId);\n\n\t\treturn user && user.floorRequestState;\n\t};\n\n\tsetUserFloorRequestState(userId, userFloorRequestState)\n\t{\n\t\tconst user: UserModel = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (user.floorRequestState != userFloorRequestState)\n\t\t{\n\t\t\tconst userState = user?.state;\n\t\t\tconst userActive = (userState !== UserState.Idle\n\t\t\t\t&& userState !== UserState.Declined\n\t\t\t\t&& userState !== UserState.Unavailable\n\t\t\t\t&& userState !== UserState.Busy\n\t\t\t);\n\t\t\tif (userFloorRequestState && !userActive)\n\t\t\t{\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tuser.floorRequestState = userFloorRequestState;\n\n\t\t\tthis.updateFloorRequestNotifications(user, userFloorRequestState);\n\n\t\t\tif (userFloorRequestState)\n\t\t\t{\n\t\t\t\tthis.showFloorRequestNotification(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (userId == this.userId)\n\t\t{\n\t\t\tthis.setButtonActive('floorRequest', userFloorRequestState);\n\t\t}\n\t};\n\n\tsetUserPermissionToSpeakState(userId, permissionToSpeakState)\n\t{\n\t\tconst user: UserModel = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (user.permissionToSpeak !== permissionToSpeakState)\n\t\t{\n\t\t\tuser.permissionToSpeak = permissionToSpeakState;\n\t\t}\n\t};\n\n\tsetAllUserPermissionToSpeakState(permissionToSpeakState)\n\t{\n\t\tthis.userRegistry.users.forEach((userModel) => {userModel.permissionToSpeak = permissionToSpeakState});\n\t};\n\n\tpinUser(userId): void\n\t{\n\t\tif (!(userId in this.users) && userId !== Number(this.userId))\n\t\t{\n\t\t\tconsole.error(`User ${userId} is not known`);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.pinnedUser && this.userRegistry.users.has(this.pinnedUser.userModel.id))\n\t\t{\n\t\t\tthis.userRegistry.get(this.pinnedUser.userModel.id).pinned = false;\n\t\t}\n\t\tthis.pinnedUser = this.users[userId] || this.localUser;\n\t\tthis.userRegistry.get(this.pinnedUser.userModel.id).pinned = true;\n\t\tthis.setCentralUser(userId);\n\t\tthis.eventEmitter.emit(EventName.onUserPinned, { userId });\n\n\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\tuserId: this.centralUser.id,\n\t\t});\n\t}\n\n\tunpinUser(): void\n\t{\n\t\tif (this.pinnedUser && this.userRegistry.users.has(this.pinnedUser.userModel.id))\n\t\t{\n\t\t\tthis.userRegistry.get(this.pinnedUser.userModel.id).pinned = false;\n\t\t}\n\t\tthis.pinnedUser = null;\n\n\t\tthis.eventEmitter.emit(EventName.onUserPinned, {\n\t\t\tuserId: null,\n\t\t});\n\n\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\tuserId: null,\n\t\t});\n\t\tthis.switchPresenterDeferred();\n\t}\n\n\tupdateFloorRequestNotifications(userModel, floorRequestState)\n\t{\n\t\tconst indexFloorRequestInList = this.floorRequestNotifications.findIndex(req => req.userModel.id === userModel.id);\n\t\tconst hasFloorRequestInList = indexFloorRequestInList !== -1;\n\t\tconst currentUser = this.users[userModel.id];\n\t\tconst currentUserData = {\n\t\t\tuserModel,\n\t\t\tavatarBackgroundColor: currentUser?.avatarBackground || Util.getAvatarBackground(),\n\t\t}\n\n\t\tif (floorRequestState && !hasFloorRequestInList)\n\t\t{\n\t\t\tthis.floorRequestNotifications.push(currentUserData);\n\t\t}\n\n\t\tif (!floorRequestState && hasFloorRequestInList)\n\t\t{\n\t\t\tthis.floorRequestNotifications.splice(indexFloorRequestInList, 1);\n\t\t}\n\n\t\tthis.pictureInPictureCallWindow?.updateFloorRequestState(currentUserData);\n\t}\n\n\tshowFloorRequestNotification(userId)\n\t{\n\t\tconst userModel: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!userModel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet notification = FloorRequest.create({\n\t\t\tuserModel,\n\t\t\tonAllowSpeakPermissionClicked: (_userModel) => {\n\t\t\t\tthis._onAllowSpeakPermissionClickedHandler(_userModel);\n\t\t\t},\n\t\t\tonDisallowSpeakPermissionClicked: (_userModel) => {\n\t\t\t\tthis._onDisallowSpeakPermissionClickedHandler(_userModel);\n\t\t\t},\n\t\t});\n\n\t\tnotification.mount(this.elements.notificationPanel);\n\t\tNotificationManager.Instance.addNotification(notification);\n\t};\n\n\tupdateFloorRequestNotification()\n\t{\n\t\tif (!NotificationManager?.Instance.notifications.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tNotificationManager.Instance.notifications.forEach(notification =>\n\t\t{\n\t\t\tnotification.updatePermissionButtonState();\n\t\t});\n\t}\n\n\t_onAllowSpeakPermissionClickedHandler(_userModel)\n\t{\n\t\tthis.setUserPermissionToSpeakState(_userModel.id, true);\n\t\tthis.eventEmitter.emit(EventName.onAllowSpeakPermission, {\n\t\t\tuserId: _userModel.id\n\t\t});\n\t}\n\n\t_onDisallowSpeakPermissionClickedHandler(_userModel)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onDisallowSpeakPermission, {\n\t\t\tuserId: _userModel.id\n\t\t});\n\t}\n\n\tsetUserScreenState(userId, screenState)\n\t{\n\t\tconst user: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tuser.screenState = screenState;\n\t\tif (userId != this.userId)\n\t\t{\n\t\t\tif (screenState === true && this.layout === View.Layout.Grid)\n\t\t\t{\n\t\t\t\tthis.setLayout(Layouts.Centered);\n\t\t\t\tthis.returnToGridAfterScreenStopped = true;\n\t\t\t}\n\t\t\tif (screenState === false\n\t\t\t\t&& this.layout === Layouts.Centered\n\t\t\t\t&& !this.hasUserWithScreenSharing()\n\t\t\t\t&& !this.pinnedUser\n\t\t\t\t&& this.returnToGridAfterScreenStopped)\n\t\t\t{\n\t\t\t\tthis.returnToGridAfterScreenStopped = false;\n\t\t\t\tthis.setLayout(Layouts.Grid);\n\t\t\t}\n\t\t\tthis.switchPresenter();\n\t\t}\n\t};\n\n\tflipLocalVideo(flipVideo)\n\t{\n\t\tthis.localUser.flipVideo = !!flipVideo;\n\t}\n\n\tsetLocalStream(streamData)\n\t{\n\t\tconst mediaRenderer = streamData.mediaRenderer;\n\t\tconst mediaStream = streamData.stream;\n\t\tconst flipVideo = streamData.flipVideo;\n\n\t\tif (mediaRenderer) // for Bitrix calls\n\t\t{\n\t\t\tthis.localUser.videoRenderer = mediaRenderer;\n\t\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(this.userId, mediaRenderer);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst videoTrack = mediaStream.getVideoTracks().length > 0 ? mediaStream.getVideoTracks()[0] : null;\n\t\t\tthis.localUser.videoTrack = videoTrack;\n\t\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(this.userId, new MediaRenderer({\n\t\t\t\tkind: 'video',\n\t\t\t\ttrack: videoTrack,\n\t\t\t}));\n\t\t}\n\n\t\tif (!Type.isUndefined(flipVideo))\n\t\t{\n\t\t\tthis.flipLocalVideo(flipVideo);\n\t\t}\n\t\tthis.localUser.userModel.cameraState = this.localUser.hasCameraVideo();\n\n\t\tconst videoTracks = mediaStream?.getVideoTracks();\n\t\tif (videoTracks?.length > 0)\n\t\t{\n\t\t\tconst videoTrackSettings = videoTracks[0].getSettings();\n\t\t\tthis.cameraId = videoTrackSettings.deviceId || '';\n\t\t}\n\t\telse if (!mediaRenderer)\n\t\t{\n\t\t\tthis.cameraId = '';\n\t\t}\n\n\t\tconst audioTracks = mediaStream?.getAudioTracks();\n\t\tif (audioTracks?.length > 0)\n\t\t{\n\t\t\tconst audioTrackSettings = audioTracks[0].getSettings();\n\t\t\tthis.microphoneId = audioTrackSettings.deviceId || '';\n\t\t}\n\n\t\t/*if(!this.localUser.hasVideo())\n\t\t{\n\t\t\treturn false;\n\t\t}*/\n\n\t\tif (this.layout !== Layouts.Grid && this.centralUser.id == this.userId)\n\t\t{\n\t\t\tif (mediaRenderer) // for Bitrix ca;ls\n\t\t\t{\n\t\t\t\tthis.centralUser.videoRenderer = mediaRenderer;\n\t\t\t}\n\t\t\telse if (videoTracks.length > 0 || Object.keys(this.users).length === 0)\n\t\t\t{\n\t\t\t\tthis.centralUser.videoTrack = videoTracks[0];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setCentralUser(Object.keys(this.users)[0]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateUserList();\n\t\t}\n\n\t\tthis.updateButtons()\n\t};\n\n\tsetLocalStreamVideoTrack(videoTrack)\n\t{\n\t\tthis.localStreamVideoTrack = videoTrack;\n\n\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(this.userId, new MediaRenderer({\n\t\t\tkind: 'sharing',\n\t\t\ttrack: videoTrack,\n\t\t}));\n\t}\n\n\tsetSpeakerId(speakerId)\n\t{\n\t\tif (this.speakerId == speakerId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!('setSinkId' in HTMLMediaElement.prototype))\n\t\t{\n\t\t\tconsole.error(\"Speaker selection is not supported\");\n\t\t}\n\n\t\tthis.speakerId = speakerId;\n\t\tfor (let userId in this.elements.audio)\n\t\t{\n\t\t\tthis.elements.audio[userId].setSinkId(this.speakerId);\n\t\t}\n\t};\n\n\tmuteSpeaker(mute)\n\t{\n\t\tthis.speakerMuted = !!mute;\n\n\t\tfor (let userId in this.elements.audio)\n\t\t{\n\t\t\tthis.elements.audio[userId].volume = this.speakerMuted ? 0 : 1;\n\t\t}\n\n\t\tif (!this.buttons.speaker)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.speakerMuted)\n\t\t{\n\t\t\tthis.buttons.speaker.disable();\n\t\t\tthis.buttons.speaker.hideArrow()\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.buttons.speaker.enable();\n\t\t\tif (Hardware.canSelectSpeaker())\n\t\t\t{\n\t\t\t\tthis.buttons.speaker.showArrow()\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateRerenderQueue(userId, reason)\n\t{\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthrow Error(\"User \" + userId + \" is not a part of this call\");\n\t\t}\n\n\t\tif (reason === RerenderReason.VideoEnabled)\n\t\t{\n\t\t\tif (this.rerenderQueue.get(userId)?.reason === RerenderReason.VideoDisabled)\n\t\t\t{\n\t\t\t\tthis.rerenderQueue.delete(userId);\n\t\t\t\tif (!this.rerenderQueue.size)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.rerenderTimeout);\n\t\t\t\t\tthis.rerenderTimeout = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.waitingForUserMediaTimeouts.has(userId))\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.waitingForUserMediaTimeouts.get(userId));\n\t\t\t\t\tthis.waitingForUserMediaTimeouts.delete(userId);\n\t\t\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\t\t\tuserId,\n\t\t\t\t\t\treason: RerenderReason.VideoEnabled,\n\t\t\t\t\t});\n\t\t\t\t\tthis.renderUserList();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (!this.rerenderTimeout)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.rerenderTimeout = setTimeout(() => {\n\t\t\t\t\t\t\tthis.renderUserList();\n\t\t\t\t\t\t}, this.videoRerenderDelay);\n\t\t\t\t\t}\n\t\t\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\t\t\tuserId,\n\t\t\t\t\t\treason: RerenderReason.VideoEnabled,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (reason === RerenderReason.VideoDisabled)\n\t\t{\n\t\t\tif (this.rerenderQueue.get(userId)?.reason === RerenderReason.VideoEnabled)\n\t\t\t{\n\t\t\t\tthis.rerenderQueue.delete(userId);\n\t\t\t\tif (!this.rerenderQueue.size)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.rerenderTimeout);\n\t\t\t\t\tthis.rerenderTimeout = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!this.rerenderTimeout)\n\t\t\t\t{\n\t\t\t\t\tthis.rerenderTimeout = setTimeout(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.renderUserList();\n\t\t\t\t\t}, this.videoRerenderDelay);\n\t\t\t\t}\n\n\t\t\t\tthis.rerenderQueue.set(userId, {\n\t\t\t\t\tuserId,\n\t\t\t\t\treason: RerenderReason.VideoDisabled,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tsetVideoRenderer(userId, mediaRenderer)\n\t{\n\t\tconst user = this.users[userId];\n\t\tif (!user)\n\t\t{\n\t\t\tthrow Error(\"User \" + userId + \" is not a part of this call\");\n\t\t}\n\n\t\tthis.cache.delete('usersWithVideo');\n\n\t\tif (mediaRenderer === null)\n\t\t{\n\t\t\tif (user.hasCameraVideo())\n\t\t\t{\n\t\t\t\tthis.updateRerenderQueue(userId, RerenderReason.VideoDisabled);\n\t\t\t}\n\t\t\tuser.videoRenderer = null;\n\t\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(userId, null);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!(\"render\" in mediaRenderer) || !Type.isFunction(mediaRenderer.render))\n\t\t{\n\t\t\tthrow Error(\"mediaRenderer should have method render\");\n\t\t}\n\t\tif (!(\"kind\" in mediaRenderer) || (mediaRenderer.kind !== \"video\" && mediaRenderer.kind !== \"sharing\"))\n\t\t{\n\t\t\tthrow Error(\"mediaRenderer should be of video kind\");\n\t\t}\n\n\t\tconst userHasCameraVideo = user.hasCameraVideo();\n\t\tuser.videoRenderer = mediaRenderer;\n\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(userId, mediaRenderer);\n\n\t\tif (mediaRenderer.stream && mediaRenderer.kind === 'video')\n\t\t{\n\t\t\tthis.updateRerenderQueue(userId, RerenderReason.VideoEnabled);\n\t\t}\n\t\telse if (mediaRenderer.kind === 'video')\n\t\t{\n\t\t\tif (!userHasCameraVideo)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.updateRerenderQueue(userId, RerenderReason.VideoDisabled);\n\t\t}\n\t};\n\n\tsetUserMedia(userId, kind, track)\n\t{\n\t\tif (kind === 'audio')\n\t\t{\n\t\t\tthis.users[userId].audioTrack = track;\n\t\t}\n\n\t\tswitch (kind)\n\t\t{\n\t\t\tcase 'sharingAudio':\n\t\t\t\tthis.users[userId].screenAudioTrack = track;\n\t\t\t\tbreak;\n\n\t\t\tcase 'video':\n\t\t\t\tthis.users[userId].videoTrack = track;\n\t\t\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(userId, new MediaRenderer({\n\t\t\t\t\tkind: 'video',\n\t\t\t\t\ttrack: track,\n\t\t\t\t}));\n\t\t\t\tbreak;\n\n\t\t\tcase 'screen':\n\t\t\t\tthis.screenUsers[userId].videoTrack = track;\n\t\t\t\tthis.pictureInPictureCallWindow?.setVideoRenderer(userId, new MediaRenderer({\n\t\t\t\t\tkind: 'sharing',\n\t\t\t\t\ttrack: track,\n\t\t\t\t}));\n\t\t\t\tthis.updateUserList();\n\t\t\t\tthis.setUserScreenState(userId, track !== null);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t}\n\t}\n\n\tremoveScreenUsers()\n\t{\n\t\tfor (let userId in this.screenUsers)\n\t\t{\n\t\t\tthis.screenUsers[userId].videoTrack = null;\n\t\t}\n\t\tthis.updateUserList();\n\t};\n\n\tsetBadNetworkIndicator(userId, badNetworkIndicator)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].badNetworkIndicator = badNetworkIndicator;\n\t\t}\n\t}\n\n\tsetUserHasConnectionProblem(userId, hasConnectionProblem)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].hasConnectionProblem = hasConnectionProblem;\n\t\t}\n\t};\n\n\tsetUserConnectionQuality(userId, connectionQuality)\n\t{\n\t\tif (this.users[userId])\n\t\t{\n\t\t\tthis.users[userId].connectionQuality = connectionQuality;\n\t\t}\n\n\t\tif (this.localUser.id === userId)\n\t\t{\n\t\t\tthis.localUser.connectionQuality = connectionQuality;\n\t\t}\n\t};\n\n\tapplyIncomingVideoConstraints()\n\t{\n\t\tlet userId;\n\t\tlet user: CallUser;\n\t\tif (this.layout === Layouts.Grid)\n\t\t{\n\t\t\tfor (userId in this.users)\n\t\t\t{\n\t\t\t\tuser = this.users[userId];\n\t\t\t\tuser.setIncomingVideoConstraints(this.userSize.width, this.userSize.height);\n\t\t\t}\n\t\t}\n\t\telse if (this.layout === Layouts.Centered)\n\t\t{\n\t\t\tfor (userId in this.users)\n\t\t\t{\n\t\t\t\tuser = this.users[userId];\n\t\t\t\tif (userId == this.centralUser.id)\n\t\t\t\t{\n\t\t\t\t\tconst containerSize = this.elements.center.getBoundingClientRect();\n\t\t\t\t\tuser.setIncomingVideoConstraints(Math.floor(containerSize.width), Math.floor(containerSize.height));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tuser.setIncomingVideoConstraints(SIDE_USER_WIDTH, SIDE_USER_HEIGHT);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tgetDefaultCommonRecordState()\n\t{\n\t\treturn {\n\t\t\tstate: CallCommonRecordState.Stopped,\n\t\t\ttype: CallCommonRecordType.None,\n\t\t\tuserId: 0,\n\t\t\tdate: {\n\t\t\t\tstart: null,\n\t\t\t\tpause: [],\n\t\t\t},\n\t\t};\n\t}\n\n\tsetCommonRecordState(commonRecordState)\n\t{\n\t\tthis.commonRecordState = commonRecordState;\n\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.update(this.commonRecordState);\n\t\t}\n\n\t\tif (this.commonRecordState.userId != this.userId)\n\t\t{\n\t\t\tif ([CallCommonRecordState.Stopped, CallCommonRecordState.Destroyed].includes(this.commonRecordState.state))\n\t\t\t{\n\t\t\t\tthis.unblockButtons(['record']);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.blockButtons(['record']);\n\t\t\t}\n\t\t}\n\n\t\tif (this.elements.topPanel)\n\t\t{\n\t\t\tif ([CallCommonRecordState.Stopped, CallCommonRecordState.Destroyed].includes(this.commonRecordState.state))\n\t\t\t{\n\t\t\t\tdelete (this.elements.topPanel.dataset.recordState);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.topPanel.dataset.recordState = commonRecordState.state;\n\t\t\t}\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t}\n\t\tthis.container.appendChild(this.elements.root);\n\n\t\tif (this.layout !== Layouts.Mobile)\n\t\t{\n\t\t\tthis.startIntersectionObserver();\n\t\t}\n\t\tthis.updateButtons();\n\t\tthis.updateUserList();\n\n\t\tthis.resumeVideo();\n\t\tthis.toggleEars();\n\t\tthis.visible = true;\n\n\t\tthis.eventEmitter.emit(EventName.onShow);\n\n\t\t// We specifically disable the face improve feature to improve call quality.\n\t\tthis.disableFaceImprove();\n\t\tthis.checkPanelOverflow();\n\t};\n\n\thide()\n\t{\n\t\tthis.closeCopilotNotify();\n\t\tthis.clearCallcontrolPromo();\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t}\n\t\tDom.remove(this.elements.root);\n\t\tthis.visible = false;\n\t};\n\n\tstartIntersectionObserver()\n\t{\n\t\tif (!('IntersectionObserver' in window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.intersectionObserver = new IntersectionObserver(\n\t\t\tthis._onIntersectionChange.bind(this),\n\t\t\t{\n\t\t\t\troot: this.elements.userList.container,\n\t\t\t\tthreshold: 0.5\n\t\t\t}\n\t\t);\n\t};\n\n\t/**\n\t * @param {CallUser} callUser\n\t */\n\tobserveIntersections(callUser)\n\t{\n\t\tif (this.intersectionObserver && callUser.elements.root)\n\t\t{\n\t\t\tthis.intersectionObserver.observe(callUser.elements.root);\n\t\t}\n\t};\n\n\t/**\n\t * @param {CallUser} callUser\n\t */\n\tunobserveIntersections(callUser)\n\t{\n\t\tif (this.intersectionObserver && callUser.elements.root)\n\t\t{\n\t\t\tthis.intersectionObserver.unobserve(callUser.elements.root);\n\t\t}\n\t};\n\n\tshowDeviceSelector(bindElement)\n\t{\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.deviceSelector = new DeviceSelector({\n\t\t\tviewElement: this.container,\n\t\t\tparentElement: bindElement,\n\t\t\tzIndex: this.baseZIndex + 500,\n\t\t\tmicrophoneEnabled: !Hardware.isMicrophoneMuted,\n\t\t\tmicrophoneId: this.microphoneId || Hardware.defaultMicrophone,\n\t\t\tcameraEnabled: Hardware.isCameraOn,\n\t\t\tcameraId: this.cameraId,\n\t\t\tspeakerEnabled: !this.speakerMuted,\n\t\t\tspeakerId: this.speakerId,\n\t\t\tallowHdVideo: Hardware.preferHdQuality,\n\t\t\tnoiseSuppressionVisible: CallSettingsManager.noiseSuppressionEnabled ?? false,\n\t\t\tallowNoiseSuppression: Hardware.enableNoiseSuppression,\n\t\t\tfaceImproveEnabled: Util.isDesktop() && DesktopApi.isDesktop() && DesktopApi.getCameraSmoothingStatus(),\n\t\t\tallowFaceImprove: false,\n\t\t\tallowBackground: BackgroundDialog.isAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowMask: BackgroundDialog.isMaskAvailable() && this.isIntranetOrExtranet,\n\t\t\tallowAdvancedSettings: typeof (BXIM) !== 'undefined' && this.isIntranetOrExtranet,\n\t\t\tswitchCameraBlocked: this.blockedButtons['camera'],\n\t\t\tswitchMicrophoneBlocked: this.blockedButtons['microphone'],\n\t\t\tevents: {\n\t\t\t\t[DeviceSelector.Events.onMicrophoneSelect]: this._onMicrophoneSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onMicrophoneSwitch]: this._onMicrophoneButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onCameraSelect]: this._onCameraSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onCameraSwitch]: this._onCameraButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onSpeakerSelect]: this._onSpeakerSelected.bind(this),\n\t\t\t\t[DeviceSelector.Events.onSpeakerSwitch]: this._onSpeakerButtonClick.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeHdVideo]: this._onChangeHdVideo.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeNoiseSuppression]: this._onChangeNoiseSuppression.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeMicAutoParams]: this._onChangeMicAutoParams.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeFaceImprove]: this._onChangeFaceImprove.bind(this),\n\t\t\t\t[DeviceSelector.Events.onChangeVideoQuality]: this._onChangeVideoQuality.bind(this),\n\t\t\t\t[DeviceSelector.Events.onAdvancedSettingsClick]: () => this.eventEmitter.emit(EventName.onOpenAdvancedSettings),\n\t\t\t\t[DeviceSelector.Events.onDestroy]: () => {\n\t\t\t\t\tthis.buttons?.microphone.elements.arrow?.classList.remove('rotate');\n\t\t\t\t\tthis.buttons?.camera.elements.arrow?.classList.remove('rotate');\n\t\t\t\t\tthis.deviceSelector = null;\n\t\t\t\t},\n\t\t\t\t[DeviceSelector.Events.onShow]: () => this.eventEmitter.emit(EventName.onDeviceSelectorShow, {}),\n\t\t\t}\n\t\t});\n\t\tthis.deviceSelector.show();\n\t};\n\n\tshowCallMenu()\n\t{\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_WANT_TO_SAY\"),\n\t\t\t\ticonClass: \"hand\",\n\t\t\t\tonClick: this._onMobileCallMenuFloorRequestClick.bind(this)\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_PARTICIPANTS_LIST\"),\n\t\t\t\ticonClass: \"participants\",\n\t\t\t\tonClick: this._onMobileCallMenShowParticipantsClick.bind(this)\n\t\t\t},\n\t\t\t// TODO:\n\t\t\t/*{\n\t\t\t\ttext: \"Add participant\",\n\t\t\t\ticonClass: \"add-participant\",\n\t\t\t\tonClick: function() {}\n\t\t\t},*/\n\n\t\t\t/*{ //DEBUG: mobile audio\n\t\t\t\ttext: \"Enable audio\",\n\t\t\t\ticonClass: \"\",\n\t\t\t\tonClick: function() {\n\t\t\t\t\tfor (var userId in this.elements.audio)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.users[userId].stream)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconsole.log('user ' + userId + ' stream found, trying to play');\n\t\t\t\t\t\t\tthis.elements.audio[userId].srcObject = this.users[userId].stream;\n\t\t\t\t\t\t\tthis.elements.audio[userId].play();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.callMenu.close();\n\t\t\t\t}.bind(this)\n\t\t\t},*/\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_COPY_INVITE\"),\n\t\t\t\ticonClass: \"add-participant\",\n\t\t\t\tonClick: this._onMobileCallMenuCopyInviteClick.bind(this)\n\n\t\t\t},\n\t\t\t!this.isIntranetOrExtranet\n\t\t\t\t?\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\"),\n\t\t\t\t\ticonClass: \"change-name\",\n\t\t\t\t\tonClick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callMenu.close();\n\t\t\t\t\t\tsetTimeout(this.showRenameSlider.bind(this), 100);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t:\n\t\t\t\tnull,\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CANCEL\"),\n\t\t\t\tenabled: false,\n\t\t\t\tonClick: this._onMobileCallMenuCancelClick.bind(this)\n\t\t\t}\n\t\t];\n\n\t\tthis.callMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\tonClose: () => this.callMenu.destroy(),\n\t\t\tonDestroy: () => this.callMenu = null,\n\t\t});\n\n\t\tthis.callMenu.show();\n\t};\n\n\tshowUserMenu(userId)\n\t{\n\t\tconst userModel: ?UserModel = this.userRegistry.get(userId);\n\t\tif (!userModel)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tlet pinItem = null;\n\t\tif (this.pinnedUser && this.pinnedUser.id == userId)\n\t\t{\n\t\t\tpinItem = {\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_UNPIN\"),\n\t\t\t\ticonClass: \"unpin\",\n\t\t\t\tonClick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.unpinUser();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\telse if (this.userId != userId)\n\t\t{\n\t\t\tpinItem = {\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_PIN\"),\n\t\t\t\ticonClass: \"pin\",\n\t\t\t\tonClick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.pinUser(userId);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\tuserModel: userModel,\n\t\t\t\tenabled: false\n\t\t\t},\n\t\t\t{\n\t\t\t\tseparator: true,\n\t\t\t},\n\t\t\tpinItem,\n\t\t\tthis.userId == userId && !this.isIntranetOrExtranet\n\t\t\t\t?\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\"),\n\t\t\t\t\ticonClass: \"change-name\",\n\t\t\t\t\tonClick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\t\tsetTimeout(this.showRenameSlider.bind(this), 100)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t:\n\t\t\t\tnull,\n\t\t\t/*{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_WRITE_TO_PRIVATE_CHAT\"),\n\t\t\t\ticonClass: \"private-chat\",\n\t\t\t\tonClick: function()\n\t\t\t\t{\n\t\t\t\t\tthis.userMenu.close();\n\t\t\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\n\t\t\t\t\t})\n\t\t\t\t}.bind(this)\n\t\t\t},*/\n\t\t\t/*{\n\t\t\t\t// TODO:\n\t\t\t\ttext: \"Remove user\",\n\t\t\t\ticonClass: \"remove-user\"\n\t\t\t},*/\n\t\t\t{\n\t\t\t\tseparator: true\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CANCEL\"),\n\t\t\t\tenabled: false,\n\t\t\t\tonClick: () => this.userMenu.close(),\n\t\t\t}\n\t\t];\n\n\t\tthis.userMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\tonClose: () => this.userMenu.destroy(),\n\t\t\tonDestroy: () => this.userMenu = null,\n\t\t});\n\t\tthis.userMenu.show();\n\t};\n\n\tshowParticipantsMenu()\n\t{\n\t\tif (this.participantsMenu)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst menuItems = [{\n\t\t\tuserModel: this.localUser.userModel,\n\t\t\tshowSubMenu: true,\n\t\t\tonClick: () => {\n\t\t\t\tthis.participantsMenu.close();\n\t\t\t\tthis.showUserMenu(this.localUser.userModel.id);\n\t\t\t},\n\t\t}];\n\n\t\t[...this.userRegistry.users.values()].forEach((userModel: UserModel) => {\n\t\t\tif (userModel.localUser || userModel.state !== UserState.Connected)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (menuItems.length > 0)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\tseparator: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmenuItems.push({\n\t\t\t\tuserModel,\n\t\t\t\tshowSubMenu: true,\n\t\t\t\tonClick: () => {\n\t\t\t\t\tthis.participantsMenu.close();\n\t\t\t\t\tthis.showUserMenu(userModel.id);\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\n\t\tif (menuItems.length === 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.participantsMenu = new MobileMenu({\n\t\t\tparent: this.elements.root,\n\t\t\titems: menuItems,\n\t\t\theader: BX.message('IM_M_CALL_PARTICIPANTS').replace('#COUNT#', this.getConnectedUserCount(true)),\n\t\t\tlargeIcons: true,\n\n\t\t\tonClose: () => {\n\t\t\t\tthis.participantsMenu.destroy();\n\t\t\t},\n\t\t\tonDestroy: () => {\n\t\t\t\tthis.participantsMenu = null;\n\t\t\t},\n\t\t});\n\n\t\tthis.participantsMenu.show();\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * @param {Object} params\n\t * @param {string} params.text\n\t * @param {string} [params.subText]\n\t */\n\tshowMessage(params)\n\t{\n\t\tconst statusNode = Dom.create('div', {\n\t\t\tprops: { className: 'bx-messenger-videocall-user-status bx-messenger-videocall-user-status-wide' },\n\t\t});\n\n\t\tif (Type.isStringFilled(params.text))\n\t\t{\n\t\t\tconst textNode = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-videocall-status-text' },\n\t\t\t\ttext: params.text,\n\t\t\t});\n\t\t\tDom.append(textNode, statusNode);\n\t\t}\n\n\t\tthis.#showErrorLayout(statusNode);\n\t}\n\n\thideMessage()\n\t{\n\t\tthis.elements.overlay.textContent = '';\n\t}\n\n\trenderSelfTestCallLayout()\n\t{\n\t\tconst errorContainer = Dom.create('div', {\n\t\t\tprops: { className: 'bx-messenger-videocall-error-container' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-container-icon-alert' },\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-message' },\n\t\t\t\t\ttext: Loc.getMessage('CALL_CONNECTED_ERROR'),\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-button-self-test' },\n\t\t\t\t\ttext: Loc.getMessage('CALL_RUN_SELF_TEST'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tUtil.startSelfTest();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.#showErrorLayout(errorContainer);\n\t}\n\n\trenderReloadPageLayout()\n\t{\n\t\tconst errorContainer = Dom.create('div', {\n\t\t\tprops: { className: 'bx-messenger-videocall-error-container' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-container-icon-alert' },\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-message' },\n\t\t\t\t\thtml: Loc.getMessage('CALL_SECURITY_KEY_CHANGED', { '[break]': '<br/>' }),\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-videocall-error-button-self-test' },\n\t\t\t\t\ttext: Loc.getMessage('CALL_RELOAD_PAGE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t\t\tlocation.reload();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.#showErrorLayout(errorContainer);\n\t}\n\n\t#showErrorLayout(content)\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t\tDom.append(this.elements.root, this.container);\n\t\t}\n\n\t\tif (this.elements.overlay.childElementCount)\n\t\t{\n\t\t\tDom.clean(this.elements.overlay);\n\t\t}\n\n\t\tDom.append(content, this.elements.overlay);\n\t}\n\n\t/**\n\t * @param {Object} params\n\t * @param {string} params.text\n\t * @param {string} [params.subText]\n\t */\n\tshowFatalError(params)\n\t{\n\t\tthis.showMessage(params);\n\t\tthis.#prepareErrorState();\n\t}\n\n\tshowSecurityKeyError()\n\t{\n\t\tthis.renderReloadPageLayout();\n\t\tthis.#prepareErrorState();\n\t}\n\n\tshowSelfTest()\n\t{\n\t\tthis.renderSelfTestCallLayout();\n\t\tthis.#prepareErrorState();\n\t}\n\n\t#prepareErrorState()\n\t{\n\t\tthis.setUiState(UiState.Error);\n\t\t// in some cases video elements may still be shown on the error screen, let's hide them\n\t\tDom.style(this.elements.userList.container, 'display', 'none');\n\t}\n\n\tclose()\n\t{\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.stopViewUpdate();\n\t\t}\n\t\tthis.commonRecordState = this.getDefaultCommonRecordState();\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tBX.remove(this.elements.root);\n\t\t}\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.toggleStatePictureInPictureCallWindow(false)\n\t\t}\n\n\t\tthis.visible = false;\n\t\tthis.eventEmitter.emit(EventName.onClose);\n\n\t\tthis.clearCallcontrolPromo();\n\t};\n\n\tsetSize(size)\n\t{\n\t\tif (this.size == size)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.size = size;\n\n\t\tif (this.size == Size.Folded)\n\t\t{\n\t\t\tthis.clearCallcontrolPromo();\n\n\t\t\tif (this.overflownButtonsPopup)\n\t\t\t{\n\t\t\t\tthis.overflownButtonsPopup.close();\n\t\t\t}\n\t\t\tif (this.elements.panel)\n\t\t\t{\n\t\t\t\tthis.elements.panel.classList.add('bx-messenger-videocall-panel-folded');\n\t\t\t}\n\t\t\tDom.remove(this.elements.container);\n\t\t\tDom.remove(this.elements.topPanel);\n\t\t\tthis.elements.root.style.removeProperty('max-width');\n\t\t\tthis.updateButtons();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.elements.panel)\n\t\t\t{\n\t\t\t\tthis.elements.panel.classList.remove('bx-messenger-videocall-panel-folded');\n\t\t\t}\n\t\t\tthis.elements.wrap.appendChild(this.elements.topPanel);\n\t\t\tthis.elements.wrap.appendChild(this.elements.container);\n\t\t\tif (this.maxWidth > 0)\n\t\t\t{\n\t\t\t\tthis.elements.root.style.maxWidth = Math.max(this.maxWidth, MIN_WIDTH) + 'px';\n\t\t\t}\n\t\t\tthis.updateButtons();\n\t\t\tthis.updateUserList();\n\t\t\tthis.resumeVideo();\n\t\t}\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t}\n\t};\n\n\tisButtonBlocked(buttonName)\n\t{\n\t\tswitch (buttonName)\n\t\t{\n\t\t\tcase 'camera':\n\t\t\t\treturn this.#isCameraButtonBlocked();\n\t\t\tcase 'chat':\n\t\t\t\treturn !this.showChatButtons || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'microphone':\n\t\t\t\treturn !Util.havePermissionToBroadcast('mic');\n\t\t\tcase 'floorRequest':\n\t\t\t\treturn (this.uiState !== UiState.Connected) || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'screen':\n\t\t\t\treturn !this.showShareButton || (!this.isScreenSharingSupported() || this.isFullScreen) || this.blockedButtons[buttonName] === true || !Util.havePermissionToBroadcast('screenshare');\n\t\t\tcase 'users':\n\t\t\t\treturn !this.showUsersButton || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'record':\n\t\t\t\treturn !this.showRecordButton || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'document':\n\t\t\t\treturn !this.showDocumentButton || this.blockedButtons[buttonName] === true;\n\t\t\tcase 'copilot':\n\t\t\t\treturn !this.showCopilotButton || this.blockedButtons[buttonName] === true;\n\t\t\tdefault:\n\t\t\t\treturn this.blockedButtons[buttonName] === true;\n\t\t}\n\t};\n\n\tisButtonHidden(buttonName)\n\t{\n\t\treturn this.hiddenButtons[buttonName] === true;\n\t};\n\n\tshowButton(buttonCode)\n\t{\n\t\tthis.showButtons([buttonCode]);\n\t};\n\n\thideButton(buttonCode)\n\t{\n\t\tthis.hideButtons([buttonCode]);\n\t};\n\n\t#isCameraButtonBlocked(): Boolean\n\t{\n\t\tconst isUiBlocked = this.uiState !== UiState.Preparing && this.uiState !== UiState.Connected;\n\t\tconst isForceBlock = this.blockedButtons.camera === true;\n\t\tconst noCamPermission = !Util.havePermissionToBroadcast('cam');\n\t\tconst isUserConnecting = this.localUser.userModel.state === UserState.Connecting;\n\t\tconst hasStream = this.localUser.hasVideo() || this.localUser.hasAudio();\n\t\tconst localUserReceivedStats = (this.isVideoconf || this.localUserReceivedStats || !hasStream);\n\n\t\treturn isUiBlocked || isForceBlock || noCamPermission || isUserConnecting || !localUserReceivedStats;\n\t}\n\n\t/**\n\t * @return {bool} Returns true if buttons update is required\n\t */\n\tcheckPanelOverflow()\n\t{\n\t\tconst delta = this.elements.panel.scrollWidth - this.elements.panel.offsetWidth;\n\t\tconst mediumButtonMinWidth = (this.layout === Layouts.Mobile)\n\t\t\t? 60\n\t\t\t: 66; // todo: move to constants maybe? or maybe even calculate dynamically somehow?\n\t\tif (delta > 0)\n\t\t{\n\t\t\tlet countOfButtonsToHide = Math.ceil(delta / mediumButtonMinWidth) + 1;\n\n\t\t\tconst buttons = this.getButtonList();\n\n\t\t\tfor (let i = buttons.length - 1; i >= 0; i--)\n\t\t\t{\n\t\t\t\tif (buttons[i] === 'hangupOptions' || buttons[i] === 'hangup' || buttons[i] === 'close' || buttons[i] === 'more')\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.overflownButtons[buttons[i]] = true;\n\t\t\t\tcountOfButtonsToHide -= 1;\n\t\t\t\tif (!countOfButtonsToHide)\n\t\t\t\t{\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst hiddenButtonsCount = Object.keys(this.overflownButtons).length;\n\t\t\tif (hiddenButtonsCount > 0)\n\t\t\t{\n\t\t\t\tconst unusedPanelSpace = this.calculateUnusedPanelSpace();\n\t\t\t\tif (unusedPanelSpace > 320)\n\t\t\t\t{\n\t\t\t\t\tlet countOfButtonsToShow = Math.min(Math.floor(unusedPanelSpace / mediumButtonMinWidth), hiddenButtonsCount);\n\t\t\t\t\tlet buttonsLeftHidden = hiddenButtonsCount - countOfButtonsToShow;\n\t\t\t\t\tif (buttonsLeftHidden === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcountOfButtonsToShow += 1;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (countOfButtonsToShow == hiddenButtonsCount)\n\t\t\t\t\t{\n\t\t\t\t\t\t// show all buttons;\n\t\t\t\t\t\tthis.overflownButtons = {};\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (let i = 0; i < countOfButtonsToShow; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdelete this.overflownButtons[Object.keys(this.overflownButtons)[0]]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to show\n\t */\n\tshowButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tif (this.hiddenButtons.hasOwnProperty(buttonName))\n\t\t\t{\n\t\t\t\tdelete this.hiddenButtons[buttonName];\n\t\t\t}\n\t\t})\n\n\t\tthis.updateButtons();\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to hide\n\t */\n\thideButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) => this.hiddenButtons[buttonName] = true);\n\t\tthis.updateButtons();\n\t};\n\n\tblockAddUser()\n\t{\n\t\tthis.blockButtons(['add']);\n\t\tif (this.elements.userList.addButton)\n\t\t{\n\t\t\tDom.remove(this.elements.userList.addButton);\n\t\t}\n\t};\n\n\tunblockAddUser()\n\t{\n\t\tthis.unblockButtons(['add']);\n\n\t\tthis.updateButtons();\n\t};\n\n\tblockUsersButton()\n\t{\n\t\tthis.blockButtons(['users']);\n\n\t\tthis.updateButtons();\n\t};\n\n\tunblockUsersButton()\n\t{\n\t\tthis.unblockButtons(['users']);\n\n\t\tthis.updateButtons();\n\t};\n\n\tblockSwitchCamera()\n\t{\n\t\tthis.blockButtons(['camera']);\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleCameraAvailability(false);\n\t\t}\n\t};\n\n\tunblockSwitchCamera()\n\t{\n\t\tthis.unblockButtons(['camera']);\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleCameraAvailability(true);\n\t\t}\n\t};\n\n\tblockSwitchMicrophone()\n\t{\n\t\tthis.blockButtons(['microphone']);\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleMicrophoneAvailability(false);\n\t\t}\n\t};\n\n\tunblockSwitchMicrophone()\n\t{\n\t\tthis.unblockButtons(['microphone']);\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.toggleMicrophoneAvailability(true);\n\t\t}\n\t};\n\n\tblockScreenSharing()\n\t{\n\t\tthis.blockButtons(['screen']);\n\t};\n\n\tblockHistoryButton()\n\t{\n\t\tthis.blockButtons(['history']);\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to block\n\t */\n\n\tblockButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array \")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tthis.blockedButtons[buttonName] = true;\n\t\t\tif (this.buttons[buttonName])\n\t\t\t{\n\t\t\t\tthis.buttons[buttonName].setBlocked(true);\n\t\t\t}\n\t\t})\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.updateBlockButtons(this.getBlockedButtonsListPictureInPictureCallWindow()).updateButtons();\n\t\t}\n\t};\n\n\t/**\n\t * @param {string[]} buttons Array of buttons names to unblock\n\t */\n\tunblockButtons(buttons)\n\t{\n\t\tif (!Type.isArray(buttons))\n\t\t{\n\t\t\tconsole.error(\"buttons should be array\")\n\t\t}\n\n\t\tbuttons.forEach((buttonName) =>\n\t\t{\n\t\t\tdelete this.blockedButtons[buttonName];\n\t\t\tif (this.buttons[buttonName])\n\t\t\t{\n\t\t\t\tthis.buttons[buttonName].setBlocked(this.isButtonBlocked(buttonName));\n\t\t\t}\n\t\t});\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.updateBlockButtons(this.getBlockedButtonsListPictureInPictureCallWindow()).updateButtons();\n\t\t}\n\t};\n\n\tdisableMediaSelection()\n\t{\n\t\tthis.mediaSelectionBlocked = true;\n\t};\n\n\tenableMediaSelection()\n\t{\n\t\tthis.mediaSelectionBlocked = false;\n\t\tif (this.buttons.microphone && this.isMediaSelectionAllowed())\n\t\t{\n\t\t\tthis.buttons.microphone.showArrow();\n\t\t}\n\t\tif (this.buttons.camera && this.isMediaSelectionAllowed())\n\t\t{\n\t\t\tthis.buttons.camera.showArrow();\n\t\t}\n\t};\n\n\tisMediaSelectionAllowed()\n\t{\n\t\treturn this.layout != Layouts.Mobile && (this.uiState == UiState.Preparing || this.uiState == UiState.Connected) && !this.mediaSelectionBlocked && !this.isFullScreen;\n\t};\n\n\tgetButtonList(): Array\n\t{\n\t\tlet result = [];\n\n\t\tif (this.uiState === UiState.Error)\n\t\t{\n\t\t\tresult.push('close');\n\t\t}\n\n\t\tif (this.uiState === UiState.Initializing)\n\t\t{\n\t\t\tresult.push('hangup');\n\t\t}\n\n\t\tif (this.size === Size.Folded)\n\t\t{\n\t\t\tresult.push('title', 'spacer', 'returnToCall', 'hangup');\n\t\t}\n\n\t\tif (result.length > 0)\n\t\t{\n\t\t\tthis.needToRerenderButtonList = this.previousButtonList.toString() !== result.toString();\n\t\t\tthis.previousButtonList = result;\n\n\t\t\treturn result;\n\t\t}\n\n\t\tresult.push('microphone', 'camera');\n\n\t\tif (this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('speaker');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.push('mobileMenu');\n\t\t}\n\t\tconst bottomCenterMenuIsVisible = this.uiState === UiState.Initializing\n\t\t\t|| this.uiState === UiState.Calling\n\t\t\t|| this.uiState === UiState.Connected\n\t\t\t|| this.uiState === UiState.Error;\n\n\t\tif (bottomCenterMenuIsVisible)\n\t\t{\n\t\t\tresult.push('chat');\n\t\t}\n\n\t\tif (this.layout !== Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('users');\n\t\t}\n\n\t\tif (this.layout != Layouts.Mobile && bottomCenterMenuIsVisible)\n\t\t{\n\t\t\tresult.push('floorRequest', 'screen', 'record', 'document');\n\t\t}\n\n\t\tif (this.layout !== Layouts.Mobile && CallAI.serviceEnabled && bottomCenterMenuIsVisible)\n\t\t{\n\t\t\tresult.push('copilot');\n\t\t}\n\n\t\tresult = result.filter((buttonCode) => {\n\t\t\treturn !Object.prototype.hasOwnProperty.call(this.hiddenButtons, buttonCode)\n\t\t\t\t&& !Object.prototype.hasOwnProperty.call(this.overflownButtons, buttonCode);\n\t\t});\n\n\t\tif (Object.keys(this.overflownButtons).length > 0 && bottomCenterMenuIsVisible)\n\t\t{\n\t\t\tresult.push('more');\n\t\t}\n\n\t\tif (this.uiState == UiState.Preparing)\n\t\t{\n\t\t\tresult.push('close');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult.push('hangup');\n\t\t}\n\n\t\tif (\n\t\t\t!Object.prototype.hasOwnProperty.call(this.hiddenButtons, 'hangupOptions')\n\t\t\t&& this.isIntranetOrExtranet\n\t\t)\n\t\t{\n\t\t\tresult.push('hangupOptions');\n\t\t}\n\n\t\tthis.needToRerenderButtonList = this.previousButtonList.toString() !== result.toString();\n\t\tthis.previousButtonList = result;\n\n\t\treturn result;\n\t}\n\n\tgetTopButtonList()\n\t{\n\t\tlet result = [];\n\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\treturn ['participantsMobile'];\n\t\t}\n\t\tresult.push('watermark');\n\t\tresult.push('protected');\n\t\tresult.push('recordStatus');\n\t\tresult.push('spacer');\n\n\t\tlet separatorNeeded = false;\n\t\tif (this.uiState === UiState.Connected && this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('grid');\n\t\t}\n\n\t\tif (this.uiState != UiState.Preparing && this.isFullScreenSupported() && this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('fullscreen');\n\t\t}\n\n\t\tif (this.uiState === UiState.Connected && this.layout != Layouts.Mobile)\n\t\t{\n\t\t\tresult.push('feedback');\n\t\t}\n\n\t\tif (\n\t\t\tthis.uiState === UiState.Connected\n\t\t\t&& this.layout != Layouts.Mobile\n\t\t\t&& Util.canControlChangeSettings()\n\t\t\t&& Util.isUserControlFeatureEnabled()\n\t\t)\n\t\t{\n\t\t\tresult.push('callcontrol');\n\t\t}\n\n\t\tif (this.uiState != UiState.Preparing)\n\t\t{\n\t\t\tif (separatorNeeded)\n\t\t\t{\n\t\t\t\tresult.push('separator');\n\t\t\t}\n\t\t\tresult.push('participants');\n\t\t}\n\n\t\tlet previousButtonCode = '';\n\t\tresult = result.filter((buttonCode) =>\n\t\t{\n\t\t\tif (previousButtonCode === 'spacer' && buttonCode === 'separator')\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tpreviousButtonCode = buttonCode;\n\n\t\t\treturn !this.hiddenTopButtons.hasOwnProperty(buttonCode);\n\t\t});\n\n\t\tthis.needToRerenderTopButtonList = this.previousTopButtonList.toString() !== result.toString();\n\t\tthis.previousTopButtonList = result;\n\n\t\treturn result;\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall bx-messenger-videocall-scope\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.wrap = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: `bx-messenger-videocall-wrap ${this.isCopilotActive ? 'bx-messenger-videocall-wrap-with-copilot' : ''}`},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.container = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-inner\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.center = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-central-user\"},\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\ttouchstart: this._onCenterTouchStart.bind(this),\n\t\t\t\t\t\t\t\t\t\ttouchend: this._onCenterTouchEnd.bind(this),\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pageNavigatorLeft = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator left\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.pageNavigatorLeftCounter = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-counter left\"},\n\t\t\t\t\t\t\t\t\t\t\thtml: (this.currentPage - 1) + '&nbsp;/&nbsp;' + this.pagesCount\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-icon left\"}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onLeftPageNavigatorClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pageNavigatorRight = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator right\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.pageNavigatorRightCounter = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-counter right\"},\n\t\t\t\t\t\t\t\t\t\t\thtml: (this.currentPage + 1) + '&nbsp;/&nbsp;' + this.pagesCount\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-page-navigator-icon right\"}\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this._onRightPageNavigatorClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.topPanel = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-top-panel\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.notificationPanel = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-notification-panel\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.bottom = Dom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tthis.elements.userSelectorContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom-user-selector-container\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tthis.elements.pinnedUserContainer = Dom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-bottom-pinned-user-container\"}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: this._onBodyClick.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tthis.talkingService.init({\n\t\t\troot: this.elements.root,\n\t\t});\n\t\tthis.talkingService.refreshQueue();\n\n\t\tif (this.showButtonPanel)\n\t\t{\n\t\t\tthis.elements.panel = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-panel\"},\n\t\t\t});\n\t\t\tthis.elements.bottom.appendChild(this.elements.panel);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-no-button-panel\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.userSelector = new UserSelectorMobile({\n\t\t\t\tuserRegistry: this.userRegistry\n\t\t\t});\n\t\t\tthis.userSelector.mount(this.elements.userSelectorContainer);\n\n\t\t\tthis.elements.ear.left = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-messenger-videocall-mobile-ear left\"\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this._onLeftEarClick.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.elements.ear.right = Dom.create(\"div\", {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: \"bx-messenger-videocall-mobile-ear right\"\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tclick: this._onRightEarClick.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.elements.localUserMobile = Dom.create(\"div\", {\n\t\t\t\tprops: {className: \"bx-messenger-videocall-local-user-mobile\"}\n\t\t\t});\n\n\t\t\tif (window.innerHeight < window.innerWidth)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add(\"orientation-landscape\");\n\t\t\t}\n\n\t\t\tthis.elements.wrap.appendChild(this.elements.ear.left);\n\t\t\tthis.elements.wrap.appendChild(this.elements.ear.right);\n\t\t\tthis.elements.wrap.appendChild(this.elements.localUserMobile);\n\t\t}\n\n\t\tthis.centralUser.mount(this.elements.center);\n\n\t\tthis.elements.overlay = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-overlay\"}\n\t\t});\n\n\t\tthis.elements.userBlock = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-block\"},\n\t\t\tchildren: [\n\t\t\t\tthis.elements.ear.top = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear bx-messenger-videocall-ear-top\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear-icon\"}\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this._onTopPageNavigatorClick.bind(this)\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.ear.bottom = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear bx-messenger-videocall-ear-bottom\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-videocall-ear-icon\"}\n\t\t\t\t\t\t})\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this._onBottomPageNavigatorClick.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tthis.elements.userList.container = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-videocall-user-list\"\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tscroll: Runtime.debounce(this.toggleEars.bind(this), 300),\n\t\t\t\twheel: (e) => this.elements.userList.container.scrollTop += e.deltaY\n\t\t\t}\n\t\t});\n\n\t\tthis.elements.userList.addButton = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-messenger-videocall-user-add\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-videocall-user-add-inner\"}\n\t\t\t\t})\n\t\t\t],\n\t\t\tstyle: {\n\t\t\t\torder: addButtonPosition\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tclick: this._onAddButtonClick.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tif (this.layout == Layouts.Centered || this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\tuserId: this.centralUser.id,\n\t\t\t});\n\t\t\tthis.elements.root.classList.add('bx-messenger-videocall-centered');\n\t\t\tif (this.layout !== Layouts.Mobile)\n\t\t\t{\n\t\t\t\tthis.elements.container.appendChild(this.elements.userBlock);\n\t\t\t}\n\t\t}\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-grid\");\n\t\t}\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-fullscreen-mobile\");\n\t\t}\n\n\t\tthis.resizeObserver.observe(this.elements.root);\n\t\tthis.resizeObserver.observe(this.container);\n\t\treturn this.elements.root;\n\t};\n\n\ttoggleSubscribingVideoInRenderUserList(participants, showVideo)\n\t{\n\t\tif (participants.length > 0)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onToggleSubscribe, { participants, showVideo });\n\t\t}\n\t}\n\n\tgetOrderingRules(): Object\n\t{\n\t\tconst rules = {\n\t\t\t[RerenderReason.VideoEnabled]: [],\n\t\t\t[RerenderReason.VideoDisabled]: [],\n\t\t\t[RerenderReason.UserDisconnected]: null,\n\t\t};\n\n\t\tthis.rerenderQueue.forEach((el) => {\n\t\t\tswitch (el.reason)\n\t\t\t{\n\t\t\t\tcase RerenderReason.UserDisconnected:\n\t\t\t\t\trules[el.reason] = {\n\t\t\t\t\t\tid: el.userId,\n\t\t\t\t\t\torder: this.userRegistry.get(el.userId).prevOrder,\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase RerenderReason.VideoEnabled:\n\t\t\t\tcase RerenderReason.VideoDisabled:\n\t\t\t\t\trules[el.reason].push({\n\t\t\t\t\t\tid: el.userId,\n\t\t\t\t\t\torder: this.userRegistry.get(el.userId).order,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t}\n\t\t});\n\n\t\tthis.rerenderQueue.clear();\n\t\trules[RerenderReason.VideoEnabled].sort((a, b) => a.order - b.order);\n\t\trules[RerenderReason.VideoDisabled].sort((a, b) => a.order - b.order);\n\n\t\treturn rules;\n\t}\n\n\tapplyOrderChanges(changes): void\n\t{\n\t\tif (!Type.isArray(changes))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tchanges.forEach((change) => {\n\t\t\tif (change.type === SwapType.Direct)\n\t\t\t{\n\t\t\t\tchange.to.userModel.order = change.to.order;\n\t\t\t\tthis.cache.delete('activeUsers');\n\t\t\t}\n\t\t\telse if (change.type === SwapType.Replace && change.to && change.from)\n\t\t\t{\n\t\t\t\tchange.to.userModel.order = change.from.order;\n\t\t\t\tchange.to.userModel.prevOrder = 0;\n\t\t\t\tchange.from.userModel.order = change.to.order;\n\t\t\t\tthis.cache.delete('activeUsers');\n\t\t\t}\n\t\t});\n\t}\n\n\tisUserHasActiveState(userModel)\n\t{\n\t\treturn (userModel.state !== UserState.Idle\n\t\t\t&& userModel.state !== UserState.Declined\n\t\t\t&& userModel.state !== UserState.Unavailable\n\t\t\t&& userModel.state !== UserState.Busy\n\t\t\t&& userModel.direction !== EndpointDirection.RecvOnly\n\t\t);\n\t};\n\n\tprocessVideoRules(rules, params): void\n\t{\n\t\tconst diffBetweenChanges = rules[RerenderReason.VideoEnabled].length - rules[RerenderReason.VideoDisabled].length;\n\t\tconst lessChangesField = diffBetweenChanges > 0\n\t\t\t? RerenderReason.VideoDisabled\n\t\t\t: RerenderReason.VideoEnabled;\n\t\tconst moreChangesField = diffBetweenChanges > 0\n\t\t\t? RerenderReason.VideoEnabled\n\t\t\t: RerenderReason.VideoDisabled;\n\n\t\tif (rules[RerenderReason.VideoEnabled].length > 0 && rules[RerenderReason.VideoDisabled].length > 0)\n\t\t{\n\t\t\trules[lessChangesField].forEach((el, index) => {\n\t\t\t\tconst toUser = this.userRegistry.get(el.id);\n\t\t\t\tconst fromUser = this.userRegistry.get(rules[moreChangesField][index].id);\n\n\t\t\t\tparams.orderChanges.push({\n\t\t\t\t\ttype: SwapType.Replace,\n\t\t\t\t\tto: {\n\t\t\t\t\t\tuserModel: fromUser,\n\t\t\t\t\t\torder: fromUser.order,\n\t\t\t\t\t},\n\t\t\t\t\tfrom: {\n\t\t\t\t\t\tuserModel: toUser,\n\t\t\t\t\t\torder: toUser.order,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.applyOrderChanges(params.orderChanges);\n\t\tparams.orderChanges.length = 0;\n\n\t\tif (diffBetweenChanges === 0)\n\t\t{\n\t\t\trules[RerenderReason.VideoEnabled].length = 0;\n\t\t\trules[RerenderReason.VideoDisabled].length = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\trules[moreChangesField].splice(0, rules[moreChangesField].length - Math.abs(diffBetweenChanges));\n\t\t\trules[lessChangesField].length = 0;\n\n\t\t\tif (moreChangesField === RerenderReason.VideoEnabled)\n\t\t\t{\n\t\t\t\trules[moreChangesField].forEach((el) => {\n\t\t\t\t\tparams.orderChanges.push({\n\t\t\t\t\t\ttype: SwapType.Replace,\n\t\t\t\t\t\tfrom: {\n\t\t\t\t\t\t\tuserModel: this.userRegistry.get(el.id),\n\t\t\t\t\t\t\torder: this.userRegistry.get(el.id).order,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tparams.incompleteSwaps.push(params.orderChanges.length);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tprocessDisconnectRules(rules, params): void\n\t{\n\t\tif (!rules[RerenderReason.UserDisconnected])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userModel = this.userRegistry.get(rules[RerenderReason.UserDisconnected].id);\n\n\t\tif (userModel.prevCameraState)\n\t\t{\n\t\t\tparams.disconnectedUserHadVideo = true;\n\t\t}\n\t}\n\n\tcompleteVideoEnableSwap(userModel, rules, params): void\n\t{\n\t\tconst swapRemains = params.incompleteSwaps.length;\n\n\t\tif (userModel.state === UserState.Calling)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.usersWithEnabledVideo.includes(userModel.id))\n\t\t{\n\t\t\tparams.incompleteSwaps.pop();\n\t\t\tparams.usersWithEnabledVideo.splice(params.usersWithEnabledVideo.indexOf(userModel.id), 1);\n\t\t\tparams.usersToKeepActive.push(userModel.id);\n\t\t}\n\t\telse if (!userModel.cameraState)\n\t\t{\n\t\t\tconst index = params.incompleteSwaps[swapRemains - 1] - 1;\n\t\t\tconst userEnabledVideo = params.orderChanges[index].from;\n\t\t\tconst currenUserFromCurrentPage = params.possibleActiveUsers?.includes(userModel.id);\n\t\t\tconst changedUserFromCurrentPage = params.possibleActiveUsers?.includes(userEnabledVideo.userModel.id);\n\t\t\tconst skipDeactivation = changedUserFromCurrentPage || (currenUserFromCurrentPage && changedUserFromCurrentPage);\n\n\t\t\tparams.orderChanges[index].to = {\n\t\t\t\tuserModel,\n\t\t\t\torder: userModel.order,\n\t\t\t};\n\n\t\t\tif (!skipDeactivation)\n\t\t\t{\n\t\t\t\tparams.currentPageUsers.pop();\n\t\t\t\tparams.usersToDeactivate++;\n\t\t\t}\n\t\t\telse if (changedUserFromCurrentPage && !currenUserFromCurrentPage)\n\t\t\t{\n\t\t\t\tparams.usersToForceDeactivation.push(userEnabledVideo.userModel.id);\n\t\t\t}\n\t\t\telse if (currenUserFromCurrentPage && changedUserFromCurrentPage)\n\t\t\t{\n\t\t\t\tparams.usersToKeepActive.push(userModel.id);\n\t\t\t}\n\n\t\t\tparams.incompleteSwaps.pop();\n\t\t}\n\t}\n\n\tcompleteVideoDisabledSwap(rules, params): void\n\t{\n\t\tlet usersProcessed = 0;\n\n\t\trules[RerenderReason.VideoDisabled].forEach((el) => {\n\t\t\tconst userWithoutVideo = this.userRegistry.get(el.id);\n\t\t\tconst userWithoutVideoIndex = params.activeUsers.indexOf(el.id);\n\t\t\tconst userWithoutVideoPage = Math.ceil((userWithoutVideoIndex + 1) / this.usersPerPage);\n\t\t\tconst skipUsers = (userWithoutVideoPage - 1) * this.usersPerPage;\n\t\t\tconst numberOfUsersWithVideoForSwap = params.usersWithVideo.length - skipUsers;\n\t\t\tconst userToSwap = params.usersWithVideo[params.usersWithVideo.length - 1 - usersProcessed];\n\t\t\tconst canCompleteVideoSwap = userToSwap && userToSwap.order > el.order;\n\n\t\t\tif (canCompleteVideoSwap && (numberOfUsersWithVideoForSwap - usersProcessed >= 0))\n\t\t\t{\n\t\t\t\tusersProcessed++;\n\t\t\t\tparams.orderChanges.push({\n\t\t\t\t\ttype: SwapType.Replace,\n\t\t\t\t\tto: {\n\t\t\t\t\t\tuserModel: userWithoutVideo,\n\t\t\t\t\t\torder: userWithoutVideo.order,\n\t\t\t\t\t},\n\t\t\t\t\tfrom: {\n\t\t\t\t\t\tuserModel: userToSwap,\n\t\t\t\t\t\torder: userToSwap.order,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tconst userToSwapIndex = params.activeUsers.indexOf(userToSwap.id);\n\t\t\t\tconst userToSwapPage = Math.ceil((userToSwapIndex + 1) / this.usersPerPage);\n\n\t\t\t\tif (userWithoutVideoPage === this.currentPage && userToSwapPage > this.currentPage)\n\t\t\t\t{\n\t\t\t\t\tparams.usersToKeepActive.push(userToSwap.id);\n\t\t\t\t\tparams.usersToForceDeactivation.push(el.id);\n\t\t\t\t\tparams.usersToDeactivate++;\n\t\t\t\t}\n\t\t\t\telse if (userToSwapPage === this.currentPage && userToSwapPage > userWithoutVideoPage)\n\t\t\t\t{\n\t\t\t\t\tparams.usersToKeepActive.push(el.id);\n\t\t\t\t\tparams.usersToForceDeactivation.push(userToSwap.id);\n\t\t\t\t\tparams.usersToDeactivate++;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.applyOrderChanges(params.orderChanges);\n\t}\n\n\tcalculateUserActive(userModel, status, userSkipped, params)\n\t{\n\t\tif (params.usersWithEnabledVideo.includes(userModel.id) && !userSkipped && !params.possibleActiveUsers.includes(userModel.id))\n\t\t{\n\t\t\tparams.currentPageUsers.push(userModel);\n\t\t\tparams.usersToDeactivate--;\n\t\t\tstatus = true;\n\t\t}\n\t\telse if (params.currentPageUsers.length + params.usersToDeactivate > this.usersPerPage)\n\t\t{\n\t\t\tparams.currentPageUsers.pop();\n\t\t\tstatus = false;\n\t\t}\n\n\t\treturn status;\n\t};\n\n\tcompleteDisconnectSwap(rules, params): void\n\t{\n\t\tconst disconnectedUser = rules[RerenderReason.UserDisconnected];\n\t\tif (!disconnectedUser)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst lowerOrderOnCurrentPage = this.userRegistry.get(params.possibleActiveUsers[0])?.order;\n\t\tconst higherOrderOnCurrentPage = this.userRegistry.get(params.possibleActiveUsers[params.possibleActiveUsers.length - 1])?.order;\n\t\tlet disconnectedUserFromCurrentPage = false;\n\n\t\tif (this.currentPage === 1)\n\t\t{\n\t\t\tdisconnectedUserFromCurrentPage = disconnectedUser.order < lowerOrderOnCurrentPage\n\t\t\t\t|| (disconnectedUser.order > lowerOrderOnCurrentPage && disconnectedUser.order < higherOrderOnCurrentPage);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst skipUsers = (this.currentPage - 2) * this.usersPerPage;\n\t\t\tconst activeUsersFromPreviousPage = params.activeUsers.slice(skipUsers, skipUsers + this.usersPerPage);\n\t\t\tconst lastActiveUserFromPreviousPage = this.userRegistry.get(activeUsersFromPreviousPage[activeUsersFromPreviousPage.length - 1]);\n\t\t\tdisconnectedUserFromCurrentPage = (disconnectedUser.order > lowerOrderOnCurrentPage && disconnectedUser.order < higherOrderOnCurrentPage)\n\t\t\t\t|| (disconnectedUser.order < lowerOrderOnCurrentPage && disconnectedUser.order > lastActiveUserFromPreviousPage?.order);\n\t\t}\n\n\t\tconst userToSwap = params.disconnectedUserHadVideo\n\t\t\t? params.usersWithVideo[params.usersWithVideo.length - 1]\n\t\t\t: this.userRegistry.get(params.activeUsers[params.activeUsers.length - 1]);\n\n\t\tif (!userToSwap || userToSwap.order <= disconnectedUser.order)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tparams.orderChanges.push({\n\t\t\ttype: SwapType.Direct,\n\t\t\tto: {\n\t\t\t\tuserModel: userToSwap,\n\t\t\t\torder: disconnectedUser.order,\n\t\t\t},\n\t\t});\n\n\t\tif (\n\t\t\tthis.currentPage !== this.pagesCount\n\t\t\t&& disconnectedUserFromCurrentPage\n\t\t\t&& !params.possibleActiveUsers.includes(userToSwap.id)\n\t\t)\n\t\t{\n\t\t\tparams.usersToKeepActive.push(userToSwap.id);\n\t\t\tparams.usersToDeactivate++;\n\t\t}\n\n\t\tthis.applyOrderChanges(params.orderChanges);\n\t}\n\n\trenderAddUserButtonInList()\n\t{\n\t\tconst showAdd = this.showAddUserButtonInList && this.layout == Layouts.Centered && this.uiState === UiState.Connected && !this.isButtonBlocked(\"add\") && this.getConnectedUserCount() < this.userLimit - 1 && !this.isFullScreen && this.elements.userList.addButton;\n\n\t\tif (showAdd)\n\t\t{\n\t\t\tthis.elements.userList.container.appendChild(this.elements.userList.addButton);\n\t\t\treturn;\n\t\t}\n\n\t\tDom.remove(this.elements.userList.addButton);\n\t};\n\n\trenderUserList(pageChange)\n\t{\n\t\tclearTimeout(this.rerenderTimeout);\n\t\tthis.rerenderTimeout = null;\n\t\tthis.activeUsers = [];\n\t\tthis.inactiveUsers = [];\n\n\t\tconst showLocalUser = this.shouldShowLocalUser();\n\t\tlet userCount = 0;\n\t\tlet skipUsers = 0;\n\t\tlet skippedUsers = 0;\n\t\tlet renderedUsers = 0;\n\n\t\tconst orderingRules = this.getOrderingRules();\n\t\tconst orderingParams = {\n\t\t\tusersWithVideo: [],\n\t\t\tusersWithEnabledVideo: [],\n\t\t\tusersWithDisabledVideo: [],\n\t\t\tpossibleActiveUsers: null,\n\t\t\tusersToKeepActive: [],\n\t\t\tusersToForceDeactivation: [],\n\t\t\tcurrentPageUsers: [],\n\t\t\torderChanges: [],\n\t\t\tincompleteSwaps: [],\n\t\t\tdisconnectedUserHadVideo: false,\n\t\t\tusersToDeactivate: 0,\n\t\t\tvideoDisabledProceed: false,\n\t\t};\n\n\t\tif ((this.layout === Layouts.Grid || this.layout === Layouts.Centered) && this.pagesCount > 1)\n\t\t{\n\t\t\tskipUsers = (this.currentPage - 1) * this.usersPerPage;\n\t\t}\n\n\t\tif (this.layout === Layouts.Grid)\n\t\t{\n\t\t\tthis.processVideoRules(orderingRules, orderingParams);\n\t\t\tthis.processDisconnectRules(orderingRules, orderingParams);\n\t\t\torderingParams.usersWithEnabledVideo = orderingRules[RerenderReason.VideoEnabled].map((el) => el.id);\n\t\t\torderingParams.usersWithDisabledVideo = orderingRules[RerenderReason.VideoDisabled].map((el) => el.id);\n\n\t\t\torderingParams.activeUsers = this.getActiveUsers();\n\t\t\torderingParams.possibleActiveUsers = orderingParams.activeUsers.slice(skipUsers, skipUsers + this.usersPerPage);\n\t\t\torderingParams.usersWithVideo = this.getUsersWithCamera();\n\n\t\t\tthis.completeVideoDisabledSwap(orderingRules, orderingParams);\n\t\t\tthis.completeDisconnectSwap(orderingRules, orderingParams);\n\n\t\t\torderingParams.activeUsers = this.getActiveUsers();\n\t\t\torderingParams.possibleActiveUsers = orderingParams.activeUsers.slice(skipUsers, skipUsers + this.usersPerPage);\n\t\t}\n\t\telse if (this.layout === Layouts.Centered)\n\t\t{\n\t\t\t// new grid logic is applied only in the Layouts.Grid layout\n\t\t\t// so we need to save some rules for later\n\t\t\torderingRules[RerenderReason.VideoEnabled].forEach((user) => this.shelvedRerenderQueue.set(user.id, {\n\t\t\t\tuserId: user.id,\n\t\t\t\treason: RerenderReason.VideoEnabled,\n\t\t\t}));\n\t\t\torderingRules[RerenderReason.VideoDisabled].forEach((user) => this.shelvedRerenderQueue.set(user.id, {\n\t\t\t\tuserId: user.id,\n\t\t\t\treason: RerenderReason.VideoDisabled,\n\t\t\t}));\n\t\t}\n\n\t\tconst userModels: UserModel[] = [...this.userRegistry.users.values()];\n\t\tfor (const userModel: UserModel of userModels)\n\t\t{\n\t\t\tconst userId = userModel.id;\n\t\t\tif (!this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst user: CallUser = this.users[userId];\n\t\t\tconst screenUser: CallUser = this.screenUsers[userId];\n\t\t\tif (userId == this.centralUser.id && (this.layout == Layouts.Centered || this.layout == Layouts.Mobile))\n\t\t\t{\n\t\t\t\tif (this.layout == Layouts.Centered)\n\t\t\t\t{\n\t\t\t\t\tthis.activeUsers.push(userId);\n\t\t\t\t}\n\t\t\t\tthis.unobserveIntersections(user);\n\t\t\t\tif (screenUser.hasVideo())\n\t\t\t\t{\n\t\t\t\t\tscreenUser.mount(this.elements.center);\n\t\t\t\t\tscreenUser.visible = true;\n\t\t\t\t\tuser.mount(this.elements.userList.container);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tuser.visible = true;\n\t\t\t\t\tuser.mount(this.elements.center);\n\t\t\t\t\tscreenUser.dismount();\n\t\t\t\t}\n\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet userActive = this.isUserHasActiveState(userModel);\n\t\t\tlet userSkipped = false;\n\n\t\t\tif (userActive && skipUsers > 0 && skippedUsers < skipUsers)\n\t\t\t{\n\t\t\t\t// skip users on previous pages\n\t\t\t\tskippedUsers++;\n\t\t\t\tuserActive = false;\n\t\t\t\tuserSkipped = true;\n\t\t\t}\n\n\t\t\tif (userActive && this.layout === Layouts.Grid && this.usersPerPage > 0 && renderedUsers < this.usersPerPage)\n\t\t\t{\n\t\t\t\torderingParams.currentPageUsers.push(userModel);\n\t\t\t}\n\n\t\t\tif (this.layout === Layouts.Grid)\n\t\t\t{\n\t\t\t\tif (orderingRules[RerenderReason.VideoEnabled].length > 0)\n\t\t\t\t{\n\t\t\t\t\tif ((userActive || userSkipped) && orderingParams.incompleteSwaps.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst previousIncompleteSwaps = orderingParams.incompleteSwaps.length;\n\t\t\t\t\t\tconst index = orderingParams.incompleteSwaps[0] - 1;\n\t\t\t\t\t\tconst userEnabledVideo = orderingParams.orderChanges[index].from;\n\t\t\t\t\t\tconst currentUserFromCurrentPage = orderingParams.possibleActiveUsers?.includes(userModel.id);\n\t\t\t\t\t\tconst changedUserFromCurrentPage = orderingParams.possibleActiveUsers?.includes(userEnabledVideo.userModel.id);\n\n\t\t\t\t\t\tthis.completeVideoEnableSwap(userModel, orderingRules, orderingParams);\n\t\t\t\t\t\tconst swapCompleted = previousIncompleteSwaps !== orderingParams.incompleteSwaps.length;\n\n\t\t\t\t\t\tif (swapCompleted && userActive && !changedUserFromCurrentPage && !orderingParams.usersToKeepActive.includes(userModel.id))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (swapCompleted && ((!userSkipped && !currentUserFromCurrentPage) || (userSkipped && changedUserFromCurrentPage)))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tuserActive = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (orderingParams.usersToDeactivate)\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = this.calculateUserActive(userModel, userActive, userSkipped, orderingParams);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (orderingParams.usersToForceDeactivation.includes(userModel.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (orderingRules[RerenderReason.VideoDisabled].length > 0)\n\t\t\t\t{\n\t\t\t\t\tif (orderingParams.usersToKeepActive.includes(userModel.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = true;\n\t\t\t\t\t\torderingParams.usersToDeactivate--;\n\t\t\t\t\t}\n\t\t\t\t\telse if (orderingParams.usersToForceDeactivation.includes(userModel.id)\n\t\t\t\t\t\t|| (orderingParams.currentPageUsers.length + orderingParams.usersToDeactivate > this.usersPerPage)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t\torderingParams.currentPageUsers.pop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (orderingRules[RerenderReason.UserDisconnected])\n\t\t\t\t{\n\t\t\t\t\tif (orderingParams.usersToKeepActive.includes(userModel.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = true;\n\t\t\t\t\t\torderingParams.usersToDeactivate--;\n\t\t\t\t\t}\n\t\t\t\t\telse if (orderingParams.currentPageUsers.length + orderingParams.usersToDeactivate > this.usersPerPage)\n\t\t\t\t\t{\n\t\t\t\t\t\tuserActive = false;\n\t\t\t\t\t\torderingParams.currentPageUsers.pop();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (userActive && (this.layout === Layouts.Grid || this.layout === Layouts.Centered) && this.usersPerPage > 0 && renderedUsers >= this.usersPerPage)\n\t\t\t{\n\t\t\t\t// skip users on following pages\n\t\t\t\tuserActive = false;\n\t\t\t}\n\n\t\t\tif (userActive)\n\t\t\t{\n\t\t\t\tthis.activeUsers.push(userId)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.inactiveUsers.push(userId)\n\t\t\t}\n\n\t\t\tif (!userActive)\n\t\t\t{\n\t\t\t\tuser.dismount();\n\t\t\t\tthis.unobserveIntersections(user);\n\t\t\t\tscreenUser.dismount();\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (screenUser.hasVideo())\n\t\t\t{\n\t\t\t\tscreenUser.mount(this.elements.userList.container);\n\t\t\t\tuserCount++;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tscreenUser.dismount();\n\t\t\t}\n\t\t\tuser.mount(this.elements.userList.container);\n\t\t\tif (!this.isPreparing)\n\t\t\t{\n\t\t\t\tthis.observeIntersections(user);\n\t\t\t}\n\t\t\trenderedUsers++;\n\t\t\tuserCount++;\n\t\t}\n\n\t\tthis.applyOrderChanges(orderingParams.orderChanges);\n\n\t\tif (showLocalUser)\n\t\t{\n\t\t\tif (this.layout == Layouts.Centered && this.userId == this.centralUser.id || this.layout == Layouts.Mobile)\n\t\t\t{\n\t\t\t\t// this.unobserveIntersections(this.localUser);\n\t\t\t\tthis.localUser.mount(this.elements.center, true);\n\t\t\t\tthis.localUser.visible = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// using force true to always move self to the end of the list\n\t\t\t\tthis.localUser.mount(this.elements.userList.container);\n\t\t\t\tif (this.layout == Layouts.Centered && this.intersectionObserver)\n\t\t\t\t{\n\t\t\t\t\t// this.observeIntersections(this.localUser);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.visible = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tuserCount++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localUser.dismount();\n\t\t\t// this.unobserveIntersections(this.localUser);\n\t\t}\n\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.updateGridUserSize(userCount);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.userList.container.classList.add(\"bx-messenger-videocall-user-list-small\");\n\t\t\tthis.elements.userList.container.style.removeProperty('--avatar-size');\n\t\t\tthis.elements.userList.container.style.removeProperty('--avatar-text-size');\n\t\t\tthis.updateCentralUserAvatarSize();\n\t\t}\n\t\tthis.applyIncomingVideoConstraints();\n\n\t\tthis.renderAddUserButtonInList();\n\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-user-list-empty\", (this.elements.userList.container.childElementCount === 0));\n\t\tthis.localUser.updatePanelDeferred();\n\n\t\tconst currentActiveUsers = this.currentPiPUserId ? [...this.activeUsers, this.currentPiPUserId] : this.activeUsers;\n\t\tconst currentInactiveUsers = [...this.inactiveUsers];\n\t\tconst currentPiPUserIndexInInactiveUsers = this.currentPiPUserId ? currentInactiveUsers.indexOf(this.currentPiPUserId) : -1;\n\n\t\tif (currentPiPUserIndexInInactiveUsers !== -1)\n\t\t{\n\t\t\tcurrentInactiveUsers.splice(currentPiPUserIndexInInactiveUsers, 1);\n\t\t}\n\t\t\n\t\tconst activeUsers = currentActiveUsers.map((userId) => {\n\t\t\treturn { userId };\n\t\t});\n\n\t\tthis.toggleSubscribingVideoInRenderUserList(activeUsers, true)\n\t\tconst inactiveUsers = currentInactiveUsers.map((userId) => {\n\t\t\treturn { userId };\n\t\t});\n\t\tthis.toggleSubscribingVideoInRenderUserList(inactiveUsers, false)\n\t};\n\n\tshouldShowLocalUser()\n\t{\n\t\treturn (\n\t\t\tthis.localUser.userModel.state != UserState.Idle\n\t\t\t&& this.localUser.userModel.direction != EndpointDirection.RecvOnly\n\t\t);\n\t};\n\n\tupdateGridUserSize(userCount)\n\t{\n\t\tconst containerSize = this.elements.userList.container.getBoundingClientRect();\n\t\tthis.userSize = Util.findBestElementSize(\n\t\t\tcontainerSize.width,\n\t\t\tcontainerSize.height,\n\t\t\tuserCount,\n\t\t\tMIN_GRID_USER_WIDTH,\n\t\t\tMIN_GRID_USER_HEIGHT\n\t\t);\n\n\t\t//Change the size to make it possible to make indents between users\n\t\tlet rows = Math.floor(containerSize.height / MIN_GRID_USER_HEIGHT) || 1;\n\t\tthis.userSize.width -= 5 * rows;\n\t\tthis.userSize.height -= 2.75 * rows;\n\t\tconst avatarSize = Math.round(this.userSize.height * 0.45);\n\t\tconst avatarTextSize = Math.round(avatarSize * 0.45);\n\t\tthis.elements.userList.container.style.setProperty('--grid-user-width', this.userSize.width + 'px');\n\t\tthis.elements.userList.container.style.setProperty('--grid-user-height', this.userSize.height + 'px');\n\t\tthis.elements.userList.container.style.setProperty('--avatar-size', avatarSize + 'px');\n\t\tthis.elements.userList.container.style.setProperty('--avatar-text-size', avatarTextSize + 'px');\n\t\tif (this.userSize.width < 220)\n\t\t{\n\t\t\tthis.elements.userList.container.classList.add(\"bx-messenger-videocall-user-list-small\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.userList.container.classList.remove(\"bx-messenger-videocall-user-list-small\");\n\t\t}\n\t};\n\n\tupdateCentralUserAvatarSize()\n\t{\n\t\tlet containerSize;\n\t\tlet avatarSize;\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tcontainerSize = this.elements.root.getBoundingClientRect();\n\t\t\tavatarSize = Math.round(containerSize.width * 0.55);\n\t\t}\n\t\telse if (this.layout == Layouts.Centered)\n\t\t{\n\t\t\tcontainerSize = this.elements.center.getBoundingClientRect();\n\t\t\tavatarSize = Math.min(Math.round(containerSize.height * 0.45), Math.round(containerSize.width * 0.45));\n\t\t\tthis.centralUser.setIncomingVideoConstraints(Math.floor(containerSize.width), Math.floor(containerSize.height));\n\t\t}\n\t\tconst avatarTextSize = Math.round(avatarSize * 0.45);\n\t\tthis.elements.center.style.setProperty('--avatar-size', avatarSize + 'px');\n\t\tthis.elements.center.style.setProperty('--avatar-text-size', avatarTextSize + 'px');\n\t};\n\n\trenderButtons(buttons, rerender): HTMLElement\n\t{\n\t\tlet panelInner, left, center, right;\n\n\t\tif (rerender)\n\t\t{\n\t\t\tpanelInner = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-inner' },\n\t\t\t});\n\t\t}\n\n\t\tif (this.layout === Layouts.Mobile || this.size === Size.Folded)\n\t\t{\n\t\t\tleft = panelInner;\n\t\t\tcenter = panelInner;\n\t\t\tright = panelInner;\n\t\t}\n\t\telse if (rerender)\n\t\t{\n\t\t\tleft = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-inner-left' },\n\t\t\t});\n\t\t\tcenter = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-inner-center' },\n\t\t\t});\n\t\t\tright = Dom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-inner-right' },\n\t\t\t});\n\t\t\tDom.append(left, panelInner);\n\t\t\tDom.append(center, panelInner);\n\t\t\tDom.append(right, panelInner);\n\t\t}\n\n\t\tfor (let i = 0; i < buttons.length; i++)\n\t\t{\n\t\t\tswitch (buttons[i])\n\t\t\t{\n\t\t\t\tcase 'title':\n\t\t\t\t\tif (this.buttons.title)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.title.update({\n\t\t\t\t\t\t\ttext: this.title,\n\t\t\t\t\t\t\tisGroupCall: Object.keys(this.users).length > 1,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.title = new Buttons.TitleButton({\n\t\t\t\t\t\t\ttext: this.title,\n\t\t\t\t\t\t\tisGroupCall: Object.keys(this.users).length > 1,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.title.render(), left);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t/*case \"grid\":\n\t\t\t\t\tthis.buttons.grid = new SimpleButton({\n\t\t\t\t\t\tclass: \"grid\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_GRID\"),\n\t\t\t\t\t\tonClick: this._onGridButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tpanelInner.appendChild(this.buttons.grid.render());\n\t\t\t\t\tbreak;*/\n\t\t\t\t/*case \"add\":\n\t\t\t\t\tthis.buttons.add = new SimpleButton({\n\t\t\t\t\t\tclass: \"add\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_ADD\"),\n\t\t\t\t\t\tonClick: this._onAddButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\tleftSubPanel.appendChild(this.buttons.add.render());\n\t\t\t\t\tbreak;*/\n\t\t\t\tcase 'share':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.share = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'share',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_LINK'),\n\t\t\t\t\t\t\tonClick: this._onShareButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tDom.append(this.buttons.share.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'microphone':\n\t\t\t\t\tif (this.buttons.microphone)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.microphone.setBlocked(this.isButtonBlocked('microphone'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.microphone = new Buttons.DeviceButton({\n\t\t\t\t\t\t\tclass: 'microphone',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_MIC'),\n\t\t\t\t\t\t\tenabled: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t\tarrowHidden: this.layout === Layouts.Mobile,\n\t\t\t\t\t\t\tarrowEnabled: this.isMediaSelectionAllowed(),\n\t\t\t\t\t\t\tshowPointer: true, //todo\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('microphone'),\n\t\t\t\t\t\t\tshowLevel: true,\n\t\t\t\t\t\t\tsideIcon: this.getMicrophoneSideIcon(this.roomState),\n\t\t\t\t\t\t\tonClick: this._onMicrophoneButtonClick.bind(this),\n\t\t\t\t\t\t\tonArrowClick: this._onMicrophoneArrowClick.bind(this),\n\t\t\t\t\t\t\tonSideIconClick: this._onMicrophoneSideIconClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => Hardware.isMicrophoneMuted ? `${BX.message('IM_SPACE_HOTKEY')}\\\\A${' '}${this.keyModifierForCss} + A${' '}` : `${this.keyModifierForCss} + A`,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.microphone.render(), left);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'camera':\n\t\t\t\t\tif (this.buttons.camera)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.camera.setBlocked(this.isButtonBlocked('camera'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.camera = new Buttons.DeviceButton({\n\t\t\t\t\t\t\tclass: 'camera',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_CAMERA'),\n\t\t\t\t\t\t\tenabled: Hardware.isCameraOn,\n\t\t\t\t\t\t\tarrowHidden: this.layout === Layouts.Mobile,\n\t\t\t\t\t\t\tarrowEnabled: this.isMediaSelectionAllowed(),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('camera'),\n\t\t\t\t\t\t\tonClick: this._onCameraButtonClick.bind(this),\n\t\t\t\t\t\t\tonArrowClick: this._onCameraArrowClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + V`,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.camera.render(), left);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'screen':\n\t\t\t\t\tif (this.buttons.screen)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.screen.setBlocked(this.isButtonBlocked('screen'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.screen = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'screen',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-screen',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_SCREEN'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('screen'),\n\t\t\t\t\t\t\tonClick: this._onScreenButtonClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + S`,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.screen.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'record':\n\t\t\t\t\tif (this.buttons.record)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.record.setBlocked(this.isButtonBlocked('record'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.record = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'record',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-record',\n\t\t\t\t\t\t\ttext: Loc.getMessage('IM_M_CALL_BTN_RECORD'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('record'),\n\t\t\t\t\t\t\tonClick: this.#onCommonRecordClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + R`,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.record.render(), center);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'document':\n\t\t\t\t\tif (this.buttons.document)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.document.setBlocked(this.isButtonBlocked('document'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.document = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'document',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-document',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_DOCUMENT'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('document'),\n\t\t\t\t\t\t\tonClick: this._onDocumentButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.document.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'copilot':\n\t\t\t\t\tif (this.buttons.copilot)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.copilot.setBlocked(this.isButtonBlocked('copilot'));\n\t\t\t\t\t\tthis.buttons.copilot.setActive(this.isCopilotActive);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.copilot = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'copilot',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-copilot',\n\t\t\t\t\t\t\ttext: BX.message('CALL_BUTTON_COPILOT_TITLE'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('copilot'),\n\t\t\t\t\t\t\tonClick: this._onCopilotButtonClick.bind(this),\n\t\t\t\t\t\t\tisComingSoon: !this.isCopilotFeaturesEnabled,\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => this.isCopilotActive\n\t\t\t\t\t\t\t\t\t\t? Loc.getMessage('CALL_COPILOT_BUTTON_ON_HINT_V2')\n\t\t\t\t\t\t\t\t\t\t: Loc.getMessage('CALL_COPILOT_BUTTON_OFF_HINT'),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.copilot.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'returnToCall':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.returnToCall = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'returnToCall',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_RETURN_TO_CALL'),\n\t\t\t\t\t\t\tonClick: this._onBodyClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tDom.append(this.buttons.returnToCall.render(), right);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'hangup':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.hangup = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'hangup',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-icon-background-hangup',\n\t\t\t\t\t\t\ttext: Object.keys(this.users).length > 1 ? BX.message('IM_M_CALL_BTN_DISCONNECT') : BX.message('IM_M_CALL_BTN_HANGUP'),\n\t\t\t\t\t\t\tonClick: this._onHangupButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tDom.append(this.buttons.hangup.render(), right);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'hangupOptions':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.hangupOptions = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'hangup-options',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-icon-background-hangup-options',\n\t\t\t\t\t\t\tonClick: this._onHangupOptionsButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tDom.append(this.buttons.hangupOptions.render(), right);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'close':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.close = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'close',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-icon-background-hangup',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_CLOSE'),\n\t\t\t\t\t\t\tonClick: this._onCloseButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t\tDom.append(this.buttons.close.render(), right);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'speaker':\n\t\t\t\t\t/*this.buttons.speaker = new Buttons.DeviceButton({\n\t\t\t\t\t\tclass: \"speaker\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_SPEAKER\"),\n\t\t\t\t\t\tenabled: !this.speakerMuted,\n\t\t\t\t\t\tarrowEnabled: Hardware.canSelectSpeaker() && this.isMediaSelectionAllowed(),\n\t\t\t\t\t\tonClick: this._onSpeakerButtonClick.bind(this),\n\t\t\t\t\t\tonArrowClick: this._onSpeakerArrowClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\trightSubPanel.appendChild(this.buttons.speaker.render());*/\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'mobileMenu':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.buttons.mobileMenu)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buttons.mobileMenu = new Buttons.SimpleButton({\n\t\t\t\t\t\t\t\tclass: 'sandwich',\n\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_MENU'),\n\t\t\t\t\t\t\t\tonClick: this._onMobileMenuButtonClick.bind(this),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tDom.append(this.buttons.mobileMenu.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'chat':\n\t\t\t\t\tif (this.buttons.chat)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.chat.setBlocked(this.isButtonBlocked('chat'));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.chat = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'chat',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-chat',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_CHAT'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('chat'),\n\t\t\t\t\t\t\tonClick: this._onChatButtonClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + C`,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.chat.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'floorRequest':\n\t\t\t\t\tif (!this.buttons.floorRequest)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.floorRequest = new Buttons.SimpleButton({\n\t\t\t\t\t\t\tclass: 'floor-request',\n\t\t\t\t\t\t\tbackgroundClass: 'bx-messenger-videocall-panel-background-floor-request',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_WANT_TO_SAY'),\n\t\t\t\t\t\t\tblocked: this.isButtonBlocked('floorRequest'),\n\t\t\t\t\t\t\tonClick: this._onFloorRequestButtonClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + H`,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.floorRequest.setBlocked(this.isButtonBlocked('floorRequest'));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.floorRequest.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'more':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.buttons.more)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buttons.more = new Buttons.SimpleButton({\n\t\t\t\t\t\t\t\tclass: 'more',\n\t\t\t\t\t\t\t\tonClick: this._onMoreButtonClick.bind(this),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\tDom.append(this.buttons.more.render(), center);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'spacer':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tpanelInner.appendChild(Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-panel-spacer' },\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t/*case \"history\":\n\t\t\t\t\tthis.buttons.history = new Buttons.SimpleButton({\n\t\t\t\t\t\tclass: \"history\",\n\t\t\t\t\t\ttext: BX.message(\"IM_M_CALL_BTN_HISTORY\"),\n\t\t\t\t\t\tonClick: this._onHistoryButtonClick.bind(this)\n\t\t\t\t\t});\n\t\t\t\t\trightSubPanel.appendChild(this.buttons.history.render());\n\t\t\t\t\tbreak;*/\n\t\t\t}\n\t\t}\n\n\t\treturn panelInner;\n\t}\n\n\trenderTopButtons(buttons, rerender): void\n\t{\n\t\tfor (let i = 0; i < buttons.length; i++)\n\t\t{\n\t\t\tswitch (buttons[i])\n\t\t\t{\n\t\t\t\tcase 'watermark':\n\t\t\t\t\tif (!this.buttons.waterMark)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.waterMark = new Buttons.WaterMarkButton({\n\t\t\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.waterMark.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'protected':\n\t\t\t\t\tif (!this.buttons.protected)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.protected = new Buttons.TopFramelessButton({\n\t\t\t\t\t\t\ticonClass: 'protected',\n\t\t\t\t\t\t\ttextClass: 'protected',\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_PROTECTED').toLowerCase(),\n\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\twidth: '384px',\n\t\t\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t\t\t\tgetText: () => BX.message('IM_M_CALL_PROTECTED_HINT'),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.protected.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'recordStatus':\n\t\t\t\t\tif (this.buttons.recordStatus)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.recordStatus.updateView();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.recordStatus = new Buttons.RecordStatusButton({\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\tcommonRecordState: this.commonRecordState,\n\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t\t\t\tgetText: () => {\n\t\t\t\t\t\t\t\t\tconst userData = this.userData[this.commonRecordState.userId];\n\n\t\t\t\t\t\t\t\t\tif (!userData)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tconst recordingUserName = Text.encode(userData.name);\n\t\t\t\t\t\t\t\t\tconst gender = userData.gender || 'M';\n\n\t\t\t\t\t\t\t\t\treturn Loc.getMessage(`CALL_COMMON_RECORD_INITIATOR_HINT_${gender}`).replace('#USER_NAME#', recordingUserName);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.recordStatus.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'grid':\n\t\t\t\t\tif (this.buttons.grid)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.grid.update({\n\t\t\t\t\t\t\ticonClass: this.layout === Layouts.Grid ? 'speaker' : 'grid',\n\t\t\t\t\t\t\ttext: this.layout === Layouts.Grid ? BX.message('IM_M_CALL_SPEAKER_MODE') : BX.message('IM_M_CALL_GRID_MODE_MSGVER_1'),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.grid = new Buttons.TopButton({\n\t\t\t\t\t\t\ticonClass: this.layout === Layouts.Grid ? 'speaker' : 'grid',\n\t\t\t\t\t\t\ttext: this.layout === Layouts.Grid ? BX.message('IM_M_CALL_SPEAKER_MODE') : BX.message('IM_M_CALL_GRID_MODE_MSGVER_1'),\n\t\t\t\t\t\t\tonClick: this._onGridButtonClick.bind(this),\n\t\t\t\t\t\t\t...(Util.isDesktop() ? {\n\t\t\t\t\t\t\t\ttooltip: {\n\t\t\t\t\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\t\t\t\t\tgetText: () => `${this.keyModifierForCss} + W`\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} : {}),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.grid.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'fullscreen':\n\t\t\t\t\tif (this.buttons.fullscreen)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.fullscreen.update({\n\t\t\t\t\t\t\ticonClass: this.isFullScreen ? 'fullscreen-leave' : 'fullscreen-enter',\n\t\t\t\t\t\t\ttext: this.isFullScreen ? BX.message('IM_M_CALL_WINDOW_MODE') : BX.message('IM_M_CALL_FULLSCREEN_MODE'),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.fullscreen = new Buttons.TopButton({\n\t\t\t\t\t\t\ticonClass: this.isFullScreen ? 'fullscreen-leave' : 'fullscreen-enter',\n\t\t\t\t\t\t\ttext: this.isFullScreen ? BX.message('IM_M_CALL_WINDOW_MODE') : BX.message('IM_M_CALL_FULLSCREEN_MODE'),\n\t\t\t\t\t\t\tonClick: this._onFullScreenButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.fullscreen.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'feedback':\n\t\t\t\t\tif (!this.buttons.feedback)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.feedback = new Buttons.TopButton({\n\t\t\t\t\t\t\ticonClass: 'feedback',\n\t\t\t\t\t\t\ttext: BX.message('IM_OL_COMMENT_HEAD_BUTTON_VOTE'),\n\t\t\t\t\t\t\tonClick: this._onFeedbackButtonClick.bind(this)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.feedback.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'callcontrol':\n\t\t\t\t\tif (!this.buttons.callcontrol)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.callcontrol = new Buttons.TopButton({\n\t\t\t\t\t\t\ticonClass: 'callcontrol',\n\t\t\t\t\t\t\ttext: BX.message('CALL_CALLCONTROL_BUTTON_LABEL'),\n\t\t\t\t\t\t\tonClick: this._onCallcontrolButtonClick.bind(this)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.callcontrol.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'participants':\n\t\t\t\t\tlet foldButtonState = Buttons.ParticipantsButton.FoldButtonState.Hidden;\n\n\t\t\t\t\tif (this.isFullScreen && this.layout === Layouts.Centered)\n\t\t\t\t\t{\n\t\t\t\t\t\tfoldButtonState = this.isUserBlockFolded\n\t\t\t\t\t\t\t? Buttons.ParticipantsButton.FoldButtonState.Unfold\n\t\t\t\t\t\t\t: Buttons.ParticipantsButton.FoldButtonState.Fold;\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.showUsersButton)\n\t\t\t\t\t{\n\t\t\t\t\t\tfoldButtonState = Buttons.ParticipantsButton.FoldButtonState.Active;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.buttons.participants)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.participants.update({\n\t\t\t\t\t\t\tfoldButtonState,\n\t\t\t\t\t\t\tallowAdding: !this.isButtonBlocked('add'),\n\t\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.participants = new Buttons.ParticipantsButton({\n\t\t\t\t\t\t\tfoldButtonState,\n\t\t\t\t\t\t\tallowAdding: !this.isButtonBlocked('add'),\n\t\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\t\tonListClick: this._onParticipantsButtonListClick.bind(this),\n\t\t\t\t\t\t\tonAddClick: this._onAddButtonClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.participants.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'participantsMobile':\n\t\t\t\t\tif (!this.buttons.participantsMobile)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buttons.participantsMobile = new Buttons.ParticipantsButtonMobile({\n\t\t\t\t\t\t\tcount: this.getConnectedUserCount(true),\n\t\t\t\t\t\t\tonClick: this._onParticipantsButtonMobileListClick.bind(this),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.buttons.participantsMobile.render(), this.elements.topPanel);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'separator':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.elements.topPanel.appendChild(Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-top-separator' },\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'spacer':\n\t\t\t\t\tif (rerender)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.elements.topPanel.appendChild(Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-top-panel-spacer' },\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateCopilotState(isActive)\n\t{\n\t\tthis.isCopilotActive = isActive;\n\n\t\tthis.setButtonActive('copilot', this.isCopilotActive);\n\n\t\tif (this.elements.wrap)\n\t\t{\n\t\t\tthis.elements.wrap.classList[this.isCopilotActive ? 'add' : 'remove']('bx-messenger-videocall-wrap-with-copilot')\n\t\t}\n\t}\n\n\tupdateCopilotFeatureState(isEnabled)\n\t{\n\t\tthis.isCopilotFeaturesEnabled = isEnabled;\n\n\t\tif (!this.buttons.copilot)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttons.copilot.setIsComingSoon(!this.isCopilotFeaturesEnabled);\n\t}\n\n\tshowCopilotNotify(callId = 0, errorCode = '')\n\t{\n\t\tconst notifyType = errorCode\n\t\t\t? null\n\t\t\t: CopilotNotifyType[this.isCopilotActive ? 'COPILOT_ENABLED' : 'COPILOT_DISABLED'];\n\n\t\tif (notifyType)\n\t\t{\n\t\t\tthis.#openCopilotNotify(notifyType, callId);\n\t\t}\n\t}\n\n\tcloseCopilotNotify()\n\t{\n\t\tif (this.copilotNotify)\n\t\t{\n\t\t\tthis.copilotNotify.close();\n\t\t\tthis.copilotNotify = null;\n\t\t}\n\t}\n\n\tshowCopilotResultNotify()\n\t{\n\t\tthis.#openCopilotNotify(CopilotNotifyType.COPILOT_RESULT);\n\t}\n\n\tshowCopilotErrorNotify(errorType)\n\t{\n\t\tconst notifyType = CopilotNotifyType[errorType];\n\t\tthis.#openCopilotNotify(notifyType);\n\t}\n\n\tcreateCopilotNotify(notifyType, callId)\n\t{\n\t\tif (!this.buttons.copilot)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn new CopilotNotify({\n\t\t\ttype: notifyType,\n\t\t\tbindElement: this.buttons.copilot.elements.root,\n\t\t\tonClose: () => {\n\t\t\t\tthis.copilotNotify = null;\n\t\t\t},\n\t\t\tcallId,\n\t\t});\n\t}\n\n\t#openCopilotNotify(notifyType, callId = 0)\n\t{\n\t\tthis.closeCopilotNotify();\n\n\t\tthis.copilotNotify = this.createCopilotNotify(notifyType, callId);\n\n\t\tif (this.copilotNotify)\n\t\t{\n\t\t\tthis.copilotNotify.show();\n\t\t}\n\t}\n\n\tcreateAhaMomentNotifyCallcontrol()\n\t{\n\t\tif (!this.buttons.callcontrol)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.ahaMomentNotifyCallcontrol)\n\t\t{\n\t\t\tthis.ahaMomentNotifyCallcontrol.show();\n\t\t\treturn this.ahaMomentNotifyCallcontrol;\n\t\t}\n\n\t\tthis.ahaMomentNotifyCallcontrol = new AhaMomentNotify({\n\t\t\tnotifyTitle: BX.message(\"CALL_CALLCONTROL_AXA_MOMENT_TITLE\"),\n\t\t\tnotifyText: BX.message(\"CALL_CALLCONTROL_AXA_MOMENT_TEXT\"),\n\t\t\tbindElement: this.buttons.callcontrol.elements.root,\n\t\t\tpromoId: CALLCONTROL_PROMO_ID,\n\t\t\tonClose: () => {\n\t\t\t\tthis.needToShowCallcontrolPromo = false;\n\t\t\t\tthis.ahaMomentNotifyCallcontrol = null;\n\t\t\t}\n\t\t});\n\n\t\tthis.ahaMomentNotifyCallcontrol.show();\n\n\t\treturn this.ahaMomentNotifyCallcontrol;\n\t}\n\n\tcalculateUnusedPanelSpace(buttonList)\n\t{\n\t\tif (!buttonList)\n\t\t{\n\t\t\tbuttonList = this.getButtonList();\n\t\t}\n\n\t\tlet totalButtonWidth = 0;\n\t\tfor (let i = 0; i < buttonList.length; i++)\n\t\t{\n\t\t\tconst button = this.buttons[buttonList[i]];\n\t\t\tif (!button)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst buttonWidth = button.elements.root ? button.elements.root.getBoundingClientRect().width : 0;\n\t\t\ttotalButtonWidth += buttonWidth;\n\t\t}\n\n\t\treturn this.elements.panel.scrollWidth - totalButtonWidth - 32;\n\t};\n\n\n\tsetWindowFocusState(isActive)\n\t{\n\t\tif (isActive === this.isWindowFocus)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isWindowFocus = isActive;\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t}\n\t}\n\n\tgetPictureInPictureCallWindowGetButtonsList()\n\t{\n\t\tconst buttonsList = [\"microphone\", \"camera\"];\n\n\t\tif (this.getButtonActive('screen'))\n\t\t{\n\t\t\tbuttonsList.push(\"stop-screen\");\n\t\t}\n\n\t\tconst isViewHidden = this.viewVisibility.getCurrentVisibility() === DocumentVisibilityState.hidden;\n\n\t\tif (this.size === View.Size.Folded || isViewHidden)\n\t\t{\n\t\t\tbuttonsList.push(\"returnToCall\");\n\t\t}\n\n\t\t// if (this.getButtonList().includes('copilot'))\n\t\t// {\n\t\t// \tbuttonsList.push(\"copilot\");\n\t\t// }\n\n\t\treturn buttonsList;\n\t}\n\n\tgetPictureInPictureCallWindowUser()\n\t{\n\t\tconst currentUserId = this.presenterId || this.centralUser?.userModel.id || this.userId;\n\t\tconst isLocalUser = +this.userId === +currentUserId;\n\t\tconst currentUser = isLocalUser ? this.localUser : this.users[currentUserId];\n\n\t\tconst isCurrentPiPUser = !!this.currentPiPUserId && currentUserId === this.currentPiPUserId;\n\n\t\tif (isCurrentPiPUser)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.activeUsers.includes(currentUserId) && !isLocalUser)\n\t\t{\n\t\t\tthis.toggleSubscribingVideoInRenderUserList([{ userId: currentUserId }], true);\n\t\t}\n\n\t\tif (this.currentPiPUserId && +this.userId !== +this.currentPiPUserId && !this.activeUsers.includes(this.currentPiPUserId))\n\t\t{\n\t\t\tthis.toggleSubscribingVideoInRenderUserList([{ userId: this.currentPiPUserId }], false);\n\t\t}\n\n\t\tthis.currentPiPUserId = currentUserId;\n\n\t\tconst modifiedCurrentUser =  {\n\t\t\tuserModel: this.userRegistry.get(currentUserId),\n\t\t\tavatarBackground: currentUser.avatarBackground,\n\t\t\tvideoRenderer: currentUser.videoRenderer,\n\t\t\tpreviewRenderer: currentUser.previewRenderer,\n\t\t};\n\n\t\tif (currentUser.videoTrack)\n\t\t{\n\t\t\tmodifiedCurrentUser.videoRenderer = new MediaRenderer({\n\t\t\t\tkind: 'video',\n\t\t\t\ttrack: currentUser.videoTrack,\n\t\t\t});\n\t\t}\n\n\t\tif (!isLocalUser && this.screenUsers[currentUserId]?.videoTrack)\n\t\t{\n\t\t\tmodifiedCurrentUser.previewRenderer = new MediaRenderer({\n\t\t\t\tkind: 'sharing',\n\t\t\t\ttrack: this.screenUsers[currentUserId].videoTrack,\n\t\t\t});\n\t\t}\n\n\t\tif (isLocalUser && this.localStreamVideoTrack)\n\t\t{\n\t\t\tmodifiedCurrentUser.previewRenderer = new MediaRenderer({\n\t\t\t\tkind: 'sharing',\n\t\t\t\ttrack: this.localStreamVideoTrack,\n\t\t\t});\n\t\t}\n\n\t\treturn modifiedCurrentUser;\n\t}\n\n\tgetBlockedButtonsListPictureInPictureCallWindow()\n\t{\n\t\tconst blockedButtons = [];\n\n\t\tif (this.isButtonBlocked('camera'))\n\t\t{\n\t\t\tblockedButtons.push('camera');\n\t\t}\n\n\t\tif (this.isButtonBlocked('microphone'))\n\t\t{\n\t\t\tblockedButtons.push('microphone');\n\t\t}\n\n\t\tif (this.isButtonBlocked('screen'))\n\t\t{\n\t\t\tblockedButtons.push('screen');\n\t\t}\n\n\t\treturn blockedButtons;\n\t}\n\n\n\t_onPiPClose() : void\n\t{\n\t\tthis.eventEmitter.emit(EventName.onPiPClose);\n\t}\n\n\ttoggleStatePictureInPictureCallWindow(isActive)\n\t{\n\t\tconst isPiPAvailable = PictureInPictureWindow.isAvailable;\n\t\tif (isActive && !this.pictureInPictureCallWindow && isPiPAvailable && Util.isPictureInPictureFeatureEnabled())\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow = new PictureInPictureWindow({\n\t\t\t\tcurrentUser: this.getPictureInPictureCallWindowUser(),\n\t\t\t\tisCopilotFeaturesEnabled: this.isCopilotFeaturesEnabled,\n\t\t\t\tbuttons: this.getPictureInPictureCallWindowGetButtonsList(),\n\t\t\t\tblockedButtons: this.getBlockedButtonsListPictureInPictureCallWindow(),\n\t\t\t\tallowPinButton: false,\n\t\t\t\tallowBackgroundItem: BackgroundDialog.isAvailable() && this.isIntranetOrExtranet,\n\t\t\t\tallowMaskItem: BackgroundDialog.isMaskAvailable() && this.isIntranetOrExtranet,\n\t\t\t\tpreferInitialWindowPlacement: this.preferInitialWindowPlacementPictureInPicture,\n\t\t\t\tfloorRequestNotifications: this.floorRequestNotifications,\n\t\t\t\tonClose: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.pictureInPictureCallWindow = null;\n\t\t\t\t\tthis.currentPiPUserId = null;\n\t\t\t\t\tthis._onPiPClose();\n\t\t\t\t},\n\t\t\t\tonButtonClick: ({ buttonName, event }) =>\n\t\t\t\t{\n\t\t\t\t\tswitch (buttonName)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase \"microphone\":\n\t\t\t\t\t\t\tthis._onMicrophoneButtonClick(event);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"camera\":\n\t\t\t\t\t\t\tthis._onCameraButtonClick(event);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"returnToCall\":\n\t\t\t\t\t\t\tthis.eventEmitter.emit(EventName.onPiPBodyClick);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"stop-screen\":\n\t\t\t\t\t\t\tthis._onScreenButtonClick(event);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.pictureInPictureCallWindow.checkAvailableAndCreate()\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.preferInitialWindowPlacementPictureInPicture = false;\n\t\t\t\t});\n\t\t}\n\n\t\tif (!isActive && this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.enableAutoPip = false;\n\t\t\tthis.pictureInPictureCallWindow.close();\n\t\t}\n\t}\n\n\tsetButtonActive(buttonName, isActive)\n\t{\n\t\tif (!this.buttons[buttonName])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttons[buttonName].setActive(isActive);\n\n\t\tif (this.pictureInPictureCallWindow)\n\t\t{\n\t\t\tthis.pictureInPictureCallWindow.setButtons(this.getPictureInPictureCallWindowGetButtonsList()).updateButtons();\n\t\t}\n\n\t};\n\n\tgetButtonActive(buttonName)\n\t{\n\t\tif (!this.buttons || !this.buttons[buttonName])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.buttons[buttonName].isActive;\n\t};\n\n\tsetButtonCounter(buttonName, counter)\n\t{\n\t\tif (!this.buttons[buttonName])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.buttons[buttonName].setCounter(counter);\n\t};\n\n\tupdateUserList(useShelvedRerenderQueue)\n\t{\n\t\tif (this.layout == Layouts.Mobile)\n\t\t{\n\t\t\tif (this.localUser != this.centralUser)\n\t\t\t{\n\t\t\t\tif (this.localUser.hasVideo())\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.mount(this.elements.localUserMobile);\n\t\t\t\t\tthis.localUser.visible = true;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.localUser.dismount();\n\t\t\t\t}\n\n\t\t\t\tthis.centralUser.mount(this.elements.center);\n\t\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\t\tuserId: this.centralUser.id,\n\t\t\t\t});\n\t\t\t\tthis.centralUser.visible = true;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\t/* if (this.layout == Layouts.Grid && this.size == Size.Full)\n\t\t{\n\t\t\tthis.recalculatePages();\n\t\t} */\n\n\t\tif ((this.layout == Layouts.Grid || this.layout == Layouts.Centered) && this.size == Size.Full)\n\t\t{\n\t\t\tthis.recalculatePages();\n\t\t}\n\n\t\tif (useShelvedRerenderQueue)\n\t\t{\n\t\t\tthis.shelvedRerenderQueue.forEach((el) =>\n\t\t\t{\n\t\t\t\tif (el.reason === RerenderReason.VideoEnabled)\n\t\t\t\t{\n\t\t\t\t\tthis.updateRerenderQueue(el.userId, el.reason);\n\t\t\t\t}\n\t\t\t\telse if (el.reason === RerenderReason.VideoDisabled)\n\t\t\t\t{\n\t\t\t\t\tthis.updateRerenderQueue(el.userId, el.reason);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.shelvedRerenderQueue.clear();\n\t\t}\n\n\t\tthis.renderUserList();\n\n\t\tif (this.layout == Layouts.Centered)\n\t\t{\n\t\t\tif (!this.elements.userList.container.parentElement)\n\t\t\t{\n\t\t\t\tthis.elements.userBlock.appendChild(this.elements.userList.container);\n\t\t\t}\n\t\t\t//this.centralUser.setFullSize(this.elements.userList.container.childElementCount === 0);\n\n\t\t}\n\t\telse if (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tif (!this.elements.userList.container.parentElement)\n\t\t\t{\n\t\t\t\tthis.elements.container.appendChild(this.elements.userList.container);\n\t\t\t}\n\t\t}\n\t\tthis.toggleEars();\n\t};\n\n\tshowOverflownButtonsPopup()\n\t{\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tconst bindElement = this.buttons.more && this.buttons.more.elements.root ? this.buttons.more.elements.root : this.elements.panel;\n\n\t\tthis.overflownButtonsPopup = new Popup({\n\t\t\tid: 'bx-call-buttons-popup',\n\t\t\tbindElement: bindElement,\n\t\t\ttargetContainer: this.container,\n\t\t\tcontent: this.renderButtons(Object.keys(this.overflownButtons), true),\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: false,\n\t\t\tautoHide: true,\n\t\t\toverlay: {backgroundColor: 'white', opacity: 0},\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'top'\n\t\t\t},\n\t\t\tangle: {position: 'bottom', offset: 49},\n\t\t\tclassName: 'bx-call-buttons-popup',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.overflownButtonsPopup = null;\n\t\t\t\t\tthis.buttons.more.setActive(false);\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\t\tthis.overflownButtonsPopup.show();\n\t}\n\n\tresumeVideo()\n\t{\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tconst user = this.users[userId];\n\t\t\tuser.playVideo()\n\t\t\tconst screenUser = this.screenUsers[userId];\n\t\t\tscreenUser.playVideo();\n\t\t}\n\t\tthis.localUser.playVideo();\n\t};\n\n\tupdateUserButtons()\n\t{\n\t\tconst currentConnectedUserCount = this.getConnectedUserCount();\n\t\tconst previousConnectedUserCount = this.cache.get('previousConnectedUserCount');\n\n\t\tif (currentConnectedUserCount > 1 && previousConnectedUserCount > 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].allowPinButton = currentConnectedUserCount > 1;\n\t\t\t}\n\t\t}\n\t};\n\n\tupdateButtons(skippedElementsList = [])\n\t{\n\t\tif (!this.elements.panel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!skippedElementsList.includes('panel'))\n\t\t{\n\t\t\tconst buttonList = this.getButtonList();\n\t\t\tif (this.needToRerenderButtonList)\n\t\t\t{\n\t\t\t\tDom.clean(this.elements.panel);\n\t\t\t\tDom.append(this.renderButtons(buttonList, this.needToRerenderButtonList), this.elements.panel);\n\t\t\t\tthis.needToRerenderButtonList = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.renderButtons(buttonList);\n\t\t\t}\n\t\t}\n\n\t\tif (this.elements.topPanel)\n\t\t{\n\t\t\tconst topButtonList = this.getTopButtonList();\n\t\t\tif (this.needToRerenderTopButtonList)\n\t\t\t{\n\t\t\t\tDom.clean(this.elements.topPanel);\n\t\t\t}\n\t\t\tthis.renderTopButtons(topButtonList, this.needToRerenderTopButtonList);\n\t\t\tthis.needToRerenderTopButtonList = false;\n\t\t}\n\n\t\tif (this.buttons.participantsMobile)\n\t\t{\n\t\t\tthis.buttons.participantsMobile.setCount(this.getConnectedUserCount(true));\n\t\t}\n\n\t\tif (this.showCallcontrolPromoPopupTimeout)\n\t\t{\n\t\t\tclearTimeout(this.showCallcontrolPromoPopupTimeout);\n\t\t}\n\n\t\tif (this.needToShowCallcontrolPromo)\n\t\t{\n\t\t\tthis.showCallcontrolPromoPopupTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.size !== View.Size.Folded)\n\t\t\t\t{\n\t\t\t\t\tthis.createAhaMomentNotifyCallcontrol();\n\t\t\t\t}\n\t\t\t}, 1500);\n\t\t}\n\n\t\tthis.renderAddUserButtonInList();\n\t};\n\n\tupdateUserData(userData)\n\t{\n\t\tfor (let userId in userData)\n\t\t{\n\t\t\tif (!this.userData[userId])\n\t\t\t{\n\t\t\t\tthis.userData[userId] = {\n\t\t\t\t\tname: '',\n\t\t\t\t\tavatar_hr: '',\n\t\t\t\t\tgender: 'M',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (userData[userId].name)\n\t\t\t{\n\t\t\t\tthis.userData[userId].name = userData[userId].name;\n\t\t\t}\n\n\t\t\tif (userData[userId].avatar_hr)\n\t\t\t{\n\t\t\t\tthis.userData[userId].avatar_hr = Util.isAvatarBlank(userData[userId].avatar_hr) ? '' : userData[userId].avatar_hr;\n\t\t\t}\n\t\t\telse if (userData[userId].avatar)\n\t\t\t{\n\t\t\t\tthis.userData[userId].avatar_hr = Util.isAvatarBlank(userData[userId].avatar) ? '' : userData[userId].avatar;\n\t\t\t}\n\n\t\t\tif (userData[userId].gender)\n\t\t\t{\n\t\t\t\tthis.userData[userId].gender = userData[userId].gender === 'F' ? 'F' : 'M';\n\t\t\t}\n\n\t\t\tconst userModel = this.userRegistry.get(userId);\n\t\t\tif (userModel)\n\t\t\t{\n\t\t\t\tuserModel.name = this.userData[userId].name;\n\t\t\t\tuserModel.avatar = checkAndEncodeURI(this.userData[userId].avatar_hr);\n\t\t\t}\n\t\t}\n\t};\n\n\tisScreenSharingSupported()\n\t{\n\t\treturn navigator.mediaDevices && typeof (navigator.mediaDevices.getDisplayMedia) === \"function\" || typeof (BXDesktopSystem) !== \"undefined\";\n\t};\n\n\tisRecordingHotKeySupported()\n\t{\n\t\treturn typeof (BXDesktopSystem) !== \"undefined\" && BXDesktopSystem.ApiVersion() >= 60;\n\t};\n\n\tisFullScreenSupported()\n\t{\n\t\tif (BX.browser.IsChrome() || BX.browser.IsSafari())\n\t\t{\n\t\t\treturn document.webkitFullscreenEnabled === true;\n\t\t}\n\t\telse if (BX.browser.IsFirefox())\n\t\t{\n\t\t\treturn document.fullscreenEnabled === true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t};\n\n\ttoggleEars()\n\t{\n\t\tthis.toggleTopEar();\n\t\tthis.toggleBottomEar();\n\n\t\tif (this.layout == Layouts.Grid && this.pagesCount > 1 && this.currentPage > 1)\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeft.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.pageNavigatorLeft.classList.remove(\"active\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Grid && this.pagesCount > 1 && this.currentPage < this.pagesCount)\n\t\t{\n\t\t\tthis.elements.pageNavigatorRight.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.pageNavigatorRight.classList.remove(\"active\");\n\t\t}\n\t};\n\n\ttoggleTopEar()\n\t{\n\t\tif (\n\t\t\tthis.layout !== Layouts.Grid &&\n\t\t\tthis.pagesCount > 1\n\t\t)\n\t\t{\n\t\t\tthis.elements.ear.top.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.ear.top.classList.remove(\"active\");\n\t\t}\n\t};\n\n\ttoggleBottomEar()\n\t{\n\t\tif (\n\t\t\tthis.layout !== Layouts.Grid &&\n\t\t\tthis.pagesCount > 1\n\t\t)\n\t\t{\n\t\t\tthis.elements.ear.bottom.classList.add(\"active\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.ear.bottom.classList.remove(\"active\");\n\t\t}\n\t};\n\n\tscrollUserListUp()\n\t{\n\t\tthis.stopScroll();\n\t\tthis.scrollInterval = setInterval(\n\t\t\t() => this.elements.userList.container.scrollTop -= 10,\n\t\t\t20\n\t\t);\n\t};\n\n\tscrollUserListDown()\n\t{\n\t\tthis.stopScroll();\n\t\tthis.scrollInterval = setInterval(\n\t\t\t() => this.elements.userList.container.scrollTop += 10,\n\t\t\t20\n\t\t);\n\t};\n\n\tstopScroll()\n\t{\n\t\tif (this.scrollInterval)\n\t\t{\n\t\t\tclearInterval(this.scrollInterval);\n\t\t\tthis.scrollInterval = 0;\n\t\t}\n\t};\n\n\ttoggleRenameSliderInputLoader()\n\t{\n\t\tthis.elements.renameSlider.button.classList.add('ui-btn-wait');\n\t};\n\n\tsetHotKeyTemporaryBlock(isActive, force)\n\t{\n\t\tif (!!isActive)\n\t\t{\n\t\t\tthis.hotKeyTemporaryBlock++;\n\t\t}\n\t\telse\n\t\t{\n\n\t\t\tthis.hotKeyTemporaryBlock--;\n\t\t\tif (this.hotKeyTemporaryBlock < 0 || force)\n\t\t\t{\n\t\t\t\tthis.hotKeyTemporaryBlock = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\tsetHotKeyActive(name, isActive)\n\t{\n\t\tif (typeof this.hotKey[name] === 'undefined')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.hotKey[name] = !!isActive;\n\t};\n\n\tisHotKeyActive(name)\n\t{\n\t\tif (!this.hotKey['all'])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.hotKeyTemporaryBlock > 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isButtonHidden(name))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.isButtonBlocked(name))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !!this.hotKey[name];\n\t}\n\n\tshowCommonRecordMenuPopup(isDesktopRecord = false) {\n\t\tif (this.#commonRecord.menuPopup)\n\t\t{\n\t\t\tthis.#commonRecord.menuPopup.close();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst popupType = [CallCommonRecordState.Stopped, CallCommonRecordState.Destroyed].includes(this.commonRecordState.state) ? 'kind' : 'control';\n\n\t\tthis.#commonRecord.menuPopup = new CommonRecordMenuPopup({\n\t\t\tstate: this.commonRecordState.state,\n\t\t\tpopupType,\n\t\t\tisDesktopRecord,\n\t\t\tonStart: (kind) => {\n\t\t\t\tthis.eventEmitter.emit(EventName.onCommonRecordMenu, {\n\t\t\t\t\tstate: CallCommonRecordState.Started,\n\t\t\t\t\tkind,\n\t\t\t\t});\n\t\t\t},\n\t\t\tonStop: () => {\n\t\t\t\tthis.eventEmitter.emit(EventName.onCommonRecordMenu, {\n\t\t\t\t\tstate: CallCommonRecordState.Stopped,\n\t\t\t\t});\n\t\t\t},\n\t\t\tonPause: () => {\n\t\t\t\tlet commonRecordState;\n\n\t\t\t\tif (this.commonRecordState.state === CallCommonRecordState.Paused)\n\t\t\t\t{\n\t\t\t\t\tthis.commonRecordState.state = CallCommonRecordState.Started;\n\t\t\t\t\tcommonRecordState = CallCommonRecordState.Resumed;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.commonRecordState.state = CallCommonRecordState.Paused;\n\t\t\t\t\tcommonRecordState = this.commonRecordState.state;\n\t\t\t\t}\n\n\t\t\t\tthis.buttons.recordStatus.update(this.commonRecordState);\n\n\t\t\t\tthis.eventEmitter.emit(EventName.onCommonRecordMenu, {\n\t\t\t\t\tstate: commonRecordState,\n\t\t\t\t});\n\t\t\t},\n\t\t\tonDestroy: () => {\n\t\t\t\tif (!CallCloudRecord.serviceEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.eventEmitter.emit(EventName.onCommonRecordMenu, {\n\t\t\t\t\tstate: CallCommonRecordState.Destroyed,\n\t\t\t\t});\n\t\t\t},\n\t\t\tonClose: () => {\n\t\t\t\tthis.#commonRecord.menuPopup = null;\n\t\t\t},\n\n\t\t});\n\n\t\tthis.#commonRecord.menuPopup.toggle();\n\t}\n\n\tshowCloudRecordInfoPopup(isCloudRecordFeaturesEnabled, callId)\n\t{\n\t\tif (this.#commonRecord.infoPopup)\n\t\t{\n\t\t\tthis.#commonRecord.infoPopup.close();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#commonRecord.infoPopup = new CloudRecordInfoPopup({\n\t\t\tisCloudRecordFeaturesEnabled,\n\t\t\tcallId,\n\t\t\tonClose: () => {\n\t\t\t\tthis.#commonRecord.infoPopup = null;\n\t\t\t},\n\t\t\tturnOn: () => {\n\t\t\t\tthis.showCommonRecordMenuPopup();\n\t\t\t},\n\t\t});\n\n\t\tthis.#commonRecord.infoPopup.toggle();\n\t}\n\n\tshowCommonRecordStartNotify(userId, state = CallCommonRecordState.Started)\n\t{\n\t\tif (this.#commonRecord.notify)\n\t\t{\n\t\t\tthis.#commonRecord.notify.close();\n\t\t\tthis.#commonRecord.notify = null;\n\t\t}\n\n\t\tconst userModel = this.userRegistry.get(userId);\n\t\tconst userGender = userModel && userModel.data.gender ? userModel.data.gender.toUpperCase() : 'M';\n\n\t\tthis.#commonRecord.notify = BX.UI.Notification.Center.notify({\n\t\t\tposition: 'top-right',\n\t\t\tautoHideDelay: 8000,\n\t\t\tcloseButton: true,\n\t\t\trender() {\n\t\t\t\treturn Dom.create('div', {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'ui-notification-balloon-content call-cloud-record-notify',\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'ui-notification-balloon-message',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-notify__icon',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'call-cloud-record-notify__message',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttext: Loc.getMessage(`CALL_CLOUD_RECORD_NOTIFY_${state.toUpperCase()}_${userGender}`, {\n\t\t\t\t\t\t\t\t\t\t'#INITIATOR_NAME#': userModel?.data?.name || '',\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'ui-notification-balloon-actions',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.getCloseButton(),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t}\n\n\tcloseCommonRecordPopups()\n\t{\n\t\tif (this.#commonRecord.menuPopup)\n\t\t{\n\t\t\tthis.#commonRecord.menuPopup.close();\n\t\t\tthis.#commonRecord.menuPopup = null;\n\t\t}\n\n\t\tif (this.#commonRecord.infoPopup)\n\t\t{\n\t\t\tthis.#commonRecord.infoPopup.close();\n\t\t\tthis.#commonRecord.infoPopup = null;\n\t\t}\n\n\t\tif (this.#commonRecord.notify)\n\t\t{\n\t\t\tthis.#commonRecord.notify.close();\n\t\t\tthis.#commonRecord.notify = null;\n\t\t}\n\t}\n\n\t/**\n\t * @param { Object } params\n\t * @param { string } params.title\n\t * @param { string } params.message\n\t * @param { string } params.yesButtonText\n\t * @param { string } params.noButtonText\n\t * @returns {Promise}\n\t */\n\tshowConfirmModal(params)\n\t{\n\t\tif (this.#confirmModal)\n\t\t{\n\t\t\tthis.#confirmModal.close();\n\t\t\tthis.#confirmModal = null;\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tlet isResolved = false;\n\n\t\t\tconst resolveOnce = (choice) => {\n\t\t\t\tif (isResolved)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tisResolved = true;\n\t\t\t\tresolve(choice);\n\t\t\t};\n\n\t\t\tthis.#confirmModal = new ConfirmModal({\n\t\t\t\t...params,\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.#confirmModal = null;\n\t\t\t\t\tresolveOnce('close');\n\t\t\t\t},\n\t\t\t\tonClickYesButton: () => resolveOnce('yes'),\n\t\t\t\tonClickNoButton: () => resolveOnce('no'),\n\t\t\t});\n\n\t\t\tthis.#confirmModal.show();\n\t\t});\n\t}\n\n\tshowCommonRecordStartModal()\n\t{\n\t\tthis.showConfirmModal({\n\t\t\ttitle: Loc.getMessage('CALL_CLOUD_RECORD_MODAL_START_TITLE'),\n\t\t\tmessage: Loc.getMessage('CALL_CLOUD_RECORD_MODAL_START_MESSAGE'),\n\t\t\tyesButtonText: Loc.getMessage('CALL_CLOUD_RECORD_MODAL_START_RESUME_BUTTON'),\n\t\t});\n\t}\n\n\tshowCloudRecordPromo(isCloudRecordFeaturesEnabled, callId)\n\t{\n\t\t// TODO: Remove once PromoManager is available for conferences\n\t\tif (this.isVideoconf)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst promoRequired = PromoManager.getInstance().needToShow(CLOUD_RECORD_PROMO_ID);\n\n\t\tif (promoRequired)\n\t\t{\n\t\t\tthis.showCloudRecordInfoPopup(isCloudRecordFeaturesEnabled, callId);\n\t\t\tPromoManager.getInstance().markAsWatched(CLOUD_RECORD_PROMO_ID);\n\t\t}\n\t}\n\n\t// event handlers\n\n\t_onBodyClick()\n\t{\n\t\tthis.eventEmitter.emit(EventName.onBodyClick);\n\t};\n\n\t_onCenterTouchStart(e)\n\t{\n\t\tthis.centerTouchX = e.pageX;\n\t};\n\n\t_onCenterTouchEnd(e)\n\t{\n\t\tconst delta = e.pageX - this.centerTouchX;\n\n\t\tif (delta > 100)\n\t\t{\n\t\t\tthis.pinUser(this.getRightUser(this.centralUser.id));\n\t\t\te.preventDefault();\n\t\t}\n\t\tif (delta < -100)\n\t\t{\n\t\t\tthis.pinUser(this.getLeftUser(this.centralUser.id));\n\t\t\te.preventDefault();\n\t\t}\n\t};\n\n\t_onFullScreenChange()\n\t{\n\t\tif (\"webkitFullscreenElement\" in document)\n\t\t{\n\t\t\tthis.isFullScreen = (!!document.webkitFullscreenElement);\n\t\t}\n\t\telse if (\"fullscreenElement\" in document)\n\t\t{\n\t\t\tthis.isFullScreen = (!!document.fullscreenElement);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// safari workaround\n\t\tsetTimeout(function ()\n\t\t{\n\t\t\tif (!this.elements.root)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.isFullScreen)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add(\"bx-messenger-videocall-fullscreen\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.remove(\"bx-messenger-videocall-fullscreen\");\n\t\t\t}\n\t\t\tthis.updateUserList();\n\t\t\tthis.updateButtons();\n\t\t\tthis.setUserBlockFolded(this.isFullScreen);\n\n\t\t}.bind(this), 0);\n\t};\n\n\t_onIntersectionChange(entries)\n\t{\n\t\tlet t = {};\n\t\tentries.forEach(function (intersectionEntry)\n\t\t{\n\t\t\tt[intersectionEntry.target.dataset.userId] = intersectionEntry.isIntersecting;\n\t\t});\n\t\tfor (let userId in t)\n\t\t{\n\t\t\tif (this.users[userId])\n\t\t\t{\n\t\t\t\tthis.users[userId].visible = t[userId];\n\t\t\t}\n\t\t\tif (userId == this.localUser.id)\n\t\t\t{\n\t\t\t\tthis.localUser.visible = t[userId];\n\t\t\t}\n\t\t}\n\t};\n\n\t_onResize()\n\t{\n\t\t// this.resizeCalled++;\n\t\t// this.reportResizeCalled();\n\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.centralUser)\n\t\t{\n\t\t\t//this.centralUser.updateAvatarWidth();\n\t\t}\n\t\tif (BX.browser.IsMobile())\n\t\t{\n\t\t\tdocument.documentElement.style.setProperty('--view-height', window.innerHeight + 'px');\n\t\t}\n\t\tif (this.layout == Layouts.Grid || this.layout == Layouts.Centered)\n\t\t{\n\t\t\tthis.updateUserList();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.updateCentralUserAvatarSize();\n\t\t\tthis.toggleEars();\n\t\t}\n\n\t\tconst rootDimensions = this.elements.root.getBoundingClientRect()\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-450\", rootDimensions.width < 450);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-550\", rootDimensions.width < 550);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-650\", rootDimensions.width < 650);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-700\", rootDimensions.width < 700);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-850\", rootDimensions.width < 850);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-900\", rootDimensions.width < 900);\n\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-width-lt-1050\", rootDimensions.width < 1050);\n\n\t\t/*if (this.maxWidth === 0)\n\t\t{\n\t\t\tthis.elements.root.style.maxWidth = this.container.clientWidth + 'px';\n\t\t}*/\n\n\t\tif (this.checkPanelOverflow())\n\t\t{\n\t\t\tthis.updateButtons();\n\t\t\tif (this.overflownButtonsPopup && !Object.keys(this.overflownButtons).length)\n\t\t\t{\n\t\t\t\tthis.overflownButtonsPopup.close();\n\t\t\t}\n\t\t}\n\t};\n\n\t_onOrientationChange()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (window.innerHeight > window.innerWidth)\n\t\t{\n\t\t\tthis.elements.root.classList.remove(\"orientation-landscape\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.classList.add(\"orientation-landscape\");\n\t\t}\n\t};\n\n\n\n\t_destroyHotKeyHint()\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.hintManager.popup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// we need to destroy, not .hide for onShow event handler (see method _showHotKeyHint).\n\t\tthis.hintManager.hide();\n\t\tthis.hintManager.popup.destroy();\n\t\tthis.hintManager.popup = null;\n\t}\n\n\t_onKeyDown(e)\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!(e.shiftKey && (e.ctrlKey || e.metaKey)) && !(e.code === 'Space'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (event.repeat)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst callMinimized = this.size === View.Size.Folded;\n\n\t\tif (\n\t\t\te.code === 'KeyA'\n\t\t\t&& this.isHotKeyActive('microphone')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tif (this.deviceSelector)\n\t\t\t{\n\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t}\n\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'Space' && Hardware.isMicrophoneMuted\n\t\t\t&& this.isHotKeyActive('microphoneSpace')\n\t\t)\n\t\t{\n\t\t\tif (!callMinimized)\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.pushToTalk = true;\n\t\t\t\tthis.microphoneHotkeyTimerId = setTimeout(function ()\n\t\t\t\t{\n\t\t\t\t\tif (this.deviceSelector)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t\t\t}\n\t\t\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t\t\t}.bind(this), 100);\n\t\t\t}\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyS'\n\t\t\t&& this.isHotKeyActive('screen')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onScreenButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyV'\n\t\t\t&& this.isHotKeyActive('camera')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tif (this.deviceSelector)\n\t\t\t{\n\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t}\n\t\t\tthis._onCameraButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyU'\n\t\t\t&& this.isHotKeyActive('users')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onUsersButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyR'\n\t\t\t&& this.isRecordingHotKeySupported()\n\t\t\t&& this.isHotKeyActive('record')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.#onCommonRecordHotkey();\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyH'\n\t\t\t&& this.isHotKeyActive('floorRequest')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis._onFloorRequestButtonClick(e);\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyC'\n\t\t\t&& this.isHotKeyActive('chat')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tif (callMinimized)\n\t\t\t{\n\t\t\t\tthis._onBodyClick(e);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._onChatButtonClick(e);\n\t\t\t\tthis._destroyHotKeyHint();\n\t\t\t}\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyM'\n\t\t\t&& this.isHotKeyActive('muteSpeaker')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\t\tbuttonName: \"toggleSpeaker\",\n\t\t\t\tspeakerMuted: this.speakerMuted,\n\t\t\t\tfromHotKey: true,\n\t\t\t});\n\t\t}\n\t\telse if (\n\t\t\te.code === 'KeyW'\n\t\t\t&& this.isHotKeyActive('grid')\n\t\t)\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.setLayout(this.layout == Layouts.Centered ? Layouts.Grid : Layouts.Centered);\n\t\t}\n\t};\n\n\t_onKeyUp(e)\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.microphoneHotkeyTimerId);\n\t\tif (this.pushToTalk && !Hardware.isMicrophoneMuted && e.code === 'Space')\n\t\t{\n\t\t\te.preventDefault();\n\t\t\tthis.pushToTalk = false;\n\t\t\tif (this.deviceSelector)\n\t\t\t{\n\t\t\t\tthis.deviceSelector.destroy();\n\t\t\t}\n\t\t\tthis._onMicrophoneButtonClick(e);\n\t\t}\n\t};\n\n\t_onUserClick(e)\n\t{\n\t\tconst userId = e.userId;\n\n\t\tif (userId == this.centralUser.id && this.layout != Layouts.Grid)\n\t\t{\n\t\t\tthis.elements.root.classList.toggle(\"bx-messenger-videocall-hidden-panels\");\n\t\t}\n\n\t\tif (this.layout == Layouts.Centered && userId != this.centralUser.id)\n\t\t{\n\t\t\tthis.pinUser(userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t(this.pinnedUser && this.pinnedUser.id === userId) ? this._onUserUnPin() : this._onUserPin({userId});\n\t\t}\n\n\t\tthis.eventEmitter.emit(EventName.onUserClick, {\n\t\t\tuserId: userId,\n\t\t\tstream: userId == this.userId ? this.localUser.stream : this.users[userId].stream,\n\t\t\tlayout: this.layout,\n\t\t});\n\t};\n\n\t_onUserRename(newName)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onUserRename, {newName: newName});\n\t};\n\n\t_onUserRenameInputFocus()\n\t{\n\t\tthis.setHotKeyTemporaryBlock(true);\n\t};\n\n\t_onUserRenameInputBlur()\n\t{\n\t\tthis.setHotKeyTemporaryBlock(false);\n\t};\n\n\t_onUserPin(e)\n\t{\n\t\tif (this.layout == Layouts.Grid)\n\t\t{\n\t\t\tthis.setLayout(Layouts.Centered)\n\t\t}\n\t\tthis.pinUser(e.userId);\n\t};\n\n\t_onUserUnPin()\n\t{\n\t\tif (this.layout == Layouts.Centered)\n\t\t{\n\t\t\tthis.setLayout(Layouts.Grid);\n\t\t}\n\t\tthis.unpinUser();\n\t};\n\n\t_onTurnOffParticipantMic(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onTurnOffParticipantMic, {\n\t\t\tuserId: e.userId\n\t\t});\n\t};\n\n\t_onTurnOffParticipantCam(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onTurnOffParticipantCam, {\n\t\t\tuserId: e.userId\n\t\t});\n\t};\n\n\t_onTurnOffParticipantScreenshare(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onTurnOffParticipantScreenshare, {\n\t\t\tuserId: e.userId\n\t\t});\n\t};\n\n\t#onCommonRecordClick()\n\t{\n\t\tconst limitObj = this.getRecordLimitation();\n\n\t\tthis.onClickButtonWithLimit(limitObj, () => {\n\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\t\tbuttonName: 'record',\n\t\t\t});\n\t\t});\n\t}\n\n\t#onCommonRecordHotkey() {\n\t\tconst limitObj = this.getRecordLimitation();\n\n\t\tthis.onClickButtonWithLimit(limitObj, () => {\n\t\t\tconst state = [CallCommonRecordState.Stopped, CallCommonRecordState.Destroyed].includes(this.commonRecordState.state)\n\t\t\t\t? CallCommonRecordState.Started\n\t\t\t\t: CallCommonRecordState.Stopped;\n\n\t\t\tthis.eventEmitter.emit(EventName.onCommonRecordMenu, {\n\t\t\t\tstate,\n\t\t\t\thotkey: true,\n\t\t\t});\n\t\t});\n\t}\n\n\t_onDocumentButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'document',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onCopilotButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'copilot',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onGridButtonClick()\n\t{\n\t\tthis.setLayout(this.layout == Layouts.Centered ? Layouts.Grid : Layouts.Centered);\n\t\tif (this.layout == Layouts.Centered && this.localUser.id !== this.centralUser.id)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onHasMainStream, {\n\t\t\t\tuserId: this.centralUser.id,\n\t\t\t});\n\t\t}\n\t};\n\n\t_onAddButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"inviteUser\",\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onShareButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"share\",\n\t\t\tnode: e.currentTarget\n\t\t});\n\t};\n\n\t_onMicrophoneButtonClick(e)\n\t{\n\t\tif (this.isButtonBlocked('microphone'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (\"stopPropagation\" in e)\n\t\t{\n\t\t\te.stopPropagation();\n\t\t}\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleMute\",\n\t\t\tmuted: !Hardware.isMicrophoneMuted\n\t\t});\n\t};\n\n\t_onMicrophoneArrowClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showDeviceSelector(e.currentTarget);\n\t};\n\n\t_onMicrophoneSideIconClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"microphoneSideIcon\",\n\t\t});\n\t};\n\n\t_onMicrophoneSelected(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onReplaceMicrophone, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onCameraButtonClick(e)\n\t{\n\t\tif (this.isButtonBlocked('camera'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (\"stopPropagation\" in e)\n\t\t{\n\t\t\te.stopPropagation();\n\t\t}\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleVideo\",\n\t\t\tvideo: !Hardware.isCameraOn\n\t\t});\n\t};\n\n\t_onCameraArrowClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showDeviceSelector(e.currentTarget);\n\t};\n\n\t_onCameraSelected(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onReplaceCamera, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onSpeakerButtonClick()\n\t{\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"toggleSpeaker\",\n\t\t\tspeakerMuted: this.speakerMuted\n\t\t});\n\t};\n\n\t_onChangeHdVideo(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeHdVideo, e.data);\n\t};\n\n\t_onChangeNoiseSuppression(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeNoiseSuppression, e.data);\n\t};\n\n\t_onChangeMicAutoParams(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeMicAutoParams, e.data);\n\t};\n\n\t_onChangeFaceImprove(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeFaceImprove, e.data);\n\t}\n\n\t_onChangeVideoQuality(e)\n\t{\n\t\tthis.eventEmitter.emit(EventName.onChangeVideoQuality, e.data);\n\t};\n\n\tdisableFaceImprove()\n\t{\n\t\tif (\n\t\t\tUtil.isDesktop()\n\t\t\t&& DesktopApi.isDesktop()\n\t\t\t&& DesktopApi.getCameraSmoothingStatus()\n\t\t)\n\t\t{\n\t\t\tthis.eventEmitter.emit(EventName.onChangeFaceImprove, {\n\t\t\t\tfaceImproveEnabled: false\n\t\t\t});\n\t\t}\n\t}\n\n\t_onSpeakerSelected(e)\n\t{\n\t\tthis.setSpeakerId(e.data.deviceId);\n\n\t\tthis.eventEmitter.emit(EventName.onReplaceSpeaker, {\n\t\t\tdeviceId: e.data.deviceId\n\t\t});\n\t};\n\n\t_onScreenButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\n\t\tconst limitObj = this.getScreenSharingLimitation();\n\n\t\tthis.onClickButtonWithLimit(limitObj, () => {\n\t\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\t\tbuttonName: 'toggleScreenSharing',\n\t\t\t\tnode: e.target\n\t\t\t});\n\t\t})\n\t};\n\n\t_onChatButtonClick(e)\n\t{\n\t\tthis.hintManager.hide();\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'showChat',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onUsersButtonClick(e)\n\t{\n\t\tthis.hintManager.hide();\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'toggleUsers',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onMobileMenuButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.showCallMenu();\n\t};\n\n\t_onFloorRequestButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'floorRequest',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onMoreButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t\tthis.buttons.more.setActive(false);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showOverflownButtonsPopup();\n\t\t\tthis.buttons.more.setActive(true);\n\t\t}\n\t};\n\n\t_onHistoryButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'showHistory',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onHangupButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.clearNewLogicRules();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'hangup',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onHangupOptionsButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'hangupOptions',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onCloseButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'close',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onFullScreenButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'fullscreen',\n\t\t\tnode: e.target\n\t\t});\n\t};\n\n\t_onFeedbackButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'feedback',\n\t\t\tnode: e.target\n\t\t});\n\t}\n\n\t_onCallcontrolButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'callcontrol',\n\t\t\tnode: e.target\n\t\t});\n\n\t\tif (this.ahaMomentNotifyCallcontrol)\n\t\t{\n\t\t\tPromoManager.getInstance().markAsWatched(CALLCONTROL_PROMO_ID);\n\t\t}\n\n\t\tthis.clearCallcontrolPromo();\n\t}\n\n\t_onParticipantsButtonListClick(event)\n\t{\n\t\tif (!this.isButtonBlocked('users'))\n\t\t{\n\t\t\tthis._onUsersButtonClick(event);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isFullScreen)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setUserBlockFolded(!this.isUserBlockFolded);\n\t};\n\n\t_onParticipantsListButtonClick(e)\n\t{\n\t\te.stopPropagation();\n\n\t\tconst viewEvent = new BaseEvent({\n\t\t\tdata: {\n\t\t\t\tbuttonName: 'participantsList',\n\t\t\t\tnode: e.target\n\t\t\t},\n\t\t\tcompatData: ['participantsList', e.target],\n\t\t});\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, viewEvent);\n\n\t\tif (viewEvent.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUserSelector.create({\n\t\t\tparentElement: e.currentTarget,\n\t\t\tzIndex: this.baseZIndex + 500,\n\t\t\tuserList: Object.values(this.users),\n\t\t\tcurrent: this.centralUser.id,\n\t\t\tonSelect: (userId) => this.setCentralUser(userId)\n\t\t}).show();\n\t};\n\n\t_onParticipantsButtonMobileListClick()\n\t{\n\t\tthis.showParticipantsMenu();\n\t};\n\n\t_onMobileCallMenuFloorRequestClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: 'floorRequest',\n\t\t});\n\t};\n\n\t_onMobileCallMenShowParticipantsClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.showParticipantsMenu();\n\t};\n\n\t_onMobileCallMenuCopyInviteClick()\n\t{\n\t\tthis.callMenu.close();\n\t\tthis.eventEmitter.emit(EventName.onButtonClick, {\n\t\t\tbuttonName: \"share\",\n\t\t\tnode: null\n\t\t})\n\t};\n\n\tshowRenameSlider()\n\t{\n\t\tif (!this.renameSlider)\n\t\t{\n\t\t\tthis.renameSlider = new MobileSlider({\n\t\t\t\tparent: this.elements.root,\n\t\t\t\tcontent: this.renderRenameSlider(),\n\t\t\t\tonClose: () => this.renameSlider.destroy(),\n\t\t\t\tonDestroy: () => this.renameSlider = null,\n\t\t\t});\n\t\t}\n\n\t\tthis.renameSlider.show();\n\t\tsetTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tthis.elements.renameSlider.input.focus();\n\t\t\t\tthis.elements.renameSlider.input.select();\n\t\t\t},\n\t\t\t400\n\t\t);\n\t};\n\n\trenderRenameSlider()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-wrap\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-title\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_MENU_CHANGE_MY_NAME\")\n\t\t\t\t}),\n\t\t\t\tthis.elements.renameSlider.input = Dom.create(\"input\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-input\"\n\t\t\t\t\t},\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\ttype: \"text\",\n\t\t\t\t\t\tvalue: this.localUser.userModel.name\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tthis.elements.renameSlider.button = Dom.create(\"button\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: \"bx-videocall-mobile-rename-slider-button ui-btn ui-btn-md ui-btn-primary\"\n\t\t\t\t\t},\n\t\t\t\t\ttext: BX.message(\"IM_M_CALL_MOBILE_RENAME_CONFIRM\"),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: this._onMobileUserRename.bind(this)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\t_onMobileUserRename(event)\n\t{\n\t\tevent.stopPropagation();\n\n\t\tconst inputValue = this.elements.renameSlider.input.value;\n\t\tconst newName = inputValue.trim();\n\t\tlet needToUpdate = true;\n\t\tif (newName === this.localUser.userModel.name || newName === '')\n\t\t{\n\t\t\tneedToUpdate = false;\n\t\t}\n\n\t\tif (needToUpdate)\n\t\t{\n\t\t\tthis.toggleRenameSliderInputLoader();\n\t\t\tthis._onUserRename(newName)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.renameSlider.close();\n\t\t}\n\t};\n\n\t_onMobileCallMenuCancelClick()\n\t{\n\t\tthis.callMenu.close();\n\t};\n\n\t_onLeftEarClick()\n\t{\n\t\tthis.pinUser(this.getLeftUser(this.centralUser.id));\n\t};\n\n\t_onRightEarClick()\n\t{\n\t\tthis.pinUser(this.getRightUser(this.centralUser.id));\n\t};\n\n\t_onLeftPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage - 1)\n\t};\n\n\t_onRightPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage + 1)\n\t};\n\n\t_onTopPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage !== 1 ? this.currentPage - 1 : this.pagesCount);\n\t};\n\n\t_onBottomPageNavigatorClick(e)\n\t{\n\t\te.stopPropagation();\n\t\tthis.setCurrentPage(this.currentPage !== this.pagesCount ? this.currentPage + 1 : 1);\n\t};\n\n\tsetMaxWidth(maxWidth)\n\t{\n\t\tif (this.maxWidth !== maxWidth)\n\t\t{\n\t\t\tconst MAX_WIDTH_SPEAKER_MODE = 650;\n\t\t\tif (maxWidth < MAX_WIDTH_SPEAKER_MODE\n\t\t\t\t&& (!this.maxWidth || this.maxWidth > MAX_WIDTH_SPEAKER_MODE)\n\t\t\t\t&& this.layout === Layouts.Centered\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.setLayout(Layouts.Grid)\n\t\t\t}\n\n\t\t\tconst animateUnsetProperty = this.maxWidth === null;\n\t\t\tthis.maxWidth = maxWidth;\n\t\t\tif (this.size !== View.Size.Folded)\n\t\t\t{\n\t\t\t\tthis._applyMaxWidth(animateUnsetProperty);\n\t\t\t}\n\t\t}\n\t};\n\n\tremoveMaxWidth()\n\t{\n\t\tthis.setMaxWidth(null);\n\t}\n\n\t_applyMaxWidth(animateUnsetProperty)\n\t{\n\t\tconst containerDimensions = this.container.getBoundingClientRect();\n\t\tif (this.maxWidth !== null)\n\t\t{\n\t\t\tif (!this.elements.root.style.maxWidth && animateUnsetProperty)\n\t\t\t{\n\t\t\t\tthis.elements.root.style.maxWidth = containerDimensions.width + 'px';\n\t\t\t}\n\t\t\tsetTimeout(\n\t\t\t\t() => this.elements.root.style.maxWidth = Math.max(this.maxWidth, MIN_WIDTH) + 'px',\n\t\t\t\t0,\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.root.style.maxWidth = containerDimensions.width + 'px';\n\t\t\tthis.elements.root.addEventListener('transitionend',\n\t\t\t\t() => this.elements.root.style.removeProperty('max-width'),\n\t\t\t\t{once: true},\n\t\t\t)\n\t\t}\n\t};\n\n\treleaseLocalMedia()\n\t{\n\t\tthis.localUser.releaseStream();\n\n\t\tif (this.centralUser.id == this.userId)\n\t\t{\n\t\t\tthis.centralUser.releaseStream();\n\t\t}\n\t};\n\n\tclearNewLogicRules()\n\t{\n\t\tclearTimeout(this.rerenderTimeout);\n\t\tthis.rerenderTimeout = null;\n\t\tthis.waitingForUserMediaTimeouts.forEach(timeout => clearTimeout(timeout));\n\t\tthis.waitingForUserMediaTimeouts.clear();\n\t\tthis.rerenderQueue.clear();\n\t}\n\n\tclearCallcontrolPromo()\n\t{\n\t\tif (this.showCallcontrolPromoPopupTimeout)\n\t\t{\n\t\t\tclearTimeout(this.showCallcontrolPromoPopupTimeout);\n\t\t}\n\n\t\tif (this.ahaMomentNotifyCallcontrol)\n\t\t{\n\t\t\tthis.needToShowCallcontrolPromo = false;\n\t\t\tthis.ahaMomentNotifyCallcontrol.close();\n\t\t\tthis.ahaMomentNotifyCallcontrol = null;\n\t\t}\n\n\t}\n\n\t#getViewVisibilityChange(listners = []) {\n\t\tconst handler = (event) => {\n\t\t\tfor (const listner of listners)\n\t\t\t{\n\t\t\t\tlistner(event, document.visibilityState)\n\t\t\t}\n\t\t};\n\n\t\tconst startViewVisibilityChange = () => {\n\t\t\tdocument.addEventListener('visibilitychange', handler, { capture: true });\n\t\t};\n\n\t\tconst stopViewVisibilityChange = () => {\n\t\t\tdocument.removeEventListener('visibilitychange', handler, { capture: true });\n\t\t};\n\n\t\treturn {\n\t\t\tstartViewVisibilityChange,\n\t\t\tstopViewVisibilityChange,\n\t\t\tgetCurrentVisibility: () => document.visibilityState,\n\t\t};\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.destroyed = true;\n\n\t\tthis.closeCopilotNotify();\n\t\tthis.closeCommonRecordPopups();\n\n\t\tif (this.overflownButtonsPopup)\n\t\t{\n\t\t\tthis.overflownButtonsPopup.close();\n\t\t}\n\n\t\tthis.preferInitialWindowPlacementPictureInPicture = true;\n\n\t\tif (this.elements.root)\n\t\t{\n\t\t\tDom.remove(this.elements.root);\n\t\t\tthis.elements.root = null;\n\t\t}\n\t\tthis.visible = false;\n\n\t\tthis.clearNewLogicRules();\n\n\t\twindow.removeEventListener(\"webkitfullscreenchange\", this._onFullScreenChangeHandler);\n\t\twindow.removeEventListener(\"mozfullscreenchange\", this._onFullScreenChangeHandler);\n\t\twindow.removeEventListener(\"orientationchange\", this._onOrientationChangeHandler);\n\t\twindow.removeEventListener(\"keydown\", this._onKeyDownHandler);\n\t\twindow.removeEventListener(\"keyup\", this._onKeyUpHandler);\n\n\t\tdocument.removeEventListener('mousemove', this.onMouseMoveHandler);\n\n\t\tthis.resizeObserver.disconnect();\n\t\tthis.resizeObserver = null;\n\t\tif (this.intersectionObserver)\n\t\t{\n\t\t\tthis.intersectionObserver.disconnect();\n\t\t\tthis.intersectionObserver = null;\n\t\t}\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].userModel.unsubscribe('changed', this.talkingService.watchTalking);\n\t\t\t\tthis.users[userId].destroy();\n\t\t\t}\n\t\t}\n\t\tthis.userData = null;\n\t\tthis.centralUser.userModel.unsubscribe('changed', this.talkingService.watchTalking);\n\t\tthis.userRegistry.unsubscribe('changed', this.talkingService.refreshQueue);\n\t\tthis.talkingService.destroy();\n\t\tthis.centralUser.destroy();\n\t\tthis.hintManager.hide();\n\t\tthis.hintManager = null;\n\n\t\tclearTimeout(this.switchPresenterTimeout);\n\n\t\tif (this.buttons.recordStatus)\n\t\t{\n\t\t\tthis.buttons.recordStatus.stopViewUpdate();\n\t\t}\n\t\tthis.commonRecordState = this.getDefaultCommonRecordState();\n\t\tthis.buttons = null;\n\n\t\tthis.eventEmitter.emit(EventName.onDestroy);\n\t\tthis.eventEmitter.unsubscribeAll();\n\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setCameraState);\n\n\t\tthis.clearCallcontrolPromo();\n\n\t\tthis.viewVisibility.stopViewVisibilityChange();\n\t\t\n\t\tif (this.deviceSelector)\n\t\t{\n\t\t\tthis.deviceSelector.destroy();\n\t\t}\n\t};\n\n\tstatic Layout = Layouts;\n\tstatic Size = Size;\n\n\tstatic RecordSource = {\n\t\tChat: 'BXCLIENT_CHAT'\n\t};\n\n\tstatic UiState = UiState;\n\tstatic Event = EventName;\n\tstatic RoomState = RoomState;\n\tstatic DeviceSelector = DeviceSelector;\n\tstatic NotificationManager = NotificationManager;\n\tstatic MIN_WIDTH = MIN_WIDTH;\n\n\tstatic DocumentVisibilityState: DocumentVisibilityState = DocumentVisibilityState;\n}\n","import {Type} from 'main.core'\n\nconst VOLUME_THRESHOLD = 0.02;\nconst INACTIVITY_TIME = 2000;\nconst AVERAGING_COEFFICIENT = 0.6; // from 0 to 1;\n\n/**\n * Naive voice activity detection\n * @param {object} config\n * @param {MediaStream} config.mediaStream\n * @param {function} config.onVoiceStarted\n * @param {function} config.onVoiceStopped\n * @constructor\n */\nexport class SimpleVAD\n{\n\tconstructor(config)\n\t{\n\t\tif (!(config.mediaStream instanceof MediaStream))\n\t\t{\n\t\t\tthrow new Error(\"config.mediaStream should be instance of MediaStream\");\n\t\t}\n\n\t\tif (config.mediaStream.getAudioTracks().length === 0)\n\t\t{\n\t\t\tthrow new Error(\"config.mediaStream should contain audio track\");\n\t\t}\n\n\t\tthis.mediaStream = new MediaStream();\n\t\tthis.mediaStream.addTrack(config.mediaStream.getAudioTracks()[0].clone());\n\t\tthis.audioContext = null;\n\t\tthis.mediaStreamNode = null;\n\t\tthis.analyserNode = null;\n\n\t\tthis.audioTimeDomainData = null;\n\t\tthis.voiceState = false;\n\n\t\tthis.measureInterval = 0;\n\t\tthis.inactivityTimeout = 0;\n\n\t\tthis.currentVolume = 0;\n\n\t\tthis.callbacks = {\n\t\t\tvoiceStarted: Type.isFunction(config.onVoiceStarted) ? config.onVoiceStarted : BX.DoNothing,\n\t\t\tvoiceStopped: Type.isFunction(config.onVoiceStopped) ? config.onVoiceStopped : BX.DoNothing\n\t\t};\n\n\t\tif (SimpleVAD.isSupported())\n\t\t{\n\t\t\tthis.init();\n\t\t}\n\t};\n\n\tstatic isSupported()\n\t{\n\t\treturn (\n\t\t\t(window.AudioContext || window.webkitAudioContext)\n\t\t\t&& window.AnalyserNode\n\t\t\t&& typeof (window.AnalyserNode.prototype['getFloatTimeDomainData']) === \"function\"\n\t\t);\n\t};\n\n\tinit()\n\t{\n\t\tthis.audioContext = new (window.AudioContext || window.webkitAudioContext)();\n\t\tthis.analyserNode = this.audioContext.createAnalyser();\n\t\tthis.analyserNode.fftSize = 128;\n\t\tthis.mediaStreamNode = this.audioContext.createMediaStreamSource(this.mediaStream);\n\t\tthis.mediaStreamNode.connect(this.analyserNode);\n\n\t\tthis.audioTimeDomainData = new Float32Array(this.analyserNode.fftSize);\n\t\tthis.measureInterval = setInterval(this.analyzeAudioStream.bind(this), 100);\n\t};\n\n\tanalyzeAudioStream()\n\t{\n\t\tthis.analyserNode.getFloatTimeDomainData(this.audioTimeDomainData);\n\t\tthis.updateCurrentVolume(this.audioTimeDomainData);\n\n\t\tthis.setVoiceState(this.currentVolume >= VOLUME_THRESHOLD);\n\t};\n\n\tsetVoiceState(voiceState)\n\t{\n\t\tif (this.voiceState == voiceState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (voiceState)\n\t\t{\n\t\t\tthis.callbacks.voiceStarted();\n\t\t\tclearTimeout(this.inactivityTimeout);\n\t\t\tthis.inactivityTimeout = 0;\n\t\t\tthis.voiceState = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.inactivityTimeout)\n\t\t\t{\n\t\t\t\tthis.inactivityTimeout = setTimeout(this.onInactivityTimeout.bind(this), INACTIVITY_TIME);\n\t\t\t}\n\t\t}\n\t};\n\n\tonInactivityTimeout()\n\t{\n\t\tthis.inactivityTimeout = 0;\n\t\tthis.voiceState = false;\n\t\tthis.callbacks.voiceStopped();\n\t};\n\n\tupdateCurrentVolume(audioTimeDomainData)\n\t{\n\t\tlet sum = 0;\n\n\t\tfor (let i = 0; i < audioTimeDomainData.length; i++)\n\t\t{\n\t\t\tsum += audioTimeDomainData[i] * audioTimeDomainData[i];\n\t\t}\n\n\t\tconst rms = Math.sqrt(sum / audioTimeDomainData.length);\n\t\tthis.currentVolume = Math.max(rms, this.currentVolume * AVERAGING_COEFFICIENT);\n\t};\n\n\tdestroy()\n\t{\n\t\tif (this.analyserNode)\n\t\t{\n\t\t\tthis.analyserNode.disconnect();\n\t\t}\n\n\t\tif (this.mediaStreamNode)\n\t\t{\n\t\t\tthis.mediaStreamNode.disconnect();\n\t\t}\n\n\t\tif (this.audioContext)\n\t\t{\n\t\t\tthis.audioContext.close();\n\t\t}\n\n\t\tif (this.mediaStream)\n\t\t{\n\t\t\tthis.mediaStream.getTracks().forEach(track => track.stop());\n\t\t\tthis.mediaStream = null;\n\t\t}\n\n\t\tclearInterval(this.measureInterval);\n\n\t\tthis.analyserNode = null;\n\t\tthis.mediaStreamNode = null;\n\t\tthis.audioContext = null;\n\n\t\tthis.callbacks = {\n\t\t\tvoiceStarted: BX.DoNothing,\n\t\t\tvoiceStopped: BX.DoNothing\n\t\t}\n\t}\n}\n\n","import { Event, Loc, Type, Runtime } from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport { CallEngine, CallState, CallEvent, UserState, Provider, DisconnectReason } from './engine';\nimport {View} from '../view/view';\nimport { MediaRenderer } from '../view/media-renderer';\nimport {SimpleVAD} from './simple_vad';\nimport {Hardware} from '../call_hardware';\nimport Util from '../util';\nimport {\n\tCall,\n\tCALL_STATE,\n\tMediaStreamsKinds,\n\tRecorderStatus,\n\tCloudRecordStatus,\n\tConnectionType,\n} from '../call_api.js';\nimport { CallStreamManager } from '../media-stream-manager';\nimport { CallCommonRecordState, CallCommonRecordType } from '../call_common_record';\nimport { CallSettingsManager } from 'call.lib.settings-manager';\n\nconst ajaxActions = {\n\tdecline: 'call.Call.decline',\n};\n\nconst clientEvents = {\n\tnegotiationNeeded: 'Call::negotiationNeeded',\n\tconnectionOffer: 'Call::connectionOffer',\n\tconnectionAnswer: 'Call::connectionAnswer',\n\ticeCandidate: 'Call::iceCandidate',\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\tcommonRecordState: 'Call::commonRecordState',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tcustomMessage: 'Call::customMessage',\n\tusersInvited: 'Call::usersInvited',\n\tuserInviteTimeout: 'Call::userInviteTimeout',\n};\n\nconst defaultConnectionOptions = {\n\tofferToReceiveVideo: true,\n\tofferToReceiveAudio: true\n};\n\nconst signalingConnectionRefreshPeriod = 30000;\nconst signalingWaitReplyPeriod = 10000;\n//var signalingWaitReplyPeriod = 5000;\nconst invitePeriod = 30000;\nconst reinvitePeriod = 5500;\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n * - setMuted\n * - setVideoEnabled\n * - setCameraId\n * - setMicrophoneId\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onUserVoiceStarted\n * - onUserVoiceStopped\n * - onLocalMediaReceived\n * - onLocalMediaStopped\n * - onLocalMediaError\n * - onDeviceListUpdated\n * - onDestroy\n */\n\nexport class ServerPlainCall extends AbstractCall\n{\n\tpeers: { [key: number]: Peer };\n\n\t#isCloudRecordFeaturesEnabled: false;\n\t#cloudRecordState;\n\n\t#recorderState;\n\t#recorderStateHasChange;\n\t#copilotInitiator: boolean;\n\n\t#connectionType: boolean;\n\n\t#screenShared: boolean;\n\n\t#onUnloadHandler: Function;\n\t#onOnlineHandler: Function;\n\n\tconstructor(params)\n\t{\n\t\tsuper(params)\n\n\t\tthis.callFromMobile = params.callFromMobile;\n\t\tthis.state = params.state || '';\n\n\t\tthis.peers = this.initPeers(this.users);\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.deviceList = [];\n\n\t\tthis.turnServer = Loc.getMessage('turn_server');\n\t\tthis.turnServerLogin = Loc.getMessage('turn_server_login') || 'bitrix';\n\t\tthis.turnServerPassword = Loc.getMessage('turn_server_password') || 'bitrix';\n\n\t\tthis.iceServers = [\n\t\t\t{\n\t\t\t\turls: `stun:${this.turnServer}`,\n\t\t\t},\n\t\t\t{\n\t\t\t\turls: `turn:${this.turnServer}`,\n\t\t\t\tusername: this.turnServerLogin,\n\t\t\t\tcredential: this.turnServerPassword,\n\t\t\t},\n\t\t];\n\n\t\tthis.userData = params.userData;\n\n\t\tthis.#onUnloadHandler = this.#onUnload.bind(this);\n\t\tthis.#onOnlineHandler = this.#onOnline.bind(this);\n\n\t\tthis.enableMicAutoParameters = params.enableMicAutoParameters !== false;\n\t\tthis.microphoneLevelInterval = null;\n\t\tthis.mediaMutedBySystem = false;\n\n\t\tthis.CallApi = null;\n\t\tthis.#connectionType = ConnectionType.PeerToPeer;\n\n\t\tthis._reconnectionEventCount = 0;\n\t\tthis.waitForAnswerTimeout = null;\n\n\t\tthis.#isCloudRecordFeaturesEnabled = CallSettingsManager.plainCallCloudRecordingEnabled;\n\n\t\tthis.#cloudRecordState = CloudRecordStatus.NONE;\n\n\t\tthis.#recorderState = RecorderStatus.UNAVAILABLE;\n\t\tthis.#copilotInitiator = false;\n\n\t\tthis.#recorderStateHasChange = false;\n\t\tthis._isCopilotFeaturesEnabled = CallSettingsManager.plainCallFollowUpEnabled;\n\n\t\tthis.#screenShared = false;\n\n\t\tEvent.bind(window, 'unload', this.#onUnloadHandler);\n\t\tEvent.bind(window, 'online', this.#onOnlineHandler);\n\t}\n\n\tget provider()\n\t{\n\t\treturn Provider.Plain;\n\t}\n\n\tget hasConnectionData()\n\t{\n\t\treturn Boolean(this.connectionData.mediaServerUrl && this.connectionData.roomData);\n\t}\n\n\tget isCopilotInitialized()\n\t{\n\t\treturn this.#recorderState !== RecorderStatus.UNAVAILABLE || this.#recorderStateHasChange;\n\t}\n\n\tget isCopilotActive()\n\t{\n\t\treturn this.#recorderState === RecorderStatus.ENABLED;\n\t}\n\n\tget isCopilotFeaturesEnabled()\n\t{\n\t\treturn this._isCopilotFeaturesEnabled;\n\t}\n\n\tset isCopilotFeaturesEnabled(isCopilotFeaturesEnabled)\n\t{\n\t\tif (isCopilotFeaturesEnabled !== this._isCopilotFeaturesEnabled)\n\t\t{\n\t\t\tthis._isCopilotFeaturesEnabled = isCopilotFeaturesEnabled;\n\t\t}\n\t}\n\n\tget isCopilotInitiator(): boolean\n\t{\n\t\treturn this.#copilotInitiator;\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\tget isCloudRecordFeaturesEnabled()\n\t{\n\t\treturn this.#isCloudRecordFeaturesEnabled;\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\tset isCloudRecordFeaturesEnabled(isCloudRecordFeaturesEnabled)\n\t{\n\t\tif (isCloudRecordFeaturesEnabled !== this.#isCloudRecordFeaturesEnabled)\n\t\t{\n\t\t\tthis.#isCloudRecordFeaturesEnabled = isCloudRecordFeaturesEnabled;\n\t\t}\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\tget isCloudRecordActive()\n\t{\n\t\treturn this.#cloudRecordState === CloudRecordStatus.STARTED;\n\t}\n\n\tget useMediaServer(): boolean\n\t{\n\t\treturn this.#connectionType === ConnectionType.MediaServer;\n\t}\n\n\tinitPeers(userIds)\n\t{\n\t\tlet peers = {};\n\t\tfor (let i = 0; i < userIds.length; i++)\n\t\t{\n\t\t\tconst userId = Number(userIds[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tpeers[userId] = this.createPeer(userId);\n\t\t}\n\t\treturn peers;\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tsignalingConnected: userId == this.initiatorId,\n\t\t\tisLegacyMobile: userId == this.initiatorId && this.callFromMobile,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t},\n\t\t\tonMediaStopped: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged.bind(this),\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout.bind(this),\n\t\t\tonRTCStatsReceived: this.#onPeerRTCStatsReceived.bind(this),\n\t\t\tonRTCQualityChanged: this.#onPeerRTCQualityChanged.bind(this),\n\t\t\tonNetworkProblem: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onNetworkProblem, e)\n\t\t\t},\n\t\t\tonReconnecting: (event) => {\n\t\t\t\tthis.#onCallReconnecting(event);\n\t\t\t},\n\t\t\tonReconnected: () =>\n\t\t\t{\n\t\t\t\tthis.#onCallReconnected();\n\t\t\t},\n\t\t\tonUpdateLastUsedCameraId: () =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUpdateLastUsedCameraId);\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * Returns call participants and their states\n\t * @return {object} userId => user state\n\t */\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\t\treturn result;\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tsetVideoEnabled = (event) => {\n\t\tif (this.videoEnabled == event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst tag = 'main';\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\t\tconst hasVideoTracks = this.localStreams[tag] && this.localStreams[tag].getVideoTracks().length > 0;\n\n\t\tif (this.ready && hasVideoTracks !== this.videoEnabled)\n\t\t{\n\t\t\tif (!this.videoEnabled)\n\t\t\t{\n\t\t\t\tCallStreamManager.stopStream(MediaStreamsKinds.Camera);\n\t\t\t}\n\n\t\t\tthis.replaceLocalMediaStream().then(() => {\n\t\t\t\tthis.signaling.sendCameraState(this.users, this.videoEnabled);\n\t\t\t}).catch(() => {\n\t\t\t\tconst kind = Util.MediaKind[MediaStreamsKinds.Camera];\n\t\t\t\tconst mediaRenderer = new MediaRenderer({ kind });\n\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\ttag,\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\tcanChangeMediaDevices()\n\t{\n\t\treturn !this.mediaMutedBySystem && !this.CallApi?.isMediaMutedBySystem;\n\t}\n\n\tsetMuted = (event) => {\n\t\tif (this.muted === event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\t\tconst tag = 'main';\n\t\tconst audioTrack = this.localStreams[tag]?.getAudioTracks()?.[0];\n\n\t\tif (this.muted && this.CallApi.isAudioPublished())\n\t\t{\n\t\t\tthis.CallApi.disableAudio({ calledFrom: 'setMuted' });\n\t\t}\n\t\telse if (!this.muted)\n\t\t{\n\t\t\tthis.CallApi.enableAudio({ calledFrom: 'setMuted' });\n\t\t}\n\n\t\tif (audioTrack)\n\t\t{\n\t\t\taudioTrack.enabled = !this.muted;\n\t\t}\n\n\t\tthis.signaling.sendMicrophoneState(this.users, !this.muted);\n\t\tthis.sendTalkingState();\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId === cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cameraId = cameraId;\n\t\tvoid this.CallApi?.switchActiveVideoDevice(this.cameraId);\n\n\t\tif (this.ready && this.mediaMutedBySystem)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onNeedResetMediaDevicesState);\n\t\t\tthis.changedMediaMutedBySystem(false);\n\t\t}\n\t\telse if (this.ready && Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.runCallback('onUpdateLastUsedCameraId');\n\t\t\tRuntime.debounce(this.replaceLocalMediaStream, 100, this)();\n\t\t}\n\t}\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId === microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\t\tvoid this.CallApi?.switchActiveAudioDevice(this.microphoneId);\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tif (this.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tRuntime.debounce(this.replaceLocalAudioStream, 100, this)();\n\t\t}\n\t}\n\n\tsetUseMediaServer(useMediaServer)\n\t{\n\t\tif (useMediaServer && !this.useMediaServer)\n\t\t{\n\t\t\tthis.#connectionType = ConnectionType.MediaServer;\n\t\t}\n\t\telse if (!useMediaServer && this.useMediaServer)\n\t\t{\n\t\t\tthis.#connectionType = ConnectionType.PeerToPeer;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.CallApi)\n\t\t{\n\t\t\tthis.CallApi.switchConnectionType(this.#connectionType);\n\t\t}\n\t\tthis.#updateOutgoingTracks();\n\n\t\tif (!useMediaServer)\n\t\t{\n\t\t\tthis.setRecorderState(RecorderStatus.PAUSED);\n\t\t}\n\t}\n\n\tgetCurrentMicrophoneId()\n\t{\n\t\tif (!this.localStreams['main'])\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\n\t\tconst audioTracks = this.localStreams['main'].getAudioTracks();\n\t\tif (audioTracks.length > 0)\n\t\t{\n\t\t\tconst audioTrackSettings = audioTracks[0].getSettings();\n\t\t\treturn audioTrackSettings.deviceId;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\t};\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\t/**\n\t * @param { Object } commonRecordState\n\t * @param { string } commonRecordState.action\n\t * @param { string } commonRecordState.type\n\t * @param { Date } commonRecordState.date\n\t */\n\tsendLocalRecordState(commonRecordState)\n\t{\n\t\tif (!this.updateCommonRecordState({ ...commonRecordState, senderId: this.userId }))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst users = [this.userId, ...this.users];\n\n\t\tthis.signaling.sendLocalRecordState(users, this.commonRecordState);\n\t}\n\n\tstopSendingStream(tag)\n\t{\n\t\t//todo: implement\n\t};\n\n\tallowVideoFrom(userList)\n\t{\n\t\t//todo: implement\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t **/\n\tinviteUsers(config: {users: number[], localStream: MediaStream, show?: boolean} = {})\n\t{\n\t\tconst users = Type.isArray(config.users) ? config.users : Object.keys(this.peers);\n\t\tthis.ready = true;\n\n\t\tif (config.localStream instanceof MediaStream && !this.localStreams[\"main\"])\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\tthis.subscribeHardwareChanges();\n\n\t\tthis.getLocalMediaStream(\"main\", true)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn this.attachToConference();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tif (!this.ready)\n\t\t\t\t{\n\t\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tclearTimeout(this.waitForAnswerTimeout);\n\t\t\t\tthis.waitForAnswerTimeout = setTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.#onNoAnswer();\n\t\t\t\t}, invitePeriod);\n\n\t\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst userId = Number(users[i]);\n\t\t\t\t\tif (!this.peers[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\t\t}\n\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t}\n\n\t\t\t\tif (config.userData && config.show)\n\t\t\t\t{\n\t\t\t\t\tthis.signaling.sendUsersInvited({\n\t\t\t\t\t\tusers: config.userData,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error(e);\n\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t\t});\n\t};\n\n\tattachToConference()\n\t{\n\t\tif (this.CallApi && this.CallApi.getState() === CALL_STATE.CONNECTED)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.CallApi = new Call(this.userId);\n\t\t\t\tthis.CallApi.needToStopStreams = false;\n\n\t\t\t\tif (!this.CallApi)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Error: could not create Plain call\");\n\t\t\t\t\treturn reject({code: \"PLAIN_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.bindCallEvents();\n\n\t\t\t\tthis.CallApi.on('Connected', () =>\n\t\t\t\t{\n\t\t\t\t\tthis.CallApi.on('Failed', this.#onCallDisconnected);\n\n\t\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\t\tlocal: true\n\t\t\t\t\t});\n\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\n\t\t\t\tthis.CallApi.on('Failed', (e) =>\n\t\t\t\t{\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\n\t\t\t\tif (!this.ready)\n\t\t\t\t{\n\t\t\t\t\treturn reject({code: \"PLAIN_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.CallApi.connect({\n\t\t\t\t\troomId: this.uuid,\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tvideoBitrate: 1_000_000,\n\t\t\t\t\tvideoSimulcast: true,\n\t\t\t\t\taudioDeviceId: this.microphoneId,\n\t\t\t\t\tvideoDeviceId: this.cameraId,\n\t\t\t\t\t...this.connectionData,\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t};\n\n\tbindCallEvents(): void\n\t{\n\t\tthis.CallApi.on('ParticipantJoined', this.#onParticipantJoined);\n\t\tthis.CallApi.on('ParticipantLeaved', this.#onParticipantLeaved);\n\t\tthis.CallApi.on('MessageReceived', this.#onCallMessageReceived);\n\t\tthis.CallApi.on('PublishSucceed', this.#onLocalMediaRendererAdded);\n\t\tthis.CallApi.on('PublishPaused', this.#onLocalMediaRendererMuteToggled);\n\t\tthis.CallApi.on('MediaMutedBySystem', this.#onMediaMutedBySystem);\n\t\tthis.CallApi.on('ToggleRemoteParticipantVideo', this.#onToggleRemoteParticipantVideo);\n\t\tthis.CallApi.on('TrackSubscriptionFailed', this.#onTrackSubscriptionFailed);\n\t\tthis.CallApi.on('RemoteMediaAdded', this.#onRemoteMediaAdded);\n\t\tthis.CallApi.on('RemoteMediaRemoved', this.#onRemoteMediaRemoved);\n\t\tthis.CallApi.on('RemoteMediaMuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.CallApi.on('RemoteMediaUnmuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.CallApi.on('VoiceStarted', this.#onEndpointVoiceStart);\n\t\tthis.CallApi.on('VoiceEnded', this.#onEndpointVoiceEnd);\n\t\tthis.CallApi.on('RecorderStatusChanged', this.#onRecorderStatusChanged);\n\t\tthis.CallApi.on('CloudRecordStatusChanged', this.#onCloudRecordStatusChanged);\n\t\tthis.CallApi.on('Reconnecting', this.#onCallReconnecting);\n\t\tthis.CallApi.on('Reconnected', this.#onCallReconnected);\n\t\tthis.CallApi.on('ReconnectingFailed', this.#onCallReconnectingFailed);\n\t\tthis.CallApi.on('Disconnected', this.#onCallDisconnected);\n\t\tthis.CallApi.on('CallStatsReceived', this.#onCallStatsReceived);\n\t\tthis.CallApi.on('ConnectionQualityChanged', this.#onConnectionQualityChanged);\n\t\tthis.CallApi.on('ConnectionTypeChanged', this.#onConnectionTypeChanged);\n\t}\n\n\tremoveCallEvents(): void\n\t{\n\t\tif (this.CallApi)\n\t\t{\n\t\t\tthis.CallApi.on('ParticipantJoined', BX.DoNothing);\n\t\t\tthis.CallApi.on('ParticipantLeaved', BX.DoNothing);\n\t\t\tthis.CallApi.on('MessageReceived', BX.DoNothing);\n\t\t\tthis.CallApi.on('PublishSucceed', BX.DoNothing);\n\t\t\tthis.CallApi.on('PublishPaused', BX.DoNothing);\n\t\t\tthis.CallApi.on('MediaMutedBySystem', BX.DoNothing);\n\t\t\tthis.CallApi.on('ToggleRemoteParticipantVideo', BX.DoNothing);\n\t\t\tthis.CallApi.on('TrackSubscriptionFailed', BX.DoNothing);\n\t\t\tthis.CallApi.on('RemoteMediaAdded', BX.DoNothing);\n\t\t\tthis.CallApi.on('RemoteMediaRemoved', BX.DoNothing);\n\t\t\tthis.CallApi.on('RemoteMediaMuted', BX.DoNothing);\n\t\t\tthis.CallApi.on('RemoteMediaUnmuted', BX.DoNothing);\n\t\t\tthis.CallApi.on('VoiceStarted', BX.DoNothing);\n\t\t\tthis.CallApi.on('VoiceEnded', BX.DoNothing);\n\t\t\tthis.CallApi.on('RecorderStatusChanged', BX.DoNothing);\n\t\t\tthis.CallApi.on('CloudRecordStatusChanged', BX.DoNothing);\n\t\t\tthis.CallApi.on('Reconnecting', BX.DoNothing);\n\t\t\tthis.CallApi.on('Reconnected', BX.DoNothing);\n\t\t\tthis.CallApi.on('ReconnectingFailed', BX.DoNothing);\n\t\t\tthis.CallApi.on('Disconnected', BX.DoNothing);\n\t\t\tthis.CallApi.on('CallStatsReceived', this.#onCallStatsReceived);\n\t\t\tthis.CallApi.on('ConnectionQualityChanged', BX.DoNothing);\n\t\t\tthis.CallApi.on('Failed', BX.DoNothing);\n\t\t\tthis.CallApi.on('ConnectionTypeChanged', BX.DoNothing);\n\t\t}\n\t}\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tgetMediaConstraints(options = {})\n\t{\n\t\tconst audio = {};\n\t\tconst video = options.videoEnabled ? {} : false;\n\t\tconst hdVideo = !!options.hdVideo;\n\t\tconst supportedConstraints = navigator.mediaDevices.getSupportedConstraints ? navigator.mediaDevices.getSupportedConstraints() : {};\n\n\t\tif (this.microphoneId)\n\t\t{\n\t\t\taudio.deviceId = { exact: this.microphoneId };\n\t\t}\n\n\t\tif (!this.enableMicAutoParameters)\n\t\t{\n\t\t\tif (supportedConstraints.echoCancellation)\n\t\t\t{\n\t\t\t\taudio.echoCancellation = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.noiseSuppression)\n\t\t\t{\n\t\t\t\taudio.noiseSuppression = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.autoGainControl)\n\t\t\t{\n\t\t\t\taudio.autoGainControl = false;\n\t\t\t}\n\t\t}\n\n\t\tif (video)\n\t\t{\n\t\t\t//video.aspectRatio = 1.7777777778;\n\t\t\tif (this.cameraId)\n\t\t\t{\n\t\t\t\tvideo.deviceId = {exact: this.cameraId};\n\t\t\t}\n\n\t\t\tif (hdVideo)\n\t\t\t{\n\t\t\t\tvideo.width = {ideal: 1280};\n\t\t\t\tvideo.height = {ideal: 720};\n\t\t\t}\n\t\t}\n\n\t\treturn {audio: audio, video: video};\n\t};\n\n\t/**\n\t * Recursively tries to get user media stream with array of constraints\n\t *\n\t * @param constraintsArray array of constraints objects\n\t * @returns {Promise}\n\t */\n\tasync getUserMedia(constraintsArray): Promise<MediaStream>\n\t{\n\t\tconst currentConstraints = constraintsArray[0];\n\n\t\ttry\n\t\t{\n\t\t\treturn await CallStreamManager.getUserMedia(currentConstraints);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.log('getUserMedia error: ', error);\n\t\t\tthis.log('Current constraints', currentConstraints);\n\n\t\t\tif (constraintsArray.length > 1)\n\t\t\t{\n\t\t\t\treturn this.getUserMedia(constraintsArray.slice(1));\n\t\t\t}\n\n\t\t\tthis.log('Last fallback constraints used, failing');\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tgetLocalMediaStream(tag, fallbackToAudio)\n\t{\n\t\tif (!Type.isStringFilled(tag))\n\t\t{\n\t\t\ttag = 'main';\n\t\t}\n\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tconst track = CallStreamManager.getLocalStream(MediaStreamsKinds.Camera);\n\t\t\tconst kind = Util.MediaKind[MediaStreamsKinds.Camera];\n\t\t\tconst mediaRenderer = new MediaRenderer({ kind, track });\n\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag,\n\t\t\t\tmediaRenderer,\n\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t});\n\n\t\t\treturn Promise.resolve(this.localStreams[tag]);\n\t\t}\n\n\t\tthis.log('Requesting access to media devices');\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst constraintsArray = [];\n\t\t\tif (Hardware.isCameraOn)\n\t\t\t{\n\t\t\t\tconstraintsArray.push(\n\t\t\t\t\tthis.getMediaConstraints({ videoEnabled: true, hdVideo: true }),\n\t\t\t\t\tthis.getMediaConstraints({ videoEnabled: true, hdVideo: false }),\n\t\t\t\t);\n\n\t\t\t\tif (fallbackToAudio)\n\t\t\t\t{\n\t\t\t\t\tconstraintsArray.push(this.getMediaConstraints({ videoEnabled: false }));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({ videoEnabled: false }));\n\t\t\t}\n\n\t\t\tthis.getUserMedia(constraintsArray).then((mediaStream) => {\n\t\t\t\tthis.log('Local media stream received');\n\t\t\t\tconst stream = mediaStream.clone();\n\t\t\t\tthis.localStreams[tag] = stream;\n\t\t\t\tstream.getVideoTracks().forEach((track) => {\n\t\t\t\t\ttrack.addEventListener('ended', () => this.onLocalVideoTrackEnded());\n\t\t\t\t\ttrack.addEventListener('mute', () => this.onLocalVideoTrackMute());\n\t\t\t\t\ttrack.addEventListener('unmute', () => this.onLocalVideoTrackUnmute());\n\t\t\t\t});\n\n\t\t\t\tstream.getAudioTracks().forEach((track) => {\n\t\t\t\t\ttrack.addEventListener('ended', () => this.onLocalAudioTrackEnded());\n\t\t\t\t});\n\n\t\t\t\tconst track = CallStreamManager.getLocalStream(MediaStreamsKinds.Camera);\n\t\t\t\tconst kind = Util.MediaKind[MediaStreamsKinds.Camera];\n\t\t\t\tconst mediaRenderer = new MediaRenderer({ kind, track });\n\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\ttag,\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t});\n\t\t\t\tthis.setPublishingState(MediaStreamsKinds.Camera, true);\n\n\t\t\t\tif (tag === 'main')\n\t\t\t\t{\n\t\t\t\t\tthis.attachVoiceDetection();\n\t\t\t\t\tif (Hardware.isMicrophoneMuted)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\tif (audioTracks[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTracks[0].enabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.deviceList.length === 0)\n\t\t\t\t{\n\t\t\t\t\tHardware.getCurrentDeviceList().then((deviceList) => {\n\t\t\t\t\t\tthis.deviceList = deviceList;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onDeviceListUpdated, {\n\t\t\t\t\t\t\tdeviceList: this.deviceList,\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tresolve(this.localStreams[tag]);\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.log('Could not get local media stream.', error);\n\t\t\t\tthis.log('Request constraints: .', constraintsArray);\n\t\t\t\tthis.runCallback('onLocalMediaError', { tag, error });\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t}\n\n\tgetLocalAudioStream(tag, fallbackToAudio)\n\t{\n\t\tif (!Type.isStringFilled(tag))\n\t\t{\n\t\t\ttag = 'main';\n\t\t}\n\t\tif (this.localStreams[tag] && this.localStreams[tag].getAudioTracks().length)\n\t\t{\n\t\t\treturn Promise.resolve(this.localStreams[tag]);\n\t\t}\n\n\t\tthis.log(\"Requesting access to audio devices\");\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet constraintsArray = [this.getMediaConstraints({videoEnabled: false})];\n\n\t\t\tthis.getUserMedia(constraintsArray).then((stream) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Local audio stream received\");\n\n\t\t\t\tif (!this.localStreams[tag]) {\n\t\t\t\t\tthis.localStreams[tag] = new MediaStream();\n\t\t\t\t}\n\n\t\t\t\tthis.localStreams[tag].addTrack(stream.getAudioTracks()[0]);\n\t\t\t\tstream.getAudioTracks().forEach((track) =>\n\t\t\t\t{\n\t\t\t\t\ttrack.addEventListener(\"ended\", () => this.onLocalAudioTrackEnded())\n\t\t\t\t});\n\n\t\t\t\tif (tag === 'main')\n\t\t\t\t{\n\t\t\t\t\tthis.attachVoiceDetection();\n\t\t\t\t\tif (this.muted)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\tif (audioTracks[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTracks[0].enabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.deviceList.length === 0)\n\t\t\t\t{\n\t\t\t\t\tHardware.getCurrentDeviceList().then((deviceList) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceList = deviceList;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onDeviceListUpdated, {\n\t\t\t\t\t\t\tdeviceList: this.deviceList\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tresolve(this.localStreams[tag]);\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Could not get local audio stream.\", e);\n\t\t\t\tthis.log(\"Request constraints: .\", constraintsArray);\n\t\t\t\tthis.runCallback(\"onLocalMediaError\", {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tsetRecorderState(state)\n\t{\n\t\tif (!this.CallApi || this.#recorderState === state)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (state === RecorderStatus.ENABLED)\n\t\t{\n\t\t\tthis.#copilotInitiator = true;\n\t\t}\n\t\telse if (state === RecorderStatus.DISABLED && state === RecorderStatus.DESTROYED)\n\t\t{\n\t\t\tthis.#copilotInitiator = false;\n\t\t}\n\n\t\tif (state === RecorderStatus.ENABLED && !this.useMediaServer)\n\t\t{\n\t\t\tthis.setUseMediaServer(true);\n\t\t}\n\n\t\tthis.CallApi.setRecorderState(state);\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\tsetCloudRecordState(state, kind = null)\n\t{\n\t\tif (!this.CallApi || this.#cloudRecordState === state)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (state === CloudRecordStatus.STARTED && !this.useMediaServer)\n\t\t{\n\t\t\tthis.setUseMediaServer(true);\n\t\t}\n\n\t\tthis.CallApi.setCloudRecordState(state, kind);\n\t}\n\n\tsetPublishingState(deviceType, publishing)\n\t{\n\t\tif (deviceType === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCameraPublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t\telse if (deviceType === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onMicrophonePublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t}\n\n\tsetMainStream(users)\n\t{\n\t\tif (!this.CallApi)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (users.userId && users.userId !== this.userId)\n\t\t{\n\t\t\tconst participant = this.peers[users.userId]?.participant;\n\t\t\tconst kind = participant?.screenSharingEnabled ? MediaStreamsKinds.Screen : MediaStreamsKinds.Camera;\n\t\t\tthis.CallApi.setMainStream(users, kind);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.CallApi.resetMainStream(users);\n\t\t}\n\t}\n\n\tstartMediaCapture()\n\t{\n\t\treturn this.getLocalMediaStream();\n\t};\n\n\tattachVoiceDetection()\n\t{\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t}\n\t\tif (this.microphoneLevelInterval)\n\t\t{\n\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tthis.voiceDetection = new SimpleVAD({\n\t\t\t\tmediaStream: this.localStreams['main'],\n\t\t\t\tonVoiceStarted: this.onLocalVoiceStarted.bind(this),\n\t\t\t\tonVoiceStopped: this.onLocalVoiceStopped.bind(this)\n\t\t\t})\n\n\t\t\tthis.microphoneLevelInterval = setInterval(function ()\n\t\t\t{\n\t\t\t\tthis.microphoneLevel = this.voiceDetection.currentVolume;\n\t\t\t}.bind(this), 200)\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Could not attach voice detection to media stream');\n\t\t}\n\t};\n\n\tgetDisplayMedia(): Promise<MediaStream>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCallStreamManager.getUserScreen().then((stream) => {\n\t\t\t\tresolve(stream);\n\t\t\t}).catch((error) => {\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t}\n\n\tstartScreenSharing(changeSource: boolean): void\n\t{\n\t\tif (this.localStreams.screen && !changeSource)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getDisplayMedia().then((mediaStream) => {\n\t\t\tthis.#screenShared = true;\n\t\t\tconst stream = mediaStream.clone();\n\t\t\tthis.localStreams.screen = stream;\n\n\t\t\tstream.getVideoTracks().forEach((track) => {\n\t\t\t\tEvent.bind(track, 'ended', () => this.stopScreenSharing());\n\t\t\t});\n\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tscreenState: true,\n\t\t\t});\n\n\t\t\tif (this.ready)\n\t\t\t{\n\t\t\t\tconst peers = Object.values(this.peers);\n\t\t\t\tpeers.forEach((peer) => {\n\t\t\t\t\tif (peer.calculatedState === UserState.Connected)\n\t\t\t\t\t{\n\t\t\t\t\t\tpeer.sendMedia();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}).catch((error) => {\n\t\t\tthis.log(error);\n\t\t});\n\t}\n\n\tonLocalVideoTrackEnded()\n\t{\n\t\tconst tag = 'main';\n\t\tif (!this.localStreams[tag])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#screenShared = false;\n\t\tUtil.stopMediaStreamVideoTracks(this.localStreams[tag]);\n\n\t\tconst kind = Util.MediaKind[MediaStreamsKinds.Camera];\n\t\tconst mediaRenderer = new MediaRenderer({ kind });\n\n\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\ttag,\n\t\t\tmediaRenderer,\n\t\t\tstream: mediaRenderer.stream,\n\t\t});\n\n\t\tif (this.localStreams[tag].getAudioTracks().length === 0)\n\t\t{\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t}\n\n\tonLocalAudioTrackEnded()\n\t{\n\t\tif (!this.localStreams.main)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.stopMediaStreamAudioTracks(this.localStreams.main);\n\n\t\tif (this.localStreams.main.getVideoTracks().length === 0)\n\t\t{\n\t\t\tthis.localStreams.main = null;\n\t\t}\n\n\t\tObject.values(this.peers).forEach((peer) => {\n\t\t\tif (peer.calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tpeer.sendMedia();\n\t\t\t}\n\t\t});\n\t}\n\n\tonLocalVideoTrackMute()\n\t{\n\t\tthis.changedMediaMutedBySystem(true);\n\t\tthis.prevMainStream = this.localStreams['main'];\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.localStreams['main'] = null;\n\t\t\tfor (let userId in this.peers)\n\t\t\t{\n\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId].replaceMediaStream('main');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tonLocalVideoTrackUnmute()\n\t{\n\t\tthis.changedMediaMutedBySystem(false);\n\n\t\tif (this.prevMainStream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.prevMainStream);\n\t\t\tthis.prevMainStream = null;\n\t\t}\n\n\t\tthis.replaceLocalMediaStream().catch(() =>\n\t\t{\n\t\t\tconst track = CallStreamManager.getLocalStream(MediaStreamsKinds.Camera);\n\t\t\tconst kind = Util.MediaKind[MediaStreamsKinds.Camera];\n\t\t\tconst mediaRenderer = new MediaRenderer({ kind, track });\n\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: 'main',\n\t\t\t\tmediaRenderer,\n\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t});\n\t\t});\n\t};\n\n\tchangedMediaMutedBySystem(muted)\n\t{\n\t\tif (muted === this.mediaMutedBySystem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaMutedBySystem = muted;\n\t\tthis.#onMediaMutedBySystem(muted);\n\t}\n\n\tstopScreenSharing()\n\t{\n\t\tconst tag = 'screen';\n\t\tconst stream = this.localStreams[tag];\n\n\t\tif (!stream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#screenShared = false;\n\t\tUtil.stopMediaStream(stream);\n\t\tCallStreamManager.stopStream(MediaStreamsKinds.Screen);\n\t\tCallStreamManager.stopStream(MediaStreamsKinds.ScreenAudio);\n\n\t\tthis.localStreams[tag] = null;\n\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\tuserId: this.userId,\n\t\t\tscreenState: false,\n\t\t});\n\n\t\tObject.values(this.peers).forEach((peer: Peer) => {\n\t\t\tif (peer.calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tpeer.sendMedia();\n\t\t\t}\n\t\t});\n\t}\n\n\tisScreenSharingStarted(): boolean\n\t{\n\t\treturn this.#screenShared;\n\t}\n\n\tonLocalVoiceStarted()\n\t{\n\t\tthis.talking = true;\n\t\tthis.sendTalkingState();\n\t};\n\n\tonLocalVoiceStopped()\n\t{\n\t\tthis.talking = false;\n\t\tthis.sendTalkingState();\n\t};\n\n\tsendTalkingState()\n\t{\n\t\tif (this.talking && !Hardware.isMicrophoneMuted)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStarted({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStopped({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t * @param { Object } commonRecordState\n\t * @param { string } commonRecordState.action\n\t * @param { string } commonRecordState.type\n\t * @param { Date } commonRecordState.date\n\t * @param { boolean } force\n\t */\n\tsendLocalRecordState(commonRecordState, force = false)\n\t{\n\t\tif (!force && !this.updateCommonRecordState({ ...commonRecordState, senderId: this.userId }))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.signaling.sendLocalRecordState(this.userId, this.commonRecordState);\n\t}\n\n\tsendCustomMessage(message)\n\t{\n\t\tthis.signaling.sendCustomMessage({\n\t\t\tuserId: this.users,\n\t\t\tmessage: message\n\t\t});\n\t}\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool} [config.useVideo]\n\t * @param {bool} [config.enableMicAutoParameters]\n\t * @param {MediaStream} [config.localStream]\n\t */\n\tanswer(config)\n\t{\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\t\t/*if(this.direction !== Direction.Incoming)\n\t\t{\n\t\t\tthrow new Error('Only incoming call could be answered');\n\t\t}*/\n\n\t\tthis.ready = true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\t\tthis.enableMicAutoParameters = (config.enableMicAutoParameters !== false);\n\n\t\tif (config.localStream instanceof MediaStream)\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\tthis.getLocalMediaStream(\"main\", true)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\treturn this.attachToConference();\n\t\t\t\t})\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tif (!this.ready)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\t\t});\n\t};\n\n\tdecline(code, reason)\n\t{\n\t\tthis.ready = false;\n\n\t\tlet data = {\n\t\t\tcallUuid: this.uuid,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.decline, data).then(() =>\n\t\t{\n\t\t\tthis.destroy();\n\t\t});\n\t};\n\n\thangup(force: boolean = false): Promise<void>\n\t{\n\t\tif (!this.ready && !force)\n\t\t{\n\t\t\tconst error = new Error('Hangup in wrong state');\n\t\t\tthis.log(error);\n\n\t\t\treturn Promise.reject(error);\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = 'Call stack:';\n\t\tthis.log(`Hangup received \\n${tempError.stack}`);\n\n\t\tthis.ready = false;\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.connectionData = {};\n\t\tthis.#screenShared = false;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst peers = Object.values(this.peers);\n\t\t\tpeers.forEach((peer) => {\n\t\t\t\tpeer.disconnect();\n\t\t\t});\n\n\t\t\tthis.#beforeLeaveCall();\n\n\t\t\tthis.runCallback(CallEvent.onLeave, { local: true });\n\t\t});\n\t}\n\n\tgetState()\n\t{\n\n\t};\n\n\treplaceLocalMediaStream(tag: string = \"main\")\n\t{\n\t\tthis.setPublishingState(MediaStreamsKinds.Camera, true);\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalMediaStream(tag).then(() =>\n\t\t\t{\n\t\t\t\tif (this.ready)\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.peers[userId].replaceMediaStream(tag);\n\t\t\t\t\t\t\tif (this.mediaMutedBySystem)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.changedMediaMutedBySystem(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error('Could not get access to hardware; don\\'t really know what to do. error:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\treplaceLocalAudioStream(tag: string = \"main\")\n\t{\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tUtil.stopMediaStreamAudioTracks(this.localStreams[tag]);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalAudioStream(tag).then(() =>\n\t\t\t{\n\t\t\t\tif (this.ready)\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.peers[userId].replaceMediaStream(tag);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error('Could not get access to hardware; don\\'t really know what to do. error:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tsendAllStreams(userId)\n\t{\n\t\tif (!this.peers[userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[userId].isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t};\n\n\t#updateOutgoingTracks(): void\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const peer of Object.values(this.peers))\n\t\t{\n\t\t\tif (peer.calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tpeer.sendMedia();\n\t\t\t}\n\t\t}\n\t}\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Object} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let id in users)\n\t\t{\n\t\t\tconst userId = Number(id);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\tuserId: userId,\n\t\t\t\t\tuserData: {[userId]: users[id]},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.peers[userId].calculatedState !== UserState.Calling)\n\t\t\t{\n\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t}\n\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onNoAnswer()\n\t{\n\t\tif (this.ready && !this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.destroy(true);\n\t\t}\n\t}\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tconst handlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer.bind(this),\n\t\t\t'Call::hangup': this.#onPullEventHangup.bind(this),\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined.bind(this),\n\t\t\t'Call::associatedEntityReplaced': this.#onPullEventAssociatedEntityReplaced.bind(this),\n\t\t\t'Call::finish': this.#onPullEventFinish.bind(this),\n\t\t\t'Call::customMessage': this.#onPullEventCallCustomMessage.bind(this),\n\t\t};\n\n\t\tif (handlers[command])\n\t\t{\n\t\t\tif (command !== 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\thandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addInvitedUsers(users);\n\t};\n\n\t#onPullEventAnswer(params)\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.#onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peers[senderId].isReady())\n\t\t{\n\t\t\tthis.log(\"Received answer for user \" + senderId + \" in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].setSignalingConnected(true);\n\t\tthis.peers[senderId].setReady(true);\n\t\tthis.peers[senderId].isLegacyMobile = params.isLegacyMobile === true;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.sendAllStreams(senderId);\n\t\t}\n\t};\n\n\t#onPullEventAnswerSelf(params)\n\t{\n\t\tthis.runCallback('onGetUserMediaEnded', {});\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.log(\"Received remote self-answer in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.log(\"Call was answered elsewhere\");\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup(params)\n\t{\n\t\tconst senderId = params.senderId;\n\n\t\tif (this.userId == senderId)\n\t\t{\n\t\t\tif (this.instanceId != params.callInstanceId)\n\t\t\t{\n\t\t\t\t// self hangup elsewhere\n\t\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId] || this.peers[senderId].participant)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].disconnect(params.code);\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\n\t\tif (!this.isAnyoneParticipating() && this.ready)\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventNegotiationNeeded(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst peer: Peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tif (params.restart)\n\t\t{\n\t\t\tpeer.reconnect({ reconnectionReason: 'GOT_PULL_EVENT_NEGOTIATION_NEEDED' });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpeer.onNegotiationNeeded();\n\t\t}\n\t};\n\n\t#onPullEventConnectionOffer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionOffer(params.connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventConnectionAnswer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst connectionId = params.connectionId;\n\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionAnswer(connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventIceCandidate(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tlet candidates;\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tcandidates = params.candidates;\n\t\t\tfor (let i = 0; i < candidates.length; i++)\n\t\t\t{\n\t\t\t\tpeer.addIceCandidate(params.connectionId, candidates[i]);\n\t\t\t}\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Error parsing serialized candidate: ', e);\n\t\t}\n\t};\n\n\t#onPullEventVoiceStarted(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventVoiceStopped(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventMicrophoneState(params)\n\t{\n\t\tif (params.senderId == this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\tuserId: params.senderId,\n\t\t\tmicrophoneState: params.microphoneState,\n\t\t});\n\t}\n\n\t#onPullEventCameraState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\tuserId: params.senderId,\n\t\t\tcameraState: params.cameraState\n\t\t})\n\t};\n\n\t#onPullEventVideoPaused(params)\n\t{\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\tuserId: params.senderId,\n\t\t\tvideoPaused: params.videoPaused\n\t\t});\n\n\t\tpeer.holdOutgoingVideo(!!params.videoPaused);\n\t};\n\n\t#onPullEventRecordState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserCommonRecordState, {\n\t\t\tuserId: params.senderId,\n\t\t\tcommonRecordState: params.commonRecordState\n\t\t});\n\t}\n\n\t#onPullEventAssociatedEntityReplaced(params)\n\t{\n\t\tif (params.call && params.call.ASSOCIATED_ENTITY)\n\t\t{\n\t\t\tthis.associatedEntity = params.call.ASSOCIATED_ENTITY;\n\t\t}\n\t};\n\n\t#onPullEventFinish()\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventCallCustomMessage(params)\n\t{\n\t\tthis.runCallback(CallEvent.onCustomMessage, {message: params.message});\n\t}\n\n\t#onPeerStateChanged(e)\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (e.state == UserState.Failed || e.state == UserState.Unavailable)\n\t\t{\n\t\t\tif (!this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup().then(this.destroy.bind(this)).catch(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\t//this.runCallback(Event.onCallFailure, e);\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState([e.userId], !Hardware.isMicrophoneMuted);\n\t\t\tthis.signaling.sendCameraState(e.userId, Hardware.isCameraOn);\n\t\t\tthis.wasConnected = true;\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout(e)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t};\n\n\t#onPeerRTCStatsReceived(event)\n\t{\n\t\tif (this.useMediaServer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst remoteReportsToShow = {};\n\t\tconst localReportsToShow = {};\n\n\t\tevent.stats.forEach((report) => {\n\t\t\tif (report.type === 'inbound-rtp' && (report.kind === 'video' || report.kind === 'audio') && report.source)\n\t\t\t{\n\t\t\t\tremoteReportsToShow[report.source] = report;\n\t\t\t}\n\n\t\t\tif (report.type === 'outbound-rtp' && (report.kind === 'video' || report.kind === 'audio') && report.source)\n\t\t\t{\n\t\t\t\tlocalReportsToShow[report.source] = report;\n\t\t\t}\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\tuserId: event.userId,\n\t\t\treport: remoteReportsToShow,\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\tuserId: this.userId,\n\t\t\treport: localReportsToShow,\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onRTCStatsReceived, event);\n\t}\n\n\t#onPeerRTCQualityChanged(e)\n\t{\n\t\tthis.runCallback(CallEvent.onConnectionQualityChanged, {\n\t\t\tuserId: e.userId,\n\t\t\tscore: e.score,\n\t\t});\n\t}\n\n\t#getPeerForMedia(participant, track): ?Peer\n\t{\n\t\tlet peer = null;\n\n\t\tif (!participant || !track)\n\t\t{\n\t\t\treturn peer;\n\t\t}\n\n\t\tconst userId = participant.userId;\n\t\tconst kind = Util.MediaKind[track.source];\n\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Unknown kind for mediaRenderer: ${track.source} for user: ${userId}`);\n\n\t\t\treturn peer;\n\t\t}\n\n\t\tpeer = this.peers[userId];\n\n\t\treturn peer;\n\t}\n\n\t#onParticipantJoined = (participant) => {\n\t\tclearTimeout(this.waitForAnswerTimeout);\n\t\tconst userId = parseInt(participant.userId, 10);\n\t\tlet peer = this.peers[userId];\n\n\t\tif (!peer)\n\t\t{\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\n\t\t\tpeer = this.createPeer(userId);\n\t\t\tpeer.participant = participant;\n\t\t\tthis.peers[userId] = peer;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserJoined, {\n\t\t\tuserId,\n\t\t\tuserData: {\n\t\t\t\t[userId]: {\n\t\t\t\t\tname: participant.name,\n\t\t\t\t\tavatar_hr: participant.image,\n\t\t\t\t\tavatar: participant.image,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tpeer.setSignalingConnected(true);\n\t\tpeer.setReady(true);\n\n\t\tif (this.ready && !peer.isInitiator())\n\t\t{\n\t\t\tthis.log('waiting for the other side to send connection offer');\n\t\t\tpeer.sendNegotiationNeeded(false);\n\t\t}\n\n\t\tif (this.commonRecordState.state !== CallCommonRecordState.Stopped && this.commonRecordState.userId === this.userId)\n\t\t{\n\t\t\tthis.signaling.sendLocalRecordState(this.userId, this.commonRecordState);\n\t\t}\n\t};\n\n\t#onParticipantLeaved = (participant) => {\n\t\tconst peer = this.peers[participant.userId];\n\t\tpeer?.setReady(false);\n\t};\n\n\t#onCallMessageReceived = (event) => {\n\t\tlet message = '';\n\n\t\ttry\n\t\t{\n\t\t\tmessage = JSON.parse(event.text);\n\t\t\tmessage = Util.deepParseJSON(message);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.log('Could not parse scenario message.', error);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventName = message.eventName;\n\n\t\tswitch (eventName)\n\t\t{\n\t\t\tcase clientEvents.connectionOffer:\n\t\t\t\tthis.#onPullEventConnectionOffer(message);\n\t\t\t\tbreak;\n\n\t\t\tcase clientEvents.connectionAnswer:\n\t\t\t\tthis.#onPullEventConnectionAnswer(message);\n\t\t\t\tbreak;\n\n\t\t\tcase clientEvents.negotiationNeeded:\n\t\t\t\tthis.#onPullEventNegotiationNeeded(message);\n\t\t\t\tbreak;\n\n\t\t\tcase clientEvents.iceCandidate:\n\t\t\t\tthis.#onPullEventIceCandidate(message);\n\t\t\t\tbreak;\n\n\t\t\tcase clientEvents.microphoneState:\n\t\t\t\tthis.#onPullEventMicrophoneState(message);\n\t\t\t\tbreak;\n\n\t\t\tcase clientEvents.cameraState:\n\t\t\t\tthis.#onPullEventCameraState(message);\n\t\t\t\tbreak;\n\n\t\t\tcase clientEvents.voiceStarted:\n\t\t\t\tthis.#onPullEventVoiceStarted(message);\n\t\t\t\tbreak;\n\n\t\t\tcase clientEvents.voiceStopped:\n\t\t\t\tthis.#onPullEventVoiceStopped(message);\n\t\t\t\tbreak;\n\n\t\t\tcase clientEvents.videoPaused:\n\t\t\t\tthis.#onPullEventVideoPaused(message);\n\t\t\t\tbreak;\n\n\t\t\tcase clientEvents.commonRecordState:\n\t\t\t\tthis.#onPullEventRecordState(message);\n\t\t\t\tbreak;\n\n\t\t\tcase clientEvents.usersInvited:\n\t\t\t\tthis.#onPullEventUsersInvited(message);\n\t\t\t\tbreak;\n\n\t\t\tcase clientEvents.customMessage:\n\t\t\t\tthis.runCallback(CallEvent.onCustomMessage, {\n\t\t\t\t\tmessage: message.message,\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthis.log(`Unknown scenario event ${eventName}`);\n\t\t}\n\t};\n\n\t#onLocalMediaRendererAdded = (event) => {\n\t\tconst kind = Util.MediaKind[event];\n\n\t\tif (!kind || this.useMediaServer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (event)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.CallApi.disableAudio({ calledFrom: 'onLocalMediaRendererAdded' });\n\t\t\t\tbreak;\n\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.CallApi.disableVideo({ calledFrom: 'onLocalMediaRendererAdded' });\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t}\n\t};\n\n\t#onLocalMediaRendererMuteToggled = (source, muted) => {\n\t\tif (source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\t// this.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\tthis.signaling.sendMicrophoneState(this.users, !muted);\n\t\t}\n\t\telse if (source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\t// this.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t}\n\t};\n\n\t#onMediaMutedBySystem = (muted) => {\n\t\tconst microphoneState = muted ? false : !Hardware.isMicrophoneMuted;\n\t\tconst cameraState = muted ? false : Hardware.isCameraOn;\n\t\tthis.signaling.sendMicrophoneState(this.users, microphoneState);\n\t\tthis.signaling.sendCameraState(this.users, cameraState);\n\t};\n\n\t#onToggleRemoteParticipantVideo = (isVideoShown) => {\n\t\tthis.runCallback(\n\t\t\tCallEvent.onToggleRemoteParticipantVideo,\n\t\t\t{ isVideoShown },\n\t\t);\n\t};\n\n\t#onTrackSubscriptionFailed = (params) => {\n\t\tthis.runCallback(CallEvent.onTrackSubscriptionFailed, params);\n\t};\n\n\t#onRemoteMediaAdded = (participant, track) => {\n\t\tif (!this.useMediaServer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst peer = this.#getPeerForMedia(participant, track);\n\n\t\tif (!peer)\n\t\t{\n\t\t\tthis.log(`Unknown user: ${participant.userId}`);\n\t\t}\n\n\t\tpeer.addMediaRenderer({ track: track.track });\n\t\tthis.log(`[RemoteMediaAdded]: UserId: ${participant.userId}, source: ${Util.MediaKind[track.source]}`);\n\t};\n\n\t#onRemoteMediaRemoved = (participant, track) => {\n\t\tif (!this.useMediaServer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst peer = this.#getPeerForMedia(participant, track);\n\n\t\tif (!peer)\n\t\t{\n\t\t\tthis.log(`Unknown user: ${participant.userId}`);\n\t\t}\n\n\t\tpeer.removeMediaRenderer({ track: track.track });\n\t\tthis.log(`[RemoteMediaRemoved]: UserId: ${participant.userId}, source: ${Util.MediaKind[track.source]}`);\n\t};\n\n\t#onRemoteMediaMuteToggled = (participant, track) => {\n\t\tif (!this.useMediaServer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (track.source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tconst userId = parseInt(participant.userId, 10);\n\t\t\tconst peer = this.peers[userId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.addMediaRenderer({ track: track.track });\n\t\t\t}\n\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId,\n\t\t\t\tmicrophoneState: !participant.isMutedAudio,\n\t\t\t});\n\t\t}\n\t};\n\n\t#onEndpointVoiceStart = (participant) => {\n\t\tconst userId = participant.userId;\n\n\t\t// for local user we need to send extra signal to show unmute hint\n\t\tif (userId === this.userId)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, { userId, local: true });\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, { userId });\n\t};\n\n\t#onEndpointVoiceEnd = (participant) => {\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, { userId: participant.userId });\n\t};\n\n\t/**\n\t * @param {Object} status\n\t * @param {RecorderStatus} status.code\n\t * @param {string} status.errMsg\n\t */\n\t#onRecorderStatusChanged = ({ code, errMsg }) => {\n\t\tconst ignoreError = [RecorderStatus.DESTROYED, RecorderStatus.UNAVAILABLE].includes(code);\n\t\tconst error = ignoreError ? '' : errMsg;\n\t\tthis.#recorderState = error ? this.#recorderState : code;\n\t\tconst isCopilotActive = this.#recorderState === RecorderStatus.ENABLED;\n\t\tthis.#recorderStateHasChange = true;\n\n\t\tif ([RecorderStatus.DISABLED, RecorderStatus.DESTROYED, RecorderStatus.UNAVAILABLE].includes(code))\n\t\t{\n\t\t\tthis.#copilotInitiator = false;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onRecorderStatusChanged, {\n\t\t\tcode,\n\t\t\terror,\n\t\t\tisCopilotActive,\n\t\t});\n\t};\n\n\t/**\n\t * @group CommonRecord\n\t */\n\n\t/**\n\t * @typedef { Object } CloudRecordStatusPause\n\t * @property { string } start\n\t * @property { string } end\n\t */\n\n\t/**\n\t * @typedef { Object } CloudRecordStatusDate\n\t * @property { string } start\n\t * @property { CloudRecordStatusPause[] } pauses\n\t */\n\n\t/**\n\t * @param {Object} status\n\t * @param {number} status.code\n\t * @param {string} status.errMsg\n\t * @param {string} status.initiatorUserID\n\t * @param {string} status.userID\n\t * @param {number} status.kind\n\t * @param {boolean} status.justJoined\n\t * @param {CloudRecordStatusDate} status.date\n\t */\n\t#onCloudRecordStatusChanged = (status) => {\n\t\tif (Util.isCloudRecordLogEnabled())\n\t\t{\n\t\t\tconsole.warn(`CloudRecord: videoRecorderStatus`, status);\n\t\t}\n\n\t\tconst { code, errMsg, initiatorUserID, userID, kind, date, justJoined } = status;\n\n\t\tconst userId = Number(userID);\n\t\tconst initiatorId = Number(initiatorUserID);\n\t\tconst pauses = (date.pauses ?? []).map(({ start, end }) => ({ start: new Date(start), finish: end ? new Date(end) : null }));\n\t\tconst recordType = kind === 1 ? CallCommonRecordType.Audio : CallCommonRecordType.Video;\n\n\t\tthis.#cloudRecordState = errMsg ? this.#cloudRecordState : code;\n\n\t\tif (errMsg)\n\t\t{\n\t\t\tif (Util.isCloudRecordLogEnabled())\n\t\t\t{\n\t\t\t\tconsole.error(`CloudRecord: videoRecorderStatus errMsg`, errMsg);\n\t\t\t}\n\n\t\t\tthis.runCallback(CallEvent.onCloudRecordStatusChanged, {\n\t\t\t\tcode: CloudRecordStatus.STOPPED,\n\t\t\t\tuserId,\n\t\t\t\tinitiatorId,\n\t\t\t\tjustJoined,\n\t\t\t\tcommonRecordState: { ...this.commonRecordState },\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tswitch (code)\n\t\t\t{\n\t\t\t\tcase CloudRecordStatus.STARTED:\n\t\t\t\tcase CloudRecordStatus.PAUSED:\n\t\t\t\t{\n\t\t\t\t\tthis.commonRecordState.state = code === CloudRecordStatus.STARTED\n\t\t\t\t\t\t? CallCommonRecordState.Started\n\t\t\t\t\t\t: CallCommonRecordState.Paused;\n\t\t\t\t\tthis.commonRecordState.type = recordType;\n\t\t\t\t\tthis.commonRecordState.userId = initiatorId;\n\t\t\t\t\tthis.commonRecordState.date.start = new Date(date.start);\n\t\t\t\t\tthis.commonRecordState.date.pause = pauses;\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase CloudRecordStatus.STOPPED:\n\t\t\t\tcase CloudRecordStatus.DESTROYED:\n\t\t\t\t{\n\t\t\t\t\tthis.commonRecordState.state = code === CloudRecordStatus.STOPPED\n\t\t\t\t\t\t? CallCommonRecordState.Stopped\n\t\t\t\t\t\t: CallCommonRecordState.Destroyed;\n\t\t\t\t\tthis.commonRecordState.type = CallCommonRecordType.None;\n\t\t\t\t\tthis.commonRecordState.userId = 0;\n\t\t\t\t\tthis.commonRecordState.date.start = null;\n\t\t\t\t\tthis.commonRecordState.date.pause = [];\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdefault:\n\t\t\t\t{\n\t\t\t\t\tif (Util.isCloudRecordLogEnabled())\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(`Unknown record status: ${status}`);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.runCallback(CallEvent.onCloudRecordStatusChanged, {\n\t\t\t\tcode,\n\t\t\t\tuserId,\n\t\t\t\tinitiatorId,\n\t\t\t\tjustJoined,\n\t\t\t\tcommonRecordState: { ...this.commonRecordState },\n\t\t\t});\n\t\t}\n\t};\n\n\t#onCallReconnecting = (event) => {\n\t\tthis._reconnectionEventCount++;\n\t\tthis.runCallback(CallEvent.onReconnecting, {\n\t\t\treconnectionEventCount: this._reconnectionEventCount,\n\t\t\treconnectionReason: event.reconnectionReason,\n\t\t\treconnectionReasonInfo: event.reconnectionReasonInfo,\n\t\t});\n\t};\n\n\t#onCallReconnected = () => {\n\t\tthis._reconnectionEventCount = 0;\n\t\tthis.runCallback(CallEvent.onReconnected);\n\n\t\tif (this.useMediaServer)\n\t\t{\n\t\t\tthis.#updateOutgoingTracks();\n\t\t}\n\n\t\tif (this.commonRecordState.userId === this.userId)\n\t\t{\n\t\t\tthis.sendLocalRecordState({ action: this.commonRecordState.state, userId: this.userId }, true);\n\t\t}\n\t};\n\n\t#onCallReconnectingFailed = (e, error) => {\n\t\tthis.runCallback(CallEvent.onReconnectingFailed, { error });\n\t};\n\n\t#onCallDisconnected = (e) => {\n\t\tif (e?.leaveInformation?.reason === DisconnectReason.SecurityKeyChanged)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, { name: e.leaveInformation.reason });\n\t\t\treturn;\n\t\t}\n\n\t\tthis.destroy();\n\t};\n\n\t#onCallStatsReceived = (stats) => {\n\t\tif (!this.useMediaServer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst usersToSendReports = {};\n\t\tconst statsIndexByRid = { f: 2, h: 1, q: 0 };\n\n\t\tconst processReport = (report) => {\n\t\t\tconst { userId, kind, source, rid } = report;\n\n\t\t\tif (!userId || !['video', 'audio'].includes(kind))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!usersToSendReports[userId])\n\t\t\t{\n\t\t\t\tusersToSendReports[userId] = {};\n\t\t\t}\n\n\t\t\tif (kind === 'audio')\n\t\t\t{\n\t\t\t\tusersToSendReports[userId][source] = report;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!usersToSendReports[userId][source])\n\t\t\t{\n\t\t\t\tusersToSendReports[userId][source] = [];\n\t\t\t}\n\n\t\t\tconst index = statsIndexByRid[rid] || 0;\n\t\t\tusersToSendReports[userId][source][index] = report;\n\t\t};\n\n\t\tstats.sender.forEach((report) => {\n\t\t\tprocessReport(report);\n\t\t});\n\n\t\tstats.recipient.forEach((report) => {\n\t\t\tprocessReport(report);\n\t\t});\n\n\t\tfor (const [userId, report] of Object.entries(usersToSendReports))\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserStatsReceived, { userId, report });\n\t\t}\n\t};\n\n\t#onConnectionQualityChanged = (participants) => {\n\t\tObject.keys(participants).forEach((participantId) => {\n\t\t\tthis.runCallback(\n\t\t\t\tCallEvent.onConnectionQualityChanged,\n\t\t\t\t{\n\t\t\t\t\tuserId: Number(participantId),\n\t\t\t\t\tscore: participants[participantId],\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\t};\n\n\t#onConnectionTypeChanged = (event) => {\n\t\tconst userId = Number(event.fromUserId);\n\t\tconst connectionType = Number(event.type);\n\n\t\tif (userId === this.userId || connectionType === this.#connectionType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#connectionType = connectionType;\n\n\t\tthis.#updateOutgoingTracks();\n\n\t\tif (this.#recorderState === RecorderStatus.ENABLED && !this.useMediaServer)\n\t\t{\n\t\t\tthis.setRecorderState(RecorderStatus.PAUSED);\n\t\t}\n\t};\n\n\t#onUnload()\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tthis.peers[userId].disconnect();\n\t\t}\n\t};\n\n\t#onOnline()\n\t{\n\t\tconst peers = Object.values(this.peers);\n\t\tpeers.forEach((peer) => {\n\t\t\tpeer.reconnect({ reconnectionReason: 'GOT_ONLINE_EVENT_FROM_BROWSER' });\n\t\t});\n\t}\n\n\t#beforeLeaveCall(finishCall = false)\n\t{\n\t\tthis.removeCallEvents();\n\t\tif (this.CallApi)\n\t\t{\n\t\t\tthis.CallApi.hangup(finishCall);\n\t\t\tthis.CallApi = null;\n\t\t}\n\n\t\t// stop media streams\n\t\tthis.unsubscribeHardwareChanges();\n\n\t\tfor (const tag of Object.keys(this.localStreams))\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\t\tthis.localStreams[tag] = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this.prevMainStream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.prevMainStream);\n\t\t\tthis.prevMainStream = null;\n\t\t}\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\t// remove all event listeners\n\t\tEvent.unbind(window, 'unload', this.#onUnloadHandler);\n\t\tEvent.unbind(window, 'online', this.#onOnlineHandler);\n\n\t\tclearInterval(this.statsInterval);\n\t\tclearInterval(this.microphoneLevelInterval);\n\t}\n\n\tdestroy(finishCall)\n\t{\n\t\tthis.ready = false;\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Call destroy \\n\" + tempError.stack);\n\n\t\t// stop sending media streams\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tthis.#beforeLeaveCall(finishCall);\n\t\tthis.runCallback(CallEvent.onLeave, { local: true });\n\n\t\treturn super.destroy();\n\t}\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tisIceTricklingAllowed()\n\t{\n\t\treturn CallEngine.getPullClient().isPublishingSupported();\n\t};\n\n\tsendUsersInvited(data)\n\t{\n\t\tthis.#sendMessage(clientEvents.usersInvited, data);\n\t};\n\n\tsendConnectionOffer(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.connectionOffer, data);\n\t};\n\n\tsendConnectionAnswer(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.connectionAnswer, data);\n\t};\n\n\tsendIceCandidate(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.iceCandidate, data);\n\t};\n\n\tsendNegotiationNeeded(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.negotiationNeeded, data);\n\t};\n\n\tsendVoiceStarted(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStarted, data);\n\t};\n\n\tsendVoiceStopped(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStopped, data);\n\t};\n\n\tsendMicrophoneState(users, microphoneState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.microphoneState, {\n\t\t\tuserId: users,\n\t\t\tmicrophoneState: microphoneState\n\t\t});\n\t};\n\n\tsendCameraState(users, cameraState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.cameraState, {\n\t\t\tuserId: users,\n\t\t\tcameraState: cameraState\n\t\t});\n\t};\n\n\tsendVideoPaused(users, videoPaused)\n\t{\n\t\treturn this.#sendMessage(clientEvents.videoPaused, {\n\t\t\tuserId: users,\n\t\t\tvideoPaused: videoPaused\n\t\t});\n\t};\n\n\tsendUseMediaServer(users, useMediaServer)\n\t{\n\t\treturn this.#sendMessage(clientEvents.useMediaServer, {\n\t\t\tuseMediaServer,\n\t\t\tuserId: users,\n\t\t});\n\t}\n\n\tsendLocalRecordState(users, commonRecordState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.commonRecordState, {\n\t\t\tuserId: users,\n\t\t\tcommonRecordState,\n\t\t});\n\t}\n\n\tsendCustomMessage(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.customMessage, data);\n\t};\n\n\t#sendMessage(eventName, data)\n\t{\n\t\tif (!this.call.CallApi)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst message = {\n\t\t\teventName,\n\t\t\trequestId: Util.getUuidv4(),\n\t\t\tsenderId: this.call.userId,\n\t\t\t...(Type.isPlainObject(data) ? data : {}),\n\t\t};\n\n\t\tthis.call.CallApi.sendMessage(JSON.stringify(message));\n\t}\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callUuid = this.call.uuid;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.log('Sending ajax-based signaling event ' + signalName + '; ' + JSON.stringify(data));\n\t\treturn CallEngine.getRestClient().callMethod(signalName, data).catch(function (e) {console.error(e)});\n\t};\n}\n\nclass Peer\n{\n\tcall: ServerPlainCall;\n\tpeerConnection: ?RTCPeerConnection;\n\tpeerConnectionId: ?string;\n\tvideoSender: ?RTCRtpSender;\n\taudioSender: ?RTCRtpSender;\n\tscreenSender: ?RTCRtpSender;\n\tscreenAudioSender: ?RTCRtpSender;\n\tcalculatedState: string;\n\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t\tthis.userId = params.userId;\n\n\t\tthis.ready = params.ready === true;\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.signalingConnected = params.signalingConnected === true;\n\t\tthis.failureReason = '';\n\n\t\tthis.userAgent = '';\n\t\tthis.isFirefox = false;\n\t\tthis.isChrome = false;\n\t\tthis.isLegacyMobile = params.isLegacyMobile === true;\n\n\t\t/*sums up from signaling, ready and connection states*/\n\t\tthis.calculatedState = this.calculateState();\n\n\t\tthis.localStreams = {\n\t\t\tmain: null,\n\t\t\tscreen: null\n\t\t};\n\n\t\tthis.pendingIceCandidates = {};\n\t\tthis.localIceCandidates = [];\n\n\t\tthis.trackList = {};\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaStopped: Type.isFunction(params.onMediaStopped) ? params.onMediaStopped : BX.DoNothing,\n\t\t\tonRTCStatsReceived: Type.isFunction(params.onRTCStatsReceived) ? params.onRTCStatsReceived : BX.DoNothing,\n\t\t\tonRTCQualityChanged: Type.isFunction(params.onRTCQualityChanged) ? params.onRTCQualityChanged : BX.DoNothing,\n\t\t\tonNetworkProblem: Type.isFunction(params.onNetworkProblem) ? params.onNetworkProblem : BX.DoNothing,\n\t\t\tonReconnecting: Type.isFunction(params.onReconnecting) ? params.onReconnecting : BX.DoNothing,\n\t\t\tonReconnected: Type.isFunction(params.onReconnected) ? params.onReconnected : BX.DoNothing,\n\t\t\tonUpdateLastUsedCameraId: Type.isFunction(params.onUpdateLastUsedCameraId) ? params.onUpdateLastUsedCameraId : BX.DoNothing,\n\t\t};\n\n\t\t// intervals and timeouts\n\t\tthis.answerTimeout = null;\n\t\tthis.callingTimeout = null;\n\t\tthis.connectionTimeout = null;\n\t\tthis.signalingConnectionTimeout = null;\n\t\tthis.candidatesTimeout = null;\n\n\t\tthis.statsInterval = null;\n\n\t\tthis.connectionOfferReplyTimeout = null;\n\t\tthis.negotiationNeededReplyTimeout = null;\n\t\tthis.reconnectAfterDisconnectTimeout = null;\n\n\t\tthis.connectionAttempt = 0;\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\n\t\tthis._outgoingVideoTrack = null;\n\t\tObject.defineProperty(this, 'outgoingVideoTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingVideoTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingVideoTrack = track;\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._outgoingScreenTrack = null;\n\t\tObject.defineProperty(this, 'outgoingScreenTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingScreenTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingScreenTrack = track;\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis._incomingAudioTrack = null;\n\t\tthis._incomingScreenAudioTrack = null;\n\t\tthis._incomingVideoTrack = null;\n\t\tthis._incomingScreenTrack = null;\n\t\tObject.defineProperty(this, 'incomingAudioTrack', {\n\t\t\tget: this._mediaGetter('_incomingAudioTrack'),\n\t\t\tset: this._mediaSetter('_incomingAudioTrack', 'audio')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingVideoTrack', {\n\t\t\tget: this._mediaGetter('_incomingVideoTrack'),\n\t\t\tset: this._mediaSetter('_incomingVideoTrack', 'video')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingScreenTrack', {\n\t\t\tget: this._mediaGetter('_incomingScreenTrack'),\n\t\t\tset: this._mediaSetter('_incomingScreenTrack', 'screen')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingScreenAudioTrack', {\n\t\t\tget: this._mediaGetter('_incomingScreenAudioTrack'),\n\t\t\tset: this._mediaSetter('_incomingScreenAudioTrack', 'sharingAudio')\n\t\t});\n\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\t// event handlers\n\t\tthis._onPeerConnectionIceCandidateHandler = this._onPeerConnectionIceCandidate.bind(this);\n\t\tthis._onPeerConnectionConnectionStateChangeHandler = this.#onPeerConnectionConnectionStateChange.bind(this);\n\t\tthis._onPeerConnectionIceGatheringStateChangeHandler = this.#onPeerConnectionIceGatheringStateChange.bind(this);\n\t\tthis._onPeerConnectionSignalingStateChangeHandler = this.#onPeerConnectionSignalingStateChange.bind(this);\n\t\t//this._onPeerConnectionNegotiationNeededHandler = this._onPeerConnectionNegotiationNeeded.bind(this);\n\t\tthis._onPeerConnectionTrackHandler = this.#onPeerConnectionTrack.bind(this);\n\t\tthis._onPeerConnectionRemoveStreamHandler = this.#onPeerConnectionRemoveStream.bind(this);\n\n\t\tthis._updateTracksDebounced = Runtime.debounce(this.#updateTracks.bind(this), 50);\n\n\t\tthis._waitTurnCandidatesTimeout = null;\n\n\t\tthis.prevPercentPacketLostList = {\n\t\t\tincomingPacketLost: [],\n\t\t\toutgoingPacketLost: [],\n\t\t};\n\t\tthis.reportsForIncomingTracks = {};\n\t\tthis.reportsForOutgoingTracks = {};\n\t\tthis.packetLostThreshold = 7;\n\t\tthis.videoBitrate = 1000000;\n\t\tthis.screenShareBitrate = 1500000;\n\t\tthis.maxConnectionScore = 5;\n\t\tthis.incomingConnectionScore = 0;\n\t\tthis.outgoingConnectionScore = 0;\n\t};\n\n\t_mediaGetter(trackVariable)\n\t{\n\t\treturn function ()\n\t\t{\n\t\t\treturn this[trackVariable]\n\t\t}.bind(this)\n\t};\n\n\t_mediaSetter(trackVariable, kind)\n\t{\n\t\treturn function (track)\n\t\t{\n\t\t\tif (this[trackVariable] != track)\n\t\t\t{\n\t\t\t\tthis[trackVariable] = track;\n\t\t\t\tif (track)\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaReceived({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind,\n\t\t\t\t\t\ttrack: track\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaStopped({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this)\n\t};\n\n\tsendMedia(skipOffer)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tif (!this.isInitiator())\n\t\t\t{\n\t\t\t\tthis.log('waiting for the other side to send connection offer');\n\t\t\t\tthis.sendNegotiationNeeded(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tconst connectionId = Util.getUuidv4();\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\t\tthis.updateOutgoingTracks();\n\n\t\tif (!skipOffer)\n\t\t{\n\t\t\tthis.applyResolutionScale();\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t};\n\n\tupdateOutgoingTracks()\n\t{\n\t\tthis.#updateDirectTracks();\n\t\tthis.#updateMediaServerTracks();\n\t}\n\n\t#updateDirectTracks()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst audioTrack = this.call.localStreams?.main?.getAudioTracks()?.[0];\n\t\tconst videoTrack = this.call.localStreams?.main?.getVideoTracks()?.[0];\n\t\tconst screenTrack = this.call.localStreams?.screen?.getVideoTracks()?.[0];\n\t\tconst screenAudioTrack = this.call.localStreams?.screen?.getAudioTracks()?.[0];\n\n\t\tthis.outgoingVideoTrack = videoTrack ? videoTrack.clone() : null;\n\t\tthis.outgoingScreenTrack = screenTrack ? screenTrack.clone() : null;\n\n\t\tconst tracksToSend = [];\n\t\tif (audioTrack?.readyState === 'live')\n\t\t{\n\t\t\ttracksToSend.push(`${audioTrack.id} (audio)`);\n\t\t}\n\n\t\tif (screenAudioTrack?.readyState === 'live')\n\t\t{\n\t\t\ttracksToSend.push(`${screenAudioTrack.id} (sharingAudio)`);\n\t\t}\n\n\t\tif (videoTrack)\n\t\t{\n\t\t\ttracksToSend.push(`${videoTrack.id} (${videoTrack.kind})`);\n\t\t}\n\n\t\tif (screenTrack)\n\t\t{\n\t\t\ttracksToSend.push(`${screenTrack.id} (${screenTrack.kind})`);\n\t\t}\n\n\t\tconsole.log(`User: ${this.userId}; Sending media streams. Tracks: ${tracksToSend.join('; ')}`);\n\n\t\t// if video sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.outgoingVideoTrack.enabled = !this.call.useMediaServer;\n\t\t\tvoid this.videoSender.replaceTrack(this.outgoingVideoTrack);\n\t\t}\n\t\telse if (!this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.outgoingVideoTrack.enabled = !this.call.useMediaServer;\n\t\t\tthis.videoSender = this.peerConnection.addTrack(this.outgoingVideoTrack);\n\t\t}\n\t\telse if (this.videoSender && !this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.videoSender);\n\t\t\tthis.videoSender = null;\n\t\t}\n\n\t\t// if screen sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.outgoingScreenTrack.enabled = !this.call.useMediaServer;\n\t\t\tvoid this.screenSender.replaceTrack(this.outgoingScreenTrack);\n\t\t}\n\t\telse if (!this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.outgoingScreenTrack.enabled = !this.call.useMediaServer;\n\t\t\tthis.screenSender = this.peerConnection.addTrack(this.outgoingScreenTrack);\n\t\t}\n\t\telse if (this.screenSender && !this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.screenSender);\n\t\t\tthis.screenSender = null;\n\t\t}\n\n\t\t// if screen sender audio found - replace track\n\t\t// if not found - add track\n\t\tif (this.screenAudioSender && screenAudioTrack)\n\t\t{\n\t\t\tscreenAudioTrack.enabled = !this.call.useMediaServer;\n\t\t\tvoid this.screenAudioSender.replaceTrack(screenAudioTrack);\n\t\t}\n\t\telse if (!this.screenAudioSender && screenAudioTrack)\n\t\t{\n\t\t\tscreenAudioTrack.enabled = !this.call.useMediaServer;\n\t\t\tthis.screenAudioSender = this.peerConnection.addTrack(screenAudioTrack);\n\t\t}\n\t\telse if (this.screenAudioSender && !screenAudioTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.screenAudioSender);\n\t\t\tthis.screenAudioSender = null;\n\t\t}\n\n\t\t// if audio sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.audioSender && audioTrack)\n\t\t{\n\t\t\taudioTrack.enabled = !Hardware.isMicrophoneMuted && !this.call.useMediaServer;\n\t\t\tvoid this.audioSender.replaceTrack(audioTrack);\n\t\t}\n\t\telse if (!this.audioSender && audioTrack)\n\t\t{\n\t\t\taudioTrack.enabled = !Hardware.isMicrophoneMuted && !this.call.useMediaServer;\n\t\t\tthis.audioSender = this.peerConnection.addTrack(audioTrack);\n\t\t}\n\t\telse if (this.audioSender && !audioTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.audioSender);\n\t\t\tthis.audioSender = null;\n\t\t}\n\t}\n\n\t#updateMediaServerTracks(): void\n\t{\n\t\tif (Hardware.isCameraOn && !this.call.CallApi.isVideoPublished())\n\t\t{\n\t\t\tvoid this.call.CallApi.enableVideo({ calledFrom: 'updateOutgoingTracks' });\n\t\t}\n\t\telse if ((!this.call.useMediaServer || !Hardware.isCameraOn))\n\t\t{\n\t\t\tvoid this.call.CallApi.disableVideo({ calledFrom: 'updateOutgoingTracks' });\n\t\t}\n\n\t\tif (!Hardware.isMicrophoneMuted && !this.call.CallApi.isAudioPublished())\n\t\t{\n\t\t\tvoid this.call.CallApi.enableAudio({ calledFrom: 'updateOutgoingTracks' });\n\t\t}\n\t\telse if ((!this.call.useMediaServer || Hardware.isMicrophoneMuted))\n\t\t{\n\t\t\tvoid this.call.CallApi.disableAudio({ calledFrom: 'updateOutgoingTracks' });\n\t\t}\n\n\t\tif (this.call.isScreenSharingStarted() && this.call.useMediaServer && !this.call.CallApi.isScreenPublished())\n\t\t{\n\t\t\tvoid this.call.CallApi.startScreenShare();\n\t\t}\n\t\telse if ((!this.call.useMediaServer || !this.call.isScreenSharingStarted()))\n\t\t{\n\t\t\tvoid this.call.CallApi.stopScreenShare();\n\t\t}\n\t}\n\n\tgetSenderMid(rtpSender: RTCRtpSender): string\n\t{\n\t\tif (!rtpSender || !this.peerConnection)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst transceiver = this.peerConnection.getTransceivers().find(transceiver => {\n\t\t\tif (transceiver.sender.track && rtpSender.track)\n\t\t\t{\n\t\t\t\treturn transceiver.sender.track.id === rtpSender.track.id\n\t\t\t}\n\t\t\treturn false\n\t\t});\n\n\t\treturn transceiver ? transceiver.mid : null;\n\t};\n\n\tapplyResolutionScale(factor)\n\t{\n\t\tif (this.videoSender)\n\t\t{\n\t\t\tconst scaleFactor = factor || (this.screenSender ? 2 : 1);\n\t\t\tconst rate = this.videoBitrate / scaleFactor;\n\t\t\tconst videoParams = this.videoSender.getParameters();\n\n\t\t\tif (videoParams.encodings && videoParams.encodings.length > 0)\n\t\t\t{\n\t\t\t\tvideoParams.encodings[0].scaleResolutionDownBy = scaleFactor;\n\t\t\t\tvideoParams.encodings[0].maxBitrate = rate;\n\t\t\t\tthis.videoSender.setParameters(videoParams);\n\t\t\t}\n\t\t}\n\n\t\tif (this.screenSender)\n\t\t{\n\t\t\tconst screenParams = this.screenSender.getParameters();\n\t\t\tif (screenParams.encodings && screenParams.encodings.length > 0)\n\t\t\t{\n\t\t\t\tscreenParams.encodings[0].maxBitrate = this.screenShareBitrate;\n\t\t\t\tthis.screenSender.setParameters(screenParams);\n\t\t\t}\n\t\t}\n\t};\n\n\treplaceMediaStream(tag: string)\n\t{\n\t\tif (this.isRenegotiationSupported())\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localStreams[tag] = this.call.getLocalStream(tag);\n\t\t\tthis.reconnect({ reconnectionReasonInfo: 'Reconnect by replaceMediaStream' });\n\t\t}\n\t}\n\n\tholdOutgoingVideo(holdState)\n\t{\n\t\tif (this.outgoingVideoHoldState == holdState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.outgoingVideoHoldState = holdState;\n\t\tif (this._outgoingVideoTrack)\n\t\t{\n\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t}\n\t};\n\n\tisInitiator()\n\t{\n\t\treturn this.call.userId < this.userId;\n\t};\n\n\tisRenegotiationSupported()\n\t{\n\t\treturn true;\n\t\t// return (Browser.isChrome() && this.isChrome);\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tthis.ready = ready;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(function ()\n\t\t{\n\t\t\tthis.onInviteTimeout(true);\n\t\t}.bind(this), invitePeriod);\n\t\tthis.updateCalculatedState();\n\t};\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetUserAgent(userAgent)\n\t{\n\t\tthis.userAgent = userAgent;\n\t\tthis.isFirefox = userAgent.toLowerCase().indexOf('firefox') != -1;\n\t\tthis.isChrome = userAgent.toLowerCase().indexOf('chrome') != -1;\n\t\tthis.isLegacyMobile = userAgent === 'Bitrix Legacy Mobile';\n\t};\n\n\tgetUserAgent()\n\t{\n\t\treturn this.userAgent;\n\t};\n\n\tisParticipating()\n\t{\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.declined || this.busy)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\t// todo: maybe we should check iceConnectionState as well.\n\t\t\tconst iceConnectionState = this.peerConnection.iceConnectionState;\n\t\t\tif (iceConnectionState == 'checking' || iceConnectionState == 'connected' || iceConnectionState == 'completed')\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tsetSignalingConnected(signalingConnected)\n\t{\n\t\tthis.signalingConnected = signalingConnected;\n\t\tthis.updateCalculatedState();\n\n\t\tif (this.signalingConnected)\n\t\t{\n\t\t\tthis.refreshSignalingTimeout();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.stopSignalingTimeout();\n\t\t}\n\t};\n\n\tisSignalingConnected()\n\t{\n\t\treturn this.signalingConnected;\n\t};\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisDeclined()\n\t{\n\t\treturn this.declined;\n\t};\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState != calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tisLegacyMobile: this.isLegacyMobile,\n\t\t\t\tnetworkProblem: !this.hasStun || !this.hasTurn\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t};\n\n\tcalculateState()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.failureReason !== '')\n\t\t\t{\n\t\t\t\treturn UserState.Failed;\n\t\t\t}\n\n\t\t\tif (this.peerConnection.iceConnectionState === 'connected' || this.peerConnection.iceConnectionState === 'completed')\n\t\t\t{\n\t\t\t\treturn UserState.Connected;\n\t\t\t}\n\n\t\t\treturn UserState.Connecting;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t};\n\n\tgetSignaling()\n\t{\n\t\treturn this.call.signaling;\n\t};\n\n\tstartStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\n\t\tthis.statsInterval = setInterval(function ()\n\t\t{\n\t\t\tif (!this.peerConnection)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.peerConnection.getStats().then(function (stats)\n\t\t\t{\n\t\t\t\t// stats gathering in new format like in the Bitrix24 calls\n\t\t\t\tconst statsOutput = [];\n\t\t\t\tconst codecs = {};\n\t\t\t\tconst reportsWithoutCodecs = {};\n\t\t\t\tconst remoteReports = {};\n\t\t\t\tconst reportsWithoutRemoteInfo = {};\n\t\t\t\tlet incomingDataLoss = 0;\n\t\t\t\tlet outgoingDataLoss = 0;\n\n\t\t\t\tstats.forEach((report) => {\n\t\t\t\t\tstatsOutput.push(report);\n\n\t\t\t\t\tconst needCheckInputPacketLost = (report?.trackIdentifier\n\t\t\t\t\t\t&& report?.type === 'inbound-rtp'\n\t\t\t\t\t\t&& report.hasOwnProperty('packetsLost')\n\t\t\t\t\t\t&& report.hasOwnProperty('packetsReceived'));\n\n\t\t\t\t\tif (needCheckInputPacketLost || report.type === 'outbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\tswitch (this.trackList[report.mid])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcase 'video':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Camera;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'screen':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Screen;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'audio':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Microphone;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (needCheckInputPacketLost)\n\t\t\t\t\t{\n\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.reportsForIncomingTracks[report.source]);\n\t\t\t\t\t\tconst packetsLostData = Util.calcRemotePacketsLost(report, this.reportsForIncomingTracks[report.source]);\n\t\t\t\t\t\treport.packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.reportsForIncomingTracks[report.source] = report;\n\n\t\t\t\t\t\tif (report.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tincomingDataLoss = packetsLostData.currentPercentPacketLost;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'codec')\n\t\t\t\t\t{\n\t\t\t\t\t\tUtil.processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'remote-inbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst reportId = report.localId;\n\t\t\t\t\t\tif (reportsWithoutRemoteInfo[reportId])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst packetsLostData = Util.calcLocalPacketsLost(reportsWithoutRemoteInfo[reportId], this.reportsForOutgoingTracks[reportId], report);\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostData = packetsLostData;\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLost = packetsLostData.totalPacketsLost;\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\t\tthis.reportsForOutgoingTracks[reportId] = reportsWithoutRemoteInfo[reportId];\n\t\t\t\t\t\t\tdelete reportsWithoutRemoteInfo[reportId];\n\n\t\t\t\t\t\t\tif (this.reportsForOutgoingTracks[reportId].source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\toutgoingDataLoss = report.packetsLost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tremoteReports[reportId] = report;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'outbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.reportsForOutgoingTracks[report.id], true);\n\t\t\t\t\t\treport.userId = this.call.userId;\n\n\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Util.setLocalPacketsLostOrSaveReport(report, remoteReports, reportsWithoutRemoteInfo))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.reportsForOutgoingTracks[report.id] = report;\n\t\t\t\t\t\t\tif (report.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\toutgoingDataLoss = report.packetsLostData.currentPercentPacketLost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (this.prevPercentPacketLostList.incomingPacketLost.push(incomingDataLoss) > 10)\n\t\t\t\t{\n\t\t\t\t\tthis.prevPercentPacketLostList.incomingPacketLost.shift();\n\t\t\t\t}\n\n\t\t\t\tconst newIncomingConnectionDataLoss = this.prevPercentPacketLostList.incomingPacketLost.reduce(\n\t\t\t\t\t(acc, number) => acc + number, 0\n\t\t\t\t) / this.prevPercentPacketLostList.incomingPacketLost.length;\n\t\t\t\tconst newIncomingConnectionScore = this.calcNewConnectionScore(newIncomingConnectionDataLoss);\n\t\t\t\tif (!this.incomingConnectionScore || this.incomingConnectionScore !== newIncomingConnectionScore)\n\t\t\t\t{\n\t\t\t\t\tthis.incomingConnectionScore = newIncomingConnectionScore;\n\t\t\t\t\tthis.callbacks.onRTCQualityChanged({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tscore: this.incomingConnectionScore\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this.prevPercentPacketLostList.outgoingPacketLost.push(outgoingDataLoss) > 10)\n\t\t\t\t{\n\t\t\t\t\tthis.prevPercentPacketLostList.outgoingPacketLost.shift();\n\t\t\t\t}\n\n\t\t\t\tconst newOutgoingConnectionDataLoss = this.prevPercentPacketLostList.outgoingPacketLost.reduce(\n\t\t\t\t\t(acc, number) => acc + number, 0\n\t\t\t\t) / this.prevPercentPacketLostList.outgoingPacketLost.length;\n\t\t\t\tconst newOutgoingConnectionScore = this.calcNewConnectionScore(newOutgoingConnectionDataLoss);\n\t\t\t\tif (!this.outgoingConnectionScore || this.outgoingConnectionScore !== newOutgoingConnectionScore)\n\t\t\t\t{\n\t\t\t\t\tthis.outgoingConnectionScore = newOutgoingConnectionScore;\n\t\t\t\t\tthis.callbacks.onRTCQualityChanged({\n\t\t\t\t\t\tuserId: this.call.userId,\n\t\t\t\t\t\tscore: this.outgoingConnectionScore\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.callbacks.onRTCStatsReceived({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tstats: statsOutput\n\t\t\t\t});\n\t\t\t}.bind(this));\n\t\t}.bind(this), 1000);\n\t};\n\n\tcalcNewConnectionScore(dataLoss)\n\t{\n\t\tlet connectionQuality;\n\t\tif (dataLoss < 10)\n\t\t{\n\t\t\tconnectionQuality = 4;\n\t\t}\n\n\t\tif (dataLoss > 10 && dataLoss <= 20)\n\t\t{\n\t\t\tconnectionQuality = 3;\n\t\t}\n\n\t\tif (dataLoss > 20 && dataLoss <= 30)\n\t\t{\n\t\t\tconnectionQuality = 2;\n\t\t}\n\n\t\tif (dataLoss > 30)\n\t\t{\n\t\t\tconnectionQuality = 1;\n\t\t}\n\n\t\treturn connectionQuality;\n\t}\n\n\tstopStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\t\tthis.statsInterval = null;\n\t};\n\n\tupdateCandidatesTimeout()\n\t{\n\t\tif (this.candidatesTimeout)\n\t\t{\n\t\t\tclearTimeout(this.candidatesTimeout);\n\t\t}\n\n\t\tthis.candidatesTimeout = setTimeout(this.sendIceCandidates.bind(this), 500);\n\t};\n\n\tsendIceCandidates()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": sending ICE candidates due to the timeout\");\n\n\t\tthis.candidatesTimeout = null;\n\t\tif (this.localIceCandidates.length > 0)\n\t\t{\n\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t});\n\t\t\tthis.localIceCandidates = [];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates pool is empty\");\n\t\t}\n\t};\n\n\t#createPeerConnection(id)\n\t{\n\t\tthis.log(`User ${this.userId}: Creating peer connection`);\n\t\tconst iceServers = this.call.CallApi?.iceServers || this.call.iceServers;\n\t\tconst connectionConfig = { iceServers };\n\n\t\tthis.localIceCandidates = [];\n\t\tthis.peerConnection = new RTCPeerConnection(connectionConfig);\n\t\tthis.peerConnectionId = id;\n\n\t\tthis.peerConnection.addEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.addEventListener(\"connectionstatechange\", this._onPeerConnectionConnectionStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.addEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.addEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.addEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.failureReason = '';\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\t\tthis.updateCalculatedState();\n\n\t\tthis.startStatisticsGathering();\n\t};\n\n\t_destroyPeerConnection()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\n\t\tthis.log(\"User \" + this.userId + \": Destroying peer connection \" + this.peerConnectionId);\n\t\tthis.stopStatisticsGathering();\n\n\t\tthis.peerConnection.removeEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.removeEventListener(\"connectionstatechange\", this._onPeerConnectionConnectionStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.removeEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.removeEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.removeEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.localIceCandidates = [];\n\t\tif (this.pendingIceCandidates[this.peerConnectionId])\n\t\t{\n\t\t\tdelete this.pendingIceCandidates[this.peerConnectionId];\n\t\t}\n\n\t\tthis.peerConnection.close();\n\t\tthis.peerConnection = null;\n\t\tthis.peerConnectionId = null;\n\t\tthis.videoSender = null;\n\t\tthis.audioSender = null;\n\t\tthis.screenSender = null;\n\t\tthis.screenAudioSender = null;\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingScreenAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\t};\n\n\t_onPeerConnectionIceCandidate(e)\n\t{\n\t\tconst candidate = e.candidate;\n\t\tthis.log(\"User \" + this.userId + \": ICE candidate discovered. Candidate: \" + (candidate ? candidate.candidate : candidate));\n\n\t\tif (candidate)\n\t\t{\n\t\t\tif (this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tcandidates: [candidate.toJSON()]\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.localIceCandidates.push(candidate.toJSON());\n\t\t\t\tthis.updateCandidatesTimeout();\n\t\t\t}\n\n\t\t\tconst match = candidate.candidate.match(/typ\\s(\\w+)?/);\n\t\t\tif (match)\n\t\t\t{\n\t\t\t\tconst type = match[1];\n\t\t\t\tif (type == \"srflx\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasStun = true;\n\t\t\t\t}\n\t\t\t\telse if (type == \"relay\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasTurn = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionConnectionStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": peer connection state changed. New state: \" + this.peerConnection.connectionState);\n\n\t\tif (this.peerConnection.connectionState === \"connected\" || this.peerConnection.connectionState === \"completed\")\n\t\t{\n\t\t\tthis.connectionAttempt = 0;\n\t\t\tthis.callbacks.onReconnected();\n\t\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t\telse if (this.peerConnection.connectionState === \"failed\")\n\t\t{\n\t\t\tconst logMessage = 'Peer connection failed. Trying to restore connection immediately';\n\t\t\tthis.log(logMessage);\n\n\t\t\tthis.reconnect({\n\t\t\t\treconnectionReason: 'PEER_CONNECTION_FAILED',\n\t\t\t\treconnectionReasonInfo: logMessage,\n\t\t\t});\n\t\t}\n\t\t// else if (this.peerConnection.connectionState === \"disconnected\")\n\t\t// {\n\t\t// \t// we can ignore a 'disconnected' state because it can provoke frequent reconnects,\n\t\t// \t// besides that, iceConnectionState can can be changed back to 'connected' state by itself\n\t\t// \tthis.log(\"peer connection lost. Waiting 5 seconds before trying to restore it\");\n\t\t// \tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t// \tthis.reconnectAfterDisconnectTimeout = setTimeout(() => this.reconnect(), 5000);\n\t\t// }\n\n\t\tthis.updateCalculatedState();\n\t};\n\n\t#onPeerConnectionIceGatheringStateChange(e)\n\t{\n\t\tconst connection = e.target;\n\t\tthis.log(\"User \" + this.userId + \": ICE gathering state changed to : \" + connection.iceGatheringState);\n\n\t\tif (connection.iceGatheringState === 'complete')\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE gathering complete\");\n\t\t\tif (!this.hasStun || !this.hasTurn)\n\t\t\t{\n\t\t\t\tconst s = [];\n\t\t\t\tif (!this.hasTurn)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"TURN\");\n\t\t\t\t}\n\t\t\t\tif (!this.hasStun)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"STUN\");\n\t\t\t\t}\n\t\t\t\tthis.log(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tconsole.error(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tthis.callbacks.onNetworkProblem();\n\t\t\t}\n\n\t\t\tif (!this.hasTurn && !this.hasStun)\n\t\t\t{\n\n\t\t\t}\n\n\t\t\tif (!this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tif (this.localIceCandidates.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t\t\t});\n\t\t\t\t\tthis.localIceCandidates = [];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates already sent\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionSignalingStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \" PC signalingState: \" + this.peerConnection.signalingState);\n\t\tif (this.peerConnection.signalingState === \"stable\")\n\t\t{\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t};\n\n\t// this event is unusable in the current version of desktop (cef 64) and leads to signaling cycling\n\t// todo: reconsider using it after new version is released\n\t#onPeerConnectionNegotiationNeeded(e)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": needed negotiation for peer connection\");\n\t\tthis.log(\"signaling state: \", e.target.signalingState);\n\t\tthis.log(\"ice connection state: \", e.target.iceConnectionState);\n\t\tthis.log(\"pendingRemoteDescription: \", e.target.pendingRemoteDescription);\n\n\t\tif (e.target.iceConnectionState !== \"new\" && e.target.iceConnectionState !== \"connected\" && e.target.iceConnectionState !== \"completed\")\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": wrong connection state\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendNegotiationNeeded(this.peerConnection._forceReconnect === true);\n\t\t}\n\t};\n\n\taddMediaRenderer(trackData)\n\t{\n\t\tthis.#addTrack(trackData);\n\t}\n\n\tremoveMediaRenderer(trackData)\n\t{\n\t\tthis.log(`Removing media renderer for user ${this.userId} ${trackData.track.source}`);\n\n\t\tswitch (trackData.track.source)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.incomingVideoTrack = null;\n\t\t\t\tbreak;\n\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.incomingAudioTrack = null;\n\t\t\t\tbreak;\n\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\tcase MediaStreamsKinds.ScreenAudio:\n\t\t\t\tthis.incomingScreenTrack = null;\n\t\t\t\tthis.incomingScreenAudioTrack = null;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t}\n\t}\n\n\t#onPeerConnectionTrack(e): void\n\t{\n\t\tif (this.call.useMediaServer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#addTrack(e);\n\t}\n\n\t#addTrack(event)\n\t{\n\t\tthis.log(`User ${this.userId}: media track received: ${event.track.id} (${event.track.kind})`);\n\n\t\tif (event.track.kind === 'video')\n\t\t{\n\t\t\tEvent.bind(event.track, 'mute', this.#onVideoTrackMuted.bind(this));\n\t\t\tEvent.bind(event.track, 'unmute', this.#onVideoTrackUnMuted.bind(this));\n\t\t\tEvent.bind(event.track, 'ended', this.#onVideoTrackEnded.bind(this));\n\n\t\t\tconst isScreenVideo = this.call.useMediaServer\n\t\t\t\t? event.track.source === MediaStreamsKinds.Screen\n\t\t\t\t: this.trackList[event.transceiver?.mid] === 'screen';\n\n\t\t\tif (isScreenVideo)\n\t\t\t{\n\t\t\t\tthis.incomingScreenTrack = event.track;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.incomingVideoTrack = event.track;\n\t\t\t}\n\t\t}\n\t\telse if (event.track.kind === 'audio')\n\t\t{\n\t\t\tconst isScreenAudio = this.call.useMediaServer\n\t\t\t\t? event.track.source === MediaStreamsKinds.ScreenAudio\n\t\t\t\t: this.trackList[event.transceiver?.mid] === 'screenAudio';\n\n\t\t\tif (isScreenAudio)\n\t\t\t{\n\t\t\t\tthis.incomingScreenAudioTrack = event.track;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.incomingAudioTrack = event.track;\n\t\t\t}\n\t\t}\n\t}\n\n\t#onPeerConnectionRemoveStream(e)\n\t{\n\t\tthis.log(\"User: \" + this.userId + \"_onPeerConnectionRemoveStream: \", e);\n\t};\n\n\t#onVideoTrackMuted()\n\t{\n\t\tconsole.log(\"Video track muted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackUnMuted()\n\t{\n\t\tconsole.log(\"Video track unmuted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackEnded()\n\t{\n\t\tconsole.log(\"Video track ended\");\n\t};\n\n\t#updateTracks()\n\t{\n\t\tif (!this.peerConnection || this.call.useMediaServer)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet audioTrack = null;\n\t\tlet videoTrack = null;\n\t\tlet screenTrack = null;\n\t\tlet screenAudioTrack = null;\n\t\tthis.peerConnection.getTransceivers().forEach((tr) =>\n\t\t{\n\t\t\tthis.call.log(\"[debug] tr direction: \" + tr.direction + \" currentDirection: \" + tr.currentDirection);\n\t\t\tif (tr.currentDirection === \"sendrecv\" || tr.currentDirection === \"recvonly\")\n\t\t\t{\n\t\t\t\tif (tr.receiver && tr.receiver.track)\n\t\t\t\t{\n\t\t\t\t\tconst track = tr.receiver.track;\n\t\t\t\t\tif (track.kind === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.trackList[tr.mid] === 'sharingAudio')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscreenAudioTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.kind === 'video')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.trackList[tr.mid] === 'screen')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscreenTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvideoTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.incomingAudioTrack = audioTrack;\n\t\tthis.incomingVideoTrack = videoTrack;\n\t\tthis.incomingScreenTrack = screenTrack;\n\t\tthis.incomingScreenAudioTrack = screenAudioTrack;\n\t};\n\n\tstopSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t};\n\n\trefreshSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = setTimeout(this.#onLostSignalingConnection.bind(this), signalingConnectionRefreshPeriod);\n\t};\n\n\t#onLostSignalingConnection()\n\t{\n\t\tthis.setSignalingConnected(false);\n\t};\n\n\t_onConnectionOfferReplyTimeout(connectionId)\n\t{\n\t\tconst logMessage = `Did not receive connection answer for connection ${connectionId}`;\n\t\tthis.log(logMessage);\n\t\tthis.call.setPublishingState(MediaStreamsKinds.Camera, false);\n\t\tthis.reconnect({ reconnectionReasonInfo: logMessage });\n\t}\n\n\t_onNegotiationNeededReplyTimeout()\n\t{\n\t\tconst logMessage = 'Did not receive connection offer in time';\n\t\tthis.log(logMessage);\n\t\tthis.reconnect({ reconnectionReasonInfo: logMessage });\n\t}\n\n\tsetConnectionOffer(connectionId, sdp, trackList)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": applying connection offer for connection \" + connectionId);\n\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = null;\n\n\t\tif (!this.call.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnectionId !== connectionId)\n\t\t\t{\n\t\t\t\tthis._destroyPeerConnection();\n\t\t\t\tthis.#createPeerConnection(connectionId);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\n\t\tthis.applyOfferAndSendAnswer(sdp);\n\t};\n\n\tcreateAndSendOffer(config)\n\t{\n\t\tlet connectionConfig = defaultConnectionOptions;\n\t\tfor (let key in config)\n\t\t{\n\t\t\tconnectionConfig[key] = config[key];\n\t\t}\n\n\t\tthis.peerConnection.createOffer(connectionConfig)\n\t\t\t.then((offer) =>\n\t\t\t{\n\t\t\t\tthis.log(\"User \" + this.userId + \": Created connection offer.\");\n\t\t\t\tthis.log(\"Applying local description\");\n\t\t\t\treturn this.peerConnection.setLocalDescription(offer);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t})\n\t\t;\n\t};\n\n\tsendOffer()\n\t{\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\t\tthis.connectionOfferReplyTimeout = setTimeout(\n\t\t\t() => this._onConnectionOfferReplyTimeout(this.peerConnectionId),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tthis.getSignaling().sendConnectionOffer({\n\t\t\tuserId: this.userId,\n\t\t\tconnectionId: this.peerConnectionId,\n\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\ttracks: {\n\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t\tsharingAudio: this.getSenderMid(this.screenAudioSender),\n\t\t\t},\n\t\t\tuserAgent: navigator.userAgent\n\t\t})\n\t};\n\n\tsendNegotiationNeeded(restart: boolean)\n\t{\n\t\trestart = restart === true;\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = setTimeout(\n\t\t\t() => this._onNegotiationNeededReplyTimeout(),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tconst params = {\n\t\t\tuserId: this.userId\n\t\t};\n\t\tif (restart)\n\t\t{\n\t\t\tparams.restart = true;\n\t\t}\n\n\t\tthis.getSignaling().sendNegotiationNeeded(params);\n\t};\n\n\tapplyOfferAndSendAnswer(sdp)\n\t{\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\tsdp,\n\t\t\ttype: 'offer',\n\t\t});\n\n\t\tif (this.pendingRemoteSdpDelay)\n\t\t{\n\t\t\tthis.pendingRemoteSdp = sdp;\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(`User: ${this.userId}; Applying remote offer`);\n\t\tthis.log(`User: ${this.userId}; Peer ice connection state ${this.peerConnection.iceConnectionState}`);\n\n\t\tconst haveLocalOffer = this.peerConnection.signalingState === 'have-local-offer';\n\n\t\tif (this.isInitiator() && haveLocalOffer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst initDescription = haveLocalOffer\n\t\t\t? new Promise((resolve) => {\n\t\t\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\t\t\t\tresolve(this.peerConnection.setLocalDescription());\n\t\t\t})\n\t\t\t: Promise.resolve();\n\n\t\tthis.pendingRemoteSdpDelay = true;\n\n\t\tinitDescription\n\t\t\t.then(() => {\n\t\t\t\treturn this.peerConnection\n\t\t\t\t\t.setRemoteDescription(sessionDescription);\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tif (this.peerConnection.iceConnectionState === 'new')\n\t\t\t\t{\n\t\t\t\t\tthis.sendMedia(true);\n\t\t\t\t}\n\n\t\t\t\treturn this.peerConnection.createAnswer();\n\t\t\t})\n\t\t\t.then((answer) => {\n\t\t\t\tthis.log('Created connection answer.');\n\t\t\t\tthis.log('Applying local description.');\n\n\t\t\t\treturn this.peerConnection.setLocalDescription(answer);\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.applyResolutionScale();\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t\tthis.getSignaling().sendConnectionAnswer({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\t\t\ttracks: {\n\t\t\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t\t\t\tsharingAudio: this.getSenderMid(this.screenAudioSender),\n\t\t\t\t\t},\n\t\t\t\t\tuserAgent: navigator.userAgent,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tthis.failureReason = error.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log('Could not apply remote offer', error);\n\t\t\t\tconsole.error('Could not apply remote offer', error);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.pendingRemoteSdpDelay = false;\n\t\t\t\tif (this.pendingRemoteSdp)\n\t\t\t\t{\n\t\t\t\t\tthis.applyOfferAndSendAnswer(this.pendingRemoteSdp);\n\t\t\t\t\tthis.pendingRemoteSdp = null;\n\t\t\t\t}\n\n\t\t\t\tconst activeTransceivers = this.peerConnection?.getTransceivers()\n\t\t\t\t\t.reduce((sum, transceiver) => {\n\t\t\t\t\t\treturn transceiver.mid === null ? sum : sum + 1;\n\t\t\t\t\t}, 0);\n\n\t\t\t\tlet activeTracks = 0;\n\t\t\t\tObject.values(this.call.localStreams).forEach((stream) => {\n\t\t\t\t\tstream?.getTracks().forEach((track) => {\n\t\t\t\t\t\tif (track.readyState === 'live')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tactiveTracks++;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tif (activeTransceivers < activeTracks)\n\t\t\t\t{\n\t\t\t\t\tObject.values(this.call.peers).forEach((peer) => {\n\t\t\t\t\t\tpeer.sendMedia();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tsetConnectionAnswer(connectionId, sdp, trackList)\n\t{\n\t\tif (!this.peerConnection || this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.signalingState !== 'have-local-offer')\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, wrong peer connection signaling state \" + this.peerConnection.signalingState);\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\ttype: \"answer\",\n\t\t\tsdp: sdp\n\t\t});\n\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\n\t\tthis.log(\"User: \" + this.userId + \"; Applying remote answer\");\n\t\tthis.peerConnection\n\t\t\t.setRemoteDescription(sessionDescription)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.failureReason = e.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log(e);\n\t\t\t})\n\t\t\t.finally(() =>\n\t\t\t{\n\t\t\t\tthis.call.setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t})\n\t\t;\n\t};\n\n\taddIceCandidate(connectionId, candidate)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Error: Candidate for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.remoteDescription && this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\tthis.peerConnection\n\t\t\t\t.addIceCandidate(candidate)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.pendingIceCandidates[connectionId])\n\t\t\t{\n\t\t\t\tthis.pendingIceCandidates[connectionId] = [];\n\t\t\t}\n\t\t\tthis.pendingIceCandidates[connectionId].push(candidate);\n\t\t}\n\t};\n\n\tapplyPendingIceCandidates()\n\t{\n\t\tif (!this.peerConnection || !this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isArray(this.pendingIceCandidates[this.peerConnectionId]))\n\t\t{\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId].forEach((candidate) =>\n\t\t\t{\n\t\t\t\tthis.peerConnection.addIceCandidate(candidate).then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId] = [];\n\t\t}\n\t};\n\n\tonNegotiationNeeded()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnection.signalingState == \"have-local-offer\")\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.createAndSendOffer({iceRestart: true});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t};\n\n\treconnect(event): void\n\t{\n\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\n\t\tthis.connectionAttempt++;\n\t\tconst maxConnectionAttempt = 3;\n\t\tconst connectionAttempt = this.call.CallApi?.isConnected() ? 0 : this.connectionAttempt;\n\n\t\tif (connectionAttempt > maxConnectionAttempt)\n\t\t{\n\t\t\tthis.log('Error: Too many reconnection attempts, giving up');\n\t\t\tthis.failureReason = 'Could not connect to user in time';\n\t\t\tthis.updateCalculatedState();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callbacks.onReconnecting(event);\n\n\t\tthis.log(`Trying to restore ICE connection. Attempt ${this.connectionAttempt}`);\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis._destroyPeerConnection();\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendNegotiationNeeded(true);\n\t\t}\n\t}\n\n\tdisconnect()\n\t{\n\t\tthis._destroyPeerConnection();\n\n\t\tthis.outgoingVideoTrack = null;\n\t\tthis.outgoingScreenTrack = null;\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingScreenAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\t};\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.disconnect();\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\tclearTimeout(this.answerTimeout);\n\t\tthis.answerTimeout = null;\n\n\t\tclearTimeout(this.connectionTimeout);\n\t\tthis.connectionTimeout = null;\n\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = null;\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaStopped = BX.DoNothing;\n\t};\n}\n","import {Type} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {\n\tEndpointDirection,\n\tUserState,\n\tQuality,\n\tUserMnemonic,\n\tCallEvent,\n\tCallState,\n\tCallType,\n\tProvider,\n\tDisconnectReason,\n} from './engine';\nimport {\n\tCall,\n\tCALL_STATE,\n\tMediaStreamsKinds,\n\tRecorderStatus,\n\tCloudRecordStatus,\n} from '../call_api.js';\nimport { MediaRenderer } from '../view/media-renderer';\nimport {SimpleVAD} from './simple_vad'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\n\nimport { UnsupportedBrowserFeatures } from './unsupported_features_in_browsers';\nimport { CallCommonRecordState, CallCommonRecordType, CallCloudRecord } from '../call_common_record';\nimport { CallStreamManager } from '../media-stream-manager';\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onDestroy\n */\n\nconst ajaxActions = {\n\tinvite: 'call.Call.invite',\n\tdecline: 'call.Call.decline',\n};\n\nconst clientEvents = {\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tscreenState: 'Call::screenState',\n\tcommonRecordState: 'Call::commonRecordState',\n\temotion: 'Call::emotion',\n\tcustomMessage: 'Call::customMessage',\n\tusersInvited: 'Call::usersInvited',\n\tuserInviteTimeout: 'Call::userInviteTimeout',\n\tshowUsers: 'Call::showUsers',\n\tshowAll: 'Call::showAll',\n\thideAll: 'Call::hideAll',\n};\n\nconst scenarioEvents = {\n\tviewerJoined: 'Call::viewerJoined',\n\tviewerLeft: 'Call::viewerLeft',\n};\n\nconst BitrixCallEvent = {\n\tonCallConference: 'BitrixCall::onCallConference'\n};\n\nconst invitePeriod = 30000;\nconst reinvitePeriod = 5500;\n\n// const MAX_USERS_WITHOUT_SIMULCAST = 6;\n\nexport class BitrixCall extends AbstractCall\n{\n\tstatic Event = BitrixCallEvent\n\tpeers: { [key: number]: Peer };\n\tlocalVAD: ?SimpleVAD;\n\n\t#isCloudRecordFeaturesEnabled: false;\n\t#cloudRecordState;\n\n\t#recorderState;\n\t#recorderStateHasChange;\n\n\t#isFirefox: Boolean;\n\n\tconstructor(config)\n\t{\n\t\tsuper(config);\n\n\t\tthis.videoQuality = Quality.VeryHigh; // initial video quality. will drop on new peers connecting\n\n\t\tthis.BitrixCall = null;\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.peers = {};\n\t\tthis.peersWithBadConnection = new Set();\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis._localUserState = UserState.Idle;\n\t\tthis.clientEventsBound = false;\n\t\tthis._screenShared = false;\n\t\tthis.videoAllowedFrom = UserMnemonic.all;\n\t\tthis.direction = EndpointDirection.SendRecv;\n\t\tthis.floorRequestActive = false;\n\n\t\tthis.microphoneLevelInterval = null;\n\n\t\tthis.initPeers();\n\n\t\tthis.reinviteTimeout = null;\n\n\t\tthis._reconnectionEventCount = 0;\n\t\tthis.waitForAnswerTimeout = null;\n\n\t\tthis.pullEventHandlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer,\n\t\t\t'Call::hangup': this.#onPullEventHangup,\n\t\t\t'Call::finish': this.#onPullEventFinish,\n\t\t\t'Call::switchTrackRecordStatus': this.#onPullEventSwitchTrackRecordStatus,\n\t\t};\n\n\t\tthis.#isCloudRecordFeaturesEnabled = true;\n\n\t\tthis.#recorderState = RecorderStatus.UNAVAILABLE;\n\t\tthis.#recorderStateHasChange = false;\n\t\tthis._isCopilotFeaturesEnabled = true;\n\t\tthis._isBoostExpired = false;\n\n\t\tthis.#isFirefox = BX.browser.IsFirefox();\n\n\t\tthis.#cloudRecordState = CloudRecordStatus.NONE;\n\t}\n\n\tget provider()\n\t{\n\t\treturn Provider.Bitrix;\n\t}\n\n\tget screenShared()\n\t{\n\t\treturn this._screenShared;\n\t}\n\n\tget isCopilotInitialized()\n\t{\n\t\treturn this.#recorderState !== RecorderStatus.UNAVAILABLE || this.#recorderStateHasChange;\n\t}\n\n\tget isCopilotActive()\n\t{\n\t\treturn this.#recorderState === RecorderStatus.ENABLED;\n\t}\n\n\tget isCopilotDisabled()\n\t{\n\t\treturn this.#recorderState === RecorderStatus.DESTROYED;\n\t}\n\n\tget isBoostExpired()\n\t{\n\t\treturn this._isBoostExpired;\n\t}\n\n\tset isBoostExpired(isBoostExpired)\n\t{\n\t\tif (isBoostExpired !== this._isBoostExpired)\n\t\t{\n\t\t\tthis._isBoostExpired = isBoostExpired;\n\t\t}\n\t}\n\n\tget isCopilotFeaturesEnabled()\n\t{\n\t\treturn this._isCopilotFeaturesEnabled;\n\t}\n\n\tset isCopilotFeaturesEnabled(isCopilotFeaturesEnabled)\n\t{\n\t\tif (isCopilotFeaturesEnabled !== this._isCopilotFeaturesEnabled)\n\t\t{\n\t\t\tthis._isCopilotFeaturesEnabled = isCopilotFeaturesEnabled;\n\t\t}\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\tget isCloudRecordFeaturesEnabled()\n\t{\n\t\treturn this.#isCloudRecordFeaturesEnabled;\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\tset isCloudRecordFeaturesEnabled(isCloudRecordFeaturesEnabled)\n\t{\n\t\tif (isCloudRecordFeaturesEnabled !== this.#isCloudRecordFeaturesEnabled)\n\t\t{\n\t\t\tthis.#isCloudRecordFeaturesEnabled = isCloudRecordFeaturesEnabled;\n\t\t}\n\t}\n\n\tset screenShared(screenShared)\n\t{\n\t\tif (screenShared !== this._screenShared)\n\t\t{\n\t\t\tthis._screenShared = screenShared;\n\t\t\tthis.signaling.sendScreenState(this._screenShared);\n\t\t}\n\t}\n\n\tget localUserState()\n\t{\n\t\treturn this._localUserState\n\t}\n\n\tset localUserState(state)\n\t{\n\t\tif (state === this._localUserState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.runCallback(CallEvent.onUserStateChanged, {\n\t\t\tuserId: this.userId,\n\t\t\tstate: state,\n\t\t\tpreviousState: this._localUserState,\n\t\t\tdirection: this.direction,\n\t\t});\n\t\tthis._localUserState = state;\n\t}\n\n\tget reconnectionEventCount()\n\t{\n\t\treturn this._reconnectionEventCount;\n\t}\n\n\tset reconnectionEventCount(newValue)\n\t{\n\t\tif (newValue === 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t}\n\t\tthis._reconnectionEventCount = newValue;\n\t}\n\n\tget hasConnectionData()\n\t{\n\t\treturn Boolean(this.connectionData.mediaServerUrl && this.connectionData.roomData);\n\t}\n\n\tinitPeers()\n\t{\n\t\tthis.users.forEach((userId) =>\n\t\t{\n\t\t\tuserId = Number(userId);\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t});\n\t};\n\n\treinitPeers()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t\tthis.peers[userId] = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.initPeers();\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\tlet incomingVideoAllowed;\n\t\tif (this.videoAllowedFrom === UserMnemonic.all)\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\t\telse if (this.videoAllowedFrom === UserMnemonic.none)\n\t\t{\n\t\t\tincomingVideoAllowed = false;\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tincomingVideoAllowed = this.videoAllowedFrom.some(allowedUserId => allowedUserId == userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tisIncomingVideoAllowed: incomingVideoAllowed,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t\tif (e.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tvideoPaused: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRemoved: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged,\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout,\n\n\t\t})\n\t};\n\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.peers).length;\n\t};\n\n\tcanChangeMediaDevices()\n\t{\n\t\treturn !this.BitrixCall?.isMediaMutedBySystem;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted === event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!event.data.calledProgrammatically && this.muted)\n\t\t\t{\n\t\t\t\tthis.signaling.sendMicrophoneState(!this.muted);\n\t\t\t}\n\n\t\t\tif (this.muted)\n\t\t\t{\n\t\t\t\tthis.BitrixCall.disableAudio({ calledFrom: 'setMuted' });\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t\t\t}\n\t\t\t\tthis.BitrixCall.enableAudio({ calledFrom: 'setMuted' });\n\t\t\t}\n\t\t}\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled === event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!event.data.calledProgrammatically)\n\t\t\t{\n\t\t\t\tthis.signaling.sendCameraState(this.videoEnabled);\n\t\t\t}\n\n\t\t\tif (this.videoEnabled)\n\t\t\t{\n\t\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\t}\n\t\t\t\tthis.localVideoShown = true;\n\t\t\t\tthis.BitrixCall.enableVideo({calledFrom: 'setVideoEnabled'});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.localVideoShown)\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tthis.BitrixCall.disableVideo({calledFrom: 'setVideoEnabled'});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId === cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst canSwitchDevice = Boolean(this.cameraId);\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!cameraId)\n\t\t\t{\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Camera);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!canSwitchDevice)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\n\t\t\tthis.BitrixCall.switchActiveVideoDevice(this.cameraId)\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (Hardware.isCameraOn)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback('onUpdateLastUsedCameraId');\n\n\t\t\t\t\t\tif (this.BitrixCall.isVideoPublished() && this.canChangeMediaDevices())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst track = CallStreamManager.getLocalStream(MediaStreamsKinds.Camera);\n\t\t\t\t\t\t\tconst kind = Util.MediaKind[MediaStreamsKinds.Camera];\n\t\t\t\t\t\t\tconst mediaRenderer = new MediaRenderer({ kind, track });\n\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\t\tmediaRenderer,\n\t\t\t\t\t\t\t\ttag: 'main',\n\t\t\t\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (this.BitrixCall.isVideoPublished())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!this.canChangeMediaDevices())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onNeedResetMediaDevicesState);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\t\t\tthis.BitrixCall.enableVideo({calledFrom: 'switchActiveVideoDevice', skipUnpause: true});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Camera);\n\t\t\t\t});\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId === microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst canSwitchDevice = Boolean(this.microphoneId);\n\t\tthis.microphoneId = microphoneId;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!microphoneId)\n\t\t\t{\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Microphone);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!canSwitchDevice)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t\tthis.#onEndpointVoiceEnd({ userId: this.userId });\n\n\t\t\tthis.BitrixCall.switchActiveAudioDevice(this.microphoneId)\n\t\t\t\t.then(() => {\n\t\t\t\t\tconst track = CallStreamManager.getLocalStream(MediaStreamsKinds.Microphone);\n\t\t\t\t\tthis.#onMicAccessResult({\n\t\t\t\t\t\tresult: true,\n\t\t\t\t\t\tstream: new MediaStream([track]),\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.log(error);\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tmicrophoneState: false,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\n\t\t\t\t\tif (Hardware.isMicrophoneMuted && !this.canChangeMediaDevices())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.BitrixCall.disableAudio({ calledFrom: 'setMicrophoneId' });\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t};\n\n\tsetRecorderState(state)\n\t{\n\t\tif (!this.BitrixCall || this.#recorderState === state)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.BitrixCall.setRecorderState(state);\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\tsetCloudRecordState(state, kind = null)\n\t{\n\t\tif (!this.BitrixCall || this.#cloudRecordState === state)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.BitrixCall.setCloudRecordState(state, kind);\n\t}\n\n\t#setPublishingState(deviceType, publishing)\n\t{\n\t\tif (deviceType === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCameraPublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t\telse if (deviceType === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onMicrophonePublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t}\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\tsetMainStream(users)\n\t{\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (users.userId && users.userId !== this.userId)\n\t\t{\n\t\t\tconst participant = this.peers[users.userId]?.participant;\n\t\t\tconst kind = participant?.screenSharingEnabled ? MediaStreamsKinds.Screen : MediaStreamsKinds.Camera;\n\t\t\tthis.BitrixCall.setMainStream(users, kind);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.BitrixCall.resetMainStream(users);\n\t\t}\n\t}\n\n\tsetVideoQualityForStreams(params)\n\t{\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.BitrixCall.setVideoQualityForStreams(params);\n\t}\n\n\trequestFloor(requestActive)\n\t{\n\t\tif (this.floorRequestActive === requestActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.floorRequestActive = requestActive;\n\t\tthis.BitrixCall.raiseHand(requestActive);\n\t};\n\n\tupdateUserData(userData: Object): void\n\t{\n\t\tthis.BitrixCall.updateUserData(userData);\n\t}\n\n\tturnOffAllParticipansStream(options)\n\t{\n\t\tthis.BitrixCall.turnOffAllParticipansStream(options);\n\t};\n\n\tturnOffParticipantStream(options)\n\t{\n\t\tthis.BitrixCall.turnOffParticipantStream(options);\n\t};\n\n\tallowSpeakPermission(options)\n\t{\n\t\tthis.BitrixCall.allowSpeakPermission(options);\n\t};\n\n\tchangeSettings(options)\n\t{\n\t\tthis.BitrixCall.changeSettings(options);\n\t};\n\n\t/**\n\t * @group CommonRecord\n\t * @param { Object } commonRecordState\n\t * @param { string } commonRecordState.action\n\t * @param { string } commonRecordState.type\n\t * @param { Date } commonRecordState.date\n\t * @param { boolean } force\n\t */\n\tsendLocalRecordState(commonRecordState, force = false)\n\t{\n\t\tif (!force && !this.updateCommonRecordState({ ...commonRecordState, senderId: this.userId }))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.signaling.sendLocalRecordState(this.userId, this.commonRecordState);\n\t}\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\tthis.signaling.sendCustomMessage(message, repeatOnConnect);\n\t};\n\n\t/**\n\t * Updates list of users,\n\t */\n\tallowVideoFrom(userList: $Keys<typeof UserMnemonic> | number[])\n\t{\n\t\tif (this.videoAllowedFrom == userList)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoAllowedFrom = userList;\n\n\t\tif (userList === UserMnemonic.all)\n\t\t{\n\t\t\tthis.signaling.sendShowAll();\n\t\t\tuserList = Object.keys(this.peers);\n\t\t}\n\t\telse if (userList === UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t\tuserList = [];\n\t\t}\n\t\telse if (Type.isArray(userList))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(userList)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error(\"userList is in wrong format\");\n\t\t}\n\n\t\tlet users = {};\n\t\tuserList.forEach(userId => users[userId] = true);\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (!this.peers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (users[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(false);\n\t\t\t}\n\t\t}\n\t};\n\n\tstartScreenSharing()\n\t{\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.waitingLocalScreenShare = true;\n\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\tuserId: this.userId,\n\t\t\tscreenState: true,\n\t\t});\n\n\t\tthis.BitrixCall.startScreenShare();\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Screen);\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.screenShared || this.waitingLocalScreenShare;\n\t};\n\n\tisGetUserMediaFulfilled()\n\t{\n\t\treturn this.getUserMediaFulfilled;\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t */\n\tinviteUsers(config: { users: ?number[], userData: ?Object, show: ?boolean } = {})\n\t{\n\t\tthis.ready = true;\n\t\tconst usersToInvite = Type.isArray(config.users) ? config.users : this.users;\n\n\t\tthis.attachToConference()\n\t\t\t.then(() => {\n\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.waitForAnswerTimeout);\n\t\t\t\t\tthis.waitForAnswerTimeout = setTimeout(() => {\n\t\t\t\t\t\tthis.#onNoAnswer();\n\t\t\t\t\t}, invitePeriod);\n\t\t\t\t}\n\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true,\n\t\t\t\t});\n\n\t\t\t\tusersToInvite.forEach((user) => {\n\t\t\t\t\tconst userId = parseInt(user, 10);\n\t\t\t\t\tif (!this.users.includes(userId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.users.push(userId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.peers[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (config.userData && config.show)\n\t\t\t\t{\n\t\t\t\t\tconst inviteParams = {\n\t\t\t\t\t\tusers: config.userData,\n\t\t\t\t\t};\n\t\t\t\t\tthis.signaling.sendUsersInvited(inviteParams);\n\t\t\t\t}\n\n\t\t\t\tif (config.show && this.type === CallType.Instant && usersToInvite.length > 0)\n\t\t\t\t{\n\t\t\t\t\tconst inviteParams = {\n\t\t\t\t\t\tusers: usersToInvite,\n\t\t\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\t\t\t\trepeated: 'Y',\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.signaling.inviteUsers(inviteParams).then(() => this.scheduleRepeatInvite());\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tthis.#onFatalError(e);\n\t\t\t})\n\t\t;\n\t}\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(() => this.repeatInviteUsers(), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst inviteParams = {\n\t\t\tusers: usersToRepeatInvite,\n\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\trepeated: 'Y',\n\t\t}\n\t\tthis.signaling.inviteUsers(inviteParams).then(() => this.scheduleRepeatInvite());\n\t};\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool?} [config.useVideo]\n\t * @param {bool?} [config.joinAsViewer]\n\t */\n\tanswer(config = {})\n\t{\n\t\tthis.ready = true;\n\t\tconst joinAsViewer = config.joinAsViewer === true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\n\t\tthis.attachToConference({joinAsViewer: joinAsViewer})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Attached to conference\");\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(err);\n\t\t\t})\n\t\t;\n\t};\n\n\tdecline(code)\n\t{\n\t\tthis.ready = false;\n\t\tconst data = {\n\t\t\tcallUuid: this.uuid,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\n\t\tif (code)\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\n\t\tBX.ajax.runAction(ajaxActions.decline, { data });\n\t}\n\n\thangup(code, reason, finishCall = false)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\n\t\tlet data = {};\n\t\tthis.ready = false;\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t//clone users and append current user id to send event to all participants of the call\n\t\tdata.userId = this.users.slice(0).concat(this.userId);\n\n\t\tif (reason !== 'SIGNALING_DUPLICATE_PARTICIPANT') {\n\t\t\t// for future reconnections\n\t\t\tthis.reinitPeers();\n\t\t}\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.BitrixCall._replaceVideoSharing = false;\n\t\t\tthis.BitrixCall.hangup(!!finishCall);\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Tried to hangup, but this.BitrixCall points nowhere\");\n\t\t\tconsole.error(\"Tried to hangup, but this.BitrixCall points nowhere\");\n\t\t}\n\n\t\tthis.connectionData = {};\n\n\t\tthis.screenShared = false;\n\t\tthis.localVideoShown = false;\n\t\tthis.floorRequestActive = false;\n\t};\n\n\tattachToConference(options: { joinAsViewer: ?boolean } = {})\n\t{\n\t\tconst joinAsViewer = options.joinAsViewer === true;\n\t\tif (this.BitrixCall && this.BitrixCall.getState() === CALL_STATE.CONNECTED)\n\t\t{\n\t\t\tif (this.joinedAsViewer === joinAsViewer)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Promise.reject(\"Already joined call in another mode\");\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.direction = joinAsViewer ? EndpointDirection.RecvOnly : EndpointDirection.SendRecv;\n\t\t\tthis.sendTelemetryEvent(\"call\");\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.localUserState = UserState.Connecting;\n\t\t\t\tthis.BitrixCall = new Call(this.userId);\n\n\t\t\t\t/*if (Hardware.isCameraOn) // transfered to #onCallConnected\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t}*/\n\n\t\t\t\tthis.joinedAsViewer = joinAsViewer;\n\n\t\t\t\tif (!this.BitrixCall)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Error: could not create Bitrix call\");\n\t\t\t\t\treturn reject({code: \"BITRIX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.runCallback(BitrixCallEvent.onCallConference, {\n\t\t\t\t\tcall: this\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\tthis.BitrixCall.on('Connected', () => {\n\t\t\t\t\tthis.#onCallConnected();\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\tthis.BitrixCall.on('Failed', (e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.#onCallFailed(e);\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\n\t\t\t\tif (!this.ready)\n\t\t\t\t{\n\t\t\t\t\t// for rare cases with fast quit\n\t\t\t\t\treturn reject({code: \"BITRIX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.BitrixCall.connect({\n\t\t\t\t\troomId: this.uuid,\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tuserRole: this.userRole,\n\t\t\t\t\tvideoBitrate: 1_000_000,\n\t\t\t\t\tvideoSimulcast: true,\n\t\t\t\t\taudioDeviceId: this.microphoneId,\n\t\t\t\t\tvideoDeviceId: this.cameraId,\n\t\t\t\t\t...this.connectionData,\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e);\n\t\t\t}\n\t\t});\n\t};\n\n\t#onCallConnected()\n\t{\n\t\tthis.reconnectionEventCount = 0;\n\t\tthis.log(\"Call connected\");\n\t\tthis.sendTelemetryEvent(\"connect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tconst MAX_USERS_WITH_VIDEO = Util.countDisableCameraNewJoinedUsersFeature();\n\n\t\tif (Util.isDisableCameraNewJoinedUsersFeatureEnabled() && this.BitrixCall.remoteParticipantsCount >= MAX_USERS_WITH_VIDEO) // task-596223\n\t\t{\n\t\t\tHardware.isCameraOn = false;\n\t\t}\n\n\t\tif (!Util.havePermissionToBroadcast('cam'))\n\t\t{\n\t\t\tHardware.isCameraOn = false;\n\t\t}\n\n\t\tif (!Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = true;\n\t\t}\n\n\t\tthis.BitrixCall.on('Failed', this.#onCallDisconnected);\n\n\t\t//this.signaling.sendCameraState(Hardware.isCameraOn);\n\n\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\tthis.BitrixCall.enableAudio({ calledFrom: 'onCallConnected', disabled: Hardware.isMicrophoneMuted });\n\n\t\tif (Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.localVideoShown = true;\n\n\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\t\t\tthis.BitrixCall.enableVideo({ calledFrom: 'onCallConnected' });\n\t\t}\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\t};\n\n\t#onCallFailed(e)\n\t{\n\t\tthis.log(\"Could not attach to conference\", e);\n\t\tthis.sendTelemetryEvent(\"connect_failure\");\n\t\tthis.localUserState = UserState.Failed;\n\n\t\tthis.BitrixCall.enableSilentLogging(false);\n\t\tthis.BitrixCall.setLoggerCallback(null);\n\t};\n\n\tbindCallEvents()\n\t{\n\t\tthis.BitrixCall.on('PublishSucceed', this.#onLocalMediaRendererAdded);\n\t\tthis.BitrixCall.on('PublishPaused', this.#onLocalMediaRendererMuteToggled);\n\t\tthis.BitrixCall.on('MediaMutedBySystem', this.#onMediaMutedBySystem);\n\t\tthis.BitrixCall.on('PublishFailed', this.#onLocalMediaRendererEnded);\n\t\tthis.BitrixCall.on('PublishEnded', this.#onLocalMediaRendererEnded);\n\t\tthis.BitrixCall.on('GetUserMediaStarted', this.#onGetUserMediaStarted.bind(this));\n\t\tthis.BitrixCall.on('GetUserMediaEnded', this.#onGetUserMediaEnded);\n\t\tthis.BitrixCall.on('GetUserMediaSuccess', this.#onGetUserMediaSuccess.bind(this));\n\t\tthis.BitrixCall.on('RemoteMediaAdded', this.#onRemoteMediaAdded);\n\t\tthis.BitrixCall.on('RemoteMediaRemoved', this.#onRemoteMediaRemoved);\n\t\tthis.BitrixCall.on('RemoteMediaMuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.BitrixCall.on('RemoteMediaUnmuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.BitrixCall.on('AwaitedRemoteMediaMuted', this.#onAwaitedRemoteMediaMuted);\n\t\tthis.BitrixCall.on('ParticipantJoined', this.#onParticipantJoined);\n\t\tthis.BitrixCall.on('ParticipantStateUpdated', () => console.log('handleParticipantStateUpdated'));\n\t\tthis.BitrixCall.on('ParticipantLeaved', this.#onParticipantLeaved);\n\t\tthis.BitrixCall.on('MessageReceived', this.#onCallMessageReceived);\n\t\tthis.BitrixCall.on('HandRaised', this.#onCallHandRaised);\n\t\tthis.BitrixCall.on('VoiceStarted', this.#onEndpointVoiceStart);\n\t\tthis.BitrixCall.on('TurnOnCamera', this.#onTurnOnCamera);\n\t\tthis.BitrixCall.on('AllParticipantsAudioMuted', this.#onAllParticipantsAudioMuted);\n\t\tthis.BitrixCall.on('AllParticipantsVideoMuted', this.#onAllParticipantsVideoMuted);\n\t\tthis.BitrixCall.on('AllParticipantsScreenshareMuted', this.#onAllParticipantsScreenshareMuted);\n\t\tthis.BitrixCall.on('YouMuteAllParticipants', this.#onYouMuteAllParticipants);\n\t\tthis.BitrixCall.on('RoomSettingsChanged', this.#onRoomSettingsChanged);\n\t\tthis.BitrixCall.on('UserPermissionsChanged', this.#onUserPermissionsChanged);\n\t\tthis.BitrixCall.on('UserRoleChanged', this.#onUserRoleChanged);\n\t\tthis.BitrixCall.on('ParticipantMuted', this.#onParticipantMuted);\n\t\tthis.BitrixCall.on('VoiceEnded', this.#onEndpointVoiceEnd);\n\t\tthis.BitrixCall.on('RecorderStatusChanged', this.#onRecorderStatusChanged);\n\t\tthis.BitrixCall.on('CloudRecordStatusChanged', this.#onCloudRecordStatusChanged);\n\t\tthis.BitrixCall.on('Reconnecting', this.#onCallReconnecting);\n\t\tthis.BitrixCall.on('Reconnected', this.#onCallReconnected);\n\t\tthis.BitrixCall.on('ReconnectingFailed', this.#onCallReconnectingFailed);\n\t\tthis.BitrixCall.on('Disconnected', this.#onCallDisconnected);\n\t\t// if (Util.shouldCollectStats())\n\t\t// {\n\t\tthis.BitrixCall.on('CallStatsReceived', this.#onCallStatsReceived);\n\t\t// }\n\t\tthis.BitrixCall.on('UpdatePacketLoss', this.#onUpdatePacketLoss);\n\t\tthis.BitrixCall.on('ConnectionQualityChanged', this.#onConnectionQualityChanged);\n\t\tthis.BitrixCall.on('ToggleRemoteParticipantVideo', this.#onToggleRemoteParticipantVideo);\n\t\tthis.BitrixCall.on('TrackSubscriptionFailed', this.#onTrackSubscriptionFailed);\n\t};\n\n\tremoveCallEvents()\n\t{\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.BitrixCall.on('Failed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishSucceed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishFailed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('GetUserMediaEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RemoteMediaAdded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RemoteMediaRemoved', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantJoined', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantStateUpdated', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantLeaved', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('MessageReceived', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('HandRaised', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsAudioMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsVideoMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsScreenshareMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('YouMuteAllParticipants', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('VoiceStarted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('VoiceEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RecorderStatusChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('CloudRecordStatusChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Reconnecting', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Reconnected', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ReconnectingFailed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Disconnected', BX.DoNothing);\n\t\t\t// if (Util.shouldCollectStats())\n\t\t\t// {\n\t\t\tthis.BitrixCall.on('CallStatsReceived', BX.DoNothing);\n\t\t\t// }\n\t\t\tthis.BitrixCall.on('UpdatePacketLoss', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ConnectionQualityChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ToggleRemoteParticipantVideo', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('TrackSubscriptionFailed', BX.DoNothing);\n\t\t}\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Object} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let id in users)\n\t\t{\n\t\t\tconst userId = Number(id);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\tuserId: userId,\n\t\t\t\t\tuserData: {[userId]: users[id]},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.type === CallType.Instant && this.peers[userId].calculatedState !== UserState.Calling)\n\t\t\t{\n\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t}\n\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\ttoggleRemoteParticipantVideo(participants, showVideo, isPaginateToggle = false) {\n\t\tif (this.BitrixCall) {\n\t\t\tthis.BitrixCall.toggleRemoteParticipantVideo(participants, showVideo, isPaginateToggle)\n\t\t}\n\t}\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t#onPeerStateChanged = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.state === UserState.Failed || e.state === UserState.Unavailable || e.state === UserState.Declined || e.state === UserState.Idle)\n\t\t{\n\t\t\tif (this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\t// this.hangup();\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout = (e) =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t#onNoAnswer()\n\t{\n\t\tif (this.ready && !this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.destroy(true);\n\t\t}\n\t}\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tif (this.pullEventHandlers[command])\n\t\t{\n\t\t\tif (command !== 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\tthis.pullEventHandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventAnswer = (params) =>\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.__onPullEventAnswerSelf(params);\n\t\t}\n\t};\n\n\t__onPullEventAnswerSelf(params)\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.runCallback(CallEvent.onJoin, { local: false });\n\t}\n\n\t#onPullEventHangup = (params) => {\n\t\tconst senderId = params.senderId;\n\t\tconst callInstanceId = params.callInstanceId;\n\t\tconst peer = this.peers[senderId];\n\n\t\tif (this.userId === senderId && callInstanceId && this.instanceId !== callInstanceId)\n\t\t{\n\t\t\t// Call declined by the same user elsewhere\n\t\t\tthis.runCallback(CallEvent.onLeave, { local: false });\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.code === 603 && (peer?.calculatedState === UserState.Connected || peer?.calculatedState === UserState.Connecting))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.code === 603 && this.userId !== senderId)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserStateChanged, { userId: senderId, callId: params.callId, state: UserState.Declined });\n\t\t}\n\n\t\tif (!peer || (peer.participant && !callInstanceId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.sendLog({\n\t\t\tparams,\n\t\t\tdescription: 'GOT A #onPullEventHangup from user',\n\t\t\tpullEvent: '#onPullEventHangup',\n\t\t});\n\n\t\tif (!peer.participant)\n\t\t{\n\t\t\tif (params.code == 486)\n\t\t\t{\n\t\t\t\tpeer.setBusy(true);\n\t\t\t\tconsole.warn(`user ${senderId} is busy`);\n\t\t\t}\n\n\t\t\tif (this.ready && this.type === CallType.Instant && !this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup();\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPullEventFinish = () =>\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventSwitchTrackRecordStatus = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onSwitchTrackRecordStatus, {\n\t\t\tisTrackRecordOn: e.isTrackRecordOn,\n\t\t\terrorCode: e.errorCode,\n\t\t});\n\t}\n\n\t#onLocalMediaRendererAdded = (mediaStreamsKind) => {\n\t\tconst kind = Util.MediaKind[mediaStreamsKind];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for local mediaRenderer: ${mediaStreamsKind}`);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('__onLocalMediaRendererAdded', kind);\n\n\t\tconst isNotSupportDevicesListBeforeStream = UnsupportedBrowserFeatures.isNotSupportDevicesListBeforeStream;\n\t\tlet track = null;\n\t\tlet mediaRenderer = null;\n\n\t\tswitch (mediaStreamsKind)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tif (!this.videoEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttrack = CallStreamManager.getLocalStream(mediaStreamsKind);\n\t\t\t\tmediaRenderer = new MediaRenderer({ kind, track });\n\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'main',\n\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t});\n\n\t\t\t\tif (isNotSupportDevicesListBeforeStream)\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onGetUserMediaEnded, {});\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.log('Screen shared');\n\t\t\t\tthis.screenShared = true;\n\t\t\t\tthis.waitingLocalScreenShare = false;\n\n\t\t\t\ttrack = CallStreamManager.getLocalStream(mediaStreamsKind);\n\t\t\t\tmediaRenderer = new MediaRenderer({ kind, track });\n\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'screen',\n\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.signaling.sendMicrophoneState(true);\n\t\t\t\tthis.#setPublishingState(mediaStreamsKind, false);\n\n\t\t\t\ttrack = CallStreamManager.getLocalStream(mediaStreamsKind);\n\t\t\t\tthis.#onMicAccessResult({\n\t\t\t\t\tresult: true,\n\t\t\t\t\tstream: new MediaStream([track]),\n\t\t\t\t});\n\n\t\t\t\tif (isNotSupportDevicesListBeforeStream)\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onGetUserMediaEnded, {});\n\t\t\t\t}\n\n\t\t\t\tif (Hardware.isMicrophoneMuted) // task-597518\n\t\t\t\t{\n\t\t\t\t\tthis.BitrixCall?.disableAudio({ calledFrom: 'onLocalMediaRendererAdded' });\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t}\n\t};\n\n\t#onLocalMediaRendererMuteToggled = (source, muted) => {\n\t\tif (source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\tthis.signaling.sendMicrophoneState(!muted);\n\t\t}\n\t\telse if (source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t}\n\t};\n\n\t#onMediaMutedBySystem = (muted) =>\n\t{\n\t\tconst microphoneState = muted ? false : !Hardware.isMicrophoneMuted;\n\t\tconst cameraState = muted ? false : Hardware.isCameraOn;\n\t\tthis.signaling.sendMicrophoneState(microphoneState);\n\t\tthis.signaling.sendCameraState(cameraState);\n\t}\n\n\t#onLocalMediaRendererEnded = (e, interrupted) =>\n\t{\n\t\tconst kind = Util.MediaKind[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (e)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tif (!interrupted)\n\t\t\t\t{\n\t\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(e);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(e);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t#onGetUserMediaStarted = (options) =>\n\t{\n\t\tthis.getUserMediaFulfilled = false;\n\n\t\tif (options.video)\n\t\t{\n\t\t\tthis.signaling.sendCameraState(false);\n\t\t}\n\n\t\tif (options.audio)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(false);\n\t\t}\n\t};\n\n\t#onGetUserMediaSuccess = (options) =>\n\t{\n\t\tif (options.video)\n\t\t{\n\t\t\tthis.signaling.sendCameraState(true);\n\t\t}\n\t}\n\n\t#onGetUserMediaEnded = () =>\n\t{\n\t\tthis.getUserMediaFulfilled = true;\n\t};\n\n\t#onBeforeLocalMediaRendererRemoved = (e) =>\n\t{\n\t\tconst kind = Util.MediaKind[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"__onBeforeLocalMediaRendererRemoved\", kind);\n\n\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\tkind,\n\t\t});\n\n\t\tswitch (e) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'main',\n\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\tremoved: true,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaStopped, { kind });\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\t\tthis.signaling.sendMicrophoneState(false);\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.BitrixCall.stopScreenShare();\n\t\t\t\tthis.log(\"Screen is no longer shared\");\n\t\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tscreenState: false,\n\t\t\t\t});\n\t\t\t\tthis.screenShared = false;\n\t\t\t\tthis.waitingLocalScreenShare = false;\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'screen',\n\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\tremoved: true,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\t#onRemoteMediaAdded = (p, t) =>\n\t{\n\t\tif (p && t)\n\t\t{\n\t\t\tconst kind = Util.MediaKind[t.source];\n\t\t\tif (!kind)\n\t\t\t{\n\t\t\t\tthis.log(`Wrong kind for mediaRenderer: ${t.source}`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst e = {\n\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\tkind,\n\t\t\t\t\ttrack: t.track\n\t\t\t\t})\n\t\t\t};\n\n\t\t\tconst peer = this.peers[p.userId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\t// temporary solution to play new streams\n\t\t\t\t// todo: need to find what cause the problem itself\n\t\t\t\tif (!peer.participant)\n\t\t\t\t{\n\t\t\t\t\tpeer.participant = p;\n\t\t\t\t\tpeer.updateCalculatedState();\n\t\t\t\t}\n\t\t\t\tpeer.addMediaRenderer(e.mediaRenderer);\n\t\t\t}\n\n\t\t\tswitch (t.source)\n\t\t\t{\n\t\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\t\tcameraState: !p.isMutedVideo\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\t\tmicrophoneState: !p.isMutedAudio\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconsole.log(`[RemoteMediaAdded]: UserId: ${p.userId}, source: ${Util.MediaKind[t.source]}`);\n\t\t\tconst cameraStateInfo = t.source === MediaStreamsKinds.Camera ? `, cameraState: ${!p?.isMutedVideo}` : '';\n\t\t\tUtil.sendLog({ description: `[RemoteMediaAdded]: UserId: ${p.userId}, source: ${Util.MediaKind[t.source]}${cameraStateInfo}` });\n\t\t}\n\t};\n\n\t#onRemoteMediaRemoved = (p, t) =>\n\t{\n\t\tif (p && t) // sometimes track could be 'undefined'\n\t\t{\n\t\t\tconst kind = Util.MediaKind[t.source];\n\t\t\tif (!kind)\n\t\t\t{\n\t\t\t\tthis.log(`Wrong kind for mediaRenderer: ${t.source}`);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst e = {\n\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\tkind,\n\t\t\t\t\ttrack: t.track\n\t\t\t\t})\n\t\t\t};\n\n\t\t\tconst peer = this.peers[p.userId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.removeMediaRenderer(e.mediaRenderer);\n\t\t\t}\n\n\t\t\tif (t.source === MediaStreamsKinds.Camera)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tcameraState: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconsole.log(`[RemoteMediaRemoved]: UserId: ${p.userId}, source: ${Util.MediaKind[t.source]}`);\n\t\t\tconst cameraStateInfo = t.source === MediaStreamsKinds.Camera ? ', cameraState: false' : '';\n\t\t\tUtil.sendLog({ description: `[RemoteMediaRemoved]: UserId: ${p.userId}, source: ${Util.MediaKind[t.source]}${cameraStateInfo}` });\n\t\t}\n\t};\n\n\t#onAwaitedRemoteMediaMuted = (p, t) =>\n\t{\n\t\tif (t.source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tcameraState: !t.muted,\n\t\t\t});\n\t\t}\n\t}\n\n\t#onRemoteMediaMuteToggled = (p, t) =>\n\t{\n\t\tif (t.source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tmicrophoneState: !p.isMutedAudio\n\t\t\t});\n\t\t}\n\t}\n\n\t#onUsersInvited = (params) =>\n\t{\n\t\tthis.log('__onUsersInvited', params);\n\t\tconst users = params.users;\n\t\tconst show = params.show;\n\n\t\tif (this.type === CallType.Instant)\n\t\t{\n\t\t\tthis.addInvitedUsers(users, show);\n\t\t}\n\t};\n\n\t#onUserInviteTimeout = (params) =>\n\t{\n\t\tthis.log('__onUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onParticipantJoined = (p) => {\n\t\tclearTimeout(this.waitForAnswerTimeout);\n\t\tlet peer = this.peers[p.userId];\n\n\t\tif (!peer)\n\t\t{\n\t\t\tconst userId = parseInt(p.userId, 10);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\n\t\t\tpeer = this.createPeer(userId);\n\t\t\tthis.peers[userId] = peer;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserJoined, {\n\t\t\tuserId: p.userId,\n\t\t\tuserData: {\n\t\t\t\t[p.userId]: {\n\t\t\t\t\tname: p.name,\n\t\t\t\t\tavatar_hr: p.image,\n\t\t\t\t\tavatar: p.image,\n\t\t\t\t\tgender: p.gender,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tif (!p.audioEnabled || p.isMutedAudio)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tmicrophoneState: false,\n\t\t\t});\n\t\t}\n\n\t\tif (!p.videoEnabled || p.isMutedVideo)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tcameraState: false,\n\t\t\t});\n\t\t}\n\n\t\tif (p.isHandRaised)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\trequestActive: p.isHandRaised,\n\t\t\t});\n\t\t}\n\n\t\tpeer.participant = p;\n\t\tpeer.setReady(true);\n\n\t\tif (this.commonRecordState.state !== CallCommonRecordState.Stopped && this.commonRecordState.userId === this.userId)\n\t\t{\n\t\t\tthis.signaling.sendLocalRecordState(this.userId, this.commonRecordState);\n\t\t}\n\t};\n\n\t#onParticipantLeaved = (p) => {\n\t\tconst peer = this.peers[p.userId];\n\n\t\tif (peer)\n\t\t{\n\t\t\tfor (const type in MediaStreamsKinds)\n\t\t\t{\n\t\t\t\tconst source = MediaStreamsKinds[type];\n\t\t\t\tconst kind = Util.MediaKind[source];\n\t\t\t\tconst e = {\n\t\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\t\tkind,\n\t\t\t\t\t}),\n\t\t\t\t};\n\t\t\t\tpeer.removeMediaRenderer(e.mediaRenderer);\n\t\t\t}\n\t\t\tpeer.participant = null;\n\t\t\tpeer.setReady(false);\n\t\t}\n\t};\n\n\t#onMicAccessResult = (e) =>\n\t{\n\t\tif (e.result)\n\t\t{\n\t\t\tif (e.stream.getAudioTracks().length > 0)\n\t\t\t{\n\t\t\t\tif (this.localVAD)\n\t\t\t\t{\n\t\t\t\t\tthis.localVAD.destroy();\n\t\t\t\t}\n\t\t\t\tthis.localVAD = new SimpleVAD({\n\t\t\t\t\tmediaStream: e.stream,\n\t\t\t\t\tonVoiceStarted: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!Hardware.isMicrophoneMuted)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.requestFloor(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#onEndpointVoiceStart({userId: this.userId});\n\t\t\t\t\t},\n\t\t\t\t\tonVoiceStopped: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onEndpointVoiceEnd({userId: this.userId});\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t\t\tthis.microphoneLevelInterval = setInterval(\n\t\t\t\t\t() =>this.microphoneLevel = this.localVAD.currentVolume,\n\t\t\t\t\t200\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onCallReconnecting = (params) =>\n\t{\n\t\tif (this._reconnectionEventCount === 0)\n\t\t{\n\t\t\tparams.reconnectionEventCount = this.reconnectionEventCount + 1;\n\n\t\t\tthis.runCallback(CallEvent.onReconnecting, params);\n\t\t}\n\n\t\tif (this.reconnectionEventCount++)\n\t\t{\n\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (userId !== this.userId && this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tfor (let type in MediaStreamsKinds)\n\t\t\t\t{\n\t\t\t\t\tconst source = MediaStreamsKinds[type];\n\t\t\t\t\tconst kind = Util.MediaKind[source];\n\t\t\t\t\tconst e = {\n\t\t\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\t\t\tkind,\n\t\t\t\t\t\t}),\n\t\t\t\t\t};\n\t\t\t\t\tthis.peers[userId].removeMediaRenderer(e.mediaRenderer);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#onCallReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount = 0;\n\t\tthis.log(\"Call reconnected\");\n\t\tthis.sendTelemetryEvent(\"reconnect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\tthis.BitrixCall.enableAudio({ calledFrom: 'onCallConnected', disabled: Hardware.isMicrophoneMuted });\n\n\t\t//this.signaling.sendCameraState(Hardware.isCameraOn);\n\t\tif (Hardware.isCameraOn)\n\t\t{\n\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\t\t\tthis.BitrixCall.enableVideo({calledFrom: 'onCallReconnected'});\n\t\t}\n\n\t\tif (this.screenShared || this.waitingLocalScreenShare)\n\t\t{\n\t\t\tthis.BitrixCall.startScreenShare();\n\t\t}\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\n\t\tif (this.commonRecordState.userId === this.userId)\n\t\t{\n\t\t\tthis.sendLocalRecordState({ action: this.commonRecordState.state, userId: this.userId }, true);\n\t\t}\n\n\t\tthis.BitrixCall.raiseHand(this.floorRequestActive);\n\t};\n\n\t#onCallReconnectingFailed = (e, error) => {\n\t\tthis.runCallback(CallEvent.onReconnectingFailed, { error });\n\t};\n\n\t#onCallDisconnected = (e) =>\n\t{\n\t\tlet logData = {};\n\n\t\tconst evt = e && typeof e === 'object' ? e : {}\n\t\tconst {headers, leaveInformation} = evt;\n\n\t\tif (headers) {\n\t\t\tlogData = {\n\t\t\t\t...logData,\n\t\t\t\theaders,\n\t\t\t}\n\t\t}\n\n\t\tif (leaveInformation) {\n\t\t\tlogData = {\n\t\t\t\t...logData,\n\t\t\t\tleaveInformation,\n\t\t\t}\n\t\t}\n\n\t\tthis.log(\"__onCallDisconnected\", (Object.keys(logData).length ? logData : null));\n\n\t\tif (this.ready && leaveInformation?.reason !== DisconnectReason.SecurityKeyChanged)\n\t\t{\n\t\t\tthis.hangup(leaveInformation?.code, leaveInformation?.reason);\n\t\t}\n\n\t\tthis.sendTelemetryEvent(\"disconnect\");\n\n\t\tthis.localUserState = UserState.Idle;\n\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.reinitPeers();\n\n\t\tthis.localVideoShown = false;\n\t\tthis.removeCallEvents();\n\t\tthis.unsubscribeHardwareChanges();\n\n\t\tthis.state = CallState.Proceeding;\n\n\t\tif (leaveInformation?.reason === DisconnectReason.SecurityKeyChanged)\n\t\t{\n\t\t\tthis.#onFatalError(leaveInformation.reason);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (leaveInformation?.reason === DisconnectReason.RoomClosed)\n\t\t{\n\t\t\tthis.destroy();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: true\n\t\t});\n\t};\n\n\t#onFatalError = (error) =>\n\t{\n\t\tif (error && error.call)\n\t\t{\n\t\t\tdelete error.call;\n\t\t}\n\t\tthis.log(\"onFatalError\", error);\n\n\t\tthis.ready = false;\n\t\tthis.localUserState = UserState.Failed;\n\t\tthis.reinitPeers();\n\n\t\tthis.localVideoShown = false;\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.BitrixCall.hangup({\n\t\t\t\t\t'X-Reason': 'Fatal error',\n\t\t\t\t\t'X-Error': typeof (error) === 'string' ? error : error.code || error.name\n\t\t\t\t})\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\tthis.log(\"Bitrix hangup error: \", e);\n\t\t\t\tconsole.error(\"Bitrix hangup error: \", e);\n\t\t\t}\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\n\t\tif (typeof (error) === \"string\")\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, {\n\t\t\t\tname: error\n\t\t\t});\n\t\t}\n\t\telse if (error.name)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, error);\n\t\t}\n\t};\n\n\t#onTrackSubscriptionFailed = (params) =>\n\t{\n\t\tthis.runCallback(CallEvent.onTrackSubscriptionFailed, params);\n\t}\n\n\t#onCallStatsReceived = (stats) =>\n\t{\n\t\tconst usersToSendReports = {};\n\t\t// to order local stats by track quality\n\t\tconst statsIndexByRid = { f: 2, h: 1, q: 0 };\n\n\t\tstats.sender.forEach((report) =>\n\t\t{\n\t\t\tif (report.userId && (report.kind === 'video' || report.kind === 'audio'))\n\t\t\t{\n\t\t\t\tif (!usersToSendReports[report.userId])\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId] = {};\n\t\t\t\t}\n\n\t\t\t\tif (report.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tif (!usersToSendReports[report.userId][report.source])\n\t\t\t\t\t{\n\t\t\t\t\t\tusersToSendReports[report.userId][report.source] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tconst index = statsIndexByRid[report.rid] || 0;\n\t\t\t\t\tusersToSendReports[report.userId][report.source][index] = report;\n\t\t\t\t}\n\t\t\t\telse if (report.kind === 'audio')\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId][report.source] = report;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tstats.recipient.forEach((report) =>\n\t\t{\n\t\t\tif (report.userId && (report.kind === 'video' || report.kind === 'audio'))\n\t\t\t{\n\t\t\t\tif (!usersToSendReports[report.userId])\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId] = {};\n\t\t\t\t}\n\t\t\t\tusersToSendReports[report.userId][report.source] = report;\n\t\t\t}\n\t\t});\n\n\t\tfor (let userId in usersToSendReports)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\t\tuserId,\n\t\t\t\treport: usersToSendReports[userId]\n\t\t\t});\n\t\t}\n\n\t\t// todo: need to correct stats format\n\t\t// if (this.logger)\n\t\t// {\n\t\t// \tthis.logger.sendStat(transformVoxStats(e.stats, this.BitrixCall));\n\t\t// }\n\t}\n\n\t#onUpdatePacketLoss = (participants) =>\n\t{\n\t\tconst prevPeersWithBadConnection = new Set([...this.peersWithBadConnection.values()]);\n\t\tparticipants.forEach(userId =>\n\t\t{\n\t\t\tconst peer = this.peers[userId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tif (!prevPeersWithBadConnection.has(userId))\n\t\t\t\t{\n\t\t\t\t\tthis.peersWithBadConnection.add(userId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tprevPeersWithBadConnection.delete(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t#onConnectionQualityChanged = participants =>\n\t{\n\t\tObject.keys(participants).forEach(participantId => {\n\t\t\tthis.runCallback(\n\t\t\t\tCallEvent.onConnectionQualityChanged,\n\t\t\t\t{\n\t\t\t\t\tuserId: Number(participantId),\n\t\t\t\t\tscore: participants[participantId],\n\t\t\t\t}\n\t\t\t);\n\t\t})\n\t}\n\n\t#onToggleRemoteParticipantVideo = isVideoShown =>\n\t{\n\t\tthis.runCallback(\n\t\t\tCallEvent.onToggleRemoteParticipantVideo,\n\t\t\t{ isVideoShown }\n\t\t);\n\t}\n\n\t#onCallMessageReceived = (e) =>\n\t{\n\t\tlet message;\n\t\tlet peer;\n\n\t\ttry\n\t\t{\n\t\t\tmessage = JSON.parse(e.text);\n\t\t} catch (err)\n\t\t{\n\t\t\tthis.log(\"Could not parse scenario message.\", err);\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventName = message.eventName;\n\t\tif (eventName === clientEvents.cameraState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tcameraState: message.cameraState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.videoPaused)\n\t\t{\n\t\t\tif (message.senderId === this.userId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tvideoPaused: message.videoPaused === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.screenState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tscreenState: message.screenState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.commonRecordState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCommonRecordState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tcommonRecordState: message.commonRecordState,\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.emotion)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserEmotion, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\ttoUserId: message.toUserId,\n\t\t\t\temotion: message.emotion\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.usersInvited)\n\t\t{\n\t\t\tthis.#onUsersInvited(message);\n\t\t}\n\t\telse if (eventName === clientEvents.userInviteTimeout)\n\t\t{\n\t\t\tthis.#onUserInviteTimeout(message);\n\t\t}\n\t\telse if (eventName === clientEvents.customMessage)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCustomMessage, {\n\t\t\t\tmessage: message.message\n\t\t\t})\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerJoined)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" joined\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setDirection(EndpointDirection.RecvOnly);\n\t\t\t\tpeer.setReady(true);\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerLeft)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" left\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setReady(false);\n\t\t\t}\n\t\t}\n\t\telse if (eventName === clientEvents.microphoneState)\n\t\t{\n\t\t\t// do nothing\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Unknown scenario event \" + eventName);\n\t\t}\n\t};\n\n\t#onCallHandRaised = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\tuserId: p.userId,\n\t\t\trequestActive: p.isHandRaised\n\t\t})\n\t}\n\n\t#onAllParticipantsAudioMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsAudioMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onTurnOnCamera = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onTurnOnCamera);\n\t}\n\n\t#onAllParticipantsVideoMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsVideoMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onAllParticipantsScreenshareMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsScreenshareMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onYouMuteAllParticipants = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onYouMuteAllParticipants, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onRoomSettingsChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onRoomSettingsChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onUserPermissionsChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserPermissionsChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onUserRoleChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserRoleChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onParticipantMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onParticipantMuted, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onEndpointVoiceStart = (p) =>\n\t{\n\t\t// for local user we need to send extra signal to show unmute hint\n\t\tif (p.userId === this.userId)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tlocal: true,\n\t\t\t});\n\n\t\t\tif (Hardware.isMicrophoneMuted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\tuserId: p.userId,\n\t\t});\n\t};\n\n\t#onEndpointVoiceEnd = (p) => {\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\tuserId: p.userId,\n\t\t});\n\t};\n\n\t/**\n\t * @param {Object} status\n\t * @param {RecorderStatus} status.code\n\t * @param {string} status.errMsg\n\t */\n\t#onRecorderStatusChanged = ({ code, errMsg }) => {\n\t\tconst ignoreError = [RecorderStatus.DESTROYED, RecorderStatus.UNAVAILABLE].includes(code);\n\t\tconst error = ignoreError ? '' : errMsg;\n\t\tthis.#recorderState = error ? this.#recorderState : code;\n\t\tconst isCopilotActive = this.#recorderState === RecorderStatus.ENABLED;\n\t\tthis.#recorderStateHasChange = true;\n\n\t\tthis.runCallback(CallEvent.onRecorderStatusChanged, {\n\t\t\tcode,\n\t\t\terror,\n\t\t\tisCopilotActive,\n\t\t});\n\t};\n\n\t/**\n\t * @group CommonRecord\n\t */\n\n\t/**\n\t * @typedef { Object } CloudRecordStatusPause\n\t * @property { string } start\n\t * @property { string } end\n\t */\n\n\t/**\n\t * @typedef { Object } CloudRecordStatusDate\n\t * @property { string } start\n\t * @property { CloudRecordStatusPause[] } pauses\n\t */\n\n\t/**\n\t * @param {Object} status\n\t * @param {number} status.code\n\t * @param {string} status.errMsg\n\t * @param {string} status.initiatorUserID\n\t * @param {string} status.userID\n\t * @param {number} status.kind\n\t * @param {boolean} status.justJoined\n\t * @param {CloudRecordStatusDate} status.date\n\t */\n\t#onCloudRecordStatusChanged = (status) => {\n\t\tif (Util.isCloudRecordLogEnabled())\n\t\t{\n\t\t\tconsole.warn(`CloudRecord: videoRecorderStatus`, status);\n\t\t}\n\n\t\tconst { code, errMsg, initiatorUserID, userID, kind, date, justJoined } = status;\n\n\t\tconst userId = Number(userID);\n\t\tconst initiatorId = Number(initiatorUserID);\n\t\tconst pauses = (date.pauses ?? []).map(({ start, end }) => ({ start: new Date(start), finish: end ? new Date(end) : null }));\n\t\tconst recordType = kind === 1 ? CallCommonRecordType.Audio : CallCommonRecordType.Video;\n\n\t\tthis.#cloudRecordState = errMsg ? this.#cloudRecordState : code;\n\n\t\tif (errMsg)\n\t\t{\n\t\t\tif (Util.isCloudRecordLogEnabled())\n\t\t\t{\n\t\t\t\tconsole.error(`CloudRecord: videoRecorderStatus errMsg`, errMsg);\n\t\t\t}\n\n\t\t\tthis.runCallback(CallEvent.onCloudRecordStatusChanged, {\n\t\t\t\tcode: CloudRecordStatus.STOPPED,\n\t\t\t\tuserId,\n\t\t\t\tinitiatorId,\n\t\t\t\tjustJoined,\n\t\t\t\tcommonRecordState: { ...this.commonRecordState },\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tswitch (code)\n\t\t\t{\n\t\t\t\tcase CloudRecordStatus.STARTED:\n\t\t\t\tcase CloudRecordStatus.PAUSED:\n\t\t\t\t{\n\t\t\t\t\tthis.commonRecordState.state = code === CloudRecordStatus.STARTED\n\t\t\t\t\t\t? CallCommonRecordState.Started\n\t\t\t\t\t\t: CallCommonRecordState.Paused;\n\t\t\t\t\tthis.commonRecordState.type = recordType;\n\t\t\t\t\tthis.commonRecordState.userId = initiatorId;\n\t\t\t\t\tthis.commonRecordState.date.start = new Date(date.start);\n\t\t\t\t\tthis.commonRecordState.date.pause = pauses;\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase CloudRecordStatus.STOPPED:\n\t\t\t\tcase CloudRecordStatus.DESTROYED:\n\t\t\t\t{\n\t\t\t\t\tthis.commonRecordState.state = code === CloudRecordStatus.STOPPED\n\t\t\t\t\t\t? CallCommonRecordState.Stopped\n\t\t\t\t\t\t: CallCommonRecordState.Destroyed;\n\t\t\t\t\tthis.commonRecordState.type = CallCommonRecordType.None;\n\t\t\t\t\tthis.commonRecordState.userId = 0;\n\t\t\t\t\tthis.commonRecordState.date.start = null;\n\t\t\t\t\tthis.commonRecordState.date.pause = [];\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdefault:\n\t\t\t\t{\n\t\t\t\t\tif (Util.isCloudRecordLogEnabled())\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(`Unknown record status: ${status}`);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.runCallback(CallEvent.onCloudRecordStatusChanged, {\n\t\t\t\tcode,\n\t\t\t\tuserId,\n\t\t\t\tinitiatorId,\n\t\t\t\tjustJoined,\n\t\t\t\tcommonRecordState: { ...this.commonRecordState },\n\t\t\t});\n\t\t}\n\t};\n\n\tsendTelemetryEvent(eventName)\n\t{\n\t\tUtil.sendTelemetryEvent({\n\t\t\tcall_id: this.id,\n\t\t\tuser_id: this.userId,\n\t\t\tkind: \"Bitrix\",\n\t\t\tevent: eventName,\n\t\t})\n\t};\n\n\tdestroy(finishCall = false)\n\t{\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis.floorRequestActive = false;\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\tthis.BitrixCall.hangup(finishCall);\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onLeave, { local: true });\n\n\t\treturn super.destroy();\n\t};\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendUsersInvited(data)\n\t{\n\t\tthis.#sendMessage(clientEvents.usersInvited, {\n\t\t\tusers: data.userData,\n\t\t});\n\t}\n\n\tsendCameraState(cameraState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.cameraState, {\n\t\t\tcameraState: cameraState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendVideoPaused(videoPaused)\n\t{\n\t\treturn this.#sendMessage(clientEvents.videoPaused, {\n\t\t\tvideoPaused: videoPaused ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendMicrophoneState(microphoneState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.microphoneState, {\n\t\t\tmicrophoneState: microphoneState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendScreenState(screenState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.screenState, {\n\t\t\tscreenState: screenState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\t/**\n\t * @group CommonRecord\n\t */\n\tsendLocalRecordState(userId, commonRecordState)\n\t{\n\t\tthis.#sendMessage(clientEvents.commonRecordState, {\n\t\t\tsenderId: userId,\n\t\t\tcommonRecordState,\n\t\t});\n\t}\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\treturn this.#sendMessage(clientEvents.customMessage, {\n\t\t\tmessage: message,\n\t\t\trepeatOnConnect: !!repeatOnConnect\n\t\t});\n\t};\n\n\tsendShowUsers(users)\n\t{\n\t\treturn this.#sendMessage(clientEvents.showUsers, {\n\t\t\tusers: users\n\t\t});\n\t};\n\n\tsendShowAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.showAll, {});\n\t};\n\n\tsendHideAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.hideAll, {});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.userInviteTimeout, {data});\n\t};\n\n\t#sendMessage(eventName, data)\n\t{\n\t\tif (!this.call.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\t\tdata.eventName = eventName;\n\t\tdata.requestId = Util.getUuidv4();\n\t\tdata.senderId = this.call.userId;\n\n\t\tthis.call.BitrixCall.sendMessage(JSON.stringify(data));\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callUuid = this.call.uuid;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\treturn BX.ajax.runAction(signalName, { data });\n\t}\n}\n\nclass Peer\n{\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.userId = params.userId;\n\t\tthis.call = params.call;\n\n\t\tthis.ready = !!params.ready;\n\t\tthis.calling = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.direction = params.direction || EndpointDirection.SendRecv;\n\n\t\tthis.stream = null;\n\t\tthis.mediaRenderers = [];\n\n\t\tthis.isIncomingVideoAllowed = params.isIncomingVideoAllowed !== false;\n\n\t\tthis.callingTimeout = 0;\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaRemoved: Type.isFunction(params.onMediaRemoved) ? params.onMediaRemoved : BX.DoNothing,\n\t\t};\n\n\t\tthis.calculatedState = this.calculateState();\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tready = !!ready;\n\t\tif (this.ready === ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.ready = ready;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.inviteTimeout = false;\n\t\t}\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetDirection(direction)\n\t{\n\t\tif (this.direction === direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.direction = direction;\n\t}\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.declined)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.busy)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.declined = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tallowIncomingVideo(isIncomingVideoAllowed)\n\t{\n\t\tif (this.isIncomingVideoAllowed == isIncomingVideoAllowed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isIncomingVideoAllowed = !!isIncomingVideoAllowed;\n\t}\n\n\taddMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Adding media renderer for user' + this.userId, mediaRenderer);\n\n\t\tthis.mediaRenderers.push(mediaRenderer);\n\n\t\tthis.callbacks.onMediaReceived({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tremoveMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Removing media renderer for user' + this.userId, mediaRenderer);\n\n\t\tlet i\n\t\tthis.mediaRenderers.forEach((el, index) => {\n\t\t\tif (el.kind === mediaRenderer.kind) {\n\t\t\t\ti = index;\n\t\t\t}\n\t\t})\n\n\t\tif (i >= 0)\n\t\t{\n\t\t\tthis.mediaRenderers.splice(i, 1);\n\t\t}\n\t\tthis.callbacks.onMediaRemoved({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tcalculateState()\n\t{\n\t\tif (this.participant)\n\t\t{\n\t\t\treturn UserState.Connected;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t}\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState !== calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tdirection: this.direction,\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t}\n\n\tisParticipating()\n\t{\n\t\treturn ((this.calling || this.ready || this.participant) && !this.declined);\n\t}\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(() => this.onInviteTimeout(true), invitePeriod);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tif (!(this.calling))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.stream)\n\t\t{\n\t\t\tUtil.sendLog({ description: 'Stop peer media stream' });\n\t\t\tUtil.stopMediaStream(this.stream);\n\t\t\tthis.stream = null;\n\t\t}\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onInviteTimeout = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaRemoved = BX.DoNothing;\n\n\t\tclearTimeout(this.callingTimeout);\n\t\tthis.callingTimeout = null;\n\t}\n}\n\nconst transformVoxStats = function (s, BitrixCall)\n{\n\tlet result = {\n\t\tconnection: s.connection,\n\t\toutboundAudio: [],\n\t\toutboundVideo: [],\n\t\tinboundAudio: [],\n\t\tinboundVideo: [],\n\t}\n\n\tlet endpoints = {};\n\tif (BitrixCall.getEndpoints)\n\t{\n\t\tBitrixCall.getEndpoints().forEach(endpoint => endpoints[endpoint.id] = endpoint)\n\t}\n\n\tif (!result.connection.timestamp)\n\t{\n\t\tresult.connection.timestamp = Date.now();\n\t}\n\tfor (let trackId in s.outbound)\n\t{\n\t\tif (!s.outbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tconst statGroup = s.outbound[trackId];\n\t\tfor (let i = 0; i < statGroup.length; i++)\n\t\t{\n\t\t\tlet stat = statGroup[i];\n\t\t\tstat.trackId = trackId;\n\t\t\tif ('audioLevel' in stat)\n\t\t\t{\n\t\t\t\tresult.outboundAudio.push(stat)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.outboundVideo.push(stat)\n\t\t\t}\n\t\t}\n\t}\n\tfor (let trackId in s.inbound)\n\t{\n\t\tif (!s.inbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tlet stat = s.inbound[trackId];\n\t\tif (!('endpoint' in stat))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tstat.trackId = trackId;\n\t\tif ('audioLevel' in stat)\n\t\t{\n\t\t\tresult.inboundAudio.push(stat)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (endpoints[stat.endpoint])\n\t\t\t{\n\t\t\t\tlet videoRenderer = endpoints[stat.endpoint].mediaRenderers.find(r => r.id == stat.trackId)\n\t\t\t\tif (videoRenderer && videoRenderer.element)\n\t\t\t\t{\n\t\t\t\t\tstat.actualHeight = videoRenderer.element.videoHeight;\n\t\t\t\t\tstat.actualWidth = videoRenderer.element.videoWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.inboundVideo.push(stat)\n\t\t}\n\t}\n\treturn result;\n\n}\n","import {Type} from 'main.core';\n\nexport class CallStub\n{\n\tconstructor(config)\n\t{\n\t\tthis.callId = config.callId;\n\t\tthis.lifetime = config.lifetime || 120;\n\t\tthis.callbacks = {\n\t\t\tonDelete: Type.isFunction(config.onDelete) ? config.onDelete : BX.DoNothing\n\t\t};\n\n\t\tthis.deleteTimeout = setTimeout( () =>\n\t\t{\n\t\t\tthis.callbacks.onDelete({\n\t\t\t\tcallId: this.callId\n\t\t\t})\n\t\t}, this.lifetime * 1000);\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\t// do nothing\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\treturn false;\n\t};\n\n\taddEventListener()\n\t{\n\t\treturn false;\n\t};\n\n\tremoveEventListener()\n\t{\n\t\treturn false;\n\t};\n\n\taddInvitedUsers()\n\t{\n\t\tconsole.error(\"unexpected call to CallStub.addInvitedUsers\");\n\t}\n\n\tdestroy()\n\t{\n\t\tclearTimeout(this.deleteTimeout);\n\t\tthis.callbacks.onDelete = BX.DoNothing;\n\t};\n}","export class CallMultiChannel\n{\n\tconstructor(name) {\n\t\tthis.channel = new BroadcastChannel(name);\n\t\tthis.senderId = Math.random().toString(36).slice(2);\n\t\tthis.requests = new Map();\n\n\t\tthis.channel.onmessage = (event) => {\n\t\t\tconst { type, requestId, senderId, payload } = event.data;\n\n\t\t\tif (type === 'response' && this.requests.has(requestId)) {\n\t\t\t\tconst req = this.requests.get(requestId);\n\n\t\t\t\tif (!req.responders.has(senderId)) {\n\t\t\t\t\treq.responders.add(senderId);\n\t\t\t\t\treq.responses.push(payload);\n\n\t\t\t\t\tif (Date.now() > req.deadline) {\n\t\t\t\t\t\treq.resolve(req.responses);\n\t\t\t\t\t\tthis.requests.delete(requestId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (type === 'request' && senderId !== this.senderId) {\n\t\t\t\tconst result = this.handle ? this.handle(payload) : undefined;\n\n\t\t\t\tif (result !== undefined) {\n\t\t\t\t\tthis.channel.postMessage({\n\t\t\t\t\t\ttype: 'response',\n\t\t\t\t\t\trequestId,\n\t\t\t\t\t\tsenderId: this.senderId,\n\t\t\t\t\t\tpayload: result\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\texecuter(handler) {\n\t\tthis.handle = handler;\n\t}\n\n\tasync broadcastRequest(payload, { timeout = 100 } = {}) {\n\t\tconst requestId = Math.random().toString(36).slice(2);\n\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.requests.set(requestId, {\n\t\t\t\tresolve,\n\t\t\t\tresponses: [],\n\t\t\t\tresponders: new Set(),\n\t\t\t\tdeadline: Date.now() + timeout,\n\t\t\t});\n\n\t\t\tthis.channel.postMessage({\n\t\t\t\ttype: 'request',\n\t\t\t\trequestId,\n\t\t\t\tsenderId: this.senderId,\n\t\t\t\tpayload,\n\t\t\t});\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (this.requests.has(requestId)) {\n\t\t\t\t\tresolve(this.requests.get(requestId).responses);\n\t\t\t\t\tthis.requests.delete(requestId);\n\t\t\t\t}\n\t\t\t}, timeout);\n\t\t});\n\t}\n\n\tdestroy() {\n\t\tthis.channel.close();\n\t\tthis.requests.clear();\n\t}\n}","import {Type} from 'main.core'\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport { JoinResponseError } from '../call_api';\nimport {ServerPlainCall} from './server_plain_call'\nimport {BitrixCall} from './bitrix_call'\nimport {CallStub} from './stub'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\nimport {AbstractCall} from './abstract_call';\nimport { CallTokenManager } from 'call.lib.call-token-manager';\nimport {CallAI} from '../call_ai';\nimport { CallMultiChannel } from '../call_multi_channel';\nimport { CallCloudRecord } from '../call_common_record';\nimport { CallSettingsManager } from 'call.lib.settings-manager';\n\nexport const CallState = {\n\tIdle: 'Idle',\n\tProceeding: 'Proceeding',\n\tConnected: 'Connected',\n\tFinished: 'Finished'\n};\n\nexport const UserState = {\n\tIdle: 'Idle',\n\tBusy: 'Busy',\n\tCalling: 'Calling',\n\tUnavailable: 'Unavailable',\n\tDeclined: 'Declined',\n\tReady: 'Ready',\n\tConnecting: 'Connecting',\n\tConnected: 'Connected',\n\tFailed: 'Failed'\n};\n\nexport const EndpointDirection = {\n\tSendOnly: 'send',\n\tRecvOnly: 'recv',\n\tSendRecv: 'sendrecv',\n};\n\nexport const CallType = {\n\tInstant: 1,\n\tPermanent: 2\n};\n\nexport const RoomType = {\n\tSmall: 1,\n\tConference: 2,\n\tLarge: 3,\n\tPersonal: 4,\n};\n\nexport const Provider = {\n\tPlain: 'Plain',\n\tBitrix: 'Bitrix',\n};\n\nexport const StreamTag = {\n\tMain: 'main',\n\tScreen: 'screen'\n};\n\nexport const Direction = {\n\tIncoming: 'Incoming',\n\tOutgoing: 'Outgoing'\n};\n\nexport const Quality = {\n\tVeryHigh: \"very_high\",\n\tHigh: \"high\",\n\tMedium: \"medium\",\n\tLow: \"low\",\n\tVeryLow: \"very_low\"\n};\n\nexport const StartCallErrorCode = {\n\tAuthorizeError: 'AUTHORIZE_ERROR',\n\tBlankAnswer: 'BLANK_ANSWER',\n\tBlankAnswerWithErrorCode: 'BLANK_ANSWER_WITH_ERROR_CODE',\n\tErrorUnexpectedAnswer: 'ERROR_UNEXPECTED_ANSWER',\n\tAccessDenied: 'ACCESS_DENIED',\n\tNetworkError: 'NETWORK_ERROR',\n\tNoWebrtc: 'NO_WEBRTC',\n\tNotAllowedError: 'NotAllowedError',\n\tNotReadableError: 'NotReadableError',\n\tUnknownError: 'UNKNOWN_ERROR',\n};\n\nexport const DisconnectReason = {\n\tSecurityKeyChanged: 'SECURITY_KEY_CHANGED',\n\tRoomClosed: 'ROOM_CLOSED',\n};\n\nexport const UserMnemonic = {\n\tall: 'all',\n\tnone: 'none'\n};\n\ntype CreateCallOptions = {\n\ttype: number,\n\tprovider: string,\n\tentityType: string,\n\tentityId: string,\n\tjoinExisting: boolean,\n\tuserIds?: number[],\n\tvideoEnabled?: boolean,\n\tenableMicAutoParameters?: boolean,\n\tdebug?: boolean\n}\n\nexport const CallEvent = {\n\tonUserInvited: 'onUserInvited',\n\tonUserJoined: 'onUserJoined',\n\tonUserStateChanged: 'onUserStateChanged',\n\tonUserMicrophoneState: 'onUserMicrophoneState',\n\tonUserCameraState: 'onUserCameraState',\n\tonCameraPublishing: 'onCameraPublishing',\n\tonMicrophonePublishing: 'onMicrophonePublishing',\n\tonNeedResetMediaDevicesState: 'onNeedResetMediaDevicesState',\n\tonUserVideoPaused: 'onUserVideoPaused',\n\tonUserScreenState: 'onUserScreenState',\n\tonUserCommonRecordState: 'onUserCommonRecordState',\n\tonUserVoiceStarted: 'onUserVoiceStarted',\n\tonUserVoiceStopped: 'onUserVoiceStopped',\n\tonUserFloorRequest: 'onUserFloorRequest', // request for a permission to speak\n\tonTurnOnCamera: 'onTurnOnCamera',\n\tonAllParticipantsAudioMuted: 'onAllParticipantsAudioMuted',\n\tonAllParticipantsVideoMuted: 'onAllParticipantsVideoMuted',\n\tonAllParticipantsScreenshareMuted: 'onAllParticipantsScreenshareMuted',\n\tonYouMuteAllParticipants: 'onYouMuteAllParticipants',\n\tonRoomSettingsChanged: 'onRoomSettingsChanged',\n\tonUserPermissionsChanged: 'onUserPermissionsChanged',\n\tonUserRoleChanged: 'onUserRoleChanged',\n\tonParticipantMuted: 'onParticipantMuted',\n\tonUserEmotion: 'onUserEmotion',\n\tonTrackSubscriptionFailed: 'onTrackSubscriptionFailed',\n\tonUserStatsReceived: 'onUserStatsReceived',\n\tonCustomMessage: 'onCustomMessage',\n\tonLocalMediaReceived: 'onLocalMediaReceived',\n\tonLocalMediaStopped: 'onLocalMediaStopped',\n\tonLocalScreenUpdated: 'onLocalScreenUpdated',\n\tonMicrophoneLevel: 'onMicrophoneLevel',\n\tonDeviceListUpdated: 'onDeviceListUpdated',\n\tonRTCStatsReceived: 'onRTCStatsReceived',\n\tonCallFailure: 'onCallFailure',\n\tonRemoteMediaReceived: 'onRemoteMediaReceived',\n\tonRemoteMediaStopped: 'onRemoteMediaStopped',\n\tonBadNetworkIndicator: 'onBadNetworkIndicator',\n\tonConnectionQualityChanged: 'onConnectionQualityChanged',\n\tonNetworkProblem: 'onNetworkProblem',\n\tonReconnecting: 'onReconnecting',\n\tonReconnected: 'onReconnected',\n\tonReconnectingFailed: 'onReconnectingFailed',\n\tonJoin: 'onJoin',\n\tonLeave: 'onLeave',\n\tonJoinRoomOffer: 'onJoinRoomOffer',\n\tonJoinRoom: 'onJoinRoom',\n\tonLeaveRoom: 'onLeaveRoom',\n\tonListRooms: 'onListRooms',\n\tonUpdateRoom: 'onUpdateRoom',\n\tonTransferRoomSpeakerRequest: 'onTransferRoomSpeakerRequest',\n\tonTransferRoomSpeaker: 'onTransferRoomSpeaker',\n\tonDestroy: 'onDestroy',\n\tonGetUserMediaEnded: 'onGetUserMediaEnded',\n\tonUpdateLastUsedCameraId: 'onUpdateLastUsedCameraId',\n\tonToggleRemoteParticipantVideo: 'onToggleRemoteParticipantVideo',\n\tonSwitchTrackRecordStatus: 'onSwitchTrackRecordStatus',\n\tonRecorderStatusChanged: 'onRecorderStatusChanged',\n\tonCloudRecordStatusChanged: 'onCloudRecordStatusChanged',\n};\n\nconst ajaxActions = {\n\tcreateCall: 'im.call.create',\n\tcreateChatForChildCall: 'call.Call.createChatForChildCall',\n\tgetPublicChannels: 'pull.channel.public.list',\n\tgetCall: 'im.call.get'\n};\n\nexport const CallScheme = {\n\tclassic: 1,\n\tjwt: 2,\n};\n\nclass Engine\n{\n\thandlers = {\n\t\t'Call::incoming': this.#onPullIncomingCall.bind(this),\n\t};\n\n\tjwtPullHandlers = {\n\t\t'chatUserAdd': this.#onCallTokenUpdate.bind(this),\n\t\t'Call::callTokenUpdate': this.#onCallTokenUpdate.bind(this),\n\t\t'Call::clearCallTokens': this.#onCallTokenClear.bind(this),\n\t\t'Call::callV2AvailabilityChanged': this.#onCallV2AvailabilityChanged.bind(this),\n\t};\n\n\tconstructor()\n\t{\n\t\tthis.debugFlag = false;\n\t\tthis.calls = {};\n\t\tthis.userId = Number(BX.message('USER_ID'));\n\t\tthis.siteId = '';\n\n\t\tthis.unknownCalls = {};\n\n\t\tthis.restClient = null;\n\t\tthis.pullClient = null;\n\n\t\tthis.finishedCalls = new Set();\n\n\t\tthis.multiBroadcastClient = new CallMultiChannel('call_engine_channel');\n\n\t\tthis.init();\n\t};\n\n\tinit()\n\t{\n\t\tBX.addCustomEvent(\"onPullEvent-call\", this.#onPullEvent.bind(this));\n\t\tBX.addCustomEvent(\"onPullEvent-im\", this.#onPullEvent.bind(this));\n\t};\n\n\tgetSiteId()\n\t{\n\t\treturn this.siteId || BX.message('SITE_ID') || '';\n\t};\n\n\tsetSiteId(siteId)\n\t{\n\t\tthis.siteId = siteId;\n\t};\n\n\tgetCurrentUserId()\n\t{\n\t\treturn this.userId;\n\t};\n\n\tsetCurrentUserId(userId)\n\t{\n\t\tthis.userId = Number(userId);\n\t};\n\n\tsetRestClient(restClient)\n\t{\n\t\tthis.restClient = restClient;\n\t};\n\n\tsetPullClient(pullClient)\n\t{\n\t\tthis.pullClient = pullClient;\n\t};\n\n\tgetRestClient()\n\t{\n\t\treturn this.restClient || BX.rest;\n\t};\n\n\tgetPullClient()\n\t{\n\t\treturn this.pullClient || BX.PULL;\n\t};\n\n\tgetLogService()\n\t{\n\t\treturn BX.message(\"call_log_service\");\n\t};\n\n\tonCallCreated(call)\n\t{\n\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\tcall: call\n\t\t}]);\n\t}\n\n\tcreateCall(config: CreateCallOptions): Promise<AbstractCall>\n\t{\n\t\treturn new Promise(async (resolve, reject) =>\n\t\t{\n\t\t\tconst callType = config.type || CallType.Instant;\n\t\t\tconst callProvider = config.provider || this.getDefaultProvider();\n\n\t\t\tif (config.joinExisting)\n\t\t\t{\n\t\t\t\tfor (let callId in this.calls)\n\t\t\t\t{\n\t\t\t\t\tif (this.calls.hasOwnProperty(callId))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst call: AbstractCall = this.calls[callId];\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tcall.provider === config.provider\n\t\t\t\t\t\t\t&& call.associatedEntity.type === config.entityType\n\t\t\t\t\t\t\t&& call.associatedEntity.id === config.entityId\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.log(callId, \"Found existing call, attaching to it\");\n\t\t\t\t\t\t\tthis.onCallCreated(call);\n\n\t\t\t\t\t\t\tHardware.isCameraOn = config.videoEnabled === true;\n\n\t\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\t\tcall: call,\n\t\t\t\t\t\t\t\tisNew: false\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet data;\n\t\t\tconst instanceId = Util.getUuidv4();\n\t\t\ttry\n\t\t\t{\n\t\t\t\tdata = await Util.getCallConnectionData({\n\t\t\t\t\tcallToken: config.token,\n\t\t\t\t\tcallType: callType,\n\t\t\t\t\tprovider: callProvider,\n\t\t\t\t\tinstanceId: instanceId,\n\t\t\t\t\tisVideo: config.videoEnabled,\n\t\t\t\t}, config.chatInfo.chatId);\n\t\t\t}\n\t\t\tcatch(error)\n\t\t\t{\n\t\t\t\tif (Type.isObject(error) && (error instanceof JoinResponseError))\n\t\t\t\t{\n\t\t\t\t\treturn reject(error);\n\t\t\t\t}\n\n\t\t\t\treturn reject({name: 'MEDIA_SERVER_UNREACHABLE', message: `Reason: ${error?.reason} ${error?.data}`});\n\t\t\t}\n\n\t\t\tif (!data?.result?.mediaServerUrl || !data?.result?.roomData)\n\t\t\t{\n\t\t\t\treturn reject({name: 'MEDIA_SERVER_MISSING_PARAMS', message: `Incorrect signaling response`});\n\t\t\t}\n\n\t\t\tconst aiSettings = Util.getAiSettings();\n\t\t\tif (aiSettings.serviceEnabled)\n\t\t\t{\n\t\t\t\tCallAI.setup(aiSettings);\n\t\t\t}\n\n\t\t\tif (this.calls[data.result.roomId])\n\t\t\t{\n\t\t\t\tif (this.calls[data.result.roomId] instanceof CallStub)\n\t\t\t\t{\n\t\t\t\t\tthis.calls[data.result.roomId].destroy();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.warn(`Call ${data.result.roomId} already exists, returning it instead of creating a new one`);\n\n\t\t\t\t\treturn resolve({\n\t\t\t\t\t\tcall: this.calls[data.result.roomId],\n\t\t\t\t\t\tisNew: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tHardware.isCameraOn = config.videoEnabled === true;\n\t\t\tconst callFactory = this.#getCallFactory(callProvider);\n\t\t\tconst call = callFactory.createCall({\n\t\t\t\tuuid: data.result.roomId,\n\t\t\t\tinstanceId: instanceId,\n\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\tenableMicAutoParameters: (config.enableMicAutoParameters !== false),\n\t\t\t\tassociatedEntity: config.chatInfo,\n\t\t\t\ttype: callType,\n\t\t\t\tstartDate: new Date(data.result.startDate * 1000),\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t},\n\t\t\t\tdebug: config.debug === true,\n\t\t\t\tconnectionData: {\n\t\t\t\t\tmediaServerUrl: data.result.mediaServerUrl,\n\t\t\t\t\troomData: data.result.roomData,\n\t\t\t\t\troomType: data.result.roomType,\n\t\t\t\t\tmonitoringServerUrl: data.result.monitoring?.metricsServerUrl,\n\t\t\t\t\tmonitoringLogsServerUrl: data.result.monitoring?.logsServerUrl,\n\t\t\t\t\tmonitoringJwtToken: data.result.monitoring?.token,\n\t\t\t\t\tmonitoringEnvironment: data.result.monitoring?.env,\n\t\t\t\t\tmonitoringRegion: data.result.monitoring?.region,\n\t\t\t\t},\n\t\t\t\tscheme: data.result.scheme,\n\t\t\t});\n\n\t\t\tthis.calls[call.uuid] = call;\n\n\t\t\tthis.onCallCreated(call);\n\n\t\t\tresolve({\n\t\t\t\tcall: call,\n\t\t\t\tisNew: data.result.isNew\n\t\t\t});\n\t\t});\n\t}\n\n\tcreateChildCall(parentCall, newProvider, newUsers, config)\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst callParameters = {\n\t\t\t\tnewProvider,\n\t\t\t\tcallUuid: parentCall.uuid,\n\t\t\t\tusers: newUsers,\n\t\t\t};\n\n\t\t\tBX.ajax.runAction(ajaxActions.createChatForChildCall, { data: callParameters })\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst createCallResponse = response.data;\n\t\t\t\t\tconst token = createCallResponse.token;\n\t\t\t\t\tconst chatId = createCallResponse.chatId;\n\t\t\t\t\tconst callType = CallType.Instant;\n\t\t\t\t\tconst callFactory = this.#getCallFactory(newProvider);\n\t\t\t\t\tconst instanceId = Util.getUuidv4();\n\n\t\t\t\t\tUtil.getCallConnectionData({\n\t\t\t\t\t\tinstanceId,\n\t\t\t\t\t\tcallType,\n\t\t\t\t\t\tcallToken: token,\n\t\t\t\t\t\tprovider: newProvider,\n\t\t\t\t\t\tisVideo: config.videoEnabled,\n\t\t\t\t\t\tparentUuid: parentCall.uuid,\n\t\t\t\t\t}, chatId)\n\t\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\t\tif (!data?.result?.mediaServerUrl || !data?.result?.roomData)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn reject({name: 'MEDIA_SERVER_MISSING_PARAMS', message: `Incorrect signaling response`});\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst call = callFactory.createCall({\n\t\t\t\t\t\t\t\tuuid: data.result.roomId,\n\t\t\t\t\t\t\t\tinstanceId: instanceId,\n\t\t\t\t\t\t\t\tinitiatorId: this.userId,\n\t\t\t\t\t\t\t\tparentUuid: parentCall.uuid,\n\t\t\t\t\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\t\t\t\t\tenableMicAutoParameters: parentCall.enableMicAutoParameters !== false,\n\t\t\t\t\t\t\t\ttype: callType,\n\t\t\t\t\t\t\t\tstartDate: data.result.startDate,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tlogToken: createCallResponse.logToken,\n\t\t\t\t\t\t\t\tconnectionData: {\n\t\t\t\t\t\t\t\t\tmediaServerUrl: data.result.mediaServerUrl,\n\t\t\t\t\t\t\t\t\troomData: data.result.roomData,\n\t\t\t\t\t\t\t\t\troomType: data.result.roomType,\n\t\t\t\t\t\t\t\t\tmonitoringServerUrl: data.result.monitoring?.metricsServerUrl,\n\t\t\t\t\t\t\t\t\tmonitoringLogsServerUrl: data.result.monitoring?.logsServerUrl,\n\t\t\t\t\t\t\t\t\tmonitoringJwtToken: data.result.monitoring?.token,\n\t\t\t\t\t\t\t\t\tmonitoringEnvironment: data.result.monitoring?.env,\n\t\t\t\t\t\t\t\t\tmonitoringRegion: data.result.monitoring?.region,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdebug: config.debug,\n\t\t\t\t\t\t\t\tscheme: data.result.scheme,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.calls[call.uuid] = call;\n\n\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\tcall,\n\t\t\t\t\t\t\t\tisNew: data.result.startDate,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((e) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn reject({name: 'MEDIA_SERVER_UNREACHABLE', message: `Reason: ${e.reason} ${e.data}`});\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\treturn reject({name: 'MEDIA_SERVER_UNREACHABLE', message: `Reason: ${e.reason} ${e.data}`});\n\t\t\t\t});\n\t\t});\n\t};\n\n\tinstantiateCall(callFields, callToken, logToken, userData): AbstractCall\n\t{\n\t\tconst callUuid = callFields.UUID;\n\n\t\tif (this.calls[callUuid])\n\t\t{\n\t\t\tconsole.warn(`Call ${callUuid} already exists, returning it instead of creating a new one`);\n\n\t\t\treturn this.calls[callUuid];\n\t\t}\n\n\t\tconst associatedEntity = callFields['ASSOCIATED_ENTITY'];\n\t\tif (callToken)\n\t\t{\n\t\t\tCallTokenManager.setToken(associatedEntity.chatId, callToken);\n\t\t}\n\n\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\t\tconst call = callFactory.createCall({\n\t\t\tuuid: callUuid,\n\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\tinitiatorId: parseInt(callFields['INITIATOR_ID']),\n\t\t\tparentUuid: callFields['PARENT_UUID'],\n\t\t\tdirection: callFields['INITIATOR_ID'] == this.userId ? Direction.Outgoing : Direction.Incoming,\n\t\t\tassociatedEntity: {\n\t\t\t\tuserCounter: Object.keys(userData).length,\n\t\t\t\t...associatedEntity\n\t\t\t},\n\t\t\ttype: callFields['TYPE'],\n\t\t\tstartDate: callFields['START_DATE'],\n\t\t\tlogToken: logToken,\n\t\t\tscheme: callFields['SCHEME'],\n\n\t\t\tevents: {\n\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tthis.calls[call.uuid] = call;\n\n\t\tthis.onCallCreated(call);\n\n\t\treturn call;\n\t};\n\n\tgetCallWithId(uuid, config): Promise<{ call: AbstractCall, isNew: boolean }>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst call = this.calls[uuid];\n\n\t\t\tif (\n\t\t\t\t(call && call.hasConnectionData)\n\t\t\t\t|| (call && !config)\n\t\t\t)\n\t\t\t{\n\t\t\t\tresolve({ call, isNew: false });\n\t\t\t}\n\t\t\telse if (config)\n\t\t\t{\n\t\t\t\tthis.createCall(config)\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst error = {\n\t\t\t\t\tname: 'CALL_NOT_FOUND',\n\t\t\t\t\tmessage: 'Call not found',\n\t\t\t\t};\n\n\t\t\t\treject(error);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetCallWithDialogId(dialogId: string): ?Object\n\t{\n\t\treturn Object.values(this.calls).find((call) => call.associatedEntity?.id == dialogId);\n\t}\n\n\t#onPullEvent(command: string, params, extra)\n\t{\n\t\tif (this.jwtPullHandlers[command])\n\t\t{\n\t\t\tthis.jwtPullHandlers[command].call(this, params, extra);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst callScheme = params?.call?.SCHEME || params?.call?.scheme;\n\n\t\tif (callScheme !== CallScheme.jwt)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.handlers[command])\n\t\t{\n\t\t\tthis.handlers[command].call(this, params, extra);\n\t\t}\n\t\telse if (command.startsWith('Call::') && params.call)\n\t\t{\n\t\t\tconst callUuid = params.call?.UUID || params.call?.uuid;\n\t\t\tif (!callUuid)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet call = this.calls[callUuid];\n\n\t\t\tif (!call && command === 'Call::finish')\n\t\t\t{\n\t\t\t\tthis.log(callUuid, 'Got \"Call::finish\" before \"Call::incoming\"');\n\t\t\t\tthis.finishedCalls.add(callUuid);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (call && !this.#callHasAssociatedEntity(call) && command === 'Call::usersInvited' && !this.finishedCalls.has(callUuid))\n\t\t\t{\n\t\t\t\tcall.addDialogInfo(params.call.ASSOCIATED_ENTITY);\n\t\t\t\tthis.onCallCreated(call);\n\t\t\t}\n\t\t\telse if (!call && command === 'Call::usersInvited' && !this.finishedCalls.has(callUuid))\n\t\t\t{\n\t\t\t\tcall = this.instantiateCall(params.call, params.callToken, params.logToken, params.userData);\n\t\t\t}\n\n\t\t\tif (call)\n\t\t\t{\n\t\t\t\tcall.__onPullEvent(command, params, extra);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #onPullIncomingCall(params, extra)\n\t{\n\t\tconsole.log('#onPullIncomingCall', location.href);\n\t\tif (extra.server_time_ago > 30)\n\t\t{\n\t\t\tconsole.error(\"Call was started too long time ago\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst callFields = params.call;\n\t\tconst callUuid = callFields.uuid;\n\t\tlet call;\n\n\t\tCallAI.setup(params.aiSettings);\n\n\t\tif (this.finishedCalls.has(callUuid))\n\t\t{\n\t\t\tthis.log(callUuid, 'Got \"Call::incoming\" after \"Call::finish\"');\n\t\t\treturn;\n\t\t}\n\n\t\tCallTokenManager.setToken(callFields.associatedEntity.chatId, params.callToken);\n\n\t\tif (this.calls[callUuid] instanceof CallStub) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.calls[callUuid])\n\t\t{\n\t\t\tcall = this.calls[callUuid];\n\n\t\t\tif (!this.#callHasAssociatedEntity(call))\n\t\t\t{\n\t\t\t\tcall.addDialogInfo(callFields.associatedEntity);\n\n\t\t\t\tthis.onCallCreated(call);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst callFactory = this.#getCallFactory(callFields.provider);\n\t\t\tconst instanceId = Util.getUuidv4();\n\t\t\tcall = callFactory.createCall({\n\t\t\t\tuuid: callUuid,\n\t\t\t\tinstanceId: instanceId,\n\t\t\t\tparentId: callFields.parentId || null,\n\t\t\t\tparentUuid: callFields.parentUuid || null,\n\t\t\t\tcallFromMobile: params.isLegacyMobile === true,\n\t\t\t\tdirection: Direction.Incoming,\n\t\t\t\tinitiatorId: callFields.initiatorId,\n\t\t\t\tassociatedEntity: callFields.associatedEntity,\n\t\t\t\ttype: callFields.type,\n\t\t\t\tstartDate: callFields.startDate,\n\t\t\t\tlogToken: callFields.logToken,\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t},\n\t\t\t\tscheme: callFields.scheme,\n\t\t\t});\n\n\t\t\tthis.calls[callUuid] = call;\n\n\t\t\tthis.onCallCreated(call);\n\t\t}\n\n\t\tconst broadcastResponse = await this.multiBroadcastClient.broadcastRequest(callUuid, { timeout: 100 });\n\t\tconst hasActiveCalls = broadcastResponse.some(res => res);\n\n\t\tif (call && !hasActiveCalls)\n\t\t{\n\t\t\tBX.onCustomEvent(window, \"CallEvents::incomingCall\", [{\n\t\t\t\tcall: call,\n\t\t\t\tvideo: params.video === true,\n\t\t\t\tisLegacyMobile: params.isLegacyMobile === true\n\t\t\t}]);\n\t\t}\n\t\tthis.log(call.uuid, \"Incoming call \" + call.uuid);\n\t};\n\n\t#onCallTokenUpdate(params, extra)\n\t{\n\t\tCallTokenManager.setToken(params.chatId, params.callToken);\n\t}\n\n\t#onCallTokenClear()\n\t{\n\t\tCallTokenManager.clearTokenList();\n\t}\n\n\t#onCallV2AvailabilityChanged(params, extra)\n\t{\n\t\tCallSettingsManager.jwtCallsEnabled = params.isJwtEnabled;\n\t\tCallSettingsManager.plainCallsUseJwt = params.isPlainUseJwt;\n\n\t\tif (params?.callBalancerUrl)\n\t\t{\n\t\t\tCallSettingsManager.callBalancerUrl = params.callBalancerUrl;\n\t\t}\n\t}\n\n\t#onCallDestroy(e)\n\t{\n\t\tconst callId = e.call.uuid;\n\t\tthis.calls[callId] = new CallStub({\n\t\t\tcallId: callId,\n\t\t\tonDelete: () =>\n\t\t\t{\n\t\t\t\tif (this.calls[callId])\n\t\t\t\t{\n\t\t\t\t\tdelete this.calls[callId];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tBX.onCustomEvent(window, \"CallEvents::callDestroyed\", [{\n\t\t\tcallId: e.call.uuid\n\t\t}]);\n\t};\n\n\t#isCallAppInitialized()\n\t{\n\t\tif ('BXIM' in window && 'init' in window.BXIM)\n\t\t{\n\t\t\treturn BXIM.init;\n\t\t}\n\t\telse if (BX.Messenger && BX.Messenger.Application && BX.Messenger.Application.conference)\n\t\t{\n\t\t\treturn BX.Messenger.Application.conference.inited;\n\t\t}\n\n\t\t//TODO: support new chat\n\t\treturn true;\n\t};\n\n\tgetDefaultProvider()\n\t{\n\t\treturn Provider.Plain;\n\t};\n\n\tgetConferencePageTag(chatDialogId)\n\t{\n\t\treturn \"conference-open-\" + chatDialogId;\n\t};\n\n\t#getCallFactory(providerType: string)\n\t{\n\t\tif (providerType == Provider.Plain)\n\t\t{\n\t\t\treturn PlainCallFactory;\n\t\t}\n\t\telse if (providerType == Provider.Bitrix)\n\t\t{\n\t\t\treturn BitrixCallFactory;\n\t\t}\n\n\t\tthrow new Error(\"Unknown call provider type \" + providerType);\n\t};\n\n\t#callHasAssociatedEntity(call: AbstractCall): boolean\n\t{\n\t\treturn Type.isObject(call?.associatedEntity) && Object.keys(call.associatedEntity).length > 0;\n\t}\n\n\tdebug(debugFlag: boolean = true): boolean\n\t{\n\t\tthis.debugFlag = !!debugFlag;\n\n\t\treturn this.debugFlag;\n\t};\n\n\tlog()\n\t{\n\t\tconst text = Util.getLogMessage.call(Util, arguments);\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.writeToLogFile(BX.message('USER_ID') + '.video.log', text);\n\t\t}\n\t\tif (this.debugFlag)\n\t\t{\n\t\t\tif (console)\n\t\t\t{\n\t\t\t\tconst a = ['Call log [' + Util.getTimeForLog() + ']: '];\n\t\t\t\tconsole.log.apply(this, a.concat(Array.prototype.slice.call(arguments)));\n\t\t\t}\n\t\t}\n\t};\n\n\tgetAllowedVideoQuality(participantsCount)\n\t{\n\t\tif (participantsCount < 5)\n\t\t{\n\t\t\treturn Quality.VeryHigh\n\t\t}\n\t\telse if (participantsCount < 10)\n\t\t{\n\t\t\treturn Quality.High\n\t\t}\n\t\telse if (participantsCount < 16)\n\t\t{\n\t\t\treturn Quality.Medium\n\t\t}\n\t\telse if (participantsCount < 32)\n\t\t{\n\t\t\treturn Quality.Low\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Quality.VeryLow\n\t\t}\n\t};\n}\n\nclass PlainCallFactory\n{\n\tstatic createCall(config): ServerPlainCall\n\t{\n\t\treturn new ServerPlainCall(config);\n\t}\n}\n\nclass BitrixCallFactory\n{\n\tstatic createCall(config): BitrixCall\n\t{\n\t\treturn new BitrixCall(config);\n\t}\n}\n\nexport const CallEngine = new Engine();\n","import {Browser, Type, Runtime} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {CallEngine, CallState, CallEvent, UserState, Provider} from './engine';\nimport {SimpleVAD} from './simple_vad'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\nimport {MediaStreamsKinds} from '../call_api';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { CallStreamManager } from '../media-stream-manager';\n\nconst ajaxActions = {\n\tinvite: 'im.call.invite',\n\tcancel: 'im.call.cancel',\n\tanswer: 'im.call.answer',\n\tdecline: 'im.call.decline',\n\thangup: 'im.call.hangup',\n\tping: 'im.call.ping',\n\tnegotiationNeeded: 'im.call.negotiationNeeded',\n\tconnectionOffer: 'im.call.connectionOffer',\n\tconnectionAnswer: 'im.call.connectionAnswer',\n\ticeCandidate: 'im.call.iceCandidate'\n};\n\nconst pullEvents = {\n\tping: 'Call::ping',\n\tanswer: 'Call::answer',\n\tnegotiationNeeded: 'Call::negotiationNeeded',\n\tconnectionOffer: 'Call::connectionOffer',\n\tconnectionAnswer: 'Call::connectionAnswer',\n\ticeCandidate: 'Call::iceCandidate',\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\tcommonRecordState: 'Call::commonRecordState',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tcustomMessage: 'Call::customMessage',\n\thangup: 'Call::hangup',\n\tuserInviteTimeout: 'Call::userInviteTimeout'\n};\n\nconst defaultConnectionOptions = {\n\tofferToReceiveVideo: true,\n\tofferToReceiveAudio: true\n};\n\nconst signalingConnectionRefreshPeriod = 30000;\nconst signalingWaitReplyPeriod = 10000;\n//var signalingWaitReplyPeriod = 5000;\nconst pingPeriod = 5000;\nconst backendPingPeriod = 25000;\nconst reinvitePeriod = 5500;\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n * - setMuted\n * - setVideoEnabled\n * - setCameraId\n * - setMicrophoneId\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onUserVoiceStarted\n * - onUserVoiceStopped\n * - onLocalMediaReceived\n * - onLocalMediaStopped\n * - onLocalMediaError\n * - onDeviceListUpdated\n * - onDestroy\n */\n\nexport class PlainCall extends AbstractCall\n{\n\tpeers: {[key: number]: Peer};\n\n\t#isCloudRecordFeaturesEnabled: false;\n\n\tconstructor(params)\n\t{\n\t\tsuper(params)\n\n\t\tthis.callFromMobile = params.callFromMobile;\n\t\tthis.state = params.state || '';\n\n\t\tthis.peers = this.initPeers(this.users);\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.deviceList = [];\n\n\t\tthis.turnServer = BX.message('turn_server');\n\t\tthis.turnServerLogin = BX.message('turn_server_login') || 'bitrix';\n\t\tthis.turnServerPassword = BX.message('turn_server_password') || 'bitrix';\n\n\t\tthis.pingUsersInterval = setInterval(this.pingUsers.bind(this), pingPeriod);\n\t\tthis.pingBackendInterval = setInterval(this.pingBackend.bind(this), backendPingPeriod);\n\n\t\tthis.reinviteTimeout = null;\n\t\tthis.userData = params.userData;\n\n\t\tthis._onUnloadHandler = this.#onUnload.bind(this);\n\t\tthis._onOnlineHandler = this.#onOnline.bind(this);\n\n\t\tthis.enableMicAutoParameters = params.enableMicAutoParameters !== false;\n\t\tthis.microphoneLevelInterval = null;\n\t\tthis.mediaMutedBySystem = false;\n\n\t\tthis._reconnectionEventCount = 0;\n\n\t\tthis.#isCloudRecordFeaturesEnabled = DesktopApi.isDesktop() || false;\n\t\tthis.isCloudRecordActive = false;\n\n\t\tthis._isCopilotActive = false;\n\t\tthis._isCopilotFeaturesEnabled = false;\n\t\tthis._isBoostExpired = false;\n\n\t\twindow.addEventListener('unload', this._onUnloadHandler);\n\t\twindow.addEventListener('online', this._onOnlineHandler);\n\t}\n\n\tget provider()\n\t{\n\t\treturn Provider.Plain;\n\t}\n\n\tget isCopilotActive()\n\t{\n\t\treturn this._isCopilotActive;\n\t}\n\n\tset isCopilotActive(isCopilotActive)\n\t{\n\t\tif (isCopilotActive !== this._isCopilotActive)\n\t\t{\n\t\t\tthis._isCopilotActive = isCopilotActive;\n\t\t}\n\t}\n\n\tget isBoostExpired()\n\t{\n\t\treturn this._isBoostExpired;\n\t}\n\n\tset isBoostExpired(isBoostExpired)\n\t{\n\t\tif (isBoostExpired !== this._isBoostExpired)\n\t\t{\n\t\t\tthis._isBoostExpired = isBoostExpired;\n\t\t}\n\t}\n\n\tget isCopilotFeaturesEnabled()\n\t{\n\t\treturn this._isCopilotFeaturesEnabled;\n\t}\n\n\tset isCopilotFeaturesEnabled(isCopilotFeaturesEnabled)\n\t{\n\t\tif (isCopilotFeaturesEnabled !== this._isCopilotFeaturesEnabled)\n\t\t{\n\t\t\tthis._isCopilotFeaturesEnabled = isCopilotFeaturesEnabled;\n\t\t}\n\t}\n\n\tget isCloudRecordFeaturesEnabled()\n\t{\n\t\treturn this.#isCloudRecordFeaturesEnabled;\n\t}\n\n\tset isCloudRecordFeaturesEnabled(isCloudRecordFeaturesEnabled)\n\t{\n\t\tif (isCloudRecordFeaturesEnabled !== this.#isCloudRecordFeaturesEnabled)\n\t\t{\n\t\t\tthis.#isCloudRecordFeaturesEnabled = isCloudRecordFeaturesEnabled;\n\t\t}\n\t}\n\n\tinitPeers(userIds)\n\t{\n\t\tlet peers = {};\n\t\tfor (let i = 0; i < userIds.length; i++)\n\t\t{\n\t\t\tconst userId = Number(userIds[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tpeers[userId] = this.createPeer(userId);\n\t\t}\n\t\treturn peers;\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tsignalingConnected: userId == this.initiatorId,\n\t\t\tisLegacyMobile: userId == this.initiatorId && this.callFromMobile,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t},\n\t\t\tonMediaStopped: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged.bind(this),\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout.bind(this),\n\t\t\tonRTCStatsReceived: this.#onPeerRTCStatsReceived.bind(this),\n\t\t\tonRTCQualityChanged: this.#onPeerRTCQualityChanged.bind(this),\n\t\t\tonNetworkProblem: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onNetworkProblem, e)\n\t\t\t},\n\t\t\tonReconnecting: (e) =>\n\t\t\t{\n\t\t\t\tthis._reconnectionEventCount++;\n\t\t\t\tthis.runCallback(CallEvent.onReconnecting, {\n\t\t\t\t\treconnectionEventCount: this._reconnectionEventCount,\n\t\t\t\t\treconnectionReason: e.reconnectionReason,\n\t\t\t\t\treconnectionReasonInfo: e.reconnectionReasonInfo,\n\t\t\t\t});\n\t\t\t},\n\t\t\tonReconnected: () =>\n\t\t\t{\n\t\t\t\tthis._reconnectionEventCount = 0;\n\t\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t\t},\n\t\t\tonUpdateLastUsedCameraId: () =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUpdateLastUsedCameraId);\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * Returns call participants and their states\n\t * @return {object} userId => user state\n\t */\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\t\treturn result;\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled == event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\t\tconst hasVideoTracks = this.localStreams['main'] && this.localStreams['main'].getVideoTracks().length > 0;\n\n\t\tif (this.ready && hasVideoTracks !== this.videoEnabled)\n\t\t{\n\t\t\tif (!this.videoEnabled)\n\t\t\t{\n\t\t\t\tCallStreamManager.stopStream(MediaStreamsKinds.Camera);\n\t\t\t}\n\n\t\t\tthis.replaceLocalMediaStream().then(() => {\n\t\t\t\tthis.signaling.sendCameraState(this.users, this.videoEnabled);\n\t\t\t}).catch(() =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\ttag: 'main',\n\t\t\t\t\tstream: this.localStreams['main'] || new MediaStream(),\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\tcanChangeMediaDevices()\n\t{\n\t\treturn !this.mediaMutedBySystem;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted == event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\t\tif (this.localStreams[\"main\"])\n\t\t{\n\t\t\tconst audioTracks = this.localStreams[\"main\"].getAudioTracks();\n\t\t\tif (audioTracks[0])\n\t\t\t{\n\t\t\t\taudioTracks[0].enabled = !this.muted;\n\t\t\t}\n\t\t}\n\n\t\tthis.signaling.sendMicrophoneState(this.users, !this.muted);\n\t\tthis.sendTalkingState();\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.ready && this.mediaMutedBySystem)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onNeedResetMediaDevicesState);\n\t\t\tthis.changedMediaMutedBySystem(false);\n\t\t}\n\t\telse if (this.ready && Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.runCallback('onUpdateLastUsedCameraId');\n\t\t\tRuntime.debounce(this.replaceLocalMediaStream, 100, this)();\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\t\tif (this.ready)\n\t\t{\n\t\t\tif (this.mediaMutedBySystem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tRuntime.debounce(this.replaceLocalAudioStream, 100, this)();\n\t\t}\n\t};\n\n\tgetCurrentMicrophoneId()\n\t{\n\t\tif (!this.localStreams['main'])\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\n\t\tconst audioTracks = this.localStreams['main'].getAudioTracks();\n\t\tif (audioTracks.length > 0)\n\t\t{\n\t\t\tconst audioTrackSettings = audioTracks[0].getSettings();\n\t\t\treturn audioTrackSettings.deviceId;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.microphoneId;\n\t\t}\n\t};\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\t/**\n\t * @param { Object } commonRecordState\n\t * @param { string } commonRecordState.action\n\t * @param { string } commonRecordState.type\n\t * @param { Date } commonRecordState.date\n\t */\n\tsendLocalRecordState(commonRecordState)\n\t{\n\t\tif (!this.updateCommonRecordState({ ...commonRecordState, senderId: this.userId }))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst users = [this.userId, ...this.users];\n\n\t\tthis.signaling.sendLocalRecordState(users, this.commonRecordState);\n\t}\n\n\tstopSendingStream(tag)\n\t{\n\t\t//todo: implement\n\t};\n\n\tallowVideoFrom(userList)\n\t{\n\t\t//todo: implement\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t **/\n\tinviteUsers(config: {users: number[], localStream: MediaStream} = {})\n\t{\n\t\tconst users = Type.isArray(config.users) ? config.users : Object.keys(this.peers);\n\t\tthis.ready = true;\n\n\t\tif (config.localStream instanceof MediaStream && !this.localStreams[\"main\"])\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\tthis.getLocalMediaStream(\"main\", true).then(() =>\n\t\t{\n\t\t\tif (!this.ready)\n\t\t\t{\n\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\treturn this.signaling.inviteUsers({\n\t\t\t\tuserIds: users,\n\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N'\n\t\t\t});\n\t\t}).then(() =>\n\t\t{\n\t\t\tthis.state = CallState.Connected;\n\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\tlocal: true\n\t\t\t});\n\n\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t{\n\t\t\t\tconst userId = Number(users[i]);\n\t\t\t\tif (!this.peers[userId])\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\n\t\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\t\tuserId: userId\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.peers[userId].onInvited();\n\n\t\t\t\tthis.scheduleRepeatInvite();\n\t\t\t}\n\t\t}).catch((e) =>\n\t\t{\n\t\t\tconsole.error(e);\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t});\n\t};\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(this.repeatInviteUsers.bind(this), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling\n\t\t\t.inviteUsers({\n\t\t\t\tuserIds: usersToRepeatInvite,\n\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\t\trepeated: 'Y',\n\t\t\t})\n\t\t\t.then(() => this.scheduleRepeatInvite());\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tgetMediaConstraints(options = {})\n\t{\n\t\tconst audio = {};\n\t\tconst video = options.videoEnabled ? {} : false;\n\t\tconst hdVideo = !!options.hdVideo;\n\t\tconst supportedConstraints = navigator.mediaDevices.getSupportedConstraints ? navigator.mediaDevices.getSupportedConstraints() : {};\n\n\t\tif (this.microphoneId)\n\t\t{\n\t\t\taudio.deviceId = { exact: this.microphoneId };\n\t\t}\n\n\t\tif (!this.enableMicAutoParameters)\n\t\t{\n\t\t\tif (supportedConstraints.echoCancellation)\n\t\t\t{\n\t\t\t\taudio.echoCancellation = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.noiseSuppression)\n\t\t\t{\n\t\t\t\taudio.noiseSuppression = false;\n\t\t\t}\n\t\t\tif (supportedConstraints.autoGainControl)\n\t\t\t{\n\t\t\t\taudio.autoGainControl = false;\n\t\t\t}\n\t\t}\n\n\t\tif (video)\n\t\t{\n\t\t\t//video.aspectRatio = 1.7777777778;\n\t\t\tif (this.cameraId)\n\t\t\t{\n\t\t\t\tvideo.deviceId = {exact: this.cameraId};\n\t\t\t}\n\n\t\t\tif (hdVideo)\n\t\t\t{\n\t\t\t\tvideo.width = {ideal: 1280};\n\t\t\t\tvideo.height = {ideal: 720};\n\t\t\t}\n\t\t}\n\n\t\treturn {audio: audio, video: video};\n\t};\n\n\t/**\n\t * Recursively tries to get user media stream with array of constraints\n\t *\n\t * @param constraintsArray array of constraints objects\n\t * @returns {Promise}\n\t */\n\tasync getUserMedia(constraintsArray): Promise<MediaStream>\n\t{\n\t\tconst currentConstraints = constraintsArray[0];\n\n\t\ttry\n\t\t{\n\t\t\treturn await CallStreamManager.getUserMedia(currentConstraints);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.log('getUserMedia error: ', error);\n\t\t\tthis.log('Current constraints', currentConstraints);\n\n\t\t\tif (constraintsArray.length > 1)\n\t\t\t{\n\t\t\t\treturn this.getUserMedia(constraintsArray.slice(1));\n\t\t\t}\n\n\t\t\tthis.log('Last fallback constraints used, failing');\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tgetLocalMediaStream(tag, fallbackToAudio)\n\t{\n\t\tif (!Type.isStringFilled(tag))\n\t\t{\n\t\t\ttag = 'main';\n\t\t}\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: tag,\n\t\t\t\tstream: this.localStreams[tag]\n\t\t\t});\n\t\t\treturn Promise.resolve(this.localStreams[tag]);\n\t\t}\n\n\t\tthis.log(\"Requesting access to media devices\");\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet constraintsArray = [];\n\t\t\tif (Hardware.isCameraOn)\n\t\t\t{\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: true, hdVideo: true}));\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: true, hdVideo: false}));\n\t\t\t\tif (fallbackToAudio)\n\t\t\t\t{\n\t\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: false}));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconstraintsArray.push(this.getMediaConstraints({videoEnabled: false}));\n\t\t\t}\n\n\t\t\tthis.getUserMedia(constraintsArray).then((mediaStream) => {\n\t\t\t\tthis.log('Local media stream received');\n\t\t\t\tconst stream = mediaStream.clone();\n\t\t\t\tthis.localStreams[tag] = stream;\n\t\t\t\tstream.getVideoTracks().forEach((track) =>\n\t\t\t\t{\n\t\t\t\t\ttrack.addEventListener(\"ended\", () => this.onLocalVideoTrackEnded());\n\t\t\t\t\ttrack.addEventListener(\"mute\", () => this.onLocalVideoTrackMute());\n\t\t\t\t\ttrack.addEventListener(\"unmute\", () => this.onLocalVideoTrackUnmute());\n\t\t\t\t});\n\n\t\t\t\tstream.getAudioTracks().forEach((track) =>\n\t\t\t\t{\n\t\t\t\t\ttrack.addEventListener(\"ended\", () => this.onLocalAudioTrackEnded())\n\t\t\t\t});\n\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\tstream: stream\n\t\t\t\t});\n\t\t\t\tthis.setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\tif (tag === 'main')\n\t\t\t\t{\n\t\t\t\t\tthis.attachVoiceDetection();\n\t\t\t\t\tif (Hardware.isMicrophoneMuted)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\tif (audioTracks[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTracks[0].enabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.deviceList.length === 0)\n\t\t\t\t{\n\t\t\t\t\tHardware.getCurrentDeviceList().then((deviceList) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceList = deviceList;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onDeviceListUpdated, {\n\t\t\t\t\t\t\tdeviceList: this.deviceList\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tresolve(this.localStreams[tag]);\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Could not get local media stream.\", e);\n\t\t\t\tthis.log(\"Request constraints: .\", constraintsArray);\n\t\t\t\tthis.runCallback(\"onLocalMediaError\", {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tgetLocalAudioStream(tag, fallbackToAudio)\n\t{\n\t\tif (!Type.isStringFilled(tag))\n\t\t{\n\t\t\ttag = 'main';\n\t\t}\n\t\tif (this.localStreams[tag] && this.localStreams[tag].getAudioTracks().length)\n\t\t{\n\t\t\treturn Promise.resolve(this.localStreams[tag]);\n\t\t}\n\n\t\tthis.log(\"Requesting access to audio devices\");\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tlet constraintsArray = [this.getMediaConstraints({videoEnabled: false})];\n\n\t\t\tthis.getUserMedia(constraintsArray).then((stream) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Local audio stream received\");\n\n\t\t\t\tif (!this.localStreams[tag]) {\n\t\t\t\t\tthis.localStreams[tag] = new MediaStream();\n\t\t\t\t}\n\n\t\t\t\tthis.localStreams[tag].addTrack(stream.getAudioTracks()[0]);\n\t\t\t\tstream.getAudioTracks().forEach((track) =>\n\t\t\t\t{\n\t\t\t\t\ttrack.addEventListener(\"ended\", () => this.onLocalAudioTrackEnded())\n\t\t\t\t});\n\n\t\t\t\tif (tag === 'main')\n\t\t\t\t{\n\t\t\t\t\tthis.attachVoiceDetection();\n\t\t\t\t\tif (this.muted)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst audioTracks = stream.getAudioTracks();\n\t\t\t\t\t\tif (audioTracks[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTracks[0].enabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (this.deviceList.length === 0)\n\t\t\t\t{\n\t\t\t\t\tHardware.getCurrentDeviceList().then((deviceList) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.deviceList = deviceList;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onDeviceListUpdated, {\n\t\t\t\t\t\t\tdeviceList: this.deviceList\n\t\t\t\t\t\t})\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tresolve(this.localStreams[tag]);\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Could not get local audio stream.\", e);\n\t\t\t\tthis.log(\"Request constraints: .\", constraintsArray);\n\t\t\t\tthis.runCallback(\"onLocalMediaError\", {\n\t\t\t\t\ttag: tag,\n\t\t\t\t\terror: e\n\t\t\t\t});\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tsetPublishingState(deviceType, publishing)\n\t{\n\t\tif (deviceType === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCameraPublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t\telse if (deviceType === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onMicrophonePublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t}\n\n\tstartMediaCapture()\n\t{\n\t\treturn this.getLocalMediaStream();\n\t};\n\n\tattachVoiceDetection()\n\t{\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t}\n\t\tif (this.microphoneLevelInterval)\n\t\t{\n\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tthis.voiceDetection = new SimpleVAD({\n\t\t\t\tmediaStream: this.localStreams['main'],\n\t\t\t\tonVoiceStarted: this.onLocalVoiceStarted.bind(this),\n\t\t\t\tonVoiceStopped: this.onLocalVoiceStopped.bind(this)\n\t\t\t})\n\n\t\t\tthis.microphoneLevelInterval = setInterval(function ()\n\t\t\t{\n\t\t\t\tthis.microphoneLevel = this.voiceDetection.currentVolume;\n\t\t\t}.bind(this), 200)\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Could not attach voice detection to media stream');\n\t\t}\n\t};\n\n\tgetDisplayMedia(): Promise<MediaStream>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tCallStreamManager.getUserScreen().then((stream) => {\n\t\t\t\tresolve(stream);\n\t\t\t}).catch((error) => {\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t}\n\n\tstartScreenSharing(changeSource)\n\t{\n\t\tchangeSource = !!changeSource;\n\t\tif (this.localStreams[\"screen\"] && !changeSource)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.waitingLocalScreenShare = true;\n\n\t\tthis.getDisplayMedia().then((stream) =>\n\t\t{\n\t\t\tthis.localStreams[\"screen\"] = stream;\n\n\t\t\tstream.getVideoTracks().forEach((track) =>\n\t\t\t{\n\t\t\t\ttrack.addEventListener(\"ended\", () => this.stopScreenSharing())\n\t\t\t});\n\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tscreenState: true,\n\t\t\t});\n\n\t\t\tthis.runCallback(CallEvent.onLocalScreenUpdated, {\n\t\t\t\ttrack: stream.getVideoTracks()?.[0] || null,\n\t\t\t});\n\n\t\t\tif (this.ready)\n\t\t\t{\n\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t{\n\t\t\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}).catch((e) =>\n\t\t{\n\t\t\tthis.log(e);\n\t\t}).finally(() =>\n\t\t{\n\t\t\tthis.waitingLocalScreenShare = false;\n\t\t})\n\t};\n\n\tonLocalVideoTrackEnded()\n\t{\n\t\tif (!this.localStreams[\"main\"])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.stopMediaStreamVideoTracks(this.localStreams[\"main\"])\n\n\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\ttag: 'main',\n\t\t\tstream: this.localStreams[\"main\"]\n\t\t});\n\n\t\tif (!this.localStreams[\"main\"].getAudioTracks().length)\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t}\n\n\tonLocalAudioTrackEnded()\n\t{\n\t\tif (!this.localStreams[\"main\"])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.stopMediaStreamAudioTracks(this.localStreams[\"main\"])\n\n\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\ttag: 'main',\n\t\t\tstream: this.localStreams[\"main\"]\n\t\t});\n\n\t\tif (!this.localStreams[\"main\"].getVideoTracks().length)\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t}\n\n\tonLocalVideoTrackMute()\n\t{\n\t\tthis.changedMediaMutedBySystem(true);\n\t\tthis.prevMainStream = this.localStreams['main'];\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.localStreams['main'] = null;\n\t\t\tfor (let userId in this.peers)\n\t\t\t{\n\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId].replaceMediaStream('main');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tonLocalVideoTrackUnmute()\n\t{\n\t\tthis.changedMediaMutedBySystem(false);\n\n\t\tif (this.prevMainStream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.prevMainStream);\n\t\t\tthis.prevMainStream = null;\n\t\t}\n\n\t\tthis.replaceLocalMediaStream().catch(() =>\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: 'main',\n\t\t\t\tstream: this.localStreams['main'] || new MediaStream(),\n\t\t\t});\n\t\t});\n\t};\n\n\tchangedMediaMutedBySystem(muted)\n\t{\n\t\tthis.mediaMutedBySystem = muted;\n\t\tconst microphoneState = muted ? false : !Hardware.isMicrophoneMuted;\n\t\tconst cameraState = muted ? false : Hardware.isCameraOn;\n\t\tthis.signaling.sendMicrophoneState(this.users, microphoneState);\n\t\tthis.signaling.sendCameraState(this.users, cameraState);\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tconst tag = 'screen';\n\t\tconst stream = this.localStreams[tag];\n\n\t\tif (!stream)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.stopMediaStream(stream);\n\t\tCallStreamManager.stopStream(MediaStreamsKinds.Screen);\n\t\tCallStreamManager.stopStream(MediaStreamsKinds.ScreenAudio);\n\n\t\tthis.localStreams[tag] = null;\n\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\tuserId: this.userId,\n\t\t\tscreenState: false,\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onLocalScreenUpdated, {\n\t\t\ttrack: null,\n\t\t});\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.localStreams[\"screen\"] instanceof MediaStream || this.waitingLocalScreenShare;\n\t};\n\n\tonLocalVoiceStarted()\n\t{\n\t\tthis.talking = true;\n\t\tthis.sendTalkingState();\n\t};\n\n\tonLocalVoiceStopped()\n\t{\n\t\tthis.talking = false;\n\t\tthis.sendTalkingState();\n\t};\n\n\tsendTalkingState()\n\t{\n\t\tif (this.talking && !Hardware.isMicrophoneMuted)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStarted({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tlocal: true\n\t\t\t});\n\t\t\tthis.signaling.sendVoiceStopped({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t}\n\n\tsendCustomMessage(message)\n\t{\n\t\tthis.signaling.sendCustomMessage({\n\t\t\tuserId: this.users,\n\t\t\tmessage: message\n\t\t});\n\t}\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool} [config.useVideo]\n\t * @param {bool} [config.enableMicAutoParameters]\n\t * @param {MediaStream} [config.localStream]\n\t */\n\tanswer(config)\n\t{\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\t\t/*if(this.direction !== Direction.Incoming)\n\t\t{\n\t\t\tthrow new Error('Only incoming call could be answered');\n\t\t}*/\n\n\t\tthis.ready = true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\t\tthis.enableMicAutoParameters = (config.enableMicAutoParameters !== false);\n\n\t\tif (config.localStream instanceof MediaStream)\n\t\t{\n\t\t\tthis.localStreams[\"main\"] = config.localStream;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalMediaStream(\"main\", true)\n\t\t\t\t.then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.ready)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#beforeLeaveCall();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\t\t\tthis.state = CallState.Connected;\n\n\t\t\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn this.sendAnswer();\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t.then(() => resolve())\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onCallFailure, e);\n\t\t\t\t\treject(e)\n\t\t\t\t});\n\t\t});\n\t};\n\n\tsendAnswer()\n\t{\n\t\tthis.signaling.sendAnswer();\n\t};\n\n\tdecline(code, reason)\n\t{\n\t\tthis.ready = false;\n\n\t\tlet data = {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.decline, data).then(() =>\n\t\t{\n\t\t\tthis.destroy();\n\t\t});\n\t};\n\n\thangup(force = false)\n\t{\n\t\tif (!this.ready && !force)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn Promise.reject(error);\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tthis.ready = false;\n\t\tthis.state = CallState.Proceeding;\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tfor (let userId in this.peers)\n\t\t\t{\n\t\t\t\tthis.peers[userId].disconnect();\n\t\t\t}\n\n\t\t\tthis.#beforeLeaveCall();\n\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t\tthis.signaling.sendHangup({userId: this.users})\n\t\t\t\t.then(() => resolve())\n\t\t\t\t.catch(e => reject(e))\n\t\t\t;\n\t\t});\n\t};\n\n\tpingUsers()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToUsers({userId: this.users.concat(this.userId)});\n\t\t}\n\t};\n\n\tpingBackend()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToBackend();\n\t\t}\n\t};\n\n\tgetState()\n\t{\n\n\t};\n\n\treplaceLocalMediaStream(tag: string = \"main\")\n\t{\n\t\tthis.setPublishingState(MediaStreamsKinds.Camera, true);\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalMediaStream(tag).then(() =>\n\t\t\t{\n\t\t\t\tif (this.ready)\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.peers[userId].replaceMediaStream(tag);\n\t\t\t\t\t\t\tif (this.mediaMutedBySystem)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.changedMediaMutedBySystem(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error('Could not get access to hardware; don\\'t really know what to do. error:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\treplaceLocalAudioStream(tag: string = \"main\")\n\t{\n\t\tif (this.localStreams[tag])\n\t\t{\n\t\t\tUtil.stopMediaStreamAudioTracks(this.localStreams[tag]);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getLocalAudioStream(tag).then(() =>\n\t\t\t{\n\t\t\t\tif (this.ready)\n\t\t\t\t{\n\t\t\t\t\tfor (let userId in this.peers)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.peers[userId].isReady())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.peers[userId].replaceMediaStream(tag);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}).catch((e) =>\n\t\t\t{\n\t\t\t\tconsole.error('Could not get access to hardware; don\\'t really know what to do. error:', e);\n\t\t\t\treject(e);\n\t\t\t});\n\t\t})\n\t};\n\n\tsendAllStreams(userId)\n\t{\n\t\tif (!this.peers[userId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[userId].isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tthis.peers[userId].sendMedia();\n\t\t\t}\n\t\t}\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.peers[userId].calculatedState !== UserState.Calling)\n\t\t\t{\n\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t}\n\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tconst handlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer.bind(this),\n\t\t\t'Call::hangup': this.#onPullEventHangup.bind(this),\n\t\t\t'Call::ping': this.#onPullEventPing.bind(this),\n\t\t\t'Call::negotiationNeeded': this.#onPullEventNegotiationNeeded.bind(this),\n\t\t\t'Call::connectionOffer': this.#onPullEventConnectionOffer.bind(this),\n\t\t\t'Call::connectionAnswer': this.#onPullEventConnectionAnswer.bind(this),\n\t\t\t'Call::iceCandidate': this.#onPullEventIceCandidate.bind(this),\n\t\t\t'Call::voiceStarted': this.#onPullEventVoiceStarted.bind(this),\n\t\t\t'Call::voiceStopped': this.#onPullEventVoiceStopped.bind(this),\n\t\t\t'Call::microphoneState': this.#onPullEventMicrophoneState.bind(this),\n\t\t\t'Call::cameraState': this.#onPullEventCameraState.bind(this),\n\t\t\t'Call::videoPaused': this.#onPullEventVideoPaused.bind(this),\n\t\t\t'Call::commonRecordState': this.#onPullEventRecordState.bind(this),\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined.bind(this),\n\t\t\t'Call::usersInvited': this.#onPullEventUsersInvited.bind(this),\n\t\t\t'Call::userInviteTimeout': this.#onPullEventUserInviteTimeout.bind(this),\n\t\t\t'Call::associatedEntityReplaced': this.#onPullEventAssociatedEntityReplaced.bind(this),\n\t\t\t'Call::finish': this.#onPullEventFinish.bind(this),\n\t\t\t'Call::repeatAnswer': this.#onPullEventRepeatAnswer.bind(this),\n\t\t\t'Call::customMessage': this.#onPullEventCallCustomMessage.bind(this),\n\t\t};\n\n\t\tif (handlers[command])\n\t\t{\n\t\t\tif (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tif (params.senderId != this.userId || params.instanceId != this.instanceId)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Signaling: ping from user \" + params.senderId);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\thandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst users = params.users;\n\n\t\tthis.addInvitedUsers(users);\n\t};\n\n\t#onPullEventUserInviteTimeout(params)\n\t{\n\t\tthis.log('__onPullEventUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onPullEventAnswer(params)\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.#onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peers[senderId].isReady())\n\t\t{\n\t\t\tthis.log(\"Received answer for user \" + senderId + \" in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].setSignalingConnected(true);\n\t\tthis.peers[senderId].setReady(true);\n\t\tthis.peers[senderId].isLegacyMobile = params.isLegacyMobile === true;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.sendAllStreams(senderId);\n\t\t}\n\t};\n\n\t#onPullEventAnswerSelf(params)\n\t{\n\t\tthis.runCallback('onGetUserMediaEnded', {});\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.log(\"Received remote self-answer in ready state, ignoring\");\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.log(\"Call was answered elsewhere\");\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup(params)\n\t{\n\t\tconst senderId = params.senderId;\n\n\t\tif (this.userId == senderId)\n\t\t{\n\t\t\tif (this.instanceId != params.callInstanceId)\n\t\t\t{\n\t\t\t\t// self hangup elsewhere\n\t\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].disconnect(params.code);\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\n\t\tif (!this.isAnyoneParticipating() && this.ready)\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventPing(params)\n\t{\n\t\tif (params.callInstanceId == this.instanceId)\n\t\t{\n\t\t\t// ignore self ping\n\t\t\treturn;\n\t\t}\n\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setSignalingConnected(true);\n\t};\n\n\t#onPullEventNegotiationNeeded(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet peer: Peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tif (params.restart)\n\t\t{\n\t\t\tpeer.reconnect({reconnectionReason: 'GOT_PULL_EVENT_NEGOTIATION_NEEDED'});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpeer.onNegotiationNeeded();\n\t\t}\n\t};\n\n\t#onPullEventConnectionOffer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tpeer.setReady(true);\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionOffer(params.connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventConnectionAnswer(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst connectionId = params.connectionId;\n\n\t\tpeer.setUserAgent(params.userAgent);\n\t\tpeer.setConnectionAnswer(connectionId, params.sdp, params.tracks);\n\t};\n\n\t#onPullEventIceCandidate(params)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst peer = this.peers[params.senderId];\n\t\tlet candidates;\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tcandidates = params.candidates;\n\t\t\tfor (let i = 0; i < candidates.length; i++)\n\t\t\t{\n\t\t\t\tpeer.addIceCandidate(params.connectionId, candidates[i]);\n\t\t\t}\n\t\t} catch (e)\n\t\t{\n\t\t\tthis.log('Error parsing serialized candidate: ', e);\n\t\t}\n\t};\n\n\t#onPullEventVoiceStarted(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventVoiceStopped(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\tuserId: params.senderId\n\t\t})\n\t};\n\n\t#onPullEventMicrophoneState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\tuserId: params.senderId,\n\t\t\tmicrophoneState: params.microphoneState\n\t\t})\n\t};\n\n\t#onPullEventCameraState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\tuserId: params.senderId,\n\t\t\tcameraState: params.cameraState\n\t\t})\n\t};\n\n\t#onPullEventVideoPaused(params)\n\t{\n\t\tconst peer = this.peers[params.senderId];\n\t\tif (!peer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\tuserId: params.senderId,\n\t\t\tvideoPaused: params.videoPaused\n\t\t});\n\n\t\tpeer.holdOutgoingVideo(!!params.videoPaused);\n\t};\n\n\t#onPullEventRecordState(params)\n\t{\n\t\tthis.runCallback(CallEvent.onUserCommonRecordState, {\n\t\t\tuserId: params.senderId,\n\t\t\tcommonRecordState: params.commonRecordState\n\t\t})\n\t};\n\n\t#onPullEventAssociatedEntityReplaced(params)\n\t{\n\t\tif (params.call && params.call.ASSOCIATED_ENTITY)\n\t\t{\n\t\t\tthis.associatedEntity = params.call.ASSOCIATED_ENTITY;\n\t\t}\n\t};\n\n\t#onPullEventFinish()\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventRepeatAnswer()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendAnswer({userId: this.userId}, true);\n\t\t}\n\t};\n\n\t#onPullEventCallCustomMessage(params)\n\t{\n\t\tthis.runCallback(CallEvent.onCustomMessage, {message: params.message});\n\t}\n\n\t#onPeerStateChanged(e)\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (e.state == UserState.Failed || e.state == UserState.Unavailable)\n\t\t{\n\t\t\tif (!this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup().then(this.destroy.bind(this)).catch(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\t//this.runCallback(Event.onCallFailure, e);\n\t\t\t\t\t\tthis.destroy();\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(e.userId, !Hardware.isMicrophoneMuted);\n\t\t\tthis.signaling.sendCameraState(e.userId, Hardware.isCameraOn);\n\t\t\tthis.wasConnected = true;\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout(e)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t#onPeerRTCStatsReceived(e)\n\t{\n\t\tconst remoteReportsToShow = {};\n\t\tconst localReportsToShow = {};\n\n\t\te.stats.forEach((report) =>\n\t\t{\n\t\t\tif (report.type === 'inbound-rtp' && (report.kind === 'video' || report.kind === 'audio') && report.source)\n\t\t\t{\n\t\t\t\tremoteReportsToShow[report.source] = report;\n\t\t\t}\n\t\t\tif (report.type === 'outbound-rtp' && (report.kind === 'video' || report.kind === 'audio') && report.source)\n\t\t\t{\n\t\t\t\tlocalReportsToShow[report.source] = report;\n\t\t\t}\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\tuserId: e.userId,\n\t\t\treport: remoteReportsToShow\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\tuserId: this.userId,\n\t\t\treport: localReportsToShow\n\t\t});\n\n\t\tthis.runCallback(CallEvent.onRTCStatsReceived, e);\n\t};\n\n\t#onPeerRTCQualityChanged(e)\n\t{\n\t\tthis.runCallback(CallEvent.onConnectionQualityChanged, {\n\t\t\tuserId: e.userId,\n\t\t\tscore: e.score,\n\t\t});\n\t}\n\n\t#onUnload()\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.hangup, {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId\n\t\t});\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tthis.peers[userId].disconnect();\n\t\t}\n\t};\n\n\t#onOnline()\n\t{\n\t\tconst peers = Object.values(this.peers);\n\t\tpeers.forEach((peer) => {\n\t\t\tpeer.reconnect({reconnectionReason: 'GOT_ONLINE_EVENT_FROM_BROWSER'});\n\t\t});\n\t}\n\n\t#beforeLeaveCall()\n\t{\n\t\t// stop media streams\n\t\tthis.unsubscribeHardwareChanges();\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tif (this.localStreams[tag])\n\t\t\t{\n\t\t\t\tUtil.stopMediaStream(this.localStreams[tag]);\n\t\t\t\tthis.localStreams[tag] = null;\n\t\t\t}\n\t\t}\n\t\tif (this.prevMainStream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.prevMainStream);\n\t\t\tthis.prevMainStream = null;\n\t\t}\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\t// remove all event listeners\n\t\twindow.removeEventListener('unload', this._onUnloadHandler);\n\t\twindow.removeEventListener('online', this._onOnlineHandler);\n\n\t\tclearInterval(this.statsInterval);\n\t\tclearInterval(this.pingUsersInterval);\n\t\tclearInterval(this.pingBackendInterval);\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tclearTimeout(this.reinviteTimeout);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.ready = false;\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Call destroy \\n\" + tempError.stack);\n\n\t\t// stop sending media streams\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tthis.#beforeLeaveCall();\n\t\tthis.runCallback(CallEvent.onLeave, { local: true });\n\n\t\treturn super.destroy();\n\t}\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tisIceTricklingAllowed()\n\t{\n\t\treturn CallEngine.getPullClient().isPublishingSupported();\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendAnswer(data, repeated)\n\t{\n\t\tif (repeated && CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.answer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.answer, data);\n\t\t}\n\t};\n\n\tsendConnectionOffer(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.connectionOffer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.connectionOffer, data);\n\t\t}\n\t};\n\n\tsendConnectionAnswer(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.connectionAnswer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.connectionAnswer, data);\n\t\t}\n\t};\n\n\tsendIceCandidate(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.iceCandidate, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.iceCandidate, data);\n\t\t}\n\t};\n\n\tsendNegotiationNeeded(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.negotiationNeeded, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.negotiationNeeded, data);\n\t\t}\n\t};\n\n\tsendVoiceStarted(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.voiceStarted, data);\n\t\t}\n\t};\n\n\tsendVoiceStopped(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.voiceStopped, data);\n\t\t}\n\t};\n\n\tsendMicrophoneState(users, microphoneState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.microphoneState, {\n\t\t\t\tuserId: users,\n\t\t\t\tmicrophoneState: microphoneState\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendCameraState(users, cameraState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.cameraState, {\n\t\t\t\tuserId: users,\n\t\t\t\tcameraState: cameraState\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendVideoPaused(users, videoPaused)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\treturn this.#sendPullEvent(pullEvents.videoPaused, {\n\t\t\t\tuserId: users,\n\t\t\t\tvideoPaused: videoPaused\n\t\t\t}, 0);\n\t\t}\n\t};\n\n\tsendLocalRecordState(users, commonRecordState)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.commonRecordState, {\n\t\t\t\tuserId: users,\n\t\t\t\tcommonRecordState,\n\t\t\t}, 0);\n\t\t}\n\t}\n\n\tsendPingToUsers(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.ping, data, 5);\n\t\t}\n\t};\n\n\tsendCustomMessage(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.customMessage, data, 5);\n\t\t}\n\t};\n\n\tsendPingToBackend()\n\t{\n\t\tconst retransmit = !CallEngine.getPullClient().isPublishingEnabled();\n\t\tthis.#runRestAction(ajaxActions.ping, {retransmit: retransmit});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.userInviteTimeout, data, 0);\n\t\t}\n\t};\n\n\tsendHangup(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingSupported())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data, 3600);\n\t\t\tdata.retransmit = false;\n\t\t\treturn this.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\treturn this.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t};\n\n\t#sendPullEvent(eventName, data, expiry)\n\t{\n\t\texpiry = expiry || 5;\n\t\tif (!data.userId)\n\t\t{\n\t\t\tthrow new Error('userId is not found in data');\n\t\t}\n\n\t\tif (!Type.isArray(data.userId))\n\t\t{\n\t\t\tdata.userId = [data.userId];\n\t\t}\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.senderId = this.call.userId;\n\t\tdata.callId = this.call.id;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tif (eventName == 'Call::ping')\n\t\t{\n\t\t\tthis.call.log('Sending p2p signaling event ' + eventName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.call.log('Sending p2p signaling event ' + eventName + '; ' + JSON.stringify(data));\n\t\t}\n\t\tCallEngine.getPullClient().sendMessage(data.userId, 'im', eventName, data, expiry);\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callId = this.call.id;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tif (signalName == 'Call::ping')\n\t\t{\n\t\t\tthis.call.log('Sending ajax-based signaling event ' + signalName);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.call.log('Sending ajax-based signaling event ' + signalName + '; ' + JSON.stringify(data));\n\t\t}\n\t\treturn CallEngine.getRestClient().callMethod(signalName, data).catch(function (e) {console.error(e)});\n\t};\n}\n\nclass Peer\n{\n\tcall: PlainCall\n\tpeerConnection: ?RTCPeerConnection\n\tpeerConnectionId: ?string\n\tvideoSender: ?RTCRtpSender\n\taudioSender: ?RTCRtpSender\n\tscreenSender: ?RTCRtpSender\n\tscreenAudioSender: ?RTCRtpSender\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t\tthis.userId = params.userId;\n\n\t\tthis.ready = params.ready === true;\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.signalingConnected = params.signalingConnected === true;\n\t\tthis.failureReason = '';\n\n\t\tthis.userAgent = '';\n\t\tthis.isFirefox = false;\n\t\tthis.isChrome = false;\n\t\tthis.isLegacyMobile = params.isLegacyMobile === true;\n\n\t\tthis.lastSuccessedLocaleCandidate = '';\n\t\tthis.lastSuccessedRemoteCandidate = '';\n\n\t\t/*sums up from signaling, ready and connection states*/\n\t\tthis.calculatedState = this.calculateState();\n\n\t\tthis.localStreams = {\n\t\t\tmain: null,\n\t\t\tscreen: null\n\t\t};\n\n\t\tthis.pendingIceCandidates = {};\n\t\tthis.localIceCandidates = [];\n\n\t\tthis.trackList = {};\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaStopped: Type.isFunction(params.onMediaStopped) ? params.onMediaStopped : BX.DoNothing,\n\t\t\tonRTCStatsReceived: Type.isFunction(params.onRTCStatsReceived) ? params.onRTCStatsReceived : BX.DoNothing,\n\t\t\tonRTCQualityChanged: Type.isFunction(params.onRTCQualityChanged) ? params.onRTCQualityChanged : BX.DoNothing,\n\t\t\tonNetworkProblem: Type.isFunction(params.onNetworkProblem) ? params.onNetworkProblem : BX.DoNothing,\n\t\t\tonReconnecting: Type.isFunction(params.onReconnecting) ? params.onReconnecting : BX.DoNothing,\n\t\t\tonReconnected: Type.isFunction(params.onReconnected) ? params.onReconnected : BX.DoNothing,\n\t\t\tonUpdateLastUsedCameraId: Type.isFunction(params.onUpdateLastUsedCameraId) ? params.onUpdateLastUsedCameraId : BX.DoNothing,\n\t\t};\n\n\t\t// intervals and timeouts\n\t\tthis.answerTimeout = null;\n\t\tthis.callingTimeout = null;\n\t\tthis.connectionTimeout = null;\n\t\tthis.signalingConnectionTimeout = null;\n\t\tthis.candidatesTimeout = null;\n\n\t\tthis.statsInterval = null;\n\n\t\tthis.connectionOfferReplyTimeout = null;\n\t\tthis.negotiationNeededReplyTimeout = null;\n\t\tthis.reconnectAfterDisconnectTimeout = null;\n\n\t\tthis.connectionAttempt = 0;\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\n\t\tthis._outgoingVideoTrack = null;\n\t\tObject.defineProperty(this, 'outgoingVideoTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingVideoTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingVideoTrack = track;\n\t\t\t\tif (this._outgoingVideoTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis._outgoingScreenTrack = null;\n\t\tObject.defineProperty(this, 'outgoingScreenTrack', {\n\t\t\tget: function ()\n\t\t\t{\n\t\t\t\treturn this._outgoingScreenTrack;\n\t\t\t},\n\t\t\tset: function (track)\n\t\t\t{\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.stop();\n\t\t\t\t}\n\t\t\t\tthis._outgoingScreenTrack = track;\n\t\t\t\tif (this._outgoingScreenTrack)\n\t\t\t\t{\n\t\t\t\t\tthis._outgoingScreenTrack.enabled = !this.outgoingVideoHoldState;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis._incomingAudioTrack = null;\n\t\tthis._incomingScreenAudioTrack = null;\n\t\tthis._incomingVideoTrack = null;\n\t\tthis._incomingScreenTrack = null;\n\t\tObject.defineProperty(this, 'incomingAudioTrack', {\n\t\t\tget: this._mediaGetter('_incomingAudioTrack'),\n\t\t\tset: this._mediaSetter('_incomingAudioTrack', 'audio')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingVideoTrack', {\n\t\t\tget: this._mediaGetter('_incomingVideoTrack'),\n\t\t\tset: this._mediaSetter('_incomingVideoTrack', 'video')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingScreenTrack', {\n\t\t\tget: this._mediaGetter('_incomingScreenTrack'),\n\t\t\tset: this._mediaSetter('_incomingScreenTrack', 'screen')\n\t\t});\n\t\tObject.defineProperty(this, 'incomingScreenAudioTrack', {\n\t\t\tget: this._mediaGetter('_incomingScreenAudioTrack'),\n\t\t\tset: this._mediaSetter('_incomingScreenAudioTrack', 'sharingAudio')\n\t\t});\n\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\t// event handlers\n\t\tthis._onPeerConnectionIceCandidateHandler = this._onPeerConnectionIceCandidate.bind(this);\n\t\tthis._onPeerConnectionConnectionStateChangeHandler = this.#onPeerConnectionConnectionStateChange.bind(this);\n\t\tthis._onPeerConnectionIceGatheringStateChangeHandler = this.#onPeerConnectionIceGatheringStateChange.bind(this);\n\t\tthis._onPeerConnectionSignalingStateChangeHandler = this.#onPeerConnectionSignalingStateChange.bind(this);\n\t\t//this._onPeerConnectionNegotiationNeededHandler = this._onPeerConnectionNegotiationNeeded.bind(this);\n\t\tthis._onPeerConnectionTrackHandler = this.#onPeerConnectionTrack.bind(this);\n\t\tthis._onPeerConnectionRemoveStreamHandler = this.#onPeerConnectionRemoveStream.bind(this);\n\n\t\tthis._updateTracksDebounced = Runtime.debounce(this.#updateTracks.bind(this), 50);\n\n\t\tthis._waitTurnCandidatesTimeout = null;\n\n\t\tthis.prevPercentPacketLostList = {\n\t\t\tincomingPacketLost: [],\n\t\t\toutgoingPacketLost: [],\n\t\t};\n\t\tthis.reportsForIncomingTracks = {};\n\t\tthis.reportsForOutgoingTracks = {};\n\t\tthis.packetLostThreshold = 7;\n\t\tthis.videoBitrate = 1000000;\n\t\tthis.screenShareBitrate = 1500000;\n\t\tthis.maxConnectionScore = 5;\n\t\tthis.incomingConnectionScore = 0;\n\t\tthis.outgoingConnectionScore = 0;\n\t};\n\n\t_mediaGetter(trackVariable)\n\t{\n\t\treturn function ()\n\t\t{\n\t\t\treturn this[trackVariable]\n\t\t}.bind(this)\n\t};\n\n\t_mediaSetter(trackVariable, kind)\n\t{\n\t\treturn function (track)\n\t\t{\n\t\t\tif (this[trackVariable] != track)\n\t\t\t{\n\t\t\t\tthis[trackVariable] = track;\n\t\t\t\tif (track)\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaReceived({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind,\n\t\t\t\t\t\ttrack: track\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onMediaStopped({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tkind: kind\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this)\n\t};\n\n\tsendMedia(skipOffer)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tif (!this.isInitiator())\n\t\t\t{\n\t\t\t\tthis.log('waiting for the other side to send connection offer');\n\t\t\t\tthis.sendNegotiationNeeded(false);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\tconst connectionId = Util.getUuidv4();\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\t\tthis.updateOutgoingTracks();\n\n\t\tif (!skipOffer)\n\t\t{\n\t\t\tthis.applyResolutionScale();\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t};\n\n\tupdateOutgoingTracks()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet audioTrack;\n\t\tlet videoTrack;\n\t\tlet screenTrack;\n\t\tlet screenAudioTrack;\n\n\t\tif (this.call.localStreams[\"main\"] && this.call.localStreams[\"main\"].getAudioTracks().length > 0 && this.call.localStreams[\"main\"].getAudioTracks()[0]?.readyState === 'live')\n\t\t{\n\t\t\taudioTrack = this.call.localStreams[\"main\"].getAudioTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"screen\"] && this.call.localStreams[\"screen\"].getVideoTracks().length > 0)\n\t\t{\n\t\t\tscreenTrack = this.call.localStreams[\"screen\"].getVideoTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"screen\"] && this.call.localStreams[\"screen\"].getAudioTracks().length > 0)\n\t\t{\n\t\t\tscreenAudioTrack = this.call.localStreams[\"screen\"].getAudioTracks()[0];\n\t\t}\n\t\tif (this.call.localStreams[\"main\"] && this.call.localStreams[\"main\"].getVideoTracks().length > 0 && this.call.localStreams[\"main\"].getVideoTracks()[0]?.readyState === 'live')\n\t\t{\n\t\t\tvideoTrack = this.call.localStreams[\"main\"].getVideoTracks()[0];\n\t\t}\n\n\t\tthis.outgoingVideoTrack = videoTrack ? videoTrack.clone() : null;\n\t\tthis.outgoingScreenTrack = screenTrack ? screenTrack.clone() : null;\n\n\t\tlet tracksToSend = [];\n\t\tif (audioTrack)\n\t\t{\n\t\t\ttracksToSend.push(audioTrack.id + ' (audio)');\n\t\t}\n\t\tif (screenAudioTrack)\n\t\t{\n\t\t\ttracksToSend.push(screenAudioTrack.id + ' (sharingAudio)');\n\t\t}\n\t\tif (videoTrack)\n\t\t{\n\t\t\ttracksToSend.push(videoTrack.id + ' (' + videoTrack.kind + ')');\n\t\t}\n\t\tif (screenTrack)\n\t\t{\n\t\t\ttracksToSend.push(screenTrack.id + ' (' + screenTrack.kind + ')');\n\t\t}\n\n\t\tconsole.log(\"User: \" + this.userId + '; Sending media streams. Tracks: ' + tracksToSend.join('; '));\n\n\t\t// if video sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.videoSender.replaceTrack(this.outgoingVideoTrack);\n\t\t}\n\t\tif (!this.videoSender && this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.videoSender = this.peerConnection.addTrack(this.outgoingVideoTrack);\n\t\t}\n\t\tif (this.videoSender && !this.outgoingVideoTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.videoSender);\n\t\t\tthis.videoSender = null;\n\t\t}\n\n\t\t// if screen sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.screenSender.replaceTrack(this.outgoingScreenTrack);\n\t\t}\n\t\tif (!this.screenSender && this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.screenSender = this.peerConnection.addTrack(this.outgoingScreenTrack);\n\t\t}\n\t\tif (this.screenSender && !this.outgoingScreenTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.screenSender);\n\t\t\tthis.screenSender = null;\n\t\t}\n\n\t\t// if screen sender audio found - replace track\n\t\t// if not found - add track\n\t\tif (this.screenAudioSender && screenAudioTrack)\n\t\t{\n\t\t\tthis.screenAudioSender.replaceTrack(screenAudioTrack);\n\t\t}\n\t\tif (!this.screenAudioSender && screenAudioTrack)\n\t\t{\n\t\t\tthis.screenAudioSender = this.peerConnection.addTrack(screenAudioTrack);\n\t\t}\n\t\tif (this.screenAudioSender && !screenAudioTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.screenAudioSender);\n\t\t\tthis.screenAudioSender = null;\n\t\t}\n\n\t\t// if audio sender found - replace track\n\t\t// if not found - add track\n\t\tif (this.audioSender && audioTrack)\n\t\t{\n\t\t\tthis.audioSender.replaceTrack(audioTrack);\n\t\t}\n\t\tif (!this.audioSender && audioTrack)\n\t\t{\n\t\t\tthis.audioSender = this.peerConnection.addTrack(audioTrack);\n\t\t}\n\t\tif (this.audioSender && !audioTrack)\n\t\t{\n\t\t\tthis.peerConnection.removeTrack(this.audioSender);\n\t\t\tthis.audioSender = null;\n\t\t}\n\t};\n\n\tgetSenderMid(rtpSender: RTCRtpSender): string\n\t{\n\t\tif (!rtpSender || !this.peerConnection)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tconst transceiver = this.peerConnection.getTransceivers().find(transceiver => {\n\t\t\tif (transceiver.sender.track && rtpSender.track)\n\t\t\t{\n\t\t\t\treturn transceiver.sender.track.id === rtpSender.track.id\n\t\t\t}\n\t\t\treturn false\n\t\t});\n\n\t\treturn transceiver ? transceiver.mid : null;\n\t};\n\n\tapplyResolutionScale(factor)\n\t{\n\t\tif (this.videoSender)\n\t\t{\n\t\t\tconst scaleFactor = factor || (this.screenSender ? 2 : 1);\n\t\t\tconst rate = this.videoBitrate / scaleFactor;\n\t\t\tconst videoParams = this.videoSender.getParameters();\n\n\t\t\tif (videoParams.encodings && videoParams.encodings.length > 0)\n\t\t\t{\n\t\t\t\tvideoParams.encodings[0].scaleResolutionDownBy = scaleFactor;\n\t\t\t\tvideoParams.encodings[0].maxBitrate = rate;\n\t\t\t\tthis.videoSender.setParameters(videoParams);\n\t\t\t}\n\t\t}\n\n\t\tif (this.screenSender)\n\t\t{\n\t\t\tconst screenParams = this.screenSender.getParameters();\n\t\t\tif (screenParams.encodings && screenParams.encodings.length > 0)\n\t\t\t{\n\t\t\t\tscreenParams.encodings[0].maxBitrate = this.screenShareBitrate;\n\t\t\t\tthis.screenSender.setParameters(screenParams);\n\t\t\t}\n\t\t}\n\t};\n\n\treplaceMediaStream(tag: string)\n\t{\n\t\tif (this.isRenegotiationSupported())\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.localStreams[tag] = this.call.getLocalStream(tag);\n\n\t\t\tconst logMessage = 'Reconnect by replaceMediaStream';\n\t\t\tthis.reconnect({ reconnectionReasonInfo: logMessage });\n\t\t}\n\t};\n\n\tholdOutgoingVideo(holdState)\n\t{\n\t\tif (this.outgoingVideoHoldState == holdState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.outgoingVideoHoldState = holdState;\n\t\tif (this._outgoingVideoTrack)\n\t\t{\n\t\t\tthis._outgoingVideoTrack.enabled = !this.outgoingVideoHoldState;\n\t\t}\n\t};\n\n\tisInitiator()\n\t{\n\t\treturn this.call.userId < this.userId;\n\t};\n\n\tisRenegotiationSupported()\n\t{\n\t\treturn true;\n\t\t// return (Browser.isChrome() && this.isChrome);\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tthis.ready = ready;\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisReady()\n\t{\n\t\treturn this.ready;\n\t};\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(function ()\n\t\t{\n\t\t\tthis.onInviteTimeout(true);\n\t\t}.bind(this), 30000);\n\t\tthis.updateCalculatedState();\n\t};\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetUserAgent(userAgent)\n\t{\n\t\tthis.userAgent = userAgent;\n\t\tthis.isFirefox = userAgent.toLowerCase().indexOf('firefox') != -1;\n\t\tthis.isChrome = userAgent.toLowerCase().indexOf('chrome') != -1;\n\t\tthis.isLegacyMobile = userAgent === 'Bitrix Legacy Mobile';\n\t};\n\n\tgetUserAgent()\n\t{\n\t\treturn this.userAgent;\n\t};\n\n\tisParticipating()\n\t{\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.declined || this.busy)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\t// todo: maybe we should check iceConnectionState as well.\n\t\t\tconst iceConnectionState = this.peerConnection.iceConnectionState;\n\t\t\tif (iceConnectionState == 'checking' || iceConnectionState == 'connected' || iceConnectionState == 'completed')\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tsetSignalingConnected(signalingConnected)\n\t{\n\t\tthis.signalingConnected = signalingConnected;\n\t\tthis.updateCalculatedState();\n\n\t\tif (this.signalingConnected)\n\t\t{\n\t\t\tthis.refreshSignalingTimeout();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.stopSignalingTimeout();\n\t\t}\n\t};\n\n\tisSignalingConnected()\n\t{\n\t\treturn this.signalingConnected;\n\t};\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t};\n\n\tisDeclined()\n\t{\n\t\treturn this.declined;\n\t};\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState != calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tisLegacyMobile: this.isLegacyMobile,\n\t\t\t\tnetworkProblem: !this.hasStun || !this.hasTurn\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t};\n\n\tcalculateState()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.failureReason !== '')\n\t\t\t{\n\t\t\t\treturn UserState.Failed;\n\t\t\t}\n\n\t\t\tif (this.peerConnection.iceConnectionState === 'connected' || this.peerConnection.iceConnectionState === 'completed')\n\t\t\t{\n\t\t\t\treturn UserState.Connected;\n\t\t\t}\n\n\t\t\treturn UserState.Connecting;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t};\n\n\tgetSignaling()\n\t{\n\t\treturn this.call.signaling;\n\t};\n\n\tstartStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\n\t\tthis.statsInterval = setInterval(function ()\n\t\t{\n\t\t\tif (!this.peerConnection)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.peerConnection.getStats().then(function (stats)\n\t\t\t{\n\t\t\t\t// stats gathering in new format like in the Bitrix24 calls\n\t\t\t\tconst statsOutput = [];\n\t\t\t\tconst codecs = {};\n\t\t\t\tconst reportsWithoutCodecs = {};\n\t\t\t\tconst remoteReports = {};\n\t\t\t\tconst reportsWithoutRemoteInfo = {};\n\t\t\t\tlet incomingDataLoss = 0;\n\t\t\t\tlet outgoingDataLoss = 0;\n\n\t\t\t\tstats.forEach((report) => {\n\t\t\t\t\tstatsOutput.push(report);\n\n\t\t\t\t\tconst needCheckInputPacketLost = (report?.trackIdentifier\n\t\t\t\t\t\t&& report?.type === 'inbound-rtp'\n\t\t\t\t\t\t&& report.hasOwnProperty('packetsLost')\n\t\t\t\t\t\t&& report.hasOwnProperty('packetsReceived'));\n\n\t\t\t\t\tif (needCheckInputPacketLost || report.type === 'outbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\tswitch (this.trackList[report.mid])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcase 'video':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Camera;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'screen':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Screen;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 'audio':\n\t\t\t\t\t\t\t\treport.source = MediaStreamsKinds.Microphone;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\treport.type === 'candidate-pair'\n\t\t\t\t\t\t&& report.state === 'succeeded'\n\t\t\t\t\t\t&& report.bytesReceived > 0\n\t\t\t\t\t\t&& report.bytesSent > 0\n\t\t\t\t\t\t&& this.lastSuccessedLocaleCandidateId !== report.localCandidateId\n\t\t\t\t\t\t&& this.lastSuccessedRemoteCandidateId !== report.remoteCandidateId\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.lastSuccessedLocaleCandidateId = report.localCandidateId;\n\t\t\t\t\t\tthis.lastSuccessedRemoteCandidateId = report.remoteCandidateId;\n\n\t\t\t\t\t\tUtil.sendLog({\n\t\t\t\t\t\t\tdescription: `GOT a succeeded candidate-pair for user ${this.userId}`,\n\t\t\t\t\t\t\tlocalCandidateId: report.localCandidateId,\n\t\t\t\t\t\t\tremoteCandidateId: report.remoteCandidateId,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (needCheckInputPacketLost)\n\t\t\t\t\t{\n\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.reportsForIncomingTracks[report.source]);\n\t\t\t\t\t\tconst packetsLostData = Util.calcRemotePacketsLost(report, this.reportsForIncomingTracks[report.source]);\n\t\t\t\t\t\treport.packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.reportsForIncomingTracks[report.source] = report;\n\n\t\t\t\t\t\tif (report.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tincomingDataLoss = packetsLostData.currentPercentPacketLost;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'codec')\n\t\t\t\t\t{\n\t\t\t\t\t\tUtil.processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'remote-inbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\tconst reportId = report.localId;\n\t\t\t\t\t\tif (reportsWithoutRemoteInfo[reportId])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst packetsLostData = Util.calcLocalPacketsLost(reportsWithoutRemoteInfo[reportId], this.reportsForOutgoingTracks[reportId], report);\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostData = packetsLostData;\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLost = packetsLostData.totalPacketsLost;\n\t\t\t\t\t\t\treportsWithoutRemoteInfo[reportId].packetsLostExtended = Util.formatPacketsLostData(packetsLostData);\n\t\t\t\t\t\t\tthis.reportsForOutgoingTracks[reportId] = reportsWithoutRemoteInfo[reportId];\n\t\t\t\t\t\t\tdelete reportsWithoutRemoteInfo[reportId];\n\n\t\t\t\t\t\t\tif (this.reportsForOutgoingTracks[reportId].source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\toutgoingDataLoss = report.packetsLost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tremoteReports[reportId] = report;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (report.type === 'outbound-rtp')\n\t\t\t\t\t{\n\t\t\t\t\t\treport.bitrate = Util.calcBitrate(report, this.reportsForOutgoingTracks[report.id], true);\n\t\t\t\t\t\treport.userId = this.call.userId;\n\n\t\t\t\t\t\tif (!Util.setCodecToReport(report, codecs, reportsWithoutCodecs))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tUtil.saveReportWithoutCodecs(report, reportsWithoutCodecs);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (Util.setLocalPacketsLostOrSaveReport(report, remoteReports, reportsWithoutRemoteInfo))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.reportsForOutgoingTracks[report.id] = report;\n\t\t\t\t\t\t\tif (report.source === MediaStreamsKinds.Camera)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\toutgoingDataLoss = report.packetsLostData.currentPercentPacketLost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (this.prevPercentPacketLostList.incomingPacketLost.push(incomingDataLoss) > 10)\n\t\t\t\t{\n\t\t\t\t\tthis.prevPercentPacketLostList.incomingPacketLost.shift();\n\t\t\t\t}\n\n\t\t\t\tconst newIncomingConnectionDataLoss = this.prevPercentPacketLostList.incomingPacketLost.reduce(\n\t\t\t\t\t(acc, number) => acc + number, 0\n\t\t\t\t) / this.prevPercentPacketLostList.incomingPacketLost.length;\n\t\t\t\tconst newIncomingConnectionScore = this.calcNewConnectionScore(newIncomingConnectionDataLoss);\n\t\t\t\tif (!this.incomingConnectionScore || this.incomingConnectionScore !== newIncomingConnectionScore)\n\t\t\t\t{\n\t\t\t\t\tthis.incomingConnectionScore = newIncomingConnectionScore;\n\t\t\t\t\tthis.callbacks.onRTCQualityChanged({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tscore: this.incomingConnectionScore\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this.prevPercentPacketLostList.outgoingPacketLost.push(outgoingDataLoss) > 10)\n\t\t\t\t{\n\t\t\t\t\tthis.prevPercentPacketLostList.outgoingPacketLost.shift();\n\t\t\t\t}\n\n\t\t\t\tconst newOutgoingConnectionDataLoss = this.prevPercentPacketLostList.outgoingPacketLost.reduce(\n\t\t\t\t\t(acc, number) => acc + number, 0\n\t\t\t\t) / this.prevPercentPacketLostList.outgoingPacketLost.length;\n\t\t\t\tconst newOutgoingConnectionScore = this.calcNewConnectionScore(newOutgoingConnectionDataLoss);\n\t\t\t\tif (!this.outgoingConnectionScore || this.outgoingConnectionScore !== newOutgoingConnectionScore)\n\t\t\t\t{\n\t\t\t\t\tthis.outgoingConnectionScore = newOutgoingConnectionScore;\n\t\t\t\t\tthis.callbacks.onRTCQualityChanged({\n\t\t\t\t\t\tuserId: this.call.userId,\n\t\t\t\t\t\tscore: this.outgoingConnectionScore\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tthis.callbacks.onRTCStatsReceived({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tstats: statsOutput\n\t\t\t\t});\n\t\t\t}.bind(this));\n\t\t}.bind(this), 1000);\n\t};\n\n\tcalcNewConnectionScore(dataLoss)\n\t{\n\t\tlet connectionQuality;\n\t\tif (dataLoss < 10)\n\t\t{\n\t\t\tconnectionQuality = 4;\n\t\t}\n\n\t\tif (dataLoss > 10 && dataLoss <= 20)\n\t\t{\n\t\t\tconnectionQuality = 3;\n\t\t}\n\n\t\tif (dataLoss > 20 && dataLoss <= 30)\n\t\t{\n\t\t\tconnectionQuality = 2;\n\t\t}\n\n\t\tif (dataLoss > 30)\n\t\t{\n\t\t\tconnectionQuality = 1;\n\t\t}\n\n\t\treturn connectionQuality;\n\t}\n\n\tstopStatisticsGathering()\n\t{\n\t\tclearInterval(this.statsInterval);\n\t\tthis.statsInterval = null;\n\t};\n\n\tupdateCandidatesTimeout()\n\t{\n\t\tif (this.candidatesTimeout)\n\t\t{\n\t\t\tclearTimeout(this.candidatesTimeout);\n\t\t}\n\n\t\tthis.candidatesTimeout = setTimeout(this.sendIceCandidates.bind(this), 500);\n\t};\n\n\tsendIceCandidates()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": sending ICE candidates due to the timeout\");\n\n\t\tthis.candidatesTimeout = null;\n\t\tif (this.localIceCandidates.length > 0)\n\t\t{\n\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t});\n\t\t\tthis.localIceCandidates = [];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates pool is empty\");\n\t\t}\n\t};\n\n\t#createPeerConnection(id)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": Creating peer connection\");\n\t\tconst connectionConfig = {\n\t\t\t\"iceServers\": [\n\t\t\t\t{\n\t\t\t\t\turls: \"stun:\" + this.call.turnServer\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\turls: \"turn:\" + this.call.turnServer,\n\t\t\t\t\tusername: this.call.turnServerLogin,\n\t\t\t\t\tcredential: this.call.turnServerPassword\n\t\t\t\t}\n\t\t\t],\n\t\t\t// iceTransportPolicy: 'relay'\n\t\t};\n\n\t\tthis.localIceCandidates = [];\n\t\tthis.peerConnection = new RTCPeerConnection(connectionConfig);\n\t\tthis.peerConnectionId = id;\n\n\t\tthis.peerConnection.addEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.addEventListener(\"connectionstatechange\", this._onPeerConnectionConnectionStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.addEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.addEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.addEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.addEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.failureReason = '';\n\t\tthis.hasStun = false;\n\t\tthis.hasTurn = false;\n\t\tthis.updateCalculatedState();\n\n\t\tthis.startStatisticsGathering();\n\t};\n\n\t_destroyPeerConnection()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\n\t\tthis.log(\"User \" + this.userId + \": Destroying peer connection \" + this.peerConnectionId);\n\t\tthis.stopStatisticsGathering();\n\n\t\tthis.peerConnection.removeEventListener(\"icecandidate\", this._onPeerConnectionIceCandidateHandler);\n\t\tthis.peerConnection.removeEventListener(\"connectionstatechange\", this._onPeerConnectionConnectionStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"icegatheringstatechange\", this._onPeerConnectionIceGatheringStateChangeHandler);\n\t\tthis.peerConnection.removeEventListener(\"signalingstatechange\", this._onPeerConnectionSignalingStateChangeHandler);\n\t\t// this.peerConnection.removeEventListener(\"negotiationneeded\", this._onPeerConnectionNegotiationNeededHandler);\n\t\tthis.peerConnection.removeEventListener(\"track\", this._onPeerConnectionTrackHandler);\n\t\tthis.peerConnection.removeEventListener(\"removestream\", this._onPeerConnectionRemoveStreamHandler);\n\n\t\tthis.localIceCandidates = [];\n\t\tif (this.pendingIceCandidates[this.peerConnectionId])\n\t\t{\n\t\t\tdelete this.pendingIceCandidates[this.peerConnectionId];\n\t\t}\n\n\t\tthis.peerConnection.close();\n\t\tthis.peerConnection = null;\n\t\tthis.peerConnectionId = null;\n\t\tthis.videoSender = null;\n\t\tthis.audioSender = null;\n\t\tthis.screenSender = null;\n\t\tthis.screenAudioSender = null;\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingScreenAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\t};\n\n\t_onPeerConnectionIceCandidate(e)\n\t{\n\t\tconst candidate = e.candidate;\n\t\tthis.log(\"User \" + this.userId + \": ICE candidate discovered. Candidate: \" + (candidate ? candidate.candidate : candidate));\n\n\t\tif (candidate)\n\t\t{\n\t\t\tif (this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tcandidates: [candidate.toJSON()]\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.localIceCandidates.push(candidate.toJSON());\n\t\t\t\tthis.updateCandidatesTimeout();\n\t\t\t}\n\n\t\t\tconst match = candidate.candidate.match(/typ\\s(\\w+)?/);\n\t\t\tif (match)\n\t\t\t{\n\t\t\t\tconst type = match[1];\n\t\t\t\tif (type == \"srflx\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasStun = true;\n\t\t\t\t}\n\t\t\t\telse if (type == \"relay\")\n\t\t\t\t{\n\t\t\t\t\tthis.hasTurn = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionConnectionStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \": peer connection state changed. New state: \" + this.peerConnection.connectionState);\n\n\t\tif (this.peerConnection.connectionState === \"connected\" || this.peerConnection.connectionState === \"completed\")\n\t\t{\n\t\t\tthis.connectionAttempt = 0;\n\t\t\tthis.callbacks.onReconnected();\n\t\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t\telse if (this.peerConnection.connectionState === \"failed\")\n\t\t{\n\t\t\tconst logMessage = 'Peer connection failed. Trying to restore connection immediately';\n\n\t\t\tthis.reconnect({\n\t\t\t\treconnectionReason: 'PEER_CONNECTION_FAILED',\n\t\t\t\treconnectionReasonInfo: logMessage,\n\t\t\t});\n\t\t}\n\t\t// else if (this.peerConnection.connectionState === \"disconnected\")\n\t\t// {\n\t\t// \t// we can ignore a 'disconnected' state because it can provoke frequent reconnects,\n\t\t// \t// besides that, iceConnectionState can can be changed back to 'connected' state by itself\n\t\t// \tthis.log(\"peer connection lost. Waiting 5 seconds before trying to restore it\");\n\t\t// \tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\t\t// \tthis.reconnectAfterDisconnectTimeout = setTimeout(() => this.reconnect(), 5000);\n\t\t// }\n\n\t\tthis.updateCalculatedState();\n\t};\n\n\t#onPeerConnectionIceGatheringStateChange(e)\n\t{\n\t\tconst connection = e.target;\n\t\tthis.log(\"User \" + this.userId + \": ICE gathering state changed to : \" + connection.iceGatheringState);\n\n\t\tif (connection.iceGatheringState === 'complete')\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": ICE gathering complete\");\n\t\t\tif (!this.hasStun || !this.hasTurn)\n\t\t\t{\n\t\t\t\tconst s = [];\n\t\t\t\tif (!this.hasTurn)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"TURN\");\n\t\t\t\t}\n\t\t\t\tif (!this.hasStun)\n\t\t\t\t{\n\t\t\t\t\ts.push(\"STUN\");\n\t\t\t\t}\n\t\t\t\tthis.log(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tconsole.error(\"Connectivity problem detected: no ICE candidates from \" + s.join(\" and \") + \" servers\");\n\t\t\t\tthis.callbacks.onNetworkProblem();\n\t\t\t}\n\n\t\t\tif (!this.getSignaling().isIceTricklingAllowed())\n\t\t\t{\n\t\t\t\tif (this.localIceCandidates.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.getSignaling().sendIceCandidate({\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\t\tcandidates: this.localIceCandidates\n\t\t\t\t\t});\n\t\t\t\t\tthis.localIceCandidates = [];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User \" + this.userId + \": ICE candidates already sent\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionSignalingStateChange()\n\t{\n\t\tthis.log(\"User \" + this.userId + \" PC signalingState: \" + this.peerConnection.signalingState);\n\t\tif (this.peerConnection.signalingState === \"stable\")\n\t\t{\n\t\t\tthis._updateTracksDebounced();\n\t\t}\n\t};\n\n\t// this event is unusable in the current version of desktop (cef 64) and leads to signaling cycling\n\t// todo: reconsider using it after new version is released\n\t#onPeerConnectionNegotiationNeeded(e)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": needed negotiation for peer connection\");\n\t\tthis.log(\"signaling state: \", e.target.signalingState);\n\t\tthis.log(\"ice connection state: \", e.target.iceConnectionState);\n\t\tthis.log(\"pendingRemoteDescription: \", e.target.pendingRemoteDescription);\n\n\t\tif (e.target.iceConnectionState !== \"new\" && e.target.iceConnectionState !== \"connected\" && e.target.iceConnectionState !== \"completed\")\n\t\t{\n\t\t\tthis.log(\"User \" + this.userId + \": wrong connection state\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis.createAndSendOffer();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendNegotiationNeeded(this.peerConnection._forceReconnect === true);\n\t\t}\n\t};\n\n\t#onPeerConnectionTrack(e)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": media track received: \", e.track.id + \" (\" + e.track.kind + \")\");\n\n\t\tif (e.track.kind === \"video\")\n\t\t{\n\t\t\te.track.addEventListener(\"mute\", this.#onVideoTrackMuted.bind(this));\n\t\t\te.track.addEventListener(\"unmute\", this.#onVideoTrackUnMuted.bind(this));\n\t\t\te.track.addEventListener(\"ended\", this.#onVideoTrackEnded.bind(this));\n\t\t\tif (this.trackList[e.track.id] === 'screen')\n\t\t\t{\n\t\t\t\tthis.incomingScreenTrack = e.track;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.incomingVideoTrack = e.track\n\t\t\t}\n\t\t}\n\t\telse if (e.track.kind === 'audio')\n\t\t{\n\t\t\t// this.incomingAudioTrack = e.track;\n\t\t\tif (this.trackList[e.track.id] === 'screenAudio')\n\t\t\t{\n\t\t\t\tthis.incomingScreenAudioTrack = e.track;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.incomingAudioTrack = e.track;\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerConnectionRemoveStream(e)\n\t{\n\t\tthis.log(\"User: \" + this.userId + \"_onPeerConnectionRemoveStream: \", e);\n\t};\n\n\t#onVideoTrackMuted()\n\t{\n\t\tconsole.log(\"Video track muted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackUnMuted()\n\t{\n\t\tconsole.log(\"Video track unmuted\");\n\t\t//this._updateTracksDebounced();\n\t};\n\n\t#onVideoTrackEnded()\n\t{\n\t\tconsole.log(\"Video track ended\");\n\t};\n\n\t#updateTracks()\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\t\tlet audioTrack = null;\n\t\tlet videoTrack = null;\n\t\tlet screenTrack = null;\n\t\tlet screenAudioTrack = null;\n\t\tthis.peerConnection.getTransceivers().forEach((tr) =>\n\t\t{\n\t\t\tthis.call.log(\"[debug] tr direction: \" + tr.direction + \" currentDirection: \" + tr.currentDirection);\n\t\t\tif (tr.currentDirection === \"sendrecv\" || tr.currentDirection === \"recvonly\")\n\t\t\t{\n\t\t\t\tif (tr.receiver && tr.receiver.track)\n\t\t\t\t{\n\t\t\t\t\tconst track = tr.receiver.track;\n\t\t\t\t\tif (track.kind === 'audio')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.trackList[tr.mid] === 'sharingAudio')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscreenAudioTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taudioTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (track.kind === 'video')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.trackList[tr.mid] === 'screen')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tscreenTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvideoTrack = track;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.incomingAudioTrack = audioTrack;\n\t\tthis.incomingVideoTrack = videoTrack;\n\t\tthis.incomingScreenTrack = screenTrack;\n\t\tthis.incomingScreenAudioTrack = screenAudioTrack;\n\t};\n\n\tstopSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t};\n\n\trefreshSignalingTimeout()\n\t{\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = setTimeout(this.#onLostSignalingConnection.bind(this), signalingConnectionRefreshPeriod);\n\t};\n\n\t#onLostSignalingConnection()\n\t{\n\t\tthis.setSignalingConnected(false);\n\t};\n\n\t_onConnectionOfferReplyTimeout(connectionId)\n\t{\n\t\tconst logMessage = 'Did not receive connection answer for connection ' + connectionId;\n\n\t\tthis.call.setPublishingState(MediaStreamsKinds.Camera, false);\n\n\t\tthis.reconnect({ reconnectionReasonInfo: logMessage });\n\t};\n\n\t_onNegotiationNeededReplyTimeout()\n\t{\n\t\tconst logMessage = 'Did not receive connection offer in time';\n\n\t\tthis.reconnect({ reconnectionReasonInfo: logMessage });\n\t};\n\n\tsetConnectionOffer(connectionId, sdp, trackList)\n\t{\n\t\tthis.log(\"User \" + this.userId + \": applying connection offer for connection \" + connectionId);\n\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = null;\n\n\t\tif (!this.call.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isReady())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnectionId !== connectionId)\n\t\t\t{\n\t\t\t\tthis._destroyPeerConnection();\n\t\t\t\tthis.#createPeerConnection(connectionId);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#createPeerConnection(connectionId);\n\t\t}\n\n\t\tthis.applyOfferAndSendAnswer(sdp);\n\t};\n\n\tcreateAndSendOffer(config)\n\t{\n\t\tlet connectionConfig = defaultConnectionOptions;\n\t\tfor (let key in config)\n\t\t{\n\t\t\tconnectionConfig[key] = config[key];\n\t\t}\n\n\t\tthis.peerConnection.createOffer(connectionConfig)\n\t\t\t.then((offer) =>\n\t\t\t{\n\t\t\t\tthis.log(\"User \" + this.userId + \": Created connection offer.\");\n\t\t\t\tthis.log(\"Applying local description\");\n\t\t\t\treturn this.peerConnection.setLocalDescription(offer);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t})\n\t\t;\n\t};\n\n\tsendOffer()\n\t{\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\t\tthis.connectionOfferReplyTimeout = setTimeout(\n\t\t\t() => this._onConnectionOfferReplyTimeout(this.peerConnectionId),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tthis.getSignaling().sendConnectionOffer({\n\t\t\tuserId: this.userId,\n\t\t\tconnectionId: this.peerConnectionId,\n\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\ttracks: {\n\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t\tsharingAudio: this.getSenderMid(this.screenAudioSender),\n\t\t\t},\n\t\t\tuserAgent: navigator.userAgent\n\t\t})\n\t};\n\n\tsendNegotiationNeeded(restart: boolean)\n\t{\n\t\trestart = restart === true;\n\t\tclearTimeout(this.negotiationNeededReplyTimeout);\n\t\tthis.negotiationNeededReplyTimeout = setTimeout(\n\t\t\t() => this._onNegotiationNeededReplyTimeout(),\n\t\t\tsignalingWaitReplyPeriod\n\t\t);\n\n\t\tconst params = {\n\t\t\tuserId: this.userId\n\t\t};\n\t\tif (restart)\n\t\t{\n\t\t\tparams.restart = true;\n\t\t}\n\n\t\tthis.getSignaling().sendNegotiationNeeded(params);\n\t};\n\n\tapplyOfferAndSendAnswer(sdp)\n\t{\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\ttype: \"offer\",\n\t\t\tsdp: sdp\n\t\t});\n\n\t\tif (this.pendingRemoteSdpDelay)\n\t\t{\n\t\t\tthis.pendingRemoteSdp = sdp;\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"User: \" + this.userId + \"; Applying remote offer\");\n\t\tthis.log(\"User: \" + this.userId + \"; Peer ice connection state \", this.peerConnection.iceConnectionState);\n\n\t\tthis.pendingRemoteSdpDelay = true;\n\n\t\tthis.peerConnection\n\t\t\t.setRemoteDescription(sessionDescription)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tif (this.peerConnection.iceConnectionState === 'new')\n\t\t\t\t{\n\t\t\t\t\tthis.sendMedia(true);\n\t\t\t\t}\n\n\t\t\t\treturn this.peerConnection.createAnswer();\n\t\t\t})\n\t\t\t.then((answer) =>\n\t\t\t{\n\t\t\t\tthis.log(\"Created connection answer.\");\n\t\t\t\tthis.log(\"Applying local description.\");\n\n\t\t\t\treturn this.peerConnection.setLocalDescription(answer);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.applyResolutionScale();\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t\tthis.getSignaling().sendConnectionAnswer({\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tconnectionId: this.peerConnectionId,\n\t\t\t\t\tsdp: this.peerConnection.localDescription.sdp,\n\t\t\t\t\ttracks: {\n\t\t\t\t\t\taudio: this.getSenderMid(this.audioSender),\n\t\t\t\t\t\tvideo: this.getSenderMid(this.videoSender),\n\t\t\t\t\t\tscreen: this.getSenderMid(this.screenSender),\n\t\t\t\t\t\tsharingAudio: this.getSenderMid(this.screenAudioSender),\n\t\t\t\t\t},\n\t\t\t\t\tuserAgent: navigator.userAgent\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.failureReason = e.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log(\"Could not apply remote offer\", e);\n\t\t\t\tconsole.error(\"Could not apply remote offer\", e);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.pendingRemoteSdpDelay = false;\n\t\t\t\tif (this.pendingRemoteSdp)\n\t\t\t\t{\n\t\t\t\t\tthis.applyOfferAndSendAnswer(this.pendingRemoteSdp);\n\t\t\t\t\tthis.pendingRemoteSdp = null;\n\t\t\t\t}\n\n\t\t\t\tconst activeTransceivers = this.peerConnection?.getTransceivers()\n\t\t\t\t\t.reduce((sum, transceiver) => {\n\t\t\t\t\t\treturn transceiver.mid === null ? sum : sum + 1;\n\t\t\t\t\t}, 0);\n\n\t\t\t\tlet activeTracks = 0;\n\t\t\t\tObject.values(this.call.localStreams).forEach((stream) => {\n\t\t\t\t\tstream?.getTracks().forEach((track) => {\n\t\t\t\t\t\tif (track.readyState === 'live')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tactiveTracks++;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tif (activeTransceivers < activeTracks)\n\t\t\t\t{\n\t\t\t\t\tObject.values(this.call.peers).forEach((peer) => {\n\t\t\t\t\t\tpeer.sendMedia();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t}\n\n\tsetConnectionAnswer(connectionId, sdp, trackList)\n\t{\n\t\tif (!this.peerConnection || this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.signalingState !== 'have-local-offer')\n\t\t{\n\t\t\tthis.log(\"Could not apply answer, wrong peer connection signaling state \" + this.peerConnection.signalingState);\n\t\t\treturn;\n\t\t}\n\n\t\tif (trackList)\n\t\t{\n\t\t\tthis.trackList = BX.util.array_flip(trackList);\n\t\t}\n\n\t\tconst sessionDescription = new RTCSessionDescription({\n\t\t\ttype: \"answer\",\n\t\t\tsdp: sdp\n\t\t});\n\n\t\tclearTimeout(this.connectionOfferReplyTimeout);\n\n\t\tthis.log(\"User: \" + this.userId + \"; Applying remote answer\");\n\t\tthis.peerConnection\n\t\t\t.setRemoteDescription(sessionDescription)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.applyPendingIceCandidates();\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.failureReason = e.toString();\n\t\t\t\tthis.updateCalculatedState();\n\t\t\t\tthis.log(e);\n\t\t\t})\n\t\t\t.finally(() =>\n\t\t\t{\n\t\t\t\tthis.call.setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t})\n\t\t;\n\t};\n\n\taddIceCandidate(connectionId, candidate)\n\t{\n\t\tif (!this.peerConnection)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnectionId != connectionId)\n\t\t{\n\t\t\tthis.log(\"Error: Candidate for unknown connection \" + connectionId);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.peerConnection.remoteDescription && this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\tthis.peerConnection\n\t\t\t\t.addIceCandidate(candidate)\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!this.pendingIceCandidates[connectionId])\n\t\t\t{\n\t\t\t\tthis.pendingIceCandidates[connectionId] = [];\n\t\t\t}\n\t\t\tthis.pendingIceCandidates[connectionId].push(candidate);\n\t\t}\n\t};\n\n\tapplyPendingIceCandidates()\n\t{\n\t\tif (!this.peerConnection || !this.peerConnection.remoteDescription.type)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isArray(this.pendingIceCandidates[this.peerConnectionId]))\n\t\t{\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId].forEach((candidate) =>\n\t\t\t{\n\t\t\t\tthis.peerConnection.addIceCandidate(candidate).then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"User: \" + this.userId + \"; Added remote ICE candidate: \" + (candidate ? candidate.candidate : candidate));\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.pendingIceCandidates[this.peerConnectionId] = [];\n\t\t}\n\t};\n\n\tonNegotiationNeeded()\n\t{\n\t\tif (this.peerConnection)\n\t\t{\n\t\t\tif (this.peerConnection.signalingState == \"have-local-offer\")\n\t\t\t{\n\t\t\t\tthis.sendOffer();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.createAndSendOffer({iceRestart: true});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.sendMedia();\n\t\t}\n\t};\n\n\treconnect(reconnectInfoObject)\n\t{\n\t\tclearTimeout(this.reconnectAfterDisconnectTimeout);\n\n\t\tthis.connectionAttempt++;\n\n\n\t\tif (this.connectionAttempt > 3)\n\t\t{\n\t\t\tthis.log(\"Error: Too many reconnection attempts, giving up\");\n\t\t\tthis.failureReason = \"Could not connect to user in time\";\n\t\t\tthis.updateCalculatedState();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callbacks.onReconnecting({\n\t\t\treconnectionReason: reconnectInfoObject?.reconnectionReason || 'TRYING_RESTORE_ICE_CONNECTION',\n\t\t\treconnectionReasonInfo: reconnectInfoObject?.reconnectionReasonInfo || '',\n\t\t});\n\n\t\tif (reconnectInfoObject && reconnectInfoObject.reconnectionReasonInfo)\n\t\t{\n\t\t\tthis.log(reconnectInfoObject.reconnectionReasonInfo);\n\t\t}\n\n\t\tthis.log(\"Trying to restore ICE connection. Attempt \" + this.connectionAttempt);\n\n\t\tif (this.isInitiator())\n\t\t{\n\t\t\tthis._destroyPeerConnection();\n\t\t\tthis.sendMedia();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t//this.sendNegotiationNeeded(true);\n\t\t}\n\t};\n\n\tdisconnect()\n\t{\n\t\tthis._destroyPeerConnection();\n\n\t\tthis.outgoingVideoTrack = null;\n\t\tthis.outgoingScreenTrack = null;\n\t\tthis.outgoingVideoHoldState = false;\n\n\t\tthis.incomingAudioTrack = null;\n\t\tthis.incomingScreenAudioTrack = null;\n\t\tthis.incomingVideoTrack = null;\n\t\tthis.incomingScreenTrack = null;\n\t};\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.disconnect();\n\n\t\tif (this.voiceDetection)\n\t\t{\n\t\t\tthis.voiceDetection.destroy();\n\t\t\tthis.voiceDetection = null;\n\t\t}\n\n\t\tfor (let tag in this.localStreams)\n\t\t{\n\t\t\tthis.localStreams[tag] = null;\n\t\t}\n\n\t\tclearTimeout(this.answerTimeout);\n\t\tthis.answerTimeout = null;\n\n\t\tclearTimeout(this.connectionTimeout);\n\t\tthis.connectionTimeout = null;\n\n\t\tclearTimeout(this.signalingConnectionTimeout);\n\t\tthis.signalingConnectionTimeout = null;\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaStopped = BX.DoNothing;\n\t};\n}","import {Type} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {\n\tEndpointDirection,\n\tUserState,\n\tQuality,\n\tUserMnemonic,\n\tCallEvent,\n\tCallState,\n\tCallType,\n\tProvider\n} from './engine';\nimport { CallEngineLegacy } from './engine_legacy';\nimport {Call, CALL_STATE, MediaStreamsKinds} from '../call_api.js';\nimport { MediaRenderer } from '../view/media-renderer';\nimport {SimpleVAD} from './simple_vad'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\n\nimport {Event} from 'main.core';\nimport { CallCommonRecordState } from '../call_common_record';\nimport { CallStreamManager } from '../media-stream-manager';\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onDestroy\n */\n\nconst ajaxActions = {\n\tinvite: 'im.call.invite',\n\tanswer: 'im.call.answer',\n\tdecline: 'im.call.decline',\n\thangup: 'im.call.hangup',\n\tping: 'im.call.ping',\n\tfinish: 'im.call.finish',\n};\n\nconst pullEvents = {\n\tping: 'Call::ping',\n\tanswer: 'Call::answer',\n\thangup: 'Call::hangup',\n\tuserInviteTimeout: 'Call::userInviteTimeout',\n\trepeatAnswer: 'Call::repeatAnswer',\n};\n\nconst clientEvents = {\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tscreenState: 'Call::screenState',\n\tcommonRecordState: 'Call::commonRecordState',\n\temotion: 'Call::emotion',\n\tcustomMessage: 'Call::customMessage',\n\tshowUsers: 'Call::showUsers',\n\tshowAll: 'Call::showAll',\n\thideAll: 'Call::hideAll',\n};\n\nconst scenarioEvents = {\n\tviewerJoined: 'Call::viewerJoined',\n\tviewerLeft: 'Call::viewerLeft',\n};\n\nconst BitrixCallEvent = {\n\tonCallConference: 'BitrixCall::onCallConference'\n};\n\nconst MediaKinds = {\n\t[MediaStreamsKinds.Camera]: 'video',\n\t[MediaStreamsKinds.Microphone]: 'audio',\n\t[MediaStreamsKinds.Screen]: 'sharing',\n\t[MediaStreamsKinds.ScreenAudio]: 'sharingAudio',\n};\n\nconst pingPeriod = 5000;\nconst backendPingPeriod = 25000;\nconst reinvitePeriod = 5500;\n\n// const MAX_USERS_WITHOUT_SIMULCAST = 6;\n\nexport class BitrixCallLegacy extends AbstractCall\n{\n\tstatic Event = BitrixCallEvent\n\tpeers: { [key: number]: Peer }\n\tlocalVAD: ?SimpleVAD\n\n\tconstructor(config)\n\t{\n\t\tsuper(config);\n\n\t\tthis.videoQuality = Quality.VeryHigh; // initial video quality. will drop on new peers connecting\n\n\t\tthis.BitrixCall = null;\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.peers = {};\n\t\tthis.peersWithBadConnection = new Set();\n\t\tthis.joinedElsewhere = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis._localUserState = UserState.Idle;\n\t\tthis.clientEventsBound = false;\n\t\tthis._screenShared = false;\n\t\tthis.videoAllowedFrom = UserMnemonic.all;\n\t\tthis.direction = EndpointDirection.SendRecv;\n\t\tthis.floorRequestActive = false;\n\n\t\tthis.microphoneLevelInterval = null;\n\n\t\twindow.addEventListener(\"unload\", this.#onWindowUnload);\n\n\t\tthis.initPeers();\n\n\t\tthis.pingUsersInterval = setInterval(this.pingUsers.bind(this), pingPeriod);\n\t\tthis.pingBackendInterval = setInterval(this.pingBackend.bind(this), backendPingPeriod);\n\n\t\tthis.lastPingReceivedTimeout = null;\n\t\tthis.lastSelfPingReceivedTimeout = null;\n\n\t\tthis.reinviteTimeout = null;\n\n\t\tthis._reconnectionEventCount = 0;\n\n\t\tthis.pullEventHandlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer,\n\t\t\t'Call::hangup': this.#onPullEventHangup,\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined,\n\t\t\t'Call::usersInvited': this.#onPullEventUsersInvited,\n\t\t\t'Call::userInviteTimeout': this.#onPullEventUserInviteTimeout,\n\t\t\t'Call::ping': this.#onPullEventPing,\n\t\t\t'Call::finish': this.#onPullEventFinish,\n\t\t\t'Call::repeatAnswer': this.#onPullEventRepeatAnswer,\n\t\t\t'Call::switchTrackRecordStatus': this.#onPullEventSwitchTrackRecordStatus,\n\t\t};\n\n\t\tthis._isCopilotActive = config.isCopilotActive;\n\t\tthis._isCopilotFeaturesEnabled = true;\n\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = false;\n\t\tthis._isBoostExpired = false;\n\t};\n\n\tget provider()\n\t{\n\t\treturn Provider.Bitrix;\n\t}\n\n\tget screenShared()\n\t{\n\t\treturn this._screenShared;\n\t}\n\n\tget isCopilotActive()\n\t{\n\t\treturn this._isCopilotActive;\n\t}\n\n\tset isCopilotActive(isCopilotActive)\n\t{\n\t\tif (isCopilotActive !== this._isCopilotActive)\n\t\t{\n\t\t\tthis._isCopilotActive = isCopilotActive;\n\t\t}\n\t}\n\n\tget isBoostExpired()\n\t{\n\t\treturn this._isBoostExpired;\n\t}\n\n\tset isBoostExpired(isBoostExpired)\n\t{\n\t\tif (isBoostExpired !== this._isBoostExpired)\n\t\t{\n\t\t\tthis._isBoostExpired = isBoostExpired;\n\t\t}\n\t}\n\n\tget isCopilotFeaturesEnabled()\n\t{\n\t\treturn this._isCopilotFeaturesEnabled;\n\t}\n\n\tset isCopilotFeaturesEnabled(isCopilotFeaturesEnabled)\n\t{\n\t\tif (isCopilotFeaturesEnabled !== this._isCopilotFeaturesEnabled)\n\t\t{\n\t\t\tthis._isCopilotFeaturesEnabled = isCopilotFeaturesEnabled;\n\t\t}\n\t}\n\n\tget isRecordWhenCopilotActivePopupAlreadyShow()\n\t{\n\t\treturn this._isRecordWhenCopilotActivePopupAlreadyShow;\n\t}\n\n\tset isRecordWhenCopilotActivePopupAlreadyShow(isRecordWhenCopilotActivePopupAlreadyShow)\n\t{\n\t\tif (isRecordWhenCopilotActivePopupAlreadyShow !== this._isRecordWhenCopilotActivePopupAlreadyShow)\n\t\t{\n\t\t\tthis._isRecordWhenCopilotActivePopupAlreadyShow = isRecordWhenCopilotActivePopupAlreadyShow;\n\t\t}\n\t}\n\n\tset screenShared(screenShared)\n\t{\n\t\tif (screenShared !== this._screenShared)\n\t\t{\n\t\t\tthis._screenShared = screenShared;\n\t\t\tthis.signaling.sendScreenState(this._screenShared);\n\t\t}\n\t}\n\n\tget localUserState()\n\t{\n\t\treturn this._localUserState\n\t}\n\n\tset localUserState(state)\n\t{\n\t\tif (state === this._localUserState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.runCallback(CallEvent.onUserStateChanged, {\n\t\t\tuserId: this.userId,\n\t\t\tstate: state,\n\t\t\tpreviousState: this._localUserState,\n\t\t\tdirection: this.direction,\n\t\t});\n\t\tthis._localUserState = state;\n\t}\n\n\tget reconnectionEventCount()\n\t{\n\t\treturn this._reconnectionEventCount;\n\t}\n\n\tset reconnectionEventCount(newValue)\n\t{\n\t\tif (this._reconnectionEventCount === 0 && newValue > 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnecting, {\n\t\t\t\treconnectionEventCount: newValue,\n\t\t\t});\n\t\t}\n\t\tif (newValue === 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t}\n\t\tthis._reconnectionEventCount = newValue;\n\t}\n\n\tinitPeers()\n\t{\n\t\tthis.users.forEach((userId) =>\n\t\t{\n\t\t\tuserId = Number(userId);\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t});\n\t};\n\n\treinitPeers()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t\tthis.peers[userId] = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.initPeers();\n\t};\n\n\tpingUsers()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tconst users = this.users.concat(this.userId);\n\t\t\tthis.signaling.sendPingToUsers({userId: users}, true);\n\t\t}\n\t};\n\n\tpingBackend()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToBackend();\n\t\t}\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\tlet incomingVideoAllowed;\n\t\tif (this.videoAllowedFrom === UserMnemonic.all)\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\t\telse if (this.videoAllowedFrom === UserMnemonic.none)\n\t\t{\n\t\t\tincomingVideoAllowed = false;\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tincomingVideoAllowed = this.videoAllowedFrom.some(allowedUserId => allowedUserId == userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tisIncomingVideoAllowed: incomingVideoAllowed,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t\tif (e.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tvideoPaused: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRemoved: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged,\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout,\n\n\t\t})\n\t};\n\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.peers).length;\n\t};\n\n\tcanChangeMediaDevices()\n\t{\n\t\treturn !this.BitrixCall?.isMediaMutedBySystem;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted === event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!event.data.calledProgrammatically)\n\t\t\t{\n\t\t\t\tthis.signaling.sendMicrophoneState(!this.muted);\n\t\t\t}\n\n\t\t\tif (this.muted)\n\t\t\t{\n\t\t\t\tthis.BitrixCall.disableAudio({ calledFrom: 'setMuted' });\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t\t\t}\n\t\t\t\tthis.BitrixCall.enableAudio({ calledFrom: 'setMuted' });\n\t\t\t}\n\t\t}\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled === event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!event.data.calledProgrammatically)\n\t\t\t{\n\t\t\t\tthis.signaling.sendCameraState(this.videoEnabled);\n\t\t\t}\n\n\t\t\tif (this.videoEnabled)\n\t\t\t{\n\t\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t\t{\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\t}\n\t\t\t\tthis.localVideoShown = true;\n\t\t\t\tthis.BitrixCall.enableVideo();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.localVideoShown)\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tthis.BitrixCall.disableVideo();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId === cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!cameraId)\n\t\t\t{\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Camera);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\n\t\t\tthis.BitrixCall.switchActiveVideoDevice(this.cameraId)\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (Hardware.isCameraOn)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback('onUpdateLastUsedCameraId');\n\n\t\t\t\t\t\tif (this.BitrixCall.isVideoPublished() && this.canChangeMediaDevices())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst track = CallStreamManager.getLocalStream(MediaStreamsKinds.Camera);\n\t\t\t\t\t\t\tconst kind = Util.MediaKind[MediaStreamsKinds.Camera];\n\t\t\t\t\t\t\tconst mediaRenderer = new MediaRenderer({ kind, track });\n\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\t\tmediaRenderer,\n\t\t\t\t\t\t\t\ttag: 'main',\n\t\t\t\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tif (this.BitrixCall.isVideoPublished())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!this.canChangeMediaDevices())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onNeedResetMediaDevicesState);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\t\t\tthis.BitrixCall.enableVideo({calledFrom: 'switchActiveVideoDevice', skipUnpause: true});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.log(e);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Camera);\n\t\t\t\t});\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId === microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tif (!microphoneId)\n\t\t\t{\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Microphone);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t\tthis.#onEndpointVoiceEnd({ userId: this.userId });\n\n\t\t\tthis.BitrixCall.switchActiveAudioDevice(this.microphoneId)\n\t\t\t\t.then(() => {\n\t\t\t\t\tconst track = CallStreamManager.getLocalStream(MediaStreamsKinds.Microphone);\n\t\t\t\t\tthis.#onMicAccessResult({\n\t\t\t\t\t\tresult: true,\n\t\t\t\t\t\tstream: new MediaStream([track]),\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.log(error);\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tmicrophoneState: false,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\n\t\t\t\t\tif (Hardware.isMicrophoneMuted && !this.canChangeMediaDevices())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.BitrixCall.disableAudio({ calledFrom: 'setMicrophoneId' });\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t}\n\t};\n\n\t#setPublishingState(deviceType, publishing)\n\t{\n\t\tif (deviceType === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCameraPublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t\telse if (deviceType === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onMicrophonePublishing, {\n\t\t\t\tpublishing\n\t\t\t});\n\t\t}\n\t}\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\tsetMainStream(userId)\n\t{\n\t\tif (userId && userId !== this.userId)\n\t\t{\n\t\t\tconst participant = this.peers[userId]?.participant;\n\t\t\tconst kind = participant?.screenSharingEnabled ? MediaStreamsKinds.Screen : MediaStreamsKinds.Camera;\n\t\t\tthis.BitrixCall.setMainStream(userId, kind);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.BitrixCall.resetMainStream();\n\t\t}\n\t}\n\n\trequestFloor(requestActive)\n\t{\n\t\tif (this.floorRequestActive === requestActive)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.floorRequestActive = requestActive;\n\t\tthis.BitrixCall.raiseHand(requestActive);\n\t};\n\n\tturnOffAllParticipansStream(options)\n\t{\n\t\tthis.BitrixCall.turnOffAllParticipansStream(options);\n\t};\n\n\tturnOffParticipantStream(options)\n\t{\n\t\tthis.BitrixCall.turnOffParticipantStream(options);\n\t};\n\n\tallowSpeakPermission(options)\n\t{\n\t\tthis.BitrixCall.allowSpeakPermission(options);\n\t};\n\n\tchangeSettings(options)\n\t{\n\t\tthis.BitrixCall.changeSettings(options);\n\t};\n\n\tsendLocalRecordState(commonRecordState, force = false)\n\t{\n\t\tif (!force && !this.updateCommonRecordState({ ...commonRecordState, senderId: this.userId }))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.signaling.sendLocalRecordState(this.userId, this.commonRecordState);\n\t}\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\tthis.signaling.sendCustomMessage(message, repeatOnConnect);\n\t};\n\n\t/**\n\t * Updates list of users,\n\t */\n\tallowVideoFrom(userList: $Keys<typeof UserMnemonic> | number[])\n\t{\n\t\tif (this.videoAllowedFrom == userList)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoAllowedFrom = userList;\n\n\t\tif (userList === UserMnemonic.all)\n\t\t{\n\t\t\tthis.signaling.sendShowAll();\n\t\t\tuserList = Object.keys(this.peers);\n\t\t}\n\t\telse if (userList === UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t\tuserList = [];\n\t\t}\n\t\telse if (Type.isArray(userList))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(userList)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error(\"userList is in wrong format\");\n\t\t}\n\n\t\tlet users = {};\n\t\tuserList.forEach(userId => users[userId] = true);\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (!this.peers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (users[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(false);\n\t\t\t}\n\t\t}\n\t};\n\n\tstartScreenSharing()\n\t{\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.waitingLocalScreenShare = true;\n\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\tuserId: this.userId,\n\t\t\tscreenState: true,\n\t\t});\n\n\t\tthis.BitrixCall.startScreenShare();\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tthis.#onBeforeLocalMediaRendererRemoved(MediaStreamsKinds.Screen);\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.screenShared || this.waitingLocalScreenShare;\n\t};\n\n\tisGetUserMediaFulfilled()\n\t{\n\t\treturn this.getUserMediaFulfilled;\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t */\n\tinviteUsers(config: { users: number[], show?: boolean } = {})\n\t{\n\t\tthis.ready = true;\n\t\tlet users = Type.isArray(config.users) ? config.users : this.users;\n\n\t\tthis.attachToConference()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.signaling.sendPingToUsers({userId: users});\n\n\t\t\t\tif (users.length > 0)\n\t\t\t\t{\n\t\t\t\t\treturn this.signaling.inviteUsers({\n\t\t\t\t\t\tuserIds: users,\n\t\t\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\t\t\t\tshow: config.show === true ? 'Y' : 'N',\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst userId = parseInt(users[i]);\n\t\t\t\t\tif (!this.users.includes(userId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.users.push(userId);\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.peers[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\n\t\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\t\t\t\tuserId: userId\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t\tthis.scheduleRepeatInvite();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e)\n\t\t\t})\n\t\t;\n\t};\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(() => this.repeatInviteUsers(), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst inviteParams = {\n\t\t\tuserIds: usersToRepeatInvite,\n\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\trepeated: 'Y',\n\t\t}\n\t\tthis.signaling.inviteUsers(inviteParams).then(() => this.scheduleRepeatInvite());\n\t};\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool?} [config.useVideo]\n\t * @param {bool?} [config.joinAsViewer]\n\t */\n\tanswer(config = {})\n\t{\n\t\tthis.ready = true;\n\t\tconst joinAsViewer = config.joinAsViewer === true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\n\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\n\t\tif (!joinAsViewer)\n\t\t{\n\t\t\tthis._outgoingAnswer = this.signaling.sendAnswer();\n\t\t}\n\t\tthis.attachToConference({joinAsViewer: joinAsViewer})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Attached to conference\");\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(err);\n\t\t\t})\n\t\t;\n\t};\n\n\tdecline(code)\n\t{\n\t\tthis.ready = false;\n\t\tconst data = {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\t\tif (code)\n\t\t{\n\t\t\tdata.code = code\n\t\t}\n\n\t\tCallEngineLegacy.getRestClient().callMethod(ajaxActions.decline, data);\n\t};\n\n\thangup(code, reason, finishCall = false)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\n\t\tlet data = {};\n\t\tthis.ready = false;\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t//clone users and append current user id to send event to all participants of the call\n\t\tdata.userId = this.users.slice(0).concat(this.userId);\n\t\tif (this._outgoingAnswer && !finishCall)\n\t\t{\n\t\t\tthis._outgoingAnswer.then(() => this.signaling.sendHangup(data));\n\t\t}\n\t\telse if (finishCall)\n\t\t{\n\t\t\tthis.signaling.sendFinish(data);\n\t\t}\n\t\telse if (reason !== 'SIGNALING_DUPLICATE_PARTICIPANT')\n\t\t{\n\t\t\tthis.signaling.sendHangup(data)\n\t\t}\n\n\t\tif (reason !== 'SIGNALING_DUPLICATE_PARTICIPANT') {\n\t\t\t// for future reconnections\n\t\t\tthis.reinitPeers();\n\t\t}\n\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.BitrixCall._replaceVideoSharing = false;\n\t\t\tthis.BitrixCall.hangup();\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Tried to hangup, but this.BitrixCall points nowhere\");\n\t\t\tconsole.error(\"Tried to hangup, but this.BitrixCall points nowhere\");\n\t\t}\n\n\t\tthis.screenShared = false;\n\t\tthis.localVideoShown = false;\n\t\tthis.floorRequestActive = false;\n\t};\n\n\tattachToConference(options: { joinAsViewer: ?boolean } = {})\n\t{\n\t\tconst joinAsViewer = options.joinAsViewer === true;\n\t\tif (this.BitrixCall && this.BitrixCall.getState() === CALL_STATE.CONNECTED)\n\t\t{\n\t\t\tif (this.joinedAsViewer === joinAsViewer)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Promise.reject(\"Already joined call in another mode\");\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.direction = joinAsViewer ? EndpointDirection.RecvOnly : EndpointDirection.SendRecv;\n\t\t\tthis.sendTelemetryEvent(\"call\");\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.localUserState = UserState.Connecting;\n\t\t\t\tthis.BitrixCall = new Call(this.userId);\n\n\t\t\t\t/*if (Hardware.isCameraOn) // transfered to #onCallConnected\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t}*/\n\n\t\t\t\tthis.joinedAsViewer = joinAsViewer;\n\n\t\t\t\tif (!this.BitrixCall)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Error: could not create Bitrix call\");\n\t\t\t\t\treturn reject({code: \"BITRIX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.runCallback(BitrixCallEvent.onCallConference, {\n\t\t\t\t\tcall: this\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\tthis.BitrixCall.on('Connected', () => {\n\t\t\t\t\tthis.#onCallConnected();\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\tthis.BitrixCall.on('Failed', (e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.#onCallFailed(e);\n\t\t\t\t\treject(e);\n\t\t\t\t});\n\n\t\t\t\tif (!this.ready)\n\t\t\t\t{\n\t\t\t\t\t// for rare cases with fast quit\n\t\t\t\t\treturn reject({code: \"BITRIX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.BitrixCall.connect({\n\t\t\t\t\troomId: this.id,\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tisLegacy: true,\n\t\t\t\t\tendpoint: this.connectionData.endpoint,\n\t\t\t\t\tjwt: this.connectionData.jwt,\n\t\t\t\t\tvideoBitrate: 1000000,\n\t\t\t\t\tvideoSimulcast: true,\n\t\t\t\t\taudioDeviceId: this.microphoneId,\n\t\t\t\t\tvideoDeviceId: this.cameraId,\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e);\n\t\t\t}\n\t\t});\n\t};\n\n\t#onCallConnected()\n\t{\n\t\tthis.reconnectionEventCount = 0;\n\t\tthis.log(\"Call connected\");\n\t\tthis.sendTelemetryEvent(\"connect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tconst MAX_USERS_WITH_VIDEO = Util.countDisableCameraNewJoinedUsersFeature();\n\n\t\tif (Util.isDisableCameraNewJoinedUsersFeatureEnabled() && this.BitrixCall.remoteParticipantsCount >= MAX_USERS_WITH_VIDEO) // task-596223\n\t\t{\n\t\t\tHardware.isCameraOn = false;\n\t\t}\n\n\t\tthis.BitrixCall.on('Failed', this.#onCallDisconnected);\n\n\t\tthis.signaling.sendMicrophoneState(!Hardware.isMicrophoneMuted);\n\t\tthis.signaling.sendCameraState(Hardware.isCameraOn);\n\n\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\tthis.BitrixCall.enableAudio({ calledFrom: 'onCallConnected', disabled: Hardware.isMicrophoneMuted });\n\n\t\tif (Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.localVideoShown = true;\n\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\t\t\tthis.BitrixCall.enableVideo({ calledFrom: 'onCallConnected' });\n\t\t}\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\t};\n\n\t#onCallFailed(e)\n\t{\n\t\tthis.log(\"Could not attach to conference\", e);\n\t\tthis.sendTelemetryEvent(\"connect_failure\");\n\t\tthis.localUserState = UserState.Failed;\n\n\t\tthis.BitrixCall.enableSilentLogging(false);\n\t\tthis.BitrixCall.setLoggerCallback(null);\n\t};\n\n\tbindCallEvents()\n\t{\n\t\tthis.BitrixCall.on('PublishSucceed', this.#onLocalMediaRendererAdded);\n\t\tthis.BitrixCall.on('PublishPaused', this.#onLocalMediaRendererMuteToggled);\n\t\tthis.BitrixCall.on('MediaMutedBySystem', this.#onMediaMutedBySystem);\n\t\tthis.BitrixCall.on('PublishFailed', this.#onLocalMediaRendererEnded);\n\t\tthis.BitrixCall.on('PublishEnded', this.#onLocalMediaRendererEnded);\n\t\tthis.BitrixCall.on('GetUserMediaStarted', this.#onGetUserMediaStarted.bind(this));\n\t\tthis.BitrixCall.on('GetUserMediaEnded', this.#onGetUserMediaEnded);\n\t\tthis.BitrixCall.on('GetUserMediaSuccess', this.#onGetUserMediaSuccess.bind(this));\n\t\tthis.BitrixCall.on('RemoteMediaAdded', this.#onRemoteMediaAdded);\n\t\tthis.BitrixCall.on('RemoteMediaRemoved', this.#onRemoteMediaRemoved);\n\t\tthis.BitrixCall.on('RemoteMediaMuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.BitrixCall.on('RemoteMediaUnmuted', this.#onRemoteMediaMuteToggled);\n\t\tthis.BitrixCall.on('ParticipantJoined', this.#onParticipantJoined);\n\t\tthis.BitrixCall.on('ParticipantStateUpdated', () => console.log('handleParticipantStateUpdated'));\n\t\tthis.BitrixCall.on('ParticipantLeaved', this.#onParticipantLeaved);\n\t\tthis.BitrixCall.on('MessageReceived', this.#onCallMessageReceived);\n\t\tthis.BitrixCall.on('HandRaised', this.#onCallHandRaised);\n\t\tthis.BitrixCall.on('VoiceStarted', this.#onEndpointVoiceStart);\n\t\tthis.BitrixCall.on('AllParticipantsAudioMuted', this.#onAllParticipantsAudioMuted);\n\t\tthis.BitrixCall.on('AllParticipantsVideoMuted', this.#onAllParticipantsVideoMuted);\n\t\tthis.BitrixCall.on('AllParticipantsScreenshareMuted', this.#onAllParticipantsScreenshareMuted);\n\t\tthis.BitrixCall.on('YouMuteAllParticipants', this.#onYouMuteAllParticipants);\n\t\tthis.BitrixCall.on('RoomSettingsChanged', this.#onRoomSettingsChanged);\n\t\tthis.BitrixCall.on('UserPermissionsChanged', this.#onUserPermissionsChanged);\n\t\tthis.BitrixCall.on('UserRoleChanged', this.#onUserRoleChanged);\n\t\tthis.BitrixCall.on('ParticipantMuted', this.#onParticipantMuted);\n\t\tthis.BitrixCall.on('VoiceEnded', this.#onEndpointVoiceEnd);\n\t\tthis.BitrixCall.on('Reconnecting', this.#onCallReconnecting);\n\t\tthis.BitrixCall.on('Reconnected', this.#onCallReconnected);\n\t\tthis.BitrixCall.on('Disconnected', this.#onCallDisconnected);\n\t\t// if (Util.shouldCollectStats())\n\t\t// {\n\t\tthis.BitrixCall.on('CallStatsReceived', this.#onCallStatsReceived);\n\t\t// }\n\t\tthis.BitrixCall.on('UpdatePacketLoss', this.#onUpdatePacketLoss);\n\t\tthis.BitrixCall.on('ConnectionQualityChanged', this.#onConnectionQualityChanged);\n\t\tthis.BitrixCall.on('ToggleRemoteParticipantVideo', this.#onToggleRemoteParticipantVideo);\n\t\tthis.BitrixCall.on('TrackSubscriptionFailed', this.#onTrackSubscriptionFailed);\n\t};\n\n\tremoveCallEvents()\n\t{\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.BitrixCall.on('Failed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishSucceed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishFailed', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('PublishEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('GetUserMediaEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RemoteMediaAdded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RemoteMediaRemoved', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantJoined', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantStateUpdated', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantLeaved', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('MessageReceived', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('HandRaised', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsAudioMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsVideoMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('AllParticipantsScreenshareMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('YouMuteAllParticipants', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('RoomSettingsChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('UserPermissionsChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ParticipantMuted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('VoiceStarted', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('VoiceEnded', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Reconnecting', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Reconnected', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('Disconnected', BX.DoNothing);\n\t\t\t// if (Util.shouldCollectStats())\n\t\t\t// {\n\t\t\tthis.BitrixCall.on('CallStatsReceived', BX.DoNothing);\n\t\t\t// }\n\t\t\tthis.BitrixCall.on('UpdatePacketLoss', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ConnectionQualityChanged', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('ToggleRemoteParticipantVideo', BX.DoNothing);\n\t\t\tthis.BitrixCall.on('TrackSubscriptionFailed', BX.DoNothing);\n\t\t}\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\t/**\n\t * Adds new users to call\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: userId\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddInvitedUsers(users, show)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.type === CallType.Instant && this.peers[userId].calculatedState !== UserState.Calling)\n\t\t\t{\n\t\t\t\tthis.peers[userId].onInvited(show);\n\t\t\t}\n\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t}\n\t};\n\n\ttoggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle = false) {\n\t\tif (this.BitrixCall) {\n\t\t\tthis.BitrixCall.toggleRemoteParticipantVideo(participantIds, showVideo, isPaginateToggle)\n\t\t}\n\t}\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\t#onPeerStateChanged = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.state === UserState.Failed || e.state === UserState.Unavailable || e.state === UserState.Declined || e.state === UserState.Idle)\n\t\t{\n\t\t\tif (this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup();\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout = (e) =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tif (this.pullEventHandlers[command])\n\t\t{\n\t\t\tif (command !== 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\tthis.pullEventHandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventAnswer = (params) =>\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.__onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId] = this.createPeer(senderId);\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: senderId\n\t\t\t});\n\t\t}\n\n\t\tif (!this.users.includes(senderId))\n\t\t{\n\t\t\tthis.users.push(senderId);\n\t\t}\n\n\t\tthis.peers[senderId].setReady(true);\n\t};\n\n\t__onPullEventAnswerSelf(params)\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.joinedElsewhere = true;\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup = (params) =>\n\t{\n\t\tconst senderId = params.senderId;\n\t\tif (this.userId === senderId && params.callInstanceId && this.instanceId !== params.callInstanceId)\n\t\t{\n\t\t\t// Call declined by the same user elsewhere\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.sendLog({'description': 'GOT A #onPullEventHangup from user', 'pullEvent': '#onPullEventHangup', params: params});\n\n\t\tthis.peers[senderId].participant = null;\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\t\telse if (params.code == 486)\n\t\t{\n\t\t\tthis.peers[senderId].setBusy(true);\n\t\t\tconsole.error(\"user \" + senderId + \" is busy\");\n\t\t}\n\n\t\tif (this.ready && this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersJoined', params);\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersInvited', params);\n\t\tconst users = params.users;\n\t\tconst show = params.show;\n\n\t\tif (this.type === CallType.Instant)\n\t\t{\n\t\t\tthis.addInvitedUsers(users, show);\n\t\t}\n\t};\n\n\t#onPullEventUserInviteTimeout = (params) =>\n\t{\n\t\tthis.log('__onPullEventUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onPullEventPing = (params) =>\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\t// ignore self ping\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\tif (!this.joinedElsewhere)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: false\n\t\t\t\t});\n\t\t\t\tthis.joinedElsewhere = true;\n\t\t\t}\n\t\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\t\tthis.lastSelfPingReceivedTimeout = setTimeout(this.#onNoSelfPingsReceived, pingPeriod * 2.1);\n\t\t}\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tthis.lastPingReceivedTimeout = setTimeout(this.#onNoPingsReceived, pingPeriod * 2.1);\n\t\tif (this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId].setReady(true);\n\t\t}\n\t};\n\n\t#onNoPingsReceived = () =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tthis.destroy();\n\t\t}\n\t};\n\n\t#onNoSelfPingsReceived = () =>\n\t{\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: false\n\t\t});\n\t\tthis.joinedElsewhere = false;\n\t};\n\n\t#onPullEventFinish = () =>\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventRepeatAnswer = () =>\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendAnswer({userId: this.userId}, true);\n\t\t}\n\t}\n\n\t#onPullEventSwitchTrackRecordStatus = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onSwitchTrackRecordStatus, {\n\t\t\tisTrackRecordOn: e.isTrackRecordOn,\n\t\t\terrorCode: e.errorCode,\n\t\t});\n\t}\n\n\t#onLocalMediaRendererAdded = (mediaStreamsKind) => {\n\t\tconst kind = MediaKinds[mediaStreamsKind];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for local mediaRenderer: ${mediaStreamsKind}`);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('__onLocalMediaRendererAdded', kind);\n\n\t\tlet track = null;\n\t\tlet mediaRenderer = null;\n\n\t\tswitch (mediaStreamsKind)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tif (!this.videoEnabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttrack = CallStreamManager.getLocalStream(mediaStreamsKind);\n\t\t\t\tmediaRenderer = new MediaRenderer({ kind, track });\n\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'main',\n\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.log('Screen shared');\n\t\t\t\tthis.screenShared = true;\n\t\t\t\tthis.waitingLocalScreenShare = false;\n\n\t\t\t\ttrack = CallStreamManager.getLocalStream(mediaStreamsKind);\n\t\t\t\tmediaRenderer = new MediaRenderer({ kind, track });\n\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'screen',\n\t\t\t\t\tstream: mediaRenderer.stream,\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.signaling.sendMicrophoneState(true);\n\t\t\t\tthis.#setPublishingState(mediaStreamsKind, false);\n\n\t\t\t\ttrack = CallStreamManager.getLocalStream(mediaStreamsKind);\n\t\t\t\tthis.#onMicAccessResult({\n\t\t\t\t\tresult: true,\n\t\t\t\t\tstream: new MediaStream([track]),\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t}\n\t};\n\n\t#onLocalMediaRendererMuteToggled = (source, muted) => {\n\t\tif (source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\tthis.signaling.sendMicrophoneState(!muted);\n\t\t}\n\t\telse if (source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, false);\n\t\t}\n\t};\n\n\t#onMediaMutedBySystem = (muted) =>\n\t{\n\t\tconst microphoneState = muted ? false : !Hardware.isMicrophoneMuted;\n\t\tconst cameraState = muted ? false : Hardware.isCameraOn;\n\t\tthis.signaling.sendMicrophoneState(microphoneState);\n\t\tthis.signaling.sendCameraState(cameraState);\n\t}\n\n\t#onLocalMediaRendererEnded = (e, interrupted) =>\n\t{\n\t\tconst kind = MediaKinds[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (e)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tif (!interrupted)\n\t\t\t\t{\n\t\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(e);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.#onBeforeLocalMediaRendererRemoved(e);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t#onGetUserMediaStarted = (options) =>\n\t{\n\t\tthis.getUserMediaFulfilled = false;\n\n\t\tif (options.video)\n\t\t{\n\t\t\tthis.signaling.sendCameraState(false);\n\t\t}\n\n\t\tif (options.audio)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(false);\n\t\t}\n\t};\n\n\t#onGetUserMediaSuccess = (options) =>\n\t{\n\t\tif (options.video)\n\t\t{\n\t\t\tthis.signaling.sendCameraState(true);\n\t\t}\n\n\t\tif (options.audio)\n\t\t{\n\t\t\tthis.signaling.sendMicrophoneState(!Hardware.isMicrophoneMuted);\n\t\t}\n\t}\n\n\t#onGetUserMediaEnded = () =>\n\t{\n\t\tthis.getUserMediaFulfilled = true;\n\t};\n\n\t#onBeforeLocalMediaRendererRemoved = (e) =>\n\t{\n\t\tconst kind = MediaKinds[e];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${e}`);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"__onBeforeLocalMediaRendererRemoved\", kind);\n\n\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\tkind,\n\t\t});\n\n\t\tswitch (e) {\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'main',\n\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\tremoved: true,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, false);\n\t\t\t\tthis.signaling.sendMicrophoneState(false);\n\t\t\t\tbreak;\n\t\t\tcase MediaStreamsKinds.Screen:\n\t\t\t\tthis.BitrixCall.stopScreenShare();\n\t\t\t\tthis.log(\"Screen is no longer shared\");\n\t\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tscreenState: false,\n\t\t\t\t});\n\t\t\t\tthis.screenShared = false;\n\t\t\t\tthis.waitingLocalScreenShare = false;\n\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\tmediaRenderer,\n\t\t\t\t\ttag: 'screen',\n\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\tremoved: true,\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\t#onRemoteMediaAdded = (p, t) =>\n\t{\n\t\tconst kind = MediaKinds[t.source];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${t.source}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst e = {\n\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\tkind,\n\t\t\t\ttrack: t.track\n\t\t\t})\n\t\t};\n\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\t// temporary solution to play new streams\n\t\t\t// todo: need to find what cause the problem itself\n\t\t\tif (!peer.participant)\n\t\t\t{\n\t\t\t\tpeer.participant = p;\n\t\t\t\tpeer.updateCalculatedState();\n\t\t\t}\n\t\t\tpeer.addMediaRenderer(e.mediaRenderer);\n\t\t}\n\n\t\tswitch (t.source)\n\t\t{\n\t\t\tcase MediaStreamsKinds.Camera:\n\t\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tcameraState: !p.isMutedVideo\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase MediaStreamsKinds.Microphone:\n\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tmicrophoneState: !p.isMutedAudio\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\n\t\tconsole.log(`[RemoteMediaAdded]: UserId: ${p.userId}, source: ${MediaKinds[t.source]}`)\n\t};\n\n\t#onRemoteMediaRemoved = (p, t) =>\n\t{\n\t\tconst kind = MediaKinds[t.source];\n\t\tif (!kind)\n\t\t{\n\t\t\tthis.log(`Wrong kind for mediaRenderer: ${t.source}`);\n\t\t\treturn;\n\t\t}\n\n\t\tconst e = {\n\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\tkind,\n\t\t\t\ttrack: t.track\n\t\t\t})\n\t\t};\n\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\tpeer.removeMediaRenderer(e.mediaRenderer);\n\t\t}\n\n\t\tif (t.source === MediaStreamsKinds.Camera)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tcameraState: false\n\t\t\t});\n\t\t}\n\n\t\tconsole.log(`[RemoteMediaRemoved]: UserId: ${p.userId}, source: ${MediaKinds[t.source]}`)\n\t};\n\n\t#onRemoteMediaMuteToggled = (p, t) =>\n\t{\n\t\tif (t.source === MediaStreamsKinds.Microphone)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tmicrophoneState: !p.isMutedAudio\n\t\t\t});\n\t\t}\n\t}\n\n\t#onParticipantJoined = (p) =>\n\t{\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\tif (!p.audioEnabled || p.isMutedAudio)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tmicrophoneState: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!p.videoEnabled || p.isMutedVideo)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\tcameraState: false\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (p.isHandRaised)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\t\t\tuserId: p.userId,\n\t\t\t\t\trequestActive: p.isHandRaised\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tpeer.participant = p;\n\t\t\tpeer.updateCalculatedState();\n\n\t\t\tif (this.commonRecordState.state !== CallCommonRecordState.Stopped\n\t\t\t\t&& this.commonRecordState.userId === this.userId)\n\t\t\t{\n\t\t\t\tthis.signaling.sendLocalRecordState(this.userId, this.commonRecordState);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onParticipantLeaved = (p) =>\n\t{\n\t\tconst peer = this.peers[p.userId];\n\t\tif (peer)\n\t\t{\n\t\t\tpeer.participant = null;\n\t\t\tfor (let type in MediaStreamsKinds)\n\t\t\t{\n\t\t\t\tconst source = MediaStreamsKinds[type];\n\t\t\t\tconst kind = MediaKinds[source];\n\t\t\t\tconst e = {\n\t\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\t\tkind,\n\t\t\t\t\t}),\n\t\t\t\t};\n\t\t\t\tpeer.removeMediaRenderer(e.mediaRenderer);\n\t\t\t}\n\t\t\tpeer.updateCalculatedState();\n\t\t}\n\t};\n\n\t#onMicAccessResult = (e) =>\n\t{\n\t\tif (e.result)\n\t\t{\n\t\t\tif (e.stream.getAudioTracks().length > 0)\n\t\t\t{\n\t\t\t\tif (this.localVAD)\n\t\t\t\t{\n\t\t\t\t\tthis.localVAD.destroy();\n\t\t\t\t}\n\t\t\t\tthis.localVAD = new SimpleVAD({\n\t\t\t\t\tmediaStream: e.stream,\n\t\t\t\t\tonVoiceStarted: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!Hardware.isMicrophoneMuted)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.requestFloor(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.#onEndpointVoiceStart({userId: this.userId});\n\t\t\t\t\t},\n\t\t\t\t\tonVoiceStopped: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onEndpointVoiceEnd({userId: this.userId});\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t\t\tthis.microphoneLevelInterval = setInterval(\n\t\t\t\t\t() =>this.microphoneLevel = this.localVAD.currentVolume,\n\t\t\t\t\t200\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onCallReconnecting = () =>\n\t{\n\t\tif (this.reconnectionEventCount++)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (userId !== this.userId && this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Connected)\n\t\t\t{\n\t\t\t\tfor (let type in MediaStreamsKinds)\n\t\t\t\t{\n\t\t\t\t\tconst source = MediaStreamsKinds[type];\n\t\t\t\t\tconst kind = MediaKinds[source];\n\t\t\t\t\tconst e = {\n\t\t\t\t\t\tmediaRenderer: new MediaRenderer({\n\t\t\t\t\t\t\tkind,\n\t\t\t\t\t\t}),\n\t\t\t\t\t};\n\t\t\t\t\tthis.peers[userId].removeMediaRenderer(e.mediaRenderer);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t#onCallReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount = 0;\n\t\tthis.log(\"Call reconnected\");\n\t\tthis.sendTelemetryEvent(\"reconnect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tthis.signaling.sendMicrophoneState(!Hardware.isMicrophoneMuted);\n\t\tif (!this.BitrixCall.isAudioPublished())\n\t\t{\n\t\t\tthis.#setPublishingState(MediaStreamsKinds.Microphone, true);\n\t\t}\n\t\tthis.BitrixCall.enableAudio({ calledFrom: 'onCallReconnected', disabled: Hardware.isMicrophoneMuted });\n\n\t\tthis.signaling.sendCameraState(Hardware.isCameraOn);\n\t\tif (Hardware.isCameraOn)\n\t\t{\n\t\t\tif (!this.BitrixCall.isVideoPublished())\n\t\t\t{\n\t\t\t\tthis.#setPublishingState(MediaStreamsKinds.Camera, true);\n\t\t\t}\n\t\t\tthis.BitrixCall.enableVideo();\n\t\t}\n\n\t\tif (this.screenShared || this.waitingLocalScreenShare)\n\t\t{\n\t\t\tthis.BitrixCall.startScreenShare();\n\t\t}\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\n\t\tif (this.recordState.userId === this.userId)\n\t\t{\n\t\t\tthis.sendLocalRecordState({ action: this.commonRecordState.state, userId: this.userId }, true);\n\t\t}\n\n\t\tthis.BitrixCall.raiseHand(this.floorRequestActive);\n\t};\n\n\t#onCallDisconnected = (e) =>\n\t{\n\t\tlet logData = {};\n\n\t\tconst evt = e && typeof e === 'object' ? e : {}\n\t\tconst {headers, leaveInformation} = evt;\n\n\t\tif (headers) {\n\t\t\tlogData = {\n\t\t\t\t...logData,\n\t\t\t\theaders,\n\t\t\t}\n\t\t}\n\n\t\tif (leaveInformation) {\n\t\t\tlogData = {\n\t\t\t\t...logData,\n\t\t\t\tleaveInformation,\n\t\t\t}\n\t\t}\n\n\t\tthis.log(\"__onCallDisconnected\", (Object.keys(logData).length ? logData : null));\n\n\t\tif (this.ready && leaveInformation) {\n\t\t\tthis.hangup(leaveInformation.code, leaveInformation.reason)\n\t\t}\n\n\t\tthis.sendTelemetryEvent(\"disconnect\");\n\n\t\tthis.localUserState = UserState.Idle;\n\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.reinitPeers();\n\n\t\tthis.localVideoShown = false;\n\t\tthis.removeCallEvents();\n\t\tthis.unsubscribeHardwareChanges();\n\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: true\n\t\t});\n\t};\n\n\t#onWindowUnload = () =>\n\t{\n\t\tif (this.ready && this.BitrixCall)\n\t\t{\n\t\t\tthis.signaling.sendHangup({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t};\n\n\t#onFatalError = (error) =>\n\t{\n\t\tif (error && error.call)\n\t\t{\n\t\t\tdelete error.call;\n\t\t}\n\t\tthis.log(\"onFatalError\", error);\n\n\t\tthis.ready = false;\n\t\tthis.localUserState = UserState.Failed;\n\t\tthis.reinitPeers();\n\n\t\tthis.localVideoShown = false;\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.BitrixCall.hangup({\n\t\t\t\t\t'X-Reason': 'Fatal error',\n\t\t\t\t\t'X-Error': typeof (error) === 'string' ? error : error.code || error.name\n\t\t\t\t})\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\tthis.log(\"Bitrix hangup error: \", e);\n\t\t\t\tconsole.error(\"Bitrix hangup error: \", e);\n\t\t\t}\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\n\t\tif (typeof (error) === \"string\")\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, {\n\t\t\t\tname: error\n\t\t\t});\n\t\t}\n\t\telse if (error.name)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCallFailure, error);\n\t\t}\n\t};\n\n\t#onTrackSubscriptionFailed = (params) =>\n\t{\n\t\tthis.runCallback(CallEvent.onTrackSubscriptionFailed, params);\n\t}\n\n\t#onCallStatsReceived = (stats) =>\n\t{\n\t\tconst usersToSendReports = {};\n\t\t// to order local stats by track quality\n\t\tconst statsIndexByRid = { f: 2, h: 1, q: 0 };\n\n\t\tstats.sender.forEach((report) =>\n\t\t{\n\t\t\tif (report.userId && (report.kind === 'video' || report.kind === 'audio'))\n\t\t\t{\n\t\t\t\tif (!usersToSendReports[report.userId])\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId] = {};\n\t\t\t\t}\n\n\t\t\t\tif (report.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tif (!usersToSendReports[report.userId][report.source])\n\t\t\t\t\t{\n\t\t\t\t\t\tusersToSendReports[report.userId][report.source] = [];\n\t\t\t\t\t}\n\n\t\t\t\t\tconst index = statsIndexByRid[report.rid] || 0;\n\t\t\t\t\tusersToSendReports[report.userId][report.source][index] = report;\n\t\t\t\t}\n\t\t\t\telse if (report.kind === 'audio')\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId][report.source] = report;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tstats.recipient.forEach((report) =>\n\t\t{\n\t\t\tif (report.userId && (report.kind === 'video' || report.kind === 'audio'))\n\t\t\t{\n\t\t\t\tif (!usersToSendReports[report.userId])\n\t\t\t\t{\n\t\t\t\t\tusersToSendReports[report.userId] = {};\n\t\t\t\t}\n\t\t\t\tusersToSendReports[report.userId][report.source] = report;\n\t\t\t}\n\t\t});\n\n\t\tfor (let userId in usersToSendReports)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserStatsReceived, {\n\t\t\t\tuserId,\n\t\t\t\treport: usersToSendReports[userId]\n\t\t\t});\n\t\t}\n\n\t\t// todo: need to correct stats format\n\t\t// if (this.logger)\n\t\t// {\n\t\t// \tthis.logger.sendStat(transformVoxStats(e.stats, this.BitrixCall));\n\t\t// }\n\t}\n\n\t#onUpdatePacketLoss = (participants) =>\n\t{\n\t\tconst prevPeersWithBadConnection = new Set([...this.peersWithBadConnection.values()]);\n\t\tparticipants.forEach(userId =>\n\t\t{\n\t\t\tconst peer = this.peers[userId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tif (!prevPeersWithBadConnection.has(userId))\n\t\t\t\t{\n\t\t\t\t\tthis.peersWithBadConnection.add(userId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tprevPeersWithBadConnection.delete(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t#onConnectionQualityChanged = participants =>\n\t{\n\t\tObject.keys(participants).forEach(participantId => {\n\t\t\tthis.runCallback(\n\t\t\t\tCallEvent.onConnectionQualityChanged,\n\t\t\t\t{\n\t\t\t\t\tuserId: Number(participantId),\n\t\t\t\t\tscore: participants[participantId],\n\t\t\t\t}\n\t\t\t);\n\t\t})\n\t}\n\n\t#onToggleRemoteParticipantVideo = isVideoShown =>\n\t{\n\t\tthis.runCallback(\n\t\t\tCallEvent.onToggleRemoteParticipantVideo,\n\t\t\t{ isVideoShown }\n\t\t);\n\t}\n\n\t#onCallMessageReceived = (e) =>\n\t{\n\t\tlet message;\n\t\tlet peer;\n\n\t\ttry\n\t\t{\n\t\t\tmessage = JSON.parse(e.text);\n\t\t} catch (err)\n\t\t{\n\t\t\tthis.log(\"Could not parse scenario message.\", err);\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventName = message.eventName;\n\t\tif (eventName === clientEvents.cameraState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tcameraState: message.cameraState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.videoPaused)\n\t\t{\n\t\t\tif (message.senderId === this.userId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tvideoPaused: message.videoPaused === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.screenState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tscreenState: message.screenState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.commonRecordState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCommonRecordState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tcommonRecordState: message.commonRecordState\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.emotion)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserEmotion, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\ttoUserId: message.toUserId,\n\t\t\t\temotion: message.emotion\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.customMessage)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCustomMessage, {\n\t\t\t\tmessage: message.message\n\t\t\t})\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerJoined)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" joined\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setDirection(EndpointDirection.RecvOnly);\n\t\t\t\tpeer.setReady(true);\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerLeft)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" left\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setReady(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Unknown scenario event \" + eventName);\n\t\t}\n\t};\n\n\t#onCallHandRaised = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\tuserId: p.userId,\n\t\t\trequestActive: p.isHandRaised\n\t\t})\n\t}\n\n\t#onAllParticipantsAudioMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsAudioMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onAllParticipantsVideoMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsVideoMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onAllParticipantsScreenshareMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onAllParticipantsScreenshareMuted, {\n\t\t\tuserId: p.fromUserId,\n\t\t\treason: p.reason,\n\t\t})\n\t}\n\n\t#onYouMuteAllParticipants = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onYouMuteAllParticipants, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onRoomSettingsChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onRoomSettingsChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onUserPermissionsChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserPermissionsChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onUserRoleChanged = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserRoleChanged, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onParticipantMuted = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onParticipantMuted, {\n\t\t\tdata: p\n\t\t})\n\t}\n\n\t#onEndpointVoiceStart = (p) =>\n\t{\n\t\t// for local user we need to send extra signal to show unmute hint\n\t\tif (p.userId === this.userId)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: p.userId,\n\t\t\t\tlocal: true,\n\t\t\t});\n\n\t\t\tif (Hardware.isMicrophoneMuted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\tuserId: p.userId,\n\t\t});\n\t};\n\n\t#onEndpointVoiceEnd = (p) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\tuserId: p.userId,\n\t\t});\n\t}\n\n\tsendTelemetryEvent(eventName)\n\t{\n\t\tUtil.sendTelemetryEvent({\n\t\t\tcall_id: this.id,\n\t\t\tuser_id: this.userId,\n\t\t\tkind: \"Bitrix\",\n\t\t\tevent: eventName,\n\t\t})\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis.floorRequestActive = false;\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tif (this.BitrixCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\tthis.BitrixCall.hangup();\n\t\t\tthis.BitrixCall = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\tclearInterval(this.pingUsersInterval);\n\t\tclearInterval(this.pingBackendInterval);\n\n\t\twindow.removeEventListener(\"unload\", this.#onWindowUnload);\n\t\treturn super.destroy();\n\t};\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendAnswer(data, repeated)\n\t{\n\t\tif (repeated && CallEngineLegacy.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.answer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.answer, data);\n\t\t}\n\t};\n\n\tsendHangup(data)\n\t{\n\t\tif (CallEngineLegacy.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data);\n\t\t\tdata.retransmit = false;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t};\n\n\tsendFinish(data)\n\t{\n\t\tif (CallEngineLegacy.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data);\n\t\t\tdata.retransmit = false;\n\t\t\tthis.#runRestAction(ajaxActions.finish, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\tthis.#runRestAction(ajaxActions.finish, data);\n\t\t}\n\t};\n\n\tsendCameraState(cameraState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.cameraState, {\n\t\t\tcameraState: cameraState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendVideoPaused(videoPaused)\n\t{\n\t\treturn this.#sendMessage(clientEvents.videoPaused, {\n\t\t\tvideoPaused: videoPaused ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendMicrophoneState(microphoneState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.microphoneState, {\n\t\t\tmicrophoneState: microphoneState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendScreenState(screenState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.screenState, {\n\t\t\tscreenState: screenState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendLocalRecordState(userId, commonRecordState)\n\t{\n\t\tthis.#sendMessage(clientEvents.commonRecordState, {\n\t\t\tsenderId: userId,\n\t\t\tcommonRecordState\n\t\t});\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\treturn this.#sendMessage(clientEvents.customMessage, {\n\t\t\tmessage: message,\n\t\t\trepeatOnConnect: !!repeatOnConnect\n\t\t});\n\t};\n\n\tsendShowUsers(users)\n\t{\n\t\treturn this.#sendMessage(clientEvents.showUsers, {\n\t\t\tusers: users\n\t\t});\n\t};\n\n\tsendShowAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.showAll, {});\n\t};\n\n\tsendHideAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.hideAll, {});\n\t};\n\n\tsendPingToUsers(data)\n\t{\n\t\tif (CallEngineLegacy.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.ping, data, 0);\n\t\t}\n\t};\n\n\tsendPingToBackend()\n\t{\n\t\tthis.#runRestAction(ajaxActions.ping, {retransmit: false});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\tif (CallEngineLegacy.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.userInviteTimeout, data, 0);\n\t\t}\n\t};\n\n\t#sendPullEvent(eventName, data, expiry)\n\t{\n\t\texpiry = expiry || 5;\n\t\tif (!data.userId)\n\t\t{\n\t\t\tthrow new Error('userId is not found in data');\n\t\t}\n\n\t\tif (!Type.isArray(data.userId))\n\t\t{\n\t\t\tdata.userId = [data.userId];\n\t\t}\n\t\tif (data.userId.length === 0)\n\t\t{\n\t\t\t// nobody to send, exit\n\t\t\treturn;\n\t\t}\n\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.senderId = this.call.userId;\n\t\tdata.callId = this.call.id;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.log('Sending p2p signaling event ' + eventName + '; ' + JSON.stringify(data));\n\t\tCallEngineLegacy.getPullClient().sendMessage(data.userId, 'im', eventName, data, expiry);\n\t};\n\n\t#sendMessage(eventName, data)\n\t{\n\t\tif (!this.call.BitrixCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\t\tdata.eventName = eventName;\n\t\tdata.requestId = Util.getUuidv4();\n\t\tdata.senderId = this.call.userId;\n\n\t\tthis.call.BitrixCall.sendMessage(JSON.stringify(data));\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callId = this.call.id;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\t\treturn CallEngineLegacy.getRestClient().callMethod(signalName, data);\n\t};\n}\n\nclass Peer\n{\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.userId = params.userId;\n\t\tthis.call = params.call;\n\n\t\tthis.ready = !!params.ready;\n\t\tthis.calling = false;\n\t\tthis.backgroundCalling = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.direction = params.direction || EndpointDirection.SendRecv;\n\n\t\tthis.stream = null;\n\t\tthis.mediaRenderers = [];\n\n\t\tthis.isIncomingVideoAllowed = params.isIncomingVideoAllowed !== false;\n\n\t\tthis.callingTimeout = 0;\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaRemoved: Type.isFunction(params.onMediaRemoved) ? params.onMediaRemoved : BX.DoNothing,\n\t\t};\n\n\t\tthis.calculatedState = this.calculateState();\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tready = !!ready;\n\t\tif (this.ready === ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.ready = ready;\n\t\tif (this.calling || this.backgroundCalling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.backgroundCalling = false;\n\t\t\tthis.inviteTimeout = false;\n\t\t}\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetDirection(direction)\n\t{\n\t\tif (this.direction === direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.direction = direction;\n\t}\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling || this.backgroundCalling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.backgroundCalling = false;\n\t\t}\n\t\tif (this.declined)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling || this.backgroundCalling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.backgroundCalling = false;\n\t\t}\n\t\tif (this.busy)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.declined = false;\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tallowIncomingVideo(isIncomingVideoAllowed)\n\t{\n\t\tif (this.isIncomingVideoAllowed == isIncomingVideoAllowed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isIncomingVideoAllowed = !!isIncomingVideoAllowed;\n\t}\n\n\taddMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Adding media renderer for user' + this.userId, mediaRenderer);\n\n\t\tthis.mediaRenderers.push(mediaRenderer);\n\n\t\tthis.callbacks.onMediaReceived({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tremoveMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Removing media renderer for user' + this.userId, mediaRenderer);\n\n\t\tlet i\n\t\tthis.mediaRenderers.forEach((el, index) => {\n\t\t\tif (el.kind === mediaRenderer.kind) {\n\t\t\t\ti = index;\n\t\t\t}\n\t\t})\n\n\t\tif (i >= 0)\n\t\t{\n\t\t\tthis.mediaRenderers.splice(i, 1);\n\t\t}\n\t\tthis.callbacks.onMediaRemoved({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tcalculateState()\n\t{\n\t\tif (this.participant)\n\t\t{\n\t\t\treturn UserState.Connected;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t}\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState !== calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tdirection: this.direction,\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t}\n\n\tisParticipating()\n\t{\n\t\treturn ((this.calling || this.backgroundCalling || this.ready || this.participant) && !this.declined);\n\t}\n\n\tonInvited(showUser = false)\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tif (showUser)\n\t\t{\n\t\t\tthis.calling = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.backgroundCalling = true;\n\t\t}\n\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(() => this.onInviteTimeout(true), 30000);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tif (!(this.calling || this.backgroundCalling))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.calling = false;\n\t\tthis.backgroundCalling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.stream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.stream);\n\t\t\tthis.stream = null;\n\t\t}\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onInviteTimeout = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaRemoved = BX.DoNothing;\n\n\t\tclearTimeout(this.callingTimeout);\n\t\tthis.callingTimeout = null;\n\t}\n}\n\nconst transformVoxStats = function (s, BitrixCall)\n{\n\tlet result = {\n\t\tconnection: s.connection,\n\t\toutboundAudio: [],\n\t\toutboundVideo: [],\n\t\tinboundAudio: [],\n\t\tinboundVideo: [],\n\t}\n\n\tlet endpoints = {};\n\tif (BitrixCall.getEndpoints)\n\t{\n\t\tBitrixCall.getEndpoints().forEach(endpoint => endpoints[endpoint.id] = endpoint)\n\t}\n\n\tif (!result.connection.timestamp)\n\t{\n\t\tresult.connection.timestamp = Date.now();\n\t}\n\tfor (let trackId in s.outbound)\n\t{\n\t\tif (!s.outbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tconst statGroup = s.outbound[trackId];\n\t\tfor (let i = 0; i < statGroup.length; i++)\n\t\t{\n\t\t\tlet stat = statGroup[i];\n\t\t\tstat.trackId = trackId;\n\t\t\tif ('audioLevel' in stat)\n\t\t\t{\n\t\t\t\tresult.outboundAudio.push(stat)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.outboundVideo.push(stat)\n\t\t\t}\n\t\t}\n\t}\n\tfor (let trackId in s.inbound)\n\t{\n\t\tif (!s.inbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tlet stat = s.inbound[trackId];\n\t\tif (!('endpoint' in stat))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tstat.trackId = trackId;\n\t\tif ('audioLevel' in stat)\n\t\t{\n\t\t\tresult.inboundAudio.push(stat)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (endpoints[stat.endpoint])\n\t\t\t{\n\t\t\t\tlet videoRenderer = endpoints[stat.endpoint].mediaRenderers.find(r => r.id == stat.trackId)\n\t\t\t\tif (videoRenderer && videoRenderer.element)\n\t\t\t\t{\n\t\t\t\t\tstat.actualHeight = videoRenderer.element.videoHeight;\n\t\t\t\t\tstat.actualWidth = videoRenderer.element.videoWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.inboundVideo.push(stat)\n\t\t}\n\t}\n\treturn result;\n\n}\n","import {Type} from 'main.core'\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\nimport {PlainCall} from './plain_call'\nimport {BitrixCallLegacy} from './bitrix_call_legacy'\nimport {CallStub} from './stub'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\nimport {AbstractCall} from './abstract_call';\nimport {CallAI} from '../call_ai';\nimport { CallSettingsManager } from 'call.lib.settings-manager';\n\nexport const CallState = {\n\tIdle: 'Idle',\n\tProceeding: 'Proceeding',\n\tConnected: 'Connected',\n\tFinished: 'Finished'\n};\n\nexport const UserState = {\n\tIdle: 'Idle',\n\tBusy: 'Busy',\n\tCalling: 'Calling',\n\tUnavailable: 'Unavailable',\n\tDeclined: 'Declined',\n\tReady: 'Ready',\n\tConnecting: 'Connecting',\n\tConnected: 'Connected',\n\tFailed: 'Failed'\n};\n\nexport const EndpointDirection = {\n\tSendOnly: 'send',\n\tRecvOnly: 'recv',\n\tSendRecv: 'sendrecv',\n};\n\nexport const CallType = {\n\tInstant: 1,\n\tPermanent: 2\n};\n\nexport const Provider = {\n\tPlain: 'Plain',\n\tBitrix: 'Bitrix',\n};\n\nexport const StreamTag = {\n\tMain: 'main',\n\tScreen: 'screen'\n};\n\nexport const Direction = {\n\tIncoming: 'Incoming',\n\tOutgoing: 'Outgoing'\n};\n\nexport const Quality = {\n\tVeryHigh: \"very_high\",\n\tHigh: \"high\",\n\tMedium: \"medium\",\n\tLow: \"low\",\n\tVeryLow: \"very_low\"\n};\n\nexport const UserMnemonic = {\n\tall: 'all',\n\tnone: 'none'\n};\n\ntype CreateCallOptions = {\n\ttype: number,\n\tprovider: string,\n\tentityType: string,\n\tentityId: string,\n\tjoinExisting: boolean,\n\tuserIds?: number[],\n\tvideoEnabled?: boolean,\n\tenableMicAutoParameters?: boolean,\n\tdebug?: boolean\n}\n\nexport const CallEvent = {\n\tonUserInvited: 'onUserInvited',\n\tonUserJoined: 'onUserJoined',\n\tonUserStateChanged: 'onUserStateChanged',\n\tonUserMicrophoneState: 'onUserMicrophoneState',\n\tonUserCameraState: 'onUserCameraState',\n\tonCameraPublishing: 'onCameraPublishing',\n\tonMicrophonePublishing: 'onMicrophonePublishing',\n\tonNeedResetMediaDevicesState: 'onNeedResetMediaDevicesState',\n\tonUserVideoPaused: 'onUserVideoPaused',\n\tonUserScreenState: 'onUserScreenState',\n\tonUserCommonRecordState: 'onUserCommonRecordState',\n\tonUserVoiceStarted: 'onUserVoiceStarted',\n\tonUserVoiceStopped: 'onUserVoiceStopped',\n\tonUserFloorRequest: 'onUserFloorRequest', // request for a permission to speak\n\tonAllParticipantsAudioMuted: 'onAllParticipantsAudioMuted',\n\tonAllParticipantsVideoMuted: 'onAllParticipantsVideoMuted',\n\tonAllParticipantsScreenshareMuted: 'onAllParticipantsScreenshareMuted',\n\tonYouMuteAllParticipants: 'onYouMuteAllParticipants',\n\tonRoomSettingsChanged: 'onRoomSettingsChanged',\n\tonUserPermissionsChanged: 'onUserPermissionsChanged',\n\tonUserRoleChanged: 'onUserRoleChanged',\n\tonParticipantMuted: 'onParticipantMuted',\n\tonUserEmotion: 'onUserEmotion',\n\tonUserStatsReceived: 'onUserStatsReceived',\n\tonCustomMessage: 'onCustomMessage',\n\tonLocalMediaReceived: 'onLocalMediaReceived',\n\tonLocalMediaStopped: 'onLocalMediaStopped',\n\tonMicrophoneLevel: 'onMicrophoneLevel',\n\tonDeviceListUpdated: 'onDeviceListUpdated',\n\tonRTCStatsReceived: 'onRTCStatsReceived',\n\tonCallFailure: 'onCallFailure',\n\tonRemoteMediaReceived: 'onRemoteMediaReceived',\n\tonRemoteMediaStopped: 'onRemoteMediaStopped',\n\tonBadNetworkIndicator: 'onBadNetworkIndicator',\n\tonConnectionQualityChanged: 'onConnectionQualityChanged',\n\tonNetworkProblem: 'onNetworkProblem',\n\tonReconnecting: 'onReconnecting',\n\tonReconnected: 'onReconnected',\n\tonJoin: 'onJoin',\n\tonLeave: 'onLeave',\n\tonJoinRoomOffer: 'onJoinRoomOffer',\n\tonJoinRoom: 'onJoinRoom',\n\tonLeaveRoom: 'onLeaveRoom',\n\tonListRooms: 'onListRooms',\n\tonUpdateRoom: 'onUpdateRoom',\n\tonTransferRoomSpeakerRequest: 'onTransferRoomSpeakerRequest',\n\tonTransferRoomSpeaker: 'onTransferRoomSpeaker',\n\tonDestroy: 'onDestroy',\n\tonGetUserMediaEnded: 'onGetUserMediaEnded',\n\tonSwitchTrackRecordStatus: 'onSwitchTrackRecordStatus',\n\tonUpdateLastUsedCameraId: 'onUpdateLastUsedCameraId',\n\tonToggleRemoteParticipantVideo: 'onToggleRemoteParticipantVideo',\n};\n\nconst ajaxActions = {\n\tcreateCall: 'im.call.create',\n\tcreateChildCall: 'im.call.createChildCall',\n\tgetPublicChannels: 'pull.channel.public.list',\n\tgetCall: 'im.call.get'\n};\n\nexport const CallScheme = {\n\tclassic: 1,\n\tjwt: 2,\n};\n\nclass EngineLegacy\n{\n\thandlers = {\n\t\t'Call::incoming': this.#onPullIncomingCall.bind(this),\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.debugFlag = false;\n\t\tthis.calls = {};\n\t\tthis.userId = Number(BX.message('USER_ID'));\n\t\tthis.siteId = '';\n\n\t\tthis.unknownCalls = {};\n\n\t\tthis.restClient = null;\n\t\tthis.pullClient = null;\n\n\t\tthis.finishedCalls = new Set();\n\n\t\tthis.init();\n\t};\n\n\tinit()\n\t{\n\t\tBX.addCustomEvent(\"onPullEvent-call\", this.#onPullEvent.bind(this));\n\t\tBX.addCustomEvent(\"onPullEvent-im\", this.#onPullEvent.bind(this));\n\t\tBX.addCustomEvent(\"onPullClientEvent-im\", this.#onPullClientEvent.bind(this));\n\t};\n\n\tgetSiteId()\n\t{\n\t\treturn this.siteId || BX.message('SITE_ID') || '';\n\t};\n\n\tsetSiteId(siteId)\n\t{\n\t\tthis.siteId = siteId;\n\t};\n\n\tgetCurrentUserId()\n\t{\n\t\treturn this.userId;\n\t};\n\n\tsetCurrentUserId(userId)\n\t{\n\t\tthis.userId = Number(userId);\n\t};\n\n\tsetRestClient(restClient)\n\t{\n\t\tthis.restClient = restClient;\n\t};\n\n\tsetPullClient(pullClient)\n\t{\n\t\tthis.pullClient = pullClient;\n\t};\n\n\tgetRestClient()\n\t{\n\t\treturn this.restClient || BX.rest;\n\t};\n\n\tgetPullClient()\n\t{\n\t\treturn this.pullClient || BX.PULL;\n\t};\n\n\tgetLogService()\n\t{\n\t\treturn BX.message(\"call_log_service\");\n\t};\n\n\tcreateCall(config: CreateCallOptions): Promise<AbstractCall>\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tconst callType = config.type || CallType.Instant;\n\t\t\tconst callProvider = config.provider || this.getDefaultProvider();\n\n\t\t\tif (config.joinExisting)\n\t\t\t{\n\t\t\t\tfor (let callId in this.calls)\n\t\t\t\t{\n\t\t\t\t\tif (this.calls.hasOwnProperty(callId))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst call: AbstractCall = this.calls[callId];\n\t\t\t\t\t\tif (call.provider == config.provider && call.associatedEntity.type == config.entityType && call.associatedEntity.id == config.entityId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.log(callId, \"Found existing call, attaching to it\");\n\n\t\t\t\t\t\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\t\t\t\t\t\tcall: call\n\t\t\t\t\t\t\t}]);\n\n\t\t\t\t\t\t\tHardware.isCameraOn = config.videoEnabled === true;\n\n\t\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\t\tcall: call,\n\t\t\t\t\t\t\t\tisNew: false\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet callParameters = {\n\t\t\t\ttype: callType,\n\t\t\t\tprovider: callProvider,\n\t\t\t\tentityType: config.entityType,\n\t\t\t\tentityId: config.entityId,\n\t\t\t\tjoinExisting: !!config.joinExisting,\n\t\t\t\tuserIds: Type.isArray(config.userIds) ? config.userIds : []\n\t\t\t};\n\n\t\t\tthis.getRestClient().callMethod(ajaxActions.createCall, callParameters).then((response) =>\n\t\t\t{\n\t\t\t\tif (response.error())\n\t\t\t\t{\n\t\t\t\t\tconst error = response.error().getError();\n\t\t\t\t\treturn reject({\n\t\t\t\t\t\tcode: error.error,\n\t\t\t\t\t\tmessage: error.error_description\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst createCallResponse = response.data();\n\n\t\t\t\tif (createCallResponse.userData)\n\t\t\t\t{\n\t\t\t\t\tUtil.setUserData(createCallResponse.userData)\n\t\t\t\t}\n\t\t\t\tif (createCallResponse.publicChannels)\n\t\t\t\t{\n\t\t\t\t\tthis.getPullClient().setPublicIds(Object.values(createCallResponse.publicChannels))\n\t\t\t\t}\n\t\t\t\tif (createCallResponse.ai)\n\t\t\t\t{\n\t\t\t\t\tCallAI.setup(createCallResponse.ai);\n\t\t\t\t}\n\n\t\t\t\tconst callFields = createCallResponse.call;\n\t\t\t\tif (this.calls[callFields['ID']])\n\t\t\t\t{\n\t\t\t\t\tif (this.calls[callFields['ID']] instanceof CallStub)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callFields['ID']].destroy();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Call \" + callFields['ID'] + \" already exists\");\n\t\t\t\t\t\treturn resolve({\n\t\t\t\t\t\t\tcall: this.calls[callFields['ID']],\n\t\t\t\t\t\t\tisNew: false\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\t\t\t\tHardware.isCameraOn = config.videoEnabled === true;\n\t\t\t\tconst call = callFactory.createCall({\n\t\t\t\t\tid: parseInt(callFields['ID']),\n\t\t\t\t\tuuid: callFields['UUID'],\n\t\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\t\tusers: createCallResponse.users,\n\t\t\t\t\tuserData: createCallResponse.userData,\n\t\t\t\t\tenableMicAutoParameters: (config.enableMicAutoParameters !== false),\n\t\t\t\t\ttype: callFields.TYPE,\n\t\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\tdebug: config.debug === true,\n\t\t\t\t\tlogToken: createCallResponse.logToken,\n\t\t\t\t\tconnectionData: createCallResponse.connectionData,\n\t\t\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\t\t\tscheme: callFields['SCHEME'],\n\t\t\t\t});\n\n\t\t\t\tcall.addDialogInfo(callFields.ASSOCIATED_ENTITY);\n\n\t\t\t\tthis.calls[callFields['ID']] = call;\n\n\t\t\t\tif (createCallResponse.isNew)\n\t\t\t\t{\n\t\t\t\t\tthis.log(call.id, \"Creating new call\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(call.id, \"Server returned existing call, attaching to it\");\n\t\t\t\t}\n\n\t\t\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\t\t\tcall: call\n\t\t\t\t}]);\n\n\t\t\t\tresolve({\n\t\t\t\t\tcall: call,\n\t\t\t\t\tuserData: createCallResponse.userData,\n\t\t\t\t\tisNew: createCallResponse.isNew\n\t\t\t\t});\n\t\t\t}).catch(function (error)\n\t\t\t{\n\t\t\t\tif (Type.isFunction(error.error))\n\t\t\t\t{\n\t\t\t\t\terror = error.error().getError();\n\t\t\t\t}\n\t\t\t\treject({\n\t\t\t\t\tcode: error.error,\n\t\t\t\t\tmessage: error.error_description\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t};\n\n\tcreateChildCall(parentId, newProvider, newUsers, config)\n\t{\n\t\tif (!this.calls[parentId])\n\t\t{\n\t\t\treturn Promise.reject('Parent call is not found');\n\t\t}\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tconst parentCall = this.calls[parentId];\n\t\t\tconst callParameters = {\n\t\t\t\tparentId: parentId,\n\t\t\t\tnewProvider: newProvider,\n\t\t\t\tnewUsers: newUsers\n\t\t\t};\n\n\t\t\tthis.getRestClient().callMethod(ajaxActions.createChildCall, callParameters, (response) =>\n\t\t\t{\n\t\t\t\tconst createCallResponse = response.data();\n\t\t\t\tconst callFields = createCallResponse.call;\n\t\t\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\n\t\t\t\tconst call = callFactory.createCall({\n\t\t\t\t\tid: parseInt(callFields['ID']),\n\t\t\t\t\tuuid: callFields['UUID'],\n\t\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\t\tparentId: callFields['PARENT_ID'],\n\t\t\t\t\tdirection: Direction.Outgoing,\n\t\t\t\t\tusers: createCallResponse.users,\n\t\t\t\t\tuserData: createCallResponse.userData,\n\t\t\t\t\tenableMicAutoParameters: parentCall.enableMicAutoParameters !== false,\n\t\t\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\t\t\ttype: callFields.TYPE,\n\t\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t\t},\n\t\t\t\t\tlogToken: createCallResponse.logToken,\n\t\t\t\t\tconnectionData: createCallResponse.connectionData,\n\t\t\t\t\tdebug: config.debug,\n\t\t\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\t\t\tscheme: callFields['SCHEME'],\n\t\t\t\t\t// jwt: callFields['JWT'],\n\t\t\t\t\t// endpoint: callFields['ENDPOINT']\n\t\t\t\t});\n\n\t\t\t\tthis.calls[callFields['ID']] = call;\n\t\t\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\t\t\tcall: call\n\t\t\t\t}]);\n\n\t\t\t\tresolve({\n\t\t\t\t\tcall: call,\n\t\t\t\t\tisNew: createCallResponse.isNew\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\tinstantiateCall(callFields, users, logToken, connectionData, userData): AbstractCall\n\t{\n\t\tif (this.calls[callFields['ID']])\n\t\t{\n\t\t\tconsole.error(\"Call \" + callFields['ID'] + \" already exists\");\n\t\t\treturn this.calls[callFields['ID']];\n\t\t}\n\n\t\tconst callFactory = this.#getCallFactory(callFields['PROVIDER']);\n\t\tconst call = callFactory.createCall({\n\t\t\tid: parseInt(callFields['ID']),\n\t\t\tuuid: callFields['UUID'],\n\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\tinitiatorId: parseInt(callFields['INITIATOR_ID']),\n\t\t\tparentId: callFields['PARENT_ID'],\n\t\t\tdirection: callFields['INITIATOR_ID'] == this.userId ? Direction.Outgoing : Direction.Incoming,\n\t\t\tusers: users,\n\t\t\tuserData: userData,\n\t\t\tassociatedEntity: {\n\t\t\t\tuserCounter: Object.keys(userData).length,\n\t\t\t\t...callFields.ASSOCIATED_ENTITY\n\t\t\t},\n\t\t\ttype: callFields.TYPE,\n\t\t\tstartDate: callFields['START_DATE'],\n\t\t\tlogToken: logToken,\n\t\t\tconnectionData: connectionData,\n\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\tscheme: callFields['SCHEME'],\n\t\t\t// jwt: callFields['JWT'],\n\t\t\t// endpoint: callFields['ENDPOINT'],\n\n\t\t\tevents: {\n\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t}\n\t\t});\n\n\t\tthis.calls[callFields['ID']] = call;\n\n\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\tcall: call\n\t\t}]);\n\n\t\treturn call;\n\t};\n\n\tgetCallWithId(id): Promise<{ call: AbstractCall, isNew: boolean }>\n\t{\n\t\tif (this.calls[id])\n\t\t{\n\t\t\treturn Promise.resolve({\n\t\t\t\tcall: this.calls[id],\n\t\t\t\tisNew: false\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.getRestClient().callMethod(ajaxActions.getCall, {callId: id}).then((answer) =>\n\t\t\t{\n\t\t\t\tconst data = answer.data();\n\t\t\t\tresolve({\n\t\t\t\t\tcall: this.instantiateCall(data.call, data.users, data.logToken, data.connectionData, data.userData),\n\t\t\t\t\tisNew: false\n\t\t\t\t})\n\t\t\t}).catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tif (Type.isFunction(error.error))\n\t\t\t\t{\n\t\t\t\t\terror = error.error().getError();\n\t\t\t\t}\n\t\t\t\treject({\n\t\t\t\t\tcode: error.error,\n\t\t\t\t\tmessage: error.error_description\n\t\t\t\t})\n\t\t\t})\n\t\t})\n\t};\n\n\tgetCallWithDialogId(dialogId: string): ?Object\n\t{\n\t\treturn Object.values(this.calls).find((call) => call.associatedEntity?.id == dialogId);\n\t}\n\n\t#onPullEvent(command: string, params, extra)\n\t{\n\t\tif (params?.call?.SCHEME !== CallScheme.classic)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (command.startsWith('Call::'))\n\t\t{\n\t\t\tif (params.publicIds)\n\t\t\t{\n\t\t\t\tthis.getPullClient().setPublicIds(Object.values(params.publicIds));\n\t\t\t}\n\t\t\tif (params.userData)\n\t\t\t{\n\t\t\t\tUtil.setUserData(params.userData);\n\t\t\t}\n\t\t}\n\n\t\tif (this.handlers[command])\n\t\t{\n\t\t\tthis.handlers[command].call(this, params, extra);\n\t\t}\n\t\telse if (command.startsWith('Call::') && (params['call'] || params['callId']))\n\t\t{\n\t\t\tconst callId = params['call'] ? params['call']['ID'] : params['callId'];\n\t\t\tif (this.calls[callId])\n\t\t\t{\n\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t}\n\t\t\telse if (command === 'Call::finish')\n\t\t\t{\n\t\t\t\tthis.log(callId, 'Got \"Call::finish\" before \"Call::incoming\"');\n\t\t\t\tthis.finishedCalls.add(callId);\n\t\t\t}\n\t\t\telse if (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.#onUnknownCallPing(params, extra).then((result) =>\n\t\t\t\t{\n\t\t\t\t\tif (result && this.calls[callId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPullClientEvent(command: string, params, extra)\n\t{\n\t\tif (command.startsWith('Call::') && params['callId'])\n\t\t{\n\t\t\tconst callId = params['callId'];\n\t\t\tif (this.calls[callId])\n\t\t\t{\n\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t}\n\t\t\telse if (command === 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.#onUnknownCallPing(params, extra).then((result) =>\n\t\t\t\t{\n\t\t\t\t\tif (result && this.calls[callId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.calls[callId].__onPullEvent(command, params, extra);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPullIncomingCall(params, extra)\n\t{\n\t\tconsole.log('#onPullIncomingCall', location.href);\n\t\tif (extra.server_time_ago > 30)\n\t\t{\n\t\t\tconsole.error(\"Call was started too long time ago\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst callFields = params.call;\n\t\tconst callId = parseInt(callFields.ID);\n\t\tlet call;\n\n\t\tif (this.finishedCalls.has(callId))\n\t\t{\n\t\t\tthis.log(callId, 'Got \"Call::incoming\" after \"Call::finish\"');\n\t\t\treturn;\n\t\t}\n\n\t\tif (params.publicIds)\n\t\t{\n\t\t\tthis.getPullClient().setPublicIds(Object.values(params.publicIds));\n\t\t}\n\n\t\tif (params.userData)\n\t\t{\n\t\t\tUtil.setUserData(params.userData);\n\t\t}\n\n\t\tif (this.calls[callId])\n\t\t{\n\t\t\tcall = this.calls[callId];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst callFactory = this.#getCallFactory(callFields.PROVIDER);\n\t\t\tcall = callFactory.createCall({\n\t\t\t\tid: callId,\n\t\t\t\tuuid: callFields.UUID,\n\t\t\t\tinstanceId: Util.getUuidv4(),\n\t\t\t\tparentId: callFields.PARENT_ID || null,\n\t\t\t\tcallFromMobile: params.isLegacyMobile === true,\n\t\t\t\tdirection: Direction.Incoming,\n\t\t\t\tusers: params.users,\n\t\t\t\tuserData: params.userData,\n\t\t\t\tinitiatorId: params.senderId,\n\t\t\t\tassociatedEntity: callFields.ASSOCIATED_ENTITY,\n\t\t\t\ttype: callFields.TYPE,\n\t\t\t\tstartDate: callFields.START_DATE,\n\t\t\t\tlogToken: params.logToken,\n\t\t\t\tconnectionData: params.connectionData,\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: this.#onCallDestroy.bind(this)\n\t\t\t\t},\n\t\t\t\tisCopilotActive: callFields['RECORD_AUDIO'],\n\t\t\t\tscheme: callFields['SCHEME'],\n\t\t\t\t// jwt: callFields['JWT'],\n\t\t\t\t// endpoint: callFields['ENDPOINT']\n\t\t\t});\n\n\t\t\tthis.calls[callId] = call;\n\n\t\t\tBX.onCustomEvent(window, \"CallEvents::callCreated\", [{\n\t\t\t\tcall: call\n\t\t\t}]);\n\t\t}\n\n\t\tif (call)\n\t\t{\n\t\t\tcall.addInvitedUsers(params.invitedUsers);\n\n\t\t\tBX.onCustomEvent(window, \"CallEvents::incomingCall\", [{\n\t\t\t\tcall: call,\n\t\t\t\tvideo: params.video === true,\n\t\t\t\tisLegacyMobile: params.isLegacyMobile === true\n\t\t\t}]);\n\t\t}\n\t\tthis.log(call.id, \"Incoming call \" + call.id);\n\t};\n\n\t#onUnknownCallPing(params, extra)\n\t{\n\t\tconst callId = Number(params.callId);\n\t\tif (extra.server_time_ago > 10)\n\t\t{\n\t\t\tthis.log(callId, \"Error: Ping was sent too long time ago\");\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\t\tif (!this.#isCallAppInitialized())\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tif (this.unknownCalls[callId])\n\t\t{\n\t\t\treturn Promise.resolve(false);\n\t\t}\n\n\t\tthis.unknownCalls[callId] = true;\n\n\t\tif (params.userData)\n\t\t{\n\t\t\tUtil.setUserData(params.userData);\n\t\t}\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.getCallWithId(callId).then(() =>\n\t\t\t{\n\t\t\t\tthis.unknownCalls[callId] = false;\n\t\t\t\tresolve(true);\n\t\t\t}).catch((error) =>\n\t\t\t{\n\t\t\t\tthis.unknownCalls[callId] = false;\n\t\t\t\tthis.log(callId, \"Error: Could not instantiate call\", error);\n\t\t\t\tresolve(false);\n\t\t\t});\n\t\t});\n\t};\n\n\t#onCallDestroy(e)\n\t{\n\t\tconst callId = e.call.id;\n\t\tthis.calls[callId] = new CallStub({\n\t\t\tcallId: callId,\n\t\t\tonDelete: () =>\n\t\t\t{\n\t\t\t\tif (this.calls[callId])\n\t\t\t\t{\n\t\t\t\t\tdelete this.calls[callId];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tBX.onCustomEvent(window, \"CallEvents::callDestroyed\", [{\n\t\t\tcallId: e.call.id\n\t\t}]);\n\t};\n\n\t#isCallAppInitialized()\n\t{\n\t\tif ('BXIM' in window && 'init' in window.BXIM)\n\t\t{\n\t\t\treturn BXIM.init;\n\t\t}\n\t\telse if (BX.Messenger && BX.Messenger.Application && BX.Messenger.Application.conference)\n\t\t{\n\t\t\treturn BX.Messenger.Application.conference.inited;\n\t\t}\n\n\t\t//TODO: support new chat\n\t\treturn true;\n\t};\n\n\tgetDefaultProvider()\n\t{\n\t\treturn Provider.Plain;\n\t};\n\n\tgetConferencePageTag(chatDialogId)\n\t{\n\t\treturn \"conference-open-\" + chatDialogId;\n\t};\n\n\t#getCallFactory(providerType: string)\n\t{\n\t\tif (providerType == Provider.Plain)\n\t\t{\n\t\t\treturn PlainCallFactory;\n\t\t}\n\t\telse if (providerType == Provider.Bitrix)\n\t\t{\n\t\t\treturn BitrixCallFactory;\n\t\t}\n\n\t\tthrow new Error(\"Unknown call provider type \" + providerType);\n\t};\n\n\tdebug(debugFlag: boolean = true): boolean\n\t{\n\t\tthis.debugFlag = !!debugFlag;\n\n\t\treturn this.debugFlag;\n\t};\n\n\tlog()\n\t{\n\t\tconst text = Util.getLogMessage.call(Util, arguments);\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.writeToLogFile(BX.message('USER_ID') + '.video.log', text);\n\t\t}\n\t\tif (this.debugFlag)\n\t\t{\n\t\t\tif (console)\n\t\t\t{\n\t\t\t\tconst a = ['Call log [' + Util.getTimeForLog() + ']: '];\n\t\t\t\tconsole.log.apply(this, a.concat(Array.prototype.slice.call(arguments)));\n\t\t\t}\n\t\t}\n\t};\n\n\tgetAllowedVideoQuality(participantsCount)\n\t{\n\t\tif (participantsCount < 5)\n\t\t{\n\t\t\treturn Quality.VeryHigh\n\t\t}\n\t\telse if (participantsCount < 10)\n\t\t{\n\t\t\treturn Quality.High\n\t\t}\n\t\telse if (participantsCount < 16)\n\t\t{\n\t\t\treturn Quality.Medium\n\t\t}\n\t\telse if (participantsCount < 32)\n\t\t{\n\t\t\treturn Quality.Low\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Quality.VeryLow\n\t\t}\n\t};\n}\n\nclass PlainCallFactory\n{\n\tstatic createCall(config): PlainCall\n\t{\n\t\treturn new PlainCall(config);\n\t}\n}\n\nclass BitrixCallFactory\n{\n\tstatic createCall(config): BitrixCallLegacy\n\t{\n\t\treturn new BitrixCallLegacy(config);\n\t}\n}\n\n\nexport const CallEngineLegacy = new EngineLegacy();\n","import { Type, Extension } from 'main.core';\nimport { CallEngine, Provider, RoomType } from './engine/engine';\nimport { CallEngineLegacy } from './engine/engine_legacy';\nimport {\n\tClientPlatform,\n\tClientVersion,\n\tMediaStreamsKinds,\n\tJoinRequestFailedCodes,\n\tJoinResponseError,\n} from './call_api';\nimport { CallTokenManager } from 'call.lib.call-token-manager';\nimport { CallSettingsManager } from 'call.lib.settings-manager';\n\nimport { Event } from 'main.core';\n\nconst MediaKind = {\n\t[MediaStreamsKinds.Camera]: 'video',\n\t[MediaStreamsKinds.Microphone]: 'audio',\n\t[MediaStreamsKinds.Screen]: 'sharing',\n\t[MediaStreamsKinds.ScreenAudio]: 'sharingAudio',\n};\nimport { CallCommonRecordState } from './call_common_record';\n\nconst blankAvatar = '/bitrix/js/im/images/blank.gif';\n\nlet userData = {}\nlet usersInProcess = {}\n\nlet abortController = null;\n\n/* User role & room permission */\nlet roomPermissions =\n{\n\tAudioEnabled: false,\n\tVideoEnabled: false,\n\tScreenShareEnabled: false,\n};\n\nlet userPermissions =\n{\n\task: false,\n\taudio: true,\n\tcan_approve: false,\n\tchange_role: false,\n\tchange_settings: false,\n\tend_call: false,\n\tgive_permissions: false,\n\tinvite: false,\n\tjoin_call: false,\n\tkick_user: false,\n\tmute: false,\n\tmute_others: false,\n\trecord_call: false,\n\tscreen_share: true,\n\tupdate: false,\n\tvideo: true,\n\tview_users: false,\n};\n\nconst UsersRoles =\n{\n\tADMIN: 'ADMIN', // chat admin\n\tMANAGER: 'MANAGER', // aka moderator\n\tUSER: 'USER', // regular user\n}\n\nconst regularUserRoles = [UsersRoles.USER]; // TODO got this from signaling in future\n\nlet currentUserRole = UsersRoles.USER;\n\nfunction setCurrentUserRole(role)\n{\n\tif (role)\n\t{\n\t\tcurrentUserRole = role.toUpperCase();\n\t}\n}\n\nfunction setRoomPermissions(_roomPermissions)\n{\n\tif (!Type.isPlainObject(_roomPermissions))\n\t{\n\t\treturn;\n\t}\n\n\troomPermissions = _roomPermissions;\n}\n\nfunction setUserPermissionsByRoomPermissions(_roomPermissions)\n{\n\tif (this.isRegularUser(this.getCurrentUserRole()))\n\t{\n\t\tlet permissions = this.getUserPermissions();\n\n\t\tfor (let permission in _roomPermissions)\n\t\t{\n\t\t\tif (_roomPermissions.hasOwnProperty(permission))\n\t\t\t{\n\t\t\t\tswitch (permission)\n\t\t\t\t{\n\t\t\t\t\tcase 'AudioEnabled':\n\t\t\t\t\t\tpermissions.audio = _roomPermissions[permission];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'VideoEnabled':\n\t\t\t\t\t\tpermissions.video = _roomPermissions[permission];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'ScreenShareEnabled':\n\t\t\t\t\t\tpermissions.screen_share = _roomPermissions[permission];\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.setUserPermissions(permissions);\n\t}\n}\n\nfunction updateUserPermissionByNewRoomPermission(_roomPermission, value)\n{\n\tif (this.isRegularUser(this.getCurrentUserRole()))\n\t{\n\t\tlet permissions = this.getUserPermissions();\n\n\t\tswitch (_roomPermission)\n\t\t{\n\t\t\tcase 'audio':\n\t\t\t\tpermissions.audio = value;\n\t\t\t\tbreak;\n\t\t\tcase 'video':\n\t\t\t\tpermissions.video = value;\n\t\t\t\tbreak;\n\t\t\tcase 'screen_share':\n\t\t\t\tpermissions.screen_share = value;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tthis.setUserPermissions(permissions);\n\t}\n}\n\nfunction isRegularUser(_role)\n{\n\treturn regularUserRoles.includes(_role);\n}\n\nfunction getRoomPermissions()\n{\n\treturn roomPermissions;\n}\n\nfunction setUserPermissions(_userPermissions)\n{\n\tif (Type.isPlainObject(_userPermissions))\n\t{\n\t\tfor (let permission in _userPermissions)\n\t\t{\n\t\t\tif (userPermissions.hasOwnProperty(permission))\n\t\t\t{\n\t\t\t\tuserPermissions[permission] = _userPermissions[permission];\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction getUserPermissions()\n{\n\treturn userPermissions;\n}\n\nfunction getCurrentUserRole()\n{\n\treturn currentUserRole;\n}\n\nfunction havePermissionToBroadcast(type)\n{\n\tlet havePermission = false;\n\n\tswitch (type)\n\t{\n\t\tcase 'mic':\n\n\t\t\thavePermission = userPermissions.audio;\n\t\t\tbreak;\n\t\tcase 'cam':\n\n\t\t\thavePermission = userPermissions.video;\n\t\t\tbreak;\n\t\tcase 'screenshare':\n\n\t\t\thavePermission = userPermissions.screen_share;\n\t\t\tbreak;\n\t}\n\n\treturn havePermission;\n}\n\nfunction canControlChangeSettings()\n{\n\treturn !!(userPermissions.change_settings && getCurrentBitrixCall());\n}\n\nfunction canControlGiveSpeakPermission()\n{\n\treturn !!userPermissions.give_permissions;\n}\n\nfunction getUserRoleByUserId(userId)\n{\n\tif (userData.hasOwnProperty(userId))\n\t{\n\t\treturn userData[userId].role;\n\t}\n}\n\n/* ------ */\n\nfunction updateUserData(callId, users)\n{\n\tlet usersToUpdate = [];\n\tfor (let i = 0; i < users.length; i++)\n\t{\n\t\tif (userData.hasOwnProperty(users[i]))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\tusersToUpdate.push(users[i]);\n\t}\n\n\tconst result = new Promise((resolve, reject) => {\n\t\tif (usersToUpdate.length === 0 || !callId)\n\t\t{\n\t\t\tresolve();\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.ajax.runAction('im.call.getUsers', {\n\t\t\tdata: {\n\t\t\t\tcallId,\n\t\t\t\tuserIds: usersToUpdate,\n\t\t\t},\n\t\t}).then((response) => {\n\t\t\tconst data = Type.isPlainObject(response.data) ? response.data : {};\n\n\t\t\tusers.forEach((userId) => {\n\t\t\t\tif (data[userId])\n\t\t\t\t{\n\t\t\t\t\tuserData[userId] = data[userId];\n\t\t\t\t}\n\t\t\t\tdelete usersInProcess[userId];\n\t\t\t});\n\n\t\t\tresolve();\n\t\t}).catch((error) => {\n\t\t\treject(error.answer);\n\t\t});\n\t});\n\n\tfor (const userId of usersToUpdate)\n\t{\n\t\tusersInProcess[userId] = result;\n\t}\n\n\treturn result;\n}\n\nfunction setUserData(users)\n{\n\tfor (let userId in users)\n\t{\n\t\tuserData[userId] = users[userId];\n\n\t}\n\n\t//setCurrentUserRole(userData[CallEngine.getCurrentUserId()].role);\n}\n\nconst getDateForLog = () =>\n{\n\tconst d = new Date();\n\n\treturn d.getFullYear() + \"-\" + lpad(d.getMonth() + 1, 2, '0') + \"-\" + lpad(d.getDate(), 2, '0') + \" \" + lpad(d.getHours(), 2, '0') + \":\" + lpad(d.getMinutes(), 2, '0') + \":\" + lpad(d.getSeconds(), 2, '0') + \".\" + d.getMilliseconds();\n}\n\nconst getTimeForLog = () =>\n{\n\tconst d = new Date();\n\n\treturn lpad(d.getHours(), 2, '0') + \":\" + lpad(d.getMinutes(), 2, '0') + \":\" + lpad(d.getSeconds(), 2, '0') + \".\" + d.getMilliseconds();\n}\n\nfunction lpad(str, length, chr)\n{\n\tstr = str.toString();\n\tchr = chr || ' ';\n\n\tif (str.length > length)\n\t{\n\t\treturn str;\n\t}\n\n\tlet result = '';\n\tfor (let i = 0; i < length - str.length; i++)\n\t{\n\t\tresult += chr;\n\t}\n\n\treturn result + str;\n}\n\nfunction getUser(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId]);\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId]);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId]);\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserCached(userId)\n{\n\treturn userData.hasOwnProperty(userId) ? userData[userId] : null;\n}\n\nfunction getUsers(callId, users)\n{\n\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tupdateUserData(callId, users).then(() =>\n\t\t{\n\t\t\tlet result = {};\n\t\t\tusers.forEach(userId => result[userId] = userData[userId] || {});\n\t\t\treturn resolve(result);\n\t\t});\n\t});\n}\n\nfunction getUserName(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].name ? userData[userId].name : '');\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserAvatar(callId, userId)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tif (userData.hasOwnProperty(userId))\n\t\t{\n\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t}\n\t\telse if (usersInProcess.hasOwnProperty(userId))\n\t\t{\n\t\t\tusersInProcess[userId].then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tupdateUserData(callId, [userId]).then(() =>\n\t\t\t{\n\t\t\t\treturn resolve(userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : '');\n\t\t\t});\n\t\t}\n\t});\n}\n\nfunction getUserAvatars(callId, users)\n{\n\treturn new Promise((resolve, reject) =>\n\t{\n\t\tupdateUserData(callId, users).then(() =>\n\t\t{\n\t\t\tlet result = {};\n\t\t\tusers.forEach((userId) =>\n\t\t\t{\n\t\t\t\tresult[userId] = userData[userId].avatar_hr && !isBlank(userData[userId].avatar_hr) ? userData[userId].avatar_hr : ''\n\t\t\t});\n\t\t\treturn resolve(result);\n\t\t});\n\t});\n}\n\nfunction isAvatarBlank(url)\n{\n\treturn isBlank(url);\n}\n\nfunction getCustomMessage(message, userData)\n{\n\tlet messageText;\n\tif (!Type.isPlainObject(userData))\n\t{\n\t\tuserData = {};\n\t}\n\n\tif (userData.gender && BX.message.hasOwnProperty(message + '_' + userData.gender))\n\t{\n\t\tmessageText = BX.message(message + '_' + userData.gender);\n\t}\n\telse\n\t{\n\t\tmessageText = BX.message(message);\n\t}\n\n\tuserData = convertKeysToUpper(userData);\n\n\treturn messageText.replace(/#.+?#/gm, function (match)\n\t{\n\t\tconst placeHolder = match.substr(1, match.length - 2);\n\t\treturn userData.hasOwnProperty(placeHolder) ? userData[placeHolder] : match;\n\t});\n}\n\nfunction convertKeysToUpper(obj)\n{\n\tvar result = BX.util.objectClone(obj);\n\n\tfor (let k in result)\n\t{\n\t\tconst u = k.toUpperCase();\n\n\t\tif (u != k)\n\t\t{\n\t\t\tresult[u] = result[k];\n\t\t\tdelete result[k];\n\t\t}\n\t}\n\treturn result;\n}\n\nfunction appendChildren(parent, children)\n{\n\tchildren.forEach(child => parent.appendChild(child))\n}\n\nfunction containsVideoTrack(stream: MediaStream)\n{\n\tif (!(stream instanceof MediaStream))\n\t{\n\t\treturn false;\n\t}\n\n\treturn stream.getVideoTracks().length > 0;\n}\n\nfunction hasHdVideo(stream: MediaStream)\n{\n\tif (!(stream instanceof MediaStream) || stream.getVideoTracks().length === 0)\n\t{\n\t\treturn false;\n\t}\n\n\tvar videoTrack = stream.getVideoTracks()[0];\n\tvar trackSettings = videoTrack.getSettings();\n\n\treturn trackSettings.width >= 1280;\n}\n\nfunction findBestElementSize(width, height, userCount, minWidth, minHeight)\n{\n\tminWidth = minWidth || 0;\n\tminHeight = minHeight || 0;\n\tlet bestFilledArea = 0;\n\n\tfor (let i = 1; i <= userCount; i++)\n\t{\n\t\tconst area = getFilledArea(width, height, userCount, i);\n\t\tif (area.area > bestFilledArea && area.elementWidth > minWidth && area.elementHeight > minHeight)\n\t\t{\n\t\t\tbestFilledArea = area.area;\n\t\t\tvar bestWidth = area.elementWidth;\n\t\t\tvar bestHeight = area.elementHeight;\n\t\t}\n\t\tif (area.area < bestFilledArea)\n\t\t{\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (bestFilledArea === 0)\n\t{\n\t\tbestWidth = minWidth;\n\t\tbestHeight = minHeight\n\t}\n\treturn {width: bestWidth, height: bestHeight};\n}\n\nfunction getFilledArea(width, height, userCount, rowCount)\n{\n\tconst columnCount = Math.ceil(userCount / rowCount);\n\tconst maxElementWidth = Math.floor(width / columnCount);\n\tconst maxElementHeight = Math.floor(height / rowCount);\n\n\tconst ratio = maxElementHeight / maxElementWidth;\n\tconst neededRatio = 9 / 16;\n\n\tlet expectedElementHeight;\n\tlet expectedElementWidth;\n\n\tif (ratio < neededRatio)\n\t{\n\t\texpectedElementHeight = maxElementHeight;\n\t\texpectedElementWidth = Math.floor(maxElementWidth * (ratio / neededRatio));\n\t}\n\telse\n\t{\n\t\texpectedElementWidth = maxElementWidth;\n\t\texpectedElementHeight = Math.floor(maxElementHeight * (neededRatio / ratio));\n\t}\n\n\t//console.log(expectedElementWidth + 'x' + expectedElementHeight)\n\tvar area = expectedElementWidth * expectedElementHeight * userCount;\n\n\treturn {area: area, elementWidth: expectedElementWidth, elementHeight: expectedElementHeight};\n}\n\nconst isWebRTCSupported = () =>\n{\n\treturn (typeof webkitRTCPeerConnection != 'undefined' || typeof mozRTCPeerConnection != 'undefined' || typeof RTCPeerConnection != 'undefined');\n}\n\nconst isCallServerAllowed = () =>\n{\n\treturn BX.message('call_server_enabled') === 'Y'\n}\n\nconst isFeedbackAllowed = () =>\n{\n\treturn BX.message('call_allow_feedback') === 'Y'\n}\n\nconst shouldCollectStats = () =>\n{\n\treturn BX.message('call_collect_stats') === 'Y'\n}\n\nconst shouldShowDocumentButton = () =>\n{\n\treturn BX.message('call_docs_status') !== 'N' || BX.message('call_resumes_status') !== 'N';\n}\n\nconst getDocumentsArticleCode = () =>\n{\n\tif (!BX.message('call_docs_status').startsWith('L'))\n\t{\n\t\treturn false;\n\t}\n\n\treturn BX.message('call_docs_status').substr(2);\n}\n\nconst getResumesArticleCode = () =>\n{\n\tif (!BX.message('call_resumes_status').startsWith('L'))\n\t{\n\t\treturn false;\n\t}\n\n\treturn BX.message('call_resumes_status').substr(2);\n}\n\nconst getUserLimit = () =>\n{\n\tif (isCallServerAllowed())\n\t{\n\t\treturn parseInt(BX.message('call_server_max_users'));\n\t}\n\n\treturn parseInt(BX.message('turn_server_max_users'));\n}\n\nconst getClientSelfTestUrl = () =>\n{\n\treturn BX.message('call_client_selftest_url') ?? '';\n}\n\nconst getCallFeatures = () => {\n\treturn BX.message('call_features')\n}\n\nfunction getLogMessage ()\n{\n\tlet text = getDateForLog();\n\n\tfor (let i = 0; i < arguments.length; i++)\n\t{\n\t\tif (arguments[i] instanceof Error)\n\t\t{\n\t\t\ttext = arguments[i].message + \"\\n\" + arguments[i].stack\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\ttext = text + ' | ' + (typeof (arguments[i]) == 'object' ? JSON.stringify(arguments[i]) : arguments[i]);\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\ttext = text + ' | (circular structure)';\n\t\t\t}\n\t\t}\n\t}\n\n\treturn text;\n}\n\nconst getUuidv4 = () =>\n{\n\treturn 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) =>\n\t{\n\t\tconst r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n\t\treturn v.toString(16);\n\t});\n}\n\nfunction reportConnectionResult(callId, connectionResult)\n{\n\tBX.ajax.runAction(\"im.call.reportConnection\", {\n\t\tdata: {\n\t\t\tcallId: callId,\n\t\t\tconnectionResult: connectionResult\n\t\t}\n\t})\n}\n\nfunction sendTelemetryEvent(options)\n{\n\n}\n\nconst isDesktop = () =>\n{\n\treturn typeof (BXDesktopSystem) != \"undefined\" || typeof (BXDesktopWindow) != \"undefined\";\n}\n\nconst getBrowserForStatistics = () =>\n{\n\tif (BX.browser.IsOpera())\n\t{\n\t\treturn 'opera';\n\t}\n\tif (BX.browser.IsChrome())\n\t{\n\t\treturn 'chrome';\n\t}\n\tif (BX.browser.IsFirefox())\n\t{\n\t\treturn 'firefox';\n\t}\n\tif (BX.browser.IsSafari())\n\t{\n\t\treturn 'safari';\n\t}\n\treturn 'other';\n}\n\nfunction isBlank(url)\n{\n\treturn typeof (url) !== \"string\" || url == \"\" || url.endsWith(blankAvatar);\n}\n\nfunction stopMediaStreamAudioTracks(mediaStream)\n{\n\tif (!mediaStream instanceof MediaStream)\n\t{\n\t\treturn;\n\t}\n\n\tmediaStream.getAudioTracks().forEach(function (track)\n\t{\n\t\tif (track.kind === 'audio') {\n\t\t\ttrack.stop();\n\t\t\tmediaStream.removeTrack(track);\n\t\t}\n\t});\n}\n\nfunction stopMediaStreamVideoTracks(mediaStream)\n{\n\tif (!mediaStream instanceof MediaStream)\n\t{\n\t\treturn;\n\t}\n\n\tmediaStream.getTracks().forEach(function (track)\n\t{\n\t\tif (track.kind === 'video') {\n\t\t\ttrack.stop();\n\t\t\tmediaStream.removeTrack(track);\n\t\t}\n\t});\n}\n\nfunction stopMediaStream(mediaStream)\n{\n\tif (!mediaStream instanceof MediaStream)\n\t{\n\t\treturn;\n\t}\n\n\tmediaStream.getTracks().forEach(function (track)\n\t{\n\t\ttrack.stop()\n\t});\n}\n\nfunction getConferenceProvider(): string{\n\tif (isCallServerAllowed())\n\t{\n\t\treturn Provider.Bitrix;\n\t}\n\n\treturn Provider.Plain;\n}\n\nfunction getCurrentBitrixCall()\n{\n\tfor (let callId in CallEngine.calls)\n\t{\n\t\tif(CallEngine.calls[callId].BitrixCall)\n\t\t{\n\t\t\treturn CallEngine.calls[callId];\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tfor (let callId in CallEngineLegacy.calls)\n\t{\n\t\tif(CallEngineLegacy.calls[callId].BitrixCall)\n\t\t{\n\t\t\treturn CallEngineLegacy.calls[callId];\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nfunction setCodecToReport(report, codecs, reportsWithoutCodecs)\n{\n\tif (codecs[report.codecId])\n\t{\n\t\treport.codecName = codecs[report.codecId];\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nfunction saveReportWithoutCodecs(report, reportsWithoutCodecs)\n{\n\tif (reportsWithoutCodecs[report.codecId])\n\t{\n\t\treportsWithoutCodecs[report.codecId].push(report);\n\t}\n\telse\n\t{\n\t\treportsWithoutCodecs[report.codecId] = [report];\n\t}\n}\n\nfunction processReportsWithoutCodecs(report, codecs, reportsWithoutCodecs)\n{\n\tcodecs[report.id] = report.mimeType;\n\tif (reportsWithoutCodecs[report.id])\n\t{\n\t\treportsWithoutCodecs[report.id].forEach(r =>\n\t\t{\n\t\t\tr.codecName = report.mimeType;\n\t\t});\n\t\tdelete reportsWithoutCodecs[report.id];\n\t}\n}\n\nfunction setLocalPacketsLostOrSaveReport(report, remoteReports, reportsWithoutRemoteInfo)\n{\n\tif (remoteReports[report.id])\n\t{\n\t\tconst packetsLostData = calcLocalPacketsLost(report, remoteReports[report.id]);\n\t\treport.packetsLostData = packetsLostData;\n\t\treport.packetsLost = packetsLostData.totalPacketsLost;\n\t\treport.packetsLostExtended = formatPacketsLostData(packetsLostData);\n\t\tdelete remoteReports[report.id];\n\t\treturn true;\n\t}\n\telse if (!report.packetsLostExtended)\n\t{\n\t\treportsWithoutRemoteInfo[report.id] = report;\n\t\treturn false;\n\t}\n}\n\nfunction calcBitrate(currentReport, prevReport, isLocal)\n{\n\tprevReport = prevReport || {};\n\tconst bytes = isLocal\n\t\t? currentReport.bytesSent - (prevReport.bytesSent || 0)\n\t\t: currentReport.bytesReceived - (prevReport.bytesReceived || 0);\n\tconst time = currentReport.timestamp - (prevReport.timestamp || 0);\n\tconst bitrate = 8 * bytes / (time / 1000);\n\treturn bitrate < 0 ? 0 : Math.trunc(bitrate);\n}\n\nfunction calcLocalPacketsLost(currentReport, prevReport, remoteReport)\n{\n\tprevReport = prevReport || {};\n\tconst packetsLost = Math.abs(remoteReport.packetsLost);\n\tconst deltaPacketsSent = currentReport.packetsSent - (prevReport.packetsSent || 0);\n\tconst deltaPacketsLost = packetsLost - (prevReport.packetsLost || 0);\n\tconst percentPacketLost = (deltaPacketsLost / deltaPacketsSent) * 100 || 0;\n\tconst percentPacketLostTotal = (packetsLost / currentReport.packetsSent) * 100 || 0;\n\treturn {\n\t\tcurrentPacketsLost: deltaPacketsLost,\n\t\tcurrentPercentPacketLost: percentPacketLost >= 0 ? Math.trunc(percentPacketLost) : 0,\n\t\ttotalPacketsLost: packetsLost,\n\t\ttotalPercentPacketLost: Math.trunc(percentPacketLostTotal),\n\t};\n}\n\nfunction calcRemotePacketsLost(currentReport, prevReport)\n{\n\tprevReport = prevReport || {};\n\tconst packetsLost = Math.abs(currentReport.packetsLost);\n\tconst deltaPacketsReceived = currentReport.packetsReceived - (prevReport.packetsReceived || 0);\n\tconst deltaPacketsLost = packetsLost - (prevReport.packetsLost || 0);\n\tconst percentPacketLost = (deltaPacketsLost / (deltaPacketsReceived + deltaPacketsLost)) * 100 || 0;\n\tconst percentPacketLostTotal = (packetsLost / (currentReport.packetsReceived + packetsLost)) * 100 || 0;\n\treturn {\n\t\tcurrentPacketsLost: deltaPacketsLost,\n\t\tcurrentPercentPacketLost:  percentPacketLost >= 0 ? Math.trunc(percentPacketLost) : 0,\n\t\ttotalPacketsLost: packetsLost,\n\t\ttotalPercentPacketLost:  Math.trunc(percentPacketLostTotal),\n\t};\n}\n\nfunction formatPacketsLostData(data)\n{\n\treturn `${data.currentPacketsLost} - ${data.currentPercentPacketLost}% (total: ${data.totalPacketsLost} - ${data.totalPercentPacketLost}%)`;\n}\n\nfunction getAvatarBackground()\n{\n\tconst colorList = ['#0154C8', '#1BCE7B', '#B15EF5', '#55D0E0', '#F85E9E', '#0075FF', '#00A94E'];\n\n\treturn colorList[Math.floor(Math.random() * colorList.length)];\n}\n\nfunction getRecordTimeText(recordState, returnInSeconds = false)\n{\n\tif (!recordState)\n\t{\n\t\treturn '';\n\t}\n\n\tconst nowDate = new Date();\n\tlet startDate = new Date(recordState.date.start);\n\n\tif (startDate > nowDate)\n\t{\n\t\tstartDate = nowDate;\n\t}\n\n\tconst pauseTime = recordState.date.pause\n\t\t.map(({ start, finish }) => {\n\t\t\tconst startTime = new Date(start);\n\t\t\tconst finishTime = finish ? new Date(finish) : nowDate;\n\n\t\t\treturn finishTime - startTime;\n\t\t})\n\t\t.reduce((sum, diff) => sum + diff, 0);\n\n\tlet totalTime = nowDate - startDate - pauseTime;\n\tif (totalTime < 0)\n\t{\n\t\ttotalTime = 0;\n\t}\n\n\tlet seconds = Math.round(totalTime / 1000);\n\tif (returnInSeconds)\n\t{\n\t\treturn seconds;\n\t}\n\n\tconst hours = Math.floor(seconds / 3600);\n\tseconds %= 3600;\n\n\tconst minutes = Math.floor(seconds / 60);\n\tseconds %= 60;\n\n\treturn hours > 0\n\t\t? `${hours}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`\n\t\t: `${minutes}:${String(seconds).padStart(2, '0')}`;\n}\n\nfunction getTimeText(startTime)\n{\n\tif (!startTime)\n\t{\n\t\treturn '';\n\t}\n\n\tconst nowDate = new Date();\n\tlet startDate = new Date(startTime);\n\tif (startDate.getTime() < nowDate.getTime())\n\t{\n\t\tstartDate = nowDate;\n\t}\n\n\tlet totalTime = nowDate - startDate;\n\tif (totalTime <= 0)\n\t{\n\t\ttotalTime = 0;\n\t}\n\n\tlet second = Math.floor(totalTime / 1000);\n\n\tlet hour = Math.floor(second / 60 / 60);\n\tif (hour > 0)\n\t{\n\t\tsecond -= hour * 60 * 60;\n\t}\n\n\tconst minute = Math.floor(second / 60);\n\tif (minute > 0)\n\t{\n\t\tsecond -= minute * 60;\n\t}\n\n\treturn (hour > 0 ? hour + ':' : '')\n\t\t+ (hour > 0 ? minute.toString().padStart(2, \"0\") + ':' : minute + ':')\n\t\t+ second.toString().padStart(2, \"0\")\n\t\t;\n}\n\nfunction getTimeInSeconds(startTime)\n{\n\tif (!startTime)\n\t{\n\t\treturn '';\n\t}\n\n\tconst nowDate = new Date();\n\tlet startDate = new Date(startTime);\n\tif (startDate.getTime() < nowDate.getDate())\n\t{\n\t\tstartDate = nowDate;\n\t}\n\n\tlet totalTime = nowDate - startDate;\n\tif (totalTime <= 0)\n\t{\n\t\ttotalTime = 0;\n\t}\n\n\treturn Math.floor(totalTime / 1000);\n}\n\nconst isConferenceChatEnabled = () =>\n{\n\treturn BX.message('conference_chat_enabled');\n}\n\nconst getCallConnectionData = async (callOptions, chatId, mustCreate = true) => {\n\tif (!Type.isPlainObject(callOptions))\n\t{\n\t\tcallOptions = {};\n\t}\n\n\treturn new Promise(async (resolve, reject) =>\n\t{\n\t\tabortController = new AbortController();\n\t\tconst callBalancerUrl = CallSettingsManager.callBalancerUrl;\n\t\tconst url = `${callBalancerUrl}/v2/join?mustCreate=${Boolean(mustCreate)}`;\n\n\t\tconst userToken = await CallTokenManager.getUserToken(chatId);\n\t\tconst isPlainCall = callOptions.provider === Provider.Plain;\n\t\tconst roomType = RoomType.Small;\n\n\t\tconst data = JSON.stringify({\n\t\t\tuserToken,\n\t\t\troomType,\n\t\t\tisOneToOne: isPlainCall,\n\t\t\tclientVersion: ClientVersion,\n\t\t\tclientPlatform: ClientPlatform,\n\t\t\t...callOptions,\n\t\t});\n\n\t\tlet responseInfo = null;\n\t\tfetch(url, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: data,\n\t\t\tsignal: abortController.signal,\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tresponseInfo = { status: response?.status, ok: response?.ok };\n\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tif (error instanceof SyntaxError)\n\t\t\t\t{\n\t\t\t\t\tthrow new JoinResponseError(error.message, JoinRequestFailedCodes.JsonParsingError);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tif (!responseInfo?.ok)\n\t\t\t\t{\n\t\t\t\t\tif (response?.error)\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new JoinResponseError(response?.error?.message, response?.error?.code);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new JoinResponseError(`Response status: ${responseInfo.status}`, JoinRequestFailedCodes.UnexpectedResponse);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresolve(response);\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tif (error?.xhr?.responseText)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst response = JSON.parse(error.xhr.responseText);\n\t\t\t\t\t\tif (response.error)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(response);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcatch (e)\n\t\t\t\t{\n\t\t\t\t\treject(e);\n\t\t\t\t}\n\n\t\t\t\treject(error);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tabortController = null;\n\t\t\t});\n\t});\n};\n\nconst getCallConnectionDataById = async (callUuid) => {\n\tconst call = await CallEngine.getCallWithId(callUuid);\n\n\treturn getCallConnectionData(\n\t\t{\n\t\t\tcallType: call.call.type,\n\t\t\tinstanceId: call.call.instanceId,\n\t\t\tprovider: call.call.provider,\n\t\t\tcallToken: CallTokenManager.getTokenCached(call.call.associatedEntity.chatId),\n\t\t},\n\t\tcall.call.associatedEntity.chatId,\n\t\tfalse,\n\t);\n};\n\nconst abortGetCallConnectionData = () => {\n\tabortController?.abort();\n};\n\nfunction startSelfTest()\n{\n\tconst link = BX.Call.Util.getClientSelfTestUrl();\n\n\tif (isDesktop()) {\n\t\twindow.open(link, '_blank', 'popup');\n\t\treturn;\n\t}\n\n\twindow.open(link, '_blank');\n}\n\nconst useTcpSdp = () =>\n{\n\treturn BX.message('call_use_tcp_sdp') === 'Y';\n}\n\nfunction openArticle(articleCode)\n{\n\tconst infoHelper = BX.UI.InfoHelper;\n\n\tif (infoHelper.isOpen())\n\t{\n\t\tinfoHelper.close()\n\t}\n\n\tinfoHelper.show(articleCode);\n}\n\nconst getAiSettings = () =>\n{\n\treturn Extension.getSettings('call.core')?.ai || {};\n}\n\nconst getCloudRecordSettings = () => {\n\treturn Extension.getSettings('call.core')?.cloudRecord || {}\n}\n\nconst isUserControlFeatureEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isUserControlFeatureEnabled;\n}\n\nconst isDisableCameraNewJoinedUsersFeatureEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isDisableCameraNewJoinedUsersFeatureEnabled;\n}\n\nconst countDisableCameraNewJoinedUsersFeature = () =>\n{\n\treturn Extension.getSettings('call.core')?.countDisableCameraNewJoinedUsersFeature;\n}\n\nconst isStreamQualityFeatureEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isStreamQualityFeatureEnabled;\n}\n\nconst isPictureInPictureFeatureEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isPictureInPictureFeatureEnabled;\n}\n\nconst isMetricsEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isMetricsEnabled;\n}\n\nconst isMetricsLogsEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isMetricsLogsEnabled;\n}\n\nconst isKibanaLogsEnabled = () =>\n{\n\treturn Extension.getSettings('call.core')?.isKibanaLogsEnabled;\n}\n\nconst isChatMountInPage = () =>\n{\n\treturn Extension.getSettings('call.core')?.isAirDesignEnabled && Extension.getSettings('call.core')?.shouldHideQuickAccess;\n}\n\nconst isCloudRecordEnabled = () => {\n\treturn Extension.getSettings('call.core')?.isCloudRecordEnabled;\n};\n\nconst isCloudRecordTariffEnabled = () => {\n\treturn Extension.getSettings('call.core')?.isCloudRecordTariffEnabled;\n};\n\nconst isCloudRecordLogEnabled = () => {\n\treturn Extension.getSettings('call.core')?.isCloudRecordLogEnabled;\n};\n\nconst isCommonRecordStateInactive = (state) => {\n\treturn [CallCommonRecordState.Stopped, CallCommonRecordState.Destroyed].includes(state);\n};\n\n/* ws logger */\n\nfunction sendLog(params)\n{\n\tconst evnt = new Event.BaseEvent({data: params});\n\tEvent.EventEmitter.emit('BX.Call.Logger:sendLog', evnt);\n}\n\nfunction deepParseJSON(value)\n{\n\tif (typeof value === 'string')\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst parsed = JSON.parse(value);\n\t\t\tif (typeof parsed === 'object' && parsed !== null)\n\t\t\t{\n\t\t\t\treturn deepParseJSON(parsed);\n\t\t\t}\n\t\t\treturn parsed;\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\treturn value;\n\t\t}\n\t}\n\telse if (Array.isArray(value))\n\t{\n\t\treturn value.map(item => deepParseJSON(item));\n\t}\n\telse if (typeof value === 'object' && value !== null)\n\t{\n\t\tconst result = {};\n\t\tObject.keys(value).forEach(key => {\n\t\t\tresult[key] = deepParseJSON(value[key]);\n\t\t});\n\t\treturn result;\n\t}\n\telse\n\t{\n\t\treturn value;\n\t}\n}\n\n\nexport default {\n\tMediaKind,\n\tupdateUserData,\n\tsetUserData,\n\tgetDateForLog,\n\tgetTimeForLog,\n\tlpad,\n\tgetUser,\n\tgetUserCached,\n\tgetUsers,\n\tgetUserName,\n\tgetUserAvatar,\n\tgetUserAvatars,\n\tisAvatarBlank,\n\tgetCustomMessage,\n\tconvertKeysToUpper,\n\tappendChildren,\n\tcontainsVideoTrack,\n\thasHdVideo,\n\tfindBestElementSize,\n\tgetFilledArea,\n\tisWebRTCSupported,\n\tisCallServerAllowed,\n\tisFeedbackAllowed,\n\tshouldCollectStats,\n\tshouldShowDocumentButton,\n\tgetDocumentsArticleCode,\n\tgetResumesArticleCode,\n\tgetUserLimit,\n\tgetClientSelfTestUrl,\n\tgetLogMessage,\n\tgetUuidv4,\n\treportConnectionResult,\n\tsendTelemetryEvent,\n\tisDesktop,\n\tgetBrowserForStatistics,\n\tisBlank,\n\tstopMediaStream,\n    stopMediaStreamVideoTracks,\n    stopMediaStreamAudioTracks,\n\tgetConferenceProvider,\n\tgetCurrentBitrixCall,\n\tsetCodecToReport,\n\tsaveReportWithoutCodecs,\n\tprocessReportsWithoutCodecs,\n\tsetLocalPacketsLostOrSaveReport,\n\tcalcBitrate,\n\tcalcLocalPacketsLost,\n\tcalcRemotePacketsLost,\n\tformatPacketsLostData,\n\tgetCallFeatures,\n\tgetAvatarBackground,\n\tgetRecordTimeText,\n\tgetTimeText,\n\tgetTimeInSeconds,\n\tisConferenceChatEnabled,\n\tgetCallConnectionData,\n\tgetCallConnectionDataById,\n\tabortGetCallConnectionData,\n\tstartSelfTest,\n\tuseTcpSdp,\n\topenArticle,\n\tgetAiSettings,\n\tisStreamQualityFeatureEnabled,\n\tgetCloudRecordSettings,\n\tisUserControlFeatureEnabled,\n\tisPictureInPictureFeatureEnabled,\n\tisMetricsEnabled,\n\tisMetricsLogsEnabled,\n\tsendLog,\n\tisChatMountInPage,\n\troomPermissions,\n\tgetCurrentUserRole,\n\thavePermissionToBroadcast,\n\tsetRoomPermissions,\n\tgetRoomPermissions,\n\tsetUserPermissions,\n\tgetUserPermissions,\n\tupdateUserPermissionByNewRoomPermission,\n\tsetUserPermissionsByRoomPermissions,\n\tcanControlChangeSettings,\n\tcanControlGiveSpeakPermission,\n\tsetCurrentUserRole,\n\tUsersRoles,\n\tisRegularUser,\n\tgetUserRoleByUserId,\n\tisDisableCameraNewJoinedUsersFeatureEnabled,\n\tcountDisableCameraNewJoinedUsersFeature,\n\tisKibanaLogsEnabled,\n\tdeepParseJSON,\n\tisCloudRecordEnabled,\n\tisCloudRecordTariffEnabled,\n\tisCommonRecordStateInactive,\n\tisCloudRecordLogEnabled,\n};\n","import { Dom, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\n\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nimport Util from '../util';\nimport { Utils } from 'im.v2.lib.utils';\nimport { checkAndEncodeURI } from '../view/tools';\n\nconst Events = {\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonButtonClick: 'onButtonClick',\n};\n\nconst InternalEvents = {\n\tsetHasCamera: 'CallNotification::setHasCamera',\n\tcontentReady: 'CallNotification::contentReady',\n\tonButtonClick: 'CallNotification::onButtonClick',\n};\n\nconst FirstDesktopVersionWithChrome = 76;\n\nexport type IncomingNotificationParams = {\n\tcallerName: string,\n\tcallerAvatar: string,\n\tcallerType: string,\n\tcallerColor: string,\n\tvideo: boolean,\n\thasCamera: boolean,\n\tmicrophoneState: boolean,\n\tcameraState: boolean,\n\tzIndex: number,\n\tonClose: () => void,\n\tonDestroy: () => void,\n\tonButtonClick: () => void,\n\tisMessengerOpen: boolean,\n}\n\nconst BroadcastChannelName = 'IncomingNotification';\n\nexport class IncomingNotification extends EventEmitter\n{\n\tstatic Events = Events;\n\n\tconstructor(config: IncomingNotificationParams)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.IncomingNotification');\n\n\t\tthis.popup = null;\n\t\tthis.window = null;\n\n\t\tthis.callerAvatar = Type.isStringFilled(config.callerAvatar) ? config.callerAvatar : '';\n\t\tif (Util.isAvatarBlank(this.callerAvatar))\n\t\t{\n\t\t\tthis.callerAvatar = '';\n\t\t}\n\n\t\tthis.callerName = config.callerName;\n\t\tthis.callerType = config.callerType;\n\t\tthis.callerColor = config.callerColor;\n\t\tthis.video = config.video;\n\t\tthis.hasCamera = config.hasCamera === true;\n\t\tthis.zIndex = config.zIndex;\n\t\tthis.isMessengerOpen = config.isMessengerOpen;\n\t\tthis.contentReady = false;\n\t\tthis.postponedEvents = [];\n\t\tthis.microphoneState = config.microphoneState;\n\t\tthis.cameraState = config.cameraState;\n\n\t\tthis.#subscribeEvents(config);\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis.onButtonClickHandler = this.#onButtonClick.bind(this);\n\t\t\tthis.onContentReadyHandler = this.#onContentReady.bind(this);\n\t\t\tDesktopApi.subscribe(InternalEvents.onButtonClick, this.onButtonClickHandler);\n\t\t\tDesktopApi.subscribe(InternalEvents.contentReady, this.onContentReadyHandler);\n\t\t}\n\n\t\tconst broadcastChannel = new BroadcastChannel(BroadcastChannelName);\n\t\tbroadcastChannel.onmessage = (event) => {\n\t\t\tif (event.data.desktopWindowIsReady)\n\t\t\t{\n\t\t\t\tthis.#showInDesktop();\n\t\t\t}\n\t\t};\n\t}\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (const eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config[eventName]);\n\t\t\t}\n\t\t}\n\t}\n\n\t#showInDesktop()\n\t{\n\t\tif (!this.window)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// Workaround to prevent incoming call window from hanging.\n\t\t// Without it, there is a possible scenario, when BXDesktopWindow.ExecuteCommand(\"close\") is executed too early\n\t\t// (if invite window is closed before appearing), which leads to hanging of the window\n\t\tif (this.window.opener.BXIM?.callController && !this.window.opener.BXIM.callController.callNotification)\n\t\t{\n\t\t\tconsole.log('Workaround to prevent incoming call window from hanging');\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('close');\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst width = 352;\n\t\tconst height = 495;\n\n\t\tDom.append(this.content.render(), this.window.document.body);\n\t\tthis.window.BXDesktopWindow?.SetProperty('position', { X: 'STP_CENTER', Y: 'STP_VCENTER', Width: width, Height: height });\n\t}\n\n\tshow()\n\t{\n\t\tconsole.log('incoming notification : SHOW');\n\n\t\tconst params = {\n\t\t\tvideo: this.video,\n\t\t\thasCamera: this.hasCamera,\n\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\tcallerName: this.callerName,\n\t\t\tcallerType: this.callerType,\n\t\t\tcallerColor: this.callerColor,\n\t\t\tmicrophoneState: this.microphoneState,\n\t\t\tcameraState: this.cameraState,\n\t\t\tisMessengerOpen: this.isMessengerOpen,\n\t\t};\n\n\t\tif (DesktopApi.isChatWindow())\n\t\t{\n\t\t\tconsole.log('incoming notification : ISDESKTOP');\n\t\t\tif (this.window)\n\t\t\t{\n\t\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('show');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.content = new IncomingNotificationContent({\n\t\t\t\t\t...params,\n\t\t\t\t});\n\n\t\t\t\tconst js = `\n\t\t\t\t\tconst broadcastChannel = new BroadcastChannel('${BroadcastChannelName}');\n\t\t\t\t\tbroadcastChannel.postMessage({ desktopWindowIsReady: true });\n\t\t\t\t`;\n\t\t\t\tconst htmlContent = DesktopApi.prepareHtml('', js);\n\t\t\t\tthis.window = DesktopApi.createTopmostWindow(htmlContent);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.log('incoming notification : ISNOTDESKTOP');\n\t\t\tthis.content = new IncomingNotificationContent({\n\t\t\t\t...params,\n\t\t\t\tonClose: () => this.emit(Events.onClose),\n\t\t\t\tonDestroy: () => this.emit(Events.onDestroy),\n\t\t\t\tonButtonClick: (e) => this.emit(Events.onButtonClick, { ...e.data }),\n\t\t\t});\n\t\t\tthis.createPopup(this.content.render());\n\t\t\tthis.popup.show();\n\n\t\t\twindow.addEventListener('resize', () => {\n\t\t\t\tthis.onResize();\n\t\t\t});\n\t\t}\n\t}\n\n\tonResize()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.setMaxHeight(document.body.clientHeight);\n\t\t}\n\t}\n\n\tcreatePopup(content)\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-messenger-call-notify',\n\t\t\tbindElement: null,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent,\n\t\t\tcloseIcon: false,\n\t\t\tnoAllPaddings: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\tdisableScroll: true,\n\t\t\tmaxHeight: document.body.clientHeight,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: false,\n\t\t\tdraggable: { restrict: false },\n\t\t\tborderRadius: '25px',\n\t\t\toverlay: { backgroundColor: 'black', opacity: 30 },\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\twindow.removeEventListener('resize', () => {\n\t\t\t\t\t\tthis.onResize();\n\t\t\t\t\t});\n\t\t\t\t\tthis.emit(Events.onClose);\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: () => this.popup = null,\n\t\t\t},\n\t\t});\n\t}\n\n\tsetHasCamera(hasCamera)\n\t{\n\t\tif (this.window)\n\t\t{\n\t\t\t// desktop; send event to the window\n\t\t\tif (this.contentReady)\n\t\t\t{\n\t\t\t\tDesktopApi.emit(InternalEvents.setHasCamera, [hasCamera]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.postponedEvents.push({\n\t\t\t\t\tname: InternalEvents.setHasCamera,\n\t\t\t\t\tparams: [hasCamera],\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (this.content)\n\t\t{\n\t\t\tthis.content.setHasCamera(hasCamera);\n\t\t}\n\t}\n\n\tsendPostponedEvents()\n\t{\n\t\tthis.postponedEvents.forEach((event) => {\n\t\t\tDesktopApi.emit(event.name, event.params);\n\t\t});\n\t\tthis.postponedEvents = [];\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\n\t\tif (this.window)\n\t\t{\n\t\t\tconst desktopVersion = window.BXDesktopSystem?.ApiVersion?.();\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('hide');\n\n\t\t\tif (desktopVersion >= FirstDesktopVersionWithChrome)\n\t\t\t{\n\t\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('close');\n\t\t\t\tthis.window = null;\n\t\t\t}\n\t\t}\n\t\tthis.emit(Events.onClose);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('close');\n\t\t\tthis.window = null;\n\t\t}\n\n\t\tif (this.content)\n\t\t{\n\t\t\tthis.content.destroy();\n\t\t\tthis.content = null;\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.unsubscribe(InternalEvents.onButtonClick, this.onButtonClickHandler);\n\t\t\tDesktopApi.unsubscribe(InternalEvents.contentReady, this.onContentReadyHandler);\n\t\t}\n\t\tthis.emit(Events.onDestroy);\n\n\t\tthis.unsubscribeAll(Events.onButtonClick);\n\t\tthis.unsubscribeAll(Events.onClick);\n\t\tthis.unsubscribeAll(Events.onDestroy);\n\t}\n\n\t#onButtonClick(event)\n\t{\n\t\tthis.emit(Events.onButtonClick, event);\n\t}\n\n\t#onContentReady()\n\t{\n\t\tthis.contentReady = true;\n\t\tthis.sendPostponedEvents();\n\t}\n}\n\nexport class IncomingNotificationContent extends EventEmitter\n{\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.IncomingNotificationContent');\n\n\t\tthis.video = Boolean(config.video);\n\t\tthis.hasCamera = Boolean(config.hasCamera);\n\t\tthis.callerAvatar = config.callerAvatar || '';\n\t\tthis.callerName = config.callerName || BX.message('IM_M_CALL_VIDEO_HD');\n\t\tthis.callerType = config.callerType || 'chat';\n\t\tthis.callerColor = config.callerColor || '';\n\t\tthis.microphoneState = config.microphoneState;\n\t\tthis.cameraState = config.cameraState;\n\t\tthis.isMessengerOpen = config.isMessengerOpen;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null,\n\t\t\tbuttons: {\n\t\t\t\tanswerVideo: null,\n\t\t\t},\n\t\t};\n\n\t\tthis.#subscribeEvents(config);\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis.onHasCameraHandler = this.#onHasCamera.bind(this);\n\t\t\tDesktopApi.subscribe(InternalEvents.setHasCamera, this.onHasCameraHandler);\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.contentReady, []);\n\t\t}\n\t}\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (const eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config[eventName]);\n\t\t\t}\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tconst callerPrefix = BX.message('IM_M_VIDEO_CALL_FROM_MSGVER_1');\n\n\t\tlet avatarClass = '';\n\t\tlet avatarImageStyles;\n\t\tlet avatarImageText = '';\n\n\t\tif (this.callerAvatar)\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: `url('${checkAndEncodeURI(this.callerAvatar)}')`,\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t};\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst callerType = this.callerType === 'private' ? 'user' : this.callerType;\n\n\t\t\tavatarClass = `bx-messenger-panel-avatar-${callerType}`;\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundColor: this.callerColor || '#525252',\n\t\t\t\tbackgroundSize: '40px',\n\t\t\t\tbackgroundPosition: 'center center',\n\t\t\t};\n\t\t\tavatarImageText = Utils.text.getFirstLetters(this.callerName).toUpperCase();\n\t\t}\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: { className: `bx-messenger-call-window${DesktopApi.isDesktop() ? ' desktop' : ''}` },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-call-window-body' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-top' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-title' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-overlay-title-caller-prefix' },\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-overlay-title-caller-prefix-icon' },\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-overlay-title-caller-prefix-text' },\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: callerPrefix,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-overlay-title-caller' },\n\t\t\t\t\t\t\t\t\t\t\ttext: Text.decode(this.callerName),\n\t\t\t\t\t\t\t\t\t\t}),\n\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-photo bx-messenger-videocall-incoming-call-avatar-pulse' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-incoming-call-pulse-element' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-incoming-call-pulse-element' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: `bx-messenger-call-window-photo-left ${avatarClass}`,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-photo-block' },\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: avatarImageStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: avatarImageText,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.elements.windowBottom = Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-bottom' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-buttons' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.buttonsBlock = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-buttons-block' },\n\t\t\t\t\t\t\t\t\t\t\tchildren: [],\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.elements.windowBottom.prepend(\n\t\t\tDom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-call-window-settings-buttons-block' },\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-settings-button' },\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tthis.elements.buttons.toggleMicrophoneIcon = Dom.create('div', {\n\t\t\t\t\t\t\t\tprops: { className: `bx-messenger-call-window-settings-icon microphone-${this.microphoneState ? 'on' : 'off'}` },\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-settings-text microphone' },\n\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_MIC'),\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t],\n\t\t\t\t\t\tevents: { click: this.#onMicrophoneSettingClick.bind(this) },\n\t\t\t\t\t}),\n\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\tprops: { className: `bx-messenger-call-window-settings-button${this.hasCamera ? '' : ' bx-messenger-call-window-button-disabled'}` },\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tthis.elements.buttons.toggleCameraIcon = Dom.create('div', {\n\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\tclassName: `bx-messenger-call-window-settings-icon camera-${this.cameraState && this.hasCamera ? 'on' : 'off'}`,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-settings-text camera' },\n\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_BTN_CAMERA'),\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t],\n\t\t\t\t\t\tevents: { click: this.#onCameraSettingClick.bind(this) },\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t}),\n\t\t);\n\n\t\tthis.elements.buttonsBlock.append(\n\t\t\tDom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-call-window-button-container' },\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-button bx-messenger-call-window-button-danger' },\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\tclassName: 'bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-down',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t],\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: { click: this.#onDeclineButtonClick.bind(this) },\n\t\t\t}),\n\t\t\tthis.elements.buttons.answer = Dom.create('div', {\n\t\t\t\tprops: {\n\t\t\t\t\tclassName: 'bx-messenger-call-window-button-container',\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\tclassName: `bx-messenger-call-window-button${this.withBlur ? ' with-blur' : ''}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-up' },\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t],\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: { click: this.#onAnswerButtonClick.bind(this) },\n\t\t\t}),\n\t\t);\n\n\t\treturn this.elements.root;\n\t}\n\n\tsetHasCamera(hasCamera)\n\t{\n\t\tthis.hasCamera = Boolean(hasCamera);\n\t}\n\n\t#onHasCamera()\n\t{}\n\n\t#onMicrophoneSettingClick()\n\t{\n\t\tthis.microphoneState = !this.microphoneState;\n\n\t\tif (this.microphoneState)\n\t\t{\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.add('microphone-on');\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.remove('microphone-off');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.add('microphone-off');\n\t\t\tthis.elements.buttons.toggleMicrophoneIcon.classList.remove('microphone-on');\n\t\t}\n\t}\n\n\t#onCameraSettingClick()\n\t{\n\t\tthis.cameraState = !this.cameraState;\n\n\t\tif (this.cameraState)\n\t\t{\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.add('camera-on');\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.remove('camera-off');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.add('camera-off');\n\t\t\tthis.elements.buttons.toggleCameraIcon.classList.remove('camera-on');\n\t\t}\n\t}\n\n\t#onAnswerButtonClick()\n\t{\n\t\tif (!this.hasCamera)\n\t\t{\n\t\t\tthis.cameraState = false;\n\t\t\tthis.microphoneState = true;\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: this.microphoneState,\n\t\t\t\t\tvideo: this.cameraState,\n\t\t\t\t},\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: this.microphoneState,\n\t\t\t\t\tvideo: this.cameraState,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\t#onAnswerWithVideoButtonClick()\n\t{\n\t\tif (!this.hasCamera)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: true,\n\t\t\t\t\tvideo: true,\n\t\t\t\t},\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'answer',\n\t\t\t\tmediaParams: {\n\t\t\t\t\taudio: true,\n\t\t\t\t\tvideo: true,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\t#onDeclineButtonClick()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(InternalEvents.onButtonClick, [{\n\t\t\t\tbutton: 'decline',\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit(Events.onButtonClick, {\n\t\t\t\tbutton: 'decline',\n\t\t\t});\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.unsubscribe(InternalEvents.setHasCamera, this.onHasCameraHandler);\n\t\t}\n\t\tthis.unsubscribeAll(Events.onButtonClick);\n\t\tthis.unsubscribeAll(Events.onClick);\n\t\tthis.unsubscribeAll(Events.onDestroy);\n\t}\n}\n","import { Dom, Text, Type } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport Util from '../util';\nimport { Utils } from 'im.v2.lib.utils';\n\nconst Events = {\n\tonButtonClick: 'ConferenceNotification::onButtonClick',\n};\n\n/**\n *\n * @param {Object} config\n * @param {string} config.callerName\n * @param {string} config.callerAvatar\n * @param {number} config.zIndex\n * @param {function} config.onClose\n * @param {function} config.onDestroy\n * @param {function} config.onButtonClick\n * @constructor\n */\nexport class ConferenceNotifications\n{\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\t\tthis.window = null;\n\n\t\tthis.callerAvatar = Type.isStringFilled(config.callerAvatar) ? config.callerAvatar : '';\n\t\tthis.zIndex = config.zIndex;\n\t\tif (Util.isAvatarBlank(this.callerAvatar))\n\t\t{\n\t\t\tthis.callerAvatar = '';\n\t\t}\n\n\t\tthis.callerName = config.callerName;\n\t\tthis.callerColor = config.callerColor;\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t\tonDestroy: Type.isFunction(config.onDestroy) ? config.onDestroy : BX.DoNothing,\n\t\t\tonButtonClick: Type.isFunction(config.onButtonClick) ? config.onButtonClick : BX.DoNothing,\n\t\t};\n\n\t\tthis._onContentButtonClickHandler = this._onContentButtonClick.bind(this);\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.subscribe(Events.onButtonClick, this._onContentButtonClickHandler);\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tif (DesktopApi.isChatWindow())\n\t\t{\n\t\t\tconst params = {\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerColor: this.callerColor,\n\t\t\t};\n\n\t\t\tif (this.window)\n\t\t\t{\n\t\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('show');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst js = `\n\t\t\t\t\twindow.conferenceNotification = new BX.Call.NotificationConferenceContent(${JSON.stringify(params)});\n\t\t\t\t\twindow.conferenceNotification.showInDesktop();\n\t\t\t\t`;\n\t\t\t\tconst html = DesktopApi.prepareHtml('', js);\n\t\t\t\tthis.window = DesktopApi.createTopmostWindow(html);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.content = new NotificationConferenceContent({\n\t\t\t\tcallerAvatar: this.callerAvatar,\n\t\t\t\tcallerName: this.callerName,\n\t\t\t\tcallerColor: this.callerColor,\n\t\t\t\tonClose: this.callbacks.onClose,\n\t\t\t\tonDestroy: this.callbacks.onDestroy,\n\t\t\t\tonButtonClick: this.callbacks.onButtonClick,\n\t\t\t});\n\t\t\tthis.createPopup(this.content.render());\n\t\t\tthis.popup.show();\n\t\t\twindow.addEventListener('resize', () => {\n\t\t\t\tthis.onResize();\n\t\t\t});\n\t\t}\n\t}\n\n\tonResize()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.setMaxHeight(document.body.clientHeight);\n\t\t}\n\t}\n\n\tcreatePopup(content)\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-messenger-call-notify',\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent,\n\t\t\tcloseIcon: false,\n\t\t\tnoAllPaddings: true,\n\t\t\tzIndex: this.zIndex,\n\t\t\toffsetLeft: 0,\n\t\t\toffsetTop: 0,\n\t\t\tcloseByEsc: false,\n\t\t\tdraggable: { restrict: false },\n\t\t\tborderRadius: '25px',\n\t\t\tdisableScroll: true,\n\t\t\tmaxHeight: document.body.clientHeight,\n\t\t\toverlay: { backgroundColor: 'black', opacity: 30 },\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function()\n\t\t\t\t{\n\t\t\t\t\twindow.removeEventListener('resize', () => {\n\t\t\t\t\t\tthis.onResize();\n\t\t\t\t\t});\n\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t}.bind(this),\n\t\t\t\tonPopupDestroy: function()\n\t\t\t\t{\n\t\t\t\t\tthis.popup = null;\n\t\t\t\t}.bind(this),\n\t\t\t},\n\t\t});\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('hide');\n\t\t}\n\t\tthis.callbacks.onClose();\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t\tthis.popup = null;\n\t\t}\n\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand('close');\n\t\t\tthis.window = null;\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.unsubscribe(Events.onButtonClick, this._onContentButtonClickHandler);\n\t\t}\n\t\tthis.callbacks.onDestroy();\n\t}\n\n\t_onContentButtonClick(e)\n\t{\n\t\tthis.callbacks.onButtonClick(e);\n\t}\n}\n\nexport class NotificationConferenceContent\n{\n\tconstructor(config)\n\t{\n\t\tthis.callerAvatar = config.callerAvatar || '';\n\t\tthis.callerName = config.callerName || BX.message('IM_CL_USER');\n\t\tthis.callerColor = config.callerColor || '#525252';\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tavatar: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t\tonDestroy: Type.isFunction(config.onDestroy) ? config.onDestroy : BX.DoNothing,\n\t\t\tonButtonClick: Type.isFunction(config.onButtonClick) ? config.onButtonClick : BX.DoNothing,\n\t\t};\n\t}\n\n\trender()\n\t{\n\t\tlet avatarImageStyles;\n\t\tlet avatarImageText = '';\n\t\tif (this.callerAvatar)\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: `url('${this.callerAvatar}')`,\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t};\n\t\t}\n\t\telse\n\t\t{\n\t\t\tavatarImageStyles = {\n\t\t\t\tbackgroundImage: 'none',\n\t\t\t\tbackgroundColor: this.callerColor,\n\t\t\t\tbackgroundSize: '80px',\n\t\t\t\tbackgroundRepeat: 'no-repeat',\n\t\t\t\tbackgroundPosition: 'center center',\n\t\t\t};\n\t\t\tavatarImageText = Utils.text.getFirstLetters(this.callerName).toUpperCase();\n\t\t}\n\n\t\tthis.elements.root = Dom.create('div', {\n\t\t\tprops: { className: `bx-messenger-call-window${DesktopApi.isDesktop() ? ' desktop' : ''}` },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-messenger-call-window-body' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-top center' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-title' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-overlay-title-caller-prefix' },\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-overlay-title-caller-prefix-icon' },\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-overlay-title-caller-prefix-text' },\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_VIDEO_CALL_FROM_MSGVER_1'),\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\ttext: Text.encode(this.callerName),\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-overlay-title-caller' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-photo bx-messenger-videocall-incoming-call-avatar-pulse' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-incoming-call-pulse-element' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-videocall-incoming-call-pulse-element' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: 'bx-messenger-call-window-photo-left',\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\t\t\tthis.elements.avatar = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-photo-block' },\n\t\t\t\t\t\t\t\t\t\t\t\t\tstyle: avatarImageStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttext: avatarImageText,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-bottom' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-buttons' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tthis.elements.buttonsBlock = Dom.create('div', {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-buttons-block' },\n\t\t\t\t\t\t\t\t\t\t\tchildren: [],\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t}),\n\t\t\t],\n\t\t});\n\n\t\tthis.elements.buttonsBlock.append(\n\t\t\tDom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-call-window-button-container' },\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\tprops: { className: 'bx-messenger-call-window-button bx-messenger-call-window-button-danger' },\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\tclassName: 'bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-down',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t],\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: { click: this._onSkipConferenceButtonClick.bind(this) },\n\t\t\t}),\n\t\t\tDom.create('div', {\n\t\t\t\tprops: { className: 'bx-messenger-call-window-button-container' },\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\tprops: { className: `bx-messenger-call-window-button${this.withBlur ? ' with-blur' : ''}` },\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\tclassName: 'bx-messenger-call-window-button-icon bx-messenger-call-window-button-icon-phone-up',\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t],\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tevents: { click: this._onAnswerConferenceButtonClick.bind(this) },\n\t\t\t}),\n\t\t);\n\n\t\treturn this.elements.root;\n\t}\n\n\tshowInDesktop()\n\t{\n\t\tconst width = 352;\n\t\tconst height = 495;\n\t\tthis.render();\n\t\tdocument.body.appendChild(this.elements.root);\n\t\tDesktopApi.setWindowPosition({\n\t\t\tx: STP_CENTER,\n\t\t\ty: STP_VCENTER,\n\t\t\twidth,\n\t\t\theight,\n\t\t});\n\t}\n\n\t_onAnswerConferenceButtonClick(e)\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(Events.onButtonClick, [{\n\t\t\t\tbutton: 'answerConference',\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tbutton: 'answerConference',\n\t\t\t});\n\t\t}\n\t}\n\n\t_onSkipConferenceButtonClick(e)\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tDesktopApi.emitToMainWindow(Events.onButtonClick, [{\n\t\t\t\tbutton: 'skipConference',\n\t\t\t}]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callbacks.onButtonClick({\n\t\t\t\tbutton: 'skipConference',\n\t\t\t});\n\t\t}\n\t}\n}\n","import {Dom, Type} from 'main.core';\nimport {DesktopApi} from 'im.v2.lib.desktop-api';\n\nimport './css/floating-screenshare.css';\n\nconst Events = {\n\tonBackToCallClick: \"FloatingScreenshare::onBackToCallClick\",\n\tonStopSharingClick: \"FloatingScreenshare::onStopSharingClick\",\n\tonChangeScreenClick: \"FloatingScreenshare::onChangeScreenClick\"\n};\n\nconst POPUP_WIDTH = 291;\nconst POPUP_HEIGHT = 81;\nconst POPUP_OFFSET_X = 80;\nconst POPUP_OFFSET_Y = 80;\n\n/**\n *\n * @param {object} config\n * @constructor\n */\nexport class FloatingScreenShare\n{\n\tconstructor(config)\n\t{\n\t\tif (typeof (config) !== \"object\")\n\t\t{\n\t\t\tconfig = {};\n\t\t}\n\t\tthis.darkMode = config.darkMode || false;\n\n\t\tthis.window = null;\n\t\tthis.sharedWindowX = null;\n\t\tthis.sharedWindowY = null;\n\t\tthis.sharedWindowHeight = null;\n\t\tthis.sharedWindowWidth = null;\n\t\tthis.title = '';\n\t\tthis.app = '';\n\n\t\tthis.screens = [];\n\t\tthis.screenToUse = null;\n\n\t\tthis.callbacks = {\n\t\t\tonBackToCallClick: Type.isFunction(config.onBackToCallClick) ? config.onBackToCallClick : BX.DoNothing,\n\t\t\tonStopSharingClick: Type.isFunction(config.onStopSharingClick) ? config.onStopSharingClick : BX.DoNothing,\n\t\t\tonChangeScreenClick: Type.isFunction(config.onChangeScreenClick) ? config.onChangeScreenClick : BX.DoNothing,\n\t\t};\n\n\t\tthis._onBackToCallClickHandler = this._onBackToCallClick.bind(this);\n\t\tthis._onStopSharingClickHandler = this._onStopSharingClick.bind(this);\n\t\tthis._onChangeScreenClickHandler = this._onChangeScreenClick.bind(this);\n\t\tthis.bindEventHandlers();\n\t};\n\n\tbindEventHandlers()\n\t{\n\t\tDesktopApi.subscribe(Events.onBackToCallClick, this._onBackToCallClickHandler);\n\t\tDesktopApi.subscribe(Events.onStopSharingClick, this._onStopSharingClickHandler);\n\t\tDesktopApi.subscribe(Events.onChangeScreenClick, this._onChangeScreenClickHandler);\n\t}\n\n\tsaveExistingScreens()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (this.screens.length > 0)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tBXDesktopSystem.ListScreenMedia((result) =>\n\t\t\t{\n\t\t\t\tresult.forEach((item) =>\n\t\t\t\t{\n\t\t\t\t\tif (item.id.slice(0, 6) === 'screen')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.screens.push({\n\t\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\t\tx: item.x,\n\t\t\t\t\t\t\ty: item.y,\n\t\t\t\t\t\t\twidth: item.width,\n\t\t\t\t\t\t\theight: item.height\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn resolve();\n\t\t\t});\n\t\t});\n\t}\n\n\t_onBackToCallClick()\n\t{\n\t\tthis.callbacks.onBackToCallClick();\n\t}\n\n\t_onStopSharingClick()\n\t{\n\t\tthis.close();\n\t\tthis.callbacks.onStopSharingClick();\n\t}\n\n\t_onChangeScreenClick()\n\t{\n\t\tthis.callbacks.onChangeScreenClick();\n\t}\n\n\tsetSharingData(data)\n\t{\n\t\treturn this.saveExistingScreens().then(() =>\n\t\t{\n\t\t\tthis.sharedWindowX = data.x + 10;\n\t\t\tthis.sharedWindowY = data.y + 10;\n\t\t\tthis.sharedWindowWidth = data.width;\n\t\t\tthis.sharedWindowHeight = data.height;\n\t\t\tthis.title = data.title;\n\t\t\tthis.app = data.app;\n\n\t\t\tfor (let i = 0; i < this.screens.length; i++)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tthis.sharedWindowX >= this.screens[i].x &&\n\t\t\t\t\tthis.sharedWindowX <= (this.screens[i].x + this.screens[i].width) &&\n\t\t\t\t\tthis.sharedWindowY >= this.screens[i].y &&\n\t\t\t\t\tthis.sharedWindowY <= (this.screens[i].y + this.screens[i].height)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.screenToUse = this.screens[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.screenToUse && this.screens.length > 0)\n\t\t\t{\n\t\t\t\tthis.screenToUse = this.screens[0];\n\t\t\t}\n\t\t}).catch((error) =>\n\t\t{\n\t\t\tconsole.log('save existing screens error', error);\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tif (!DesktopApi.isDesktop() || DesktopApi.getApiVersion() > 74)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.window)\n\t\t{\n\t\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"show\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar params = {\n\t\t\t\ttitle: this.title,\n\t\t\t\tapp: this.app,\n\t\t\t\tsharedWindowX: this.sharedWindowX,\n\t\t\t\tsharedWindowY: this.sharedWindowY,\n\t\t\t\tsharedWindowWidth: this.sharedWindowWidth,\n\t\t\t\tsharedWindowHeight: this.sharedWindowHeight,\n\t\t\t\tscreenToUse: this.screenToUse,\n\t\t\t\tdarkMode: this.darkMode\n\t\t\t};\n\n\t\t\tconst js = `window.FSSC = new BX.Call.FloatingScreenShareContent(${JSON.stringify(params)});`;\n\t\t\tconst htmlContent = DesktopApi.prepareHtml('', js);\n\t\t\tthis.window = DesktopApi.createTopmostWindow(htmlContent);\n\t\t}\n\t}\n\n\thide()\n\t{\n\t\tif (!this.window || !this.window.document)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"hide\");\n\t}\n\n\tclose()\n\t{\n\t\tif (!this.window || !this.window.document)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.window.BXDesktopWindow.ExecuteCommand(\"close\");\n\t\tthis.window = null;\n\t\tthis.visible = false;\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.window)\n\t\t{\n\t\t\tDesktopApi.closeWindow();\n\t\t\tthis.window = null;\n\t\t}\n\n\t\tDesktopApi.unsubscribe(Events.onBackToCallClick, this._onBackToCallClickHandler);\n\t\tDesktopApi.unsubscribe(Events.onStopSharingClick, this._onStopSharingClickHandler);\n\t\tDesktopApi.unsubscribe(Events.onChangeScreenClick, this._onChangeScreenClickHandler);\n\t}\n}\n\nexport class FloatingScreenShareContent\n{\n\tconstructor(config)\n\t{\n\t\tthis.title = config.title || '';\n\t\tthis.app = config.app || '';\n\t\tthis.sharedWindowX = config.sharedWindowX || 0;\n\t\tthis.sharedWindowY = config.sharedWindowY || 0;\n\t\tthis.sharedWindowHeight = config.sharedWindowHeight || 0;\n\t\tthis.sharedWindowWidth = config.sharedWindowWidth || 0;\n\t\tthis.screenToUse = config.screenToUse || null;\n\t\tthis.darkMode = config.darkMode || false;\n\n\t\tthis.elements = {\n\t\t\tcontainer: null\n\t\t};\n\n\t\tthis.render();\n\t\tthis.adjustWindow(POPUP_WIDTH, POPUP_HEIGHT);\n\t};\n\n\trender()\n\t{\n\t\tconst title = this.app ? this.app + ' - ' + this.title : this.title;\n\n\t\tthis.elements.container = Dom.create(\"div\", {\n\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-wrap' + (this.darkMode ? ' dark-mode' : '')},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top-icon'}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-top-text', title: title},\n\t\t\t\t\t\t\ttext: title\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-left'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-back-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-back-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_BACK_TO_CALL')\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onBackToCallClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-center'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-change-screen-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-change-screen-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_CHANGE_SCREEN')\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onChangeScreenClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-bottom-right'},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-stop-icon'}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: 'bx-messenger-call-floating-screenshare-stop-text'},\n\t\t\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_SCREENSHARE_STOP')\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: this.onStopSharingClick.bind(this)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\n\t\tdocument.body.appendChild(this.elements.container);\n\t\tdocument.body.classList.add('bx-messenger-call-floating-screenshare');\n\t}\n\n\tonBackToCallClick()\n\t{\n\t\tthis.dispatchEvent(Events.onBackToCallClick, []);\n\t}\n\n\tonChangeScreenClick()\n\t{\n\t\tthis.dispatchEvent(Events.onChangeScreenClick, []);\n\t}\n\n\tonStopSharingClick()\n\t{\n\t\tthis.dispatchEvent(Events.onStopSharingClick, []);\n\t}\n\n\tadjustWindow(width, height)\n\t{\n\t\tif (!this.screenToUse)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst blockOffset = 22;\n\t\tconst popupPadding = 22;\n\t\tconst leftBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-left').scrollWidth;\n\t\tconst centerBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-center').scrollWidth;\n\t\tconst rightBlockWidth = document.querySelector('.bx-messenger-call-floating-screenshare-bottom-right').scrollWidth;\n\t\tconst fullWidth = leftBlockWidth + centerBlockWidth + rightBlockWidth + (2 * blockOffset) + (2 * popupPadding);\n\t\tif (fullWidth > POPUP_WIDTH)\n\t\t{\n\t\t\twidth = fullWidth;\n\t\t}\n\n\t\tthis.elements.container.style.width = width + \"px\";\n\t\tthis.elements.container.style.height = height + \"px\";\n\n\t\tBXDesktopWindow.SetProperty(\"minClientSize\", {Width: width, Height: height});\n\t\tBXDesktopWindow.SetProperty(\"resizable\", false);\n\t\tBXDesktopWindow.SetProperty(\"closable\", false);\n\t\tBXDesktopWindow.SetProperty(\"title\", BX.message('IM_M_CALL_SCREENSHARE_TITLE'));\n\n\t\tBXDesktopWindow.SetProperty(\"position\", {\n\t\t\tX: this.screenToUse.x + this.screenToUse.width - width - POPUP_OFFSET_X,\n\t\t\tY: this.screenToUse.y + POPUP_OFFSET_Y,\n\t\t\tWidth: width,\n\t\t\tHeight: height,\n\t\t\tMode: STP_FRONT\n\t\t});\n\t}\n\n\tdispatchEvent(name, params)\n\t{\n\t\tlet convertedParams = {};\n\t\tfor (let i = 0; i < params.length; i++)\n\t\t{\n\t\t\tconvertedParams[i] = params[i];\n\t\t}\n\n\t\tconst mainWindow = opener ? opener : top;\n\t\tmainWindow.BXWindows.forEach( (windowItem) =>\n\t\t{\n\t\t\tif (\n\t\t\t\twindowItem &&\n\t\t\t\twindowItem.name !== '' &&\n\t\t\t\twindowItem.BXDesktopWindow &&\n\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent\n\t\t\t)\n\t\t\t{\n\t\t\t\twindowItem.BXDesktopWindow.DispatchCustomEvent(name, convertedParams);\n\t\t\t}\n\t\t});\n\t\tmainWindow.BXDesktopWindow.DispatchCustomEvent(name, convertedParams);\n\t}\n}","import {Dom, Text} from 'main.core'\nimport {Popup} from 'main.popup'\nimport Util from './util'\n\nexport class CallHint\n{\n\tconstructor(options)\n\t{\n\t\tthis.popup = null;\n\n\t\tthis.title = BX.prop.getString(options, \"title\", Text.encode(BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING\")));\n\t\tthis.icon = BX.prop.getString(options, \"icon\", \"mic\");\n\n\t\tthis.bindElement = BX.prop.getElementNode(options, \"bindElement\", null);\n\t\tthis.targetContainer = BX.prop.getElementNode(options, \"targetContainer\", null);\n\t\tthis.callFolded = BX.prop.getBoolean(options, \"callFolded\", false);\n\t\tthis.showAngle = BX.prop.getBoolean(options, \"showAngle\", false);\n\t\tthis.autoCloseDelay = BX.prop.getInteger(options, \"autoCloseDelay\", 5000);\n\t\tthis.maxWidth = BX.prop.getInteger(options, \"maxWidth\", 600);\n\t\tthis.customClassName = BX.prop.getString(options, \"customClassName\", \"\");\n\t\tthis.initiatorName = BX.prop.getString(options, \"initiatorName\", \"\");\n\t\tthis.customRender = BX.prop.getFunction(options, \"customRender\", false);\n\n\t\tthis.buttonsLayout = BX.prop.getString(options, \"buttonsLayout\", \"right\");\n\t\tthis.buttons = BX.prop.getArray(options, \"buttons\", []);\n\n\t\tthis.callbacks = {\n\t\t\tonClose: BX.prop.getFunction(options, \"onClose\", BX.DoNothing),\n\t\t\tonAskSpeakButtonClicked: BX.prop.getFunction(options, \"onAskSpeakButtonClicked\", BX.DoNothing),\n\t\t}\n\t\tthis.autoCloseTimeout = 0;\n\t};\n\n\tshow()\n\t{\n\t\tclearTimeout(this.autoCloseTimeout);\n\t\tif (this.autoCloseDelay > 0)\n\t\t{\n\t\t\tthis.autoCloseTimeout = setTimeout(() => this.onAutoClose(), this.autoCloseDelay);\n\t\t}\n\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.popup = new Popup({\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: this.targetContainer,\n\t\t\tcontent: this.render(),\n\t\t\tpadding: 0,\n\t\t\tcontentPadding: 0,\n\t\t\tclassName: ('bx-call-view-popup-call-hint ' + this.customClassName),\n\t\t\tbackground: '#00428F',\n\t\t\tcontentBackground: '#00428F',\n\t\t\tdarkMode: true,\n\t\t\tcontentBorderRadius: '27px',\n\t\t\tborderRadius: '27px',\n\t\t\t//maxWidth: this.maxWidth,\n\t\t\tangle: (this.showAngle && this.bindElement),\n\t\t\tevents: {\n\t\t\t\tonClose: () => this.popup.destroy(),\n\t\t\t\tonDestroy: () => this.popup = null,\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-body layout-\" + this.buttonsLayout},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-icon \" + this.icon},\n\t\t\t\t}),\t\t\t\t\n\t\t\t\t(this.customRender ? this.customRender() : this.renderPopupMessage()),\n\t\t\t\t(this.buttonsLayout === 'right' ? this.renderButtons() : null),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-close\"},\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick:  () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\t\t\tif (this.popup)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t}\n\t\n\tcreateAskSpeakButton()\n\t{\n\t\treturn new BX.UI.Button({\n\t\t\tbaseClass: \"ui-btn\",\n\t\t\ttext: BX.message(\"CALL_RISE_YOU_HAND_IN_HINT\"),\n\t\t\tsize: BX.UI.Button.Size.EXTRA_SMALL,\n\t\t\tcolor: BX.UI.Button.Color.LIGHT_BORDER,\n\t\t\tnoCaps: true,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.callbacks.onAskSpeakButtonClicked();\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\t\n\t/*renderHandRaiseIcon()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-hand-raise-icon\"},\n\t\t});\n\t}*/\n\n\trenderButtons()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-buttons-container\"},\n\t\t\tchildren: this.buttons.map(button => button.render()),\n\t\t})\n\t}\n\n\trenderPopupMessage()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-call-hint-middle-block\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-text\"},\n\t\t\t\t\thtml: this.getPopupMessage()\n\t\t\t\t}),\n\t\t\t\t(this.buttonsLayout === 'bottom' ? this.renderButtons() : null),\n\t\t\t]\n\t\t});\n\t}\n\n\tgetPopupMessage()\n\t{\n\t\tif (!Util.isDesktop())\n\t\t{\n\t\t\treturn this.title;\n\t\t}\n\t\t\n\t\tlet hotKeyMessage = BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING_HOTKEY\");\n\t\tif (this.callFolded)\n\t\t{\n\t\t\tconst hotkey = (BX.browser.IsMac() ? 'Shift + &#8984; + A' : 'Ctrl + Shift + A');\n\t\t\thotKeyMessage = BX.message(\"IM_CALL_MIC_MUTED_WHILE_TALKING_FOLDED_CALL_HOTKEY\").replace('#HOTKEY#', hotkey);\n\t\t}\n\t\thotKeyMessage = '<span class=\"bx-call-view-popup-call-hint-text-hotkey\">' + hotKeyMessage + '</span>';\n\n\t\treturn this.title + (this.buttonsLayout === 'bottom' ? '' : '<br>') + hotKeyMessage;\n\t}\n\n\t/**\n\t * Returns height in pixels for the popup.\n\t * The height depends on the hotkey hint (hint appears only in the desktop app).\n\t *\n\t * @returns {number}\n\t */\n\tgetPopupHeight()\n\t{\n\t\treturn Util.isDesktop() ? 60 : 54;\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t\tthis.callbacks.onClose();\n\t\t}\n\t}\n\n\tonAutoClose()\n\t{\n\t\tthis.close();\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\n\t\tclearTimeout(this.autoCloseTimeout)\n\t}\n}","import {Dom, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup} from 'main.popup';\nimport {BackgroundDialog} from './background_dialog';\nimport {View} from '../view/view';\nimport '../css/promo-popup.css';\n\nconst Events = {\n\tonActionClick: 'onActionClick',\n\tonClose: 'onClose'\n};\n\nexport class PromoPopup\n{\n\tconstructor(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\t\tthis.promoCode = Type.isStringFilled(options.promoCode) ? options.promoCode : '';\n\t\tthis.bindElement = options.bindElement;\n\n\t\tthis.elements = {\n\t\t\troot: null\n\t\t};\n\t\tthis.popup = null;\n\t\tthis.dontShowAgain = false;\n\t\tthis.eventEmitter = new EventEmitter(this, \"BX.Call.PromoPopup\");\n\n\t\tif (options.events)\n\t\t{\n\t\t\tthis.subscribeToEvents(options.events);\n\t\t}\n\t};\n\n\tsubscribeToEvents(events)\n\t{\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tif (events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t\t}\n\t\t}\n\t};\n\n\trender()\n\t{\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-promo-container\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-promo-content\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-icon-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-icon\"}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-text-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-title\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_TITLE_MSGVER_2\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-text\"},\n\t\t\t\t\t\t\t\t\thtml: BX.message(\"IM_CALL_DOCUMENT_PROMO_TEXT\")\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-refuse\"},\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"input\", {\n\t\t\t\t\t\t\t\t\t\t\tattrs: {type: \"checkbox\"},\n\t\t\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\t\t\tclassName: \"bx-call-promo-refuse-checkbox\",\n\t\t\t\t\t\t\t\t\t\t\t\tid: \"bx-call-promo-refuse-checkbox\"\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\t\t\tchange: this.onCheckboxChange.bind(this)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"label\", {\n\t\t\t\t\t\t\t\t\t\t\tattrs: {for: \"bx-call-promo-refuse-checkbox\"},\n\t\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-refuse-text\"},\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_DONT_SHOW_AGAIN\")\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button-section\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button bx-call-promo-button-action ui-btn ui-btn-round\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_ACTION\"),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.onActionClick.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"button\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-promo-button bx-call-promo-button-action-close ui-btn ui-btn-round\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_DOCUMENT_PROMO_ACTION_CLOSE\"),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tclick: this.close.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t};\n\n\tshow()\n\t{\n\t\tif (!this.elements.root)\n\t\t{\n\t\t\tthis.render();\n\t\t}\n\n\t\tthis.createPopup();\n\t\tthis.popup.show();\n\t};\n\n\tclose()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.popup.close();\n\t};\n\n\tcreatePopup()\n\t{\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-popup',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.elements.root,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tangle: {position: \"bottom\", offset: 49},\n\t\t\tclassName: 'bx-call-promo-popup',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: this.onPopupClose.bind(this),\n\t\t\t}\n\t\t});\n\t};\n\n\tonPopupClose()\n\t{\n\t\tthis.popup.destroy();\n\t\tthis.destroy();\n\t};\n\n\tonCheckboxChange(event)\n\t{\n\t\tthis.dontShowAgain = event.currentTarget.checked;\n\t};\n\n\tonActionClick()\n\t{\n\t\tthis.eventEmitter.emit(Events.onActionClick);\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.eventEmitter.emit(Events.onClose, {dontShowAgain: this.dontShowAgain});\n\n\t\tthis.eventEmitter.unsubscribeAll(Events.onClose);\n\t\tthis.eventEmitter = null;\n\t\tthis.elements = null;\n\t};\n}\n\nPromoPopup.Events = Events;\n\nexport class PromoPopup3D\n{\n\tcallView: View\n\n\tconstructor(options)\n\t{\n\t\toptions = Type.isPlainObject(options) ? options : {};\n\n\t\tthis.callView = options.callView;\n\t\tthis.bindElement = options.bindElement;\n\n\t\tthis.popup = null;\n\n\t\toptions.events = Type.isPlainObject(options.events) ? options.events : {};\n\t\tthis.events = {\n\t\t\tonActionClick: options.events.onActionClick ? options.events.onActionClick : () => {},\n\t\t\tonClose: options.events.onClose ? options.events.onClose : () => {},\n\t\t};\n\t};\n\n\tshow()\n\t{\n\t\tthis.createPopup();\n\t\tthis.popup.show();\n\n\t\tBX.bind(BX('promo-popup-3d-button'), \"click\", this.openWindow.bind(this));\n\t};\n\n\topenWindow()\n\t{\n\t\tBackgroundDialog.open({tab: 'mask'});\n\t\tsetTimeout(() => this.close(), 100);\n\t}\n\n\topenLearningPopup()\n\t{\n\t\tconst bindElement = BX('bx-messenger-videocall-panel-item-with-arrow-camera');\n\t\tif (!bindElement)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst title = BX.message('IM_PROMO_3DAVATAR_30112022_LEARNING_TITLE');\n\t\tconst description = BX.message('IM_PROMO_3DAVATAR_30112022_LEARNING_TEXT');\n\n\t\tconst content = `\n\t\t\t<div class=\"promo-popup-3d-learning-content\">\n\t\t\t\t<h4 class=\"ui-typography-heading-h4 promo-popup-3d-learning-content__title\">${title}</h4>\n\t\t\t\t<p class=\"promo-popup-3d-learning-content__description\">${description}</p>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-learning-popup',\n\t\t\tbindElement: bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\", forceTop: -100, forceLeft: 100, forceBindPosition: true\n\t\t\t},\n\t\t\tangle: {position: \"top\", offset: 49},\n\t\t\tclassName: 'bx-call-promo-popup-learn',\n\t\t\tcontentBackground: 'unset',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.events.onClose();\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\n\t\tthis.callView.subscribe(\n\t\t\tView.Event.onDeviceSelectorShow,\n\t\t\t() => this.popup ? this.popup.close() : ''\n\t\t);\n\t}\n\n\tclose()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.popup.close();\n\t};\n\n\tcreatePopup()\n\t{\n\t\tconst title = BX.message('IM_PROMO_3DAVATAR_30112022_TITLE');\n\t\tconst description = BX.message('IM_PROMO_3DAVATAR_30112022_TEXT');\n\t\tconst btnText = BX.message('IM_PROMO_3DAVATAR_30112022_BUTTON');\n\n\t\tconst content = `\n\t\t\t<div class=\"promo-popup-3d-content\">\n\t\t\t\t<div class=\"promo-popup-3d-content__masks-container\">\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --left-2 --bear\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --left-1 --pole-bear\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --center --fox\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --right-1 --santa\"></div>\n\t\t\t\t\t<div class=\"promo-popup-3d-content__mask --right-2 --owl\"></div>\n\t\t\t\t</div>\n\t\t\t\t<h3 class=\"ui-typography-heading-h2 promo-popup-3d-content__title\">${title}</h3>\n\t\t\t\t<p class=\"promo-popup-3d-content__description\">${description}</p>\n\t\t\t\t<div class=\"promo-popup-3d-content__actions-btn\">\n\t\t\t\t\t<span class=\"ui-btn btn-primary ui-btn-lg ui-btn-round ui-btn-primary\" id=\"promo-popup-3d-button\">${btnText}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.popup = new Popup({\n\t\t\tid: 'bx-call-promo-popup-3d',\n\t\t\tbindElement: this.bindElement,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: content,\n\t\t\tcacheable: false,\n\t\t\tcloseIcon: true,\n\t\t\toverlay: {\n\t\t\t\tbackgroundColor: '#000',\n\t\t\t\topacity: 40,\n\t\t\t},\n\t\t\twidth: 531,\n\t\t\tminHeight: 481,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tclassName: 'bx-call-promo-popup-3d-masks',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: this.onPopupClose.bind(this),\n\t\t\t}\n\t\t});\n\t};\n\n\tonPopupClose()\n\t{\n\t\tthis.popup.destroy();\n\t\tthis.openLearningPopup();\n\t};\n}\n\nPromoPopup3D.Events = Events;\n\n","import {Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport './css/sidebar.css';\n\nconst Events = {\n\tonClose: 'onClose',\n\tonDestroy: 'onDestroy',\n\tonCloseClicked: 'onCloseClicked',\n}\n\nexport class Sidebar extends EventEmitter\n{\n\tconstructor(options)\n\t{\n\t\tsuper()\n\t\tthis.setEventNamespace(\"BX.Call.SideBar\");\n\t\tthis.container = options.container;\n\n\t\tthis.width = BX.prop.getInteger(options, 'width', 200);\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\tclose: null,\n\t\t\tcontentContainer: null,\n\t\t}\n\n\t\tif (options.events)\n\t\t{\n\t\t\tfor (let eventName in options.events)\n\t\t\t{\n\t\t\t\tif (options.events.hasOwnProperty(eventName))\n\t\t\t\t{\n\t\t\t\t\tthis.subscribe(eventName, options.events[eventName]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\trender()\n\t{\n\t\tif (this.elements.root)\n\t\t{\n\t\t\treturn this.elements.root;\n\t\t}\n\n\t\tthis.elements.root = Dom.create(\"div\", {\n\t\t\tprops: {\n\t\t\t\tclassName: \"bx-messenger-call-sidebar-root\"\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-labels\"},\n\t\t\t\t\tstyle: {top: '39px' /*'17px'*/},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label\"},\n\t\t\t\t\t\t\tstyle: {maxWidth: '40px'},\n\t\t\t\t\t\t\tchildren: [Dom.create(\"div\", {\n\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label-icon-box\"},\n\t\t\t\t\t\t\t\tattrs: {title: BX.message(\"IM_M_CALL_BTN_CLOSE\")},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-label-icon bx-messenger-call-sidebar-label-icon-close\"},\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t})],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () => this.emit(Events.onCloseClicked)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tthis.elements.contentContainer = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-messenger-call-sidebar-content-container\"}\n\t\t\t\t})\n\t\t\t]\n\t\t});\n\t\tthis.elements.root.style.setProperty('--sidebar-width', this.width + 'px');\n\n\t\treturn this.elements.root;\n\t}\n\n\tsetWidth(width)\n\t{\n\t\tif (this.width == width)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.width = width;\n\t\tthis.elements.root.style.setProperty('--sidebar-width', this.width + 'px');\n\t}\n\n\topen(animation)\n\t{\n\t\tanimation = animation !== false;\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.container.appendChild(this.render());\n\t\t\tif (animation)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add('opening');\n\t\t\t\tthis.elements.root.addEventListener(\n\t\t\t\t\t'animationend',\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.elements.root.classList.remove('opening');\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tonce: true\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t})\n\t}\n\n\tclose(animation)\n\t{\n\t\tanimation = animation !== false;\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (animation)\n\t\t\t{\n\t\t\t\tthis.elements.root.classList.add('closing');\n\t\t\t\tthis.elements.root.addEventListener(\n\t\t\t\t\t'animationend',\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.container.removeChild(this.elements.root);\n\t\t\t\t\t\tthis.emit(Events.onClose);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tonce: true\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.container.removeChild(this.elements.root);\n\t\t\t\tthis.emit(Events.onClose);\n\t\t\t\tresolve();\n\t\t\t}\n\t\t})\n\t}\n\n\ttoggleHidden(hidden)\n\t{\n\t\tthis.elements.root.classList.toggle('hidden', hidden);\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.emit(Events.onDestroy);\n\t\tthis.unsubscribeAll(Events.onClose);\n\t\tthis.unsubscribeAll(Events.onDestroy);\n\t\tthis.eventEmitter = null;\n\t\tthis.elements = null;\n\t\tthis.container = null;\n\t}\n}","import {Dom, Type} from 'main.core'\nimport {Popup} from 'main.popup'\n\nexport class WebScreenSharePopup\n{\n\tconstructor(options)\n\t{\n\t\tthis.popup = null;\n\t\tthis.options = options || {};\n\n\t\tthis.callbacks = {\n\t\t\tonClose: Type.isFunction(this.options.onClose) ? this.options.onClose : BX.DoNothing,\n\t\t\tonStopSharingClick: Type.isFunction(this.options.onStopSharingClick) ? this.options.onStopSharingClick : BX.DoNothing,\n\t\t}\n\t};\n\n\tshow()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.show();\n\t\t\treturn;\n\t\t}\n\n\t\tvar popupWidth = 400;\n\n\t\tthis.popup = new Popup({\n\t\t\tbindElement: this.options.bindElement,\n\t\t\ttargetContainer: this.options.targetContainer,\n\t\t\tcontent: this.render(),\n\t\t\tpadding: 0,\n\t\t\tcontentPadding: 0,\n\t\t\theight: 38,\n\t\t\twidth: popupWidth,\n\t\t\toffsetTop: -135,\n\t\t\toffsetLeft: (this.options.bindElement.offsetWidth / 2) - (popupWidth / 2) + (this.options.bindElement.offsetWidth / 2),\n\t\t\tclassName: 'bx-call-view-popup-web-screenshare',\n\t\t\tbackground: '#00428F',\n\t\t\tcontentBackground: '#00428F',\n\t\t\tdarkMode: true,\n\t\t\tcontentBorderRadius: '27px',\n\t\t\tborderRadius: '27px',\n\t\t\tangle: false,\n\t\t\tcacheable: false,\n\t\t\tevents: {\n\t\t\t\tonDestroy: () => this.popup = null\n\t\t\t}\n\t\t});\n\n\t\tthis.popup.show();\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create(\"div\", {\n\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-body\"},\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-left\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-icon-screen\"},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-text\"},\n\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_WEB_SCREENSHARE_STATUS\")\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-right\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-stop\"},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-stop-icon\"},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-stop-text\"},\n\t\t\t\t\t\t\t\t\ttext: BX.message(\"IM_CALL_WEB_SCREENSHARE_STOP\"),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () => this.callbacks.onStopSharingClick()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: {className: \"bx-call-view-popup-web-screenshare-close\"},\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.popup.close();\n\t\t\t\t\t\t\t\t\tthis.callbacks.onClose();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t})\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.destroy();\n\t\t}\n\t}\n}","import {Type} from 'main.core';\n\nimport {AbstractCall} from './abstract_call';\nimport {\n\tCallEngine,\n\tEndpointDirection,\n\tUserState,\n\tQuality,\n\tUserMnemonic,\n\tCallEvent,\n\tCallState,\n\tCallType,\n\tProvider\n} from './engine';\nimport {SimpleVAD} from './simple_vad'\nimport {Hardware} from '../call_hardware';\nimport Util from '../util'\n\n/**\n * Implements Call interface\n * Public methods:\n * - inviteUsers\n * - cancel\n * - answer\n * - decline\n * - hangup\n *\n * Events:\n * - onCallStateChanged //not sure about this.\n * - onUserStateChanged\n * - onStreamReceived\n * - onStreamRemoved\n * - onDestroy\n */\n\nconst ajaxActions = {\n\tinvite: 'im.call.invite',\n\tcancel: 'im.call.cancel',\n\tanswer: 'im.call.answer',\n\tdecline: 'im.call.decline',\n\thangup: 'im.call.hangup',\n\tping: 'im.call.ping'\n};\n\nconst pullEvents = {\n\tping: 'Call::ping',\n\tanswer: 'Call::answer',\n\thangup: 'Call::hangup',\n\tuserInviteTimeout: 'Call::userInviteTimeout',\n\trepeatAnswer: 'Call::repeatAnswer',\n};\n\nconst clientEvents = {\n\tvoiceStarted: 'Call::voiceStarted',\n\tvoiceStopped: 'Call::voiceStopped',\n\tmicrophoneState: 'Call::microphoneState',\n\tcameraState: 'Call::cameraState',\n\tvideoPaused: 'Call::videoPaused',\n\tscreenState: 'Call::screenState',\n\trecordState: 'Call::recordState',\n\tfloorRequest: 'Call::floorRequest',\n\temotion: 'Call::emotion',\n\tcustomMessage: 'Call::customMessage',\n\tshowUsers: 'Call::showUsers',\n\tshowAll: 'Call::showAll',\n\thideAll: 'Call::hideAll',\n\n\tjoinRoom: 'Call::joinRoom',\n\tleaveRoom: 'Call::leaveRoom',\n\tlistRooms: 'Call::listRooms',\n\trequestRoomSpeaker: 'Call::requestRoomSpeaker',\n};\n\nconst scenarioEvents = {\n\tviewerJoined: 'Call::viewerJoined',\n\tviewerLeft: 'Call::viewerLeft',\n\n\tjoinRoomOffer: 'Call::joinRoomOffer',\n\ttransferRoomHost: 'Call::transferRoomHost',\n\tlistRoomsResponse: 'Call::listRoomsResponse',\n\troomUpdated: 'Call::roomUpdated',\n};\n\nconst VoximplantCallEvent = {\n\tonCallConference: 'VoximplantCall::onCallConference'\n};\n\nconst pingPeriod = 5000;\nconst backendPingPeriod = 25000;\nconst reinvitePeriod = 5500;\nconst connectionRestoreTime = 15000;\n\n// const MAX_USERS_WITHOUT_SIMULCAST = 6;\n\nexport class VoximplantCall extends AbstractCall\n{\n\tstatic Event = VoximplantCallEvent\n\tpeers: { [key: number]: Peer }\n\tlocalVAD: ?SimpleVAD\n\n\tconstructor(config)\n\t{\n\t\tsuper(config);\n\n\t\tthis.debug = config.debug;\n\n\t\tthis.videoQuality = Quality.VeryHigh; // initial video quality. will drop on new peers connecting\n\n\t\tthis.voximplantCall = null;\n\n\t\tthis.signaling = new Signaling({\n\t\t\tcall: this\n\t\t});\n\n\t\tthis.peers = {};\n\t\tthis.joinedElsewhere = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.localVideoShown = false;\n\t\tthis._localUserState = UserState.Idle;\n\t\tthis.clientEventsBound = false;\n\t\tthis._screenShared = false;\n\t\tthis.videoAllowedFrom = UserMnemonic.all;\n\t\tthis.direction = EndpointDirection.SendRecv;\n\n\t\tthis.microphoneLevelInterval = null;\n\n\t\tthis.rooms = {};\n\n\t\twindow.addEventListener(\"unload\", this.#onWindowUnload);\n\n\t\tthis.initPeers();\n\n\t\tthis.pingUsersInterval = setInterval(this.pingUsers.bind(this), pingPeriod);\n\t\tthis.pingBackendInterval = setInterval(this.pingBackend.bind(this), backendPingPeriod);\n\n\t\tthis.lastPingReceivedTimeout = null;\n\t\tthis.lastSelfPingReceivedTimeout = null;\n\n\t\tthis.reinviteTimeout = null;\n\n\t\t// There are two kinds of reconnection events: from call (for media connection) and from client (for signaling).\n\t\t// So we have to use counter to convert these two events to one\n\t\tthis._reconnectionEventCount = 0;\n\n\t\tthis.pullEventHandlers = {\n\t\t\t'Call::answer': this.#onPullEventAnswer,\n\t\t\t'Call::hangup': this.#onPullEventHangup,\n\t\t\t'Call::usersJoined': this.#onPullEventUsersJoined,\n\t\t\t'Call::usersInvited': this.#onPullEventUsersInvited,\n\t\t\t'Call::userInviteTimeout': this.#onPullEventUserInviteTimeout,\n\t\t\t'Call::ping': this.#onPullEventPing,\n\t\t\t'Call::finish': this.#onPullEventFinish,\n\t\t\t'Call::repeatAnswer': this.#onPullEventRepeatAnswer,\n\t\t}\n\t};\n\n\tget provider()\n\t{\n\t\treturn Provider.Voximplant;\n\t}\n\n\tget screenShared()\n\t{\n\t\treturn this._screenShared;\n\t}\n\n\tset screenShared(screenShared)\n\t{\n\t\tif (screenShared != this._screenShared)\n\t\t{\n\t\t\tthis._screenShared = screenShared;\n\t\t\tthis.signaling.sendScreenState(this._screenShared);\n\t\t}\n\t}\n\n\tget localUserState()\n\t{\n\t\treturn this._localUserState\n\t}\n\n\tset localUserState(state)\n\t{\n\t\tif (state == this._localUserState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.runCallback(CallEvent.onUserStateChanged, {\n\t\t\tuserId: this.userId,\n\t\t\tstate: state,\n\t\t\tpreviousState: this._localUserState,\n\t\t\tdirection: this.direction,\n\t\t});\n\t\tthis._localUserState = state;\n\t}\n\n\tget reconnectionEventCount()\n\t{\n\t\treturn this._reconnectionEventCount;\n\t}\n\n\tset reconnectionEventCount(newValue)\n\t{\n\t\tif (this._reconnectionEventCount === 0 && newValue > 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnecting);\n\t\t}\n\t\tif (newValue === 0)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onReconnected);\n\t\t}\n\t\tthis._reconnectionEventCount = newValue;\n\t}\n\n\tinitPeers()\n\t{\n\t\tthis.users.forEach((userId) =>\n\t\t{\n\t\t\tuserId = Number(userId);\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t});\n\t};\n\n\treinitPeers()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t\tthis.peers[userId] = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.initPeers();\n\t};\n\n\tpingUsers()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tconst users = this.users.concat(this.userId);\n\t\t\tthis.signaling.sendPingToUsers({userId: users}, true);\n\t\t}\n\t};\n\n\tpingBackend()\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendPingToBackend();\n\t\t}\n\t};\n\n\tcreatePeer(userId)\n\t{\n\t\tlet incomingVideoAllowed;\n\t\tif (this.videoAllowedFrom === UserMnemonic.all)\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\t\telse if (this.videoAllowedFrom === UserMnemonic.none)\n\t\t{\n\t\t\tincomingVideoAllowed = false;\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tincomingVideoAllowed = this.videoAllowedFrom.some(allowedUserId => allowedUserId == userId);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tincomingVideoAllowed = true;\n\t\t}\n\n\t\treturn new Peer({\n\t\t\tcall: this,\n\t\t\tuserId: userId,\n\t\t\tready: userId == this.initiatorId,\n\t\t\tisIncomingVideoAllowed: incomingVideoAllowed,\n\n\t\t\tonMediaReceived: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaReceived, e);\n\t\t\t\tif (e.kind === 'video')\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tvideoPaused: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRemoved: (e) =>\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onRemoteMediaStopped, e);\n\t\t\t},\n\t\t\tonMediaRenderEnabled: (e) =>\n\t\t\t{\n\t\t\t\tconst endpoint = e.endpoint;\n\t\t\t\tconst userName = endpoint.userName;\n\t\t\t\t// user connected to conference (userName is in format `user${id}`\n\t\t\t\tconst userId = parseInt(userName.substring(4));\n\t\t\t\tif (this.peers[userId])\n\t\t\t\t{\n\t\t\t\t\tthis.runCallback(CallEvent.onBadNetworkIndicator, {\n\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\tbadNetworkIndicator: false\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonMediaRenderDisabled: (e) =>\n\t\t\t{\n\t\t\t\tconst endpoint = e.endpoint;\n\t\t\t\tconst userName = endpoint.userName;\n\t\t\t\tif (Type.isStringFilled(userName) && userName.startsWith('user'))\n\t\t\t\t{\n\t\t\t\t\tconst userId = parseInt(userName.substring(4));\n\t\t\t\t\tif (this.peers[userId] && e.reason === 'disabledByServer')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback(CallEvent.onBadNetworkIndicator, {\n\t\t\t\t\t\t\tuserId: userId,\n\t\t\t\t\t\t\tbadNetworkIndicator: true\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tonVoiceStarted: () =>\n\t\t\t{\n\t\t\t\t// todo: uncomment to switch to SDK VAD events\n\t\t\t\t/*this.runCallback(Event.onUserVoiceStarted, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});*/\n\t\t\t},\n\t\t\tonVoiceEnded: () =>\n\t\t\t{\n\t\t\t\t// todo: uncomment to switch to SDK VAD events\n\t\t\t\t/*this.runCallback(Event.onUserVoiceStopped, {\n\t\t\t\t\tuserId: userId\n\t\t\t\t});*/\n\t\t\t},\n\t\t\tonStateChanged: this.#onPeerStateChanged,\n\t\t\tonInviteTimeout: this.#onPeerInviteTimeout,\n\n\t\t})\n\t};\n\n\tgetUsers()\n\t{\n\t\tlet result = {};\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tresult[userId] = this.peers[userId].calculatedState;\n\t\t}\n\t\treturn result;\n\t};\n\n\tgetUserCount()\n\t{\n\t\treturn Object.keys(this.peers).length;\n\t};\n\n\tgetClient()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tBX.Voximplant.getClient({\n\t\t\t\tdebug: this.debug,\n\t\t\t\trestClient: CallEngine.getRestClient(),\n\t\t\t}).then((client) =>\n\t\t\t{\n\t\t\t\tclient.enableSilentLogging();\n\t\t\t\tclient.setLoggerCallback((e) => this.log(e.label + \": \" + e.message));\n\t\t\t\tthis.log(\"User agent: \" + navigator.userAgent);\n\t\t\t\tthis.log(\"Voximplant SDK version: \" + VoxImplant.version);\n\n\t\t\t\tthis.bindClientEvents();\n\n\t\t\t\tresolve(client);\n\t\t\t}).catch(reject);\n\t\t});\n\t};\n\n\tbindClientEvents()\n\t{\n\t\tconst streamManager = VoxImplant.Hardware.StreamManager.get();\n\n\t\tif (!this.clientEventsBound)\n\t\t{\n\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.MicAccessResult, this.#onMicAccessResult);\n\t\t\tif (VoxImplant.Events.Reconnecting)\n\t\t\t{\n\t\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.Reconnecting, this.#onClientReconnecting);\n\t\t\t\tVoxImplant.getInstance().on(VoxImplant.Events.Reconnected, this.#onClientReconnected);\n\t\t\t}\n\n\t\t\t// streamManager.on(VoxImplant.Hardware.HardwareEvents.DevicesUpdated, this.#onLocalDevicesUpdated);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.MediaRendererAdded, this.#onLocalMediaRendererAdded);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.MediaRendererUpdated, this.#onLocalMediaRendererAdded);\n\t\t\tstreamManager.on(VoxImplant.Hardware.HardwareEvents.BeforeMediaRendererRemoved, this.#onBeforeLocalMediaRendererRemoved);\n\t\t\tthis.clientEventsBound = true;\n\t\t}\n\t};\n\n\tremoveClientEvents()\n\t{\n\t\tif (!('VoxImplant' in window))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tVoxImplant.getInstance().off(VoxImplant.Events.MicAccessResult, this.#onMicAccessResult);\n\t\tif (VoxImplant.Events.Reconnecting)\n\t\t{\n\t\t\tVoxImplant.getInstance().off(VoxImplant.Events.Reconnecting, this.#onClientReconnecting);\n\t\t\tVoxImplant.getInstance().off(VoxImplant.Events.Reconnected, this.#onClientReconnected);\n\t\t}\n\n\t\tconst streamManager = VoxImplant.Hardware.StreamManager.get();\n\t\t// streamManager.off(VoxImplant.Hardware.HardwareEvents.DevicesUpdated, this.#onLocalDevicesUpdated);\n\t\tstreamManager.off(VoxImplant.Hardware.HardwareEvents.MediaRendererAdded, this.#onLocalMediaRendererAdded);\n\t\tstreamManager.off(VoxImplant.Hardware.HardwareEvents.BeforeMediaRendererRemoved, this.#onBeforeLocalMediaRendererRemoved);\n\t\tthis.clientEventsBound = false;\n\t};\n\n\tsetMuted = (event) =>\n\t{\n\t\tif (this.muted == event.data.isMicrophoneMuted)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.muted = event.data.isMicrophoneMuted;\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tif (this.muted)\n\t\t\t{\n\t\t\t\tthis.voximplantCall.muteMicrophone();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.voximplantCall.unmuteMicrophone();\n\t\t\t}\n\t\t\tthis.signaling.sendMicrophoneState(!this.muted);\n\t\t}\n\t};\n\n\tsetVideoEnabled = (event) =>\n\t{\n\t\tif (this.videoEnabled == event.data.isCameraOn)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.videoEnabled = event.data.isCameraOn;\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tif (this.videoEnabled)\n\t\t\t{\n\t\t\t\tthis.#showLocalVideo();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.localVideoShown)\n\t\t\t\t{\n\t\t\t\t\tVoxImplant.Hardware.StreamManager.get().hideLocalVideo().then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\t\t\t\ttag: \"main\",\n\t\t\t\t\t\t\tstream: new MediaStream(),\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.voximplantCall.sendVideo(this.videoEnabled);\n\t\t\tthis.signaling.sendCameraState(this.videoEnabled);\n\t\t}\n\t};\n\n\tsetCameraId(cameraId)\n\t{\n\t\tif (this.cameraId == cameraId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.cameraId = cameraId;\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tVoxImplant.Hardware.CameraManager.get().getInputDevices().then(() =>\n\t\t\t{\n\t\t\t\tVoxImplant.Hardware.CameraManager.get().setCallVideoSettings(this.voximplantCall, this.constructCameraParams());\n\t\t\t});\n\t\t}\n\t};\n\n\tsetMicrophoneId(microphoneId)\n\t{\n\t\tif (this.microphoneId == microphoneId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.microphoneId = microphoneId;\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().getInputDevices().then(() =>\n\t\t\t{\n\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setCallAudioSettings(this.voximplantCall, {\n\t\t\t\t\tinputId: this.microphoneId\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t};\n\n\tgetCurrentMicrophoneId()\n\t{\n\t\tif (this.voximplantCall.peerConnection.impl.getTransceivers)\n\t\t{\n\t\t\tconst transceivers = this.voximplantCall.peerConnection.impl.getTransceivers();\n\t\t\tif (transceivers.length > 0)\n\t\t\t{\n\t\t\t\tconst audioTrack = transceivers[0].sender.track;\n\t\t\t\tconst audioTrackSettings = audioTrack.getSettings();\n\t\t\t\treturn audioTrackSettings.deviceId;\n\t\t\t}\n\t\t}\n\t\treturn this.microphoneId;\n\t};\n\n\tconstructCameraParams()\n\t{\n\t\tlet result = {};\n\n\t\tif (this.cameraId)\n\t\t{\n\t\t\tresult.cameraId = this.cameraId;\n\t\t}\n\n\t\tresult.videoQuality = this.videoHd ? VoxImplant.Hardware.VideoQuality.VIDEO_SIZE_HD : VoxImplant.Hardware.VideoQuality.VIDEO_SIZE_nHD;\n\t\tresult.facingMode = true;\n\t\treturn result;\n\t};\n\n\tuseHdVideo(flag)\n\t{\n\t\tthis.videoHd = (flag === true);\n\t};\n\n\trequestFloor(requestActive)\n\t{\n\t\tthis.signaling.sendFloorRequest(requestActive);\n\t};\n\n\tsendLocalRecordState(recordState)\n\t{\n\t\tthis.signaling.sendLocalRecordState(recordState);\n\t};\n\n\tsendEmotion(toUserId, emotion)\n\t{\n\t\tthis.signaling.sendEmotion(toUserId, emotion);\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\tthis.signaling.sendCustomMessage(message, repeatOnConnect);\n\t};\n\n\t/**\n\t * Updates list of users,\n\t */\n\tallowVideoFrom(userList: $Keys<typeof UserMnemonic> | number[])\n\t{\n\t\tif (this.videoAllowedFrom == userList)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.videoAllowedFrom = userList;\n\n\t\tif (userList === UserMnemonic.all)\n\t\t{\n\t\t\tthis.signaling.sendShowAll();\n\t\t\tuserList = Object.keys(this.peers);\n\t\t}\n\t\telse if (userList === UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t\tuserList = [];\n\t\t}\n\t\telse if (Type.isArray(userList))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(userList)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error(\"userList is in wrong format\");\n\t\t}\n\n\t\tlet users = {};\n\t\tuserList.forEach(userId => users[userId] = true);\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (!this.peers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (users[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId].allowIncomingVideo(false);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * Sets bitrate cap for outgoing video\n\t * @param bitrate\n\t * @deprecated\n\t */\n\n\t/*#setMaxBitrate(bitrate)\n\t{\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tconst transceivers = this.voximplantCall.peerConnection.getTransceivers();\n\t\t\tif (!transceivers)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttransceivers.forEach((tr) =>\n\t\t\t{\n\t\t\t\tif (tr.sender && tr.sender.track && tr.sender.track.kind === 'video' && !tr.stoped && tr.currentDirection.indexOf('send') !== -1)\n\t\t\t\t{\n\t\t\t\t\tconst sender = tr.sender;\n\t\t\t\t\tconst parameters = sender.getParameters();\n\t\t\t\t\tif (!parameters.encodings)\n\t\t\t\t\t{\n\t\t\t\t\t\tparameters.encodings = [{}];\n\t\t\t\t\t}\n\t\t\t\t\tif (bitrate === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tdelete parameters.encodings[0].maxBitrate;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tparameters.encodings[0].maxBitrate = bitrate * 1000;\n\t\t\t\t\t}\n\t\t\t\t\tsender.setParameters(parameters);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};*/\n\n\t#showLocalVideo()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tVoxImplant.Hardware.StreamManager.get().showLocalVideo(false).then(\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = true;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t)\n\t\t})\n\t};\n\n\t#hideLocalVideo()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (!('VoxImplant' in window))\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tVoxImplant.Hardware.StreamManager.get().hideLocalVideo().then(\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\t() =>\n\t\t\t\t{\n\t\t\t\t\tthis.localVideoShown = false;\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t);\n\t\t})\n\t};\n\n\tstartScreenSharing()\n\t{\n\t\tif (!this.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst showLocalView = !Hardware.isCameraOn;\n\t\tconst replaceTrack = Hardware.isCameraOn || this.screenShared;\n\n\t\tthis.voximplantCall.shareScreen(showLocalView, replaceTrack)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Screen shared\");\n\t\t\t\tthis.screenShared = true;\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.log(\"Screen sharing error:\", error)\n\t\t\t})\n\t\t;\n\t};\n\n\tstopScreenSharing()\n\t{\n\t\tif (!this.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.voximplantCall.stopSharingScreen()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Screen is no longer shared\");\n\t\t\t\tthis.screenShared = false;\n\t\t\t})\n\t\t;\n\t};\n\n\tisScreenSharingStarted()\n\t{\n\t\treturn this.screenShared;\n\t};\n\n\t/**\n\t * Invites users to participate in the call.\n\t */\n\tinviteUsers(config: { users: number[] } = {})\n\t{\n\t\tthis.ready = true;\n\t\tlet users = Type.isArray(config.users) ? config.users : this.users;\n\n\t\tthis.attachToConference()\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.signaling.sendPingToUsers({userId: users});\n\n\t\t\t\tif (users.length > 0)\n\t\t\t\t{\n\t\t\t\t\treturn this.signaling.inviteUsers({\n\t\t\t\t\t\tuserIds: users,\n\t\t\t\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t\tfor (let i = 0; i < users.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst userId = parseInt(users[i]);\n\t\t\t\t\tif (!this.users.includes(userId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.users.push(userId);\n\t\t\t\t\t}\n\t\t\t\t\tif (!this.peers[userId])\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\n\t\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\t\t\t\t\tuserId: userId\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t\tthis.scheduleRepeatInvite();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(e)\n\t\t\t})\n\t\t;\n\t};\n\n\tscheduleRepeatInvite()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tthis.reinviteTimeout = setTimeout(() => this.repeatInviteUsers(), reinvitePeriod)\n\t};\n\n\trepeatInviteUsers()\n\t{\n\t\tclearTimeout(this.reinviteTimeout);\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tlet usersToRepeatInvite = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId].calculatedState === UserState.Calling)\n\t\t\t{\n\t\t\t\tusersToRepeatInvite.push(userId);\n\t\t\t}\n\t\t}\n\n\t\tif (usersToRepeatInvite.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst inviteParams = {\n\t\t\tuserIds: usersToRepeatInvite,\n\t\t\tvideo: Hardware.isCameraOn ? 'Y' : 'N',\n\t\t\trepeated: 'Y',\n\t\t}\n\t\tthis.signaling.inviteUsers(inviteParams).then(() => this.scheduleRepeatInvite());\n\t};\n\n\t/**\n\t * @param {Object} config\n\t * @param {bool?} [config.useVideo]\n\t * @param {bool?} [config.joinAsViewer]\n\t */\n\tanswer(config = {})\n\t{\n\t\tthis.ready = true;\n\t\tconst joinAsViewer = config.joinAsViewer === true;\n\t\tthis.videoEnabled = Hardware.isCameraOn;\n\t\tthis.muted = Hardware.isMicrophoneMuted;\n\n\t\tif (!joinAsViewer)\n\t\t{\n\t\t\tthis.signaling.sendAnswer();\n\t\t}\n\t\tthis.attachToConference({joinAsViewer: joinAsViewer})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.log(\"Attached to conference\");\n\t\t\t\tthis.state = CallState.Connected;\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: true\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) =>\n\t\t\t{\n\t\t\t\tthis.#onFatalError(err);\n\t\t\t})\n\t\t;\n\t};\n\n\tdecline(code)\n\t{\n\t\tthis.ready = false;\n\t\tconst data = {\n\t\t\tcallId: this.id,\n\t\t\tcallInstanceId: this.instanceId,\n\t\t};\n\t\tif (code)\n\t\t{\n\t\t\tdata.code = code\n\t\t}\n\n\t\tCallEngine.getRestClient().callMethod(ajaxActions.decline, data);\n\t};\n\n\thangup(code, reason)\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tconst error = new Error(\"Hangup in wrong state\");\n\t\t\tthis.log(error);\n\t\t\treturn;\n\t\t}\n\n\t\tconst tempError = new Error();\n\t\ttempError.name = \"Call stack:\";\n\t\tthis.log(\"Hangup received \\n\" + tempError.stack);\n\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\n\t\tlet data = {};\n\t\tthis.ready = false;\n\t\tif (typeof (code) != 'undefined')\n\t\t{\n\t\t\tdata.code = code;\n\t\t}\n\t\tif (typeof (reason) != 'undefined')\n\t\t{\n\t\t\tdata.reason = reason;\n\t\t}\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {local: true});\n\n\t\t//clone users and append current user id to send event to all participants of the call\n\t\tdata.userId = this.users.slice(0).concat(this.userId);\n\t\tthis.signaling.sendHangup(data);\n\n\t\t// for future reconnections\n\t\tthis.reinitPeers();\n\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.voximplantCall._replaceVideoSharing = false;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.voximplantCall.hangup();\n\t\t\t} catch (e)\n\t\t\t{\n\t\t\t\tthis.log(\"Voximplant hangup error: \", e);\n\t\t\t\tconsole.error(\"Voximplant hangup error: \", e);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Tried to hangup, but this.voximplantCall points nowhere\");\n\t\t\tconsole.error(\"Tried to hangup, but this.voximplantCall points nowhere\");\n\t\t}\n\n\t\tthis.screenShared = false;\n\t\tthis.#hideLocalVideo();\n\t};\n\n\tattachToConference(options: { joinAsViewer: ?boolean } = {})\n\t{\n\t\tconst joinAsViewer = options.joinAsViewer === true;\n\t\tif (this.voximplantCall && this.voximplantCall.state() === \"CONNECTED\")\n\t\t{\n\t\t\tif (this.joinedAsViewer === joinAsViewer)\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn Promise.reject(\"Already joined call in another mode\");\n\t\t\t}\n\t\t}\n\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tthis.direction = joinAsViewer ? EndpointDirection.RecvOnly : EndpointDirection.SendRecv;\n\t\t\tthis.sendTelemetryEvent(\"call\");\n\n\t\t\tthis.getClient().then((voximplantClient) =>\n\t\t\t{\n\t\t\t\tthis.localUserState = UserState.Connecting;\n\n\t\t\t\t// workaround to set default video settings before starting call. ugly, but I do not see another way\n\t\t\t\tVoxImplant.Hardware.CameraManager.get().setDefaultVideoSettings(this.constructCameraParams());\n\t\t\t\tif (this.microphoneId)\n\t\t\t\t{\n\t\t\t\t\tVoxImplant.Hardware.AudioDeviceManager.get().setDefaultAudioSettings({\n\t\t\t\t\t\tinputId: this.microphoneId\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (Hardware.isCameraOn)\n\t\t\t\t{\n\t\t\t\t\tthis.#showLocalVideo();\n\t\t\t\t}\n\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tif (!this.ready)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.log(\"Error: trying to attach after hangup\");\n\t\t\t\t\t\treturn reject({code: \"VOX_NO_CALL\"});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (joinAsViewer)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.voximplantCall = voximplantClient.joinAsViewer(\"bx_conf_\" + this.id, {\n\t\t\t\t\t\t\t'X-Direction': EndpointDirection.RecvOnly\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.voximplantCall = voximplantClient.callConference({\n\t\t\t\t\t\t\tnumber: \"bx_conf_\" + this.id,\n\t\t\t\t\t\t\tvideo: {sendVideo: Hardware.isCameraOn, receiveVideo: true},\n\t\t\t\t\t\t\t// simulcast: (this.getUserCount() > MAX_USERS_WITHOUT_SIMULCAST),\n\t\t\t\t\t\t\t// simulcastProfileName: 'b24',\n\t\t\t\t\t\t\tcustomData: JSON.stringify({\n\t\t\t\t\t\t\t\tcameraState: Hardware.isCameraOn,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} catch (e)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\treturn reject(e);\n\t\t\t\t}\n\t\t\t\tthis.joinedAsViewer = joinAsViewer;\n\n\t\t\t\tif (!this.voximplantCall)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Error: could not create voximplant call\");\n\t\t\t\t\treturn reject({code: \"VOX_NO_CALL\"});\n\t\t\t\t}\n\n\t\t\t\tthis.runCallback(VoximplantCallEvent.onCallConference, {\n\t\t\t\t\tcall: this\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.subscribeHardwareChanges();\n\n\t\t\t\tthis.voximplantCall.on(\n\t\t\t\t\tVoxImplant.CallEvents.Connected,\n\t\t\t\t\t() =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onCallConnected();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\t{once: true});\n\t\t\t\tthis.voximplantCall.on(\n\t\t\t\t\tVoxImplant.CallEvents.Failed,\n\t\t\t\t\t(e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#onCallFailed(e);\n\t\t\t\t\t\treject(e);\n\t\t\t\t\t},\n\t\t\t\t\t{once: true}\n\t\t\t\t);\n\t\t\t}).catch(this.#onFatalError.bind(this));\n\t\t});\n\t};\n\n\t#onCallConnected()\n\t{\n\t\tthis.log(\"Call connected\");\n\t\tthis.sendTelemetryEvent(\"connect\");\n\t\tthis.localUserState = UserState.Connected;\n\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Failed, this.#onCallDisconnected);\n\n\t\tif (Hardware.isMicrophoneMuted)\n\t\t{\n\t\t\tthis.voximplantCall.muteMicrophone();\n\t\t}\n\n\t\tthis.signaling.sendMicrophoneState(!Hardware.isMicrophoneMuted);\n\t\tthis.signaling.sendCameraState(Hardware.isCameraOn);\n\n\t\tif (this.videoAllowedFrom == UserMnemonic.none)\n\t\t{\n\t\t\tthis.signaling.sendHideAll();\n\t\t}\n\t\telse if (Type.isArray(this.videoAllowedFrom))\n\t\t{\n\t\t\tthis.signaling.sendShowUsers(this.videoAllowedFrom);\n\t\t}\n\t};\n\n\t#onCallFailed(e)\n\t{\n\t\tthis.log(\"Could not attach to conference\", e);\n\t\tthis.sendTelemetryEvent(\"connect_failure\");\n\t\tthis.localUserState = UserState.Failed;\n\n\t\tconst client = VoxImplant.getInstance();\n\t\tclient.enableSilentLogging(false);\n\t\tclient.setLoggerCallback(null);\n\t};\n\n\tbindCallEvents()\n\t{\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Disconnected, this.#onCallDisconnected);\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.MessageReceived, this.#onCallMessageReceived);\n\t\tif (Util.shouldCollectStats())\n\t\t{\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.CallStatsReceived, this.#onCallStatsReceived);\n\t\t}\n\n\t\tthis.voximplantCall.on(VoxImplant.CallEvents.EndpointAdded, this.#onCallEndpointAdded);\n\t\tif (VoxImplant.CallEvents.Reconnecting)\n\t\t{\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Reconnecting, this.#onCallReconnecting);\n\t\t\tthis.voximplantCall.on(VoxImplant.CallEvents.Reconnected, this.#onCallReconnected);\n\t\t}\n\t};\n\n\tremoveCallEvents()\n\t{\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Disconnected, this.#onCallDisconnected);\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.MessageReceived, this.#onCallMessageReceived);\n\t\t\tif (Util.shouldCollectStats())\n\t\t\t{\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.CallStatsReceived, this.#onCallStatsReceived);\n\t\t\t}\n\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.EndpointAdded, this.#onCallEndpointAdded);\n\t\t\tif (VoxImplant.CallEvents.Reconnecting)\n\t\t\t{\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Reconnecting, this.#onCallReconnecting);\n\t\t\t\tthis.voximplantCall.removeEventListener(VoxImplant.CallEvents.Reconnected, this.#onCallReconnected);\n\t\t\t}\n\t\t}\n\t};\n\n\tsubscribeHardwareChanges()\n\t{\n\t\tHardware.subscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.subscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\tunsubscribeHardwareChanges()\n\t{\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMicrophoneMuted, this.setMuted);\n\t\tHardware.unsubscribe(Hardware.Events.onChangeCameraOn, this.setVideoEnabled);\n\t};\n\n\t/**\n\t * Adds new users to call\n\t * @param {Number[]} users\n\t */\n\taddJoinedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId || this.peers[userId])\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: userId\n\t\t\t});\n\t\t}\n\t};\n\n\t/**\n\t * Adds users, invited by you or someone else\n\t * @param {Number[]} users\n\t */\n\taddInvitedUsers(users)\n\t{\n\t\tfor (let i = 0; i < users.length; i++)\n\t\t{\n\t\t\tconst userId = Number(users[i]);\n\t\t\tif (userId == this.userId)\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (this.peers[userId])\n\t\t\t{\n\t\t\t\tif (this.peers[userId].calculatedState === UserState.Failed || this.peers[userId].calculatedState === UserState.Idle)\n\t\t\t\t{\n\t\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.peers[userId] = this.createPeer(userId);\n\t\t\t\tif (this.type === CallType.Instant)\n\t\t\t\t{\n\t\t\t\t\tthis.peers[userId].onInvited();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!this.users.includes(userId))\n\t\t\t{\n\t\t\t\tthis.users.push(userId);\n\t\t\t}\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: userId\n\t\t\t});\n\t\t}\n\t};\n\n\tisAnyoneParticipating()\n\t{\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tgetParticipatingUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers[userId].isParticipating())\n\t\t\t{\n\t\t\t\tresult.push(userId);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t};\n\n\tupdateRoom(roomData)\n\t{\n\t\tif (!this.rooms[roomData.id])\n\t\t{\n\t\t\tthis.rooms[roomData.id] = {\n\t\t\t\tid: roomData.id,\n\t\t\t\tusers: roomData.users,\n\t\t\t\tspeaker: roomData.speaker\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.rooms[roomData.id].users = roomData.users;\n\t\t\tthis.rooms[roomData.id].speaker = roomData.speaker;\n\t\t}\n\t}\n\n\tcurrentRoom()\n\t{\n\t\treturn this._currentRoomId ? this.rooms[this._currentRoomId] : null;\n\t}\n\n\tisRoomSpeaker()\n\t{\n\t\treturn this.currentRoom() ? this.currentRoom().speaker == this.userId : false;\n\t}\n\n\tjoinRoom(roomId)\n\t{\n\t\tthis.signaling.sendJoinRoom(roomId);\n\t}\n\n\trequestRoomSpeaker()\n\t{\n\t\tthis.signaling.sendRequestRoomSpeaker(this._currentRoomId);\n\t}\n\n\tleaveCurrentRoom()\n\t{\n\t\tthis.signaling.sendLeaveRoom(this._currentRoomId);\n\t}\n\n\tlistRooms()\n\t{\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tthis.signaling.sendListRooms();\n\t\t\tthis.__resolveListRooms = resolve;\n\t\t});\n\t}\n\n\t#onPeerStateChanged = (e) =>\n\t{\n\t\tthis.runCallback(CallEvent.onUserStateChanged, e);\n\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.state == UserState.Failed || e.state == UserState.Unavailable || e.state == UserState.Declined || e.state == UserState.Idle)\n\t\t{\n\t\t\tif (this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t\t{\n\t\t\t\tthis.hangup();\n\t\t\t}\n\t\t}\n\t};\n\n\t#onPeerInviteTimeout = (e) =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.signaling.sendUserInviteTimeout({\n\t\t\tuserId: this.users,\n\t\t\tfailedUserId: e.userId\n\t\t})\n\t};\n\n\t__onPullEvent(command, params, extra)\n\t{\n\t\tif (this.pullEventHandlers[command])\n\t\t{\n\t\t\tif (command != 'Call::ping')\n\t\t\t{\n\t\t\t\tthis.log(\"Signaling: \" + command + \"; Parameters: \" + JSON.stringify(params));\n\t\t\t}\n\t\t\tthis.pullEventHandlers[command].call(this, params);\n\t\t}\n\t};\n\n\t#onPullEventAnswer = (params) =>\n\t{\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\treturn this.__onPullEventAnswerSelf(params);\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId] = this.createPeer(senderId);\n\t\t\tthis.runCallback(CallEvent.onUserInvited, {\n\t\t\t\tuserId: senderId\n\t\t\t});\n\t\t}\n\n\t\tif (!this.users.includes(senderId))\n\t\t{\n\t\t\tthis.users.push(senderId);\n\t\t}\n\n\t\tthis.peers[senderId].setReady(true);\n\t};\n\n\t__onPullEventAnswerSelf(params)\n\t{\n\t\tif (params.callInstanceId === this.instanceId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// call was answered elsewhere\n\t\tthis.joinedElsewhere = true;\n\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\tlocal: false\n\t\t});\n\t};\n\n\t#onPullEventHangup = (params) =>\n\t{\n\t\tconst senderId = params.senderId;\n\t\tif (this.userId == senderId && this.instanceId != params.callInstanceId)\n\t\t{\n\t\t\t// Call declined by the same user elsewhere\n\t\t\tthis.runCallback(CallEvent.onLeave, {local: false});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.peers[senderId])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.peers[senderId].setReady(false);\n\n\t\tif (params.code == 603)\n\t\t{\n\t\t\tthis.peers[senderId].setDeclined(true);\n\t\t}\n\t\telse if (params.code == 486)\n\t\t{\n\t\t\tthis.peers[senderId].setBusy(true);\n\t\t\tconsole.error(\"user \" + senderId + \" is busy\");\n\t\t}\n\n\t\tif (this.ready && this.type == CallType.Instant && !this.isAnyoneParticipating())\n\t\t{\n\t\t\tthis.hangup();\n\t\t}\n\t};\n\n\t#onPullEventUsersJoined = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersJoined', params);\n\t\tconst users = params.users;\n\n\t\tthis.addJoinedUsers(users);\n\t};\n\n\t#onPullEventUsersInvited = (params) =>\n\t{\n\t\tthis.log('__onPullEventUsersInvited', params);\n\t\tconst users = params.users;\n\n\t\tif (this.type === CallType.Instant)\n\t\t{\n\t\t\tthis.addInvitedUsers(users);\n\t\t}\n\t};\n\n\t#onPullEventUserInviteTimeout = (params) =>\n\t{\n\t\tthis.log('__onPullEventUserInviteTimeout', params);\n\t\tconst failedUserId = params.failedUserId;\n\n\t\tif (this.peers[failedUserId])\n\t\t{\n\t\t\tthis.peers[failedUserId].onInviteTimeout(false);\n\t\t}\n\t};\n\n\t#onPullEventPing = (params) =>\n\t{\n\t\tif (params.callInstanceId == this.instanceId)\n\t\t{\n\t\t\t// ignore self ping\n\t\t\treturn;\n\t\t}\n\n\t\tconst senderId = Number(params.senderId);\n\n\t\tif (senderId == this.userId)\n\t\t{\n\t\t\tif (!this.joinedElsewhere)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onJoin, {\n\t\t\t\t\tlocal: false\n\t\t\t\t});\n\t\t\t\tthis.joinedElsewhere = true;\n\t\t\t}\n\t\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\t\tthis.lastSelfPingReceivedTimeout = setTimeout(this.#onNoSelfPingsReceived, pingPeriod * 2.1);\n\t\t}\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tthis.lastPingReceivedTimeout = setTimeout(this.#onNoPingsReceived, pingPeriod * 2.1);\n\t\tif (this.peers[senderId])\n\t\t{\n\t\t\tthis.peers[senderId].setReady(true);\n\t\t}\n\t};\n\n\t#onNoPingsReceived = () =>\n\t{\n\t\tif (!this.ready)\n\t\t{\n\t\t\tthis.destroy();\n\t\t}\n\t};\n\n\t#onNoSelfPingsReceived = () =>\n\t{\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: false\n\t\t});\n\t\tthis.joinedElsewhere = false;\n\t};\n\n\t#onPullEventFinish = () =>\n\t{\n\t\tthis.destroy();\n\t};\n\n\t#onPullEventRepeatAnswer = () =>\n\t{\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.signaling.sendAnswer({userId: this.userId}, true);\n\t\t}\n\t}\n\n\t#onLocalMediaRendererAdded = (e) =>\n\t{\n\t\tconst renderer = e.renderer;\n\t\tconst trackLabel = renderer.stream.getVideoTracks().length > 0 ? renderer.stream.getVideoTracks()[0].label : \"\";\n\t\tthis.log(\"__onLocalMediaRendererAdded\", renderer.kind, trackLabel);\n\n\t\tif (renderer.kind === \"video\")\n\t\t{\n\t\t\tlet tag;\n\t\t\tif (trackLabel.match(/^screen|window|tab|web-contents-media-stream/i))\n\t\t\t{\n\t\t\t\ttag = \"screen\";\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttag = \"main\";\n\t\t\t}\n\n\t\t\tthis.screenShared = tag === \"screen\";\n\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: tag,\n\t\t\t\tstream: renderer.stream,\n\t\t\t});\n\t\t}\n\t\telse if (renderer.kind === \"sharing\")\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: \"screen\",\n\t\t\t\tstream: renderer.stream,\n\t\t\t});\n\t\t\tthis.screenShared = true;\n\t\t}\n\t};\n\n\t#onBeforeLocalMediaRendererRemoved = (e) =>\n\t{\n\t\tconst renderer = e.renderer;\n\t\tthis.log(\"__onBeforeLocalMediaRendererRemoved\", renderer.kind);\n\n\t\tif (renderer.kind === \"sharing\" && !Hardware.isCameraOn)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onLocalMediaReceived, {\n\t\t\t\ttag: \"main\",\n\t\t\t\tstream: new MediaStream(),\n\t\t\t});\n\t\t\tthis.screenShared = false;\n\t\t}\n\t};\n\n\t#onMicAccessResult = (e) =>\n\t{\n\t\tif (this.ready && e.result)\n\t\t{\n\t\t\tif (e.stream.getAudioTracks().length > 0)\n\t\t\t{\n\t\t\t\tif (this.localVAD)\n\t\t\t\t{\n\t\t\t\t\tthis.localVAD.destroy();\n\t\t\t\t}\n\t\t\t\tthis.localVAD = new SimpleVAD({\n\t\t\t\t\tmediaStream: e.stream,\n\t\t\t\t\tonVoiceStarted: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonVoiceStopped: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\t\tlocal: true\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tclearInterval(this.microphoneLevelInterval);\n\t\t\t\tthis.microphoneLevelInterval = setInterval(\n\t\t\t\t\t() =>this.microphoneLevel = this.localVAD.currentVolume,\n\t\t\t\t\t200\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t};\n\n\t#onCallReconnecting = () =>\n\t{\n\t\tthis.reconnectionEventCount++;\n\t}\n\n\t#onCallReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount--;\n\t}\n\n\t#onClientReconnecting = () =>\n\t{\n\t\tthis.reconnectionEventCount++;\n\t}\n\n\t#onClientReconnected = () =>\n\t{\n\t\tthis.reconnectionEventCount--;\n\t};\n\n\t#onCallDisconnected = (e) =>\n\t{\n\t\tthis.log(\"__onCallDisconnected\", (e && e.headers ? {headers: e.headers} : null));\n\t\tthis.sendTelemetryEvent(\"disconnect\");\n\t\tthis.localUserState = UserState.Idle;\n\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.reinitPeers();\n\n\t\tthis.#hideLocalVideo();\n\t\tthis.removeCallEvents();\n\t\tthis.unsubscribeHardwareChanges();\n\t\tthis.voximplantCall = null;\n\n\t\tconst client = VoxImplant.getInstance();\n\t\tclient.enableSilentLogging(false);\n\t\tclient.setLoggerCallback(null);\n\n\t\tthis.state = CallState.Proceeding;\n\t\tthis.runCallback(CallEvent.onLeave, {\n\t\t\tlocal: true\n\t\t});\n\t};\n\n\t#onWindowUnload = () =>\n\t{\n\t\tif (this.ready && this.voximplantCall)\n\t\t{\n\t\t\tthis.signaling.sendHangup({\n\t\t\t\tuserId: this.users\n\t\t\t});\n\t\t}\n\t};\n\n\t#onFatalError = (error) =>\n\t{\n\t\tif (error && error.call)\n\t\t{\n\t\t\tdelete error.call;\n\t\t}\n\t\tthis.log(\"onFatalError\", error);\n\n\t\tthis.ready = false;\n\t\tthis.localUserState = UserState.Failed;\n\t\tthis.reinitPeers();\n\n\t\tthis.#hideLocalVideo().then(() =>\n\t\t{\n\t\t\tif (this.voximplantCall)\n\t\t\t{\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tthis.voximplantCall.hangup({\n\t\t\t\t\t\t'X-Reason': 'Fatal error',\n\t\t\t\t\t\t'X-Error': typeof (error) === 'string' ? error : error.code || error.name\n\t\t\t\t\t})\n\t\t\t\t} catch (e)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Voximplant hangup error: \", e);\n\t\t\t\t\tconsole.error(\"Voximplant hangup error: \", e);\n\t\t\t\t}\n\t\t\t\tthis.voximplantCall = null;\n\t\t\t}\n\n\t\t\tif (typeof (VoxImplant) !== 'undefined')\n\t\t\t{\n\t\t\t\tconst client = VoxImplant.getInstance();\n\n\t\t\t\tclient.enableSilentLogging(false);\n\t\t\t\tclient.setLoggerCallback(null);\n\t\t\t}\n\n\t\t\tif (typeof (error) === \"string\")\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onCallFailure, {\n\t\t\t\t\tname: error\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (error.name)\n\t\t\t{\n\t\t\t\tthis.runCallback(CallEvent.onCallFailure, error);\n\t\t\t}\n\t\t})\n\t};\n\n\t#setEndpointForUser(userName: string, endpoint)\n\t{\n\t\t// user connected to conference (userName is in format `user${id}`\n\t\tconst userId = parseInt(userName.substring(4));\n\t\tif (this.peers[userId])\n\t\t{\n\t\t\tthis.peers[userId].setEndpoint(endpoint);\n\t\t}\n\t\tthis.wasConnected = true;\n\t}\n\n\t#onCallEndpointAdded = (e) =>\n\t{\n\t\tconst endpoint = e.endpoint;\n\t\tconst userName = endpoint.userName;\n\t\tthis.log(\"__onCallEndpointAdded (\" + userName + \")\", e.endpoint);\n\t\tconsole.log(\"__onCallEndpointAdded (\" + userName + \")\", e.endpoint);\n\n\t\tif (Type.isStringFilled(userName) && userName.startsWith('user'))\n\t\t{\n\t\t\tthis.#setEndpointForUser(userName, endpoint)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tendpoint.addEventListener(VoxImplant.EndpointEvents.InfoUpdated, (e) =>\n\t\t\t{\n\t\t\t\tconst endpoint = e.endpoint;\n\t\t\t\tconst userName = endpoint.userName;\n\t\t\t\tthis.log(\"VoxImplant.EndpointEvents.InfoUpdated (\" + userName + \")\", e.endpoint);\n\n\t\t\t\tif (Type.isStringFilled(userName) && userName.startsWith('user'))\n\t\t\t\t{\n\t\t\t\t\tthis.#setEndpointForUser(userName, endpoint)\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.log('Unknown endpoint ' + userName);\n\t\t\tconsole.warn('Unknown endpoint ' + userName);\n\t\t}\n\t};\n\n\t#onCallStatsReceived = (e) =>\n\t{\n\t\tif (this.logger)\n\t\t{\n\t\t\tthis.logger.sendStat(transformVoxStats(e.stats, this.voximplantCall));\n\t\t}\n\t}\n\n\t#onJoinRoomOffer = (e) =>\n\t{\n\t\tconsole.warn(\"__onJoinRoomOffer\", e)\n\t\tthis.updateRoom({\n\t\t\tid: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tspeaker: e.speaker,\n\t\t});\n\t\tthis.runCallback(CallEvent.onJoinRoomOffer, {\n\t\t\troomId: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tinitiator: e.initiator,\n\t\t\tspeaker: e.speaker,\n\t\t})\n\t}\n\n\t#onRoomUpdated = (e) =>\n\t{\n\t\tconst speakerChanged = (\n\t\t\te.roomId === this._currentRoomId\n\t\t\t&& this.rooms[e.roomId]\n\t\t\t&& this.rooms[e.roomId].speaker != e.speaker\n\t\t);\n\t\tconst previousSpeaker = speakerChanged && this.rooms[e.roomId].speaker;\n\n\t\tconsole.log(\"__onRoomUpdated; speakerChanged: \", speakerChanged)\n\t\tthis.updateRoom({\n\t\t\tid: e.roomId,\n\t\t\tusers: e.users,\n\t\t\tspeaker: e.speaker,\n\t\t});\n\n\t\tif (e.roomId === this._currentRoomId && e.users.indexOf(this.userId) === -1)\n\t\t{\n\t\t\tthis._currentRoomId = null;\n\t\t\tthis.runCallback(CallEvent.onLeaveRoom, {\n\t\t\t\troomId: e.roomId\n\t\t\t})\n\t\t}\n\t\telse if (e.roomId !== this._currentRoomId && e.users.indexOf(this.userId) !== -1)\n\t\t{\n\t\t\tthis._currentRoomId = e.roomId;\n\t\t\tthis.runCallback(CallEvent.onJoinRoom, {\n\t\t\t\troomId: e.roomId,\n\t\t\t\tspeaker: this.currentRoom().speaker,\n\t\t\t\tusers: this.currentRoom().users,\n\t\t\t})\n\t\t}\n\t\telse if (speakerChanged)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onTransferRoomSpeaker, {\n\t\t\t\troomId: e.roomId,\n\t\t\t\tspeaker: e.speaker,\n\t\t\t\tpreviousSpeaker: previousSpeaker,\n\t\t\t\tinitiator: e.initiator,\n\t\t\t})\n\t\t}\n\t};\n\n\t#onCallMessageReceived = (e) =>\n\t{\n\t\tlet message;\n\t\tlet peer;\n\n\t\ttry\n\t\t{\n\t\t\tmessage = JSON.parse(e.text);\n\t\t} catch (err)\n\t\t{\n\t\t\tthis.log(\"Could not parse scenario message.\", err);\n\t\t\treturn;\n\t\t}\n\n\t\tconst eventName = message.eventName;\n\t\tif (eventName === clientEvents.voiceStarted)\n\t\t{\n\t\t\t// todo: remove after switching to SDK VAD events\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStarted, {\n\t\t\t\tuserId: message.senderId\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.voiceStopped)\n\t\t{\n\t\t\t// todo: remove after switching to SDK VAD events\n\t\t\tthis.runCallback(CallEvent.onUserVoiceStopped, {\n\t\t\t\tuserId: message.senderId\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.microphoneState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserMicrophoneState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tmicrophoneState: message.microphoneState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.cameraState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCameraState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tcameraState: message.cameraState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.videoPaused)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserVideoPaused, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tvideoPaused: message.videoPaused === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.screenState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserScreenState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\tscreenState: message.screenState === \"Y\"\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.recordState)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserCommonRecordState, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\trecordState: message.recordState\n\t\t\t});\n\t\t}\n\t\telse if (eventName === clientEvents.floorRequest)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserFloorRequest, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\trequestActive: message.requestActive === \"Y\"\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.emotion)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onUserEmotion, {\n\t\t\t\tuserId: message.senderId,\n\t\t\t\ttoUserId: message.toUserId,\n\t\t\t\temotion: message.emotion\n\t\t\t})\n\t\t}\n\t\telse if (eventName === clientEvents.customMessage)\n\t\t{\n\t\t\tthis.runCallback(CallEvent.onCustomMessage, {\n\t\t\t\tmessage: message.message\n\t\t\t})\n\t\t}\n\t\telse if (eventName === \"scenarioLogUrl\")\n\t\t{\n\t\t\tconsole.warn(\"scenario log url: \" + message.logUrl)\n\t\t}\n\t\telse if (eventName === scenarioEvents.joinRoomOffer)\n\t\t{\n\t\t\tconsole.log(message)\n\t\t\tthis.#onJoinRoomOffer(message);\n\t\t}\n\t\telse if (eventName === scenarioEvents.roomUpdated)\n\t\t{\n\t\t\t// console.log(message)\n\t\t\tthis.#onRoomUpdated(message);\n\t\t}\n\t\telse if (eventName === scenarioEvents.listRoomsResponse)\n\t\t{\n\t\t\tif (this.__resolveListRooms)\n\t\t\t{\n\t\t\t\tthis.__resolveListRooms(message.rooms)\n\t\t\t\tdelete this.__resolveListRooms;\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerJoined)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" joined\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setDirection(EndpointDirection.RecvOnly);\n\t\t\t\tpeer.setReady(true);\n\t\t\t}\n\t\t}\n\t\telse if (eventName === scenarioEvents.viewerLeft)\n\t\t{\n\t\t\tconsole.log(\"viewer \" + message.senderId + \" left\");\n\t\t\tpeer = this.peers[message.senderId];\n\t\t\tif (peer)\n\t\t\t{\n\t\t\t\tpeer.setReady(false);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.log(\"Unknown scenario event \" + eventName);\n\t\t}\n\t};\n\n\tsendTelemetryEvent(eventName)\n\t{\n\t\tUtil.sendTelemetryEvent({\n\t\t\tcall_id: this.id,\n\t\t\tuser_id: this.userId,\n\t\t\tkind: \"voximplant\",\n\t\t\tevent: eventName,\n\t\t})\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.ready = false;\n\t\tthis.joinedAsViewer = false;\n\t\tthis.#hideLocalVideo();\n\t\tif (this.localVAD)\n\t\t{\n\t\t\tthis.localVAD.destroy();\n\t\t\tthis.localVAD = null;\n\t\t}\n\t\tclearInterval(this.microphoneLevelInterval);\n\t\tif (this.voximplantCall)\n\t\t{\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.unsubscribeHardwareChanges();\n\t\t\tif (this.voximplantCall.state() != \"ENDED\")\n\t\t\t{\n\t\t\t\tthis.voximplantCall.hangup();\n\t\t\t}\n\t\t\tthis.voximplantCall = null;\n\t\t}\n\n\t\tfor (let userId in this.peers)\n\t\t{\n\t\t\tif (this.peers.hasOwnProperty(userId) && this.peers[userId])\n\t\t\t{\n\t\t\t\tthis.peers[userId].destroy();\n\t\t\t}\n\t\t}\n\n\t\tthis.removeClientEvents();\n\n\t\tclearTimeout(this.lastPingReceivedTimeout);\n\t\tclearTimeout(this.lastSelfPingReceivedTimeout);\n\t\tclearInterval(this.pingUsersInterval);\n\t\tclearInterval(this.pingBackendInterval);\n\n\t\twindow.removeEventListener(\"unload\", this.#onWindowUnload);\n\t\treturn super.destroy();\n\t};\n}\n\nclass Signaling\n{\n\tconstructor(params)\n\t{\n\t\tthis.call = params.call;\n\t};\n\n\tinviteUsers(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.invite, data);\n\t};\n\n\tsendAnswer(data, repeated)\n\t{\n\t\tif (repeated && CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.answer, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.#runRestAction(ajaxActions.answer, data);\n\t\t}\n\t};\n\n\tsendCancel(data)\n\t{\n\t\treturn this.#runRestAction(ajaxActions.cancel, data);\n\t};\n\n\tsendHangup(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.hangup, data);\n\t\t\tdata.retransmit = false;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdata.retransmit = true;\n\t\t\tthis.#runRestAction(ajaxActions.hangup, data);\n\t\t}\n\t};\n\n\tsendVoiceStarted(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStarted, data);\n\t};\n\n\tsendVoiceStopped(data)\n\t{\n\t\treturn this.#sendMessage(clientEvents.voiceStopped, data);\n\t};\n\n\tsendMicrophoneState(microphoneState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.microphoneState, {\n\t\t\tmicrophoneState: microphoneState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendCameraState(cameraState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.cameraState, {\n\t\t\tcameraState: cameraState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendScreenState(screenState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.screenState, {\n\t\t\tscreenState: screenState ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendLocalRecordState(recordState)\n\t{\n\t\treturn this.#sendMessage(clientEvents.recordState, recordState);\n\t};\n\n\tsendFloorRequest(requestActive)\n\t{\n\t\treturn this.#sendMessage(clientEvents.floorRequest, {\n\t\t\trequestActive: requestActive ? \"Y\" : \"N\"\n\t\t});\n\t};\n\n\tsendEmotion(toUserId, emotion)\n\t{\n\t\treturn this.#sendMessage(clientEvents.emotion, {\n\t\t\ttoUserId: toUserId,\n\t\t\temotion: emotion\n\t\t});\n\t};\n\n\tsendCustomMessage(message, repeatOnConnect)\n\t{\n\t\treturn this.#sendMessage(clientEvents.customMessage, {\n\t\t\tmessage: message,\n\t\t\trepeatOnConnect: !!repeatOnConnect\n\t\t});\n\t};\n\n\tsendShowUsers(users)\n\t{\n\t\treturn this.#sendMessage(clientEvents.showUsers, {\n\t\t\tusers: users\n\t\t});\n\t};\n\n\tsendShowAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.showAll, {});\n\t};\n\n\tsendHideAll()\n\t{\n\t\treturn this.#sendMessage(clientEvents.hideAll, {});\n\t};\n\n\tsendPingToUsers(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.ping, data, 0);\n\t\t}\n\t};\n\n\tsendPingToBackend()\n\t{\n\t\tthis.#runRestAction(ajaxActions.ping, {retransmit: false});\n\t};\n\n\tsendUserInviteTimeout(data)\n\t{\n\t\tif (CallEngine.getPullClient().isPublishingEnabled())\n\t\t{\n\t\t\tthis.#sendPullEvent(pullEvents.userInviteTimeout, data, 0);\n\t\t}\n\t};\n\n\tsendJoinRoom(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.joinRoom, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\tsendLeaveRoom(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.leaveRoom, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\tsendListRooms()\n\t{\n\t\treturn this.#sendMessage(clientEvents.listRooms);\n\t};\n\n\tsendRequestRoomSpeaker(roomId)\n\t{\n\t\treturn this.#sendMessage(clientEvents.requestRoomSpeaker, {\n\t\t\troomId: roomId\n\t\t});\n\t};\n\n\t#sendPullEvent(eventName, data, expiry)\n\t{\n\t\texpiry = expiry || 5;\n\t\tif (!data.userId)\n\t\t{\n\t\t\tthrow new Error('userId is not found in data');\n\t\t}\n\n\t\tif (!Type.isArray(data.userId))\n\t\t{\n\t\t\tdata.userId = [data.userId];\n\t\t}\n\t\tif (data.userId.length === 0)\n\t\t{\n\t\t\t// nobody to send, exit\n\t\t\treturn;\n\t\t}\n\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.senderId = this.call.userId;\n\t\tdata.callId = this.call.id;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.log('Sending p2p signaling event ' + eventName + '; ' + JSON.stringify(data));\n\t\tCallEngine.getPullClient().sendMessage(data.userId, 'im', eventName, data, expiry);\n\t};\n\n\t#sendMessage(eventName, data)\n\t{\n\t\tif (!this.call.voximplantCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\t\tdata.eventName = eventName;\n\t\tdata.requestId = Util.getUuidv4();\n\n\t\tthis.call.voximplantCall.sendMessage(JSON.stringify(data));\n\t};\n\n\t#runRestAction(signalName, data)\n\t{\n\t\tif (!Type.isPlainObject(data))\n\t\t{\n\t\t\tdata = {};\n\t\t}\n\n\t\tdata.callId = this.call.id;\n\t\tdata.callInstanceId = this.call.instanceId;\n\t\tdata.requestId = Util.getUuidv4();\n\t\treturn CallEngine.getRestClient().callMethod(signalName, data);\n\t};\n}\n\nclass Peer\n{\n\tcalculatedState: string\n\n\tconstructor(params)\n\t{\n\t\tthis.userId = params.userId;\n\t\tthis.call = params.call;\n\n\t\tthis.ready = !!params.ready;\n\t\tthis.calling = false;\n\t\tthis.declined = false;\n\t\tthis.busy = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.endpoint = null;\n\t\tthis.direction = params.direction || EndpointDirection.SendRecv;\n\n\t\tthis.stream = null;\n\t\tthis.mediaRenderers = [];\n\n\t\tthis.isIncomingVideoAllowed = params.isIncomingVideoAllowed !== false;\n\n\t\tthis.callingTimeout = 0;\n\t\tthis.connectionRestoreTimeout = 0;\n\n\t\tthis.callbacks = {\n\t\t\tonStateChanged: Type.isFunction(params.onStateChanged) ? params.onStateChanged : BX.DoNothing,\n\t\t\tonInviteTimeout: Type.isFunction(params.onInviteTimeout) ? params.onInviteTimeout : BX.DoNothing,\n\t\t\tonMediaReceived: Type.isFunction(params.onMediaReceived) ? params.onMediaReceived : BX.DoNothing,\n\t\t\tonMediaRemoved: Type.isFunction(params.onMediaRemoved) ? params.onMediaRemoved : BX.DoNothing,\n\t\t\tonVoiceStarted: Type.isFunction(params.onVoiceStarted) ? params.onVoiceStarted : BX.DoNothing,\n\t\t\tonVoiceEnded: Type.isFunction(params.onVoiceEnded) ? params.onVoiceEnded : BX.DoNothing,\n\t\t\tonMediaRenderEnabled: Type.isFunction(params.onMediaRenderEnabled) ? params.onMediaRenderEnabled : BX.DoNothing,\n\t\t\tonMediaRenderDisabled: Type.isFunction(params.onMediaRenderDisabled) ? params.onMediaRenderDisabled : BX.DoNothing,\n\t\t};\n\n\t\tthis.calculatedState = this.calculateState();\n\t};\n\n\tsetReady(ready)\n\t{\n\t\tready = !!ready;\n\t\tif (this.ready == ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.ready = ready;\n\t\tthis.readyStack = (new Error()).stack;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t\tthis.inviteTimeout = false;\n\t\t}\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.declined = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetDirection(direction)\n\t{\n\t\tif (this.direction == direction)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.direction = direction;\n\t}\n\n\tsetDeclined(declined)\n\t{\n\t\tthis.declined = declined;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.declined)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.busy = false;\n\t\t}\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetBusy(busy)\n\t{\n\t\tthis.busy = busy;\n\t\tif (this.calling)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t\tthis.calling = false;\n\t\t}\n\t\tif (this.busy)\n\t\t{\n\t\t\tthis.ready = false;\n\t\t\tthis.declined = false;\n\t\t}\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tsetEndpoint(endpoint)\n\t{\n\t\tthis.log(\"Adding endpoint with \" + endpoint.mediaRenderers.length + \" media renderers\");\n\n\t\tthis.setReady(true);\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\n\t\tthis.endpoint = endpoint;\n\n\t\tfor (let i = 0; i < this.endpoint.mediaRenderers.length; i++)\n\t\t{\n\t\t\tthis.addMediaRenderer(this.endpoint.mediaRenderers[i]);\n\t\t\tif (this.endpoint.mediaRenderers[i].element)\n\t\t\t{\n\t\t\t\t//BX.remove(this.endpoint.mediaRenderers[i].element);\n\t\t\t}\n\t\t}\n\n\t\tthis.bindEndpointEventHandlers();\n\t}\n\n\tallowIncomingVideo(isIncomingVideoAllowed)\n\t{\n\t\tif (this.isIncomingVideoAllowed == isIncomingVideoAllowed)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isIncomingVideoAllowed = !!isIncomingVideoAllowed;\n\t}\n\n\taddMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Adding media renderer for user' + this.userId, mediaRenderer);\n\n\t\tthis.mediaRenderers.push(mediaRenderer);\n\t\tthis.callbacks.onMediaReceived({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tremoveMediaRenderer(mediaRenderer)\n\t{\n\t\tthis.log('Removing media renderer for user' + this.userId, mediaRenderer);\n\n\t\tlet i = this.mediaRenderers.indexOf(mediaRenderer);\n\t\tif (i >= 0)\n\t\t{\n\t\t\tthis.mediaRenderers.splice(i, 1);\n\t\t}\n\t\tthis.callbacks.onMediaRemoved({\n\t\t\tuserId: this.userId,\n\t\t\tkind: mediaRenderer.kind,\n\t\t\tmediaRenderer: mediaRenderer\n\t\t});\n\t\tthis.updateCalculatedState();\n\t}\n\n\tbindEndpointEventHandlers()\n\t{\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.RemoteMediaAdded, this.#onEndpointRemoteMediaAdded);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.RemoteMediaRemoved, this.#onEndpointRemoteMediaRemoved);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.VoiceStart, this.#onEndpointVoiceStart);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.VoiceEnd, this.#onEndpointVoiceEnd);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.Removed, this.#onEndpointRemoved);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.MediaRenderEnabled, this.#onEndpointMediaRenderEnabled);\n\t\tthis.endpoint.addEventListener(VoxImplant.EndpointEvents.MediaRenderDisabled, this.#onEndpointMediaRenderDisabled);\n\t}\n\n\tremoveEndpointEventHandlers()\n\t{\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.RemoteMediaAdded, this.#onEndpointRemoteMediaAdded);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.RemoteMediaRemoved, this.#onEndpointRemoteMediaRemoved);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.VoiceStart, this.#onEndpointVoiceStart);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.VoiceEnd, this.#onEndpointVoiceEnd);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.Removed, this.#onEndpointRemoved);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.MediaRenderEnabled, this.#onEndpointMediaRenderEnabled);\n\t\tthis.endpoint.removeEventListener(VoxImplant.EndpointEvents.MediaRenderDisabled, this.#onEndpointMediaRenderDisabled);\n\t}\n\n\tcalculateState()\n\t{\n\t\tif (this.endpoint)\n\t\t{\n\t\t\treturn UserState.Connected;\n\t\t}\n\n\t\tif (this.calling)\n\t\t{\n\t\t\treturn UserState.Calling;\n\t\t}\n\n\t\tif (this.inviteTimeout)\n\t\t{\n\t\t\treturn UserState.Unavailable;\n\t\t}\n\n\t\tif (this.declined)\n\t\t{\n\t\t\treturn UserState.Declined;\n\t\t}\n\n\t\tif (this.busy)\n\t\t{\n\t\t\treturn UserState.Busy;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\treturn UserState.Ready;\n\t\t}\n\n\t\treturn UserState.Idle;\n\t}\n\n\tupdateCalculatedState()\n\t{\n\t\tconst calculatedState = this.calculateState();\n\n\t\tif (this.calculatedState != calculatedState)\n\t\t{\n\t\t\tthis.callbacks.onStateChanged({\n\t\t\t\tuserId: this.userId,\n\t\t\t\tstate: calculatedState,\n\t\t\t\tpreviousState: this.calculatedState,\n\t\t\t\tdirection: this.direction,\n\t\t\t});\n\t\t\tthis.calculatedState = calculatedState;\n\t\t}\n\t}\n\n\tisParticipating()\n\t{\n\t\treturn ((this.calling || this.ready || this.endpoint) && !this.declined);\n\t}\n\n\twaitForConnectionRestore()\n\t{\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.connectionRestoreTimeout = setTimeout(\n\t\t\tthis.onConnectionRestoreTimeout.bind(this),\n\t\t\tconnectionRestoreTime\n\t\t);\n\t}\n\n\tonInvited()\n\t{\n\t\tthis.ready = false;\n\t\tthis.inviteTimeout = false;\n\t\tthis.declined = false;\n\t\tthis.calling = true;\n\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tif (this.callingTimeout)\n\t\t{\n\t\t\tclearTimeout(this.callingTimeout);\n\t\t}\n\t\tthis.callingTimeout = setTimeout(() => this.onInviteTimeout(true), 30000);\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonInviteTimeout(internal)\n\t{\n\t\tclearTimeout(this.callingTimeout);\n\t\tif (!this.calling)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.calling = false;\n\t\tthis.inviteTimeout = true;\n\t\tif (internal)\n\t\t{\n\t\t\tthis.callbacks.onInviteTimeout({\n\t\t\t\tuserId: this.userId\n\t\t\t});\n\t\t}\n\t\tthis.updateCalculatedState();\n\t}\n\n\tonConnectionRestoreTimeout()\n\t{\n\t\tif (this.endpoint || !this.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log(\"Done waiting for connection restoration\");\n\t\tthis.setReady(false);\n\t}\n\n\t#onEndpointRemoteMediaAdded = (e) =>\n\t{\n\t\tthis.log(\"VoxImplant.EndpointEvents.RemoteMediaAdded\", e.mediaRenderer);\n\n\t\t// voximplant audio auto-play bug workaround:\n\t\tif (e.mediaRenderer.element)\n\t\t{\n\t\t\te.mediaRenderer.element.volume = 0;\n\t\t\te.mediaRenderer.element.srcObject = null;\n\t\t}\n\t\tthis.addMediaRenderer(e.mediaRenderer);\n\t}\n\n\t#onEndpointRemoteMediaRemoved = (e) =>\n\t{\n\t\tconsole.log(\"VoxImplant.EndpointEvents.RemoteMediaRemoved, \", e.mediaRenderer)\n\t\t//this.log(\"VoxImplant.EndpointEvents.RemoteMediaRemoved, \", e);\n\t\tthis.removeMediaRenderer(e.mediaRenderer);\n\t}\n\n\t#onEndpointVoiceStart = () =>\n\t{\n\t\tthis.callbacks.onVoiceStarted();\n\t}\n\n\t#onEndpointVoiceEnd = () =>\n\t{\n\t\tthis.callbacks.onVoiceEnded();\n\t}\n\n\t#onEndpointRemoved = (e) =>\n\t{\n\t\tthis.log(\"VoxImplant.EndpointEvents.Removed\", e);\n\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\t\tif (this.stream)\n\t\t{\n\t\t\tthis.stream = null;\n\t\t}\n\n\t\tif (this.ready)\n\t\t{\n\t\t\tthis.waitForConnectionRestore();\n\t\t}\n\n\t\tthis.updateCalculatedState();\n\t}\n\n\t#onEndpointMediaRenderEnabled = (e) =>\n\t{\n\t\tthis.callbacks.onMediaRenderEnabled(e);\n\t}\n\n\t#onEndpointMediaRenderDisabled = (e) =>\n\t{\n\t\tthis.callbacks.onMediaRenderDisabled(e);\n\t}\n\n\tlog()\n\t{\n\t\tthis.call.log.apply(this.call, arguments);\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.stream)\n\t\t{\n\t\t\tUtil.stopMediaStream(this.stream);\n\t\t\tthis.stream = null;\n\t\t}\n\t\tif (this.endpoint)\n\t\t{\n\t\t\tthis.removeEndpointEventHandlers();\n\t\t\tthis.endpoint = null;\n\t\t}\n\n\t\tthis.callbacks.onStateChanged = BX.DoNothing;\n\t\tthis.callbacks.onInviteTimeout = BX.DoNothing;\n\t\tthis.callbacks.onMediaReceived = BX.DoNothing;\n\t\tthis.callbacks.onMediaRemoved = BX.DoNothing;\n\n\t\tclearTimeout(this.callingTimeout);\n\t\tclearTimeout(this.connectionRestoreTimeout);\n\t\tthis.callingTimeout = null;\n\t\tthis.connectionRestoreTimeout = null;\n\t}\n}\n\nconst transformVoxStats = function (s, voximplantCall)\n{\n\tlet result = {\n\t\tconnection: s.connection,\n\t\toutboundAudio: [],\n\t\toutboundVideo: [],\n\t\tinboundAudio: [],\n\t\tinboundVideo: [],\n\t}\n\n\tlet endpoints = {};\n\tif (voximplantCall.getEndpoints)\n\t{\n\t\tvoximplantCall.getEndpoints().forEach(endpoint => endpoints[endpoint.id] = endpoint)\n\t}\n\n\tif (!result.connection.timestamp)\n\t{\n\t\tresult.connection.timestamp = Date.now();\n\t}\n\tfor (let trackId in s.outbound)\n\t{\n\t\tif (!s.outbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tconst statGroup = s.outbound[trackId];\n\t\tfor (let i = 0; i < statGroup.length; i++)\n\t\t{\n\t\t\tlet stat = statGroup[i];\n\t\t\tstat.trackId = trackId;\n\t\t\tif ('audioLevel' in stat)\n\t\t\t{\n\t\t\t\tresult.outboundAudio.push(stat)\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult.outboundVideo.push(stat)\n\t\t\t}\n\t\t}\n\t}\n\tfor (let trackId in s.inbound)\n\t{\n\t\tif (!s.inbound.hasOwnProperty(trackId))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tlet stat = s.inbound[trackId];\n\t\tif (!('endpoint' in stat))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\t\tstat.trackId = trackId;\n\t\tif ('audioLevel' in stat)\n\t\t{\n\t\t\tresult.inboundAudio.push(stat)\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (endpoints[stat.endpoint])\n\t\t\t{\n\t\t\t\tlet videoRenderer = endpoints[stat.endpoint].mediaRenderers.find(r => r.id == stat.trackId)\n\t\t\t\tif (videoRenderer && videoRenderer.element)\n\t\t\t\t{\n\t\t\t\t\tstat.actualHeight = videoRenderer.element.videoHeight;\n\t\t\t\t\tstat.actualWidth = videoRenderer.element.videoWidth;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.inboundVideo.push(stat)\n\t\t}\n\t}\n\treturn result;\n\n}\n","import {Type} from 'main.core';\nimport {CallEvent, UserMnemonic} from './engine/engine';\nimport {View} from './view/view';\n\nconst StrategyType = {\n\tAllowAll: 'AllowAll',\n\tAllowNone: 'AllowNone',\n\tOnlySpeaker: 'OnlySpeaker',\n\tCurrentlyTalking: 'CurrentlyTalking'\n};\n\nconst HOLD_VIDEO_SECONDS = 20;\n\nexport class VideoStrategy\n{\n\tstatic Type = StrategyType\n\n\tcall: VoximplantCall\n\tcallView: View\n\tstrategyType: $Keys<typeof StrategyType>\n\tusers: {[string]: User}\n\n\tconstructor(config)\n\t{\n\t\tthis.call = config.call;\n\t\tthis.callView = config.callView;\n\t\tthis.strategyType = config.strategyType || StrategyType.AllowAll;\n\n\t\t// event handlers\n\t\tthis.onCallUserVoiceStartedHandler = this.onCallUserVoiceStarted.bind(this);\n\t\tthis.onCallUserVoiceStoppedHandler = this.onCallUserVoiceStopped.bind(this);\n\t\tthis.onCallViewSetCentralUserHandler = this.onCallViewSetCentralUser.bind(this);\n\t\tthis.onCallViewLayoutChangeHandler = this.onCallViewLayoutChange.bind(this);\n\n\t\tthis.users = {};\n\n\t\tthis.init();\n\t};\n\n\tinit()\n\t{\n\t\tif (this.strategyType === StrategyType.AllowAll)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.all);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.AllowNone)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t}\n\t\tthis.bindEvents();\n\t};\n\n\tbindEvents()\n\t{\n\t\tthis.call.addEventListener(CallEvent.onUserVoiceStarted, this.onCallUserVoiceStartedHandler);\n\t\tthis.call.addEventListener(CallEvent.onUserVoiceStopped, this.onCallUserVoiceStoppedHandler);\n\t\tthis.callView.subscribe(View.Event.onSetCentralUser, this.onCallViewSetCentralUserHandler);\n\t\tthis.callView.subscribe(View.Event.onLayoutChange, this.onCallViewLayoutChangeHandler);\n\t};\n\n\tremoveEvents()\n\t{\n\t\tif (this.call)\n\t\t{\n\t\t\tthis.call.removeEventListener(CallEvent.onUserVoiceStarted, this.onCallUserVoiceStartedHandler);\n\t\t\tthis.call.removeEventListener(CallEvent.onUserVoiceStopped, this.onCallUserVoiceStoppedHandler);\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.unsubscribe(View.Event.onSetCentralUser, this.onCallViewSetCentralUserHandler);\n\t\t\tthis.callView.unsubscribe(View.Event.onLayoutChange, this.onCallViewLayoutChangeHandler);\n\t\t}\n\t};\n\n\tsetType(strategyType: $Keys<typeof StrategyType>)\n\t{\n\t\tif (strategyType == this.strategyType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.strategyType = strategyType;\n\t\tthis.applyVideoLimit();\n\t};\n\n\tapplyVideoLimit()\n\t{\n\t\tif (this.strategyType === StrategyType.AllowAll)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.all);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.AllowNone)\n\t\t{\n\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t}\n\t\telse if (this.strategyType === StrategyType.CurrentlyTalking)\n\t\t{\n\t\t\tlet talkingUsers = this.getActiveUsers();\n\t\t\tif (talkingUsers.length === 0)\n\t\t\t{\n\t\t\t\tthis.call.allowVideoFrom(UserMnemonic.none);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.call.allowVideoFrom(this.getActiveUsers());\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * return int[]\n\t */\n\tgetActiveUsers()\n\t{\n\t\tlet result = [];\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tlet user = this.users[userId];\n\t\t\tif (user.active)\n\t\t\t{\n\t\t\t\tresult.push(user.id)\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tonUserActiveChanged()\n\t{\n\t\tif (this.strategyType == StrategyType.CurrentlyTalking)\n\t\t{\n\t\t\tthis.applyVideoLimit();\n\t\t}\n\t};\n\n\tonCallUserVoiceStarted(data)\n\t{\n\t\tconst userId = data.userId;\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthis.users[userId] = new User({\n\t\t\t\tid: userId,\n\t\t\t\tonActiveChanged: this.onUserActiveChanged.bind(this)\n\t\t\t});\n\t\t}\n\n\t\tthis.users[userId].setTalking(true);\n\t};\n\n\tonCallUserVoiceStopped(data)\n\t{\n\t\tconst userId = data.userId;\n\t\tif (!this.users[userId])\n\t\t{\n\t\t\tthis.users[userId] = new User({\n\t\t\t\tid: userId,\n\t\t\t\tonActiveChanged: this.onUserActiveChanged.bind(this)\n\t\t\t});\n\t\t}\n\n\t\tthis.users[userId].setTalking(false);\n\t};\n\n\tonCallViewSetCentralUser(event)\n\t{\n\t\tconst userId = event.data.userId;\n\n\t\tif (this.strategyType === StrategyType.OnlySpeaker)\n\t\t{\n\t\t\tthis.call.allowVideoFrom([userId]);\n\t\t}\n\t};\n\n\tonCallViewLayoutChange(event)\n\t{\n\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.removeEvents();\n\t\tthis.call = null;\n\t\tthis.callView = null;\n\n\t\tfor (let userId in this.users)\n\t\t{\n\t\t\tif (this.users.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tthis.users[userId].destroy();\n\t\t\t}\n\t\t}\n\t\tthis.users = {};\n\t};\n}\n\nclass User\n{\n\tid: number\n\ttalking = false\n\tsharing = false\n\tactive = false\n\n\tconstructor(config)\n\t{\n\t\tthis.id = config.id;\n\n\t\tthis.callbacks = {\n\t\t\tonActiveChanged: Type.isFunction(config.onActiveChanged) ? config.onActiveChanged : BX.DoNothing\n\t\t};\n\n\t\tthis.turnOffVideoTimeout = null;\n\t};\n\n\tsetTalking(talking: boolean)\n\t{\n\t\tif (this.talking == talking)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.talking = talking;\n\t\tif (this.talking)\n\t\t{\n\t\t\tthis.cancelTurnOffVideo();\n\t\t\tthis.updateActive();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.scheduleTurnOffVideo();\n\t\t}\n\t};\n\n\tsetSharing(sharing: boolean)\n\t{\n\t\tif (this.sharing == sharing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.sharing = sharing;\n\t\tif (this.sharing)\n\t\t{\n\t\t\tthis.cancelTurnOffVideo();\n\t\t\tthis.updateActive();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.scheduleTurnOffVideo();\n\t\t}\n\t};\n\n\tupdateActive()\n\t{\n\t\tconst newActive = !!(this.sharing || this.talking || this.turnOffVideoTimeout);\n\t\tif (newActive !== this.active)\n\t\t{\n\t\t\tthis.active = newActive;\n\t\t}\n\t\tthis.callbacks.onActiveChanged({\n\t\t\tuserId: this.id,\n\t\t\tactive: this.active\n\t\t});\n\t};\n\n\tscheduleTurnOffVideo()\n\t{\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t\tthis.turnOffVideoTimeout = setTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tthis.turnOffVideoTimeout = null;\n\t\t\t\tthis.updateActive();\n\t\t\t},\n\t\t\tHOLD_VIDEO_SECONDS * 1000\n\t\t);\n\t};\n\n\tcancelTurnOffVideo()\n\t{\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t\tthis.turnOffVideoTimeout = null;\n\t};\n\n\tdestroy()\n\t{\n\t\tthis.callbacks.onActiveChanged = BX.DoNothing;\n\t\tclearTimeout(this.turnOffVideoTimeout);\n\t};\n}","import { Dom, Loc } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { Analytics } from 'call.lib.analytics';\nimport '../css/copilot-popup.css';\nimport Util from '../util';\nimport { CallAI } from '../call_ai';\n\nexport class CopilotPopup\n{\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\t\tthis.popupTemplate = null;\n\t\tthis.isCopilotActive = config.isCopilotActive;\n\t\tthis.isCopilotFeaturesEnabled = config.isCopilotFeaturesEnabled;\n\t\tthis.callId = config.callId;\n\n\t\tthis.callbacks = {\n\t\t\tupdateCopilotState: BX.type.isFunction(config.updateCopilotState) ? config.updateCopilotState : BX.DoNothing,\n\t\t\tonClose: BX.type.isFunction(config.onClose) ? config.onClose : BX.DoNothing,\n\t\t}\n\t};\n\n\tgetPopupTemplate()\n\t{\n\t\tconst getButton = () => {\n\n\t\t\tif (!this.isCopilotFeaturesEnabled)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('private_coming_soon');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button coming_soon' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_COMING_SOON'),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!CallAI.settingsEnabled)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('error_turnedoff');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_transparent' },\n\t\t\t\t\ttext: Loc.getMessage('CALL_COPILOT_POPUP_SETTINGS_DISABLED'),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!CallAI.tariffAvailable)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('tariff_limit');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button tariff_up' },\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tUtil.openArticle(CallAI.helpSlider);\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'bx-call-copilot-popup__button_wrapper',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'bx-call-copilot-popup__button_icon',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'bx-call-copilot-popup__button_text',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_TARIFF_UP'),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!CallAI.agreementAccepted)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('agreement_limit');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button bx-call-copilot-popup__button_transparent' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_CONCERN_NOT_ACCEPTED'),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (this.isCopilotActive)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__button turn_off' },\n\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_DISABLE'),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tthis.callbacks.updateCopilotState();\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!CallAI.baasAvailable)\n\t\t\t{\n\t\t\t\tthis.sendAnalytics('baas_limit');\n\n\t\t\t\treturn {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: 'bx-call-copilot-popup__button --secondary buy_boost',\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: 'bx-call-copilot-popup__button_wrapper',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'bx-call-copilot-popup__button_icon',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\t\t\tclassName: 'bx-call-copilot-popup__button_text',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_BUY_BOOST'),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\tUtil.openArticle(CallAI.baasPromoSlider);\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tprops: { className: 'bx-call-copilot-popup__button turn_on' },\n\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_BUTTON_ENABLE'),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.callbacks.updateCopilotState();\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t};\n\n\t\tthis.popupTemplate = Dom.create(\"div\", {\n\t\t\tprops: { className: 'bx-call-copilot-popup__wrapper' },\n\t\t\tchildren: [\n\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__content' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title-icon-background' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title-icon-image' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__title-text' },\n\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_TITLE'),\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__description' },\n\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_TITLE'),\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tDom.create(\"ul\", {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_ai' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_AGENDA'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_pen' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_AGREEMENTS_V2'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_magic-pen' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_GRADE'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tDom.create(\"li\", {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item' },\n\t\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-icon bx-call-copilot-popup__list-item-icon_list' },\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\tDom.create(\"div\", {\n\t\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__list-item-text' },\n\t\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_COPILOT_POPUP_LIST_ITEM_TRANSCRIPT_V2'),\n\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-call-copilot-popup__actions' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create('button', getButton()),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tcreate()\n\t{\n\t\tconst copilotButton = document.querySelector('.bx-messenger-videocall-panel-background-copilot');\n\t\tconst self = this;\n\n\t\tif (!copilotButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getPopupTemplate();\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName : \"bx-call-copilot-popup\",\n\t\t\tbindElement: copilotButton,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.popupTemplate,\n\t\t\tbindOptions: {\n\t\t\t\tposition: \"top\"\n\t\t\t},\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tbackground: '#190A37',\n\t\t\tcontentBackground: '#190A37',\n\t\t\tdarkMode: true,\n\t\t\tcontentNoPaddings: true,\n\t\t\tanimation: \"fading\",\n\t\t\twidth: 364,\n\t\t\tpadding: 0,\n\t\t\tangle: {\n\t\t\t\toffset: 162,\n\t\t\t\tposition: 'bottom',\n\t\t\t},\n\t\t\toffsetLeft: -118,\n\t\t\tcontentBorderRadius: '18px',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\tself.callbacks.onClose();\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tself.popup = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.create();\n\t\tthis.popup.show();\n\t}\n\n\ttoggle()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.close();\n\t}\n\n\tsendAnalytics(popupType)\n\t{\n\t\tAnalytics.getInstance().copilot.onAIRestrictionsPopupShow({\n\t\t\tcallId: this.callId,\n\t\t\tpopupType,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { Popup } from 'main.popup';\nimport { EventEmitter } from 'main.core.events'\nimport '../css/participants-permission-popup.css';\nimport { Provider } from '../engine/engine';\nimport 'ui.switcher';\nimport Util from '../util';\n\nconst ParticipantsPermissionPopupEvents = {\n\tonTurnOffStreamForAll: 'onTurnOffStreamForAll',\n};\n\nexport class ParticipantsPermissionPopup\n{\n\tconstructor(config)\n\t{\n\t\tthis.popup = null;\n\n\t\tthis.roomPermissions = config.roomPermissions;\n\n\t\tthis.elements = {\n\t\t\troot: null,\n\t\t\troomPermissions: null,\n\t\t\troomSettings: null,\n\t\t\tallParticipantsDeviceControl: null,\n\t\t};\n\n\t\tthis.roomSettingsElements = {\n\t\t\tmic: null,\n\t\t\tcam: null,\n\t\t\tscreenshare: null,\n\t\t};\n\n\t\tthis.callbacks = {\n\t\t\tturnOffAllParticipansStream:\n\t\t\t\tBX.type.isFunction(config.turnOffAllParticipansStream)\n\t\t\t\t\t? config.turnOffAllParticipansStream\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonPermissionChanged:\n\t\t\t\tBX.type.isFunction(config.onPermissionChanged)\n\t\t\t\t\t? config.onPermissionChanged\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonPermissionCollapseStateChanged:\n\t\t\t\tBX.type.isFunction(config.onPermissionCollapseStateChanged)\n\t\t\t\t\t? config.onPermissionCollapseStateChanged\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonClose:\n\t\t\t\tBX.type.isFunction(config.onClose)\n\t\t\t\t\t? config.onClose\n\t\t\t\t\t: BX.DoNothing,\n\t\t\tonOpen:\n\t\t\t\tBX.type.isFunction(config.onOpen)\n\t\t\t\t\t? config.onOpen\n\t\t\t\t\t: BX.DoNothing,\n\t\t}\n\n\t\tthis.eventEmitter = new EventEmitter(this, 'ParticipantsPermissionPopup');\n\n\t\tthis.currentBitrixCall = Util.getCurrentBitrixCall();\n\n\t\tthis.isShowPopup =\n\t\t\tUtil.isUserControlFeatureEnabled()\n\t\t\t&& this.currentBitrixCall\n\t\t\t&& this.currentBitrixCall.provider !== Provider.Plain;\n\t\t\t/*&&\n\t\t\t\t!(this.currentBitrixCall.associatedEntity.type === 'chat'\n\t\t\t\t&& this.currentBitrixCall.associatedEntity.advanced['chatType'] === 'videoconf');*/\n\n\t\tthis.isShowRoomSettings = BX.prop.getObject(config, 'showRoomSettings', false);\n\t\t\n\t\tif (\n\t\t\t!Util.getRoomPermissions().ScreenShareEnabled\n\t\t\t|| !Util.getRoomPermissions().AudioEnabled\n\t\t\t|| !Util.getRoomPermissions().VideoEnabled)\n\t\t{\n\t\t\tthis.isShowRoomSettings = true;\n\t\t}\n\n\t\tlet events = BX.prop.getObject(config, 'events', {});\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tif (!events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t}\n\t}\n\n\trenderSettingsElements()\n\t{\n\t\tthis.roomSettingsElements.screenshare = ParticipantsPermissionSwitcher.create({\n\t\t\ttypeOfSetting: 'screenshare',\n\t\t\tcanControlPermission: true,\n\t\t\tsettingEnabled: Util.getRoomPermissions().ScreenShareEnabled,\n\t\t\tlabel: BX.message('CALL_CONTROL_PERMISSIONS_IN_CALL_LABEL_SCREENSHARE'),\n\t\t\tevents: {\n\t\t\t\tonSwitch: this.onPermissionChanged.bind(this)\n\t\t\t}\n\n\t\t});\n\t\tthis.roomSettingsElements.mic = ParticipantsPermissionSwitcher.create({\n\t\t\ttypeOfSetting: 'mic',\n\t\t\tcanControlPermission: true,\n\t\t\tsettingEnabled: Util.getRoomPermissions().AudioEnabled,\n\t\t\tlabel: BX.message('CALL_CONTROL_PERMISSIONS_IN_CALL_LABEL_MIC'),\n\t\t\tevents: {\n\t\t\t\tonSwitch: this.onPermissionChanged.bind(this)\n\t\t\t}\n\n\t\t});\n\t\tthis.roomSettingsElements.cam = ParticipantsPermissionSwitcher.create({\n\t\t\ttypeOfSetting: 'cam',\n\t\t\tcanControlPermission: true,\n\t\t\tsettingEnabled: Util.getRoomPermissions().VideoEnabled,\n\t\t\tlabel: BX.message('CALL_CONTROL_PERMISSIONS_IN_CALL_LABEL_CAM'),\n\t\t\tevents: {\n\t\t\t\tonSwitch: this.onPermissionChanged.bind(this)\n\t\t\t}\n\n\t\t});\n\n\t\treturn [\n\t\t\tthis.roomSettingsElements.screenshare.render(),\n\t\t\tthis.roomSettingsElements.mic.render(),\n\t\t\tthis.roomSettingsElements.cam.render(),\n\t\t];\n\t}\n\n\tupdateStatePermissions()\n\t{\n\t\tif (this.elements.roomSettings)\n\t\t{\n\t\t\tconst settingsElements = this.renderSettingsElements();\n\t\t\tthis.elements.roomSettings.innerHTML = '';\n\t\t\tthis.elements.roomSettings.append(...settingsElements);\n\t\t}\n\n\t}\n\n\ttoggleRoomSettings(e)\n\t{\n\t\tthis.isShowRoomSettings = !this.isShowRoomSettings;\n\n\t\tif (this.isShowRoomSettings)\n\t\t{\n\t\t\tthis.elements.roomPermissions.classList.add('permissions-uncollapsed');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.roomPermissions.classList.remove('permissions-uncollapsed');\n\t\t}\n\t\t\n\t\tthis.callbacks.onPermissionCollapseStateChanged(this.isShowRoomSettings);\n\t}\n\n\tgetPopupTemplate()\n\t{\n\t\treturn Dom.create('div', {\n\t\t\tprops: { className: 'bx-call-participants-permission-popup__wrapper' },\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__content' },\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tthis.elements.roomPermissions = Dom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__permissions-wrapper' },\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__permissions-title-wrapper' },\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tclick: () => {\n\t\t\t\t\t\t\t\t\t\tthis.toggleRoomSettings();\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t\tDom.create('span', {\n\t\t\t\t\t\t\t\t\t\tprops: {className: 'bx-call-participants-permission-popup__permissions-title'},\n\t\t\t\t\t\t\t\t\t\ttext: BX.message('CALL_CONTROL_PERMISSIONS_IN_CALL_TITLE'),\n\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__permissions-title-arrow' },\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t]}),\n\n\t\t\t\t\t\t\t\tthis.elements.roomSettings = Dom.create('div', {\n\t\t\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__permissions' },\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__control-buttons-label' },\n\t\t\t\t\t\t\ttext: BX.message('CALL_ADMIN_TURN_OFF_FOR_ALL_LABEL'),\n\t\t\t\t\t\t}),\n\n\t\t\t\t\t\tDom.create('div', {\n\t\t\t\t\t\t\tprops: { className: 'bx-call-participants-permission-popup__control-buttons' },\n\t\t\t\t\t\t\tchildren: [\n\n\t\t\t\t\t\t\t\tthis.turnOffMicContainer = ParticipantsStreamControlButton.create({\n\t\t\t\t\t\t\t\t\ttypeOfStream: 'mic',\n\t\t\t\t\t\t\t\t\tlabel: BX.message('CALL_TURN_OFF_MIC_FOR_ALL_PARTICIPANTS_MSGVER_1'),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tonTurnOffStreamForAll: this.onTurnOffStreamForAll.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}).render(),\n\n\t\t\t\t\t\t\t\tthis.turnOffMicContainer = ParticipantsStreamControlButton.create({\n\t\t\t\t\t\t\t\t\ttypeOfStream: 'cam',\n\t\t\t\t\t\t\t\t\tlabel: BX.message('CALL_TURN_OFF_CAM_FOR_ALL_PARTICIPANTS_MSGVER_1'),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tonTurnOffStreamForAll: this.onTurnOffStreamForAll.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}).render(),\n\n\t\t\t\t\t\t\t\tthis.turnOffMicContainer = ParticipantsStreamControlButton.create({\n\t\t\t\t\t\t\t\t\ttypeOfStream: 'screenshare',\n\t\t\t\t\t\t\t\t\tlabel: BX.message('CALL_TURN_OFF_SCREENSHARE_FOR_ALL_PARTICIPANTS_MSGVER_1'),\n\t\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\t\tonTurnOffStreamForAll: this.onTurnOffStreamForAll.bind(this)\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}).render(),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t}),\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t})\n\t}\n\n\tonPermissionChanged(e)\n\t{\n\t\tthis.callbacks.onPermissionChanged(e.data);\n\t}\n\n\tonTurnOffStreamForAll(e)\n\t{\n\t\tthis.callbacks.turnOffAllParticipansStream(e);\n\t\tthis.close();\n\t}\n\n\tclose()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tcreate()\n\t{\n\t\tconst participantsButton = document.querySelector('.bx-messenger-videocall-top-button-text.callcontrol');\n\t\tconst self = this;\n\t\t\n\t\tif (!participantsButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isShowPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.elements.root = this.getPopupTemplate();\n\n\t\tconst settingsElements = this.renderSettingsElements();\n\t\tthis.elements.roomSettings.innerHTML = '';\n\t\tthis.elements.roomSettings.append(...settingsElements);\n\t\t\n\t\tif (this.isShowRoomSettings)\n\t\t{\n\t\t\tthis.elements.roomPermissions?.classList.add('permissions-uncollapsed');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.elements.roomPermissions?.classList.remove('permissions-uncollapsed');\n\t\t}\n\t\t\n\t\t\n\n\t\tthis.popup = new Popup({\n\t\t\tclassName : 'bx-call-participants-permission-popup',\n\t\t\tbindElement: participantsButton,\n\t\t\ttargetContainer: document.body,\n\t\t\tcontent: this.elements.root,\n\t\t\toffsetTop: 10,\n\t\t\tbindOptions: {\n\t\t\t\tposition: 'bottom'\n\t\t\t},\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tangle: {position: 'top'},\n\t\t\tcontentNoPaddings: true,\n\t\t\tanimation: 'fading',\n\t\t\tevents: {\n\t\t\t\tonPopupClose: function ()\n\t\t\t\t{\n\t\t\t\t\tself.callbacks.onClose();\n\t\t\t\t\tthis.destroy();\n\t\t\t\t},\n\t\t\t\tonPopupShow: function ()\n\t\t\t\t{\n\t\t\t\t\tself.callbacks.onOpen();\n\t\t\t\t},\n\t\t\t\tonPopupDestroy: function ()\n\t\t\t\t{\n\t\t\t\t\tself.popup = null;\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tshow()\n\t{\n\t\tthis.create();\n\t\tthis.popup?.show();\n\t}\n\n\ttoggle()\n\t{\n\t\tif (!this.popup)\n\t\t{\n\t\t\tthis.show();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.close();\n\t}\n}\n\n\nconst ParticipantsStreamControlButtonEvents = {\n\tonTurnOffStreamForAll: 'onTurnOffStreamForAll'\n};\n\nclass ParticipantsStreamControlButton\n{\n\tconstructor(config)\n\t{\n\t\tconfig = BX.type.isObject(config) ? config : {};\n\n\t\tthis.label = config.label || '';\n\t\tthis.typeOfStream = config.typeOfStream || '';\n\t\tthis.eventEmitter = new EventEmitter(this, 'ParticipantsStreamControl');\n\n\t\tlet events = BX.prop.getObject(config, 'events', {});\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tif (!events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t}\n\t}\n\n\tstatic create(config)\n\t{\n\t\treturn new ParticipantsStreamControlButton(config);\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create('div', {\n\t\t\tprops: {className: 'bx-call-view-participants-control-stream-button'},\n\t\t\tchildren: [\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {className: 'bx-call-view-participants-control-stream-button-icon bx-call-view-participants-control-stream-button-icon-' + this.typeOfStream},\n\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {className: 'bx-call-view-participants-control-stream-button-action'},\n\t\t\t\t\ttext: this.label\n\t\t\t\t})\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tclick: (e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.eventEmitter.emit(ParticipantsStreamControlButtonEvents.onTurnOffStreamForAll, {\n\t\t\t\t\t\ttypeOfStream: this.typeOfStream\n\t\t\t\t\t})\n\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n}\n\nconst ParticipantsPermissionSwitcherEvents = {\n\tonSwitch: 'onSwitch',\n};\n\nclass ParticipantsPermissionSwitcher\n{\n\tconstructor(config)\n\t{\n\t\tconfig = BX.type.isObject(config) ? config : {};\n\n\t\tthis.label = config.label || '';\n\t\tthis.typeOfSetting = config.typeOfSetting || '';\n\t\tthis.canControlPermission = config.canControlPermission || false;\n\t\tthis.settingEnabled = config.settingEnabled || false;\n\t\tthis.eventEmitter = new EventEmitter(this, 'ParticipantsPermissionSwitcher');\n\n\t\tlet events = BX.prop.getObject(config, 'events', {});\n\t\tfor (let eventName in events)\n\t\t{\n\t\t\tif (!events.hasOwnProperty(eventName))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tthis.eventEmitter.subscribe(eventName, events[eventName]);\n\t\t}\n\t}\n\n\tstatic create(config)\n\t{\n\t\treturn new ParticipantsPermissionSwitcher(config);\n\t}\n\n\tonSwitchToggled(e)\n\t{\n\t\tif (!this.canControlPermission)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.settingEnabled = !this.settingEnabled;\n\n\t\tthis.eventEmitter.emit(ParticipantsPermissionSwitcherEvents.onSwitch, {\n\t\t\tsettingEnabled: this.settingEnabled,\n\t\t\ttypeOfSetting: this.typeOfSetting,\n\t\t})\n\t}\n\n\trender()\n\t{\n\t\treturn Dom.create('div', {\n\t\t\tprops: {\n\t\t\t\tclassName: 'bx-call-view-participants-permissions-switch-wrapper',\n\t\t\t},\n\t\t\tdataset: {\n\t\t\t\tid: 'call-participants-permissions-switch-' + this.typeOfSetting,\n\t\t\t},\n\t\t\tchildren: [\n\t\t\t\tDom.create('span', {\n\t\t\t\t\tprops: {className: 'bx-call-view-participants-permissions-label'},\n\t\t\t\t\ttext: this.label\n\n\t\t\t\t}),\n\t\t\t\tDom.create('div', {\n\t\t\t\t\tprops: {className: 'bx-call-view-participants-permissions-switch'},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t(new BX.UI.Switcher({\n\t\t\t\t\t\t\tsize: 'small',\n\t\t\t\t\t\t\tchecked: this.settingEnabled,\n\t\t\t\t\t\t\thandlers: {\n\t\t\t\t\t\t\t\ttoggled: this.onSwitchToggled.bind(this)\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdisabled: !this.canControlPermission,\n\t\t\t\t\t\t})).getNode()\n\t\t\t\t\t]\n\t\t\t\t}),\n\t\t\t]\n\t\t});\n\t}\n}","import {Loc, Browser, Dom, Type, Text, Reflection, ZIndexManager, Event} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Popup, Menu} from 'main.popup';\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\nimport {Button} from 'ui.buttons';\nimport {LocalStorage} from 'im.lib.localstorage';\nimport { DesktopApi, DesktopFeature } from 'im.v2.lib.desktop-api';\nimport { DesktopBroadcastManager } from 'im.v2.lib.desktop';\nimport { SoundType, DesktopBroadcastAction } from 'im.v2.const';\nimport {DesktopDownload} from 'intranet.desktop-download';\n\nimport {BackgroundDialog} from './dialogs/background_dialog'\nimport {PromoPopup, PromoPopup3D} from './dialogs/promo_popup';\nimport {IncomingNotification} from './dialogs/incoming_notification';\nimport {ConferenceNotifications} from './dialogs/conference_notification';\nimport {CallHint} from './call_hint_popup';\nimport { UnsupportedBrowserFeatures } from './engine/unsupported_features_in_browsers';\nimport { CallStreamManager } from './media-stream-manager';\nimport {Sidebar} from './sidebar';\nimport { CopilotNotifyType } from './view/copilot-notify';\nimport {WebScreenSharePopup} from './web_screenshare_popup';\nimport {FloatingScreenShare} from './floating_screenshare';\nimport {\n\tCallEngine,\n\tUserState,\n\tProvider,\n\tCallState,\n\tCallEvent,\n\tDisconnectReason,\n\tCallScheme,\n\tStartCallErrorCode,\n} from './engine/engine';\nimport {CallEngineLegacy} from './engine/engine_legacy';\nimport {BitrixCall} from './engine/bitrix_call_legacy'\nimport {VoximplantCall} from './engine/voximplant_call'\nimport {PlainCall} from './engine/plain_call';\nimport {SimpleVAD} from './engine/simple_vad';\nimport {Hardware} from './call_hardware';\nimport {View} from './view/view';\nimport {VideoStrategy} from './video_strategy';\nimport Util from './util';\nimport { Utils } from 'im.v2.lib.utils';\nimport { Analytics } from 'call.lib.analytics';\nimport { CallTokenManager } from 'call.lib.call-token-manager';\nimport { CopilotPopup, CopilotPopupType } from './view/copilot-popup';\nimport { CallAI } from './call_ai';\nimport { MediaStreamsKinds, RecorderStatus, CloudRecordKind, CloudRecordStatus, JoinResponseError } from './call_api.js';\nimport { MediaRenderer } from './view/media-renderer';\nimport { ParticipantsPermissionPopup } from './view/participants-permission-popup';\nimport {PictureInPictureWindow} from './view/pictureInPictureWindow';\nimport { CallSettingsManager } from 'call.lib.settings-manager';\nimport { CallMultiChannel } from './call_multi_channel';\nimport { CallCloudRecord, CallCommonRecordState, CallCommonRecordType } from './call_common_record';\n\nimport './css/call-overlay.css';\n\nconst Events = {\n\tonViewStateChanged: 'onViewStateChanged',\n\tonOpenVideoConference: 'onOpenVideoConference',\n\tonPromoViewed: 'onPromoViewed',\n\tonCallJoined: 'onCallJoined',\n\tonCallLeft: 'onCallLeft',\n\tonCallDestroyed: 'onCallDestroyed',\n};\n\nconst ViewState = {\n\tOpened: 'Opened',\n\tClosed: 'Closed',\n\tFolded: 'Folded'\n};\n\nconst DocumentType = {\n\tResume: 'resume',\n\tBlank: 'blank'\n};\n\nconst FeatureState = {\n\tEnabled: 'enabled',\n\tDisabled: 'disabled',\n\tLimited: 'limited',\n}\n\nconst DOC_EDITOR_WIDTH = 961;\nconst DOC_TEMPLATE_WIDTH = 328;\nconst DOC_CREATED_EVENT = 'CallController::documentCreated';\nconst DOCUMENT_PROMO_CODE = 'im:call-document:16102021:web';\nconst DOCUMENT_PROMO_DELAY = 5 * 60 * 1000; // 5 minutes\nconst FILE_TYPE_DOCX = 'docx';\nconst FILE_TYPE_XLSX = 'xlsx';\nconst FILE_TYPE_PPTX = 'pptx';\n\nconst BALLOON_OFFSET_CLASS_NAME = 'bx-call-control-notification-right-offset';\n\nconst MASK_PROMO_CODE = 'im:mask:06122022:desktop';\nconst MASK_PROMO_DELAY = 5 * 60 * 1000; // 5 minutes\n\nconst DEFAULT_GENDER = 'M';\n\nconst CLOUD_RECORD_PROMO_CODE = 'call:cloud-record-info-popup:09092025:all';\n\ntype UserData = {\n\tid: number,\n\tname: string,\n\tavatar: string,\n\tavatar_hr: string,\n\trole: string,\n\tgender: string\n}\n\ntype InviteParams = {\n\tviewElement: HTMLElement,\n\tbindElement: HTMLElement,\n\tzIndex: number,\n\tdarkMode: boolean,\n\tidleUsers: number[],\n\tallowNewUsers: boolean,\n\tonDestroy: () => void,\n\tonSelect: ({user: UserData}) => void\n}\n\ntype Closer = {\n\tclose: () => void\n}\n\ntype MessengerFacade = {\n\tgetDefaultZIndex: () => number,\n\tisThemeDark: () => boolean,\n\tgetContainer: () => HTMLElement,\n\topenMessenger: (dialogId: string) => Promise,\n\topenHistory: (dialogId: string) => Promise,\n\topenSettings: (params: any) => void,\n\topenHelpArticle: (string) => void,\n\tisPromoRequired: (string) => boolean,\n\tisMessengerOpen: () => boolean,\n\tisSliderFocused: () => boolean,\n\tshowUserSelector?: (params: InviteParams) => Promise<Closer>,\n\n\tgetMessageCount: () => number,\n\tgetCurrentDialogId: () => string,\n\n\trepeatSound: (string, number, boolean) => void,\n\tstopRepeatSound: (string) => void\n}\n\nexport class CallController extends EventEmitter\n{\n\tcurrentCall: BitrixCall | PlainCall | VoximplantCall | null;\n\tcurrentCallIsNew: false;\n\tcallNotification: ?IncomingNotification;\n\tfloatingScreenShareWindow: ?FloatingScreenShare;\n\tcallView: ?View;\n\tlanguage: string;\n\tincomingVideoStrategyType: string;\n\tformatRecordDate: string;\n\tmessengerFacade: MessengerFacade;\n\n\t#onCallUserCommonRecordStateHandler;\n\t#onCloudRecordStatusChangedHandler;\n\n\t#onSwitchTrackRecordStatusHandler;\n\t#onRecorderStatusChangedHandler;\n\n\tconstructor(config)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Call.Controller');\n\n\t\tconst needInit = BX.prop.getBoolean(config, \"init\", true);\n\n\t\tthis.language = config.language || 'en';\n\t\tthis.incomingVideoStrategyType = config.incomingVideoStrategyType || VideoStrategy.Type.AllowAll;\n\t\tthis.formatRecordDate = config.formatRecordDate || 'd.m.Y';\n\n\t\tthis.messengerFacade = config.messengerFacade;\n\n\t\tthis.inited = false;\n\t\tthis.debug = false;\n\n\t\tthis.container = null;\n\t\tthis.docEditor = null;\n\t\tthis.docEditorIframe = null;\n\t\tthis.maxEditorWidth = DOC_TEMPLATE_WIDTH;\n\t\tthis.docCreatedForCurrentCall = false;\n\n\t\tthis.folded = false;\n\n\t\tthis.localStream = null;\n\t\tthis.audioRingtone = SoundType.ringtoneModern;\n\n\t\t// for setting the camera after reconnect\n\t\tthis.lastUsedCameraId = null;\n\t\tthis.reconnectingCameraId = null;\n\n\t\tthis.childCall = null;\n\t\tthis.invitePopup = null;\n\t\t/** @var {VideoStrategy} this.currentCall */\n\t\tthis.videoStrategy = null;\n\n\t\tthis.isHttps = window.location.protocol === \"https:\";\n\t\tthis.callWithLegacyMobile = false;\n\n\t\tthis.featureScreenSharing = FeatureState.Enabled;\n\n\t\tthis.screenShareStartTime = null;\n\n\t\tthis.commonRecord = this.#getDefaultCommonRecord();\n\n\t\tthis.autoCloseCallView = true;\n\n\t\tthis.talkingUsers = {};\n\n\t\tthis.promotedToAdminTimeoutValue = 10 * 1000; // 10 sec\n\t\tthis.promotedToAdminTimeout = null;\n\n\t\tthis.clickLinkInterceptor = null;\n\n\t\tthis._callViewState = ViewState.Closed;\n\n\t\tthis.answeredOrDeclinedCalls = new Set();\n\n\t\t// event handlers\n\t\tthis._onCallUserInvitedHandler = this._onCallUserInvited.bind(this);\n\t\tthis._onCallUserJoinedHandler = this._onCallUserJoined.bind(this);\n\t\tthis._onCallDestroyHandler = this._onCallDestroy.bind(this);\n\t\tthis._onCallUserStateChangedHandler = this._onCallUserStateChanged.bind(this);\n\t\tthis._onCallUserMicrophoneStateHandler = this._onCallUserMicrophoneState.bind(this);\n\t\tthis._onCallUserCameraStateHandler = this._onCallUserCameraState.bind(this);\n\t\tthis._onNeedResetMediaDevicesStateHandler = this._onNeedResetMediaDevicesState.bind(this);\n\t\tthis._onCameraPublishingHandler = this._onCameraPublishing.bind(this);\n\t\tthis._onMicrophonePublishingdHandler = this._onMicrophonePublishingd.bind(this);\n\t\tthis._onCallUserVideoPausedHandler = this._onCallUserVideoPaused.bind(this);\n\t\tthis._onCallLocalMediaReceivedHandler = this._onCallLocalMediaReceived.bind(this);\n\t\tthis._onCallLocalMediaStoppedHandler = this._onCallLocalMediaStopped.bind(this);\n\t\tthis._onCallLocalScreenUpdatedHandler = this._onCallLocalScreenUpdated.bind(this);\n\t\tthis._onCallLocalCameraFlipHandler = this._onCallLocalCameraFlip.bind(this);\n\t\tthis._onCallLocalCameraFlipInDesktopHandler = this._onCallLocalCameraFlipInDesktop.bind(this);\n\t\tthis._onCallRemoteMediaReceivedHandler = this._onCallRemoteMediaReceived.bind(this);\n\t\tthis._onCallRemoteMediaStoppedHandler = this._onCallRemoteMediaStopped.bind(this);\n\t\tthis._onCallBadNetworkIndicatorHandler = this._onCallBadNetworkIndicator.bind(this);\n\t\tthis._onCallConnectionQualityChangedHandler = this._onCallConnectionQualityChanged.bind(this);\n\t\tthis._onCallToggleRemoteParticipantVideoHandler = this._onCallToggleRemoteParticipantVideo.bind(this);\n\t\tthis._onCallUserVoiceStartedHandler = this._onCallUserVoiceStarted.bind(this);\n\t\tthis._onCallUserVoiceStoppedHandler = this._onCallUserVoiceStopped.bind(this);\n\t\tthis._onAllParticipantsAudioMutedHandler = this._onAllParticipantsAudioMuted.bind(this);\n\t\tthis._onAllParticipantsVideoMutedHandler = this._onAllParticipantsVideoMuted.bind(this);\n\t\tthis._onTurnOnCameraHandler = this._onTurnOnCamera.bind(this);\n\t\tthis._onAllParticipantsScreenshareHandler = this._onAllParticipantsScreenshareMuted.bind(this);\n\t\tthis._onYouMuteAllParticipantsHandler = this._onYouMuteAllParticipants.bind(this);\n\t\tthis._onRoomSettingsChangedHandler = this._onRoomSettingsChanged.bind(this);\n\t\tthis._onUserPermissionsChangedHandler = this._onUserPermissionsChanged.bind(this);\n\t\tthis._onUserRoleChangedHandler = this._onUserRoleChanged.bind(this);\n\t\tthis._onParticipantMutedHandler = this._onParticipantMuted.bind(this);\n\t\tthis._onUserStatsReceivedHandler = this._onUserStatsReceived.bind(this);\n\t\tthis._onTrackSubscriptionFailedHandler = this._onTrackSubscriptionFailed.bind(this);\n\t\tthis._onCallUserScreenStateHandler = this._onCallUserScreenState.bind(this);\n\t\tthis.#onCallUserCommonRecordStateHandler = this.#onCallUserCommonRecordState.bind(this);\n\t\tthis.#onCloudRecordStatusChangedHandler = this.#onCloudRecordStatusChanged.bind(this);\n\t\tthis.onCallUserFloorRequestHandler = this._onCallUserFloorRequest.bind(this);\n\t\tthis._onCallFailureHandler = this._onCallFailure.bind(this);\n\t\tthis._onNetworkProblemHandler = this._onNetworkProblem.bind(this);\n\t\tthis._onMicrophoneLevelHandler = this._onMicrophoneLevel.bind(this);\n\t\tthis._onReconnectingHandler = this._onReconnecting.bind(this);\n\t\tthis._onReconnectedHandler = this._onReconnected.bind(this);\n\t\tthis._onReconnectingFailedHandler = this._onReconnectingFailed.bind(this);\n\t\tthis._onCustomMessageHandler = this._onCustomMessage.bind(this);\n\t\tthis._onJoinRoomOfferHandler = this._onJoinRoomOffer.bind(this);\n\t\tthis._onJoinRoomHandler = this._onJoinRoom.bind(this);\n\t\tthis._onLeaveRoomHandler = this._onLeaveRoom.bind(this);\n\t\tthis._onTransferRoomSpeakerHandler = this._onTransferRoomSpeaker.bind(this);\n\t\tthis._onCallLeaveHandler = this._onCallLeave.bind(this);\n\t\tthis._onCallJoinHandler = this._onCallJoin.bind(this);\n\t\tthis._onGetUserMediaEndedHandler = this.#onGetUserMediaEnded.bind(this);\n\t\tthis._onUpdateLastUsedCameraIdHandler = this._onUpdateLastUsedCameraId.bind(this);\n\t\tthis.#onSwitchTrackRecordStatusHandler = this.#onSwitchTrackRecordStatus.bind(this);\n\t\tthis.#onRecorderStatusChangedHandler = this.#onRecorderStatusChanged.bind(this);\n\n\t\tthis._onBeforeUnloadHandler = this._onBeforeUnload.bind(this);\n\t\tthis._onImTabChangeHandler = this._onImTabChange.bind(this);\n\t\tthis._onUpdateChatCounterHandler = this._onUpdateChatCounter.bind(this);\n\n\t\tthis._onChildCallFirstMediaHandler = this.#onChildCallFirstMedia.bind(this);\n\t\tthis._onChildCallFirstUserJoinedHandler = this.#onChildCallFirstUserJoined.bind(this);\n\n\t\tthis._onWindowFocusHandler = this._onWindowFocus.bind(this);\n\t\tthis._onWindowBlurHandler = this._onWindowBlur.bind(this);\n\t\tthis._onDocumentBodyClickHandler = this._onDocumentBodyClick.bind(this);\n\n\t\tif (DesktopApi.isDesktop() && false)\n\t\t{\n\t\t\tthis.floatingWindow = new FloatingVideo({\n\t\t\t\tonMainAreaClick: this._onFloatingVideoMainAreaClick.bind(this),\n\t\t\t\tonButtonClick: this._onFloatingVideoButtonClick.bind(this)\n\t\t\t});\n\t\t\tthis.floatingWindowUser = 0;\n\t\t}\n\t\tthis.showFloatingWindowTimeout = 0;\n\t\tthis.hideIncomingCallTimeout = 0;\n\t\tthis.ignoreDeclinedCallsTimeout = {};\n\t\tthis.ignoreIncomingNotificationTimeouts = {};\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis.floatingScreenShareWindow = new FloatingScreenShare({\n\t\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\t\t\t\tonBackToCallClick: this._onFloatingScreenShareBackToCallClick.bind(this),\n\t\t\t\tonStopSharingClick: this._onFloatingScreenShareStopClick.bind(this),\n\t\t\t\tonChangeScreenClick: this._onFloatingScreenShareChangeScreenClick.bind(this)\n\t\t\t});\n\t\t}\n\t\tthis.showFloatingScreenShareWindowTimeout = 0;\n\n\t\tthis.mutePopup = null;\n\t\tthis.riseYouHandToTalkPopup = null;\n\t\tthis.allowMutePopup = true;\n\n\t\tthis.webScreenSharePopup = null;\n\n\t\tthis.feedbackPopup = null;\n\n\t\tthis.resizeObserver = new BX.ResizeObserver(this._onResize.bind(this));\n\n\t\tthis.loopTimers = {};\n\n\t\tthis.lastCalledChangeSettingsUserName = BX.message('CALL_DEFAULT_NAME_OF_MODERATOR');\n\t\tthis.isFileChooserActive = false;\n\t\tthis.pictureInPictureDebounceForOpen = null;\n\t\tthis.isWindowFocus = true;\n\n\t\tthis.isCallHangupButtonPressed = false;\n\n\t\tthis.callMultiBroadcastClient = null;\n\n\t\tif (needInit)\n\t\t{\n\t\t\tthis.init();\n\t\t\tthis.#subscribeEvents(config);\n\t\t}\n\t}\n\n\t#subscribeEvents(config)\n\t{\n\t\tconst eventKeys = Object.keys(Events);\n\t\tfor (let eventName of eventKeys)\n\t\t{\n\t\t\tif (Type.isFunction(config.events[eventName]))\n\t\t\t{\n\t\t\t\tthis.subscribe(Events[eventName], config.events[eventName])\n\t\t\t}\n\t\t}\n\t}\n\n\tget userId()\n\t{\n\t\treturn Number(BX.message('USER_ID'))\n\t}\n\n\tget callViewState()\n\t{\n\t\treturn this._callViewState\n\t}\n\n\tset callViewState(newState)\n\t{\n\t\tif (this.callViewState == newState)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._callViewState = newState;\n\t\tthis.emit(Events.onViewStateChanged, {\n\t\t\tcallViewState: newState\n\t\t})\n\t}\n\n\tinit()\n\t{\n\t\tBX.addCustomEvent(window, \"CallEvents::incomingCall\", this.onIncomingCall.bind(this));\n\t\tHardware.subscribe(Hardware.Events.deviceChanged, this._onDeviceChange.bind(this));\n\t\tHardware.subscribe(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipHandler);\n\n\t\twindow.addEventListener(\"blur\", this._onWindowBlurHandler);\n\t\twindow.addEventListener(\"focus\", this._onWindowFocusHandler);\n\t\tdocument.body.addEventListener('click',this._onDocumentBodyClickHandler);\n\n\t\tif (DesktopApi.isDesktop() && this.floatingWindow)\n\t\t{\n\t\t\twindow.addEventListener(\"blur\", this._onWindowBlurHandler);\n\t\t\twindow.addEventListener(\"focus\", this._onWindowFocusHandler);\n\t\t\tDesktopApi.subscribe(\"BXForegroundChanged\", (focus) =>\n\t\t\t{\n\t\t\t\tif (focus)\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowDesktopFocus();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowDesktopBlur();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (DesktopApi.isDesktop() && this.floatingScreenShareWindow)\n\t\t{\n\t\t\tDesktopApi.subscribe(\"BXScreenMediaSharing\", (id, title, x, y, width, height, app) =>\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.close();\n\n\t\t\t\tthis.floatingScreenShareWindow.setSharingData({\n\t\t\t\t\ttitle: title,\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: y,\n\t\t\t\t\twidth: width,\n\t\t\t\t\theight: height,\n\t\t\t\t\tapp: app\n\t\t\t\t}).then(() =>\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.show();\n\t\t\t\t}).catch((error) =>\n\t\t\t\t{\n\t\t\t\t\tconsole.error('setSharingData error', error);\n\t\t\t\t});\n\t\t\t});\n\n\t\t\twindow.addEventListener(\"blur\", this._onWindowBlurHandler);\n\t\t\twindow.addEventListener(\"focus\", this._onWindowFocusHandler);\n\n\t\t\tDesktopApi.subscribe(\"BXForegroundChanged\", (focus) =>\n\t\t\t{\n\t\t\t\tif (focus)\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowDesktopFocus();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis._onWindowDesktopBlur();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.subscribe(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipInDesktopHandler);\n\t\t}\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.subscribe('BXVpnStatusChange', (status) =>\n\t\t\t{\n\t\t\t\tif (status)\n\t\t\t\t{\n\t\t\t\t\tthis.showVpnIsActiveNotification();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (window['VoxImplant'])\n\t\t{\n\t\t\tVoxImplant.getInstance().addEventListener(VoxImplant.Events.MicAccessResult, this.voxMicAccessResult.bind(this));\n\t\t}\n\n\t\twindow.addEventListener(\"beforeunload\", this._onBeforeUnloadHandler);\n\t\tBX.addCustomEvent(\"OnDesktopTabChange\", this._onImTabChangeHandler);\n\n\t\tBX.addCustomEvent(window, \"onImUpdateCounterMessage\", this._onUpdateChatCounter.bind(this));\n\n\t\tBX.garbage(this.destroy, this);\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis.callMultiBroadcastClient = new CallMultiChannel('call_controller_multi_channel');\n\n\t\t\tthis.callMultiBroadcastClient.executer((callUuid) => {\n\t\t\t\tconst currentCallUuid = this.currentCall?.uuid;\n\t\t\t\tconst hasView = Boolean(this.callView);\n\n\t\t\t\tconst hasActiveCall = currentCallUuid === callUuid && hasView;\n\n\t\t\t\tif (hasActiveCall)\n\t\t\t\t{\n\t\t\t\t\tBXDesktopSystem.SetActiveTab();\n\t\t\t\t}\n\n\t\t\t\treturn hasActiveCall;\n\t\t\t});\n\t\t}\n\n\t\tCallEngine.multiBroadcastClient.executer(() => Boolean(this.callView));\n\n\t\tthis.inited = true;\n\t}\n\n\t/**\n\t * Workaround to get current microphoneId\n\t * @param e\n\t */\n\tvoxMicAccessResult(e)\n\t{\n\t\tif (e.stream && e.stream.getAudioTracks().length > 0 && this.callView)\n\t\t{\n\t\t\tthis.callView.microphoneId = e.stream.getAudioTracks()[0].getSettings().deviceId\n\t\t}\n\t}\n\n\tgetCallType(provider = '')\n\t{\n\t\tconst currentProvider = provider || this.currentCall?.provider;\n\n\t\tif (!currentProvider)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\treturn currentProvider === Provider.Plain\n\t\t\t? Analytics.AnalyticsType.private\n\t\t\t: Analytics.AnalyticsType.group\n\t\t;\n\t}\n\n\tgetCallUsers(includeSelf)\n\t{\n\t\tconst result = Object.keys(this.currentCall.getUsers());\n\t\tif (includeSelf)\n\t\t{\n\t\t\tresult.push(this.currentCall.userId);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetActiveCallUsers()\n\t{\n\t\tconst userStates = this.currentCall.getUsers();\n\t\tlet activeUsers = [];\n\n\t\tfor (let userId in userStates)\n\t\t{\n\t\t\tif (userStates.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tif (userStates[userId] === UserState.Connected || userStates[userId] === UserState.Connecting || userStates[userId] === UserState.Calling)\n\t\t\t\t{\n\t\t\t\t\tactiveUsers.push(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn activeUsers;\n\t}\n\n\tgetMaxActiveCallUsers()\n\t{\n\t\tconst userStates = this.currentCall.getUsers();\n\t\tlet activeUsers = [];\n\n\t\tfor (let userId in userStates)\n\t\t{\n\t\t\tif (userStates.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tuserStates[userId] !== UserState.Declined\n\t\t\t\t\t&& userStates[userId] !== UserState.Busy\n\t\t\t\t\t&& userStates[userId] !== UserState.Unavailable\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tactiveUsers.push(userId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn activeUsers;\n\t}\n\n\tupdateFloatingWindowContent()\n\t{\n\t\tif (!this.floatingWindow || !this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\n\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) =>\n\t\t{\n\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t});\n\t}\n\n\tupdateDeviceIdInChildCall()\n\t{\n\t\tif (!this.childCall || !this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.microphoneId)\n\t\t{\n\t\t\tthis.childCall.setMicrophoneId(this.currentCall.microphoneId);\n\t\t}\n\n\t\tif (this.currentCall.cameraId)\n\t\t{\n\t\t\tthis.childCall.setCameraId(this.currentCall.cameraId);\n\t\t}\n\t}\n\n\tonIncomingCall(e)\n\t{\n\t\tconsole.warn(\"incoming.call\", e);\n\t\t/** @var {BitrixCall|PlainCall|VoximplantCall} newCall */\n\t\tconst newCall = e.call;\n\t\tconst isCurrentCallActive = this.currentCall && (this.callView || this.callNotification);\n\n\t\tthis.callWithLegacyMobile = (e.isLegacyMobile === true);\n\n\t\tconst newCallId = this._getCallIdentifier(newCall);\n\t\tconst currentCallId = this._getCallIdentifier(this.currentCall);\n\n\t\tif (!isCurrentCallActive)\n\t\t{\n\t\t\tif ((newCall.initiatorId == this.userId) || CallEngineLegacy.calls[newCall.parentId])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.ignoreDeclinedCallsTimeout[newCallId])\n\t\t\t{\n\t\t\t\tclearTimeout(this.ignoreDeclinedCallsTimeout[newCallId]);\n\t\t\t\tthis.ignoreDeclinedCallsTimeout[newCallId] = setTimeout(\n\t\t\t\t\t() => this.answeredOrDeclinedCalls.delete(newCallId),\n\t\t\t\t\t15000\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.callView\n\t\t\t\t|| this.answeredOrDeclinedCalls.has(newCallId)\n\t\t\t\t|| window.BXShowedIncomingCallNotification === newCallId\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.checkDesktop()\n\t\t\t.then(() => {\n\t\t\t\tthis.prepareIncomingCall(e);\n\t\t\t},\n\t\t\t(error) =>\n\t\t\t{\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\tthis.removeCallEvents();\n\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t}\n\n\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t}\n\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.log(error);\n\t\t\t\tif (!this.isHttps)\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message(\"IM_CALL_INCOMING_ERROR_HTTPS_REQUIRED\"))\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message(\"IM_CALL_INCOMING_UNSUPPORTED_BROWSER\"))\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (newCallId === currentCallId)\n\t\t\t{\n\t\t\t\t// ignoring\n\t\t\t}\n\t\t\telse if (newCall.parentUuid === this.currentCall.uuid || (this.currentCall.id && (newCall.parentId === this.currentCall.id)))\n\t\t\t{\n\t\t\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.stopScreenSharing();\n\t\t\t\t}\n\n\t\t\t\tif (!this.childCall)\n\t\t\t\t{\n\t\t\t\t\tthis.childCall = newCall;\n\t\t\t\t}\n\t\t\t\tthis.callView.removeScreenUsers();\n\n\t\t\t\tif (this.isLegacyCall(this.childCall.provider, this.childCall.scheme))\n\t\t\t\t{\n\t\t\t\t\tthis.childCall.users.forEach((userId) => this.callView.addUser(userId, UserState.Calling));\n\t\t\t\t\tthis.updateCallViewUsers(newCall.id, this.childCall.users);\n\t\t\t\t}\n\n\t\t\t\tthis.callView.updateCopilotFeatureState(this.childCall?.isCopilotFeaturesEnabled);\n\t\t\t\tthis.updateDeviceIdInChildCall();\n\t\t\t\tthis.answerChildCall();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// send busy\n\t\t\t\tnewCall.decline(486);\n\t\t\t\tconst isVideoconf =\n\t\t\t\t\tnewCall.associatedEntity.type === 'chat'\n\t\t\t\t\t&& newCall.associatedEntity.advanced['chatType'] === 'videoconf'\n\t\t\t\t;\n\t\t\t\tconst newCallType = newCall.provider === Provider.Plain\n\t\t\t\t\t? Analytics.AnalyticsType.private\n\t\t\t\t\t: Analytics.AnalyticsType.group\n\t\t\t\t;\n\n\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\tcallId: newCallId,\n\t\t\t\t\tcallType: isVideoconf ? Analytics.AnalyticsType.videoconf : newCallType,\n\t\t\t\t\tstatus: Analytics.AnalyticsStatus.busy,\n\t\t\t\t\tassociatedEntity: newCall.associatedEntity,\n\t\t\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tprepareIncomingCall(e)\n\t{\n\t\t/** @var {BitrixCall|PlainCall|VoximplantCall} newCall */\n\t\tconst newCall = e.call;\n\t\tconst newCallId = this._getCallIdentifier(newCall);\n\n\t\t// don't wait for init here to speedup process\n\t\tHardware.init();\n\t\tif (this.currentCall || newCall.state == CallState.Finished)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentCall = newCall;\n\t\tif (!(this.currentCall instanceof PlainCall))\n\t\t{\n\t\t\tconst currentUser = BX.Messenger.v2.Lib.CallManager.getInstance().getCurrentUser();\n\t\t\tUtil.setUserData({[this.userId] : currentUser});\n\t\t}\n\n\t\tthis.bindCallEvents();\n\t\tthis.updateFloatingWindowContent();\n\t\twindow.BXShowedIncomingCallNotification = newCallId;\n\t\tthis.ignoreIncomingNotificationTimeouts[newCallId] = setTimeout(\n\t\t\t() => window.BXShowedIncomingCallNotification = null,\n\t\t\t10000\n\t\t);\n\n\t\tif (this.currentCall.associatedEntity.type === 'chat' && this.currentCall.associatedEntity.advanced['chatType'] === 'videoconf')\n\t\t{\n\t\t\tif (this.isConferencePageOpened(this.currentCall.associatedEntity.id))\n\t\t\t{\n\t\t\t\t// conference page is already opened, do nothing\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\tthis.currentCall = null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showIncomingConference();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlet video = e.video === true;\n\t\t\tthis.showIncomingCall({ video: video });\n\n\t\t\tHardware.init().then(() =>\n\t\t\t{\n\t\t\t\tif (!Hardware.hasCamera())\n\t\t\t\t{\n\t\t\t\t\tif (video)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\t}\n\t\t\t\t\tif (this.callNotification)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callNotification.setHasCamera(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n\n\tbindCallEvents()\n\t{\n\t\tthis.currentCall.addEventListener(CallEvent.onUserInvited, this._onCallUserInvitedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserJoined, this._onCallUserJoinedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onDestroy, this._onCallDestroyHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserMicrophoneState, this._onCallUserMicrophoneStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserCameraState, this._onCallUserCameraStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onNeedResetMediaDevicesState, this._onNeedResetMediaDevicesStateHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onCameraPublishing, this._onCameraPublishingHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onMicrophonePublishing, this._onMicrophonePublishingdHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVideoPaused, this._onCallUserVideoPausedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserScreenState, this._onCallUserScreenStateHandler);\n\t\tEvent.bind(this.currentCall, CallEvent.onUserCommonRecordState, this.#onCallUserCommonRecordStateHandler);\n\t\tEvent.bind(this.currentCall, CallEvent.onCloudRecordStatusChanged, this.#onCloudRecordStatusChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserFloorRequest, this.onCallUserFloorRequestHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLocalMediaStopped, this._onCallLocalMediaStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLocalScreenUpdated, this._onCallLocalScreenUpdatedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onCallRemoteMediaReceivedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onRemoteMediaStopped, this._onCallRemoteMediaStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onBadNetworkIndicator, this._onCallBadNetworkIndicatorHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onConnectionQualityChanged, this._onCallConnectionQualityChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onToggleRemoteParticipantVideo, this._onCallToggleRemoteParticipantVideoHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVoiceStarted, this._onCallUserVoiceStartedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserVoiceStopped, this._onCallUserVoiceStoppedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onTurnOnCamera, this._onTurnOnCameraHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onAllParticipantsAudioMuted, this._onAllParticipantsAudioMutedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onAllParticipantsVideoMuted, this._onAllParticipantsVideoMutedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onAllParticipantsScreenshareMuted, this._onAllParticipantsScreenshareHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onRoomSettingsChanged, this._onRoomSettingsChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserPermissionsChanged, this._onUserPermissionsChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserRoleChanged, this._onUserRoleChangedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onYouMuteAllParticipants, this._onYouMuteAllParticipantsHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onParticipantMuted, this._onParticipantMutedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUserStatsReceived, this._onUserStatsReceivedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onTrackSubscriptionFailed, this._onTrackSubscriptionFailedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onCallFailure, this._onCallFailureHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onNetworkProblem, this._onNetworkProblemHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onMicrophoneLevel, this._onMicrophoneLevelHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onReconnecting, this._onReconnectingHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onReconnected, this._onReconnectedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onReconnectingFailed, this._onReconnectingFailedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onCustomMessage, this._onCustomMessageHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoinRoomOffer, this._onJoinRoomOfferHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoinRoom, this._onJoinRoomHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLeaveRoom, this._onLeaveRoomHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onTransferRoomSpeaker, this._onTransferRoomSpeakerHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onJoin, this._onCallJoinHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onLeave, this._onCallLeaveHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onGetUserMediaEnded, this._onGetUserMediaEndedHandler);\n\t\tthis.currentCall.addEventListener(CallEvent.onUpdateLastUsedCameraId, this._onUpdateLastUsedCameraIdHandler);\n\t\tEvent.bind(this.currentCall, CallEvent.onSwitchTrackRecordStatus, this.#onSwitchTrackRecordStatusHandler);\n\t\tEvent.bind(this.currentCall, CallEvent.onRecorderStatusChanged, this.#onRecorderStatusChangedHandler);\n\t}\n\n\tremoveCallEvents()\n\t{\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserInvited, this._onCallUserInvitedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserJoined, this._onCallUserJoinedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onDestroy, this._onCallDestroyHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserMicrophoneState, this._onCallUserMicrophoneStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserCameraState, this._onCallUserCameraStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onNeedResetMediaDevicesState, this._onNeedResetMediaDevicesStateHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onCameraPublishing, this._onCameraPublishingHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onMicrophonePublishing, this._onMicrophonePublishingdHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVideoPaused, this._onCallUserVideoPausedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserScreenState, this._onCallUserScreenStateHandler);\n\t\tEvent.unbind(this.currentCall, CallEvent.onUserCommonRecordState, this.#onCallUserCommonRecordStateHandler);\n\t\tEvent.unbind(this.currentCall, CallEvent.onCloudRecordStatusChanged, this.#onCloudRecordStatusChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserFloorRequest, this.onCallUserFloorRequestHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLocalMediaStopped, this._onCallLocalMediaStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLocalScreenUpdated, this._onCallLocalScreenUpdatedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onCallRemoteMediaReceivedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onRemoteMediaStopped, this._onCallRemoteMediaStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onBadNetworkIndicator, this._onCallBadNetworkIndicatorHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onConnectionQualityChanged, this._onCallConnectionQualityChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onToggleRemoteParticipantVideo, this._onCallToggleRemoteParticipantVideoHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVoiceStarted, this._onCallUserVoiceStartedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserVoiceStopped, this._onCallUserVoiceStoppedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onTurnOnCamera, this._onTurnOnCameraHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onAllParticipantsAudioMuted, this._onAllParticipantsAudioMutedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onAllParticipantsVideoMuted, this._onAllParticipantsVideoMutedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onAllParticipantsScreenshareMuted, this._onAllParticipantsScreenshareMutedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onRoomSettingsChanged, this._onRoomSettingsChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserPermissionsChanged, this._onUserPermissionsChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserRoleChanged, this._onUserRoleChangedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onYouMuteAllParticipants, this._onYouMuteAllParticipantsHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onParticipantMuted, this._onParticipantMutedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUserStatsReceived, this._onUserStatsReceivedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onTrackSubscriptionFailed, this._onTrackSubscriptionFailedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onCallFailure, this._onCallFailureHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onNetworkProblem, this._onNetworkProblemHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onMicrophoneLevel, this._onMicrophoneLevelHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onReconnecting, this._onReconnectingHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onReconnected, this._onReconnectedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onReconnectingFailed, this._onReconnectingFailedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onCustomMessage, this._onCustomMessageHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onJoin, this._onCallJoinHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onLeave, this._onCallLeaveHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onGetUserMediaEnded, this._onGetUserMediaEndedHandler);\n\t\tthis.currentCall.removeEventListener(CallEvent.onUpdateLastUsedCameraId, this._onUpdateLastUsedCameraIdHandler);\n\t\tEvent.unbind(this.currentCall, CallEvent.onSwitchTrackRecordStatus, this.#onSwitchTrackRecordStatusHandler);\n\t\tEvent.unbind(this.currentCall, CallEvent.onRecorderStatusChanged, this.#onRecorderStatusChangedHandler);\n\t}\n\n\tbindCallViewEvents()\n\t{\n\t\tthis.callView.setCallback(View.Event.onShow, this._onCallViewShow.bind(this));\n\t\tthis.callView.setCallback(View.Event.onClose, this._onCallViewClose.bind(this));\n\t\tthis.callView.setCallback(View.Event.onDestroy, this._onCallViewDestroy.bind(this));\n\t\tthis.callView.setCallback(View.Event.onButtonClick, this._onCallViewButtonClick.bind(this));\n\t\tthis.callView.setCallback(View.Event.onBodyClick, this._onCallViewBodyClick.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceCamera, this._onCallViewReplaceCamera.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceMicrophone, this._onCallViewReplaceMicrophone.bind(this));\n\t\tthis.callView.setCallback(View.Event.onSetCentralUser, this._onCallViewSetCentralUser.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeHdVideo, this._onCallViewChangeHdVideo.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeNoiseSuppression, this._onCallViewChangeNoiseSuppression.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeMicAutoParams, this._onCallViewChangeMicAutoParams.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeFaceImprove, this._onCallViewChangeFaceImprove.bind(this));\n\t\tthis.callView.setCallback(View.Event.onOpenAdvancedSettings, this._onCallViewOpenAdvancedSettings.bind(this));\n\t\tthis.callView.setCallback(View.Event.onReplaceSpeaker, this._onCallViewReplaceSpeaker.bind(this));\n\t\tthis.callView.setCallback(View.Event.onHasMainStream, this._onCallViewHasMainStream.bind(this));\n\t\tthis.callView.setCallback(View.Event.onTurnOffParticipantMic, this._onCallViewTurnOffParticipantMic.bind(this));\n\t\tthis.callView.setCallback(View.Event.onTurnOffParticipantCam, this._onCallViewTurnOffParticipantCam.bind(this));\n\t\tthis.callView.setCallback(View.Event.onTurnOffParticipantScreenshare, this._onCallViewTurnOffParticipantScreenshare.bind(this));\n\t\tthis.callView.setCallback(View.Event.onAllowSpeakPermission, this._onCallViewAllowSpeakPermission.bind(this));\n\t\tthis.callView.setCallback(View.Event.onDisallowSpeakPermission, this._onCallViewDisallowSpeakPermission.bind(this));\n\t\tthis.callView.setCallback(View.Event.onToggleSubscribe, this._onCallToggleSubscribe.bind(this));\n\t\tthis.callView.setCallback(View.Event.onUserClick, this._onCallUserClick.bind(this));\n\t\tthis.callView.setCallback(View.Event.onPiPClose, this._onPipClose.bind(this));\n\t\tthis.callView.setCallback(View.Event.onCommonRecordMenu, this.#onCommonRecordMenu.bind(this));\n\t\tthis.callView.setCallback(View.Event.onPiPBodyClick, this.#onPiPViewBodyClick.bind(this));\n\t\tthis.callView.setCallback(View.Event.onChangeVideoQuality, this._onChangeVideoQuality.bind(this));\n\t}\n\n\tupdateCallViewUsers(callId, userList)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst convertAllItemsToInt = (arr) => Array.from(arr, (item) => parseFloat(item))\n\t\tconst userListInt = convertAllItemsToInt(userList)\n\n\t\tlet userDataInt = []\n\t\tlet notIncludedEl = []\n\n\t\tif (this.currentCall.userData)\n\t\t{\n\t\t\tthis.callView.updateUserData(this.currentCall.userData);\n\n\t\t\tuserDataInt = convertAllItemsToInt(Object.keys(this.currentCall.userData));\n\t\t\tnotIncludedEl = userListInt.filter((id) => userDataInt.indexOf(id) === -1);\n\t\t}\n\n\t\tif (this.currentCall.userData && !notIncludedEl.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tUtil.getUsers(callId, userListInt).then((userData) =>\n\t\t{\n\t\t\tthis.callView.updateUserData(userData);\n\t\t});\n\t}\n\n\tcreateVideoStrategy()\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.destroy();\n\t\t}\n\n\t\tconst strategyType = this.incomingVideoStrategyType;\n\n\t\tthis.videoStrategy = new VideoStrategy({\n\t\t\tcall: this.currentCall,\n\t\t\tcallView: this.callView,\n\t\t\tstrategyType: strategyType\n\t\t});\n\t}\n\n\tremoveVideoStrategy()\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.destroy();\n\t\t}\n\t\tthis.videoStrategy = null;\n\t}\n\n\tsetFeatureScreenSharing(enable)\n\t{\n\t\tthis.featureScreenSharing = enable;\n\t}\n\n\tsetVideoStrategyType(type)\n\t{\n\t\tif (this.videoStrategy)\n\t\t{\n\t\t\tthis.videoStrategy.setType(type)\n\t\t}\n\t}\n\n\tgetExternalContainer()\n\t{\n\t\tlet externalContainer = document.querySelector(`.${BX.Messenger.v2.Lib.CallManager.viewContainerClass}`);\n\n\t\tif (!externalContainer)\n\t\t{\n\t\t\texternalContainer = BX.create('div', {\n\t\t\t\tprops: { className: BX.Messenger.v2.Lib.CallManager.viewContainerClass },\n\t\t\t});\n\n\t\t\tdocument.body.appendChild(externalContainer);\n\t\t}\n\n\t\treturn externalContainer;\n\t}\n\n\tcreateContainer()\n\t{\n\t\tthis.container = BX.create(\"div\", {\n\t\t\tprops: {className: `bx-messenger-call-overlay ${Util.isChatMountInPage() ? '--fixed' : ''}`},\n\t\t});\n\n\t\tconst externalContainer = this.getExternalContainer();\n\t\texternalContainer.insertBefore(this.container, externalContainer.firstChild);\n\n\t\tZIndexManager.getOrAddStack(document.body).register(this.container);\n\n\t\texternalContainer.classList.add(\"bx-messenger-call\");\n\t}\n\n\tremoveContainer()\n\t{\n\t\tif (this.container)\n\t\t{\n\t\t\tZIndexManager.getStack(document.body).unregister(this.container);\n\t\t\tDom.remove(this.container);\n\t\t\tthis.container = null;\n\t\t\tthis.getExternalContainer().classList.remove(\"bx-messenger-call\");\n\t\t}\n\t}\n\n\tanswerChildCall()\n\t{\n\t\tthis.removeCallEvents();\n\t\tthis.removeVideoStrategy();\n\t\tthis.childCall.addEventListener(CallEvent.onUserJoined, this._onChildCallFirstUserJoinedHandler);\n\t\tthis.childCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstMediaHandler);\n\t\tthis.childCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tthis.childCall.answer();\n\t}\n\n\tsetReconnectingCameraId(id)\n\t{\n\t\tthis.reconnectingCameraId = id;\n\n\t\tif (id) {\n\t\t\tthis.updateCameraSettingsInCurrentCallAfterReconnecting(id)\n\t\t}\n\t}\n\n\tupdateCameraSettingsInCurrentCallAfterReconnecting(cameraId)\n\t{\n\n\t\tif (this.currentCall.cameraId === cameraId) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst devicesList = Hardware.getCameraList();\n\n\t\tif (!devicesList.find(device => device.deviceId === cameraId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentCall.setCameraId(cameraId);\n\t\tthis.setReconnectingCameraId(null);\n\t}\n\n\t#onChildCallFirstMedia(e)\n\t{\n\t\tif (!this.childCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#switchToChildCall();\n\t\tthis.#setUserMedia(e);\n\t}\n\n\t#onChildCallFirstUserJoined(e)\n\t{\n\t\tif (!this.childCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#switchToChildCall();\n\t\tthis._onCallUserJoined(e);\n\t}\n\n\t#switchToChildCall()\n\t{\n\t\tif (!this.childCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.log('Finishing one-to-one call, switching to group call');\n\n\t\tconst newCall = this.childCall;\n\t\tthis.childCall = null;\n\n\t\tlet previousRecordType = CallCommonRecordType.None;\n\n\t\tif (this.#isCommonRecordStarted())\n\t\t{\n\t\t\tpreviousRecordType = this.commonRecord.type;\n\t\t\tthis.#stopCommonRecord();\n\t\t}\n\n\t\tthis.callView.showButtons(['floorRequest', 'hangupOptions']);\n\n\t\tnewCall.removeEventListener(CallEvent.onUserJoined, this._onChildCallFirstMediaHandler);\n\t\tnewCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstUserJoinedHandler);\n\t\tnewCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\tnewCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\n\t\tthis.removeCallEvents();\n\t\tconst oldCall = this.currentCall;\n\n\t\tAnalytics.getInstance().onFinishCall({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\tstatus: Analytics.AnalyticsStatus.privateToGroup,\n\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t\tcallUsersCount: this.getMaxActiveCallUsers().length,\n\t\t\tcallLength: Util.getTimeInSeconds(this.currentCall.startDate),\n\t\t});\n\n\t\toldCall.hangup();\n\n\t\tthis.currentCall = newCall;\n\n\t\tif (this.currentCall.associatedEntity && this.currentCall.associatedEntity.id && this.folded)\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\t}\n\n\t\tthis.bindCallEvents();\n\t\tthis.createVideoStrategy();\n\n\t\t// restart Follow-Up if it was started in one-to-one call\n\t\tif (oldCall.isCopilotActive && oldCall.isCopilotInitiator)\n\t\t{\n\t\t\tthis.#onChangeStateCopilotAction(RecorderStatus.ENABLED);\n\t\t}\n\n\t\t// restart cloud recording if it was started in one-to-one call\n\t\tif (previousRecordType !== CallCommonRecordType.None)\n\t\t{\n\t\t\tthis.#startCommonRecord(previousRecordType);\n\t\t}\n\t}\n\n\tcheckDesktop()\n\t{\n\t\tif (Reflection.getClass('BX.Messenger.v2.Lib.DesktopManager'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tconst desktop = BX.Messenger.v2.Lib.DesktopManager.getInstance();\n\t\t\t\tdesktop.checkStatusInDifferentContext()\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (result === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (Reflection.getClass('BX.desktopUtils'))\n\t\t{\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tBX.desktopUtils.runningCheck(\n\t\t\t\t\t() => {},\n\t\t\t\t\t() => resolve()\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\tisMutedPopupAllowed()\n\t{\n\t\tif (!this.allowMutePopup || !this.currentCall)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst currentRoom = this.currentCall.currentRoom && this.currentCall.currentRoom();\n\t\treturn !currentRoom || currentRoom.speaker == this.userId;\n\t}\n\n\tisConferencePageOpened(dialogId)\n\t{\n\t\tconst tagPresent = LocalStorage.get(\n\t\t\tCallEngine.getSiteId(),\n\t\t\tCallEngine.getCurrentUserId(),\n\t\t\tCallEngine.getConferencePageTag(dialogId),\n\t\t\t'N'\n\t\t);\n\n\t\treturn tagPresent === 'Y';\n\t}\n\n\t/**\n\t * @param {Object} params\n\t * @param {bool} [params.video = false]\n\t */\n\tshowIncomingCall(params)\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tparams = {};\n\t\t}\n\t\tparams.video = params.video === true;\n\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\tthis.feedbackPopup.close();\n\t\t}\n\n\t\tconst allowVideo = this.callWithLegacyMobile ? params.video === true : true;\n\n\t\tthis.callNotification = new IncomingNotification({\n\t\t\tcallerName: this.currentCall.associatedEntity.name,\n\t\t\tcallerAvatar: this.currentCall.associatedEntity.avatar,\n\t\t\tcallerType: this.currentCall.associatedEntity.advanced.chatType,\n\t\t\tcallerColor: this.currentCall.associatedEntity.avatarColor,\n\t\t\tvideo: params.video,\n\t\t\thasCamera: allowVideo,\n\t\t\tcameraState: allowVideo,\n\t\t\tmicrophoneState: !(this.currentCall.associatedEntity.userCounter > this.getMaxActiveMicrophonesCount()),\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: this._onCallNotificationButtonClick.bind(this),\n\t\t\tisMessengerOpen: this.messengerFacade.isMessengerOpen(),\n\t\t});\n\n\t\tthis.callNotification.show();\n\t\tthis.scheduleCancelNotification(false);\n\n\t\tthis.messengerFacade.repeatSound(this.audioRingtone, 3500, true);\n\t}\n\n\tshowIncomingConference()\n\t{\n\t\tthis.callNotification = new ConferenceNotifications({\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tcallerName: this.currentCall.associatedEntity.name,\n\t\t\tcallerAvatar: this.currentCall.associatedEntity.avatar,\n\t\t\tcallerColor: this.currentCall.associatedEntity.avatarColor,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: this._onCallConferenceNotificationButtonClick.bind(this)\n\t\t});\n\n\t\tthis.callNotification.show();\n\t\tthis.scheduleCancelNotification(true);\n\n\t\tthis.messengerFacade.repeatSound(this.audioRingtone, 3500, true);\n\t}\n\n\tscheduleCancelNotification(isIncomingConference = false)\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.hideIncomingCallTimeout = setTimeout(() =>\n\t\t{\n\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: isIncomingConference ? Analytics.AnalyticsType.videoconf : this.getCallType(),\n\t\t\t\tstatus: Analytics.AnalyticsStatus.noAnswer,\n\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t\t});\n\n\t\t\tif (this.callNotification)\n\t\t\t{\n\t\t\t\tthis.callNotification.close();\n\t\t\t}\n\t\t\tif (this.currentCall)\n\t\t\t{\n\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\tthis.currentCall = null;\n\t\t\t}\n\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t{\n\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t}\n\t\t}, 30 * 1000);\n\t}\n\n\tshowNotification(notificationText, actions)\n\t{\n\t\tif (!actions)\n\t\t{\n\t\t\tactions = [];\n\t\t}\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(notificationText),\n\t\t\tposition: \"top-right\",\n\t\t\tautoHideDelay: 5000,\n\t\t\tcloseButton: true,\n\t\t\tactions: actions\n\t\t});\n\t}\n\t\n\t#isVpnConnected()\n\t{\n\t\tif (DesktopApi.isDesktop() && typeof BXDesktopSystem?.IsVpnConnected === 'function' && BXDesktopSystem.IsVpnConnected())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tcheckVpnStatus()\n\t{\n\t\tif (this.#isVpnConnected())\n\t\t{\n\t\t\tthis.showVpnIsActiveNotification()\n\t\t}\n\t}\n\n\tshowVpnIsActiveNotification()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(Loc.getMessage('CALL_MESSAGE_VPN_IS_ACTIVE')),\n\t\t\t\tposition: 'top-right',\n\t\t\t\tautoHideDelay: 10000,\n\t\t\t\tcloseButton: true,\n\t\t\t\tcategory: 'vpnIsActive',\n\t\t\t});\n\t\t}\n\t}\n\n\tshowNetworkProblemNotification(notificationText)\n\t{\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(notificationText),\n\t\t\tposition: \"top-right\",\n\t\t\tautoHideDelay: 5000,\n\t\t\tcloseButton: true,\n\t\t\tactions: [{\n\t\t\t\ttitle: BX.message(\"IM_M_CALL_HELP\"),\n\t\t\t\tevents: {\n\t\t\t\t\tclick: (event, balloon) =>\n\t\t\t\t\t{\n\t\t\t\t\t\ttop.BX.Helper.show('redirect=detail&code=12723718');\n\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}]\n\t\t});\n\t}\n\n\tshowUnsupportedNotification()\n\t{\n\t\tlet messageBox;\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tmessageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_DESKTOP_TOO_OLD'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message('IM_M_CALL_BTN_UPDATE'),\n\t\t\t\tcancelCaption: BX.message('IM_NOTIFY_CONFIRM_CLOSE'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\tconst url = DesktopDownload.getLinkForCurrentUser();\n\t\t\t\t\twindow.open(url, \"desktopApp\");\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmessageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_WEBRTC_USE_CHROME_OR_DESKTOP'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message(\"IM_CALL_DETAILS\"),\n\t\t\t\tcancelCaption: BX.message('IM_NOTIFY_CONFIRM_CLOSE'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\ttop.BX.Helper.show(\"redirect=detail&code=11387752\");\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t})\n\t\t}\n\t\tmessageBox.show();\n\t}\n\n\tisUserAgentSupported()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\treturn DesktopApi.getApiVersion() > 48;\n\t\t}\n\t\tif ('VoxImplant' in window)\n\t\t{\n\t\t\treturn VoxImplant.getInstance().isRTCsupported();\n\t\t}\n\t\treturn Util.isWebRTCSupported();\n\t}\n\n\tgetBlockedButtons(needBlockAddButton = false) :string[]\n\t{\n\t\tlet result = ['record', 'copilot'];\n\t\tif (!this.messengerFacade.showUserSelector || needBlockAddButton)\n\t\t{\n\t\t\tresult.push('add')\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprepareCall(callData)\n\t{\n\t\tthis.preparedCall = callData;\n\t}\n\n\tstartCall(dialogId, video, chatInfo)\n\t{\n\t\tif (!this.isUserAgentSupported())\n\t\t{\n\t\t\tthis.showUnsupportedNotification();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.callView || this.currentCall)\n\t\t{\n\t\t\tthis.unfold();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.initCallPromise)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.onConnectToCallClick = Date.now();\n\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\tthis.feedbackPopup.close();\n\t\t}\n\n\t\tconst call = CallEngineLegacy.getCallWithDialogId(dialogId) || CallEngine.getCallWithDialogId(dialogId);\n\t\tif (call)\n\t\t{\n\t\t\tthis.joinCall(call.id, call.uuid, video, { chatInfo: call.associatedEntity, mustCreate: true });\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet provider = Provider.Plain;\n\t\tif (dialogId.toString().startsWith(\"chat\"))\n\t\t{\n\t\t\tprovider = Util.getConferenceProvider();\n\t\t}\n\n\t\tconst isPlainCall = provider === Provider.Plain;\n\t\tconst isLegacyCall = this.isLegacyCall(provider);\n\n\t\tconst callTokenPromise = isLegacyCall\n\t\t\t? Promise.resolve()\n\t\t\t: CallTokenManager.getToken(chatInfo.chatId);\n\n\t\tconst isCallPrepared = this.preparedCall?.dialogId === dialogId;\n\n\t\tconst debug1 = +(new Date());\n\t\tthis.initCallPromise = this.messengerFacade.openMessenger(dialogId)\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn Hardware.init();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tif (video && isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tthis.#prepareLocalStream(provider);\n\t\t\t\t}\n\n\t\t\t\tthis.createContainer();\n\t\t\t\tlet hiddenButtons = [];\n\t\t\t\tif (isPlainCall)\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t\thiddenButtons.push('callconrol');\n\t\t\t\t\thiddenButtons.push('hangupOptions');\n\t\t\t\t}\n\n\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t}\n\n\t\t\t\tHardware.isCameraOn = video;\n\n\t\t\t\tconst isCopilotFeaturesEnabled = (isPlainCall && CallSettingsManager.plainCallFollowUpEnabled) || !isPlainCall;\n\t\t\t\tconst isCloudRecordFeaturesEnabled = DesktopApi.isDesktop()\n\t\t\t\t\t|| (isPlainCall && CallSettingsManager.plainCallCloudRecordingEnabled)\n\t\t\t\t\t|| !isPlainCall;\n\n\t\t\t\tthis.callView = new View({\n\t\t\t\t\thiddenButtons,\n\t\t\t\t\tisCopilotFeaturesEnabled,\n\t\t\t\t\tisCloudRecordFeaturesEnabled,\n\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\tshowUsersButton: false,\n\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\tlayout: dialogId.toString().startsWith('chat') ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\tshowShareButton: this.featureScreenSharing !== FeatureState.Disabled,\n\t\t\t\t\tshowRecordButton: true,\n\t\t\t\t\tblockedButtons: this.getBlockedButtons(isPlainCall),\n\t\t\t\t\tshowAddUserButtonInList: isPlainCall,\n\t\t\t\t\tisCopilotActive: false,\n\t\t\t\t\tisWindowFocus: this.isWindowFocus,\n\t\t\t\t});\n\n\t\t\t\tthis.bindCallViewEvents();\n\n\t\t\t\tif (isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.isPreparing = true;\n\t\t\t\t\tif (this.preparedCall.user)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.appendUsers({\n\t\t\t\t\t\t\t[this.preparedCall.user]: UserState.Calling,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.callView.updateUserData(this.preparedCall.userData);\n\t\t\t\t\tUtil.setUserData(this.preparedCall.userData);\n\t\t\t\t\tif (this.localStream)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setLocalStream(provider);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst style = 'background-color: #AA00AA; color: white;'\n\t\t\t\t\tconsole.log(`%c[debug] Time from click 'Start call' to show call card: ${Date.now() - this.onConnectToCallClick} ms`, style);\n\t\t\t\t\tthis.onCallViewRenderToMediaReceived = Date.now();\n\n\t\t\t\t\tthis.callView.show();\n\t\t\t\t}\n\n\t\t\t\tif (video && !Hardware.hasCamera())\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\tvideo = false;\n\t\t\t\t}\n\n\t\t\t\treturn callTokenPromise;\n\t\t\t})\n\t\t\t.then((callToken) =>\n\t\t\t{\n\t\t\t\tif (!this.isLegacyCall(provider) && !callToken)\n\t\t\t\t{\n\t\t\t\t\tthrow new Error('Empty callToken');\n\t\t\t\t}\n\n\t\t\t\tconst callEngine = isLegacyCall\n\t\t\t\t\t? CallEngineLegacy\n\t\t\t\t\t: CallEngine;\n\n\t\t\t\treturn callEngine.createCall({\n\t\t\t\t\tentityType: 'chat',\n\t\t\t\t\tentityId: dialogId,\n\t\t\t\t\tprovider: provider,\n\t\t\t\t\tvideoEnabled: !!video,\n\t\t\t\t\tenableMicAutoParameters: Hardware.enableMicAutoParameters,\n\t\t\t\t\tjoinExisting: true,\n\t\t\t\t\tdebug: this.debug,\n\t\t\t\t\ttoken: callToken,\n\t\t\t\t\tchatInfo: chatInfo,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then((e) => {\n\t\t\t\tif (!this.initCallPromise)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst debug2 = Date.now();\n\t\t\t\tthis.currentCall = e.call;\n\t\t\t\tthis.currentCallIsNew = e.isNew;\n\n\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t}\n\n\t\t\t\tif (!this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.leaveCurrentCall(true);\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (isLegacyCall)\n\t\t\t\t{\n\t\t\t\t\tthis.#onUpdateCallCopilotState(this.currentCall.isCopilotActive);\n\t\t\t\t}\n\n\t\t\t\tthis.log(\"Call creation time: \" + (debug2 - debug1) / 1000 + \" seconds\");\n\n\t\t\t\tif (this.currentCall.isCopilotActive && isLegacyCall)\n\t\t\t\t{\n\t\t\t\t\tthis.sendStartCopilotRecordAnalytics({ isAutostart: true });\n\t\t\t\t}\n\n\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t}\n\n\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.createVideoStrategy();\n\n\t\t\t\tif (isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.isPreparing = false;\n\t\t\t\t}\n\n\t\t\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t\t\t{\n\t\t\t\t\tthis.callView.appendUsers(this.currentCall.getUsers());\n\t\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\t}\n\n\t\t\t\tif (!isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tconst style = 'background-color: #AA00AA; color: white;'\n\t\t\t\t\tconsole.log(`%c[debug] Time from click 'Start call' to show call card: ${Date.now() - this.onConnectToCallClick} ms`, style);\n\t\t\t\t\tthis.onCallViewRenderToMediaReceived = Date.now();\n\t\t\t\t}\n\n\t\t\t\tthis.callView.show();\n\t\t\t\tthis.showCopilotNotify(true);\n\n\t\t\t\tthis.showDocumentPromo();\n\t\t\t\tthis.showMaskPromo();\n\t\t\t\tthis.#showCloudRecordPromo();\n\n\t\t\t\tif (this.currentCallIsNew)\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Inviting users\");\n\t\t\t\t\tAnalytics.getInstance().onStartCall({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t\t\tisCopilotActive: false,\n\t\t\t\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.currentCall.inviteUsers({users: isLegacyCall ? this.getCallUsers() : []});\n\n\t\t\t\t\tthis.messengerFacade.repeatSound('dialtone', 5000, true);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.log(\"Joining existing call\");\n\t\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsection: Analytics.AnalyticsSection.chatWindow,\n\t\t\t\t\t\telement: Analytics.AnalyticsElement.videocall,\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t\t\t\t});\n\n\t\t\t\t\tif (this.currentCall.associatedEntity.userCounter > this.getMaxActiveMicrophonesCount())\n\t\t\t\t\t{\n\t\t\t\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\t\t\t\tthis.showAutoMicMuteNotification();\n\t\t\t\t\t}\n\t\t\t\t\tthis.currentCall.answer();\n\t\t\t\t}\n\n\t\t\t\tthis.checkVpnStatus();\n\t\t\t\tthis._onUpdateLastUsedCameraId();\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tif (!this.initCallPromise)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconsole.error(error);\n\n\t\t\t\tlet errorCode;\n\t\t\t\tif (typeof (error) == \"string\")\n\t\t\t\t{\n\t\t\t\t\terrorCode = error;\n\t\t\t\t}\n\t\t\t\telse if (Type.isObject(error) && error instanceof JoinResponseError)\n\t\t\t\t{\n\t\t\t\t\terrorCode = error.name;\n\t\t\t\t}\n\t\t\t\telse if (typeof (error) == \"object\" && error.code)\n\t\t\t\t{\n\t\t\t\t\terrorCode = error.code == 'access_denied' ? 'ACCESS_DENIED' : error.code\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\terrorCode = 'UNKNOWN_ERROR';\n\t\t\t\t}\n\n\t\t\t\tif (errorCode === 'user_is_busy')\n\t\t\t\t{\n\t\t\t\t\tthis.leaveCurrentCall();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tAnalytics.getInstance().onStartCallError({\n\t\t\t\t\t\tcallType: this.getCallType(provider),\n\t\t\t\t\t\terrorCode,\n\t\t\t\t\t\terrorMessage: error?.message,\n\t\t\t\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis._onCallFailure({\n\t\t\t\t\t\tcode: errorCode,\n\t\t\t\t\t\tmessage: error.message || '',\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#stopLocalStream();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.finally(() =>\n\t\t\t{\n\t\t\t\tthis.initCallPromise = null;\n\t\t\t\tthis.preparedCall = null;\n\t\t\t});\n\t}\n\n\tcloseCallNotification()\n\t{\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\t}\n\n\tjoinCall(\n\t\tcallId: number,\n\t\tcallUuid: string,\n\t\tvideo: boolean,\n\t\toptions: { joinAsViewer?: boolean, chatInfo: {}, mustCreate?: Boolean },\n\t)\n\t{\n\t\tconst joinAsViewer = BX.prop.getBoolean(options, \"joinAsViewer\", false);\n\n\t\tif (!this.isUserAgentSupported())\n\t\t{\n\t\t\tthis.showUnsupportedNotification();\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasActiveCall = this.callView && this.currentCall;\n\n\t\tif (hasActiveCall && this.currentCall.uuid === callUuid)\n\t\t{\n\t\t\tthis.unfold();\n\t\t\treturn;\n\t\t}\n\n\t\tif (hasActiveCall && this.currentCall.uuid !== callUuid)\n\t\t{\n\t\t\tthis.leaveCurrentCall();\n\t\t}\n\n\t\tif (this.initCallPromise)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.onConnectToCallClick = Date.now();\n\n\t\tconst isCallPrepared = this.preparedCall?.dialogId === options.chatInfo.id;\n\t\tconst isGroupCall = options.chatInfo.id.toString().startsWith('chat');\n\t\tconst call = CallEngineLegacy.calls[callId] || CallEngine.calls[callUuid];\n\t\tconst defaultProvider = isGroupCall ? Util.getConferenceProvider() : Provider.Plain;\n\t\tconst provider = call?.provider || defaultProvider;\n\t\tconst isLegacyCall = this.isLegacyCall(provider, call?.scheme);\n\n\t\tthis.log(\"Joining call \" + callUuid);\n\n\t\tthis.initCallPromise = isLegacyCall\n\t\t\t? Promise.resolve()\n\t\t\t: CallTokenManager.getToken(options.chatInfo.chatId);\n\n\t\tthis.initCallPromise\n\t\t\t.then((callToken) => {\n\t\t\t\tlet config = null;\n\t\t\t\tif (options?.mustCreate)\n\t\t\t\t{\n\t\t\t\t\tconfig = {\n\t\t\t\t\t\tprovider,\n\t\t\t\t\t\tentityType: 'chat',\n\t\t\t\t\t\tentityId: options.chatInfo.id,\n\t\t\t\t\t\tvideoEnabled: Boolean(video),\n\t\t\t\t\t\tenableMicAutoParameters: Hardware.enableMicAutoParameters,\n\t\t\t\t\t\tjoinExisting: true,\n\t\t\t\t\t\troomId: callUuid,\n\t\t\t\t\t\tdebug: this.debug,\n\t\t\t\t\t\ttoken: callToken,\n\t\t\t\t\t\tchatInfo: options.chatInfo,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn isLegacyCall\n\t\t\t\t\t? CallEngineLegacy.getCallWithId(callId)\n\t\t\t\t\t: CallEngine.getCallWithId(callUuid, config);\n\t\t\t})\n\t\t\t.then((result) => {\n\t\t\t\tif (!this.currentCall || (this.currentCall.uuid !== callUuid))\n\t\t\t\t{\n\t\t\t\t\tUtil.setUserData(result.call.userData);\n\t\t\t\t\tthis.currentCall = result.call;\n\t\t\t\t}\n\n\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t}\n\n\t\t\t\treturn this.messengerFacade.openMessenger(options.chatInfo.id);\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\treturn Hardware.init();\n\t\t\t})\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\tthis.createContainer();\n\n\t\t\t\tlet hiddenButtons = [];\n\t\t\t\tif (this.currentCall.provider === Provider.Plain)\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t\thiddenButtons.push('hangupOptions');\n\t\t\t\t\thiddenButtons.push('callconrol');\n\t\t\t\t}\n\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t{\n\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t}\n\n\t\t\t\tHardware.isCameraOn = !!video;\n\n\t\t\t\tthis.callView = new View({\n\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\tshowUsersButton: false,\n\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\tlayout: isGroupCall ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\tshowRecordButton: true,\n\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\t\tblockedButtons: this.getBlockedButtons(this.currentCall.provider === Provider.Plain),\n\t\t\t\t\tshowAddUserButtonInList: this.currentCall.provider === Provider.Plain,\n\t\t\t\t\tisCloudRecordFeaturesEnabled: this.currentCall.isCloudRecordFeaturesEnabled,\n\t\t\t\t\tisCopilotFeaturesEnabled: this.currentCall.isCopilotFeaturesEnabled,\n\t\t\t\t\tisCopilotActive: this.currentCall.isCopilotActive,\n\t\t\t\t\tisWindowFocus: this.isWindowFocus,\n\t\t\t\t});\n\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\tthis.bindCallViewEvents();\n\n\t\t\t\tif (isCallPrepared)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.isPreparing = true;\n\t\t\t\t\tif (this.preparedCall.user)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.appendUsers({\n\t\t\t\t\t\t\t[this.preparedCall.user]: UserState.Calling,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.callView.updateUserData(this.preparedCall.userData);\n\t\t\t\t\tUtil.setUserData(this.preparedCall.userData);\n\t\t\t\t}\n\n\t\t\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t\t\t{\n\t\t\t\t\tthis.callView.appendUsers(this.currentCall.getUsers());\n\t\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\t}\n\n\t\t\t\tconst style = 'background-color: #AA00AA; color: white;'\n\t\t\t\tconsole.log(`%c[debug] Time from click 'Join call' to show call card: ${Date.now() - this.onConnectToCallClick} ms`, style);\n\t\t\t\tthis.onCallViewRenderToMediaReceived = Date.now();\n\n\t\t\t\tthis.callView.show();\n\t\t\t\tthis.showDocumentPromo();\n\t\t\t\tthis.showCopilotNotify();\n\t\t\t\tthis.#showCloudRecordPromo();\n\t\t\t\tthis.checkVpnStatus();\n\n\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t}\n\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t}\n\n\t\t\t\tthis.bindCallEvents();\n\t\t\t\tthis.createVideoStrategy();\n\n\t\t\t\tif (video && !Hardware.hasCamera())\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(BX.message('IM_CALL_ERROR_NO_CAMERA'));\n\t\t\t\t\tvideo = false;\n\t\t\t\t}\n\n\t\t\t\tif (this.currentCall.associatedEntity.userCounter > this.getMaxActiveMicrophonesCount())\n\t\t\t\t{\n\t\t\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\t\t\tthis.showAutoMicMuteNotification();\n\t\t\t\t}\n\n\t\t\t\tthis.currentCall.answer({\n\t\t\t\t\tjoinAsViewer: joinAsViewer\n\t\t\t\t});\n\n\t\t\t\tthis._onUpdateLastUsedCameraId();\n\n\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t},\n\t\t\t\t\tsection: Analytics.AnalyticsSection.chatList,\n\t\t\t\t\telement: Analytics.AnalyticsElement.joinButton,\n\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t\t\t});\n\n\t\t\t\tif (isCallPrepared && this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.isPreparing = false;\n\t\t\t\t}\n\n\t\t\t\tthis.initCallPromise = null;\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tthis.initCallPromise = null;\n\t\t\t\tlet errorCode = 'UNKNOWN_ERROR';\n\t\t\t\tif (Type.isString(error))\n\t\t\t\t{\n\t\t\t\t\terrorCode = error;\n\t\t\t\t}\n\t\t\t\telse if (Type.isObject(error) && error instanceof JoinResponseError)\n\t\t\t\t{\n\t\t\t\t\terrorCode = error.name;\n\t\t\t\t}\n\t\t\t\telse if (Type.isObject(error) && error.code)\n\t\t\t\t{\n\t\t\t\t\terrorCode = error.code === 'access_denied' ? 'ACCESS_DENIED' : error.code;\n\t\t\t\t}\n\n\t\t\t\tAnalytics.getInstance().onJoinCallError({\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\terrorCode,\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\terrorMessage: error?.message,\n\t\t\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tleaveCurrentCall(force, finishCall = false)\n\t{\n\t\tthis.initCallPromise = null;\n\t\tUtil.abortGetCallConnectionData();\n\n\t\tif (this.#isLocalRecordStarted())\n\t\t{\n\t\t\tAnalytics.getInstance().onRecordStop({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\tsubSection: finishCall ? Analytics.AnalyticsSubSection.contextMenu : Analytics.AnalyticsSubSection.window,\n\t\t\t\telement: finishCall ? Analytics.AnalyticsElement.finishForAllButton : Analytics.AnalyticsElement.disconnectButton,\n\t\t\t\trecordTime: Util.getRecordTimeText(this.commonRecord.info, true),\n\t\t\t});\n\n\t\t}\n\n\t\tthis.#stopCommonRecord();\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.releaseLocalMedia();\n\t\t}\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.answeredOrDeclinedCalls.delete(this._getCallIdentifier(this.currentCall));\n\t\t\tthis.currentCall.hangup(force, '', finishCall);\n\t\t\tif (force)\n\t\t\t{\n\t\t\t\tthis.currentCall = null;\n\t\t\t}\n\n\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t{\n\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t}\n\t\t}\n\n\t\tif (this.childCall)\n\t\t{\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserJoined, this._onChildCallFirstMediaHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstUserJoinedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\t\tthis.childCall.hangup(force, '', finishCall);\n\t\t\tthis.childCall = null;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tfor (const mediaStreamKind of Object.values(MediaStreamsKinds))\n\t\t{\n\t\t\tCallStreamManager.stopStream(mediaStreamKind);\n\t\t}\n\n\t\tthis.hasStreamFromCall = false;\n\t\tthis.#stopLocalStream();\n\t}\n\n\thasActiveCall()\n\t{\n\t\treturn !!((this.currentCall && this.currentCall.isAnyoneParticipating()) || (this.callView));\n\t}\n\n\thasVisibleCall()\n\t{\n\t\treturn !!(this.callView && this.callView.visible && this.callView.size == View.Size.Full);\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\t#canLocalRecord(): boolean\n\t{\n\t\tconst isDesktop = DesktopApi.isDesktop();\n\t\tconst isValidApi = DesktopApi.getApiVersion() >= 54;\n\n\t\t// It's a desktop with the right API version.\n\t\tif (!isDesktop || !isValidApi)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// If cloud recording is disabled, can record local\n\t\tif (!CallCloudRecord.serviceEnabled)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\t// If the cloud recording tariff is not available, can record local\n\t\tif (!CallCloudRecord.tariffAvailable)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\t// If the cloud recording is active, and it is a paid plan, then we turn it on only in plain\n\t\treturn this.currentCall.provider === Provider.Plain;\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\t#canCloudRecord(): boolean\n\t{\n\t\tconst isPlainCall = this.currentCall.provider === Provider.Plain;\n\t\tconst cloudRecordingEnabled = ((isPlainCall && CallSettingsManager.plainCallCloudRecordingEnabled) || !isPlainCall);\n\n\t\treturn CallCloudRecord.serviceEnabled\n\t\t\t&& CallCloudRecord.tariffAvailable\n\t\t\t&& cloudRecordingEnabled;\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\t#canCommonRecord(): boolean\n\t{\n\t\treturn this.#canLocalRecord() || this.#canCloudRecord();\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\t#isLocalRecordStarted(): boolean\n\t{\n\t\treturn this.#canLocalRecord()\n\t\t\t&& this.commonRecord.state != CallCommonRecordState.Stopped\n\t\t\t&& this.commonRecord.state != CallCommonRecordState.Destroyed;\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\t#isCommonRecordStarted(): boolean\n\t{\n\t\treturn this.#canCommonRecord()\n\t\t\t&& this.commonRecord.state != CallCommonRecordState.Stopped\n\t\t\t&& this.commonRecord.state != CallCommonRecordState.Destroyed;\n\t}\n\n\tuseDevicesInCurrentCall(deviceList, isForceUse = false)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < deviceList.length; i++)\n\t\t{\n\t\t\tconst deviceInfo = deviceList[i];\n\n\t\t\tswitch (deviceInfo.kind)\n\t\t\t{\n\t\t\t\tcase \"audioinput\":\n\t\t\t\t\tif (deviceInfo.deviceId === 'default' || isForceUse)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst newDeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceInfo.groupId, 'audioinput');\n\t\t\t\t\t\tthis.currentCall.setMicrophoneId(newDeviceId);\n\t\t\t\t\t\tthis.callView.setMicrophoneId(newDeviceId);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"videoinput\":\n\t\t\t\t\tif (deviceInfo.deviceId === 'default' || isForceUse)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.setCameraId(deviceInfo.deviceId);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.reconnectingCameraId === deviceInfo.deviceId && !Hardware.isCameraOn)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateCameraSettingsInCurrentCallAfterReconnecting(deviceInfo.deviceId)\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"audiooutput\":\n\t\t\t\t\tif (this.callView && deviceInfo.deviceId === 'default' || isForceUse)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst newDeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceInfo.groupId, 'audiooutput');\n\t\t\t\t\t\tthis.callView.setSpeakerId(newDeviceId);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveDevicesFromCurrentCall(deviceList)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (let i = 0; i < deviceList.length; i++)\n\t\t{\n\t\t\tconst deviceInfo = deviceList[i];\n\n\t\t\tswitch (deviceInfo.kind)\n\t\t\t{\n\t\t\t\tcase \"audioinput\":\n\t\t\t\t\tif (this.currentCall.microphoneId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst microphoneIds = Object.keys(Hardware.microphoneList);\n\t\t\t\t\t\tlet deviceId;\n\n\t\t\t\t\t\tif (microphoneIds.includes('default'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst deviceGroup = Hardware.getDeviceGroupIdByDeviceId('default', 'audioinput');\n\t\t\t\t\t\t\tdeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceGroup, 'audioinput');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!deviceId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdeviceId = microphoneIds.length > 0 ? microphoneIds[0] : \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.currentCall.setMicrophoneId(deviceId);\n\n\t\t\t\t\t\tif (this.currentCall.provider === Provider.Bitrix)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.callView.setMicrophoneId(deviceId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"videoinput\":\n\t\t\t\t\tif (this.currentCall.cameraId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst cameraIds = Object.keys(Hardware.cameraList);\n\t\t\t\t\t\tthis.currentCall.setCameraId(cameraIds.length > 0 ? cameraIds[0] : \"\");\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"audiooutput\":\n\t\t\t\t\tif (this.callView && this.callView.speakerId == deviceInfo.deviceId)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst speakerIds = Object.keys(Hardware.audioOutputList);\n\t\t\t\t\t\tlet deviceId;\n\n\t\t\t\t\t\tif (speakerIds.includes('default'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst deviceGroup = Hardware.getDeviceGroupIdByDeviceId('default', 'audiooutput');\n\t\t\t\t\t\t\tdeviceId = Hardware.getDefaultDeviceIdByGroupId(deviceGroup, 'audiooutput');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!deviceId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdeviceId = speakerIds.length > 0 ? speakerIds[0] : \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.callView.setSpeakerId(deviceId);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tshowChat()\n\t{\n\t\tif (DesktopApi.isDesktop() && this.floatingWindow)\n\t\t{\n\t\t\tthis.detached = true;\n\t\t\tthis.callView.hide();\n\t\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\t\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) => {\n\t\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t\t\tthis.floatingWindow.show();\n\t\t\t});\n\n\t\t\tthis.container.style.width = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.fold(Text.decode(this.currentCall.associatedEntity.name));\n\t\t}\n\t}\n\n\ttogglePictureInPictureCallWindow(config = {})\n\t{\n\t\tconst hasActiveCall = Boolean(this.currentCall);\n\t\tconst isFolded = this.folded;\n\t\tconst isScreenSharing = hasActiveCall && this.currentCall.isScreenSharingStarted();\n\t\tconst isForceOpen = config.isForceOpen;\n\t\tconst isForceClose = config.isForceClose;\n\n\t\tconst shouldOpenPiP = isFolded || isScreenSharing || isForceOpen || this.callView?.enableAutoPip;\n\t\tconst canStayOpen = shouldOpenPiP && !isForceClose;\n\n\t\tconst isActiveStatePictureInPictureCallWindow = hasActiveCall && canStayOpen;\n\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.talkingService.refreshQueue();\n\n\t\tthis.callView.isActivePiPFromController = isActiveStatePictureInPictureCallWindow;\n\t\tthis.callView.toggleStatePictureInPictureCallWindow(isActiveStatePictureInPictureCallWindow);\n\t}\n\n\tfold(foldedCallTitle)\n\t{\n\t\tif (this.folded || (DesktopApi.isDesktop() && this.floatingWindow))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!foldedCallTitle && this.currentCall)\n\t\t{\n\t\t\tfoldedCallTitle = Text.decode(this.currentCall.associatedEntity.name)\n\t\t}\n\n\t\tthis.folded = true;\n\t\tif (this.resizeObserver)\n\t\t{\n\t\t\tthis.resizeObserver.unobserve(this.container);\n\t\t}\n\t\tthis.container.classList.add('bx-messenger-call-overlay-folded');\n\t\tthis.callView.setTitle(foldedCallTitle);\n\t\tthis.callView.setSize(View.Size.Folded);\n\t\tthis.callViewState = ViewState.Folded;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tthis.sidebar.toggleHidden(true);\n\t\t}\n\t\tthis.closePromo();\n\t\tthis.callView.closeCopilotNotify();\n\n\t\tBX.onCustomEvent(this, \"CallController::onFold\", {});\n\n\t\tthis.togglePictureInPictureCallWindow();\n\t}\n\n\tsetCallEditorMaxWidth(maxWidth)\n\t{\n\t\tif (maxWidth != this.maxEditorWidth)\n\t\t{\n\t\t\tthis.maxEditorWidth = maxWidth;\n\t\t\tthis._onResize();\n\t\t}\n\t}\n\n\tfindCallEditorWidth()\n\t{\n\t\tconst containerWidth = this.container.clientWidth;\n\t\tconst editorWidth = containerWidth < (this.maxEditorWidth + View.MIN_WIDTH) ? containerWidth - View.MIN_WIDTH : this.maxEditorWidth;\n\t\tconst callWidth = containerWidth - editorWidth;\n\n\t\treturn {callWidth: callWidth, editorWidth: editorWidth};\n\t}\n\n\tshowDocumentsMenu()\n\t{\n\t\tif (this.documentsMenu)\n\t\t{\n\t\t\tthis.documentsMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tAnalytics.getInstance().onDocumentBtnClick({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tconst targetNodeWidth = this.callView.buttons.document.elements.root.offsetWidth;\n\t\tconst resumesArticleCode = Util.getResumesArticleCode();\n\t\tconst documentsArticleCode = Util.getDocumentsArticleCode();\n\n\t\tlet menuItems = [\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_RESUME_MSGVER_2'),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.resume);\n\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\ttype: DocumentType.Resume,\n\t\t\t\t\t\t}, resumesArticleCode);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE'),\n\t\t\t\t\titems: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_DOC'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.doc);\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_DOCX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_XLS'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.sheet);\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_XLSX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_CREATE_FILE_PPT'),\n\t\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\t\tthis.onDocumentCreateAnalyticsEvent(Analytics.AnalyticsType.presentation);\n\t\t\t\t\t\t\t\tthis.maybeShowDocumentEditor({\n\t\t\t\t\t\t\t\t\ttype: DocumentType.Blank,\n\t\t\t\t\t\t\t\t\ttypeFile: FILE_TYPE_PPTX,\n\t\t\t\t\t\t\t\t}, documentsArticleCode);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t,\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t]\n\t\t;\n\n\t\tif (!resumesArticleCode)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: BX.message('IM_M_CALL_MENU_OPEN_LAST_RESUME_MSGVER_2'),\n\t\t\t\tcacheable: true,\n\t\t\t\titems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: \"loading\",\n\t\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_LOADING_RESUME_LIST'),\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\tonSubMenuShow: (e) => this.buildPreviousResumesSubmenu(e.target)\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tlet newStyleOptions = {\n\t\t\tclassName: 'bx-messenger-videocall-document-options-container',\n\t\t\tbackground: '#00428F',\n\t\t\tcontentBackground: '#00428F',\n\t\t\tborderRadius: '6px',\n\t\t\tdarkMode: true,\n\t\t\tcontentBorderRadius: '6px',\n\t\t};\n\n\t\tthis.documentsMenu = new BX.PopupMenuWindow({\n\t\t\t...newStyleOptions,\n\t\t\tangle: false,\n\t\t\tbindElement: this.callView.buttons.document.elements.root,\n\t\t\ttargetContainer: this.container,\n\t\t\toffsetTop: -15,\n\t\t\tbindOptions: {position: \"top\"},\n\t\t\tcacheable: false,\n\t\t\tsubMenuOptions: {\n\t\t\t\tmaxWidth: 450\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonShow: (event) =>\n\t\t\t\t{\n\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\tpopup.getPopupContainer().style.display = 'block'; // bad hack\n\n\t\t\t\t\tconst offsetLeft = (targetNodeWidth / 2) - popup.getPopupContainer().offsetWidth / 2;\n\t\t\t\t\tpopup.setOffset({offsetLeft: offsetLeft + 40, offsetTop: 0});\n\t\t\t\t\tpopup.setAngle({offset: popup.getPopupContainer().offsetWidth / 2 - 17});\n\t\t\t\t},\n\t\t\t\tonDestroy: () => this.documentsMenu = null\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t});\n\n\t\tthis.documentsMenu.show();\n\t}\n\n\tonDocumentCreateAnalyticsEvent(documentType)\n\t{\n\t\tAnalytics.getInstance().onDocumentCreate({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttype: documentType,\n\t\t});\n\t}\n\n\tbuildPreviousResumesSubmenu(menuItem)\n\t{\n\t\t// todo: check if it's correct\n\t\tBX.ajax.runAction('disk.api.integration.messengerCall.listResumesInChatByCall', {\n\t\t\tdata: {\n\t\t\t\tcallUuid: this.currentCall.uuid,\n\t\t\t}\n\t\t}).then((response) =>\n\t\t{\n\t\t\tconst resumeList = response.data.resumes;\n\n\t\t\tif (resumeList.length > 0)\n\t\t\t{\n\t\t\t\tresumeList.forEach((resume) =>\n\t\t\t\t{\n\t\t\t\t\tmenuItem.getSubMenu().addMenuItem({\n\t\t\t\t\t\tid: resume.id,\n\t\t\t\t\t\ttext: resume.object.createDate + ': ' + resume.object.name,\n\t\t\t\t\t\tonclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.documentsMenu.close();\n\t\t\t\t\t\t\tAnalytics.getInstance().onLastResumeOpen({\n\t\t\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.viewDocumentByLink(resume.links.view);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmenuItem.getSubMenu().addMenuItem({\n\t\t\t\t\tid: 'nothing',\n\t\t\t\t\ttext: BX.message('IM_M_CALL_MENU_NO_RESUME_MSGVER_2'),\n\t\t\t\t\tdisabled: true\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tmenuItem.getSubMenu().removeMenuItem('loading');\n\t\t\tmenuItem.adjustSubMenu();\n\t\t})\n\t}\n\n\tmaybeShowDocumentEditor(options, articleCode)\n\t{\n\t\tif (articleCode)\n\t\t{\n\t\t\tif (articleCode)\n\t\t\t{\n\t\t\t\tBX.UI.InfoHelper.show(articleCode);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.showDocumentEditor(options);\n\t}\n\n\tshowDocumentEditor(options)\n\t{\n\t\toptions = options || {};\n\t\tlet openAnimation = true;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tif (options.force)\n\t\t\t{\n\t\t\t\tthis.sidebar.close(false);\n\t\t\t\tthis.sidebar.destroy();\n\t\t\t\tthis.sidebar = null;\n\t\t\t\topenAnimation = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setButtonActive('document', true);\n\t\t}\n\t\tclearTimeout(this.showPromoPopupTimeout);\n\n\t\tthis._createAndOpenSidebarWithIframe(\"about:blank\", openAnimation);\n\n\t\tBX.loadExt('disk.onlyoffice-im-integration')\n\t\t\t.then(() =>\n\t\t\t{\n\t\t\t\t// todo: check if it's correct\n\t\t\t\tconst docEditor = new BX.Disk.OnlyOfficeImIntegration.CreateDocument({\n\t\t\t\t\tdialog: {\n\t\t\t\t\t\tid: this.currentCall.associatedEntity.id,\n\t\t\t\t\t},\n\t\t\t\t\tcall: {\n\t\t\t\t\t\tuuid: this.currentCall.uuid,\n\t\t\t\t\t},\n\t\t\t\t\tdelegate: {\n\t\t\t\t\t\tsetMaxWidth: this.setCallEditorMaxWidth.bind(this),\n\t\t\t\t\t\tonDocumentCreated: this._onDocumentCreated.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\ttype: options.type,\n\t\t\t\t\ttypeFile: options?.typeFile,\n\t\t\t\t});\n\n\t\t\t\tlet promiseGetUrl;\n\t\t\t\tif (options.type === DocumentType.Resume)\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrlForTemplates();\n\t\t\t\t}\n\t\t\t\telse if (options.type === DocumentType.Blank)\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrlForCreate({\n\t\t\t\t\t\ttypeFile: options.typeFile\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpromiseGetUrl = docEditor.getIframeUrl({\n\t\t\t\t\t\tviewerItem: options.viewerItem\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tpromiseGetUrl\n\t\t\t\t\t.then((url) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.docEditorIframe.src = url;\n\t\t\t\t\t})\n\t\t\t\t\t.catch((e) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(e)\n\t\t\t\t\t\tthis.closeDocumentEditor()\n\t\t\t\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t\t\t\t});\n\n\t\t\t\tthis.docEditor = docEditor;\n\t\t\t})\n\t\t\t.catch((error) =>\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t\tthis.closeDocumentEditor()\n\t\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t\t});\n\n\t\tif (this.resizeObserver)\n\t\t{\n\t\t\tthis.resizeObserver.observe(this.container);\n\t\t}\n\t}\n\n\tcloseDocumentEditor()\n\t{\n\t\tAnalytics.getInstance().onDocumentClose({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttype: this.getDocumentType(),\n\t\t});\n\n\t\treturn new Promise((resolve) =>\n\t\t{\n\t\t\tif (this.docEditor && this.docEditorIframe)\n\t\t\t{\n\t\t\t\tthis.docEditor.onCloseIframe(this.docEditorIframe);\n\t\t\t}\n\t\t\tif (this.container && this.resizeObserver)\n\t\t\t{\n\t\t\t\tthis.resizeObserver.unobserve(this.container);\n\t\t\t}\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setButtonActive('document', false);\n\t\t\t\tthis.callView.removeMaxWidth();\n\t\t\t}\n\t\t\tif (!this.sidebar)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\t\t\tconst oldSidebar = this.sidebar;\n\t\t\tthis.sidebar = null;\n\t\t\toldSidebar.close().then(() =>\n\t\t\t{\n\t\t\t\tthis.docEditor = null;\n\t\t\t\tthis.docEditorIframe = null;\n\t\t\t\toldSidebar.destroy();\n\t\t\t\tthis.maxEditorWidth = this.docCreatedForCurrentCall ? DOC_EDITOR_WIDTH : DOC_TEMPLATE_WIDTH;\n\t\t\t\tif (!this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.removeContainer();\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tclearPictureInPictureDebounceForOpen()\n\t{\n\t\tif (this.pictureInPictureDebounceForOpen)\n\t\t{\n\t\t\tclearTimeout(this.pictureInPictureDebounceForOpen);\n\t\t\tthis.pictureInPictureDebounceForOpen = null;\n\t\t}\n\t}\n\n\tonInputFileOpenedStateUpdate(isActive)\n\t{\n\t\tif (isActive)\n\t\t{\n\t\t\tthis.clearPictureInPictureDebounceForOpen();\n\t\t\tthis.togglePictureInPictureCallWindow({ isForceClose: true });\n\t\t\tthis.isFileChooserActive = true;\n\t\t}\n\n\t\tif (!isActive && !this.pictureInPictureDebounceForOpen)\n\t\t{\n\t\t\tthis.pictureInPictureDebounceForOpen = setTimeout(() => {\n\t\t\t\tthis.togglePictureInPictureCallWindow();\n\t\t\t\tthis.isFileChooserActive = false;\n\t\t\t\tthis.pictureInPictureDebounceForOpen = null;\n\t\t\t}, 1000);\n\t\t}\n\t}\n\n\tupdateWindowFocusState(isActive)\n\t{\n\t\tif (isActive === this.isWindowFocus)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isWindowFocus = isActive;\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setWindowFocusState(this.isWindowFocus);\n\t\t}\n\t}\n\n\tviewDocumentByLink(url)\n\t{\n\t\tif (this.sidebar)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setButtonActive('document', true);\n\t\t}\n\n\t\tthis.maxEditorWidth = DOC_EDITOR_WIDTH;\n\t\tthis._createAndOpenSidebarWithIframe(url);\n\t}\n\n\t_createAndOpenSidebarWithIframe(url, animation)\n\t{\n\t\tanimation = animation === true;\n\t\tconst result = this.findCallEditorWidth();\n\t\tconst callWidth = result.callWidth;\n\t\tconst editorWidth = result.editorWidth;\n\n\t\tthis.callView.setMaxWidth(callWidth);\n\t\tthis.sidebar = new Sidebar({\n\t\t\tcontainer: this.container,\n\t\t\twidth: editorWidth,\n\t\t\tevents: {\n\t\t\t\tonCloseClicked: this.onSideBarCloseClicked.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.sidebar.open(animation);\n\n\t\tconst loader = new BX.Loader({\n\t\t\ttarget: this.sidebar.elements.contentContainer\n\t\t});\n\t\tloader.show();\n\n\t\tconst docEditorIframe = BX.create(\"iframe\", {\n\t\t\tattrs: {\n\t\t\t\tsrc: url,\n\t\t\t\tframeborder: \"0\"\n\t\t\t},\n\t\t\tstyle: {\n\t\t\t\tdisplay: \"none\",\n\t\t\t\tborder: \"0\",\n\t\t\t\tmargin: \"0\",\n\t\t\t\twidth: \"100%\",\n\t\t\t\theight: \"100%\",\n\t\t\t}\n\t\t});\n\n\t\tdocEditorIframe.addEventListener('load',\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tloader.destroy();\n\t\t\t\tdocEditorIframe.style.display = 'block';\n\t\t\t},\n\t\t\t{once: true}\n\t\t);\n\t\tdocEditorIframe.addEventListener('error', (error) =>\n\t\t{\n\t\t\tconsole.error(error);\n\t\t\tthis.closeDocumentEditor()\n\t\t\talert(BX.message(\"IM_F_ERROR\"));\n\t\t})\n\t\tthis.sidebar.elements.contentContainer.appendChild(docEditorIframe);\n\t\tthis.docEditorIframe = docEditorIframe;\n\t}\n\n\t_onDocumentCreated()\n\t{\n\t\tthis.docCreatedForCurrentCall = true;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.sendCustomMessage(DOC_CREATED_EVENT, true)\n\t\t}\n\n\t\tAnalytics.getInstance().onDocumentUpload({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttype: this.getDocumentType(),\n\t\t});\n\t}\n\n\tonSideBarCloseClicked()\n\t{\n\t\tthis.closeDocumentEditor();\n\t}\n\n\t_ensureDocumentEditorClosed()\n\t{\n\t\treturn new Promise((resolve, reject) =>\n\t\t{\n\t\t\tif (!this.sidebar)\n\t\t\t{\n\t\t\t\treturn resolve();\n\t\t\t}\n\n\t\t\tconst messageBox = new MessageBox({\n\t\t\t\tmessage: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_TO_ANSWER'),\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_YES'),\n\t\t\t\tcancelCaption: BX.message('IM_CALL_CLOSE_DOCUMENT_EDITOR_NO'),\n\t\t\t\tonOk: () =>\n\t\t\t\t{\n\t\t\t\t\tthis.closeDocumentEditor().then(() => resolve());\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tonCancel: () =>\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tmessageBox.show();\n\t\t})\n\t}\n\n\tonDocumentPromoActionClicked()\n\t{\n\t\tthis.closePromo();\n\n\t\tconst articleCode = Util.getResumesArticleCode();\n\t\tif (articleCode)\n\t\t{\n\t\t\tBX.UI.InfoHelper.show(articleCode); //@see \\Bitrix\\Disk\\Integration\\MessengerCall::getInfoHelperCodeForDocuments()\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showDocumentEditor({\n\t\t\ttype: DocumentType.Resume,\n\t\t});\n\t}\n\n\tonDocumentPromoClosed(e)\n\t{\n\t\tconst data = e.getData();\n\t\tif (data.dontShowAgain)\n\t\t{\n\t\t\tthis.emit(Events.onPromoViewed, {\n\t\t\t\tcode: DOCUMENT_PROMO_CODE\n\t\t\t})\n\t\t}\n\n\t\tthis.documentPromoPopup = null;\n\t}\n\n\tgetDocumentType()\n\t{\n\t\tif (this.docEditor?.options?.type === DocumentType.Resume)\n\t\t{\n\t\t\treturn Analytics.AnalyticsType.resume;\n\t\t}\n\n\t\tswitch (this.docEditor?.options?.typeFile)\n\t\t{\n\t\t\tcase FILE_TYPE_DOCX:\n\t\t\t\treturn Analytics.AnalyticsType.doc;\n\t\t\tcase FILE_TYPE_XLSX:\n\t\t\t\treturn Analytics.AnalyticsType.sheet;\n\t\t\tcase FILE_TYPE_PPTX:\n\t\t\t\treturn Analytics.AnalyticsType.presentation;\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tunfold(options = {})\n\t{\n\t\tconst { fromPiP = false } = options;\n\n\t\tif (this.detached)\n\t\t{\n\t\t\tthis.container.style.removeProperty('width');\n\t\t\tthis.callView.show();\n\n\t\t\tthis.detached = false;\n\t\t\tif (this.floatingWindow)\n\t\t\t{\n\t\t\t\tthis.floatingWindow.hide();\n\t\t\t}\n\t\t}\n\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.folded = false;\n\t\t\tthis.container.classList.remove('bx-messenger-call-overlay-folded');\n\t\t\tthis.callView.setSize(View.Size.Full);\n\t\t\tthis.callViewState = ViewState.Opened;\n\t\t\tZIndexManager.getStack(document.body).bringToFront(this.container);\n\t\t\tif (this.sidebar)\n\t\t\t{\n\t\t\t\tthis.sidebar.toggleHidden(false);\n\t\t\t\tif (this.resizeObserver)\n\t\t\t\t{\n\t\t\t\t\tthis.resizeObserver.observe(this.container);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.togglePictureInPictureCallWindow({ isForceClose: fromPiP });\n\t\t}\n\n\t\tBX.onCustomEvent(this, \"CallController::onUnfold\", {});\n\t}\n\n\tisFullScreen()\n\t{\n\t\tif (\"webkitFullscreenElement\" in document)\n\t\t{\n\t\t\treturn (!!document.webkitFullscreenElement);\n\t\t}\n\t\telse if (\"fullscreenElement\" in document)\n\t\t{\n\t\t\treturn (!!document.fullscreenElement);\n\t\t}\n\t\treturn false;\n\t}\n\n\ttoggleFullScreen()\n\t{\n\t\tif (this.isFullScreen())\n\t\t{\n\t\t\tthis.exitFullScreen();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.enterFullScreen();\n\t\t}\n\t}\n\n\tenterFullScreen()\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst element = this.callView.elements.root;\n\n\t\ttry\n\t\t{\n\t\t\tconst requestFullscreen = element.requestFullscreen\n\t\t\t\t|| element.webkitRequestFullscreen\n\t\t\t\t|| element.mozRequestFullScreen\n\t\t\t\t|| element.msRequestFullscreen\n\t\t\t;\n\n\t\t\tif (requestFullscreen)\n\t\t\t{\n\t\t\t\trequestFullscreen.call(element).catch((error) => {\n\t\t\t\t\tconsole.error('Failed to enter fullscreen mode:', error);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.warn('Fullscreen API is not supported in this browser');\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error('Error attempting to enable fullscreen mode:', e);\n\t\t}\n\t}\n\n\texitFullScreen()\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst exitFullscreen = document.exitFullscreen\n\t\t\t\t|| document.mozCancelFullScreen\n\t\t\t\t|| document.webkitExitFullscreen\n\t\t\t\t|| document.msExitFullscreen\n\t\t\t\t|| document.cancelFullScreen\n\t\t\t;\n\n\t\t\tif (exitFullscreen)\n\t\t\t{\n\t\t\t\texitFullscreen.call(document).catch((error) => {\n\t\t\t\t\tconsole.error('Failed to exit fullscreen mode:', error);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.warn('Fullscreen API is not fully supported in this browser');\n\t\t\t}\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tconsole.error('Error attempting to exit fullscreen mode:', e);\n\t\t}\n\t}\n\n\tshowDocumentPromo()\n\t{\n\t\tif (!this.callView || !this.currentCall || !Util.shouldShowDocumentButton())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.messengerFacade.isPromoRequired(DOCUMENT_PROMO_CODE))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst documentButton = this.callView.buttons.document.elements.root;\n\t\tconst bindElement = documentButton.querySelector('.bx-messenger-videocall-panel-icon');\n\t\tif (!bindElement)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tthis.documentPromoPopup = new PromoPopup({\n\t\t\tbindElement: bindElement,\n\t\t\tpromoCode: DOCUMENT_PROMO_CODE,\n\t\t\tevents: {\n\t\t\t\tonActionClick: this.onDocumentPromoActionClicked.bind(this),\n\t\t\t\tonClose: this.onDocumentPromoClosed.bind(this)\n\t\t\t}\n\t\t});\n\t\tthis.showPromoPopupTimeout = setTimeout(() =>\n\t\t{\n\t\t\tif (this.folded)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.documentPromoPopup.show();\n\t\t}, DOCUMENT_PROMO_DELAY);\n\t}\n\n\tshowMaskPromo()\n\t{\n\t\tif (!this.callView || !this.currentCall || !BackgroundDialog.isMaskAvailable())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.messengerFacade.isPromoRequired(MASK_PROMO_CODE))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.maskPromoPopup = new PromoPopup3D({\n\t\t\tcallView: this.callView,\n\t\t\tevents: {\n\t\t\t\tonClose: (e) =>\n\t\t\t\t{\n\t\t\t\t\tthis.emit(Events.onPromoViewed, {\n\t\t\t\t\t\tcode: MASK_PROMO_CODE\n\t\t\t\t\t})\n\t\t\t\t\tthis.maskPromoPopup = null\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.showPromoPopup3dTimeout = setTimeout(\n\t\t\t() =>\n\t\t\t{\n\t\t\t\tif (!this.folded)\n\t\t\t\t{\n\t\t\t\t\tthis.maskPromoPopup.show();\n\t\t\t\t}\n\t\t\t},\n\t\t\tMASK_PROMO_DELAY\n\t\t);\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\t#showCloudRecordPromo()\n\t{\n\t\tconst isPlainCall = this.currentCall.provider === Provider.Plain;\n\t\tconst isBitrixCall = this.currentCall.provider === Provider.Bitrix;\n\t\tconst cloudRecordingEnabled = (isPlainCall && this.currentCall.isCloudRecordFeaturesEnabled) || isBitrixCall;\n\n\t\tif (this.hasActiveCall() && CallCloudRecord.serviceEnabled && cloudRecordingEnabled)\n\t\t{\n\t\t\tthis.callView.showCloudRecordPromo(this.currentCall.isCloudRecordFeaturesEnabled, this.currentCall.id);\n\t\t}\n\t}\n\n\tclosePromo()\n\t{\n\t\tif (this.documentPromoPopup)\n\t\t{\n\t\t\tthis.documentPromoPopup.close();\n\t\t}\n\n\t\tif (this.maskPromoPopup)\n\t\t{\n\t\t\tthis.maskPromoPopup.close();\n\t\t}\n\n\t\tclearTimeout(this.showPromoPopupTimeout);\n\t\tclearTimeout(this.showPromoPopup3dTimeout);\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\t#getDefaultCommonRecord()\n\t{\n\t\treturn {\n\t\t\tstate: CallCommonRecordState.Stopped,\n\t\t\ttype: CallCommonRecordType.None,\n\t\t\tinitiatorId: null,\n\t\t\tinfo: null,\n\t\t\tnotifyShowed: false,\n\t\t};\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\t#startCommonRecord(type)\n\t{\n\t\tconst isPlainCall = this.currentCall.provider === Provider.Plain;\n\t\tconst isBitrixCall = this.currentCall.provider === Provider.Bitrix;\n\t\tconst cloudRecordingEnabled = (isPlainCall && this.currentCall.isCloudRecordFeaturesEnabled) || isBitrixCall;\n\n\t\tthis.commonRecord.type = type;\n\n\t\tif (CallCloudRecord.serviceEnabled && cloudRecordingEnabled)\n\t\t{\n\t\t\tconst kind = type === 'audio' ? CloudRecordKind.AUDIO : CloudRecordKind.VIDEO;\n\t\t\tthis.callView.blockButtons(['record']);\n\t\t\tthis.currentCall.setCloudRecordState(CloudRecordStatus.STARTED, kind);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.setButtonActive('record', true);\n\n\t\tthis.currentCall.sendLocalRecordState({\n\t\t\taction: CallCommonRecordState.Started,\n\t\t\ttype: this.commonRecord.type,\n\t\t\tdate: new Date(),\n\t\t});\n\n\t\tthis.commonRecord.state = CallCommonRecordState.Started;\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\t#stopCommonRecord()\n\t{\n\t\tconst initiatorId = this.commonRecord.initiatorId;\n\t\tconst state = this.commonRecord.state;\n\n\t\tthis.commonRecord = this.#getDefaultCommonRecord();\n\n\t\tif (this.#canLocalRecord())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordStop();\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setCommonRecordState(this.callView.getDefaultCommonRecordState());\n\t\t\tthis.callView.setButtonActive('record', false);\n\t\t}\n\n\t\tif (\n\t\t\tstate !== CallCommonRecordState.Stopped\n\t\t\t&& initiatorId === this.userId\n\t\t\t&& (this.currentCall && this.currentCall.isAnyoneParticipating())\n\t\t)\n\t\t{\n\t\t\tthis.currentCall.sendLocalRecordState({\n\t\t\t\taction: CallCommonRecordState.Stopped,\n\t\t\t\tuserId: this.userId,\n\t\t\t});\n\t\t}\n\t}\n\n\t// event handlers\n\n\t_onCallNotificationClose()\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.destroy();\n\t\t}\n\t}\n\n\t_onCallNotificationDestroy()\n\t{\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\t\tthis.callNotification = null;\n\t}\n\n\tasync _onCallNotificationButtonClick(e)\n\t{\n\t\tconst data = e.data;\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.callNotification.close();\n\t\tswitch (data.button)\n\t\t{\n\t\t\tcase \"answer\":\n\t\t\t\tif (this.currentCall && !this.answeredOrDeclinedCalls.has(this._getCallIdentifier(this.currentCall)))\n\t\t\t\t{\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(this._getCallIdentifier(this.currentCall));\n\t\t\t\t\tconst callParams = {\n\t\t\t\t\t\tid: this.currentCall?.id,\n\t\t\t\t\t\tuuid: this.currentCall?.uuid,\n\t\t\t\t\t\tscheme: this.currentCall?.scheme || CallScheme.classic,\n\t\t\t\t\t};\n\n\t\t\t\t\tif (!DesktopApi.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onAnswerButtonClick(data.mediaParams, callParams);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tawait DesktopApi.showBrowserWindow();\n\n\t\t\t\t\tif (DesktopApi.isFeatureSupported(DesktopFeature.portalTabActivation.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tawait DesktopApi.handlePortalTabActivation();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (DesktopApi.shouldActivateTabWithChatPage())\n\t\t\t\t\t{\n\t\t\t\t\t\tawait DesktopApi.setTabWithChatPageActive();\n\t\t\t\t\t}\n\n\t\t\t\t\tDesktopBroadcastManager.getInstance().sendActionMessage({\n\t\t\t\t\t\taction: DesktopBroadcastAction.answerButtonClick,\n\t\t\t\t\t\tparams: {\n\t\t\t\t\t\t\tmediaParams: data.mediaParams,\n\t\t\t\t\t\t\tcallParams,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"decline\":\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tconst callId = this._getCallIdentifier(this._getCallIdentifier(this.currentCall));\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(callId);\n\t\t\t\t\tthis.ignoreDeclinedCallsTimeout[callId] = setTimeout(\n\t\t\t\t\t\t() => this.answeredOrDeclinedCalls.delete(callId),\n\t\t\t\t\t\t15000\n\t\t\t\t\t);\n\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\tthis.removeCallEvents();\n\n\t\t\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\t\t\tcallId: callId,\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tsection: Analytics.AnalyticsSection.callPopup,\n\t\t\t\t\t\telement: Analytics.AnalyticsElement.answerButton,\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.decline,\n\t\t\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.currentCall.decline(603);\n\t\t\t\t\tthis.currentCall = null;\n\n\t\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tonAnswerButtonClick(mediaParams, callParams)\n\t{\n\t\tconst isLegacyCall= callParams.scheme === CallScheme.classic;\n\t\tconst currentCallPromise = isLegacyCall\n\t\t\t? CallEngineLegacy.getCallWithId(callParams.id)\n\t\t\t: CallEngine.getCallWithId(callParams.uuid)\n\t\t;\n\n\t\tcurrentCallPromise.then(result => {\n\t\t\tif (!this.currentCall)\n\t\t\t{\n\t\t\t\tthis.currentCall = result.call;\n\t\t\t\tthis.bindCallEvents();\n\t\t\t}\n\n\t\t\tif (DesktopApi.isDesktop())\n\t\t\t{\n\t\t\t\tDesktopApi.activateWindow();\n\t\t\t}\n\n\t\t\tif (!this.isUserAgentSupported())\n\t\t\t{\n\t\t\t\tthis.log(\"Error: unsupported user agent\");\n\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\tthis.removeCallEvents();\n\t\t\t\tthis.currentCall.decline();\n\t\t\t\tthis.currentCall = null;\n\n\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t{\n\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t}\n\n\t\t\t\tthis.showUnsupportedNotification();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tAnalytics.getInstance().onJoinCall({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\tmediaParams,\n\t\t\t\tsection: Analytics.AnalyticsSection.callPopup,\n\t\t\t\telement: Analytics.AnalyticsElement.answerButton,\n\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\tassociatedEntity: this.currentCall.associatedEntity,\n\t\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t\t});\n\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.destroy();\n\t\t\t}\n\n\t\t\tconst dialogId = this.currentCall.associatedEntity && this.currentCall.associatedEntity.id ? this.currentCall.associatedEntity.id : false;\n\t\t\tlet isGroupCall = dialogId.toString().startsWith(\"chat\");\n\t\t\tthis._ensureDocumentEditorClosed()\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\treturn this.messengerFacade.openMessenger(dialogId, true);\n\t\t\t\t})\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\treturn Hardware.init();\n\t\t\t\t})\n\t\t\t\t.then(() =>\n\t\t\t\t{\n\t\t\t\t\tif (!this.currentCall)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.log('The call was destroyed while being answered');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.createContainer();\n\t\t\t\t\tlet hiddenButtons = [];\n\t\t\t\t\tif (this.currentCall.provider === Provider.Plain)\n\t\t\t\t\t{\n\t\t\t\t\t\thiddenButtons.push('floorRequest');\n\t\t\t\t\t\thiddenButtons.push('hangupOptions');\n\t\t\t\t\t\thiddenButtons.push('callconrol');\n\t\t\t\t\t}\n\t\t\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t\t\t{\n\t\t\t\t\t\thiddenButtons.push('document');\n\t\t\t\t\t}\n\t\t\t\t\tHardware.isCameraOn = mediaParams.video && Hardware.hasCamera();\n\t\t\t\t\tthis.callView = new View({\n\t\t\t\t\t\tcontainer: this.container,\n\t\t\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\t\t\tusers: this.currentCall.users,\n\t\t\t\t\t\tuserStates: this.currentCall.getUsers(),\n\t\t\t\t\t\tshowChatButtons: true,\n\t\t\t\t\t\tshowUsersButton: false,\n\t\t\t\t\t\tshowRecordButton: true,\n\t\t\t\t\t\tuserLimit: Util.getUserLimit(),\n\t\t\t\t\t\tlayout: isGroupCall ? View.Layout.Grid : View.Layout.Centered,\n\t\t\t\t\t\tmicrophoneId: Hardware.defaultMicrophone,\n\t\t\t\t\t\tblockedButtons: this.getBlockedButtons(this.currentCall.provider === Provider.Plain),\n\t\t\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\t\t\tlanguage: this.language,\n\t\t\t\t\t\tshowAddUserButtonInList: this.currentCall.provider === Provider.Plain,\n\t\t\t\t\t\tisCloudRecordFeaturesEnabled: this.currentCall.isCloudRecordFeaturesEnabled,\n\t\t\t\t\t\tisCopilotFeaturesEnabled: this.currentCall.isCopilotFeaturesEnabled,\n\t\t\t\t\t\tisCopilotActive: this.currentCall.isCopilotActive,\n\t\t\t\t\t\tisWindowFocus: this.isWindowFocus,});\n\t\t\t\t\tthis.autoCloseCallView = true;\n\t\t\t\t\tif (this.callWithLegacyMobile)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.blockAddUser();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.bindCallViewEvents();\n\n\t\t\t\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, this.getCallUsers(true));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (Reflection.getClass('BX.Messenger.v2.Lib.CallManager'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst currentUser = BX.Messenger.v2.Lib.CallManager.getInstance().getCurrentUser();\n\t\t\t\t\t\t\tthis.callView.updateUserData({ [this.userId]: currentUser });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!isGroupCall)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst { id, name, avatar } = this.currentCall.associatedEntity;\n\t\t\t\t\t\t\tconst user = { name, avatar_hr: avatar };\n\t\t\t\t\t\t\tthis.callView.updateUserData({ [id]: user });\n\t\t\t\t\t\t\tthis.callView.addUser(id, UserState.Connected);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.callView.show();\n\t\t\t\t\tthis.showDocumentPromo();\n\t\t\t\t\tthis.showMaskPromo();\n\t\t\t\t\tthis.showCopilotNotify();\n\t\t\t\t\tthis.#showCloudRecordPromo();\n\t\t\t\t\tthis.checkVpnStatus();\n\n\t\t\t\t\tthis.currentCall.useHdVideo(Hardware.preferHdQuality);\n\t\t\t\t\tif (Hardware.defaultMicrophone)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t\t\t\t}\n\t\t\t\t\tif (Hardware.defaultCamera)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t\t\t\t}\n\n\t\t\t\t\tHardware.isMicrophoneMuted = !mediaParams.audio;\n\n\t\t\t\t\tthis.currentCall.answer({\n\t\t\t\t\t\tenableMicAutoParameters: Hardware.enableMicAutoParameters\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.createVideoStrategy();\n\n\t\t\t\t\tthis._onUpdateLastUsedCameraId();\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tlet errorCode = 'UNKNOWN_ERROR';\n\t\t\t\t\tif (Type.isString(error))\n\t\t\t\t\t{\n\t\t\t\t\t\terrorCode = error;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isObject(error) && error instanceof JoinResponseError)\n\t\t\t\t\t{\n\t\t\t\t\t\terrorCode = error.name;\n\t\t\t\t\t}\n\t\t\t\t\telse if (Type.isObject(error) && error.code)\n\t\t\t\t\t{\n\t\t\t\t\t\terrorCode = error.code === 'access_denied' ? 'ACCESS_DENIED' : error.code;\n\t\t\t\t\t}\n\n\t\t\t\t\tAnalytics.getInstance().onJoinCallError({\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\terrorCode,\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\terrorMessage: error?.message,\n\t\t\t\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t});\n\t}\n\n\t_onCallConferenceNotificationButtonClick(e)\n\t{\n\t\tclearTimeout(this.hideIncomingCallTimeout);\n\t\tthis.callNotification.close();\n\t\tswitch (e.button)\n\t\t{\n\t\t\tcase \"answerConference\":\n\t\t\t\tif (this.currentCall && 'id' in this.currentCall.associatedEntity)\n\t\t\t\t{\n\t\t\t\t\tAnalytics.getInstance().onAnswerConference({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(this._getCallIdentifier(this.currentCall));\n\t\t\t\t\tlet dialogId = this.currentCall.associatedEntity.id.toString();\n\t\t\t\t\tif (dialogId.startsWith('chat'))\n\t\t\t\t\t{\n\t\t\t\t\t\tdialogId = dialogId.substring(4);\n\t\t\t\t\t}\n\t\t\t\t\tthis.emit(Events.onOpenVideoConference, {dialogId: dialogId});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"skipConference\":\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tAnalytics.getInstance().onDeclineConference({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.answeredOrDeclinedCalls.add(this._getCallIdentifier(this.currentCall));\n\t\t\t\t\tthis.removeVideoStrategy();\n\t\t\t\t\tthis.removeCallEvents();\n\t\t\t\t\tthis.currentCall.decline();\n\t\t\t\t\tthis.currentCall = null;\n\t\t\t\t\tif (this.promotedToAdminTimeout)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_onCallViewShow()\n\t{\n\t\tZIndexManager.getStack(document.body).bringToFront(this.container);\n\n\t\tif (Number.isNaN(parseInt(this.messengerFacade.getMessageCount(), 10)))\n\t\t{\n\t\t\tUtil.sendLog(`[call] setButtonCounter chat: this.messengerFacade.getMessageCount() = ${this.messengerFacade.getMessageCount()} (NaN)`);\n\t\t}\n\t\tthis.callView.setButtonCounter(\"chat\", this.messengerFacade.getMessageCount());\n\t\tthis.callViewState = ViewState.Opened;\n\t}\n\n\t_onCallViewClose()\n\t{\n\t\tthis.callView.destroy();\n\t\tthis.callViewState = ViewState.Closed;\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.documentsMenu)\n\t\t{\n\t\t\tthis.documentsMenu.close();\n\t\t}\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow(DesktopApi.findWindow('callBackground'));\n\t\t}\n\t\tthis.closePromo();\n\n\t\tif (this.mediaDevicesResetStateHintBaloon)\n\t\t{\n\t\t\tthis.mediaDevicesResetStateHintBaloon.close();\n\t\t\tthis.mediaDevicesResetStateHintBaloon = null;\n\t\t}\n\t\tthis._closeReconnectionBaloon();\n\t\tthis._closeParticipantsVideoBaloon();\n\n\t\tif (this.copilotPopup)\n\t\t{\n\t\t\tthis.copilotPopup.close();\n\t\t}\n\n\t\tif (this.riseYouHandToTalkPopup)\n\t\t{\n\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t}\n\t}\n\n\t_onCallViewDestroy()\n\t{\n\t\tthis.callView = null;\n\t\tthis.folded = false;\n\t\tthis.autoCloseCallView = true;\n\t\tif (this.sidebar)\n\t\t{\n\t\t\tBX.adjust(this.container, {\n\t\t\t\tstyle: {\n\t\t\t\t\tbackgroundColor: \"rgba(0, 0, 0, 0.5)\",\n\t\t\t\t\tbackdropFilter: \"blur(5px)\"\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.removeContainer();\n\t\t\tthis.maxEditorWidth = DOC_TEMPLATE_WIDTH;\n\t\t}\n\t}\n\n\t_onCallViewBodyClick()\n\t{\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.unfold();\n\t\t}\n\t}\n\n\t#onPiPViewBodyClick()\n\t{\n\t\tthis.togglePictureInPictureCallWindow({ isForceClose: false });\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.unfold();\n\t\t}\n\t}\n\n\t_onPipClose()\n\t{\n\t\tconst isViewHidden = this.callView.viewVisibility.getCurrentVisibility() === View.DocumentVisibilityState.hidden;\n\t\tif (this.folded && isViewHidden)\n\t\t{\n\t\t\tthis.unfold({ fromPiP: true });\n\t\t}\n\t}\n\n\t_onCallViewButtonClick(e)\n\t{\n\t\tconst buttonName = e.buttonName;\n\n\t\tconst handlers = {\n\t\t\thangup: this._onCallViewHangupButtonClick.bind(this),\n\t\t\thangupOptions: this._onCallViewHangupOptionsButtonClick.bind(this),\n\t\t\tclose: this._onCallViewCloseButtonClick.bind(this),\n\t\t\ttoggleUsers: this._onCallViewUsersListButtonClick.bind(this),\n\t\t\tinviteUser: this._onCallViewInviteUserButtonClick.bind(this),\n\t\t\ttoggleMute: this._onCallViewToggleMuteButtonClick.bind(this),\n\t\t\ttoggleScreenSharing: this._onCallViewToggleScreenSharingButtonClick.bind(this),\n\t\t\trecord: this.#onCallViewRecordButtonClick.bind(this),\n\t\t\ttoggleVideo: this._onCallViewToggleVideoButtonClick.bind(this),\n\t\t\ttoggleSpeaker: this._onCallViewToggleSpeakerButtonClick.bind(this),\n\t\t\tshowChat: this._onCallViewShowChatButtonClick.bind(this),\n\t\t\tfloorRequest: this._onCallViewFloorRequestButtonClick.bind(this),\n\t\t\tshowHistory: this._onCallViewShowHistoryButtonClick.bind(this),\n\t\t\tfullscreen: this._onCallViewFullScreenButtonClick.bind(this),\n\t\t\tdocument: this._onCallViewDocumentButtonClick.bind(this),\n\t\t\tmicrophoneSideIcon: this._onCallViewMicrophoneSideIconClick.bind(this),\n\t\t\tfeedback: this._onCallViewFeedbackButtonClick.bind(this),\n\t\t\tcallcontrol: this._onCallcontrolButtonClick.bind(this),\n\t\t\tcopilot: this._onCallViewCopilotButtonClick.bind(this),\n\t\t};\n\n\t\tif (Type.isFunction(handlers[buttonName]))\n\t\t{\n\t\t\thandlers[buttonName].call(this, e);\n\t\t}\n\t}\n\n\t_onCallViewHangupButtonClick()\n\t{\n\t\tAnalytics.getInstance().onDisconnectCall({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\tsubSection: Analytics.AnalyticsSubSection.finishButton,\n\t\t\tmediaParams: {\n\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t},\n\t\t});\n\n\t\tthis.leaveCurrentCall();\n\t}\n\n\t_onCallViewHangupOptionsButtonClick()\n\t{\n\t\tif (this.hangupOptionsMenu)\n\t\t{\n\t\t\tthis.hangupOptionsMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tconst targetNodeWidth = this.callView.buttons.hangupOptions.elements.root.offsetWidth;\n\n\t\tlet menuItems = [\n\t\t\t{\n\t\t\t\ttext: BX.message(\"CALL_M_BTN_HANGUP_OPTION_FINISH\"),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tAnalytics.getInstance().onFinishCall({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tstatus: Analytics.AnalyticsStatus.finishedForAll,\n\t\t\t\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t\t\t\t\tcallUsersCount: this.getMaxActiveCallUsers().length,\n\t\t\t\t\t\tcallLength: Util.getTimeInSeconds(this.currentCall.startDate),\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.isCallHangupButtonPressed = true;\n\n\t\t\t\t\tthis.hangupOptionsMenu?.destroy();\n\n\t\t\t\t\tthis.leaveCurrentCall(false, true);\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message(\"CALL_M_BTN_HANGUP_OPTION_LEAVE\"),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tAnalytics.getInstance().onDisconnectCall({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\tsubSection: Analytics.AnalyticsSubSection.contextMenu,\n\t\t\t\t\t\tmediaParams: {\n\t\t\t\t\t\t\tvideo: Hardware.isCameraOn,\n\t\t\t\t\t\t\taudio: !Hardware.isMicrophoneMuted,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.hangupOptionsMenu?.destroy();\n\n\t\t\t\t\tthis.leaveCurrentCall();\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\tthis.hangupOptionsMenu = new BX.PopupMenuWindow({\n\t\t\tclassName: 'bx-messenger-videocall-hangup-options-container',\n\t\t\tbackground: '#00428F',\n\t\t\tcontentBackground: '#00428F',\n\t\t\tdarkMode: true,\n\t\t\tcontentBorderRadius: '6px',\n\t\t\tborderRadius: '6px',\n\t\t\tangle: false,\n\t\t\tbindElement: this.callView.buttons.hangupOptions.elements.root,\n\t\t\ttargetContainer: this.container,\n\t\t\toffsetTop: -15,\n\t\t\tbindOptions: {position: \"top\"},\n\t\t\tcacheable: false,\n\t\t\tsubMenuOptions: {\n\t\t\t\tmaxWidth: 450\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonShow: (event) =>\n\t\t\t\t{\n\t\t\t\t\tconst popup = event.getTarget();\n\t\t\t\t\tpopup.getPopupContainer().style.display = 'block'; // bad hack\n\n\t\t\t\t\tconst offsetLeft = (targetNodeWidth / 2) - popup.getPopupContainer().offsetWidth / 2;\n\t\t\t\t\tpopup.setOffset({offsetLeft: offsetLeft + 40, offsetTop: 0});\n\t\t\t\t\tpopup.setAngle({offset: popup.getPopupContainer().offsetWidth / 2 - 17});\n\t\t\t\t},\n\t\t\t\tonDestroy: () => this.hangupOptionsMenu = null\n\t\t\t},\n\t\t\titems: menuItems,\n\t\t});\n\n\t\tthis.hangupOptionsMenu.show();\n\t}\n\n\t_onCallViewCloseButtonClick()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\t}\n\n\t_onCallViewShowChatButtonClick()\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tAnalytics.getInstance().onShowChat({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\tthis.showChat();\n\t}\n\n\t_onCallViewFloorRequestButtonClick()\n\t{\n\t\tAnalytics.getInstance().onFloorRequest({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tconst floorState = this.callView.getUserFloorRequestState(CallEngine.getCurrentUserId());\n\t\tconst talkingState = this.callView.getUserTalking(CallEngine.getCurrentUserId());\n\t\tthis.callView.setUserFloorRequestState(CallEngine.getCurrentUserId(), !floorState);\n\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.requestFloor(!floorState);\n\t\t}\n\n\t\tclearTimeout(this.callViewFloorRequestTimeout);\n\t\tif (talkingState && !floorState)\n\t\t{\n\t\t\tthis.callViewFloorRequestTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall)\n\t\t\t\t{\n\t\t\t\t\tthis.currentCall.requestFloor(false);\n\t\t\t\t}\n\t\t\t}, 1500);\n\t\t}\n\n\t\tif (this.riseYouHandToTalkPopup && !floorState)\n\t\t{\n\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t}\n\t}\n\n\t_onCallViewTurnOffAllParticipansStreamButtonClick(options)\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.turnOffAllParticipansStream(options);\n\t\t}\n\t}\n\n\t/**\n\t * Returns list of users, that are not currently connected\n\t * @return {Array}\n\t * @private\n\t */\n\t_getDisconnectedUsers()\n\t{\n\t\tconst result = [];\n\t\tconst userStates = this.currentCall.getUsers();\n\n\t\tfor (let userId in userStates)\n\t\t{\n\t\t\tif (userStates[userId] !== UserState.Connected)\n\t\t\t{\n\t\t\t\tconst userData = Util.getUserCached(userId)\n\t\t\t\tif (userData)\n\t\t\t\t{\n\t\t\t\t\tresult.push(userData);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t_closeReconnectionBaloon()\n\t{\n\t\tif (this.reconnectionBaloon)\n\t\t{\n\t\t\tthis.reconnectionBaloon.close();\n\t\t\tthis.reconnectionBaloon = null;\n\t\t}\n\t}\n\n\t_onCallViewUsersListButtonClick(e)\n\t{\n\n\t}\n\n\t_onCallcontrolButtonClick(e)\n\t{\n\t\tif (!Util.canControlChangeSettings())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.close();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.participantsPermissionPopup = new ParticipantsPermissionPopup({\n\t\t\tturnOffAllParticipansStream: (options) => {\n\t\t\t\tthis._onCallViewTurnOffAllParticipansStreamButtonClick(options);\n\n\t\t\t\tAnalytics.getInstance().onTurnOffAllParticipansStream({\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\ttypeOfStream: options.data?.typeOfStream,\n\t\t\t\t});\n\t\t\t},\n\t\t\tonPermissionChanged: (options) => {\n\t\t\t\tthis.currentCall.changeSettings(options);\n\n\t\t\t\tif (!options.settingEnabled) // send only when it turned off\n\t\t\t\t{\n\t\t\t\t\tAnalytics.getInstance().onCallSettingsChanged({\n\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\ttypeOfSetting: options.typeOfSetting,\n\t\t\t\t\t\tsettingEnabled: options.settingEnabled,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\tonClose: () => {\n\t\t\t\tthis.participantsPermissionPopup = null;\n\t\t\t\tthis._afterCloseParticipantsPermissionPopup();\n\t\t\t},\n\t\t\tonOpen: () => {\n\t\t\t\tthis._afterOpenParticipantsPermissionPopup();\n\n\t\t\t\tAnalytics.getInstance().onOpenCallSettings({\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.toggle();\n\t\t}\n\t}\n\n\t_onCallViewInviteUserButtonClick(e)\n\t{\n\t\tif (!this.messengerFacade.showUserSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userStates = this.currentCall ? this.currentCall.getUsers() : {};\n\t\tconst idleUsers = this.currentCall ? this._getDisconnectedUsers() : [];\n\n\t\tthis.messengerFacade.showUserSelector({\n\t\t\tviewElement: this.callView.container,\n\t\t\tbindElement: e.node,\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tdarkMode: this.messengerFacade.isThemeDark(),\n\t\t\tidleUsers: idleUsers,\n\t\t\tallowNewUsers: Object.keys(userStates).length < Util.getUserLimit() - 1,\n\t\t\tonDestroy: this._onInvitePopupDestroy.bind(this),\n\t\t\tonSelect: this._onInvitePopupSelect.bind(this)\n\t\t}).then((inviteCloser) => {\n\t\t\tthis.invitePopup = inviteCloser;\n\t\t\tthis.callView.setHotKeyTemporaryBlock(true);\n\t\t});\n\t}\n\n\t_onCallViewToggleMuteHandler(e)\n\t{\n\t\tif (!e.muted && !Hardware?.hasMicrophone())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentRoom = this.currentCall?.currentRoom?.();\n\t\tif (currentRoom && currentRoom.speaker != this.userId && !e.muted)\n\t\t{\n\t\t\tthis.currentCall.requestRoomSpeaker();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall && !this.currentCall.microphoneId && !e.muted)\n\t\t{\n\t\t\tthis.currentCall.setMicrophoneId(Hardware.defaultMicrophone);\n\t\t}\n\n\t\tHardware.setIsMicrophoneMuted({isMicrophoneMuted: e.muted, calledProgrammatically: !!e.calledProgrammatically});\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setAudioMuted(e.muted);\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\t\tif (!e.muted)\n\t\t{\n\t\t\tif (!Util.havePermissionToBroadcast('mic'))\n\t\t\t{\n\t\t\t\tthis.showRiseYouHandToTalkNotification({initiatorName: this.lastCalledChangeSettingsUserName});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.allowMutePopup = true;\n\t\t\t}\n\t\t}\n\t\tif (this.currentCall && this.#isCommonRecordStarted() && this.#canLocalRecord())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordMute(e.muted);\n\t\t}\n\t}\n\n\t_onCallViewToggleMuteButtonClick(e)\n\t{\n\t\tAnalytics.getInstance().onToggleMicrophone({\n\t\t\tmuted: e.muted,\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tthis._onCallViewToggleMuteHandler(e);\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t * @param { Object } event\n\t * @param { string } event.state\n\t * @param { string } event.kind\n\t * @param { boolean } event.hotkey\n\t */\n\t#onCommonRecordMenu({ state, kind, hotkey })\n\t{\n\t\t// Recording state (Started, Paused, Stopped, etc.)\n\t\tswitch (state)\n\t\t{\n\t\t\tcase CallCommonRecordState.Started:\n\t\t\t{\n\t\t\t\t// If forced recording  start immediately\n\t\t\t\tif (hotkey)\n\t\t\t\t{\n\t\t\t\t\tthis.#startCommonRecord(CallCommonRecordType.Video);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (kind === CallCommonRecordType.Audio)\n\t\t\t\t{\n\t\t\t\t\t// If copilot is active  ask if recording is needed\n\t\t\t\t\tif (this.currentCall && this.currentCall.isCopilotActive)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView\n\t\t\t\t\t\t\t.showConfirmModal({\n\t\t\t\t\t\t\t\ttitle: Loc.getMessage('CALL_RECORD_AUDIO_WITH_COPILOT_TITLE'),\n\t\t\t\t\t\t\t\tmessage: Loc.getMessage('CALL_RECORD_AUDIO_WITH_COPILOT_MESSAGE'),\n\t\t\t\t\t\t\t\tyesButtonText: Loc.getMessage('CALL_RECORD_AUDIO_WITH_COPILOT_YES_BUTTON'),\n\t\t\t\t\t\t\t\tnoButtonText: Loc.getMessage('CALL_RECORD_AUDIO_WITH_COPILOT_NO_BUTTON'),\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.then((choice) => {\n\t\t\t\t\t\t\t\tif (choice === 'no')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.#startCommonRecord(CallCommonRecordType.Audio);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch((error) => console.error('Unspecified error in callView.showConfirmModal:', error));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// Else start audio recording immediately\n\t\t\t\t\tthis.#startCommonRecord(CallCommonRecordType.Audio);\n\t\t\t\t}\n\n\t\t\t\t// Start video recording\n\t\t\t\tif (kind === CallCommonRecordType.Video)\n\t\t\t\t{\n\t\t\t\t\tthis.#startCommonRecord(CallCommonRecordType.Video);\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcase CallCommonRecordState.Paused:\n\t\t\tcase CallCommonRecordState.Resumed:\n\t\t\t{\n\t\t\t\t// For cloud recording  change recorder state\n\t\t\t\tif (this.#canCloudRecord())\n\t\t\t\t{\n\t\t\t\t\tconst status = (state === CallCommonRecordState.Paused ? CloudRecordStatus.PAUSED : CloudRecordStatus.STARTED);\n\t\t\t\t\tthis.currentCall.setCloudRecordState(status);\n\t\t\t\t\tthis.commonRecord.state = state;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// For desktop  pause / resume recording\n\t\t\t\tif (this.#canLocalRecord())\n\t\t\t\t{\n\t\t\t\t\tBXDesktopSystem.CallRecordPause(state === CallCommonRecordState.Paused);\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase CallCommonRecordState.Stopped:\n\t\t\t{\n\t\t\t\t// For cloud recording  block button and stop recording\n\t\t\t\tif (this.#canCloudRecord())\n\t\t\t\t{\n\t\t\t\t\tthis.callView.blockButtons(['record']);\n\t\t\t\t\tthis.currentCall.setCloudRecordState(CloudRecordStatus.STOPPED);\n\t\t\t\t\tthis.commonRecord.state = CallCommonRecordState.Stopped;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// For desktop  just deactivate the recording button\n\t\t\t\tthis.callView.setButtonActive('record', false);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase CallCommonRecordState.Destroyed:\n\t\t\t{\n\t\t\t\t// For cloud recording  confirm recording deletion\n\t\t\t\tif (this.#canCloudRecord())\n\t\t\t\t{\n\t\t\t\t\tthis.callView\n\t\t\t\t\t\t.showConfirmModal({\n\t\t\t\t\t\t\ttitle: Loc.getMessage('CALL_CLOUD_RECORD_DESTROY_TITLE'),\n\t\t\t\t\t\t\tmessage: Loc.getMessage('CALL_CLOUD_RECORD_DESTROY_MESSAGE'),\n\t\t\t\t\t\t\tyesButtonText: Loc.getMessage('CALL_CLOUD_RECORD_DESTROY_RESUME_BUTTON'),\n\t\t\t\t\t\t\tnoButtonText: Loc.getMessage('CALL_CLOUD_RECORD_DESTROY_DELETE_BUTTON'),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then((choice) => {\n\t\t\t\t\t\t\tif (choice === 'no')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.callView.blockButtons(['record']);\n\t\t\t\t\t\t\t\tthis.currentCall.setCloudRecordState(CloudRecordStatus.DESTROYED);\n\t\t\t\t\t\t\t\tthis.commonRecord.state = CallCommonRecordState.Destroyed;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => console.error('Unspecified error in callView.showConfirmModal:', error));\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t{\n\t\t\t\tconsole.error('Unknown recording state', state);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// Send current recording state\n\t\tthis.currentCall.sendLocalRecordState({\n\t\t\taction: state,\n\t\t\ttype: this.commonRecord.type,\n\t\t\tdate: new Date(),\n\t\t});\n\n\t\t// Save current recording state locally\n\t\tthis.commonRecord.state = state;\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t */\n\t#onCallViewRecordButtonClick()\n\t{\n\t\tif (Util.isCommonRecordStateInactive(this.commonRecord.state))\n\t\t{\n\t\t\tAnalytics.getInstance().onRecordBtnClick({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t});\n\t\t}\n\n\t\tif (CallCloudRecord.serviceEnabled)\n\t\t{\n\t\t\tif (!CallCloudRecord.tariffAvailable)\n\t\t\t{\n\t\t\t\tUtil.openArticle(CallCloudRecord.tariffSlider);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst isLegacyCall = this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme);\n\t\t\tconst isCloudRecordFeaturesEnabled = this.currentCall.isCloudRecordFeaturesEnabled && !isLegacyCall;\n\n\t\t\tif (!isCloudRecordFeaturesEnabled && !DesktopApi.isDesktop())\n\t\t\t{\n\t\t\t\tthis.callView.showCloudRecordInfoPopup(this.currentCall.isCloudRecordFeaturesEnabled, this.currentCall.id);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.callView.showCommonRecordMenuPopup(isCloudRecordFeaturesEnabled && DesktopApi.isDesktop());\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#canCommonRecord())\n\t\t{\n\t\t\tif (window.BX.Helper)\n\t\t\t{\n\t\t\t\twindow.BX.Helper.show('redirect=detail&code=22079566');\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.showCommonRecordMenuPopup(true);\n\t}\n\n\t_onChangeStateCopilot()\n\t{\n\t\tif (this.currentCall.isCopilotActive)\n\t\t{\n\t\t\tAnalytics.getInstance().copilot.onClickAIOff({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t});\n\n\t\t\tthis.callView\n\t\t\t\t.showConfirmModal({\n\t\t\t\t\ttitle: Loc.getMessage('CALL_AI_RECORD_STOP_TITLE'),\n\t\t\t\t\tmessage: Loc.getMessage('CALL_AI_RECORD_STOP_MESSAGE'),\n\t\t\t\t\tyesButtonText: Loc.getMessage('CALL_AI_RECORD_STOP_YES_BUTTON'),\n\t\t\t\t\tnoButtonText: Loc.getMessage('CALL_AI_RECORD_STOP_NO_BUTTON'),\n\t\t\t\t})\n\t\t\t\t.then((choice) => {\n\t\t\t\t\tif (choice === 'yes')\n\t\t\t\t\t{\n\t\t\t\t\t\tAnalytics.getInstance().copilot.onSelectAIOff({\n\t\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.#onChangeStateCopilotAction(RecorderStatus.PAUSED);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (choice === 'no')\n\t\t\t\t\t{\n\t\t\t\t\t\tAnalytics.getInstance().copilot.onSelectAIDelete({\n\t\t\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.#onChangeStateCopilotAction(RecorderStatus.DESTROYED);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => console.error('Unspecified error in callView.showConfirmModal:', error));\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#onChangeStateCopilotAction(RecorderStatus.ENABLED);\n\t}\n\n\t#onChangeStateCopilotAction(state)\n\t{\n\t\tlet url = '';\n\t\tswitch (state)\n\t\t{\n\t\t\tcase RecorderStatus.ENABLED:\n\t\t\t\turl = 'call.Track.start';\n\t\t\t\tbreak;\n\n\t\t\tcase RecorderStatus.PAUSED:\n\t\t\t\turl = 'call.Track.stop';\n\t\t\t\tbreak;\n\n\t\t\tcase RecorderStatus.DESTROYED:\n\t\t\t\turl = 'call.Track.destroy';\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t}\n\n\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t{\n\t\t\tBX.ajax.runAction(url, {\n\t\t\t\tdata: { callId: this.currentCall.id, callUuid: this.currentCall.uuid },\n\t\t\t}).then(() => {\n\t\t\t\tconst newCopilotState = !this.currentCall.isCopilotActive;\n\t\t\t\tthis.#onUpdateCallCopilotState(newCopilotState);\n\n\t\t\t\tAnalytics.getInstance().copilot.onAIRecordStatusChanged({\n\t\t\t\t\tisAIOn: newCopilotState,\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t});\n\n\t\t\t\tif (newCopilotState)\n\t\t\t\t{\n\t\t\t\t\tthis.sendStartCopilotRecordAnalytics({ isAutostart: false });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.showCopilotResultNotify();\n\t\t\t\t}\n\t\t\t}).catch((error) => {\n\t\t\t\tconst errorCode = error.errors[0].code;\n\t\t\t\tCallAI.handleCopilotError(errorCode);\n\n\t\t\t\tif (this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.showCopilotErrorNotify(errorCode);\n\t\t\t\t}\n\n\t\t\t\tconst newCopilotState = !this.currentCall.isCopilotActive;\n\n\t\t\t\tAnalytics.getInstance().copilot.onAIRecordStatusChanged({\n\t\t\t\t\tisAIOn: newCopilotState,\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\terror: errorCode,\n\t\t\t\t});\n\t\t\t\tthis.sendStartCopilotRecordAnalytics({ errorCode, isAutostart: false });\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst newCopilotState = !this.currentCall.isCopilotActive;\n\t\t\tthis.#onUpdateCallCopilotState(newCopilotState);\n\t\t\tthis.currentCall.setRecorderState(state);\n\n\t\t\tBX.ajax.runAction(url, {\n\t\t\t\tdata: { callId: this.currentCall.id, callUuid: this.currentCall.uuid },\n\t\t\t});\n\n\t\t\tif (newCopilotState)\n\t\t\t{\n\t\t\t\tthis.sendStartCopilotRecordAnalytics({ isAutostart: false });\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showCopilotResultNotify();\n\t\t\t}\n\t\t}\n\t}\n\n\t_onCallViewCopilotButtonClick()\n\t{\n\t\tif (this.copilotPopup)\n\t\t{\n\t\t\tthis.copilotPopup.close();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst isPlainCall = this.currentCall.provider === Provider.Plain;\n\t\tconst isBitrixCall = this.currentCall.provider === Provider.Bitrix;\n\t\tconst isCopilotFeaturesEnabled = (isPlainCall && this.currentCall.isCopilotFeaturesEnabled) || isBitrixCall;\n\n\t\tif (isCopilotFeaturesEnabled && CallAI.settingsEnabled && !CallAI.tariffAvailable)\n\t\t{\n\t\t\tUtil.openArticle(CallAI.helpSlider);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.copilotPopup = new CopilotPopup({\n\t\t\tisCopilotActive: this.currentCall.isCopilotActive,\n\t\t\tisCopilotFeaturesEnabled: this.currentCall.isCopilotFeaturesEnabled,\n\t\t\tcallId: this.currentCall.id,\n\t\t\tupdateCopilotState: () => {\n\t\t\t\tthis._onChangeStateCopilot();\n\t\t\t},\n\t\t\tonClose: () => {\n\t\t\t\tthis.copilotPopup = null;\n\t\t\t},\n\t\t});\n\n\t\tif (this.copilotPopup)\n\t\t{\n\t\t\tthis.callView.closeCopilotNotify();\n\t\t\tthis.copilotPopup.toggle();\n\t\t}\n\t}\n\n\t#onUpdateCallCopilotState(state)\n\t{\n\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t{\n\t\t\tthis.currentCall.isCopilotActive = state;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.updateCopilotState(state);\n\t\t}\n\t}\n\n\t#onSwitchTrackRecordStatus({ isTrackRecordOn, errorCode })\n\t{\n\t\tthis.#onUpdateCallCopilotState(isTrackRecordOn);\n\n\t\tif (errorCode)\n\t\t{\n\t\t\tthis.showCopilotNotify(true, errorCode);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (isTrackRecordOn)\n\t\t{\n\t\t\tthis.showCopilotNotify();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.closeCopilotNotify();\n\t\t\tthis.showCopilotResultNotify();\n\t\t}\n\t}\n\n\t/**\n\t * @param {Object} status\n\t * @param {RecorderStatus} status.code\n\t * @param {string} status.error\n\t * @param {boolean} status.isCopilotActive\n\t */\n\t#onRecorderStatusChanged({ code, error, isCopilotActive })\n\t{\n\t\tthis.#onUpdateCallCopilotState(isCopilotActive);\n\n\t\tif (!CallAI.tariffAvailable)\n\t\t{\n\t\t\tthis.callView.unblockButtons(['copilot']);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.isCopilotInitialized)\n\t\t{\n\t\t\tif (!this.currentCall.initiatorId && isCopilotActive)\n\t\t\t{\n\t\t\t\tthis.sendStartCopilotRecordAnalytics({ isAutostart: true });\n\t\t\t}\n\t\t\tthis.callView.unblockButtons(['copilot']);\n\t\t}\n\n\t\tif (error)\n\t\t{\n\t\t\tCallAI.handleCopilotError(error);\n\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tconst errorType = isCopilotActive\n\t\t\t\t\t? CopilotNotifyType.DISABLE_AI_INTERNAL_ERROR\n\t\t\t\t\t: CopilotNotifyType.ENABLE_AI_INTERNAL_ERROR;\n\t\t\t\tthis.callView.showCopilotErrorNotify(errorType);\n\t\t\t}\n\t\t\tthis.sendStartCopilotRecordAnalytics({ error, isAutostart: false });\n\t\t}\n\n\t\tif (code === RecorderStatus.DISABLED)\n\t\t{\n\t\t\tthis.showCopilotResultNotify();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (![RecorderStatus.PAUSED, RecorderStatus.DESTROYED].includes(code))\n\t\t{\n\t\t\tthis.showCopilotNotify();\n\t\t}\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t * @param { Object } event\n\t * @param { number } event.code\n\t * @param { number } event.initiatorId\n\t * @param { number } event.userId\n\t * @param { boolean } event.justJoined\n\t * @param { Object } event.commonRecordState\n\t * @private\n\t */\n\t#onCloudRecordStatusChanged(event)\n\t{\n\t\tif (this.userId === event.userId)\n\t\t{\n\t\t\tconst state = event.commonRecordState.state;\n\t\t\tconst callId = this._getCallIdentifier(this.currentCall);\n\t\t\tconst callType = this.getCallType();\n\n\t\t\tswitch (state)\n\t\t\t{\n\t\t\t\tcase CallCommonRecordState.Started: {\n\t\t\t\t\tif (this.commonRecord.state === CallCommonRecordState.Resumed)\n\t\t\t\t\t{\n\t\t\t\t\t\tAnalytics.getInstance().onRecordResumed({\n\t\t\t\t\t\t\tcallId,\n\t\t\t\t\t\t\tcallType,\n\t\t\t\t\t\t\terrorCode: null,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tAnalytics.getInstance().onRecordStart({\n\t\t\t\t\t\t\tcallId,\n\t\t\t\t\t\t\tcallType,\n\t\t\t\t\t\t\trecordType: event.commonRecordState.type,\n\t\t\t\t\t\t\terrorCode: null,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase CallCommonRecordState.Paused: {\n\t\t\t\t\tAnalytics.getInstance().onRecordPaused({\n\t\t\t\t\t\tcallId,\n\t\t\t\t\t\tcallType,\n\t\t\t\t\t\terrorCode: null,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase CallCommonRecordState.Stopped: {\n\t\t\t\t\tAnalytics.getInstance().onRecordStop({\n\t\t\t\t\t\tcallId,\n\t\t\t\t\t\tcallType,\n\t\t\t\t\t\tsubSection: Analytics.AnalyticsSubSection.window,\n\t\t\t\t\t\telement: Analytics.AnalyticsElement.recordButton,\n\t\t\t\t\t\trecordTime: Util.getRecordTimeText(this.commonRecord.info, true),\n\t\t\t\t\t});\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tcase CallCommonRecordState.Destroyed: {\n\t\t\t\t\tAnalytics.getInstance().onRecordDelete({\n\t\t\t\t\t\tcallId,\n\t\t\t\t\t\tcallType,\n\t\t\t\t\t\terrorCode: null,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tdefault: {\n\t\t\t\t\tif (Util.isCloudRecordLogEnabled())\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(`Unknown record state: ${status}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (event.userId && event.userId !== this.userId)\n\t\t{\n\t\t\tif (event.justJoined)\n\t\t\t{\n\t\t\t\tif (event.commonRecordState.state === CallCommonRecordState.Started)\n\t\t\t\t{\n\t\t\t\t\tif (CallCloudRecord.isCisRegion)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.showCommonRecordStartNotify(event.userId, CallCommonRecordState.Started);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.showCommonRecordStartModal();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.showCommonRecordStartNotify(event.userId, event.commonRecordState.state);\n\t\t\t}\n\t\t}\n\n\t\tthis.commonRecord.state = event.commonRecordState.state;\n\t\tthis.callView.setCommonRecordState(event.commonRecordState);\n\t\tthis.commonRecord.initiatorId = event.initiatorId;\n\n\t\tif (Util.isCommonRecordStateInactive(event.commonRecordState.state))\n\t\t{\n\t\t\tthis.commonRecord.info = null;\n\t\t\tthis.commonRecord.initiatorId = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.commonRecord.info = structuredClone(event.commonRecordState);\n\t\t}\n\n\t\tthis.callView.unblockButtons(['record']);\n\t\tthis.callView.setButtonActive('record', [CloudRecordStatus.STARTED, CloudRecordStatus.PAUSED].includes(event.code));\n\t}\n\n\tshowCopilotNotify(force = false, errorCode = '')\n\t{\n\t\tif (\n\t\t\t(this.currentCall.isCopilotActive || force)\n\t\t\t&& this.currentCall.provider !== Provider.Plain\n\t\t\t&& this.callView\n\t\t)\n\t\t{\n\t\t\tthis.callView.showCopilotNotify(this._getCallIdentifier(this.currentCall), errorCode)\n\t\t}\n\t}\n\n\tshowCopilotResultNotify()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.showCopilotResultNotify();\n\t\t}\n\t}\n\n\tcloseCopilotNotify()\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.closeCopilotNotify();\n\t\t}\n\t}\n\n\tsendStartCopilotRecordAnalytics({ errorCode = null, isAutostart })\n\t{\n\t\tconst params = {\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\terrorCode: errorCode,\n\t\t\tchatUserCount: this.currentCall?.associatedEntity.userCounter,\n\t\t\tisAutostart,\n\t\t};\n\n\t\tconst userCount = this.getActiveCallUsers().length;\n\t\tif (userCount)\n\t\t{\n\t\t\tparams.userCount = userCount + 1;\n\t\t}\n\t\tAnalytics.getInstance().copilot.onAIRecordStart(params);\n\t}\n\n\t_onCallViewToggleScreenSharingButtonClick()\n\t{\n\t\tAnalytics.getInstance().onScreenShareBtnClick({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tif (this.featureScreenSharing === FeatureState.Limited)\n\t\t{\n\t\t\tthis.messengerFacade.openHelpArticle('call_screen_sharing');\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.featureScreenSharing === FeatureState.Disabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t{\n\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t}\n\t\t\tif (this.webScreenSharePopup)\n\t\t\t{\n\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t}\n\t\t\tif (this.documentPromoPopup)\n\t\t\t{\n\t\t\t\tthis.documentPromoPopup.close();\n\t\t\t}\n\t\t\tthis.currentCall.stopScreenSharing();\n\n\t\t\tif (this.#isCommonRecordStarted() && this.#canLocalRecord())\n\t\t\t{\n\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.currentCall.startScreenSharing();\n\t\t\tthis.togglePictureInPictureCallWindow();\n\t\t\tBX.ajax.runAction('call.Call.onShareScreen', { data: { callId: this.currentCall.id, callUuid: this.currentCall.uuid } });\n\t\t}\n\t}\n\n\t_onCallViewToggleVideoButtonClickHandler(e)\n\t{\n\t\tif (!Hardware.initialized)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.video && Object.values(Hardware.cameraList).length === 0)\n\t\t{\n\t\t\tthis.showNotification(BX.message(\"IM_CALL_CAMERA_ERROR_FALLBACK_TO_MIC\"));\n\t\t\treturn;\n\t\t}\n\n\t\tHardware.setIsCameraOn({isCameraOn: e.video, calledProgrammatically: !!e.calledProgrammatically});\n\n\t\tif (!e.video && !this.currentCall.isScreenSharingStarted())\n\t\t{\n\t\t\tthis.callView.releaseLocalMedia();\n\t\t}\n\n\t\tif (!this.currentCall.cameraId && e.video)\n\t\t{\n\t\t\tthis.currentCall.setCameraId(Hardware.defaultCamera);\n\t\t}\n\t}\n\n\t_onCallViewToggleVideoButtonClick(e)\n\t{\n\t\tAnalytics.getInstance().onToggleCamera({\n\t\t\tvideo: e.video,\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\n\t\tthis._onCallViewToggleVideoButtonClickHandler(e);\n\t}\n\n\t_onCallViewToggleSpeakerButtonClick(e)\n\t{\n\t\tconst currentRoom = this.currentCall?.currentRoom?.();\n\t\tif (currentRoom && currentRoom.speaker != this.userId)\n\t\t{\n\t\t\talert(\"only room speaker can turn on sound\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.muteSpeaker(!e.speakerMuted);\n\n\t\tif (e.fromHotKey)\n\t\t{\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: BX.message(this.callView.speakerMuted ? 'IM_M_CALL_MUTE_SPEAKERS_OFF' : 'IM_M_CALL_MUTE_SPEAKERS_ON'),\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tautoHideDelay: 3000,\n\t\t\t\tcloseButton: true\n\t\t\t});\n\t\t}\n\t}\n\n\t_onCallViewMicrophoneSideIconClick()\n\t{\n\t\tconst currentRoom = this.currentCall?.currentRoom?.();\n\t\tif (currentRoom)\n\t\t{\n\t\t\tthis.toggleRoomMenu(this.callView.buttons.microphone.elements.icon);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.toggleRoomListMenu(this.callView.buttons.microphone.elements.icon);\n\t\t}\n\t}\n\n\t_onCallViewFeedbackButtonClick()\n\t{\n\t\tBX.loadExt('ui.feedback.form').then(() => {\n\t\t\tBX.UI.Feedback.Form.open({\n\t\t\t\tid: `call_feedback_${this._getCallIdentifier(this.currentCall)}-${this.currentCall.instanceId}-${Math.random()}`,\n\t\t\t\tforms: [\n\t\t\t\t\t{ zones: ['ru', 'by', 'kz'], id: 406, sec: '9lhjhn', lang: 'ru' },\n\t\t\t\t\t{ zones: ['de'], id: 754, sec: '6upe49', lang: 'de' },\n\t\t\t\t\t{ zones: ['es'], id: 750, sec: 'whk4la', lang: 'es' },\n\t\t\t\t\t{ zones: ['com.br'], id: 752, sec: 'is01cs', lang: 'com.br' },\n\t\t\t\t\t{ zones: ['en'], id: 748, sec: 'pds0h6', lang: 'en' },\n\t\t\t\t],\n\t\t\t\tpresets: {\n\t\t\t\t\tsender_page: 'call',\n\t\t\t\t\tcall_type: this.currentCall.provider,\n\t\t\t\t\tcall_amount: this.currentCall.users.length + 1,\n\t\t\t\t\tcall_id: `id: ${this._getCallIdentifier(this.currentCall)}, instanceId: ${this.currentCall.instanceId}`,\n\t\t\t\t\tid_of_user: this.currentCall.userId,\n\t\t\t\t\tfrom_domain: location.origin\n\t\t\t\t},\n\t\t\t});\n\t\t})\n\t}\n\n\t_onCallViewShowHistoryButtonClick()\n\t{\n\t\tthis.messengerFacade.openHistory(this.currentCall.associatedEntity.id);\n\t}\n\n\t_onCallViewFullScreenButtonClick()\n\t{\n\t\tif (this.folded)\n\t\t{\n\t\t\tthis.unfold();\n\t\t}\n\t\tthis.toggleFullScreen();\n\t}\n\n\t_onCallViewDocumentButtonClick()\n\t{\n\t\tthis.sidebar ? this.closeDocumentEditor() : this.showDocumentsMenu();\n\t}\n\n\t_onCallViewReplaceCamera(e)\n\t{\n\t\tif (this.reconnectingCameraId) {\n\t\t\tthis.setReconnectingCameraId(null);\n\t\t}\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.setCameraId(e.deviceId);\n\t\t}\n\n\t\t// update default camera\n\t\tHardware.defaultCamera = e.deviceId;\n\t}\n\n\t_onCallViewReplaceMicrophone(e)\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.setMicrophoneId(e.deviceId)\n\t\t\tthis.callView.setMicrophoneId(e.deviceId);\n\t\t}\n\n\t\t// update default microphone\n\t\tHardware.defaultMicrophone = e.deviceId;\n\t}\n\n\t_onCallViewReplaceSpeaker(e)\n\t{\n\t\tHardware.defaultSpeaker = e.deviceId;\n\t}\n\n\t_onCallViewHasMainStream(event): void\n\t{\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst provider = this.currentCall.provider;\n\t\tconst isBitrixCall = provider === Provider.Bitrix;\n\t\tconst isPlainCall = provider === Provider.Plain;\n\t\tconst isJwtInPlainCallsEnabled = isPlainCall && !this.isLegacyCall(provider, this.currentCall.scheme);\n\n\t\tif (isBitrixCall || isJwtInPlainCallsEnabled)\n\t\t{\n\t\t\tthis.currentCall.setMainStream(event);\n\t\t}\n\t}\n\n\t_onCallViewTurnOffParticipantMic(e)\n\t{\n\t\tthis.currentCall.turnOffParticipantStream({typeOfStream: 'mic', userId: e.userId, fromUserId: CallEngine.getCurrentUserId()});\n\n\t\tAnalytics.getInstance().onTurnOffParticipantStream({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttypeOfSetting: 'mic',\n\t\t});\n\t}\n\n\t_onCallViewTurnOffParticipantCam(e)\n\t{\n\t\tthis.currentCall.turnOffParticipantStream({typeOfStream: 'cam', userId: e.userId, fromUserId: CallEngine.getCurrentUserId()});\n\n\t\tAnalytics.getInstance().onTurnOffParticipantStream({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttypeOfSetting: 'cam',\n\t\t});\n\t}\n\n\t_onCallViewTurnOffParticipantScreenshare(e)\n\t{\n\t\tthis.currentCall.turnOffParticipantStream({typeOfStream: 'screenshare', userId: e.userId, fromUserId: CallEngine.getCurrentUserId()});\n\n\t\tAnalytics.getInstance().onTurnOffParticipantStream({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\ttypeOfSetting: 'screenshare',\n\t\t});\n\t}\n\n\t_onCallViewAllowSpeakPermission(e)\n\t{\n\t\tthis.currentCall.allowSpeakPermission({allow: true, userId: e.userId});\n\n\t\tAnalytics.getInstance().onAllowPermissionToSpeakResponse({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\t}\n\n\t_onCallViewDisallowSpeakPermission(e)\n\t{\n\t\tthis.currentCall.allowSpeakPermission({allow: false, userId: e.userId});\n\n\t\tAnalytics.getInstance().onDisallowPermissionToSpeakResponse({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t});\n\t}\n\n\t_onCallViewChangeHdVideo(e)\n\t{\n\t\tHardware.preferHdQuality = e.allowHdVideo;\n\t}\n\n\t_onCallViewChangeNoiseSuppression(e)\n\t{\n\t\tHardware.enableNoiseSuppression = e.allowNoiseSuppression;\n\t\tHardware.turnNoiseSuppression();\n\t}\n\n\t_onCallViewChangeMicAutoParams(e)\n\t{\n\t\tHardware.enableMicAutoParameters = e.allowMicAutoParams;\n\t}\n\n\t_onCallViewChangeFaceImprove(e)\n\t{\n\t\tif (!DesktopApi.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDesktopApi.setCameraSmoothingStatus(e.faceImproveEnabled);\n\t}\n\n\t_onCallViewOpenAdvancedSettings()\n\t{\n\t\tthis.messengerFacade.openSettings({onlyPanel: 'hardware'});\n\t}\n\n\t_onCallViewSetCentralUser(e)\n\t{\n\t\tif (e.stream && this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindowUser = e.userId;\n\t\t\t//this.floatingWindow.setStream(e.stream);\n\t\t}\n\t}\n\n\t_onCallUserInvited(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tif (this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t\t{\n\t\t\t\tthis.updateCallViewUsers(this.currentCall.id, [e.userId]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tUtil.setUserData(e.userData);\n\t\t\t\tthis.callView.updateUserData(e.userData);\n\t\t\t}\n\t\t\tthis.callView.addUser(e.userId);\n\t\t}\n\t}\n\n\t_onCallUserJoined(e) {\n\t\tUtil.setUserData(e.userData);\n\t\tsetTimeout(this.updateFloatingWindowContent.bind(this), 100);\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.updateUserData(e.userData);\n\t\t\tthis.callView.addUser(e.userId, UserState.Connected);\n\t\t}\n\t}\n\n\t_onCallDestroy()\n\t{\n\t\tlet callDetails;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tcallDetails = this.#getCallDetail(this.currentCall);\n\t\t\tthis.currentCall = null;\n\t\t}\n\n\t\tif (this.promotedToAdminTimeout)\n\t\t{\n\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t}\n\n\t\tif (this.childCall)\n\t\t{\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserJoined, this._onChildCallFirstMediaHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstUserJoinedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\t\tthis.childCall.hangup(false, '', true);\n\t\t\tthis.childCall = null;\n\t\t}\n\n\t\tthis.callWithLegacyMobile = false;\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.close();\n\t\t}\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tthis.#stopCommonRecord();\n\n\t\tif (this.callView && this.autoCloseCallView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tfor (const mediaStreamKind of Object.values(MediaStreamsKinds))\n\t\t{\n\t\t\tCallStreamManager.stopStream(mediaStreamKind);\n\t\t}\n\n\t\tthis.hasStreamFromCall = false;\n\t\tthis.#stopLocalStream();\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.close();\n\t\t}\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow(DesktopApi.findWindow('callBackground'));\n\t\t}\n\t\tif (this.riseYouHandToTalkPopup)\n\t\t{\n\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t}\n\t\tthis.closePromo();\n\n\t\tthis.allowMutePopup = true;\n\t\tthis.docCreatedForCurrentCall = false;\n\t\tthis._closeReconnectionBaloon();\n\t\tthis._closeParticipantsVideoBaloon();\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\n\t\tthis.emit(Events.onCallDestroyed, {\n\t\t\tcallDetails: callDetails\n\t\t})\n\t}\n\n\tloopConnectionQuality(userId, quality, timeout = 200)\n\t{\n\t\tthis.loopTimers[userId] = setTimeout(() => {\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.setUserConnectionQuality(userId, quality);\n\t\t\t\tconst newQuality = quality >= 4 ? 1 : quality + 1;\n\t\t\t\tthis.loopConnectionQuality(userId, newQuality, timeout);\n\t\t\t}\n\t\t}, timeout);\n\t}\n\n\tclearConnectionQualityTimer(userId)\n\t{\n\t\tif (this.loopTimers[userId] !== undefined)\n\t\t{\n\t\t\tclearTimeout(this.loopTimers[userId]);\n\t\t\tdelete this.loopTimers[userId];\n\t\t}\n\t};\n\n\t_onCallUserStateChanged(e)\n\t{\n\t\tsetTimeout(this.updateFloatingWindowContent.bind(this), 100);\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserState(e.userId, e.state);\n\t\t\tif (e.isLegacyMobile)\n\t\t\t{\n\t\t\t\tthis.callView.blockAddUser();\n\t\t\t\tthis.callView.blockSwitchCamera();\n\t\t\t\tthis.callView.blockScreenSharing();\n\t\t\t\tthis.callView.disableMediaSelection();\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t}\n\t\t}\n\n\t\tif (e.state !== UserState.Connected && this.loopTimers[e.userId] === undefined)\n\t\t{\n\t\t\tthis.loopConnectionQuality(e.userId, 1);\n\t\t}\n\n\t\tif (e.state == UserState.Connecting || e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\t}\n\n\t\tif (e.state == UserState.Connected)\n\t\t{\n\t\t\tthis.clearConnectionQualityTimer(e.userId);\n\t\t\tthis.callView.setUserConnectionQuality(e.userId, 5);\n\n\t\t\tconst unblockButtonsList = [];\n\t\t\tconst isNeedUnblockCameraButton = ((this.currentCall.provider === Provider.Bitrix && this.currentCall.isGetUserMediaFulfilled()) || this.currentCall.provider === Provider.Plain) && Hardware.hasCamera();\n\n\t\t\tif (!e.isLegacyMobile)\n\t\t\t{\n\t\t\t\tunblockButtonsList.push('floorRequest', 'screen');\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!e.isLegacyMobile\n\t\t\t\t&& this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme)\n\t\t\t\t&& CallAI.serviceEnabled\n\t\t\t)\n\t\t\t{\n\t\t\t\tunblockButtonsList.push('copilot');\n\t\t\t}\n\n\t\t\tif (!e.isLegacyMobile && isNeedUnblockCameraButton)\n\t\t\t{\n\t\t\t\tunblockButtonsList.push('camera');\n\t\t\t}\n\n\t\t\tif (!!unblockButtonsList.length)\n\t\t\t{\n\t\t\t\tthis.callView.unblockButtons(unblockButtonsList);\n\t\t\t}\n\n\t\t\tif (Util.isCommonRecordStateInactive(this.commonRecord.state))\n\t\t\t{\n\t\t\t\tthis.callView.unblockButtons(['record']);\n\t\t\t}\n\n\t\t\tif (this.currentCall.provider === Provider.Plain) {\n\t\t\t\tthis.callView.unblockAddUser();\n\t\t\t}\n\n\t\t\t/*Util.getUser(e.userId).then(function(userData)\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_CONNECTED\", {\n\t\t\t\t\t\tgender: (userData.gender || DEFAULT_GENDER),\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t}.bind(this));*/\n\t\t}\n\t\telse if (e.state == UserState.Idle && e.previousState == UserState.Connected)\n\t\t{\n\t\t\t/*Util.getUser(e.userId).then(function(userData)\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_DISCONNECTED\", {\n\t\t\t\t\t\tgender: (userData.gender || DEFAULT_GENDER),\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t}.bind(this));*/\n\n\t\t\tif (!this.#canCloudRecord() && e.userId === this.commonRecord.initiatorId)\n\t\t\t{\n\t\t\t\tthis.#stopCommonRecord();\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Failed)\n\t\t{\n\t\t\tif (e.networkProblem)\n\t\t\t{\n\t\t\t\tthis.showNetworkProblemNotification(BX.message(\"IM_M_CALL_TURN_UNAVAILABLE\"));\n\t\t\t}\n\t\t\telse if (this.currentCall instanceof PlainCall)\n\t\t\t{\n\t\t\t\tUtil.getUser(this.currentCall.id, e.userId).then((userData) =>\n\t\t\t\t{\n\t\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_FAILED\", {\n\t\t\t\t\t\tgender: (userData.gender || DEFAULT_GENDER),\n\t\t\t\t\t\tname: userData.name\n\t\t\t\t\t}));\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (e.state == UserState.Declined)\n\t\t{\n\t\t\tconst isLegacyCall = this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme);\n\t\t\tconst isBitrixCall = this.currentCall.provider === Provider.Bitrix;\n\t\t\tconst callId = isLegacyCall || !isBitrixCall ? this.currentCall.id : e.callId;\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\t(async () => {\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tconst userData = await Util.getUser(callId, e.userId);\n\t\t\t\t\t\tconst notyText = Util.getCustomMessage('IM_M_CALL_USER_DECLINED', {\n\t\t\t\t\t\t\tgender: (userData.gender || DEFAULT_GENDER),\n\t\t\t\t\t\t\tname: userData.name,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.showNotification(notyText);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (error)\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.warn('not found userData:', error);\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t}\n\t\t}\n\t\telse if (e.state === UserState.Busy && this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t{\n\t\t\tUtil.getUser(this.currentCall.id, e.userId).then((userData) =>\n\t\t\t{\n\t\t\t\tthis.showNotification(Util.getCustomMessage(\"IM_M_CALL_USER_BUSY\", {\n\t\t\t\t\tgender: (userData.gender || DEFAULT_GENDER),\n\t\t\t\t\tname: userData.name\n\t\t\t\t}));\n\t\t\t});\n\t\t}\n\t}\n\n\t_onCallUserMicrophoneState(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (e.userId == this.userId)\n\t\t{\n\t\t\tUtil.sendLog({\n\t\t\t\tdescription: `Set microphone muted ${!e.microphoneState} on MicrophoneState event`,\n\t\t\t});\n\t\t\tHardware.isMicrophoneMuted = !e.microphoneState;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.callView.setUserMicrophoneState(e.userId, e.microphoneState);\n\t\t}\n\t}\n\n\t_onCallUserCameraState(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.callView.setUserCameraState(e.userId, e.cameraState);\n\t}\n\n\t_onNeedResetMediaDevicesState(e)\n\t{\n\t\tconsole.log('_onNeedResetMediaDevicesState');\n\t\tUtil.sendLog({\n\t\t\tdescription: 'Set microphone muted true in _onNeedResetMediaDevicesState',\n\t\t});\n\t\tHardware.isMicrophoneMuted = true;\n\t\tHardware.isCameraOn = false;\n\n\t\tif (this.mediaDevicesResetStateHintBaloon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mediaDevicesResetStateHintBaloon = BX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(BX.message('CALL_MEDIA_DEVICES_RESET_STATE_HINT')),\n\t\t\tautoHide: false,\n\t\t\tposition: \"top-right\",\n\t\t\tcloseButton: true,\n\t\t});\n\t}\n\n\t_onBlockCameraButton()\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.blockSwitchCamera();\n\t}\n\n\t_onUnblockCameraButton()\n\t{\n\t\tif (!this.callView) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.unblockSwitchCamera();\n\t}\n\n\t_onBlockMicrophoneButton()\n\t{\n\t\tif (!this.callView) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.blockSwitchMicrophone();\n\t}\n\n\t_onUnblockMicrophoneButton()\n\t{\n\t\tif (!this.callView) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.callView.unblockSwitchMicrophone();\n\t}\n\n\t_onCameraPublishing(e)\n\t{\n\t\tif (e.publishing)\n\t\t{\n\t\t\tthis._onBlockCameraButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._onUnblockCameraButton();\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t}\n\n\t_onMicrophonePublishingd(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.publishing)\n\t\t{\n\t\t\tthis._onBlockMicrophoneButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._onUnblockMicrophoneButton();\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t}\n\n\t_onCallUserVideoPaused(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.callView.setUserVideoPaused(e.userId, e.videoPaused);\n\t}\n\n\t_onCallLocalScreenUpdated(e)\n\t{\n\t\tconst { track } = e;\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setLocalStreamVideoTrack(track)\n\t\t}\n\t}\n\n\t_onCallLocalMediaReceived(e)\n\t{\n\t\tthis.log(\"Received local media stream \" + e.tag);\n\n\t\tthis.hasStreamFromCall = true;\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tconst flipVideo = (e.tag === \"main\" || e.mediaRenderer) ? Hardware.enableMirroring : false;\n\n\t\t\tthis.callView.setLocalStream(e);\n\t\t\tthis.callView.flipLocalVideo(flipVideo);\n\n\t\t\tthis.callView.setButtonActive(\"screen\", this.currentCall.isScreenSharingStarted());\n\t\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t\t{\n\t\t\t\tthis.screenShareStartTime = new Date();\n\t\t\t\tAnalytics.getInstance().onScreenShareStarted({\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t});\n\n\t\t\t\tthis.togglePictureInPictureCallWindow();\n\n\t\t\t\tif (!DesktopApi.isDesktop())\n\t\t\t\t{\n\t\t\t\t\tthis.showWebScreenSharePopup();\n\t\t\t\t}\n\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().onScreenShareStopped({\n\t\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\t\tcallType: this.getCallType(),\n\t\t\t\t\tstatus: Analytics.AnalyticsStatus.success,\n\t\t\t\t\tscreenShareLength: Util.getTimeInSeconds(this.screenShareStartTime),\n\t\t\t\t});\n\t\t\t\tthis.screenShareStartTime = null;\n\n\t\t\t\tthis.togglePictureInPictureCallWindow();\n\n\t\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t\t}\n\t\t\t\tif (this.webScreenSharePopup)\n\t\t\t\t{\n\t\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t\t}\n\t\t\t\tif (this.#isCommonRecordStarted() && this.#canLocalRecord())\n\t\t\t\t{\n\t\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.currentCall.callFromMobile)\n\t\t\t{\n\t\t\t\tthis.callView.unblockSwitchCamera();\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tthis.currentCall\n\t\t\t&& Hardware.isCameraOn\n\t\t\t&& e.tag === 'main'\n\t\t\t&& e.stream.getVideoTracks().length === 0\n\t\t)\n\t\t{\n\t\t\tif (this.currentCall.canChangeMediaDevices())\n\t\t\t{\n\t\t\t\tthis.showNotification(BX.message(\"IM_CALL_CAMERA_ERROR_FALLBACK_TO_MIC\"));\n\t\t\t}\n\t\t\tHardware.isCameraOn = false;\n\t\t}\n\t}\n\n\t_onCallLocalCameraFlip(e)\n\t{\n\t\tthis._onCallLocalCameraFlipInDesktop(e.data.enableMirroring);\n\t}\n\n\t_onCallLocalCameraFlipInDesktop(e)\n\t{\n\t\tconsole.error('FLIPPING LOCAL VIDEO');\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.flipLocalVideo(e);\n\t\t}\n\t}\n\n\t_onCallLocalMediaStopped(e)\n\t{\n\t\tif (this.callView && e.kind === 'audio')\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\tthis.showNotification(Loc.getMessage('CALL_ERROR_MICROPHONE_STREAM_STOPPED'));\n\t\t}\n\t}\n\n\t#setUserMedia(e)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\tUtil.sendLog({\n\t\t\t\tdescription: 'trying to do #setUserMedia, but callView is not initialized yet',\n\t\t\t\tuserId: e.userId,\n\t\t\t\tkind: e.kind,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif ('track' in e)\n\t\t{\n\t\t\tthis.callView.setUserMedia(e.userId, e.kind, e.track);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif ('mediaRenderer' in e)\n\t\t{\n\t\t\tconst kind = e.mediaRenderer.kind;\n\t\t\tconst audioTrack = e.mediaRenderer.stream?.getAudioTracks()?.[0];\n\t\t\tconst videoTrack = e.mediaRenderer.stream?.getVideoTracks()?.[0];\n\n\t\t\tif ((kind === 'audio' || kind === 'sharingAudio') && audioTrack)\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, kind, audioTrack);\n\t\t\t}\n\t\t\telse if ((kind === 'video' || kind === 'sharing') && videoTrack)\n\t\t\t{\n\t\t\t\tthis.callView.setVideoRenderer(e.userId, e.mediaRenderer);\n\t\t\t}\n\t\t}\n\t}\n\n\t_onCallRemoteMediaReceived(e)\n\t{\n\t\tif (this.onCallViewRenderToMediaReceived)\n\t\t{\n\t\t\tconst style = 'background-color: #00F; color: white;'\n\t\t\tconsole.log(`%c[debug] Time from view render to the first media received: ${Date.now() - this.onCallViewRenderToMediaReceived} ms`, style);\n\n\t\t\tthis.onCallViewRenderToMediaReceived = null;\n\t\t}\n\n\t\tif (this.onConnectToCallClick)\n\t\t{\n\t\t\tconst style = 'background-color: #AA00AA; color: white;'\n\t\t\tconsole.log(`%c[debug] Time from click to the first media received: ${Date.now() - this.onConnectToCallClick} ms`, style);\n\n\t\t\tthis.onConnectToCallClick = null;\n\t\t}\n\n\t\tthis.#setUserMedia(e);\n\t}\n\n\t_onCallRemoteMediaStopped(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tif ('mediaRenderer' in e)\n\t\t\t{\n\t\t\t\tif (e.kind === 'video' || e.kind === 'sharing')\n\t\t\t\t{\n\t\t\t\t\te.mediaRenderer.stream = null;\n\t\t\t\t\tthis.callView.setVideoRenderer(e.userId, e.mediaRenderer);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.setUserMedia(e.userId, e.kind, null);\n\t\t\t}\n\t\t}\n\t}\n\n\tisLegacyCall(provider, scheme = null): boolean\n\t{\n\t\tif (scheme)\n\t\t{\n\t\t\treturn scheme === CallScheme.classic;\n\t\t}\n\n\t\tconst isLegacyPlainCall = provider === Provider.Plain && !CallSettingsManager.isJwtInPlainCallsEnabled();\n\t\tconst isLegacyBitrixCall = provider === Provider.Bitrix && !CallSettingsManager.jwtCallsEnabled;\n\n\t\treturn isLegacyPlainCall || isLegacyBitrixCall;\n\t}\n\n\t_getCallIdentifier(call)\n\t{\n\t\tif (!call)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.isLegacyCall(call.provider, call.scheme) ? call.id : call.uuid;\n\t}\n\n\t#prepareLocalStream(provider, fallback = false)\n\t{\n\t\tconst video = {};\n\n\t\tif (Hardware.defaultCamera)\n\t\t{\n\t\t\tvideo.deviceId = { exact: Hardware.defaultCamera };\n\t\t}\n\n\t\tif (!fallback)\n\t\t{\n\t\t\tvideo.width = { ideal: 1280 };\n\t\t\tvideo.height = { ideal: 720 };\n\t\t}\n\n\t\tconst isNotSupportDevicesListBeforeStream = UnsupportedBrowserFeatures.isNotSupportDevicesListBeforeStream;\n\t\tconst constraints = { audio: isNotSupportDevicesListBeforeStream, video };\n\t\tCallStreamManager.getUserMedia(constraints).then((stream) => {\n\t\t\tthis.localStream = stream;\n\n\t\t\tif (!this.currentCall && !this.initCallPromise)\n\t\t\t{\n\t\t\t\tthis.#stopLocalStream();\n\t\t\t}\n\t\t\telse if (this.callView)\n\t\t\t{\n\t\t\t\tthis.#setLocalStream(provider);\n\t\t\t}\n\n\t\t\tif (isNotSupportDevicesListBeforeStream)\n\t\t\t{\n\t\t\t\tthis.#onGetUserMediaEnded();\n\t\t\t}\n\t\t}).catch((error) => {\n\t\t\tthis.log(`Attempt to get video (fallback: ${Boolean(fallback)}) for call before it has been created failed`, error);\n\t\t\tif (!fallback)\n\t\t\t{\n\t\t\t\tthis.#prepareLocalStream(provider, true);\n\t\t\t}\n\t\t});\n\t}\n\n\t#setLocalStream(provider)\n\t{\n\t\tconst isLegacyCall = this.isLegacyCall(provider);\n\t\tconst streamData = {\n\t\t\tstream: this.localStream,\n\t\t\ttag: 'main',\n\t\t\tflipVideo: Hardware.enableMirroring,\n\t\t};\n\n\t\tif (provider !== Provider.Plain || !isLegacyCall)\n\t\t{\n\t\t\tconst mediaRenderer = new MediaRenderer({\n\t\t\t\ttrack: this.localStream.getVideoTracks()[0],\n\t\t\t\tkind: 'video',\n\t\t\t});\n\t\t\tstreamData.mediaRenderer = mediaRenderer;\n\t\t\tstreamData.stream = mediaRenderer.stream;\n\t\t}\n\n\t\tthis.callView.setLocalStream(streamData);\n\t}\n\n\t#stopLocalStream()\n\t{\n\t\tif (this.localStream)\n\t\t{\n\t\t\tUtil.sendLog({ description: 'Stop local media stream' });\n\t\t\tUtil.stopMediaStream(this.localStream);\n\t\t\tthis.localStream = null;\n\t\t}\n\t}\n\n\t_onCallBadNetworkIndicator(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setBadNetworkIndicator(e.userId, e.badNetworkIndicator);\n\t\t}\n\t}\n\n\t_onCallConnectionQualityChanged(e)\n\t{\n\t\tthis.clearConnectionQualityTimer(e.userId);\n\n\t\tthis.callView.setUserConnectionQuality(e.userId, e.score);\n\t}\n\n\t_onCallToggleRemoteParticipantVideo(e)\n\t{\n\t\tif (this.toogleParticipantsVideoBaloon)\n\t\t{\n\t\t\tif (e.isVideoShown)\n\t\t\t{\n\t\t\t\tthis._closeParticipantsVideoBaloon();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!e.isVideoShown)\n\t\t{\n\t\t\tthis.toogleParticipantsVideoBaloon = BX.UI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(BX.message('IM_M_CALL_REMOTE_PARTICIPANTS_VIDEO_MUTED')),\n\t\t\t\tautoHide: false,\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tcloseButton: false,\n\t\t\t})\n\t\t}\n\t}\n\n\t_closeParticipantsVideoBaloon()\n\t{\n\t\tif (this.toogleParticipantsVideoBaloon)\n\t\t{\n\t\t\tthis.toogleParticipantsVideoBaloon.close();\n\t\t\tthis.toogleParticipantsVideoBaloon = null;\n\t\t}\n\t}\n\n\t_onCallUserVoiceStarted(e)\n\t{\n\t\tif (e.local)\n\t\t{\n\t\t\tif (this.currentCall.muted && this.isMutedPopupAllowed())\n\t\t\t{\n\t\t\t\tthis.showMicMutedNotification();\n\t\t\t}\n\n\t\t\tif (this.currentCall.muted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.talkingUsers[e.userId] = true;\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserTalking(e.userId, true);\n\t\t\tif (e.userId == this.callView.localUser.id)\n\t\t\t{\n\t\t\t\tthis.callView.setUserFloorRequestState(e.userId, false);\n\t\t\t}\n\n\t\t}\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setTalking(Object.keys(this.talkingUsers).map(function (id)\n\t\t\t{\n\t\t\t\treturn Number(id);\n\t\t\t}));\n\t\t}\n\t}\n\n\t_onCallUserVoiceStopped(e)\n\t{\n\t\tif (this.talkingUsers[e.userId])\n\t\t{\n\t\t\tdelete this.talkingUsers[e.userId];\n\t\t}\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserTalking(e.userId, false);\n\t\t}\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.setTalking(Object.keys(this.talkingUsers).map(function (id)\n\t\t\t{\n\t\t\t\treturn Number(id);\n\t\t\t}));\n\t\t}\n\t}\n\n\t_onBlockUnblockCamMicButtons()\n\t{\n\t\tif (Util.havePermissionToBroadcast('cam'))\n\t\t{\n\t\t\tthis._onUnblockCameraButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._onBlockCameraButton();\n\t\t}\n\n\t\tif (Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\tthis._onUnblockMicrophoneButton();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._onBlockMicrophoneButton();\n\t\t}\n\t}\n\n\t_onTurnOnCamera(e)\n\t{\n\t\tthis._onCallViewToggleVideoButtonClickHandler({video: true, calledProgrammatically: true});\n\t}\n\n\t_onAllParticipantsAudioMuted(e)\n\t{\n\t\tconst userModel = this.callView.userRegistry.get(e.userId);\n\n\t\tlet content = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-mic-muted\"></div>'\n\t\t\t+ (Text.encode(Util.getCustomMessage(\"CALL_USER_TURNED_OFF_MIC_FOR_ALL_MSGVER_1\", {\n\t\t\t\tgender: (userModel.data.gender? userModel.data.gender.toUpperCase() : DEFAULT_GENDER),\n\t\t\t\tname: userModel.data.name\n\t\t\t})));\n\n\t\tif (content && (!e.reason || e.reason !== 'settings'))\n\t\t{\n\t\t\tthis.createCallControlNotify({content: content, isAllow: false});\n\t\t}\n\n\t\tif (Util.isRegularUser(Util.getCurrentUserRole()))\n\t\t{\n\t\t\tthis._onCallViewToggleMuteHandler({muted: true, calledProgrammatically: true});\n\t\t}\n\t}\n\n\t_onAllParticipantsVideoMuted(e)\n\t{\n\n\t\tconst userModel = this.callView.userRegistry.get(e.userId);\n\n\t\tlet content = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-cam-muted\"></div>'\n\t\t\t+ (Text.encode(Util.getCustomMessage(\"CALL_USER_TURNED_OFF_CAM_FOR_ALL_MSGVER_1\", {\n\t\t\t\tgender: (userModel.data.gender? userModel.data.gender.toUpperCase() : DEFAULT_GENDER),\n\t\t\t\tname: userModel.data.name\n\t\t\t})));\n\n\t\tif (content && (!e.reason || e.reason !== 'settings'))\n\t\t{\n\t\t\tthis.createCallControlNotify({content: content, isAllow: false});\n\t\t}\n\n\t\tif (Util.isRegularUser(Util.getCurrentUserRole()))\n\t\t{\n\t\t\tthis._onCallViewToggleVideoButtonClickHandler({video: false, calledProgrammatically: true});\n\t\t}\n\t}\n\n\t_onAllParticipantsScreenshareMuted(e)\n\t{\n\t\tconst userModel = this.callView.userRegistry.get(e.userId);\n\n\t\tlet content = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-cam-muted\"></div>'\n\t\t\t+ (Text.encode(Util.getCustomMessage(\"CALL_USER_TURNED_OFF_SCREENSHARE_FOR_ALL_MSGVER_1\", {\n\t\t\t\tgender: (userModel.data.gender? userModel.data.gender.toUpperCase() : DEFAULT_GENDER),\n\t\t\t\tname: userModel.data.name\n\t\t\t})));\n\n\t\tif (content && (!e.reason || e.reason !== 'settings'))\n\t\t{\n\t\t\tthis.createCallControlNotify({content: content, isAllow: false});\n\t\t}\n\n\t\tif (this.currentCall.isScreenSharingStarted() && Util.isRegularUser(Util.getCurrentUserRole()))\n\t\t{\n\t\t\tthis._onCallViewToggleScreenSharingButtonClick();\n\t\t}\n\t}\n\n\t_onParticipantMuted(e)\n\t{\n\t\tif (e.data?.track.muted) // tbh always should be in \"true\"..\n\t\t{\n\t\t\tlet contentIcon = 'mic';\n\t\t\tlet contentPhrase = '';\n\t\t\tconst initiatorUserModel = this.callView.userRegistry.get(e.data.fromUserId);\n\t\t\tconst targetUserModel = this.callView.userRegistry.get(e.data.toUserId);\n\t\t\tconst initiatorGender = (initiatorUserModel.data.gender ? initiatorUserModel.data.gender.toUpperCase() : DEFAULT_GENDER);\n\n\t\t\tif (e.data.toUserId == CallEngine.getCurrentUserId())\n\t\t\t{\n\t\t\t\tif (e.data.track.type === 0)\n\t\t\t\t{\n\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_YOUR_MIC_MSGVER_1' + '_' + initiatorGender;\n\t\t\t\t\tthis._onCallViewToggleMuteHandler({muted: true, calledProgrammatically: true});\n\t\t\t\t}\n\t\t\t\telse if (e.data.track.type === 1)\n\t\t\t\t{\n\t\t\t\t\tcontentIcon = 'cam';\n\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_YOUR_CAM_MSGVER_1' + '_' + initiatorGender;\n\t\t\t\t\tthis._onCallViewToggleVideoButtonClickHandler({video: false, calledProgrammatically: true});\n\t\t\t\t}\n\t\t\t\telse if (e.data.track.type === 2)\n\t\t\t\t{\n\t\t\t\t\tcontentIcon = 'screenshare';\n\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_YOUR_SCREENSHARE' + '_' + initiatorGender;\n\t\t\t\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._onCallViewToggleScreenSharingButtonClick();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (e.data.fromUserId == CallEngine.getCurrentUserId())\n\t\t\t\t{\n\t\t\t\t\tif (e.data.track.type === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_YOU_TURNED_OFF_USER_MIC';\n\t\t\t\t\t}\n\t\t\t\t\telse if (e.data.track.type === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentIcon = 'cam';\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_YOU_TURNED_OFF_USER_CAM';\n\t\t\t\t\t}\n\t\t\t\t\telse if (e.data.track.type === 2)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentIcon = 'screenshare';\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_YOU_TURNED_OFF_USER_SCREENSHARE';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (e.data.track.type === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_USER_MIC_MSGVER_1' + '_' + initiatorGender;\n\t\t\t\t\t}\n\t\t\t\t\telse if (e.data.track.type === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentIcon = 'cam';\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_USER_CAM_MSGVER_1' + '_' + initiatorGender;\n\t\t\t\t\t}\n\t\t\t\t\telse if (e.data.track.type === 2)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontentIcon = 'screenshare';\n\t\t\t\t\t\tcontentPhrase = 'CALL_CONTROL_MODERATOR_TURNED_OFF_USER_SCREENSHARE' + '_' + initiatorGender;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet content =\n\t\t\t\t'<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+contentIcon+'-muted\"></div>'\n\t\t\t\t+ (Text.encode(Util.getCustomMessage(contentPhrase, {\n\t\t\t\t\tgender: initiatorGender,\n\t\t\t\t\tinitiator_name: initiatorUserModel.data.name,\n\t\t\t\t\ttarget_name: targetUserModel.data.name,\n\t\t\t\t})));\n\n\t\t\tthis.createCallControlNotify({content: content, isAllow: false});\n\t\t}\n\t}\n\n\t_onYouMuteAllParticipants(e)\n\t{\n\t\tlet typesOfMute = {0: 'mic', 1: 'cam', 2: 'screenshare'};\n\t\tlet typesOfMuteMessage = {0: 'CALL_YOU_TURNED_OFF_MIC_FOR_ALL_MSGVER_1', 1: 'CALL_YOU_TURNED_OFF_CAM_FOR_ALL_MSGVER_1', 2: 'CALL_YOU_TURNED_OFF_SCREENSHARE_FOR_ALL_MSGVER_1'};\n\n\t\tlet content = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+(typesOfMute[e.data.track.type])+'-muted\"></div>'\n\t\t+ (BX.message[(typesOfMuteMessage[e.data.track.type])]);\n\n\t\tthis.createCallControlNotify({content: content, isAllow: false});\n\t}\n\n\t_onUserPermissionsChanged(e)\n\t{\n\t\tconst initiatorUserModel = this.callView.userRegistry.get(e.data.fromUserId);\n\t\tconst initiatorGender = (initiatorUserModel.data.gender ? initiatorUserModel.data.gender.toUpperCase() : DEFAULT_GENDER);\n\n\t\tlet contentPhrase = 'CALL_ADMIN_ALLOWED_TURN_ON_ALL_FOR_YOU_BY_HANDRAISE_' + initiatorGender;\n\n\t\tif (!e.data.allow)\n\t\t{\n\t\t\tcontentPhrase = 'CALL_ADMIN_NOT_ALLOWED_TURN_ON_ALL_FOR_YOU_BY_HANDRAISE_' + initiatorGender;\n\t\t\tconst floorState = this.callView.getUserFloorRequestState(CallEngine.getCurrentUserId());\n\n\t\t\tif (floorState)\n\t\t\t{\n\t\t\t\tthis._onCallViewFloorRequestButtonClick();\n\t\t\t}\n\t\t}\n\n\t\tconst content = Text.encode(Util.getCustomMessage(contentPhrase, {\n\t\t\tgender: initiatorGender,\n\t\t\tinitiator_name: initiatorUserModel.data.name,\n\t\t}));\n\n\t\tif (content)\n\t\t{\n\t\t\tthis.createCallControlNotify({content: content, isAllow: e.data.allow});\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserPermissionToSpeakState(e.data.toUserId, e.data.allow);\n\t\t}\n\n\t\tthis.callView.updateButtons();\n\t\tthis._onBlockUnblockCamMicButtons();\n\t}\n\n\t_onUserRoleChanged(e)\n\t{\n\t\tif (e.data.toUserId == CallEngine.getCurrentUserId())\n\t\t{\n\t\t\tconst content = BX.message('CALL_YOU_HAVE_BEEN_APPOINTED_AS_ADMIN');\n\n\t\t\tif (content)\n\t\t\t{\n\t\t\t\tthis.promotedToAdminTimeout = setTimeout(\n\t\t\t\t\t() => this.createCallControlNotify({content: content, isAllow: true}),\n\t\t\t\t\tthis.promotedToAdminTimeoutValue\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (this.riseYouHandToTalkPopup)\n\t\t\t{\n\t\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t\t}\n\n\t\t\tif (this.callView)\n\t\t\t{\n\t\t\t\tthis.callView.updateButtons();\n\t\t\t\tthis.callView.updateFloorRequestNotification();\n\t\t\t}\n\n\t\t\tthis._onBlockUnblockCamMicButtons();\n\t\t}\n\t}\n\n\t_onRoomSettingsChanged(e)\n\t{\n\t\tlet typesOfMute = {'audio': 'mic', 'video': 'cam', 'screen_share': 'screenshare'};\n\n\t\tlet content = '';\n\t\tlet isAllow = false;\n\n\t\tconst initiatorUserModel = this.callView.userRegistry.get(e.data.fromUserId);\n\t\tconst initiatorGender = (initiatorUserModel.data.gender ? initiatorUserModel.data.gender.toUpperCase() : DEFAULT_GENDER);\n\n\t\tif (e.data.eft === true)\n\t\t{\n\t\t\tif (e.data.fromUserId == this.currentCall.userId)\n\t\t\t{\n\t\t\t\tconst typesOfMuteMessage =\n\t\t\t\t{\n\t\t\t\t\t'audio': 'CALL_YOU_PROHIBITED_MIC_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'video': 'CALL_YOU_PROHIBITED_CAM_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'screen_share': 'CALL_YOU_PROHIBITED_SCREENSHARE_FOR_ALL_BY_SETTINGS',\n\t\t\t\t};\n\n\t\t\t\tcontent = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+(typesOfMute[e.data.act])+'-muted\"></div>'\n\t\t\t\t+ (BX.message[(typesOfMuteMessage[e.data.act])]);\n\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst typesOfMuteMessage =\n\t\t\t\t{\n\t\t\t\t\t'audio': 'CALL_ADMIN_PROHIBITED_MIC_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'video': 'CALL_ADMIN_PROHIBITED_CAM_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'screen_share': 'CALL_ADMIN_PROHIBITED_SCREENSHARE_FOR_ALL_BY_SETTINGS',\n\t\t\t\t};\n\n\t\t\t\tlet contentPhrase = typesOfMuteMessage[e.data.act] + '_' + initiatorGender;\n\n\t\t\t\tcontent = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+(typesOfMute[e.data.act])+'-muted\"></div>'\n\t\t\t\t+ (Text.encode(Util.getCustomMessage(contentPhrase, {\n\t\t\t\t\tgender: initiatorGender,\n\t\t\t\t\tinitiator_name: initiatorUserModel.data.name,\n\t\t\t\t})));\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tisAllow = true;\n\t\t\tif (e.data.fromUserId == this.currentCall.userId)\n\t\t\t{\n\t\t\t\tif (this.riseYouHandToTalkPopup)\n\t\t\t\t{\n\t\t\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t\t\t}\n\t\t\t\tconst typesOfMuteMessage =\n\t\t\t\t{\n\t\t\t\t\t'audio': 'CALL_YOU_ALLOWED_MIC_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'video': 'CALL_YOU_ALLOWED_CAM_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'screen_share': 'CALL_YOU_ALLOWED_SCREENSHARE_FOR_ALL_BY_SETTINGS',\n\t\t\t\t};\n\n\t\t\t\tcontent = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+(typesOfMute[e.data.act])+'-unmuted\"></div>'\n\t\t\t\t+ (BX.message[(typesOfMuteMessage[e.data.act])]);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst typesOfMuteMessage =\n\t\t\t\t{\n\t\t\t\t\t'audio': 'CALL_ADMIN_ALLOWED_MIC_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'video': 'CALL_ADMIN_ALLOWED_CAM_FOR_ALL_BY_SETTINGS',\n\t\t\t\t\t'screen_share': 'CALL_ADMIN_ALLOWED_SCREENSHARE_FOR_ALL_BY_SETTINGS',\n\t\t\t\t};\n\n\t\t\t\tlet contentPhrase = typesOfMuteMessage[e.data.act] + '_' + initiatorGender;\n\n\t\t\t\tcontent = '<div class = \"bx-call-view-participants-control-stream-notify-icon bx-call-view-'+(typesOfMute[e.data.act])+'-unmuted\"></div>'\n\t\t\t\t+ (Text.encode(Util.getCustomMessage(contentPhrase, {\n\t\t\t\t\tgender: initiatorGender,\n\t\t\t\t\tinitiator_name: initiatorUserModel.data.name,\n\t\t\t\t})));\n\n\t\t\t\tif (this.riseYouHandToTalkPopup && e.data.act === 'audio')\n\t\t\t\t{\n\t\t\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\tif (this.callView && !isAllow)\n\t\t{\n\t\t\tthis.callView.setAllUserPermissionToSpeakState(false);\n\t\t}\n\n\t\tif (content)\n\t\t{\n\t\t\tthis.createCallControlNotify({content: content, isAllow: isAllow});\n\t\t}\n\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.updateStatePermissions();\n\t\t}\n\n\t\tif (e.data.eft === true && e.data.act === 'audio' && !Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\tthis.lastCalledChangeSettingsUserName = initiatorUserModel.data.name;\n\t\t\tthis.showRiseYouHandToTalkNotification({initiatorName: this.lastCalledChangeSettingsUserName});\n\t\t}\n\n\t\tthis.callView.updateButtons();\n\t\tthis._onBlockUnblockCamMicButtons();\n\t}\n\n\t_afterOpenParticipantsPermissionPopup()\n\t{\n\t\tif (this.participantsPermissionPopup)\n\t\t\t{\n\t\t\tlet balloons = BX.UI.Notification.Center.balloons;\n\n\t\t\tfor (let baloonId in balloons)\n\t\t\t{\n\t\t\t\tballoons[baloonId].container?.classList.add(BALLOON_OFFSET_CLASS_NAME);\n\t\t\t\tballoons[baloonId].offsetClassNameSetted = true;\n\t\t\t}\n\t\t}\n\t}\n\n\t_afterCloseParticipantsPermissionPopup()\n\t{\n\t\tlet balloons = BX.UI.Notification.Center.balloons;\n\n\t\tfor (let baloonId in balloons)\n\t\t{\n\t\t\tballoons[baloonId].container?.classList.remove(BALLOON_OFFSET_CLASS_NAME);\n\t\t\tballoons[baloonId].offsetClassNameSetted = false;\n\t\t}\n\t}\n\n\tcreateCallControlNotify(_p)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet balloonClassName = 'ui-notification-balloon-content bx-call-control-notification ';\n\n\t\tif (_p.isAllow === false)\n\t\t{\n\t\t\tballoonClassName += 'bx-call-control-notification-disallow ';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tballoonClassName += 'bx-call-control-notification-allow ';\n\t\t}\n\n\t\tBX.UI.Notification.Center.notify({\n\t\t\tcontent: _p.content,\n\t\t\tposition: \"top-right\",\n\t\t\tautoHideDelay: 8000,\n\t\t\tcategory: _p.category || '',\n\t\t\tcloseButton: true,\n\t\t\trender: function() {\n\n\t\t\t\tconst actions = this.getActions().map(action => action.getContainer());\n\n\t\t\t\treturn BX.create(\"div\", {\n\t\t\t\t\tprops: {\n\t\t\t\t\t\tclassName: balloonClassName,\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tBX.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"ui-notification-balloon-message\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\thtml: this.getContent(),\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tBX.create(\"div\", {\n\t\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\t\tclassName: \"ui-notification-balloon-actions\"\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tchildren: actions\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tthis.isCloseButtonVisible() ?  this.getCloseButton(): null\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\tthis._afterOpenParticipantsPermissionPopup();\n\t}\n\n\t_onUserStatsReceived(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserStats(e.userId, e.report);\n\t\t}\n\t}\n\n\t_onTrackSubscriptionFailed(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setTrackSubscriptionFailed(e);\n\t\t}\n\t}\n\n\t_onCallUserScreenState(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserScreenState(e.userId, e.screenState);\n\t\t}\n\t\tif (e.userId == CallEngine.getCurrentUserId())\n\t\t{\n\t\t\tthis.callView.setButtonActive(\"screen\", e.screenState);\n\n\t\t\tif (e.screenState)\n\t\t\t{\n\t\t\t\tif (!DesktopApi.isDesktop())\n\t\t\t\t{\n\t\t\t\t\tthis.showWebScreenSharePopup();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.close();\n\t\t\t\t}\n\t\t\t\tif (this.webScreenSharePopup)\n\t\t\t\t{\n\t\t\t\t\tthis.webScreenSharePopup.close();\n\t\t\t\t}\n\t\t\t\tif (this.#isCommonRecordStarted() && this.#canLocalRecord())\n\t\t\t\t{\n\t\t\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.currentCall && this.currentCall.provider === 'Plain')\n\t\t\t{\n\t\t\t\tthis.togglePictureInPictureCallWindow();\n\t\t\t}\n\n\t\t\tthis.callView.updateButtons();\n\t\t}\n\t}\n\n\t/**\n\t * @group CommonRecord\n\t * @param { Object } event\n\t * @param { BitrixCall | PlainCall } event.call\n\t * @param { Object } event.commonRecordState\n\t * @param { number } event.commonRecordState.userId\n\t * @param { CallCommonRecordType } event.commonRecordState.type\n\t * @param { CallCommonRecordState } event.commonRecordState.state\n\t * @param { Object } event.commonRecordState.date\n\t * @param { string } event.commonRecordState.date.start\n\t * @param { Array } event.commonRecordState.date.pause\n\t * @param { number } event.userId\n \t */\n\n\t#onCallUserCommonRecordState(event)\n\t{\n\t\tif (this.#canCloudRecord())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { commonRecordState, userId } = event;\n\t\tconst { state, userId: initiatorId } = commonRecordState;\n\n\t\tthis.commonRecord.state = state;\n\t\tthis.callView.setCommonRecordState(commonRecordState);\n\t\tthis.commonRecord.initiatorId = initiatorId;\n\n\t\tif (Util.isCommonRecordStateInactive(state))\n\t\t{\n\t\t\tthis.commonRecord.info = null;\n\t\t\tthis.commonRecord.initiatorId = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.commonRecord.info = commonRecordState;\n\t\t}\n\n\t\t// if (CallCloudRecord.serviceEnabled)\n\t\t// {\n\t\t// \tif (state === CallCommonRecordState.Started && initiatorId !== this.userId)\n\t\t// \t{\n\t\t// \t\tthis.callView.showCommonRecordStartModal();\n\t\t// \t}\n\t\t//\n\t\t// \treturn;\n\t\t// }\n\n\t\tif (!this.commonRecord.notifyShowed && state === CallCommonRecordState.Started && initiatorId !== this.userId)\n\t\t{\n\t\t\tthis.commonRecord.notifyShowed = true;\n\t\t\tthis.callView.showCommonRecordStartNotify(initiatorId);\n\t\t}\n\n\t\tif (Util.isCommonRecordStateInactive(state) && initiatorId !== this.userId)\n\t\t{\n\t\t\tthis.commonRecord.notifyShowed = false;\n\t\t}\n\n\t\tif (!this.#canLocalRecord() || userId !== this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isStartedByMe = state === CallCommonRecordState.Started && initiatorId === this.userId;\n\t\tconst isStopped = state === CallCommonRecordState.Stopped;\n\n\t\tif (isStartedByMe)\n\t\t{\n\t\t\tconst callType = this.getCallType();\n\t\t\tconst callId = this._getCallIdentifier(this.currentCall);\n\t\t\tconst { id: dialogId, name: dialogName } = this.currentCall.associatedEntity;\n\n\t\t\tconst callDate = BX?.date.format(this.formatRecordDate) || BX.Main.Date.format(this.formatRecordDate);\n\n\t\t\tlet fileName = Loc.getMessage('IM_CALL_RECORD_NAME');\n\t\t\tif (fileName)\n\t\t\t{\n\t\t\t\tfileName = fileName\n\t\t\t\t\t.replace('#CHAT_TITLE#', dialogName)\n\t\t\t\t\t.replace('#CALL_ID#', callId)\n\t\t\t\t\t.replace('#DATE#', callDate)\n\t\t\t\t;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfileName = `call_record_${callId}`;\n\t\t\t}\n\n\t\t\tBX.ajax.runAction('call.Call.onStartRecord', { data: { callId: this.currentCall.id, callUuid: this.currentCall.uuid } });\n\n\t\t\tAnalytics.getInstance().onRecordStart({ callId, callType, recordType: this.commonRecord.type, errorCode: null });\n\n\t\t\tBXDesktopSystem.CallRecordStart({\n\t\t\t\twindowId: View.RecordSource.Chat,\n\t\t\t\tfileName,\n\t\t\t\tcallId,\n\t\t\t\tcallDate,\n\t\t\t\tdialogId,\n\t\t\t\tdialogName,\n\t\t\t\tvideo: this.commonRecord.type !== CallCommonRecordType.Audio,\n\t\t\t\tmuted: Hardware.isMicrophoneMuted,\n\t\t\t\tcropTop: 72,\n\t\t\t\tcropBottom: 90,\n\t\t\t\tshareMethod: 'im.disk.record.share',\n\t\t\t\tcallType,\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (isStopped)\n\t\t{\n\t\t\tAnalytics.getInstance().onRecordStop({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\tsubSection: Analytics.AnalyticsSubSection.window,\n\t\t\t\telement: Analytics.AnalyticsElement.recordButton,\n\t\t\t\trecordTime: Util.getRecordTimeText(this.commonRecord.info, true),\n\t\t\t});\n\n\t\t\tthis.#stopCommonRecord();\n\t\t}\n\t}\n\n\t_onCallUserFloorRequest(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setUserFloorRequestState(e.userId, e.requestActive);\n\t\t}\n\t}\n\n\t_onCallFailure(e)\n\t{\n\t\tconst errorCode = e.code || e.name || e.error;\n\n\t\tlet errorMessage = '';\n\t\tlet isUnknownError = false;\n\n\t\tif (e.name === 'VoxConnectionError' || e.name === 'AuthResult')\n\t\t{\n\t\t\tUtil.reportConnectionResult(e.call.id, false);\n\t\t}\n\n\t\tswitch (errorCode)\n\t\t{\n\t\t\tcase StartCallErrorCode.ErrorUnexpectedAnswer:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_UNEXPECTED_ANSWER');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.BlankAnswerWithErrorCode:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_BLANK_ANSWER');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.BlankAnswer:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_BLANK_ANSWER');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.AccessDenied:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_ACCESS_DENIED');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.NoWebrtc:\n\t\t\t\terrorMessage = Loc.getMessage(this.isHttps ? 'IM_CALL_NO_WEBRT' : 'IM_CALL_ERROR_HTTPS_REQUIRED');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.UnknownError:\n\t\t\t\tisUnknownError = true;\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_UNKNOWN');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.NetworkError:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_NETWORK');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.NotAllowedError:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_HARDWARE_ACCESS_DENIED');\n\t\t\t\tbreak;\n\n\t\t\tcase StartCallErrorCode.NotReadableError:\n\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_HARDWARE');\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (errorCode === StartCallErrorCode.AuthorizeError || e.name === 'AuthResult')\n\t\t\t\t{\n\t\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_AUTHORIZATION');\n\t\t\t\t}\n\t\t\t\telse if (errorCode == 403 && e.name === 'Failed')\n\t\t\t\t{\n\t\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_HARDWARE_ACCESS_DENIED');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tisUnknownError = true;\n\t\t\t\t\terrorMessage = Loc.getMessage('IM_CALL_ERROR_UNKNOWN_WITH_CODE', { '#ERROR_CODE#': errorCode });\n\t\t\t\t}\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tif (isUnknownError)\n\t\t\t{\n\t\t\t\tthis.callView.showSelfTest();\n\t\t\t}\n\t\t\telse if (errorCode === DisconnectReason.SecurityKeyChanged)\n\t\t\t{\n\t\t\t\tthis.callView.showSecurityKeyError();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.callView.showFatalError({ text: errorMessage });\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showNotification(errorMessage);\n\t\t}\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.autoCloseCallView = false;\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\n\t\t\tif (this.currentCallIsNew && this.isLegacyCall(this.currentCall.provider, this.currentCall.scheme))\n\t\t\t{\n\t\t\t\tBX.ajax.runAction('im.call.interrupt', { data: { callId: this.currentCall.id } });\n\t\t\t}\n\n\t\t\tthis.currentCall.destroy();\n\t\t\tthis.currentCall = null;\n\t\t\tthis.currentCallIsNew = false;\n\t\t}\n\n\t\tif (this.promotedToAdminTimeout)\n\t\t{\n\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t}\n\n\t\tHardware.isMicrophoneMuted = false;\n\t}\n\n\t_onNetworkProblem()\n\t{\n\t\tthis.showNetworkProblemNotification(BX.message(\"IM_M_CALL_TURN_UNAVAILABLE\"));\n\t}\n\n\t_onMicrophoneLevel(e)\n\t{\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.setMicrophoneLevel(e.level)\n\t\t}\n\t}\n\n\t_onReconnecting(e)\n\t{\n\t\t// todo: restore after fixing balloon resurrection issue\n\t\t// related to multiple simultaneous calls to the balloon manager\n\t\t// now it's enabled for calls as a temp solution\n\n\t\tAnalytics.getInstance().onReconnect({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\treconnectionReason: e.reconnectionReason,\n\t\t\treconnectionReasonInfo: e.reconnectionReasonInfo,\n\t\t\treconnectionEventCount: e.reconnectionEventCount,\n\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t});\n\n\t\t// noinspection UnreachableCodeJS\n\t\tif (this.reconnectionBaloon)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.reconnectionBaloon = BX.UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(BX.message('IM_CALL_RECONNECTING')),\n\t\t\tautoHide: false,\n\t\t\tposition: \"top-right\",\n\t\t\tcloseButton: false,\n\t\t})\n\t}\n\n\t_onReconnected()\n\t{\n\t\tthis.setReconnectingCameraId(this.lastUsedCameraId)\n\t\t// todo: restore after fixing balloon resurrection issue\n\t\t// related to multiple simultaneous calls to the balloon manager\n\t\t// now it's enabled for calls as a temp solution\n\n\t\t// noinspection UnreachableCodeJS\n\t\tthis._closeReconnectionBaloon();\n\t}\n\n\t_onReconnectingFailed(e)\n\t{\n\t\tAnalytics.getInstance().onReconnectError({\n\t\t\tcallId:  this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\terrorCode: e?.error?.code,\n\t\t\terrorMessage: e?.error?.message,\n\t\t\tisVpnActive: this.#isVpnConnected(),\n\t\t});\n\t}\n\n\t_onCustomMessage(event)\n\t{\n\t\t// there will be no more template selector in this call\n\t\tif (event.message === DOC_CREATED_EVENT)\n\t\t{\n\t\t\tthis.docCreatedForCurrentCall = true;\n\t\t\tthis.maxEditorWidth = DOC_EDITOR_WIDTH;\n\t\t}\n\t}\n\n\t_onJoinRoomOffer(event)\n\t{\n\t\tconsole.log(\"_onJoinRoomOffer\", event)\n\t\tif (!event.initiator && !this.currentCall.currentRoom())\n\t\t{\n\t\t\tthis.currentCall.joinRoom(event.roomId);\n\t\t\tthis.showRoomJoinedPopup(true, event.speaker == this.userId, event.users);\n\t\t}\n\t}\n\n\t_onJoinRoom(event)\n\t{\n\t\tconsole.log(\"_onJoinRoom\", event)\n\t\tif (event.speaker == this.userId)\n\t\t{\n\t\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\tthis.callView.muteSpeaker(true);\n\n\t\t\tthis.callView.setRoomState(View.RoomState.NonSpeaker);\n\t\t}\n\t}\n\n\t_onLeaveRoom()\n\t{\n\t\t// this.callView.setRoomState(View.RoomState.None);\n\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\t\tthis.callView.muteSpeaker(false);\n\t}\n\n\t_onTransferRoomSpeaker(event)\n\t{\n\t\tconsole.log(\"_onTransferRoomSpeaker\", event);\n\t\tif (event.speaker == this.userId)\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = false;\n\t\t\tthis.callView.setRoomState(View.RoomState.Speaker);\n\n\t\t\tif (event.initiator == this.userId)\n\t\t\t{\n\t\t\t\tthis.callView.muteSpeaker(false);\n\t\t\t\tthis.showMicTakenFromPopup(event.previousSpeaker);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tHardware.isMicrophoneMuted = true;\n\t\t\tthis.callView.muteSpeaker(true);\n\t\t\tthis.callView.setRoomState(View.RoomState.NonSpeaker);\n\n\t\t\tthis.showMicTakenByPopup(event.speaker);\n\t\t}\n\t}\n\n\t_onCallJoin(e)\n\t{\n\t\tif (this.callView && !this.clickLinkInterceptor)\n\t\t{\n\t\t\tthis.clickLinkInterceptor = this.getClickLinkInterceptor();\n\t\t\tthis.clickLinkInterceptor.startIntercepting();\n\t\t}\n\n\t\tif (e.local)\n\t\t{\n\t\t\t// self answer\n\t\t\tif (this.currentCall && (this.currentCall instanceof VoximplantCall))\n\t\t\t{\n\t\t\t\tUtil.reportConnectionResult(this.currentCall.id, true);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\t// remote answer, stop ringing and hide incoming cal notification\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tthis.currentCall = null;\n\t\t}\n\n\t\tif (this.promotedToAdminTimeout)\n\t\t{\n\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.close();\n\t\t}\n\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\t}\n\n\t_onCallLeave(e)\n\t{\n\t\tconsole.log(\"_onCallLeave\", e);\n\t\tif (!e.local && this.currentCall && this.currentCall.ready)\n\t\t{\n\t\t\tthis.log(new Error(\"received remote leave with active call!\"));\n\t\t\treturn;\n\t\t}\n\n\t\tHardware.isMicrophoneMuted = false;\n\n\t\tthis.#stopCommonRecord();\n\n\t\tthis.docCreatedForCurrentCall = false;\n\t\tlet callDetails;\n\n\t\tif (!this.getActiveCallUsers().length && Boolean(this.callView) && !this.isCallHangupButtonPressed)\n\t\t{\n\t\t\tAnalytics.getInstance().onFinishCall({\n\t\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\t\tcallType: this.getCallType(),\n\t\t\t\tstatus: Analytics.AnalyticsStatus.lastUserLeft,\n\t\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t\t\tcallUsersCount: this.getMaxActiveCallUsers().length,\n\t\t\t\tcallLength: Util.getTimeInSeconds(this.currentCall.startDate),\n\t\t\t});\n\n\t\t\tthis.isCallHangupButtonPressed = false;\n\t\t}\n\n\t\tif (this.currentCall && this.currentCall.associatedEntity)\n\t\t{\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\n\t\t\tcallDetails = this.#getCallDetail(this.currentCall);\n\t\t\tthis.currentCall = null;\n\t\t}\n\n\t\tif (this.promotedToAdminTimeout)\n\t\t{\n\t\t\tclearTimeout(this.promotedToAdminTimeout);\n\t\t}\n\n\t\tif (this.childCall)\n\t\t{\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserJoined, this._onChildCallFirstMediaHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstUserJoinedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\t\tthis.childCall.removeEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\t\t\tthis.childCall.hangup(false, '', true);\n\t\t\tthis.childCall = null;\n\t\t}\n\n\t\tif (this.callView)\n\t\t{\n\t\t\tthis.callView.close();\n\t\t}\n\n\t\tfor (const mediaStreamKind of Object.values(MediaStreamsKinds))\n\t\t{\n\t\t\tCallStreamManager.stopStream(mediaStreamKind);\n\t\t}\n\n\t\tthis.hasStreamFromCall = false;\n\t\tthis.#stopLocalStream();\n\n\t\tif (this.invitePopup)\n\t\t{\n\t\t\tthis.invitePopup.close();\n\t\t}\n\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.close();\n\t\t}\n\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.close();\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t}\n\n\t\tthis.togglePictureInPictureCallWindow({ isForceClose: true });\n\n\t\tthis.allowMutePopup = true;\n\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tDesktopApi.closeWindow(DesktopApi.findWindow('callBackground'));\n\t\t}\n\n\t\tthis.closePromo();\n\n\t\tthis._closeReconnectionBaloon();\n\t\tthis._closeParticipantsVideoBaloon();\n\n\t\tthis.messengerFacade.stopRepeatSound('dialtone');\n\t\tthis.messengerFacade.stopRepeatSound(this.audioRingtone);\n\n\t\tthis.hangupOptionsMenu?.destroy();\n\n\t\tif (this.clickLinkInterceptor)\n\t\t{\n\t\t\tthis.clickLinkInterceptor.stopIntercepting();\n\t\t\tthis.clickLinkInterceptor = null;\n\t\t}\n\n\t\tthis.emit(Events.onCallLeft, {\n\t\t\tcallDetails: callDetails\n\t\t});\n\t}\n\n\t#onGetUserMediaEnded()\n\t{\n\t\tHardware.getCurrentDeviceList();\n\t}\n\n\t_onUpdateLastUsedCameraId()\n\t{\n\t\tconst cameraId = this.currentCall.cameraId;\n\n\t\tif (cameraId)\n\t\t{\n\t\t\tthis.lastUsedCameraId = cameraId;\n\t\t}\n\t}\n\n\t#getCallDetail(call)\n\t{\n\t\treturn {\n\t\t\tid: this._getCallIdentifier(call),\n\t\t\tprovider: call.provider,\n\t\t\tchatId: call.associatedEntity.id,\n\t\t\tuserCount: call.users.length,\n\t\t\tbrowser: Util.getBrowserForStatistics(),\n\t\t\tisMobile: Browser.isMobile(),\n\t\t\tisConference: false,\n\t\t\twasConnected: call.wasConnected\n\t\t};\n\t}\n\n\t_onInvitePopupDestroy()\n\t{\n\t\tthis.invitePopup = null;\n\t\tthis.callView.setHotKeyTemporaryBlock(false);\n\t}\n\n\t_onInvitePopupSelect(e: {users: UserData})\n\t{\n\t\tthis.invitePopup.close();\n\n\t\tif (!this.currentCall || !e.users.length)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tAnalytics.getInstance().onInviteUser({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\tchatId: this.currentCall.associatedEntity.id,\n\t\t});\n\n\t\tconst currentUsers = this.currentCall.getUsers();\n\t\tconst usersToInvite = [];\n\t\tconst userData = {};\n\t\tlet totalUsers = Object.keys(currentUsers).length;\n\n\t\tconst newProvider = Util.getConferenceProvider();\n\t\tconst isLegacyCall = this.isLegacyCall(newProvider);\n\n\t\te.users.forEach((user) =>\n\t\t{\n\t\t\tconst userId = user.id;\n\t\t\tuserData[userId] = user;\n\n\t\t\tif (totalUsers < Util.getUserLimit() - 1 || currentUsers.hasOwnProperty(userId))\n\t\t\t{\n\t\t\t\ttotalUsers++;\n\t\t\t\tusersToInvite.push(userId);\n\t\t\t\tthis.callView.addUser(userId, UserState.Calling);\n\t\t\t}\n\t\t});\n\n\t\tUtil.setUserData(userData);\n\t\tthis.callView.updateUserData(userData);\n\n\t\tif (Util.isCallServerAllowed() && this.currentCall.provider === Provider.Plain)\n\t\t{\n\t\t\t// trying to switch to the server version of the call\n\t\t\tthis.removeVideoStrategy();\n\t\t\tthis.removeCallEvents();\n\t\t\tif (this.currentCall.isScreenSharingStarted())\n\t\t\t{\n\t\t\t\tthis.currentCall.stopScreenSharing();\n\t\t\t}\n\n\t\t\tconst onInviteSuccess = (call) => {\n\t\t\t\tthis.childCall = call;\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onUserJoined, this._onChildCallFirstUserJoinedHandler);\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onRemoteMediaReceived, this._onChildCallFirstMediaHandler);\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onLocalMediaReceived, this._onCallLocalMediaReceivedHandler);\n\t\t\t\tthis.childCall.addEventListener(CallEvent.onUserStateChanged, this._onCallUserStateChangedHandler);\n\n\t\t\t\tthis.updateDeviceIdInChildCall();\n\n\t\t\t\tconst options = {\n\t\t\t\t\tusers: isLegacyCall ? this.childCall.users : usersToInvite,\n\t\t\t\t\tshow: isLegacyCall,\n\t\t\t\t};\n\n\t\t\t\tthis.childCall.inviteUsers(options);\n\n\t\t\t\tthis.callView.updateCopilotFeatureState(this.childCall?.isCopilotFeaturesEnabled);\n\t\t\t};\n\n\t\t\tconst onInviteFailure = (error) => {\n\t\t\t\tthis.log('Can\\'t invite users', error);\n\t\t\t\tthis.bindCallEvents();\n\n\t\t\t\tusersToInvite.forEach((userId) => {\n\t\t\t\t\tthis.callView.setUserState(userId, UserState.Idle);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tconst createChildCallPromise = isLegacyCall\n\t\t\t\t? CallEngineLegacy.createChildCall(\n\t\t\t\t\tthis.currentCall.id,\n\t\t\t\t\tnewProvider,\n\t\t\t\t\tusersToInvite,\n\t\t\t\t\t{ debug: this.debug },\n\t\t\t\t)\n\t\t\t\t: CallEngine.createChildCall(\n\t\t\t\t\tthis.currentCall,\n\t\t\t\t\tnewProvider,\n\t\t\t\t\tusersToInvite,\n\t\t\t\t\t{ debug: this.debug, videoEnabled: Hardware.isCameraOn },\n\t\t\t\t);\n\n\t\t\tcreateChildCallPromise\n\t\t\t\t.then((callData) => onInviteSuccess(callData.call))\n\t\t\t\t.catch((error) => onInviteFailure(error));\n\n\t\t\tthis.callView.removeScreenUsers();\n\t\t}\n\t\telse if (usersToInvite.length > 0)\n\t\t{\n\t\t\tthis.currentCall.inviteUsers({\n\t\t\t\tuserData,\n\t\t\t\tusers: usersToInvite,\n\t\t\t\tshow: true,\n\t\t\t});\n\t\t}\n\t}\n\n\t_onDocumentBodyClick(event)\n\t{\n\t\tconst { target } = event;\n\n\t\tif (target.matches('input[type=\"file\"]'))\n\t\t{\n\t\t\tthis.onInputFileOpenedStateUpdate(true);\n\t\t}\n\t}\n\n\t_onWindowFocus()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis._onWindowDesktopFocus();\n\t\t}\n\n\t\tif (DesktopApi.isDesktop() && this.isFileChooserActive)\n\t\t{\n\t\t\tthis.onInputFileOpenedStateUpdate(false);\n\t\t}\n\n\t\tthis.updateWindowFocusState(true);\n\t}\n\n\n\t_onWindowBlur()\n\t{\n\t\tif (DesktopApi.isDesktop())\n\t\t{\n\t\t\tthis._onWindowDesktopBlur();\n\t\t}\n\n\t\tthis.updateWindowFocusState(false);\n\t}\n\n\t_onWindowDesktopFocus()\n\t{\n\t\tif (!this.detached)\n\t\t{\n\t\t\tclearTimeout(this.showFloatingWindowTimeout);\n\t\t\tclearTimeout(this.showFloatingScreenShareWindowTimeout);\n\t\t\tif (this.floatingWindow)\n\t\t\t{\n\t\t\t\tthis.floatingWindow.hide();\n\t\t\t}\n\t\t\tif (this.floatingScreenShareWindow)\n\t\t\t{\n\t\t\t\tthis.floatingScreenShareWindow.hide();\n\t\t\t}\n\t\t}\n\t}\n\n\t_onWindowDesktopBlur()\n\t{\n\t\tclearTimeout(this.showFloatingWindowTimeout);\n\t\tclearTimeout(this.showFloatingScreenShareWindowTimeout);\n\t\tif (this.currentCall && this.floatingWindow && this.callView)\n\t\t{\n\t\t\tthis.showFloatingWindowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall && this.floatingWindow && this.callView)\n\t\t\t\t{\n\t\t\t\t\tthis.floatingWindow.setTitle(this.currentCall.associatedEntity.name);\n\t\t\t\t\tUtil.getUserAvatars(this.currentCall.id, this.getActiveCallUsers()).then((result) =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.floatingWindow.setAvatars(result);\n\t\t\t\t\t\tthis.floatingWindow.show();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, 300);\n\t\t}\n\n\t\tif (this.currentCall && this.floatingScreenShareWindow && this.callView && this.currentCall.isScreenSharingStarted())\n\t\t{\n\t\t\tthis.showFloatingScreenShareWindowTimeout = setTimeout(() =>\n\t\t\t{\n\t\t\t\tif (this.currentCall && this.floatingScreenShareWindow && this.callView && this.currentCall.isScreenSharingStarted())\n\t\t\t\t{\n\t\t\t\t\tthis.floatingScreenShareWindow.show();\n\t\t\t\t}\n\t\t\t}, 300);\n\t\t}\n\t}\n\n\t_onBeforeUnload(e)\n\t{\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.close();\n\t\t}\n\t\tif (this.callNotification)\n\t\t{\n\t\t\tthis.callNotification.close();\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\t\tif (this.participantsPermissionPopup)\n\t\t{\n\t\t\tthis.participantsPermissionPopup.close();\n\t\t}\n\t\tif (this.hasActiveCall())\n\t\t{\n\t\t\te.preventDefault();\n\t\t\te.returnValue = '';\n\t\t}\n\t}\n\n\t_onImTabChange(currentTab)\n\t{\n\t\tif (currentTab === \"notify\" && this.currentCall && this.callView)\n\t\t{\n\t\t\tthis.fold(Text.decode(this.currentCall.associatedEntity.name));\n\t\t}\n\t}\n\n\t_onUpdateChatCounter(counter)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.associatedEntity || !this.currentCall.associatedEntity.id || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Number.isNaN(parseInt(counter, 10)))\n\t\t{\n\t\t\tUtil.sendLog(`[call] setButtonCounter chat: counter = ${counter} (NaN)`);\n\t\t}\n\t\tthis.callView.setButtonCounter(\"chat\", counter);\n\t}\n\n\t_onDeviceChange(e)\n\t{\n\t\tif (!this.currentCall || !this.currentCall.ready)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst allAddedDevice = e.data.added;\n\t\tconst allRemovedDevice = e.data.removed\n\t\tconst removed = Hardware.getRemovedUsedDevices(\n\t\t\te.data.removed,\n\t\t\t{\n\t\t\t\tmicrophoneId: this.currentCall.microphoneId,\n\t\t\t\tcameraId: this.currentCall.cameraId,\n\t\t\t\tspeakerId: this.callView.speakerId,\n\t\t\t}\n\t\t);\n\n\t\tthis.log(\"New devices: \", allAddedDevice);\n\t\tif (allAddedDevice)\n\t\t{\n\t\t\tsetTimeout(() => this.useDevicesInCurrentCall(allAddedDevice), 500);\n\t\t}\n\n\t\tthis.log(\"Removed devices: \", allRemovedDevice);\n\t\tif (removed.length > 0)\n\t\t{\n\t\t\tthis.log(\"Removed devices: \", removed);\n\t\t\tBX.UI.Notification.Center.notify({\n\t\t\t\tcontent: BX.message(\"IM_CALL_DEVICES_DETACHED\") + \"<br><ul>\" + removed.map(function (deviceInfo)\n\t\t\t\t{\n\t\t\t\t\treturn \"<li>\" + deviceInfo.label\n\t\t\t\t}) + \"</ul>\",\n\t\t\t\tposition: \"top-right\",\n\t\t\t\tautoHideDelay: 10000,\n\t\t\t\tcloseButton: true,\n\t\t\t\t//category: \"call-device-change\",\n\t\t\t\tactions: [{\n\t\t\t\t\ttitle: BX.message(\"IM_CALL_DEVICES_CLOSE\"),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function (event, balloon)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tballoon.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t});\n\t\t}\n\n\t\tif (allRemovedDevice)\n\t\t{\n\t\t\tsetTimeout(() => this.removeDevicesFromCurrentCall(allRemovedDevice), 500);\n\t\t}\n\t}\n\n\t_onFloatingVideoMainAreaClick()\n\t{\n\t\tDesktopApi.activateWindow();\n\t\tDesktopApi.changeTab(\"im\");\n\n\t\tif (!this.currentCall)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall.associatedEntity && this.currentCall.associatedEntity.id)\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger(this.currentCall.associatedEntity.id);\n\t\t}\n\t\telse if (!this.messengerFacade.isMessengerOpen())\n\t\t{\n\t\t\tthis.messengerFacade.openMessenger();\n\t\t}\n\n\t\tif (this.detached)\n\t\t{\n\t\t\tthis.container.style.removeProperty('width');\n\t\t\tthis.callView.show();\n\t\t\tthis.detached = false;\n\t\t}\n\t}\n\n\t_onFloatingVideoButtonClick(e)\n\t{\n\t\tswitch (e.buttonName)\n\t\t{\n\t\t\tcase \"toggleMute\":\n\t\t\t\tthis._onCallViewToggleMuteButtonClick(e);\n\t\t\t\tbreak;\n\t\t\tcase \"hangup\":\n\t\t\t\tthis._onCallViewHangupButtonClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t_onFloatingScreenShareBackToCallClick()\n\t{\n\t\tDesktopApi.activateWindow();\n\t\tDesktopApi.changeTab(\"im\");\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.hide();\n\t\t}\n\t}\n\n\t_onFloatingScreenShareStopClick()\n\t{\n\t\tDesktopApi.activateWindow();\n\t\tDesktopApi.changeTab(\"im\");\n\n\t\tthis.currentCall.stopScreenSharing();\n\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.close();\n\t\t}\n\n\t\tif (this.#isCommonRecordStarted() && this.#canLocalRecord())\n\t\t{\n\t\t\tBXDesktopSystem.CallRecordStopSharing();\n\t\t}\n\t}\n\n\t_onFloatingScreenShareChangeScreenClick()\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tthis.currentCall.startScreenSharing(true);\n\t\t}\n\t}\n\n\t_onResize()\n\t{\n\t\tif (this.sidebar && this.callView)\n\t\t{\n\t\t\tconst result = this.findCallEditorWidth();\n\t\t\tconst callWidth = result.callWidth;\n\t\t\tconst editorWidth = result.editorWidth;\n\n\t\t\tthis.callView.setMaxWidth(callWidth);\n\t\t\tthis.sidebar.setWidth(editorWidth);\n\t\t}\n\t}\n\n\tdestroy()\n\t{\n\t\tif (this.floatingWindow)\n\t\t{\n\t\t\tthis.floatingWindow.destroy();\n\t\t\tthis.floatingWindow = null;\n\t\t}\n\t\tif (this.floatingScreenShareWindow)\n\t\t{\n\t\t\tthis.floatingScreenShareWindow.destroy();\n\t\t\tthis.floatingScreenShareWindow = null;\n\t\t}\n\t\tif (this.resizeObserver)\n\t\t{\n\t\t\tthis.resizeObserver.disconnect();\n\t\t\tthis.resizeObserver = null;\n\t\t}\n\n\t\tthis.callMultiBroadcastClient && this.callMultiBroadcastClient.destroy()\n\n\t\tHardware.unsubscribe(Hardware.Events.onChangeMirroringVideo, this._onCallLocalCameraFlipHandler);\n\t}\n\n\tlog()\n\t{\n\t\tif (this.currentCall)\n\t\t{\n\t\t\tlet arr = [this._getCallIdentifier(this.currentCall)];\n\n\t\t\tCallEngine.log.apply(CallEngine, arr.concat(Array.prototype.slice.call(arguments)));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tCallEngine.log.apply(CallEngine, arguments);\n\t\t}\n\t}\n\n\ttest(users = [473, 464], videoOptions = {width: 320, height: 180}, audioOptions = false)\n\t{\n\t\tthis.messengerFacade.openMessenger().then(() =>\n\t\t{\n\t\t\treturn (videoOptions || audioOptions) ? Hardware.init() : null;\n\t\t}).then(() =>\n\t\t{\n\t\t\tthis.createContainer();\n\t\t\tlet hiddenButtons = ['floorRequest'];\n\t\t\tif (!Util.shouldShowDocumentButton())\n\t\t\t{\n\t\t\t\thiddenButtons.push('document');\n\t\t\t}\n\n\t\t\tthis.callView = new View({\n\t\t\t\tcontainer: this.container,\n\t\t\t\tbaseZIndex: this.messengerFacade.getDefaultZIndex(),\n\t\t\t\tshowChatButtons: true,\n\t\t\t\tshowUsersButton: true,\n\t\t\t\tuserLimit: 48,\n\t\t\t\tlanguage: this.language,\n\t\t\t\tlayout: View.Layout.Grid,\n\t\t\t\thiddenButtons: hiddenButtons,\n\t\t\t\tblockedButtons: this.getBlockedButtons(),\n\t\t\t\tisWindowFocus: this.isWindowFocus,\n\t\t\t});\n\n\t\t\tthis.lastUserId = 1;\n\n\t\t\tthis.callView.setCallback('onButtonClick', (e) => this._onTestCallViewButtonClick(e));\n\t\t\t//this.callView.blockAddUser();\n\t\t\tthis.callView.setCallback(View.Event.onUserClick, (e) =>\n\t\t\t{\n\t\t\t\tif (!e.stream)\n\t\t\t\t{\n\t\t\t\t\tthis.callView.setUserState(e.userId, UserState.Connected);\n\t\t\t\t\tthis.callView.setUserMedia(e.userId, 'video', this.stream2.getVideoTracks()[0]);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.callView.setUiState(View.UiState.Connected);\n\t\t\tthis.callView.setCallback(View.Event.onBodyClick, this._onCallViewBodyClick.bind(this));\n\t\t\tthis.callView.setCallback('onShow', this._onCallViewShow.bind(this));\n\t\t\tthis.callView.setCallback('onClose', this._onCallViewClose.bind(this));\n\t\t\tthis.callView.setCallback('onReplaceMicrophone', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceMicrophone\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback('onReplaceCamera', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceCamera\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback('onReplaceSpeaker', function (e)\n\t\t\t{\n\t\t\t\tconsole.log(\"onReplaceSpeaker\", e);\n\t\t\t});\n\t\t\tthis.callView.setCallback(View.Event.onOpenAdvancedSettings,  (e) =>\n\t\t\t{\n\t\t\t\tconsole.log(\"onOpenAdvancedSettings\", e);\n\t\t\t\tthis._onCallViewOpenAdvancedSettings()\n\t\t\t});\n\t\t\tthis.callView.show();\n\n\t\t\tif (audioOptions || videoOptions)\n\t\t\t{\n\t\t\t\treturn CallStreamManager.getUserMedia({\n\t\t\t\t\taudio: audioOptions,\n\t\t\t\t\tvideo: videoOptions,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn new MediaStream();\n\t\t}).then((s) =>\n\t\t{\n\t\t\tthis.stream = s;\n\t\t\tconst streamData = {\n\t\t\t\tstream: this.stream,\n\t\t\t};\n\t\t\tthis.callView.setLocalStream(streamData);\n\t\t\tusers.forEach(userId => this.callView.addUser(userId, UserState.Connected));\n\n\t\t\tif (audioOptions !== false)\n\t\t\t{\n\t\t\t\tthis.vad = new SimpleVAD({\n\t\t\t\t\tmediaStream: this.stream\n\t\t\t\t});\n\t\t\t\tsetInterval(() => this.callView.setMicrophoneLevel(this.vad.currentVolume), 100)\n\t\t\t}\n\n\t\t\tif (videoOptions)\n\t\t\t{\n\t\t\t\treturn CallStreamManager.getUserMedia({\n\t\t\t\t\taudio: false,\n\t\t\t\t\tvideo: {\n\t\t\t\t\t\twidth: 320,\n\t\t\t\t\t\theight: 180,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn new MediaStream();\n\t\t}).then((s2) =>\n\t\t{\n\t\t\tthis.stream2 = s2;\n\t\t\t/*users.forEach(function(userId)\n\t\t\t\t {\n\t\t\t\t\tthis.callView.setUserMedia(userId, 'video', stream2.getVideoTracks()[0]);\n\t\t\t\t},this);*/\n\n\t\t\tthis.callView.setUserMedia(users[0], 'video', this.stream2.getVideoTracks()[0]);\n\n\t\t\tBX.rest.callMethod('im.user.list.get', {\n\t\t\t\t'ID': users.concat(this.userId),\n\t\t\t\t'AVATAR_HR': 'Y'\n\t\t\t}).then((response) => this.callView.updateUserData(response.data()));\n\n\t\t});\n\t}\n\n\t_onTestCallViewButtonClick(e)\n\t{\n\t\tconsole.log(e.buttonName);\n\t\tswitch (e.buttonName)\n\t\t{\n\t\t\tcase \"hangup\":\n\t\t\tcase \"close\":\n\t\t\t\tthis.callView.close();\n\t\t\t\tbreak;\n\t\t\tcase \"inviteUser\":\n\t\t\t\t/*this.lastUserId++;\n\t\t\t\tBX.rest.callMethod('im.user.list.get', {\n\t\t\t\t\t'ID': [this.lastUserId],\n\t\t\t\t\t'AVATAR_HR': 'Y'\n\t\t\t\t}).then((response) => this.callView.updateUserData(response.data()))\n\n\t\t\t\tthis.callView.addUser(this.lastUserId, UserState.Connecting);*/\n\n\t\t\t\tthis._onCallViewInviteUserButtonClick(e)\n\t\t\t\t//this.callView.setStream(lastUserId, stream2);\n\t\t\t\tbreak;\n\t\t\tcase \"fullscreen\":\n\t\t\t\tthis.toggleFullScreen();\n\n\t\t\t\tbreak;\n\t\t\tcase 'record':\n\t\t\t\tthis.#onCallViewRecordButtonClick(e);\n\n\t\t\t\tbreak;\n\t\t\tcase \"floorRequest\":\n\t\t\t\tthis._onCallViewFloorRequestButtonClick(e);\n\t\t\t\tbreak;\n\n\t\t\tcase \"showChat\":\n\t\t\t\tthis.fold(\"asd \\\"asd\\\"\");\n\n\t\t\t\tbreak;\n\n\t\t\tcase \"toggleScreenSharing\":\n\t\t\t\tthis.callView.setUserMedia(464, 'screen', this.stream2.getVideoTracks()[0]);\n\n\t\t\t\t/*setTimeout(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.callView.setUserScreenState(464, true);\n\t\t\t\t\t}.bind(this), 0);*/\n\t\t\t\tbreak;\n\n\t\t\tcase \"returnToCall\":\n\t\t\t\tbreak;\n\n\t\t\tcase \"document\":\n\t\t\t\tthis._onCallViewDocumentButtonClick();\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\ttestIncoming(hasCamera)\n\t{\n\t\tthis.callNotification = new IncomingNotification({\n\t\t\tcallerName: \"this.currentCall.associatedEntity.name\",\n\t\t\tcallerAvatar: \"this.currentCall.associatedEntity.avatar\",\n\t\t\tcallerType: \"this.currentCall.associatedEntity.advanced.chatType\",\n\t\t\tcallerColor: \"\",\n\t\t\tvideo: true,\n\t\t\thasCamera: !!hasCamera,\n\t\t\tzIndex: this.messengerFacade.getDefaultZIndex() + 200,\n\t\t\tonClose: this._onCallNotificationClose.bind(this),\n\t\t\tonDestroy: this._onCallNotificationDestroy.bind(this),\n\t\t\tonButtonClick: (e) =>\n\t\t\t{\n\t\t\t\tconsole.log('button pressed', e.data);\n\t\t\t\tthis.callNotification.close()\n\t\t\t}\n\t\t});\n\n\t\tthis.callNotification.show();\n\t}\n\n\tgetMaxActiveMicrophonesCount()\n\t{\n\t\treturn 4;\n\t}\n\n\tshowRiseYouHandToTalkNotification(params)\n\t{\n\t\tif (!this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.riseYouHandToTalkPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.mutePopup)\n\t\t{\n\t\t\tthis.mutePopup.close();\n\t\t\tthis.mutePopup = null;\n\t\t}\n\n\t\tthis.riseYouHandToTalkPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.folded ? null : this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ticon: 'mic',\n\t\t\tshowAngle: false,\n\t\t\tinitiatorName: params.initiatorName,\n\t\t\tcustomClassName: 'bx-call-view-popup-call-hint-rise-hand-to-talk',\n\t\t\tautoCloseDelay: (30 * 60 * 1000), // show it 30 minutes\n\t\t\tcustomRender: function(){\n\t\t\t\tlet handRaiseContentElement = Dom.create(\"div\", {\n\t\t\t\t\tprops: {className: \"bx-call-view-popup-call-hint-rise-block\"},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tLoc.getMessage('CALL_ADMIN_PROHIBITED_TURN_ON_PARTICIPANTS_MICROPHONES_HINT', {\n\t\t\t\t\t\t\t'#INITIATOR_NAME#': this.initiatorName,\n\t\t\t\t\t\t\t'[hint-label]': `<div class=\"bx-call-view-popup-call-hint-text\">`,\n\t\t\t\t\t\t\t'[/hint-label]': '</div>',\n\t\t\t\t\t\t\t'#RISE_HAND_ICON#': `<div class=\"ui-btn bx-call-view-popup-call-hint-hand-raise-icon\"></div>`,\n\t\t\t\t\t\t\t'[label-or]': `<div class=\"bx-call-view-popup-call-hint-hand-raise-or-label\">`,\n\t\t\t\t\t\t\t'[/label-or]': '</div>',\n\t\t\t\t\t\t\t'#REQUEST_NOW_BUTTON#': `<div class = \"bx-call-view-popup-call-hint-button-placeholder\"></div>`,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\t\tlet buttonPlaceholder = handRaiseContentElement.getElementsByClassName('bx-call-view-popup-call-hint-button-placeholder')[0];\n\n\t\t\t\tbuttonPlaceholder.replaceWith(this.createAskSpeakButton().render());\n\n\t\t\t\treturn handRaiseContentElement;\n\t\t\t},\n\t\t\tbuttons: [],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t\t},\n\t\t\tonAskSpeakButtonClicked: () =>\n\t\t\t{\n\t\t\t\tthis._onCallViewFloorRequestButtonClick();\n\n\t\t\t\tif (this.riseYouHandToTalkPopup)\n\t\t\t\t{\n\t\t\t\t\tthis.riseYouHandToTalkPopup.close();\n\t\t\t\t\tthis.riseYouHandToTalkPopup = null;\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t\tthis.riseYouHandToTalkPopup.show();\n\t}\n\n\tshowMicMutedNotification()\n\t{\n\t\tif (this.mutePopup || !this.callView || this.riseYouHandToTalkPopup || !Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mutePopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ticon: 'mic-off',\n\t\t\tbuttons: [\n\t\t\t\tthis.createUnmuteButton()\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.allowMutePopup = false;\n\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\tthis.mutePopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.mutePopup.show();\n\t}\n\n\tshowAutoMicMuteNotification()\n\t{\n\t\tif (this.mutePopup || !this.callView || this.riseYouHandToTalkPopup || !Util.havePermissionToBroadcast('mic'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.mutePopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ttitle: Text.encode(BX.message(\"IM_CALL_MIC_AUTO_MUTED\")),\n\t\t\ticon: 'mic-off',\n\t\t\tbuttons: [\n\t\t\t\tthis.createUnmuteButton()\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\tthis.mutePopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.mutePopup.show();\n\t}\n\n\tcreateUnmuteButton()\n\t{\n\t\treturn new BX.UI.Button({\n\t\t\tbaseClass: \"ui-btn bx-call-view-popup-call-hint-unmute\",\n\t\t\ttext: BX.message(\"IM_CALL_UNMUTE_MIC\"),\n\t\t\tsize: BX.UI.Button.Size.EXTRA_SMALL,\n\t\t\tcolor: BX.UI.Button.Color.LIGHT_BORDER,\n\t\t\tnoCaps: true,\n\t\t\tround: true,\n\t\t\tevents: {\n\t\t\t\tclick: () =>\n\t\t\t\t{\n\t\t\t\t\tthis._onCallViewToggleMuteButtonClick({\n\t\t\t\t\t\tmuted: false\n\t\t\t\t\t});\n\t\t\t\t\tif (this.mutePopup)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.mutePopup.destroy();\n\t\t\t\t\t\tthis.mutePopup = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\t_onCallToggleSubscribe(e) {\n\t\tif (this.currentCall && this.currentCall.provider === Provider.Bitrix)\n\t\t{\n\t\t\tthis.currentCall.toggleRemoteParticipantVideo(e.participants, e.showVideo, true)\n\t\t}\n\t}\n\n\t_onChangeVideoQuality(event)\n\t{\n\t\tif (this.currentCall && this.currentCall.provider === Provider.Bitrix)\n\t\t{\n\t\t\tconst params = {\n\t\t\t\tisCameraWasEnabledBeforeQualityChanged: event.isCameraWasEnabledBeforeQualityChanged,\n\t\t\t\tvideoQuality: event.videoQuality,\n\t\t\t\totherUsers: this.currentCall.users,\n\t\t\t};\n\t\t\tthis.currentCall.setVideoQualityForStreams(params);\n\t\t}\n\t}\n\n\t_onCallUserClick(e)\n\t{\n\t\tAnalytics.getInstance().onClickUser({\n\t\t\tcallId: this._getCallIdentifier(this.currentCall),\n\t\t\tcallType: this.getCallType(),\n\t\t\tlayout: Object.keys(View.Layout).find(key => View.Layout[key] === e.layout),\n\t\t});\n\t}\n\n\ttoggleRoomMenu(bindElement)\n\t{\n\t\tif (this.roomMenu)\n\t\t{\n\t\t\tthis.roomMenu.destroy();\n\t\t\treturn;\n\t\t}\n\n\t\tconst roomSpeaker = this.currentCall.currentRoom().speaker;\n\t\tconst speakerModel = this.callView.userRegistry.get(roomSpeaker);\n\t\tlet avatarText = ''\n\n\t\tif (!speakerModel)\n\t\t{\n\t\t\tavatarText = Utils.text.getFirstLetters(speakerModel.name).toUpperCase();\n\t\t}\n\n\t\tthis.roomMenu = new Menu({\n\t\t\ttargetContainer: this.container,\n\t\t\tbindElement: bindElement,\n\t\t\titems: [\n\t\t\t\t{text: BX.message(\"IM_CALL_SOUND_PLAYS_VIA\"), disabled: true},\n\t\t\t\t{html: `<div class=\"bx-messenger-videocall-room-menu-avatar\" style=\"--avatar: url('${Text.encode(speakerModel.avatar)}')\">${avatarText}</div>${Text.encode(speakerModel.name)}`},\n\t\t\t\t{delimiter: true},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_CALL_LEAVE_ROOM\"),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.leaveCurrentRoom();\n\t\t\t\t\t\tthis.roomMenu.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{delimiter: true},\n\t\t\t\t{\n\t\t\t\t\ttext: BX.message(\"IM_CALL_HELP\"),\n\t\t\t\t\tonclick: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showRoomHelp();\n\t\t\t\t\t\tthis.roomMenu.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tonDestroy: () => this.roomMenu = null\n\t\t\t}\n\t\t});\n\t\tthis.roomMenu.show();\n\t}\n\n\ttoggleRoomListMenu(bindElement)\n\t{\n\t\tif (this.roomListMenu)\n\t\t{\n\t\t\tthis.roomListMenu.destroy();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentCall?.listRooms)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentCall.listRooms().then((roomList) =>\n\t\t{\n\t\t\tthis.roomListMenu = new BX.PopupMenuWindow({\n\t\t\t\tclassName: 'bx-call-context-menu-options-container',\n\t\t\t\tbackground: '#00428F',\n\t\t\t\tcontentBackground: '#00428F',\n\t\t\t\tdarkMode: true,\n\t\t\t\tcontentBorderRadius: '6px',\n\t\t\t\tborderRadius: '6px',\n\t\t\t\ttargetContainer: this.container,\n\t\t\t\tbindElement: bindElement,\n\t\t\t\titems: this.prepareRoomListMenuItems(roomList),\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: () => this.roomListMenu = null\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.roomListMenu.show();\n\t\t})\n\t}\n\n\tprepareRoomListMenuItems(roomList)\n\t{\n\t\tlet menuItems = [\n\t\t\t{text: BX.message(\"IM_CALL_JOIN_ROOM\"), disabled: true},\n\t\t\t{delimiter: true},\n\t\t];\n\t\tmenuItems = menuItems.concat(...roomList.map(room =>\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.getRoomDescription(room),\n\t\t\t\tonclick: () =>\n\t\t\t\t{\n\t\t\t\t\tif (this.currentCall && this.currentCall.joinRoom)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.currentCall.joinRoom(room.id);\n\t\t\t\t\t}\n\t\t\t\t\tthis.roomListMenu.destroy();\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tmenuItems.push({delimiter: true});\n\t\tmenuItems.push({\n\t\t\ttext: BX.message(\"IM_CALL_HELP\"),\n\t\t\tonclick: () =>\n\t\t\t{\n\t\t\t\tthis.showRoomHelp();\n\t\t\t\tthis.roomMenu.close();\n\t\t\t}\n\t\t})\n\n\t\treturn menuItems;\n\t}\n\n\tshowRoomHelp()\n\t{\n\t\tBX.loadExt('ui.dialogs.messagebox').then(() =>\n\t\t{\n\t\t\tBX.UI.Dialogs.MessageBox.alert(\n\t\t\t\tBX.message(\"IM_CALL_HELP_TEXT\"),\n\t\t\t\tBX.message(\"IM_CALL_HELP\")\n\t\t\t);\n\t\t})\n\t}\n\n\tgetRoomDescription(roomFields)\n\t{\n\t\tconst userNames = roomFields.userList.map(userId =>\n\t\t{\n\t\t\tconst userModel = this.callView.userRegistry.get(userId);\n\t\t\treturn userModel.name;\n\t\t})\n\n\t\tlet result = BX.message(\"IM_CALL_ROOM_DESCRIPTION\");\n\t\tresult = result.replace(\"#ROOM_ID#\", roomFields.id)\n\t\tresult = result.replace(\"#PARTICIPANTS_LIST#\", userNames.join(\", \"))\n\t\treturn result;\n\t}\n\n\tshowRoomJoinedPopup(isAuto, isSpeaker, userIdList)\n\t{\n\t\tif (this.roomJoinedPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet title;\n\t\tif (!isAuto)\n\t\t{\n\t\t\ttitle = BX.message(\"IM_CALL_ROOM_JOINED_MANUALLY\") + \"<p>\" + BX.message(\"IM_CALL_ROOM_JOINED_P2\") + \"</p>\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst userNames = userIdList.filter(userId => userId != this.userId).map(userId =>\n\t\t\t{\n\t\t\t\tconst userModel = this.callView.userRegistry.get(userId);\n\t\t\t\treturn userModel.name;\n\t\t\t})\n\n\t\t\tconst usersInRoom = userNames.join(\", \");\n\t\t\tif (isSpeaker)\n\t\t\t{\n\t\t\t\ttitle = BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_AUTO_SPEAKER\").replace(\"#PARTICIPANTS_LIST#\", usersInRoom));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttitle = BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_AUTO\").replace(\"#PARTICIPANTS_LIST#\", usersInRoom));\n\t\t\t\ttitle += \"<p>\" + BX.Text.encode(BX.message(\"IM_CALL_ROOM_JOINED_P2\")) + \"</p>\";\n\t\t\t}\n\t\t}\n\n\t\tthis.roomJoinedPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ttitle: title,\n\t\t\tbuttonsLayout: \"bottom\",\n\t\t\tautoCloseDelay: 0,\n\t\t\tbuttons: [\n\t\t\t\tnew Button({\n\t\t\t\t\tbaseClass: \"ui-btn\",\n\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_JOINED_UNDERSTOOD\"),\n\t\t\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\t\t\tcolor: Button.Color.LIGHT_BORDER,\n\t\t\t\t\tnoCaps: true,\n\t\t\t\t\tround: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t\tnew Button({\n\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_WRONG_ROOM\"),\n\t\t\t\t\tsize: Button.Size.EXTRA_SMALL,\n\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\tnoCaps: true,\n\t\t\t\t\tround: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: () =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t\t\t\t\tthis.currentCall.leaveCurrentRoom();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.roomJoinedPopup.destroy();\n\t\t\t\tthis.roomJoinedPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.roomJoinedPopup.show();\n\t}\n\n\tshowMicTakenFromPopup(fromUserId)\n\t{\n\t\tif (this.micTakenFromPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userModel = this.callView.userRegistry.get(fromUserId);\n\t\tconst title = BX.message(\"IM_CALL_ROOM_MIC_TAKEN_FROM\").replace('#USER_NAME#', userModel.name);\n\t\tthis.micTakenFromPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ttitle: BX.Text.encode(title),\n\t\t\tbuttonsLayout: \"right\",\n\t\t\tautoCloseDelay: 5000,\n\t\t\tbuttons: [\n\t\t\t\t/*new Button({\n\t\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_DETAILS\"),\n\t\t\t\t\t\tsize: Button.Size.SMALL,\n\t\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\t\tnoCaps: true,\n\t\t\t\t\t\tround: true,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {this.micTakenFromPopup.destroy(); this.micTakenFromPopup = null;}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),*/\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.micTakenFromPopup.destroy();\n\t\t\t\tthis.micTakenFromPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.micTakenFromPopup.show();\n\t}\n\n\tshowMicTakenByPopup(byUserId)\n\t{\n\t\tif (this.micTakenByPopup || !this.callView)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userModel = this.callView.userRegistry.get(byUserId);\n\n\t\tthis.micTakenByPopup = new CallHint({\n\t\t\tcallFolded: this.folded,\n\t\t\tbindElement: this.callView.buttons.microphone.elements.icon,\n\t\t\ttargetContainer: this.folded ? this.getExternalContainer() : this.callView.container,\n\t\t\ttitle: BX.Text.encode(BX.message(\"IM_CALL_ROOM_MIC_TAKEN_BY\").replace('#USER_NAME#', userModel.name)),\n\t\t\tbuttonsLayout: \"right\",\n\t\t\tautoCloseDelay: 5000,\n\t\t\tbuttons: [\n\t\t\t\t/*new Button({\n\t\t\t\t\t\ttext: BX.message(\"IM_CALL_ROOM_DETAILS\"),\n\t\t\t\t\t\tsize: Button.Size.SMALL,\n\t\t\t\t\t\tcolor: Button.Color.LINK,\n\t\t\t\t\t\tnoCaps: true,\n\t\t\t\t\t\tround: true,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tclick: () => {this.micTakenByPopup.destroy(); this.micTakenByPopup = null;}\n\t\t\t\t\t\t}\n\t\t\t\t\t}),*/\n\t\t\t],\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.micTakenByPopup.destroy();\n\t\t\t\tthis.micTakenByPopup = null;\n\t\t\t},\n\t\t});\n\t\tthis.micTakenByPopup.show();\n\t}\n\n\tshowWebScreenSharePopup()\n\t{\n\t\tif (this.webScreenSharePopup)\n\t\t{\n\t\t\tthis.webScreenSharePopup.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.webScreenSharePopup = new WebScreenSharePopup({\n\t\t\tbindElement: this.callView.buttons.screen.elements.root,\n\t\t\ttargetContainer: this.callView.container,\n\t\t\tonClose: () =>\n\t\t\t{\n\t\t\t\tthis.webScreenSharePopup.destroy();\n\t\t\t\tthis.webScreenSharePopup = null;\n\t\t\t},\n\t\t\tonStopSharingClick: () =>\n\t\t\t{\n\t\t\t\tthis._onCallViewToggleScreenSharingButtonClick();\n\t\t\t\tthis.webScreenSharePopup.destroy();\n\t\t\t\tthis.webScreenSharePopup = null;\n\t\t\t}\n\t\t});\n\t\tthis.webScreenSharePopup.show();\n\t}\n\n\tshowFeedbackPopup(callDetails)\n\t{\n\t\tif (!callDetails)\n\t\t{\n\t\t\tif (this.lastCallDetails)\n\t\t\t{\n\t\t\t\tcallDetails = this.lastCallDetails;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.error('Could not show feedback without call ')\n\t\t\t}\n\t\t}\n\n\t\tBX.loadExt('ui.feedback.form').then(() =>\n\t\t{\n\t\t\tBX.UI.Feedback.Form.open({\n\t\t\t\tid: 'call_feedback_' + Math.random(),\n\t\t\t\tforms: [\n\t\t\t\t\t{zones: ['ru'], id: 406, sec: '9lhjhn', lang: 'ru'},\n\t\t\t\t],\n\t\t\t\tpresets: {\n\t\t\t\t\tcall_id: callDetails.id || 0,\n\t\t\t\t\tcall_amount: callDetails.userCount || 0,\n\t\t\t\t},\n\t\t\t});\n\t\t})\n\t}\n\n\tshowFeedbackPopup_(callDetails)\n\t{\n\t\tif (this.feedbackPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!callDetails)\n\t\t{\n\t\t\tcallDetails = this.lastCallDetails;\n\t\t}\n\t\tconst darkMode = this.messengerFacade.isThemeDark();\n\t\tif (!Type.isPlainObject(callDetails))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tBX.loadExt('im.component.call-feedback').then(() =>\n\t\t{\n\t\t\tlet vueInstance;\n\t\t\tthis.feedbackPopup = new Popup({\n\t\t\t\tid: 'im-call-feedback',\n\t\t\t\tcontent: '',\n\t\t\t\ttitleBar: BX.message('IM_CALL_QUALITY_FEEDBACK'),\n\t\t\t\tcloseIcon: true,\n\t\t\t\tnoAllPaddings: true,\n\t\t\t\tcacheable: false,\n\t\t\t\tbackground: darkMode ? '#3A414B' : null,\n\t\t\t\tdarkMode: darkMode,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupDestroy: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tif (vueInstance)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvueInstance.$destroy();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.feedbackPopup = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst template = '<bx-im-component-call-feedback ' +\n\t\t\t\t'@feedbackSent=\"onFeedbackSent\" ' +\n\t\t\t\t':darkMode=\"darkMode\" ' +\n\t\t\t\t':callDetails=\"callDetails\" />';\n\n\t\t\tvueInstance = BX.Vue.createApp({\n\t\t\t\ttemplate: template,\n\t\t\t\tdata: function ()\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdarkMode: darkMode,\n\t\t\t\t\t\tcallDetails: callDetails\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmethods: {\n\t\t\t\t\tonFeedbackSent: () =>\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(\n\t\t\t\t\t\t\t() =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (this.feedbackPopup)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.feedbackPopup.close()\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t1500\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tvueInstance.mount('#' + this.feedbackPopup.getContentContainer().id);\n\n\t\t\tthis.feedbackPopup.show();\n\n\t\t})\n\t}\n\n\tgetClickLinkInterceptor()\n\t{\n\t\tconst handleClick = (event) => {\n\t\t\tconst link = event.target.closest('a');\n\n\t\t\tif (!link)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst href = link.getAttribute('href');\n\n\t\t\tif (!href)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.defaultPrevented)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.open(href, '_blank');\n\t\t\tevent.preventDefault();\n\t\t};\n\n\t\tconst startIntercepting = () => {\n\t\t\tdocument.addEventListener('click', handleClick, { capture: true });\n\t\t};\n\n\t\tconst stopIntercepting = () => {\n\t\t\tdocument.removeEventListener('click', handleClick, { capture: true });\n\t\t};\n\n\t\treturn {\n\t\t\tstartIntercepting,\n\t\t\tstopIntercepting,\n\t\t};\n\t}\n\n\tstatic FeatureState = FeatureState;\n\tstatic Events = Events;\n\tstatic ViewState = ViewState;\n\tstatic DocumentType = DocumentType;\n}\n","import { applyHacks } from './hacks';\nimport { BackgroundDialog } from './dialogs/background_dialog';\nimport { IncomingNotificationContent } from './dialogs/incoming_notification';\nimport { NotificationConferenceContent } from './dialogs/conference_notification';\nimport { FloatingScreenShare, FloatingScreenShareContent } from './floating_screenshare';\nimport { CallHint } from './call_hint_popup';\nimport { CallController } from './controller';\nimport {\n\tCallEngine,\n\tCallEvent,\n\tEndpointDirection,\n\tUserState,\n\tProvider,\n\tCallType,\n\tCallState,\n\tStartCallErrorCode,\n\tDisconnectReason,\n\tCallScheme,\n} from './engine/engine';\nimport { CallEngineLegacy } from './engine/engine_legacy';\nimport { Hardware } from './call_hardware';\nimport Util from './util';\nimport { CallAI } from './call_ai';\nimport {VideoStrategy} from './video_strategy';\nimport { JoinResponseError } from './call_api';\nimport {View} from './view/view';\nimport { CopilotPopup } from './view/copilot-popup';\nimport { ParticipantsPermissionPopup } from './view/participants-permission-popup';\nimport { WebScreenSharePopup } from './web_screenshare_popup';\nimport { UserListPopup } from 'call.component.user-list-popup';\nimport { UserList } from 'call.component.user-list';\nimport { CallMultiChannel } from './call_multi_channel';\nimport { CallCloudRecord, CallCommonRecordType, CallCommonRecordState } from './call_common_record';\nimport { CloudRecordKind, CloudRecordStatus } from './call_api';\n\nimport 'loader';\nimport 'resize_observer';\nimport 'webrtc_adapter';\nimport 'im.lib.localstorage';\nimport 'ui.hint';\nimport 'voximplant';\n\napplyHacks();\n\nexport {\n\tJoinResponseError,\n\tBackgroundDialog,\n\tCallController as Controller,\n\tCallEngine as Engine,\n\tCallEvent as Event,\n\tCallHint as Hint,\n\tCallState as State,\n\tCallEngineLegacy as EngineLegacy,\n\tEndpointDirection,\n\tStartCallErrorCode,\n\tDisconnectReason,\n\tFloatingScreenShare,\n\tFloatingScreenShareContent,\n\tIncomingNotificationContent,\n\tNotificationConferenceContent,\n\tHardware,\n\tProvider,\n\tCallType as Type,\n\tUserState,\n\tUtil,\n\tVideoStrategy,\n\tView,\n\tWebScreenSharePopup,\n\tUserListPopup,\n\tCopilotPopup,\n\tUserList,\n\tCallAI,\n\tCallScheme,\n\tParticipantsPermissionPopup,\n\tCallMultiChannel,\n\tCallCloudRecord,\n\tCallCommonRecordType,\n\tCallCommonRecordState,\n\tCloudRecordKind,\n\tCloudRecordStatus,\n};\n\n// compatibility\nBX.CallEngine = CallEngine;\n"],"names":["applyHacks","window","navigator","mediaParams","audio","video","mandatory","chromeMediaSource","maxWidth","screen","width","maxHeight","height","optional","googTemporalLayeredScreencast","mediaDevices","getUserMedia","BackgroundDialog","MessengerUtils","platform","getDesktopVersion","isDesktopFeatureEnabled","options","Type","isPlainObject","tab","isStringFilled","isAvailable","BX","Helper","show","html","js","DesktopApi","createWindow","controller","title","isMaskAvailable","message","SetProperty","Width","Height","ExecuteCommand","prepareHtml","STREAM_QUALITY","HIGH","MEDIUM","LOW","NO_VIDEO","LOCAL_STREAM_QUALITY_HEIGHT","defaultNoiseSuppressionEnabled","CallSettings","jwtCallsEnabled","plainCallsUseJwt","plainCallFollowUpEnabled","plainCallCloudRecordingEnabled","callBalancerUrl","Extension","getSettings","call","setup","settings","undefined","noiseSuppressionEnabled","_jwtCallsEnabled","value","_plainCallsUseJwt","_callBalancerUrl","isJwtInPlainCallsEnabled","_plainCallFollowUpEnabled","_plainCallCloudRecordingEnabled","CallSettingsManager","lsKey","defaultMicrophone","defaultCamera","defaultSpeaker","Events","initialized","deviceChanged","HardwareManager","setEventNamespace","_currentDeviceList","updating","Promise","resolve","initPromise","_checkPermissions","reject","enumerateDevices","then","deviceList","filterDeviceList","addEventListener","debounce","onNavigatorDeviceChanged","bind","emit","e","permissions","query","name","cameraPermission","microphonePermission","onchange","status","getCurrentDeviceList","constraints","error","Error","code","stream","err","devices","Object","keys","cameraList","length","microphoneList","values","filter","deviceInfo","kind","deviceId","HTMLMediaElement","prototype","removedDevices","addedDevices","shouldSkipDeviceChangedEvent","every","label","forEach","index","findIndex","dev","groupId","splice","push","added","removed","browserDeviceList","device","isDeviceInBlackList","deviceBlackList","result","item","toLowerCase","includes","updateDeviceList","deviceKind","i","resultDeviceList","currentDevices","microphoneId","speakerId","cameraId","_getDeviceMap","localStorage","getItem","getDefaultDeviceIdByGroupId","getDeviceGroupIdByDeviceId","setItem","audioOutputList","EventEmitter","enableNoiseSuppression","NOISE_SUPPRESSION_WORKLET_PATH","NoiseSuppressionService","audioCtx","AudioContext","webkitAudioContext","destination","createMediaStreamDestination","state","resume","inputSource","inputStream","getAudioTracks","track","trackInNewStream","getTrackById","id","stop","createMediaStreamSource","noiseSuppressionNode","audioWorklet","addModule","AudioWorkletNode","previousEnable","Boolean","enable","disconnect","connect","close","enableMicAutoParameters","preferHd","enableMirroring","CallEvents","onChangeMirroringVideo","onChangeMicrophoneMuted","onChangeCameraOn","CallHardwareManager","_classPrivateFieldInitSpec","_isCameraOn","_isMicrophoneMuted","assign","isCameraOn","isMicrophoneMuted","addNoiseSuppression","noiseSuppressionInputStream","stopNoiseSuppression","turnNoiseSuppression","processedAudioTracks","videoTracks","getVideoTracks","MediaStream","turn","preferHdQuality","isDesktop","Hardware","StreamManager","BXDesktopSystem","GetProperty","mediaStreamKind","promises","stopStream","MediaStreamsKinds","Microphone","allSettled","results","tracks","Map","reason","set","size","newConstraints","videoPromise","Camera","audioPromise","Number","streamPromise","videoTrack","audioTrack","getTracks","streamRequest","Screen","ScreenAudio","screenConstraints","getDisplayMedia","constraintsA","constraintsB","keys1","keys2","key","JSON","stringify","trackRequest","localTrack","isSameConstraints","isInputTrackLived","readyState","screenShareWidth","screenShareHeight","maxFrameRate","cursor","ideal","systemAudio","CallStreamManager","ClientPlatform","ClientVersion","Track","source","Message","text","from","senderSid","timestamp","Math","floor","Date","now","CALL_STATE","CONNECTED","PROGRESSING","TERMINATED","VIDEO_QUEUE","INITIAL","ENABLE","DISABLE","LOG_LEVEL","INFO","WARNING","ERROR","MONITORING_EVENTS_NAME_LIST","TRACK_SUBSCRIPTION_FAILED","TRACK_SUBSCRIPTION_DELAY","HIGH_PACKET_LOSS_SEND","HIGH_PACKET_LOSS_RECEIVE","CPU_ISSUES","NETWORK_ISSUES","NETWORK_LATENCY_MS","PEER_CONNECTION_REFUSED","PEER_CONNECTION_ISSUES_HANDLING_OFFER","PEER_CONNECTION_ISSUES_HANDLING_ANSWER","PEER_CONNECTION_ISSUES_ADDING_ICE_CANDIDATE","USER_CAMERA_DISABLED","USER_RECONNECTED","LOCAL_VIDEO_STREAM_RECEIVING_FAILED","LOCAL_MICROPHONE_STREAM_RECEIVING_FAILED","LOCAL_SCREEN_STREAM_RECEIVING_FAILED","LOCAL_VIDEO_STREAM_PUBLICATION_FAILED","LOCAL_MICROPHONE_STREAM_PUBLICATION_FAILED","LOCAL_SCREEN_STREAM_PUBLICATION_FAILED","STREAM_FAILURE_TOTAL","RECONNECT_ATTEMPTS","RECONNECT_DURATION_SECONDS","CPU_USAGE_PERCENT","HIGH_PACKET_LOSS_PERCENT","SUBSCRIPTION_DELAY_MS","MONITORING_METRICS","COUNT_TRACKS","COUNT_VIDEO_TRACKS","COUNT_AUDIO_TRACKS","PACKET_LOST_RECEIVE","PACKET_LOST_SEND","BITRATE_IN","BITRATE_OUT","CONN_SCORE_CURRENT","FRAMES_LOSS","FREEZE_COUNT","TOTAL_FREEZE_DURATION","JITTER","FRAMES_DECODED","FRAMES_DROPPED","FRAMES_RECEIVED","MONITORING_METRICS_PHROMETEUS","RecorderStatus","UNAVAILABLE","NONE","ENABLED","DISABLED","PAUSED","DESTROYED","CloudRecordStatus","STARTED","STOPPED","CloudRecordKind","AUDIO","VIDEO","ReconnectionReason","NetworkError","PingPongMissed","PeerConnectionFailed","WsTransportClosed","LeaveCommand","JoinResponseError","JoinRequestFailedCodes","CanNotCreateRoom","InputError","AccessDenied","RoomNotFound","MalfunctioningSignaling","JsonParsingError","UnexpectedResponse","UnknownError","ConnectionType","PeerToPeer","MediaServer","CloseCode","Normal","Reconnect","errorCode","fondedCodePair","entries","find","_","failedCode","CallApiEvent","Reconnected","Connected","Call","_classPrivateMethodInitSpec","codec","canReconnect","logs","isloggingEnable","loggerCallback","abortController","AbortController","isWaitAnswer","reportsForIncomingTracks","outgoingTracksReports","prevParticipantsWithLargeDataLoss","Set","tracksDataFromSocket","realTracksIds","mediaServerUrl","monitoringServerUrl","monitoringLogsServerUrl","monitoringJwtToken","monitoringEnvironment","monitoringRegion","roomData","roomType","RoomType","Small","roomId","isLegacy","token","endpoint","jwt","iceServers","socketConnect","peerConnectionFailed","pendingOffer","pendingCandidates","recipient","sender","pendingPublications","pendingSubscriptions","publicationTimeout","subscriptionTimeout","subscriptionTries","cameraStream","microphoneStream","screenStream","needToStopStreams","mediaMutedBySystem","needToEnableAudioAfterSystemMuted","needToDisableAudioAfterPublish","localTracks","localConnectionQuality","minimalConnectionQuality","rtt","pingIntervalDuration","pingTimeoutDuration","ontrackData","remoteTracks","remoteParticipants","participantsToUpdateTrackAvailability","mainStream","pingPongTimeout","pingPongInterval","userId","localParticipantSid","defaultVideoResolution","defaultSimulcastBitrate","q","h","f","defaultRemoteStreamsQuality","audioBitrate","videoBitrate","screenBitrate","videoSimulcast","screenSimulcast","events","offersStack","audioDeviceId","switchActiveAudioDeviceInProgress","switchActiveAudioDevicePending","videoDeviceId","switchActiveVideoDeviceInProgress","switchActiveVideoDevicePending","isReconnecting","reconnectionAttempt","reconnectionTimeout","lastReconnectionReason","fastReconnectionDelay","reconnectionDelay","callStatsInterval","callState","wasConnected","packetLostThreshold","statsTimeout","videoQueue","videoStreamSetupErrorList","sendLeaveBound","_classPrivateMethodGet","beforeDisconnectBound","monitoringEvents","monitoringDelayTime","monitoringIntervalTime","countMetricsInMetricsInterval","monitoringInterval","currentMonitoringEventsObject","metrics","increasingEvents","currentMonitoringRtcStatsObject","prevInboundRtpStatsSum","freezeCount","totalFreezesDuration","jitter","framesDecoded","framesDropped","framesReceived","Event","subscribe","event","setLog","data","initConnectionEvent","maxLocalStreamQualityHeight","connection","reconnectionReason","reconnectionReasonInfo","mozConnection","webkitConnection","onChangeConnection","callback","Util","isMetricsEnabled","bitrateArray","Array","isArray","reduce","acc","currentValue","bitrate","additionalData","metricValue","metricKey","metric","__name__","user_id","String","session_id","env","region","timestamps","withCounter","currentEventIndex","evt","currentIncreasingEventIndex","addValidatedMonitoringMetric","fillDefaultValueMonitoringMetrics","countVideoTracks","countAudioTracks","participant","getTrack","isMutedVideo","isLocalVideoMute","isMutedAudio","getDefaultValueMonitoringMetric","setClearValuesForCurrentMonitoringEventsObject","setInterval","getCountRemoteTracks","monitoringTimeout","setTimeout","clearTimeout","sendMonitoringEvents","isRtcStatsNotEmpty","metricsResultString","hasOwnProperty","sendMonitoringHandler","isMetricsLogsEnabled","otplLogsStructure","resourceLogs","resource","attributes","scopeLogs","scope","version","logRecords","resultLogsStr","url","xhr","XMLHttpRequest","open","setRequestHeader","send","withRestart","sendLogMonitoringRtcStats","clearInterval","startAggregateMonitoringEvents","triggerEvents","eventName","checkMetricsFeatureAndExecutionCallback","addMonitoringEvents","replace","canConnect","getMediaServerInfo","mediaServerInfo","signal","aborted","WebSocket","onmessage","socketOnMessageHandler","onopen","socketOnOpenHandler","onerror","socketOnErrorHandler","onclose","socketOnCloseHandler","request","fetch","method","response","json","getCallConnectionDataById","isErrorPreventingReconnection","reconnectionStoppableCodeNames","some","failedName","has","monitoring","metricsServerUrl","logsServerUrl","abort","createOffer","offer","useTcpSdp","type","sdp","setLocalDescription","getLocalVideo","publishTrack","onPublishFailed","getLocalAudio","parse","answer","joinResponse","role","setCurrentUserRole","removeEventListener","localParticipant","sid","connectedEvent","oneToOneType","roomState","setRoomPermissions","setUserPermissionsByRoomPermissions","participantsToDelete","otherParticipants","p","recorderStatus","recorderRespStatus","errMsg","pingInterval","participantJoined","participantLeft","participantId","trackId","timeout","trackCreated","cid","disableAudio","calledFrom","videoEnabled","audioEnabled","screenSharingEnabled","trackDeleted","publisher","shortId","pendingSubscription","removeTrack","trackMuted","videoRecorderStatus","trickle","newMessage","handRaised","isHandRaised","speakersChanged","connectionQuality","updates","participants","participantsToUpdate","remoteParticipant","hasGoodQuality","score","participantSid","isLocalVideoMuted","muted","pongResp","lastPingTimestamp","leave","initiatedByUser","reasonsToReconnect","leaveInformation","onErrorResponse","onActionSent","changeSettings","givePermissions","participantMuted","allParticipantsMuted","updateRole","switchConnectionType","target","candidate","protocol","candidateInit","sdpMid","sdpMLineIndex","usernameFragment","subscriber","connectionState","logMessage","iceConnectionState","eventType","handler","args","get","console","log","MediaStreamKind","isSimulcast","senders","getSenders","params","getParameters","encodings","encoding","maxBitrate","rid","setParameters","transceiver","RTCRtpReceiver","cap","getCapabilities","matched","partialMatched","unmatched","codecs","c","mimeType","matchesVideoCodec","sdpFmtpLine","setCodecPreferences","concat","MediaStreamTrack","StreamQualityOptions","replaceTrack","addTransceiver","direction","streams","sendEncodings","setCodec","setBitrate","sendOffer","republishTrack","unpublishTrack","showVideo","isPaginateToggle","closeRoom","errorInVideoStreamSetupErrorList","kindInListKinds","kindsArray","users","setVideoStreamSetupErrorList","videoQuality","disableVideo","isCameraWasEnabledBeforeQualityChanged","trackSid","keepTrack","mute","bySystem","enabled","pauseTrack","disabled","havePermissionToBroadcast","needToGetNewTrack","unpauseTrack","hasQueue","skipUnpause","hasTrack","getLocalScreen","sendMessage","raised","raiseHand","updateUserData","isUserControlFeatureEnabled","settingsObj","typeOfSetting","settingEnabled","sendAction","act","changeSettingsPayload","typeOfStream","muteAllParticipantPayload","audioMutedEvent","videoMutedEvent","screenShareMutedEvent","muteParticipantPayload","canControlGiveSpeakPermission","allow","readyStateInfo","noInputTrackEndHandler","onended","force","fulfilled","promise","prevStream","prevTrack","prevTrackEnabledState","prevTrackId","isAudioPublished","switchActiveAudioDevice","isVideoPublished","switchActiveVideoDevice","recorderControl","isConnected","videoRecorderControl","isCloudRecordLogEnabled","warn","level","desktopVersion","ApiVersion","currentTime","timestampMS","client","appVersion","logLength","lastSentLog","slice","logData","logObject","timeUnixNano","severityNumber","severityText","body","stringValue","peer_id","app_version","reconnect","disconnectOptions","isObject","closeCode","pingTimeout","pingReq","tries","aspectRation","ceil","maxEncodings","rids","active","scaleResolutionDownBy","max","map","quality","encodingByRid","el","subscription","trackSids","participantTracks","trackSource","pause","videoPaused","trackSetting","exactUser","exactTrack","otherUsers","setStreamQuality","requestLayers","targetUserId","layers","mediaServerId","cameraTrack","trackSubscribed","subscribed","needChangeLocalVideoMute","enableVideo","fallbackMode","exact","mediaStream","clone","trackMuteHandlersAreAddedInfo","getUserScreen","interrupted","permissionDescriptor","permissionPromise","onmute","onunmute","enableAudio","prepareMetricsLogs","isKibanaLogsEnabled","sendLog","userName","msgLevel","updatedSdp","split","RegExp","test","startsWith","join","hasError","setRemoteDescription","addIceCandidate","createAnswer","remoteDescription","_permissionsJSON","setUserPermissions","participantEvent","Participant","kindArray","setMainStream","trackData","remoteTrack","addTrack","streamRemovingId","getUuidv4","onremovetrack","speakers","speaker","isSpeaking","awaitedTrack","isMuted","toUserId","fromUserId","screenAudioTrack","isRegularUser","getUserRoleByUserId","getCurrentUserRole","getUserPermissions","screen_share","newRoomSettings","getRoomPermissions","eft","AudioEnabled","VideoEnabled","ScreenShareEnabled","updateUserPermissionByNewRoomPermission","config","RTCPeerConnection","onIceCandidate","onConnectionStateChange","onIceConnectionStateChange","ontrack","ids","getStatsHandle","statsAll","packetLostEventAdded","getStats","stats","statsOutput","reportsWithoutCodecs","remoteReports","reportsWithoutRemoteInfo","isQualityLimitationSent","totalBitrateOut","rawReport","report","processReportsWithoutCodecs","reportId","localId","prevReport","packetsLostData","calcLocalPacketsLost","currentPercentPacketLost","currentReportPacketsSent","packetsSent","prevReportPacketsSent","prevReportPacketsLost","packetsLost","remoteReportPacketsLost","packetsLostExtended","formatPacketsLostData","calcBitrate","contentType","qualityLimitationReason","limitations","qualityLimitationDurations","accumulator","setCodecToReport","saveReportWithoutCodecs","setLocalPacketsLostOrSaveReport","bitrateSumOut","calcBitrateSumFromArray","formattedBitrateOut","parseFloat","toFixed","bitrateList","participantsWithLargeDataLoss","totalBitrateIn","currentPacketLostReceiveCount","inboundRtpStatsArray","framesLoss","needCheckPacketLosts","trackIdentifier","calcRemotePacketsLost","realTrackId","inRemoteTracks","round","number","decimal","pow","addValueInboundRTCStatsToMetrics","metricsKey","isSum","interval","inboundRtpStatsArraySumByKey","prevInboundRtpStatsArraySumByKey","diffInboundRtpStatsArraySumByKey","inboundRtpStatsArrayByKey","currentFramesReceivedArray","currentFramesDroppedArray","currentFramesReceived","currentFramesDropped","currentFramesLoss","bitrateSumIn","formattedBitrateIn","streamTypes","streamType","s","socket","image","cameraStreamQuality","currentVideoQuality","Logger","serviceUrl","attempt","reconnectTimeout","unsentMessages","onSocketOpenHandler","onSocketOpen","onSocketCloseHandler","onSocketClose","onSocketErrorHandler","onSocketError","action","statRecord","bindSocketEvents","getConnectionDelay","removeSocketEvents","scheduleReconnect","CallCommonRecordState","Started","Resumed","Paused","Stopped","Destroyed","CallCommonRecordType","None","Video","Audio","CallCloudRecordClass","serviceEnabled","tariffAvailable","isCisRegion","tariffSlider","cloudRecord","CallCloudRecord","AbstractCall","uuid","instanceId","parentId","parentUuid","scheme","prop","getInteger","CallType","Instant","getString","CallState","Idle","ready","CallEngine","getCurrentUserId","userData","initiatorId","associatedEntity","startDate","videoHd","logToken","getLogService","logger","localStreams","main","eventListeners","initEventListeners","connectionData","_microphoneLevel","commonRecordState","date","start","dialogInfo","listener","isFunction","indexOf","listenerIndex","eventFields","tag","command","getLogMessage","apply","arguments","writeToLogFile","substr","debugFlag","a","getTimeForLog","MessengerDebug","addLog","destroy","Finished","runCallback","CallEvent","onDestroy","senderId","isCommonRecordStateInactive","finish","lastPause","reverse","onMicrophoneLevel","logPlaybackError","description","checkAndEncodeURI","uri","decodeURI","encodeURI","UserModel","avatar","gender","UserState","talking","getBoolean","cameraState","prevCameraState","microphoneState","screenState","floorRequestState","permissionToSpeak","localUser","centralUser","pinned","presenter","order","prevOrder","allowRename","wasRenamed","renameRequested","EndpointDirection","SendRecv","fieldName","defineProperty","_getField","_setField","onUpdate","_onUpdateTalking","_onUpdateState","talkingStop","eventEmitter","newValue","oldValue","user","getTime","Infinity","unsubscribe","UserRegistry","_onUserChanged","_sort","sort","b","createSVG","elementName","element","document","createElementNS","attrNS","setAttributeNS","Dom","adjust","createCssTooltip","tooltipWidth","position","tooltipPosition","getText","getTooltipText","hasTooltip","tooltipText","tooltipPositionClass","tooltipClass","tooltipTextVarName","tooltipStyle","TitleButton","elements","root","isGroupCall","create","props","className","getTitle","prettyName","Text","encode","innerHTML","SimpleButton","backgroundClass","blocked","tooltip","getObject","isActive","counter","isComingSoon","comingSoon","callbacks","onClick","getFunction","DoNothing","textNode","children","attrs","style","dataset","counterType","visible","click","classList","add","remove","setProperty","isBlocked","parseInt","isNaN","innerText","counterLabel","counterData","toString","DeviceButton","arrowEnabled","arrowHidden","showLevel","sideIcon","iconContainer","icon","arrow","levelMeter","pointer","ellipsis","onArrowClick","onSideIconClick","stopPropagation","getIconContainerClass","getIconClass","appendChild","viewBox","fill","x1","y1","x2","y2","gradientStop1","offset","gradientStop2","d","insertAfter","setAttribute","querySelector","removeChild","WaterMarkButton","language","src","getWatermarkUrl","TopButton","iconClass","TopFramelessButton","textClass","ParticipantsButton","count","foldButtonState","FoldButtonState","Hidden","allowAdding","leftContainer","rightContainer","foldIcon","separator","onListClick","onAddClick","parentElement","Active","Fold","Unfold","ParticipantsButtonMobile","RecordStatusButton","updateViewInterval","timeText","stateText","getRecordTimeText","prevState","updateView","currentClass","contains","classes","CallUserMobile","userModel","avatarOutline","userStatus","menuArrow","floorRequest","mic","cam","_onUserFieldChangeHandler","_onUserFieldChange","avatarBackground","getAvatarBackground","removeProperty","Utils","getFirstLetters","toUpperCase","toggle","render","update","UserSelectorMobile","userRegistry","_onUserAdded","updateUsers","userFields","cx","cy","r","newNode","renderUser","MobileSlider","parent","content","background","handle","onClose","touchStartY","processedTouchId","_onBackgroundClick","touchstart","_onTouchStart","touchmove","_onTouchMove","touchend","_onTouchEnd","pageY","touches","header","scrollTop","identifier","delta","bottom","preventDefault","allowProcessing","changedTouches","closeWithAnimation","MobileMenu","largeIcons","slider","items","getArray","MobileMenuItem","createFragment","onSliderClose","onSliderDestroy","showSubMenu","_userChangeHandler","_onUserChange","subscribeUserEvents","iconText","iconBackground","submenu","clickSubMenu","backgroundImage","prepend","updateUserIcons","CallUser","_onUserFieldChangedHandler","_onUserFieldChanged","parentContainer","screenSharingUser","isBoolean","allowBackgroundItem","allowMaskItem","_allowPinButton","allowPinButton","_visible","_audioTrack","_screenAudioTrack","_audioStream","_screenAudioStream","_videoTrack","_stream","_videoRenderer","_previewRenderer","_flipVideo","flipVideo","_tracksSubscriptionFailed","_alwaysShowName","alwaysShowName","_hiddenFloorRequest","hiddenFloorRequest","_hiddenRemoteParticipantButtonMenu","hiddenRemoteParticipantButtonMenu","hidden","videoBlurState","isChangingName","_badNetworkIndicator","incomingVideoConstraints","audioElement","screenAudioElement","screenAudio","callBacks","onUserRename","onUserRenameInputFocus","onUserRenameInputBlur","onPin","onUnPin","onTurnOffParticipantMic","onTurnOffParticipantCam","onTurnOffParticipantScreenshare","checkAspectInterval","checkVideoAspect","hintManager","UI","Hint","createInstance","popupParameters","targetContainer","bindOptions","forceBindPosition","connectionStats","connectionStatsVisible","removeAvatarPulseTimer","hideUserNameTimer","toggleStateUserName","isVisibleMediaStateIcon","statsOverlay","showConnectionStats","videoBorder","container","avatarContainer","panel","getStateMessage","userBottomContainer","nameContainer","changeNameIcon","toggleNameInput","changeNameContainer","changeNameCancel","changeNameInput","placeholder","keydown","onNameInputKeyDown","focus","blur","changeNameConfirm","changeName","changeNameLoader","introduceYourselfContainer","updateAvatarPulseState","debugPanel","connectionQualityIcon","connectionProblem","mouseover","currentTarget","mouseout","hide","getAvatarInnerText","videoContainer","volume","autoplay","playsinline","preview","srcObject","isVisibleCameraStateIcon","isVisibleMicStateIcon","buttonBackground","buttonMenu","showMenu","remoteParticipantButtonMenu","showRemoteParticipantMenu","buttonPin","buttonUnPin","micState","updatePanelDeferred","statsString","cameraStats","screenStats","audioStats","failedTracksResult","_formatFailedSubscribtionTracks","_formatVideoStats","codecName","videoRenderer","requestVideoSize","eventData","updateId","updateName","updateAvatar","updateState","updateTalking","updateMicrophoneState","updateCameraState","updateVideoPaused","updateFloorRequestState","updateScreenState","updatePanel","updateRenameAllowed","updateWasRenamed","updateRenameRequested","updateOrder","select","keyCode","inputValue","newName","trim","needToUpdate","menuItems","onclick","menu","rect","getRelativePosition","Menu","contentBackground","darkMode","contentBorderRadius","borderRadius","bindElement","left","top","autoHide","closeByEsc","offsetTop","offsetLeft","angle","overlay","backgroundColor","opacity","cacheable","onPopupDestroy","remoteParticipantMenu","onShow","popup","getTarget","adjustPosition","isMounted","offsetWidth","initialUpdate","hasChildNodes","lastWIdth","canChangeBackground","needChangeBackgroundButton","needChangePinButton","needChangeUnPinButton","clean","append","currentBitrixCall","getCurrentBitrixCall","isShowRemoteParticipantButtonMenu","canControlChangeSettings","provider","Provider","Plain","videoElement","hasVideoEl","isCanPlaying","isReadyPlaying","HAVE_CURRENT_DATA","isEnded","ended","play","load","onloadeddata","playVideoElements","hasVideo","isCallServerAllowed","audioStream","userModelId","setSinkId","screenAudioStream","blurState","userState","Calling","Declined","Ready","Connecting","Failed","Unavailable","initUserNameState","addAvatarPulseTimer","clearAvatarPulseTimer","updateRemoteParticipantMenuState","blurVideo","hasAudioTrack","videoHeight","videoWidth","videoStats","resultString","limitationsString","frameWidth","frameHeight","qualityLimitationResolutionChanges","framesPerSecond","trackIndex","_getVideoStats","activeClassName","hasActiveClass","releaseStream","playAudio","playScreenAudio","updateRendererState","_tempVideoRenderer","currentVideoRendererKind","newVideoRendererKind","badNetworkIndicator","hasConnectionProblem","_hasConnectionProblem","_connectionQuality","connectionQualityIcons","excellent","good","poor","bad","resultIcon","FloorRequest","hideTime","isShowAllowPermissionButton","_canChangeSpeakPermission","onAllowSpeakPermissionClicked","onDisallowSpeakPermissionClicked","_hideTimeout","_onUserModelChangedHandler","_onUserModelChanged","scheduleDismount","dismount","util","htmlspecialchars","createAllowPermissionButton","onCloseClicked","dismountWithAnimation","Button","baseClass","Size","EXTRA_SMALL","color","Color","LIGHT_BORDER","noCaps","_allowPermissionHandler","innerHtml","maximumNotifications","instance","NotificationManager","maxNotification","notifications","notification","onNotificationDestroy","firstNotification","shift","DeviceSelectorEvents","onMicrophoneSelect","onMicrophoneSwitch","onCameraSelect","onCameraSwitch","onSpeakerSelect","onSpeakerSwitch","onChangeHdVideo","onChangeMicAutoParams","onChangeFaceImprove","onChangeVideoQuality","onAdvancedSettingsClick","onChangeNoiseSuppression","DeviceSelector","viewElement","zIndex","cameraEnabled","microphoneEnabled","speakerEnabled","allowHdVideo","allowNoiseSuppression","noiseSuppressionVisible","faceImproveEnabled","allowFaceImprove","allowBackground","allowMask","allowAdvancedSettings","switchCameraBlocked","switchMicrophoneBlocked","isDestroying","micContainer","cameraContainer","speakerContainer","Popup","onPopupClose","microphoneContainer","DeviceMenu","deviceLabel","getMicrophoneList","selectedDevice","deviceEnabled","icons","onSwitch","onSelect","getCameraList","onVideoQualityChanged","canSelectSpeaker","getSpeakerList","checked","change","onAllowNoiseSuppression","onAllowHdVideoChange","onFaceImproveChange","startSelfTest","MessengerCommon","available","unblock","block","DeviceMenuEvents","menuBlocked","switchIcon","menuInner","isShowVideoQuality","isStreamQualityFeatureEnabled","getDeviceIconClass","Switcher","handlers","toggled","onSwitchToggled","getNode","renderDevice","VideoQualityRange","videoQualityList","deviceElements","onMenuItemClick","currentDevice","random","currentVideoQualityIndex","inputId","input","step","min","renderRangeItem","onVideoQualityChange","CallAiError","AI_MODULE_ERROR","AI_UNAVAILABLE_ERROR","AI_SETTINGS_ERROR","AI_AGREEMENT_ERROR","AI_NOT_ENOUGH_BAAS_ERROR","AI_MARKET_SUBSCRIPTION","CallAi","settingsEnabled","recordingMinUsers","agreementAccepted","baasAvailable","feedBackLink","baasPromoSlider","helpSlider","disclaimerArticleCode","marketSubscriptionEnabled","marketSubscriptionSlider","ai","errorType","_serviceEnabled","flag","_settingsEnabled","_recordingMinUsers","_agreementAccepted","_tariffAvailable","_baasAvailable","_feedBackLink","_baasPromoSlider","_helpSlider","_disclaimerArticleCode","_marketSubscriptionEnabled","_marketSubscriptionSlider","CallAI","CopilotNotifyType","COPILOT_ENABLED","COPILOT_DISABLED","COPILOT_RESULT","ENABLE_AI_INTERNAL_ERROR","DISABLE_AI_INTERNAL_ERROR","CopilotNotify","callId","notifyText","promoId","popupTemplate","notifyColor","Loc","getMessage","getPopupTemplate","padding","contentNoPaddings","animation","popupWidth","getPopupContainer","elementWidth","offsetFix","setOffset","setAngle","PromoManager","getInstance","markAsWatched","setAdditionalInformation","needToShow","Analytics","copilot","onCopilotNotifyShow","isCopilotActive","MediaRenderer","UnsupportedBrowserFeatures","listOfDevicesBeforeStream","browser","listOfPiPAvailable","IsFirefox","IsChrome","PictureInPictureWindow","pictureWindow","template","userPanel","actionsPanel","notificationPanel","buttons","microphone","camera","returnToCall","stopScreen","preferInitialWindowPlacement","currentUser","blockedButtons","previousFloorRequestNotifications","floorRequestNotifications","onButtonClick","isMinHeight","isMinWidth","floorRequestElements","mainNotification","floorRequestsList","floorRequestTimeForHidden","floorRequestTimeout","baseWidthPopup","buttonName","showStats","mount","mediaRenderer","hasUser","isCurrentUser","destroyCurrentUser","renderUserPanel","buttonsList","renderButtons","Buttons","getButtonTextBySizePictureWindow","showPointer","isButtonBlocked","_onButtonClick","previewRenderer","floorRequestsListItem","avatarBackgroundColor","initials","updateFloorRequestCounter","userInFloorRequestsListIndex","hasUserInFloorRequestsList","isActiveFloorRequestState","withoutRenderTemplate","updateVisibilityFloorRequestCounter","updateTemplateForFloorRequestsPopup","self","floorRequestsListItemIndex","avatarElement","tmpTemplate","getTemplateForFloorRequestsPopup","setContent","withoutAdditionInList","withoutDismount","updateFloorRequestsList","updateFloorRequestMainNotification","renderNotificationPanel","closeFloorRequestMainNotification","isHidden","renderFloorRequestCounter","hiddenClass","hasHiddenClass","composedPath","clientHeight","clientWidth","bindElementPos","getBoundingClientRect","baseOffsetHorizontalPopup","baseOffsetVerticalPopup","maxWidthPopup","widthPopup","heightWidth","setWidth","setMaxHeight","setNewSettingForPopup","pictureWindowHeight","pictureWindowWidth","avatarSize","avatarTextSize","onMouseOutCallbackForPopup","setAvatarSettings","isHeightUpdated","setHeightPictureWindow","isWidthUpdated","setWidthPictureWindow","updateButtons","onResize","onMouseMove","documentPictureInPicture","requestWindow","disallowReturnToOpener","toggleEvents","styleSheets","styleSheet","cssRules","rule","cssText","createElement","textContent","head","link","rel","media","href","isPiPAvailable","UserSelector","userList","current","popupWindow","MenuManager","SPOTLIGHT_ID_PREFIX","AhaMomentNotify","notifyTitle","spotlight","SpotLight","targetElement","targetVertex","lightMode","getSpotlight","getTargetContainer","CloudRecordInfoPopup","isCloudRecordFeaturesEnabled","turnOn","popupType","onCloudRecordPopupShow","sendAnalytics","openArticle","CommonRecordMenuPopup","isDesktopRecord","onStart","onStop","onPause","copilotButton","ConfirmModal","onClickYesButton","onClickNoButton","isString","yesButtonText","noButtonText","Dialogs","MessageBox","modal","popupOptions","closeIcon","TalkingPopup","customClassName","getElementNode","closingDelay","closingDuration","closingTimeout","isNumber","hasClass","clearClosingTimeout","removeClass","requestAnimationFrame","addClass","contentPadding","zIndexOptions","alwaysOnTop","avatarText","isForce","animatedClose","TalkingService","refreshQueue","watchTalking","deleteFromQueue","updateQueue","showPopup","hidePopup","activeId","queue","isUserTalking","mutedUserId","newActiveId","deleteUserFromQueue","activeUserCard","canPopupClose","userTalkAgain","talkingPopup","userCard","closeWithDelay","Layouts","Grid","Centered","Mobile","RerenderReason","VideoDisabled","UserDisconnected","SwapType","Direct","Replace","UiState","Preparing","Initializing","Folded","Full","RoomState","Speaker","NonSpeaker","EventName","onBodyClick","onReplaceCamera","onReplaceMicrophone","onReplaceSpeaker","onSetCentralUser","onLayoutChange","onUserClick","onUserPinned","onDeviceSelectorShow","onOpenAdvancedSettings","onHasMainStream","onAllowSpeakPermission","onDisallowSpeakPermission","onToggleSubscribe","onUnfold","onPiPClose","onCommonRecordMenu","onPiPBodyClick","beginingPosition","newUserPosition","addButtonPosition","MIN_WIDTH","SIDE_USER_WIDTH","SIDE_USER_HEIGHT","MAX_USERS_PER_PAGE","MIN_GRID_USER_WIDTH","MIN_GRID_USER_HEIGHT","CHANGE_VIDEO_RERENDER_DELAY","WAITING_VIDEO_DELAY","CALLCONTROL_PROMO_ID","CLOUD_RECORD_PROMO_ID","DocumentVisibilityState","View","disable","pictureInPictureCallWindow","setButtons","getPictureInPictureCallWindowGetButtonsList","baseZIndex","speakerMuted","showChatButtons","showUsersButton","showShareButton","showRecordButton","showDocumentButton","showCopilotButton","showButtonPanel","showAddUserButtonInList","preferInitialWindowPlacementPictureInPicture","limitation","inactiveUsers","activeUsers","rerenderTimeout","waitingForUserMediaTimeouts","rerenderQueue","shelvedRerenderQueue","broadcastingMode","broadcastingPresenters","currentPage","pagesCount","usersPerPage","lastPosition","userLimit","isIntranetOrExtranet","screenUsers","talkingService","localUserModel","avatar_hr","cache","_onUserRename","_onUserRenameInputFocus","_onUserRenameInputBlur","_onUserClick","_onTurnOffParticipantMic","_onTurnOffParticipantCam","_onTurnOffParticipantScreenshare","_onUserPin","_onUserUnPin","centralUserMobile","pinnedUser","presenterId","localUserReceivedStats","returnToGridAfterScreenStopped","mediaSelectionBlocked","wrap","watermark","topPanel","audioContainer","screenAudioContainer","center","localUserMobile","userBlock","ear","right","addButton","userSelectorContainer","pinnedUserContainer","renameSlider","button","pageNavigatorLeft","pageNavigatorLeftCounter","pageNavigatorRight","pageNavigatorRightCounter","grid","share","record","mobileMenu","chat","history","hangup","fullscreen","recordStatus","participantsMobile","hd","more","hangupOptions","previousTopButtonList","needToRerenderTopButtonList","previousButtonList","needToRerenderButtonList","isFullScreen","isUserBlockFolded","getDefaultCommonRecordState","configBlockedButtons","buttonCode","hiddenButtons","overflownButtons","configHiddenButtons","hiddenTopButtons","configHiddenTopButtons","uiState","layout","whiteSpaceInUserGrid","scrollInterval","_onFullScreenChangeHandler","_onFullScreenChange","_onResizeHandler","_onResize","_onOrientationChangeHandler","_onOrientationChange","_onKeyDownHandler","_onKeyDown","_onKeyUpHandler","_onKeyUp","resizeObserver","ResizeObserver","intersectionObserver","switchPresenterTimeout","deviceSelector","userSelector","userSize","hotKey","all","microphoneSpace","muteSpeaker","hotKeyTemporaryBlock","_isPreparing","_videoRerenderDelay","isWindowFocus","_isActivePiPFromController","enableAutoPip","pictureInPictureUpdateButtonHandler","openPiPHandler","visibility","isVideoconf","toggleStatePictureInPictureCallWindow","isFolded","isUserScreenSharing","hasCurrentUserScreenSharing","viewVisibility","init","subscribeEvents","userStates","appendUsers","hideEarTimer","isCopilotFeaturesEnabled","copilotNotify","ahaMomentNotify","currentPiPUserId","needToShowCallcontrolPromo","infoPopup","menuPopup","notify","articleCode","infoHelper","InfoHelper","isOpen","limitObj","_onBodyClick","getCallFeatures","defaultLimitation","currentLimitation","getLimitationByType","isDesktopCall","getBackgroundImage","backgroundId","setCallBackground","getLimitation","checkAvailableBackgroundImage","isFullScreenSupported","Browser","isChrome","isSafari","isFirefox","isMobile","documentElement","innerHeight","setSpeakerId","setMuted","setCameraState","onMouseMoveHandler","toggleVisibilityEar","keyModifierForCss","isMac","startViewVisibilityChange","setCallback","cb","userIds","addUser","previousCentralUser","updateUserList","setUserModel","showUserMenu","candidateUserId","userModels","totalUserModels","withYou","getConnectedUsers","isUserHasActiveState","hasOwn","currentPresenterId","getConnectedUserCount","currentPresenterModel","wasTalkingAgo","minTalkingAgo","minTalkingAgoUserId","userWasTalkingAgo","newPresenterId","getPresenterUserId","setCurrentUser","getPictureInPictureCallWindowUser","setCentralUser","switchPresenter","newLayout","useShelvedRerenderQueue","playVideo","unpinUser","setUserBlockFolded","toggleEars","setSideIcon","getMicrophoneSideIcon","pageNumber","recalculateUsersPerPage","renderUserList","containerSize","columns","rows","rowsWithoutGap","rowGap","elementSize","findBestElementSize","pages","getDisplayedUsers","calculateUsersPerPage","calculatePagesCount","displayedUsers","userPosition","microphoneLevel","setLevel","RecvOnly","getNextPosition","updateUserButtons","newState","setUiState","usersWithVideo","getUsersWithVideo","connectedUsers","timer","setUserFloorRequestState","setUserPermissionToSpeakState","hasCameraVideo","skippedElementsList","switchPresenterDeferred","setStats","showTrackSubscriptionFailed","isMicrophoneOn","updateRerenderQueue","userFloorRequestState","userActive","Busy","updateFloorRequestNotifications","showFloorRequestNotification","setButtonActive","permissionToSpeakState","indexFloorRequestInList","req","hasFloorRequestInList","currentUserData","_userModel","_onAllowSpeakPermissionClickedHandler","_onDisallowSpeakPermissionClickedHandler","Instance","addNotification","updatePermissionButtonState","Layout","setLayout","hasUserWithScreenSharing","streamData","setVideoRenderer","isUndefined","flipLocalVideo","videoTrackSettings","audioTracks","audioTrackSettings","localStreamVideoTrack","hideArrow","showArrow","videoRerenderDelay","userHasCameraVideo","setUserScreenState","setIncomingVideoConstraints","unblockButtons","blockButtons","recordState","startIntersectionObserver","resumeVideo","disableFaceImprove","checkPanelOverflow","closeCopilotNotify","clearCallcontrolPromo","overflownButtonsPopup","IntersectionObserver","_onIntersectionChange","threshold","callUser","observe","unobserve","getCameraSmoothingStatus","BXIM","_onMicrophoneSelected","_onMicrophoneButtonClick","_onCameraSelected","_onCameraButtonClick","_onSpeakerSelected","_onSpeakerButtonClick","_onChangeHdVideo","_onChangeNoiseSuppression","_onChangeMicAutoParams","_onChangeFaceImprove","_onChangeVideoQuality","_onMobileCallMenuFloorRequestClick","_onMobileCallMenShowParticipantsClick","_onMobileCallMenuCopyInviteClick","callMenu","showRenameSlider","_onMobileCallMenuCancelClick","pinItem","userMenu","pinUser","participantsMenu","statusNode","errorContainer","location","reload","showMessage","renderReloadPageLayout","renderSelfTestCallLayout","stopViewUpdate","isScreenSharingSupported","showButtons","hideButtons","scrollWidth","mediumButtonMinWidth","countOfButtonsToHide","getButtonList","hiddenButtonsCount","unusedPanelSpace","calculateUnusedPanelSpace","countOfButtonsToShow","buttonsLeftHidden","toggleCameraAvailability","toggleMicrophoneAvailability","setBlocked","updateBlockButtons","getBlockedButtonsListPictureInPictureCallWindow","isMediaSelectionAllowed","bottomCenterMenuIsVisible","previousButtonCode","_onCenterTouchStart","_onCenterTouchEnd","_onLeftPageNavigatorClick","_onRightPageNavigatorClick","_onLeftEarClick","_onRightEarClick","innerWidth","_onTopPageNavigatorClick","_onBottomPageNavigatorClick","scroll","Runtime","wheel","deltaY","_onAddButtonClick","rules","clear","changes","to","diffBetweenChanges","lessChangesField","moreChangesField","toUser","fromUser","orderChanges","applyOrderChanges","abs","incompleteSwaps","disconnectedUserHadVideo","swapRemains","usersWithEnabledVideo","pop","usersToKeepActive","userEnabledVideo","currenUserFromCurrentPage","possibleActiveUsers","changedUserFromCurrentPage","skipDeactivation","currentPageUsers","usersToDeactivate","usersToForceDeactivation","usersProcessed","userWithoutVideo","userWithoutVideoIndex","userWithoutVideoPage","skipUsers","numberOfUsersWithVideoForSwap","userToSwap","canCompleteVideoSwap","userToSwapIndex","userToSwapPage","userSkipped","disconnectedUser","lowerOrderOnCurrentPage","higherOrderOnCurrentPage","disconnectedUserFromCurrentPage","activeUsersFromPreviousPage","lastActiveUserFromPreviousPage","showAdd","pageChange","showLocalUser","shouldShowLocalUser","userCount","skippedUsers","renderedUsers","orderingRules","getOrderingRules","orderingParams","usersWithDisabledVideo","videoDisabledProceed","processVideoRules","processDisconnectRules","getActiveUsers","getUsersWithCamera","completeVideoDisabledSwap","completeDisconnectSwap","screenUser","unobserveIntersections","previousIncompleteSwaps","currentUserFromCurrentPage","completeVideoEnableSwap","swapCompleted","calculateUserActive","isPreparing","observeIntersections","updateGridUserSize","updateCentralUserAvatarSize","applyIncomingVideoConstraints","renderAddUserButtonInList","childElementCount","currentActiveUsers","currentInactiveUsers","currentPiPUserIndexInInactiveUsers","toggleSubscribingVideoInRenderUserList","rerender","panelInner","_onShareButtonClick","_onMicrophoneArrowClick","_onMicrophoneSideIconClick","_onCameraArrowClick","_onScreenButtonClick","_onDocumentButtonClick","setActive","_onCopilotButtonClick","_onHangupButtonClick","_onHangupOptionsButtonClick","_onCloseButtonClick","_onMobileMenuButtonClick","_onChatButtonClick","_onFloorRequestButtonClick","_onMoreButtonClick","waterMark","recordingUserName","_onGridButtonClick","_onFullScreenButtonClick","feedback","_onFeedbackButtonClick","callcontrol","_onCallcontrolButtonClick","_onParticipantsButtonListClick","_onParticipantsButtonMobileListClick","isEnabled","setIsComingSoon","notifyType","ahaMomentNotifyCallcontrol","buttonList","totalButtonWidth","buttonWidth","getButtonActive","isViewHidden","getCurrentVisibility","currentUserId","isLocalUser","isCurrentPiPUser","modifiedCurrentUser","isPictureInPictureFeatureEnabled","_onPiPClose","checkAvailableAndCreate","setCounter","recalculatePages","currentConnectedUserCount","previousConnectedUserCount","topButtonList","getTopButtonList","renderTopButtons","setCount","showCallcontrolPromoPopupTimeout","createAhaMomentNotifyCallcontrol","isAvatarBlank","IsSafari","webkitFullscreenEnabled","fullscreenEnabled","toggleTopEar","toggleBottomEar","stopScroll","isButtonHidden","showCommonRecordMenuPopup","userGender","Notification","Center","autoHideDelay","closeButton","getCloseButton","isResolved","resolveOnce","choice","showConfirmModal","promoRequired","showCloudRecordInfoPopup","centerTouchX","pageX","getRightUser","getLeftUser","webkitFullscreenElement","fullscreenElement","t","intersectionEntry","isIntersecting","IsMobile","rootDimensions","shiftKey","ctrlKey","metaKey","repeat","callMinimized","isHotKeyActive","pushToTalk","microphoneHotkeyTimerId","_onUsersButtonClick","isRecordingHotKeySupported","_destroyHotKeyHint","fromHotKey","setHotKeyTemporaryBlock","node","showDeviceSelector","getScreenSharingLimitation","onClickButtonWithLimit","showCallMenu","showOverflownButtonsPopup","clearNewLogicRules","viewEvent","BaseEvent","compatData","isDefaultPrevented","showParticipantsMenu","renderRenameSlider","_onMobileUserRename","toggleRenameSliderInputLoader","setCurrentPage","MAX_WIDTH_SPEAKER_MODE","animateUnsetProperty","_applyMaxWidth","setMaxWidth","containerDimensions","once","destroyed","closeCommonRecordPopups","unsubscribeAll","stopViewVisibilityChange","isUiBlocked","isForceBlock","noCamPermission","isUserConnecting","hasStream","hasAudio","createCopilotNotify","getRecordLimitation","hotkey","listners","listner","visibilityState","capture","Chat","VOLUME_THRESHOLD","INACTIVITY_TIME","AVERAGING_COEFFICIENT","SimpleVAD","audioContext","mediaStreamNode","analyserNode","audioTimeDomainData","voiceState","measureInterval","inactivityTimeout","currentVolume","voiceStarted","onVoiceStarted","voiceStopped","onVoiceStopped","isSupported","createAnalyser","fftSize","Float32Array","analyzeAudioStream","getFloatTimeDomainData","updateCurrentVolume","setVoiceState","onInactivityTimeout","sum","rms","sqrt","AnalyserNode","ajaxActions","decline","clientEvents","negotiationNeeded","connectionOffer","connectionAnswer","iceCandidate","customMessage","usersInvited","userInviteTimeout","defaultConnectionOptions","offerToReceiveVideo","offerToReceiveAudio","signalingConnectionRefreshPeriod","signalingWaitReplyPeriod","invitePeriod","ServerPlainCall","hasVideoTracks","replaceLocalMediaStream","signaling","sendCameraState","MediaKind","onLocalMediaReceived","CallApi","sendMicrophoneState","sendTalkingState","waitForAnswerTimeout","peer","peers","createPeer","onUserJoined","setSignalingConnected","setReady","isInitiator","sendNegotiationNeeded","sendLocalRecordState","deepParseJSON","onCustomMessage","useMediaServer","isVideoShown","onToggleRemoteParticipantVideo","onTrackSubscriptionFailed","addMediaRenderer","removeMediaRenderer","onUserMicrophoneState","onUserVoiceStarted","local","onUserVoiceStopped","ignoreError","onRecorderStatusChanged","initiatorUserID","userID","justJoined","pauses","end","recordType","onCloudRecordStatusChanged","_reconnectionEventCount","onReconnecting","reconnectionEventCount","onReconnected","onReconnectingFailed","DisconnectReason","SecurityKeyChanged","onCallFailure","usersToSendReports","statsIndexByRid","processReport","onUserStatsReceived","onConnectionQualityChanged","connectionType","setRecorderState","callFromMobile","initPeers","Signaling","turnServer","turnServerLogin","turnServerPassword","urls","username","credential","microphoneLevelInterval","_isCopilotFeaturesEnabled","Peer","signalingConnected","isLegacyMobile","onMediaReceived","onRemoteMediaReceived","onMediaStopped","onRemoteMediaStopped","onStateChanged","onInviteTimeout","onRTCStatsReceived","onRTCQualityChanged","onNetworkProblem","onUpdateLastUsedCameraId","calculatedState","isMediaMutedBySystem","onNeedResetMediaDevicesState","changedMediaMutedBySystem","replaceLocalAudioStream","updateCommonRecordState","localStream","subscribeHardwareChanges","getLocalMediaStream","attachToConference","onInvited","sendUsersInvited","getState","bindCallEvents","on","onJoin","setVideoEnabled","hdVideo","supportedConstraints","getSupportedConstraints","echoCancellation","noiseSuppression","autoGainControl","constraintsArray","currentConstraints","fallbackToAudio","getLocalStream","getMediaConstraints","onLocalVideoTrackEnded","onLocalVideoTrackMute","onLocalVideoTrackUnmute","onLocalAudioTrackEnded","setPublishingState","attachVoiceDetection","onDeviceListUpdated","setUseMediaServer","setCloudRecordState","deviceType","publishing","onCameraPublishing","onMicrophonePublishing","resetMainStream","voiceDetection","onLocalVoiceStarted","onLocalVoiceStopped","changeSource","stopScreenSharing","onUserScreenState","sendMedia","stopMediaStreamVideoTracks","stopMediaStreamAudioTracks","prevMainStream","isReady","replaceMediaStream","stopMediaStream","sendVoiceStarted","sendVoiceStopped","sendCustomMessage","callUuid","callInstanceId","getRestClient","callMethod","tempError","stack","Proceeding","onLeave","getLocalAudioStream","isParticipating","onUserInvited","extra","finishCall","isAnyoneParticipating","addJoinedUsers","addInvitedUsers","sendAllStreams","setDeclined","restart","onNegotiationNeeded","setUserAgent","userAgent","setConnectionOffer","connectionId","setConnectionAnswer","candidates","onUserCameraState","onUserVideoPaused","holdOutgoingVideo","onUserCommonRecordState","ASSOCIATED_ENTITY","onUserStateChanged","remoteReportsToShow","localReportsToShow","removeCallEvents","unsubscribeHardwareChanges","unbind","statsInterval","getPullClient","isPublishingSupported","requestId","calling","inviteTimeout","declined","busy","failureReason","calculateState","pendingIceCandidates","localIceCandidates","trackList","answerTimeout","callingTimeout","connectionTimeout","signalingConnectionTimeout","candidatesTimeout","connectionOfferReplyTimeout","negotiationNeededReplyTimeout","reconnectAfterDisconnectTimeout","connectionAttempt","hasStun","hasTurn","_outgoingVideoTrack","outgoingVideoHoldState","_outgoingScreenTrack","_incomingAudioTrack","_incomingScreenAudioTrack","_incomingVideoTrack","_incomingScreenTrack","_mediaGetter","_mediaSetter","_onPeerConnectionIceCandidateHandler","_onPeerConnectionIceCandidate","_onPeerConnectionConnectionStateChangeHandler","_onPeerConnectionIceGatheringStateChangeHandler","_onPeerConnectionSignalingStateChangeHandler","_onPeerConnectionTrackHandler","_onPeerConnectionRemoveStreamHandler","_updateTracksDebounced","_waitTurnCandidatesTimeout","prevPercentPacketLostList","incomingPacketLost","outgoingPacketLost","reportsForOutgoingTracks","screenShareBitrate","maxConnectionScore","incomingConnectionScore","outgoingConnectionScore","trackVariable","skipOffer","peerConnection","updateOutgoingTracks","applyResolutionScale","createAndSendOffer","rtpSender","getTransceivers","mid","factor","videoSender","scaleFactor","screenSender","rate","videoParams","screenParams","isRenegotiationSupported","holdState","updateCalculatedState","internal","refreshSignalingTimeout","stopSignalingTimeout","previousState","networkProblem","incomingDataLoss","outgoingDataLoss","needCheckInputPacketLost","totalPacketsLost","newIncomingConnectionDataLoss","newIncomingConnectionScore","calcNewConnectionScore","newOutgoingConnectionDataLoss","newOutgoingConnectionScore","dataLoss","sendIceCandidates","getSignaling","sendIceCandidate","peerConnectionId","stopStatisticsGathering","audioSender","screenAudioSender","incomingAudioTrack","incomingScreenAudioTrack","incomingVideoTrack","incomingScreenTrack","isIceTricklingAllowed","toJSON","updateCandidatesTimeout","match","array_flip","_destroyPeerConnection","applyOfferAndSendAnswer","connectionConfig","_onConnectionOfferReplyTimeout","sendConnectionOffer","localDescription","getSenderMid","sharingAudio","_onNegotiationNeededReplyTimeout","sessionDescription","RTCSessionDescription","pendingRemoteSdpDelay","pendingRemoteSdp","haveLocalOffer","signalingState","initDescription","applyPendingIceCandidates","sendConnectionAnswer","activeTransceivers","activeTracks","iceRestart","maxConnectionAttempt","outgoingVideoTrack","outgoingScreenTrack","screenTrack","tracksToSend","isScreenSharingStarted","isScreenPublished","startScreenShare","stopScreenShare","startStatisticsGathering","iceGatheringState","isScreenVideo","isScreenAudio","tr","currentDirection","receiver","invite","emotion","showUsers","showAll","hideAll","scenarioEvents","viewerJoined","viewerLeft","BitrixCallEvent","onCallConference","reinvitePeriod","BitrixCall","calledProgrammatically","localVideoShown","sendUserInviteTimeout","failedUserId","__onPullEventAnswerSelf","pullEvent","setBusy","onSwitchTrackRecordStatus","isTrackRecordOn","mediaStreamsKind","isNotSupportDevicesListBeforeStream","onGetUserMediaEnded","screenShared","waitingLocalScreenShare","getUserMediaFulfilled","onLocalMediaStopped","cameraStateInfo","onUserFloorRequest","requestActive","localVAD","requestFloor","sendTelemetryEvent","localUserState","videoAllowedFrom","UserMnemonic","none","sendHideAll","sendShowUsers","floorRequestActive","headers","joinedAsViewer","reinitPeers","RoomClosed","prevPeersWithBadConnection","peersWithBadConnection","onUserEmotion","setDirection","onAllParticipantsAudioMuted","onTurnOnCamera","onAllParticipantsVideoMuted","onAllParticipantsScreenshareMuted","onYouMuteAllParticipants","onRoomSettingsChanged","onUserPermissionsChanged","onUserRoleChanged","onParticipantMuted","Quality","VeryHigh","_localUserState","clientEventsBound","_screenShared","reinviteTimeout","pullEventHandlers","_isBoostExpired","incomingVideoAllowed","allowedUserId","isIncomingVideoAllowed","onMediaRemoved","canSwitchDevice","canChangeMediaDevices","setVideoQualityForStreams","turnOffAllParticipansStream","turnOffParticipantStream","allowSpeakPermission","repeatOnConnect","sendShowAll","allowIncomingVideo","usersToInvite","inviteParams","repeated","inviteUsers","scheduleRepeatInvite","repeatInviteUsers","usersToRepeatInvite","joinAsViewer","ajax","runAction","_replaceVideoSharing","userRole","toggleRemoteParticipantVideo","call_id","Bitrix","sendScreenState","isBoostExpired","MAX_USERS_WITH_VIDEO","countDisableCameraNewJoinedUsersFeature","isDisableCameraNewJoinedUsersFeatureEnabled","remoteParticipantsCount","enableSilentLogging","setLoggerCallback","signalName","mediaRenderers","CallStub","lifetime","onDelete","deleteTimeout","CallMultiChannel","channel","BroadcastChannel","requests","payload","responders","responses","deadline","postMessage","SendOnly","Permanent","Conference","Large","Personal","Direction","Incoming","Outgoing","High","Medium","Low","VeryLow","StartCallErrorCode","AuthorizeError","BlankAnswer","BlankAnswerWithErrorCode","ErrorUnexpectedAnswer","NoWebrtc","NotAllowedError","NotReadableError","onLocalScreenUpdated","onBadNetworkIndicator","onJoinRoomOffer","onJoinRoom","onLeaveRoom","onListRooms","onUpdateRoom","onTransferRoomSpeakerRequest","onTransferRoomSpeaker","createCall","createChatForChildCall","getPublicChannels","getCall","CallScheme","classic","Engine","calls","siteId","unknownCalls","restClient","pullClient","finishedCalls","multiBroadcastClient","addCustomEvent","rest","PULL","onCustomEvent","callType","callProvider","getDefaultProvider","joinExisting","entityType","entityId","onCallCreated","isNew","getCallConnectionData","callToken","isVideo","chatInfo","chatId","aiSettings","getAiSettings","callFactory","debug","parentCall","newProvider","newUsers","callParameters","createCallResponse","callFields","UUID","CallTokenManager","setToken","userCounter","hasConnectionData","dialogId","chatDialogId","participantsCount","jwtPullHandlers","callScheme","SCHEME","addDialogInfo","instantiateCall","__onPullEvent","server_time_ago","broadcastRequest","broadcastResponse","hasActiveCalls","res","clearTokenList","isJwtEnabled","isPlainUseJwt","providerType","PlainCallFactory","BitrixCallFactory","cancel","ping","pullEvents","pingPeriod","backendPingPeriod","PlainCall","pingUsersInterval","pingUsers","pingBackendInterval","pingBackend","_onUnloadHandler","_onOnlineHandler","isCloudRecordActive","_isCopilotActive","sendAnswer","sendHangup","sendPingToUsers","sendPingToBackend","isPublishingEnabled","retransmit","expiry","lastSuccessedLocaleCandidate","lastSuccessedRemoteCandidate","bytesReceived","bytesSent","lastSuccessedLocaleCandidateId","localCandidateId","lastSuccessedRemoteCandidateId","remoteCandidateId","reconnectInfoObject","repeatAnswer","MediaKinds","BitrixCallLegacy","joinedElsewhere","lastSelfPingReceivedTimeout","lastPingReceivedTimeout","_isRecordWhenCopilotActivePopupAlreadyShow","_outgoingAnswer","CallEngineLegacy","sendFinish","participantIds","isRecordWhenCopilotActivePopupAlreadyShow","backgroundCalling","showUser","createChildCall","EngineLegacy","getError","error_description","setUserData","publicChannels","setPublicIds","TYPE","START_DATE","publicIds","ID","PROVIDER","PARENT_ID","invitedUsers","getCallWithId","Messenger","Application","conference","inited","blankAvatar","usersInProcess","roomPermissions","userPermissions","ask","can_approve","change_role","change_settings","end_call","give_permissions","join_call","kick_user","mute_others","record_call","view_users","UsersRoles","ADMIN","MANAGER","USER","regularUserRoles","currentUserRole","_roomPermissions","permission","_roomPermission","_role","_userPermissions","havePermission","usersToUpdate","getDateForLog","getFullYear","lpad","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","str","chr","getUser","getUserCached","getUsers","getUserName","getUserAvatar","isBlank","getUserAvatars","getCustomMessage","messageText","convertKeysToUpper","placeHolder","obj","objectClone","k","u","appendChildren","child","containsVideoTrack","hasHdVideo","trackSettings","minWidth","minHeight","bestFilledArea","area","getFilledArea","elementHeight","bestWidth","bestHeight","rowCount","columnCount","maxElementWidth","maxElementHeight","ratio","neededRatio","expectedElementHeight","expectedElementWidth","isWebRTCSupported","webkitRTCPeerConnection","mozRTCPeerConnection","isFeedbackAllowed","shouldCollectStats","shouldShowDocumentButton","getDocumentsArticleCode","getResumesArticleCode","getUserLimit","getClientSelfTestUrl","v","reportConnectionResult","connectionResult","BXDesktopWindow","getBrowserForStatistics","IsOpera","endsWith","getConferenceProvider","codecId","currentReport","isLocal","bytes","time","trunc","remoteReport","deltaPacketsSent","deltaPacketsLost","percentPacketLost","percentPacketLostTotal","currentPacketsLost","totalPercentPacketLost","deltaPacketsReceived","packetsReceived","colorList","returnInSeconds","nowDate","pauseTime","startTime","finishTime","diff","totalTime","seconds","hours","minutes","padStart","getTimeText","second","hour","minute","getTimeInSeconds","isConferenceChatEnabled","callOptions","mustCreate","getUserToken","userToken","isPlainCall","isOneToOne","clientVersion","clientPlatform","responseInfo","ok","SyntaxError","responseText","getTokenCached","abortGetCallConnectionData","getCloudRecordSettings","isChatMountInPage","isAirDesignEnabled","shouldHideQuickAccess","isCloudRecordEnabled","isCloudRecordTariffEnabled","evnt","parsed","InternalEvents","setHasCamera","contentReady","FirstDesktopVersionWithChrome","BroadcastChannelName","IncomingNotification","callerAvatar","callerName","callerType","callerColor","hasCamera","isMessengerOpen","postponedEvents","onButtonClickHandler","onContentReadyHandler","broadcastChannel","desktopWindowIsReady","isChatWindow","IncomingNotificationContent","htmlContent","createTopmostWindow","createPopup","noAllPaddings","disableScroll","draggable","restrict","eventKeys","opener","callController","callNotification","X","Y","sendPostponedEvents","answerVideo","onHasCameraHandler","emitToMainWindow","callerPrefix","avatarClass","avatarImageStyles","avatarImageText","backgroundSize","backgroundPosition","decode","windowBottom","buttonsBlock","toggleMicrophoneIcon","toggleCameraIcon","withBlur","closeWindow","ConferenceNotifications","_onContentButtonClickHandler","_onContentButtonClick","NotificationConferenceContent","backgroundRepeat","_onSkipConferenceButtonClick","_onAnswerConferenceButtonClick","setWindowPosition","x","STP_CENTER","y","STP_VCENTER","onBackToCallClick","onStopSharingClick","onChangeScreenClick","POPUP_WIDTH","POPUP_HEIGHT","POPUP_OFFSET_X","POPUP_OFFSET_Y","FloatingScreenShare","sharedWindowX","sharedWindowY","sharedWindowHeight","sharedWindowWidth","app","screens","screenToUse","_onBackToCallClickHandler","_onBackToCallClick","_onStopSharingClickHandler","_onStopSharingClick","_onChangeScreenClickHandler","_onChangeScreenClick","bindEventHandlers","ListScreenMedia","saveExistingScreens","getApiVersion","FloatingScreenShareContent","adjustWindow","dispatchEvent","blockOffset","popupPadding","leftBlockWidth","centerBlockWidth","rightBlockWidth","fullWidth","Mode","STP_FRONT","convertedParams","mainWindow","BXWindows","windowItem","DispatchCustomEvent","CallHint","callFolded","showAngle","autoCloseDelay","initiatorName","customRender","buttonsLayout","onAskSpeakButtonClicked","autoCloseTimeout","onAutoClose","renderPopupMessage","getPopupMessage","hotKeyMessage","IsMac","onActionClick","PromoPopup","promoCode","dontShowAgain","subscribeToEvents","onCheckboxChange","PromoPopup3D","callView","openWindow","forceTop","forceLeft","btnText","openLearningPopup","Sidebar","contentContainer","WebScreenSharePopup","joinRoom","leaveRoom","listRooms","requestRoomSpeaker","joinRoomOffer","transferRoomHost","listRoomsResponse","roomUpdated","VoximplantCallEvent","connectionRestoreTime","VoximplantCall","voximplantCall","muteMicrophone","unmuteMicrophone","VoxImplant","hideLocalVideo","sendVideo","renderer","trackLabel","EndpointEvents","InfoUpdated","sendStat","transformVoxStats","updateRoom","initiator","speakerChanged","_currentRoomId","rooms","previousSpeaker","currentRoom","logUrl","__resolveListRooms","onMediaRenderEnabled","substring","onMediaRenderDisabled","onVoiceEnded","Voximplant","getClient","bindClientEvents","streamManager","MicAccessResult","Reconnecting","HardwareEvents","MediaRendererAdded","MediaRendererUpdated","BeforeMediaRendererRemoved","off","CameraManager","getInputDevices","setCallVideoSettings","constructCameraParams","AudioDeviceManager","setCallAudioSettings","impl","transceivers","VideoQuality","VIDEO_SIZE_HD","VIDEO_SIZE_nHD","facingMode","sendFloorRequest","sendEmotion","showLocalView","shareScreen","stopSharingScreen","voximplantClient","setDefaultVideoSettings","setDefaultAudioSettings","callConference","receiveVideo","customData","Disconnected","MessageReceived","CallStatsReceived","EndpointAdded","sendJoinRoom","sendRequestRoomSpeaker","sendLeaveRoom","sendListRooms","removeClientEvents","showLocalVideo","setEndpoint","removeEndpointEventHandlers","waitForConnectionRestore","connectionRestoreTimeout","readyStack","bindEndpointEventHandlers","RemoteMediaAdded","RemoteMediaRemoved","VoiceStart","VoiceEnd","Removed","MediaRenderEnabled","MediaRenderDisabled","onConnectionRestoreTimeout","outboundAudio","outboundVideo","inboundAudio","inboundVideo","endpoints","getEndpoints","outbound","statGroup","stat","inbound","actualHeight","actualWidth","StrategyType","AllowAll","AllowNone","OnlySpeaker","CurrentlyTalking","HOLD_VIDEO_SECONDS","VideoStrategy","strategyType","onCallUserVoiceStartedHandler","onCallUserVoiceStarted","onCallUserVoiceStoppedHandler","onCallUserVoiceStopped","onCallViewSetCentralUserHandler","onCallViewSetCentralUser","onCallViewLayoutChangeHandler","onCallViewLayoutChange","allowVideoFrom","bindEvents","applyVideoLimit","talkingUsers","User","onActiveChanged","onUserActiveChanged","setTalking","removeEvents","turnOffVideoTimeout","cancelTurnOffVideo","updateActive","scheduleTurnOffVideo","sharing","newActive","CopilotPopup","updateCopilotState","getButton","onAIRestrictionsPopupShow","ParticipantsPermissionPopup","roomSettings","allParticipantsDeviceControl","roomSettingsElements","screenshare","onPermissionChanged","onPermissionCollapseStateChanged","onOpen","isShowPopup","isShowRoomSettings","ParticipantsPermissionSwitcher","canControlPermission","settingsElements","renderSettingsElements","toggleRoomSettings","turnOffMicContainer","ParticipantsStreamControlButton","onTurnOffStreamForAll","participantsButton","onPopupShow","ParticipantsStreamControlButtonEvents","ParticipantsPermissionSwitcherEvents","onViewStateChanged","onOpenVideoConference","onPromoViewed","onCallJoined","onCallLeft","onCallDestroyed","ViewState","Opened","Closed","DocumentType","Resume","Blank","FeatureState","Enabled","Disabled","Limited","DOC_EDITOR_WIDTH","DOC_TEMPLATE_WIDTH","DOC_CREATED_EVENT","DOCUMENT_PROMO_CODE","DOCUMENT_PROMO_DELAY","FILE_TYPE_DOCX","FILE_TYPE_XLSX","FILE_TYPE_PPTX","BALLOON_OFFSET_CLASS_NAME","MASK_PROMO_CODE","MASK_PROMO_DELAY","DEFAULT_GENDER","CallController","needInit","incomingVideoStrategyType","formatRecordDate","messengerFacade","docEditor","docEditorIframe","maxEditorWidth","docCreatedForCurrentCall","folded","audioRingtone","SoundType","ringtoneModern","lastUsedCameraId","reconnectingCameraId","childCall","invitePopup","videoStrategy","isHttps","callWithLegacyMobile","featureScreenSharing","screenShareStartTime","commonRecord","autoCloseCallView","promotedToAdminTimeoutValue","promotedToAdminTimeout","clickLinkInterceptor","_callViewState","answeredOrDeclinedCalls","_onCallUserInvitedHandler","_onCallUserInvited","_onCallUserJoinedHandler","_onCallUserJoined","_onCallDestroyHandler","_onCallDestroy","_onCallUserStateChangedHandler","_onCallUserStateChanged","_onCallUserMicrophoneStateHandler","_onCallUserMicrophoneState","_onCallUserCameraStateHandler","_onCallUserCameraState","_onNeedResetMediaDevicesStateHandler","_onNeedResetMediaDevicesState","_onCameraPublishingHandler","_onCameraPublishing","_onMicrophonePublishingdHandler","_onMicrophonePublishingd","_onCallUserVideoPausedHandler","_onCallUserVideoPaused","_onCallLocalMediaReceivedHandler","_onCallLocalMediaReceived","_onCallLocalMediaStoppedHandler","_onCallLocalMediaStopped","_onCallLocalScreenUpdatedHandler","_onCallLocalScreenUpdated","_onCallLocalCameraFlipHandler","_onCallLocalCameraFlip","_onCallLocalCameraFlipInDesktopHandler","_onCallLocalCameraFlipInDesktop","_onCallRemoteMediaReceivedHandler","_onCallRemoteMediaReceived","_onCallRemoteMediaStoppedHandler","_onCallRemoteMediaStopped","_onCallBadNetworkIndicatorHandler","_onCallBadNetworkIndicator","_onCallConnectionQualityChangedHandler","_onCallConnectionQualityChanged","_onCallToggleRemoteParticipantVideoHandler","_onCallToggleRemoteParticipantVideo","_onCallUserVoiceStartedHandler","_onCallUserVoiceStarted","_onCallUserVoiceStoppedHandler","_onCallUserVoiceStopped","_onAllParticipantsAudioMutedHandler","_onAllParticipantsAudioMuted","_onAllParticipantsVideoMutedHandler","_onAllParticipantsVideoMuted","_onTurnOnCameraHandler","_onTurnOnCamera","_onAllParticipantsScreenshareHandler","_onAllParticipantsScreenshareMuted","_onYouMuteAllParticipantsHandler","_onYouMuteAllParticipants","_onRoomSettingsChangedHandler","_onRoomSettingsChanged","_onUserPermissionsChangedHandler","_onUserPermissionsChanged","_onUserRoleChangedHandler","_onUserRoleChanged","_onParticipantMutedHandler","_onParticipantMuted","_onUserStatsReceivedHandler","_onUserStatsReceived","_onTrackSubscriptionFailedHandler","_onTrackSubscriptionFailed","_onCallUserScreenStateHandler","_onCallUserScreenState","onCallUserFloorRequestHandler","_onCallUserFloorRequest","_onCallFailureHandler","_onCallFailure","_onNetworkProblemHandler","_onNetworkProblem","_onMicrophoneLevelHandler","_onMicrophoneLevel","_onReconnectingHandler","_onReconnecting","_onReconnectedHandler","_onReconnected","_onReconnectingFailedHandler","_onReconnectingFailed","_onCustomMessageHandler","_onCustomMessage","_onJoinRoomOfferHandler","_onJoinRoomOffer","_onJoinRoomHandler","_onJoinRoom","_onLeaveRoomHandler","_onLeaveRoom","_onTransferRoomSpeakerHandler","_onTransferRoomSpeaker","_onCallLeaveHandler","_onCallLeave","_onCallJoinHandler","_onCallJoin","_onGetUserMediaEndedHandler","_onUpdateLastUsedCameraIdHandler","_onUpdateLastUsedCameraId","_onBeforeUnloadHandler","_onBeforeUnload","_onImTabChangeHandler","_onImTabChange","_onUpdateChatCounterHandler","_onUpdateChatCounter","_onChildCallFirstMediaHandler","_onChildCallFirstUserJoinedHandler","_onWindowFocusHandler","_onWindowFocus","_onWindowBlurHandler","_onWindowBlur","_onDocumentBodyClickHandler","_onDocumentBodyClick","floatingWindow","FloatingVideo","onMainAreaClick","_onFloatingVideoMainAreaClick","_onFloatingVideoButtonClick","floatingWindowUser","showFloatingWindowTimeout","hideIncomingCallTimeout","ignoreDeclinedCallsTimeout","ignoreIncomingNotificationTimeouts","floatingScreenShareWindow","isThemeDark","_onFloatingScreenShareBackToCallClick","_onFloatingScreenShareStopClick","_onFloatingScreenShareChangeScreenClick","showFloatingScreenShareWindowTimeout","mutePopup","riseYouHandToTalkPopup","allowMutePopup","webScreenSharePopup","feedbackPopup","loopTimers","lastCalledChangeSettingsUserName","isFileChooserActive","pictureInPictureDebounceForOpen","isCallHangupButtonPressed","callMultiBroadcastClient","onIncomingCall","_onDeviceChange","_onWindowDesktopFocus","_onWindowDesktopBlur","setSharingData","showVpnIsActiveNotification","voxMicAccessResult","garbage","executer","currentCallUuid","currentCall","hasView","hasActiveCall","SetActiveTab","currentProvider","AnalyticsType","group","includeSelf","setTitle","getActiveCallUsers","setAvatars","setMicrophoneId","setCameraId","newCall","isCurrentCallActive","newCallId","_getCallIdentifier","currentCallId","BXShowedIncomingCallNotification","checkDesktop","prepareIncomingCall","removeVideoStrategy","showNotification","removeScreenUsers","isLegacyCall","updateCallViewUsers","updateCopilotFeatureState","updateDeviceIdInChildCall","answerChildCall","advanced","newCallType","onJoinCall","videoconf","AnalyticsStatus","isVpnActive","v2","Lib","CallManager","getCurrentUser","updateFloatingWindowContent","isConferencePageOpened","showIncomingConference","showIncomingCall","_onAllParticipantsScreenshareMutedHandler","_onCallViewShow","_onCallViewClose","_onCallViewDestroy","_onCallViewButtonClick","_onCallViewBodyClick","_onCallViewReplaceCamera","_onCallViewReplaceMicrophone","_onCallViewSetCentralUser","_onCallViewChangeHdVideo","_onCallViewChangeNoiseSuppression","_onCallViewChangeMicAutoParams","_onCallViewChangeFaceImprove","_onCallViewOpenAdvancedSettings","_onCallViewReplaceSpeaker","_onCallViewHasMainStream","_onCallViewTurnOffParticipantMic","_onCallViewTurnOffParticipantCam","_onCallViewTurnOffParticipantScreenshare","_onCallViewAllowSpeakPermission","_onCallViewDisallowSpeakPermission","_onCallToggleSubscribe","_onCallUserClick","_onPipClose","convertAllItemsToInt","arr","userListInt","userDataInt","notIncludedEl","setType","externalContainer","viewContainerClass","getExternalContainer","insertBefore","firstChild","ZIndexManager","getOrAddStack","register","getStack","unregister","updateCameraSettingsInCurrentCallAfterReconnecting","devicesList","setReconnectingCameraId","Reflection","getClass","desktop","DesktopManager","checkStatusInDifferentContext","desktopUtils","runningCheck","tagPresent","LocalStorage","getSiteId","getConferencePageTag","allowVideo","chatType","avatarColor","getMaxActiveMicrophonesCount","getDefaultZIndex","_onCallNotificationClose","_onCallNotificationDestroy","_onCallNotificationButtonClick","scheduleCancelNotification","repeatSound","_onCallConferenceNotificationButtonClick","isIncomingConference","getCallType","noAnswer","notificationText","actions","category","balloon","messageBox","MessageBoxButtons","OK_CANCEL","okCaption","cancelCaption","onOk","DesktopDownload","getLinkForCurrentUser","isRTCsupported","needBlockAddButton","showUserSelector","callData","preparedCall","isUserAgentSupported","showUnsupportedNotification","unfold","initCallPromise","onConnectToCallClick","getCallWithDialogId","joinCall","callTokenPromise","getToken","isCallPrepared","debug1","openMessenger","createContainer","getBlockedButtons","bindCallViewEvents","onCallViewRenderToMediaReceived","callEngine","debug2","currentCallIsNew","leaveCurrentCall","sendStartCopilotRecordAnalytics","isAutostart","useHdVideo","createVideoStrategy","getCallUsers","showCopilotNotify","showDocumentPromo","showMaskPromo","onStartCall","success","section","AnalyticsSection","chatWindow","AnalyticsElement","videocall","showAutoMicMuteNotification","checkVpnStatus","onStartCallError","errorMessage","defaultProvider","chatList","joinButton","onJoinCallError","onRecordStop","subSection","AnalyticsSubSection","contextMenu","finishForAllButton","disconnectButton","recordTime","info","releaseLocalMedia","hasStreamFromCall","isForceUse","newDeviceId","microphoneIds","deviceGroup","cameraIds","speakerIds","detached","fold","isScreenSharing","isForceOpen","isForceClose","shouldOpenPiP","canStayOpen","isActiveStatePictureInPictureCallWindow","isActivePiPFromController","foldedCallTitle","setSize","callViewState","sidebar","toggleHidden","closePromo","togglePictureInPictureCallWindow","containerWidth","editorWidth","callWidth","documentsMenu","onDocumentBtnClick","targetNodeWidth","resumesArticleCode","documentsArticleCode","onDocumentCreateAnalyticsEvent","maybeShowDocumentEditor","doc","typeFile","sheet","presentation","onSubMenuShow","buildPreviousResumesSubmenu","newStyleOptions","PopupMenuWindow","subMenuOptions","display","documentType","onDocumentCreate","menuItem","resumeList","resumes","getSubMenu","addMenuItem","object","createDate","onLastResumeOpen","viewDocumentByLink","links","view","removeMenuItem","adjustSubMenu","showDocumentEditor","openAnimation","showPromoPopupTimeout","_createAndOpenSidebarWithIframe","loadExt","Disk","OnlyOfficeImIntegration","CreateDocument","dialog","delegate","setCallEditorMaxWidth","onDocumentCreated","_onDocumentCreated","promiseGetUrl","getIframeUrlForTemplates","getIframeUrlForCreate","getIframeUrl","viewerItem","closeDocumentEditor","alert","onDocumentClose","getDocumentType","onCloseIframe","removeMaxWidth","oldSidebar","removeContainer","clearPictureInPictureDebounceForOpen","setWindowFocusState","findCallEditorWidth","onSideBarCloseClicked","loader","Loader","frameborder","border","margin","onDocumentUpload","onCancel","getData","documentPromoPopup","fromPiP","bringToFront","exitFullScreen","enterFullScreen","requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","cancelFullScreen","isPromoRequired","documentButton","onDocumentPromoActionClicked","onDocumentPromoClosed","maskPromoPopup","showPromoPopup3dTimeout","stopRepeatSound","callParams","onAnswerButtonClick","showBrowserWindow","isFeatureSupported","DesktopFeature","portalTabActivation","handlePortalTabActivation","shouldActivateTabWithChatPage","setTabWithChatPageActive","DesktopBroadcastManager","sendActionMessage","DesktopBroadcastAction","answerButtonClick","callPopup","answerButton","currentCallPromise","activateWindow","_ensureDocumentEditorClosed","blockAddUser","onAnswerConference","onDeclineConference","getMessageCount","setButtonCounter","findWindow","mediaDevicesResetStateHintBaloon","_closeReconnectionBaloon","_closeParticipantsVideoBaloon","copilotPopup","backdropFilter","_onCallViewHangupButtonClick","_onCallViewHangupOptionsButtonClick","_onCallViewCloseButtonClick","toggleUsers","_onCallViewUsersListButtonClick","inviteUser","_onCallViewInviteUserButtonClick","toggleMute","_onCallViewToggleMuteButtonClick","toggleScreenSharing","_onCallViewToggleScreenSharingButtonClick","toggleVideo","_onCallViewToggleVideoButtonClick","toggleSpeaker","_onCallViewToggleSpeakerButtonClick","showChat","_onCallViewShowChatButtonClick","_onCallViewFloorRequestButtonClick","showHistory","_onCallViewShowHistoryButtonClick","_onCallViewFullScreenButtonClick","_onCallViewDocumentButtonClick","microphoneSideIcon","_onCallViewMicrophoneSideIconClick","_onCallViewFeedbackButtonClick","_onCallViewCopilotButtonClick","onDisconnectCall","finishButton","hangupOptionsMenu","onFinishCall","finishedForAll","callUsersCount","getMaxActiveCallUsers","callLength","onShowChat","onFloorRequest","floorState","getUserFloorRequestState","talkingState","getUserTalking","callViewFloorRequestTimeout","reconnectionBaloon","participantsPermissionPopup","_onCallViewTurnOffAllParticipansStreamButtonClick","onTurnOffAllParticipansStream","onCallSettingsChanged","_afterCloseParticipantsPermissionPopup","_afterOpenParticipantsPermissionPopup","onOpenCallSettings","idleUsers","_getDisconnectedUsers","allowNewUsers","_onInvitePopupDestroy","_onInvitePopupSelect","inviteCloser","hasMicrophone","setIsMicrophoneMuted","setAudioMuted","showRiseYouHandToTalkNotification","CallRecordMute","onToggleMicrophone","_onCallViewToggleMuteHandler","onClickAIOff","onSelectAIOff","onSelectAIDelete","isBitrixCall","_onChangeStateCopilot","showCopilotResultNotify","chatUserCount","onAIRecordStart","onScreenShareBtnClick","openHelpArticle","CallRecordStopSharing","startScreenSharing","setIsCameraOn","onToggleCamera","_onCallViewToggleVideoButtonClickHandler","toggleRoomMenu","toggleRoomListMenu","Feedback","Form","forms","zones","sec","lang","presets","sender_page","call_type","call_amount","id_of_user","from_domain","origin","openHistory","toggleFullScreen","showDocumentsMenu","onTurnOffParticipantStream","onAllowPermissionToSpeakResponse","onDisallowPermissionToSpeakResponse","allowMicAutoParams","setCameraSmoothingStatus","openSettings","onlyPanel","callDetails","setUserConnectionQuality","newQuality","loopConnectionQuality","setUserState","blockSwitchCamera","blockScreenSharing","disableMediaSelection","clearConnectionQualityTimer","unblockButtonsList","isNeedUnblockCameraButton","isGetUserMediaFulfilled","unblockAddUser","showNetworkProblemNotification","notyText","setUserMicrophoneState","setUserCameraState","unblockSwitchCamera","blockSwitchMicrophone","unblockSwitchMicrophone","_onBlockCameraButton","_onUnblockCameraButton","_onBlockMicrophoneButton","_onUnblockMicrophoneButton","setUserVideoPaused","setLocalStreamVideoTrack","setLocalStream","onScreenShareStarted","showWebScreenSharePopup","onScreenShareStopped","screenShareLength","setUserMedia","isLegacyPlainCall","isLegacyBitrixCall","setBadNetworkIndicator","toogleParticipantsVideoBaloon","isMutedPopupAllowed","showMicMutedNotification","setUserTalking","createCallControlNotify","isAllow","contentIcon","contentPhrase","initiatorUserModel","targetUserModel","initiatorGender","initiator_name","target_name","typesOfMute","typesOfMuteMessage","_onBlockUnblockCamMicButtons","updateFloorRequestNotification","setAllUserPermissionToSpeakState","updateStatePermissions","balloons","baloonId","offsetClassNameSetted","_p","balloonClassName","getActions","getContainer","getContent","isCloseButtonVisible","setUserStats","setTrackSubscriptionFailed","isUnknownError","showSelfTest","showSecurityKeyError","showFatalError","setMicrophoneLevel","onReconnect","onReconnectError","showRoomJoinedPopup","setRoomState","showMicTakenFromPopup","showMicTakenByPopup","getClickLinkInterceptor","startIntercepting","lastUserLeft","stopIntercepting","onInviteUser","currentUsers","totalUsers","onInviteSuccess","onInviteFailure","createChildCallPromise","matches","onInputFileOpenedStateUpdate","updateWindowFocusState","returnValue","currentTab","allAddedDevice","allRemovedDevice","getRemovedUsedDevices","useDevicesInCurrentCall","removeDevicesFromCurrentCall","changeTab","videoOptions","audioOptions","lastUserId","_onTestCallViewButtonClick","stream2","vad","s2","handRaiseContentElement","buttonPlaceholder","getElementsByClassName","replaceWith","createAskSpeakButton","createUnmuteButton","onClickUser","roomMenu","roomSpeaker","speakerModel","delimiter","leaveCurrentRoom","showRoomHelp","roomListMenu","roomList","prepareRoomListMenuItems","room","getRoomDescription","roomFields","userNames","isAuto","isSpeaker","userIdList","roomJoinedPopup","usersInRoom","LINK","micTakenFromPopup","byUserId","micTakenByPopup","lastCallDetails","vueInstance","titleBar","$destroy","Vue","createApp","methods","onFeedbackSent","getContentContainer","handleClick","closest","getAttribute","defaultPrevented","previousRecordType","oldCall","privateToGroup","isCopilotInitiator","IsVpnConnected","isValidApi","cloudRecordingEnabled","showCloudRecordPromo","notifyShowed","CallRecordStop","setCommonRecordState","CallRecordPause","onRecordBtnClick","newCopilotState","onAIRecordStatusChanged","isAIOn","errors","handleCopilotError","showCopilotErrorNotify","isCopilotInitialized","onRecordResumed","onRecordStart","onRecordPaused","recordButton","onRecordDelete","showCommonRecordStartNotify","showCommonRecordStartModal","structuredClone","fallback","isStartedByMe","isStopped","dialogName","callDate","format","Main","fileName","CallRecordStart","windowId","RecordSource","cropTop","cropBottom","shareMethod","isConference"],"mappings":"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"}