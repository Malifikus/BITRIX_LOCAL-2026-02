(function(e,t,i,r,a){"use strict";var n;function o(e,t){l(e,t);t.add(e)}function s(e,t,i){l(e,t);t.set(e,i)}function l(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function c(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var d=t.Reflection.namespace("BX.Bizproc.Component");var p=new WeakMap;var u=new WeakMap;var h=new WeakMap;var v=new WeakMap;var f=new WeakMap;var b=new WeakMap;var g=new WeakSet;var w=new WeakSet;var m=function(){function e(i){babelHelpers.classCallCheck(this,e);o(this,w);o(this,g);s(this,p,{writable:true,value:void 0});s(this,u,{writable:true,value:void 0});s(this,h,{writable:true,value:new Map});s(this,v,{writable:true,value:void 0});s(this,f,{writable:true,value:void 0});s(this,b,{writable:true,value:void 0});if(!t.Type.isPlainObject(i)){return}this.gridId=i.gridId;this.createTemplateButton=i.createTemplateButton;this.errorsContainerDiv=i.errorsContainerDiv;babelHelpers.classPrivateFieldSet(this,v,i.canEdit);babelHelpers.classPrivateFieldSet(this,f,i.bizprocEditorUrl);babelHelpers.classPrivateFieldSet(this,b,i.bizprocNewEditorUrl);if(t.Type.isStringFilled(i.signedDocumentType)){babelHelpers.classPrivateFieldSet(this,p,i.signedDocumentType)}if(t.Type.isStringFilled(i.signedDocumentId)){babelHelpers.classPrivateFieldSet(this,u,i.signedDocumentId)}}babelHelpers.createClass(e,[{key:"init",value:function e(){BX.UI.Hint.init(document);if(this.getGrid()){BX.Bizproc.Component.WorkflowStartList.colorPinnedRows(this.getGrid())}i.EventEmitter.subscribe("Grid::updated",c(this,g,T).bind(this))}},{key:"editTemplate",value:function e(t,i,r){if(!babelHelpers.classPrivateFieldGet(this,v)){this.showNoPermissionsHint(t.target);return}if(babelHelpers.classPrivateFieldGet(this,f).length===0){this.showNoEditorHint(t.target);return}this.openBizprocEditor(i,r)}},{key:"showAngleHint",value:function e(i,r){if(this.hintTimeout){clearTimeout(this.hintTimeout)}this.popupHint=BX.UI.Hint.createInstance({popupParameters:{width:334,height:104,closeByEsc:true,autoHide:true,angle:{offset:t.Dom.getPosition(i).width/2},bindOptions:{position:"top"}}});this.popupHint.close=function(){this.hide()};this.popupHint.show(i,r);this.timeout=setTimeout(this.hideHint.bind(this),5e3)}},{key:"hideHint",value:function e(){if(this.popupHint){this.popupHint.close()}this.popupHint=null}},{key:"showNoPermissionsHint",value:function e(i){this.showAngleHint(i,t.Loc.getMessage("BIZPROC_CMP_WORKKFLOW_START_LIST_START_RIGHTS_ERROR"))}},{key:"showNoEditorHint",value:function e(i){this.showAngleHint(i,t.Loc.getMessage("BIZPROC_CMP_WORKKFLOW_START_LIST_START_MODULE_ERROR"))}},{key:"showErrors",value:function e(t){var i=this;this.errorsContainerDiv.style.margin="10px";t.forEach((function(e){var t=new r.Alert({text:e.message,color:r.AlertColor.DANGER,closeBtn:true,animated:true});t.renderTo(i.errorsContainerDiv)}))}},{key:"reloadGrid",value:function e(){var t=this.getGrid();if(t){t.reload()}}},{key:"getGrid",value:function e(){if(this.gridId){return BX.Main.gridManager&&BX.Main.gridManager.getInstanceById(this.gridId)}return null}},{key:"startWorkflow",value:function e(i,r,n){var o=this;i.preventDefault();var s=t.Text.toNumber(r);if(s<=0||!babelHelpers.classPrivateFieldGet(this,p)||!babelHelpers.classPrivateFieldGet(this,u)){return}var l=function e(){var t;var i=BX.SidePanel.Instance.getSliderByWindow(window);if(i){i.close();return}if(!babelHelpers.classPrivateFieldGet(o,h).has(r)){babelHelpers.classPrivateFieldGet(o,h).set(r,0)}babelHelpers.classPrivateFieldGet(o,h).set(r,babelHelpers.classPrivateFieldGet(o,h).get(r)+1);(t=o.getGrid())===null||t===void 0?void 0:t.reload()};a.Starter.singleStart({signedDocumentId:babelHelpers.classPrivateFieldGet(this,u),signedDocumentType:babelHelpers.classPrivateFieldGet(this,p),templateId:s,triggerType:n},l)}},{key:"openBizprocEditor",value:function t(i,r){if(r===e.NEW_TEMPLATE_TYPE){top.window.location.href=babelHelpers.classPrivateFieldGet(this,b).replace("#ID#",i)}else{top.window.location.href=babelHelpers.classPrivateFieldGet(this,f).replace("#ID#",i)}}}],[{key:"changePin",value:function e(i,r,a){var n=a.getData();var o=n.button;if(t.Dom.hasClass(o,BX.Grid.CellActionState.ACTIVE)){BX.Bizproc.Component.WorkflowStartList.action("unpin",i,r);t.Dom.removeClass(o,BX.Grid.CellActionState.ACTIVE)}else{BX.Bizproc.Component.WorkflowStartList.action("pin",i,r);t.Dom.addClass(o,BX.Grid.CellActionState.ACTIVE)}var s=BX.Main.gridManager.getInstanceById(r);if(s){BX.Bizproc.Component.WorkflowStartList.colorPinnedRows(s)}}},{key:"action",value:function e(t,i,r){var a="bitrix:bizproc.workflow.start.list";BX.ajax.runComponentAction(a,t,{mode:"class",data:{templateId:i}}).then((function(e){var t=BX.Main.gridManager.getInstanceById(r);if(t){t.reload()}}))}},{key:"colorPinnedRows",value:function e(i){i.getRows().getRows().forEach((function(e){var i=e.getNode();if(t.Type.isElementNode(i.querySelector(".main-grid-cell-content-action-pin.main-grid-cell-content-action-active"))){t.Dom.addClass(i,"bizproc-workflow-start-list-item-pinned")}else{t.Dom.removeClass(i,"bizproc-workflow-start-list-item-pinned")}}))}}]);return e}();function T(){var e=this;if(this.getGrid()){BX.UI.Hint.init(this.getGrid().getContainer());BX.Bizproc.Component.WorkflowStartList.colorPinnedRows(this.getGrid())}babelHelpers.classPrivateFieldGet(this,h).forEach((function(i,r){var a=document.querySelector('[data-role="template-'.concat(r,'-counter"]'));if(t.Type.isElementNode(a)){t.Dom.clean(a);t.Dom.append(c(e,w,H).call(e,r),a)}}))}function H(e){var i=t.Text.encode(t.Loc.getMessage("BIZPROC_CMP_TMP_WORKKFLOW_START_LIST_START_COUNTER",{"#COUNTER#":babelHelpers.classPrivateFieldGet(this,h).get(e)}));i=i.replace("[bold]",'<span class="bizproc-workflow-start-list-column-start-counter">');i=i.replace("[/bold]","</span>");return t.Tag.render(n||(n=babelHelpers.taggedTemplateLiteral(['<div class="ui-typography-text-xs">',"</div>"])),i)}babelHelpers.defineProperty(m,"NEW_TEMPLATE_TYPE","nodes");d.WorkflowStartList=m})(this.window=this.window||{},BX,BX.Event,BX.UI,BX.Bizproc.Workflow);
//# sourceMappingURL=script.map.js