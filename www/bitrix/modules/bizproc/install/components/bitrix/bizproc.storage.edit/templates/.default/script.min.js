this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(t,e,o){"use strict";var i=babelHelpers.classPrivateFieldLooseKey("collectFormFields");class s{constructor(t){Object.defineProperty(this,i,{value:a});this.formNode=null;this.tabs=new Map;if(e.Type.isPlainObject(t)){if(t.formName){this.formNode=document.querySelector(`form[data-role="${t.formName}"]`)}if(e.Type.isElementNode(t.tabContainer)){this.tabContainer=t.tabContainer}}this.init();s.instance=this}init(){if(!this.formNode){return}e.Event.bind(this.formNode,"submit",(t=>{var e;t.preventDefault();const o=(e=t.submitter)==null?void 0:e.name;this.onHandleSubmitForm(o)}));this.fillTabs()}fillTabs(){if(this.tabContainer){const t=this.tabContainer.querySelectorAll(".bizproc-storage-edit-tab");t.forEach((t=>{if(t.dataset.tab){this.tabs.set(t.dataset.tab,t)}}))}}resetSaveButton(){const t=this.formNode.querySelector(".main-user-field-edit-buttons #ui-button-panel-save");if(t){e.Dom.removeClass(t,"ui-btn-wait")}}onHandleSubmitForm(t){const s=babelHelpers.classPrivateFieldLooseBase(this,i)[i]();const a=s.id>0;const n=t==="remove";if(n){var r,l;o.MessageBox.confirm((r=e.Loc.getMessage("BIZPROC_STORAGE_EDIT_CONFIRM_MESSAGE"))!=null?r:"",(t=>{this.runAction("bizproc.storage.delete",{id:s.id},"BIZPROC_STORAGE_EDIT_DELETE_MESSAGE",t)}),(l=e.Loc.getMessage("BIZPROC_STORAGE_EDIT_CONFIRM_MESSAGE_OK"))!=null?l:"");return}const c=a?"bizproc.storage.update":"bizproc.storage.add";this.runAction(c,{storageType:s},"BIZPROC_STORAGE_EDIT_SAVE_MESSAGE")}runAction(t,i,s,a){BX.ajax.runAction(t,{data:i}).then((t=>{if(t.data){var o;top.BX.UI.Notification.Center.notify({content:(o=e.Loc.getMessage(s))!=null?o:""});const i=this.formNode.querySelector('input[name="id"]');if(i&&t.data.id){i.value=t.data.id}if(a){a.close()}const n=BX.SidePanel.Instance.getTopSlider();if(n){const e=n.getData();e.set("data",{storageId:t.data.id,storageTitle:t.data.title});n.close()}}this.resetSaveButton()})).catch((t=>{o.MessageBox.alert(t.errors.pop().message);this.resetSaveButton()}))}showTab(t){[...this.tabs.keys()].forEach((o=>{if(o===t){e.Dom.addClass(this.tabs.get(o),"bizproc-storage-edit-tab-current")}else{e.Dom.removeClass(this.tabs.get(o),"bizproc-storage-edit-tab-current")}}))}static handleLeftMenuClick(t){if(this.instance){this.instance.showTab(t)}}static showStorageFieldList(t){BX.Runtime.loadExtension("bizproc.router").then((({Router:e})=>{const o=BX.SidePanel.Instance.getTopSlider();o==null?void 0:o.close();if(e!=null&&e.openStorageFieldList){e.openStorageFieldList({requestMethod:"get",requestParams:{storageId:t}})}else{console.warn("Router or openStorageFieldList method not available")}})).catch((t=>console.error(t)))}}function a(){const t=new FormData(this.formNode);const e={};for(const[o,i]of t.entries()){e[o]=i}return e}s.instance=null;t.StorageEdit=s})(this.BX.Bizproc.Component=this.BX.Bizproc.Component||{},BX,BX.UI.Dialogs);
//# sourceMappingURL=script.map.js