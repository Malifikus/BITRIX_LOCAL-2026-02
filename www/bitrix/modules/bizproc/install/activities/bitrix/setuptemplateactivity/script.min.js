this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(t,e,n,i,o,r){"use strict";var a=Object.freeze({DELIMITER:"delimiter",TITLE:"title",DESCRIPTION:"description",CONSTANT:"constant"});var s=Object.freeze({STRING:"string",INT:"int",USER:"user",FILE:"file"});var l=Object.freeze({LINE:"line"});var d="SetupTemplateActivity_";function u(){return{itemType:a.DELIMITER,delimiterType:l.LINE}}function p(){return{itemType:a.TITLE,text:""}}function m(){return{itemType:a.DESCRIPTION,text:""}}function c(){return{itemType:a.CONSTANT,id:v(),name:"",constantType:s.STRING,multiple:false,description:"",default:"",options:[],required:false}}function T(t){return{Name:t.name,Description:t.description,Type:t.constantType,Required:0,Multiple:t.multiple?1:0,Options:t.options&&t.options.length>0?t.options:null,Default:t["default"]}}function I(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";var n="";var i=e.length;for(var o=0;o<t;o++){n+=e.charAt(Math.floor(Math.random()*i))}return n}function v(){return d+I(10)}var f={name:"ConstantEditComponent",props:{item:{type:Object,required:false,default:null},fieldTypeNames:{type:Object,required:true}},emits:["update","cancel"],data:function t(){var e,n,i,o,r,a,l,d;return{type:(e=(n=this.item)===null||n===void 0?void 0:n.constantType)!==null&&e!==void 0?e:s.STRING,name:(i=(o=this.item)===null||o===void 0?void 0:o.name)!==null&&i!==void 0?i:"",multiple:(r=(a=this.item)===null||a===void 0?void 0:a.multiple)!==null&&r!==void 0?r:false,required:(l=(d=this.item)===null||d===void 0?void 0:d.required)!==null&&l!==void 0?l:false,nameInvalid:false}},watch:{name:function t(e){if(e!==""){this.nameInvalid=false}}},methods:{onOk:function t(){if(this.name===""){this.nameInvalid=true;return}this.nameInvalid=false;var e={propertyValues:{constantType:this.type,name:this.name,multiple:this.multiple,required:this.required}};this.$emit("update",e)},onCancel:function t(){this.$emit("cancel")}},template:'\n\t\t<div>\n\t\t\t<div>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_HEADING\') }}\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<label>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_NAME_LABEL\') }}\n\t\t\t\t\t<br>\n\t\t\t\t\t<input v-model.trim="name" type="text" :class="{\'has-error\': this.nameInvalid }"/>\n\t\t\t\t</label>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<label>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_TYPE_LABEL\') }}\n\t\t\t\t\t<br>\n\t\t\t\t\t<select v-model="type">\n\t\t\t\t\t\t<option v-for="(typeName, typeKey) in fieldTypeNames" :value="typeKey" :key="typeKey">\n\t\t\t\t\t\t\t{{ typeName }}\n\t\t\t\t\t\t</option>\n\t\t\t\t\t</select>\n\t\t\t\t</label>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<label>\n\t\t\t\t\t<input v-model="multiple" type="checkbox"/>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_MULTIPLE_LABEL\') }}\n\t\n\t\t\t\t</label>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<label>\n\t\t\t\t\t<input v-model="required" type="checkbox"/>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_REQUIRED_LABEL\') }}\n\t\t\t\t</label>\n\t\t\t</div>\n\t\n\t\t\t<div>\n\t\t\t\t<button type="button" @click="onOk">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_OK\') }}\n\t\t\t\t</button>\n\n\t\t\t\t<button type="button" @click="onCancel">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_CANCEL\') }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t'};var E={name:"ConstantComponent",components:{ConstantEditComponent:f},props:{item:{type:Object,required:true},fieldTypeNames:{type:Object,required:true}},emits:["updateItemProperty","cancelItem"],data:function t(){return{editMode:this.item.name===""}},computed:{typeLabel:function t(){var e;return(e=this.fieldTypeNames[this.item.constantType])!==null&&e!==void 0?e:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_ITEM_TYPE_UNSUPPORTED")},titleWithType:function t(){return this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_ITEM_TITLE",{"#NAME#":this.item.name,"#TYPE#":this.typeLabel})}},methods:{onInput:function t(e){var n={propertyValues:{default:e.target.value}};this.$emit("updateItemProperty",n)},onEdit:function t(){this.editMode=true},onEditCancel:function t(){this.editMode=false;if(this.item.name===""){this.$emit("cancelItem")}},onEditUpdate:function t(e){this.editMode=false;this.$emit("updateItemProperty",e)}},template:'\n\t\t<div>\n\t\t\t<div v-if="!editMode">\n\t\t\t\t<div>\n\t\t\t\t\t{{ titleWithType }}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<input type="text" :value="item.default" @input="onInput">\n\t\t\t\t</div>\n\t\t\t\t<button type="button" @click="onEdit">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT\') }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<ConstantEditComponent\n\t\t\t\tv-if="editMode"\n\t\t\t\t:item="item"\n\t\t\t \t:fieldTypeNames="fieldTypeNames"\n\t\t\t\t@cancel="onEditCancel"\n\t\t\t\t@update="onEditUpdate"\n\t\t\t/>\n\t\t</div>\n\t'};var _={name:"DelimiterComponent",props:{item:{type:Object,required:true}},emits:["updateItemProperty"],methods:{onSelect:function t(e){var n={propertyValues:{delimiterType:e.target.value}};this.$emit("updateItemProperty",n)}},template:'\n\t\t<div>\n\t\t\t<div>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DELIMITER_ITEM_LABEL\') }}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<select :value="item.delimiterType" @change="onSelect">\n\t\t\t\t\t<option value="line">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DELIMITER_ITEM_OPTION_LINE\') }}\n\t\t\t\t\t</option>\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t</div>\n\t'};var y={name:"DescriptionComponent",props:{item:{type:Object,required:true}},emits:["updateItemProperty"],methods:{onInput:function t(e){var n={propertyValues:{text:e.target.value}};this.$emit("updateItemProperty",n)}},template:'\n\t\t<div>\n\t\t\t<div>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DESCRIPTION_ITEM_LABEL\') }}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<textarea :value="item.text" @input="onInput"/>\n\t\t\t</div>\n\t\t</div>\n\t'};var h={name:"TitleComponent",props:{item:{type:Object,required:true}},emits:["updateItemProperty"],methods:{onInput:function t(e){var n={propertyValues:{text:e.target.value}};this.$emit("updateItemProperty",n)}},template:'\n\t\t<div>\n\t\t\t<div>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_TITLE_ITEM_LABEL\') }}\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<input type="text" :value="item.text" @input="onInput"/>\n\t\t\t</div>\n\t\t</div>\n\t'};var C={name:"ItemComponent",components:{TitleComponent:h,DelimiterComponent:_,DescriptionComponent:y,ConstantComponent:E},props:{item:{type:Object,required:true},fieldTypeNames:{type:Object,required:true}},emits:["deleteItem","updateItemProperty"],computed:{type:function t(){return this.item.itemType},isItemTitle:function t(){return this.type===a.TITLE},isItemDelimiter:function t(){return this.type===a.DELIMITER},isItemDescription:function t(){return this.type===a.DESCRIPTION},isItemConstant:function t(){return this.type===a.CONSTANT}},methods:{deleteItem:function t(){this.$emit("deleteItem")},onUpdateItemProperty:function t(e){this.$emit("updateItemProperty",e)}},template:'\n\t\t<div>\n\t\t\t<TitleComponent \n\t\t\t\tv-if="isItemTitle"\n\t\t\t\t:item="item" \n\t\t\t\t@updateItemProperty="onUpdateItemProperty"\n\t\t\t/>\n\t\t\t<DescriptionComponent\n\t\t\t\tv-if="isItemDescription"\n\t\t\t\t:item="item"\n\t\t\t\t@updateItemProperty="onUpdateItemProperty"\n\t\t\t/>\n\t\t\t<DelimiterComponent\n\t\t\t\tv-if="isItemDelimiter"\n\t\t\t\t:item="item"\n\t\t\t\t@updateItemProperty="onUpdateItemProperty"\n\t\t\t/>\n\t\t\t<ConstantComponent\n\t\t\t\tv-if="isItemConstant"\n\t\t\t\t:item="item"\n\t\t\t\t:fieldTypeNames="fieldTypeNames"\n\t\t\t\t@updateItemProperty="onUpdateItemProperty"\n\t\t\t\t@cancelItem="deleteItem"\n\t\t\t/>\n\t\t\t<button @click="deleteItem" type="button">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DELETE\') }}\n\t\t\t</button>\n\t\t</div>\n\t'};var P={name:"BlockComponent",components:{ItemComponent:C,BMenu:i.BMenu},props:{items:{type:Array,required:true},position:{type:Number,required:true},fieldTypeNames:{type:Object,required:true}},emits:["addItem","deleteBlock","deleteItem","updateItemProperty"],data:function t(){return{isMenuShown:false}},computed:{title:function t(){return this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_BLOCK_TITLE",{"#POSITION#":this.position})},menuOptions:function t(){var e=this;return{bindElement:this.$refs.addItemElementRef,items:[{onClick:function t(){return e.addItem(p())},title:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_TITLE_ITEM_LABEL")},{onClick:function t(){return e.addItem(m())},title:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DESCRIPTION_ITEM_LABEL")},{onClick:function t(){return e.addItem(u())},title:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DELIMITER_ITEM_LABEL")},{onClick:function t(){return e.addItem(c())},title:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_MENU")}]}}},methods:{addItem:function t(e){this.$emit("addItem",e)},deleteBlock:function t(){this.$emit("deleteBlock")},deleteItem:function t(e){this.$emit("deleteItem",e)},onUpdateItemProperty:function t(e,n){var i={propertyValues:n.propertyValues,itemIndex:e};this.$emit("updateItemProperty",i)}},template:'\n\t\t<div>\n\t\t\t<div>\n\t\t\t\t{{ title }} \n\t\t\t\t<button @click="deleteBlock" type="button">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DELETE\') }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div v-for="(item, index) in items">\n\t\t\t\t<ItemComponent \n\t\t\t\t\t:key="index"\n\t\t\t\t\t:item="item"\n\t\t\t\t\t:fieldTypeNames="fieldTypeNames"\n\t\t\t\t\t@deleteItem="deleteItem(index)"\n\t\t\t\t\t@updateItemProperty="onUpdateItemProperty(index, $event)"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div @click="isMenuShown = true" ref="addItemElementRef">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_ADD_ITEM\') }}\n\t\t\t\t<BMenu  v-if="isMenuShown" :options="menuOptions" @close="isMenuShown = false" />\n\t\t\t</div>\n\t\t</div>\n\t'};function S(t,e){var n=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=B(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var i=0;var o=function t(){};return{s:o,n:function e(){if(i>=t.length)return{done:true};return{done:false,value:t[i++]}},e:function t(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,a=false,s;return{s:function e(){n=n.call(t)},n:function t(){var e=n.next();r=e.done;return e},e:function t(e){a=true;s=e},f:function t(){try{if(!r&&n["return"]!=null)n["return"]()}finally{if(a)throw s}}}}function B(t,e){if(!t)return;if(typeof t==="string")return A(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(t,e)}function A(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var b="SetupTemplateActivity";var L={name:"BlocksAppComponent",components:{BlockComponent:P},props:{serializedBlocks:{type:[String,null],required:true},fieldTypeNames:{type:Object,required:true}},data:function t(){var e;return{blocks:(e=JSON.parse(this.serializedBlocks))!==null&&e!==void 0?e:[],initialConstantIds:null}},computed:{formValue:function t(){return JSON.stringify(this.blocks)}},created:function t(){this.initialConstantIds=new Set(this.blocks.flatMap((function(t){return t.items||[]})).filter((function(t){return(t===null||t===void 0?void 0:t.itemType)===a.CONSTANT&&t.id})).map((function(t){return t.id})))},mounted:function t(){n.EventEmitter.subscribe("Bizproc.NodeSettings:nodeSettingsSaving",this.onNodeSettingsSave)},unmounted:function t(){n.EventEmitter.unsubscribe("Bizproc.NodeSettings:nodeSettingsSaving",this.onNodeSettingsSave)},methods:{addBlock:function t(){this.blocks.push(this.makeEmptyBlock())},makeEmptyBlock:function t(){return{items:[]}},addItem:function t(e,n){this.blocks[e].items.push(n)},deleteBlock:function t(e){this.blocks.splice(e,1)},deleteItem:function t(e,n){this.blocks[e].items.splice(n,1)},onUpdateItemProperty:function t(e,n){for(var i=0,o=Object.entries(n.propertyValues);i<o.length;i++){var r=babelHelpers.slicedToArray(o[i],2),a=r[0],s=r[1];this.blocks[e].items[n.itemIndex][a]=s}},onNodeSettingsSave:function t(e){var i=e.getData(),o=i.formData;if(o.activity!==b){return}var r=this.blocks.flatMap((function(t){return t.items||[]})).filter((function(t){return(t===null||t===void 0?void 0:t.itemType)===a.CONSTANT}));var s=new Set(r.map((function(t){return t.id})));var l=[];var d=S(this.initialConstantIds),u;try{for(d.s();!(u=d.n()).done;){var p=u.value;if(!s.has(p)){l.push(p)}}}catch(t){d.e(t)}finally{d.f()}var m={};var c=S(r),I;try{for(c.s();!(I=c.n()).done;){var v=I.value;if(v!==null&&v!==void 0&&v.id){m[v.id]=T(v)}}}catch(t){c.e(t)}finally{c.f()}n.EventEmitter.emit("Bizproc:onConstantsUpdated",{constantsToUpdate:m,deletedConstantIds:l});this.initialConstantIds=s}},template:'\n\t\t<div>\n\t\t\t<input type="hidden" id="id_blocks" name="blocks" :value="formValue"/>\n\t\t\t<div>\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_APP_TITLE\') }}\n\t\t\t</div>\n\t\t\t<div v-for="(block, index) in blocks">\n\t\t\t\t<BlockComponent \n\t\t\t\t\t:key="index"\n\t\t\t\t\t:items="block.items"\n\t\t\t\t\t:position="index + 1"\n\t\t\t\t\t:fieldTypeNames="fieldTypeNames"\n\t\t\t\t\t@addItem="addItem(index, $event)"\n\t\t\t\t\t@deleteBlock="deleteBlock(index)"\n\t\t\t\t\t@deleteItem="deleteItem(index, $event)"\n\t\t\t\t\t@updateItemProperty="onUpdateItemProperty(index, $event)"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div @click="addBlock">\n\t\t\t\t{{ $Bitrix.Loc.getMessage(\'BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_ADD_BLOCK\') }}\n\t\t\t</div>\n\t\t</div>\n\t'};function M(t,e,n){N(t,e);e.set(t,n)}function N(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var g=e.Reflection.namespace("BX.Bizproc.Activity");var O=new WeakMap;var k=new WeakMap;var x=new WeakMap;var R=function(){function t(e){babelHelpers.classCallCheck(this,t);M(this,O,{writable:true,value:void 0});M(this,k,{writable:true,value:void 0});M(this,x,{writable:true,value:void 0});babelHelpers.classPrivateFieldSet(this,O,e.currentValues);babelHelpers.classPrivateFieldSet(this,k,document.getElementById(e.domElementId));babelHelpers.classPrivateFieldSet(this,x,e.fieldTypeNames)}babelHelpers.createClass(t,[{key:"init",value:function t(){var e;var n=r.BitrixVue.createApp(L,{serializedBlocks:(e=babelHelpers.classPrivateFieldGet(this,O))===null||e===void 0?void 0:e.blocks,fieldTypeNames:babelHelpers.classPrivateFieldGet(this,x)});n.mount(babelHelpers.classPrivateFieldGet(this,k))}}]);return t}();g.SetupTemplateActivity=R})(this.BX.Bizproc.Activity=this.BX.Bizproc.Activity||{},BX,BX.Event,BX.UI.System.Menu,BX,BX.Vue3);
//# sourceMappingURL=script.map.js