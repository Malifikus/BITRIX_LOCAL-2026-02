{"version":3,"file":"script.js","sources":["src/storage-selector-footer.js","src/storage-selector.js","src/index.js"],"sourcesContent":["import { Loc, Tag, Type } from 'main.core';\nimport { Dialog, DefaultFooter } from 'ui.entity-selector';\n\nclass StorageSelectorFooter extends DefaultFooter\n{\n\tconstructor(dialog: Dialog, options: { [option: string]: any })\n\t{\n\t\tsuper(dialog, options);\n\t}\n\n\tgetContent(): HTMLElement | HTMLElement[] | string | null\n\t{\n\t\treturn this.cache.remember('write-data-storage-activity', () => {\n\t\t\treturn Tag.render`\n\t\t\t\t<span onclick=\"${this.#getCreateNewStorageHandler()}\" class=\"ui-selector-footer-link ui-selector-footer-link-add\">\n\t\t\t\t\t${Loc.getMessage('BIZPROC_WRITE_DATA_ACTIVITY_CREATE_NEW_STORAGE')}\n\t\t\t\t</span>\n\t\t\t`;\n\t\t});\n\t}\n\n\t#getCreateNewStorageHandler(): Promise<(event: MouseEvent) => void>\n\t{\n\t\tconst handler = this.getOption('onCreateNewStorageHandler');\n\n\t\tif (Type.isNil(handler) || ! Type.isFunction(handler))\n\t\t{\n\t\t\tthrow Error('The \"onCreateNewStorageHandler\" option must be a function.');\n\t\t}\n\n\t\treturn handler;\n\t}\n}\n\nexport default StorageSelectorFooter;","import { Loc, Text } from 'main.core';\nimport { TagSelector, ItemOptions } from 'ui.entity-selector';\nimport { Router } from 'bizproc.router';\nimport StorageSelectorFooter from './storage-selector-footer';\n\nexport type StorageItem = {\n\tid: number,\n\ttitle: string,\n\tselected?: boolean | false\n}\nexport type EventHandler = (event: MouseEvent) => void\n\nexport type EventHandlers = {\n\tonCreateNewStorageHandler: EventHandler,\n};\n\nclass StorageSelector\n{\n\t#entityId: string = 'bizproc-storage';\n\t#tabId: string = 'storage-tab';\n\t#storageIdField: HTMLInputElement;\n\t#storageItems: StorageItem[];\n\t#eventHandlers: EventHandlers = null;\n\n\tconstructor(\n\t\tstorageIdField: HTMLInputElement,\n\t\tstorageItems: StorageItem[],\n\t\teventHandlers: EventHandlers,\n\t)\n\t{\n\t\tthis.#storageIdField = storageIdField;\n\t\tthis.#storageItems = storageItems;\n\t\tthis.#eventHandlers = eventHandlers;\n\t}\n\n\t#currentValue(): number | null\n\t{\n\t\tconst value = parseInt(this.#storageIdField.value);\n\n\t\treturn Number.isNaN(value) ? null : value;\n\t}\n\n\t#createStorageItems(): ItemOptions[]\n\t{\n\t\tconst storageId = this.#currentValue();\n\n\t\treturn this.#storageItems.map((item) =>\n\t\t\tthis.#createItemOptions(item, storageId !== null && item.id === storageId)\n\t\t);\n\t}\n\n\t#createTagSelector(items: ItemOptions[]): TagSelector\n\t{\n\t\treturn new TagSelector({\n\t\t\tdialogOptions: {\n\t\t\t\titems,\n\t\t\t\ttabs: [\n\t\t\t\t\t{ id: this.#tabId, title: Loc.getMessage('BIZPROC_WRITE_DATA_ACTIVITY_STORAGE_TAB_TITLE') },\n\t\t\t\t],\n\t\t\t\twidth: 400,\n\t\t\t\theight: 300,\n\t\t\t\tenableSearch: true,\n\t\t\t\tcompactView: true,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\t\tconst { item: selectedItem } = event.getData();\n\n\t\t\t\t\t\tthis.#storageIdField.value = selectedItem.getId();\n\n\t\t\t\t\t\tthis.#storageIdField.dispatchEvent(new Event('change'));\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onDeselect': (event) => {\n\t\t\t\t\t\tthis.#storageIdField.value = '';\n\n\t\t\t\t\t\tthis.#storageIdField.dispatchEvent(new Event('change'));\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tfooter: StorageSelectorFooter,\n\t\t\t\tfooterOptions: {\n\t\t\t\t\tonCreateNewStorageHandler: this.#eventHandlers.onCreateNewStorageHandler,\n\t\t\t\t},\n\t\t\t},\n\t\t\tmultiple: false,\n\t\t\ttagMaxWidth: 500,\n\t\t\ttextBoxWidth: 100,\n\t\t\tevents: {\n\t\t\t\t'onAfterTagAdd': (event: BaseEvent) => {\n\t\t\t\t\tconst selector: TagSelector = event.getTarget();\n\t\t\t\t\tconst { tag } = event.getData();\n\n\t\t\t\t\tconst itemOptions = this.#createItemOptions(\n\t\t\t\t\t\t{ id: tag.id, title: tag.title.text },\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\t\tselector.dialog.addItem(itemOptions);\n\t\t\t\t\tthis.#setSelectedStorage(tag.id, tag.title.text);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t#createItemOptions(item: StorageItem, selected: boolean = false): ItemOptions\n\t{\n\t\treturn {\n\t\t\tid: item.id,\n\t\t\ttitle: item.title,\n\t\t\tentityId: this.#entityId,\n\t\t\ttabs: this.#tabId,\n\t\t\tselected: selected,\n\t\t\tlinkTitle: Loc.getMessage('BIZPROC_WRITE_DATA_ACTIVITY_OPEN_STORAGE_LIST'),\n\t\t\tlink: `/bitrix/components/bitrix/bizproc.storage.item.list/?storageId=${item.id}`,\n\t\t};\n\t}\n\n\t#setSelectedStorage(storageId: number, title: string): void\n\t{\n\t\tconst field = this.#storageIdField;\n\t\tlet option = [...field.options].find(o => o.value == storageId);\n\t\tif (!option)\n\t\t{\n\t\t\toption = new Option(Text.encode(title ?? ''), Text.encode(storageId));\n\t\t\tfield.add(option);\n\t\t}\n\n\t\tfield.value = storageId;\n\n\t\tfield.dispatchEvent(new Event('change'));\n\t}\n\n\tgetTagSelector(targetNode: HTMLElement): TagSelector\n\t{\n\t\tRouter.init();\n\n\t\tconst items = this.#createStorageItems();\n\n\t\treturn this.#createTagSelector(items);\n\t}\n}\n\nexport default StorageSelector;","import { ajax, Event, Reflection, Dom, Tag, Loc, Type, Runtime, Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { PopupMenu, Menu } from 'main.popup';\nimport StorageSelector, { StorageItem } from './storage-selector';\n\nconst namespace = Reflection.namespace('BX.Bizproc.Activity');\n\ntype Field = {\n\tName: string,\n\tType: string,\n\tFieldName: string,\n\tMultiple: boolean,\n\tRequired: boolean,\n};\n\nclass WriteDataStorageActivity\n{\n\t#fieldsContainer: HTMLElement;\n\t#storageSelectorContainer: HTMLElement;\n\t#storageIdField: HTMLElement;\n\t#storageCodeField: HTMLElement;\n\t#modeField: HTMLElement;\n\t#addFieldButton: HTMLElement;\n\t#documentType: {};\n\t#storageFields: Field[];\n\t#currentValues: {};\n\t#fieldsMap: {};\n\t#systemFields: {};\n\t#storageItems: ?StorageItem[] = null;\n\t#fieldMenu: Menu;\n\t#dynamicStorage: boolean;\n\t#fieldIndex: number;\n\t#storageSelectorInstance: TagSelector;\n\t#fieldsCache: Map<any,any> = new Map();\n\t#onAfterFieldRendererHandler: Function | null;\n\t#onStorageRemoveHandler: Function | null;\n\n\tstatic Mode = {\n\t\tMERGE: 'mergeFields',\n\t\tREWRITE: 'rewriteFields',\n\t};\n\n\tstatic Action = {\n\t\tGET_FIELDS: 'bizproc.storage.getFieldsByStorageId',\n\t};\n\n\tconstructor(\n\t\toptions: {\n\t\t\tfieldsContainer: Element,\n\t\t\tstorageSelectorContainer: Element,\n\t\t\tstorageIdField: Element,\n\t\t\tstorageCodeField: Element,\n\t\t\tmodeField: Element,\n\t\t\taddFieldButton: Element,\n\t\t\tdocumentType: {},\n\t\t\tcurrentValues: {},\n\t\t\tfields: Field[],\n\t\t\tsystemFields: Field[],\n\t\t\tstorageItems: StorageItem[],\n\t\t},\n\t)\n\t{\n\t\tthis.#fieldsContainer = options.fieldsContainer;\n\t\tthis.#storageSelectorContainer = options.storageSelectorContainer;\n\t\tthis.#storageIdField = options.storageIdField;\n\t\tthis.#storageCodeField = options.storageCodeField;\n\t\tthis.#modeField = options.modeField;\n\t\tthis.#addFieldButton = options.addFieldButton;\n\t\tthis.#documentType = options.documentType;\n\t\tthis.#storageFields = [];\n\t\tthis.#currentValues = options.currentValues;\n\t\tthis.#systemFields = options.systemFields;\n\t\tthis.#storageItems = Type.isArray(options.storageItems) ? options.storageItems : [];\n\t\tthis.#fieldIndex = 0;\n\t\tthis.#onAfterFieldRendererHandler = this.#onAfterFieldRenderer.bind(this);\n\t\tthis.#onStorageRemoveHandler = this.#onStorageRemove.bind(this);\n\n\t\tthis.#bindEvents();\n\t\tthis.#configureStorageCodeField();\n\t\tthis.#initializeFields(options);\n\t\tthis.#renderStorageSelector();\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tEvent.bind(this.#storageIdField, 'change', this.#onChangeStorageId.bind(this));\n\t\tEvent.bind(this.#storageCodeField, 'change', this.#onChangeStorageCode.bind(this));\n\t\tEvent.bind(this.#modeField, 'change', this.#onChangeMode.bind(this));\n\t\tEvent.bind(this.#addFieldButton, 'click', this.#onAddButtonClick.bind(this));\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Bizproc.FieldType.onDesignerRenderControlFinished',\n\t\t\tthis.#onAfterFieldRendererHandler,\n\t\t);\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Bizproc.Component.StorageItemList:onStorageRemove',\n\t\t\tthis.#onStorageRemoveHandler,\n\t\t);\n\t}\n\n\t#onStorageRemove(event): void\n\t{\n\t\tconst storageId = Number(event.getData().storageId);\n\n\t\tif (storageId <= 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#storageItems = this.#storageItems.filter(item => item.id !== storageId);\n\t\tthis.#clearFields();\n\t\tthis.#renderStorageSelector();\n\t}\n\n\t#onAfterFieldRenderer(event): void\n\t{\n\t\tconst node = event.data.node;\n\t\tconst textarea = node.querySelector('textarea[name=\"field_values[]\"], textarea[name=\"field_keys[]\"]');\n\t\tif (!textarea) return;\n\n\t\tconst isFieldValues = textarea.name === 'field_values[]';\n\t\tconst randString = Math.random().toString(36).substr(2, 9);\n\t\tconst uniqueId = 'field_' + (isFieldValues ? 'values' : 'keys') + '_' + randString;\n\n\t\ttextarea.id = uniqueId;\n\n\t\tconst button = node.querySelector('[data-role=\"bp-selector-button\"]');\n\t\tif (!button) return;\n\n\t\tconst oldOnclick = button.getAttribute('onclick');\n\t\tif (oldOnclick)\n\t\t{\n\t\t\tconst newOnclick = oldOnclick.replace(\n\t\t\t\t/BPAShowSelector\\('([^']+)'(\\s*,\\s*[^)]+)\\)/,\n\t\t\t\t\"BPAShowSelector('\" + uniqueId + \"'$2)\"\n\t\t\t);\n\t\t\tbutton.setAttribute('onclick', newOnclick);\n\t\t}\n\t}\n\n\t#configureStorageCodeField(): void\n\t{\n\t\tconst storageCodeRow = this.#storageCodeField.closest('[data-cid=\"StorageCode\"]');\n\t}\n\n\t#initializeFields(options: Object): void\n\t{\n\t\tconst storageCodeValue = this.#storageCodeField.value;\n\n\t\tif (Type.isStringFilled(storageCodeValue))\n\t\t{\n\t\t\tthis.#initializeDynamicStorageFields();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#initializeStaticStorageFields(options.fields);\n\t\t}\n\n\t\tconst storageId = this.#getStorageId();\n\t\tif (storageId <= 0 && !Type.isStringFilled(storageCodeValue))\n\t\t{\n\t\t\tDom.hide(this.#addFieldButton);\n\t\t}\n\t}\n\n\t#initializeDynamicStorageFields(): void\n\t{\n\t\tthis.#dynamicStorage = true;\n\n\t\tfor (const [fieldName, value] of Object.entries(this.#currentValues))\n\t\t{\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\tthis.#addDynamicStorageField(fieldName, value);\n\t\t\t}\n\t\t}\n\t}\n\n\t#initializeStaticStorageFields(fields: Field[]): void\n\t{\n\t\tthis.#dynamicStorage = false;\n\n\t\tif (!Type.isArrayFilled(fields) && !Type.isArrayFilled(this.#systemFields))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#storageFields = [...this.#systemFields, ...fields];\n\t\tthis.#restoreSavedFieldValues();\n\t}\n\n\t#restoreSavedFieldValues(): void\n\t{\n\t\tfor (const [fieldName, value] of Object.entries(this.#currentValues))\n\t\t{\n\t\t\tif (value && (!Type.isArray(value) || value.length > 0))\n\t\t\t{\n\t\t\t\tconst field = this.#storageFields.find(item => item.FieldName === fieldName);\n\t\t\t\tif (field)\n\t\t\t\t{\n\t\t\t\t\tfield.Value = value;\n\t\t\t\t\tthis.#addField(field);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #createNewStorage(): Promise<void>\n\t{\n\t\tconst storageData = await this.#openStorageEdit();\n\t\tif (Type.isNil(storageData))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst storageId = storageData.storageId;\n\t\tconst title = storageData.storageTitle ?? '';\n\t\tthis.#selectNewStorage(storageId, title);\n\t\tawait this.#resetFieldContainer(storageId);\n\t}\n\n\tasync #resetFieldContainer(storageId: number): Promise<void>\n\t{\n\t\tconst fields = await this.#getFields(storageId);\n\t\tthis.#storageFields = [...this.#systemFields, ...fields];\n\t\tDom.clean(this.#fieldsContainer);\n\t\tDom.show(this.#addFieldButton);\n\t}\n\n\tasync #onChangeStorageId(event): void\n\t{\n\t\tif (this.#dynamicStorage)\n\t\t{\n\t\t\tthis.#storageCodeField.value = '';\n\t\t}\n\n\t\tthis.#dynamicStorage = false;\n\t\tconst storageId = this.#getStorageId();\n\t\tif (storageId <= 0)\n\t\t{\n\t\t\tthis.#clearFields();\n\n\t\t\treturn;\n\t\t}\n\t\tawait this.#resetFieldContainer(storageId);\n\t}\n\n\t#clearFields(): void\n\t{\n\t\tDom.clean(this.#fieldsContainer);\n\t\tDom.hide(this.#addFieldButton);\n\t}\n\n\t#onChangeStorageCode(event): void\n\t{\n\t\tconst storageCode = event.currentTarget.value.trim();\n\n\t\tif (!Type.isStringFilled(storageCode))\n\t\t{\n\t\t\tthis.#clearFields();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#dynamicStorage)\n\t\t{\n\t\t\tDom.clean(this.#fieldsContainer);\n\t\t}\n\n\t\tif (this.#storageSelectorInstance)\n\t\t{\n\t\t\tthis.#storageSelectorInstance.removeTags();\n\t\t}\n\n\t\tthis.#dynamicStorage = true;\n\t\tDom.show(this.#addFieldButton);\n\t}\n\n\t#onChangeMode(event: Event): void\n\t{\n\t\tconst value = event.currentTarget.value;\n\t\tconst row = document.querySelector('[data-cid=\"ItemId\"]');\n\t\tif (!row)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (value === WriteDataStorageActivity.Mode.MERGE || value === WriteDataStorageActivity.Mode.REWRITE)\n\t\t{\n\t\t\tDom.show(row);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.hide(row);\n\t\t}\n\t}\n\n\t#openStorageEdit(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tRuntime\n\t\t\t\t.loadExtension('bizproc.router')\n\t\t\t\t.then(({ Router }) => {\n\t\t\t\t\tRouter.openStorageEdit({\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonCloseComplete: (event: BX.SidePanel.Event) => {\n\t\t\t\t\t\t\t\tconst slider = event.getSlider();\n\t\t\t\t\t\t\t\tconst dictionary: ?BX.SidePanel.Dictionary = slider ? slider.getData() : null;\n\t\t\t\t\t\t\t\tlet data = null;\n\t\t\t\t\t\t\t\tif (dictionary && dictionary.has('data'))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tdata = {\n\t\t\t\t\t\t\t\t\t\tstorageId: dictionary.get('data').storageId || null,\n\t\t\t\t\t\t\t\t\t\tstorageTitle: dictionary.get('data').storageTitle || '',\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((e) => {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tresolve(null);\n\t\t\t\t});\n\t\t});\n\t}\n\n\t#selectNewStorage(storageId: number, title: string): void\n\t{\n\t\tconst item = this.#storageSelectorInstance.addTag({\n\t\t\tid: storageId,\n\t\t\ttitle: title,\n\t\t\tentityId: 'bizproc-storage',\n\t\t\tlink: `/bitrix/components/bitrix/bizproc.storage.item.list/?storageId=${storageId}`,\n\t\t});\n\t}\n\n\t#getStorageId(): ?number\n\t{\n\t\treturn this.#storageIdField.value ? Number(this.#storageIdField.value) : null;\n\t}\n\n\tasync #getFields(storageId: number): Promise<Field[]>\n\t{\n\t\tif (this.#fieldsCache.has(storageId))\n\t\t{\n\t\t\treturn this.#fieldsCache.get(storageId);\n\t\t}\n\n\t\tconst response = await ajax.runAction(\n\t\t\tWriteDataStorageActivity.Action.GET_FIELDS,\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tstorageId,\n\t\t\t\t\tformat: true,\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\n\t\tif (response.status === 'success')\n\t\t{\n\t\t\tthis.#fieldsCache.set(storageId, response.data);\n\n\t\t\treturn response.data;\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t#onAddButtonClick(event): void\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (!this.#dynamicStorage)\n\t\t{\n\t\t\tthis.#showFieldSelectionMenu();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#showDynamicFieldSelectionMenu();\n\t\t}\n\t}\n\n\t#showDynamicFieldSelectionMenu(): void\n\t{\n\t\tconst addedFieldIds = this.#getAddedFieldIds();\n\t\tconst menuItems = this.#buildDynamicMenuItems(addedFieldIds);\n\n\t\tthis.#cleanupExistingMenu();\n\t\tthis.#fieldMenu = this.#createFieldMenu(menuItems);\n\t\tthis.#fieldMenu.show();\n\t}\n\n\t#buildDynamicMenuItems(addedFieldIds: Set<string>): MenuItem[]\n\t{\n\t\tconst writeDataActivity = this;\n\t\tconst menuItems = [];\n\n\t\tfor (const field of this.#systemFields)\n\t\t{\n\t\t\tif (!addedFieldIds.has(field.FieldName) && Type.isStringFilled(field.Name))\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: Text.encode(field.Name),\n\t\t\t\t\tonclick()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\twriteDataActivity.#addDynamicStorageField(Text.encode(field.FieldName));\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tmenuItems.push({\n\t\t\ttext: Loc.getMessage('BIZPROC_WRITE_DATA_ACTIVITY_ANOTHER_FIELD') ?? '',\n\t\t\tasync onclick()\n\t\t\t{\n\t\t\t\tthis.popupWindow.close();\n\t\t\t\twriteDataActivity.#addDynamicStorageField();\n\t\t\t},\n\t\t});\n\n\t\treturn menuItems;\n\t}\n\n\t#showFieldSelectionMenu(): void\n\t{\n\t\tconst addedFieldIds = this.#getAddedFieldIds();\n\t\tconst menuItems = this.#buildMenuItems(addedFieldIds);\n\n\t\tthis.#cleanupExistingMenu();\n\t\tthis.#fieldMenu = this.#createFieldMenu(menuItems);\n\t\tthis.#fieldMenu.show();\n\t}\n\n\t#getAddedFieldIds(): Set<string>\n\t{\n\t\tconst fieldRows = Array.from(this.#fieldsContainer.querySelectorAll('tr[data-id]'));\n\n\t\treturn new Set(fieldRows.map(row => row.dataset.id));\n\t}\n\n\t#buildMenuItems(addedFieldIds: Set<string>): MenuItem[]\n\t{\n\t\tconst writeDataActivity = this;\n\t\tconst menuItems = [{\n\t\t\ttext: Loc.getMessage('BIZPROC_WRITE_DATA_ACTIVITY_CREATE_NEW_FIELD') ?? '',\n\t\t\tasync onclick()\n\t\t\t{\n\t\t\t\tthis.popupWindow.close();\n\t\t\t\tconst field = await writeDataActivity.#openFieldEdit();\n\n\t\t\t\tif (field)\n\t\t\t\t{\n\t\t\t\t\twriteDataActivity.#addStorageField(field);\n\t\t\t\t\twriteDataActivity.#addField(field);\n\t\t\t\t}\n\t\t\t},\n\t\t}];\n\n\t\tfor (const field of this.#storageFields)\n\t\t{\n\t\t\tconst fieldId = String(field.Id);\n\t\t\tif (!addedFieldIds.has(fieldId) && Type.isStringFilled(field.Name))\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: Text.encode(field.Name),\n\t\t\t\t\tonclick()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.popupWindow.close();\n\t\t\t\t\t\twriteDataActivity.#addField(field);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn menuItems;\n\t}\n\n\t#createFieldMenu(menuItems: MenuItem[]): Menu\n\t{\n\t\treturn PopupMenu.create({\n\t\t\tid: `bp_wsa_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n\t\t\tbindElement: this.#addFieldButton,\n\t\t\tautoHide: true,\n\t\t\titems: menuItems,\n\t\t\tevents: {\n\t\t\t\tonPopupClose: () => {\n\t\t\t\t\tthis.#cleanupExistingMenu();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#createDynamicKeyField(customValue: string = ''): Field\n\t{\n\t\tconst fieldIndex = this.#fieldIndex;\n\t\tthis.#fieldIndex++;\n\n\t\treturn {\n\t\t\tId: customValue ? customValue : `dynamic_${fieldIndex}`,\n\t\t\tName: '',\n\t\t\tFieldName: `field_keys[]`,\n\t\t\tType: 'string',\n\t\t\tRequired: false,\n\t\t\tAllowSelection: true,\n\t\t\tValue: customValue\n\t\t};\n\t}\n\n\t#createDynamicValueField(customValue: string = ''): Field\n\t{\n\t\tconst fieldIndex = this.#fieldIndex;\n\t\tthis.#fieldIndex++;\n\n\t\treturn {\n\t\t\tId: customValue ? customValue : `dynamic_${fieldIndex}`,\n\t\t\tName: '',\n\t\t\tFieldName: `field_values[]`,\n\t\t\tType: 'string',\n\t\t\tRequired: false,\n\t\t\tAllowSelection: true,\n\t\t\tValue: customValue\n\t\t};\n\t}\n\n\t#renderDynamicFieldRow(row: HTMLTableRowElement, leftField: Field, rightField: Field): void\n\t{\n\t\tconst leftCell = row.insertCell(-1);\n\t\tDom.addClass(leftCell, 'dynamic-field');\n\t\tDom.append(this.#getField(leftField, leftField.Value), leftCell);\n\t\tDom.append(this.#getEqualSign(), row.insertCell(-1));\n\t\tDom.append(this.#getField(rightField, rightField.Value), row.insertCell(-1));\n\t\tDom.append(this.#getDeleteButton(row), row.insertCell(-1));\n\t}\n\n\t#renderSystemFieldRow(row: HTMLTableRowElement, leftField: Field, rightField: Field): void\n\t{\n\t\tconst leftCell = row.insertCell(-1);\n\t\tDom.addClass(leftCell, 'locked-field');\n\t\tDom.append(this.#getField(leftField, leftField.Value), leftCell);\n\t\tDom.append(this.#getEqualSign(), row.insertCell(-1));\n\t\tDom.append(this.#getField(rightField, rightField.Value), row.insertCell(-1));\n\t\tDom.append(this.#getDeleteButton(row), row.insertCell(-1));\n\t}\n\n\t#cleanupExistingMenu(): void\n\t{\n\t\tif (this.#fieldMenu && this.#fieldMenu.getId())\n\t\t{\n\t\t\tPopupMenu.destroy(this.#fieldMenu.getId());\n\t\t\tthis.#fieldMenu = null;\n\t\t}\n\t}\n\n\t#addDynamicStorageField(key: string, value: string): void\n\t{\n\t\tconst keyField = this.#createDynamicKeyField(key);\n\t\tconst valueField = this.#createDynamicValueField(value);\n\n\t\tconst row = this.#fieldsContainer.insertRow(-1);\n\t\trow.dataset.id = keyField.Id;\n\n\t\tconst index = this.#systemFields.findIndex(f => f.Id === key);\n\t\tif (index !== -1)\n\t\t{\n\t\t\tthis.#renderSystemFieldRow(row, keyField, valueField);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#renderDynamicFieldRow(row, keyField, valueField);\n\t\t}\n\t}\n\n\t#openFieldEdit(fieldId: ?int = null): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tRuntime\n\t\t\t\t.loadExtension('bizproc.router')\n\t\t\t\t.then(({ Router }) => {\n\t\t\t\t\tRouter.openStorageFieldEdit({\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonCloseComplete: (event: BX.SidePanel.Event) => {\n\t\t\t\t\t\t\t\tconst slider = event.getSlider();\n\t\t\t\t\t\t\t\tconst dictionary: ?BX.SidePanel.Dictionary = slider ? slider.getData() : null;\n\t\t\t\t\t\t\t\tlet data = null;\n\t\t\t\t\t\t\t\tif (dictionary && dictionary.has('data'))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tdata = dictionary.get('data');\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresolve(data);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\trequestMethod: 'get',\n\t\t\t\t\t\trequestParams: { storageId: this.#storageIdField.value, fieldId},\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((e) => {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t\tresolve(null);\n\t\t\t\t});\n\t\t});\n\t}\n\n\t#addStorageField(field: Field): void\n\t{\n\t\tthis.#storageFields.push(field);\n\t}\n\n\t#addField(field: Field): void\n\t{\n\t\tconst row = this.#fieldsContainer.insertRow(-1);\n\t\trow.dataset.id = field.Id;\n\t\tthis.#renderFieldRow(row, field);\n\t}\n\n\t#editStorageField(field: Field): void\n\t{\n\t\tconst index = this.#storageFields.findIndex(f => f.Id === field.Id);\n\t\tif (index !== -1)\n\t\t{\n\t\t\tthis.#storageFields[index] = field;\n\t\t}\n\t}\n\n\t#editField(field: Field): void\n\t{\n\t\tconst row = this.#fieldsContainer.querySelector(`tr[data-id=\"${field.Id}\"]`);\n\t\tif (row)\n\t\t{\n\t\t\tDom.clean(row);\n\t\t\tthis.#renderFieldRow(row, field);\n\t\t}\n\t}\n\n\t#renderFieldRow(row: HTMLTableRowElement, field: Field): void\n\t{\n\t\tconst leftCell = row.insertCell(-1);\n\t\tDom.addClass(leftCell, 'static-field');\n\t\tDom.append(this.#getSelectField(field.Name), leftCell);\n\t\tDom.append(this.#getEqualSign(), row.insertCell(-1));\n\t\tDom.append(this.#getField(field), row.insertCell(-1));\n\t\tconst editBtn = this.#getEditButton(row, field.Id);\n\t\tif (editBtn)\n\t\t{\n\t\t\tDom.append(editBtn, row.insertCell(-1));\n\t\t}\n\t\telse\n\t\t{\n\t\t\trow.insertCell(-1);\n\t\t}\n\t\tDom.append(this.#getDeleteButton(row), row.insertCell(-1));\n\t}\n\n\t#getSelectField(name: string): HTMLSpanElement\n\t{\n\t\treturn Tag.render`<span>${Text.encode(name)}</span>`;\n\t}\n\n\t#getEqualSign(): HTMLSpanElement\n\t{\n\t\treturn Tag.render`<span>=</span>`;\n\t}\n\n\t#getField(field, value = null): HTMLElement\n\t{\n\t\tlet currentValue = this.#currentValues[field.FieldName] ?? null;\n\t\tif (value)\n\t\t{\n\t\t\tcurrentValue = value;\n\t\t}\n\n\t\treturn BX.Bizproc.FieldType.renderControl(\n\t\t\tthis.#documentType,\n\t\t\tfield,\n\t\t\tfield.FieldName,\n\t\t\tcurrentValue,\n\t\t\t'designer',\n\t\t);\n\t}\n\n\t#getDeleteButton(row: HTMLElement): HTMLButtonElement\n\t{\n\t\tconst button = Tag.render`<a href=\"#\"><div class=\"ui-icon-set --cross-m\"></div></a>`;\n\n\t\tEvent.bind(\n\t\t\tbutton,\n\t\t\t'click',\n\t\t\t(event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tDom.remove(row);\n\t\t\t},\n\t\t);\n\n\t\treturn button;\n\t}\n\n\t#getEditButton(row: HTMLElement, fieldId: number): ?HTMLButtonElement\n\t{\n\t\tconst button = Tag.render`<a href=\"#\"><div class=\"ui-icon-set --edit-m\"></div></a>`;\n\t\tconst systemFieldIds = this.#systemFields.map(item => item.Id);\n\t\tif (systemFieldIds.includes(fieldId))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tEvent.bind(\n\t\t\tbutton,\n\t\t\t'click',\n\t\t\tasync (event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst field = await this.#openFieldEdit(fieldId);\n\n\t\t\t\tif (!field)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst isDeleteAction = field.action === 'bizproc.storage.deleteField' && field.id;\n\t\t\t\tif (isDeleteAction)\n\t\t\t\t{\n\t\t\t\t\tthis.#deleteFieldRow(Number(field.id));\n\t\t\t\t\tthis.#storageFields = this.#storageFields.filter(f => f.Id !== Number(field.id));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#editStorageField(field);\n\t\t\t\t\tthis.#editField(field);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\n\t\treturn button;\n\t}\n\n\t#deleteFieldRow(fieldId: number): void\n\t{\n\t\tconst rowToRemove = this.#fieldsContainer.querySelector(`[data-id=\"${fieldId}\"]`);\n\t\tif (rowToRemove)\n\t\t{\n\t\t\tDom.remove(rowToRemove);\n\t\t}\n\t}\n\n\t#renderStorageSelector(): void\n\t{\n\t\tthis.#storageSelectorContainer.innerHTML = '';\n\n\t\tthis.#storageSelectorInstance = new StorageSelector(this.#storageIdField, this.#storageItems ?? [], {\n\t\t\tonCreateNewStorageHandler: this.#createNewStorage.bind(this),\n\t\t}).getTagSelector();\n\t\tthis.#storageSelectorInstance.renderTo(this.#storageSelectorContainer);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#unbindEvents();\n\t}\n\n\t#unbindEvents(): void\n\t{\n\t\tEvent.unbindAll(this.#storageIdField);\n\t\tEvent.unbindAll(this.#storageCodeField);\n\t\tEvent.unbindAll(this.#modeField);\n\t\tEvent.unbindAll(this.#addFieldButton);\n\n\t\tthis.#fieldsCache.clear();\n\t\tif (this.#storageSelectorInstance)\n\t\t{\n\t\t\tthis.#storageSelectorInstance.destroy();\n\t\t}\n\n\t\tEventEmitter.unsubscribe(\n\t\t\t'BX.Bizproc.FieldType.onDesignerRenderControlFinished',\n\t\t\tthis.#onAfterFieldRendererHandler,\n\t\t);\n\n\t\tEventEmitter.unsubscribe(\n\t\t\t'BX.Bizproc.Component.StorageItemList:onStorageRemove',\n\t\t\tthis.#onStorageRemoveHandler,\n\t\t);\n\t}\n}\n\nnamespace.WriteDataStorageActivity = WriteDataStorageActivity;\n"],"names":["StorageSelectorFooter","DefaultFooter","constructor","dialog","options","getContent","cache","remember","Tag","render","Loc","getMessage","handler","getOption","Type","isNil","isFunction","Error","StorageSelector","storageIdField","storageItems","eventHandlers","getTagSelector","targetNode","Router","init","items","value","parseInt","Number","isNaN","storageId","map","item","id","TagSelector","dialogOptions","tabs","title","width","height","enableSearch","compactView","dropdownMode","showAvatars","events","event","selectedItem","getData","getId","dispatchEvent","Event","footer","footerOptions","onCreateNewStorageHandler","multiple","tagMaxWidth","textBoxWidth","selector","getTarget","tag","itemOptions","text","addItem","selected","entityId","linkTitle","link","field","option","find","o","Option","Text","encode","add","namespace","Reflection","WriteDataStorageActivity","Map","fieldsContainer","storageSelectorContainer","storageCodeField","modeField","addFieldButton","documentType","currentValues","systemFields","isArray","bind","destroy","EventEmitter","subscribe","filter","node","data","textarea","querySelector","isFieldValues","name","randString","Math","random","toString","substr","uniqueId","button","oldOnclick","getAttribute","newOnclick","replace","setAttribute","storageCodeRow","closest","storageCodeValue","isStringFilled","fields","Dom","hide","fieldName","Object","entries","isArrayFilled","length","FieldName","Value","storageData","storageTitle","clean","show","storageCode","currentTarget","trim","removeTags","row","document","Mode","MERGE","REWRITE","Promise","resolve","Runtime","loadExtension","then","openStorageEdit","onCloseComplete","slider","getSlider","dictionary","has","get","catch","e","console","error","addTag","response","ajax","runAction","Action","GET_FIELDS","format","status","set","preventDefault","addedFieldIds","menuItems","writeDataActivity","Name","push","onclick","popupWindow","close","fieldRows","Array","from","querySelectorAll","Set","dataset","fieldId","String","Id","PopupMenu","create","Date","now","bindElement","autoHide","onPopupClose","customValue","fieldIndex","Required","AllowSelection","leftField","rightField","leftCell","insertCell","addClass","append","key","keyField","valueField","insertRow","index","findIndex","f","openStorageFieldEdit","requestMethod","requestParams","editBtn","currentValue","BX","Bizproc","FieldType","renderControl","remove","systemFieldIds","includes","isDeleteAction","action","rowToRemove","innerHTML","renderTo","unbindAll","clear","unsubscribe"],"mappings":"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"}