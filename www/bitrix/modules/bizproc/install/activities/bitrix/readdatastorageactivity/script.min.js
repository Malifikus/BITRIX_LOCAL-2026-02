(function(e,t,i){"use strict";function r(e,t){s(e,t);t.add(e)}function n(e,t,i){s(e,t);t.set(e,i)}function s(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function l(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var a=t.Reflection.namespace("BX.Bizproc.Activity");var o=new WeakMap;var d=new WeakSet;var c=new WeakSet;var u=new WeakSet;var h=function(){function e(s){babelHelpers.classCallCheck(this,e);r(this,u);r(this,c);r(this,d);n(this,o,{writable:true,value:{dependentElements:[],isReturnFieldsRendered:true}});babelHelpers.defineProperty(this,"returnFieldsProperty",{});if(t.Type.isPlainObject(s)){this.documentType=s.documentType;var l=document.forms[s.formName];if(!t.Type.isNil(l)){var a,h;this.storageIdSelect=l.storage_id;this.currentStorageId=Number(((a=this.storageIdSelect)===null||a===void 0?void 0:a.value)||0);this.storageIdDependentElements=l.querySelectorAll('[data-role="bpa-sra-storage-id-dependent"]');babelHelpers.classPrivateFieldGet(this,o).element=l.storage_code;(h=babelHelpers.classPrivateFieldGet(this,o).dependentElements).push.apply(h,babelHelpers.toConsumableArray(l.querySelectorAll('[data-role="bpa-sra-storage-code-dependent"]').values()).concat([l.querySelector('[data-role="bpa-sra-filter-fields-container"]').closest("tr")]))}this.document=new i.Document({rawDocumentType:this.documentType,documentFields:s.documentFields,title:s.documentName});this.initAutomationContext();this.initFilterFields(s);this.initReturnFields(s);this.render()}}babelHelpers.createClass(e,[{key:"initFilterFields",value:function e(r){this.conditionIdPrefix="id_bpa_sra_field_";this.filterFieldsContainer=document.querySelector('[data-role="bpa-sra-filter-fields-container"]');this.filteringFieldsPrefix=r.filteringFieldsPrefix;this.filterFieldsMap=new Map(Object.entries(r.filterFieldsMap).map((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],r=t[1];return[Number(i),r]})));if(!t.Type.isNil(r.documentType)){BX.Bizproc.Automation.API.documentType=r.documentType}this.conditionGroup=new i.ConditionGroup(r.conditions)}},{key:"initReturnFields",value:function e(i){var r=this;this.returnFieldsProperty=i.returnFieldsProperty;this.returnFieldsIds=t.Type.isArray(i.returnFieldsIds)?i.returnFieldsIds:[];this.returnFieldsMapContainer=document.querySelector('[data-role="bpa-sra-return-fields-container"]');this.returnFieldsMap=new Map;Object.entries(i.returnFieldsMap).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],n=t[1];r.returnFieldsMap.set(Number(i),new Map(Object.entries(n)))}));babelHelpers.classPrivateFieldGet(this,o).returnFieldsProperty=i.returnFieldsByStorageCodeProperty;babelHelpers.classPrivateFieldGet(this,o).returnFieldsContainer=document.querySelector('[data-role="bpa-sra-return-fields-by-storage-code-container"]')}},{key:"initAutomationContext",value:function e(){try{i.getGlobalContext()}catch(e){i.setGlobalContext(new i.Context({document:this.document}))}}},{key:"init",value:function e(){if(this.storageIdSelect){t.Event.bind(this.storageIdSelect,"change",this.onStorageIdChange.bind(this))}if(babelHelpers.classPrivateFieldGet(this,o).element){this.renderFilterFields();t.Event.bind(babelHelpers.classPrivateFieldGet(this,o).element,"input",l(this,d,p).bind(this));t.Event.bind(babelHelpers.classPrivateFieldGet(this,o).element,"focus",l(this,d,p).bind(this))}}},{key:"onStorageIdChange",value:function e(){this.currentStorageId=Number(this.storageIdSelect.value);if(this.currentStorageId>0){l(this,c,F).call(this)}this.conditionGroup=new i.ConditionGroup;this.returnFieldsIds=[];this.render()}},{key:"render",value:function e(){babelHelpers.classPrivateFieldGet(this,o).dependentElements.forEach((function(e){return t.Dom.hide(e)}));if(t.Type.isNil(this.currentStorageId)||this.currentStorageId<=0){this.storageIdDependentElements.forEach((function(e){return t.Dom.hide(e)}));l(this,u,f).call(this)}else{this.storageIdDependentElements.forEach((function(e){return t.Dom.show(e)}));this.renderFilterFields();this.renderReturnFields()}}},{key:"showFieldSelector",value:function e(t){BPAShowSelector(t,"string","")}},{key:"renderFilterFields",value:function e(){if(!t.Type.isNil(this.conditionGroup)){var r=new i.ConditionGroupSelector(this.conditionGroup,{fields:Object.values(this.filterFieldsMap.get(this.currentStorageId)||{}),fieldPrefix:this.filteringFieldsPrefix,customSelector:t.Type.isFunction(BPAShowSelector)?this.showFieldSelector:null,caption:{head:t.Loc.getMessage("BIZPROC_SRA_FILTER_FIELDS_PROPERTY"),collapsed:t.Loc.getMessage("BIZPROC_SRA_FILTER_FIELDS_COLLAPSED_TEXT")}});if(r.modern&&this.filterFieldsContainer&&this.filterFieldsContainer.parentNode){var n=this.filterFieldsContainer.parentNode.firstElementChild===this.filterFieldsContainer?this.filterFieldsContainer.parentNode.parentNode.firstElementChild:this.filterFieldsContainer.parentNode.firstElementChild;t.Dom.clean(n)}t.Dom.clean(this.filterFieldsContainer);t.Dom.append(r.createNode(),this.filterFieldsContainer)}}},{key:"renderReturnFields",value:function e(){var i=this.currentStorageId;var r=this.returnFieldsMap.get(i);if(!t.Type.isNil(r)){var n={};r.forEach((function(e,t){n[t]=e.Name}));this.returnFieldsProperty.Options=n;t.Dom.clean(this.returnFieldsMapContainer);this.returnFieldsMapContainer.appendChild(BX.Bizproc.FieldType.renderControl(this.documentType,this.returnFieldsProperty,this.returnFieldsProperty.FieldName,this.returnFieldsIds,"designer"))}}}]);return e}();function p(){if(this.currentStorageId<=0&&babelHelpers.classPrivateFieldGet(this,o).returnFieldsContainer){if(!t.Type.isStringFilled(babelHelpers.classPrivateFieldGet(this,o).element.value)){l(this,c,F).call(this)}this.render()}}function F(){babelHelpers.classPrivateFieldGet(this,o).dependentElements.forEach((function(e){return t.Dom.hide(e)}));babelHelpers.classPrivateFieldGet(this,o).element.value="";t.Dom.clean(babelHelpers.classPrivateFieldGet(this,o).returnFieldsContainer);babelHelpers.classPrivateFieldGet(this,o).isReturnFieldsRendered=false;this.conditionGroup=new i.ConditionGroup}function f(){if(t.Type.isStringFilled(babelHelpers.classPrivateFieldGet(this,o).element.value)){babelHelpers.classPrivateFieldGet(this,o).dependentElements.forEach((function(e){return t.Dom.show(e)}));if(!babelHelpers.classPrivateFieldGet(this,o).isReturnFieldsRendered){this.renderFilterFields();t.Dom.clean(babelHelpers.classPrivateFieldGet(this,o).returnFieldsContainer);t.Dom.append(BX.Bizproc.FieldType.renderControlDesigner(this.documentType,babelHelpers.classPrivateFieldGet(this,o).returnFieldsProperty,babelHelpers.classPrivateFieldGet(this,o).returnFieldsProperty.FieldName),babelHelpers.classPrivateFieldGet(this,o).returnFieldsContainer);babelHelpers.classPrivateFieldGet(this,o).isReturnFieldsRendered=true}}}a.ReadDataStorageActivity=h})(this.window=this.window||{},BX,BX.Bizproc.Automation);
//# sourceMappingURL=script.map.js