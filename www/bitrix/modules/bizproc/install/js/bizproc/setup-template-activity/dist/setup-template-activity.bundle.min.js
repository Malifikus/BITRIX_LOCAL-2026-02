this.BX=this.BX||{};(function(t,e,n,i,s,a,l,o,r,c){"use strict";const d={name:"DraggableContainer",props:{items:{type:Array,required:true},blockIndex:{type:Number,required:true}},emits:["update:items"],data(){return{isDragging:false,dropTargetIndex:null,dragState:{sourceBlockIndex:null,draggedItemIndex:null,draggedElement:null,ghostElement:null,offsetX:0,offsetY:0,lastTargetBlockIndex:null,lastTargetItemIndex:null}}},computed:{draggedItemIndex(){return this.isDragging?this.dragState.draggedItemIndex:null}},created(){this.boundHandleDragMove=this.handleDragMove.bind(this);this.boundHandleDragEnd=this.handleDragEnd.bind(this);i.EventEmitter.subscribe("Bizproc.SetupTemplate:Draggable:start",this.onGlobalDragStart);i.EventEmitter.subscribe("Bizproc.SetupTemplate:Draggable:dragover",this.onGlobalDragOver);i.EventEmitter.subscribe("Bizproc.SetupTemplate:Draggable:end",this.onGlobalDragEnd)},beforeUnmount(){i.EventEmitter.unsubscribe("Bizproc.SetupTemplate:Draggable:start",this.onGlobalDragStart);i.EventEmitter.unsubscribe("Bizproc.SetupTemplate:Draggable:dragover",this.onGlobalDragOver);i.EventEmitter.unsubscribe("Bizproc.SetupTemplate:Draggable:end",this.onGlobalDragEnd)},methods:{onGlobalDragStart(t){const e=t.getData();const{sourceItemIndex:n,sourceBlockIndex:i,event:a,element:l}=e;if(i!==this.blockIndex){return}a.preventDefault();this.isDragging=true;this.dragState.sourceBlockIndex=this.blockIndex;this.dragState.draggedItemIndex=n;this.dragState.draggedElement=l;this.createGhost(a);s.Dom.addClass(this.dragState.draggedElement,"--dragging");s.Dom.addClass(document.body,"--user-dragging");s.Event.bind(document,"mousemove",this.boundHandleDragMove);s.Event.bind(document,"mouseup",this.boundHandleDragEnd)},onGlobalDragOver(t){const e=t.getData();if(e.targetBlockIndex===this.blockIndex){this.dropTargetIndex=e.targetItemIndex}else{this.dropTargetIndex=null}if(this.isDragging){this.dragState.lastTargetBlockIndex=e.targetBlockIndex;this.dragState.lastTargetItemIndex=e.targetItemIndex}},handleDragMove(t){if(!this.isDragging){return}this.updateGhostPosition(t);const e={targetBlockIndex:null,targetItemIndex:null};const n=document.elementFromPoint(t.clientX,t.clientY);if(n){const i=n.closest("[data-draggable-container]");if(i){e.targetBlockIndex=parseInt(i.dataset.blockIndex,10);const s=[...i.querySelectorAll("[data-draggable-item]")];const a=n.closest("[data-draggable-item]");if(a){const n=a.getBoundingClientRect();const i=t.clientY-n.top>n.height/2;const l=s.indexOf(a);e.targetItemIndex=i?l+1:l}else if(s.length===0){e.targetItemIndex=0}}}i.EventEmitter.emit("Bizproc.SetupTemplate:Draggable:dragover",e)},handleDragEnd(){if(!this.isDragging){return}i.EventEmitter.emit("Bizproc.SetupTemplate:Draggable:drop",{sourceBlockIndex:this.dragState.sourceBlockIndex,sourceItemIndex:this.dragState.draggedItemIndex,targetBlockIndex:this.dragState.lastTargetBlockIndex,targetItemIndex:this.dragState.lastTargetItemIndex});i.EventEmitter.emit("Bizproc.SetupTemplate:Draggable:end")},onGlobalDragEnd(){if(this.isDragging){this.resetDragState()}this.isDragging=false;this.dropTargetIndex=null},resetDragState(){s.Dom.removeClass(document.body,"--user-dragging");if(this.dragState.draggedElement){s.Dom.removeClass(this.dragState.draggedElement,"--dragging")}if(this.dragState.ghostElement){s.Dom.remove(this.dragState.ghostElement)}s.Event.unbind(document,"mousemove",this.boundHandleDragMove);s.Event.unbind(document,"mouseup",this.boundHandleDragEnd);this.dragState={sourceBlockIndex:null,draggedItemIndex:null,draggedElement:null,ghostElement:null,offsetX:0,offsetY:0,lastTargetBlockIndex:null,lastTargetItemIndex:null}},updateGhostPosition(t){if(!this.dragState.ghostElement){return}s.Dom.style(this.dragState.ghostElement,"left",`${t.clientX-this.dragState.offsetX}px`);s.Dom.style(this.dragState.ghostElement,"top",`${t.clientY-this.dragState.offsetY}px`)},createGhost(t){const e=this.dragState.draggedElement.getBoundingClientRect();this.dragState.offsetX=t.clientX-e.left;this.dragState.offsetY=t.clientY-e.top;const n=this.dragState.draggedElement.cloneNode(true);s.Dom.addClass(n,"--ghost");s.Dom.style(n,"width",`${e.width}px`);s.Dom.append(n,document.body);this.dragState.ghostElement=n;this.updateGhostPosition(t)}},template:`\n\t\t<div>\n\t\t\t<slot\n\t\t\t\t:dropTargetIndex="dropTargetIndex"\n\t\t\t\t:draggedItemIndex="draggedItemIndex"\n\t\t\t></slot>\n\t\t</div>\n\t`};const p={name:"BlockComponent",components:{BIcon:a.BIcon,DraggableContainer:d},props:{position:{type:Number,required:true},items:{type:Array,required:true},blockIndex:{type:Number,required:true}},emits:["deleteBlock","update:items"],setup(){return{Outline:l.Outline}},computed:{title(){return this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_BLOCK_TITLE",{"#POSITION#":this.position})}},methods:{onItemsUpdate(t){this.$emit("update:items",t)},showDropPlaceholder(t,e){return t.dropTargetIndex===e&&t.dropTargetIndex!==t.draggedItemIndex},showFinalDropPlaceholder(t){return t.dropTargetIndex===this.items.length&&t.draggedItemIndex!==this.items.length}},template:`\n\t\t<div class="bizproc-setuptemplateactivity-block">\n\t\t\t<div class="bizproc-setuptemplateactivity-block__header">\n\t\t\t\t<div class="bizproc-setuptemplateactivity-block__header-wrap">\n\t\t\t\t\t<p class="bizproc-setuptemplateactivity-block__title">\n\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t</p>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\t\t:size="18"\n\t\t\t\t\t\tclass="bizproc-setuptemplateactivity-block__delete-icon"\n\t\t\t\t\t\t@click="$emit('deleteBlock')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<DraggableContainer\n\t\t\t\t:items="items"\n\t\t\t\t:blockIndex="blockIndex"\n\t\t\t\t@update:items="onItemsUpdate"\n\t\t\t\tv-slot="dnd"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\t:data-block-index="blockIndex"\n\t\t\t\t\tclass="bizproc-setuptemplateactivity-block__items"\n\t\t\t\t\tdata-draggable-container="true"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for="(item, itemIndex) in items"\n\t\t\t\t\t\t:key="item.id"\n\t\t\t\t\t\tclass="bizproc-setuptemplateactivity-draggable-wrapper"\n\t\t\t\t\t\tdata-draggable-item="true"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="showDropPlaceholder(dnd, itemIndex)"\n\t\t\t\t\t\t\tclass="bizproc-setuptemplateactivity-drop-placeholder"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\tname="item"\n\t\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t\t:itemIndex="itemIndex"\n\t\t\t\t\t\t></slot>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="showFinalDropPlaceholder(dnd)"\n\t\t\t\t\t\tclass="bizproc-setuptemplateactivity-drop-placeholder"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</DraggableContainer>\n\t\t\t<div class="bizproc-setuptemplateactivity-block__footer">\n\t\t\t\t<div class="bizproc-setuptemplateactivity-block__footer-wrap">\n\t\t\t\t\t<slot name="footer"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const u={name:"AddBlockBtn",template:`\n\t\t<button\n\t\t\tclass="ui-btn --air --wide --style-outline-no-accent ui-btn-no-caps --with-icon"\n\t\t\ttype="button"\n\t\t>\n\t\t\t<div class="ui-icon-set --plus-l"/>\n\t\t\t<span class="ui-btn-text">\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_ADD_BLOCK') }}\n\t\t\t</span>\n\t\t</button>\n\t`};const m=Object.freeze({DELIMITER:"delimiter",TITLE:"title",TITLE_WITH_ICON:"titleWithIcon",ICON_TITLE:"iconTitle",DESCRIPTION:"description",CONSTANT:"constant"});const v=Object.freeze({STRING:"string",INT:"int",USER:"user",FILE:"file",TEXT:"text",SELECT:"select"});const T=Object.freeze({LINE:"line"});const I="SetupTemplateActivity_";const _={IMAGE:"o-image",ATTACH:"o-attach",SETTINGS:"o-settings",STARS:"o-ai-stars"};function E(){return{id:f(),items:[]}}function g(){return{id:f(),itemType:m.DELIMITER,delimiterType:T.LINE}}function h(){return{id:f(),itemType:m.TITLE,text:""}}function b(){return{id:f(),itemType:m.TITLE_WITH_ICON,text:"",icon:"IMAGE"}}function S(){return{id:f(),itemType:m.DESCRIPTION,text:""}}function B(t=null){return{itemType:m.CONSTANT,id:t||f(),name:"",constantType:v.STRING,multiple:false,description:"",default:"",options:[],required:false}}function y(t){return{Name:t.name,Description:t.description,Type:t.constantType,Required:0,Multiple:t.multiple?1:0,Options:t.options&&t.options.length>0?t.options:null,Default:t.default}}function P(t){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";const i=e.length;for(let s=0;s<t;s++){n+=e.charAt(Math.floor(Math.random()*i))}return n}function f(){return I+P(10)}const C={name:"AddElementBtn",components:{BMenu:o.BMenu},props:{constantIds:{type:Set,default:()=>new Set}},emits:["add:element","create:constant"],data(){return{isMenuShown:false,offsetLeft:0}},computed:{menuOptions(){return{bindElement:this.$refs.addElementButton,offsetLeft:this.offsetLeft,fixed:false,cacheable:false,items:[{title:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_TITLE_ITEM_LABEL"),onClick:()=>this.$emit("add:element",h())},{title:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_ICON_TITLE_ITEM_LABEL"),onClick:()=>this.$emit("add:element",b())},{title:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DESCRIPTION_ITEM_LABEL"),onClick:()=>this.$emit("add:element",S())},{title:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DELIMITER_ITEM_LABEL"),onClick:()=>this.$emit("add:element",g())},{title:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_MENU"),onClick:()=>{const t=this.generateFriendlyId();this.$emit("create:constant",B(t))}}]}}},methods:{onShowMenu(t){var e,n;const{left:i=0}=(e=(n=this.$refs.addElementButton)==null?void 0:n.getBoundingClientRect())!=null?e:{};this.offsetLeft=Math.abs(t.clientX-i);this.isMenuShown=true},generateFriendlyId(){const t="Constant";let e=1;let n=`${t}${e}`;while(this.constantIds.has(n)){e++;n=`${t}${e}`}return n}},template:`\n\t\t<button\n\t\t\tref="addElementButton"\n\t\t\tclass="ui-btn --air --wide --style-outline-no-accent ui-btn-no-caps --with-icon bizproc-setuptemplateactivity-add-element-btn"\n\t\t\ttype="button"\n\t\t\t@click="onShowMenu"\n\t\t>\n\t\t\t<div class="ui-icon-set --plus-l"/>\n\t\t\t<span class="ui-btn-text">\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_ADD_ITEM') }}\n\t\t\t</span>\n\t\t\t<BMenu\n\t\t\t\tv-if="isMenuShown"\n\t\t\t\t:options="menuOptions"\n\t\t\t\t@close="isMenuShown = false"\n\t\t\t/>\n\t\t</button>\n\t`};const L={name:"AppHeader",template:`\n\t\t<header class="bizproc-setuptemplateactivity-app-header">\n\t\t\t<div class="bizproc-setuptemplateactivity-app-header__title-wrap">\n\t\t\t\t<h3 class="bizproc-setuptemplateactivity-app-header__title">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_APP_TITLE') }}\n\t\t\t\t</h3>\n\t\t\t\t<div class="bizproc-setuptemplateactivity-app-header__preview-btn">\n\t\t\t\t\t<slot name="preview-btn"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<p class="bizproc-setuptemplateactivity-app-header__description">\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_HEADER_DESCRIPTION') }}\n\t\t\t</p>\n\t\t</header>\n\t`};const A={name:"PreviewBtn",components:{BIcon:a.BIcon},props:{showPreview:{type:Boolean,default:false}},computed:{icon(){return this.showPreview?l.Outline.CROSSED_EYE:l.Outline.OBSERVER},label(){return this.showPreview?this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_HIDE_PREVIEW_BTN_TEXT"):this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_SHOW_PREVIEW_BTN_TEXT")}},template:`\n\t\t<button\n\t\t\tclass="bizproc-setuptemplateactivity-preview-btn"\n\t\t\ttype="button"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\t:name="icon"\n\t\t\t\t:size="24"\n\t\t\t\tclass="bizproc-setuptemplateactivity-preview-btn__icon"\n\t\t\t/>\n\t\t\t<span class="bizproc-setuptemplateactivity-preview-btn__label">\n\t\t\t\t{{ label }}\n\t\t\t</span>\n\t\t</button\n\t`};const O={name:"TitleField",components:{BIcon:a.BIcon},props:{item:{type:Object,required:true}},emits:["updateItemProperty","delete"],setup(){return{Outline:l.Outline,Main:l.Main}},methods:{onInput(t){const e={propertyValues:{text:t.target.value}};this.$emit("updateItemProperty",e)},handleDragStart(t){this.$emit("itemDragStart",{event:t,element:this.$el})}},template:`\n\t\t<div class="bizproc-setuptemplateactivity-field-wrapper">\n\t\t\t<div\n\t\t\t\tclass="bizproc-setuptemplateactivity-field-drag-icon"\n\t\t\t\t@mousedown.prevent="handleDragStart"\n\t\t\t>\n\t\t\t\t<BIcon :name="Main.MORE_POINTS" :size="18"/>\n\t\t\t</div>\n\t\t\t<div class="bizproc-setuptemplateactivity-title-field">\n\t\t\t\t<div class="ui-ctl-container">\n\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t<div class="ui-ctl-title bizproc-setuptemplateactivity-title-field__label">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_TITLE_ITEM_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-w100">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t:value="item.text"\n\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t@input="onInput"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bizproc-setuptemplateactivity-title-field__controls">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\t\t:size="18"\n\t\t\t\t\t\tclass="bizproc-setuptemplateactivity-title-field__delete-icon"\n\t\t\t\t\t\t@click="$emit('delete')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const x={name:"DescriptionField",components:{BIcon:a.BIcon},props:{item:{type:Object,required:true}},emits:["updateItemProperty"],setup(){return{Outline:l.Outline,Main:l.Main}},methods:{onInput(t){const e={propertyValues:{text:t.target.value}};this.$emit("updateItemProperty",e)},handleDragStart(t){this.$emit("itemDragStart",{event:t,element:this.$el})}},template:`\n\t\t<div class="bizproc-setuptemplateactivity-field-wrapper">\n\t\t\t<div\n\t\t\t\tclass="bizproc-setuptemplateactivity-field-drag-icon"\n\t\t\t\t@mousedown.prevent="handleDragStart"\n\t\t\t>\n\t\t\t\t<BIcon :name="Main.MORE_POINTS" :size="18"/>\n\t\t\t</div>\n\t\t\t<div class="bizproc-setuptemplateactivity-description-feild">\n\t\t\t\t<div class="ui-ctl-container">\n\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t<div class="ui-ctl-title bizproc-setuptemplateactivity-description-feild__label">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DESCRIPTION_ITEM_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-w100">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t:value="item.text"\n\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\trows="4"\n\t\t\t\t\t\t\t@input="onInput"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bizproc-setuptemplateactivity-description-feild__controls">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\t\t:size="18"\n\t\t\t\t\t\tclass="bizproc-setuptemplateactivity-description-feild__delete-icon"\n\t\t\t\t\t\t@click="$emit('delete')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const M={name:"DelimiterField",components:{BIcon:a.BIcon},props:{item:{type:Object,required:true}},emits:["updateItemProperty"],setup(){return{Outline:l.Outline,Main:l.Main}},methods:{onSelect(t){const e={propertyValues:{delimiterType:t.target.value}};this.$emit("updateItemProperty",e)},handleDragStart(t){this.$emit("itemDragStart",{event:t,element:this.$el})}},template:`\n\t\t<div class="bizproc-setuptemplateactivity-field-wrapper">\n\t\t\t<div\n\t\t\t\tclass="bizproc-setuptemplateactivity-field-drag-icon"\n\t\t\t\t@mousedown.prevent="handleDragStart"\n\t\t\t>\n\t\t\t\t<BIcon :name="Main.MORE_POINTS" :size="18"/>\n\t\t\t</div>\n\t\t\t<div class="bizproc-setuptemplateactivity-delimiter-field">\n\t\t\t\t<div class="ui-ctl-container">\n\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t<div class="ui-ctl-title">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DELIMITER_ITEM_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t:value="item.delimiterType"\n\t\t\t\t\t\t\tclass="ui-ctl-element ui-ctl-w100"\n\t\t\t\t\t\t\t@change="onSelect"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value="line">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DELIMITER_ITEM_OPTION_LINE') }}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bizproc-setuptemplateactivity-delimiter-field__controls">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\t\t:size="18"\n\t\t\t\t\t\tclass="bizproc-setuptemplateactivity-delimiter-field__delete-icon"\n\t\t\t\t\t\t@click="$emit('delete')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const D={name:"EditConstantPopupForm",components:{UiButton:r.Button},inject:["editSlider"],props:{item:{type:Object,required:true},fieldTypeNames:{type:Object,required:true},isCreation:{type:Boolean,default:false}},emits:["update:item","cancel"],setup(){return{AirButtonStyle:r.AirButtonStyle,ButtonSize:r.ButtonSize}},data(){return{id:this.item.id,name:this.item.name,constantType:this.item.constantType,multiple:this.item.multiple,description:this.item.description,defaultValue:this.item.default,options:[...this.item.options],required:this.item.required,errors:{id:"",name:"",options:this.item.options.map((()=>""))}}},computed:{isSelectType(){return this.constantType===v.SELECT},errorMessages(){return{required:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_ERROR_LABEL_REQUIRED"),idFormat:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_ERROR_ID_FORMAT"),idUnique:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_ERROR_ID_UNIQUE")}}},watch:{constantType(){this.options=[]}},methods:{onAddOption(){this.options.push({name:""});this.errors.options.push("")},onDeleteOption(t){this.options.splice(t,1);this.errors.options.splice(t,1)},validateName(){this.errors.name="";if(!s.Type.isStringFilled(this.name.trim())){this.errors.name=this.errorMessages.required;return false}return true},validateId(){this.errors.id="";const t=this.id.trim();if(!s.Type.isStringFilled(t)){this.errors.id=this.errorMessages.required;return false}if(!/^[A-Za-z]\w*$/.test(t)){this.errors.id=this.errorMessages.idFormat;return false}return true},validateOption(t){const e=this.options[t].name.trim();this.errors.options[t]="";if(!s.Type.isStringFilled(e)){this.errors.options[t]=this.errorMessages.required;return false}return true},validateOptions(){if(this.constantType!==v.SELECT){return true}let t=0;this.errors.options=[];this.options.forEach(((e,n)=>{if(s.Type.isStringFilled(e.name.trim())){this.errors.options[n]=""}else{t+=1;this.errors.options[n]=this.errorMessages.required}}));return t===0},resetErrors(){this.errors={id:"",name:"",options:[]}},onSave(){const t=[this.validateId(),this.validateName(),this.validateOptions()].every((t=>t));if(!t){return}const e=()=>{this.errors.id=this.errorMessages.idUnique};this.$emit("update:item",{propertyValues:{...this.item,id:this.id.trim(),name:this.name,description:this.description,constantType:this.constantType,multiple:this.multiple,options:[...this.options],default:this.defaultValue,required:this.required},setError:e})},onCancel(){var t;(t=this.editSlider)==null?void 0:t.close();this.$emit("cancel")}},template:`\n\t\t<div class="bizproc-setuptemplateactivity-edit-constant-popup">\n\t\t\t<div class="bizproc-setuptemplateactivity-edit-constant-popup__container">\n\t\t\t\t<div class="bizproc-setuptemplateactivity-edit-constant-popup__header">\n\t\t\t\t\t<h1 class="bizproc-setuptemplateactivity-edit-constant-popup__title">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_SLIDER_TITLE') }}\n\t\t\t\t\t</h1>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="bizproc-setuptemplateactivity-edit-constant-popup__content">\n\t\t\t\t\t<div class="bizproc-setuptemplateactivity-edit-constant-popup__block">\n\t\t\t\t\t\t<div class="ui-ctl-container">\n\t\t\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-title">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_NAME_LABEL') }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tv-model="name"\n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t:class="{ '--error': errors.name !== '' }"\n\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t\t@blur="validateName"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if="errors.name"\n\t\t\t\t\t\t\t\tclass="ui-ctl-label-text-error">\n\t\t\t\t\t\t\t\t{{ errors.name }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="ui-ctl-container">\n\t\t\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-title">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_ID_LABEL') }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tv-model="id"\n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t:class="{ '--error': errors.id !== '' }"\n\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t\t:disabled="!isCreation"\n\t\t\t\t\t\t\t\t\t@blur="validateId"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if="errors.id"\n\t\t\t\t\t\t\t\tclass="ui-ctl-label-text-error"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ errors.id }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-ctl-container">\n\t\t\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t\t\t<label class="ui-ctl-title">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_TYPE_LABEL') }}\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\tv-model="constantType"\n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<option\n\t\t\t\t\t\t\t\t\t\tv-for="[fieldType, fieldText] in Object.entries(fieldTypeNames)"\n\t\t\t\t\t\t\t\t\t\t:key="fieldType"\n\t\t\t\t\t\t\t\t\t\t:value="fieldType"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ fieldText }}\n\t\t\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-ctl-container">\n\t\t\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-title">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_MULTIPLE_LABEL') }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<label class="ui-ctl ui-ctl-radio ui-ctl-inline">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\tv-model="multiple"\n\t\t\t\t\t\t\t\t\t\ttype="radio"\n\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t:value="true"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_MULTIPLE_VALUE_YES') }}\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<label class="ui-ctl ui-ctl-radio ui-ctl-inline">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\tv-model="multiple"\n\t\t\t\t\t\t\t\t\t\ttype="radio"\n\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t:value="false"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_MULTIPLE_VALUE_NO') }}\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="ui-ctl-container">\n\t\t\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t\t\t<div class="ui-ctl-title">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_REQUIRED_LABEL') }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<label class="ui-ctl ui-ctl-radio ui-ctl-inline">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\tv-model="required"\n\t\t\t\t\t\t\t\t\t\ttype="radio"\n\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t:value="true"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_REQUIRED_VALUE_YES') }}\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<label class="ui-ctl ui-ctl-radio ui-ctl-inline">\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\tv-model="required"\n\t\t\t\t\t\t\t\t\t\ttype="radio"\n\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t:value="false"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_REQUIRED_VALUE_NO') }}\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="ui-ctl-container">\n\t\t\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t\t\t<label class="ui-ctl-title">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_VALUE') }}\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\tv-model="defaultValue"\n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<template v-if="isSelectType">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-for="(option, index) in options"\n\t\t\t\t\t\t\t\tclass="ui-ctl-container"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t\t\t\t<div class="ui-ctl-title">\n\t\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_OPTION_LABEL')  }} {{ index + 1 }}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100">\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-after ui-ctl-icon-clear"\n\t\t\t\t\t\t\t\t\t\t@click="onDeleteOption(index)"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\tv-model="option.name"\n\t\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\t\t:class="{ '--error': errors.options[index] !== '' }"\n\t\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t\t\t@blur="validateOption(index)"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="errors.options[index]"\n\t\t\t\t\t\t\t\t\tclass="ui-ctl-label-text-error">\n\t\t\t\t\t\t\t\t\t{{ errors.options[index] }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="isSelectType"\n\t\t\t\t\t\t\tclass="ui-ctl-container"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tclass="ui-btn --air --wide --style-outline-no-accent ui-btn-no-caps"\n\t\t\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\t\t\t@click="onAddOption"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class="ui-icon-set --plus-l"/>\n\t\t\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_ADD_OPTION_BTN') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="ui-ctl-container">\n\t\t\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t\t\t<label class="ui-ctl-title">\n\t\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_DESCRIPTION') }}\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-w100">\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tv-model="description"\n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="bizproc-setuptemplateactivity-edit-constant-popup__footer">\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_SAVE')"\n\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t@click="onSave"\n\t\t\t\t/>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_EDIT_CANCEL')"\n\t\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t@click="onCancel"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const k={name:"ConstantField",components:{BIcon:a.BIcon,EditConstantPopupForm:D},inject:["editSlider"],props:{item:{type:Object,required:true},fieldTypeNames:{type:Object,required:true}},emits:["delete","updateItemProperty","edit"],setup(){return{Outline:l.Outline,Main:l.Main}},data(){return{isEdit:false}},computed:{typeLabel(){var t;return(t=this.fieldTypeNames[this.item.constantType])!=null?t:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_ITEM_TYPE_UNSUPPORTED")},titleWithType(){return this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_CONSTANT_ITEM_TITLE",{"#NAME#":this.item.name,"#TYPE#":this.typeLabel})}},created(){i.EventEmitter.subscribe("Bitrix24.Slider:onClose",this.handleClosePopup)},unmounted(){i.EventEmitter.unsubscribe("Bitrix24.Slider:onClose",this.handleClosePopup)},methods:{handleClosePopup(){this.isEdit=false},onInput(t){const e={propertyValues:{default:t.target.value}};this.$emit("updateItemProperty",e)},onUpdateItem(t){this.$emit("updateItemProperty",t)},onEdit(){var t;this==null?void 0:(t=this.editSlider)==null?void 0:t.open();this.$nextTick((()=>{this.isEdit=true}))},handleDragStart(t){this.$emit("itemDragStart",{event:t,element:this.$el})}},template:`\n\t\t<div class="bizproc-setuptemplateactivity-field-wrapper">\n\t\t\t<div\n\t\t\t\tclass="bizproc-setuptemplateactivity-field-drag-icon"\n\t\t\t\t@mousedown.prevent="handleDragStart"\n\t\t\t>\n\t\t\t\t<BIcon :name="Main.MORE_POINTS" :size="18"/>\n\t\t\t</div>\n\t\t\t<div class="bizproc-setuptemplateactivity-constant-edit">\n\t\t\t\t<div class="bizproc-setuptemplateactivity-constant-edit__wrap">\n\t\t\t\t\t<div class="bizproc-setuptemplateactivity-constant-edit__input-control ui-ctl-container">\n\t\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t\t<div class="ui-ctl-title">\n\t\t\t\t\t\t\t\t{{ titleWithType }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t:value="item.default"\n\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t@input="onInput"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bizproc-setuptemplateactivity-constant-edit__btn-control">\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name="Outline.EDIT_L"\n\t\t\t\t\t\t\t:size="18"\n\t\t\t\t\t\t\tclass="bizproc-setuptemplateactivity-constant-edit__control-icon"\n\t\t\t\t\t\t\t@click="onEdit"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\t\t\t:size="18"\n\t\t\t\t\t\t\tclass="bizproc-setuptemplateactivity-constant-edit__control-icon"\n\t\t\t\t\t\t\t@click="$emit('delete')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\n\t\t\t<Teleport\n\t\t\t\tto="#bizproc-setuptemplateactivity-popup-content"\n\t\t\t>\n\t\t\t\t<EditConstantPopupForm\n\t\t\t\t\tv-if="isEdit"\n\t\t\t\t\t:item="item"\n\t\t\t\t\t:fieldTypeNames="fieldTypeNames"\n\t\t\t\t\t@update:item="onUpdateItem"\n\t\t\t\t\t:isCreation="false"\n\t\t\t\t/>\n\t\t\t</Teleport>\n\t\t</div>\n\t`};const w={name:"TitleIconField",components:{BIcon:a.BIcon,BMenu:o.BMenu},props:{item:{type:Object,required:true}},emits:["updateItemProperty","delete"],setup(){return{Outline:l.Outline,Main:l.Main}},data(){return{isMenuShown:false}},computed:{currentIconCssClass(){return _[this.item.icon]||_.IMAGE},menuOptions(){const t=Object.entries(_).map((([t,e])=>({icon:e,title:" ",onClick:()=>this.selectIcon(t)})));return{bindElement:this.$refs.iconTrigger,cacheable:false,angle:true,offsetLeft:25,className:"bizproc-setuptemplateactivity-title-field__icon-menu",items:t}}},methods:{onInput(t){const e={propertyValues:{text:t.target.value}};this.$emit("updateItemProperty",e)},selectIcon(t){const e={propertyValues:{icon:t}};this.$emit("updateItemProperty",e)},handleDragStart(t){this.$emit("itemDragStart",{event:t,element:this.$el})}},template:`\n\t\t<div class="bizproc-setuptemplateactivity-field-wrapper">\n\t\t\t<div\n\t\t\t\tclass="bizproc-setuptemplateactivity-field-drag-icon"\n\t\t\t\t@mousedown.prevent="handleDragStart"\n\t\t\t>\n\t\t\t\t<BIcon :name="Main.MORE_POINTS" :size="18"/>\n\t\t\t</div>\n\t\t\t<div class="bizproc-setuptemplateactivity-title-field">\n\t\t\t\t<div class="ui-ctl-container">\n\t\t\t\t\t<div class="ui-ctl-top">\n\t\t\t\t\t\t<div class="ui-ctl-title bizproc-setuptemplateactivity-title-field__label">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_ICON_TITLE_ITEM_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bizproc-setuptemplateactivity-title-field__container">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown bizproc-setuptemplateactivity-title-field__icon-selector"\n\t\t\t\t\t\t\t @click="isMenuShown = true"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div ref="iconTrigger" class="ui-ctl-element">\n\t\t\t\t\t\t\t\t<i class="ui-icon-set --custom" :class="'--' + currentIconCssClass"></i>\n\t\t\t\t\t\t\t\t<i class="ui-icon-set --chevron-down-m"></i>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-w100">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t:value="item.text"\n\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t@input="onInput"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bizproc-setuptemplateactivity-title-field__controls">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\t\t:size="18"\n\t\t\t\t\t\tclass="bizproc-setuptemplateactivity-title-field__delete-icon"\n\t\t\t\t\t\t@click="$emit('delete')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<BMenu\n\t\t\t\t\tv-if="isMenuShown"\n\t\t\t\t\t:options="menuOptions"\n\t\t\t\t\t@close="isMenuShown = false"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const N={name:"PreviewLayout",template:`\n\t\t<div class="bizproc-setuptemplateactivity-preview-layout">\n\t\t\t<div class="bizproc-setuptemplateactivity-preview-layout__container">\n\t\t\t\t<div class="bizproc-setuptemplateactivity-preview-layout__header">\n\t\t\t\t\t<slot name="header"/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="bizproc-setuptemplateactivity-preview-layout__content">\n\t\t\t\t\t<slot/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="bizproc-setuptemplateactivity-preview-layout__footer">\n\t\t\t\t<slot name="footer"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const z={name:"PreviewHeader",template:`\n\t\t<header class="bizproc-setuptemplateactivity-preview-header">\n\t\t\t<h3 class="bizproc-setuptemplateactivity-preview-header__title">\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_PREVIEW_HEADER_TITLE') }}\n\t\t\t\t<span class="bizproc-setuptemplateactivity-preview-header__tag-preview">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_PREVIEW_HEADER_TAG') }}\n\t\t\t\t</span>\n\t\t\t</h3>\n\t\t\t<div class="bizproc-setuptemplateactivity-preview-header__line"></div>\n\t\t</header>\n\t`};const R={name:"PreviewBlock",props:{isEmpty:{type:Boolean,default:false}},template:`\n\t\t<div\n\t\t\tclass="bizproc-setuptemplateactivity-preview-block"\n\t\t\t:class="{ '--empty': isEmpty }"\n\t\t>\n\t\t\t<slot/>\n\t\t</div>\n\t`};const $={name:"PreviewApp",components:{UiButton:r.Button,PreviewLayout:N,PreviewHeader:z,PreviewBlock:R,FormElement:c.FormElement},props:{blocks:{type:Array,default:()=>[]}},setup(){return{AirButtonStyle:r.AirButtonStyle,ButtonSize:r.ButtonSize}},computed:{formData(){return this.blocks.reduce(((t,e)=>{const n=e.items.reduce(((t,e)=>{if(e.itemType===m.CONSTANT){var n;t[e.id]=(n=e.default)!=null?n:"";return t}return t}),{});return{...t,...n}}),{})}},template:`\n\t\t<PreviewLayout>\n\t\t\t<template #header>\n\t\t\t\t<PreviewHeader/>\n\t\t\t</template>\n\n\t\t\t<template #default>\n\t\t\t\t<PreviewBlock\n\t\t\t\t\tv-for="block in blocks"\n\t\t\t\t\t:key="block.id"\n\t\t\t\t\t:isEmpty="block.items.length === 0"\n\t\t\t\t>\n\t\t\t\t\t<template #default>\n\t\t\t\t\t\t<FormElement\n\t\t\t\t\t\t\tv-for="item in block.items"\n\t\t\t\t\t\t\t:key="item.id"\n\t\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t\t:formData="formData"\n\t\t\t\t\t\t\t:disabled="true"\n\t\t\t\t\t\t\t:errors="{}"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</PreviewBlock>\n\t\t\t</template>\n\n\t\t\t<template #footer>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_PREVIEW_RUN_BTN')"\n\t\t\t\t\t:disabled="true"\n\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t/>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="$Bitrix.Loc.getMessage('BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_PREVIEW_CANCEL_BTN')"\n\t\t\t\t\t:disabled="true"\n\t\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</PreviewLayout>\n\t`};const U="SetupTemplateActivity";const V={[m.TITLE]:O,[m.TITLE_WITH_ICON]:w,[m.DESCRIPTION]:x,[m.DELIMITER]:M,[m.CONSTANT]:k};const Y={name:"BlocksAppComponent",components:{BlockComponent:p,AddBlockBtn:u,AddElementBtn:C,AppHeader:L,PreviewBtn:A,TitleField:O,TitleIconField:w,DescriptionField:x,DelimiterField:M,ConstantField:k,PreviewApp:$,EditConstantPopupForm:D},provide(){return{editSlider:n.computed((()=>this.sliderInstance))}},props:{serializedBlocks:{type:[String,null],required:true},fieldTypeNames:{type:Object,required:true},globalConstants:{type:Object,required:false,default:()=>({})}},data(){return{blocks:[],isShowPreview:false,sliderInstance:null,initialConstantIds:new Set,currentBlockIndex:null,createdConstant:null}},computed:{formValue(){return JSON.stringify(this.blocks)},preparedBlocks(){return this.blocks.map(((t,e)=>{const n=t.items.map((t=>{if(!t.text&&t.itemType===m.TITLE){return{...t,text:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_TITLE_CONTENT")}}if(!t.text&&t.itemType===m.DESCRIPTION){return{...t,text:this.$Bitrix.Loc.getMessage("BIZPROC_SETUP_TEMPLATE_ACTIVITY_JS_DESCRIPTION_CONTENT")}}return{...t}}));return{...t,items:n}}))},localConstants(){return this.blocks.flatMap((t=>t.items||[])).filter((t=>(t==null?void 0:t.itemType)===m.CONSTANT))},localConstantIds(){return this.localConstants.filter((t=>t.id)).map((t=>t.id))},allConstantIds(){const t=Object.keys(this.globalConstants);const e=this.localConstantIds;return new Set([...t,...e])}},mounted(){var t;this.initEditSlider();this.blocks=(t=JSON.parse(this.serializedBlocks))!=null?t:[];this.initialConstantIds=new Set(this.localConstantIds);i.EventEmitter.subscribe("SidePanel.Slider:onClosing",this.onCancelConstant);i.EventEmitter.subscribe("Bizproc.NodeSettings:nodeSettingsSaving",this.onNodeSettingsSave);i.EventEmitter.subscribe("Bizproc.SetupTemplate:Draggable:drop",this.onItemDrop)},beforeUnmount(){var t;this.isShowPreview=false;i.EventEmitter.unsubscribe("SidePanel.Slider:onClosing",this.onCancelConstant);i.EventEmitter.unsubscribe("Bizproc.SetupTemplate:Draggable:drop",this.onItemDrop);(t=this.sliderInstance)==null?void 0:t.destroy()},unmounted(){i.EventEmitter.unsubscribe("Bizproc.NodeSettings:nodeSettingsSaving",this.onNodeSettingsSave)},methods:{initEditSlider(){this.sliderInstance=n.markRaw(new e.Slider("",{contentCallback:()=>this.$refs.bizprocSetupTemplateActivityPopup,width:596,outerBoundary:{right:8,top:64},startPosition:"bottom",overlayClassName:"bizproc-setuptemplateactivity-app__overlay"}))},onAddBlock(){this.blocks.push(E())},onAddItem(t,e){this.blocks[t].items.push(e)},onCreateConstant(t,e){var n;this.currentBlockIndex=t;this.createdConstant={...e};(n=this.sliderInstance)==null?void 0:n.open()},onSaveConstant(t,e){var n;const i=e.propertyValues.id;const s=e.setError;if(this.allConstantIds.has(i)){s();return}this.blocks[t].items.push(e.propertyValues);this.currentBlockIndex=null;this.createdConstant=null;(n=this.sliderInstance)==null?void 0:n.close()},onCancelConstant(){this.currentBlockIndex=null;this.createdConstant=null},onDeleteBlock(t){this.blocks.splice(t,1)},onDeleteItem(t,e){this.blocks[t].items.splice(e,1)},onUpdateItemProperty(t,e,n){var i;const s=this.blocks[t].items[e];const a=n.propertyValues;const l=n.setError;const o=a.id;if(o&&o!==s.id&&this.allConstantIds.has(o)){l();return}this.blocks[t].items[e]={...s,...a};if((i=this.sliderInstance)!=null&&i.isOpen()){this.sliderInstance.close()}},onItemsReorder(t,e){this.blocks[t].items=e},getElementComponent(t){return V[t]},onToggleShowPreview(){this.isShowPreview=!this.isShowPreview;i.EventEmitter.emit("BX.Bizproc:setuptemplateactivity:preview",this.isShowPreview)},onNodeSettingsSave(t){const{formData:e}=t.getData();if(e.activity!==U){return}const n=this.localConstants;const s=new Set(this.initialConstantIds);const a={};for(const t of n){if(t!=null&&t.id){a[t.id]=y(t);s.delete(t.id)}}const l=[...s];i.EventEmitter.emit("Bizproc:onConstantsUpdated",{constantsToUpdate:a,deletedConstantIds:l});this.initialConstantIds=new Set(this.localConstantIds)},onItemDragStart(t,e,n){i.EventEmitter.emit("Bizproc.SetupTemplate:Draggable:start",{...t,sourceBlockIndex:e,sourceItemIndex:n})},onItemDrop(t){const e=t.getData();const{sourceBlockIndex:n,sourceItemIndex:i,targetBlockIndex:s,targetItemIndex:a}=e;if(s===null||a===null){return}const l=JSON.parse(JSON.stringify(this.blocks));const[o]=l[n].items.splice(i,1);if(!o){return}let r=a;if(n===s&&i<a){r--}l[s].items.splice(r,0,o);this.blocks=l}},template:`\n\t\t<div\n\t\t\tclass="bizproc-setuptemplateactivity-app"\n\t\t\tid="bizproc-setuptemplateactivity-app"\n\t\t\tref="setuptemplateactivity"\n\t\t>\n\t\t\t<input\n\t\t\t\t:value="formValue"\n\t\t\t\ttype="hidden"\n\t\t\t\tid="id_blocks"\n\t\t\t\tname="blocks"\n\t\t\t/>\n\n\t\t\t<AppHeader>\n\t\t\t\t<template #preview-btn>\n\t\t\t\t\t<PreviewBtn\n\t\t\t\t\t\t:showPreview="isShowPreview"\n\t\t\t\t\t\t@click="onToggleShowPreview"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</AppHeader>\n\n\t\t\t<div class="bizproc-setuptemplateactivity-app__blocks">\n\t\t\t\t<BlockComponent\n\t\t\t\t\tv-for="(block, blockIndex) in blocks"\n\t\t\t\t\t:key="block.id"\n\t\t\t\t\t:position="blockIndex + 1"\n\t\t\t\t\t:items="block.items"\n\t\t\t\t\t:blockIndex="blockIndex"\n\t\t\t\t\t@deleteBlock="onDeleteBlock(blockIndex)"\n\t\t\t\t\t@update:items="onItemsReorder(blockIndex, $event)"\n\t\t\t\t>\n\t\t\t\t\t<template #item="{ item, itemIndex }">\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is="getElementComponent(item.itemType)"\n\t\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t\t:fieldTypeNames="fieldTypeNames"\n\t\t\t\t\t\t\t@delete="onDeleteItem(blockIndex, itemIndex)"\n\t\t\t\t\t\t\t@updateItemProperty="onUpdateItemProperty(blockIndex, itemIndex, $event)"\n\t\t\t\t\t\t\t@itemDragStart="onItemDragStart($event, blockIndex, itemIndex)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template #footer>\n\t\t\t\t\t\t<AddElementBtn\n\t\t\t\t\t\t\t:constantIds="allConstantIds"\n\t\t\t\t\t\t\t@add:element="onAddItem(blockIndex, $event)"\n\t\t\t\t\t\t\t@create:constant="onCreateConstant(blockIndex, $event)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</BlockComponent>\n\t\t\t\t<AddBlockBtn @click="onAddBlock"/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div\n\t\t\tclass="bizproc-setuptemplateactivity-app__popup"\n\t\t\tref="bizprocSetupTemplateActivityPopup"\n\t\t>\n\t\t\t<div\n\t\t\t\tid="bizproc-setuptemplateactivity-popup-content"\n\t\t\t\tclass="bizproc-setuptemplateactivity-app__popup-content"\n\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<Teleport\n\t\t\tto="#preview-panel"\n\t\t\t:disabled="!isShowPreview"\n\t\t>\n\t\t\t<PreviewApp\n\t\t\t\tv-if="isShowPreview"\n\t\t\t\t:blocks="preparedBlocks"\n\t\t\t/>\n\t\t</Teleport>\n\n\t\t<Teleport\n\t\t\tto="#bizproc-setuptemplateactivity-popup-content"\n\t\t\t:disabled="!createdConstant"\n\t\t>\n\t\t\t<EditConstantPopupForm\n\t\t\t\tv-if="createdConstant !== null"\n\t\t\t\t:item="createdConstant"\n\t\t\t\t:fieldTypeNames="fieldTypeNames"\n\t\t\t\t@update:item="onSaveConstant(currentBlockIndex, $event)"\n\t\t\t\t@cancel="onCancelConstant"\n\t\t\t\t:isCreation="true"\n\t\t\t/>\n\t\t</Teleport>\n\t`};var J=babelHelpers.classPrivateFieldLooseKey("app");var F=babelHelpers.classPrivateFieldLooseKey("currentValues");var Z=babelHelpers.classPrivateFieldLooseKey("blocksElement");var H=babelHelpers.classPrivateFieldLooseKey("fieldTypeNames");var q=babelHelpers.classPrivateFieldLooseKey("getBlocks");class X extends i.EventEmitter{constructor(t){super();Object.defineProperty(this,q,{value:G});Object.defineProperty(this,J,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,Z,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});this.setEventNamespace("BX.Bizproc.Activity");babelHelpers.classPrivateFieldLooseBase(this,F)[F]=t.currentValues;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=document.getElementById(t.domElementId);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=t.fieldTypeNames}unmount(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,J)[J])==null?void 0:t.unmount()}init(){babelHelpers.classPrivateFieldLooseBase(this,J)[J]=n.BitrixVue.createApp(Y,{serializedBlocks:babelHelpers.classPrivateFieldLooseBase(this,q)[q](),fieldTypeNames:babelHelpers.classPrivateFieldLooseBase(this,H)[H],globalConstants:window.arWorkflowConstants||{}});babelHelpers.classPrivateFieldLooseBase(this,J)[J].mount(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z])}}function G(){var t,e;const n=(t=JSON.parse((e=babelHelpers.classPrivateFieldLooseBase(this,F)[F])==null?void 0:e.blocks))!=null?t:[];n.forEach((t=>{t.id=f();t.items.forEach((t=>{if(!(t!=null&&t.id)){t.id=f()}}))}));return JSON.stringify(n)}t.SetupTemplateActivity=X})(this.BX.Bizproc=this.BX.Bizproc||{},BX.SidePanel,BX.Vue3,BX.Event,BX,BX.UI.IconSet,BX.UI.IconSet,BX.UI.System.Menu,BX.Vue3.Components,BX.Bizproc);
//# sourceMappingURL=setup-template-activity.bundle.map.js