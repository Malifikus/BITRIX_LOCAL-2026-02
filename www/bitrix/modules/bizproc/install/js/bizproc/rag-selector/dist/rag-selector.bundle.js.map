{"version":3,"file":"rag-selector.bundle.js","sources":["../src/api.js","../src/utils.js","../src/component/uploader.js","../src/component/base.js","../src/component/app.js","../src/index.js"],"sourcesContent":["import { ajax } from 'main.core';\nimport type { KnowledgeBase, KnowledgeBaseModifyResult, KnowledgeBaseUid } from './types';\n\nconst post = async (action: string, data: Object): Promise<?Array> => {\n\tconst response = await ajax.runAction(`bizproc.v2.Integration.Rag.${action}`, {\n\t\tmethod: 'POST',\n\t\tjson: data || {},\n\t});\n\n\tif (response.status === 'success')\n\t{\n\t\treturn response.data;\n\t}\n\n\treturn null;\n};\n\nexport class KnowledgeBaseApi\n{\n\tstatic create(\n\t\tname: string,\n\t\tdescription: string,\n\t\tfileIds: Array<string>,\n\t): Promise<KnowledgeBaseModifyResult>\n\t{\n\t\treturn post('KnowledgeBase.create', { name, description, fileIds });\n\t}\n\n\tstatic update(\n\t\tuid: KnowledgeBaseUid,\n\t\tname: string,\n\t\tdescription: string,\n\t\tfileIds: Array<string | number>,\n\t): Promise<KnowledgeBaseModifyResult>\n\t{\n\t\treturn post('KnowledgeBase.update', { uid, name, description, fileIds });\n\t}\n\n\tstatic get(uid: KnowledgeBaseUid): Promise<KnowledgeBase>\n\t{\n\t\treturn post('KnowledgeBase.get', { uid });\n\t}\n}\n","export function deepEqual(a: any, b: any): boolean\n{\n\tif (a === b)\n\t{\n\t\treturn true;\n\t}\n\n\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-typeof\n\tif (typeof a !== typeof b)\n\t{\n\t\treturn false;\n\t}\n\n\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-typeof\n\tif (typeof a !== 'object' || a === null || b === null)\n\t{\n\t\treturn false;\n\t}\n\n\tconst keysA = Object.keys(a);\n\tconst keysB = Object.keys(b);\n\tif (keysA.length !== keysB.length)\n\t{\n\t\treturn false;\n\t}\n\n\tfor (const key of keysA)\n\t{\n\t\tif (!deepEqual(a[key], b[key]))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n","import { Extension, Type } from 'main.core';\nimport { TileWidgetComponent } from 'ui.uploader.tile-widget';\nimport { UploaderEvent, UploaderFile, Uploader } from 'ui.uploader.core';\n\nimport type { FileIdReplaces, PersistentFileId, TempFileId } from '../types';\nimport type { TileWidgetOptions } from 'ui.uploader.tile-widget';\nimport type { UploaderOptions } from 'ui.uploader.core';\n\n// @vue/component\nexport const RagFileUploader = {\n\tname: 'RagFileUploader',\n\tcomponents: { TileWidgetComponent },\n\tprops: {\n\t\tknowledgeBaseUid: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tfileIds: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\treadonly: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tfileIdsReplaces: {\n\t\t\ttype: [Object, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\temits: ['filesChanged'],\n\tcomputed: {\n\t\tuploaderOptions(): UploaderOptions\n\t\t{\n\t\t\tconst settings = Extension.getSettings('bizproc.rag-selector');\n\n\t\t\treturn {\n\t\t\t\tcontroller: 'bizproc.fileUploader.KnowledgeBaseUploaderController',\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\tknowledgeBaseUid: this.knowledgeBaseUid,\n\t\t\t\t},\n\t\t\t\tfiles: this.fileIds,\n\t\t\t\tmultiple: true,\n\t\t\t\tmaxFileCount: settings.get('maxFilesCount', 0),\n\t\t\t\tmaxFileSize: settings.get('maxFileSize', 0),\n\t\t\t\tautoUpload: true,\n\t\t\t\thiddenFieldsContainer: this.$refs.ragUploaderHiddenFields,\n\t\t\t\tacceptedFileTypes: settings.get('acceptedFileTypes', []),\n\t\t\t\tevents: {\n\t\t\t\t\t[UploaderEvent.FILE_COMPLETE]: (): void => {\n\t\t\t\t\t\tthis.emitFilesChanged();\n\t\t\t\t\t},\n\t\t\t\t\t[UploaderEvent.FILE_REMOVE]: (): void => {\n\t\t\t\t\t\tthis.emitFilesChanged();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\twidgetOptions(): TileWidgetOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\treadonly: this.readonly,\n\t\t\t\thideDropArea: this.readonly,\n\t\t\t};\n\t\t},\n\t},\n\twatch: {\n\t\tfileIdsReplaces(newValue: FileIdReplaces): void\n\t\t{\n\t\t\tif (!Type.isObject(newValue))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst uploader: Uploader = this.$refs?.tileWidget?.uploader;\n\t\t\tif (!uploader)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfor (const [tempFileId: TempFileId, persistentFileId: PersistentFileId] of Object.entries(newValue))\n\t\t\t{\n\t\t\t\tuploader\n\t\t\t\t\t.getFiles()\n\t\t\t\t\t.forEach((file: UploaderFile): void => {\n\t\t\t\t\t\tif (file.getServerFileId() === tempFileId)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfile.setServerFileId(persistentFileId);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\temitFilesChanged(): void\n\t\t{\n\t\t\tconst uploader: Uploader = this.$refs?.tileWidget?.uploader;\n\t\t\tif (!uploader)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst fileIds: Array<string | number> = uploader\n\t\t\t\t.getFiles()\n\t\t\t\t.map((value: UploaderFile): string => value.getServerFileId())\n\t\t\t;\n\t\t\tthis.$emit('filesChanged', fileIds);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div ref=\"ragUploaderHiddenFields\"></div>\n\t\t<TileWidgetComponent :uploaderOptions=\"uploaderOptions\" :widgetOptions=\"widgetOptions\" ref=\"tileWidget\"/>\n\t`,\n};\n","import { RagFileUploader } from './uploader';\nimport { Outline as OutlineIcons } from 'ui.icon-set.api.core';\nimport { BIcon } from 'ui.icon-set.api.vue';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n\nimport './css/style.css';\n\nconst MAX_DESCRIPTION_LENGTH = 500;\n// @vue/component\nexport const KnowledgeBaseComponent = {\n\tname: 'KnowledgeBaseComponent',\n\tcomponents: { RagFileUploader, BIcon },\n\tprops: {\n\t\t/** @type KnowledgeBase */\n\t\tbase: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tsaving: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\terror: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['updated', 'remove'],\n\tdata(): { isEditing: boolean }\n\t{\n\t\treturn {\n\t\t\tisEditing: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tOutlineIcons: () => OutlineIcons,\n\t\tgetCounterValue(): string\n\t\t{\n\t\t\tconst length = (this.base.description || '').length;\n\n\t\t\treturn `${length}/${MAX_DESCRIPTION_LENGTH}`;\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tif (!this.base.uid)\n\t\t{\n\t\t\tthis.isEditing = true;\n\t\t}\n\t},\n\tmethods: {\n\t\tonNameInput(event: Event): void\n\t\t{\n\t\t\tthis.emitUpdate('name', event.target.value);\n\t\t},\n\t\tonDescriptionInput(event: Event): void\n\t\t{\n\t\t\tlet currentValue = event.target.value;\n\n\t\t\tif (currentValue.length > MAX_DESCRIPTION_LENGTH)\n\t\t\t{\n\t\t\t\tcurrentValue = currentValue.slice(0, MAX_DESCRIPTION_LENGTH);\n\t\t\t\tevent.target.value = currentValue;\n\t\t\t}\n\n\t\t\tthis.emitUpdate('description', currentValue);\n\t\t},\n\t\tonFilesChanged(fileIds: Array<string | number>): void\n\t\t{\n\t\t\tthis.emitUpdate('fileIds', fileIds);\n\t\t},\n\t\temitUpdate(name: string, value: string | Array<string | number>): void\n\t\t{\n\t\t\tthis.$emit('updated', { name, value });\n\t\t},\n\t\tswitchToEditMode(): void\n\t\t{\n\t\t\tif (!this.saving)\n\t\t\t{\n\t\t\t\tthis.isEditing = true;\n\t\t\t}\n\t\t},\n\t\tshowConfirmPopup(): void\n\t\t{\n\t\t\tconst popup = new MessageBox({\n\t\t\t\tmessage: this.$Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_BASE_DELETE_CONFIRM'),\n\t\t\t\tmodal: true,\n\t\t\t\tbuttons: BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,\n\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\tthis.$emit('remove');\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t},\n\t\t\t\tokCaption: this.$Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_BASE_DELETE_OK'),\n\t\t\t\tonCancel: (messageBox) => {\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t},\n\t\t\t\tuseAirDesign: true,\n\t\t\t\tmaxWidth: 300,\n\t\t\t});\n\t\t\tpopup.show();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bizproc-rag-selector__base\" :class=\"{'--view': !isEditing}\">\n\t\t\t<BIcon\n\t\t\t\t:name=\"OutlineIcons.CROSS_L\"\n\t\t\t\t:hoverable=\"true\"\n\t\t\t\t:size=\"20\"\n\t\t\t\tcolor=\"#a8adb4\"\n\t\t\t\t@click=\"showConfirmPopup()\"\n\t\t\t\tdata-test-id=\"bizproc-rag-selector__knowledge-delete-btn\"\n\t\t\t\tclass=\"bizproc-rag-selector__base-remove-icon\"\n\t\t\t/>\n\t\t\t<template v-if=\"isEditing\">\n\t\t\t\t<div v-if=\"error\" class=\"bizproc-rag-selector__base-error\">\n\t\t\t\t\t<span class=\"ui-alert-message\">{{ error }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-label --required\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text bizproc-setup-template__label-text\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_BASE_NAME_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-w100\">\n\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\ttype=\"text\" \n\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t\t:value=\"base.name\"\n\t\t\t\t\t\t\t\t:disabled=\"saving\"\n\t\t\t\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_BASE_NAME_PLACEHOLDER')\"\n\t\t\t\t\t\t\t\t@input=\"onNameInput\"\n\t\t\t\t\t\t\t\tdata-test-id=\"bizproc-rag-selector__name-field\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-row\">\n\t\t\t\t\t<div class=\"ui-form-label --required\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_BASE_DESCRIPTION_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"ui-form-content\">\n\t\t\t\t\t\t<div class=\"bizproc-setup-template__textarea-wrapper\">\n\t\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textarea ui-ctl-w100\">\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tclass=\"ui-ctl-element\"\n\t\t\t\t\t\t\t\t\t:value=\"base.description\"\n\t\t\t\t\t\t\t\t\t:disabled=\"saving\"\n\t\t\t\t\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_BASE_DESCRIPTION_PLACEHOLDER')\"\n\t\t\t\t\t\t\t\t\t@input=\"onDescriptionInput\"\n\t\t\t\t\t\t\t\t\tdata-test-id=\"bizproc-rag-selector__description-field\"\n\t\t\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"bizproc-rag-selector__char-counter\">\n\t\t\t\t\t\t\t\t{{ getCounterValue }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-form-row --uploader\">\n\t\t\t\t\t<div class=\"ui-form-label --required\">\n\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_BASE_FILE_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bizproc-rag-selector__base-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_BASE_FILE_DESC') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<RagFileUploader\n\t\t\t\t\t\t:key=\"base.uid\"\n\t\t\t\t\t\t:readonly=\"saving\"\n\t\t\t\t\t\t:knowledgeBaseUid=\"base.uid\"\n\t\t\t\t\t\t:fileIds=\"base.fileIds\"\n\t\t\t\t\t\t:fileIdsReplaces=\"base.fileIdsReplaces\"\n\t\t\t\t\t\t@filesChanged=\"onFilesChanged\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div v-if=\"error\" class=\"bizproc-rag-selector__base-error\">\n\t\t\t\t\t<span class=\"ui-alert-message\">{{ error }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_BASE_NAME_VIEW') }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bizproc-rag-selector__base-view-title\" @click=\"switchToEditMode\">{{ base.name }}</div>\n\t\t\t\t<div class=\"bizproc-rag-selector__base-view-desc\">{{ base.description }}</div>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { Extension, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { AirButtonStyle, Button as UiButton, ButtonSize } from 'ui.vue3.components.button';\nimport 'ui.alerts';\nimport 'ui.forms';\nimport 'ui.layout-form';\nimport { KnowledgeBaseApi } from '../api';\n\nimport type { KnowledgeBase } from '../types';\nimport { deepEqual } from '../utils';\nimport { KnowledgeBaseComponent } from './base';\n\nconst BEFORE_SUBMIT_EVENT = 'Bizproc:SetupTemplate:beforeSubmit';\n\nconst ErrorTypes = Object.freeze({\n\tREQUIRED: 'required',\n\tLOADING: 'loading',\n});\n\n// @vue/component\nexport const RagAppComponent = {\n\tname: 'RagAppComponent',\n\tcomponents: { KnowledgeBaseComponent, UiButton },\n\tprops: {\n\t\t/** @type Array<KnowledgeBase> */\n\t\texistedKnowledgeBases: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tmodelValue: {\n\t\t\ttype: [Array, String],\n\t\t\tdefault: () => [],\n\t\t},\n\t\tisMultiple: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisRequired: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['update:modelValue'],\n\tdata(): {\n\t\terrorMessage: string,\n\t\tisSaving: boolean,\n\t\tisLoading: boolean,\n\t\tbases: Array<KnowledgeBase>,\n\t\terrorType: ?string,\n\t\tbaseErrors: Array<string>,\n\t\t}\n\t{\n\t\treturn {\n\t\t\tbases: this.existedKnowledgeBases ?? [],\n\t\t\tisSaving: false,\n\t\t\tisLoading: false,\n\t\t\terrorType: null,\n\t\t\terrorMessage: '',\n\t\t\tbaseErrors: [],\n\t\t};\n\t},\n\tcomputed: {\n\t\tAirButtonStyle: () => AirButtonStyle,\n\t\tButtonSize: () => ButtonSize,\n\t\tbuttonAddBaseText(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_ADD_KNOWLEDGE_BASE_BUTTON_TEXT');\n\t\t},\n\t\tisRagAvailable(): boolean\n\t\t{\n\t\t\tconst settings = Extension.getSettings('bizproc.rag-selector');\n\n\t\t\treturn settings.get('isAvailable', false);\n\t\t},\n\t\tbasesCount(): number\n\t\t{\n\t\t\treturn this.bases.length;\n\t\t},\n\t\tmaxBasesCount(): number\n\t\t{\n\t\t\tif (this.isMultiple)\n\t\t\t{\n\t\t\t\tconst settings = Extension.getSettings('bizproc.rag-selector');\n\n\t\t\t\treturn settings.get('maxBasesCountPerField', 1);\n\t\t\t}\n\n\t\t\treturn 1;\n\t\t},\n\t\tshowAddButton(): boolean\n\t\t{\n\t\t\treturn this.basesCount < this.maxBasesCount;\n\t\t},\n\t\tloadingErrorText(): string\n\t\t{\n\t\t\tif (this.errorType === ErrorTypes.LOADING)\n\t\t\t{\n\t\t\t\treturn this.errorMessage;\n\t\t\t}\n\n\t\t\treturn '';\n\t\t},\n\t\tisRequiredError(): boolean\n\t\t{\n\t\t\treturn this.errorType === ErrorTypes.REQUIRED;\n\t\t},\n\t},\n\twatch: {\n\t\tmodelValue(newIds: string | Array<string>, oldIds: string | Array<string>): void\n\t\t{\n\t\t\tif (!deepEqual(newIds, oldIds))\n\t\t\t{\n\t\t\t\tthis.loadInitialBases();\n\t\t\t}\n\t\t},\n\t\tbases: {\n\t\t\thandler(): void\n\t\t\t{\n\t\t\t\tthis.clearError();\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\tasync mounted(): void\n\t{\n\t\tEventEmitter.subscribe(BEFORE_SUBMIT_EVENT, this.onSendAll);\n\n\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\tif (slider)\n\t\t{\n\t\t\tEventEmitter.subscribe(slider, 'SidePanel.Slider:onClose', this.cleanupSubscriptions);\n\t\t}\n\n\t\tawait this.loadInitialBases();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.cleanupSubscriptions();\n\t},\n\n\tmethods: {\n\t\tasync loadInitialBases(): Promise<void>\n\t\t{\n\t\t\tconst initialValues = Type.isArray(this.modelValue) ? this.modelValue : [this.modelValue];\n\n\t\t\tconst idsToLoad = initialValues.filter(Boolean);\n\n\t\t\tif (idsToLoad.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst promises = idsToLoad.map((uid) => KnowledgeBaseApi.get(uid));\n\t\t\t\tthis.bases = await Promise.all(promises);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tthis.errorMessage = this.getErrorFromResponse(error);\n\t\t\t\tthis.errorType = ErrorTypes.LOADING;\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.isLoading = false;\n\t\t\t}\n\t\t},\n\t\tgetErrorFromResponse(response: Object): string\n\t\t{\n\t\t\tif (!response.errors)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (!Type.isArrayFilled(response.errors))\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_LOAD_BASES_ERROR');\n\t\t\t}\n\n\t\t\tconst [firstError] = response.errors;\n\n\t\t\treturn firstError.message;\n\t\t},\n\t\tonAddBase(): void\n\t\t{\n\t\t\tthis.bases.push(this.makeEmptyKnowledgeBase());\n\t\t},\n\t\tmakeEmptyKnowledgeBase(): KnowledgeBase\n\t\t{\n\t\t\treturn {\n\t\t\t\tuid: '',\n\t\t\t\tname: '',\n\t\t\t\tdescription: '',\n\t\t\t\tfileIds: [],\n\t\t\t\tfileIdsReplaces: null,\n\t\t\t};\n\t\t},\n\t\tonBasePropertyUpdated(index: number, changed: {name: string, value: any}): void\n\t\t{\n\t\t\tif (!this.bases[index])\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst baseToUpdate = this.bases[index];\n\t\t\tconst currentValue = baseToUpdate[changed.name];\n\n\t\t\tif (deepEqual(currentValue, changed.value))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst newErrors = [...this.baseErrors];\n\t\t\tif (newErrors[index])\n\t\t\t{\n\t\t\t\tnewErrors[index] = '';\n\t\t\t}\n\t\t\tthis.baseErrors = newErrors;\n\n\t\t\tbaseToUpdate[changed.name] = changed.value;\n\t\t},\n\t\tonBaseRemove(index: number): void\n\t\t{\n\t\t\tthis.bases.splice(index, 1);\n\t\t\tthis.clearError();\n\t\t},\n\t\temitIds(): void\n\t\t{\n\t\t\tconst savedUids = this.bases.map((base) => base.uid).filter(Boolean);\n\n\t\t\tthis.$emit('update:modelValue', savedUids);\n\t\t},\n\t\tvalidate(): boolean\n\t\t{\n\t\t\tthis.clearError();\n\t\t\tconst errors = [];\n\t\t\tlet isAllValid = true;\n\n\t\t\tif (this.isRequired && this.bases.length === 0)\n\t\t\t{\n\t\t\t\tthis.errorMessage = this.$Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_VALIDATION_REQUIRED');\n\t\t\t\tthis.errorType = ErrorTypes.REQUIRED;\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.bases.forEach((base, index) => {\n\t\t\t\tif (this.isBaseIncomplete(base))\n\t\t\t\t{\n\t\t\t\t\terrors[index] = this.$Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_VALIDATION_INCOMPLETE');\n\t\t\t\t\tisAllValid = false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\terrors[index] = '';\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.baseErrors = errors;\n\n\t\t\treturn isAllValid;\n\t\t},\n\t\tisBaseIncomplete(base: KnowledgeBase): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\t!Type.isString(base.name) || base.name.trim() === ''\n\t\t\t\t|| !Type.isString(base.description) || base.description.trim() === ''\n\t\t\t\t|| !Type.isArrayFilled(base.fileIds)\n\t\t\t);\n\t\t},\n\t\tasync onSendAll(): Promise<boolean>\n\t\t{\n\t\t\tif (!this.validate())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.isSaving = true;\n\t\t\ttry\n\t\t\t{\n\t\t\t\tfor (let i = 0; i < this.bases.length; i++)\n\t\t\t\t{\n\t\t\t\t\tconst baseToSave = this.bases[i];\n\t\t\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\t\t\tconst savedBase = await this.saveBase(baseToSave);\n\n\t\t\t\t\tconst currentBases = [...this.bases];\n\t\t\t\t\tcurrentBases[i] = savedBase;\n\t\t\t\t\tthis.bases = currentBases;\n\t\t\t\t}\n\n\t\t\t\tthis.emitIds();\n\t\t\t}\n\t\t\tfinally\n\t\t\t{\n\t\t\t\tthis.isSaving = false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tsaveBase(base: KnowledgeBase): Promise<void>\n\t\t{\n\t\t\tif (base.uid)\n\t\t\t{\n\t\t\t\treturn this.updateBase(base);\n\t\t\t}\n\n\t\t\treturn this.createBase(base);\n\t\t},\n\t\tasync createBase(base: KnowledgeBase): Promise<void>\n\t\t{\n\t\t\tconst modifyResult = await KnowledgeBaseApi.create(base.name, base.description, base.fileIds);\n\n\t\t\treturn {\n\t\t\t\t...base,\n\t\t\t\tfileIds: modifyResult.fileIds,\n\t\t\t\tuid: modifyResult.uid,\n\t\t\t\tfileIdsReplaces: modifyResult.fileIdsReplaces,\n\t\t\t};\n\t\t},\n\t\tasync updateBase(base: KnowledgeBase): Promise<void>\n\t\t{\n\t\t\tconst modifyResult = await KnowledgeBaseApi.update(base.uid, base.name, base.description, base.fileIds);\n\n\t\t\treturn {\n\t\t\t\t...base,\n\t\t\t\tfileIds: modifyResult.fileIds,\n\t\t\t\tfileIdsReplaces: modifyResult.fileIdsReplaces,\n\t\t\t};\n\t\t},\n\t\tclearError(): void\n\t\t{\n\t\t\tthis.errorType = null;\n\t\t\tthis.errorMessage = '';\n\t\t\tthis.baseErrors = [];\n\t\t},\n\t\tcleanupSubscriptions(): void\n\t\t{\n\t\t\tEventEmitter.unsubscribe(BEFORE_SUBMIT_EVENT, this.onSendAll);\n\n\t\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\t\tif (slider)\n\t\t\t{\n\t\t\t\tEventEmitter.unsubscribe(slider, 'SidePanel.Slider:onClose', this.cleanupSubscriptions);\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"!isRagAvailable\" class=\"ui-alert ui-alert-danger\">\n\t\t\t<span class=\"ui-alert-message\">{{ $Bitrix.Loc.getMessage('BIZPROC_JS_RAG_SELECTOR_NOT_AVAILABLE_ERROR') }}</span>\n\t\t</div>\n\t\t<template v-else>\n\t\t\t<div v-if=\"loadingErrorText\" class=\"ui-alert ui-alert-danger\">\n\t\t\t\t<span class=\"ui-alert-message\">{{ loadingErrorText }}</span>\n\t\t\t</div>\n\t\t\t<KnowledgeBaseComponent\n\t\t\t\tv-for=\"(base, index) in bases\"\n\t\t\t\t:key=\"base.uid\"\n\t\t\t\t:base=\"base\"\n\t\t\t\t:saving=\"isSaving\"\n\t\t\t\t:error=\"baseErrors[index] ?? ''\"\n\t\t\t\t@updated=\"onBasePropertyUpdated(index, $event)\"\n\t\t\t\t@remove=\"onBaseRemove(index)\"\n\t\t\t/>\n\t\t\t<UiButton\n\t\t\t\tv-if=\"showAddButton\"\n\t\t\t\t:text=\"buttonAddBaseText\" \n\t\t\t\t:disabled=\"isSaving\"\n\t\t\t\t:style=\"AirButtonStyle.OUTLINE_ACCENT_2\"\n\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t@click=\"onAddBase\"\n\t\t\t\ttype=\"button\"\n\t\t\t/>\n\t\t\t<div v-if=\"isRequiredError\" class=\"bizproc-setup-template__error-text\">\n\t\t\t\t<div class=\"ui-icon-set --warning\"></div>\n\t\t\t\t{{ errorMessage }}\n\t\t\t</div>\n\t\t</template>\n\t`,\n};\n","import { BitrixVue } from 'ui.vue3';\nimport { RagAppComponent } from './component/app';\nexport { RagAppComponent } from './component/app';\n\nexport function initRagDevApp(\n\tcontainer: HTMLElement,\n\tisMultiple: boolean = false,\n\texistedKnowledgeBases: Array = [],\n): void\n{\n\tconst app = BitrixVue.createApp(RagAppComponent, {\n\t\tisMultiple,\n\t\texistedKnowledgeBases,\n\t});\n\tapp.mount(container);\n}\n"],"names":["post","action","data","ajax","runAction","method","json","response","status","KnowledgeBaseApi","name","description","fileIds","uid","deepEqual","a","b","keysA","Object","keys","keysB","length","key","RagFileUploader","components","TileWidgetComponent","props","knowledgeBaseUid","type","String","Array","readonly","Boolean","fileIdsReplaces","emits","computed","uploaderOptions","settings","Extension","getSettings","controller","controllerOptions","files","multiple","maxFileCount","get","maxFileSize","autoUpload","hiddenFieldsContainer","$refs","ragUploaderHiddenFields","acceptedFileTypes","events","UploaderEvent","FILE_COMPLETE","emitFilesChanged","FILE_REMOVE","widgetOptions","hideDropArea","watch","newValue","Type","isObject","uploader","tileWidget","tempFileId","persistentFileId","getFiles","forEach","file","getServerFileId","setServerFileId","entries","methods","map","value","$emit","template","MAX_DESCRIPTION_LENGTH","KnowledgeBaseComponent","BIcon","base","required","saving","error","isEditing","OutlineIcons","getCounterValue","created","onNameInput","event","emitUpdate","target","onDescriptionInput","currentValue","slice","onFilesChanged","switchToEditMode","showConfirmPopup","popup","MessageBox","message","$Bitrix","Loc","getMessage","modal","buttons","BX","UI","Dialogs","MessageBoxButtons","OK_CANCEL","onOk","messageBox","close","okCaption","onCancel","useAirDesign","maxWidth","show","BEFORE_SUBMIT_EVENT","ErrorTypes","freeze","REQUIRED","LOADING","RagAppComponent","UiButton","existedKnowledgeBases","modelValue","isMultiple","isRequired","bases","isSaving","isLoading","errorType","errorMessage","baseErrors","AirButtonStyle","ButtonSize","buttonAddBaseText","isRagAvailable","basesCount","maxBasesCount","showAddButton","loadingErrorText","isRequiredError","newIds","oldIds","loadInitialBases","handler","clearError","deep","mounted","EventEmitter","subscribe","onSendAll","slider","SidePanel","Instance","getTopSlider","cleanupSubscriptions","beforeUnmount","initialValues","isArray","idsToLoad","filter","promises","Promise","all","getErrorFromResponse","errors","isArrayFilled","firstError","onAddBase","push","makeEmptyKnowledgeBase","onBasePropertyUpdated","index","changed","baseToUpdate","newErrors","onBaseRemove","splice","emitIds","savedUids","validate","isAllValid","isBaseIncomplete","isString","trim","i","baseToSave","saveBase","savedBase","currentBases","updateBase","createBase","create","modifyResult","update","unsubscribe","initRagDevApp","container","app","BitrixVue","createApp","mount"],"mappings":"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"}