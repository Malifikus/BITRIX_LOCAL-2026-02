this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,n,o,a,i,s,r,c,l,h,C,d,m,u,p,_,M,g,v,E,T,I){"use strict";const b={components:{BaseHeaderMenu:r.BaseHeaderMenu,MenuItem:h.MenuItem},props:{unreadOnlyMode:{type:Boolean,default:false}},emits:["toggleUnreadMode"],computed:{unreadCounter(){const t=this.$store.getters["counters/getTotalChatCounter"];return this.unreadOnlyMode?0:t},unreadToggleTitle(){return this.unreadOnlyMode?this.loc("IM_RECENT_HEADER_MENU_SHOW_ALL"):this.loc("IM_RECENT_HEADER_MENU_SHOW_UNREAD_ONLY_MSGVER_1")},isUnreadRecentModeAvailable(){return p.FeatureManager.isFeatureAvailable(p.Feature.unreadRecentModeAvailable)}},methods:{async onReadAllClick(t){const e=await s.showReadMessagesConfirm(this.loc("IM_RECENT_HEADER_MENU_READ_ALL_CONFIRM_TEXT"));if(!e){return}(new i.ChatService).readAll();t()},onToggleUnreadMode(t){this.$emit("toggleUnreadMode");t()},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<BaseHeaderMenu>\n\t\t\t<template #menu-items="{ closeCallback }">\n\t\t\t\t<MenuItem\n\t\t\t\t\t:title="loc('IM_RECENT_HEADER_MENU_READ_ALL_MSGVER_1')"\n\t\t\t\t\t@click="onReadAllClick(closeCallback)"\n\t\t\t\t/>\n\t\t\t\t<MenuItem\n\t\t\t\t\tv-if="isUnreadRecentModeAvailable"\n\t\t\t\t\t:title="unreadToggleTitle"\n\t\t\t\t\t:counter="unreadCounter"\n\t\t\t\t\t@click="onToggleUnreadMode(closeCallback)"\n\t\t\t\t/>\n\t\t\t\t<MenuItem\n\t\t\t\t\tv-if="false"\n\t\t\t\t\t:title="loc('IM_RECENT_HEADER_MENU_CHAT_GROUPS_TITLE')"\n\t\t\t\t\t:subtitle="loc('IM_RECENT_HEADER_MENU_CHAT_GROUPS_SUBTITLE')"\n\t\t\t\t\t:disabled="true"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</BaseHeaderMenu>\n\t`};const R={emits:["articleOpen"],data(){return{}},methods:{openHelpArticle(){const t="17412872";M.openHelpdeskArticle(t);this.$emit("articleOpen")},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-create-chat-help__container">\n\t\t\t<div @click="openHelpArticle" class="bx-im-create-chat-help__content">\n\t\t\t\t<div class="bx-im-create-chat-help__icon"></div>\n\t\t\t\t<div class="bx-im-create-chat-help__text">{{ loc('IM_RECENT_CREATE_CHAT_WHAT_TO_CHOOSE') }}</div>\t\n\t\t\t</div>\n\t\t</div>\n\t`};const A={name:"NewBadge",methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-create-chat-menu-new-badge__container">\n\t\t\t<div class="bx-im-create-chat-menu-new-badge__content">{{ loc('IM_RECENT_CREATE_COLLAB_NEW_BADGE') }}</div>\n\t\t</div>\n\t`};const y={name:"DescriptionBanner",emits:["close"],computed:{preparedText(){return g.Loc.getMessage("IM_RECENT_CREATE_COLLAB_DESCRIPTION_BANNER",{"[color_highlight]":'<span class="bx-im-create-chat-menu-description-banner__highlight">',"[/color_highlight]":"</span>"})}},template:`\n\t\t<div class="bx-im-create-chat-menu-description-banner__container">\n\t\t\t<div class="bx-im-create-chat-menu-description-banner__content" v-html="preparedText"></div>\n\t\t\t<div class="bx-im-create-chat-menu-description-banner__close-icon" @click.stop="$emit('close')"></div>\n\t\t</div>\n\t`};const L={methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div\n\t\t\tclass="bx-im-create-chat-menu-item__button --copilot"\n\t\t\t:title="loc('IM_RECENT_CREATE_COPILOT_ROLE_SELECTION_TITLE')"\n\t\t>\n\t\t\t<div class="bx-im-create-chat-menu-item__icon-more"></div>\n\t\t</div>\n\t`};const f={name:"InvitePromo",emits:["close"],methods:{onContainerClick(){const t=v.Analytics.getInstance().sliderInvite.getRecentCreateMenuContext();E.InviteManager.openInviteSlider(t)},onCloseClick(){void T.PromoManager.getInstance().markAsWatched(I.PromoId.recentCreateChatInviteUsers);this.$emit("close")},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div @click="onContainerClick" class="bx-im-recent-invite-promo__container">\n\t\t\t<div class="bx-im-recent-invite-promo__icon"></div>\n\t\t\t<div class="bx-im-recent-invite-promo__content">\n\t\t\t\t<div class="bx-im-recent-invite-promo__title">\n\t\t\t\t\t{{ loc('IM_RECENT_CREATE_INVITE_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-recent-invite-promo__subtitle">\n\t\t\t\t\t{{ loc('IM_RECENT_CREATE_INVITE_SUBTITLE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div @click.stop="onCloseClick" class="bx-im-recent-invite-promo__close-icon"></div>\n\t\t</div>\n\t`};const B={[I.ChatType.chat]:I.PromoId.createGroupChat,[I.ChatType.videoconf]:I.PromoId.createConference,[I.ChatType.channel]:I.PromoId.createChannel};const S={components:{MessengerMenu:h.MessengerMenu,MenuItem:h.MenuItem,CreateChatHelp:R,CreateChatPromo:d.CreateChatPromo,NewBadge:A,DescriptionBanner:y,CopilotRoleSelectionButton:L,CopilotRolesDialog:C.CopilotRolesDialog,InvitePromo:f},data(){return{showMenu:false,chatTypeToCreate:"",showCreateChatPromo:false,showCollabPromo:false,showInvitePromo:false,showCopilotRolesDialog:false,isLoading:false}},computed:{ChatType:()=>I.ChatType,MenuItemIcon:()=>h.MenuItemIcon,menuConfig(){return{id:"im-create-chat-menu",width:275,bindElement:this.$refs.icon||{},offsetTop:4,padding:0}},collabAvailable(){const t=m.PermissionManager.getInstance().canPerformActionByUserType(I.ActionByUserType.createCollab);const e=p.FeatureManager.isFeatureAvailable(p.Feature.collabCreationAvailable);const n=p.FeatureManager.isFeatureAvailable(p.Feature.collabAvailable);return t&&n&&e},canCreateChat(){return m.PermissionManager.getInstance().canPerformActionByUserType(I.ActionByUserType.createChat)},canCreateCopilot(){return m.PermissionManager.getInstance().canPerformActionByUserType(I.ActionByUserType.createCopilot)},isCopilotAvailable(){return p.FeatureManager.isFeatureAvailable(p.Feature.copilotAvailable)},isCopilotActive(){return p.FeatureManager.isFeatureAvailable(p.Feature.copilotActive)},isCopilotAvailableAndCreatable(){return this.isCopilotAvailable&&this.canCreateCopilot},canCreateChannel(){return m.PermissionManager.getInstance().canPerformActionByUserType(I.ActionByUserType.createChannel)},canCreateConference(){return m.PermissionManager.getInstance().canPerformActionByUserType(I.ActionByUserType.createConference)},iconStatusClasses(){return{"--default":!this.isLoading,"--loading":this.isLoading}}},created(){this.showCollabPromo=T.PromoManager.getInstance().needToShow(I.PromoId.createCollabDescription);this.showInvitePromo=T.PromoManager.getInstance().needToShow(I.PromoId.recentCreateChatInviteUsers)},methods:{onChatCreateClick(t){v.Analytics.getInstance().chatCreate.onStartClick(t);this.chatTypeToCreate=t;const e=T.PromoManager.getInstance().needToShow(this.getPromoType());if(e){this.showCreateChatPromo=true;this.showMenu=false;return}this.startChatCreation();this.showMenu=false},showCopilotPromoter(){const t=new c.FeaturePromoter({code:I.SliderCode.copilotDisabled});t.show()},checkCopilotActive(){if(!this.isCopilotActive){this.showCopilotPromoter();return false}return true},async onDefaultCopilotCreateClick(){if(!this.checkCopilotActive()){return}this.showMenu=false;this.isLoading=true;try{const t=await this.getCopilotService().createDefaultChat();v.Analytics.getInstance().copilot.onCreateDefaultChatInRecent();this.isLoading=false;void l.Messenger.openChat(t)}catch{this.isLoading=false}},onCopilotRoleSelectClick(){if(!this.checkCopilotActive()){return}v.Analytics.getInstance().copilot.onSelectRoleInRecent();this.showCopilotRolesDialog=true},async onCopilotDialogSelectRole(t){await this.createCopilotChat(t.code)},async createCopilotChat(t){this.showMenu=false;this.isLoading=true;try{const e=await this.getCopilotService().createChat({roleCode:t});this.isLoading=false;void l.Messenger.openChat(e)}catch{this.isLoading=false}},onPromoContinueClick(){T.PromoManager.getInstance().markAsWatched(this.getPromoType());this.startChatCreation();this.showCreateChatPromo=false;this.showMenu=false;this.chatTypeToCreate=""},onCollabDescriptionClose(){void T.PromoManager.getInstance().markAsWatched(I.PromoId.createCollabDescription);this.showCollabPromo=false},startChatCreation(){const{name:t,entityId:e}=this.$store.getters["application/getLayout"];if(t===I.Layout.createChat&&e===this.chatTypeToCreate){return}u.CreateChatManager.getInstance().startChatCreation(this.chatTypeToCreate)},getPromoType(){var t;return(t=B[this.chatTypeToCreate])!=null?t:""},loc(t){return this.$Bitrix.Loc.getMessage(t)},getCopilotService(){if(!this.copilotService){this.copilotService=new _.CopilotService}return this.copilotService},handleShowPopup(){v.Analytics.getInstance().chatCreate.onMenuCreateClick();this.showMenu=true}},template:`\n\t\t<div\n\t\t\tclass="bx-im-list-container-recent__create-chat_icon"\n\t\t\t:class="{'--active': showMenu}"\n\t\t\t@click="handleShowPopup"\n\t\t\tref="icon"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="bx-im-list-container-recent__create-chat_icon_status"\n\t\t\t\t:class="iconStatusClasses"\n\t\t\t></div>\n\t\t</div>\n\t\t<MessengerMenu v-if="showMenu" :config="menuConfig" @close="showMenu = false">\n\t\t\t<MenuItem\n\t\t\t\tv-if="canCreateChat"\n\t\t\t\t:icon="MenuItemIcon.chat"\n\t\t\t\t:title="loc('IM_RECENT_CREATE_GROUP_CHAT_TITLE_V2')"\n\t\t\t\t:subtitle="loc('IM_RECENT_CREATE_GROUP_CHAT_SUBTITLE_MSGVER_1')"\n\t\t\t\t@click="onChatCreateClick(ChatType.chat)"\n\t\t\t/>\n\t\t\t<MenuItem\n\t\t\t\tv-if="isCopilotAvailableAndCreatable"\n\t\t\t\t:icon="MenuItemIcon.copilot"\n\t\t\t\t:title="loc('IM_RECENT_CREATE_COPILOT_TITLE')"\n\t\t\t\t:subtitle="loc('IM_RECENT_CREATE_COPILOT_SUBTITLE_MSGVER_1')"\n\t\t\t\t@click.stop="onDefaultCopilotCreateClick"\n\t\t\t>\n\t\t\t\t<template #after-content>\n\t\t\t\t\t<CopilotRoleSelectionButton @click.stop="onCopilotRoleSelectClick" />\n\t\t\t\t</template>\n\t\t\t</MenuItem>\n\t\t\t<MenuItem\n\t\t\t\tv-if="canCreateChannel"\n\t\t\t\t:icon="MenuItemIcon.channel"\n\t\t\t\t:title="loc('IM_RECENT_CREATE_CHANNEL_TITLE_V2')"\n\t\t\t\t:subtitle="loc('IM_RECENT_CREATE_CHANNEL_SUBTITLE_MSGVER_1')"\n\t\t\t\t@click="onChatCreateClick(ChatType.channel)"\n\t\t\t/>\n\t\t\t<MenuItem\n\t\t\t\tv-if="collabAvailable"\n\t\t\t\t:icon="MenuItemIcon.collab"\n\t\t\t\t:title="loc('IM_RECENT_CREATE_COLLAB_TITLE')"\n\t\t\t\t:subtitle="loc('IM_RECENT_CREATE_COLLAB_SUBTITLE_MSGVER_1')"\n\t\t\t\t@click="onChatCreateClick(ChatType.collab)"\n\t\t\t>\n\t\t\t\t<template #after-title>\n\t\t\t\t\t<NewBadge />\n\t\t\t\t</template>\n\t\t\t\t<template #below-content>\n\t\t\t\t\t<DescriptionBanner v-if="showCollabPromo" @close="onCollabDescriptionClose" />\n\t\t\t\t</template>\n\t\t\t</MenuItem>\n\t\t\t<MenuItem\n\t\t\t\tv-if="canCreateConference"\n\t\t\t\t:icon="MenuItemIcon.conference"\n\t\t\t\t:title="loc('IM_RECENT_CREATE_CONFERENCE_TITLE')"\n\t\t\t\t:subtitle="loc('IM_RECENT_CREATE_CONFERENCE_SUBTITLE_MSGVER_1')"\n\t\t\t\t:withBottomBorder="showInvitePromo"\n\t\t\t\t@click="onChatCreateClick(ChatType.videoconf)"\n\t\t\t/>\n\t\t\t<InvitePromo v-if="showInvitePromo" @close="showInvitePromo = false" />\n\t\t\t<template #footer>\n\t\t\t\t<CreateChatHelp @articleOpen="showMenu = false" />\n\t\t\t</template>\n\t\t</MessengerMenu>\n\t\t<CreateChatPromo\n\t\t\tv-if="showCreateChatPromo"\n\t\t\t:chatType="chatTypeToCreate"\n\t\t\t@continue="onPromoContinueClick"\n\t\t\t@close="showCreateChatPromo = false"\n\t\t/>\n\t\t<CopilotRolesDialog\n\t\t\tv-if="showCopilotRolesDialog"\n\t\t\t@selectRole="onCopilotDialogSelectRole"\n\t\t\t@close="showCopilotRolesDialog = false"\n\t\t/>\n\t`};const P={name:"RecentListContainer",components:{HeaderMenu:b,CreateChatMenu:S,ChatSearchInput:o.ChatSearchInput,RecentList:n.RecentList,ChatSearch:o.ChatSearch,RecentUnreadList:n.RecentUnreadList},emits:["selectEntity"],data(){return{searchMode:false,unreadOnlyMode:false,searchQuery:"",isSearchLoading:false}},computed:{canCreateChat(){const t=[I.ActionByUserType.createChat,I.ActionByUserType.createCollab,I.ActionByUserType.createChannel,I.ActionByUserType.createConference];return t.some((t=>m.PermissionManager.getInstance().canPerformActionByUserType(t)))}},created(){a.Logger.warn("List: Recent container created");e.EventEmitter.subscribe(I.EventType.recent.openSearch,this.onOpenSearch);g.Event.bind(document,"mousedown",this.onDocumentClick)},beforeUnmount(){e.EventEmitter.unsubscribe(I.EventType.recent.openSearch,this.onOpenSearch);g.Event.unbind(document,"mousedown",this.onDocumentClick)},methods:{onChatClick(t){this.$emit("selectEntity",{layoutName:I.Layout.chat,entityId:t})},onOpenSearch(){this.searchMode=true},onCloseSearch(){this.searchMode=false;this.searchQuery=""},onUpdateSearch(t){this.searchMode=true;this.searchQuery=t},onDocumentClick(t){const e=t.composedPath().includes(this.$refs["recent-container"]);if(this.searchMode&&!e){this.onCloseSearch()}},onLoading(t){this.isSearchLoading=t},onToggleUnreadMode(){this.$store.dispatch("recent/clearUnreadCollection");this.unreadOnlyMode=!this.unreadOnlyMode}},template:`\n\t\t<div class="bx-im-list-container-recent__scope bx-im-list-container-recent__container" ref="recent-container">\n\t\t\t<div class="bx-im-list-container-recent__header_container">\n\t\t\t\t<HeaderMenu :unreadOnlyMode="unreadOnlyMode" @toggleUnreadMode="onToggleUnreadMode" />\n\t\t\t\t<div class="bx-im-list-container-recent__search-input_container">\n\t\t\t\t\t<ChatSearchInput \n\t\t\t\t\t\t:searchMode="searchMode" \n\t\t\t\t\t\t:isLoading="searchMode && isSearchLoading"\n\t\t\t\t\t\t@openSearch="onOpenSearch"\n\t\t\t\t\t\t@closeSearch="onCloseSearch"\n\t\t\t\t\t\t@updateSearch="onUpdateSearch"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<CreateChatMenu v-if="canCreateChat" />\n\t\t\t</div>\n\t\t\t<div class="bx-im-list-container-recent__elements_container">\n\t\t\t\t<div class="bx-im-list-container-recent__elements">\n\t\t\t\t\t<ChatSearch \n\t\t\t\t\t\tv-show="searchMode" \n\t\t\t\t\t\t:searchMode="searchMode"\n\t\t\t\t\t\t:query="searchQuery"\n\t\t\t\t\t\t@loading="onLoading"\n\t\t\t\t\t\t@closeSearch="onCloseSearch"\n\t\t\t\t\t/>\n\t\t\t\t\t<RecentList v-show="!searchMode && !unreadOnlyMode" @chatClick="onChatClick" />\n\t\t\t\t\t<RecentUnreadList v-if="unreadOnlyMode" @chatClick="onChatClick" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};t.RecentListContainer=P})(this.BX.Messenger.v2.Component.List=this.BX.Messenger.v2.Component.List||{},BX.Event,BX.Messenger.v2.Component.List,BX.Messenger.v2.Component,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.List,BX.UI,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.List,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=recent-container.bundle.map.js