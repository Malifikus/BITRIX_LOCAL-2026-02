{"version":3,"file":"init.bundle.js","sources":["../src/const/const.js","../src/init.js"],"sourcesContent":["export const PreloadedEntity = {\n\tusers: 'users',\n};\n","import { Core } from 'im.v2.application.core';\nimport { CallManager } from 'im.v2.lib.call';\nimport { PhoneManager } from 'im.v2.lib.phone';\nimport { SmileManager } from 'im.v2.lib.smile-manager';\nimport { UserManager } from 'im.v2.lib.user';\nimport { CounterManager } from 'im.v2.lib.counter';\nimport { Logger } from 'im.v2.lib.logger';\nimport { MessageNotifierManager } from 'im.v2.lib.message-notifier';\nimport { MarketManager } from 'im.v2.lib.market';\nimport { DesktopManager } from 'im.v2.lib.desktop';\nimport { PromoManager } from 'im.v2.lib.promo';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { UpdateStateManager } from 'im.v2.lib.update-state.manager';\nimport { Router } from 'im.v2.lib.router';\n\nimport { PreloadedEntity } from './const/const';\n\nimport type { JsonObject } from 'main.core';\n\nexport class InitManager\n{\n\tstatic #instance: InitManager;\n\tstatic #inited: boolean = false;\n\n\tstatic getInstance(): InitManager\n\t{\n\t\tInitManager.#instance = InitManager.#instance ?? new InitManager();\n\n\t\treturn InitManager.#instance;\n\t}\n\n\tstatic init(): void\n\t{\n\t\tInitManager.getInstance();\n\t}\n\n\tconstructor()\n\t{\n\t\tif (InitManager.#inited)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#initLogger();\n\t\tLogger.warn('InitManager: start');\n\t\tthis.#initSettings();\n\t\tthis.#initTariffRestrictions();\n\t\tthis.#initAnchors();\n\t\tthis.#initCallManager();\n\t\tthis.#initAvailableAIModelsList();\n\t\tthis.#initPreloadedEntities();\n\t\tthis.#initCurrentUserAdminStatus();\n\n\t\tCounterManager.init();\n\t\tPermissionManager.init();\n\t\tPromoManager.init();\n\t\tMarketManager.init();\n\t\tPhoneManager.init();\n\t\tSmileManager.init();\n\t\tMessageNotifierManager.init();\n\t\tDesktopManager.init();\n\t\tUpdateStateManager.init();\n\t\tRouter.handleGetParams();\n\n\t\tInitManager.#inited = true;\n\t}\n\n\t#initLogger(): void\n\t{\n\t\tconst { loggerConfig } = Core.getApplicationData();\n\t\tif (!loggerConfig)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.setConfig(loggerConfig);\n\t}\n\n\t#initSettings(): void\n\t{\n\t\tconst { settings } = Core.getApplicationData();\n\t\tif (!settings)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.warn('InitManager: settings', settings);\n\t\tvoid Core.getStore().dispatch('application/settings/set', settings);\n\t}\n\n\t#initTariffRestrictions(): void\n\t{\n\t\tconst { tariffRestrictions } = Core.getApplicationData();\n\t\tif (!tariffRestrictions)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.warn('InitManager: tariffRestrictions', tariffRestrictions);\n\t\tvoid Core.getStore().dispatch('application/tariffRestrictions/set', tariffRestrictions);\n\t}\n\n\t#initCallManager(): void\n\t{\n\t\tconst { activeCalls } = Core.getApplicationData();\n\t\tCallManager.getInstance().updateRecentCallsList(activeCalls);\n\t}\n\n\t#initAnchors(): void\n\t{\n\t\tconst { anchors } = Core.getApplicationData();\n\t\tif (!anchors)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid Core.getStore().dispatch('messages/anchors/setAnchors', { anchors });\n\t}\n\n\t#initAvailableAIModelsList(): void\n\t{\n\t\tconst { copilot }: ApplicationDataType = Core.getApplicationData();\n\n\t\tif (!copilot.availableEngines)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid Core.getStore().dispatch('copilot/setAvailableAIModels', copilot.availableEngines);\n\t}\n\n\t#initPreloadedEntities(): void\n\t{\n\t\tconst { preloadedEntities } = Core.getApplicationData();\n\t\tif (!preloadedEntities)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst preloadedEntitiesHandler = {\n\t\t\t[PreloadedEntity.users]: (users) => (new UserManager()).setUsersToModel(users),\n\t\t};\n\n\t\tObject.entries(preloadedEntities).forEach(([entityType: string, items: JsonObject[]]) => {\n\t\t\tif (preloadedEntitiesHandler[entityType])\n\t\t\t{\n\t\t\t\tpreloadedEntitiesHandler[entityType](items);\n\t\t\t}\n\t\t});\n\t}\n\n\t#initCurrentUserAdminStatus(): void\n\t{\n\t\tconst { isCurrentUserAdmin } = Core.getApplicationData();\n\t\tvoid Core.getStore().dispatch('users/setCurrentUserAdminStatus', isCurrentUserAdmin);\n\t}\n}\n"],"names":["PreloadedEntity","users","InitManager","getInstance","init","constructor","Logger","warn","CounterManager","PermissionManager","PromoManager","MarketManager","PhoneManager","SmileManager","MessageNotifierManager","DesktopManager","UpdateStateManager","Router","handleGetParams","loggerConfig","Core","getApplicationData","setConfig","settings","getStore","dispatch","tariffRestrictions","activeCalls","CallManager","updateRecentCallsList","anchors","copilot","availableEngines","preloadedEntities","preloadedEntitiesHandler","UserManager","setUsersToModel","Object","entries","forEach","entityType","items","isCurrentUserAdmin"],"mappings":";;;;;;;CAAO,MAAMA,eAAe,GAAG;GAC9BC,KAAK,EAAE;CACR,CAAC;;CCa+C;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAIhD,CAAO,MAAMC,WAAW,CACxB;GAIC,OAAOC,WAAW,GAClB;KAAA;KACC,wCAAAD,WAAW,2FAAaA,WAAW,2DAAc,IAAIA,WAAW,EAAE;KAElE,+CAAOA,WAAW;;GAGnB,OAAOE,IAAI,GACX;KACCF,WAAW,CAACC,WAAW,EAAE;;GAG1BE,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KACC,4CAAIH,WAAW,qBACf;OACC;;KAGD,4CAAI;KACJI,uBAAM,CAACC,IAAI,CAAC,oBAAoB,CAAC;KACjC,4CAAI;KACJ,4CAAI;KACJ,4CAAI;KACJ,4CAAI;KACJ,4CAAI;KACJ,4CAAI;KACJ,4CAAI;KAEJC,gCAAc,CAACJ,IAAI,EAAE;KACrBK,sCAAiB,CAACL,IAAI,EAAE;KACxBM,4BAAY,CAACN,IAAI,EAAE;KACnBO,8BAAa,CAACP,IAAI,EAAE;KACpBQ,4BAAY,CAACR,IAAI,EAAE;KACnBS,mCAAY,CAACT,IAAI,EAAE;KACnBU,gDAAsB,CAACV,IAAI,EAAE;KAC7BW,gCAAc,CAACX,IAAI,EAAE;KACrBY,gDAAkB,CAACZ,IAAI,EAAE;KACzBa,uBAAM,CAACC,eAAe,EAAE;KAExB,wCAAAhB,WAAW,sBAAW,IAAI;;CA4F5B;CAAC,wBAxFA;GACC,MAAM;KAAEiB;IAAc,GAAGC,2BAAI,CAACC,kBAAkB,EAAE;GAClD,IAAI,CAACF,YAAY,EACjB;KACC;;GAGDb,uBAAM,CAACgB,SAAS,CAACH,YAAY,CAAC;CAC/B;CAAC,0BAGD;GACC,MAAM;KAAEI;IAAU,GAAGH,2BAAI,CAACC,kBAAkB,EAAE;GAC9C,IAAI,CAACE,QAAQ,EACb;KACC;;GAGDjB,uBAAM,CAACC,IAAI,CAAC,uBAAuB,EAAEgB,QAAQ,CAAC;GAC9C,KAAKH,2BAAI,CAACI,QAAQ,EAAE,CAACC,QAAQ,CAAC,0BAA0B,EAAEF,QAAQ,CAAC;CACpE;CAAC,oCAGD;GACC,MAAM;KAAEG;IAAoB,GAAGN,2BAAI,CAACC,kBAAkB,EAAE;GACxD,IAAI,CAACK,kBAAkB,EACvB;KACC;;GAGDpB,uBAAM,CAACC,IAAI,CAAC,iCAAiC,EAAEmB,kBAAkB,CAAC;GAClE,KAAKN,2BAAI,CAACI,QAAQ,EAAE,CAACC,QAAQ,CAAC,oCAAoC,EAAEC,kBAAkB,CAAC;CACxF;CAAC,6BAGD;GACC,MAAM;KAAEC;IAAa,GAAGP,2BAAI,CAACC,kBAAkB,EAAE;GACjDO,0BAAW,CAACzB,WAAW,EAAE,CAAC0B,qBAAqB,CAACF,WAAW,CAAC;CAC7D;CAAC,yBAGD;GACC,MAAM;KAAEG;IAAS,GAAGV,2BAAI,CAACC,kBAAkB,EAAE;GAC7C,IAAI,CAACS,OAAO,EACZ;KACC;;GAGD,KAAKV,2BAAI,CAACI,QAAQ,EAAE,CAACC,QAAQ,CAAC,6BAA6B,EAAE;KAAEK;IAAS,CAAC;CAC1E;CAAC,uCAGD;GACC,MAAM;KAAEC;IAA8B,GAAGX,2BAAI,CAACC,kBAAkB,EAAE;GAElE,IAAI,CAACU,OAAO,CAACC,gBAAgB,EAC7B;KACC;;GAGD,KAAKZ,2BAAI,CAACI,QAAQ,EAAE,CAACC,QAAQ,CAAC,8BAA8B,EAAEM,OAAO,CAACC,gBAAgB,CAAC;CACxF;CAAC,mCAGD;GACC,MAAM;KAAEC;IAAmB,GAAGb,2BAAI,CAACC,kBAAkB,EAAE;GACvD,IAAI,CAACY,iBAAiB,EACtB;KACC;;GAGD,MAAMC,wBAAwB,GAAG;KAChC,CAAClC,eAAe,CAACC,KAAK,GAAIA,KAAK,IAAM,IAAIkC,0BAAW,EAAE,CAAEC,eAAe,CAACnC,KAAK;IAC7E;GAEDoC,MAAM,CAACC,OAAO,CAACL,iBAAiB,CAAC,CAACM,OAAO,CAAC,CAAC,CAACC,UAAkB,EAAEC,KAAmB,CAAC,KAAK;KACxF,IAAIP,wBAAwB,CAACM,UAAU,CAAC,EACxC;OACCN,wBAAwB,CAACM,UAAU,CAAC,CAACC,KAAK,CAAC;;IAE5C,CAAC;CACH;CAAC,wCAGD;GACC,MAAM;KAAEC;IAAoB,GAAGtB,2BAAI,CAACC,kBAAkB,EAAE;GACxD,KAAKD,2BAAI,CAACI,QAAQ,EAAE,CAACC,QAAQ,CAAC,iCAAiC,EAAEiB,kBAAkB,CAAC;CACrF;CAAC,sBAxIWxC,WAAW;GAAA;GAAA;CAAA;CAAA,sBAAXA,WAAW;GAAA;GAAA,OAGG;CAAK;;;;;;;;"}