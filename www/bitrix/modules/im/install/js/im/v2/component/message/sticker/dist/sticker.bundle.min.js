this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,s,i,n,r,c,a,o,p,k,u,d,l){"use strict";const g=178;const m=12;const h={name:"PackPopupContent",components:{UiButton:r.Button,BIcon:l.BIcon,Spinner:a.Spinner,Shimmer:a.Shimmer,StickerPackForm:u.StickerPackForm,PackStickers:u.PackStickers},inject:["disableAutoHide","enableAutoHide"],props:{dialogId:{type:String,required:true},packId:{type:Number,required:true},packType:{type:String,required:true}},emits:["close"],data(){return{isLoading:false,isRequestSending:false,showPackForm:false}},computed:{SHIMMER_WIDTH:()=>g,SHIMMER_HEIGHT:()=>m,PopupType:()=>o.PopupType,ButtonSize:()=>r.ButtonSize,SpinnerColor:()=>a.SpinnerColor,SpinnerSize:()=>a.SpinnerSize,OutlineIcons:()=>l.Outline,AirButtonStyle:()=>r.AirButtonStyle,Color:()=>o.Color,pack(){return this.$store.getters["stickers/packs/getByIdentifier"]({id:this.packId,type:this.packType})},buttonText(){if(this.pack.isAdded){return this.loc("IM_MESSAGE_STICKER_PACK_ADDED")}return this.loc("IM_MESSAGE_STICKER_PACK_ADD")},buttonStyle(){if(this.pack.isAdded){return r.AirButtonStyle.PLAIN}return r.AirButtonStyle.FILLED},isPackOwner(){return this.pack.authorId===c.Core.getUserId()},canShowContextMenu(){if(this.isLoading){return false}if(!this.isPackOwner){return false}return this.pack.type===o.StickerPackType.custom}},async created(){this.stickerService=k.StickerService.getInstance();this.isLoading=true;await this.stickerService.loadPack({id:this.packId,type:this.packType});this.isLoading=false},methods:{async linkStickerPack(){var t;if((t=this.pack)!=null&&t.isAdded){return}this.isRequestSending=true;await this.stickerService.linkPack({id:this.packId,type:this.packType});this.isRequestSending=false;d.Notifier.sticker.onLinkPackComplete();this.$emit("close")},showPackMenu(t){if(!this.packMenu){this.packMenu=new p.StickerPackMenu;this.packMenu.subscribe("openEditor",(()=>{this.showPackForm=true}));this.packMenu.subscribe("closeParentPopup",(()=>{this.$emit("close")}))}this.disableAutoHide();this.packMenu.openMenu({pack:this.pack,dialogId:this.dialogId,isRecent:false},t.target)},showStickerMenu({event:t,sticker:e}){if(!this.stickerMenu){this.stickerMenu=new p.StickerMenu;this.stickerMenu.subscribe("close",(()=>{this.enableAutoHide()}));this.stickerMenu.subscribe("closeParentPopup",(()=>{this.$emit("close")}))}this.disableAutoHide();this.stickerMenu.openMenu({sticker:e,isRecent:false,dialogId:this.dialogId},t.target)},onStickerPackFormClose(){this.enableAutoHide();this.showPackForm=false},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-stickers-pack-popup__container">\n\t\t\t<div class="bx-im-stickers-pack-popup__header">\n\t\t\t\t<Shimmer v-if="isLoading" :width="SHIMMER_WIDTH" :height="SHIMMER_HEIGHT" />\n\t\t\t\t<div v-else class="bx-im-stickers-pack-popup__header-title --ellipsis">{{ pack.name }}</div>\n\t\t\t\t<div class="bx-im-stickers-pack-popup__header-controls">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if="canShowContextMenu"\n\t\t\t\t\t\t:name="OutlineIcons.MORE_M"\n\t\t\t\t\t\t:hoverable="true"\n\t\t\t\t\t\tclass="bx-im-stickers-pack-popup__control-icon"\n\t\t\t\t\t\t@click="showPackMenu"\n\t\t\t\t\t/>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="OutlineIcons.CROSS_M"\n\t\t\t\t\t\t:hoverable="true"\n\t\t\t\t\t\tclass="bx-im-stickers-pack-popup__control-icon"\n\t\t\t\t\t\t@click="$emit('close')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<PackStickers\n\t\t\t\tv-if="!isLoading"\n\t\t\t\t:pack="pack"\n\t\t\t\t:withAddButton="false"\n\t\t\t\tclass="bx-im-stickers-pack-popup__sticker-list"\n\t\t\t\t@clickSticker="showStickerMenu"\n\t\t\t\t@openContextMenuSticker="showStickerMenu"\n\t\t\t/>\n\t\t\t<div v-else class="bx-im-stickers-pack-popup__loader">\n\t\t\t\t<Spinner\n\t\t\t\t\t:size="SpinnerSize.M"\n\t\t\t\t\t:color="SpinnerColor.mainPrimary"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tv-if="!isLoading"\n\t\t\t\t:class="{'--pack-added': pack.isAdded}"\n\t\t\t\tclass="bx-im-stickers-pack-popup__footer"\n\t\t\t>\n\t\t\t\t<UiButton\n\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t:text="buttonText"\n\t\t\t\t\t:loading="isRequestSending"\n\t\t\t\t\t:style="buttonStyle"\n\t\t\t\t\t:left-icon="OutlineIcons.CHECK_L"\n\t\t\t\t\t@click="linkStickerPack"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<StickerPackForm v-if="showPackForm" :pack="pack" @close="onStickerPackFormClose" />\n\t\t</div>\n\t`};const S={name:"StickerPackPopup",components:{MessengerPopup:n.MessengerPopup,PackPopupContent:h},props:{dialogId:{type:String,required:true},packId:{type:Number,required:true},packType:{type:String,required:true}},emits:["close"],computed:{PopupType:()=>o.PopupType,popupConfig(){return{width:404,targetContainer:document.body,fixed:true,overlay:true,autoHide:true,padding:0,contentPadding:0,borderRadius:"20px",contentBorderRadius:"20px",className:"bx-im-messenger__scope",background:"transparent"}}},template:`\n\t\t<MessengerPopup\n\t\t\t:config="popupConfig"\n\t\t\t:id="PopupType.stickerPack"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<PackPopupContent \n\t\t\t\t:dialogId="dialogId"\n\t\t\t\t:packId="packId"\n\t\t\t\t:packType="packType"\n\t\t\t\t@close="$emit('close')"\n\t\t\t/>\n\t\t</MessengerPopup>\n\t`};const M={name:"StickerFallback",components:{BIcon:l.BIcon},computed:{OutlineIcons:()=>l.Outline},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-message-sticker-fallback__container">\n\t\t\t<div class="bx-im-message-sticker-fallback__content">\n\t\t\t\t<BIcon :name="OutlineIcons.ALERT" />\n\t\t\t\t{{ loc('IM_MESSAGE_STICKER_EMPTY') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const v={name:"StickerMessage",components:{BaseMessage:s.BaseMessage,MessageStatus:i.MessageStatus,ReactionList:i.ReactionList,MessageHeader:i.MessageHeader,StickerFallback:M,PackPopup:S},props:{item:{type:Object,required:true},dialogId:{type:String,required:true}},data(){return{showPackPopup:false}},computed:{message(){return this.item},sticker(){const t=this.$store.getters["stickers/messages/getStickerByMessageId"](this.message.id);return this.$store.getters["stickers/get"](t)},imageUri(){var t;return(t=this.sticker)==null?void 0:t.uri},hasStickerUri(){return e.Type.isStringFilled(this.imageUri)},imageHeightStyles(){if(!this.sticker.width||!this.sticker.height){return{}}const t=166;const e=this.sticker.width/this.sticker.height;const s=Math.round(t/e);const i=Math.min(s,t);return{height:`${i}px`}}},methods:{onStickerClick(){if(!this.hasStickerUri){return}this.showPackPopup=true},onClosePopup(){this.showPackPopup=false}},template:`\n\t\t<BaseMessage\n\t\t\t:dialogId="dialogId"\n\t\t\t:item="item"\n\t\t\t:withBackground="false"\n\t\t\t:afterMessageWidthLimit="false"\n\t\t>\n\t\t\t<template #before-message>\n\t\t\t\t<div class="bx-im-message-sticker__header-container">\n\t\t\t\t\t<MessageHeader :item="item" :isOverlay="true" />\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div class="bx-im-message-sticker__container">\n\t\t\t\t<div\n\t\t\t\t\tv-if="hasStickerUri"\n\t\t\t\t\tclass="bx-im-message-sticker__image"\n\t\t\t\t\t:style="imageHeightStyles"\n\t\t\t\t\t@click="onStickerClick"\n\t\t\t\t>\n\t\t\t\t\t<img :src="imageUri" alt="" loading="lazy"/>\n\t\t\t\t</div>\n\t\t\t\t<StickerFallback v-else />\n\t\t\t\t<div class="bx-im-message-sticker__message-status-container">\n\t\t\t\t\t<MessageStatus :item="message" :isOverlay="true" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<template #after-message>\n\t\t\t\t<div class="bx-im-message-sticker__reactions-container">\n\t\t\t\t\t<ReactionList \n\t\t\t\t\t\t:messageId="message.id"\n\t\t\t\t\t\t:contextDialogId="dialogId"\n\t\t\t\t\t\tclass="bx-im-message-sticker__reactions"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<PackPopup\n\t\t\t\tv-if="showPackPopup"\n\t\t\t\t:dialogId="dialogId"\n\t\t\t\t:packId="sticker.packId"\n\t\t\t\t:packType="sticker.packType"\n\t\t\t\t@close="onClosePopup"\n\t\t\t/>\n\t\t</BaseMessage>\n\t`};t.StickerMessage=v})(this.BX.Messenger.v2.Component.Message=this.BX.Messenger.v2.Component.Message||{},BX,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Component.Elements,BX.Vue3.Components,BX.Messenger.v2.Application,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Provider.Service,BX.Messenger.v2.Component,BX.Messenger.v2.Lib,BX.UI.IconSet);
//# sourceMappingURL=sticker.bundle.map.js