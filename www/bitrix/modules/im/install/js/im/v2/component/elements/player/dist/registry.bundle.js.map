{"version":3,"file":"registry.bundle.js","sources":["../src/components/default-video-player.js","../src/classes/playlist.js","../src/components/elements/round-progress-bar.js","../src/components/elements/transcription-button/transcription-button.js","../src/components/round-video-player.js","../src/components/elements/timeline/timeline.js","../src/components/elements/transcription-text/transcription-text.js","../src/components/audio-player.js","../src/components/transcribed-video-player.js"],"sourcesContent":["import 'ui.fonts.opensans';\nimport 'main.polyfill.intersectionobserver';\n\nimport { FadeAnimation } from 'im.v2.component.animation';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport './css/default-video-player.css';\n\nimport type { JsonObject } from 'main.core';\n\nconst State = Object.freeze({\n\tplay: 'play',\n\tpause: 'pause',\n\tstop: 'stop',\n\tnone: 'none',\n});\n\nconst PreloadAttribute = Object.freeze({\n\tnone: 'none',\n\tmetadata: 'metadata',\n\tauto: 'auto',\n});\n\n// @vue/component\nexport const DefaultVideoPlayer = {\n\tname: 'DefaultVideoPlayer',\n\tcomponents: { FadeAnimation },\n\tprops: {\n\t\tfileId: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 0,\n\t\t},\n\t\tsrc: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tpreviewImageUrl: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\twithAutoplay: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\telementStyle: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t\twithPlayerControls: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tviewerAttributes: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => {},\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tpreloadAttribute: PreloadAttribute.none,\n\t\t\tloaded: false,\n\t\t\tloading: false,\n\t\t\tstate: State.none,\n\t\t\ttimeCurrent: 0,\n\t\t\ttimeTotal: 0,\n\t\t\tisMuted: true,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tState: () => State,\n\t\tisAutoPlayDisabled(): boolean\n\t\t{\n\t\t\treturn !this.withAutoplay && this.state === State.none;\n\t\t},\n\t\tshowStartButton(): boolean\n\t\t{\n\t\t\treturn this.withPlayerControls && this.isAutoPlayDisabled;\n\t\t},\n\t\tshowInterface(): boolean\n\t\t{\n\t\t\treturn this.withPlayerControls && !this.showStartButton;\n\t\t},\n\t\tformattedTime(): string\n\t\t{\n\t\t\tif (!this.loaded && !this.timeTotal)\n\t\t\t{\n\t\t\t\treturn '--:--';\n\t\t\t}\n\n\t\t\tlet time = 0;\n\t\t\tif (this.state === State.play)\n\t\t\t{\n\t\t\t\ttime = this.timeTotal - this.timeCurrent;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttime = this.timeTotal;\n\t\t\t}\n\n\t\t\treturn Utils.date.formatMediaDurationTime(time);\n\t\t},\n\t\tcontrolButtonClass(): string\n\t\t{\n\t\t\tif (this.loading)\n\t\t\t{\n\t\t\t\treturn '--loading';\n\t\t\t}\n\n\t\t\treturn this.state === State.play ? '--pause' : '--play';\n\t\t},\n\t\tsource(): HTMLVideoElement\n\t\t{\n\t\t\treturn this.$refs.source;\n\t\t},\n\t\thasViewerAttributes(): boolean\n\t\t{\n\t\t\treturn Object.keys(this.viewerAttributes).length > 0;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tif (!this.previewImageUrl)\n\t\t{\n\t\t\tthis.preloadAttribute = PreloadAttribute.metadata;\n\t\t}\n\t},\n\tmounted()\n\t{\n\t\tthis.getObserver().observe(this.$refs.body);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.getObserver().unobserve(this.$refs.body);\n\t},\n\tmethods:\n\t{\n\t\tloadFile()\n\t\t{\n\t\t\tif (this.loaded || this.loading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.preloadAttribute = PreloadAttribute.auto;\n\n\t\t\tthis.loading = true;\n\t\t\tthis.playAfterLoad = true;\n\t\t},\n\t\thandleControlClick()\n\t\t{\n\t\t\tif (this.state === State.play)\n\t\t\t{\n\t\t\t\tthis.getObserver().unobserve(this.$refs.body);\n\t\t\t\tthis.pause();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.play();\n\t\t\t}\n\t\t},\n\t\thandleMuteClick()\n\t\t{\n\t\t\tif (this.isMuted)\n\t\t\t{\n\t\t\t\tthis.unmute();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.mute();\n\t\t\t}\n\t\t},\n\t\thandleContainerClick()\n\t\t{\n\t\t\tif (this.hasViewerAttributes)\n\t\t\t{\n\t\t\t\tthis.pause();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.handleControlClick();\n\t\t},\n\t\tplay()\n\t\t{\n\t\t\tif (!this.loaded)\n\t\t\t{\n\t\t\t\tthis.loadFile();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.source.play();\n\t\t},\n\t\tpause()\n\t\t{\n\t\t\tthis.source.pause();\n\t\t},\n\t\tmute()\n\t\t{\n\t\t\tthis.isMuted = true;\n\t\t\tthis.source.muted = true;\n\t\t},\n\t\tunmute()\n\t\t{\n\t\t\tthis.isMuted = false;\n\t\t\tthis.source.muted = false;\n\t\t},\n\t\thandleError(event: Event)\n\t\t{\n\t\t\tconsole.error('Im.VideoPlayer: loading failed', this.fileId, event);\n\n\t\t\tthis.loading = false;\n\t\t\tthis.state = State.none;\n\t\t\tthis.timeTotal = 0;\n\t\t\tthis.preloadAttribute = PreloadAttribute.none;\n\t\t},\n\t\thandleAbort(event: Event)\n\t\t{\n\t\t\tthis.handleError(event);\n\t\t},\n\t\thandlePlay()\n\t\t{\n\t\t\tthis.state = State.play;\n\t\t},\n\t\thandleLoadedData()\n\t\t{\n\t\t\tthis.timeTotal = this.source.duration;\n\t\t},\n\t\thandleDurationChange()\n\t\t{\n\t\t\tthis.handleLoadedData();\n\t\t},\n\t\thandleLoadedMetaData()\n\t\t{\n\t\t\tthis.timeTotal = this.source.duration;\n\t\t\tthis.loaded = true;\n\t\t\tthis.play();\n\t\t},\n\t\thandleCanPlayThrough()\n\t\t{\n\t\t\tthis.loading = false;\n\t\t\tthis.loaded = true;\n\t\t\tthis.play();\n\t\t},\n\t\thandlePause()\n\t\t{\n\t\t\tif (this.state === State.stop)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.state = State.pause;\n\t\t},\n\t\thandleVolumeChange()\n\t\t{\n\t\t\tif (this.source.muted)\n\t\t\t{\n\t\t\t\tthis.mute();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.unmute();\n\t\t\t}\n\t\t},\n\t\thandleTimeUpdate()\n\t\t{\n\t\t\tthis.timeCurrent = this.source.currentTime;\n\t\t},\n\t\tgetObserver(): IntersectionObserver\n\t\t{\n\t\t\tif (this.observer)\n\t\t\t{\n\t\t\t\treturn this.observer;\n\t\t\t}\n\n\t\t\tthis.observer = new IntersectionObserver((entries) => {\n\t\t\t\tif (this.isAutoPlayDisabled)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tentries.forEach((entry) => {\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.play();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.pause();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, {\n\t\t\t\tthreshold: [0, 1],\n\t\t\t});\n\n\t\t\treturn this.observer;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-video-player__container\" @click.stop=\"handleContainerClick\">\n\t\t\t<FadeAnimation :duration=\"500\">\n\t\t\t\t<div v-if=\"showStartButton\" class=\"bx-im-video-player__start-play_button\" @click.stop=\"handleControlClick\">\n\t\t\t\t\t<span class=\"bx-im-video-player__start-play_icon\"></span>\n\t\t\t\t</div>\n\t\t\t</FadeAnimation>\n\t\t\t<FadeAnimation :duration=\"500\">\n\t\t\t\t<div v-if=\"showInterface\" class=\"bx-im-video-player__control-button_container\" @click.stop=\"handleControlClick\">\n\t\t\t\t\t<button class=\"bx-im-video-player__control-button\" :class=\"controlButtonClass\"></button>\n\t\t\t\t</div>\n\t\t\t</FadeAnimation>\n\t\t\t<FadeAnimation :duration=\"500\">\n\t\t\t\t<div \n\t\t\t\t\tv-if=\"showInterface\" \n\t\t\t\t\tclass=\"bx-im-video-player__info-container\" \n\t\t\t\t\t@click.stop=\"handleMuteClick\"\n\t\t\t\t>\n\t\t\t\t\t<span class=\"bx-im-video-player__time\">{{ formattedTime }}</span>\n\t\t\t\t\t<span class=\"bx-im-video-player__sound\" :class=\"{'--muted': isMuted}\"></span>\n\t\t\t\t</div>\n\t\t\t</FadeAnimation>\n\t\t\t<div class=\"bx-im-video-player__video-container\" ref=\"body\">\n\t\t\t\t<video\n\t\t\t\t\tv-bind=\"viewerAttributes\"\n\t\t\t\t\t:src=\"src\"\n\t\t\t\t\tclass=\"bx-im-video-player__video\"\n\t\t\t\t\t:poster=\"previewImageUrl\"\n\t\t\t\t\tref=\"source\"\n\t\t\t\t\t:preload=\"preloadAttribute\"\n\t\t\t\t\tplaysinline\n\t\t\t\t\tloop\n\t\t\t\t\tmuted\n\t\t\t\t\t:style=\"elementStyle\"\n\t\t\t\t\t@abort=\"handleAbort\"\n\t\t\t\t\t@error=\"handleError\"\n\t\t\t\t\t@canplaythrough=\"handleCanPlayThrough\"\n\t\t\t\t\t@durationchange=\"handleDurationChange\"\n\t\t\t\t\t@loadeddata=\"handleLoadedData\"\n\t\t\t\t\t@loadedmetadata=\"handleLoadedMetaData\"\n\t\t\t\t\t@volumechange=\"handleVolumeChange\"\n\t\t\t\t\t@timeupdate=\"handleTimeUpdate\"\n\t\t\t\t\t@play=\"handlePlay\"\n\t\t\t\t\t@pause=\"handlePause\"\n\t\t\t\t></video>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\n\nimport { EventType } from 'im.v2.const';\n\nimport type { ImModelFile } from 'im.v2.model';\nimport type { ApplicationContext } from 'im.v2.const';\n\nexport class Playlist\n{\n\tstatic #instance: Playlist;\n\t#files: { [chatId: string]: Set<ImModelFile> } = {};\n\n\tstatic getInstance(): Playlist\n\t{\n\t\tif (!this.#instance)\n\t\t{\n\t\t\tthis.#instance = new this();\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n\n\tregister(file: ImModelFile)\n\t{\n\t\tif (!this.#files[file.chatId])\n\t\t{\n\t\t\tthis.#files[file.chatId] = new Set();\n\t\t}\n\n\t\tthis.#files[file.chatId].add(file);\n\t}\n\n\tunregister(file: ImModelFile)\n\t{\n\t\tthis.#files[file.chatId].delete(file);\n\t}\n\n\tonFileEnded(payload: { file: ImModelFile, context: ApplicationContext })\n\t{\n\t\tconst { file, context: { emitter } } = payload;\n\n\t\tconst nextFile = this.#getNextFile(file);\n\t\tif (!nextFile)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\temitter.emit(EventType.roundVideoPlayer.playNext, { fileId: nextFile.id });\n\t}\n\n\t#getNextFile(file: ImModelFile): ImModelFile | null\n\t{\n\t\tconst chatFiles = [...this.#files[file.chatId]];\n\t\tchatFiles.sort((a, b) => a.date - b.date);\n\t\tconst currentIndex = chatFiles.indexOf(file);\n\n\t\treturn chatFiles[currentIndex + 1];\n\t}\n}\n","const PLAYER_RADIUS = 130;\nconst PLAYER_DIAMETER = PLAYER_RADIUS * 2;\nconst PLAYER_PROGRESS_MARGIN = 1;\n\n// @vue/component\nexport const RoundProgressBar = {\n\tname: 'RoundProgressBar',\n\tprops: {\n\t\tprogress: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t\tvalidator: (value) => value >= 0 && value <= 100,\n\t\t},\n\t},\n\tcomputed: {\n\t\tPLAYER_RADIUS: () => PLAYER_RADIUS,\n\t\tPLAYER_DIAMETER: () => PLAYER_DIAMETER,\n\t\tPLAYER_PROGRESS_MARGIN: () => PLAYER_PROGRESS_MARGIN,\n\t\tprogressStyles(): { strokeDashoffset: number, strokeDasharray: number }\n\t\t{\n\t\t\tconst radius = PLAYER_RADIUS - PLAYER_PROGRESS_MARGIN;\n\t\t\tconst circumference = 2 * Math.PI * radius;\n\n\t\t\tconst offset = circumference - (this.progress / 100) * circumference;\n\n\t\t\treturn {\n\t\t\t\tstrokeDasharray: circumference,\n\t\t\t\tstrokeDashoffset: offset,\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-round-video-player__progress-container\">\n\t\t\t<svg :viewBox=\"\\`0 0 ${PLAYER_DIAMETER} ${PLAYER_DIAMETER}\\`\">\n\t\t\t\t<circle\n\t\t\t\t\t:style=\"progressStyles\"\n\t\t\t\t\tclass=\"bx-im-round-video-player__progress\"\n\t\t\t\t\t:transform=\"\\`rotate(-90, ${PLAYER_RADIUS}, ${PLAYER_RADIUS})\\`\"\n\t\t\t\t\t:cx=\"PLAYER_RADIUS\"\n\t\t\t\t\t:cy=\"PLAYER_RADIUS\"\n\t\t\t\t\t:r=\"PLAYER_RADIUS - PLAYER_PROGRESS_MARGIN\"\n\t\t\t\t></circle>\n\t\t\t</svg>\n\t\t</div>\n\t`,\n};\n","import { BIcon, Outline as OutlineIcons, SmallOutline as SmallOutlineIcons } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.small-outline'; // temp fix, does not work without direct import\n\nimport { Spinner, SpinnerSize, SpinnerColor } from 'im.v2.component.elements.loader';\nimport { Color, TranscriptionStatus } from 'im.v2.const';\nimport { MessageService } from 'im.v2.provider.service.message';\nimport { Analytics } from 'im.v2.lib.analytics';\n\nimport './transcription-button.css';\n\nimport type { ImModelTranscription } from 'im.v2.model';\n\n// @vue/component\nexport const TranscriptionButton = {\n\tname: 'TranscriptionButton',\n\tcomponents: { Spinner, BIcon },\n\tprops: {\n\t\tfile: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisOpened: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t\tisOverlay: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['transcriptionToggle'],\n\tcomputed:\n\t{\n\t\tSpinnerSize: () => SpinnerSize,\n\t\tSpinnerColor: () => SpinnerColor,\n\t\tfileId(): boolean\n\t\t{\n\t\t\treturn this.file.id;\n\t\t},\n\t\tchatId(): boolean\n\t\t{\n\t\t\treturn this.file.chatId;\n\t\t},\n\t\ttranscription(): ?ImModelTranscription\n\t\t{\n\t\t\treturn this.$store.getters['files/getTranscription'](this.fileId);\n\t\t},\n\t\tstatus(): TranscriptionStatus | null\n\t\t{\n\t\t\treturn this.transcription ? this.transcription.status : null;\n\t\t},\n\t\tisPending(): boolean\n\t\t{\n\t\t\treturn this.status === TranscriptionStatus.PENDING;\n\t\t},\n\t\tisSuccess(): boolean\n\t\t{\n\t\t\treturn this.status === TranscriptionStatus.SUCCESS;\n\t\t},\n\t\tbuttonIcon(): string\n\t\t{\n\t\t\tif (this.isOpened)\n\t\t\t{\n\t\t\t\treturn OutlineIcons.CHEVRON_TOP_M;\n\t\t\t}\n\n\t\t\treturn this.isOverlay ? SmallOutlineIcons.TRANSCRIPTION : OutlineIcons.TRANSCRIPTION;\n\t\t},\n\t\ticonColor(): string\n\t\t{\n\t\t\treturn this.isOverlay ? Color.white : Color.accentBlue;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tstatus(newStatus: TranscriptionStatus | null, oldStatus: TranscriptionStatus | null)\n\t\t{\n\t\t\tif (oldStatus === TranscriptionStatus.PENDING)\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().player.onViewTranscription(this.file.id, newStatus);\n\t\t\t\tthis.open();\n\t\t\t}\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tasync onButtonClick(): Promise<void>\n\t\t{\n\t\t\tif (this.isPending)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isOpened)\n\t\t\t{\n\t\t\t\tthis.close();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isSuccess)\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().player.onViewTranscription(this.file.id, TranscriptionStatus.SUCCESS);\n\t\t\t\tthis.open();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst result = await this.transcribe();\n\t\t\tif (result)\n\t\t\t{\n\t\t\t\tthis.open();\n\t\t\t}\n\t\t},\n\t\tasync transcribe(): Promise<void>\n\t\t{\n\t\t\tconst messageService = new MessageService({ chatId: this.chatId });\n\n\t\t\treturn messageService.transcribe(this.fileId, this.messageId);\n\t\t},\n\t\topen(): void\n\t\t{\n\t\t\tthis.$emit('transcriptionToggle', true);\n\t\t},\n\t\tclose(): void\n\t\t{\n\t\t\tthis.$emit('transcriptionToggle', false);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-transcription-button__container\">\n\t\t\t<button\n\t\t\t\tclass=\"bx-im-transcription-button__button\"\n\t\t\t\t:class=\"{'--overlay': isOverlay}\"\n\t\t\t\t@click=\"onButtonClick\"\n\t\t\t>\n\t\t\t\t<Spinner v-if=\"isPending\" :size=\"SpinnerSize.XXS\" :color=\"SpinnerColor.white\" />\n\t\t\t\t<BIcon\n\t\t\t\t\tv-else\n\t\t\t\t\t:name=\"buttonIcon\"\n\t\t\t\t\t:color=\"iconColor\"\n\t\t\t\t\t:size=\"20\"\n\t\t\t\t/>\n\t\t\t</button>\n\t\t</div>\n\t`,\n};\n","import 'main.polyfill.intersectionobserver';\n\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { Feature, FeatureManager } from 'im.v2.lib.feature';\nimport { Outline as OutlineIcons, BIcon } from 'ui.icon-set.api.vue';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { Color, EventType } from 'im.v2.const';\nimport { FadeAnimation } from 'im.v2.component.animation';\n\nimport { Playlist } from '../classes/playlist';\nimport { RoundProgressBar } from './elements/round-progress-bar';\nimport { TranscriptionButton } from './elements/transcription-button/transcription-button';\n\nimport './css/round-video-player.css';\n\nimport type { EventEmitter, BaseEvent } from 'main.core.events';\nimport type { JsonObject } from 'main.core';\nimport type { ImModelFile } from 'im.v2.model';\n\nconst PlaybackMode = {\n\tautoplay: 'autoplay',\n\tmanual: 'manual',\n};\n\nconst PlaybackState = {\n\tloading: 'loading',\n\tplaying: 'playing',\n\tpaused: 'paused',\n};\n\nconst MUTE_ICON_SIZE = 16;\n\n// @vue/component\nexport const RoundVideoPlayer = {\n\tname: 'RoundVideoPlayer',\n\tcomponents: { BIcon, FadeAnimation, RoundProgressBar, TranscriptionButton },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tstartWithSound: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['openTranscription'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tplaybackMode: PlaybackMode.autoplay,\n\t\t\tplaybackState: PlaybackState.loading,\n\t\t\tcurrentTime: 0,\n\t\t\tduration: 0,\n\t\t\tanimationFrameId: null,\n\t\t\tcurrentTimeSmoothed: 0,\n\t\t};\n\t},\n\tcomputed: {\n\t\tPlaybackMode: () => PlaybackMode,\n\t\tOutlineIcons: () => OutlineIcons,\n\t\tMUTE_ICON_SIZE: () => MUTE_ICON_SIZE,\n\t\tColor: () => Color,\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tisLoaded(): boolean\n\t\t{\n\t\t\treturn this.playbackState === PlaybackState.loading;\n\t\t},\n\t\tisAutoplay(): boolean\n\t\t{\n\t\t\treturn this.playbackMode === PlaybackMode.autoplay;\n\t\t},\n\t\tformattedTime(): string\n\t\t{\n\t\t\tif (!this.isLoaded && !this.duration)\n\t\t\t{\n\t\t\t\treturn '--:--';\n\t\t\t}\n\n\t\t\tconst time = this.duration - this.currentTime;\n\n\t\t\treturn Utils.date.formatMediaDurationTime(time);\n\t\t},\n\t\tvideoElement(): HTMLVideoElement\n\t\t{\n\t\t\treturn this.$refs.videoElement;\n\t\t},\n\t\tcurrentProgress(): number\n\t\t{\n\t\t\tif (this.duration === 0)\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn (this.currentTimeSmoothed / this.duration) * 100;\n\t\t},\n\t\tisPaused(): boolean\n\t\t{\n\t\t\treturn this.playbackState === PlaybackState.paused;\n\t\t},\n\t\tisTranscriptionAvailable(): boolean\n\t\t{\n\t\t\treturn this.file.isTranscribable\n\t\t\t\t&& FeatureManager.isFeatureAvailable(Feature.videoNoteTranscriptionAvailable)\n\t\t\t\t&& FeatureManager.isFeatureAvailable(Feature.copilotAvailable);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tPlaylist.getInstance().register(this.file);\n\t},\n\tmounted()\n\t{\n\t\tthis.getObserver().observe(this.$refs.body);\n\t\tthis.getEmitter().subscribe(EventType.roundVideoPlayer.playNext, this.handlePlayNextRequest);\n\t\tthis.getEmitter().subscribe(EventType.roundVideoPlayer.onClickPlay, this.handleOtherVideoStarted);\n\n\t\tif (this.startWithSound)\n\t\t{\n\t\t\tthis.switchToManualMode();\n\t\t}\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.stopProgressAnimation();\n\t\tthis.getObserver().unobserve(this.$refs.body);\n\t\tPlaylist.getInstance().unregister(this.file);\n\t\tthis.getEmitter().unsubscribe(EventType.roundVideoPlayer.playNext, this.handlePlayNextRequest);\n\t\tthis.getEmitter().unsubscribe(EventType.roundVideoPlayer.onClickPlay, this.handleOtherVideoStarted);\n\t},\n\tmethods: {\n\t\ttogglePlayMode()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.roundVideoPlayer.onClickPlay, { fileId: this.file.id });\n\t\t\tif (this.playbackMode === PlaybackMode.autoplay)\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().player.onPlay(this.file.id);\n\t\t\t\tthis.switchToManualMode();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.playbackState === PlaybackState.playing)\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().player.onPause(this.file.id);\n\t\t\t\tthis.pauseVideo();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().player.onPlay(this.file.id);\n\t\t\t\tthis.playVideo();\n\t\t\t}\n\t\t},\n\t\tplayVideo()\n\t\t{\n\t\t\tvoid this.videoElement.play();\n\t\t},\n\t\tpauseVideo()\n\t\t{\n\t\t\tthis.videoElement.pause();\n\t\t},\n\t\thandleLoadedMetaData()\n\t\t{\n\t\t\tthis.duration = this.videoElement.duration;\n\t\t\tthis.playVideo();\n\t\t},\n\t\thandleCanPlayThrough()\n\t\t{\n\t\t\tif (this.playbackState === PlaybackState.loading)\n\t\t\t{\n\t\t\t\tthis.playVideo();\n\t\t\t}\n\t\t},\n\t\thandlePlay()\n\t\t{\n\t\t\tthis.playbackState = PlaybackState.playing;\n\t\t\tthis.startProgressAnimation();\n\t\t},\n\t\thandlePause()\n\t\t{\n\t\t\tthis.playbackState = PlaybackState.paused;\n\t\t\tthis.stopProgressAnimation();\n\t\t},\n\t\thandleEnded()\n\t\t{\n\t\t\tthis.switchToAutoplayMode();\n\t\t\tPlaylist.getInstance().onFileEnded({\n\t\t\t\tfile: this.file,\n\t\t\t\tcontext: { emitter: this.getEmitter() },\n\t\t\t});\n\t\t},\n\t\thandleTimeUpdate()\n\t\t{\n\t\t\tthis.currentTime = this.videoElement.currentTime;\n\t\t},\n\t\thandleError(event: Event)\n\t\t{\n\t\t\tconsole.error('Im.RoundVideoPlayer: loading failed', event);\n\t\t\tthis.playbackState = PlaybackState.loading;\n\t\t\tthis.duration = 0;\n\t\t\tthis.stopProgressAnimation();\n\t\t},\n\t\thandlePlayNextRequest(event: BaseEvent<{fileId: string}>)\n\t\t{\n\t\t\tconst { fileId } = event.getData();\n\t\t\tif (fileId !== this.file.id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$refs.body.scrollIntoView({ behavior: 'smooth', block: 'center' });\n\t\t\tthis.switchToManualMode();\n\t\t},\n\t\thandleOtherVideoStarted(event: BaseEvent<{fileId: string}>)\n\t\t{\n\t\t\tconst { fileId } = event.getData();\n\t\t\tif (fileId === this.file.id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.switchToAutoplayMode();\n\t\t},\n\t\tswitchToAutoplayMode()\n\t\t{\n\t\t\tthis.playbackMode = PlaybackMode.autoplay;\n\t\t\tthis.videoElement.loop = true;\n\t\t\tthis.videoElement.muted = true;\n\t\t\tthis.playVideo();\n\t\t},\n\t\tswitchToManualMode()\n\t\t{\n\t\t\tthis.playbackMode = PlaybackMode.manual;\n\t\t\tthis.videoElement.currentTime = 0;\n\t\t\tthis.videoElement.loop = false;\n\t\t\tthis.videoElement.muted = false;\n\t\t\tthis.playVideo();\n\t\t},\n\t\tgetObserver(): IntersectionObserver\n\t\t{\n\t\t\tif (this.observer)\n\t\t\t{\n\t\t\t\treturn this.observer;\n\t\t\t}\n\n\t\t\tthis.observer = new IntersectionObserver((entries) => {\n\t\t\t\tentries.forEach((entry) => {\n\t\t\t\t\tif (!this.isAutoplay)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (entry.isIntersecting)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.playVideo();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.pauseVideo();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, { threshold: [0, 1] });\n\n\t\t\treturn this.observer;\n\t\t},\n\t\tstartProgressAnimation()\n\t\t{\n\t\t\tconst update = () => {\n\t\t\t\tif (!this.videoElement)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.currentTimeSmoothed = this.videoElement.currentTime;\n\t\t\t\tthis.animationFrameId = requestAnimationFrame(update);\n\t\t\t};\n\t\t\tupdate();\n\t\t},\n\t\tstopProgressAnimation()\n\t\t{\n\t\t\tif (!this.animationFrameId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcancelAnimationFrame(this.animationFrameId);\n\t\t\tthis.animationFrameId = null;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-round-video-player__container\">\n\t\t\t<FadeAnimation :duration=\"200\">\n\t\t\t\t<div v-if=\"isAutoplay\" class=\"bx-im-round-video-player__mute\">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name=\"OutlineIcons.SOUND_OFF\"\n\t\t\t\t\t\t:color=\"Color.white\"\n\t\t\t\t\t\t:size=\"MUTE_ICON_SIZE\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</FadeAnimation>\n\t\t\t<div v-if=\"isTranscriptionAvailable\" class=\"bx-im-round-video-player__transcribe-button\">\n\t\t\t\t<TranscriptionButton\n\t\t\t\t\t:file=\"file\"\n\t\t\t\t\t:messageId=\"message.id\"\n\t\t\t\t\t:isOpened=\"false\"\n\t\t\t\t\t:isOverlay=\"true\"\n\t\t\t\t\t@transcriptionToggle=\"$emit('openTranscription')\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-round-video-player__time-container\">\n\t\t\t\t<div class=\"bx-im-round-video-player__time\">{{ formattedTime }}</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-round-video-player__video-container\" ref=\"body\" @click.stop=\"togglePlayMode\">\n\t\t\t\t<FadeAnimation :duration=\"200\">\n\t\t\t\t\t<div v-if=\"isPaused\" class=\"bx-im-round-video-player__start-play_button\"></div>\n\t\t\t\t</FadeAnimation>\n\t\t\t\t<video\n\t\t\t\t\t:src=\"file.urlDownload\"\n\t\t\t\t\tclass=\"bx-im-round-video-player__video\"\n\t\t\t\t\t:poster=\"file.urlPreview\"\n\t\t\t\t\tref=\"videoElement\"\n\t\t\t\t\tpreload=\"metadata\"\n\t\t\t\t\tplaysinline\n\t\t\t\t\tloop\n\t\t\t\t\tmuted\n\t\t\t\t\t@abort=\"handleError\"\n\t\t\t\t\t@error=\"handleError\"\n\t\t\t\t\t@canplaythrough=\"handleCanPlayThrough\"\n\t\t\t\t\t@loadedmetadata=\"handleLoadedMetaData\"\n\t\t\t\t\t@timeupdate=\"handleTimeUpdate\"\n\t\t\t\t\t@play=\"handlePlay\"\n\t\t\t\t\t@pause=\"handlePause\"\n\t\t\t\t\t@ended=\"handleEnded\"\n\t\t\t\t></video>\n\t\t\t\t<FadeAnimation :duration=\"200\">\n\t\t\t\t\t<RoundProgressBar \n\t\t\t\t\t\tv-if=\"playbackMode === PlaybackMode.manual\" \n\t\t\t\t\t\t:progress=\"currentProgress\" \n\t\t\t\t\t/>\n\t\t\t\t</FadeAnimation>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './css/timeline.css';\n\nimport type { JsonObject } from 'main.core';\n\nconst Wave = {\n\tverticalShift: 44,\n\tactiveVerticalShift: 19,\n};\n\n// @vue/component\nexport const Timeline = {\n\tname: 'PLayerTimeline',\n\tprops: {\n\t\tloaded: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\ttimeCurrent: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\ttimeTotal: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\twithSeeking: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['change'],\n\tdata(): JsonObject {\n\t\treturn {\n\t\t\tseekerOffset: 0,\n\t\t};\n\t},\n\tcomputed: {\n\t\tprogress(): number\n\t\t{\n\t\t\treturn Math.round((100 / this.timeTotal) * this.timeCurrent);\n\t\t},\n\t\tseekerPositionStyles(): JsonObject\n\t\t{\n\t\t\tif (!this.loaded || !this.withSeeking)\n\t\t\t{\n\t\t\t\treturn { display: 'none' };\n\t\t\t}\n\n\t\t\treturn { left: `${this.seekerOffset}px` };\n\t\t},\n\t\tprogressPosition(): JsonObject\n\t\t{\n\t\t\tif (!this.loaded || this.timeCurrent === 0)\n\t\t\t{\n\t\t\t\treturn { width: '100%' };\n\t\t\t}\n\n\t\t\tconst offset = Math.round(this.$refs.timeline.offsetWidth / 100 * this.progress);\n\n\t\t\treturn { width: `${offset}px` };\n\t\t},\n\t\tactiveWaveStyles(): JsonObject\n\t\t{\n\t\t\tconst shift = this.waveType * Wave.verticalShift + Wave.activeVerticalShift;\n\n\t\t\treturn {\n\t\t\t\t...this.progressPosition,\n\t\t\t\t'background-position-y': `-${shift}px`,\n\t\t\t};\n\t\t},\n\t\twaveStyles(): JsonObject\n\t\t{\n\t\t\tconst shift = this.waveType * Wave.verticalShift;\n\n\t\t\treturn {\n\t\t\t\t'background-position-y': `-${shift}px`,\n\t\t\t};\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.waveType = Math.floor(Math.random() * 5);\n\t},\n\tmethods: {\n\t\tsetPosition()\n\t\t{\n\t\t\tif (!this.loaded || !this.withSeeking)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst pixelPerPercent = this.$refs.timeline.offsetWidth / 100;\n\t\t\tconst progress = Math.round(this.seekerOffset / pixelPerPercent);\n\n\t\t\tthis.$emit('change', progress);\n\t\t},\n\t\tupdateSeekerPosition(event: MouseEvent)\n\t\t{\n\t\t\tif (!this.loaded || !this.withSeeking)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.seekerOffset = event.offsetX > 0 ? event.offsetX : 0;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tref=\"timeline\"\n\t\t\t:class=\"{'--with-seeking': withSeeking}\"\n\t\t\tclass=\"bx-im-player-timeline__container\" \n\t\t\t@click=\"setPosition\" \n\t\t\t@mousemove=\"updateSeekerPosition\" \n\t\t>\n\t\t\t<div class=\"bx-im-player-timeline__wave\" :style=\"waveStyles\"></div>\n\t\t\t<div class=\"bx-im-player-timeline__wave\" :style=\"activeWaveStyles\"></div>\n\t\t\t<div class=\"bx-im-player-timeline__seeker\" :style=\"seekerPositionStyles\"></div>\n\t\t</div>\n\t`,\n};\n","import { FeaturePromoter } from 'ui.info-helper';\nimport { RichLoc } from 'ui.vue3.components.rich-loc';\n\nimport { ExpandAnimation } from 'im.v2.component.animation';\nimport { TranscriptionStatus, FileType, SliderCode } from 'im.v2.const';\nimport { Parser } from 'im.v2.lib.parser';\n\nimport './transcription-text.css';\n\nimport type { ImModelMessage, ImModelTranscription } from 'im.v2.model';\n\nconst ErrorMessageByType = {\n\t[FileType.video]: 'IM_MESSAGE_FILE_AUDIO_TRANSCRIPTION_ERROR_VIDEO',\n\t[FileType.audio]: 'IM_MESSAGE_FILE_AUDIO_TRANSCRIPTION_ERROR',\n};\n\nconst LIMIT_ERROR_CODE = 'LIMIT_IS_EXCEEDED_BAAS';\n\n// @vue/component\nexport const TranscriptionText = {\n\tname: 'TranscriptionText',\n\tcomponents: { ExpandAnimation, RichLoc },\n\tprops: {\n\t\tfile: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t\tisOpened: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\ttranscription(): ?ImModelTranscription\n\t\t{\n\t\t\treturn this.$store.getters['files/getTranscription'](this.file.id);\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\treturn Parser.decode({ text: this.transcription.transcriptText });\n\t\t},\n\t\tisError(): boolean\n\t\t{\n\t\t\treturn this.transcription && this.transcription.status === TranscriptionStatus.ERROR;\n\t\t},\n\t\tisLimitError(): boolean\n\t\t{\n\t\t\treturn this.transcription && this.transcription.errorCode === LIMIT_ERROR_CODE;\n\t\t},\n\t\terrorText(): string\n\t\t{\n\t\t\tif (this.isLimitError)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_MESSAGE_FILE_TRANSCRIPTION_LIMIT_ERROR');\n\t\t\t}\n\n\t\t\tconst code = ErrorMessageByType[this.file.type];\n\n\t\t\treturn this.loc(code);\n\t\t},\n\t\tshowDivider(): boolean\n\t\t{\n\t\t\treturn this.isOpened && Boolean(this.message.text);\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.messageId);\n\t\t},\n\t},\n\tmethods: {\n\t\tloc(code: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(code);\n\t\t},\n\t\tonLimitErrorLinkClick()\n\t\t{\n\t\t\tconst promoter = new FeaturePromoter({ code: SliderCode.buyMarketPlus });\n\t\t\tpromoter.show();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-transcription-text__container\">\n\t\t\t<ExpandAnimation>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isOpened\"\n\t\t\t\t\tclass=\"bx-im-transcription-text__content\"\n\t\t\t\t>\n\t\t\t\t\t<div v-if=\"!isError\" v-html=\"text\"></div>\n\t\t\t\t\t<RichLoc\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t:text=\"errorText\"\n\t\t\t\t\t\tclass=\"--error\"\n\t\t\t\t\t\tplaceholder=\"[url]\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #url=\"{ text }\">\n\t\t\t\t\t\t\t<span class=\"bx-im-transcription-text__error-link\" @click=\"onLimitErrorLinkClick\">\n\t\t\t\t\t\t\t\t{{ text }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</RichLoc>\n\t\t\t\t</div>\n\t\t\t</ExpandAnimation>\n\t\t\t<div v-if=\"showDivider\" class=\"bx-im-transcription-text__divider\"></div>\n\t\t</div>\n\t`,\n};\n","import 'ui.fonts.opensans';\nimport 'main.polyfill.intersectionobserver';\nimport { Feature, FeatureManager } from 'im.v2.lib.feature';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport { LocalStorageKey, AudioPlaybackRate, AudioPlaybackState as State, EventType } from 'im.v2.const';\nimport { LocalStorageManager } from 'im.v2.lib.local-storage';\nimport { Utils } from 'im.v2.lib.utils';\nimport { MessageAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { Analytics } from 'im.v2.lib.analytics';\n\nimport { Timeline } from './elements/timeline/timeline';\nimport { TranscriptionButton } from './elements/transcription-button/transcription-button';\nimport { TranscriptionText } from './elements/transcription-text/transcription-text';\n\nimport './css/audio-player.css';\n\nimport type { JsonObject } from 'main.core';\n\nconst ID_KEY = 'im:audioplayer:id';\n\n// @vue/component\nexport const AudioPlayer = {\n\tname: 'AudioPlayer',\n\tcomponents: { MessageAvatar, Timeline, TranscriptionButton, TranscriptionText },\n\tprops: {\n\t\tid: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t},\n\t\tsrc: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tfile: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tauthorId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t\twithContextMenu: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\twithAvatar: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\twithPlaybackRateControl: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\twithTranscription: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\tdata(): JsonObject {\n\t\treturn {\n\t\t\tpreload: 'none',\n\t\t\tloaded: false,\n\t\t\tloading: false,\n\t\t\tstate: State.none,\n\t\t\ttimeCurrent: 0,\n\t\t\ttimeTotal: 0,\n\t\t\tshowContextButton: false,\n\t\t\tcurrentRate: AudioPlaybackRate['1'],\n\t\t\tisTranscriptionOpened: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tState: () => State,\n\t\tisPlaying(): boolean\n\t\t{\n\t\t\treturn this.state === State.play;\n\t\t},\n\t\tlabelTime(): string\n\t\t{\n\t\t\tif (!this.loaded && !this.timeTotal)\n\t\t\t{\n\t\t\t\treturn '--:--';\n\t\t\t}\n\n\t\t\tlet time = 0;\n\t\t\tif (this.isPlaying)\n\t\t\t{\n\t\t\t\ttime = this.timeTotal - this.timeCurrent;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttime = this.timeTotal;\n\t\t\t}\n\n\t\t\treturn Utils.date.formatMediaDurationTime(time);\n\t\t},\n\t\tAvatarSize: () => AvatarSize,\n\t\tfileSize(): string\n\t\t{\n\t\t\treturn Utils.file.formatFileSize(this.file.size);\n\t\t},\n\t\tgetAudioPlayerIds(): Array\n\t\t{\n\t\t\treturn this.$Bitrix.Data.get(ID_KEY, []);\n\t\t},\n\t\tcurrentRateLabel(): string\n\t\t{\n\t\t\treturn this.isPlaying ? `${this.currentRate}x` : '';\n\t\t},\n\t\tmetaInfo(): string\n\t\t{\n\t\t\treturn `${this.fileSize}, ${this.labelTime}`;\n\t\t},\n\t\tisTranscriptionAvailable(): boolean\n\t\t{\n\t\t\treturn this.withTranscription\n\t\t\t\t&& this.file.isTranscribable\n\t\t\t\t&& FeatureManager.isFeatureAvailable(Feature.aiFileTranscriptionAvailable)\n\t\t\t\t&& FeatureManager.isFeatureAvailable(Feature.copilotAvailable);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tid(value: number)\n\t\t{\n\t\t\tthis.registerPlayer(value);\n\t\t},\n\t\ttimeCurrent(value: number)\n\t\t{\n\t\t\tconst progress = Math.round(100 / this.timeTotal * value);\n\t\t\tif (progress > 70)\n\t\t\t{\n\t\t\t\tthis.preloadNext();\n\t\t\t}\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.localStorageInst = LocalStorageManager.getInstance();\n\t\tthis.currentRate = this.getRateFromLS();\n\n\t\tthis.preloadRequestSent = false;\n\t\tthis.registeredId = 0;\n\n\t\tthis.registerPlayer(this.id);\n\t\tthis.getEmitter().subscribe(EventType.audioPlayer.play, this.onPlay);\n\t\tthis.getEmitter().subscribe(EventType.audioPlayer.stop, this.onStop);\n\t\tthis.getEmitter().subscribe(EventType.audioPlayer.pause, this.onPause);\n\t\tthis.getEmitter().subscribe(EventType.audioPlayer.preload, this.onPreload);\n\t},\n\tmounted()\n\t{\n\t\tthis.getObserver().observe(this.$refs.body);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.unregisterPlayer();\n\n\t\tthis.getEmitter().unsubscribe(EventType.audioPlayer.play, this.onPlay);\n\t\tthis.getEmitter().unsubscribe(EventType.audioPlayer.stop, this.onStop);\n\t\tthis.getEmitter().unsubscribe(EventType.audioPlayer.pause, this.onPause);\n\t\tthis.getEmitter().unsubscribe(EventType.audioPlayer.preload, this.onPreload);\n\n\t\tthis.getObserver().unobserve(this.$refs.body);\n\t},\n\tmethods:\n\t{\n\t\tloadFile(play: boolean = false)\n\t\t{\n\t\t\tif (this.loaded || (this.loading && !play))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.preload = 'auto';\n\n\t\t\tif (!play)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.loading = true;\n\n\t\t\tif (this.source())\n\t\t\t{\n\t\t\t\tvoid this.source().play();\n\t\t\t}\n\t\t},\n\t\tclickToButton()\n\t\t{\n\t\t\tif (!this.src)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isPlaying)\n\t\t\t{\n\t\t\t\tthis.pause();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.play();\n\t\t\t}\n\t\t},\n\t\tplay()\n\t\t{\n\t\t\tthis.updateRate(this.getRateFromLS());\n\n\t\t\tif (!this.loaded)\n\t\t\t{\n\t\t\t\tthis.loadFile(true);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.source().play();\n\t\t},\n\t\tpause()\n\t\t{\n\t\t\tthis.source().pause();\n\t\t},\n\t\tstop()\n\t\t{\n\t\t\tthis.state = State.stop;\n\t\t\tthis.source().pause();\n\t\t},\n\t\tgetRateFromLS(): $Values<typeof AudioPlaybackRate>\n\t\t{\n\t\t\treturn this.localStorageInst.get(LocalStorageKey.audioPlaybackRate) || AudioPlaybackRate['1'];\n\t\t},\n\t\tsetRateInLS(newRate: $Values<typeof AudioPlaybackRate>)\n\t\t{\n\t\t\tthis.localStorageInst.set(LocalStorageKey.audioPlaybackRate, newRate);\n\t\t},\n\t\tgetNextPlaybackRate(currentRate: $Values<typeof AudioPlaybackRate>): $Values<typeof AudioPlaybackRate>\n\t\t{\n\t\t\tconst rates = Object.values(AudioPlaybackRate).sort();\n\t\t\tconst currentIndex = rates.indexOf(currentRate);\n\t\t\tconst nextIndex = (currentIndex + 1) % rates.length;\n\n\t\t\treturn rates[nextIndex];\n\t\t},\n\t\tchangeRate()\n\t\t{\n\t\t\tif ([State.pause, State.none].includes(this.state))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst commonCurrentRate = this.getRateFromLS();\n\t\t\tconst newRate = this.getNextPlaybackRate(commonCurrentRate);\n\n\t\t\tAnalytics.getInstance().player.onChangeRate(this.file.chatId, newRate);\n\t\t\tthis.setRateInLS(newRate);\n\t\t\tthis.updateRate(newRate);\n\t\t},\n\t\tupdateRate(newRate: $Values<typeof AudioPlaybackRate>)\n\t\t{\n\t\t\tthis.currentRate = newRate;\n\t\t\tthis.source().playbackRate = newRate;\n\t\t},\n\t\tregisterPlayer(id: number): boolean\n\t\t{\n\t\t\tif (id <= 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.unregisterPlayer();\n\t\t\tconst audioIdArray = [...new Set([...this.getAudioPlayerIds, id])];\n\t\t\tthis.$Bitrix.Data.set(ID_KEY, audioIdArray.sort((a, b) => a - b));\n\n\t\t\tthis.registeredId = id;\n\t\t},\n\t\tunregisterPlayer(): boolean\n\t\t{\n\t\t\tif (!this.registeredId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$Bitrix.Data.get(ID_KEY, this.getAudioPlayerIds.filter((id) => id !== this.registeredId));\n\n\t\t\tthis.registeredId = 0;\n\t\t},\n\t\tplayNext(): boolean\n\t\t{\n\t\t\tif (!this.registeredId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst nextId = this.getAudioPlayerIds.filter((id) => id > this.registeredId).slice(0, 1)[0];\n\t\t\tif (nextId)\n\t\t\t{\n\t\t\t\tthis.getEmitter().emit(EventType.audioPlayer.play, { id: nextId, start: true });\n\t\t\t}\n\t\t},\n\t\tpreloadNext(): boolean\n\t\t{\n\t\t\tif (this.preloadRequestSent || !this.registeredId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.preloadRequestSent = true;\n\n\t\t\tconst nextId = this.getAudioPlayerIds.filter((id) => id > this.registeredId).slice(0, 1)[0];\n\t\t\tif (nextId)\n\t\t\t{\n\t\t\t\tthis.getEmitter().emit(EventType.audioPlayer.preload, { id: nextId });\n\t\t\t}\n\t\t},\n\t\tonPlay(event: BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.id !== this.id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (data.start)\n\t\t\t{\n\t\t\t\tthis.stop();\n\t\t\t}\n\n\t\t\tthis.play();\n\t\t},\n\t\tonStop(event: BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.initiator === this.id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.stop();\n\t\t},\n\t\tonPause(event: BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.initiator === this.id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.pause();\n\t\t},\n\t\tonPreload(event: BaseEvent)\n\t\t{\n\t\t\tconst data = event.getData();\n\n\t\t\tif (data.id !== this.id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.loadFile();\n\t\t},\n\t\tsource(): HTMLAudioElement\n\t\t{\n\t\t\treturn this.$refs.source;\n\t\t},\n\t\taudioEventRouter(eventName: string, event: BaseEvent)\n\t\t{\n\t\t\t// eslint-disable-next-line default-case\n\t\t\tswitch (eventName)\n\t\t\t{\n\t\t\t\tcase 'durationchange':\n\t\t\t\tcase 'loadeddata':\n\t\t\t\tcase 'loadedmetadata':\n\t\t\t\t\tif (!this.source())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.timeTotal = this.source().duration;\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'abort':\n\t\t\t\tcase 'error':\n\t\t\t\t\tconsole.error('BxAudioPlayer: load failed', this.id, event);\n\n\t\t\t\t\tthis.loading = false;\n\t\t\t\t\tthis.state = State.none;\n\t\t\t\t\tthis.timeTotal = 0;\n\t\t\t\t\tthis.preload = 'none';\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'canplaythrough':\n\t\t\t\t\tthis.loading = false;\n\t\t\t\t\tthis.loaded = true;\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'timeupdate':\n\t\t\t\t\tif (!this.source())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.timeCurrent = this.source().currentTime;\n\n\t\t\t\t\tif (this.isPlaying && this.timeCurrent >= this.timeTotal)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.playNext();\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'pause':\n\t\t\t\t\tAnalytics.getInstance().player.onPause(this.file.id);\n\t\t\t\t\tif (this.state !== State.stop)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.state = State.pause;\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'play':\n\t\t\t\t\tAnalytics.getInstance().player.onPlay(this.file.id);\n\t\t\t\t\tthis.state = State.play;\n\n\t\t\t\t\tif (this.state === State.stop)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.timeCurrent = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.id > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.getEmitter().emit(EventType.audioPlayer.pause, { initiator: this.id });\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t// No default\n\t\t\t}\n\t\t},\n\t\tgetObserver(): IntersectionObserver\n\t\t{\n\t\t\tif (this.observer)\n\t\t\t{\n\t\t\t\treturn this.observer;\n\t\t\t}\n\n\t\t\tthis.observer = new IntersectionObserver((entries) => {\n\t\t\t\tentries.forEach((entry) => {\n\t\t\t\t\tif (entry.isIntersecting && this.preload === 'none')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.preload = 'metadata';\n\t\t\t\t\t\tthis.observer.unobserve(entry.target);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, {\n\t\t\t\tthreshold: [0, 1],\n\t\t\t});\n\n\t\t\treturn this.observer;\n\t\t},\n\t\tonTimelineClick(progress: number)\n\t\t{\n\t\t\tthis.play();\n\t\t\tthis.source().currentTime = this.timeTotal / 100 * progress;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-audio-player__scope\">\n\t\t\t<div \n\t\t\t\tclass=\"bx-im-audio-player__container\" \n\t\t\t\tref=\"body\"\n\t\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t\t>\n\t\t\t\t<div class=\"bx-im-audio-player__control-container\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"bx-im-audio-player__control-button\"\n\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t'bx-im-audio-player__control-loader': loading,\n\t\t\t\t\t\t\t'bx-im-audio-player__control-play': !loading && !this.isPlaying,\n\t\t\t\t\t\t\t'bx-im-audio-player__control-pause': !loading && this.isPlaying,\n\t\t\t\t\t\t}\"\n\t\t\t\t\t\t@click=\"clickToButton\"\n\t\t\t\t\t></button>\n\t\t\t\t\t<div v-if=\"withAvatar\" class=\"bx-im-audio-player__author-avatar-container\">\n\t\t\t\t\t\t<MessageAvatar\n\t\t\t\t\t\t\t:messageId=\"messageId\"\n\t\t\t\t\t\t\t:authorId=\"authorId\"\n\t\t\t\t\t\t\t:size=\"AvatarSize.XS\" \n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-audio-player__content-container\">\n\t\t\t\t\t<div class=\"bx-im-audio-player__timeline-container\">\n\t\t\t\t\t\t<Timeline \n\t\t\t\t\t\t\t:loaded=\"loaded\"\n\t\t\t\t\t\t\t:timeCurrent=\"timeCurrent\"\n\t\t\t\t\t\t\t:timeTotal=\"timeTotal\"\n\t\t\t\t\t\t\t@change=\"onTimelineClick\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class=\"bx-im-audio-player__timer-container --ellipsis\">\n\t\t\t\t\t\t\t{{ metaInfo }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"isTranscriptionAvailable\" class=\"bx-im-audio-player__transcription\">\n\t\t\t\t\t\t<TranscriptionButton\n\t\t\t\t\t\t\t:file=\"file\"\n\t\t\t\t\t\t\t:messageId=\"messageId\"\n\t\t\t\t\t\t\t:isOpened=\"isTranscriptionOpened\"\n\t\t\t\t\t\t\t@transcriptionToggle=\"isTranscriptionOpened = !isTranscriptionOpened\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"!withPlaybackRateControl\"\n\t\t\t\t\t\tclass=\"bx-im-audio-player__rate-button-container\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t:class=\"{'--active': isPlaying}\"\n\t\t\t\t\t\t\t@click=\"changeRate\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<span :class=\"{'bx-im-audio-player__rate-icon': !isPlaying}\">\n\t\t\t\t\t\t\t{{ currentRateLabel }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button\n\t\t\t\t\t\tv-if=\"showContextButton && withContextMenu\"\n\t\t\t\t\t\tclass=\"bx-im-messenger__context-menu-icon bx-im-audio-player__context-menu-button\"\n\t\t\t\t\t\t@click=\"$emit('contextMenuClick', $event)\"\n\t\t\t\t\t></button>\n\t\t\t\t</div>\n\t\t\t\t<audio \n\t\t\t\t\tv-if=\"src\" \n\t\t\t\t\t:src=\"src\" \n\t\t\t\t\tclass=\"bx-im-audio-player__audio-source\" \n\t\t\t\t\tref=\"source\" \n\t\t\t\t\t:preload=\"preload\"\n\t\t\t\t\t@abort=\"audioEventRouter('abort', $event)\"\n\t\t\t\t\t@error=\"audioEventRouter('error', $event)\"\n\t\t\t\t\t@suspend=\"audioEventRouter('suspend', $event)\"\n\t\t\t\t\t@canplay=\"audioEventRouter('canplay', $event)\"\n\t\t\t\t\t@canplaythrough=\"audioEventRouter('canplaythrough', $event)\"\n\t\t\t\t\t@durationchange=\"audioEventRouter('durationchange', $event)\"\n\t\t\t\t\t@loadeddata=\"audioEventRouter('loadeddata', $event)\"\n\t\t\t\t\t@loadedmetadata=\"audioEventRouter('loadedmetadata', $event)\"\n\t\t\t\t\t@timeupdate=\"audioEventRouter('timeupdate', $event)\"\n\t\t\t\t\t@play=\"audioEventRouter('play', $event)\"\n\t\t\t\t\t@playing=\"audioEventRouter('playing', $event)\"\n\t\t\t\t\t@pause=\"audioEventRouter('pause', $event)\"\n\t\t\t\t></audio>\n\t\t\t</div>\n\t\t\t<TranscriptionText\n\t\t\t\t:file=\"file\"\n\t\t\t\t:isOpened=\"isTranscriptionOpened\"\n\t\t\t\t:messageId=\"messageId\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Utils } from 'im.v2.lib.utils';\n\nimport { Timeline } from './elements/timeline/timeline';\nimport { TranscriptionButton } from './elements/transcription-button/transcription-button';\nimport { TranscriptionText } from './elements/transcription-text/transcription-text';\n\nimport './css/transcribed-video-player.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelFile } from 'im.v2.model';\n\n// @vue/component\nexport const TranscribedVideoPlayer = {\n\tname: 'TranscribedVideoPlayer',\n\tcomponents: { TranscriptionText, TranscriptionButton, Timeline },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['closeTranscription', 'clickPlay'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tduration: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tplayButtonStyles(): JsonObject\n\t\t{\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url(${this.file.urlPreview})`,\n\t\t\t};\n\t\t},\n\t\tformattedTime(): string\n\t\t{\n\t\t\tif (this.duration === 0)\n\t\t\t{\n\t\t\t\treturn '--:--';\n\t\t\t}\n\n\t\t\treturn Utils.date.formatMediaDurationTime(this.duration);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\thandleLoadedMetaData()\n\t\t{\n\t\t\tthis.duration = this.$refs.videoElement.duration;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-transcribed-video-player__container\">\n\t\t\t<div class=\"bx-im-transcribed-video-player__video\">\n\t\t\t\t<div\n\t\t\t\t\t:style=\"playButtonStyles\"\n\t\t\t\t\tclass=\"bx-im-transcribed-video-player__play\"\n\t\t\t\t\t@click=\"$emit('clickPlay')\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bx-im-transcribed-video-player__play-button-overlay\"></div>\n\t\t\t\t\t<div class=\"bx-im-transcribed-video-player__play-icon\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-transcribed-video-player__content\">\n\t\t\t\t\t<div class=\"bx-im-transcribed-video-player__timeline-container\">\n\t\t\t\t\t\t<Timeline\n\t\t\t\t\t\t\t:loaded=\"duration > 0\"\n\t\t\t\t\t\t\t:timeCurrent=\"duration\"\n\t\t\t\t\t\t\t:timeTotal=\"duration\"\n\t\t\t\t\t\t\t:withSeeking=\"false\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class=\"bx-im-transcribed-video-player__metainfo\">{{ formattedTime }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-transcribed-video-player__transcription-button\">\n\t\t\t\t\t\t<TranscriptionButton\n\t\t\t\t\t\t\t:file=\"file\"\n\t\t\t\t\t\t\t:isOpened=\"true\"\n\t\t\t\t\t\t\t:messageId=\"message.id\"\n\t\t\t\t\t\t\t@transcriptionToggle=\"$emit('closeTranscription')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<video\n\t\t\t\t\t:src=\"file.urlDownload\"\n\t\t\t\t\tclass=\"bx-im-transcribed-video-player__video-source\"\n\t\t\t\t\tref=\"videoElement\"\n\t\t\t\t\tpreload=\"metadata\"\n\t\t\t\t\t@loadedmetadata=\"handleLoadedMetaData\"\n\t\t\t\t></video>\n\t\t\t</div>\n\t\t\t<TranscriptionText\n\t\t\t\t:file=\"file\"\n\t\t\t\t:isOpened=\"true\"\n\t\t\t\t:messageId=\"message.id\"\n\t\t\t\tclass=\"bx-im-transcribed-video-player__transcription-text\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n"],"names":["State","Object","freeze","play","pause","stop","none","PreloadAttribute","metadata","auto","DefaultVideoPlayer","name","components","FadeAnimation","props","fileId","type","Number","String","default","src","required","previewImageUrl","withAutoplay","Boolean","elementStyle","withPlayerControls","viewerAttributes","data","preloadAttribute","loaded","loading","state","timeCurrent","timeTotal","isMuted","computed","isAutoPlayDisabled","showStartButton","showInterface","formattedTime","time","Utils","date","formatMediaDurationTime","controlButtonClass","source","$refs","hasViewerAttributes","keys","length","created","mounted","getObserver","observe","body","beforeUnmount","unobserve","methods","loadFile","playAfterLoad","handleControlClick","handleMuteClick","unmute","mute","handleContainerClick","muted","handleError","event","console","error","handleAbort","handlePlay","handleLoadedData","duration","handleDurationChange","handleLoadedMetaData","handleCanPlayThrough","handlePause","handleVolumeChange","handleTimeUpdate","currentTime","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","threshold","template","Playlist","getInstance","register","file","chatId","Set","add","unregister","delete","onFileEnded","payload","context","emitter","nextFile","emit","EventType","roundVideoPlayer","playNext","id","chatFiles","sort","a","b","currentIndex","indexOf","PLAYER_RADIUS","PLAYER_DIAMETER","PLAYER_PROGRESS_MARGIN","RoundProgressBar","progress","validator","value","progressStyles","radius","circumference","Math","PI","offset","strokeDasharray","strokeDashoffset","TranscriptionButton","Spinner","BIcon","isOpened","messageId","isOverlay","emits","SpinnerSize","SpinnerColor","transcription","$store","getters","status","isPending","TranscriptionStatus","PENDING","isSuccess","SUCCESS","buttonIcon","OutlineIcons","CHEVRON_TOP_M","SmallOutlineIcons","TRANSCRIPTION","iconColor","Color","white","accentBlue","watch","newStatus","oldStatus","Analytics","player","onViewTranscription","open","onButtonClick","close","result","transcribe","messageService","MessageService","$emit","PlaybackMode","autoplay","manual","PlaybackState","playing","paused","MUTE_ICON_SIZE","RoundVideoPlayer","item","message","startWithSound","playbackMode","playbackState","animationFrameId","currentTimeSmoothed","isLoaded","isAutoplay","videoElement","currentProgress","isPaused","isTranscriptionAvailable","isTranscribable","FeatureManager","isFeatureAvailable","Feature","videoNoteTranscriptionAvailable","copilotAvailable","getEmitter","subscribe","handlePlayNextRequest","onClickPlay","handleOtherVideoStarted","switchToManualMode","stopProgressAnimation","unsubscribe","togglePlayMode","onPlay","onPause","pauseVideo","playVideo","startProgressAnimation","handleEnded","switchToAutoplayMode","getData","scrollIntoView","behavior","block","loop","update","requestAnimationFrame","cancelAnimationFrame","$Bitrix","eventEmitter","Wave","verticalShift","activeVerticalShift","Timeline","withSeeking","seekerOffset","round","seekerPositionStyles","display","left","progressPosition","width","timeline","offsetWidth","activeWaveStyles","shift","waveType","waveStyles","floor","random","setPosition","pixelPerPercent","updateSeekerPosition","offsetX","ErrorMessageByType","FileType","video","audio","LIMIT_ERROR_CODE","TranscriptionText","ExpandAnimation","RichLoc","text","Parser","decode","transcriptText","isError","ERROR","isLimitError","errorCode","errorText","loc","code","showDivider","Loc","getMessage","onLimitErrorLinkClick","promoter","FeaturePromoter","SliderCode","buyMarketPlus","show","ID_KEY","AudioPlayer","MessageAvatar","authorId","withContextMenu","withAvatar","withPlaybackRateControl","withTranscription","preload","showContextButton","currentRate","AudioPlaybackRate","isTranscriptionOpened","isPlaying","labelTime","AvatarSize","fileSize","formatFileSize","size","getAudioPlayerIds","Data","get","currentRateLabel","metaInfo","aiFileTranscriptionAvailable","registerPlayer","preloadNext","localStorageInst","LocalStorageManager","getRateFromLS","preloadRequestSent","registeredId","audioPlayer","onStop","onPreload","unregisterPlayer","clickToButton","updateRate","LocalStorageKey","audioPlaybackRate","setRateInLS","newRate","set","getNextPlaybackRate","rates","values","nextIndex","changeRate","includes","commonCurrentRate","onChangeRate","playbackRate","audioIdArray","filter","nextId","slice","start","initiator","audioEventRouter","eventName","target","onTimelineClick","TranscribedVideoPlayer","playButtonStyles","backgroundImage","urlPreview"],"mappings":"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"}