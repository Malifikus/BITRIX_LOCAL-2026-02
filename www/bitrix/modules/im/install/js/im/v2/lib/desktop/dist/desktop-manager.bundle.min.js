this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,i,o,n,a,r,l,c,d,p,b,v,h,u,k){"use strict";const g="icon.png";const L="internal.png";const f="http://127.0.0.1:20141";const P=500;const B="bx-im-messenger__out-of-view";const y={};const D={testImageLoad(e=g){let t=null;const s=new Promise((e=>{t=e}));const i=Date.now();let o=false;const n=b.Dom.create({tag:"img",attrs:{src:`${f}/${e}?${i}`,"data-id":i},props:{className:B},events:{error(){if(o){return}const e=this.dataset.id;t(false);clearTimeout(y[e]);b.Dom.remove(this)},load(){const e=this.dataset.id;t(true);clearTimeout(y[e]);b.Dom.remove(this)}}});document.body.append(n);y[i]=setTimeout((()=>{o=true;t(false);b.Dom.remove(n)}),P);return s},testInternetConnection(){const e=Date.now();const t=b.Extension.getSettings("im.v2.lib.desktop");const s=t.get("internetCheckUrl");return new Promise((t=>{fetch(`${s}.${e}`).then((e=>{if(e.status===200){t(true);return}t(false)})).catch((()=>{t(false)}))}))},IMAGE_DESKTOP_RUN:g,IMAGE_DESKTOP_TWO_WINDOW_MODE:L};let C=[];let m=0;const w={openConference(e){if(!d.Utils.conference.isValidCode(e)){return false}if(!k.DesktopApi.isDesktop()){return false}let t=null;const s=[{width:2560,height:1440},{width:2048,height:1152},{width:1920,height:1080},{width:1600,height:900},{width:1366,height:768},{width:1024,height:576}];for(const e of s){t=e;if(screen.width>e.width&&screen.height>e.height){break}}C=C.filter((e=>Boolean(k.DesktopApi.findWindow(e))));C.push(d.Utils.conference.getWindowNameByCode(e));k.DesktopApi.createWindow(d.Utils.conference.getWindowNameByCode(e),(s=>{s.SetProperty("title",b.Loc.getMessage("IM_LIB_DESKTOP_CONFERENCE_TITLE"));s.SetProperty("clientSize",{Width:t.width,Height:t.height});s.ExecuteCommand("center");s.SetProperty("minClientSize",{Width:940,Height:400});s.SetProperty("backgroundColor","#2B3038");s.ExecuteCommand("html.load",`<script>location.href="/video/${e}/";<\/script>`);s.ExecuteCommand("show");s.ExecuteCommand("center")}));return true},toggleConference(){if(m>C.length-1){m=0;k.DesktopApi.showWindow();return true}C=C.filter((e=>Boolean(k.DesktopApi.findWindow(e))));for(let e=m;e<C.length;e++){m++;const t=k.DesktopApi.findWindow(C[e]);if(t){k.DesktopApi.activateWindow(t);break}}return true}};const F="!!";const H={encodeParams(e){if(!b.Type.isPlainObject(e)){return""}let t="";Object.entries(e).forEach((([e,s])=>{const i="";t+=`${i}${e}${F}${s}`}));return t},decodeParams(e){const t={};if(!b.Type.isStringFilled(e)){return t}const s=e.split(F);for(let e=0;e<s.length;e+=2){const i=s[e];const o=s[e+1];t[i]=o}return t},encodeParamsJson(e){if(!b.Type.isPlainObject(e)){return"{}"}let t="";try{t=encodeURIComponent(JSON.stringify(e))}catch(e){console.error("DesktopUtils: could not encode params.",e);t="{}"}return t},decodeParamsJson(e){let t={};if(!b.Type.isStringFilled(e)){return t}try{t=JSON.parse(decodeURIComponent(e))}catch(e){console.error("DesktopUtils: could not decode encoded params.",e)}return t}};const x={handleCommand(e,t){const i=t!=null?t:{};Object.entries(i).forEach((([e,t])=>{i[e]=decodeURIComponent(t)}));if(e!==v.DesktopBxLink.openPage){k.DesktopApi.activateWindow()}if(e===v.DesktopBxLink.chat){var o;const e=(o=i.messageId)!=null?o:0;void s.Messenger.openChat(i.dialogId,e)}else if(e===v.DesktopBxLink.lines){void s.Messenger.openLines(i.dialogId)}else if(e===v.DesktopBxLink.conference){void c.DesktopManager.getInstance().openConference(i.code)}else if(e===v.DesktopBxLink.call){const e=i.withVideo!=="N";void s.Messenger.startVideoCall(i.dialogId,e)}else if(e===v.DesktopBxLink.phone){const e=H.decodeParamsJson(i.phoneParams);void s.Messenger.startPhoneCall(i.number,e)}else if(e===v.DesktopBxLink.callList){const e=H.decodeParamsJson(i.callListParams);void s.Messenger.startCallList(i.callListId,e)}else if(e===v.DesktopBxLink.notifications){void s.Messenger.openNotifications()}else if(e===v.DesktopBxLink.recentSearch){void s.Messenger.openRecentSearch()}else if(e===v.DesktopBxLink.copilot){void s.Messenger.openCopilot(i.dialogId)}else if(e===v.DesktopBxLink.collab){void s.Messenger.openCollab(i.dialogId)}else if(e===v.DesktopBxLink.channel){void s.Messenger.openChannel(i.dialogId)}else if(e===v.DesktopBxLink.taskComments){var n;const e=(n=i.messageId)!=null?n:0;void s.Messenger.openTaskComments(i.dialogId,e)}else if(e===v.DesktopBxLink.settings){void s.Messenger.openSettings({onlyPanel:i.section})}else if(e===v.DesktopBxLink.chatCreation){void s.Messenger.openChatCreation(i.chatType)}else if(e===v.DesktopBxLink.openLayout){const{id:e,entityId:t}=i;void s.Messenger.openNavigationItem({id:e,entityId:t})}else if(e===v.DesktopBxLink.timeManager){var a,r;(a=BX.Timeman)==null?void 0:(r=a.Monitor)==null?void 0:r.openReport()}else if(e===v.DesktopBxLink.openTab){k.DesktopApi.setActiveTab()}else if(e===v.DesktopBxLink.openPage){const e=H.decodeParamsJson(i.options);k.DesktopApi.openPage(e.url,e.options)}else if(e===v.DesktopBxLink.botContext){const{dialogId:e,context:t}=i;const o=H.decodeParamsJson(t);void s.Messenger.openChatWithBotContext(e,o)}},handleLegacyCommand(e,t){const i=t!=null?t:{};Object.entries(i).forEach((([e,t])=>{i[e]=decodeURIComponent(t)}));if(e===v.LegacyDesktopBxLink.messenger){if(i.dialog){void s.Messenger.openChat(i.dialog)}else if(i.chat){void s.Messenger.openChat(`chat${i.chat}`)}else{void s.Messenger.openChat()}}else if(e===v.LegacyDesktopBxLink.chat&&i.id){void s.Messenger.openChat(`chat${i.id}`)}else if(e===v.LegacyDesktopBxLink.notify){void s.Messenger.openNotifications()}else if(e===v.LegacyDesktopBxLink.callTo){if(i.video){void s.Messenger.startVideoCall(i.video)}else if(i.audio){void s.Messenger.startVideoCall(i.audio,false)}else if(i.phone){void s.Messenger.startPhoneCall(i.phone)}}else if(e===v.LegacyDesktopBxLink.callList){void s.Messenger.openRecentSearch()}}};var T=babelHelpers.classPrivateFieldLooseKey("subscribeToBxProtocolEvent");var I=babelHelpers.classPrivateFieldLooseKey("subscribeToLegacyBxProtocolEvent");class A{static init(){return new A}constructor(){Object.defineProperty(this,I,{value:M});Object.defineProperty(this,T,{value:E});babelHelpers.classPrivateFieldLooseBase(this,T)[T]();babelHelpers.classPrivateFieldLooseBase(this,I)[I]()}}function E(){k.DesktopApi.subscribe(v.EventType.desktop.onBxLink,(async(e,t)=>{await k.DesktopApi.showBrowserWindow();if(k.DesktopApi.isFeatureSupported(k.DesktopFeature.portalTabActivation.id)){await k.DesktopApi.handlePortalTabActivation()}c.DesktopBroadcastManager.getInstance().sendActionMessage({action:v.DesktopBroadcastAction.bxLink,params:{command:e,rawParams:t}})}))}function M(){k.DesktopApi.subscribe(v.EventType.desktop.onBxLink,((e,t)=>{x.handleLegacyCommand(e,t)}))}var O=babelHelpers.classPrivateFieldLooseKey("subscribeToLogoutEvent");var S=babelHelpers.classPrivateFieldLooseKey("onExit");class ${static init(){return new $}constructor(){Object.defineProperty(this,S,{value:K});Object.defineProperty(this,O,{value:j});babelHelpers.classPrivateFieldLooseBase(this,O)[O]()}}function j(){k.DesktopApi.subscribe(v.EventType.desktop.onExit,babelHelpers.classPrivateFieldLooseBase(this,S)[S].bind(this))}function K(){i.runAction(v.RestMethod.imV2DesktopLogout).finally((()=>{k.DesktopApi.shutdown()}))}var W=babelHelpers.classPrivateFieldLooseKey("subscribeToIconClickEvent");var R=babelHelpers.classPrivateFieldLooseKey("onIconClick");var N=babelHelpers.classPrivateFieldLooseKey("subscribeToAwayEvent");var U=babelHelpers.classPrivateFieldLooseKey("onUserAway");var X=babelHelpers.classPrivateFieldLooseKey("subscribeToFocusEvent");var V=babelHelpers.classPrivateFieldLooseKey("subscribeToBlurEvent");var _=babelHelpers.classPrivateFieldLooseKey("removeNativeNotifications");var J=babelHelpers.classPrivateFieldLooseKey("setInitialStatus");var G=babelHelpers.classPrivateFieldLooseKey("subscribeToStatusChange");class q{static init(){return new q}constructor(){Object.defineProperty(this,G,{value:oe});Object.defineProperty(this,J,{value:ie});Object.defineProperty(this,_,{value:se});Object.defineProperty(this,V,{value:te});Object.defineProperty(this,X,{value:ee});Object.defineProperty(this,U,{value:Z});Object.defineProperty(this,N,{value:Q});Object.defineProperty(this,R,{value:Y});Object.defineProperty(this,W,{value:z});babelHelpers.classPrivateFieldLooseBase(this,N)[N]();babelHelpers.classPrivateFieldLooseBase(this,X)[X]();babelHelpers.classPrivateFieldLooseBase(this,V)[V]();babelHelpers.classPrivateFieldLooseBase(this,W)[W]();babelHelpers.classPrivateFieldLooseBase(this,J)[J]();babelHelpers.classPrivateFieldLooseBase(this,G)[G]()}}function z(){k.DesktopApi.subscribe(v.EventType.desktop.onIconClick,babelHelpers.classPrivateFieldLooseBase(this,R)[R].bind(this))}function Y(){vt.getInstance().toggleConference()}function Q(){k.DesktopApi.subscribe(v.EventType.desktop.onUserAway,babelHelpers.classPrivateFieldLooseBase(this,U)[U].bind(this))}function Z(e){const t=e?v.RestMethod.imUserStatusIdleStart:v.RestMethod.imUserStatusIdleEnd;o.Core.getRestClient().callMethod(t).catch((e=>{console.error(`Desktop: error in ${t}  - ${e}`)}))}function ee(){b.Event.bind(window,"focus",babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this))}function te(){b.Event.bind(window,"blur",babelHelpers.classPrivateFieldLooseBase(this,_)[_].bind(this))}function se(){if(!b.Browser.isWin()||!k.DesktopApi.isChatWindow()){return}k.DesktopApi.removeNativeNotifications()}function ie(){const e=o.Core.getStore().getters["application/settings/get"](v.Settings.user.status);k.DesktopApi.setIconStatus(e)}function oe(){const e=(e,t)=>t["application/settings/get"](v.Settings.user.status);o.Core.getStore().watch(e,(e=>{k.DesktopApi.setIconStatus(e)}))}var ne=babelHelpers.classPrivateFieldLooseKey("store");var ae=babelHelpers.classPrivateFieldLooseKey("subscribeToCountersChange");var re=babelHelpers.classPrivateFieldLooseKey("onCounterChange");class le{static init(){return new le}constructor(){Object.defineProperty(this,re,{value:de});Object.defineProperty(this,ae,{value:ce});Object.defineProperty(this,ne,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]=o.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,re)[re]();babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]()}}function ce(){l.EventEmitter.subscribe(v.EventType.counter.onNotificationCounterChange,babelHelpers.classPrivateFieldLooseBase(this,re)[re].bind(this));l.EventEmitter.subscribe(v.EventType.counter.onChatCounterChange,babelHelpers.classPrivateFieldLooseBase(this,re)[re].bind(this))}function de(){const e=babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].getters["counters/getTotalChatCounter"];const t=babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].getters["notifications/getCounter"];const s=e>0;k.DesktopApi.setCounter(e+t,s)}var pe=babelHelpers.classPrivateFieldLooseKey("bindHotkeys");class be{static init(){return new be}constructor(){Object.defineProperty(this,pe,{value:ve});babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]()}}function ve(){b.Event.bind(window,"keydown",(e=>{const t=d.Utils.key.isCombination(e,"Ctrl+Shift+L");if(t){k.DesktopApi.openLogsFolder();p.Logger.desktop("NOTICE: User open log folder (hotkey)");return}const s=d.Utils.key.isCombination(e,"Ctrl+Shift+D");if(s){k.DesktopApi.openDeveloperTools();p.Logger.desktop("NOTICE: User open developer tools (hotkey)")}}))}var he=babelHelpers.classPrivateFieldLooseKey("subscribeToNewTabEvent");var ue=babelHelpers.classPrivateFieldLooseKey("onNewTabClick");class ke{static init(){return new ke}constructor(){Object.defineProperty(this,ue,{value:Le});Object.defineProperty(this,he,{value:ge});babelHelpers.classPrivateFieldLooseBase(this,he)[he]()}}function ge(){k.DesktopApi.subscribe(v.EventType.desktop.onNewTabClick,babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].bind(this))}function Le(){k.DesktopApi.createTab("/desktop/menu/")}const fe={init(){const e=k.DesktopApi.getSliderBindingsStatus();if(e){BX.SidePanel.Instance.enableAnchorBinding();return}BX.SidePanel.Instance.disableAnchorBinding()}};const Pe={async reloadChatInfo(){await r.LegacyRecentService.getInstance().requestItems({firstPage:true});const e=a.LayoutManager.getInstance().getLayout();if(e.entityId){await this.reopenChat(e)}},async reopenChat(e){a.LayoutManager.getInstance().clearCurrentLayoutEntityId();const t=new n.ChatService;await t.resetChat(e.entityId);void a.LayoutManager.getInstance().setLayout(e)}};var Be=babelHelpers.classPrivateFieldLooseKey("initDate");var ye=babelHelpers.classPrivateFieldLooseKey("wakeUpTimer");var De=babelHelpers.classPrivateFieldLooseKey("onWakeUp");class Ce{static init(){return new Ce}constructor(){Object.defineProperty(this,De,{value:me});Object.defineProperty(this,Be,{writable:true,value:void 0});Object.defineProperty(this,ye,{writable:true,value:null});this.sidePanelManager=BX.SidePanel.Instance;babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]=new Date;k.DesktopApi.subscribe(v.EventType.desktop.onWakeUp,babelHelpers.classPrivateFieldLooseBase(this,De)[De].bind(this))}}async function me(){const e=await D.testInternetConnection();if(!e){p.Logger.desktop("StatusHandler: onWakeUp event, no internet connection, delay 60 sec");clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]);babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,De)[De].bind(this),60*1e3);return}if(d.Utils.date.isSameHour(new Date,babelHelpers.classPrivateFieldLooseBase(this,Be)[Be])){p.Logger.desktop("StatusHandler: onWakeUp event, same hour - restart pull client");o.Core.getPullClient().restart()}else{if(this.sidePanelManager.opened){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]);babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,De)[De].bind(this),60*1e3);p.Logger.desktop("StatusHandler: onWakeUp event, slider is open, delay 60 sec");return}if(h.CallManager.getInstance().hasCurrentCall()){clearTimeout(babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]);babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]=setTimeout(babelHelpers.classPrivateFieldLooseBase(this,De)[De].bind(this),60*1e3);p.Logger.desktop("StatusHandler: onWakeUp event, call is active, delay 60 sec");return}if(!c.DesktopManager.getInstance().canReloadWindow()){await Pe.reloadChatInfo();return}p.Logger.desktop("StatusHandler: onWakeUp event, reload window");k.DesktopApi.reloadWindow()}}const we=60*60*1e3;var Fe=babelHelpers.classPrivateFieldLooseKey("initDate");var He=babelHelpers.classPrivateFieldLooseKey("sidePanelManager");var xe=babelHelpers.classPrivateFieldLooseKey("startReloadCheck");var Te=babelHelpers.classPrivateFieldLooseKey("isReloadNeeded");var Ie=babelHelpers.classPrivateFieldLooseKey("reloadWindow");var Ae=babelHelpers.classPrivateFieldLooseKey("subscribeToReloadEvent");class Ee{static init(){return new Ee}constructor(){Object.defineProperty(this,Ae,{value:$e});Object.defineProperty(this,Ie,{value:Se});Object.defineProperty(this,Te,{value:Oe});Object.defineProperty(this,xe,{value:Me});Object.defineProperty(this,Fe,{writable:true,value:void 0});Object.defineProperty(this,He,{writable:true,value:BX.SidePanel.Instance});babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=new Date;babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]();babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]()}}function Me(){setInterval((async()=>{const e=await babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]();if(!e){return}if(!c.DesktopManager.getInstance().canReloadWindow()){await Pe.reloadChatInfo();return}babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]()}),we)}async function Oe(){if(d.Utils.date.isSameDay(new Date,babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe])){return false}if(babelHelpers.classPrivateFieldLooseBase(this,He)[He].opened){p.Logger.desktop("Checker: checkDayForReload, slider is open - delay reload");return false}if(h.CallManager.getInstance().hasCurrentCall()){p.Logger.desktop("Checker: checkDayForReload, call is active - delay reload");return false}return D.testInternetConnection()}function Se(){p.Logger.desktop("Checker: checkDayForReload, new day - reload window");k.DesktopApi.reloadWindow()}function $e(){b.Event.bind(window,"beforeunload",(()=>{const e=new l.BaseEvent;l.EventEmitter.emit(window,v.EventType.desktop.onReload,e)}))}var je=babelHelpers.classPrivateFieldLooseKey("sendInitEvent");var Ke=babelHelpers.classPrivateFieldLooseKey("initComplete");var We=babelHelpers.classPrivateFieldLooseKey("subscribeOnErrorEvent");var Re=babelHelpers.classPrivateFieldLooseKey("handleInvalidAuthError");class Ne{static init(){return new Ne}constructor(){Object.defineProperty(this,Re,{value:_e});Object.defineProperty(this,We,{value:Ve});Object.defineProperty(this,Ke,{value:Xe});Object.defineProperty(this,je,{value:Ue});Ee.init();Ce.init();q.init();$.init();A.init();le.init();be.init();ke.init();fe.init();babelHelpers.classPrivateFieldLooseBase(this,je)[je]();babelHelpers.classPrivateFieldLooseBase(this,We)[We]();babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]()}}function Ue(){const{preloadedEntities:{legacyCurrentUser:e}}=o.Core.getApplicationData();k.DesktopApi.emit(v.EventType.desktop.onInit,[{userInfo:e}])}function Xe(){k.DesktopApi.setLogInfo=function(...e){p.Logger.desktop(...e)};window.BX.debugEnable(true);k.DesktopApi.printWelcomePrompt()}function Ve(){l.EventEmitter.subscribe(v.EventType.request.onAuthError,(()=>babelHelpers.classPrivateFieldLooseBase(this,Re)[Re]()))}function _e(){return k.DesktopApi.login()}var Je=babelHelpers.classPrivateFieldLooseKey("initComplete");class Ge{static init(){return new Ge}constructor(){Object.defineProperty(this,Je,{value:qe});Ee.init();Ce.init();be.init();fe.init();ke.init();babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]()}}function qe(){k.DesktopApi.setLogInfo=function(...e){p.Logger.desktop(...e)}}const ze="im-channel-desktop";var Ye=babelHelpers.classPrivateFieldLooseKey("actionHandlers");var Qe=babelHelpers.classPrivateFieldLooseKey("onNotifierClick");var Ze=babelHelpers.classPrivateFieldLooseKey("onAnswerButtonClick");var et=babelHelpers.classPrivateFieldLooseKey("handleBxLinkCommand");class tt{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(){tt.getInstance()}constructor(){Object.defineProperty(this,et,{value:ot});Object.defineProperty(this,Ze,{value:it});Object.defineProperty(this,Qe,{value:st});Object.defineProperty(this,Ye,{writable:true,value:{[v.DesktopBroadcastAction.notification]:babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe].bind(this),[v.DesktopBroadcastAction.answerButtonClick]:babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze].bind(this),[v.DesktopBroadcastAction.bxLink]:babelHelpers.classPrivateFieldLooseBase(this,et)[et].bind(this)}});this.initBroadcastHandler()}initBroadcastHandler(){this.channel=new BroadcastChannel(ze);if(k.DesktopApi.isChatWindow()){return}b.Event.bind(this.channel,"message",(e=>{const{data:t}=e;if(!k.DesktopApi.isActiveTab()){return}const s=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye][t.action];if(!s){return}s(t.params)}))}sendActionMessage(e){this.channel.postMessage(e)}}function st(e){u.MessageNotifierManager.getInstance().onNotifierClick(e)}function it(e){const{mediaParams:t,callParams:s}=e;h.CallManager.getInstance().onAnswerButtonClick(t,s)}function ot(e){x.handleCommand(e.command,e.rawParams)}const nt=2;const at=1e3;var rt=babelHelpers.classPrivateFieldLooseKey("desktopIsActive");var lt=babelHelpers.classPrivateFieldLooseKey("desktopActiveVersion");var ct=babelHelpers.classPrivateFieldLooseKey("locationChangedToBx");var dt=babelHelpers.classPrivateFieldLooseKey("enableRedirectCounter");var pt=babelHelpers.classPrivateFieldLooseKey("prepareBxUrl");var bt=babelHelpers.classPrivateFieldLooseKey("initDesktopStatus");class vt{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}static init(){vt.getInstance()}static isDesktop(){return k.DesktopApi.isDesktop()}static isChatWindow(){return k.DesktopApi.isChatWindow()}constructor(){Object.defineProperty(this,bt,{value:ut});Object.defineProperty(this,pt,{value:ht});Object.defineProperty(this,rt,{writable:true,value:void 0});Object.defineProperty(this,lt,{writable:true,value:void 0});Object.defineProperty(this,ct,{writable:true,value:false});Object.defineProperty(this,dt,{writable:true,value:1});babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]();if(!vt.isDesktop()){return}tt.init();if(k.DesktopApi.isChatWindow()){Ne.init()}else{Ge.init()}}isDesktopActive(){if(vt.isDesktop()){return true}return babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]}setDesktopActive(e){babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]=e}setDesktopVersion(e){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]=e}getDesktopVersion(){return babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]}isLocationChangedToBx(){return babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]}canReloadWindow(){return a.LayoutManager.getInstance().isEmbeddedMode()}redirectToChat(e="",t=0){p.Logger.warn("Desktop: redirectToChat",e);let s=`bx://${v.DesktopBxLink.chat}/dialogId/${e}`;if(t>0){s+=`/messageId/${t}`}this.openBxLink(s);return Promise.resolve()}redirectToChatWithBotContext(e="",t={}){p.Logger.warn("Desktop: redirectToChatWithBotContext",e);let s=`bx://${v.DesktopBxLink.botContext}/dialogId/${e}`;if(!b.Type.isPlainObject(t)){return Promise.reject()}const i=H.encodeParamsJson(t);s+=`/context/${i}`;this.openBxLink(s);return Promise.resolve()}redirectToLines(e=""){p.Logger.warn("Desktop: redirectToLines",e);this.openBxLink(`bx://${v.DesktopBxLink.lines}/dialogId/${e}`);return Promise.resolve()}redirectToCopilot(e=""){p.Logger.warn("Desktop: redirectToCopilot",e);this.openBxLink(`bx://${v.DesktopBxLink.copilot}/dialogId/${e}`);return Promise.resolve()}redirectToCollab(e=""){p.Logger.warn("Desktop: redirectToCollab",e);this.openBxLink(`bx://${v.DesktopBxLink.collab}/dialogId/${e}`);return Promise.resolve()}redirectToChannel(e=""){p.Logger.warn("Desktop: redirectToChannel",e);this.openBxLink(`bx://${v.DesktopBxLink.channel}/dialogId/${e}`);return Promise.resolve()}redirectToTaskComments(e="",t=0){p.Logger.warn("Desktop: redirectToTaskComments",e);let s=`bx://${v.DesktopBxLink.taskComments}/dialogId/${e}`;if(t>0){s+=`/messageId/${t}`}this.openBxLink(s);return Promise.resolve()}redirectToNotifications(){p.Logger.warn("Desktop: redirectToNotifications");this.openBxLink(`bx://${v.DesktopBxLink.notifications}`);return Promise.resolve()}redirectToRecentSearch(){p.Logger.warn("Desktop: redirectToRecentSearch");this.openBxLink(`bx://${v.DesktopBxLink.recentSearch}`);return Promise.resolve()}redirectToConference(e){p.Logger.warn("Desktop: redirectToConference",e);this.openBxLink(`bx://${v.DesktopBxLink.conference}/code/${e}`);return Promise.resolve()}redirectToSettings(e){p.Logger.warn("Desktop: redirectToSettings",e);this.openBxLink(`bx://${v.DesktopBxLink.settings}/section/${e}`);return Promise.resolve()}openConference(e){p.Logger.warn("Desktop: openConference",e);const t=w.openConference(e);if(!t){return Promise.resolve(false)}return Promise.resolve(true)}toggleConference(){p.Logger.warn("Desktop: toggleConference");w.toggleConference()}redirectToChatCreation(e){p.Logger.warn("Desktop: redirectToChatCreation",e);this.openBxLink(`bx://${v.DesktopBxLink.chatCreation}/chatType/${e}/`);return Promise.resolve()}redirectToVideoCall(e="",t=true){p.Logger.warn("Desktop: redirectToVideoCall",e,t);const s=t?"Y":"N";this.openBxLink(`bx://${v.DesktopBxLink.call}/dialogId/${e}/withVideo/${s}`);return Promise.resolve()}redirectToPhoneCall(e,t){p.Logger.warn("Desktop: redirectToPhoneCall",e,t);const s=H.encodeParamsJson(t);this.openBxLink(`bx://${v.DesktopBxLink.phone}/number/${e}/phoneParams/${s}`);return Promise.resolve()}redirectToCallList(e,t){p.Logger.warn("Desktop: redirectToCallList",e,t);const s=H.encodeParamsJson(t);this.openBxLink(`bx://${v.DesktopBxLink.callList}/callListId/${e}/callListParams/${s}`);return Promise.resolve()}openAccountTab(e){this.openBxLink(`bx://v2/${e}/${v.DesktopBxLink.openTab}`)}openPage(e,t={}){const s=H.encodeParamsJson({url:e,options:t});this.openBxLink(`bx://${v.DesktopBxLink.openPage}/options/${s}`)}redirectToLayout({id:e,entityId:t}){p.Logger.warn("Desktop: redirectToLayout",e,t);const s=t!=null?t:"";this.openBxLink(`bx://${v.DesktopBxLink.openLayout}/id/${e}/entityId/${s}`);return Promise.resolve()}async checkStatusInDifferentContext(){if(!this.isDesktopActive()){return false}if(k.DesktopApi.isChatWindow()){return false}if(k.DesktopApi.isDesktop()&&!k.DesktopApi.isChatWindow()){return true}return D.testImageLoad()}checkForRedirect(){if(!this.isRedirectEnabled()||!this.isRedirectOptionEnabled()){return Promise.resolve(false)}return this.checkStatusInDifferentContext()}async checkForOpenBrowserPage(){await o.Core.ready();if(!this.isDesktopActive()||!this.isRedirectOptionEnabled()){return false}const e=this.getDesktopVersion();if(!k.DesktopApi.isFeatureSupportedInVersion(e,k.DesktopFeature.openPage.id)){return false}return D.testImageLoad(D.IMAGE_DESKTOP_TWO_WINDOW_MODE)}isRedirectEnabled(){return babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]>0}enableRedirect(){babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]++}disableRedirect(){babelHelpers.classPrivateFieldLooseBase(this,dt)[dt]--}isRedirectOptionEnabled(){if(!t.FeatureManager.isFeatureAvailable(t.Feature.isDesktopRedirectAvailable)){return false}if(k.DesktopApi.isDesktop()&&!k.DesktopApi.isChatWindow()){return true}return o.Core.getStore().getters["application/settings/get"](v.Settings.desktop.enableRedirect)}openBxLink(e){const t=babelHelpers.classPrivateFieldLooseBase(this,pt)[pt](e);babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]=true;setTimeout((()=>{const e=new l.BaseEvent({compatData:[]});l.EventEmitter.emit(window,"BXLinkOpened",e);babelHelpers.classPrivateFieldLooseBase(this,ct)[ct]=false}),at);location.href=t}}function ht(e){if(/^bx:\/\/v(\d)\//.test(e)){return e}return e.replace("bx://",`bx://v${nt}/${location.hostname}/`)}function ut(){const e=b.Extension.getSettings("im.v2.lib.desktop");this.setDesktopActive(e.get("desktopIsActive"));this.setDesktopVersion(e.get("desktopActiveVersion"))}e.DesktopManager=vt;e.DesktopBroadcastManager=tt})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=desktop-manager.bundle.map.js