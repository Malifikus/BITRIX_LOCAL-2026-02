this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,i,r,n,l,o,c,d,b,v){"use strict";const u=Object.freeze({handled:"handled",ignored:"ignored"});var p=babelHelpers.classPrivateFieldLooseKey("messengerContainer");var h=babelHelpers.classPrivateFieldLooseKey("emitter");var y=babelHelpers.classPrivateFieldLooseKey("wasKeyDownHandled");var P=babelHelpers.classPrivateFieldLooseKey("instance");var L=babelHelpers.classPrivateFieldLooseKey("shouldIgnoreEscape");var f=babelHelpers.classPrivateFieldLooseKey("isHandledBySubscriber");var g=babelHelpers.classPrivateFieldLooseKey("handleActiveInput");var B=babelHelpers.classPrivateFieldLooseKey("handleLayoutClear");var H=babelHelpers.classPrivateFieldLooseKey("handleMessengerSliderClose");var F=babelHelpers.classPrivateFieldLooseKey("handleDesktopAction");var E=babelHelpers.classPrivateFieldLooseKey("onKeyUp");var m=babelHelpers.classPrivateFieldLooseKey("onKeyDown");var M=babelHelpers.classPrivateFieldLooseKey("switchToChatLayout");var w=babelHelpers.classPrivateFieldLooseKey("isExternalSliderOpened");var X=babelHelpers.classPrivateFieldLooseKey("handleChannelComments");class O{constructor(){Object.defineProperty(this,X,{value:x});Object.defineProperty(this,w,{value:T});Object.defineProperty(this,M,{value:U});Object.defineProperty(this,m,{value:A});Object.defineProperty(this,E,{value:D});Object.defineProperty(this,F,{value:S});Object.defineProperty(this,H,{value:I});Object.defineProperty(this,B,{value:j});Object.defineProperty(this,g,{value:k});Object.defineProperty(this,f,{value:K});Object.defineProperty(this,L,{value:C});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:false});this.keyUpEventHandler=babelHelpers.classPrivateFieldLooseBase(this,E)[E].bind(this);this.keyDownEventHandler=babelHelpers.classPrivateFieldLooseBase(this,m)[m].bind(this)}static getInstance(){var e;babelHelpers.classPrivateFieldLooseBase(O,P)[P]=(e=babelHelpers.classPrivateFieldLooseBase(O,P)[P])!=null?e:new O;return babelHelpers.classPrivateFieldLooseBase(O,P)[P]}register(e){const{messengerContainer:t,context:{emitter:a}}=e;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=a;babelHelpers.classPrivateFieldLooseBase(this,p)[p]=t;s.Event.bind(document,"keyup",this.keyUpEventHandler);s.Event.bind(document,"keydown",this.keyDownEventHandler)}unregister(){s.Event.unbind(document,"keyup",this.keyUpEventHandler);s.Event.unbind(document,"keydown",this.keyDownEventHandler)}async handleEsc(){if(babelHelpers.classPrivateFieldLooseBase(this,y)[y]){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=false;return}if(babelHelpers.classPrivateFieldLooseBase(this,L)[L]()){return}if(await babelHelpers.classPrivateFieldLooseBase(this,f)[f]()){return}if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]()){return}if(babelHelpers.classPrivateFieldLooseBase(this,X)[X]()){return}if(babelHelpers.classPrivateFieldLooseBase(this,B)[B]()){return}if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]()){return}babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}}function C(){const e=n.CallManager.getInstance().hasVisibleCall();const s=a.PopupWindowManager.isAnyPopupShown();return e||s||babelHelpers.classPrivateFieldLooseBase(this,w)[w]()}async function K(){const e=await babelHelpers.classPrivateFieldLooseBase(this,h)[h].emitAsync(o.EventType.key.onBeforeEscape);const s=await t.EventEmitter.emitAsync(o.EventType.key.onBeforeEscape);const a=[...e,...s];return a.includes(u.handled)}function k(){const{activeElement:e}=document;if(!e){return false}const s=babelHelpers.classPrivateFieldLooseBase(this,p)[p].contains(e);const t=e.matches("input");if(s&&t){e.blur();return true}return false}function j(){const e=c.LayoutManager.getInstance();const s=e.getLayout();const t=e.isChatLayout(s.name);const a=t&&s.entityId==="";if(a){return false}if(t){e.clearCurrentLayoutEntityId()}else{babelHelpers.classPrivateFieldLooseBase(this,M)[M]()}return true}function I(){const e=d.MessengerSlider.getInstance();if(e.getCurrent()&&e.isFocused()){e.getCurrent().close();return true}return false}function S(){if(!b.DesktopManager.isDesktop()){return false}v.DesktopApi.hideWindow();return true}function D(e){if(!r.Utils.key.isCombination(e,"Escape")){return}void this.handleEsc()}function A(){babelHelpers.classPrivateFieldLooseBase(this,y)[y]=BX.UI.Viewer.Instance.isOpen()}function U(){void c.LayoutManager.getInstance().setLayout({name:o.Layout.chat,entityId:""})}function T(){const e=c.LayoutManager.getInstance().isEmbeddedMode();if(e){return i.SidePanel.Instance.getOpenSlidersCount()>0}return!d.MessengerSlider.getInstance().isFocused()}function x(){const e=l.Core.getStore().getters["messages/comments/areOpened"];if(e){babelHelpers.classPrivateFieldLooseBase(this,h)[h].emit(o.EventType.dialog.closeComments)}return e}Object.defineProperty(O,P,{writable:true,value:void 0});e.EscEventAction=u;e.EscManager=O})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Event,BX.Main,BX.SidePanel,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=esc-manager.bundle.map.js