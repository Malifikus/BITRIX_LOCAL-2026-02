{"version":3,"file":"message-notifier.bundle.js","sources":["../src/classes/notification-id.js","../src/classes/message-options-builder.js","../src/message-notifier.js"],"sourcesContent":["type MessageIdPrefix = typeof NotificationIdPrefix.chat\n\t| typeof NotificationIdPrefix.lines\n\t| typeof NotificationIdPrefix.taskComments;\n\ntype MessageIdPayload = {\n\tprefix: MessageIdPrefix,\n\tdialogId: string,\n\tmessageId: string,\n};\n\ntype NotifyIdPayload = {\n\tprefix: typeof NotificationIdPrefix.notify,\n\tnotifyId: string,\n};\n\ntype NotificationIdPayload = MessageIdPayload | NotifyIdPayload;\n\nexport const NotificationIdPrefix = {\n\tchat: 'im_chat',\n\ttaskComments: 'im_task_comments',\n\tlines: 'im_lines',\n\tnotify: 'im_notify',\n};\n\nconst ID_SEPARATOR = '-';\n\nexport const NotificationId = {\n\tbuild(payload: NotificationIdPayload): string\n\t{\n\t\tconst { prefix } = payload;\n\t\tif (prefix === NotificationIdPrefix.notify)\n\t\t{\n\t\t\tconst { notifyId } = payload;\n\n\t\t\treturn `${prefix}${ID_SEPARATOR}${notifyId}`;\n\t\t}\n\n\t\tconst { dialogId, messageId } = payload;\n\n\t\treturn `${prefix}${ID_SEPARATOR}${dialogId}${ID_SEPARATOR}${messageId}`;\n\t},\n\n\tparse(notificationId: string): NotificationIdPayload\n\t{\n\t\tconst parts = notificationId.split(ID_SEPARATOR);\n\t\tconst [prefix] = parts;\n\n\t\tif (prefix === NotificationIdPrefix.notify)\n\t\t{\n\t\t\tconst [, notifyId] = parts;\n\n\t\t\treturn { prefix, notifyId };\n\t\t}\n\n\t\tconst [, dialogId, messageId] = parts;\n\n\t\treturn { prefix, dialogId, messageId };\n\t},\n};\n","import { ChatType } from 'im.v2.const';\nimport { Parser } from 'im.v2.lib.parser';\n\nimport { NotificationId, NotificationIdPrefix } from './notification-id';\n\nimport type { ImModelUser, ImModelChat, ImModelMessage } from 'im.v2.model';\n\ntype MessageContext = {\n\tmessage: ImModelMessage,\n\tchat: ImModelChat,\n\tuser: ImModelUser,\n\tisLines: boolean,\n};\n\ntype MessageNotificationOptions = {\n\tid: string,\n\ttitle: string,\n\ticon: string,\n\ttext: string,\n};\n\ntype PrefixMapItem = {\n\tcondition: () => boolean,\n\tprefix: $Values<typeof NotificationIdPrefix>,\n};\n\nexport class MessageOptionsBuilder\n{\n\t#message: ImModelMessage;\n\t#chat: ImModelChat;\n\t#user: ?ImModelUser;\n\t#isLines: boolean;\n\n\tconstructor(context: MessageContext)\n\t{\n\t\tconst { message, chat, user, isLines } = context;\n\n\t\tthis.#message = message;\n\t\tthis.#chat = chat;\n\t\tthis.#user = user;\n\t\tthis.#isLines = isLines;\n\t}\n\n\tbuild(): MessageNotificationOptions\n\t{\n\t\treturn {\n\t\t\tid: this.#getId(),\n\t\t\ttitle: this.#chat.name,\n\t\t\ticon: this.#getAvatarUrl(),\n\t\t\ttext: this.#getText(),\n\t\t};\n\t}\n\n\t#getId(): string\n\t{\n\t\tconst prefixMap: PrefixMapItem[] = [\n\t\t\t{\n\t\t\t\tcondition: () => this.#isLines,\n\t\t\t\tprefix: NotificationIdPrefix.lines,\n\t\t\t},\n\t\t\t{\n\t\t\t\tcondition: () => this.#chat.type === ChatType.taskComments,\n\t\t\t\tprefix: NotificationIdPrefix.taskComments,\n\t\t\t},\n\t\t];\n\n\t\tlet prefix = NotificationIdPrefix.chat;\n\t\tconst foundItem = prefixMap.find((record: PrefixMapItem) => record.condition() === true);\n\t\tif (foundItem)\n\t\t{\n\t\t\tprefix = foundItem.prefix;\n\t\t}\n\n\t\treturn NotificationId.build({\n\t\t\tprefix,\n\t\t\tdialogId: this.#chat.dialogId,\n\t\t\tmessageId: this.#message.id,\n\t\t});\n\t}\n\n\t#getAvatarUrl(): string\n\t{\n\t\treturn this.#chat.avatar || this.#user?.avatar;\n\t}\n\n\t#getText(): string\n\t{\n\t\tlet text = '';\n\t\tif (this.#chat.type !== ChatType.user && this.#user)\n\t\t{\n\t\t\ttext += `${this.#user.name}: `;\n\t\t}\n\n\t\ttext += Parser.purifyMessage(this.#message);\n\n\t\treturn text;\n\t}\n}\n","import { Loc } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Store } from 'ui.vue3.vuex';\nimport { Notifier, NotificationOptions } from 'ui.notification-manager';\n\nimport { Messenger } from 'im.public';\nimport { SoundNotificationManager } from 'im.v2.lib.sound-notification';\nimport { Core } from 'im.v2.application.core';\nimport { Parser } from 'im.v2.lib.parser';\nimport { DesktopManager, DesktopBroadcastManager } from 'im.v2.lib.desktop';\nimport { DesktopApi, DesktopFeature } from 'im.v2.lib.desktop-api';\nimport { NotificationTypesCodes, SoundType, EventType, ChatType, DesktopBroadcastAction } from 'im.v2.const';\nimport { NotificationService } from 'im.v2.provider.service.notification';\n\nimport { NotificationId, NotificationIdPrefix } from './classes/notification-id';\n\nimport { MessageOptionsBuilder } from './classes/message-options-builder';\n\nimport type {\n\tImModelUser,\n\tImModelNotification,\n\tImModelNotificationButton,\n} from 'im.v2.model';\n\nexport type NotifierClickParams = {\n\tid: string // 'im-notify_2558' | 'im-chat_1_2565'\n};\n\ntype NotifierActionParams = {\n\taction: string, // 'button_1'\n\tid: string, // 'im-notify-2561'\n\tuserInput?: string\n};\n\ntype MessageNotificationParams = {\n\tmessageId: number,\n\tdialogId: string,\n\tisLines: boolean,\n\tisImportant: boolean\n}\n\nconst ACTION_BUTTON_PREFIX = 'button_';\nconst ButtonNumber = {\n\tfirst: '1',\n\tsecond: '2',\n};\n\nexport const NotifierShowMessageAction = {\n\tskip: 'skip',\n\tshow: 'show',\n};\n\nexport class MessageNotifierManager\n{\n\tstatic #instance: MessageNotifierManager;\n\n\t#store: Store;\n\t#notificationService: NotificationService;\n\n\tstatic getInstance(): MessageNotifierManager\n\t{\n\t\tif (!this.#instance)\n\t\t{\n\t\t\tthis.#instance = new this();\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n\n\tstatic init()\n\t{\n\t\tMessageNotifierManager.getInstance();\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#notificationService = new NotificationService();\n\n\t\tthis.#subscribeToNotifierEvents();\n\t}\n\n\tasync handleIncomingMessage(params: MessageNotificationParams)\n\t{\n\t\tconst { isImportant, dialogId } = params;\n\n\t\tif (await this.#shouldSkipNotification(dialogId))\n\t\t{\n\t\t\tthis.#playOpenedChatMessageSound(isImportant);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#playMessageSound(isImportant);\n\t\tthis.#flashDesktopIcon();\n\n\t\tMessageNotifierManager.getInstance().showMessage(params);\n\t}\n\n\thandleIncomingNotification(params: {notificationId: number, userId: number, isSilent: boolean })\n\t{\n\t\tconst { notificationId, userId, isSilent } = params;\n\n\t\tconst notification = this.#store.getters['notifications/getById'](notificationId);\n\t\tconst user = this.#store.getters['users/get'](userId);\n\n\t\tif (!isSilent)\n\t\t{\n\t\t\tSoundNotificationManager.getInstance().playOnce(SoundType.reminder);\n\t\t}\n\n\t\tthis.#flashDesktopIcon();\n\n\t\tMessageNotifierManager.getInstance().showNotification(notification, user);\n\t}\n\n\tshowMessage(params: MessageNotificationParams)\n\t{\n\t\tconst { messageId, dialogId, isLines } = params;\n\t\tconst message = this.#store.getters['messages/getById'](messageId);\n\t\tconst chat = this.#store.getters['chats/get'](dialogId, true);\n\t\tconst user = this.#store.getters['users/get'](message.authorId);\n\n\t\tconst builder = new MessageOptionsBuilder({ message, chat, user, isLines });\n\t\tconst notificationOptions = builder.build();\n\n\t\tconst isDesktopFocused: boolean = DesktopManager.isChatWindow() && document.hasFocus();\n\t\tif (isDesktopFocused)\n\t\t{\n\t\t\tNotifier.notifyViaBrowserProvider(notificationOptions);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tNotifier.notify(notificationOptions);\n\t\t}\n\t}\n\n\tshowNotification(notification: ImModelNotification, user?: ImModelUser)\n\t{\n\t\tlet title = Loc.getMessage('IM_LIB_NOTIFIER_NOTIFY_SYSTEM_TITLE');\n\t\tif (notification.title)\n\t\t{\n\t\t\ttitle = notification.title;\n\t\t}\n\t\telse if (user)\n\t\t{\n\t\t\ttitle = user.name;\n\t\t}\n\n\t\tconst notificationOptions = this.#prepareNotificationOptions(title, notification, user);\n\n\t\tconst isDesktopFocused: boolean = DesktopManager.isChatWindow() && document.hasFocus();\n\t\tif (isDesktopFocused)\n\t\t{\n\t\t\tNotifier.notifyViaBrowserProvider(notificationOptions);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tNotifier.notify(notificationOptions);\n\t\t}\n\t}\n\n\tonNotifierClick(params: NotifierClickParams)\n\t{\n\t\tconst { id } = params;\n\n\t\tconst { prefix, dialogId } = NotificationId.parse(id);\n\t\tif (prefix === NotificationIdPrefix.chat)\n\t\t{\n\t\t\tvoid Messenger.openChat(dialogId);\n\t\t}\n\t\telse if (prefix === NotificationIdPrefix.taskComments)\n\t\t{\n\t\t\tvoid Messenger.openTaskComments(dialogId);\n\t\t}\n\t\telse if (prefix === NotificationIdPrefix.lines)\n\t\t{\n\t\t\tvoid Messenger.openLines(dialogId);\n\t\t}\n\t\telse if (prefix === NotificationIdPrefix.notify)\n\t\t{\n\t\t\tvoid Messenger.openNotifications();\n\t\t}\n\t}\n\n\t#prepareNotificationOptions(\n\t\ttitle: string,\n\t\tnotification: ImModelNotification,\n\t\tuser?: ImModelUser,\n\t): NotificationOptions\n\t{\n\t\tconst id = NotificationId.build({\n\t\t\tprefix: NotificationIdPrefix.notify,\n\t\t\tnotifyId: notification.id,\n\t\t});\n\n\t\tconst notificationOptions = {\n\t\t\tid,\n\t\t\ttitle,\n\t\t\ticon: user ? user.avatar : '',\n\t\t\ttext: Parser.purifyNotification(notification),\n\t\t};\n\n\t\tif (notification.sectionCode === NotificationTypesCodes.confirm)\n\t\t{\n\t\t\tconst [firstButton, secondButton] = notification.notifyButtons;\n\t\t\tnotificationOptions.button1Text = firstButton.TEXT;\n\t\t\tnotificationOptions.button2Text = secondButton.TEXT;\n\t\t}\n\t\telse if (notification.params?.canAnswer === 'Y')\n\t\t{\n\t\t\tnotificationOptions.inputPlaceholderText = Loc.getMessage('IM_LIB_NOTIFIER_NOTIFY_REPLY_PLACEHOLDER');\n\t\t}\n\n\t\treturn notificationOptions;\n\t}\n\n\t#subscribeToNotifierEvents()\n\t{\n\t\tNotifier.subscribe('click', async (event: BaseEvent<NotifierClickParams>) => {\n\t\t\tif (!DesktopApi.isDesktop())\n\t\t\t{\n\t\t\t\tthis.onNotifierClick(event.getData());\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait DesktopApi.showBrowserWindow();\n\n\t\t\tif (DesktopApi.isFeatureSupported(DesktopFeature.portalTabActivation.id))\n\t\t\t{\n\t\t\t\tawait DesktopApi.handlePortalTabActivation();\n\t\t\t}\n\n\t\t\tDesktopBroadcastManager.getInstance().sendActionMessage({\n\t\t\t\taction: DesktopBroadcastAction.notification,\n\t\t\t\tparams: event.getData(),\n\t\t\t});\n\t\t});\n\n\t\tNotifier.subscribe('action', (event: BaseEvent<NotifierActionParams>) => {\n\t\t\tthis.#onNotifierAction(event.getData());\n\t\t});\n\t}\n\n\t#onNotifierAction(params: NotifierActionParams)\n\t{\n\t\tconst { id, action, userInput } = params;\n\n\t\tconst { prefix, notifyId } = NotificationId.parse(id);\n\t\tif (prefix !== NotificationIdPrefix.notify)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst notification = this.#store.getters['notifications/getById'](notifyId);\n\t\tif (userInput)\n\t\t{\n\t\t\tthis.#onNotifierQuickAnswer(notification, userInput);\n\t\t}\n\t\telse if (this.#isConfirmButtonAction(action, notification))\n\t\t{\n\t\t\tthis.#onNotifierButtonClick(action, notification);\n\t\t}\n\t}\n\n\t#onNotifierQuickAnswer(notification: ImModelNotification, text: string)\n\t{\n\t\tthis.#notificationService.sendQuickAnswer({\n\t\t\tid: notification.id,\n\t\t\ttext,\n\t\t});\n\t}\n\n\t#onNotifierButtonClick(action: string, notification: ImModelNotification)\n\t{\n\t\tconst [firstButton, secondButton] = notification.notifyButtons;\n\t\tconst actionButtonNumber = this.#extractButtonNumber(action);\n\t\tif (actionButtonNumber === ButtonNumber.first)\n\t\t{\n\t\t\tthis.#sendButtonAction(notification, firstButton);\n\t\t}\n\t\telse if (actionButtonNumber === ButtonNumber.second)\n\t\t{\n\t\t\tthis.#sendButtonAction(notification, secondButton);\n\t\t}\n\t}\n\n\t#sendButtonAction(notification: ImModelNotification, button: ImModelNotificationButton)\n\t{\n\t\tconst [notificationId, value] = this.#extractButtonParams(button);\n\n\t\tthis.#notificationService.sendConfirmAction(notificationId, value);\n\t}\n\n\t#isConfirmButtonAction(action: string, notification: ImModelNotification): boolean\n\t{\n\t\tconst notificationType = notification.sectionCode;\n\n\t\treturn action.startsWith(ACTION_BUTTON_PREFIX) && notificationType === NotificationTypesCodes.confirm;\n\t}\n\n\t#extractButtonNumber(action: string): string\n\t{\n\t\t// 'button_1'\n\t\treturn action.split('_')[1];\n\t}\n\n\t#extractButtonParams(button: ImModelNotificationButton): string[]\n\t{\n\t\t// '2568|Y'\n\t\treturn button.COMMAND_PARAMS.split('|');\n\t}\n\n\t#isChatOpened(dialogId: string): boolean\n\t{\n\t\tconst isChatOpen = this.#store.getters['application/isChatOpen'](dialogId);\n\n\t\treturn Boolean(document.hasFocus() && isChatOpen);\n\t}\n\n\t#playOpenedChatMessageSound(isImportant: boolean)\n\t{\n\t\tif (isImportant)\n\t\t{\n\t\t\tSoundNotificationManager.getInstance().forcePlayOnce(SoundType.newMessage2);\n\n\t\t\treturn;\n\t\t}\n\n\t\tSoundNotificationManager.getInstance().playOnce(SoundType.newMessage2);\n\t}\n\n\t#playMessageSound(isImportant: boolean)\n\t{\n\t\tif (isImportant)\n\t\t{\n\t\t\tSoundNotificationManager.getInstance().forcePlayOnce(SoundType.newMessage1);\n\n\t\t\treturn;\n\t\t}\n\n\t\tSoundNotificationManager.getInstance().playOnce(SoundType.newMessage1);\n\t}\n\n\t#flashDesktopIcon()\n\t{\n\t\tif (!DesktopManager.isDesktop())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDesktopApi.flashIcon();\n\t}\n\n\tasync #shouldSkipNotification(dialogId: string): Promise<boolean>\n\t{\n\t\tif (this.#isChatOpened(dialogId))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst eventResult = await EventEmitter.emitAsync(EventType.notifier.onBeforeShowMessage, { dialogId });\n\n\t\treturn eventResult.includes(NotifierShowMessageAction.skip);\n\t}\n}\n"],"names":["NotificationIdPrefix","chat","taskComments","lines","notify","ID_SEPARATOR","NotificationId","build","payload","prefix","notifyId","dialogId","messageId","parse","notificationId","parts","split","MessageOptionsBuilder","constructor","context","message","user","isLines","id","title","name","icon","text","prefixMap","condition","type","ChatType","foundItem","find","record","avatar","Parser","purifyMessage","ACTION_BUTTON_PREFIX","ButtonNumber","first","second","NotifierShowMessageAction","skip","show","MessageNotifierManager","getInstance","init","Core","getStore","NotificationService","handleIncomingMessage","params","isImportant","showMessage","handleIncomingNotification","userId","isSilent","notification","getters","SoundNotificationManager","playOnce","SoundType","reminder","showNotification","authorId","builder","notificationOptions","isDesktopFocused","DesktopManager","isChatWindow","document","hasFocus","Notifier","notifyViaBrowserProvider","Loc","getMessage","onNotifierClick","Messenger","openChat","openTaskComments","openLines","openNotifications","purifyNotification","sectionCode","NotificationTypesCodes","confirm","firstButton","secondButton","notifyButtons","button1Text","TEXT","button2Text","canAnswer","inputPlaceholderText","subscribe","event","DesktopApi","isDesktop","getData","showBrowserWindow","isFeatureSupported","DesktopFeature","portalTabActivation","handlePortalTabActivation","DesktopBroadcastManager","sendActionMessage","action","DesktopBroadcastAction","userInput","sendQuickAnswer","actionButtonNumber","button","value","sendConfirmAction","notificationType","startsWith","COMMAND_PARAMS","isChatOpen","Boolean","forcePlayOnce","newMessage2","newMessage1","flashIcon","eventResult","EventEmitter","emitAsync","EventType","notifier","onBeforeShowMessage","includes"],"mappings":";;;;;;;CAiBO,MAAMA,oBAAoB,GAAG;GACnCC,IAAI,EAAE,SAAS;GACfC,YAAY,EAAE,kBAAkB;GAChCC,KAAK,EAAE,UAAU;GACjBC,MAAM,EAAE;CACT,CAAC;CAED,MAAMC,YAAY,GAAG,GAAG;AAExB,CAAO,MAAMC,cAAc,GAAG;GAC7BC,KAAK,CAACC,OAA8B,EACpC;KACC,MAAM;OAAEC;MAAQ,GAAGD,OAAO;KAC1B,IAAIC,MAAM,KAAKT,oBAAoB,CAACI,MAAM,EAC1C;OACC,MAAM;SAAEM;QAAU,GAAGF,OAAO;OAE5B,OAAQ,GAAEC,MAAO,GAAEJ,YAAa,GAAEK,QAAS,EAAC;;KAG7C,MAAM;OAAEC,QAAQ;OAAEC;MAAW,GAAGJ,OAAO;KAEvC,OAAQ,GAAEC,MAAO,GAAEJ,YAAa,GAAEM,QAAS,GAAEN,YAAa,GAAEO,SAAU,EAAC;IACvE;GAEDC,KAAK,CAACC,cAAsB,EAC5B;KACC,MAAMC,KAAK,GAAGD,cAAc,CAACE,KAAK,CAACX,YAAY,CAAC;KAChD,MAAM,CAACI,MAAM,CAAC,GAAGM,KAAK;KAEtB,IAAIN,MAAM,KAAKT,oBAAoB,CAACI,MAAM,EAC1C;OACC,MAAM,GAAGM,QAAQ,CAAC,GAAGK,KAAK;OAE1B,OAAO;SAAEN,MAAM;SAAEC;QAAU;;KAG5B,MAAM,GAAGC,QAAQ,EAAEC,SAAS,CAAC,GAAGG,KAAK;KAErC,OAAO;OAAEN,MAAM;OAAEE,QAAQ;OAAEC;MAAW;;CAExC,CAAC;;CCvDwE;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAuBzE,CAAO,MAAMK,qBAAqB,CAClC;GAMCC,WAAW,CAACC,OAAuB,EACnC;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,MAAM;OAAEC,OAAO;OAAEnB,IAAI;OAAEoB,IAAI;OAAEC;MAAS,GAAGH,OAAO;KAEhD,4CAAI,wBAAYC,OAAO;KACvB,4CAAI,kBAASnB,IAAI;KACjB,4CAAI,kBAASoB,IAAI;KACjB,4CAAI,wBAAYC,OAAO;;GAGxBf,KAAK,GACL;KACC,OAAO;OACNgB,EAAE,0CAAE,IAAI,mBAAS;OACjBC,KAAK,EAAE,4CAAI,gBAAOC,IAAI;OACtBC,IAAI,0CAAE,IAAI,iCAAgB;OAC1BC,IAAI,0CAAE,IAAI;MACV;;CA+CH;CAAC,mBA3CA;GACC,MAAMC,SAA0B,GAAG,CAClC;KACCC,SAAS,EAAE,8CAAM,IAAI,qBAAS;KAC9BpB,MAAM,EAAET,oBAAoB,CAACG;IAC7B,EACD;KACC0B,SAAS,EAAE,MAAM,4CAAI,gBAAOC,IAAI,KAAKC,oBAAQ,CAAC7B,YAAY;KAC1DO,MAAM,EAAET,oBAAoB,CAACE;IAC7B,CACD;GAED,IAAIO,MAAM,GAAGT,oBAAoB,CAACC,IAAI;GACtC,MAAM+B,SAAS,GAAGJ,SAAS,CAACK,IAAI,CAAEC,MAAqB,IAAKA,MAAM,CAACL,SAAS,EAAE,KAAK,IAAI,CAAC;GACxF,IAAIG,SAAS,EACb;KACCvB,MAAM,GAAGuB,SAAS,CAACvB,MAAM;;GAG1B,OAAOH,cAAc,CAACC,KAAK,CAAC;KAC3BE,MAAM;KACNE,QAAQ,EAAE,4CAAI,gBAAOA,QAAQ;KAC7BC,SAAS,EAAE,4CAAI,sBAAUW;IACzB,CAAC;CACH;CAAC,0BAGD;GAAA;GACC,OAAO,4CAAI,gBAAOY,MAAM,sEAAI,IAAI,oCAAJ,sBAAYA,MAAM;CAC/C;CAAC,qBAGD;GACC,IAAIR,IAAI,GAAG,EAAE;GACb,IAAI,4CAAI,gBAAOG,IAAI,KAAKC,oBAAQ,CAACV,IAAI,4CAAI,IAAI,eAAM,EACnD;KACCM,IAAI,IAAK,GAAE,4CAAI,gBAAOF,IAAK,IAAG;;GAG/BE,IAAI,IAAIS,uBAAM,CAACC,aAAa,yCAAC,IAAI,sBAAU;GAE3C,OAAOV,IAAI;CACZ;;CCvDD,MAAMW,oBAAoB,GAAG,SAAS;CACtC,MAAMC,YAAY,GAAG;GACpBC,KAAK,EAAE,GAAG;GACVC,MAAM,EAAE;CACT,CAAC;AAED,OAAaC,yBAAyB,GAAG;GACxCC,IAAI,EAAE,MAAM;GACZC,IAAI,EAAE;CACP,CAAC;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAEF,CAAO,MAAMC,sBAAsB,CACnC;GAMC,OAAOC,WAAW,GAClB;KACC,IAAI,yCAAC,IAAI,uBAAU,EACnB;OACC,4CAAI,0BAAa,IAAI,IAAI,EAAE;;KAG5B,+CAAO,IAAI;;GAGZ,OAAOC,IAAI,GACX;KACCF,sBAAsB,CAACC,WAAW,EAAE;;GAGrC5B,WAAW,GACX;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KACC,4CAAI,oBAAU8B,2BAAI,CAACC,QAAQ,EAAE;KAC7B,4CAAI,gDAAwB,IAAIC,uDAAmB,EAAE;KAErD,4CAAI;;GAGL,MAAMC,qBAAqB,CAACC,MAAiC,EAC7D;KACC,MAAM;OAAEC,WAAW;OAAE1C;MAAU,GAAGyC,MAAM;KAExC,IAAI,8CAAM,IAAI,oDAAyBzC,QAAQ,CAAC,EAChD;OACC,4CAAI,4DAA6B0C,WAAW;OAE5C;;KAGD,4CAAI,wCAAmBA,WAAW;KAClC,4CAAI;KAEJR,sBAAsB,CAACC,WAAW,EAAE,CAACQ,WAAW,CAACF,MAAM,CAAC;;GAGzDG,0BAA0B,CAACH,MAAoE,EAC/F;KACC,MAAM;OAAEtC,cAAc;OAAE0C,MAAM;OAAEC;MAAU,GAAGL,MAAM;KAEnD,MAAMM,YAAY,GAAG,4CAAI,kBAAQC,OAAO,CAAC,uBAAuB,CAAC,CAAC7C,cAAc,CAAC;KACjF,MAAMO,IAAI,GAAG,4CAAI,kBAAQsC,OAAO,CAAC,WAAW,CAAC,CAACH,MAAM,CAAC;KAErD,IAAI,CAACC,QAAQ,EACb;OACCG,oDAAwB,CAACd,WAAW,EAAE,CAACe,QAAQ,CAACC,qBAAS,CAACC,QAAQ,CAAC;;KAGpE,4CAAI;KAEJlB,sBAAsB,CAACC,WAAW,EAAE,CAACkB,gBAAgB,CAACN,YAAY,EAAErC,IAAI,CAAC;;GAG1EiC,WAAW,CAACF,MAAiC,EAC7C;KACC,MAAM;OAAExC,SAAS;OAAED,QAAQ;OAAEW;MAAS,GAAG8B,MAAM;KAC/C,MAAMhC,OAAO,GAAG,4CAAI,kBAAQuC,OAAO,CAAC,kBAAkB,CAAC,CAAC/C,SAAS,CAAC;KAClE,MAAMX,IAAI,GAAG,4CAAI,kBAAQ0D,OAAO,CAAC,WAAW,CAAC,CAAChD,QAAQ,EAAE,IAAI,CAAC;KAC7D,MAAMU,IAAI,GAAG,4CAAI,kBAAQsC,OAAO,CAAC,WAAW,CAAC,CAACvC,OAAO,CAAC6C,QAAQ,CAAC;KAE/D,MAAMC,OAAO,GAAG,IAAIjD,qBAAqB,CAAC;OAAEG,OAAO;OAAEnB,IAAI;OAAEoB,IAAI;OAAEC;MAAS,CAAC;KAC3E,MAAM6C,mBAAmB,GAAGD,OAAO,CAAC3D,KAAK,EAAE;KAE3C,MAAM6D,gBAAyB,GAAGC,gCAAc,CAACC,YAAY,EAAE,IAAIC,QAAQ,CAACC,QAAQ,EAAE;KACtF,IAAIJ,gBAAgB,EACpB;OACCK,+BAAQ,CAACC,wBAAwB,CAACP,mBAAmB,CAAC;MACtD,MAED;OACCM,+BAAQ,CAACrE,MAAM,CAAC+D,mBAAmB,CAAC;;;GAItCH,gBAAgB,CAACN,YAAiC,EAAErC,IAAkB,EACtE;KACC,IAAIG,KAAK,GAAGmD,aAAG,CAACC,UAAU,CAAC,qCAAqC,CAAC;KACjE,IAAIlB,YAAY,CAAClC,KAAK,EACtB;OACCA,KAAK,GAAGkC,YAAY,CAAClC,KAAK;MAC1B,MACI,IAAIH,IAAI,EACb;OACCG,KAAK,GAAGH,IAAI,CAACI,IAAI;;KAGlB,MAAM0C,mBAAmB,2CAAG,IAAI,4DAA6B3C,KAAK,EAAEkC,YAAY,EAAErC,IAAI,CAAC;KAEvF,MAAM+C,gBAAyB,GAAGC,gCAAc,CAACC,YAAY,EAAE,IAAIC,QAAQ,CAACC,QAAQ,EAAE;KACtF,IAAIJ,gBAAgB,EACpB;OACCK,+BAAQ,CAACC,wBAAwB,CAACP,mBAAmB,CAAC;MACtD,MAED;OACCM,+BAAQ,CAACrE,MAAM,CAAC+D,mBAAmB,CAAC;;;GAItCU,eAAe,CAACzB,MAA2B,EAC3C;KACC,MAAM;OAAE7B;MAAI,GAAG6B,MAAM;KAErB,MAAM;OAAE3C,MAAM;OAAEE;MAAU,GAAGL,cAAc,CAACO,KAAK,CAACU,EAAE,CAAC;KACrD,IAAId,MAAM,KAAKT,oBAAoB,CAACC,IAAI,EACxC;OACC,KAAK6E,mBAAS,CAACC,QAAQ,CAACpE,QAAQ,CAAC;MACjC,MACI,IAAIF,MAAM,KAAKT,oBAAoB,CAACE,YAAY,EACrD;OACC,KAAK4E,mBAAS,CAACE,gBAAgB,CAACrE,QAAQ,CAAC;MACzC,MACI,IAAIF,MAAM,KAAKT,oBAAoB,CAACG,KAAK,EAC9C;OACC,KAAK2E,mBAAS,CAACG,SAAS,CAACtE,QAAQ,CAAC;MAClC,MACI,IAAIF,MAAM,KAAKT,oBAAoB,CAACI,MAAM,EAC/C;OACC,KAAK0E,mBAAS,CAACI,iBAAiB,EAAE;;;CAyLrC;CAAC,sCApLC1D,KAAa,EACbkC,YAAiC,EACjCrC,IAAkB,EAEnB;GAAA;GACC,MAAME,EAAE,GAAGjB,cAAc,CAACC,KAAK,CAAC;KAC/BE,MAAM,EAAET,oBAAoB,CAACI,MAAM;KACnCM,QAAQ,EAAEgD,YAAY,CAACnC;IACvB,CAAC;GAEF,MAAM4C,mBAAmB,GAAG;KAC3B5C,EAAE;KACFC,KAAK;KACLE,IAAI,EAAEL,IAAI,GAAGA,IAAI,CAACc,MAAM,GAAG,EAAE;KAC7BR,IAAI,EAAES,uBAAM,CAAC+C,kBAAkB,CAACzB,YAAY;IAC5C;GAED,IAAIA,YAAY,CAAC0B,WAAW,KAAKC,kCAAsB,CAACC,OAAO,EAC/D;KACC,MAAM,CAACC,WAAW,EAAEC,YAAY,CAAC,GAAG9B,YAAY,CAAC+B,aAAa;KAC9DtB,mBAAmB,CAACuB,WAAW,GAAGH,WAAW,CAACI,IAAI;KAClDxB,mBAAmB,CAACyB,WAAW,GAAGJ,YAAY,CAACG,IAAI;IACnD,MACI,IAAI,yBAAAjC,YAAY,CAACN,MAAM,qBAAnB,qBAAqByC,SAAS,MAAK,GAAG,EAC/C;KACC1B,mBAAmB,CAAC2B,oBAAoB,GAAGnB,aAAG,CAACC,UAAU,CAAC,0CAA0C,CAAC;;GAGtG,OAAOT,mBAAmB;CAC3B;CAAC,uCAGD;GACCM,+BAAQ,CAACsB,SAAS,CAAC,OAAO,EAAE,MAAOC,KAAqC,IAAK;KAC5E,IAAI,CAACC,+BAAU,CAACC,SAAS,EAAE,EAC3B;OACC,IAAI,CAACrB,eAAe,CAACmB,KAAK,CAACG,OAAO,EAAE,CAAC;OAErC;;KAGD,MAAMF,+BAAU,CAACG,iBAAiB,EAAE;KAEpC,IAAIH,+BAAU,CAACI,kBAAkB,CAACC,mCAAc,CAACC,mBAAmB,CAAChF,EAAE,CAAC,EACxE;OACC,MAAM0E,+BAAU,CAACO,yBAAyB,EAAE;;KAG7CC,yCAAuB,CAAC3D,WAAW,EAAE,CAAC4D,iBAAiB,CAAC;OACvDC,MAAM,EAAEC,kCAAsB,CAAClD,YAAY;OAC3CN,MAAM,EAAE4C,KAAK,CAACG,OAAO;MACrB,CAAC;IACF,CAAC;GAEF1B,+BAAQ,CAACsB,SAAS,CAAC,QAAQ,EAAGC,KAAsC,IAAK;KACxE,4CAAI,wCAAmBA,KAAK,CAACG,OAAO,EAAE;IACtC,CAAC;CACH;CAAC,4BAEiB/C,MAA4B,EAC9C;GACC,MAAM;KAAE7B,EAAE;KAAEoF,MAAM;KAAEE;IAAW,GAAGzD,MAAM;GAExC,MAAM;KAAE3C,MAAM;KAAEC;IAAU,GAAGJ,cAAc,CAACO,KAAK,CAACU,EAAE,CAAC;GACrD,IAAId,MAAM,KAAKT,oBAAoB,CAACI,MAAM,EAC1C;KACC;;GAGD,MAAMsD,YAAY,GAAG,4CAAI,kBAAQC,OAAO,CAAC,uBAAuB,CAAC,CAACjD,QAAQ,CAAC;GAC3E,IAAImG,SAAS,EACb;KACC,4CAAI,kDAAwBnD,YAAY,EAAEmD,SAAS;IACnD,MACI,4CAAI,IAAI,kDAAwBF,MAAM,EAAEjD,YAAY,GACzD;KACC,4CAAI,kDAAwBiD,MAAM,EAAEjD,YAAY;;CAElD;CAAC,iCAEsBA,YAAiC,EAAE/B,IAAY,EACtE;GACC,4CAAI,8CAAsBmF,eAAe,CAAC;KACzCvF,EAAE,EAAEmC,YAAY,CAACnC,EAAE;KACnBI;IACA,CAAC;CACH;CAAC,iCAEsBgF,MAAc,EAAEjD,YAAiC,EACxE;GACC,MAAM,CAAC6B,WAAW,EAAEC,YAAY,CAAC,GAAG9B,YAAY,CAAC+B,aAAa;GAC9D,MAAMsB,kBAAkB,2CAAG,IAAI,8CAAsBJ,MAAM,CAAC;GAC5D,IAAII,kBAAkB,KAAKxE,YAAY,CAACC,KAAK,EAC7C;KACC,4CAAI,wCAAmBkB,YAAY,EAAE6B,WAAW;IAChD,MACI,IAAIwB,kBAAkB,KAAKxE,YAAY,CAACE,MAAM,EACnD;KACC,4CAAI,wCAAmBiB,YAAY,EAAE8B,YAAY;;CAEnD;CAAC,4BAEiB9B,YAAiC,EAAEsD,MAAiC,EACtF;GACC,MAAM,CAAClG,cAAc,EAAEmG,KAAK,CAAC,2CAAG,IAAI,8CAAsBD,MAAM,CAAC;GAEjE,4CAAI,8CAAsBE,iBAAiB,CAACpG,cAAc,EAAEmG,KAAK,CAAC;CACnE;CAAC,iCAEsBN,MAAc,EAAEjD,YAAiC,EACxE;GACC,MAAMyD,gBAAgB,GAAGzD,YAAY,CAAC0B,WAAW;GAEjD,OAAOuB,MAAM,CAACS,UAAU,CAAC9E,oBAAoB,CAAC,IAAI6E,gBAAgB,KAAK9B,kCAAsB,CAACC,OAAO;CACtG;CAAC,+BAEoBqB,MAAc,EACnC;;GAEC,OAAOA,MAAM,CAAC3F,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;CAC5B;CAAC,+BAEoBgG,MAAiC,EACtD;;GAEC,OAAOA,MAAM,CAACK,cAAc,CAACrG,KAAK,CAAC,GAAG,CAAC;CACxC;CAAC,wBAEaL,QAAgB,EAC9B;GACC,MAAM2G,UAAU,GAAG,4CAAI,kBAAQ3D,OAAO,CAAC,wBAAwB,CAAC,CAAChD,QAAQ,CAAC;GAE1E,OAAO4G,OAAO,CAAChD,QAAQ,CAACC,QAAQ,EAAE,IAAI8C,UAAU,CAAC;CAClD;CAAC,sCAE2BjE,WAAoB,EAChD;GACC,IAAIA,WAAW,EACf;KACCO,oDAAwB,CAACd,WAAW,EAAE,CAAC0E,aAAa,CAAC1D,qBAAS,CAAC2D,WAAW,CAAC;KAE3E;;GAGD7D,oDAAwB,CAACd,WAAW,EAAE,CAACe,QAAQ,CAACC,qBAAS,CAAC2D,WAAW,CAAC;CACvE;CAAC,4BAEiBpE,WAAoB,EACtC;GACC,IAAIA,WAAW,EACf;KACCO,oDAAwB,CAACd,WAAW,EAAE,CAAC0E,aAAa,CAAC1D,qBAAS,CAAC4D,WAAW,CAAC;KAE3E;;GAGD9D,oDAAwB,CAACd,WAAW,EAAE,CAACe,QAAQ,CAACC,qBAAS,CAAC4D,WAAW,CAAC;CACvE;CAAC,8BAGD;GACC,IAAI,CAACrD,gCAAc,CAAC6B,SAAS,EAAE,EAC/B;KACC;;GAGDD,+BAAU,CAAC0B,SAAS,EAAE;CACvB;CAAC,wCAE6BhH,QAAgB,EAC9C;GACC,4CAAI,IAAI,gCAAeA,QAAQ,GAC/B;KACC,OAAO,IAAI;;GAGZ,MAAMiH,WAAW,GAAG,MAAMC,6BAAY,CAACC,SAAS,CAACC,qBAAS,CAACC,QAAQ,CAACC,mBAAmB,EAAE;KAAEtH;IAAU,CAAC;GAEtG,OAAOiH,WAAW,CAACM,QAAQ,CAACxF,yBAAyB,CAACC,IAAI,CAAC;CAC5D;CAAC,sBAzTWE,sBAAsB;GAAA;GAAA;CAAA;;;;;;;;;"}