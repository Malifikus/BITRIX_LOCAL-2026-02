{"version":3,"file":"sending.bundle.js","sources":["../src/sending.js"],"sourcesContent":["import { Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { Logger } from 'im.v2.lib.logger';\nimport { runAction, type RunActionError } from 'im.v2.lib.rest';\nimport { Core } from 'im.v2.application.core';\nimport { EventType, RestMethod, DialogScrollThreshold, ChatType, MessageComponent } from 'im.v2.const';\nimport { MessageService } from 'im.v2.provider.service.message';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { ImModelChat, ImModelMessage } from 'im.v2.model';\nimport type {\n\tPlainMessageParams,\n\tCopilotMessageParams,\n\tFileMessageParams,\n\tPreparedMessage,\n\tStickerMessageParams,\n} from './types/sending';\n\nexport type { PanelContext, PanelContextWithMultipleIds } from './types/sending';\n\nexport class SendingService\n{\n\t#store: Store;\n\n\tstatic instance: SendingService = null;\n\n\tstatic getInstance(): SendingService\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\tasync sendMessage(params: PlainMessageParams): void\n\t{\n\t\tconst { text = '' } = params;\n\t\tif (!Type.isStringFilled(text))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.warn('SendingService: sendMessage', params);\n\t\tconst message = this.#prepareMessage(params);\n\n\t\tvoid this.#processMessageSending(message);\n\t}\n\n\tasync sendMessageWithFiles(params: FileMessageParams): Promise\n\t{\n\t\tconst { text = '', fileIds = [] } = params;\n\t\tif (!Type.isStringFilled(text) && !Type.isArrayFilled(fileIds))\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tLogger.warn('SendingService: sendMessage with files', params);\n\t\tconst message: PreparedMessage = this.#prepareMessageWithFiles(params);\n\n\t\tawait this.#handlePagination(message.dialogId);\n\t\tawait this.#addLoadingMessage(message);\n\t\tawait this.#addMessageToRecent(message);\n\t\tawait this.#clearLastMessageViews(message.dialogId);\n\n\t\tthis.#sendScrollEvent({\n\t\t\tforce: true,\n\t\t\tdialogId: message.dialogId,\n\t\t});\n\n\t\treturn Promise.resolve();\n\t}\n\n\tasync sendMessageWithSticker(params: StickerMessageParams): void\n\t{\n\t\tconst { stickerParams } = params;\n\n\t\tif (!Type.isPlainObject(stickerParams))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.#store.dispatch('stickers/recent/update', stickerParams);\n\t\tLogger.warn('SendingService: sendMessage with sticker', params);\n\t\tconst message: PreparedMessage = this.#prepareMessageWithSticker(params);\n\n\t\tvoid this.#processMessageSending(message);\n\t}\n\n\tasync forwardMessages(params: PlainMessageParams): Promise\n\t{\n\t\tconst { forwardIds, dialogId, text } = params;\n\t\tif (!Type.isArrayFilled(forwardIds))\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tLogger.warn('SendingService: forwardMessages', params);\n\n\t\tawait this.#handlePagination(dialogId);\n\n\t\tlet commentMessage = null;\n\t\tif (Type.isStringFilled(text))\n\t\t{\n\t\t\tcommentMessage = this.#prepareMessage(params);\n\t\t\tawait this.#addMessageToModels(commentMessage);\n\t\t}\n\n\t\tconst sortForwardIds = [...forwardIds].sort();\n\t\tconst forwardUuidMap = this.#getForwardUuidMap(sortForwardIds);\n\t\tconst forwardedMessages = this.#prepareForwardMessages(params, forwardUuidMap);\n\n\t\tawait this.#addForwardsToModels(forwardedMessages);\n\n\t\tthis.#sendScrollEvent({ force: true, dialogId });\n\n\t\treturn this.#sendForwardRequest({ forwardUuidMap, commentMessage, dialogId });\n\t}\n\n\tasync retrySendMessage(params: { tempMessageId: string, dialogId: string }): Promise\n\t{\n\t\tconst { tempMessageId, dialogId } = params;\n\t\tconst unsentMessage: ImModelMessage = this.#store.getters['messages/getById'](tempMessageId);\n\t\tif (!unsentMessage)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.#removeMessageError(tempMessageId);\n\t\tconst message = this.#prepareMessage({\n\t\t\ttext: unsentMessage.text,\n\t\t\tdialogId,\n\t\t\ttempMessageId: unsentMessage.id,\n\t\t\treplyId: unsentMessage.replyId,\n\t\t});\n\n\t\tif (Type.isStringFilled(unsentMessage.forward.id))\n\t\t{\n\t\t\tconst [, forwardId] = unsentMessage.forward.id.split('/');\n\t\t\tconst forwardUuidMap = { [unsentMessage.id]: forwardId };\n\n\t\t\treturn this.#sendForwardRequest({ forwardUuidMap, dialogId });\n\t\t}\n\n\t\treturn this.#sendAndProcessMessage(message);\n\t}\n\n\tasync sendCopilotPrompt(params: CopilotMessageParams): Promise\n\t{\n\t\tconst { text = '' } = params;\n\t\tif (!Type.isStringFilled(text))\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tLogger.warn('SendingService: sendCopilotPrompt', params);\n\t\tconst message = this.#preparePrompt(params);\n\n\t\treturn this.#processMessageSending(message);\n\t}\n\n\tasync #addLoadingMessage(message: PreparedMessage): Promise<void>\n\t{\n\t\treturn this.#store.dispatch('messages/addLoadingMessage', { message });\n\t}\n\n\tasync #processMessageSending(message: PreparedMessage): Promise\n\t{\n\t\tawait this.#handleAddingMessageToModels(message);\n\n\t\treturn this.#sendAndProcessMessage(message);\n\t}\n\n\tasync #handleAddingMessageToModels(message)\n\t{\n\t\tawait this.#handlePagination(message.dialogId);\n\t\tawait this.#addMessageToModels(message);\n\n\t\tthis.#sendScrollEvent({ force: true, dialogId: message.dialogId });\n\t}\n\n\tasync #sendAndProcessMessage(message: PreparedMessage): Promise\n\t{\n\t\tconst sendResult = await this.#sendMessageToServer(message)\n\t\t\t.catch((errors) => {\n\t\t\t\tthis.#updateMessageError(message.temporaryId);\n\t\t\t\tthis.#logSendErrors(errors, 'sendAndProcessMessage');\n\t\t\t});\n\n\t\tLogger.warn('SendingService: sendAndProcessMessage result -', sendResult);\n\t\tconst { id } = sendResult;\n\t\tif (!id)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.#updateModels({\n\t\t\toldId: message.temporaryId,\n\t\t\tnewId: id,\n\t\t\tdialogId: message.dialogId,\n\t\t});\n\n\t\treturn Promise.resolve();\n\t}\n\n\t#prepareMessage(params: PlainMessageParams): PreparedMessage\n\t{\n\t\tconst { text, tempMessageId, dialogId, replyId, forwardIds } = params;\n\n\t\tconst defaultFields = {\n\t\t\tauthorId: Core.getUserId(),\n\t\t\tunread: false,\n\t\t\tsending: true,\n\t\t};\n\n\t\tconst copilotParams = this.#prepareCopilotMessageParams(dialogId);\n\t\tconst aiAssistantParams = this.#prepareAiAssistantMessageParams(dialogId);\n\n\t\treturn {\n\t\t\ttext,\n\t\t\tdialogId,\n\t\t\tchatId: this.#getDialog(dialogId).chatId,\n\t\t\ttemporaryId: tempMessageId ?? Utils.text.getUuidV4(),\n\t\t\treplyId,\n\t\t\tforwardIds,\n\t\t\tviewedByOthers: this.#needToSetAsViewed(dialogId),\n\t\t\t...copilotParams,\n\t\t\t...aiAssistantParams,\n\t\t\t...defaultFields,\n\t\t};\n\t}\n\n\t#prepareMessageWithFiles(params: FileMessageParams): PreparedMessage\n\t{\n\t\tconst { fileIds } = params;\n\t\tif (!Type.isArrayFilled(fileIds))\n\t\t{\n\t\t\tthrow new Error('SendingService: sendMessageWithFile: no fileId provided');\n\t\t}\n\n\t\treturn {\n\t\t\t...this.#prepareMessage(params),\n\t\t\tparams: { FILE_ID: fileIds },\n\t\t};\n\t}\n\n\t#prepareMessageWithSticker(params: StickerMessageParams): PreparedMessage\n\t{\n\t\tconst { stickerParams } = params;\n\t\tif (!Type.isPlainObject(stickerParams))\n\t\t{\n\t\t\tthrow new TypeError('SendingService: sendMessageWithSticker: no stickerParams provided');\n\t\t}\n\n\t\treturn {\n\t\t\t...this.#prepareMessage(params),\n\t\t\tstickerParams,\n\t\t};\n\t}\n\n\t#preparePrompt(params: CopilotMessageParams): PreparedMessage\n\t{\n\t\tconst { copilot } = params;\n\t\tif (!copilot || !copilot.promptCode)\n\t\t{\n\t\t\tthrow new Error('SendingService: preparePrompt: no code provided');\n\t\t}\n\n\t\treturn {\n\t\t\t...this.#prepareMessage(params),\n\t\t\tcopilot,\n\t\t};\n\t}\n\n\tasync #handlePagination(dialogId: string): Promise\n\t{\n\t\tif (!this.#getDialog(dialogId).hasNextPage)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tLogger.warn('SendingService: sendMessage: there are unread pages, move to chat end');\n\t\tconst messageService = new MessageService({ chatId: this.#getDialog(dialogId).chatId });\n\n\t\tawait messageService.loadContext(this.#getDialog(dialogId).lastMessageId);\n\t\tthis.#sendScrollEvent({ dialogId });\n\n\t\treturn Promise.resolve();\n\t}\n\n\t#addMessageToModels(message: PreparedMessage): Promise\n\t{\n\t\tthis.#addMessageToRecent(message);\n\t\tconst hasMessageSticker: boolean = Type.isPlainObject(message.stickerParams);\n\t\tif (hasMessageSticker)\n\t\t{\n\t\t\tvoid this.#store.dispatch('stickers/messages/set', [{\n\t\t\t\tmessageId: message.temporaryId,\n\t\t\t\t...message.stickerParams,\n\t\t\t}]);\n\t\t}\n\n\t\tvoid this.#clearLastMessageViews(message.dialogId);\n\n\t\treturn this.#store.dispatch('messages/add', message);\n\t}\n\n\t#addMessageToRecent(message: PreparedMessage)\n\t{\n\t\tconst hasMessageText: boolean = Type.isStringFilled(message.text);\n\t\tconst hasMessageFile: boolean = Type.isArrayFilled(message.params?.FILE_ID);\n\t\tconst hasMessageSticker: boolean = Type.isPlainObject(message.stickerParams);\n\n\t\tif (hasMessageText || hasMessageFile || hasMessageSticker)\n\t\t{\n\t\t\tvoid this.#store.dispatch('recent/update', {\n\t\t\t\tid: message.dialogId,\n\t\t\t\tfields: { messageId: message.temporaryId },\n\t\t\t});\n\t\t}\n\t}\n\n\t#sendMessageToServer(message: PreparedMessage): Promise\n\t{\n\t\tconst fields = {};\n\n\t\tif (message.replyId)\n\t\t{\n\t\t\tfields.replyId = message.replyId;\n\t\t}\n\n\t\tif (message.forwardIds)\n\t\t{\n\t\t\tfields.forwardIds = message.forwardIds;\n\t\t}\n\n\t\tif (message.text)\n\t\t{\n\t\t\tfields.message = message.text;\n\t\t\tfields.templateId = message.temporaryId;\n\t\t}\n\n\t\tif (message.copilot)\n\t\t{\n\t\t\tfields.copilot = message.copilot;\n\t\t}\n\n\t\tif (message.aiAssistant)\n\t\t{\n\t\t\tfields.aiAssistant = message.aiAssistant;\n\t\t}\n\n\t\tif (message.stickerParams)\n\t\t{\n\t\t\t// todo: this is temp fix. We need to figure it out, why templateId is set only for text messages (see above)\n\t\t\tfields.templateId = message.temporaryId;\n\t\t\tfields.stickerParams = message.stickerParams;\n\t\t}\n\n\t\tconst queryData = {\n\t\t\tdialogId: message.dialogId.toString(),\n\t\t\tfields,\n\t\t};\n\n\t\treturn runAction(RestMethod.imV2ChatMessageSend, { data: queryData });\n\t}\n\n\t#updateModels(params: { oldId: string, newId: number, dialogId: string })\n\t{\n\t\tconst { oldId, newId, dialogId } = params;\n\t\tvoid this.#store.dispatch('messages/updateWithId', {\n\t\t\tid: oldId,\n\t\t\tfields: { id: newId },\n\t\t});\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: {\n\t\t\t\tlastId: newId,\n\t\t\t\tlastMessageId: newId,\n\t\t\t},\n\t\t});\n\t\tvoid this.#store.dispatch('recent/update', {\n\t\t\tid: dialogId,\n\t\t\tfields: { messageId: newId },\n\t\t});\n\n\t\tconst isSticker: boolean = this.#store.getters['stickers/messages/isSticker'](oldId);\n\t\tif (isSticker)\n\t\t{\n\t\t\tvoid this.#store.dispatch('stickers/messages/updateWithId', { oldId, newId });\n\t\t}\n\t}\n\n\t#updateMessageError(messageId: string)\n\t{\n\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\tid: messageId,\n\t\t\tfields: { error: true },\n\t\t});\n\t}\n\n\t#removeMessageError(messageId: string)\n\t{\n\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\tid: messageId,\n\t\t\tfields: {\n\t\t\t\tsending: true,\n\t\t\t\terror: false,\n\t\t\t},\n\t\t});\n\t}\n\n\t#sendScrollEvent(params: {force: boolean, dialogId: string} = {})\n\t{\n\t\tconst { force = false, dialogId } = params;\n\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\tchatId: this.#getDialog(dialogId).chatId,\n\t\t\tthreshold: force ? DialogScrollThreshold.none : DialogScrollThreshold.halfScreenUp,\n\t\t});\n\t}\n\n\t#getDialog(dialogId: string): ImModelChat\n\t{\n\t\treturn this.#store.getters['chats/get'](dialogId, true);\n\t}\n\n\t#getDialogByChatId(chatId: number): ImModelChat\n\t{\n\t\treturn this.#store.getters['chats/getByChatId'](chatId, true);\n\t}\n\n\t#needToSetAsViewed(dialogId: string): boolean\n\t{\n\t\treturn this.#store.getters['users/bots/isNetwork'](dialogId);\n\t}\n\n\t#handleForwardMessageResponse(params: { response: Object, dialogId: string, commentMessage: PreparedMessage })\n\t{\n\t\tconst { response, dialogId, commentMessage } = params;\n\t\tconst { id, uuidMap } = response;\n\n\t\tif (id)\n\t\t{\n\t\t\tthis.#updateModels({\n\t\t\t\toldId: commentMessage.temporaryId,\n\t\t\t\tnewId: id,\n\t\t\t\tdialogId,\n\t\t\t});\n\t\t}\n\t\tObject.entries(uuidMap).forEach(([uuid: string, messageId: number]) => {\n\t\t\tthis.#updateModels({\n\t\t\t\toldId: uuid,\n\t\t\t\tnewId: messageId,\n\t\t\t\tdialogId,\n\t\t\t});\n\t\t});\n\t}\n\n\t#handleForwardMessageError({ commentMessage, forwardUuidMap })\n\t{\n\t\tif (commentMessage)\n\t\t{\n\t\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\t\tid: commentMessage.temporaryId,\n\t\t\t\tfields: { error: true },\n\t\t\t});\n\t\t}\n\n\t\tObject.keys(forwardUuidMap).forEach((uuid: string) => {\n\t\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\t\tid: uuid,\n\t\t\t\tfields: { error: true },\n\t\t\t});\n\t\t});\n\t}\n\n\t#prepareForwardMessages(params: PlainMessageParams, forwardUuidMap: {[string]: number}): PreparedMessage[]\n\t{\n\t\tconst { forwardIds, dialogId } = params;\n\t\tif (forwardIds.length === 0)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst preparedMessages = [];\n\t\tObject.entries(forwardUuidMap).forEach(([uuid: string, messageId: number]) => {\n\t\t\tconst message: ImModelMessage = this.#store.getters['messages/getById'](messageId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst prepared = {\n\t\t\t\t...this.#prepareMessage({ dialogId, text: message.text, tempMessageId: uuid, replyId: message.replyId }),\n\t\t\t\tforward: this.#prepareForwardParams(messageId),\n\t\t\t\tattach: message.attach,\n\t\t\t\tisDeleted: message.isDeleted,\n\t\t\t\tfiles: message.files,\n\t\t\t};\n\n\t\t\tconst isSticker = this.#store.getters['stickers/messages/isSticker'](messageId);\n\t\t\tif (isSticker)\n\t\t\t{\n\t\t\t\tprepared.stickerParams = this.#store.getters['stickers/messages/getStickerByMessageId'](messageId);\n\t\t\t}\n\n\t\t\tpreparedMessages.push(prepared);\n\t\t});\n\n\t\treturn preparedMessages;\n\t}\n\n\t#prepareForwardParams(messageId: number): { id: string, userId: number, chatType: string, chatTitle: string }\n\t{\n\t\tconst message: ImModelMessage = this.#store.getters['messages/getById'](messageId);\n\t\tconst chat = this.#getDialogByChatId(message.chatId);\n\n\t\tconst isForward = this.#store.getters['messages/isForward'](messageId);\n\n\t\tconst userId = isForward ? message.forward.userId : message.authorId;\n\t\tconst chatType = isForward ? message.forward.chatType : chat.type;\n\t\tlet chatTitle = isForward ? message.forward.chatTitle : chat.name;\n\t\tif (chatType === ChatType.channel)\n\t\t{\n\t\t\tchatTitle = null;\n\t\t}\n\n\t\treturn {\n\t\t\tid: this.#buildForwardContextId(message.chatId, messageId),\n\t\t\tuserId,\n\t\t\tchatType,\n\t\t\tchatTitle,\n\t\t};\n\t}\n\n\t#prepareSendForwardRequest(params: {\n\t\tforwardUuidMap: { [string]: number },\n\t\tcommentMessage: ?PreparedMessage,\n\t\tdialogId: string\n\t}): { dialogId: string, forwardIds: { [string]: number }, text?: string, temporaryId?: string }\n\t{\n\t\tconst { dialogId, forwardUuidMap, commentMessage } = params;\n\n\t\tconst requestPrams = {\n\t\t\tdialogId,\n\t\t\tforwardIds: forwardUuidMap,\n\t\t};\n\n\t\tif (commentMessage)\n\t\t{\n\t\t\trequestPrams.text = commentMessage.text;\n\t\t\trequestPrams.temporaryId = commentMessage.temporaryId;\n\t\t}\n\n\t\treturn requestPrams;\n\t}\n\n\t#addForwardsToModels(forwardedMessages: PreparedMessage[]): Promise\n\t{\n\t\tconst addPromises = [];\n\t\tforwardedMessages.forEach((message) => {\n\t\t\taddPromises.push(this.#addMessageToModels(message));\n\t\t});\n\n\t\treturn Promise.all(addPromises);\n\t}\n\n\t#getForwardUuidMap(forwardIds: number[]): { [string]: number }\n\t{\n\t\tconst uuidMap = {};\n\t\tforwardIds.forEach((id) => {\n\t\t\tuuidMap[Utils.text.getUuidV4()] = id;\n\t\t});\n\n\t\treturn uuidMap;\n\t}\n\n\t#buildForwardContextId(chatId: number, messageId: number): string\n\t{\n\t\tconst dialogId = this.#getDialogByChatId(chatId).dialogId;\n\t\tif (dialogId.startsWith('chat'))\n\t\t{\n\t\t\treturn `${dialogId}/${messageId}`;\n\t\t}\n\n\t\tconst currentUser = Core.getUserId();\n\n\t\treturn `${dialogId}:${currentUser}/${messageId}`;\n\t}\n\n\t#logSendErrors(errors: RunActionError[], methodName: string)\n\t{\n\t\terrors.forEach((error) => {\n\t\t\tconsole.error(`SendingService: ${methodName} error: code: ${error.code} message: ${error.message}`);\n\t\t});\n\t}\n\n\t#clearLastMessageViews(dialogId: string): Promise<any>\n\t{\n\t\treturn this.#store.dispatch('chats/clearLastMessageViews', {\n\t\t\tdialogId,\n\t\t});\n\t}\n\n\tasync #sendForwardRequest({ forwardUuidMap, commentMessage, dialogId }): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst requestParams = this.#prepareSendForwardRequest({ forwardUuidMap, commentMessage, dialogId });\n\t\t\tconst response = await this.#sendMessageToServer(requestParams);\n\t\t\tLogger.warn('SendingService: forwardMessage result -', response);\n\t\t\tthis.#handleForwardMessageResponse({ response, dialogId, commentMessage });\n\t\t}\n\t\tcatch (errors)\n\t\t{\n\t\t\tthis.#handleForwardMessageError({ commentMessage, forwardUuidMap });\n\t\t\tthis.#logSendErrors(errors, 'forwardMessage');\n\t\t}\n\n\t\treturn Promise.resolve();\n\t}\n\n\t#prepareCopilotMessageParams(dialogId: string): { copilot?: { reasoning: boolean } }\n\t{\n\t\tconst isReasoningEnabled = Core.getStore().getters['copilot/chats/isReasoningEnabled'](dialogId);\n\t\tif (!isReasoningEnabled)\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\treturn { copilot: { reasoning: 'Y' } };\n\t}\n\n\t#prepareAiAssistantMessageParams(dialogId: string): { aiAssistant?: { mcpAuthId: number } }\n\t{\n\t\tconst isAiAssistant = Core.getStore().getters['users/bots/isAiAssistant'](dialogId);\n\t\tif (!isAiAssistant)\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\tconst mcpAuthId = Core.getStore().getters['aiAssistant/getMcpAuthId'];\n\t\tif (!mcpAuthId)\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\treturn { aiAssistant: { mcpAuthId } };\n\t}\n}\n"],"names":["SendingService","getInstance","instance","constructor","Core","getStore","sendMessage","params","text","Type","isStringFilled","Logger","warn","message","sendMessageWithFiles","fileIds","isArrayFilled","Promise","resolve","dialogId","force","sendMessageWithSticker","stickerParams","isPlainObject","dispatch","forwardMessages","forwardIds","commentMessage","sortForwardIds","sort","forwardUuidMap","forwardedMessages","retrySendMessage","tempMessageId","unsentMessage","getters","id","replyId","forward","forwardId","split","sendCopilotPrompt","sendResult","catch","errors","temporaryId","oldId","newId","defaultFields","authorId","getUserId","unread","sending","copilotParams","aiAssistantParams","chatId","Utils","getUuidV4","viewedByOthers","Error","FILE_ID","TypeError","copilot","promptCode","hasNextPage","messageService","MessageService","loadContext","lastMessageId","hasMessageSticker","messageId","hasMessageText","hasMessageFile","fields","templateId","aiAssistant","queryData","toString","runAction","RestMethod","imV2ChatMessageSend","data","lastId","isSticker","error","EventEmitter","emit","EventType","dialog","scrollToBottom","threshold","DialogScrollThreshold","none","halfScreenUp","response","uuidMap","Object","entries","forEach","uuid","keys","length","preparedMessages","prepared","attach","isDeleted","files","push","chat","isForward","userId","chatType","type","chatTitle","name","ChatType","channel","requestPrams","addPromises","all","startsWith","currentUser","methodName","console","code","requestParams","isReasoningEnabled","reasoning","isAiAssistant","mcpAuthId"],"mappings":"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"}