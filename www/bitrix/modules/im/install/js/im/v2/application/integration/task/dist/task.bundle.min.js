this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(t,e,a,n,s,i,o,r,d,h,l,c,g,C,p,u,m,v){"use strict";const b={name:"TaskChatHeader",components:{ChatHeader:u.ChatHeader,UserCounter:u.UserCounter,LineLoader:C.LineLoader,FadeAnimation:p.FadeAnimation},props:{dialogId:{type:String,default:""}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},isInited(){return this.dialog.inited}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<ChatHeader :dialogId="dialogId" >\n\t\t\t<template #left>\n\t\t\t\t<div class="bx-im-task-chat-header__left_container">\n\t\t\t\t\t<div class="bx-im-task-chat-header__avatar"></div>\n\t\t\t\t\t<div class="bx-im-task-chat-header__info">\n\t\t\t\t\t\t<div class="bx-im-task-chat-header__title">{{ loc('IM_TASK_CHAT_HEADER_TITLE') }}</div>\n\t\t\t\t\t\t<LineLoader v-if="!isInited" :width="50" :height="16" />\n\t\t\t\t\t\t<FadeAnimation :duration="100">\n\t\t\t\t\t\t\t<UserCounter v-if="isInited" :dialogId="dialogId" />\n\t\t\t\t\t\t</FadeAnimation>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</ChatHeader>\n\t`};const I={name:"TaskChatContent",components:{BaseChatContent:u.BaseChatContent,TaskChatHeader:b,ChatDialog:c.ChatDialog,ChatTextarea:l.ChatTextarea},props:{dialogId:{type:String,default:""},withSidebar:{type:Boolean,default:true}},created(){h.EventEmitter.subscribe(m.EventType.notifier.onBeforeShowMessage,this.onBeforeNotificationShow)},beforeUnmount(){h.EventEmitter.unsubscribe(m.EventType.notifier.onBeforeShowMessage,this.onBeforeNotificationShow)},methods:{onBeforeNotificationShow(t){const e=t.getData();if(e.dialogId!==this.dialogId){return g.NotifierShowMessageAction.show}return g.NotifierShowMessageAction.skip}},template:`\n\t\t<BaseChatContent :dialogId="dialogId" :withSidebar="withSidebar">\n\t\t\t<template #header>\n\t\t\t\t<TaskChatHeader :dialogId="dialogId" />\n\t\t\t</template>\n\t\t\t<template #dialog>\n\t\t\t\t<ChatDialog\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t:key="dialogId"\n\t\t\t\t\t:reloadOnExit="false"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template #textarea="{ onTextareaMount }">\n\t\t\t\t<ChatTextarea\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t:key="dialogId"\n\t\t\t\t\t:withMarket="false"\n\t\t\t\t\t:withAutoFocus="false"\n\t\t\t\t\t@mounted="onTextareaMount"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</BaseChatContent>\n\t`};const k=()=>{const t=new v.DemoChatBuilder;const{dialogId:e}=t.addChat();t.addMessage({text:e,componentId:m.MessageComponent.taskChatCreationMessage});t.save();return e};const f={name:"TaskChatPlaceholder",components:{TaskChatContent:I},props:{taskId:{type:[Number,String],required:true}},data(){return{fakeDialogId:"",chatMembersCount:1}},computed:{containerClasses(){const t=this.$store.getters["application/settings/get"](m.Settings.appearance.alignment);return[`--${t}-align`]},backgroundStyle(){return d.ThemeManager.getCurrentBackgroundStyle()}},created(){this.fakeDialogId=k();this.bindEvents()},beforeUnmount(){this.unbindEvents()},methods:{bindEvents(){h.EventEmitter.subscribe(m.EventType.task.onMembersCountChange,this.onMembersCountChange)},unbindEvents(){h.EventEmitter.unsubscribe(m.EventType.task.onMembersCountChange,this.onMembersCountChange)},onMembersCountChange(t){const{taskId:e,userCounter:a}=t.getData();if(e!==this.taskId){return}this.$store.dispatch("chats/update",{dialogId:this.fakeDialogId,fields:{userCounter:a}})}},template:`\n\t\t<div class="bx-im-task-chat-placeholder__container bx-im-messenger__scope">\n\t\t\t<TaskChatContent :dialogId="fakeDialogId" :withSidebar="false" />\n\t\t\t<div class="bx-im-task-chat-placeholder__overlay"></div>\n\t\t</div>\n\t`};const B={name:"TaskChatOpener",components:{TaskChatContent:I,TaskChatPlaceholder:f},props:{chatId:{type:Number,required:true},chatType:{type:String,required:true}},computed:{dialog(){return this.$store.getters["chats/getByChatId"](this.chatId,true)},dialogId(){return this.dialog.dialogId}},created(){return this.onChatOpen()},methods:{async onChatOpen(){if(this.dialog.inited){o.Logger.warn(`TaskChatOpener: chat ${this.chatId} is already loaded`);return}await this.loadChat()},async loadChat(){o.Logger.warn(`TaskChatOpener: loading chat ${this.chatId}`);await this.getChatService().loadChatByChatId(this.chatId);o.Logger.warn(`TaskChatOpener: chat ${this.chatId} is loaded`)},getChatService(){if(!this.chatService){this.chatService=new r.ChatService}return this.chatService}},template:`\n\t\t<div class="bx-im-messenger__scope bx-im-task-chat-opener__container --ui-context-content-light">\n\t\t\t<TaskChatContent :dialogId="dialogId" />\n\t\t</div>\n\t`};const M="TaskChatApplication";const T="TaskChatPlaceholderApplication";var y=babelHelpers.classPrivateFieldLooseKey("initPromise");var w=babelHelpers.classPrivateFieldLooseKey("init");class E{constructor(){Object.defineProperty(this,w,{value:S});Object.defineProperty(this,y,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,y)[y]=babelHelpers.classPrivateFieldLooseBase(this,w)[w]()}ready(){return babelHelpers.classPrivateFieldLooseBase(this,y)[y]}async mount(t){await this.ready();const{rootContainer:n,chatId:s,onError:i,type:o}=t;if(!n){return Promise.reject(new Error("Provide node or selector for root container"))}if(!o){return Promise.reject(new Error("Provide custom chat type name for task chat"))}const r=e.Text.toCamelCase(o);return a.Core.createVue(this,{name:M,el:n,onError:i,components:{TaskChatOpener:B},template:`<TaskChatOpener :chatId="${s}" chatType="${r}" />`})}async mountPlaceholder(t){await this.ready();const{rootContainer:e,taskId:n}=t;if(!e){return Promise.reject(new Error("Provide node or selector for root container"))}return a.Core.createVue(this,{name:T,el:e,components:{TaskChatPlaceholder:f},template:`<TaskChatPlaceholder :taskId="${n}" />`})}}async function S(){await a.Core.ready();return this}t.TaskApplication=E})(this.BX.Messenger.v2.Application=this.BX.Messenger.v2.Application||{},BX,BX.Messenger.v2.Application,BX.Messenger.v2.Css,BX.Messenger.v2.Css,BX.Messenger.v2.Css,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Event,BX.Messenger.v2.Component,BX.Messenger.v2.Component.Dialog,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.Animation,BX.Messenger.v2.Component.Content,BX.Messenger.v2.Const,BX.Messenger.v2.Lib);
//# sourceMappingURL=task.bundle.map.js