this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,i,n,o,a,r,l,c,g,d,h,u,I,m,M,p,v,b,C,L,f,P,y,_,x,F,k,B,E,A,O,H){"use strict";const S="BX.Messenger.v2.Lib.Menu";var N=babelHelpers.classPrivateFieldLooseKey("prepareItems");var T=babelHelpers.classPrivateFieldLooseKey("bindBlurEvent");class D extends t.EventEmitter{constructor(){super();Object.defineProperty(this,T,{value:R});Object.defineProperty(this,N,{value:U});this.id="im-base-context-menu";this.setEventNamespace(S);this.store=E.Core.getStore();this.restClient=E.Core.getRestClient()}openMenu(e,t){if(this.menuInstance){this.close()}this.context=e;this.target=t;this.menuInstance=new B.Menu(this.getMenuOptions());this.menuInstance.show(this.target);babelHelpers.classPrivateFieldLooseBase(this,T)[T]()}getMenuOptions(){return{id:this.id,bindOptions:{forceBindPosition:true,position:"bottom"},targetContainer:document.body,cacheable:false,closeByEsc:true,className:this.getMenuClassName(),items:babelHelpers.classPrivateFieldLooseBase(this,N)[N](),sections:this.getMenuGroups(),events:{onClose:()=>this.close(),onDestroy:()=>this.destroy()}}}getMenuItems(){return[]}getMenuGroups(){return[]}groupItems(e,t){return e.filter((e=>e!==null)).map((e=>({...e,sectionCode:t})))}getMenuClassName(){return""}close(){this.emit("close");if(!this.menuInstance){return}this.menuInstance.destroy();this.menuInstance=null}destroy(){this.close()}getCurrentUserId(){return E.Core.getUserId()}}function U(){return this.getMenuItems().filter((e=>e!==null))}function R(){F.Event.bindOnce(window,"blur",(()=>{this.destroy()}))}const w={first:"first",second:"second",third:"third"};var K=babelHelpers.classPrivateFieldLooseKey("leaveChat");var X=babelHelpers.classPrivateFieldLooseKey("leaveCollab");var G=babelHelpers.classPrivateFieldLooseKey("canHideChat");var j=babelHelpers.classPrivateFieldLooseKey("isInvitationActive");var V=babelHelpers.classPrivateFieldLooseKey("canResendInvitation");class W extends D{constructor(e){super();Object.defineProperty(this,V,{value:z});Object.defineProperty(this,j,{value:q});Object.defineProperty(this,G,{value:$});Object.defineProperty(this,X,{value:Q});Object.defineProperty(this,K,{value:Y});this.id="im-recent-context-menu";this.chatService=new c.ChatService;this.callManager=o.CallManager.getInstance();this.permissionManager=b.PermissionManager.getInstance();const{emitter:t}=e;this.emitter=t}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName()}}getMenuClassName(){return this.context.compactMode?"":super.getMenuClassName()}getMenuItems(){if(babelHelpers.classPrivateFieldLooseBase(this,j)[j]()){const e=[this.getSendMessageItem(),this.getOpenProfileItem()];return[...this.groupItems(e,w.first),...this.groupItems(this.getInviteItems(),w.second)]}return[this.getUnreadMessageItem(),this.getPinMessageItem(),this.getMuteItem(),this.getOpenProfileItem(),this.getChatsWithUserItem(),this.getHideItem(),this.getLeaveItem()]}getMenuGroups(){if(babelHelpers.classPrivateFieldLooseBase(this,j)[j]()){return[{code:w.first},{code:w.second}]}return[]}getSendMessageItem(){return{title:F.Loc.getMessage("IM_LIB_MENU_WRITE_V2"),onClick:()=>{void l.Messenger.openChat(this.context.dialogId);this.menuInstance.close()}}}getOpenItem(){return{title:F.Loc.getMessage("IM_LIB_MENU_OPEN"),onClick:()=>{void l.Messenger.openChat(this.context.dialogId);this.menuInstance.close()}}}getUnreadMessageItem(){const{recentItem:e,dialogId:t}=this.context;if(!e){return null}const s=this.store.getters["chats/get"](t,true);const i=e.unread||s.counter>0;return{title:i?F.Loc.getMessage("IM_LIB_MENU_READ"):F.Loc.getMessage("IM_LIB_MENU_UNREAD"),onClick:()=>{if(i){this.chatService.readDialog(t)}else{this.chatService.unreadDialog(t)}this.menuInstance.close()}}}getPinMessageItem(){const{recentItem:e,dialogId:t}=this.context;if(!e){return null}const s=e.pinned;return{title:s?F.Loc.getMessage("IM_LIB_MENU_UNPIN_MSGVER_1"):F.Loc.getMessage("IM_LIB_MENU_PIN_MSGVER_1"),onClick:()=>{if(s){this.chatService.unpinChat(t)}else{this.chatService.pinChat(t);f.Analytics.getInstance().chatPins.onPin(t)}this.menuInstance.close()}}}getMuteItem(){const{dialogId:e}=this.context;const t=this.permissionManager.canPerformActionByRole(H.ActionByRole.mute,e);if(!t){return null}const s=this.store.getters["chats/get"](e,true);const i=s.muteList.includes(E.Core.getUserId());return{title:i?F.Loc.getMessage("IM_LIB_MENU_UNMUTE_2"):F.Loc.getMessage("IM_LIB_MENU_MUTE_2"),onClick:()=>{if(i){this.chatService.unmuteChat(e)}else{this.chatService.muteChat(e)}this.menuInstance.close()}}}getOpenProfileItem(){if(!this.isUser()||this.isBot()){return null}const e=v.Utils.user.getProfileLink(this.context.dialogId);return{title:F.Loc.getMessage("IM_LIB_MENU_OPEN_PROFILE_V2"),onClick:()=>{BX.SidePanel.Instance.open(e);this.menuInstance.close()}}}getHideItem(){if(!babelHelpers.classPrivateFieldLooseBase(this,G)[G]()){return null}return{title:F.Loc.getMessage("IM_LIB_MENU_HIDE_MSGVER_1"),onClick:()=>{a.LegacyRecentService.getInstance().hideChat(this.context.dialogId);this.menuInstance.close()}}}getLeaveItem(){if(this.isCollabChat()){return babelHelpers.classPrivateFieldLooseBase(this,X)[X]()}return babelHelpers.classPrivateFieldLooseBase(this,K)[K]()}getChatsWithUserItem(){if(!this.isUser()||this.isBot()||this.isChatWithCurrentUser()){return null}const e=this.store.getters["application/getLayout"].entityId.length>0;return{title:F.Loc.getMessage("IM_LIB_MENU_FIND_SHARED_CHATS"),onClick:async()=>{if(!e){await l.Messenger.openChat(this.context.dialogId)}this.emitter.emit(H.EventType.sidebar.open,{panel:H.SidebarDetailBlock.chatsWithUser,standalone:true,dialogId:this.context.dialogId});this.menuInstance.close()}}}getInviteItems(){const{recentItem:e}=this.context;if(!e){return[]}const t=[];let s;if(F.Type.isUndefined(BX.MessengerProxy)){s=true;console.error("BX.MessengerProxy.canInvite() method not found in v2 version!")}else{s=BX.MessengerProxy.canInvite()}const i=s&&E.Core.getUserId()===e.invitation.originator;if(i){t.push(this.getResendInviteItem(),this.getCancelInviteItem())}return t}getResendInviteItem(){const{recentItem:e,dialogId:t}=this.context;if(!e||!babelHelpers.classPrivateFieldLooseBase(this,V)[V]()){return null}return{title:F.Loc.getMessage("IM_LIB_INVITE_RESEND"),onClick:()=>{r.InviteManager.resendInvite(t);this.menuInstance.close()}}}getCancelInviteItem(){return{title:F.Loc.getMessage("IM_LIB_INVITE_CANCEL"),onClick:()=>{n.MessageBox.show({message:F.Loc.getMessage("IM_LIB_INVITE_CANCEL_CONFIRM"),modal:true,buttons:n.MessageBoxButtons.OK_CANCEL,onOk:e=>{r.InviteManager.cancelInvite(this.context.dialogId);e.close()},onCancel:e=>{e.close()}});this.menuInstance.close()}}}getChat(){return this.store.getters["chats/get"](this.context.dialogId,true)}isUser(){return this.store.getters["chats/isUser"](this.context.dialogId)}isBot(){if(!this.isUser()){return false}const e=this.store.getters["users/get"](this.context.dialogId);return e.type===H.UserType.bot}isChannel(){return L.ChannelManager.isChannel(this.context.dialogId)}isCommentsChat(){const{type:e}=this.store.getters["chats/get"](this.context.dialogId,true);return e===H.ChatType.comment}isCollabChat(){const{type:e}=this.store.getters["chats/get"](this.context.dialogId,true);return e===H.ChatType.collab}isChatWithCurrentUser(){return this.getCurrentUserId()===Number.parseInt(this.context.dialogId,10)}}function Y(){const e=this.permissionManager.canPerformActionByRole(H.ActionByRole.leave,this.context.dialogId);if(!e){return null}const t=this.isChannel()?F.Loc.getMessage("IM_LIB_MENU_LEAVE_CHANNEL"):F.Loc.getMessage("IM_LIB_MENU_LEAVE_MSGVER_1");return{title:t,onClick:async()=>{this.menuInstance.close();const e=await x.showLeaveChatConfirm(this.context.dialogId);if(e===true){this.chatService.leaveChat(this.context.dialogId)}}}}function Q(){const e=this.permissionManager.canPerformActionByRole(H.ActionByRole.leave,this.context.dialogId);const t=this.permissionManager.canPerformActionByUserType(H.ActionByUserType.leaveCollab);if(!e||!t){return null}return{title:F.Loc.getMessage("IM_LIB_MENU_LEAVE_MSGVER_1"),onClick:async()=>{this.menuInstance.close();const e=await x.showLeaveChatConfirm(this.context.dialogId);if(!e){return}this.chatService.leaveCollab(this.context.dialogId)}}}function $(){const{recentItem:e,dialogId:t}=this.context;if(!e){return null}const s=babelHelpers.classPrivateFieldLooseBase(this,j)[j]();const i=e.isFakeElement;const n=this.store.getters["users/bots/isAiAssistant"](t);return!s&&!i&&!n}function q(){const{recentItem:e}=this.context;if(!e||!e.invitation){return false}return e.invitation.isActive}function z(){const{recentItem:e}=this.context;if(!e||!e.invitation){return false}return e.invitation.canResend}var J=babelHelpers.classPrivateFieldLooseKey("getKickItemText");var Z=babelHelpers.classPrivateFieldLooseKey("kickUser");class ee extends D{constructor(e){super();Object.defineProperty(this,Z,{value:se});Object.defineProperty(this,J,{value:te});this.id="bx-im-user-context-menu";this.permissionManager=b.PermissionManager.getInstance();const{emitter:t}=e;this.emitter=t}getKickItem(){const e=this.permissionManager.canPerformActionByRole(H.ActionByRole.kick,this.context.dialog.dialogId);if(!e){return null}return{title:babelHelpers.classPrivateFieldLooseBase(this,J)[J](),onClick:async()=>{this.menuInstance.close();const e=await x.showKickUserConfirm(this.context.dialog.dialogId);if(e!==true){return}void babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]()}}}getMentionItem(){return{title:F.Loc.getMessage("IM_LIB_MENU_USER_MENTION"),onClick:()=>{this.emitter.emit(H.EventType.textarea.insertMention,{mentionText:this.context.user.name,mentionReplacement:v.Utils.text.getMentionBbCode(this.context.user.id,this.context.user.name),dialogId:this.context.dialog.dialogId,isMentionSymbol:false});this.menuInstance.close()}}}getSendItem(){if(this.context.dialog.type===H.ChatType.user){return null}return{title:F.Loc.getMessage("IM_LIB_MENU_USER_WRITE"),onClick:()=>{void l.Messenger.openChat(this.context.user.id);this.menuInstance.close()}}}getProfileItem(){if(this.isBot()){return null}const e=v.Utils.user.getProfileLink(this.context.user.id);return{title:F.Loc.getMessage("IM_LIB_MENU_OPEN_PROFILE_V2"),onClick:()=>{BX.SidePanel.Instance.open(e);this.menuInstance.close()}}}isCollabChat(){const{type:e}=this.store.getters["chats/get"](this.context.dialog.dialogId,true);return e===H.ChatType.collab}isBot(){return this.context.user.type===H.UserType.bot}}function te(){if(this.isCollabChat()){return F.Loc.getMessage("IM_LIB_MENU_USER_KICK_FROM_COLLAB")}return F.Loc.getMessage("IM_LIB_MENU_USER_KICK_FROM_CHAT")}function se(){if(this.isCollabChat()){return(new c.ChatService).kickUserFromCollab(this.context.dialog.dialogId,this.context.user.id)}return(new c.ChatService).kickUserFromChat(this.context.dialog.dialogId,this.context.user.id)}const ie={first:"first",second:"second",third:"third"};const ne={first:"first",second:"second",third:"third"};var oe=babelHelpers.classPrivateFieldLooseKey("isStickerMessage");var ae=babelHelpers.classPrivateFieldLooseKey("needNestedMenu");var re=babelHelpers.classPrivateFieldLooseKey("getFirstFile");var le=babelHelpers.classPrivateFieldLooseKey("isSingleFile");var ce=babelHelpers.classPrivateFieldLooseKey("onDelete");var ge=babelHelpers.classPrivateFieldLooseKey("isDeletionCancelled");var de=babelHelpers.classPrivateFieldLooseKey("getDownloadSingleFileItem");var he=babelHelpers.classPrivateFieldLooseKey("getDownloadSeveralFilesItem");var ue=babelHelpers.classPrivateFieldLooseKey("arePinsExceedLimit");class Ie extends D{constructor(e){super();Object.defineProperty(this,ue,{value:Pe});Object.defineProperty(this,he,{value:fe});Object.defineProperty(this,de,{value:Le});Object.defineProperty(this,ge,{value:Ce});Object.defineProperty(this,ce,{value:be});Object.defineProperty(this,le,{value:ve});Object.defineProperty(this,re,{value:pe});Object.defineProperty(this,ae,{value:Me});Object.defineProperty(this,oe,{value:me});this.maxPins=20;this.id="bx-im-message-context-menu";this.diskService=new M.DiskService;this.marketManager=p.MarketManager.getInstance();const{emitter:t}=e;this.emitter=t}getMenuOptions(){return{...super.getMenuOptions(),className:this.getMenuClassName(),angle:true,offsetLeft:11,minWidth:238}}getMenuItems(){const e=[this.getReplyItem(),this.getCopyItem(),this.getEditItem(),this.getDownloadFileItem(),this.getForwardItem(),this.getAskCopilotItem(),this.getCreateTaskItem(),...this.getAdditionalItems()];const t=[this.getDeleteItem(),this.getSelectItem()];return[...this.groupItems(e,ie.first),...this.groupItems(t,ie.second)]}getMenuGroups(){return[{code:ie.first},{code:ie.second}]}getNestedMenuGroups(){return[{code:ne.first},{code:ne.second}]}getSelectItem(){if(this.isDeletedMessage()||!this.isRealMessage()){return null}return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_SELECT"),icon:k.Outline.CIRCLE_CHECK,onClick:()=>{f.Analytics.getInstance().messageContextMenu.onSelect(this.context.dialogId);this.emitter.emit(H.EventType.dialog.openBulkActionsMode,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}}}getReplyItem(){return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_REPLY"),onClick:()=>{f.Analytics.getInstance().messageContextMenu.onReply(this.context.dialogId);this.emitter.emit(H.EventType.textarea.replyMessage,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()},icon:k.Outline.QUOTE}}getForwardItem(){if(this.isDeletedMessage()||!this.isRealMessage()){return null}return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_FORWARD"),icon:k.Outline.FORWARD,onClick:()=>{f.Analytics.getInstance().messageContextMenu.onForward(this.context.dialogId);this.emitter.emit(H.EventType.dialog.showForwardPopup,{messagesIds:[this.context.id]});this.menuInstance.close()}}}getCopyItem(){if(this.isDeletedMessage()||this.context.text.trim().length===0){return null}return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY"),onClick:async()=>{f.Analytics.getInstance().messageContextMenu.onCopyText({dialogId:this.context.dialogId,messageId:this.context.id});const e=u.Parser.prepareCopy(this.context);await v.Utils.text.copyToClipboard(e);_.Notifier.message.onCopyComplete();this.menuInstance.close()},icon:k.Outline.COPY}}getCopyLinkItem(){return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_LINK_MSGVER_1"),icon:k.Outline.LINK,onClick:()=>{var e;f.Analytics.getInstance().messageContextMenu.onCopyLink(this.context.dialogId);const t=g.ChatManager.buildMessageLink(this.context.dialogId,this.context.id);if((e=BX.clipboard)!=null&&e.copy(t)){_.Notifier.message.onCopyLinkComplete()}this.menuInstance.close()}}}getCopyFileItem(){if(this.context.files.length!==1){return null}return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_COPY_FILE"),icon:k.Outline.COPY,onClick:()=>{var e;const t=this.context.files[0];f.Analytics.getInstance().messageContextMenu.onCopyFile({dialogId:this.context.dialogId,fileId:t});const s=u.Parser.prepareCopyFile(this.context);if((e=BX.clipboard)!=null&&e.copy(s)){_.Notifier.file.onCopyComplete()}this.menuInstance.close()}}}getPinItem(){const e=b.PermissionManager.getInstance().canPerformActionByRole(H.ActionByRole.pinMessage,this.context.dialogId);if(this.isDeletedMessage()||!e){return null}const t=this.store.getters["messages/pin/isPinned"]({chatId:this.context.chatId,messageId:this.context.id});return{title:t?F.Loc.getMessage("IM_DIALOG_CHAT_MENU_UNPIN"):F.Loc.getMessage("IM_DIALOG_CHAT_MENU_PIN"),icon:k.Outline.PIN,onClick:()=>{const e=new m.MessageService({chatId:this.context.chatId});if(t){e.unpinMessage(this.context.chatId,this.context.id);f.Analytics.getInstance().messageContextMenu.onUnpin(this.context.dialogId)}else{if(babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()){_.Notifier.chat.onMessagesPinLimitError(this.maxPins);f.Analytics.getInstance().messageContextMenu.onReachingPinsLimit(this.context.dialogId);this.menuInstance.close();return}e.pinMessage(this.context.chatId,this.context.id);f.Analytics.getInstance().messageContextMenu.onPin(this.context.dialogId)}this.menuInstance.close()}}}getFavoriteItem(){if(this.isDeletedMessage()){return null}const e=this.store.getters["sidebar/favorites/isFavoriteMessage"](this.context.chatId,this.context.id);const t=e?F.Loc.getMessage("IM_DIALOG_CHAT_MENU_REMOVE_FROM_SAVED"):F.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE");return{title:t,icon:k.Outline.FAVORITE,onClick:()=>{const t=new m.MessageService({chatId:this.context.chatId});if(e){t.removeMessageFromFavorite(this.context.id)}else{f.Analytics.getInstance().messageContextMenu.onAddFavorite({dialogId:this.context.dialogId,messageId:this.context.id});t.addMessageToFavorite(this.context.id)}this.menuInstance.close()}}}getMarkItem(){const e=this.context.viewed&&!this.isOwnMessage();const t=this.store.getters["chats/getByChatId"](this.context.chatId);const s=this.context.id===t.markedId;if(!e||s){return null}return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_MARK"),icon:k.Outline.NEW_MESSAGE,onClick:()=>{f.Analytics.getInstance().messageContextMenu.onMark(this.context.dialogId);const e=new m.MessageService({chatId:this.context.chatId});e.markMessage(this.context.id);this.menuInstance.close()}}}getCreateTaskItem(){if(this.isDeletedMessage()||babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]()){return null}return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_TASK_MSGVER_1"),icon:k.Outline.TASK,onClick:()=>{f.Analytics.getInstance().messageContextMenu.onCreateTask(this.context.dialogId);const e=new I.EntityCreator(this.context.chatId);void e.createTaskForMessage(this.context.id);this.menuInstance.close()}}}getCreateMeetingItem(){if(this.isDeletedMessage()||babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]()){return null}return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_CREATE_MEETING_MSGVER_1"),icon:k.Outline.CALENDAR_WITH_SLOTS,onClick:()=>{f.Analytics.getInstance().messageContextMenu.onCreateEvent(this.context.dialogId);const e=new I.EntityCreator(this.context.chatId);void e.createMeetingForMessage(this.context.id);this.menuInstance.close()}}}getEditItem(){if(!d.MessageManager.isEditable(this.context.id)){return null}return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_EDIT"),icon:k.Outline.EDIT_L,onClick:()=>{f.Analytics.getInstance().messageContextMenu.onEdit(this.context.dialogId);this.emitter.emit(H.EventType.textarea.editMessage,{messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}}}getAskCopilotItem(){if(!C.FeatureManager.isFeatureAvailable(C.Feature.isCopilotMentionAvailable)){return null}if(!this.canSendMessage()||this.isDeletedMessage()){return null}const e=L.ChannelManager.isChannel(this.context.dialogId);if(e){return null}const t=this.store.getters["users/bots/getCopilotBotDialogId"];const{name:s}=this.store.getters["users/get"](t,true);return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_ASK_COPILOT"),icon:k.Outline.COPILOT,design:B.MenuItemDesign.Copilot,onClick:()=>{f.Analytics.getInstance().messageContextMenu.onAskCopilot(this.context.dialogId);this.emitter.emit(H.EventType.textarea.insertMention,{mentionText:s,mentionReplacement:v.Utils.text.getMentionBbCode(t,s),dialogId:this.context.dialogId});this.emitter.emit(H.EventType.textarea.replyMessage,{messageId:this.context.id,dialogId:this.context.dialogId})}}}getDeleteItem(){if(this.isDeletedMessage()){return null}const e=b.PermissionManager.getInstance();const t=e.canPerformActionByRole(H.ActionByRole.deleteOthersMessage,this.context.dialogId);if(!this.isOwnMessage()&&!t){return null}return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_DELETE"),design:B.MenuItemDesign.Alert,icon:k.Outline.TRASHCAN,onClick:babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].bind(this)}}getMarketItems(){const{dialogId:e,id:t}=this.context;const s=this.marketManager.getAvailablePlacementsByType(H.PlacementType.contextMenu,e);const i=[];const n={messageId:t,dialogId:e};s.forEach((e=>{i.push({title:e.title,icon:k.Outline.MARKET,onClick:()=>{void p.MarketManager.openSlider(e,n);this.menuInstance.close()}})}));const o=10;return i.slice(0,o)}getDownloadFileItem(){if(!F.Type.isArrayFilled(this.context.files)){return null}if(babelHelpers.classPrivateFieldLooseBase(this,le)[le]()){return babelHelpers.classPrivateFieldLooseBase(this,de)[de]()}return babelHelpers.classPrivateFieldLooseBase(this,he)[he]()}getSaveToDiskItem(){if(!F.Type.isArrayFilled(this.context.files)){return null}const e=babelHelpers.classPrivateFieldLooseBase(this,le)[le]()?F.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ON_DISK_MSGVER_1"):F.Loc.getMessage("IM_DIALOG_CHAT_MENU_SAVE_ALL_ON_DISK");return{title:e,icon:k.Outline.FOLDER_24,onClick:async function(){f.Analytics.getInstance().messageContextMenu.onSaveOnDisk({messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close();await this.diskService.save(this.context.files);_.Notifier.file.onDiskSaveComplete(babelHelpers.classPrivateFieldLooseBase(this,le)[le]())}.bind(this)}}getAdditionalItems(){const e=this.getNestedItems();if(babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](e)){return[{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_MORE"),subMenu:{items:e,sections:this.getNestedMenuGroups()}}]}return e}getNestedItems(){const e=[this.getPinItem(),this.getCopyLinkItem(),this.getCopyFileItem(),this.getMarkItem(),this.getFavoriteItem(),this.getSaveToDiskItem(),this.getCreateMeetingItem()];return[...this.groupItems(e,ne.first),...this.groupItems(this.getMarketItems(),ne.second)]}isOwnMessage(){return this.context.authorId===E.Core.getUserId()}isDeletedMessage(){return this.context.isDeleted}isRealMessage(){return this.store.getters["messages/isRealMessage"](this.context.id)}canSendMessage(){const e=E.Core.getStore().getters["chats/get"](this.context.dialogId,true);if(!e.isTextareaEnabled){return false}return b.PermissionManager.getInstance().canPerformActionByRole(H.ActionByRole.send,this.context.dialogId)}}function me(){return this.store.getters["stickers/messages/isSticker"](this.context.id)}function Me(e){const t=3;const s=e.filter((e=>e!==null));return s.length>=t}function pe(){return this.store.getters["files/get"](this.context.files[0])}function ve(){return this.context.files.length===1}async function be(){const{id:e,dialogId:t,chatId:s}=this.context;f.Analytics.getInstance().messageContextMenu.onDelete({messageId:e,dialogId:t});this.menuInstance.close();if(await babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]()){return}const i=new m.MessageService({chatId:s});i.deleteMessages([e])}async function Ce(){const{id:e,dialogId:t}=this.context;if(!L.ChannelManager.isChannel(t)){return false}const s=await x.showDeleteChannelPostConfirm();if(!s){f.Analytics.getInstance().messageContextMenu.onCancelDelete({messageId:e,dialogId:t});return true}return false}function Le(){const e=babelHelpers.classPrivateFieldLooseBase(this,re)[re]();return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_DOWNLOAD_FILE"),icon:k.Outline.DOWNLOAD,onClick:function(){v.Utils.file.downloadFiles([e]);f.Analytics.getInstance().messageContextMenu.onFileDownload({messageId:this.context.id,dialogId:this.context.dialogId});this.menuInstance.close()}.bind(this)}}function fe(){const e=this.context.files.map((e=>this.store.getters["files/get"](e)));return{title:F.Loc.getMessage("IM_DIALOG_CHAT_MENU_DOWNLOAD_FILES"),icon:k.Outline.DOWNLOAD,onClick:async()=>{var t;f.Analytics.getInstance().messageContextMenu.onFileDownload({messageId:this.context.id,dialogId:this.context.dialogId});v.Utils.file.downloadFiles(e);const s=h.PromoManager.getInstance().needToShow(H.PromoId.downloadSeveralFiles);if(s&&v.Utils.browser.isChrome()&&!v.Utils.platform.isBitrixDesktop()){var i;(i=this.menuInstance)==null?void 0:i.close();await x.showDownloadAllFilesConfirm();void h.PromoManager.getInstance().markAsWatched(H.PromoId.downloadSeveralFiles)}(t=this.menuInstance)==null?void 0:t.close()}}}function Pe(){const e=this.store.getters["messages/pin/getPinned"](this.context.chatId);return e.length>=this.maxPins}class ye extends Ie{getMenuItems(){const e=[this.getCopyItem(),this.getEditItem(),this.getDownloadFileItem(),this.getForwardItem(),this.getAskCopilotItem(),this.getCreateTaskItem(),...this.getAdditionalItems()];const t=[this.getDeleteItem(),this.getSelectItem()];return[...this.groupItems(e,ie.first),...this.groupItems(t,ie.second)]}getNestedItems(){const e=[this.getPinItem(),this.getCopyLinkItem(),this.getCopyFileItem(),this.getMarkItem(),this.getFavoriteItem(),this.getSaveToDiskItem(),this.getCreateMeetingItem()];return this.groupItems(e,ne.first)}getNestedMenuGroups(){return[{code:ne.first}]}}var _e=babelHelpers.classPrivateFieldLooseKey("getCommentsPostMenuItems");var xe=babelHelpers.classPrivateFieldLooseKey("getDefaultMenuItems");class Fe extends Ie{constructor(...e){super(...e);Object.defineProperty(this,xe,{value:Be});Object.defineProperty(this,_e,{value:ke})}getMenuItems(){const e=this.context;const t=this.context.dialogId;if(L.ChannelManager.isCommentsPostMessage(e,t)){return babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]()}return babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]()}getNestedItems(){const e=[this.getCopyFileItem(),this.getFavoriteItem(),this.getSaveToDiskItem(),this.getCreateMeetingItem()];return this.groupItems(e,ne.first)}getMenuGroups(){return[{code:ie.first},{code:ie.second},{code:ie.third}]}getNestedMenuGroups(){return[{code:ne.first}]}getOpenInChannelItem(){return{title:F.Loc.getMessage("IM_LIB_MENU_COMMENTS_OPEN_IN_CHANNEL"),icon:k.Outline.GO_TO_MESSAGE,onClick:()=>{this.emitter.emit(H.EventType.dialog.closeComments);this.menuInstance.close()}}}}function ke(){const e=[this.getCopyItem(),this.getCopyFileItem()];const t=[this.getDownloadFileItem(),this.getSaveToDiskItem()];return[...this.groupItems(e,ie.first),...this.groupItems(t,ie.second),...this.groupItems([this.getOpenInChannelItem()],ie.third)]}function Be(){const e=[this.getReplyItem(),this.getCopyItem(),this.getEditItem(),this.getDownloadFileItem(),this.getAskCopilotItem(),this.getCreateTaskItem(),...this.getAdditionalItems()];return[...this.groupItems(e,ie.first),...this.groupItems([this.getDeleteItem()],ie.second)]}var Ee=babelHelpers.classPrivateFieldLooseKey("openForm");var Ae=babelHelpers.classPrivateFieldLooseKey("getUserCounter");class Oe extends Ie{constructor(...e){super(...e);Object.defineProperty(this,Ae,{value:Se});Object.defineProperty(this,Ee,{value:He})}getMenuItems(){const e=[this.getCopyItem(),this.getMarkItem(),this.getFavoriteItem(),this.getForwardItem(),this.getSendFeedbackItem()];const t=[this.getDeleteItem(),this.getSelectItem()];return[...this.groupItems(e,ie.first),...this.groupItems(t,ie.second)]}getSendFeedbackItem(){const e=new P.CopilotManager;if(!e.isCopilotBot(this.context.authorId)){return null}return{title:F.Loc.getMessage("IM_LIB_MENU_AI_ASSISTANT_FEEDBACK"),icon:k.Outline.FEEDBACK,onClick:()=>{f.Analytics.getInstance().messageContextMenu.onSendFeedback(this.context.dialogId);void babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]();this.menuInstance.close()}}}}async function He(){void(new y.FeedbackManager).openCopilotForm({userCounter:babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae](),text:this.context.text})}function Se(){const e=this.store.getters["chats/get"](this.context.dialogId);return e.userCounter}class Ne extends Ie{getMenuItems(){const e=[this.getCopyItem(),this.getDownloadFileItem(),this.getForwardItem(),this.getCreateTaskItem(),...this.getAdditionalItems()];return this.groupItems(e,ie.first)}getNestedItems(){const e=[this.getCopyFileItem(),this.getMarkItem(),this.getFavoriteItem(),this.getSaveToDiskItem(),this.getCreateMeetingItem()];return[...this.groupItems(e,ne.first),...this.groupItems([this.getSendFeedbackItem()],ne.second),...this.groupItems(this.getMarketItems(),ne.third)]}getNestedMenuGroups(){return[{code:ne.first},{code:ne.second},{code:ne.third}]}getSendFeedbackItem(){const e=E.Core.getStore().getters["users/bots/isAiAssistant"](this.context.authorId);if(!e){return null}return{title:F.Loc.getMessage("IM_LIB_MENU_AI_ASSISTANT_FEEDBACK"),icon:k.Outline.FEEDBACK,onClick:()=>{void(new y.FeedbackManager).openAiAssistantForm({});this.menuInstance.close()}}}}class Te extends Ie{getMenuItems(){const e=[this.getReplyItem(),this.getCopyItem(),this.getEditItem(),this.getDownloadFileItem(),this.getAskCopilotItem(),this.getCreateTaskItem(),this.getAddResultItem(),this.getRemoveResultItem(),...this.getAdditionalItems()];const t=[this.getDeleteItem()];return[...this.groupItems(e,ie.first),...this.groupItems(t,ie.second)]}getNestedItems(){const e=[this.getPinItem(),this.getCopyLinkItem(),this.getCopyFileItem(),this.getFavoriteItem(),this.getSaveToDiskItem(),this.getCreateMeetingItem()];return this.groupItems(e,ne.first)}getMenuGroups(){return[{code:ie.first},{code:ie.second}]}getNestedMenuGroups(){return[{code:ne.first}]}getAddResultItem(){return null}getRemoveResultItem(){return null}}var De=babelHelpers.classPrivateFieldLooseKey("instance");var Ue=babelHelpers.classPrivateFieldLooseKey("defaultMenuByCallback");var Re=babelHelpers.classPrivateFieldLooseKey("customMenuByCallback");var we=babelHelpers.classPrivateFieldLooseKey("menuByMessageType");var Ke=babelHelpers.classPrivateFieldLooseKey("menuInstance");var Xe=babelHelpers.classPrivateFieldLooseKey("resolveMenuClass");var Ge=babelHelpers.classPrivateFieldLooseKey("registerDefaultMenus");var je=babelHelpers.classPrivateFieldLooseKey("isCustomMenuAllowed");var Ve=babelHelpers.classPrivateFieldLooseKey("getDefaultMenuClass");var We=babelHelpers.classPrivateFieldLooseKey("getCustomMenuClass");var Ye=babelHelpers.classPrivateFieldLooseKey("getClassByMap");var Qe=babelHelpers.classPrivateFieldLooseKey("getChatType");var $e=babelHelpers.classPrivateFieldLooseKey("isChannel");var qe=babelHelpers.classPrivateFieldLooseKey("isComment");var ze=babelHelpers.classPrivateFieldLooseKey("isCopilot");var Je=babelHelpers.classPrivateFieldLooseKey("isAiAssistant");var Ze=babelHelpers.classPrivateFieldLooseKey("isTaskComments");var et=babelHelpers.classPrivateFieldLooseKey("hasMenuForMessageType");var tt=babelHelpers.classPrivateFieldLooseKey("getMenuForMessageType");class st{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,De)[De]){babelHelpers.classPrivateFieldLooseBase(this,De)[De]=new st}return babelHelpers.classPrivateFieldLooseBase(this,De)[De]}constructor(){Object.defineProperty(this,tt,{value:Mt});Object.defineProperty(this,et,{value:mt});Object.defineProperty(this,Ze,{value:It});Object.defineProperty(this,Je,{value:ut});Object.defineProperty(this,ze,{value:ht});Object.defineProperty(this,qe,{value:dt});Object.defineProperty(this,$e,{value:gt});Object.defineProperty(this,Qe,{value:ct});Object.defineProperty(this,Ye,{value:lt});Object.defineProperty(this,We,{value:rt});Object.defineProperty(this,Ve,{value:at});Object.defineProperty(this,je,{value:ot});Object.defineProperty(this,Ge,{value:nt});Object.defineProperty(this,Xe,{value:it});Object.defineProperty(this,Ue,{writable:true,value:new Map});Object.defineProperty(this,Re,{writable:true,value:new Map});Object.defineProperty(this,we,{writable:true,value:new Map});Object.defineProperty(this,Ke,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]()}openMenu(e){this.destroyMenuInstance();const{messageContext:t,target:s,applicationContext:i}=e;const n=babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe](t);babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]=new n(i);babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke].openMenu(t,s)}registerMenuByCallback(e,t){babelHelpers.classPrivateFieldLooseBase(this,Re)[Re].set(e,t)}unregisterMenuByCallback(e){babelHelpers.classPrivateFieldLooseBase(this,Re)[Re].delete(e)}destroyMenuInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]){return}babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke].destroy();babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]=null}shouldUseNativeContextMenu(e){return Boolean(e.closest(`[${H.DataAttribute.useNativeContextMenu}]`))}registerMenuByMessageType(e,t){if(babelHelpers.classPrivateFieldLooseBase(this,et)[et](e)){return}babelHelpers.classPrivateFieldLooseBase(this,we)[we].set(e,t)}}function it(e){if(!babelHelpers.classPrivateFieldLooseBase(this,je)[je](e)){return babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve](e)}const t=babelHelpers.classPrivateFieldLooseBase(this,We)[We](e);return t!=null?t:babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve](e)}function nt(){babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].set(babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].bind(this),ye);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].set(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe].bind(this),Fe);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].set(babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].bind(this),Oe);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].set(babelHelpers.classPrivateFieldLooseBase(this,Je)[Je].bind(this),Ne);babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue].set(babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze].bind(this),Te)}function ot(e){return!L.ChannelManager.isCommentsPostMessage(e,e.dialogId)}function at(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye](babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue],e);return t!=null?t:Ie}function rt(e){if(babelHelpers.classPrivateFieldLooseBase(this,et)[et](e.componentId)){return babelHelpers.classPrivateFieldLooseBase(this,tt)[tt](e.componentId)}return babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye](babelHelpers.classPrivateFieldLooseBase(this,Re)[Re],e)}function lt(e,t){const s=e.entries();for(const[e,i]of s){if(e(t)){return i}}return null}function ct(e){const t=E.Core.getStore().getters["chats/get"](e,true);return t.type}function gt(e){return L.ChannelManager.isChannel(e.dialogId)}function dt(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe](e.dialogId);return t===H.ChatType.comment}function ht(e){return(new P.CopilotManager).isCopilotChat(e.dialogId)}function ut(e){return E.Core.getStore().getters["users/bots/isAiAssistant"](e.dialogId)}function It(e){const t=babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe](e.dialogId);return t===H.ChatType.taskComments}function mt(e){return babelHelpers.classPrivateFieldLooseBase(this,we)[we].has(e)}function Mt(e){return babelHelpers.classPrivateFieldLooseBase(this,we)[we].get(e)}Object.defineProperty(st,De,{writable:true,value:null});const pt={first:"first",second:"second"};var vt=babelHelpers.classPrivateFieldLooseKey("isPackOwner");var bt=babelHelpers.classPrivateFieldLooseKey("isVendorStickerPack");var Ct=babelHelpers.classPrivateFieldLooseKey("canUnlinkPack");var Lt=babelHelpers.classPrivateFieldLooseKey("canDeletePack");class ft extends D{constructor(){super();Object.defineProperty(this,Lt,{value:xt});Object.defineProperty(this,Ct,{value:_t});Object.defineProperty(this,bt,{value:yt});Object.defineProperty(this,vt,{value:Pt});this.id=H.PopupType.stickerPackContextMenu}getMenuOptions(){return{...super.getMenuOptions(),angle:false}}getMenuItems(){if(this.context.isRecent){return[this.getClearRecentItem()]}return[...this.groupItems([this.getEditPackItem()],pt.first),...this.groupItems([this.getUnlinkPackItem(),this.getDeletePackItem()],pt.second)]}getMenuGroups(){return this.getMenuItems().map((e=>({code:e.sectionCode})))}getEditPackItem(){if(!babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]()){return null}return{title:F.Loc.getMessage("IM_LIB_MENU_EDIT_STICKER_PACK"),icon:k.Outline.EDIT_M,onClick:()=>{this.emit("openEditor")}}}getDeletePackItem(){if(!babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]()){return null}return{title:F.Loc.getMessage("IM_LIB_MENU_REMOVE_STICKER_PACK"),design:B.MenuItemDesign.Alert,icon:k.Outline.TRASHCAN,onClick:async()=>{const e=await x.showStickerPackDeleteConfirm();if(!e){return}this.emit("closeParentPopup");await O.StickerService.getInstance().deletePack({id:this.context.pack.id,type:this.context.pack.type});_.Notifier.sticker.onRemovePackComplete()}}}getUnlinkPackItem(){if(!babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]()){return null}return{title:F.Loc.getMessage("IM_LIB_MENU_UNLINK_STICKER_PACK"),design:B.MenuItemDesign.Alert,icon:k.Outline.TRASHCAN,onClick:async()=>{const e=await x.showStickerPackUnlinkConfirm();if(!e){return}this.emit("closeParentPopup");await O.StickerService.getInstance().unlinkPack({id:this.context.pack.id,type:this.context.pack.type});_.Notifier.sticker.onRemovePackComplete()}}}getClearRecentItem(){return{title:F.Loc.getMessage("IM_LIB_MENU_CLEAR_RECENT_STICKERS"),icon:k.Outline.BROOM,onClick:()=>{void O.StickerService.getInstance().clearRecent()}}}}function Pt(){return this.context.pack.authorId===E.Core.getUserId()}function yt(){return this.context.packType===H.StickerPackType.vendor}function _t(){if(babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]()){return false}if(!this.context.pack.isAdded){return false}return!babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]()}function xt(){if(babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]()){return false}return babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]()}var Ft=babelHelpers.classPrivateFieldLooseKey("isPackOwner");class kt extends D{constructor(){super();Object.defineProperty(this,Ft,{value:Bt});this.id=H.PopupType.stickerContextMenu}getMenuOptions(){return{...super.getMenuOptions(),angle:false}}getMenuItems(){return[this.getSendItem(),this.getRemoveFromRecentItem(),this.getDeleteFromPackItem()]}getSendItem(){return{title:F.Loc.getMessage("IM_LIB_MENU_SEND_STICKER"),icon:k.Outline.SEND,onClick:()=>{this.emit("closeParentPopup");void A.SendingService.getInstance().sendMessageWithSticker({dialogId:this.context.dialogId,stickerParams:{id:this.context.sticker.id,packId:this.context.sticker.packId,packType:this.context.sticker.packType}});this.menuInstance.close()}}}getDeleteFromPackItem(){if(this.context.isRecent){return null}const e=babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]();if(!e){return null}return{title:F.Loc.getMessage("IM_LIB_MENU_REMOVE_STICKER"),design:B.MenuItemDesign.Alert,icon:k.Outline.TRASHCAN,onClick:()=>{void O.StickerService.getInstance().deleteStickerFromPack({ids:[this.context.sticker.id],packId:this.context.sticker.packId,packType:this.context.sticker.packType});this.menuInstance.close()}}}getRemoveFromRecentItem(){if(!this.context.isRecent){return null}return{title:F.Loc.getMessage("IM_LIB_MENU_REMOVE_RECENT_STICKER"),icon:k.Outline.CIRCLE_MINUS,design:B.MenuItemDesign.Alert,onClick:()=>{void O.StickerService.getInstance().removeFromRecent({id:this.context.sticker.id,packId:this.context.sticker.packId,packType:this.context.sticker.packType})}}}}function Bt(){const e=E.Core.getStore().getters["stickers/packs/getByIdentifier"]({id:this.context.sticker.packId,type:this.context.sticker.packType});if(!e){return false}return e.authorId===E.Core.getUserId()}e.BaseMenu=D;e.RecentMenu=W;e.UserMenu=ee;e.MessageMenuManager=st;e.MessageMenu=Ie;e.AiAssistantMessageMenu=Ne;e.StickerPackMenu=ft;e.StickerMenu=kt;e.TaskCommentsMessageMenu=Te})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Event,BX.Vue3.Vuex,BX,BX.UI.Dialogs,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.UI.IconSet,BX.UI.System,BX.Messenger.v2.Application,BX.Messenger.v2.Service,BX.Messenger.v2.Provider.Service,BX.Messenger.v2.Const);
//# sourceMappingURL=registry.bundle.map.js