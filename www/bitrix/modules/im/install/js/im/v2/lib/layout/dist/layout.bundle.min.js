this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,a,i,o,l,r,n,c,d,b){"use strict";const u=new Set([l.ChatType.comment]);const y=new Set([l.Layout.channel,l.Layout.market,l.Layout.taskComments]);var v=babelHelpers.classPrivateFieldLooseKey("instance");var L=babelHelpers.classPrivateFieldLooseKey("emitter");var h=babelHelpers.classPrivateFieldLooseKey("lastOpenedElement");var p=babelHelpers.classPrivateFieldLooseKey("onGoToMessageContext");var g=babelHelpers.classPrivateFieldLooseKey("onDesktopReload");var P=babelHelpers.classPrivateFieldLooseKey("sendAnalytics");var f=babelHelpers.classPrivateFieldLooseKey("isSameChat");var m=babelHelpers.classPrivateFieldLooseKey("handleLayoutChange");var B=babelHelpers.classPrivateFieldLooseKey("handleChatChange");var H=babelHelpers.classPrivateFieldLooseKey("handleSameChatReopen");var F=babelHelpers.classPrivateFieldLooseKey("clearBulkActionsCollection");var C=babelHelpers.classPrivateFieldLooseKey("closeChannelComments");var I=babelHelpers.classPrivateFieldLooseKey("handleContextAccess");var M=babelHelpers.classPrivateFieldLooseKey("getChat");class E{constructor(){Object.defineProperty(this,M,{value:R});Object.defineProperty(this,I,{value:w});Object.defineProperty(this,C,{value:k});Object.defineProperty(this,F,{value:x});Object.defineProperty(this,H,{value:T});Object.defineProperty(this,B,{value:S});Object.defineProperty(this,m,{value:A});Object.defineProperty(this,f,{value:j});Object.defineProperty(this,P,{value:K});Object.defineProperty(this,g,{value:X});Object.defineProperty(this,p,{value:O});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:{}})}static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,v)[v]){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=new this}return babelHelpers.classPrivateFieldLooseBase(this,v)[v]}bindEvents(e){const{emitter:t}=e;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=t;babelHelpers.classPrivateFieldLooseBase(this,L)[L].subscribe(l.EventType.dialog.goToMessageContext,babelHelpers.classPrivateFieldLooseBase(this,p)[p].bind(this));s.EventEmitter.subscribe(l.EventType.desktop.onReload,babelHelpers.classPrivateFieldLooseBase(this,g)[g].bind(this))}async setLayout(e){if(e.contextId){const t=await babelHelpers.classPrivateFieldLooseBase(this,I)[I](e);if(!t){return Promise.resolve()}}if(e.entityId){this.setLastOpenedElement(e.name,e.entityId)}if(babelHelpers.classPrivateFieldLooseBase(this,f)[f](e)){babelHelpers.classPrivateFieldLooseBase(this,H)[H](e)}else{babelHelpers.classPrivateFieldLooseBase(this,m)[m]()}babelHelpers.classPrivateFieldLooseBase(this,P)[P](e);return a.Core.getStore().dispatch("application/setLayout",e)}getLayout(){return a.Core.getStore().getters["application/getLayout"]}saveCurrentLayout(){const e=this.getLayout();o.LocalStorageManager.getInstance().set(l.LocalStorageKey.layoutConfig,{name:e.name,entityId:e.entityId})}prepareInitialLayout(){const e=o.LocalStorageManager.getInstance().get(l.LocalStorageKey.layoutConfig);if(!e){return this.setLayout({name:l.Layout.chat})}r.Logger.warn("LayoutManager: last layout was restored",e);o.LocalStorageManager.getInstance().remove(l.LocalStorageKey.layoutConfig);return this.setLayout(e)}getLastOpenedElement(e){var t;return(t=babelHelpers.classPrivateFieldLooseBase(this,h)[h][e])!=null?t:null}setLastOpenedElement(e,t){if(y.has(e)){return}babelHelpers.classPrivateFieldLooseBase(this,h)[h][e]=t}clearCurrentLayoutEntityId(){const e=this.getLayout().name;void this.setLayout({name:e});void this.deleteLastOpenedElement(e)}isChatContextAvailable(e){if(!this.getLayout().contextId){return false}const{type:t}=babelHelpers.classPrivateFieldLooseBase(this,M)[M](e);return!u.has(t)}destroy(){babelHelpers.classPrivateFieldLooseBase(this,L)[L].unsubscribe(l.EventType.dialog.goToMessageContext,babelHelpers.classPrivateFieldLooseBase(this,p)[p]);s.EventEmitter.unsubscribe(l.EventType.desktop.onReload,babelHelpers.classPrivateFieldLooseBase(this,g)[g].bind(this))}deleteLastOpenedElement(e){if(y.has(e)){return}delete babelHelpers.classPrivateFieldLooseBase(this,h)[h][e]}deleteLastOpenedElementById(e){Object.entries(babelHelpers.classPrivateFieldLooseBase(this,h)[h]).forEach((([t,s])=>{if(s===e){delete babelHelpers.classPrivateFieldLooseBase(this,h)[h][t]}}))}isEmbeddedMode(){return this.isQuickAccessHidden()}isQuickAccessHidden(){const e=t.Extension.getSettings("im.v2.lib.layout");return e.get("isQuickAccessHidden",false)}isValidLayout(e){return Object.values(l.Layout).includes(e)}isChatLayout(e){const t=[l.Layout.chat,l.Layout.channel,l.Layout.copilot,l.Layout.openlines,l.Layout.openlinesV2,l.Layout.collab,l.Layout.taskComments];return t.includes(e)}}async function O(e){const{dialogId:t,messageId:s}=e.getData();if(this.getLayout().entityId===t){return}const{type:a}=babelHelpers.classPrivateFieldLooseBase(this,M)[M](t);if(u.has(a)){return}void this.setLayout({name:l.Layout.chat,entityId:t,contextId:s})}function X(){this.saveCurrentLayout()}function K(e){const t=this.getLayout();if(t.name===e.name){return}if(e.name===l.Layout.copilot){i.Analytics.getInstance().copilot.onOpenTab()}i.Analytics.getInstance().onOpenTab(e.name)}function j(e){const{name:t,entityId:s}=this.getLayout();const a=t===e.name;const i=s&&s===e.entityId;return a&&i}function A(){babelHelpers.classPrivateFieldLooseBase(this,C)[C]();babelHelpers.classPrivateFieldLooseBase(this,B)[B]()}function S(){const{name:e,entityId:t}=this.getLayout();if(this.isChatLayout(e)&&t){babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}}function T(e){const{entityId:t,contextId:s}=e;babelHelpers.classPrivateFieldLooseBase(this,C)[C]();if(s){babelHelpers.classPrivateFieldLooseBase(this,L)[L].emit(l.EventType.dialog.goToMessageContext,{messageId:s,dialogId:t})}}function x(){b.BulkActionsManager.getInstance().clearCollection()}function k(){const{entityId:e=""}=this.getLayout();const t=n.ChannelManager.isChannel(e);if(t){babelHelpers.classPrivateFieldLooseBase(this,L)[L].emit(l.EventType.dialog.closeComments)}}async function w(e){const{contextId:t,entityId:s}=e;if(!t){return Promise.resolve(true)}const{hasAccess:a,errorCode:o}=await c.AccessManager.checkMessageAccess(t);if(!a&&o===l.ErrorCode.message.accessDeniedByTariff){i.Analytics.getInstance().historyLimit.onGoToContextLimitExceeded({dialogId:s});d.FeatureManager.chatHistory.openFeatureSlider();return Promise.resolve(false)}return Promise.resolve(true)}function R(e){return a.Core.getStore().getters["chats/get"](e,true)}Object.defineProperty(E,v,{writable:true,value:void 0});e.LayoutManager=E})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX,BX.Event,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=layout.bundle.map.js