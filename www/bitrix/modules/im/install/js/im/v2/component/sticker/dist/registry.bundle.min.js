this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(t,e,i,n,s,o,r,c,a,l,d,p,u,k,m,_,h){"use strict";const v={name:"StickerPackFormHeader",methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-sticker-pack-form-header__container">\n\t\t\t<div class="bx-im-sticker-pack-form-header__image"></div>\n\t\t\t<div class="bx-im-sticker-pack-form-header__content">\n\t\t\t\t<div class="bx-im-sticker-pack-form-header__title">\n\t\t\t\t\t{{ loc('IM_STICKER_PACK_FORM_WELCOME_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-sticker-pack-form-header__description">\n\t\t\t\t\t{{ loc('IM_STICKER_PACK_FORM_WELCOME_BODY') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const I={name:"UploadButton",components:{UiButton:r.Button,RichLoc:c.RichLoc},inject:["uploader"],computed:{ButtonSize:()=>r.ButtonSize,AirButtonStyle:()=>r.AirButtonStyle,OutlineIcons:()=>a.Outline,description(){return u.Loc.getMessage("IM_STICKER_PACK_FORM_DESCRIPTION")}},mounted(){this.uploader.assignBrowse(this.$refs.upload)},methods:{onHelpdeskLinkClick(){l.openHelpdeskArticle("26987270")},loc(t){return u.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-sticker-pack-form-upload-button__container">\n\t\t\t<div class="bx-im-sticker-pack-form-upload-button__button" ref="upload">\n\t\t\t\t<UiButton\n\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t:leftIcon="OutlineIcons.PLUS_L"\n\t\t\t\t\t:text="loc('IM_STICKER_PACK_FORM_ADD_FILES_BUTTON')"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="bx-im-sticker-pack-form-upload-button__description">\n\t\t\t\t<RichLoc\n\t\t\t\t\t:text="description"\n\t\t\t\t\tplaceholder="[url]"\n\t\t\t\t>\n\t\t\t\t\t<template #url="{ text }">\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass="bx-im-sticker-pack-form-upload-button__description-link" \n\t\t\t\t\t\t\t@click="onHelpdeskLinkClick"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ text }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</template>\n\t\t\t\t</RichLoc>\n\t\t\t</div>\n\t\t</div>\n\t`};const S="image/webp";const g=1024*500;const B=512;var P=babelHelpers.classPrivateFieldLooseKey("isValid");class C extends k.Filter{constructor(...t){super(...t);Object.defineProperty(this,P,{value:E})}apply(t){return new Promise(((e,i)=>{if(babelHelpers.classPrivateFieldLooseBase(this,P)[P](t)){e()}else{i(new k.UploaderError("UPLOADING_ERROR",u.Loc.getMessage("IM_STICKER_PACK_FORM_UPLOADING_LIMITS_WEBP")))}}))}}function E(t){if(t.getType()!==S){return true}if(t.isAnimated()){return false}const e=t.getSize()<=g;const i=t.getWidth()<=B&&t.getHeight()<=B;return e&&i}const M="im.v2.controller.sticker.stickerUploader";const b=50;const T=50*1024*1024;const f=["image/jpg","image/jpeg","image/png","image/webp"];var U=babelHelpers.classPrivateFieldLooseKey("fileIds");class F extends p.EventEmitter{constructor(){super();Object.defineProperty(this,U,{writable:true,value:new Set});this.setEventNamespace("BX.Messenger.v2.Textarea.StickersUploader")}getOptions(){return{controller:M,multiple:true,maxFileCount:b,autoUpload:true,maxFileSize:T,acceptedFileTypes:f,events:{[k.UploaderEvent.FILE_COMPLETE]:t=>{const{file:e}=t.getData();const i=e.getServerFileId();if(i){babelHelpers.classPrivateFieldLooseBase(this,U)[U].add(i);this.emit(F.UPLOAD_EVENT,[...babelHelpers.classPrivateFieldLooseBase(this,U)[U].values()])}},[k.UploaderEvent.FILE_REMOVE]:t=>{const{file:e}=t.getData();const i=e.getServerFileId();if(i){babelHelpers.classPrivateFieldLooseBase(this,U)[U].delete(i);this.emit(F.UPLOAD_EVENT,[...babelHelpers.classPrivateFieldLooseBase(this,U)[U].values()])}}},filters:[{type:k.FilterType.PREPARATION,filter:C}]}}}F.UPLOAD_EVENT="uploadedFiles";const O={readonly:false,hideDropArea:false,slots:{[d.TileWidgetSlot.BEFORE_DROP_AREA]:I}};const A={name:"UploaderWidget",components:{TileWidgetComponent:d.TileWidgetComponent},emits:["uploadedFiles"],computed:{UploaderWidgetOptions:()=>O,uploaderOptions(){return this.uploader.getOptions()}},created(){this.uploader=new F;this.uploader.subscribe(F.UPLOAD_EVENT,(t=>{const e=t.getData();this.$emit("uploadedFiles",e)}))},template:`\n\t\t<TileWidgetComponent\n\t\t\t:uploaderOptions="uploaderOptions"\n\t\t\t:widgetOptions="UploaderWidgetOptions"\n\t\t/>\n\t`};let L=t=>t,R,y;const x="im:sticker-pack-form";const K=700;const N={name:"StickerPackForm",components:{BInput:n.BInput,UiButton:r.Button,StickerPackFormHeader:v,UploaderWidget:A,UploadButton:I},props:{pack:{type:Object,default:()=>{}}},emits:["close"],data(){var t;return{uploadedFileIds:[],packName:((t=this.pack)==null?void 0:t.name)||""}},computed:{InputDesign:()=>n.InputDesign,AirButtonStyle:()=>r.AirButtonStyle,ButtonSize:()=>r.ButtonSize,hasUploadedFiles(){return this.uploadedFileIds.length>0},isUpdateMode(){return Boolean(this.pack)},saveButtonName(){if(this.isUpdateMode){return this.loc("IM_STICKER_PACK_FORM_BUTTON_SAVE")}return this.loc("IM_STICKER_PACK_FORM_BUTTON_CREATE")},contentContainer(){return u.Tag.render(R||(R=L`<div></div>`))},footerContainer(){return u.Tag.render(y||(y=L`<div></div>`))},title(){if(this.isUpdateMode){return u.Loc.getMessage("IM_STICKER_PACK_FORM_UPDATE_TITLE")}return u.Loc.getMessage("IM_STICKER_PACK_FORM_CREATE_TITLE")},description(){return u.Loc.getMessage("IM_STICKER_PACK_FORM_DESCRIPTION")}},created(){this.openSlider()},beforeUnmount(){this.closeSlider()},methods:{openSlider(){e.SidePanel.Instance.open(x,{cacheable:false,width:K,contentCallback:()=>this.createLayoutContent(),events:{onClose:()=>{this.$emit("close")}}})},closeSlider(){this.$emit("close");const t=e.SidePanel.Instance.getSlider(x);t==null?void 0:t.close()},createLayoutContent(){return i.Layout.createContent({title:this.title,design:{section:false,alignButtonsLeft:true},content:()=>this.contentContainer,buttons:()=>[this.footerContainer]})},onUploadedFiles(t){this.uploadedFileIds=t},onSave(){if(this.isUpdateMode){void this.updatePack();return}void this.createPack()},async createPack(){await o.StickerService.getInstance().createPack({uuids:this.uploadedFileIds,type:_.StickerPackType.custom,name:this.packName});s.Notifier.sticker.onCreatePackComplete();this.$emit("close")},async updatePack(){await o.StickerService.getInstance().updatePack({uuids:this.uploadedFileIds,id:this.pack.id,type:this.pack.type,name:this.packName});s.Notifier.sticker.onUpdatePackComplete();this.$emit("close")},loc(t){return u.Loc.getMessage(t)}},template:`\n\t\t<Teleport :to="contentContainer">\n\t\t\t<div class="bx-im-sticker-pack-form__section">\n\t\t\t\t<StickerPackFormHeader />\n\t\t\t\t<UploaderWidget @uploadedFiles="onUploadedFiles" />\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="hasUploadedFiles || isUpdateMode"\n\t\t\t\tclass="bx-im-sticker-pack-form__section"\n\t\t\t>\n\t\t\t\t<div class="bx-im-sticker-pack-form__pack-title">\n\t\t\t\t\t{{ loc('IM_STICKER_PACK_FORM_PACK_NAME') }}\n\t\t\t\t</div>\n\t\t\t\t<BInput v-model.trim="packName" :design="InputDesign.Primary" />\n\t\t\t</div>\n\t\t</Teleport>\n\t\t<Teleport :to="footerContainer">\n\t\t\t<div class="bx-im-sticker-pack-form__buttons">\n\t\t\t\t<UiButton\n\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t:text="saveButtonName"\n\t\t\t\t\t@click="onSave"\n\t\t\t\t/>\n\t\t\t\t<UiButton\n\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t\t:text="loc('IM_STICKER_PACK_FORM_BUTTON_CANCEL')"\n\t\t\t\t\t@click="$emit('close');"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</Teleport>\n\t`};const X={name:"AddStickerButton",components:{BIcon:h.BIcon,StickerPackForm:N},inject:["disableAutoHide","enableAutoHide"],props:{pack:{type:Object,required:true}},data(){return{showPackForm:false}},computed:{OutlineIcons:()=>h.Outline},methods:{onUpdatePackClick(){this.disableAutoHide();this.showPackForm=true},onPackFormClose(){this.enableAutoHide();this.showPackForm=false},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-stickers-add-sticker-button__container" @click="onUpdatePackClick">\n\t\t\t<div class="bx-im-stickers-add-sticker-button__button">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="OutlineIcons.PLUS_L"\n\t\t\t\t\t:title="loc('IM_TEXTAREA_STICKER_SELECTOR_STICKERS_RECENT')"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<StickerPackForm v-if="showPackForm" :pack="pack" @close="onPackFormClose" />\n\t\t</div>\n\t`};const D={name:"StickerItem",props:{sticker:{type:Object,required:true}},template:`\n\t\t<div class="bx-im-sticker-item__container">\n\t\t\t<img :src="sticker.uri" alt="" loading="lazy" draggable="false" />\n\t\t</div>\n\t`};const w={name:"PackStickers",components:{StickerItem:D,AddStickerButton:X},props:{pack:{type:Object,required:true},withAddButton:{type:Boolean,default:true}},emits:["clickSticker","openContextMenuSticker"],computed:{isRecentPack(){return this.pack.id===_.RecentPackId&&this.pack.type===_.RecentPackType},recentStickers(){return this.$store.getters["stickers/recent/get"]},stickers(){if(this.isRecentPack){return this.recentStickers}return this.$store.getters["stickers/getByPack"]({id:this.pack.id,type:this.pack.type})},canAddStickers(){if(!this.withAddButton){return false}if(this.pack.type!==_.StickerPackType.custom){return false}return this.pack.authorId===m.Core.getUserId()}},template:`\n\t\t<div class="bx-im-pack-stickers__container">\n\t\t\t<StickerItem\n\t\t\t\tv-for="sticker in stickers"\n\t\t\t\t:key="sticker.id"\n\t\t\t\t:sticker="sticker"\n\t\t\t\t@click="$emit('clickSticker', { event: $event, sticker })"\n\t\t\t\t@contextmenu.prevent="$emit('openContextMenuSticker', { event: $event, sticker })"\n\t\t\t/>\n\t\t\t<AddStickerButton v-if="canAddStickers" :pack="pack" />\n\t\t</div>\n\t`};t.StickerPackForm=N;t.PackStickers=w})(this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{},BX.SidePanel,BX.UI.SidePanel,BX.UI.System.Input.Vue,BX.Messenger.v2.Lib,BX.Messenger.v2.Provider.Service,BX.Vue3.Components,BX.UI.Vue3.Components,BX.UI.IconSet,BX.Messenger.v2.Lib,BX.UI.Uploader,BX.Event,BX,BX.UI.Uploader,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.UI.IconSet);
//# sourceMappingURL=registry.bundle.map.js