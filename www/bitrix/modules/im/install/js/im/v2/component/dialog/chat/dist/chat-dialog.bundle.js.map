{"version":3,"file":"chat-dialog.bundle.js","sources":["../src/classes/anchor-service.js","../src/classes/scroll-manager.js","../src/classes/pull-watch-manager.js","../src/classes/visible-messages-manager.js","../src/helpers/find-unique-numbers.js","../src/helpers/sequentialize.js","../src/components/pinned/pinned-message.js","../src/components/pinned/header/title.js","../src/components/pinned/header/counter-control.js","../src/components/pinned/header/header-pin.js","../src/components/pinned/header/header.js","../src/components/pinned/pinned-messages.js","../src/components/quote-button.js","../src/components/float-button.js","../src/components/scroll-button.js","../src/components/reactions-button.js","../src/components/mentions-button.js","../src/components/float-buttons.js","../src/chat-dialog.js"],"sourcesContent":["import { Core } from 'im.v2.application.core';\nimport { runAction } from 'im.v2.lib.rest';\nimport { RestMethod } from 'im.v2.const';\n\nconst DEBOUNCE_TIME = 50;\n\nexport class AnchorService\n{\n\t#store: Store;\n\tmessagesToRead: Set<number> = new Set();\n\t#timerBeforeSendRequest = null;\n\n\tconstructor() {\n\t\tthis.#store = Core.getStore();\n\t}\n\n\treadChatAnchors(chatId: number): void\n\t{\n\t\trunAction(RestMethod.imV2ChatAnchorRead, {\n\t\t\tdata: {\n\t\t\t\tchatId,\n\t\t\t},\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.#store.dispatch('messages/anchors/removeChatAnchors', chatId);\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error('AnchorService: read chat anchors error', error);\n\t\t\t})\n\t\t;\n\t}\n\n\tdebouncedReadMessageAnchors(messageId: number): void\n\t{\n\t\tthis.messagesToRead.add(messageId);\n\t\tthis.#store.dispatch('messages/anchors/removeUserAnchorsFromMessage', messageId);\n\n\t\tif (this.#timerBeforeSendRequest)\n\t\t{\n\t\t\tclearTimeout(this.#timerBeforeSendRequest);\n\t\t\tthis.#timerBeforeSendRequest = null;\n\t\t}\n\n\t\tthis.#timerBeforeSendRequest = setTimeout(() => {\n\t\t\treturn this.#batchReadMessageAnchors();\n\t\t}, DEBOUNCE_TIME);\n\n\t\treturn Promise.resolve();\n\t}\n\n\t#batchReadMessageAnchors(): void\n\t{\n\t\tif (this.messagesToRead.size === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\trunAction(RestMethod.imV2AnchorRead, {\n\t\t\tdata: {\n\t\t\t\tmessageIds: [...this.messagesToRead],\n\t\t\t},\n\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error('AnchorService: read anchor error', error);\n\t\t\t})\n\t\t;\n\n\t\tthis.messagesToRead.clear();\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { Animation } from 'im.v2.lib.animation';\n\nconst EVENT_NAMESPACE = 'BX.Messenger.v2.Dialog.ScrollManager';\n\nexport class ScrollManager extends EventEmitter\n{\n\tcontainer: HTMLElement;\n\tisScrolling: boolean = false;\n\tcurrentScroll: number = 0;\n\tlastScroll: number = 0;\n\tchatIsScrolledUp: boolean = false;\n\tscrollButtonClicked: boolean = false;\n\tstartScrollNeeded: boolean = true;\n\n\tstatic events = {\n\t\tonScrollTriggerUp: 'onScrollTriggerUp',\n\t\tonScrollTriggerDown: 'onScrollTriggerDown',\n\t\tonScrollThresholdPass: 'onScrollThresholdPass',\n\t};\n\n\tstatic scrollPosition = {\n\t\tmessageTop: 'messageTop',\n\t\tmessageBottom: 'messageBottom',\n\t\tmessageCenter: 'messageCenter',\n\t};\n\n\tconstructor(): ScrollManager\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace(EVENT_NAMESPACE);\n\t}\n\n\tsetContainer(container: HTMLElement)\n\t{\n\t\tthis.container = container;\n\t}\n\n\tonScroll(event: Event)\n\t{\n\t\tif (this.isScrolling || !event.target)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.currentScroll = event.target.scrollTop;\n\t\tconst isScrollingDown = this.lastScroll < this.currentScroll;\n\t\tconst isScrollingUp = !isScrollingDown;\n\t\tif (isScrollingUp)\n\t\t{\n\t\t\tthis.scrollButtonClicked = false;\n\t\t}\n\n\t\tconst SCROLLING_THRESHOLD = 1500;\n\t\tconst leftSpaceBottom = event.target.scrollHeight - event.target.scrollTop - event.target.clientHeight;\n\t\tif (isScrollingDown && this.isStartScrollCompleted() && leftSpaceBottom < SCROLLING_THRESHOLD)\n\t\t{\n\t\t\tthis.emit(ScrollManager.events.onScrollTriggerDown);\n\t\t}\n\t\telse if (isScrollingUp && this.currentScroll <= SCROLLING_THRESHOLD)\n\t\t{\n\t\t\tthis.emit(ScrollManager.events.onScrollTriggerUp);\n\t\t}\n\n\t\tthis.lastScroll = this.currentScroll;\n\n\t\tthis.checkIfChatIsScrolledUp();\n\t}\n\n\tcheckIfChatIsScrolledUp()\n\t{\n\t\tconst SCROLLED_UP_THRESHOLD = 400;\n\n\t\tconst availableScrollHeight = this.container.scrollHeight - this.container.clientHeight;\n\t\tconst newFlag = this.currentScroll + SCROLLED_UP_THRESHOLD < availableScrollHeight;\n\t\tif (newFlag !== this.chatIsScrolledUp)\n\t\t{\n\t\t\tthis.emit(ScrollManager.events.onScrollThresholdPass, newFlag);\n\t\t}\n\t\tthis.chatIsScrolledUp = newFlag;\n\t}\n\n\tscrollToBottom()\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: scroll to bottom');\n\t\tthis.forceScrollTo(this.container.scrollHeight - this.container.clientHeight);\n\t}\n\n\tanimatedScrollToBottom()\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: animated scroll to bottom');\n\t\tthis.animatedScrollTo(this.container.scrollHeight - this.container.clientHeight);\n\t}\n\n\tscrollToMessage(messageId: number, params: { withDateOffset: boolean, position: string } = {})\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: scroll to message - ', messageId);\n\t\tconst element = this.getDomElementById(messageId);\n\t\tif (!element)\n\t\t{\n\t\t\tLogger.warn('Dialog: ScrollManager: message not found - ', messageId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst scrollPosition = this.#getScrollPosition(element, params);\n\t\tthis.forceScrollTo(scrollPosition);\n\t}\n\n\tsetStartScrollNeeded(flag: boolean): void\n\t{\n\t\tthis.startScrollNeeded = flag;\n\t}\n\n\tisStartScrollCompleted(): boolean\n\t{\n\t\tif (!this.startScrollNeeded)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.lastScroll > 0;\n\t}\n\n\tanimatedScrollToMessage(messageId: number, params: { withDateOffset: boolean, position: string } = {}): Promise\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: animated scroll to message - ', messageId);\n\t\tconst element = this.getDomElementById(messageId);\n\t\tif (!element)\n\t\t{\n\t\t\tLogger.warn('Dialog: ScrollManager: message not found - ', messageId);\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst scrollPosition = this.#getScrollPosition(element, params);\n\n\t\treturn this.animatedScrollTo(scrollPosition);\n\t}\n\n\tforceScrollTo(position: number)\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: Force scroll to - ', position);\n\t\tthis.cancelAnimatedScroll();\n\t\tthis.container.scroll({ top: position, behavior: 'instant' });\n\t}\n\n\tadjustScrollOnHistoryAddition(oldContainerHeight: number)\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: Adjusting scroll after history addition');\n\t\tconst newContainerHeight = this.container.scrollHeight - this.container.clientHeight;\n\t\tconst newScrollPosition = this.container.scrollTop + newContainerHeight - oldContainerHeight;\n\t\tthis.forceScrollTo(newScrollPosition);\n\t}\n\n\tanimatedScrollTo(position: number): Promise\n\t{\n\t\tLogger.warn('Dialog: ScrollManager: Animated scroll to - ', position);\n\n\t\treturn new Promise((resolve) => {\n\t\t\tAnimation.start({\n\t\t\t\tstart: this.container.scrollTop,\n\t\t\t\tend: position,\n\t\t\t\telement: this.container,\n\t\t\t\telementProperty: 'scrollTop',\n\t\t\t\tcallback: () => {\n\t\t\t\t\tthis.checkIfChatIsScrolledUp();\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tcancelAnimatedScroll()\n\t{\n\t\tif (!this.isScrolling)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tAnimation.cancel();\n\t\tthis.isScrolling = false;\n\t}\n\n\tisAtTheTop(): boolean\n\t{\n\t\treturn this.container.scrollTop === 0;\n\t}\n\n\tisAtTheBottom(): boolean\n\t{\n\t\treturn this.container.scrollTop + this.container.clientHeight >= this.container.scrollHeight;\n\t}\n\n\tisAroundBottom(): boolean\n\t{\n\t\tconst POSITION_THRESHOLD = 40;\n\n\t\treturn this.container.scrollHeight - this.container.scrollTop - this.container.clientHeight < POSITION_THRESHOLD;\n\t}\n\n\tgetDomElementById(id: number | string): ?HTMLElement\n\t{\n\t\treturn this.container.querySelector(`[data-id=\"${id}\"]`);\n\t}\n\n\t#getScrollPosition(element: HTMLElement, params: { withDateOffset: boolean, position: string } = {}): number\n\t{\n\t\tconst FLOATING_DATE_OFFSET = 52;\n\t\tconst MESSAGE_BOTTOM_OFFSET = 100;\n\n\t\tconst { withDateOffset = true, position = ScrollManager.scrollPosition.messageTop } = params;\n\t\tconst offset = withDateOffset ? -FLOATING_DATE_OFFSET : -10;\n\n\t\tlet scrollPosition = element.offsetTop + offset;\n\t\tif (position === ScrollManager.scrollPosition.messageBottom)\n\t\t{\n\t\t\tscrollPosition += element.clientHeight - MESSAGE_BOTTOM_OFFSET;\n\t\t}\n\t\telse if (position === ScrollManager.scrollPosition.messageCenter\n\t\t\t&& this.container.clientHeight > element.clientHeight\n\t\t)\n\t\t{\n\t\t\tscrollPosition = scrollPosition - (this.container.clientHeight / 2) + (element.clientHeight / 2);\n\t\t}\n\n\t\treturn scrollPosition;\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { UserRole, RestMethod, ChatType } from 'im.v2.const';\nimport { runAction } from 'im.v2.lib.rest';\nimport { ChannelManager } from 'im.v2.lib.channel';\nimport { DemoChatBuilder } from 'im.v2.lib.demo';\n\nimport type { ImModelChat } from 'im.v2.model';\nimport type { PULL as Pull } from 'pull.client';\n\nconst MESSAGES_TAG_PREFIX = 'IM_PUBLIC_';\nconst COMMENTS_TAG_PREFIX = 'IM_PUBLIC_COMMENT_';\n\nexport class PullWatchManager\n{\n\t#dialog: ImModelChat;\n\t#pullClient: Pull;\n\n\tconstructor(dialogId: string)\n\t{\n\t\tthis.#dialog = Core.getStore().getters['chats/get'](dialogId, true);\n\t\tthis.#pullClient = Core.getPullClient();\n\t}\n\n\tsubscribe()\n\t{\n\t\tif (this.#isChannel())\n\t\t{\n\t\t\tthis.#subscribeChannel();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#isGuest() || this.#isCommentsChat() || this.#isDemoChat())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#subscribeOpenChat();\n\t}\n\n\tunsubscribe()\n\t{\n\t\tthis.#pullClient.clearWatch(`${MESSAGES_TAG_PREFIX}${this.#dialog.chatId}`);\n\t\tthis.#pullClient.clearWatch(`${COMMENTS_TAG_PREFIX}${this.#dialog.chatId}`);\n\t}\n\n\t#subscribeChannel()\n\t{\n\t\tthis.#requestWatchStart();\n\t\tthis.#pullClient.extendWatch(`${MESSAGES_TAG_PREFIX}${this.#dialog.chatId}`);\n\t\tthis.#pullClient.extendWatch(`${COMMENTS_TAG_PREFIX}${this.#dialog.chatId}`);\n\t}\n\n\t#subscribeOpenChat()\n\t{\n\t\tthis.#requestWatchStart();\n\t\tthis.#pullClient.extendWatch(`${MESSAGES_TAG_PREFIX}${this.#dialog.chatId}`);\n\t}\n\n\t#requestWatchStart()\n\t{\n\t\trunAction(RestMethod.imV2ChatExtendPullWatch, {\n\t\t\tdata: {\n\t\t\t\tdialogId: this.#dialog.dialogId,\n\t\t\t},\n\t\t});\n\t}\n\n\t#isGuest(): boolean\n\t{\n\t\treturn this.#dialog?.role === UserRole.guest;\n\t}\n\n\t#isDemoChat(): boolean\n\t{\n\t\treturn DemoChatBuilder.isDemoDialogId(this.#dialog?.dialogId);\n\t}\n\n\t#isChannel(): boolean\n\t{\n\t\treturn ChannelManager.isChannel(this.#dialog?.dialogId);\n\t}\n\n\t#isCommentsChat(): boolean\n\t{\n\t\treturn this.#dialog?.type === ChatType.comment;\n\t}\n}\n","export class VisibleMessagesManager\n{\n\t#visibleMessages: Set = new Set();\n\n\tsetMessageAsVisible(messageId: number): void\n\t{\n\t\tthis.#visibleMessages.add(messageId);\n\t}\n\n\tsetMessageAsNotVisible(messageId: number): void\n\t{\n\t\tthis.#visibleMessages.delete(messageId);\n\t}\n\n\tgetVisibleMessages(): number[]\n\t{\n\t\treturn [...this.#visibleMessages];\n\t}\n\n\tgetFirstMessageId(): number\n\t{\n\t\tif (this.#visibleMessages.size === 0)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst [firstVisibleMessage] = [...this.#visibleMessages].sort((a, b) => a - b);\n\n\t\treturn firstVisibleMessage;\n\t}\n}\n","export function findUniqueNumbers(arr1: number[], arr2: number[]): number[]\n{\n\tconst set1 = new Set(arr1);\n\tconst set2 = new Set(arr2);\n\n\treturn [\n\t\t...arr1.filter((num) => !set2.has(num)),\n\t\t...arr2.filter((num) => !set1.has(num)),\n\t];\n}\n","type Task = {\n\targs: Array<any>,\n\tresolve: (result: any) => void,\n};\n\nconst sharedQueues: Map<string, (...args: any[]) => Promise<any>> = new Map();\n\n/**\n * @description\n * Adds a delay between calls to the fn function.\n * Calls with the same function execute this function in the same sequence\n * @param fn\n * @param delay\n * @param context\n * @returns Function\n */\nfunction sequentializeShared(\n\tfn: (...args: any[]) => any,\n\tdelay: number,\n\tcontext: any = null,\n): (...args: any[]) => Promise<any>\n{\n\tif (sharedQueues.has(fn))\n\t{\n\t\treturn sharedQueues.get(fn);\n\t}\n\n\tconst wrapped = sequentialize(fn, delay, context);\n\tsharedQueues.set(fn, wrapped);\n\n\treturn wrapped;\n}\n\nfunction sequentialize(\n\tfn: (...args: any[]) => any,\n\tdelay: number,\n\tcontext: any = null,\n): (...args: any[]) => Promise<any>\n{\n\tconst queue: Array<Task> = [];\n\tlet isRunning = false;\n\n\tasync function run(): Promise<void>\n\t{\n\t\tif (isRunning)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tisRunning = true;\n\n\t\tconst task = queue.shift();\n\n\t\tif (!task)\n\t\t{\n\t\t\tisRunning = false;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst result = fn.apply(context, task.args);\n\t\tawait wait(delay);\n\t\ttask.resolve(result);\n\n\t\tisRunning = false;\n\n\t\trun();\n\t}\n\n\treturn (...args: any[]): Promise<any> => {\n\t\treturn new Promise((resolve) => {\n\t\t\tqueue.push({ args, resolve });\n\t\t\trun();\n\t\t});\n\t};\n}\n\nfunction wait(ms: number): Promise<void>\n{\n\treturn new Promise((resolve) => {\n\t\tsetTimeout(resolve, ms);\n\t});\n}\n\nexport { sequentializeShared as sequentialize };\n","import { Parser } from 'im.v2.lib.parser';\nimport { MessageAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport type { ImModelUser, ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const PinnedMessage = {\n\tcomponents: { MessageAvatar },\n\tprops:\n\t{\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tshowUnpinIcon: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['messageUnpin'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\ttypedMessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.message;\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\treturn Parser.purifyMessage(this.typedMessage);\n\t\t},\n\t\tauthorId(): number\n\t\t{\n\t\t\treturn this.typedMessage.authorId;\n\t\t},\n\t\tauthor(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.authorId);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-dialog-chat__pinned_item\">\n\t\t\t<MessageAvatar\n\t\t\t\tv-if=\"typedMessage.authorId\"\n\t\t\t\t:messageId=\"typedMessage.id\"\n\t\t\t\t:authorId=\"typedMessage.authorId\"\n\t\t\t\t:size=\"AvatarSize.M\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-dialog-chat__pinned_item_content\">\n\t\t\t\t<div v-if=\"author\" class=\"bx-im-dialog-chat__pinned_item_user\">\n\t\t\t\t\t{{ author.name }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-dialog-chat__pinned_item_text --ellipsis\">\n\t\t\t\t\t{{ text }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tv-if=\"showUnpinIcon\"\n\t\t\t\tclass=\"bx-im-dialog-chat__pinned_icon-item-unpin\"\n\t\t\t\t@click.stop=\"$emit('messageUnpin', typedMessage.id)\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import './css/title.css';\n\n// @vue/component\nexport const HeaderTitle = {\n\tname: 'HeaderTitle',\n\tprops:\n\t{\n\t\ttotalPinCounter: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['toggleList'],\n\tcomputed:\n\t{\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.loc(\n\t\t\t\t'IM_DIALOG_CHAT_PINNED_TITLE_MULTIPLE_COUNTER',\n\t\t\t\t{\n\t\t\t\t\t'#PINS_COUNT#': `\n\t\t\t\t\t\t<span class=\"bx-im-dialog-chat__pin-header_counter-total\">\n\t\t\t\t\t\t\t${this.totalPinCounter}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t`,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-dialog-chat__pin-header_opened\">\n\t\t    <div v-html=\"title\"></div>\n\t\t\t<button\n\t\t\t\tclass=\"bx-im-messenger__cross-icon\"\n\t\t\t\t@click=\"$emit('toggleList')\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import './css/counter-control.css';\n\n// @vue/component\nexport const CounterControl = {\n\tname: 'CounterControl',\n\tprops:\n\t{\n\t\tmessagePosition: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\ttotalPinCounter: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['toggleList'],\n\ttemplate: `\n\t\t<button\n\t\t\t@click=\"$emit('toggleList')\"\n\t\t\tclass=\"bx-im-dialog-chat__pinned_counter_control\"\n\t\t>\n\t\t\t<span class=\"bx-im-dialog-chat__pinned_icon-dropdown\"></span>\n\t\t\t<span>\n\t\t\t\t{{ messagePosition }}\n\t\t\t\t<span class=\"bx-im-dialog-chat__pinned_counter_control-total\">\n\t\t\t\t\t/ {{ totalPinCounter }}\n\t\t\t\t</span>\n\t\t\t</span>\n\t\t</button>\n\t`,\n};\n","import { ChatType } from 'im.v2.const';\nimport { Parser } from 'im.v2.lib.parser';\n\nimport { CounterControl } from './counter-control';\n\nimport './css/header-pin.css';\n\nimport type { ImModelMessage, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const HeaderPin = {\n\tname: 'HeaderPin',\n\tcomponents:\n\t{\n\t\tCounterControl,\n\t},\n\tprops:\n\t{\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tmessagePosition: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tshowUnpinIcon: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\ttotalPinCounter: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tcontextDialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['toggleList', 'messageUnpin', 'messageClick'],\n\tcomputed:\n\t{\n\t\ttypedMessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.message;\n\t\t},\n\t\tisSinglePin(): boolean\n\t\t{\n\t\t\treturn this.totalPinCounter === 1;\n\t\t},\n\t\tauthorId(): number\n\t\t{\n\t\t\treturn this.typedMessage.authorId;\n\t\t},\n\t\tauthor(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.authorId);\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\treturn Parser.purifyMessage(this.typedMessage);\n\t\t},\n\t\tisCommentChatContext(): boolean\n\t\t{\n\t\t\tconst dialog = this.$store.getters['chats/get'](this.contextDialogId, true);\n\n\t\t\treturn dialog.type === ChatType.comment;\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\tif (this.isCommentChatContext)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_DIALOG_CHAT_PINNED_TITLE_IN_CHANNEL');\n\t\t\t}\n\n\t\t\treturn this.loc(\n\t\t\t\tthis.isSinglePin\n\t\t\t\t\t? 'IM_DIALOG_CHAT_PINNED_TITLE'\n\t\t\t\t\t: 'IM_DIALOG_CHAT_PINNED_TITLE_MULTIPLE',\n\t\t\t);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-dialog-chat__pin-header\">\n\t\t\t<div\n\t\t\t\tclass=\"bx-im-dialog-chat__pin-header_wrapper\"\n\t\t\t\t@click=\"$emit('messageClick', typedMessage.id)\"\n\t\t\t>\n\t\t\t\t<div class=\"bx-im-dialog-chat__pin-header_title\">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-dialog-chat__pin-header_content\">\n\t\t\t\t\t<div v-if=\"author\" class=\"bx-im-dialog-chat__pin-header_user\">\n\t\t\t\t\t\t{{ author.name + ':' }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-dialog-chat__pin-header_text --ellipsis\">\n\t\t\t\t\t\t{{ text }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"bx-im-dialog-chat__pin-header_controls\">\n\t\t\t\t<button\n\t\t\t\t\tv-if=\"showUnpinIcon && isSinglePin\"\n\t\t\t\t\tclass=\"bx-im-dialog-chat__pinned_icon-header-unpin\"\n\t\t\t\t\t@click=\"$emit('messageUnpin', typedMessage.id)\"\n\t\t\t\t></button>\n\t\t\t\t<CounterControl\n\t\t\t\t\tv-else-if=\"!isSinglePin\"\n\t\t\t\t\t:messagePosition=\"messagePosition\"\n\t\t\t\t\t:totalPinCounter=\"totalPinCounter\"\n\t\t\t\t\t@toggleList=\"$emit('toggleList')\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { HeaderTitle } from './title';\nimport { HeaderPin } from './header-pin';\n\nimport './css/header.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const PinnedHeader = {\n\tname: 'PinnedHeader',\n\tcomponents:\n\t{\n\t\tHeaderTitle,\n\t\tHeaderPin,\n\t},\n\tprops:\n\t{\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tmessagePosition: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tshowUnpinIcon: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\ttotalPinCounter: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tisListOpened: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tcontextDialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['toggleList', 'messageUnpin', 'messageClick'],\n\tcomputed:\n\t{\n\t\ttypedMessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.message;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-dialog-chat__pinned_header\">\n\t\t\t<HeaderTitle\n\t\t\t\tv-if=\"isListOpened\"\n\t\t\t\t:totalPinCounter=\"totalPinCounter\"\n\t\t\t\t@toggleList=\"$emit('toggleList')\"\n\t\t\t/>\n\t\t\t<HeaderPin\n\t\t\t\tv-else\n\t\t\t\t:message=\"typedMessage\"\n\t\t\t\t:contextDialogId=\"contextDialogId\"\n\t\t\t\t:messagePosition=\"messagePosition\"\n\t\t\t\t:totalPinCounter=\"totalPinCounter\"\n\t\t\t\t:showUnpinIcon=\"showUnpinIcon\"\n\t\t\t\t@toggleList=\"$emit('toggleList')\"\n\t\t\t\t@messageUnpin=\"$emit('messageUnpin', typedMessage.id)\"\n\t\t\t\t@messageClick=\"$emit('messageClick', typedMessage.id)\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\n\nimport { ActionByRole, ChatType } from 'im.v2.const';\nimport { PermissionManager } from 'im.v2.lib.permission';\n\nimport { PinnedMessage } from './pinned-message';\nimport { PinnedHeader } from './header/header';\n\nimport './css/pinned-messages.css';\nimport './css/list.css';\n\nimport type { ImModelChat, ImModelMessage } from 'im.v2.model';\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const PinnedMessages = {\n\tname: 'PinnedMessages',\n\tcomponents:\n\t{\n\t\tPinnedMessage,\n\t\tPinnedHeader,\n\t},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tmessages: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['messageClick', 'messageUnpin'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisListOpened: false,\n\t\t\tupcomingMessageIndex: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tsortedPinnedMessages(): ImModelMessage[]\n\t\t{\n\t\t\treturn [...this.messages].sort((a, b) => b.id - a.id);\n\t\t},\n\t\ttotalPinCounter(): number\n\t\t{\n\t\t\treturn this.messages.length;\n\t\t},\n\t\tcanUnpin(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformActionByRole(ActionByRole.pinMessage, this.dialogId);\n\t\t},\n\t\tshowUnpinIcon(): boolean\n\t\t{\n\t\t\treturn !this.isCommentChat && this.canUnpin;\n\t\t},\n\t\tisCommentChat(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.comment;\n\t\t},\n\t\tupcomingMessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.sortedPinnedMessages[this.upcomingMessageIndex];\n\t\t},\n\t\tupcomingMessageDisplayPosition(): number\n\t\t{\n\t\t\treturn this.upcomingMessageIndex + 1;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tmessages(newValue: Array<ImModelMessage>): void\n\t\t{\n\t\t\tif (newValue.length === 1)\n\t\t\t{\n\t\t\t\tthis.toggleList(false);\n\t\t\t}\n\n\t\t\tif (this.shouldResetIndex(this.upcomingMessageIndex))\n\t\t\t{\n\t\t\t\tthis.resetHeaderIndex();\n\t\t\t}\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\ttoggleList(flag: boolean | undefined): void\n\t\t{\n\t\t\tthis.isListOpened = Type.isUndefined(flag) ? !this.isListOpened : flag;\n\t\t},\n\n\t\tincrementHeaderIndex(): void\n\t\t{\n\t\t\tconst nextIndex = this.upcomingMessageIndex + 1;\n\n\t\t\tif (this.shouldResetIndex(nextIndex))\n\t\t\t{\n\t\t\t\tthis.resetHeaderIndex();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.upcomingMessageIndex = nextIndex;\n\t\t\t}\n\t\t},\n\n\t\tresetHeaderIndex(): void\n\t\t{\n\t\t\tthis.upcomingMessageIndex = 0;\n\t\t},\n\n\t\tshouldResetIndex(index: number): boolean\n\t\t{\n\t\t\treturn index >= this.totalPinCounter;\n\t\t},\n\n\t\tclickOnHeaderMessage(): void\n\t\t{\n\t\t\tthis.emitMessageClick(this.sortedPinnedMessages[this.upcomingMessageIndex].id);\n\t\t\tthis.incrementHeaderIndex();\n\t\t},\n\n\t\tclickOnHeaderMessageFromList(index: number): void\n\t\t{\n\t\t\t// manually setting the next index because the item is selected directly from the list\n\t\t\tconst nextIndex = index + 1;\n\t\t\tthis.upcomingMessageIndex = this.shouldResetIndex(nextIndex) ? 0 : nextIndex;\n\t\t\tthis.emitMessageClick(this.sortedPinnedMessages[index].id);\n\t\t},\n\n\t\temitMessageClick(messageId: number): void\n\t\t{\n\t\t\tthis.$emit('messageClick', messageId);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-dialog-chat__pinned_container\">\n\t\t\t<PinnedHeader\n\t\t\t\t:message=\"upcomingMessage\"\n\t\t\t\t:messagePosition=\"upcomingMessageDisplayPosition\"\n\t\t\t\t:showUnpinIcon=\"showUnpinIcon\"\n\t\t\t\t:totalPinCounter=\"totalPinCounter\"\n\t\t\t\t:isListOpened=\"isListOpened\"\n\t\t\t\t:contextDialogId=\"dialogId\"\n\t\t\t\t@toggleList=\"toggleList\"\n\t\t\t\t@messageUnpin=\"$emit('messageUnpin', upcomingMessage.id)\"\n\t\t\t\t@messageClick=\"clickOnHeaderMessage\"\n\t\t\t/>\n\t\t\t<transition name=\"pinned-list\">\n\t\t\t\t<div v-if=\"isListOpened\" class=\"bx-im-dialog-chat__pinned_list\">\n\t\t\t\t\t<PinnedMessage\n\t\t\t\t\t\tv-for=\"(message, index) in sortedPinnedMessages\"\n\t\t\t\t\t\t:key=\"message.id\"\n\t\t\t\t\t\t:message=\"message\"\n\t\t\t\t\t\t:showUnpinIcon=\"showUnpinIcon\"\n\t\t\t\t\t\t@messageUnpin=\"$emit('messageUnpin', message.id)\"\n\t\t\t\t\t\t@click=\"clickOnHeaderMessageFromList(index)\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t</div>\n\t`,\n};\n","import { Event, Type } from 'main.core';\n\nimport { Quote } from 'im.v2.lib.quote';\nimport { Utils } from 'im.v2.lib.utils';\nimport { MessengerPopup } from 'im.v2.component.elements.popup';\n\nimport '../css/quote-button.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelMessage } from 'im.v2.model';\nimport type { PopupOptions } from 'main.popup';\n\nconst CONTAINER_HEIGHT = 44;\nconst CONTAINER_WIDTH = 60;\n\nconst MESSAGE_TEXT_NODE_CLASS = '.bx-im-message-default-content__text';\nconst POPUP_ID = 'im-quote-button-popup';\n\n// @vue/component\nexport const QuoteButton = {\n\tname: 'QuoteButton',\n\tcomponents: { MessengerPopup },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\ttargetPosition: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t\tvalidator(value: { left: number, top: number }): boolean {\n\t\t\t\treturn Type.isNumber(value.left) && Type.isNumber(value.top);\n\t\t\t},\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\ttext: '',\n\t\t\tmessage: null,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tPOPUP_ID: () => POPUP_ID,\n\t\tconfig(): PopupOptions\n\t\t{\n\t\t\tconst { top, left } = this.targetPosition;\n\t\t\tconst offsetLeftForCenteredPopup = left - CONTAINER_WIDTH / 2;\n\n\t\t\treturn {\n\t\t\t\tbindElement: { top, left: offsetLeftForCenteredPopup },\n\t\t\t\tclassName: 'bx-im-dialog-chat__quote-button_scope',\n\t\t\t\tbackground: 'transparent',\n\t\t\t\tbindOptions: { position: 'top' },\n\t\t\t\tanimation: 'fading-slide',\n\t\t\t\twidth: CONTAINER_WIDTH,\n\t\t\t\theight: CONTAINER_HEIGHT,\n\t\t\t\tautoHide: true,\n\t\t\t\tpadding: 0,\n\t\t\t};\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tEvent.bind(window, 'mousedown', this.onMouseDown);\n\t},\n\tmethods:\n\t{\n\t\tonMessageMouseUp(message: ImModelMessage, event: MouseEvent)\n\t\t{\n\t\t\tif (event.button === 2)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.prepareSelectedText();\n\t\t\tthis.message = message;\n\t\t},\n\t\tonMouseDown(event: MouseEvent)\n\t\t{\n\t\t\tconst container = this.$refs.container;\n\t\t\tif (!container || container.contains(event.target))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tprepareSelectedText(): string\n\t\t{\n\t\t\tif (Utils.browser.isFirefox())\n\t\t\t{\n\t\t\t\tthis.text = window.getSelection().toString();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst range = window.getSelection().getRangeAt(0);\n\t\t\tconst rangeContents = range.cloneContents();\n\t\t\tlet nodesToIterate = rangeContents.childNodes;\n\n\t\t\tconst messageNode = rangeContents.querySelector(MESSAGE_TEXT_NODE_CLASS);\n\t\t\tif (messageNode)\n\t\t\t{\n\t\t\t\tnodesToIterate = messageNode.childNodes;\n\t\t\t}\n\n\t\t\tfor (const node of nodesToIterate)\n\t\t\t{\n\t\t\t\tif (this.isImage(node))\n\t\t\t\t{\n\t\t\t\t\tthis.text += node.getAttribute('data-code') ?? node.getAttribute('alt');\n\t\t\t\t}\n\t\t\t\telse if (this.isLineBreak(node))\n\t\t\t\t{\n\t\t\t\t\tthis.text += '\\n';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.text += node.textContent;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tisImage(node: HTMLElement): boolean\n\t\t{\n\t\t\tif (!(node instanceof HTMLElement))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn node.tagName.toLowerCase() === 'img';\n\t\t},\n\t\tisLineBreak(node: HTMLElement): boolean\n\t\t{\n\t\t\treturn node.nodeName.toLowerCase() === 'br';\n\t\t},\n\t\tisText(node: HTMLElement): boolean\n\t\t{\n\t\t\treturn node.nodeName === '#text';\n\t\t},\n\t\tonQuoteClick()\n\t\t{\n\t\t\tconst text = Quote.prepareInlineMessageQuote(this.message, this.text);\n\n\t\t\tQuote.sendQuoteEvent({\n\t\t\t\ttext,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tcontext: { emitter: this.getEmitter() },\n\t\t\t});\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<MessengerPopup\n\t\t\t:id=\"POPUP_ID\"\n\t\t\t:config=\"config\"\n\t\t\t@close=\"$emit('close')\"\n\t\t>\n\t\t\t<div ref=\"container\" @click=\"onQuoteClick\" class=\"bx-im-dialog-chat__quote-button\">\n\t\t\t\t<div class=\"bx-im-dialog-chat__quote-icon\"></div>\n\t\t\t\t<div class=\"bx-im-dialog-chat__quote-icon --hover\"></div>\n\t\t\t</div>\n\t\t</MessengerPopup>\n\t`,\n};\n","export const FloatButtonColor = Object.freeze({\n\taccent: 'accent',\n\talert: 'alert',\n\tsuccess: 'success',\n});\n\nexport const FloatButtonIcon = Object.freeze({\n\tchevronDown: 'chevron-down',\n\theart: 'heart',\n\tatSymbol: 'at-symbol',\n\tcomment: 'comment',\n});\n\n// @vue/component\nexport const FloatButton = {\n\tname: 'FloatButton',\n\tprops:\n\t{\n\t\tcounter: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t},\n\t\tcolor: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: FloatButtonColor.accent,\n\t\t\tvalidator: (value) => {\n\t\t\t\treturn Object.values(FloatButtonColor).includes(value);\n\t\t\t},\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tvalidator: (value) => {\n\t\t\t\treturn Object.values(FloatButtonIcon).includes(value);\n\t\t\t},\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tbuttonClassname(): string[]\n\t\t{\n\t\t\treturn [\n\t\t\t\t'bx-im-dialog-chat__float-button',\n\t\t\t\t`--color-${this.color}`,\n\t\t\t\t`--icon-${this.icon}`,\n\t\t\t];\n\t\t},\n\t\tformattedCounter(): string\n\t\t{\n\t\t\tif (this.counter === 0)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (this.counter > 99)\n\t\t\t{\n\t\t\t\treturn '99+';\n\t\t\t}\n\n\t\t\treturn String(this.counter);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :class=\"buttonClassname\">\n\t\t\t<div class=\"bx-im-dialog-chat__float-button_icon\"></div>\n\t\t\t<div v-if=\"counter\" class=\"bx-im-dialog-chat__float-button_counter\">\n\t\t\t\t{{ formattedCounter }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import type { ImModelChat } from 'im.v2.model';\nimport type { JsonObject } from 'main.core';\nimport { FloatButton, FloatButtonColor, FloatButtonIcon } from './float-button';\n\n// @vue/component\nexport const ScrollButton = {\n\tname: 'ScrollButton',\n\tcomponents: {\n\t\tFloatButton,\n\t},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tfloatButtonProps(): { color: string, icon: string, counter: number }\n\t\t{\n\t\t\treturn {\n\t\t\t\tcolor: FloatButtonColor.accent,\n\t\t\t\ticon: FloatButtonIcon.chevronDown,\n\t\t\t\tcounter: this.dialog.counter,\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<FloatButton v-bind=\"floatButtonProps\" />\n\t`,\n};\n","import type { ImModelChat } from 'im.v2.model';\nimport { AnchorType } from 'im.v2.const';\n\nimport { FloatButton, FloatButtonColor, FloatButtonIcon } from './float-button';\n\nexport const ReactionsButton = {\n\tname: 'ReactionsButton',\n\tcomponents: {\n\t\tFloatButton,\n\t},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\treactionCounter(): number\n\t\t{\n\t\t\treturn this.$store.getters['messages/anchors/getCounterInChatByType'](this.dialog.chatId, AnchorType.reaction);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tfloatButtonProps(): { color: string, icon: string, counter: number }\n\t\t{\n\t\t\treturn {\n\t\t\t\tcolor: FloatButtonColor.alert,\n\t\t\t\ticon: FloatButtonIcon.heart,\n\t\t\t\tcounter: this.reactionCounter,\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<FloatButton v-bind=\"floatButtonProps\" />\n\t`,\n};\n","import type { ImModelChat } from 'im.v2.model';\nimport { FloatButton, FloatButtonIcon, FloatButtonColor } from './float-button';\nimport { AnchorType } from 'im.v2.const';\n\n// @vue/component\nexport const MentionsButton = {\n\tname: 'MentionsButton',\n\tcomponents: {\n\t\tFloatButton,\n\t},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmentionCounter(): number\n\t\t{\n\t\t\treturn this.$store.getters['messages/anchors/getCounterInChatByType'](this.dialog.chatId, AnchorType.mention);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tfloatButtonProps(): {color: string, icon: string, counter: number}\n\t\t{\n\t\t\treturn {\n\t\t\t\tcolor: FloatButtonColor.accent,\n\t\t\t\ticon: FloatButtonIcon.atSymbol,\n\t\t\t\tcounter: this.mentionCounter,\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<FloatButton v-bind=\"floatButtonProps\" />\n\t`,\n};\n","import { AnchorType } from 'im.v2.const';\nimport type { ImModelChat } from 'im.v2.model';\n\nimport { ScrollButton } from './scroll-button';\nimport { ReactionsButton } from './reactions-button';\nimport { MentionsButton } from './mentions-button';\n\n// @vue/component\nexport const FloatButtons = {\n\tcomponents:\n\t{\n\t\tScrollButton,\n\t\tReactionsButton,\n\t\tMentionsButton,\n\t},\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tisScrolledUp: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['scrollButtonClick', 'reactionsButtonClick', 'mentionsButtonClick'],\n\tcomputed:\n\t{\n\t\tdialogInited(): boolean\n\t\t{\n\t\t\treturn this.dialog.inited;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tshowScrollButton(): boolean\n\t\t{\n\t\t\treturn this.isScrolledUp || this.dialog.hasNextPage;\n\t\t},\n\t\tshowMentionsButton(): boolean\n\t\t{\n\t\t\treturn this.dialogInited && this.$store.getters['messages/anchors/getCounterInChatByType'](this.dialog.chatId, AnchorType.mention);\n\t\t},\n\t\tshowReactionsButton(): boolean\n\t\t{\n\t\t\treturn this.dialogInited && this.$store.getters['messages/anchors/getCounterInChatByType'](this.dialog.chatId, AnchorType.reaction);\n\t\t},\n\t\thasAdditionalButtonSlot(): boolean\n\t\t{\n\t\t\tconst slot = this.$slots['additional-float-button'];\n\n\t\t\tif (!slot)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst slotChildren = slot();\n\n\t\t\t/**\n\t\t\t * Check that slot has empty content.\n\t\t\t * Used for case when parent component passes a slot to this slot\n\t\t\t * This is important for the animation to work correctly\n\t\t\t */\n\t\t\treturn slotChildren[0]?.children.length > 0;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonReactionsButtonClick(): void\n\t\t{\n\t\t\tthis.$emit('reactionsButtonClick');\n\t\t},\n\t\tonMentionsButtonClick(): void\n\t\t{\n\t\t\tthis.$emit('mentionsButtonClick');\n\t\t},\n\t\tonScrollButtonClick(): void\n\t\t{\n\t\t\tthis.$emit('scrollButtonClick');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<TransitionGroup\n\t\t\tname=\"float-button-transition\"\n\t\t\ttag=\"div\"\n\t\t\tclass=\"bx-im-dialog-chat__float-buttons\"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-if=\"showReactionsButton\"\n\t\t\t\tkey=\"reaction\"\n\t\t\t\tclass=\"bx-im-dialog-chat__float-buttons_button\"\n\t\t\t>\n\t\t\t\t<ReactionsButton :dialogId=\"dialogId\" @click=\"onReactionsButtonClick\" />\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"showMentionsButton\"\n\t\t\t\tkey=\"mention\"\n\t\t\t\tclass=\"bx-im-dialog-chat__float-buttons_button\"\n\t\t\t>\n\t\t\t\t<MentionsButton :dialogId=\"dialogId\" @click=\"onMentionsButtonClick\" />\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"hasAdditionalButtonSlot\"\n\t\t\t\tkey=\"additionalButton\"\n\t\t\t\tclass=\"bx-im-dialog-chat__float-buttons_button\"\n\t\t\t>\n\t\t\t\t<slot name=\"additional-float-button\"></slot>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"showScrollButton\"\n\t\t\t\tkey=\"scroll\"\n\t\t\t\tclass=\"bx-im-dialog-chat__float-buttons_button\"\n\t\t\t>\n\t\t\t\t<ScrollButton :dialogId=\"dialogId\" @click=\"onScrollButtonClick\" />\n\t\t\t</div>\n\t\t</TransitionGroup>\n\t`,\n};\n","import { Runtime, Event, Dom } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { PopupManager } from 'main.popup';\nimport { PullStatus } from 'pull.vue3.status';\n\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { MessageList } from 'im.v2.component.message-list';\nimport { ForwardPopup } from 'im.v2.component.entity-selector';\nimport { Logger } from 'im.v2.lib.logger';\nimport { CallManager } from 'im.v2.lib.call';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { AccessManager } from 'im.v2.lib.access';\nimport { FeatureManager } from 'im.v2.lib.feature';\nimport { MessageService } from 'im.v2.provider.service.message';\nimport { ChatService } from 'im.v2.provider.service.chat';\nimport {\n\tDialogBlockType as BlockType,\n\tEventType,\n\tPopupType,\n\tDialogScrollThreshold,\n\tUserRole,\n\tActionByRole,\n\tErrorCode,\n\tAnchorType,\n} from 'im.v2.const';\n\nimport { AnchorService } from './classes/anchor-service';\nimport { ScrollManager } from './classes/scroll-manager';\nimport { PullWatchManager } from './classes/pull-watch-manager';\nimport { VisibleMessagesManager } from './classes/visible-messages-manager';\nimport { findUniqueNumbers } from './helpers/find-unique-numbers';\nimport { sequentialize } from './helpers/sequentialize';\n\nimport { PinnedMessages } from './components/pinned/pinned-messages';\nimport { QuoteButton } from './components/quote-button';\nimport { FloatButtons } from './components/float-buttons';\n\nimport './css/chat-dialog.css';\nimport './css/float-button.css';\n\nimport type { ImModelMessage, ImModelChat, ImModelLayout } from 'im.v2.model';\nimport type { ScrollToBottomEvent } from 'im.v2.const';\n\nexport { ScrollManager } from './classes/scroll-manager';\nexport { PinnedMessages } from './components/pinned/pinned-messages';\nexport { FloatButton, FloatButtonIcon, FloatButtonColor } from './components/float-button';\n\n// @vue/component\nexport const ChatDialog = {\n\tname: 'ChatDialog',\n\tcomponents: {\n\t\tMessageList,\n\t\tPinnedMessages,\n\t\tQuoteButton,\n\t\tFloatButtons,\n\t\tPullStatus,\n\t\tForwardPopup,\n\t},\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsaveScrollOnExit: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\treloadOnExit: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tclearOnExit: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tforwardPopup: {\n\t\t\t\tshow: false,\n\t\t\t\tmessagesIds: [],\n\t\t\t},\n\t\t\tcontextMode: {\n\t\t\t\tactive: false,\n\t\t\t\tmessageIsLoaded: false,\n\t\t\t},\n\t\t\tisScrolledUp: false,\n\t\t\twindowFocused: false,\n\t\t\tshowQuoteButton: false,\n\t\t\tisJumpingToAnchor: false,\n\t\t\tmessagesToRead: new Set(),\n\t\t\tcontainerHeight: 0,\n\t\t\tquoteButtonPosition: {},\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tlayout(): ImModelLayout\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tdialogInited(): boolean\n\t\t{\n\t\t\treturn this.dialog.inited;\n\t\t},\n\t\tmessageCollection(): ImModelMessage[]\n\t\t{\n\t\t\treturn this.$store.getters['messages/getByChatId'](this.dialog.chatId);\n\t\t},\n\t\tpinnedMessages(): ImModelMessage[]\n\t\t{\n\t\t\treturn this.$store.getters['messages/pin/getPinned'](this.dialog.chatId);\n\t\t},\n\t\tisOpened(): boolean\n\t\t{\n\t\t\tconst openedDialogId = this.$store.getters['application/getLayout'].entityId;\n\n\t\t\treturn this.dialogId === openedDialogId;\n\t\t},\n\t\tisGuest(): boolean\n\t\t{\n\t\t\treturn this.dialog.role === UserRole.guest;\n\t\t},\n\t\tdebouncedScrollHandler(): Function\n\t\t{\n\t\t\tconst SCROLLING_DEBOUNCE_DELAY = 100;\n\n\t\t\treturn Runtime.debounce(this.getScrollManager().onScroll, SCROLLING_DEBOUNCE_DELAY, this.getScrollManager());\n\t\t},\n\t\tdebouncedReadHandler(): Function\n\t\t{\n\t\t\tconst READING_DEBOUNCE_DELAY = 50;\n\n\t\t\treturn Runtime.debounce(this.readQueuedMessages, READING_DEBOUNCE_DELAY, this);\n\t\t},\n\t\tsequentiallyHighlightMessageHandler(): Function\n\t\t{\n\t\t\treturn sequentialize(this.highlightMessage, 300, this);\n\t\t},\n\t\tshowScrollButton(): boolean\n\t\t{\n\t\t\treturn this.isScrolledUp || this.dialog.hasNextPage;\n\t\t},\n\t\tanchorMessages(): number[]\n\t\t{\n\t\t\treturn this.$store.getters['messages/anchors/getChatMessageIdsWithAnchors'](this.dialog.chatId);\n\t\t},\n\t\thasCommentsOnTop(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/comments/areOpenedForChannel'](this.dialogId);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tanchorMessages(newValue: number[], oldValue: number[])\n\t\t{\n\t\t\tconst newMessageIdsWithAnchor = findUniqueNumbers(newValue, oldValue);\n\t\t\tconst visibleMessageIds = this.getVisibleMessagesManager().getVisibleMessages();\n\n\t\t\tnewMessageIdsWithAnchor.forEach((messageId) => {\n\t\t\t\tif (visibleMessageIds.includes(messageId))\n\t\t\t\t{\n\t\t\t\t\tthis.getAnchorService().debouncedReadMessageAnchors(messageId);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tdialogInited(newValue: boolean, oldValue: boolean)\n\t\t{\n\t\t\tif (!newValue || oldValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t// first opening\n\t\t\tthis.getPullWatchManager().subscribe();\n\t\t\tthis.onChatInited();\n\t\t},\n\t\thasCommentsOnTop: {\n\t\t\thandler(newValue: boolean)\n\t\t\t{\n\t\t\t\tconst commentsWereClosed = newValue === false;\n\t\t\t\tif (!commentsWereClosed)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.readVisibleMessages();\n\t\t\t},\n\t\t\tflush: 'post',\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tLogger.warn('Dialog: Chat created', this.dialogId);\n\t\tthis.initContextMode();\n\t},\n\tasync mounted()\n\t{\n\t\tawait this.$nextTick();\n\t\tthis.containerHeight = this.$refs.container.clientHeight;\n\n\t\tthis.getScrollManager().setContainer(this.getContainer());\n\t\tif (this.dialogInited)\n\t\t{\n\t\t\t// second+ opening\n\t\t\tthis.getPullWatchManager().subscribe();\n\t\t\tthis.onChatInited();\n\t\t}\n\t\t// there are P&P messages\n\t\telse if (!this.dialogInited && this.messageCollection.length > 0)\n\t\t{\n\t\t\tthis.scrollOnStart();\n\t\t}\n\n\t\tthis.windowFocused = document.hasFocus();\n\n\t\tthis.subscribeToEvents();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.unsubscribeFromEvents();\n\t\tif (this.dialogInited)\n\t\t{\n\t\t\tthis.saveScrollPosition();\n\t\t\tvoid this.handleMessagesOnExit();\n\t\t}\n\t\tthis.getPullWatchManager().unsubscribe();\n\t\tthis.closeDialogPopups();\n\t\tthis.forwardPopup.show = false;\n\t\tthis.readAllAnchors();\n\t},\n\tmethods:\n\t{\n\t\tasync scrollOnStart(): void\n\t\t{\n\t\t\tawait this.$nextTick();\n\n\t\t\t// we loaded chat with context\n\t\t\tif (this.contextMode.active && this.contextMode.messageIsLoaded)\n\t\t\t{\n\t\t\t\tthis.getScrollManager().scrollToMessage(this.layout.contextId);\n\t\t\t\tvoid this.$nextTick(() => {\n\t\t\t\t\tthis.highlightMessage(this.layout.contextId);\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// chat was loaded before\n\t\t\tif (this.contextMode.active && !this.contextMode.messageIsLoaded)\n\t\t\t{\n\t\t\t\tthis.goToMessageContext(this.layout.contextId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// marked message\n\t\t\tif (this.dialog.markedId)\n\t\t\t{\n\t\t\t\tthis.getScrollManager().scrollToMessage(BlockType.newMessages);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// saved position\n\t\t\tif (this.dialog.savedPositionMessageId && !this.isGuest)\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog: saved scroll position, scrolling to', this.dialog.savedPositionMessageId);\n\t\t\t\tthis.getScrollManager().scrollToMessage(this.dialog.savedPositionMessageId, { withDateOffset: false });\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst lastReadId = this.$store.getters['chats/getLastReadId'](this.dialogId);\n\t\t\tconst isLastMessageId = lastReadId === this.dialog.lastMessageId;\n\t\t\t// unread messages and read messages before them\n\t\t\tif (lastReadId > 0 && !isLastMessageId)\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog: scroll to \"New messages\" mark, lastReadId -', lastReadId, 'lastMessageId', this.dialog.lastMessageId);\n\t\t\t\tthis.getScrollManager().scrollToMessage(BlockType.newMessages);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// new chat, unread messages without read messages before them\n\t\t\tconst hasUnread = this.$store.getters['messages/getFirstUnread'](this.dialog.chatId);\n\t\t\tif (lastReadId === 0 || hasUnread)\n\t\t\t{\n\t\t\t\tthis.getScrollManager().setStartScrollNeeded(false);\n\t\t\t\tLogger.warn('Dialog: dont scroll, hasUnread -', hasUnread, 'lastReadId', lastReadId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// no unread messages\n\t\t\tthis.getScrollManager().scrollToBottom();\n\t\t},\n\t\tshowLoadingBar(): void\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.dialog.showLoadingBar, { dialogId: this.dialogId });\n\t\t},\n\t\thideLoadingBar(): void\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.dialog.hideLoadingBar, { dialogId: this.dialogId });\n\t\t},\n\t\tasync goToMessageContext(messageId: number, params: { position: string } = {}): void\n\t\t{\n\t\t\tconst { position = ScrollManager.scrollPosition.messageTop } = params;\n\t\t\tconst hasMessage = this.$store.getters['messages/hasMessage']({\n\t\t\t\tchatId: this.dialog.chatId,\n\t\t\t\tmessageId,\n\t\t\t});\n\t\t\tif (hasMessage)\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog: we have this message, scrolling to it', messageId);\n\n\t\t\t\tawait this.getScrollManager().animatedScrollToMessage(messageId, { position });\n\t\t\t\tthis.highlightMessage(messageId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { hasAccess, errorCode } = await AccessManager.checkMessageAccess(messageId);\n\t\t\tif (!hasAccess && errorCode === ErrorCode.message.accessDeniedByTariff)\n\t\t\t{\n\t\t\t\tAnalytics.getInstance().historyLimit.onGoToContextLimitExceeded({ dialogId: this.dialogId });\n\t\t\t\tFeatureManager.chatHistory.openFeatureSlider();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showLoadingBar();\n\t\t\tawait this.getMessageService().loadContext(messageId);\n\t\t\tawait this.$nextTick();\n\t\t\tthis.hideLoadingBar();\n\t\t\tthis.getScrollManager().scrollToMessage(messageId, { position });\n\t\t\tawait this.$nextTick();\n\t\t\tthis.highlightMessage(messageId);\n\t\t},\n\t\thighlightMessage(messageId: number)\n\t\t{\n\t\t\tconst HIGHLIGHT_CLASS = 'bx-im-dialog-chat__highlighted-message';\n\t\t\tconst HIGHLIGHT_DURATION = 2000;\n\n\t\t\tconst message = this.getScrollManager().getDomElementById(messageId);\n\t\t\tif (!message)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.addClass(message, HIGHLIGHT_CLASS);\n\t\t\tsetTimeout(() => {\n\t\t\t\tDom.removeClass(message, HIGHLIGHT_CLASS);\n\t\t\t}, HIGHLIGHT_DURATION);\n\t\t},\n\t\tsaveScrollPosition()\n\t\t{\n\t\t\tif (!this.saveScrollOnExit)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlet savedPositionMessageId = this.getVisibleMessagesManager().getFirstMessageId();\n\t\t\tif (this.getScrollManager().isAroundBottom())\n\t\t\t{\n\t\t\t\tsavedPositionMessageId = 0;\n\t\t\t}\n\t\t\tthis.$store.dispatch('chats/update', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tfields: { savedPositionMessageId },\n\t\t\t});\n\t\t},\n\t\tasync handleMessagesOnExit()\n\t\t{\n\t\t\tif (this.clearOnExit)\n\t\t\t{\n\t\t\t\tvoid this.getChatService().clearChat(this.dialogId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.getChatService().readChatQueuedMessages(this.dialog.chatId);\n\n\t\t\tif (this.reloadOnExit)\n\t\t\t{\n\t\t\t\tconst LOAD_MESSAGES_ON_EXIT_DELAY = 200;\n\t\t\t\tsetTimeout(async () => {\n\t\t\t\t\tthis.getMessageService().reloadMessageList();\n\t\t\t\t}, LOAD_MESSAGES_ON_EXIT_DELAY);\n\t\t\t}\n\t\t},\n\t\t/* region Reading */\n\t\treadQueuedMessages(): void\n\t\t{\n\t\t\tif (!this.messagesCanBeRead())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t[...this.messagesToRead].forEach((messageId) => {\n\t\t\t\tthis.getChatService().readMessage(this.dialog.chatId, messageId);\n\t\t\t\tthis.messagesToRead.delete(messageId);\n\t\t\t});\n\t\t},\n\t\treadVisibleMessages(): void\n\t\t{\n\t\t\tif (!this.messagesCanBeRead())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst visibleMessages = this.getVisibleMessagesManager().getVisibleMessages();\n\t\t\tvisibleMessages.forEach((messageId) => {\n\t\t\t\tconst message: ImModelMessage = this.$store.getters['messages/getById'](messageId);\n\t\t\t\tif (!message || message.viewed)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.getChatService().readMessage(this.dialog.chatId, messageId);\n\t\t\t});\n\t\t},\n\t\treadAllAnchors(): void\n\t\t{\n\t\t\tif (this.$store.getters['messages/anchors/isChatHasAnchors'](this.dialog.chatId))\n\t\t\t{\n\t\t\t\tthis.getAnchorService().readChatAnchors(this.dialog.chatId);\n\t\t\t}\n\t\t},\n\t\tmessagesCanBeRead(): boolean\n\t\t{\n\t\t\tif (!this.dialogInited || !this.isChatVisible())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst permissionManager = PermissionManager.getInstance();\n\n\t\t\treturn permissionManager.canPerformActionByRole(ActionByRole.readMessage, this.dialogId);\n\t\t},\n\t\t/* endregion Reading */\n\t\t/* region Event handlers */\n\t\tonChatInited()\n\t\t{\n\t\t\tthis.scrollOnStart();\n\t\t\tthis.readVisibleMessages();\n\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tthis.getChatService().clearDialogMark(this.dialogId);\n\t\t\t});\n\n\t\t\tEventEmitter.emit(EventType.dialog.onDialogInited, { dialogId: this.dialogId });\n\t\t},\n\t\tasync onScrollTriggerUp()\n\t\t{\n\t\t\tif (!this.dialogInited || !this.getContainer())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLogger.warn('Dialog: scroll triggered UP');\n\t\t\tconst container = this.getContainer();\n\t\t\tconst oldHeight = container.scrollHeight - container.clientHeight;\n\n\t\t\t// Insert messages if there are some\n\t\t\tif (this.getMessageService().hasPreparedHistoryMessages())\n\t\t\t{\n\t\t\t\tawait this.getMessageService().drawPreparedHistoryMessages();\n\t\t\t\tthis.getScrollManager().adjustScrollOnHistoryAddition(oldHeight);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// check if already loading or no more history\n\t\t\tif (this.getMessageService().isLoading() || !this.dialog.hasPrevPage)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Load messages and save them\n\t\t\tthis.showLoadingBar();\n\t\t\tawait this.getMessageService().loadHistory();\n\t\t\tthis.hideLoadingBar();\n\t\t\t// Messages loaded and we are at the top\n\t\t\tif (this.getScrollManager().isAtTheTop())\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog: we are at the top after history request, inserting messages');\n\t\t\t\tawait this.getMessageService().drawPreparedHistoryMessages();\n\t\t\t\tthis.getScrollManager().adjustScrollOnHistoryAddition(oldHeight);\n\t\t\t}\n\t\t},\n\t\tasync onScrollTriggerDown()\n\t\t{\n\t\t\tif (!this.dialogInited || !this.getContainer())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tLogger.warn('Dialog: scroll triggered DOWN');\n\t\t\t// Insert messages if there are some\n\t\t\tif (this.getMessageService().hasPreparedUnreadMessages())\n\t\t\t{\n\t\t\t\tawait this.getMessageService().drawPreparedUnreadMessages();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// check if already loading or no more history\n\t\t\tif (this.getMessageService().isLoading() || !this.dialog.hasNextPage)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Load messages and save them\n\t\t\tthis.showLoadingBar();\n\t\t\tawait this.getMessageService().loadUnread();\n\t\t\tthis.hideLoadingBar();\n\t\t\t// Messages loaded and we are at the bottom\n\t\t\tif (this.getScrollManager().isAroundBottom())\n\t\t\t{\n\t\t\t\tLogger.warn('Dialog: we are at the bottom after unread request, inserting messages');\n\t\t\t\tawait this.getMessageService().drawPreparedUnreadMessages();\n\t\t\t\tthis.getScrollManager().checkIfChatIsScrolledUp();\n\t\t\t}\n\t\t},\n\t\tasync onScrollToBottom(event: BaseEvent<ScrollToBottomEvent>)\n\t\t{\n\t\t\tconst { chatId, threshold = DialogScrollThreshold.halfScreenUp, animation = true } = event.getData();\n\t\t\tif (this.dialog.chatId !== chatId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.windowFocused || this.hasVisibleCall())\n\t\t\t{\n\t\t\t\tconst firstUnreadId = this.$store.getters['messages/getFirstUnread'](this.dialog.chatId);\n\t\t\t\tif (firstUnreadId)\n\t\t\t\t{\n\t\t\t\t\tawait this.$nextTick();\n\t\t\t\t\tthis.getScrollManager().scrollToMessage(firstUnreadId);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tLogger.warn('Dialog: scroll to bottom', chatId, threshold);\n\t\t\tif (threshold === DialogScrollThreshold.halfScreenUp && this.isScrolledUp)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (threshold === DialogScrollThreshold.nearTheBottom && !this.getScrollManager().isAroundBottom())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.$nextTick();\n\t\t\tif (animation)\n\t\t\t{\n\t\t\t\tthis.getScrollManager().animatedScrollToBottom();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getScrollManager().scrollToBottom();\n\t\t},\n\t\tonGoToMessageContext(event: BaseEvent)\n\t\t{\n\t\t\tconst { dialogId, messageId } = event.getData();\n\t\t\tif (this.dialog.dialogId !== dialogId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.goToMessageContext(messageId);\n\t\t},\n\t\tonPinnedMessageClick(messageId: number)\n\t\t{\n\t\t\tthis.goToMessageContext(messageId);\n\t\t},\n\t\tonPinnedMessageUnpin(messageId: number)\n\t\t{\n\t\t\tthis.getMessageService().unpinMessage(this.dialog.chatId, messageId);\n\t\t\tAnalytics.getInstance().messagePins.onUnpin({ dialogId: this.dialogId });\n\t\t},\n\t\tonScroll(event: Event)\n\t\t{\n\t\t\tthis.closeDialogPopups();\n\t\t\tthis.debouncedScrollHandler(event);\n\t\t},\n\t\tasync onScrollButtonClick()\n\t\t{\n\t\t\tif (this.getScrollManager().scrollButtonClicked)\n\t\t\t{\n\t\t\t\tvoid this.handleSecondScrollButtonClick();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getScrollManager().scrollButtonClicked = true;\n\t\t\tif (this.dialog.counter === 0)\n\t\t\t{\n\t\t\t\tthis.showLoadingBar();\n\t\t\t\tawait this.getMessageService().loadInitialMessages();\n\t\t\t\tthis.hideLoadingBar();\n\t\t\t\tthis.getScrollManager().scrollToBottom();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst firstUnreadId = this.$store.getters['messages/getFirstUnread'](this.dialog.chatId);\n\t\t\tif (!firstUnreadId)\n\t\t\t{\n\t\t\t\tthis.showLoadingBar();\n\t\t\t\tawait this.getMessageService().loadInitialMessages();\n\t\t\t\tthis.hideLoadingBar();\n\t\t\t\tawait this.getScrollManager().animatedScrollToMessage(firstUnreadId);\n\t\t\t}\n\n\t\t\tawait this.getScrollManager().animatedScrollToMessage(firstUnreadId);\n\t\t},\n\t\tasync onMentionsButtonClick(): void\n\t\t{\n\t\t\tif (this.isJumpingToAnchor)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isJumpingToAnchor = true;\n\t\t\tawait this.goToNearestMessageWithAnchor(AnchorType.mention);\n\t\t\tthis.isJumpingToAnchor = false;\n\t\t},\n\t\tasync onReactionsButtonClick(): void\n\t\t{\n\t\t\tif (this.isJumpingToAnchor)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isJumpingToAnchor = true;\n\t\t\tawait this.goToNearestMessageWithAnchor(AnchorType.reaction);\n\t\t\tthis.isJumpingToAnchor = false;\n\t\t},\n\t\tasync goToNearestMessageWithAnchor(anchorType: string)\n\t\t{\n\t\t\tconst nextMessage: ?number = this.$store.getters['messages/anchors/getNextMessageIdWithAnchorType'](\n\t\t\t\tthis.dialog.chatId,\n\t\t\t\tanchorType,\n\t\t\t);\n\n\t\t\tif (nextMessage)\n\t\t\t{\n\t\t\t\tawait this.goToMessageContext(nextMessage, { position: ScrollManager.scrollPosition.messageTop });\n\t\t\t}\n\t\t},\n\t\tonWindowFocus()\n\t\t{\n\t\t\tthis.windowFocused = true;\n\t\t\tthis.readVisibleMessages();\n\t\t},\n\t\tonWindowBlur()\n\t\t{\n\t\t\tthis.windowFocused = false;\n\t\t},\n\t\tonCallFold()\n\t\t{\n\t\t\tconst callDialogId = CallManager.getInstance().getCurrentCallDialogId();\n\t\t\tif (callDialogId !== this.dialogId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.readVisibleMessages();\n\t\t},\n\t\tasync onShowQuoteButton(event: BaseEvent<{ message: ImModelMessage, event: MouseEvent }>)\n\t\t{\n\t\t\tconst { message, event: $event } = event.getData();\n\t\t\tconst permissionManager = PermissionManager.getInstance();\n\t\t\tif (!permissionManager.canPerformActionByRole(ActionByRole.send, this.dialogId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showQuoteButton = true;\n\n\t\t\tthis.quoteButtonPosition = {\n\t\t\t\tleft: $event.pageX,\n\t\t\t\ttop: $event.pageY,\n\t\t\t};\n\n\t\t\tawait this.$nextTick();\n\n\t\t\tthis.$refs.quoteButton.onMessageMouseUp(message, $event);\n\t\t},\n\t\tasync handleSecondScrollButtonClick()\n\t\t{\n\t\t\tthis.getScrollManager().scrollButtonClicked = false;\n\t\t\tif (this.dialog.hasNextPage)\n\t\t\t{\n\t\t\t\tthis.showLoadingBar();\n\t\t\t\tawait this.getMessageService().loadContext(this.dialog.lastMessageId);\n\t\t\t\tthis.hideLoadingBar();\n\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.dialog.chatId,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.getScrollManager().animatedScrollToMessage(this.dialog.lastMessageId, { withDateOffset: false });\n\t\t},\n\t\tonShowForwardPopup(event: BaseEvent)\n\t\t{\n\t\t\tconst { messagesIds } = event.getData();\n\t\t\tthis.forwardPopup.messagesIds = messagesIds;\n\t\t\tthis.forwardPopup.show = true;\n\t\t},\n\t\tonCloseForwardPopup()\n\t\t{\n\t\t\tthis.forwardPopup.messagesIds = [];\n\t\t\tthis.forwardPopup.show = false;\n\t\t},\n\t\tonMessageIsVisible(event: BaseEvent<{ messageId: number, dialogId: string }>)\n\t\t{\n\t\t\tconst { messageId, dialogId } = event.getData();\n\t\t\tif (dialogId !== this.dialogId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getVisibleMessagesManager().setMessageAsVisible(messageId);\n\n\t\t\tif (this.isChatVisible() === false)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.$store.getters['messages/anchors/isMessageHasAnchors'](messageId))\n\t\t\t{\n\t\t\t\tthis.readAnchorsIfMessageVisibleLongEnough(messageId);\n\t\t\t}\n\n\t\t\tconst message: ImModelMessage = this.$store.getters['messages/getById'](messageId);\n\t\t\tif (!message.viewed)\n\t\t\t{\n\t\t\t\tthis.messagesToRead.add(messageId);\n\t\t\t\tthis.debouncedReadHandler();\n\t\t\t}\n\t\t},\n\t\treadAnchorsIfMessageVisibleLongEnough(messageId: number)\n\t\t{\n\t\t\tconst messageVisibilityTimeThreshold = 200;\n\n\t\t\tif (this.getScrollManager().isScrolling)\n\t\t\t{\n\t\t\t\tthis.readMessageAnchorsAfterVisibilityThreshold(messageId, messageVisibilityTimeThreshold);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getAnchorService().debouncedReadMessageAnchors(messageId);\n\t\t\t}\n\t\t},\n\t\treadMessageAnchorsAfterVisibilityThreshold(messageId: number, messageVisibilityTimeThreshold: number)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (this.getVisibleMessagesManager().getVisibleMessages().includes(messageId))\n\t\t\t\t{\n\t\t\t\t\tthis.sequentiallyHighlightMessageHandler(messageId);\n\t\t\t\t\tthis.getAnchorService().debouncedReadMessageAnchors(messageId);\n\t\t\t\t}\n\t\t\t}, messageVisibilityTimeThreshold);\n\t\t},\n\t\tonMessageIsNotVisible(event: BaseEvent<{ messageId: number, dialogId: string }>)\n\t\t{\n\t\t\tconst { messageId, dialogId } = event.getData();\n\t\t\tif (dialogId !== this.dialogId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.getVisibleMessagesManager().setMessageAsNotVisible(messageId);\n\t\t},\n\t\t/* endregion Event handlers */\n\t\t/* region Init methods */\n\t\tinitContextMode()\n\t\t{\n\t\t\tconst layoutManager = LayoutManager.getInstance();\n\t\t\tif (!layoutManager.isChatContextAvailable(this.dialogId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.contextMode.active = true;\n\t\t\t// chat was loaded before, we didn't load context specifically\n\t\t\t// if chat wasn't loaded before - we load it with context\n\t\t\tthis.contextMode.messageIsLoaded = !this.dialogInited;\n\t\t},\n\t\tgetMessageService(): MessageService\n\t\t{\n\t\t\tif (!this.messageService)\n\t\t\t{\n\t\t\t\tthis.messageService = new MessageService({ chatId: this.dialog.chatId });\n\t\t\t}\n\n\t\t\treturn this.messageService;\n\t\t},\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\tgetAnchorService(): AnchorService\n\t\t{\n\t\t\tif (!this.anchorService)\n\t\t\t{\n\t\t\t\tthis.anchorService = new AnchorService();\n\t\t\t}\n\n\t\t\treturn this.anchorService;\n\t\t},\n\t\tgetScrollManager(): ScrollManager\n\t\t{\n\t\t\tif (!this.scrollManager)\n\t\t\t{\n\t\t\t\tthis.scrollManager = new ScrollManager();\n\t\t\t\tthis.scrollManager.subscribe(ScrollManager.events.onScrollTriggerUp, this.onScrollTriggerUp);\n\t\t\t\tthis.scrollManager.subscribe(ScrollManager.events.onScrollTriggerDown, this.onScrollTriggerDown);\n\t\t\t\tthis.scrollManager.subscribe(ScrollManager.events.onScrollThresholdPass, (event: BaseEvent<boolean>) => {\n\t\t\t\t\tthis.isScrolledUp = event.getData();\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.scrollManager;\n\t\t},\n\t\tgetPullWatchManager(): PullWatchManager\n\t\t{\n\t\t\tif (!this.pullWatchManager)\n\t\t\t{\n\t\t\t\tthis.pullWatchManager = new PullWatchManager(this.dialogId);\n\t\t\t}\n\n\t\t\treturn this.pullWatchManager;\n\t\t},\n\t\tgetVisibleMessagesManager(): VisibleMessagesManager\n\t\t{\n\t\t\tif (!this.visibleMessagesManager)\n\t\t\t{\n\t\t\t\tthis.visibleMessagesManager = new VisibleMessagesManager();\n\t\t\t}\n\n\t\t\treturn this.visibleMessagesManager;\n\t\t},\n\t\t/* endregion Init methods */\n\t\tisChatVisible(): boolean\n\t\t{\n\t\t\treturn this.windowFocused && !this.hasVisibleCall() && !this.hasCommentsOnTop;\n\t\t},\n\t\thasVisibleCall(): boolean\n\t\t{\n\t\t\treturn CallManager.getInstance().hasVisibleCall();\n\t\t},\n\t\tcloseDialogPopups()\n\t\t{\n\t\t\tthis.showQuoteButton = false;\n\t\t\tPopupManager.getPopupById(PopupType.dialogAvatarMenu)?.close();\n\t\t\tPopupManager.getPopupById(PopupType.dialogMessageMenu)?.close();\n\t\t\tPopupManager.getPopupById(PopupType.dialogReactionUsers)?.close();\n\t\t\tPopupManager.getPopupById(PopupType.dialogReadUsers)?.close();\n\t\t\tPopupManager.getPopupById(PopupType.messageBaseFileMenu)?.close();\n\t\t},\n\t\tsubscribeToEvents()\n\t\t{\n\t\t\tEventEmitter.subscribe(EventType.dialog.scrollToBottom, this.onScrollToBottom);\n\t\t\tEventEmitter.subscribe(EventType.call.onFold, this.onCallFold);\n\n\t\t\tthis.getEmitter().subscribe(EventType.dialog.onMessageIsVisible, this.onMessageIsVisible);\n\t\t\tthis.getEmitter().subscribe(EventType.dialog.onMessageIsNotVisible, this.onMessageIsNotVisible);\n\t\t\tthis.getEmitter().subscribe(EventType.dialog.goToMessageContext, this.onGoToMessageContext);\n\t\t\tthis.getEmitter().subscribe(EventType.dialog.showForwardPopup, this.onShowForwardPopup);\n\t\t\tthis.getEmitter().subscribe(EventType.dialog.showQuoteButton, this.onShowQuoteButton);\n\n\t\t\tEvent.bind(window, 'focus', this.onWindowFocus);\n\t\t\tEvent.bind(window, 'blur', this.onWindowBlur);\n\t\t},\n\t\tunsubscribeFromEvents()\n\t\t{\n\t\t\tEventEmitter.unsubscribe(EventType.dialog.scrollToBottom, this.onScrollToBottom);\n\t\t\tEventEmitter.unsubscribe(EventType.call.onFold, this.onCallFold);\n\n\t\t\tthis.getEmitter().unsubscribe(EventType.dialog.onMessageIsVisible, this.onMessageIsVisible);\n\t\t\tthis.getEmitter().unsubscribe(EventType.dialog.onMessageIsNotVisible, this.onMessageIsNotVisible);\n\t\t\tthis.getEmitter().unsubscribe(EventType.dialog.goToMessageContext, this.onGoToMessageContext);\n\t\t\tthis.getEmitter().unsubscribe(EventType.dialog.showForwardPopup, this.onShowForwardPopup);\n\t\t\tthis.getEmitter().unsubscribe(EventType.dialog.showQuoteButton, this.onShowQuoteButton);\n\n\t\t\tEvent.unbind(window, 'focus', this.onWindowFocus);\n\t\t\tEvent.unbind(window, 'blur', this.onWindowBlur);\n\t\t},\n\t\tgetContainer(): ?HTMLElement\n\t\t{\n\t\t\treturn this.$refs.container;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-dialog-chat__block bx-im-dialog-chat__scope\">\n\t\t\t<!-- Top -->\n\t\t\t<slot name=\"pinned-panel\">\n\t\t\t\t<PinnedMessages\n\t\t\t\t\tv-if=\"pinnedMessages.length > 0\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:messages=\"pinnedMessages\"\n\t\t\t\t\t@messageClick=\"onPinnedMessageClick\"\n\t\t\t\t\t@messageUnpin=\"onPinnedMessageUnpin\"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t\t<PullStatus/>\n\t\t\t<!-- Message list -->\n\t\t\t<div @scroll=\"onScroll\" class=\"bx-im-dialog-chat__scroll-container\" ref=\"container\">\n\t\t\t\t<slot name=\"message-list\">\n\t\t\t\t\t<MessageList :dialogId=\"dialogId\" :containerHeight=\"containerHeight\" />\n\t\t\t\t</slot>\n\t\t\t</div>\n\t\t\t<FloatButtons\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:isScrolledUp=\"isScrolledUp\"\n\t\t\t\t@scrollButtonClick=\"onScrollButtonClick\"\n\t\t\t\t@reactionsButtonClick=\"onReactionsButtonClick\"\n\t\t\t\t@mentionsButtonClick=\"onMentionsButtonClick\"\n\t\t\t>\n\t\t\t\t<template #additional-float-button><slot name=\"additional-float-button\" /></template>\n\t\t\t</FloatButtons>\n\t\t\t<!-- Absolute elements -->\n\t\t\t<ForwardPopup\n\t\t\t\tv-if=\"forwardPopup.show\"\n\t\t\t\t:messagesIds=\"forwardPopup.messagesIds\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t@close=\"onCloseForwardPopup\"\n\t\t\t/>\n\t\t\t<QuoteButton\n\t\t\t\tv-if=\"showQuoteButton\"\n\t\t\t\t:targetPosition=\"quoteButtonPosition\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t@close=\"showQuoteButton = false\"\n\t\t\t\tref=\"quoteButton\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n"],"names":["DEBOUNCE_TIME","AnchorService","constructor","messagesToRead","Set","Core","getStore","readChatAnchors","chatId","runAction","RestMethod","imV2ChatAnchorRead","data","then","dispatch","catch","error","console","debouncedReadMessageAnchors","messageId","add","clearTimeout","setTimeout","Promise","resolve","size","imV2AnchorRead","messageIds","clear","EVENT_NAMESPACE","ScrollManager","EventEmitter","isScrolling","currentScroll","lastScroll","chatIsScrolledUp","scrollButtonClicked","startScrollNeeded","setEventNamespace","setContainer","container","onScroll","event","target","scrollTop","isScrollingDown","isScrollingUp","SCROLLING_THRESHOLD","leftSpaceBottom","scrollHeight","clientHeight","isStartScrollCompleted","emit","events","onScrollTriggerDown","onScrollTriggerUp","checkIfChatIsScrolledUp","SCROLLED_UP_THRESHOLD","availableScrollHeight","newFlag","onScrollThresholdPass","scrollToBottom","Logger","warn","forceScrollTo","animatedScrollToBottom","animatedScrollTo","scrollToMessage","params","element","getDomElementById","scrollPosition","setStartScrollNeeded","flag","animatedScrollToMessage","position","cancelAnimatedScroll","scroll","top","behavior","adjustScrollOnHistoryAddition","oldContainerHeight","newContainerHeight","newScrollPosition","Animation","start","end","elementProperty","callback","cancel","isAtTheTop","isAtTheBottom","isAroundBottom","POSITION_THRESHOLD","id","querySelector","FLOATING_DATE_OFFSET","MESSAGE_BOTTOM_OFFSET","withDateOffset","messageTop","offset","offsetTop","messageBottom","messageCenter","MESSAGES_TAG_PREFIX","COMMENTS_TAG_PREFIX","PullWatchManager","dialogId","getters","getPullClient","subscribe","unsubscribe","clearWatch","extendWatch","imV2ChatExtendPullWatch","role","UserRole","guest","DemoChatBuilder","isDemoDialogId","ChannelManager","isChannel","type","ChatType","comment","VisibleMessagesManager","setMessageAsVisible","setMessageAsNotVisible","delete","getVisibleMessages","getFirstMessageId","firstVisibleMessage","sort","a","b","findUniqueNumbers","arr1","arr2","set1","set2","filter","num","has","sharedQueues","Map","sequentializeShared","fn","delay","context","get","wrapped","sequentialize","set","queue","isRunning","run","task","shift","result","apply","args","wait","push","ms","PinnedMessage","components","MessageAvatar","props","message","Object","required","showUnpinIcon","Boolean","emits","computed","AvatarSize","typedMessage","text","Parser","purifyMessage","authorId","author","$store","template","HeaderTitle","name","totalPinCounter","Number","title","loc","methods","phraseCode","replacements","$Bitrix","Loc","getMessage","CounterControl","messagePosition","HeaderPin","contextDialogId","String","isSinglePin","isCommentChatContext","dialog","PinnedHeader","isListOpened","PinnedMessages","messages","Array","upcomingMessageIndex","sortedPinnedMessages","length","canUnpin","PermissionManager","getInstance","canPerformActionByRole","ActionByRole","pinMessage","isCommentChat","upcomingMessage","upcomingMessageDisplayPosition","watch","newValue","toggleList","shouldResetIndex","resetHeaderIndex","Type","isUndefined","incrementHeaderIndex","nextIndex","index","clickOnHeaderMessage","emitMessageClick","clickOnHeaderMessageFromList","$emit","CONTAINER_HEIGHT","CONTAINER_WIDTH","MESSAGE_TEXT_NODE_CLASS","POPUP_ID","QuoteButton","MessengerPopup","default","targetPosition","validator","value","isNumber","left","config","offsetLeftForCenteredPopup","bindElement","className","background","bindOptions","animation","width","height","autoHide","padding","mounted","Event","bind","window","onMouseDown","onMessageMouseUp","button","prepareSelectedText","$refs","contains","Utils","browser","isFirefox","getSelection","toString","range","getRangeAt","rangeContents","cloneContents","nodesToIterate","childNodes","messageNode","node","isImage","getAttribute","isLineBreak","textContent","HTMLElement","tagName","toLowerCase","nodeName","isText","onQuoteClick","Quote","prepareInlineMessageQuote","sendQuoteEvent","emitter","getEmitter","eventEmitter","FloatButtonColor","freeze","accent","alert","success","FloatButtonIcon","chevronDown","heart","atSymbol","FloatButton","counter","color","values","includes","icon","buttonClassname","formattedCounter","ScrollButton","floatButtonProps","ReactionsButton","reactionCounter","AnchorType","reaction","MentionsButton","mentionCounter","mention","FloatButtons","isScrolledUp","dialogInited","inited","showScrollButton","hasNextPage","showMentionsButton","showReactionsButton","hasAdditionalButtonSlot","slot","$slots","slotChildren","children","onReactionsButtonClick","onMentionsButtonClick","onScrollButtonClick","ChatDialog","MessageList","PullStatus","ForwardPopup","saveScrollOnExit","reloadOnExit","clearOnExit","forwardPopup","show","messagesIds","contextMode","active","messageIsLoaded","windowFocused","showQuoteButton","isJumpingToAnchor","containerHeight","quoteButtonPosition","layout","messageCollection","pinnedMessages","isOpened","openedDialogId","entityId","isGuest","debouncedScrollHandler","SCROLLING_DEBOUNCE_DELAY","Runtime","debounce","getScrollManager","debouncedReadHandler","READING_DEBOUNCE_DELAY","readQueuedMessages","sequentiallyHighlightMessageHandler","highlightMessage","anchorMessages","hasCommentsOnTop","oldValue","newMessageIdsWithAnchor","visibleMessageIds","getVisibleMessagesManager","forEach","getAnchorService","getPullWatchManager","onChatInited","handler","commentsWereClosed","readVisibleMessages","flush","created","initContextMode","$nextTick","getContainer","scrollOnStart","document","hasFocus","subscribeToEvents","beforeUnmount","unsubscribeFromEvents","saveScrollPosition","handleMessagesOnExit","closeDialogPopups","readAllAnchors","contextId","goToMessageContext","markedId","BlockType","newMessages","savedPositionMessageId","lastReadId","isLastMessageId","lastMessageId","hasUnread","showLoadingBar","EventType","hideLoadingBar","hasMessage","hasAccess","errorCode","AccessManager","checkMessageAccess","ErrorCode","accessDeniedByTariff","Analytics","historyLimit","onGoToContextLimitExceeded","FeatureManager","chatHistory","openFeatureSlider","getMessageService","loadContext","HIGHLIGHT_CLASS","HIGHLIGHT_DURATION","Dom","addClass","removeClass","fields","getChatService","clearChat","readChatQueuedMessages","LOAD_MESSAGES_ON_EXIT_DELAY","reloadMessageList","messagesCanBeRead","readMessage","visibleMessages","viewed","isChatVisible","permissionManager","clearDialogMark","onDialogInited","oldHeight","hasPreparedHistoryMessages","drawPreparedHistoryMessages","isLoading","hasPrevPage","loadHistory","hasPreparedUnreadMessages","drawPreparedUnreadMessages","loadUnread","onScrollToBottom","threshold","DialogScrollThreshold","halfScreenUp","getData","hasVisibleCall","firstUnreadId","nearTheBottom","onGoToMessageContext","onPinnedMessageClick","onPinnedMessageUnpin","unpinMessage","messagePins","onUnpin","handleSecondScrollButtonClick","loadInitialMessages","goToNearestMessageWithAnchor","anchorType","nextMessage","onWindowFocus","onWindowBlur","onCallFold","callDialogId","CallManager","getCurrentCallDialogId","onShowQuoteButton","$event","send","pageX","pageY","quoteButton","onShowForwardPopup","onCloseForwardPopup","onMessageIsVisible","readAnchorsIfMessageVisibleLongEnough","messageVisibilityTimeThreshold","readMessageAnchorsAfterVisibilityThreshold","onMessageIsNotVisible","layoutManager","LayoutManager","isChatContextAvailable","messageService","MessageService","chatService","ChatService","anchorService","scrollManager","pullWatchManager","visibleMessagesManager","PopupManager","getPopupById","PopupType","dialogAvatarMenu","close","dialogMessageMenu","dialogReactionUsers","dialogReadUsers","messageBaseFileMenu","call","onFold","showForwardPopup","unbind"],"mappings":"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"}