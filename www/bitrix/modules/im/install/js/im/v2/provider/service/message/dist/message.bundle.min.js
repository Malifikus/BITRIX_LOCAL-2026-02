this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,a,t,r,i,l,o,d,c,b,n,v,h){"use strict";var p=babelHelpers.classPrivateFieldLooseKey("store");var g=babelHelpers.classPrivateFieldLooseKey("chatId");var P=babelHelpers.classPrivateFieldLooseKey("userManager");var L=babelHelpers.classPrivateFieldLooseKey("preparedHistoryMessages");var F=babelHelpers.classPrivateFieldLooseKey("preparedUnreadMessages");var H=babelHelpers.classPrivateFieldLooseKey("isLoading");var u=babelHelpers.classPrivateFieldLooseKey("prepareInitialMessages");var B=babelHelpers.classPrivateFieldLooseKey("handleLoadedMessages");var M=babelHelpers.classPrivateFieldLooseKey("updateModels");var f=babelHelpers.classPrivateFieldLooseKey("setDialogInited");var y=babelHelpers.classPrivateFieldLooseKey("prepareTariffRestrictions");var m=babelHelpers.classPrivateFieldLooseKey("getDialog");var I=babelHelpers.classPrivateFieldLooseKey("sendAnalytics");var S=babelHelpers.classPrivateFieldLooseKey("getStickerMessages");class C{constructor(e){Object.defineProperty(this,S,{value:x});Object.defineProperty(this,I,{value:T});Object.defineProperty(this,m,{value:R});Object.defineProperty(this,y,{value:j});Object.defineProperty(this,f,{value:K});Object.defineProperty(this,M,{value:E});Object.defineProperty(this,B,{value:O});Object.defineProperty(this,u,{value:w});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:[]});Object.defineProperty(this,F,{writable:true,value:[]});Object.defineProperty(this,H,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,p)[p]=b.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new s.UserManager;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e}async loadUnread(){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]||!babelHelpers.classPrivateFieldLooseBase(this,m)[m]().hasNextPage){return Promise.resolve(false)}v.Logger.warn("MessageService: loadUnread");const e=babelHelpers.classPrivateFieldLooseBase(this,p)[p].getters["messages/getLastId"](babelHelpers.classPrivateFieldLooseBase(this,g)[g]);if(!e){v.Logger.warn("MessageService: no lastUnreadMessageId, cant load unread");return Promise.resolve(false)}babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true;const s={chatId:babelHelpers.classPrivateFieldLooseBase(this,g)[g],filter:{lastId:e},order:{id:"ASC"},limit:C.MESSAGE_REQUEST_LIMIT};const a=await h.runAction(n.RestMethod.imV2ChatMessageTail,{data:s}).catch((e=>{console.error("MessageService: loadUnread error:",e);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=false}));v.Logger.warn("MessageService: loadUnread result",a);babelHelpers.classPrivateFieldLooseBase(this,F)[F]=a.messages;const t={...a,tariffRestrictions:babelHelpers.classPrivateFieldLooseBase(this,y)[y](a.tariffRestrictions)};await babelHelpers.classPrivateFieldLooseBase(this,M)[M](t);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=false;return Promise.resolve()}async loadHistory(){if(babelHelpers.classPrivateFieldLooseBase(this,H)[H]||!babelHelpers.classPrivateFieldLooseBase(this,m)[m]().hasPrevPage){return Promise.resolve(false)}v.Logger.warn("MessageService: loadHistory");const e=babelHelpers.classPrivateFieldLooseBase(this,p)[p].getters["messages/getFirstId"](babelHelpers.classPrivateFieldLooseBase(this,g)[g]);if(!e){v.Logger.warn("MessageService: no lastHistoryMessageId, cant load unread");return Promise.resolve()}babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true;const s={chatId:babelHelpers.classPrivateFieldLooseBase(this,g)[g],filter:{lastId:e},order:{id:"DESC"},limit:C.MESSAGE_REQUEST_LIMIT};const a=await h.runAction(n.RestMethod.imV2ChatMessageTail,{data:s}).catch((e=>{console.error("MessageService: loadHistory error:",e);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=false}));v.Logger.warn("MessageService: loadHistory result",a);babelHelpers.classPrivateFieldLooseBase(this,L)[L]=a.messages;const t=a.hasNextPage;const r={...a,hasPrevPage:t,hasNextPage:null};await babelHelpers.classPrivateFieldLooseBase(this,M)[M](r);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=false;return Promise.resolve()}hasPreparedHistoryMessages(){return babelHelpers.classPrivateFieldLooseBase(this,L)[L].length>0}drawPreparedHistoryMessages(){if(!this.hasPreparedHistoryMessages()){return Promise.resolve()}return babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("messages/setChatCollection",{messages:babelHelpers.classPrivateFieldLooseBase(this,L)[L]}).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,L)[L]=[];return true}))}hasPreparedUnreadMessages(){return babelHelpers.classPrivateFieldLooseBase(this,F)[F].length>0}drawPreparedUnreadMessages(){if(!this.hasPreparedUnreadMessages()){return Promise.resolve()}return babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("messages/setChatCollection",{messages:babelHelpers.classPrivateFieldLooseBase(this,F)[F]}).then((()=>{babelHelpers.classPrivateFieldLooseBase(this,F)[F]=[];return true}))}async loadFirstPage(){v.Logger.warn("MessageService: loadFirstPage for: ",babelHelpers.classPrivateFieldLooseBase(this,g)[g]);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true;const e={data:{chatId:babelHelpers.classPrivateFieldLooseBase(this,g)[g],limit:C.MESSAGE_REQUEST_LIMIT,order:{id:"ASC"}}};const s=await h.runAction(n.RestMethod.imV2ChatMessageTail,e).catch((([e])=>{console.error("MessageService: loadFirstPage error:",e);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=false;throw e}));v.Logger.warn("MessageService: loadFirstPage result",s);await babelHelpers.classPrivateFieldLooseBase(this,B)[B](s);await babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("chats/update",{dialogId:babelHelpers.classPrivateFieldLooseBase(this,m)[m]().dialogId,fields:{hasPrevPage:false,hasNextPage:s.hasNextPage}});babelHelpers.classPrivateFieldLooseBase(this,H)[H]=false}loadContext(e){const s={[n.RestMethod.imV2ChatMessageGetContext]:{id:e,range:C.MESSAGE_REQUEST_LIMIT},[n.RestMethod.imV2ChatMessageRead]:{chatId:babelHelpers.classPrivateFieldLooseBase(this,g)[g],ids:[e]}};v.Logger.warn("MessageService: loadContext for: ",e);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true;return h.callBatch(s).then((e=>{v.Logger.warn("MessageService: loadContext result",e);return babelHelpers.classPrivateFieldLooseBase(this,B)[B](e[n.RestMethod.imV2ChatMessageGetContext])})).catch((e=>{babelHelpers.classPrivateFieldLooseBase(this,I)[I](e);d.Notifier.message.handleLoadContextError(e);console.error("MessageService: loadContext error:",e)})).finally((()=>{babelHelpers.classPrivateFieldLooseBase(this,H)[H]=false}))}async loadContextByChatId(e){const s={data:{commentChatId:e}};const a=await h.runAction(n.RestMethod.imV2ChatMessageGetContext,s).catch((([e])=>{console.error("MessageService: loadContextByChatId error:",e);throw e}));const t=a.commentInfo;const r=t.find((s=>s.chatId===e));const i=r==null?void 0:r.messageId;v.Logger.warn("MessageService: loadContextByChatId result",a);void babelHelpers.classPrivateFieldLooseBase(this,B)[B](a);return i}reloadMessageList(){v.Logger.warn("MessageService: loadChatOnExit for: ",babelHelpers.classPrivateFieldLooseBase(this,g)[g]);let e=0;if(babelHelpers.classPrivateFieldLooseBase(this,m)[m]().chatId<=0){return}if(babelHelpers.classPrivateFieldLooseBase(this,m)[m]().markedId){e=babelHelpers.classPrivateFieldLooseBase(this,m)[m]().markedId}else if(babelHelpers.classPrivateFieldLooseBase(this,m)[m]().savedPositionMessageId){e=babelHelpers.classPrivateFieldLooseBase(this,m)[m]().savedPositionMessageId}const s=babelHelpers.classPrivateFieldLooseBase(this,m)[m]().inited;babelHelpers.classPrivateFieldLooseBase(this,f)[f](false);if(e){void this.loadContext(e).finally((()=>{babelHelpers.classPrivateFieldLooseBase(this,f)[f](true,s)}))}void this.loadInitialMessages().finally((()=>{babelHelpers.classPrivateFieldLooseBase(this,f)[f](true,s)}))}async loadInitialMessages(){v.Logger.warn("MessageService: loadInitialMessages for: ",babelHelpers.classPrivateFieldLooseBase(this,g)[g]);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=true;const e={data:{chatId:babelHelpers.classPrivateFieldLooseBase(this,g)[g],limit:C.MESSAGE_REQUEST_LIMIT}};const s=await h.runAction(n.RestMethod.imV2ChatMessageList,e).catch((([e])=>{console.error("MessageService: loadInitialMessages error:",e);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=false;throw e}));v.Logger.warn("MessageService: loadInitialMessages result",s);s.messages=babelHelpers.classPrivateFieldLooseBase(this,u)[u](s.messages);await babelHelpers.classPrivateFieldLooseBase(this,B)[B](s);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=false;return Promise.resolve()}isLoading(){return babelHelpers.classPrivateFieldLooseBase(this,H)[H]}}function w(e){if(e.length===0){return e}const s=babelHelpers.classPrivateFieldLooseBase(this,m)[m]().lastMessageId;const a=Math.max(...e.map((e=>e.id)));if(a>=s){return e}const t=babelHelpers.classPrivateFieldLooseBase(this,p)[p].getters["messages/getByChatId"](babelHelpers.classPrivateFieldLooseBase(this,g)[g]);const r=t.filter((e=>e.id>a));v.Logger.warn("MessageService: loadInitialMessages: local id is higher than server one",r);return[...e,...r]}function O(e){const{messages:s}=e;const a=babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("messages/setChatCollection",{messages:s,clearCollection:true});const t=babelHelpers.classPrivateFieldLooseBase(this,M)[M](e);return Promise.all([a,t])}function E(e){const{files:s,users:t,usersShort:r,reactions:i,hasPrevPage:l,hasNextPage:o,additionalMessages:d,commentInfo:c,copilot:b,tariffRestrictions:n,stickers:v}=e;const h=babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("chats/update",{dialogId:babelHelpers.classPrivateFieldLooseBase(this,m)[m]().dialogId,fields:{hasPrevPage:l,hasNextPage:o,tariffRestrictions:n}});const g=Promise.all([babelHelpers.classPrivateFieldLooseBase(this,P)[P].setUsersToModel(t),babelHelpers.classPrivateFieldLooseBase(this,P)[P].addUsersToModel(r)]);const L=babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("files/set",s);const F=babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("messages/reactions/set",i);const H=babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("messages/store",d);const u=babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("messages/comments/set",c);const B=new a.CopilotManager;const M=B.handleChatLoadResponse(b);const f=Promise.all([babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("stickers/messages/set",babelHelpers.classPrivateFieldLooseBase(this,S)[S](e)),babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("stickers/set",v)]);return Promise.all([h,L,g,F,H,u,M,f])}function K(e,s=true){const a={inited:e,loading:!e};if(e===true&&!s){delete a.inited}babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatch("chats/update",{dialogId:babelHelpers.classPrivateFieldLooseBase(this,m)[m]().dialogId,fields:a})}function j(e){const s=babelHelpers.classPrivateFieldLooseBase(this,m)[m]().dialogId;const a=babelHelpers.classPrivateFieldLooseBase(this,p)[p].getters["chats/get"](s);if(!a){return e}const{tariffRestrictions:{isHistoryLimitExceeded:t}}=a;if(t===true){return{...e,isHistoryLimitExceeded:true}}return e}function R(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p].getters["chats/getByChatId"](babelHelpers.classPrivateFieldLooseBase(this,g)[g])}function T(e){if(e.code!==n.ErrorCode.message.notFound){return}const s=babelHelpers.classPrivateFieldLooseBase(this,m)[m]();const a=s.dialogId;t.Analytics.getInstance().messageDelete.onNotFoundNotification({dialogId:a})}function x(e){const s=[];e.messages.forEach((e=>{const a=Boolean(e.params.STICKER_PARAMS);if(!a){return}s.push({messageId:e.id,...e.params.STICKER_PARAMS})}));return s}C.MESSAGE_REQUEST_LIMIT=25;var A=babelHelpers.classPrivateFieldLooseKey("store");var U=babelHelpers.classPrivateFieldLooseKey("restClient");class D{constructor(){Object.defineProperty(this,A,{writable:true,value:void 0});Object.defineProperty(this,U,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,A)[A]=b.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,U)[U]=b.Core.getRestClient()}pinMessage(e,s){v.Logger.warn(`Dialog: PinManager: pin message ${s}`);const a={chatId:e,messageId:s};void babelHelpers.classPrivateFieldLooseBase(this,A)[A].dispatch("messages/pin/add",a);babelHelpers.classPrivateFieldLooseBase(this,U)[U].callMethod(n.RestMethod.imV2ChatMessagePin,{id:s}).catch((e=>{console.error("Dialog: PinManager: error pinning message",e.error());void babelHelpers.classPrivateFieldLooseBase(this,A)[A].dispatch("messages/pin/delete",a)}))}unpinMessage(e,s){v.Logger.warn(`Dialog: PinManager: unpin message ${s}`);const a={chatId:e,messageId:s};void babelHelpers.classPrivateFieldLooseBase(this,A)[A].dispatch("messages/pin/delete",a);babelHelpers.classPrivateFieldLooseBase(this,U)[U].callMethod(n.RestMethod.imV2ChatMessageUnpin,{id:s}).catch((e=>{console.error("Dialog: PinManager: error unpinning message",e.error());void babelHelpers.classPrivateFieldLooseBase(this,A)[A].dispatch("messages/pin/add",a)}))}}var X=babelHelpers.classPrivateFieldLooseKey("updateMessageModel");var V=babelHelpers.classPrivateFieldLooseKey("getMessage");class _{constructor(){Object.defineProperty(this,V,{value:G});Object.defineProperty(this,X,{value:k})}editMessageText(e,s){v.Logger.warn("MessageService: editMessageText",e,s);const a=babelHelpers.classPrivateFieldLooseBase(this,V)[V](e);if(!a){return}babelHelpers.classPrivateFieldLooseBase(this,X)[X](e,s);const t={data:{id:e,fields:{message:s}}};h.runAction(n.RestMethod.imV2ChatMessageUpdate,t).catch((([e])=>{console.error("MessageService: editMessageText error:",e)}))}}function k(e,s){const a=babelHelpers.classPrivateFieldLooseBase(this,V)[V](e);const t=a.viewedByOthers;b.Core.getStore().dispatch("messages/update",{id:e,fields:{text:s,isEdited:t}})}function G(e){return b.Core.getStore().getters["messages/getById"](e)}var N=babelHelpers.classPrivateFieldLooseKey("store");var Q=babelHelpers.classPrivateFieldLooseKey("chatId");var $=babelHelpers.classPrivateFieldLooseKey("updateModels");var q=babelHelpers.classPrivateFieldLooseKey("shallowMessageDelete");var z=babelHelpers.classPrivateFieldLooseKey("canDeleteCompletely");var J=babelHelpers.classPrivateFieldLooseKey("completeMessageDelete");var W=babelHelpers.classPrivateFieldLooseKey("updateRecentForCompleteDelete");var Y=babelHelpers.classPrivateFieldLooseKey("updateChatForCompleteDelete");var Z=babelHelpers.classPrivateFieldLooseKey("deleteMessageOnServer");var ee=babelHelpers.classPrivateFieldLooseKey("deleteTemporaryMessage");var se=babelHelpers.classPrivateFieldLooseKey("getPreviousMessageId");var ae=babelHelpers.classPrivateFieldLooseKey("sendDeleteEvent");var te=babelHelpers.classPrivateFieldLooseKey("getChat");class re{constructor(e){Object.defineProperty(this,te,{value:ge});Object.defineProperty(this,ae,{value:pe});Object.defineProperty(this,se,{value:he});Object.defineProperty(this,ee,{value:ve});Object.defineProperty(this,Z,{value:ne});Object.defineProperty(this,Y,{value:be});Object.defineProperty(this,W,{value:ce});Object.defineProperty(this,J,{value:de});Object.defineProperty(this,z,{value:oe});Object.defineProperty(this,q,{value:le});Object.defineProperty(this,$,{value:ie});Object.defineProperty(this,N,{writable:true,value:void 0});Object.defineProperty(this,Q,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=e;babelHelpers.classPrivateFieldLooseBase(this,N)[N]=b.Core.getStore()}async deleteMessages(e){v.Logger.warn("MessageService: deleteMessage",e);const s=[];e.forEach((e=>{if(i.Utils.text.isUuidV4(e)){babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](e);return}babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](e);babelHelpers.classPrivateFieldLooseBase(this,$)[$](e);s.push(e)}));if(s.length>0){void babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](s)}}}function ie(e){const s=babelHelpers.classPrivateFieldLooseBase(this,N)[N].getters["messages/getById"](e);if(babelHelpers.classPrivateFieldLooseBase(this,z)[z](s)){void babelHelpers.classPrivateFieldLooseBase(this,J)[J](s);return}void babelHelpers.classPrivateFieldLooseBase(this,q)[q](s)}function le(e){babelHelpers.classPrivateFieldLooseBase(this,N)[N].dispatch("messages/update",{id:e.id,fields:{text:"",isDeleted:true,files:[],attach:[],replyId:0}})}function oe(e){const s=babelHelpers.classPrivateFieldLooseBase(this,te)[te]();const a=[n.ChatType.comment,n.ChatType.lines];if(a.includes(s.type)){return false}const t=e.authorId===b.Core.getUserId();const r=t?n.ActionByRole.deleteCompleteOwnMessage:n.ActionByRole.deleteOthersMessage;const i=l.PermissionManager.getInstance().canPerformActionByRole(r,s.dialogId);if(i){return true}return!e.viewedByOthers}function de(e){const s=babelHelpers.classPrivateFieldLooseBase(this,te)[te]();if(e.id===s.lastMessageId){const s=babelHelpers.classPrivateFieldLooseBase(this,se)[se](e.id);babelHelpers.classPrivateFieldLooseBase(this,W)[W](s);babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](s)}babelHelpers.classPrivateFieldLooseBase(this,N)[N].dispatch("messages/delete",{id:e.id})}function ce(e){const s=babelHelpers.classPrivateFieldLooseBase(this,te)[te]();if(!e){babelHelpers.classPrivateFieldLooseBase(this,N)[N].dispatch("recent/hide",{id:s.dialogId});return}babelHelpers.classPrivateFieldLooseBase(this,N)[N].dispatch("recent/update",{id:s.dialogId,fields:{messageId:e}})}function be(e){const s=babelHelpers.classPrivateFieldLooseBase(this,te)[te]();babelHelpers.classPrivateFieldLooseBase(this,N)[N].dispatch("chats/update",{dialogId:s.dialogId,fields:{lastMessageId:e,lastId:e}});babelHelpers.classPrivateFieldLooseBase(this,N)[N].dispatch("chats/clearLastMessageViews",{dialogId:s.dialogId})}function ne(e){return h.runAction(n.RestMethod.imV2ChatMessageDelete,{data:{messageIds:e}}).catch((e=>{console.error("MessageService: deleteMessage error:",e)}))}function ve(e){const s=babelHelpers.classPrivateFieldLooseBase(this,te)[te]();const a=babelHelpers.classPrivateFieldLooseBase(this,N)[N].getters["recent/get"](s.dialogId);if(a.messageId===e){const a=babelHelpers.classPrivateFieldLooseBase(this,se)[se](e);babelHelpers.classPrivateFieldLooseBase(this,N)[N].dispatch("recent/update",{id:s.dialogId,fields:{messageId:a}})}babelHelpers.classPrivateFieldLooseBase(this,N)[N].dispatch("messages/delete",{id:e})}function he(e){var s;const a=babelHelpers.classPrivateFieldLooseBase(this,N)[N].getters["messages/getPreviousMessage"]({messageId:e,chatId:babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]});return(s=a==null?void 0:a.id)!=null?s:0}function pe(e){r.EventEmitter.emit(n.EventType.dialog.onMessageDeleted,{messageId:e})}function ge(){return babelHelpers.classPrivateFieldLooseBase(this,N)[N].getters["chats/getByChatId"](babelHelpers.classPrivateFieldLooseBase(this,Q)[Q])}var Pe=babelHelpers.classPrivateFieldLooseKey("chatId");var Le=babelHelpers.classPrivateFieldLooseKey("store");var Fe=babelHelpers.classPrivateFieldLooseKey("restClient");class He{constructor(e){Object.defineProperty(this,Pe,{writable:true,value:void 0});Object.defineProperty(this,Le,{writable:true,value:void 0});Object.defineProperty(this,Fe,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=e;babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]=b.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=b.Core.getRestClient()}markMessage(e){v.Logger.warn("MessageService: markMessage",e);const{dialogId:s}=babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].getters["chats/getByChatId"](babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]);void babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].dispatch("recent/unread",{id:s,action:true});void babelHelpers.classPrivateFieldLooseBase(this,Le)[Le].dispatch("chats/update",{dialogId:s,fields:{markedId:e}});babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe].callMethod(n.RestMethod.imV2ChatMessageMark,{dialogId:s,id:e}).catch((e=>{console.error("MessageService: error marking message",e.error())}))}}var ue=babelHelpers.classPrivateFieldLooseKey("chatId");var Be=babelHelpers.classPrivateFieldLooseKey("store");var Me=babelHelpers.classPrivateFieldLooseKey("restClient");class fe{constructor(e){Object.defineProperty(this,ue,{writable:true,value:void 0});Object.defineProperty(this,Be,{writable:true,value:void 0});Object.defineProperty(this,Me,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]=e;babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]=b.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]=b.Core.getRestClient()}addMessageToFavorite(e){v.Logger.warn("MessageService: addMessageToFavorite",e);babelHelpers.classPrivateFieldLooseBase(this,Me)[Me].callMethod(n.RestMethod.imChatFavoriteAdd,{MESSAGE_ID:e}).catch((e=>{console.error("MessageService: error adding message to favorite",e.error())}));d.Notifier.message.onAddToFavoriteComplete()}removeMessageFromFavorite(e){v.Logger.warn("MessageService: removeMessageFromFavorite",e);void babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].dispatch("sidebar/favorites/deleteByMessageId",{chatId:babelHelpers.classPrivateFieldLooseBase(this,ue)[ue],messageId:e});babelHelpers.classPrivateFieldLooseBase(this,Me)[Me].callMethod(n.RestMethod.imChatFavoriteDelete,{MESSAGE_ID:e}).catch((e=>{console.error("MessageService: error removing message from favorite",e.error())}))}}var ye=babelHelpers.classPrivateFieldLooseKey("store");class me{constructor(){Object.defineProperty(this,ye,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]=b.Core.getStore()}transcribe(e,s){v.Logger.warn("TranscribeService: transcribe:",e);const a={data:{messageId:s,fileId:e}};void babelHelpers.classPrivateFieldLooseBase(this,ye)[ye].dispatch("files/setTranscription",{fileId:e,status:n.TranscriptionStatus.PENDING,transcriptText:null,errorCode:null});return h.runAction(n.RestMethod.imV2DiskFileTranscribe,a).then((e=>{void babelHelpers.classPrivateFieldLooseBase(this,ye)[ye].dispatch("files/setTranscription",e)})).catch((s=>{const[a]=s;void babelHelpers.classPrivateFieldLooseBase(this,ye)[ye].dispatch("files/setTranscription",{fileId:e,status:n.TranscriptionStatus.ERROR,transcriptText:null,errorCode:a==null?void 0:a.code});console.error("TranscribeService: transcribe error:",s)}))}}var Ie=babelHelpers.classPrivateFieldLooseKey("loadService");var Se=babelHelpers.classPrivateFieldLooseKey("pinService");var Ce=babelHelpers.classPrivateFieldLooseKey("editService");var we=babelHelpers.classPrivateFieldLooseKey("deleteService");var Oe=babelHelpers.classPrivateFieldLooseKey("markService");var Ee=babelHelpers.classPrivateFieldLooseKey("favoriteService");var Ke=babelHelpers.classPrivateFieldLooseKey("transcribeService");var je=babelHelpers.classPrivateFieldLooseKey("initServices");class Re{static getMessageRequestLimit(){return C.MESSAGE_REQUEST_LIMIT}constructor(e){Object.defineProperty(this,je,{value:Te});Object.defineProperty(this,Ie,{writable:true,value:void 0});Object.defineProperty(this,Se,{writable:true,value:void 0});Object.defineProperty(this,Ce,{writable:true,value:void 0});Object.defineProperty(this,we,{writable:true,value:void 0});Object.defineProperty(this,Oe,{writable:true,value:void 0});Object.defineProperty(this,Ee,{writable:true,value:void 0});Object.defineProperty(this,Ke,{writable:true,value:void 0});const{chatId:s}=e;babelHelpers.classPrivateFieldLooseBase(this,je)[je](s)}loadUnread(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].loadUnread()}loadHistory(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].loadHistory()}hasPreparedHistoryMessages(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].hasPreparedHistoryMessages()}drawPreparedHistoryMessages(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].drawPreparedHistoryMessages()}hasPreparedUnreadMessages(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].hasPreparedUnreadMessages()}drawPreparedUnreadMessages(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].drawPreparedUnreadMessages()}isLoading(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].isLoading()}loadContext(e){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].loadContext(e)}loadContextByChatId(e){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].loadContextByChatId(e)}loadFirstPage(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].loadFirstPage()}reloadMessageList(){babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].reloadMessageList()}loadInitialMessages(){return babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie].loadInitialMessages()}pinMessage(e,s){babelHelpers.classPrivateFieldLooseBase(this,Se)[Se].pinMessage(e,s)}unpinMessage(e,s){babelHelpers.classPrivateFieldLooseBase(this,Se)[Se].unpinMessage(e,s)}markMessage(e){babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe].markMessage(e)}addMessageToFavorite(e){babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee].addMessageToFavorite(e)}removeMessageFromFavorite(e){babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee].removeMessageFromFavorite(e)}editMessageText(e,s){babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].editMessageText(e,s)}deleteMessages(e){babelHelpers.classPrivateFieldLooseBase(this,we)[we].deleteMessages(e)}transcribe(e,s){return babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke].transcribe(e,s)}}function Te(e){babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]=new C(e);babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]=new _;babelHelpers.classPrivateFieldLooseBase(this,we)[we]=new re(e);babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]=new D;babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]=new He(e);babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]=new fe(e);babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke]=new me}e.MessageService=Re})(this.BX.Messenger.v2.Service=this.BX.Messenger.v2.Service||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX,BX.Messenger.v2.Lib,BX.Vue3.Vuex,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=message.bundle.map.js