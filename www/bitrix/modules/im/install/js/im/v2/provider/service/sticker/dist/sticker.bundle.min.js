this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Provider=this.BX.Messenger.v2.Provider||{};(function(e,t,r,n,i,a,c){"use strict";function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function t(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function e(t,r,n){return t[r]=n}}function l(e,t,r,i){var a=t&&t.prototype instanceof d?t:d,c=Object.create(a.prototype),o=new T(i||[]);return n(c,"_invoke",{value:S(e,r,o)}),c}function p(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h={};function d(){}function f(){}function v(){}var k={};u(k,a,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(E([])));g&&g!==t&&r.call(g,a)&&(k=g);var w=v.prototype=d.prototype=Object.create(k);function m(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function i(n,a,c,o){var s=p(e[n],e,a);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==babelHelpers["typeof"](l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){i("next",e,c,o)}),(function(e){i("throw",e,c,o)})):t.resolve(l).then((function(e){u.value=e,c(u)}),(function(e){return i("throw",e,c,o)}))}o(s.arg)}var a;n(this,"_invoke",{value:function e(r,n){function c(){return new t((function(e,t){i(r,n,e,t)}))}return a=a?a.then(c,c):c()}})}function S(e,t,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return G()}for(r.method=i,r.arg=a;;){var c=r.delegate;if(c){var o=P(c,r);if(o){if(o===h)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=p(e,t,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function P(e,t){var r=t.method,n=e.iterator[r];if(undefined===n)return t.delegate=null,"throw"===r&&e.iterator["return"]&&(t.method="return",t.arg=undefined,P(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var i=p(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,h):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=undefined,t.done=!0,t};return i.next=i}}return{next:G}}function G(){return{value:undefined,done:!0}}return f.prototype=v,n(w,"constructor",{value:v,configurable:!0}),n(v,"constructor",{value:f,configurable:!0}),f.displayName=u(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},m(b.prototype),u(b.prototype,c,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var c=new b(l(t,r,n,i),a);return e.isGeneratorFunction(r)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},m(w),u(w,s,"Generator"),u(w,a,(function(){return this})),u(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=E,T.prototype={constructor:T,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(L),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var n=this;function i(e,r){return o.type="throw",o.arg=t,n.next=e,r&&(n.method="next",n.arg=undefined),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var c=this.tryEntries[a],o=c.completion;if("root"===c.tryLoc)return i("end");if(c.tryLoc<=this.prev){var s=r.call(c,"catchLoc"),u=r.call(c,"finallyLoc");if(s&&u){if(this.prev<c.catchLoc)return i(c.catchLoc,!0);if(this.prev<c.finallyLoc)return i(c.finallyLoc)}else if(s){if(this.prev<c.catchLoc)return i(c.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return i(c.finallyLoc)}}}},abrupt:function e(t,n){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var c=a;break}}c&&("break"===t||"continue"===t)&&c.tryLoc<=n&&n<=c.finallyLoc&&(c=null);var o=c?c.completion:{};return o.type=t,o.arg=n,c?(this.method="next",this.next=c.finallyLoc,h):this.complete(o)},complete:function e(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),h},finish:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),L(n),h}},catch:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var a=i.arg;L(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function e(t,r,n){return this.delegate={iterator:E(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=undefined),h}},e}function s(e,t){l(e,t);t.add(e)}function u(e,t,r){l(e,t);t.set(e,r)}function l(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function p(e,t,r){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return r}var h=10;var d=new WeakMap;var f=new WeakMap;var v=new WeakMap;var k=new WeakSet;var y=new WeakSet;var g=new WeakSet;var w=new WeakSet;var m=new WeakSet;var b=new WeakSet;var S=function(){function e(){babelHelpers.classCallCheck(this,e);s(this,b);s(this,m);s(this,w);s(this,g);s(this,y);s(this,k);u(this,d,{writable:true,value:null});u(this,f,{writable:true,value:""});u(this,v,{writable:true,value:true})}babelHelpers.createClass(e,[{key:"initFirstPage",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(){return o().wrap((function e(t){while(1)switch(t.prev=t.next){case 0:if(!babelHelpers.classPrivateFieldGet(this,d)){t.next=2;break}return t.abrupt("return",Promise.resolve());case 2:return t.abrupt("return",p(this,y,x).call(this));case 3:case"end":return t.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadNextPage",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(){return o().wrap((function e(t){while(1)switch(t.prev=t.next){case 0:if(babelHelpers.classPrivateFieldGet(this,v)){t.next=2;break}return t.abrupt("return",Promise.resolve());case 2:return t.abrupt("return",p(this,y,x).call(this));case 3:case"end":return t.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"loadPack",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(t){var c,s,u,l,p,h,d,f;return o().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:c=t.id,s=t.type;u=r.Core.getStore().getters["stickers/packs/hasPack"]({id:c,type:s});if(!u){o.next=4;break}return o.abrupt("return",Promise.resolve());case 4:o.next=6;return i.runAction(n.RestMethod.imV2StickerPackGet,{data:{id:c,type:s}})["catch"]((function(e){a.Logger.warn("StickerService: pack request error",e)}));case 6:l=o.sent;p=l.pack,h=l.stickers;d=r.Core.getStore().dispatch("stickers/packs/set",[p]);f=r.Core.getStore().dispatch("stickers/set",h);return o.abrupt("return",Promise.all([f,d]));case 11:case"end":return o.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"linkPack",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(t){var s=this;var u,l;return o().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:u=t.id,l=t.type;void r.Core.getStore().dispatch("stickers/packs/link",{id:u,type:l});o.next=4;return i.runAction(n.RestMethod.imV2StickerPackLink,{data:{id:u,type:l}})["catch"]((function(e){var t=babelHelpers.slicedToArray(e,1),r=t[0];p(s,b,H).call(s,r.code);a.Logger.warn("StickerService: link pack error",e);c.Notifier.sticker.handleLinkPackError()}));case 4:case"end":return o.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"createPack",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(t){var c=this;var s,u,l,h,d,f,v,k;return o().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:s=t.uuids,u=t.type,l=t.name;o.next=3;return i.runAction(n.RestMethod.imV2StickerPackAdd,{data:{uuids:s,type:u,name:l}})["catch"]((function(e){var t=babelHelpers.slicedToArray(e,1),r=t[0];p(c,b,H).call(c,r.code);a.Logger.warn("StickerService: pack creation error",e)}));case 3:h=o.sent;d=h.pack,f=h.stickers;v=r.Core.getStore().dispatch("stickers/packs/addNew",d);k=r.Core.getStore().dispatch("stickers/set",f);return o.abrupt("return",Promise.all([v,k]));case 8:case"end":return o.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"renamePack",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(t){var s,u,l;return o().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:s=t.id,u=t.type,l=t.name;void r.Core.getStore().dispatch("stickers/packs/rename",{id:s,type:u,name:l});o.next=4;return i.runAction(n.RestMethod.imV2StickerPackRename,{data:{id:s,type:u,name:l}})["catch"]((function(e){a.Logger.warn("StickerService: rename pack error",e);c.Notifier.sticker.handleLinkPackError()}));case 4:case"end":return o.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addStickers",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(t){var c=this;var s,u,l,h,d,f,v,k;return o().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:s=t.uuids,u=t.id,l=t.type;o.next=3;return i.runAction(n.RestMethod.imV2StickerAdd,{data:{uuids:s,packId:u,packType:l}})["catch"]((function(e){var t=babelHelpers.slicedToArray(e,1),r=t[0];p(c,b,H).call(c,r.code);a.Logger.warn("StickerService: add stickers error",e);throw e}));case 3:h=o.sent;d=h.pack,f=h.stickers;v=r.Core.getStore().dispatch("stickers/packs/addNew",d);k=r.Core.getStore().dispatch("stickers/set",f);return o.abrupt("return",Promise.all([v,k]));case 8:case"end":return o.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"updatePack",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(r){var n,i,a,c,s;return o().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:n=r.uuids,i=r.id,a=r.type,c=r.name;s=[];if(t.Type.isArrayFilled(n)){s.push(this.addStickers({uuids:n,id:i,type:a}))}if(p(this,m,G).call(this,{id:i,type:a,name:c})){s.push(this.renamePack({uuids:n,id:i,type:a,name:c}))}return o.abrupt("return",Promise.all(s));case 5:case"end":return o.stop()}}),e,this)})));function r(t){return e.apply(this,arguments)}return r}()},{key:"deletePack",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(t){var c,s;return o().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:c=t.id,s=t.type;void r.Core.getStore().dispatch("stickers/packs/delete",{id:c,type:s});void r.Core.getStore().dispatch("stickers/deleteByPack",{id:c,type:s});o.next=5;return i.runAction(n.RestMethod.imV2StickerPackDelete,{data:{id:c,type:s}})["catch"]((function(e){a.Logger.warn("StickerService: delete pack error",e)}));case 5:case"end":return o.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"unlinkPack",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(t){var c,s;return o().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:c=t.id,s=t.type;void r.Core.getStore().dispatch("stickers/packs/unlink",{id:c,type:s});o.next=4;return i.runAction(n.RestMethod.imV2StickerPackUnlink,{data:{id:c,type:s}})["catch"]((function(e){a.Logger.warn("StickerService: unlink pack error",e)}));case 4:case"end":return o.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"clearRecent",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(){return o().wrap((function e(t){while(1)switch(t.prev=t.next){case 0:void r.Core.getStore().dispatch("stickers/recent/clear");t.next=3;return i.runAction(n.RestMethod.imV2StickerRecentDeleteAll,{data:{}})["catch"]((function(e){a.Logger.warn("StickerService: clear recent error",e)}));case 3:case"end":return t.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"removeFromRecent",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(t){var c,s,u;return o().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:c=t.id,s=t.packType,u=t.packId;void r.Core.getStore().dispatch("stickers/recent/delete",{id:c,packType:s,packId:u});o.next=4;return i.runAction(n.RestMethod.imV2StickerRecentDelete,{data:{id:c,packId:u,packType:s}})["catch"]((function(e){a.Logger.warn("StickerService: remove sticker from recent error",e)}));case 4:case"end":return o.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"deleteStickerFromPack",value:function(){var e=babelHelpers.asyncToGenerator(o().mark((function e(c){var s,u,l,p;return o().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:s=c.ids,u=c.packId,l=c.packType;void r.Core.getStore().dispatch("stickers/delete",{ids:s,packType:l,packId:u});p=r.Core.getStore().getters["stickers/getByPack"]({id:u,type:l});if(!t.Type.isArrayFilled(p)){void r.Core.getStore().dispatch("stickers/packs/delete",{id:u,type:l})}o.next=6;return i.runAction(n.RestMethod.imV2StickerDelete,{data:{ids:s,packId:u,packType:l}})["catch"]((function(e){a.Logger.warn("StickerService: remove sticker from pack error",e)}));case 6:case"end":return o.stop()}}),e)})));function c(t){return e.apply(this,arguments)}return c}()}],[{key:"getInstance",value:function e(){if(!this.instance){this.instance=new this}return this.instance}}]);return e}();function P(){var e={limit:h};var t=!babelHelpers.classPrivateFieldGet(this,d)&&!babelHelpers.classPrivateFieldGet(this,f);if(!t){e.id=babelHelpers.classPrivateFieldGet(this,d);e.type=babelHelpers.classPrivateFieldGet(this,f)}return e}function x(){return L.apply(this,arguments)}function L(){L=babelHelpers.asyncToGenerator(o().mark((function e(){var t,r,c,s;return o().wrap((function e(o){while(1)switch(o.prev=o.next){case 0:t={data:p(this,k,P).call(this)};r=!babelHelpers.classPrivateFieldGet(this,d)&&!babelHelpers.classPrivateFieldGet(this,f);c=r?n.RestMethod.imV2StickerPackLoad:n.RestMethod.imV2StickerPackTail;o.next=5;return i.runAction(c,t)["catch"]((function(e){a.Logger.warn("StickerService: page request error",e)}));case 5:s=o.sent;p(this,g,T).call(this,s);p(this,w,E).call(this,s);case 8:case"end":return o.stop()}}),e,this)})));return L.apply(this,arguments)}function T(e){babelHelpers.classPrivateFieldSet(this,v,e.hasNextPage);var t=e.packs[e.packs.length-1];if(t){babelHelpers.classPrivateFieldSet(this,d,t.id);babelHelpers.classPrivateFieldSet(this,f,t.type)}}function E(e){var t=e.packs,n=e.stickers,i=e.recentStickers,a=i===void 0?[]:i;var c=r.Core.getStore().dispatch("stickers/packs/set",t);var o=r.Core.getStore().dispatch("stickers/set",n);var s=r.Core.getStore().dispatch("stickers/recent/set",a);return Promise.all([o,c,s])}function G(e){var t=e.id,n=e.type,i=e.name;var a=r.Core.getStore().getters["stickers/packs/getByIdentifier"]({id:t,type:n});if(!a){return false}return a.name!==i}function H(e){var t={MAX_STICKERS_ERROR:c.Notifier.sticker.handleAddStickersError,MAX_PACKS_ERROR:c.Notifier.sticker.handleAddPackError};if(!t[e]){return}t[e]()}e.StickerService=S})(this.BX.Messenger.v2.Provider.Service=this.BX.Messenger.v2.Provider.Service||{},BX,BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=sticker.bundle.map.js