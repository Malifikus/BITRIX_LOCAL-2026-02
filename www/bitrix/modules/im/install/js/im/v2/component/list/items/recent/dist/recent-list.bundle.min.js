this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,n,s,i,a,r,o,c,l,h,d,g,m,C,u,I,v,p,_,T,M,E,L,S){"use strict";const f={[I.ChatType.openChannel]:C.Loc.getMessage("IM_LIST_RECENT_CHAT_TYPE_OPEN_CHANNEL"),[I.ChatType.channel]:C.Loc.getMessage("IM_LIST_RECENT_CHAT_TYPE_PRIVATE_CHANNEL"),[I.ChatType.generalChannel]:C.Loc.getMessage("IM_LIST_RECENT_CHAT_TYPE_OPEN_CHANNEL"),default:C.Loc.getMessage("IM_LIST_RECENT_CHAT_TYPE_GROUP_V2")};const y={name:"MessageText",components:{MessageAvatar:l.MessageAvatar},props:{item:{type:Object,required:true}},computed:{AvatarSize:()=>l.AvatarSize,recentItem(){return this.item},dialog(){return this.$store.getters["chats/get"](this.recentItem.dialogId,true)},user(){return this.$store.getters["users/get"](this.recentItem.dialogId,true)},message(){return this.$store.getters["recent/getMessage"](this.recentItem.dialogId)},needsBirthdayPlaceholder(){return this.$store.getters["recent/needsBirthdayPlaceholder"](this.recentItem.dialogId)},needsVacationPlaceholder(){return this.$store.getters["recent/needsVacationPlaceholder"](this.recentItem.dialogId)},showLastMessage(){return this.$store.getters["application/settings/get"](I.Settings.recent.showLastMessage)},notesText(){return this.loc("IM_LIST_RECENT_CHAT_SELF_SUBTITLE")},hiddenMessageText(){var t;if(this.isNotes){return this.notesText}if(this.isUser){return this.$store.getters["users/getPosition"](this.recentItem.dialogId)}return(t=f[this.dialog.type])!=null?t:f.default},isLastMessageAuthor(){return this.showLastMessage&&this.message.authorId===u.Core.getUserId()},messageText(){if(this.message.isDeleted){return this.loc("IM_LIST_RECENT_DELETED_MESSAGE")}const t=r.Parser.purifyRecent(this.recentItem);if(!this.showLastMessage||!t){return this.hiddenMessageText}return t},formattedMessageText(){const t=27;return E.Utils.text.insertUnseenWhitespace(this.messageText,t)},preparedDraftContent(){const t=this.loc("IM_LIST_RECENT_MESSAGE_DRAFT_2");const e="#TEXT#".length;const n=t.slice(0,-e);const s=C.Text.encode(this.formattedDraftText);return`\n\t\t\t\t<span class="bx-im-list-recent-item__message_draft-prefix">${n}</span>\n\t\t\t\t<span class="bx-im-list-recent-item__message_text_content">${s}</span>\n\t\t\t`},formattedDraftText(){return r.Parser.purify({text:this.recentItem.draft.text,showIconIfEmptyText:false})},formattedVacationEndDate(){return a.DateTimeFormat.format("d.m.Y",this.user.absent)},isUser(){return this.dialog.type===I.ChatType.user},isChat(){return!this.isUser},isNotes(){return this.$store.getters["chats/isNotes"](this.recentItem.dialogId)}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="bx-im-list-recent-item__message_container">\n\t\t\t<span class="bx-im-list-recent-item__message_text">\n\t\t\t\t<span v-if="recentItem.draft.text" v-html="preparedDraftContent"></span>\n\t\t\t\t<span v-else-if="recentItem.invitation.isActive" class="bx-im-list-recent-item__balloon_container --invitation">\n\t\t\t\t\t<span class="bx-im-list-recent-item__balloon">{{ loc('IM_LIST_RECENT_INVITATION_NOT_ACCEPTED_MSGVER_1') }}</span>\n\t\t\t\t</span>\n\t\t\t\t<span v-else-if="needsBirthdayPlaceholder" class="bx-im-list-recent-item__balloon_container --birthday" :title="loc('IM_LIST_RECENT_BIRTHDAY')">\n\t\t\t\t\t<span class="bx-im-list-recent-item__balloon">{{ loc('IM_LIST_RECENT_BIRTHDAY') }}</span>\n\t\t\t\t</span>\n\t\t\t\t<span v-else-if="needsVacationPlaceholder" class="bx-im-list-recent-item__balloon_container --vacation">\n\t\t\t\t\t<span class="bx-im-list-recent-item__balloon">\n\t\t\t\t\t\t{{ loc('IM_LIST_RECENT_VACATION', {'#VACATION_END_DATE#': formattedVacationEndDate}) }}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<span v-if="isLastMessageAuthor" class="bx-im-list-recent-item__self_author-icon"></span>\n\t\t\t\t\t<MessageAvatar\n\t\t\t\t\t\tv-else-if="isChat && message.authorId"\n\t\t\t\t\t\t:messageId="message.id"\n\t\t\t\t\t\t:authorId="message.authorId"\n\t\t\t\t\t\t:size="AvatarSize.XXS"\n\t\t\t\t\t\tclass="bx-im-list-recent-item__author-avatar"\n\t\t\t\t\t/>\n\t\t\t\t\t<span>{{ formattedMessageText }}</span>\n\t\t\t\t</template>\n\t\t\t</span>\n\t\t</div>\n\t`};const b={name:"ItemCounters",props:{item:{type:Object,required:true},isChatMuted:{type:Boolean,required:true}},computed:{recentItem(){return this.item},dialog(){return this.$store.getters["chats/get"](this.recentItem.dialogId,true)},user(){return this.$store.getters["users/get"](this.recentItem.dialogId,true)},isUser(){return this.dialog.type===I.ChatType.user},isSelfChat(){return this.isUser&&this.user.id===u.Core.getUserId()},invitation(){return this.recentItem.invitation},totalCounter(){return this.dialog.counter+this.channelCommentsCounter},channelCommentsCounter(){return this.$store.getters["counters/getChannelCommentsCounter"](this.dialog.chatId)},formattedCounter(){return this.formatCounter(this.totalCounter)},showCounterContainer(){return!this.invitation.isActive},showPinnedIcon(){const t=this.totalCounter===0;return this.recentItem.pinned&&t&&!this.recentItem.unread},showUnreadWithoutCounter(){return this.recentItem.unread&&this.totalCounter===0},showUnreadWithCounter(){return this.recentItem.unread&&this.totalCounter>0},showMention(){return this.$store.getters["messages/anchors/isChatHasAnchorsWithType"](this.dialog.chatId,I.AnchorType.mention)&&!this.isSelfChat},showCounter(){const t=this.showMention&&this.totalCounter===1;return!t&&!this.recentItem.unread&&this.totalCounter>0&&!this.isSelfChat},containerClasses(){const t=this.dialog.counter===0&&this.channelCommentsCounter>0;const e=this.dialog.counter>0&&this.channelCommentsCounter>0;const n=this.dialog.counter>0&&this.showMention;return{"--muted":this.isChatMuted,"--comments-only":t,"--with-comments":e,"--with-mention-and-counter":n}}},methods:{formatCounter(t){return t>99?"99+":t.toString()}},template:`\n\t\t<div v-if="showCounterContainer" :class="containerClasses" class="bx-im-list-recent-item__counters_wrap">\n\t\t\t<div class="bx-im-list-recent-item__counters_container">\n\t\t\t\t<div v-if="showPinnedIcon" class="bx-im-list-recent-item__pinned-icon"></div>\n\t\t\t\t<div v-else class="bx-im-list-recent-item__counters">\n\t\t\t\t\t<div v-if="showMention" class="bx-im-list-recent-item__mention">\n\t\t\t\t\t\t<div class="bx-im-list-recent-item__mention-icon"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="showUnreadWithoutCounter" class="bx-im-list-recent-item__counter_number --no-counter"></div>\n\t\t\t\t\t<div v-else-if="showUnreadWithCounter" class="bx-im-list-recent-item__counter_number --with-unread">\n\t\t\t\t\t\t{{ formattedCounter }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else-if="showCounter" class="bx-im-list-recent-item__counter_number">\n\t\t\t\t\t\t{{ formattedCounter }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const A={none:"",like:"like",sending:"sending",sent:"sent",viewed:"viewed"};const x={props:{item:{type:Object,required:true}},data(){return{}},computed:{recentItem(){return this.item},user(){return this.$store.getters["users/get"](this.recentItem.dialogId,true)},dialog(){return this.$store.getters["chats/get"](this.recentItem.dialogId,true)},message(){return this.$store.getters["recent/getMessage"](this.recentItem.dialogId)},isChatWithReactions(){return this.$store.getters["messages/anchors/isChatHasAnchorsWithType"](this.dialog.chatId,I.AnchorType.reaction)},showLike(){return this.isChatWithReactions||this.recentItem.liked},messageStatus(){if(this.message.sending){return I.OwnMessageStatus.sending}if(this.message.viewedByOthers){return I.OwnMessageStatus.viewed}return I.OwnMessageStatus.sent},statusIcon(){if(this.isSelfChat||this.isBot){return A.none}if(this.showLike){return A.like}if(!this.isLastMessageAuthor||this.needsBirthdayPlaceholder||this.hasDraft){return A.none}return this.messageStatus},isLastMessageAuthor(){var t;return((t=this.message)==null?void 0:t.authorId)===u.Core.getUserId()},isSelfChat(){return this.isUser&&this.user.id===u.Core.getUserId()},isUser(){return this.dialog.type===I.ChatType.user},isBot(){if(this.isUser){return this.user.type===I.UserType.bot}return false},hasDraft(){return Boolean(this.recentItem.draft.text)},needsBirthdayPlaceholder(){if(!this.isUser){return false}return this.$store.getters["recent/needsBirthdayPlaceholder"](this.recentItem.dialogId)}},template:`\n\t\t<div class="bx-im-list-recent-item__status-icon" :class="'--' + statusIcon"></div>\n\t`};const R={name:"RecentItem",components:{ChatAvatar:l.ChatAvatar,ChatTitle:n.ChatTitle,MessageText:y,MessageStatus:x,ItemCounters:b,InputActionIndicator:e.InputActionIndicator},props:{item:{type:Object,required:true}},computed:{AvatarSize:()=>l.AvatarSize,recentItem(){return this.item},formattedDate(){if(this.needsBirthdayPlaceholder){return this.loc("IM_LIST_RECENT_BIRTHDAY_DATE")}return this.formatDate(this.itemDate)},formattedCounter(){return this.dialog.counter>99?"99+":this.dialog.counter.toString()},dialog(){return this.$store.getters["chats/get"](this.recentItem.dialogId,true)},layout(){return this.$store.getters["application/getLayout"]},message(){return this.$store.getters["recent/getMessage"](this.recentItem.dialogId)},itemDate(){return this.$store.getters["recent/getSortDate"](this.recentItem.dialogId)},isUser(){return this.dialog.type===I.ChatType.user},isChat(){return!this.isUser},isChannel(){return i.ChannelManager.isChannel(this.recentItem.dialogId)},isNotes(){return this.$store.getters["chats/isNotes"](this.recentItem.dialogId)},avatarType(){return this.isNotes?l.ChatAvatarType.notes:""},chatType(){return this.isNotes?n.ChatTitleType.notes:""},isChatSelected(){const t=[I.Layout.chat,I.Layout.updateChat,I.Layout.collab,I.Layout.copilot,I.Layout.taskComments];if(!t.includes(this.layout.name)){return false}return this.layout.entityId===this.recentItem.dialogId},isChatMuted(){const t=this.dialog.muteList.find((t=>t===u.Core.getUserId()));return Boolean(t)},hasActiveInputAction(){return this.$store.getters["chats/inputActions/isChatActive"](this.recentItem.dialogId)},needsBirthdayPlaceholder(){return this.$store.getters["recent/needsBirthdayPlaceholder"](this.recentItem.dialogId)},showLastMessage(){return this.$store.getters["application/settings/get"](I.Settings.recent.showLastMessage)},invitation(){return this.recentItem.invitation},wrapClasses(){return{"--pinned":this.recentItem.pinned,"--selected":this.isChatSelected}},itemClasses(){return{"--no-text":!this.showLastMessage}}},methods:{formatDate(t){return s.DateFormatter.formatByTemplate(t,s.DateTemplate.recent)},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div :data-id="recentItem.dialogId" :class="wrapClasses" class="bx-im-list-recent-item__wrap">\n\t\t\t<div :class="itemClasses" class="bx-im-list-recent-item__container">\n\t\t\t\t<div class="bx-im-list-recent-item__avatar_container">\n\t\t\t\t\t<div v-if="invitation.isActive" class="bx-im-list-recent-item__avatar_invitation"></div>\n\t\t\t\t\t<div v-else class="bx-im-list-recent-item__avatar_content">\n\t\t\t\t\t\t<ChatAvatar \n\t\t\t\t\t\t\t:avatarDialogId="recentItem.dialogId" \n\t\t\t\t\t\t\t:contextDialogId="recentItem.dialogId" \n\t\t\t\t\t\t\t:size="AvatarSize.XL" \n\t\t\t\t\t\t\t:withSpecialTypeIcon="!hasActiveInputAction"\n\t\t\t\t\t\t\t:customType="avatarType"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<InputActionIndicator v-if="hasActiveInputAction" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-list-recent-item__content_container">\n\t\t\t\t\t<div class="bx-im-list-recent-item__content_header">\n\t\t\t\t\t\t<ChatTitle \n\t\t\t\t\t\t\t:dialogId="recentItem.dialogId" \n\t\t\t\t\t\t\t:withMute="true" \n\t\t\t\t\t\t\t:withAutoDelete="true"\n\t\t\t\t\t\t\t:customType="chatType"\n\t\t\t\t\t\t\t:showItsYou="false"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="bx-im-list-recent-item__date">\n\t\t\t\t\t\t\t<MessageStatus :item="item" />\n\t\t\t\t\t\t\t<span>{{ formattedDate }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bx-im-list-recent-item__content_bottom">\n\t\t\t\t\t\t<MessageText :item="recentItem" />\n\t\t\t\t\t\t<ItemCounters :item="recentItem" :isChatMuted="isChatMuted" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const B={[I.ChatType.chat]:C.Loc.getMessage("IM_LIST_RECENT_CREATE_CHAT_DEFAULT_TITLE"),[I.ChatType.videoconf]:C.Loc.getMessage("IM_LIST_RECENT_CREATE_CONFERENCE_DEFAULT_TITLE"),[I.ChatType.channel]:C.Loc.getMessage("IM_LIST_RECENT_CREATE_CHANNEL_DEFAULT_TITLE"),[I.ChatType.collab]:C.Loc.getMessage("IM_LIST_RECENT_CREATE_COLLAB_DEFAULT_TITLE")};const k={[I.ChatType.chat]:C.Loc.getMessage("IM_LIST_RECENT_CREATE_CHAT_SUBTITLE"),[I.ChatType.videoconf]:C.Loc.getMessage("IM_LIST_RECENT_CREATE_CONFERENCE_SUBTITLE"),[I.ChatType.channel]:C.Loc.getMessage("IM_LIST_RECENT_CREATE_CHANNEL_SUBTITLE"),[I.ChatType.collab]:C.Loc.getMessage("IM_LIST_RECENT_CREATE_COLLAB_SUBTITLE")};const N=20;const U={name:"CreateChat",components:{EmptyAvatar:l.EmptyAvatar,BIcon:o.BIcon},data(){return{chatTitle:"",chatAvatarFile:"",chatType:""}},computed:{AvatarSize:()=>l.AvatarSize,OutlineIcons:()=>o.Outline,Color:()=>I.Color,CLOSE_ICON_SIZE:()=>N,chatCreationIsOpened(){const{name:t}=this.$store.getters["application/getLayout"];return t===I.Layout.createChat},preparedTitle(){if(this.chatTitle===""){return B[this.chatType]}return this.chatTitle},preparedSubtitle(){return k[this.chatType]},preparedAvatar(){if(!this.chatAvatarFile){return null}return URL.createObjectURL(this.chatAvatarFile)},avatarType(){if(this.chatType===I.ChatType.collab){return l.EmptyAvatarType.collab}if(this.chatType===I.ChatType.chat){return l.EmptyAvatarType.default}return l.EmptyAvatarType.squared},closeIconColor(){return this.chatCreationIsOpened?I.Color.white:I.Color.black}},created(){const t=_.CreateChatManager.getInstance().getChatTitle();if(t){this.chatTitle=t}const e=_.CreateChatManager.getInstance().getChatAvatar();if(e){this.chatAvatarFile=e}this.chatType=_.CreateChatManager.getInstance().getChatType();_.CreateChatManager.getInstance().subscribe(_.CreateChatManager.events.titleChange,this.onTitleChange);_.CreateChatManager.getInstance().subscribe(_.CreateChatManager.events.avatarChange,this.onAvatarChange);_.CreateChatManager.getInstance().subscribe(_.CreateChatManager.events.chatTypeChange,this.onChatTypeChange)},beforeUnmount(){_.CreateChatManager.getInstance().unsubscribe(_.CreateChatManager.events.titleChange,this.onTitleChange);_.CreateChatManager.getInstance().unsubscribe(_.CreateChatManager.events.avatarChange,this.onAvatarChange);_.CreateChatManager.getInstance().unsubscribe(_.CreateChatManager.events.chatTypeChange,this.onChatTypeChange)},methods:{onTitleChange(t){this.chatTitle=t.getData()},onAvatarChange(t){this.chatAvatarFile=t.getData()},onChatTypeChange(t){this.chatType=t.getData()},onClick(){_.CreateChatManager.getInstance().startChatCreation(this.chatType,{clearCurrentCreation:false})},onCancel(){_.CreateChatManager.getInstance().clearExternalFields();_.CreateChatManager.getInstance().setCreationStatus(false);if(!this.chatCreationIsOpened){return}void c.Messenger.openChat()},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-list-recent-create-chat__container">\n\t\t\t<div class="bx-im-list-recent-item__wrap" :class="{'--selected': chatCreationIsOpened}" @click="onClick">\n\t\t\t\t<div class="bx-im-list-recent-item__container">\n\t\t\t\t\t<div class="bx-im-list-recent-create-chat__avatar-container">\n\t\t\t\t\t\t<EmptyAvatar \n\t\t\t\t\t\t\t:url="preparedAvatar" \n\t\t\t\t\t\t\t:size="AvatarSize.XL"\n\t\t\t\t\t\t\t:title="chatTitle"\n\t\t\t\t\t\t\t:type="avatarType"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bx-im-list-recent-item__content_container">\n\t\t\t\t\t\t<div class="bx-im-list-recent-item__content_header">\n\t\t\t\t\t\t\t<div class="bx-im-list-recent-create-chat__header --ellipsis">\n\t\t\t\t\t\t\t\t{{ preparedTitle }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-im-list-recent-item__content_bottom">\n\t\t\t\t\t\t\t<div class="bx-im-list-recent-item__message_container">\n\t\t\t\t\t\t\t\t{{ preparedSubtitle }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="OutlineIcons.CROSS_M"\n\t\t\t\t\t\t:size="CLOSE_ICON_SIZE"\n\t\t\t\t\t\t:color="closeIconColor"\n\t\t\t\t\t\tclass="bx-im-list-recent-create-chat__icon-close"\n\t\t\t\t\t\t@click.stop="onCancel"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const w={name:"EmptyState",components:{ChatButton:h.ChatButton,RecentEmptyState:S.RecentEmptyState},computed:{ButtonSize:()=>h.ButtonSize,ButtonColor:()=>h.ButtonColor,canInviteUsers(){return d.FeatureManager.isFeatureAvailable(d.Feature.intranetInviteAvailable)}},methods:{onInviteUsersClick(){g.InviteManager.openInviteSlider()},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<RecentEmptyState\n\t\t\t:title="loc('IM_LIST_RECENT_EMPTY_STATE_TITLE')"\n\t\t\t:subtitle="loc('IM_LIST_RECENT_EMPTY_STATE_SUBTITLE')"\n\t\t>\n\t\t\t<ChatButton\n\t\t\t\tv-if="canInviteUsers"\n\t\t\t\t:size="ButtonSize.L"\n\t\t\t\t:isRounded="true"\n\t\t\t\t:text="loc('IM_LIST_RECENT_EMPTY_STATE_INVITE_USERS')"\n\t\t\t\t@click="onInviteUsersClick"\n\t\t\t/>\n\t\t</RecentEmptyState>\n\t`};const D={name:"ActiveCallList",props:{listIsScrolled:{type:Boolean,required:true}},emits:["onCallClick"],computed:{componentToRender(){return m.ActiveCallList}},template:`\n\t\t<component v-if="componentToRender" :is="componentToRender" :listIsScrolled="listIsScrolled" @onCallClick="$emit('onCallClick', $event)" />\n\t`};class $ extends v.EventEmitter{static getInstance(){if(!this.instance){this.instance=new this}return this.instance}constructor(){super();this.setEventNamespace($.eventNamespace);this.init()}isSupported(){return!C.Type.isUndefined(window.BroadcastChannel)&&!E.Utils.platform.isBitrixDesktop()}init(){if(!this.isSupported()){return}this.channel=new BroadcastChannel($.channelName);this.channel.addEventListener("message",(({data:{type:t,data:e}})=>{this.emit(t,e)}))}sendRecentList(t){if(!this.isSupported()){return}this.channel.postMessage({type:$.events.recentListUpdate,data:t})}}$.instance=null;$.channelName="im-recent";$.eventNamespace="BX.Messenger.v2.Recent.BroadcastManager";$.events={recentListUpdate:"recentListUpdate"};class P{constructor(){this.store=u.Core.getStore()}init(){this.onDialogInitedHandler=this.onDialogInited.bind(this);v.EventEmitter.subscribe(I.EventType.dialog.onDialogInited,this.onDialogInitedHandler)}destroy(){v.EventEmitter.unsubscribe(I.EventType.dialog.onDialogInited,this.onDialogInitedHandler)}onDialogInited(t){const{dialogId:e}=t.getData();const n=this.store.getters["recent/get"](e);if(!n||!n.liked){return}this.store.dispatch("recent/like",{id:e,liked:false})}}const X={name:"RecentUnreadList",components:{LoadingState:p.ListLoadingState,RecentItem:R,ActiveCallList:D,CreateChat:U,EmptyState:w,RecentEmptyState:S.RecentEmptyState},emits:["chatClick"],data(){return{isLoading:false,isLoadingNextPage:false,listIsScrolled:false,isCreatingChat:false}},computed:{collection(){return this.getUnreadRecentService().getCollection()},isEmptyCollection(){return this.collection.length===0},preparedItems(){return[...this.collection].sort(((t,e)=>{const n=this.$store.getters["recent/getSortDate"](t.dialogId);const s=this.$store.getters["recent/getSortDate"](e.dialogId);return s-n}))},activeCalls(){return this.$store.getters["recent/calls/get"]},pinnedItems(){return this.preparedItems.filter((t=>t.pinned===true))},generalItems(){return this.preparedItems.filter((t=>t.pinned===false))}},async created(){this.contextMenuManager=new M.RecentMenu({emitter:this.getEmitter()});this.initLikeManager();this.initCreateChatManager();this.isLoading=true;await this.getUnreadRecentService().loadFirstPage({ignorePreloadedItems:true});this.isLoading=false;void T.DraftManager.getInstance().initDraftHistory()},beforeUnmount(){this.contextMenuManager.destroy();this.destroyLikeManager();this.destroyCreateChatManager()},methods:{async onScroll(t){this.listIsScrolled=t.target.scrollTop>0;this.getUnreadRecentService().hasMoreItemsToLoad=true;this.contextMenuManager.close();if(!E.Utils.dom.isOneScreenRemaining(t.target)||!this.getUnreadRecentService().hasMoreItemsToLoad){return}this.isLoadingNextPage=true;await this.getUnreadRecentService().loadNextPage();this.isLoadingNextPage=false},onClick(t){this.$emit("chatClick",t.dialogId)},onRightClick(t,e){if(E.Utils.key.isCombination(e,"Alt+Shift")){return}const n={dialogId:t.dialogId,recentItem:t,compactMode:false};const s={left:e.clientX,top:e.clientY};this.contextMenuManager.openMenu(n,s);e.preventDefault()},onCallClick({item:t,$event:e}){this.onClick(t,e)},initLikeManager(){this.likeManager=new P;this.likeManager.init()},destroyLikeManager(){this.likeManager.destroy()},initCreateChatManager(){if(_.CreateChatManager.getInstance().isCreating()){this.isCreatingChat=true}this.onCreationStatusChange=t=>{this.isCreatingChat=t.getData()};_.CreateChatManager.getInstance().subscribe(_.CreateChatManager.events.creationStatusChange,this.onCreationStatusChange)},destroyCreateChatManager(){_.CreateChatManager.getInstance().unsubscribe(_.CreateChatManager.events.creationStatusChange,this.onCreationStatusChange)},getUnreadRecentService(){if(!this.service){this.service=L.UnreadRecentService.getInstance()}return this.service},getEmitter(){return this.$Bitrix.eventEmitter},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-list-recent__container">\n\t\t\t<ActiveCallList :listIsScrolled="listIsScrolled" @onCallClick="onCallClick"/>\n\t\t\t<CreateChat v-if="isCreatingChat" />\n\t\t\t<LoadingState v-if="isLoading" />\n\t\t\t<div v-else @scroll="onScroll" class="bx-im-list-recent__scroll-container">\n\t\t\t\t<RecentEmptyState\n\t\t\t\t\tv-if="isEmptyCollection" \n\t\t\t\t\t:title="loc('IM_LIST_UNREAD_RECENT_EMPTY_STATE_TITLE')"\n\t\t\t\t/>\n\t\t\t\t<div v-if="pinnedItems.length > 0" class="bx-im-list-recent__pinned_container">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for="item in pinnedItems"\n\t\t\t\t\t\t:key="item.dialogId"\n\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t@click="onClick(item, $event)"\n\t\t\t\t\t\t@click.right="onRightClick(item, $event)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-list-recent__general_container">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for="item in generalItems"\n\t\t\t\t\t\t:key="item.dialogId"\n\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t@click="onClick(item, $event)"\n\t\t\t\t\t\t@click.right="onRightClick(item, $event)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<LoadingState v-if="isLoadingNextPage" />\n\t\t\t</div>\n\t\t</div>\n\t`};const O={name:"RecentList",components:{LoadingState:p.ListLoadingState,RecentItem:R,ActiveCallList:D,CreateChat:U,EmptyState:w},emits:["chatClick"],data(){return{isLoading:false,isLoadingNextPage:false,listIsScrolled:false,isCreatingChat:false}},computed:{collection(){return this.getRecentService().getCollection()},isEmptyCollection(){return this.collection.length===0},preparedItems(){const t=this.collection.filter((t=>{let e=true;if(!this.showBirthdays&&t.isBirthdayPlaceholder){e=false}if(t.isFakeElement&&!this.isFakeItemNeeded(t)){e=false}return e}));return[...t].sort(((t,e)=>{const n=this.$store.getters["recent/getSortDate"](t.dialogId);const s=this.$store.getters["recent/getSortDate"](e.dialogId);return s-n}))},activeCalls(){return this.$store.getters["recent/calls/get"]},pinnedItems(){return this.preparedItems.filter((t=>t.pinned===true))},generalItems(){return this.preparedItems.filter((t=>t.pinned===false))},showBirthdays(){return this.$store.getters["application/settings/get"](I.Settings.recent.showBirthday)},showInvited(){return this.$store.getters["application/settings/get"](I.Settings.recent.showInvited)},firstPageLoaded(){return this.getRecentService().firstPageIsLoaded}},async created(){this.contextMenuManager=new M.RecentMenu({emitter:this.getEmitter()});this.initBroadcastManager();this.initLikeManager();this.initCreateChatManager();this.isLoading=true;await this.getRecentService().loadFirstPage({ignorePreloadedItems:true});this.isLoading=false;void T.DraftManager.getInstance().initDraftHistory()},beforeUnmount(){this.contextMenuManager.destroy();this.destroyBroadcastManager();this.destroyLikeManager();this.destroyCreateChatManager()},methods:{async onScroll(t){this.listIsScrolled=t.target.scrollTop>0;this.contextMenuManager.close();if(!E.Utils.dom.isOneScreenRemaining(t.target)||!this.getRecentService().hasMoreItemsToLoad){return}this.isLoadingNextPage=true;await this.getRecentService().loadNextPage();this.isLoadingNextPage=false},onClick(t){this.$emit("chatClick",t.dialogId)},onRightClick(t,e){if(E.Utils.key.isCombination(e,"Alt+Shift")){return}const n={dialogId:t.dialogId,recentItem:t,compactMode:false};const s={left:e.clientX,top:e.clientY};this.contextMenuManager.openMenu(n,s);e.preventDefault()},onCallClick({item:t,$event:e}){this.onClick(t,e)},initBroadcastManager(){this.onRecentListUpdate=t=>{this.getRecentService().setPreloadedData(t.data)};this.broadcastManager=$.getInstance();this.broadcastManager.subscribe($.events.recentListUpdate,this.onRecentListUpdate)},destroyBroadcastManager(){this.broadcastManager=$.getInstance();this.broadcastManager.unsubscribe($.events.recentListUpdate,this.onRecentListUpdate)},initLikeManager(){this.likeManager=new P;this.likeManager.init()},destroyLikeManager(){this.likeManager.destroy()},initCreateChatManager(){if(_.CreateChatManager.getInstance().isCreating()){this.isCreatingChat=true}this.onCreationStatusChange=t=>{this.isCreatingChat=t.getData()};_.CreateChatManager.getInstance().subscribe(_.CreateChatManager.events.creationStatusChange,this.onCreationStatusChange)},destroyCreateChatManager(){_.CreateChatManager.getInstance().unsubscribe(_.CreateChatManager.events.creationStatusChange,this.onCreationStatusChange)},isFakeItemNeeded(t){const e=this.$store.getters["chats/get"](t.dialogId,true);const n=e.type===I.ChatType.user;const s=n&&this.showBirthdays&&this.$store.getters["users/hasBirthday"](t.dialogId);return this.showInvited||s},getRecentService(){if(!this.service){this.service=L.LegacyRecentService.getInstance()}return this.service},getEmitter(){return this.$Bitrix.eventEmitter},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-list-recent__container">\n\t\t\t<ActiveCallList :listIsScrolled="listIsScrolled" @onCallClick="onCallClick"/>\n\t\t\t<CreateChat v-if="isCreatingChat" />\n\t\t\t<LoadingState v-if="isLoading && !firstPageLoaded" />\n\t\t\t<div v-else @scroll="onScroll" class="bx-im-list-recent__scroll-container">\n\t\t\t\t<EmptyState \n\t\t\t\t\tv-if="isEmptyCollection"\n\t\t\t\t/>\n\t\t\t\t<div v-if="pinnedItems.length > 0" class="bx-im-list-recent__pinned_container">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for="item in pinnedItems"\n\t\t\t\t\t\t:key="item.dialogId"\n\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t@click="onClick(item, $event)"\n\t\t\t\t\t\t@click.right="onRightClick(item, $event)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-list-recent__general_container">\n\t\t\t\t\t<RecentItem\n\t\t\t\t\t\tv-for="item in generalItems"\n\t\t\t\t\t\t:key="item.dialogId"\n\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t@click="onClick(item, $event)"\n\t\t\t\t\t\t@click.right="onRightClick(item, $event)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\t\n\t\t\t\t<LoadingState v-if="isLoadingNextPage" />\n\t\t\t</div>\n\t\t</div>\n\t`};t.RecentList=O;t.RecentItem=R;t.RecentUnreadList=X})(this.BX.Messenger.v2.Component.List=this.BX.Messenger.v2.Component.List||{},BX?.Messenger?.v2?.Component?.List??{},BX?.Messenger?.v2?.Component?.Elements??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Lib??{},BX?.Main??{},BX?.Messenger?.v2?.Lib??{},BX?.UI?.IconSet??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Component?.Elements??{},BX?.Messenger?.v2?.Component?.Elements??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Lib??{},BX?.Call?.Component??{},BX??{},BX?.Messenger?.v2?.Application??{},BX?.Messenger?.v2?.Const??{},BX?.Event??{},BX?.Messenger?.v2?.Component?.Elements??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Lib??{},BX?.Messenger?.v2?.Service??{},BX?.Messenger?.v2?.Component?.List??{});
//# sourceMappingURL=recent-list.bundle.map.js