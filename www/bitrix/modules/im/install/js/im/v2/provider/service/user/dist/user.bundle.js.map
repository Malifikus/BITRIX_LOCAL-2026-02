{"version":3,"file":"user.bundle.js","sources":["../src/user.js"],"sourcesContent":["import { runAction } from 'im.v2.lib.rest';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport type { ImModelUser } from 'im.v2.model';\n\ntype BaseLoadUsersResult = {\n\thasNextPage: boolean,\n\tusers: ImModelUser[],\n};\n\nexport class BaseUserService <T: {} = {}>\n{\n\t#itemsPerPage: number = 50;\n\t#isLoading: boolean = false;\n\t#hasMoreItemsToLoad: boolean = true;\n\t#lastId: number;\n\n\tloadFirstPage(messageId: number): Promise\n\t{\n\t\tthis.#isLoading = true;\n\n\t\treturn this.#requestItems({\n\t\t\tmessageId,\n\t\t\tfirstPage: true,\n\t\t});\n\t}\n\n\tloadNextPage(messageId: number): Promise\n\t{\n\t\tif (this.#isLoading || !this.#hasMoreItemsToLoad)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.#isLoading = true;\n\n\t\treturn this.#requestItems({ messageId });\n\t}\n\n\thasMoreItemsToLoad(): boolean\n\t{\n\t\treturn this.#hasMoreItemsToLoad;\n\t}\n\n\tgetItemsPerPage(): number\n\t{\n\t\treturn this.#itemsPerPage;\n\t}\n\n\tgetRequestFilter(firstPage: boolean = false): Record\n\t{\n\t\treturn {\n\t\t\tlastId: firstPage ? null : this.#lastId,\n\t\t};\n\t}\n\n\tgetRestMethodName(): string\n\t{\n\t\tthrow new Error('BaseUserService: you should implement \"getRestMethodName\" for child class');\n\t}\n\n\tgetLastId(result: BaseLoadUsersResult & T): number\n\t{\n\t\tthrow new Error('BaseUserService: you should implement \"getLastId\" for child class');\n\t}\n\n\tasync #requestItems({ messageId, firstPage = false }: { messageId: number, firstPage: boolean }): Promise<number[]>\n\t{\n\t\tconst result: BaseLoadUsersResult & T = await runAction(this.getRestMethodName(), this.#getQueryParams({\n\t\t\tmessageId,\n\t\t\tfirstPage,\n\t\t}))\n\t\t\t.catch(([error]) => {\n\t\t\t\tconsole.error('BaseRecentList: page request error', error);\n\t\t\t});\n\n\t\tconst { users, hasNextPage } = result;\n\t\tthis.#lastId = this.getLastId(result);\n\t\tthis.#hasMoreItemsToLoad = hasNextPage;\n\n\t\tthis.#isLoading = false;\n\t\tconst userManager = new UserManager();\n\t\tawait userManager.setUsersToModel(Object.values(users));\n\n\t\treturn users.map((user) => user.id);\n\t}\n\n\t#getQueryParams({ messageId, firstPage = false }: { messageId: number, firstPage: boolean }): Record\n\t{\n\t\treturn {\n\t\t\tdata: {\n\t\t\t\tmessageId,\n\t\t\t\tlimit: this.getItemsPerPage(),\n\t\t\t\tfilter: this.getRequestFilter(firstPage),\n\t\t\t},\n\t\t};\n\t}\n}\n"],"names":["BaseUserService","loadFirstPage","messageId","firstPage","loadNextPage","Promise","resolve","hasMoreItemsToLoad","getItemsPerPage","getRequestFilter","lastId","getRestMethodName","Error","getLastId","result","runAction","catch","error","console","users","hasNextPage","userManager","UserManager","setUsersToModel","Object","values","map","user","id","data","limit","filter"],"mappings":";;;;;;;CAC6C;CAAA;CAAA;CAAA;CAAA;CAAA;AAS7C,CAAO,MAAMA,eAAe,CAC5B;GAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OACyB;;KAAE;OAAA;OAAA,OACJ;;KAAK;OAAA;OAAA,OACI;;KAAI;OAAA;OAAA;;;GAGnCC,aAAa,CAACC,SAAiB,EAC/B;KACC,4CAAI,4BAAc,IAAI;KAEtB,+CAAO,IAAI,gCAAe;OACzBA,SAAS;OACTC,SAAS,EAAE;MACX;;GAGFC,YAAY,CAACF,SAAiB,EAC9B;KACC,IAAI,4CAAI,6BAAe,yCAAC,IAAI,2CAAoB,EAChD;OACC,OAAOG,OAAO,CAACC,OAAO,EAAE;;KAGzB,4CAAI,4BAAc,IAAI;KAEtB,+CAAO,IAAI,gCAAe;OAAEJ;MAAW;;GAGxCK,kBAAkB,GAClB;KACC,+CAAO,IAAI;;GAGZC,eAAe,GACf;KACC,+CAAO,IAAI;;GAGZC,gBAAgB,CAACN,SAAkB,GAAG,KAAK,EAC3C;KACC,OAAO;OACNO,MAAM,EAAEP,SAAS,GAAG,IAAI,2CAAG,IAAI;MAC/B;;GAGFQ,iBAAiB,GACjB;KACC,MAAM,IAAIC,KAAK,CAAC,2EAA2E,CAAC;;GAG7FC,SAAS,CAACC,MAA+B,EACzC;KACC,MAAM,IAAIF,KAAK,CAAC,mEAAmE,CAAC;;CAkCtF;CAAC,8BA/BoB;GAAEV,SAAS;GAAEC,SAAS,GAAG;CAAiD,CAAC,EAC/F;GACC,MAAMW,MAA+B,GAAG,MAAMC,wBAAS,CAAC,IAAI,CAACJ,iBAAiB,EAAE,0CAAE,IAAI,oCAAiB;KACtGT,SAAS;KACTC;IACA,EAAE,CACDa,KAAK,CAAC,CAAC,CAACC,KAAK,CAAC,KAAK;KACnBC,OAAO,CAACD,KAAK,CAAC,oCAAoC,EAAEA,KAAK,CAAC;IAC1D,CAAC;GAEH,MAAM;KAAEE,KAAK;KAAEC;IAAa,GAAGN,MAAM;GACrC,4CAAI,sBAAW,IAAI,CAACD,SAAS,CAACC,MAAM,CAAC;GACrC,4CAAI,8CAAuBM,WAAW;GAEtC,4CAAI,4BAAc,KAAK;GACvB,MAAMC,WAAW,GAAG,IAAIC,0BAAW,EAAE;GACrC,MAAMD,WAAW,CAACE,eAAe,CAACC,MAAM,CAACC,MAAM,CAACN,KAAK,CAAC,CAAC;GAEvD,OAAOA,KAAK,CAACO,GAAG,CAAEC,IAAI,IAAKA,IAAI,CAACC,EAAE,CAAC;CACpC;CAAC,0BAEe;GAAE1B,SAAS;GAAEC,SAAS,GAAG;CAAiD,CAAC,EAC3F;GACC,OAAO;KACN0B,IAAI,EAAE;OACL3B,SAAS;OACT4B,KAAK,EAAE,IAAI,CAACtB,eAAe,EAAE;OAC7BuB,MAAM,EAAE,IAAI,CAACtB,gBAAgB,CAACN,SAAS;;IAExC;CACF;;;;;;;;"}