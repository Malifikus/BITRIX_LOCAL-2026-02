{"version":3,"file":"registry.bundle.js","sources":["../src/base/handlers/bot.js","../src/base/handlers/classes/message-delete-manager.js","../src/base/handlers/message.js","../src/base/handlers/chat.js","../src/base/handlers/tariff.js","../src/base/handlers/user.js","../src/base/handlers/desktop.js","../src/base/handlers/settings.js","../src/base/handlers/comments.js","../src/base/handlers/application.js","../src/base/handlers/collab.js","../src/base/handlers/ai.js","../src/base/base.js","../src/recent/classes/new-message-manager.js","../src/recent/classes/recent-update-manager.js","../src/recent/helpers/helpers.js","../src/recent/recent.js","../src/recent/recent-unread.js","../src/notification.js","../src/sidebar.js","../src/notifier.js","../src/online.js","../src/counter.js","../src/promotion.js","../src/anchor.js","../src/stickers.js"],"sourcesContent":["import { Core } from 'im.v2.application.core';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { BotAddParams, BotUpdateParams } from '../../types/bot';\n\nexport class BotPullHandler\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\thandleBotAdd(params: BotAddParams)\n\t{\n\t\tLogger.warn('BotPullHandler: handleBotAdd', params);\n\t\tconst { user } = params;\n\n\t\tvoid (new UserManager()).addUsersToModel(user);\n\t}\n\n\thandleBotUpdate(params: BotUpdateParams)\n\t{\n\t\tconst { user } = params;\n\n\t\tthis.#store.dispatch('users/update', {\n\t\t\tid: user.id,\n\t\t\tfields: user,\n\t\t});\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'im.v2.application.core';\nimport { EventType } from 'im.v2.const';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { InputActionListener } from 'im.v2.lib.input-action';\nimport { Notifier } from 'im.v2.lib.notifier';\n\nimport type {\n\tMessageDeletePreparedParams,\n\tMessageDeleteCompletePreparedParams,\n\tDialogUpdateFieldsParams,\n} from '../../../types/message';\n\nexport class MessageDeleteManager\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\tdeleteMessage(params: MessageDeletePreparedParams)\n\t{\n\t\tthis.#stopWriting(params.dialogId, params.senderId);\n\n\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tfields: {\n\t\t\t\ttext: '',\n\t\t\t\tisDeleted: true,\n\t\t\t\tfiles: [],\n\t\t\t\tattach: [],\n\t\t\t\treplyId: 0,\n\t\t\t},\n\t\t});\n\t}\n\n\tdeleteMessageComplete(params: MessageDeleteCompletePreparedParams)\n\t{\n\t\tthis.#stopWriting(params.dialogId, params.senderId);\n\n\t\tconst areChannelCommentsOpened = this.#store.getters['messages/comments/areOpenedForChannelPost'](params.id);\n\t\tif (areChannelCommentsOpened)\n\t\t{\n\t\t\tthis.#closeChannelComments(params);\n\t\t}\n\n\t\tvoid this.#store.dispatch('messages/delete', {\n\t\t\tid: params.id,\n\t\t});\n\n\t\tconst dialogUpdateFields = this.#prepareDialogUpdateFields(params);\n\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: dialogUpdateFields,\n\t\t});\n\t}\n\n\t#stopWriting(dialogId: number, userId: number)\n\t{\n\t\tInputActionListener.getInstance().stopAction({ dialogId, userId });\n\t}\n\n\t#closeChannelComments(params: MessageDeleteCompletePreparedParams)\n\t{\n\t\tEventEmitter.emit(EventType.dialog.closeComments);\n\t\tAnalytics.getInstance().messageDelete.onDeletedPostNotification({\n\t\t\tdialogId: params.dialogId,\n\t\t});\n\n\t\tNotifier.message.onNotFoundError();\n\t}\n\n\t#prepareDialogUpdateFields(params: MessageDeleteCompletePreparedParams): DialogUpdateFieldsParams\n\t{\n\t\tconst dialogUpdateFields = {\n\t\t\tcounter: params.counter,\n\t\t};\n\n\t\tconst lastMessageWasDeleted = Boolean(params.newLastMessage);\n\t\tif (lastMessageWasDeleted)\n\t\t{\n\t\t\tdialogUpdateFields.lastMessageId = params.newLastMessage.id;\n\t\t\tdialogUpdateFields.lastMessageViews = params.lastMessageViews;\n\n\t\t\tvoid this.#store.dispatch('messages/store', params.newLastMessage);\n\t\t}\n\n\t\treturn dialogUpdateFields;\n\t}\n}\n","import { Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { UserManager } from 'im.v2.lib.user';\nimport { UuidManager } from 'im.v2.lib.uuid';\nimport { InputActionListener } from 'im.v2.lib.input-action';\nimport { EventType, DialogScrollThreshold, UserRole, ChatType } from 'im.v2.const';\nimport { MessageService } from 'im.v2.provider.service.message';\n\nimport { MessageDeleteManager } from './classes/message-delete-manager';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { ImModelChat, ImModelMessage } from 'im.v2.model';\n\nimport type {\n\tMessageAddParams,\n\tMessageUpdateParams,\n\tMessageDeleteParams,\n\tMessageDeleteCompleteParams,\n\tMultipleMessageDeleteParams,\n\tReadMessageParams,\n\tReadMessageOpponentParams,\n\tPinAddParams,\n\tPinDeleteParams,\n\tAddReactionParams,\n\tDeleteReactionParams,\n\tMessageDeleteCompletePreparedParams,\n\tPrepareDeleteMessageParams,\n\tRawReaction,\n} from '../../types/message';\nimport type { PullExtraParams, RawFile, RawUser, RawMessage, RawChat } from '../../types/common';\n\ntype UserId = number;\n\nexport class MessagePullHandler\n{\n\t#store: Store;\n\t#messageViews: {[messageId: string]: Set<UserId>} = {};\n\t#messageDeleteManager: MessageDeleteManager;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t\tthis.#messageDeleteManager = new MessageDeleteManager();\n\t}\n\n\thandleMessageAdd(params: MessageAddParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleMessageAdd', params);\n\t\tthis.#setMessageChat(params);\n\t\tthis.#setUsers(params);\n\t\tthis.#setFiles(params);\n\t\tthis.#setAdditionalEntities(params);\n\t\tthis.#setCommentInfo(params);\n\t\tthis.#setCopilotData(params);\n\t\tthis.#setMessagesAutoDeleteConfig(params);\n\t\tthis.#setStickers(params);\n\n\t\tconst messageWithTemplateId = this.#store.getters['messages/isInChatCollection']({\n\t\t\tmessageId: params.message.templateId,\n\t\t});\n\n\t\tconst messageWithRealId = this.#store.getters['messages/isInChatCollection']({\n\t\t\tmessageId: params.message.id,\n\t\t});\n\n\t\t// update message with parsed link info\n\t\tif (messageWithRealId)\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we already have this message', params.message);\n\t\t\tvoid this.#store.dispatch('messages/update', {\n\t\t\t\tid: params.message.id,\n\t\t\t\tfields: { ...params.message, error: false },\n\t\t\t});\n\t\t\tthis.#sendScrollEvent(params.chatId);\n\t\t}\n\t\telse if (!messageWithRealId && messageWithTemplateId)\n\t\t{\n\t\t\tLogger.warn('New message pull handler: we already have the TEMPORARY message', params.message);\n\t\t\tvoid this.#store.dispatch('messages/updateWithId', {\n\t\t\t\tid: params.message.templateId,\n\t\t\t\tfields: { ...params.message, error: false },\n\t\t\t});\n\t\t}\n\t\t// it's an opponent message or our own message from somewhere else\n\t\telse if (!messageWithRealId && !messageWithTemplateId)\n\t\t{\n\t\t\tconst hasLoadingMessage: boolean = this.#store.getters['messages/hasLoadingMessageByMessageId'](\n\t\t\t\tparams.message.templateId,\n\t\t\t);\n\t\t\tif (hasLoadingMessage)\n\t\t\t{\n\t\t\t\tvoid this.#store.dispatch('messages/delete', {\n\t\t\t\t\tid: params.message.templateId,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tLogger.warn('New message pull handler: we dont have this message', params.message);\n\t\t\tthis.#handleAddingMessageToModel(params);\n\t\t}\n\n\t\tInputActionListener.getInstance().stopAction({\n\t\t\tuserId: params.message.senderId,\n\t\t\tdialogId: params.dialogId,\n\t\t});\n\n\t\tthis.#updateDialog(params);\n\t}\n\n\thandleMessageUpdate(params: MessageUpdateParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleMessageUpdate', params);\n\t\tInputActionListener.getInstance().stopAction({\n\t\t\tuserId: params.senderId,\n\t\t\tdialogId: params.dialogId,\n\t\t});\n\t\tthis.#store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tfields: {\n\t\t\t\ttext: params.text,\n\t\t\t\tparams: params.params,\n\t\t\t},\n\t\t});\n\t\tthis.#sendScrollEvent(params.chatId);\n\t}\n\n\thandleMessageDeleteV2(params: MultipleMessageDeleteParams)\n\t{\n\t\tLogger.warn('MessageDeletePullHandler: handleMultipleMessageDelete', params);\n\n\t\tconst messages = params.messages;\n\n\t\tmessages.forEach((message) => {\n\t\t\tif (message.completelyDeleted)\n\t\t\t{\n\t\t\t\tconst preparedParams = this.#prepareDeleteMessageParams(params, true, message);\n\t\t\t\tthis.#messageDeleteManager.deleteMessageComplete(preparedParams);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst preparedParams = this.#prepareDeleteMessageParams(params, false, message);\n\t\t\tthis.#messageDeleteManager.deleteMessage(preparedParams);\n\t\t});\n\t}\n\n\thandleMessageDelete(params: MessageDeleteParams)\n\t{\n\t\tLogger.warn('MessageDeletePullHandler: handleMessageDelete', params);\n\t\tconst preparedParams = this.#prepareDeleteMessageParams(params);\n\t\tthis.#messageDeleteManager.deleteMessage(preparedParams);\n\t}\n\n\thandleMessageDeleteComplete(params: MessageDeleteCompleteParams)\n\t{\n\t\tLogger.warn('MessageDeletePullHandler: handleMessageDeleteComplete', params);\n\n\t\tconst preparedParams = this.#prepareDeleteMessageParams(params, true);\n\t\tthis.#messageDeleteManager.deleteMessageComplete(preparedParams);\n\t}\n\n\thandleAddReaction(params: AddReactionParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleAddReaction', params);\n\t\tconst {\n\t\t\tactualReactions: { reaction: actualReactionsState, usersShort },\n\t\t\tuserId,\n\t\t\treaction,\n\t\t} = params;\n\n\t\tif (Core.getUserId() === userId)\n\t\t{\n\t\t\tactualReactionsState.ownReactions = [reaction];\n\t\t}\n\n\t\tconst userManager = new UserManager();\n\t\tvoid userManager.addUsersToModel(usersShort);\n\n\t\tvoid this.#store.dispatch('messages/reactions/set', [actualReactionsState]);\n\t}\n\n\thandleDeleteReaction(params: DeleteReactionParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleDeleteReaction', params);\n\t\tconst { actualReactions: { reaction: rawReaction }, reaction: reactionType, userId } = params;\n\n\t\tconst newReactionItem: RawReaction = { ...rawReaction };\n\n\t\tif (Core.getUserId() === userId)\n\t\t{\n\t\t\tnewReactionItem.ownReactionsToRemove = [reactionType];\n\t\t}\n\n\t\tvoid this.#store.dispatch('messages/reactions/set', [newReactionItem]);\n\t}\n\n\thandleMessageParamsUpdate(params)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleMessageParamsUpdate', params);\n\n\t\tthis.#store.dispatch('messages/update', {\n\t\t\tid: params.id,\n\t\t\tchatId: params.chatId,\n\t\t\tfields: { params: params.params },\n\t\t});\n\t}\n\n\thandleReadMessage(params: ReadMessageParams, extra: PullExtraParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handleReadMessage', params);\n\t\tconst uuidManager = UuidManager.getInstance();\n\t\tif (uuidManager.hasActionUuid(extra.action_uuid))\n\t\t{\n\t\t\tLogger.warn('MessagePullHandler: handleReadMessage: we have this uuid, skip');\n\t\t\tuuidManager.removeActionUuid(extra.action_uuid);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('messages/readMessages', {\n\t\t\tchatId: params.chatId,\n\t\t\tmessageIds: params.viewedMessages,\n\t\t}).then(() => {\n\t\t\tthis.#store.dispatch('chats/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\tcounter: params.counter,\n\t\t\t\t\tlastId: params.lastId,\n\t\t\t\t},\n\t\t\t});\n\t\t}).catch((error) => {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.error('MessagePullHandler: error handling readMessage', error);\n\t\t});\n\t}\n\n\thandleReadMessageOpponent(params: ReadMessageOpponentParams)\n\t{\n\t\tif (params.userId === Core.getUserId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tLogger.warn('MessagePullHandler: handleReadMessageOpponent', params);\n\t\tthis.#updateMessageViewedByOthers(params);\n\t\tthis.#updateChatLastMessageViews(params);\n\t}\n\n\thandlePinAdd(params: PinAddParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handlePinAdd', params);\n\t\tthis.#setFiles(params);\n\t\tthis.#setUsers(params);\n\t\tthis.#store.dispatch('messages/store', params.additionalMessages);\n\t\tthis.#store.dispatch('messages/pin/add', {\n\t\t\tchatId: params.pin.chatId,\n\t\t\tmessageId: params.pin.messageId,\n\t\t});\n\t\tif (Core.getUserId() !== params.pin.authorId)\n\t\t{\n\t\t\t// this.#sendScrollEvent(params.link.chatId);\n\t\t}\n\t}\n\n\thandlePinDelete(params: PinDeleteParams)\n\t{\n\t\tLogger.warn('MessagePullHandler: handlePinDelete', params);\n\t\tthis.#store.dispatch('messages/pin/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tmessageId: params.messageId,\n\t\t});\n\t}\n\n\t// helpers\n\t#setMessageChat(params: MessageAddParams)\n\t{\n\t\tconst chat = params.chat?.[params.chatId];\n\t\tif (!chat)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatToAdd = { ...params.chat[params.chatId], dialogId: params.dialogId };\n\t\tconst dialogExists = Boolean(this.#getDialog(params.dialogId));\n\t\tconst messageWithoutNotification = !params.notify || params.message?.params?.NOTIFY === 'N';\n\t\tif (!dialogExists && !messageWithoutNotification && !chatToAdd.role)\n\t\t{\n\t\t\tchatToAdd.role = UserRole.member;\n\t\t}\n\t\tthis.#store.dispatch('chats/set', chatToAdd);\n\t}\n\n\t#setUsers(params: {users: {[userId: string]: RawUser} | []})\n\t{\n\t\tif (!params.users)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userManager = new UserManager();\n\t\tuserManager.setUsersToModel(Object.values(params.users));\n\t}\n\n\t#setFiles(params: {files: {[fileId: string]: RawFile} | [], message?: RawMessage})\n\t{\n\t\tif (!params.files)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst files = Object.values(params.files);\n\t\tfiles.forEach((file: RawFile) => {\n\t\t\tvoid this.#store.dispatch('files/set', file);\n\t\t});\n\t}\n\n\t#setAdditionalEntities(params: MessageAddParams): void\n\t{\n\t\tif (!params.message.additionalEntities)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tadditionalMessages,\n\t\t\tmessages,\n\t\t\tfiles,\n\t\t\tusers,\n\t\t\tstickers,\n\t\t} = params.message.additionalEntities;\n\t\tconst newMessages = [...messages, ...additionalMessages];\n\t\tvoid this.#store.dispatch('messages/store', newMessages);\n\t\tvoid this.#store.dispatch('files/set', files);\n\t\tvoid this.#store.dispatch('users/set', users);\n\t\tvoid this.#store.dispatch('stickers/set', stickers);\n\t}\n\n\t#setCommentInfo(params: MessageAddParams): void\n\t{\n\t\tconst chat: RawChat = params.chat?.[params.chatId];\n\t\tif (!chat || chat.type !== ChatType.comment)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('messages/comments/set', {\n\t\t\tmessageId: chat.parent_message_id,\n\t\t\tchatId: params.chatId,\n\t\t\tmessageCount: chat.message_count,\n\t\t});\n\t\tthis.#store.dispatch('messages/comments/setLastUser', {\n\t\t\tmessageId: chat.parent_message_id,\n\t\t\tnewUserId: params.message.senderId,\n\t\t});\n\t}\n\n\t#handleAddingMessageToModel(params: MessageAddParams)\n\t{\n\t\tconst dialog = this.#getDialog(params.dialogId, true);\n\t\tif (dialog.hasNextPage)\n\t\t{\n\t\t\tthis.#store.dispatch('messages/store', params.message);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatIsOpened = this.#store.getters['application/isChatOpen'](params.dialogId);\n\t\tconst unreadMessages: ImModelMessage[] = this.#store.getters['messages/getChatUnreadMessages'](params.chatId);\n\t\tconst RELOAD_LIMIT = MessageService.getMessageRequestLimit() * 5;\n\t\tif (dialog.inited && !chatIsOpened && unreadMessages.length > RELOAD_LIMIT)\n\t\t{\n\t\t\tvoid this.#store.dispatch('messages/store', params.message);\n\t\t\tconst messageService = new MessageService({ chatId: params.chatId });\n\t\t\tmessageService.reloadMessageList();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#addMessageToModel(params.message);\n\t\tthis.#sendScrollEvent(params.chatId);\n\t}\n\n\t#addMessageToModel(message)\n\t{\n\t\tconst newMessage = { ...message };\n\t\tif (message.senderId === Core.getUserId())\n\t\t{\n\t\t\tnewMessage.unread = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewMessage.unread = true;\n\t\t\tnewMessage.viewed = false;\n\t\t}\n\t\tthis.#store.dispatch('messages/setChatCollection', { messages: [newMessage] });\n\t}\n\n\t#updateDialog(params)\n\t{\n\t\tconst dialog = this.#getDialog(params.dialogId, true);\n\n\t\tconst dialogFieldsToUpdate = {};\n\t\tif (params.message.id > dialog.lastMessageId)\n\t\t{\n\t\t\tdialogFieldsToUpdate.lastMessageId = params.message.id;\n\t\t}\n\n\t\tif (params.message.senderId === Core.getUserId() && params.message.id > dialog.lastReadId)\n\t\t{\n\t\t\tdialogFieldsToUpdate.lastId = params.message.id;\n\t\t}\n\n\t\tdialogFieldsToUpdate.counter = params.counter;\n\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: dialogFieldsToUpdate,\n\t\t});\n\t\tthis.#store.dispatch('chats/clearLastMessageViews', {\n\t\t\tdialogId: params.dialogId,\n\t\t});\n\t}\n\n\t#updateMessageViewedByOthers(params: ReadMessageOpponentParams)\n\t{\n\t\tthis.#store.dispatch('messages/setViewedByOthers', { ids: params.viewedMessages });\n\t}\n\n\t#updateChatLastMessageViews(params: ReadMessageOpponentParams)\n\t{\n\t\tconst dialog = this.#getDialog(params.dialogId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isLastMessage = params.viewedMessages.includes(dialog.lastMessageId);\n\t\tif (!isLastMessage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#checkMessageViewsRegistry(params.userId, dialog.lastMessageId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasFirstViewer = Boolean(dialog.lastMessageViews.firstViewer);\n\t\tif (hasFirstViewer)\n\t\t{\n\t\t\tthis.#store.dispatch('chats/incrementLastMessageViews', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t});\n\t\t\tthis.#updateMessageViewsRegistry(params.userId, dialog.lastMessageId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('chats/setLastMessageViews', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tuserId: params.userId,\n\t\t\t\tuserName: params.userName,\n\t\t\t\tdate: params.date,\n\t\t\t\tmessageId: dialog.lastMessageId,\n\t\t\t},\n\t\t});\n\n\t\tthis.#updateMessageViewsRegistry(params.userId, dialog.lastMessageId);\n\t}\n\n\t#checkMessageViewsRegistry(userId: number, messageId: number): boolean\n\t{\n\t\treturn Boolean(this.#messageViews[messageId]?.has(userId));\n\t}\n\n\t#updateMessageViewsRegistry(userId: number, messageId: number): void\n\t{\n\t\tif (!this.#messageViews[messageId])\n\t\t{\n\t\t\tthis.#messageViews[messageId] = new Set();\n\t\t}\n\n\t\tthis.#messageViews[messageId].add(userId);\n\t}\n\n\t#sendScrollEvent(chatId: number)\n\t{\n\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, { chatId, threshold: DialogScrollThreshold.nearTheBottom });\n\t}\n\n\t#getDialog(dialogId: string, temporary: boolean = false): ?ImModelChat\n\t{\n\t\treturn this.#store.getters['chats/get'](dialogId, temporary);\n\t}\n\n\t#setCopilotData(params)\n\t{\n\t\tif (!params.copilot)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst copilotManager = new CopilotManager();\n\t\tvoid copilotManager.handleMessageAdd(params.copilot);\n\t}\n\n\t#setMessagesAutoDeleteConfig(params: MessageAddParams)\n\t{\n\t\tconst { messagesAutoDeleteConfigs } = params;\n\t\tvoid this.#store.dispatch('chats/autoDelete/set', messagesAutoDeleteConfigs);\n\t}\n\n\t#setStickers(params: MessageAddParams)\n\t{\n\t\tconst hasMessageSticker = Type.isPlainObject(params.message.params.STICKER_PARAMS);\n\t\tif (hasMessageSticker)\n\t\t{\n\t\t\tvoid this.#store.dispatch('stickers/messages/set', [{\n\t\t\t\tmessageId: params.message.id,\n\t\t\t\t...params.message.params.STICKER_PARAMS,\n\t\t\t}]);\n\t\t\tvoid this.#store.dispatch('stickers/set', params.stickers);\n\t\t}\n\t}\n\n\t#prepareDeleteMessageParams(\n\t\tparams: PrepareDeleteMessageParams,\n\t\tisComplete = false,\n\t\tmessage = null,\n\t): MessageDeleteCompletePreparedParams\n\t{\n\t\tconst baseParams = {\n\t\t\tid: message ? message.id : params.id,\n\t\t\tsenderId: message ? message.senderId : params.senderId,\n\t\t\tdialogId: params.dialogId,\n\t\t};\n\n\t\tif (isComplete)\n\t\t{\n\t\t\treturn {\n\t\t\t\t...baseParams,\n\t\t\t\tnewLastMessage: params.newLastMessage,\n\t\t\t\tlastMessageViews: params.lastMessageViews,\n\t\t\t\tcounter: params.counter,\n\t\t\t};\n\t\t}\n\n\t\treturn baseParams;\n\t}\n}\n","import { LayoutManager } from 'im.v2.lib.layout';\nimport { Messenger } from 'im.public';\nimport { ChatType, UserRole } from 'im.v2.const';\nimport { Core } from 'im.v2.application.core';\nimport { UserManager } from 'im.v2.lib.user';\nimport { CallManager } from 'im.v2.lib.call';\nimport { ChannelManager } from 'im.v2.lib.channel';\nimport { InputActionListener } from 'im.v2.lib.input-action';\nimport { Logger } from 'im.v2.lib.logger';\nimport { getChatRoleForUser } from 'im.v2.lib.role-manager';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { Notifier } from 'im.v2.lib.notifier';\nimport { CounterClearActionsByChatType, CounterClearActionsDefault } from 'im.v2.lib.counter';\n\nimport type { Store } from 'ui.vue3.vuex';\n\nimport type {\n\tChatOwnerParams,\n\tChatManagersParams,\n\tChatUserAddParams,\n\tChatUserLeaveParams,\n\tInputActionNotifyParams,\n\tChatUnreadParams,\n\tChatMuteNotifyParams,\n\tChatRenameParams,\n\tChatAvatarParams,\n\tChatConvertParams,\n\tChatDeleteParams,\n\tMessagesAutoDeleteDelayParams,\n\tRelation,\n} from '../../types/chat';\nimport type { RawUser, RawChat } from '../../types/common';\nimport type { ImModelChat } from 'im.v2.model';\n\nexport class ChatPullHandler\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\thandleChatOwner(params: ChatOwnerParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatOwner', params);\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\townerId: params.userId,\n\t\t\t},\n\t\t});\n\t}\n\n\thandleChatManagers(params: ChatManagersParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatManagers', params);\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tmanagerList: params.list,\n\t\t\t},\n\t\t});\n\n\t\tconst chat: ImModelChat = this.#store.getters['chats/get'](params.dialogId);\n\t\tif (!chat)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userInManagerList = params.list.includes(Core.getUserId());\n\t\tif (chat.role === UserRole.member && userInManagerList)\n\t\t{\n\t\t\tthis.#store.dispatch('chats/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\trole: UserRole.manager,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (chat.role === UserRole.manager && !userInManagerList)\n\t\t{\n\t\t\tthis.#store.dispatch('chats/update', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t\tfields: {\n\t\t\t\t\trole: UserRole.member,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\thandleChatUserAdd(params: ChatUserAddParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatUserAdd', params);\n\t\tthis.#updateChatUsers(params);\n\n\t\tconst { newUsers, dialogId, relations } = params;\n\n\t\tconst currentUserId = Core.getUserId();\n\t\tif (newUsers.includes(currentUserId))\n\t\t{\n\t\t\tconst currentUserRelation: Relation = relations.find((relation) => relation.userId === Core.getUserId());\n\t\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\t\tdialogId,\n\t\t\t\tfields: { role: currentUserRelation.role },\n\t\t\t});\n\t\t}\n\t}\n\n\thandleChatUserLeave(params: ChatUserLeaveParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatUserLeave', params);\n\t\tthis.#updateChatUsers(params);\n\n\t\t// chatUserLeave is single user event, so we can safely use first (and only) relation from array\n\t\tconst { userId, dialogId, chatId, relations: [relation] } = params;\n\t\tconst currentUserIsKicked = userId === Core.getUserId();\n\t\tif (relation?.isHidden || !currentUserIsKicked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields: { inited: false },\n\t\t});\n\t\tvoid this.#store.dispatch('messages/clearChatCollection', { chatId });\n\n\t\tconst isChannel = ChannelManager.isChannel(dialogId);\n\t\tif (isChannel)\n\t\t{\n\t\t\tvoid this.#store.dispatch('counters/deleteForChannel', { channelChatId: chatId });\n\t\t}\n\n\t\tconst chatIsOpened = this.#store.getters['application/isChatOpen'](dialogId);\n\t\tif (chatIsOpened)\n\t\t{\n\t\t\tvoid Messenger.openChat();\n\t\t}\n\n\t\tCallManager.getInstance().deleteRecentCall(dialogId);\n\t\tconst chatHasCall = CallManager.getInstance().getCurrentCallDialogId() === dialogId;\n\t\tif (chatHasCall)\n\t\t{\n\t\t\tCallManager.getInstance().leaveCurrentCall();\n\t\t}\n\t}\n\n\thandleInputActionNotify(params: InputActionNotifyParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleInputActionNotify', params);\n\t\tInputActionListener.getInstance().startAction(params);\n\t\tthis.#store.dispatch('users/update', {\n\t\t\tid: params.userId,\n\t\t\tfields: { lastActivityDate: new Date() },\n\t\t});\n\t}\n\n\thandleChatUnread(params: ChatUnreadParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatUnread', params);\n\t\tlet markedId = 0;\n\t\tif (params.active === true)\n\t\t{\n\t\t\tmarkedId = params.markedId;\n\t\t}\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: { markedId },\n\t\t});\n\t}\n\n\thandleChatMuteNotify(params: ChatMuteNotifyParams)\n\t{\n\t\tif (params.muted)\n\t\t{\n\t\t\tthis.#store.dispatch('chats/mute', {\n\t\t\t\tdialogId: params.dialogId,\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('chats/unmute', {\n\t\t\tdialogId: params.dialogId,\n\t\t});\n\t}\n\n\thandleChatRename(params: ChatRenameParams)\n\t{\n\t\tconst dialog = this.#store.getters['chats/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tname: params.name,\n\t\t\t},\n\t\t});\n\t}\n\n\thandleChatAvatar(params: ChatAvatarParams)\n\t{\n\t\tconst dialog = this.#store.getters['chats/getByChatId'](params.chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId: dialog.dialogId,\n\t\t\tfields: {\n\t\t\t\tavatar: params.avatar,\n\t\t\t},\n\t\t});\n\t}\n\n\thandleReadAllChats()\n\t{\n\t\tLogger.warn('ChatPullHandler: handleReadAllChats');\n\t\tCounterClearActionsDefault.forEach((actionName) => {\n\t\t\tvoid this.#store.dispatch(actionName);\n\t\t});\n\t}\n\n\thandleReadAllChatsByType(params: { type: $Values<typeof ChatType> })\n\t{\n\t\tconst { type } = params;\n\n\t\tconst counterClearActions = CounterClearActionsByChatType[type];\n\n\t\tif (!counterClearActions)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcounterClearActions.forEach((actionName) => {\n\t\t\tvoid this.#store.dispatch(actionName, { type });\n\t\t});\n\t}\n\n\thandleChatConvert(params: ChatConvertParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatConvert', params);\n\t\tconst { dialogId, oldType, newType, newPermissions, newTypeParams } = params;\n\t\tconst fields = {\n\t\t\ttype: newType,\n\t\t\tpermissions: newPermissions,\n\t\t};\n\n\t\tif ([newType, oldType].includes(ChatType.collab))\n\t\t{\n\t\t\tfields.diskFolderId = 0;\n\t\t}\n\n\t\tthis.#store.dispatch('chats/update', {\n\t\t\tdialogId,\n\t\t\tfields,\n\t\t});\n\n\t\tconst dialog = this.#store.getters['chats/get'](dialogId);\n\t\tif (newType === ChatType.collab && dialog?.chatId > 0)\n\t\t{\n\t\t\tthis.#store.dispatch('chats/collabs/set', {\n\t\t\t\tchatId: dialog.chatId,\n\t\t\t\tcollabInfo: newTypeParams.collabInfo,\n\t\t\t});\n\t\t}\n\t}\n\n\thandleChatUpdate(params: {chat: RawChat})\n\t{\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.chat.dialogId,\n\t\t\tfields: {\n\t\t\t\trole: getChatRoleForUser(params.chat),\n\t\t\t\t...params.chat,\n\t\t\t},\n\t\t});\n\t}\n\n\thandleChatFieldsUpdate(params: Partial<RawChat> & {dialogId: string, chatId: number})\n\t{\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\t...params,\n\t\t\t},\n\t\t});\n\t}\n\n\thandleChatDelete(params: ChatDeleteParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleChatDelete', params);\n\n\t\tconst currentUserId = Core.getUserId();\n\t\tif (params.userId === currentUserId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: { inited: false },\n\t\t});\n\t\tvoid this.#store.dispatch('recent/delete', { id: params.dialogId });\n\n\t\tconst isCommentChat = params.type === ChatType.comment;\n\t\tif (isCommentChat)\n\t\t{\n\t\t\tvoid this.#store.dispatch('counters/deleteForChannel', {\n\t\t\t\tchannelChatId: params.parentChatId,\n\t\t\t\tcommentChatId: params.chatId,\n\t\t\t});\n\t\t}\n\n\t\tconst isChannel = ChannelManager.isChannel(params.dialogId);\n\t\tif (isChannel)\n\t\t{\n\t\t\tvoid this.#store.dispatch('counters/deleteForChannel', {\n\t\t\t\tchannelChatId: params.chatId,\n\t\t\t});\n\t\t}\n\n\t\tvoid this.#store.dispatch('messages/clearChatCollection', { chatId: params.chatId });\n\n\t\tconst chatIsOpened = this.#store.getters['application/isChatOpen'](params.dialogId);\n\t\tif (chatIsOpened)\n\t\t{\n\t\t\tAnalytics.getInstance().chatDelete.onChatDeletedNotification(params.dialogId);\n\t\t\tNotifier.chat.onNotFoundError();\n\t\t\tvoid LayoutManager.getInstance().clearCurrentLayoutEntityId();\n\t\t\tvoid LayoutManager.getInstance().deleteLastOpenedElementById(params.dialogId);\n\t\t}\n\n\t\tconst chatHasCall = CallManager.getInstance().getCurrentCallDialogId() === params.dialogId;\n\t\tif (chatHasCall)\n\t\t{\n\t\t\tCallManager.getInstance().leaveCurrentCall();\n\t\t}\n\t}\n\n\thandleMessagesAutoDeleteDelayChanged(params: MessagesAutoDeleteDelayParams)\n\t{\n\t\tLogger.warn('ChatPullHandler: handleMessagesAutoDeleteDelayChanged', params);\n\n\t\tconst { chatId, delay } = params;\n\n\t\tvoid this.#store.dispatch('chats/autoDelete/set', {\n\t\t\tchatId,\n\t\t\tdelay,\n\t\t});\n\t}\n\n\t#updateChatUsers(params: {\n\t\tusers?: {[userId: string]: RawUser},\n\t\tdialogId: string,\n\t\tuserCount: number,\n\t\tchatExtranet: boolean,\n\t\tcontainsCollaber: boolean,\n\t})\n\t{\n\t\tif (params.users)\n\t\t{\n\t\t\tconst userManager = new UserManager();\n\t\t\tvoid userManager.setUsersToModel(Object.values(params.users));\n\t\t}\n\n\t\tvoid this.#store.dispatch('chats/update', {\n\t\t\tdialogId: params.dialogId,\n\t\t\tfields: {\n\t\t\t\tuserCounter: params.userCount,\n\t\t\t\textranet: params.chatExtranet,\n\t\t\t\tcontainsCollaber: params.containsCollaber,\n\t\t\t},\n\t\t});\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { ChangeTariffParams } from '../../types/tariff';\n\nexport class TariffPullHandler\n{\n\thandleChangeTariff(params: ChangeTariffParams)\n\t{\n\t\tLogger.warn('TariffPullHandler: handleChangeTariff', params);\n\t\tconst { tariffRestrictions } = params;\n\t\tif (!tariffRestrictions)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (tariffRestrictions.fullChatHistory?.isAvailable === true)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid Core.getStore().dispatch('application/tariffRestrictions/set', tariffRestrictions);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { UserInviteParams } from '../../types/user';\nimport type { UserShowInRecentParams } from '../../types/recent';\n\nexport class UserPullHandler\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\thandleUserInvite(params: UserInviteParams)\n\t{\n\t\tif (params.invited)\n\t\t{\n\t\t\tconst userManager = new UserManager();\n\t\t\tuserManager.setUsersToModel([params.user]);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('users/update', {\n\t\t\tid: params.userId,\n\t\t\tfields: params.user,\n\t\t});\n\t}\n\n\thandleUserShowInRecent(params: UserShowInRecentParams)\n\t{\n\t\tconst usersToStore = params.items.map((item) => item.user);\n\n\t\tconst userManager = new UserManager();\n\t\tuserManager.setUsersToModel(usersToStore);\n\t}\n}\n","import { Logger } from 'im.v2.lib.logger';\nimport { DesktopManager } from 'im.v2.lib.desktop';\nimport { CounterManager } from 'im.v2.lib.counter';\n\nimport type { DesktopOnlineParams } from '../../types/desktop';\n\nexport class DesktopPullHandler\n{\n\thandleDesktopOnline(params: DesktopOnlineParams)\n\t{\n\t\tLogger.warn('DesktopPullHandler: handleDesktopOnline', params);\n\t\tconst desktopManager = DesktopManager.getInstance();\n\t\tdesktopManager.setDesktopActive(true);\n\t\tdesktopManager.setDesktopVersion(params.version);\n\n\t\tCounterManager.getInstance().removeBrowserTitleCounter();\n\t}\n\n\thandleDesktopOffline()\n\t{\n\t\tLogger.warn('DesktopPullHandler: handleDesktopOffline');\n\t\tDesktopManager.getInstance().setDesktopActive(false);\n\t\tDesktopManager.getInstance().setDesktopVersion(0);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { SettingsUpdateParams } from '../../types/settings';\n\nexport class SettingsPullHandler\n{\n\thandleSettingsUpdate(params: SettingsUpdateParams)\n\t{\n\t\tLogger.warn('SettingsPullHandler: handleSettingsUpdate', params);\n\t\tObject.entries(params).forEach(([optionName, optionValue]) => {\n\t\t\tCore.getStore().dispatch('application/settings/set', {\n\t\t\t\t[optionName]: optionValue,\n\t\t\t});\n\t\t});\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { CommentSubscribeParams, ReadAllChannelCommentsParams } from '../../types/comments';\n\nexport class CommentsPullHandler\n{\n\thandleCommentSubscribe(params: CommentSubscribeParams)\n\t{\n\t\tconst { messageId, subscribe } = params;\n\t\tLogger.warn('CommentsPullHandler: handleCommentSubscribe', params);\n\t\tif (subscribe)\n\t\t{\n\t\t\tCore.getStore().dispatch('messages/comments/subscribe', messageId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('messages/comments/unsubscribe', messageId);\n\t}\n\n\thandleReadAllChannelComments(params: ReadAllChannelCommentsParams)\n\t{\n\t\tCore.getStore().dispatch('counters/readAllChannelComments', params.chatId);\n\t}\n}\n","import { SidePanel, type SliderManager } from 'main.sidepanel';\n\nimport { Messenger } from 'im.public';\nimport { DesktopManager } from 'im.v2.lib.desktop';\nimport { MessengerSlider } from 'im.v2.lib.slider';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport type { ApplicationOpenChatParams } from '../../types/application';\n\nexport class ApplicationPullHandler\n{\n\thandleApplicationOpenChat(params: ApplicationOpenChatParams): void\n\t{\n\t\tLogger.warn('ApplicationPullHandler: handleOpenChat', params);\n\n\t\tif (!this.#isChatFocused())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (DesktopManager.isDesktop())\n\t\t{\n\t\t\tif (!DesktopManager.isChatWindow())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid Messenger.openChat(params.dialogId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tvoid Messenger.openChat(params.dialogId);\n\t}\n\n\t#isChatFocused(): boolean\n\t{\n\t\tif (!document.hasFocus())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst sidePanelManager: SliderManager = SidePanel.Instance;\n\t\tconst hasOpenSliders = sidePanelManager.getOpenSlidersCount() > 0;\n\t\tconst isEmbeddedMode = LayoutManager.getInstance().isEmbeddedMode();\n\t\tif (isEmbeddedMode && hasOpenSliders)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst isChatSliderFocused = MessengerSlider.getInstance().isFocused();\n\t\tif (!isEmbeddedMode && !isChatSliderFocused)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { UpdateCollabEntityCounterParams, UpdateCollabGuestCountParams } from '../../types/collab';\n\nexport class CollabPullHandler\n{\n\thandleUpdateCollabEntityCounter(params: UpdateCollabEntityCounterParams)\n\t{\n\t\tLogger.warn('CollabPullHandler: handleUpdateCollabEntityCounter', params);\n\t\tconst { chatId, counter, entity } = params;\n\t\tvoid Core.getStore().dispatch('chats/collabs/setCounter', { chatId, entity, counter });\n\t}\n\n\thandleUpdateCollabGuestCount(params: UpdateCollabGuestCountParams)\n\t{\n\t\tLogger.warn('CollabPullHandler: handleUpdateCollabGuestCount', params);\n\t\tconst { chatId, guestCount } = params;\n\t\tvoid Core.getStore().dispatch('chats/collabs/setGuestCount', { chatId, guestCount });\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { ImModelChat } from 'im.v2.model';\nimport type { EngineUpdateParams, FileTranscriptionParams, CopilotRoleParams } from '../../types/ai';\n\nexport class AiPullHandler\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\thandleChangeEngine(params: EngineUpdateParams)\n\t{\n\t\tLogger.warn('AiPullHandler: handleChangeEngine', params);\n\t\tconst { chatId, engineCode } = params;\n\t\tconst dialog: ImModelChat = this.#store.getters['chats/getByChatId'](chatId);\n\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#store.dispatch('copilot/chats/updateModel', { dialogId: dialog.dialogId, aiModel: engineCode });\n\t}\n\n\thandleFileTranscription(params: FileTranscriptionParams)\n\t{\n\t\tLogger.warn('AiPullHandler: handleFileTranscription', params);\n\n\t\tthis.#store.dispatch('files/setTranscription', params);\n\t}\n\n\thandleChatCopilotRoleUpdate(params: CopilotRoleParams)\n\t{\n\t\tif (!params.copilotRole)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst copilotManager = new CopilotManager();\n\t\tvoid copilotManager.handleRoleUpdate(params.copilotRole);\n\t}\n}\n","import { BotPullHandler } from './handlers/bot';\nimport { MessagePullHandler } from './handlers/message';\nimport { ChatPullHandler } from './handlers/chat';\nimport { TariffPullHandler } from './handlers/tariff';\nimport { UserPullHandler } from './handlers/user';\nimport { DesktopPullHandler } from './handlers/desktop';\nimport { SettingsPullHandler } from './handlers/settings';\nimport { CommentsPullHandler } from './handlers/comments';\nimport { ApplicationPullHandler } from './handlers/application';\nimport { CollabPullHandler } from './handlers/collab';\nimport { AiPullHandler } from './handlers/ai';\n\nexport class BasePullHandler\n{\n\t#messageHandler: MessagePullHandler;\n\t#chatHandler: ChatPullHandler;\n\t#userHandler: UserPullHandler;\n\t#desktopHandler: DesktopPullHandler;\n\t#settingsHandler: SettingsPullHandler;\n\t#commentsHandler: CommentsPullHandler;\n\t#tariffPullHandler: TariffPullHandler;\n\t#applicationPullHandler: ApplicationPullHandler;\n\t#collabPullHandler: CollabPullHandler;\n\t#botPullHandler: BotPullHandler;\n\t#aiPullHandler: AiPullHandler;\n\n\tconstructor()\n\t{\n\t\tthis.#messageHandler = new MessagePullHandler();\n\t\tthis.#chatHandler = new ChatPullHandler();\n\t\tthis.#userHandler = new UserPullHandler();\n\t\tthis.#desktopHandler = new DesktopPullHandler();\n\t\tthis.#settingsHandler = new SettingsPullHandler();\n\t\tthis.#commentsHandler = new CommentsPullHandler();\n\t\tthis.#tariffPullHandler = new TariffPullHandler();\n\t\tthis.#applicationPullHandler = new ApplicationPullHandler();\n\t\tthis.#collabPullHandler = new CollabPullHandler();\n\t\tthis.#botPullHandler = new BotPullHandler();\n\t\tthis.#aiPullHandler = new AiPullHandler();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\t// region 'message'\n\thandleMessage(params)\n\t{\n\t\tthis.#messageHandler.handleMessageAdd(params);\n\t}\n\n\thandleMessageChat(params)\n\t{\n\t\tthis.#messageHandler.handleMessageAdd(params);\n\t}\n\n\thandleMessageUpdate(params)\n\t{\n\t\tthis.#messageHandler.handleMessageUpdate(params);\n\t}\n\n\thandleMessageDeleteV2(params)\n\t{\n\t\tthis.#messageHandler.handleMessageDeleteV2(params);\n\t}\n\n\thandleMessageDelete(params)\n\t{\n\t\tthis.#messageHandler.handleMessageDelete(params);\n\t}\n\n\thandleMessageDeleteComplete(params)\n\t{\n\t\tthis.#messageHandler.handleMessageDeleteComplete(params);\n\t}\n\n\thandleAddReaction(params)\n\t{\n\t\tthis.#messageHandler.handleAddReaction(params);\n\t}\n\n\thandleDeleteReaction(params)\n\t{\n\t\tthis.#messageHandler.handleDeleteReaction(params);\n\t}\n\n\thandleMessageParamsUpdate(params)\n\t{\n\t\tthis.#messageHandler.handleMessageParamsUpdate(params);\n\t}\n\n\thandleReadMessage(params, extra)\n\t{\n\t\tthis.#messageHandler.handleReadMessage(params, extra);\n\t}\n\n\thandleReadMessageChat(params, extra)\n\t{\n\t\tthis.#messageHandler.handleReadMessage(params, extra);\n\t}\n\n\thandleReadMessageOpponent(params)\n\t{\n\t\tthis.#messageHandler.handleReadMessageOpponent(params);\n\t}\n\n\thandleReadMessageChatOpponent(params)\n\t{\n\t\tthis.#messageHandler.handleReadMessageOpponent(params);\n\t}\n\n\thandlePinAdd(params)\n\t{\n\t\tthis.#messageHandler.handlePinAdd(params);\n\t}\n\n\thandlePinDelete(params)\n\t{\n\t\tthis.#messageHandler.handlePinDelete(params);\n\t}\n\t// endregion 'message'\n\n\t// region 'chat'\n\thandleChatOwner(params)\n\t{\n\t\tthis.#chatHandler.handleChatOwner(params);\n\t}\n\n\thandleChatManagers(params)\n\t{\n\t\tthis.#chatHandler.handleChatManagers(params);\n\t}\n\n\thandleChatUserAdd(params)\n\t{\n\t\tthis.#chatHandler.handleChatUserAdd(params);\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tthis.#chatHandler.handleChatUserLeave(params);\n\t}\n\n\thandleInputActionNotify(params)\n\t{\n\t\tthis.#chatHandler.handleInputActionNotify(params);\n\t}\n\n\thandleChatUnread(params)\n\t{\n\t\tthis.#chatHandler.handleChatUnread(params);\n\t}\n\n\thandleReadAllChats()\n\t{\n\t\tthis.#chatHandler.handleReadAllChats();\n\t}\n\n\thandleReadAllChatsByType(params)\n\t{\n\t\tthis.#chatHandler.handleReadAllChatsByType(params);\n\t}\n\n\thandleChatMuteNotify(params)\n\t{\n\t\tthis.#chatHandler.handleChatMuteNotify(params);\n\t}\n\n\thandleChatRename(params)\n\t{\n\t\tthis.#chatHandler.handleChatRename(params);\n\t}\n\n\thandleChatAvatar(params)\n\t{\n\t\tthis.#chatHandler.handleChatAvatar(params);\n\t}\n\n\thandleChatUpdate(params)\n\t{\n\t\tthis.#chatHandler.handleChatUpdate(params);\n\t}\n\n\thandleChatFieldsUpdate(params)\n\t{\n\t\tthis.#chatHandler.handleChatFieldsUpdate(params);\n\t}\n\n\thandleChatDelete(params)\n\t{\n\t\tthis.#chatHandler.handleChatDelete(params);\n\t}\n\n\thandleChatConvert(params)\n\t{\n\t\tthis.#chatHandler.handleChatConvert(params);\n\t}\n\n\thandleMessagesAutoDeleteDelayChanged(params)\n\t{\n\t\tthis.#chatHandler.handleMessagesAutoDeleteDelayChanged(params);\n\t}\n\t// endregion 'chat'\n\n\t// region 'user'\n\thandleUserInvite(params)\n\t{\n\t\tthis.#userHandler.handleUserInvite(params);\n\t}\n\n\thandleUserShowInRecent(params)\n\t{\n\t\tthis.#userHandler.handleUserShowInRecent(params);\n\t}\n\t// endregion 'user'\n\n\t// region 'desktop'\n\thandleDesktopOnline(params)\n\t{\n\t\tthis.#desktopHandler.handleDesktopOnline(params);\n\t}\n\n\thandleDesktopOffline()\n\t{\n\t\tthis.#desktopHandler.handleDesktopOffline();\n\t}\n\t// endregion 'desktop'\n\n\t// region 'settings'\n\thandleSettingsUpdate(params)\n\t{\n\t\tthis.#settingsHandler.handleSettingsUpdate(params);\n\t}\n\t// endregion 'settings'\n\n\t// region 'comments'\n\thandleCommentSubscribe(params)\n\t{\n\t\tthis.#commentsHandler.handleCommentSubscribe(params);\n\t}\n\n\thandleReadAllChannelComments(params)\n\t{\n\t\tthis.#commentsHandler.handleReadAllChannelComments(params);\n\t}\n\t// endregion 'comments'\n\n\t// region 'tariff'\n\thandleChangeTariff(params)\n\t{\n\t\tthis.#tariffPullHandler.handleChangeTariff(params);\n\t}\n\t// endregion 'tariff'\n\n\t// region 'collab'\n\thandleUpdateCollabEntityCounter(params)\n\t{\n\t\tthis.#collabPullHandler.handleUpdateCollabEntityCounter(params);\n\t}\n\n\thandleUpdateCollabGuestCount(params)\n\t{\n\t\tthis.#collabPullHandler.handleUpdateCollabGuestCount(params);\n\t}\n\t// endregion 'collab'\n\n\t// region 'application'\n\thandleApplicationOpenChat(params)\n\t{\n\t\tthis.#applicationPullHandler.handleApplicationOpenChat(params);\n\t}\n\t// endregion 'application'\n\n\t// region 'bot'\n\thandleBotAdd(params)\n\t{\n\t\tthis.#botPullHandler.handleBotAdd(params);\n\t}\n\n\thandleBotUpdate(params)\n\t{\n\t\tthis.#botPullHandler.handleBotUpdate(params);\n\t}\n\t// endregion 'bot'\n\n\t// region 'ai'\n\thandleChangeEngine(params)\n\t{\n\t\tthis.#aiPullHandler.handleChangeEngine(params);\n\t}\n\n\thandleFileTranscription(params)\n\t{\n\t\tthis.#aiPullHandler.handleFileTranscription(params);\n\t}\n\n\thandleChatCopilotRoleUpdate(params)\n\t{\n\t\tthis.#aiPullHandler.handleChatCopilotRoleUpdate(params);\n\t}\n\t// endregion 'ai'\n}\n","import { Core } from 'im.v2.application.core';\nimport { ChatType, RecentType } from 'im.v2.const';\nimport { ChannelManager } from 'im.v2.lib.channel';\n\nimport type { PullExtraParams, RawChat } from '../../types/common';\nimport type { MessageAddParams } from '../../types/message';\n\nconst ActionNameByRecentType = {\n\t[RecentType.default]: 'recent/setRecent',\n\t[RecentType.copilot]: 'recent/setCopilot',\n\t[RecentType.openChannel]: 'recent/setChannel',\n\t[RecentType.collab]: 'recent/setCollab',\n\t[RecentType.taskComments]: 'recent/setTask',\n};\n\nexport class NewMessageManager\n{\n\t#params: MessageAddParams;\n\t#extra: PullExtraParams;\n\n\tconstructor(params: MessageAddParams, extra: PullExtraParams = {})\n\t{\n\t\tthis.#params = params;\n\t\tthis.#extra = extra;\n\t}\n\n\tgetChatId(): number\n\t{\n\t\treturn this.#params.chatId;\n\t}\n\n\tgetParentChatId(): number\n\t{\n\t\treturn this.getChat()?.parent_chat_id || 0;\n\t}\n\n\tgetChat(): ?RawChat\n\t{\n\t\tconst chatId = this.getChatId();\n\n\t\treturn this.#params.chat?.[chatId];\n\t}\n\n\tgetChatType(): string\n\t{\n\t\tconst chat = this.getChat();\n\n\t\treturn chat?.type ?? '';\n\t}\n\n\tgetRecentTypes(): $Values<typeof RecentType>[]\n\t{\n\t\treturn this.#params.recentConfig.sections;\n\t}\n\n\tisLinesChat(): boolean\n\t{\n\t\treturn Boolean(this.#params.lines);\n\t}\n\n\tisCommentChat(): boolean\n\t{\n\t\treturn this.getChatType() === ChatType.comment;\n\t}\n\n\tisChannelChat(): boolean\n\t{\n\t\treturn ChannelManager.channelTypes.has(this.getChatType());\n\t}\n\n\tisUserInChat(): boolean\n\t{\n\t\tconst chatUsers = this.#params.userInChat[this.getChatId()];\n\t\tif (!chatUsers || this.isChannelListEvent())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn chatUsers.includes(Core.getUserId());\n\t}\n\n\tisChannelListEvent(): boolean\n\t{\n\t\treturn this.isChannelChat() && this.#extra.is_shared_event;\n\t}\n\n\tneedToSkipMessageEvent(): boolean\n\t{\n\t\treturn this.isLinesChat() || this.isCommentChat() || !this.isUserInChat();\n\t}\n\n\tgetAddActions(): string[]\n\t{\n\t\tconst recentTypes = this.getRecentTypes();\n\n\t\treturn recentTypes.map((recentType) => {\n\t\t\treturn ActionNameByRecentType[recentType];\n\t\t});\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport type { RecentUpdateParams } from '../../types/recent';\n\nexport class RecentUpdateManager\n{\n\t#params: RecentUpdateParams;\n\n\tconstructor(params: RecentUpdateParams)\n\t{\n\t\tthis.#params = params;\n\t}\n\n\tsetLastMessageInfo(): void\n\t{\n\t\tthis.#setMessageChat();\n\t\tthis.#setUsers();\n\t\tthis.#setFiles();\n\t\tthis.#setMessage();\n\t}\n\n\tgetDialogId(): string\n\t{\n\t\treturn this.#params.chat.dialogId;\n\t}\n\n\tgetLastMessageId(): number\n\t{\n\t\tconst [lastMessage] = this.#params.messages;\n\n\t\treturn lastMessage.id;\n\t}\n\n\t#setUsers(): void\n\t{\n\t\tconst userManager = new UserManager();\n\t\tuserManager.setUsersToModel(this.#params.users);\n\t}\n\n\t#setFiles(): void\n\t{\n\t\tCore.getStore().dispatch('files/set', this.#params.files);\n\t}\n\n\t#setMessageChat(): void\n\t{\n\t\tconst chat = { ...this.#params.chat, counter: this.#params.counter, dialogId: this.getDialogId() };\n\t\tCore.getStore().dispatch('chats/set', chat);\n\t}\n\n\t#setMessage(): void\n\t{\n\t\tconst [lastChannelPost] = this.#params.messages;\n\t\tCore.getStore().dispatch('messages/store', lastChannelPost);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\n\nimport type { ImModelRecentItem } from 'im.v2.model';\nimport type { MessageAddParams } from 'im.v2.provider.pull';\n\nexport function buildRecentItem(params: MessageAddParams): ImModelRecentItem\n{\n\tconst newRecentItem = {\n\t\tid: params.dialogId,\n\t\tchatId: params.chatId,\n\t\tmessageId: params.message.id,\n\t};\n\n\tconst recentItem: ?ImModelRecentItem = Core.getStore().getters['recent/get'](params.dialogId);\n\tif (recentItem)\n\t{\n\t\tnewRecentItem.isFakeElement = false;\n\t\tnewRecentItem.isBirthdayPlaceholder = false;\n\t\tnewRecentItem.liked = false;\n\t}\n\n\treturn newRecentItem;\n}\n","import { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport { NewMessageManager } from './classes/new-message-manager';\nimport { RecentUpdateManager } from './classes/recent-update-manager';\nimport { buildRecentItem } from './helpers/helpers';\n\nimport type { PullExtraParams, RawMessage } from '../types/common';\nimport type {\n\tMessageAddParams,\n\tAddReactionParams,\n\tMessageDeleteCompleteParams,\n\tMultipleMessageDeleteParams,\n} from '../types/message';\nimport type { ChatUnreadParams } from '../types/chat';\nimport type { UserInviteParams } from '../types/user';\nimport type { RecentHideParams, RecentUpdateParams, UserShowInRecentParams } from '../types/recent';\nimport type { ImModelRecentItem, ImModelMessage } from 'im.v2.model';\n\n// noinspection JSUnusedGlobalSymbols\nexport class RecentPullHandler\n{\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleMessage(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageChat(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageAdd(params: MessageAddParams, extra: PullExtraParams)\n\t{\n\t\tconst manager = new NewMessageManager(params, extra);\n\n\t\tif (manager.needToSkipMessageEvent(params))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.warn('RecentPullHandler: handleMessageAdd', params);\n\n\t\tconst newRecentItem = buildRecentItem(params);\n\n\t\tconst addActions = manager.getAddActions();\n\t\taddActions.forEach((actionName) => {\n\t\t\tif (!actionName)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tCore.getStore().dispatch(actionName, newRecentItem);\n\t\t});\n\t}\n\n\thandleMessageDeleteV2(params: MultipleMessageDeleteParams)\n\t{\n\t\tthis.#deleteLastMessage(params.dialogId, params.newLastMessage);\n\t}\n\n\thandleMessageDeleteComplete(params: MessageDeleteCompleteParams)\n\t{\n\t\tthis.#deleteLastMessage(params.dialogId, params.newLastMessage);\n\t}\n\n\thandleChatUnread(params: ChatUnreadParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatUnread', params);\n\t\tCore.getStore().dispatch('recent/unread', {\n\t\t\tid: params.dialogId,\n\t\t\taction: params.active,\n\t\t});\n\t}\n\n\thandleAddReaction(params: AddReactionParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleAddReaction', params);\n\t\tconst recentItem: ?ImModelRecentItem = Core.getStore().getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatIsOpened = Core.getStore().getters['application/isChatOpen'](params.dialogId);\n\t\tif (chatIsOpened)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst message: ?ImModelMessage = Core.getStore().getters['recent/getMessage'](params.dialogId);\n\t\tconst isOwnLike = Core.getUserId() === params.userId;\n\t\tconst isOwnLastMessage = Core.getUserId() === message.authorId;\n\t\tif (isOwnLike || !isOwnLastMessage)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/like', {\n\t\t\tid: params.dialogId,\n\t\t\tmessageId: params.actualReactions.reaction.messageId,\n\t\t\tliked: true,\n\t\t});\n\t}\n\n\thandleChatPin(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatPin', params);\n\t\tconst recentItem: ?ImModelRecentItem = Core.getStore().getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/pin', {\n\t\t\tid: params.dialogId,\n\t\t\taction: params.active,\n\t\t});\n\t}\n\n\thandleChatHide(params: RecentHideParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatHide', params);\n\t\tconst recentItem: ?ImModelRecentItem = Core.getStore().getters['recent/get'](params.dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid Core.getStore().dispatch('recent/hide', {\n\t\t\tid: params.dialogId,\n\t\t});\n\t}\n\n\thandleChatUserLeave(params)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleChatUserLeave', params);\n\t\tconst recentItem: ?ImModelRecentItem = Core.getStore().getters['recent/get'](params.dialogId);\n\t\tif (!recentItem || params.userId !== Core.getUserId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/hide', {\n\t\t\tid: params.dialogId,\n\t\t});\n\t}\n\n\thandleUserInvite(params: UserInviteParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUserInvite', params);\n\n\t\tconst messageId = Utils.text.getUuidV4();\n\t\tCore.getStore().dispatch('messages/store', {\n\t\t\tid: messageId,\n\t\t\tdate: params.date,\n\t\t});\n\n\t\tCore.getStore().dispatch('recent/setRecent', {\n\t\t\tid: params.user.id,\n\t\t\tinvited: params.invited ?? false,\n\t\t\tisFakeElement: true,\n\t\t\tmessageId,\n\t\t});\n\t}\n\n\thandleUserShowInRecent(params: UserShowInRecentParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleUserShowInRecent', params);\n\t\tconst { items } = params;\n\n\t\titems.forEach((item) => {\n\t\t\tconst messageId = Utils.text.getUuidV4();\n\t\t\tCore.getStore().dispatch('messages/store', {\n\t\t\t\tid: messageId,\n\t\t\t\tdate: item.date,\n\t\t\t});\n\n\t\t\tCore.getStore().dispatch('recent/setRecent', {\n\t\t\t\tid: item.user.id,\n\t\t\t\tmessageId,\n\t\t\t});\n\t\t});\n\t}\n\n\thandleRecentUpdate(params: RecentUpdateParams)\n\t{\n\t\tLogger.warn('RecentPullHandler: handleRecentUpdate', params);\n\t\tconst manager = new RecentUpdateManager(params);\n\t\tmanager.setLastMessageInfo();\n\n\t\tconst newRecentItem = {\n\t\t\tid: manager.getDialogId(),\n\t\t\tmessageId: manager.getLastMessageId(),\n\t\t\tlastActivityDate: params.lastActivityDate,\n\t\t};\n\n\t\tCore.getStore().dispatch('recent/setRecent', newRecentItem);\n\t}\n\n\t#deleteLastMessage(dialogId: number, newLastMessage: RawMessage) {\n\t\tconst lastMessageWasDeleted = Boolean(newLastMessage);\n\n\t\tif (lastMessageWasDeleted)\n\t\t{\n\t\t\tthis.#updateRecentForMessageDelete(dialogId, newLastMessage.id);\n\t\t}\n\t}\n\n\t#updateRecentForMessageDelete(dialogId: string, newLastMessageId: number): void\n\t{\n\t\tif (!newLastMessageId)\n\t\t{\n\t\t\tCore.getStore().dispatch('recent/hide', { id: dialogId });\n\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/update', {\n\t\t\tid: dialogId,\n\t\t\tfields: { messageId: newLastMessageId },\n\t\t});\n\t}\n}\n","import { Type } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\n\nimport { NewMessageManager } from './classes/new-message-manager';\nimport { buildRecentItem } from './helpers/helpers';\n\nimport type { MessageAddParams } from 'im.v2.provider.pull';\nimport type { ImModelChat, ImModelRecentItem } from 'im.v2.model';\n\nexport class RecentUnreadPullHandler\n{\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleMessage(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageChat(params, extra)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageAdd(params: MessageAddParams, extra: PullExtraParams)\n\t{\n\t\tif (params.counter === 0 || Type.isUndefined(params.counter))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.warn('UnreadRecentPullHandler: handleMessageAdd', params);\n\n\t\tconst manager = new NewMessageManager(params, extra);\n\n\t\tif (manager.isCommentChat())\n\t\t{\n\t\t\tconst parentChatId = manager.getParentChatId();\n\n\t\t\tconst recentItem = this.#getChannelByParentChatId(parentChatId);\n\t\t\tif (!recentItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid Core.getStore().dispatch('recent/setUnread', recentItem);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst newRecentItem = buildRecentItem(params);\n\n\t\tvoid Core.getStore().dispatch('recent/setUnread', newRecentItem);\n\t}\n\n\t#getChannelByParentChatId(parentChatId: number): ?ImModelRecentItem\n\t{\n\t\tconst { dialogId }: ImModelChat = Core.getStore().getters['chats/getByChatId'](parentChatId);\n\t\tconst recentList = Core.getStore().getters['recent/getRecentCollection'];\n\n\t\treturn recentList.find((item) => item.dialogId === dialogId);\n\t}\n}\n","import {Runtime} from 'main.core';\n\nimport {Core} from 'im.v2.application.core';\nimport {UserManager} from 'im.v2.lib.user';\n\nimport type {NotifyAddParams} from './types/notification';\n\nexport class NotificationPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.userManager = new UserManager();\n\n\t\tthis.updateCounterDebounced = Runtime.debounce(this.updateCounter, 1500, this);\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\tgetSubscriptionType(): string\n\t{\n\t\treturn 'server';\n\t}\n\n\thandleNotifyAdd(params: NotifyAddParams)\n\t{\n\t\tif (params.onlyFlash === true)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.userManager.setUsersToModel(params.users);\n\t\tthis.store.dispatch('notifications/set', params);\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\thandleNotifyConfirm(params)\n\t{\n\t\tthis.store.dispatch('notifications/delete', {\n\t\t\tid: params.id,\n\t\t});\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\thandleNotifyRead(params)\n\t{\n\t\tparams.list.forEach(id => {\n\t\t\tthis.store.dispatch('notifications/read', {ids: [id], read: true});\n\t\t});\n\n\t\tif (params.counter < this.store.getters['notifications/getCounter'])\n\t\t{\n\t\t\tthis.updateCounterDebounced(params.counter);\n\t\t}\n\t}\n\n\thandleNotifyUnread(params)\n\t{\n\t\tparams.list.forEach(id => {\n\t\t\tthis.store.dispatch('notifications/read', {ids: [id], read: false});\n\t\t});\n\n\t\tif (params.counter > this.store.getters['notifications/getCounter'])\n\t\t{\n\t\t\tthis.updateCounterDebounced(params.counter);\n\t\t}\n\t}\n\n\thandleNotifyReadAll(params)\n\t{\n\t\tconst excludeIds = params.excludeIds || [];\n\t\tvoid this.store.dispatch('notifications/readAllSimple', { excludeIds });\n\n\t\tthis.updateCounterDebounced(params.newCounter);\n\t}\n\n\thandleNotifyDelete(params)\n\t{\n\t\tconst idsToDelete = Object.keys(params.id).map(id => Number.parseInt(id, 10));\n\n\t\tidsToDelete.forEach(id => {\n\t\t\tthis.store.dispatch('notifications/delete', {id});\n\t\t});\n\n\t\tthis.updateCounterDebounced(params.counter);\n\t}\n\n\tupdateCounter(counter: number)\n\t{\n\t\tthis.store.dispatch('notifications/setCounter', counter);\n\t}\n}\n","import { Type } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { UserManager } from 'im.v2.lib.user';\nimport { SidebarDetailBlock } from 'im.v2.const';\nimport { ChatUnreadParams } from './types/chat';\n\nimport type {\n\tAddMultidialogParams,\n\tChangeMultidialogSessionsLimitParams,\n\tChangeMultidialogStatusParams,\n} from './types/multidialog';\nimport { MessageChatParams, MessageParams, ReadMessageChatParams, ReadMessageParams } from './types/message';\nimport type { ChatUserAddParams, ChatUserLeaveParams } from './types/chat';\nimport type { ImModelSidebarMultidialogItem } from 'im.v2.model';\n\nexport class SidebarPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\t// region members\n\thandleChatUserAdd(params: ChatUserAddParams)\n\t{\n\t\tif (this.getMembersCountFromStore(params.chatId) === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { chatId, users, newUsers, relations } = params;\n\t\tvoid this.userManager.setUsersToModel(Object.values(users));\n\n\t\tconst usersToAdd = newUsers.filter((userId) => {\n\t\t\tconst { isHidden } = relations.find((relation) => relation.userId === userId);\n\n\t\t\treturn !isHidden;\n\t\t});\n\n\t\tvoid this.store.dispatch('sidebar/members/set', {\n\t\t\tchatId,\n\t\t\tusers: usersToAdd,\n\t\t});\n\t}\n\n\thandleChatUserLeave(params: ChatUserLeaveParams)\n\t{\n\t\tif (this.getMembersCountFromStore(params.chatId) === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/members/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tuserId: params.userId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region task\n\thandleTaskAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(params.users);\n\n\t\tvoid this.store.dispatch('sidebar/tasks/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\ttasks: [params.link],\n\t\t});\n\t}\n\n\thandleTaskUpdate(params, extra)\n\t{\n\t\tthis.handleTaskAdd(params, extra);\n\t}\n\n\thandleTaskDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/tasks/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region meetings\n\thandleCalendarAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(params.users);\n\n\t\tvoid this.store.dispatch('sidebar/meetings/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tmeetings: [params.link],\n\t\t});\n\t}\n\n\thandleCalendarUpdate(params, extra)\n\t{\n\t\tthis.handleCalendarAdd(params, extra);\n\t}\n\n\thandleCalendarDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/meetings/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region links\n\thandleUrlAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(params.users);\n\n\t\tvoid this.store.dispatch('sidebar/links/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tlinks: [params.link],\n\t\t});\n\n\t\tconst counter = this.store.getters['sidebar/links/getCounter'](params.link.chatId);\n\t\tvoid this.store.dispatch('sidebar/links/setCounter', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tcounter: counter + 1,\n\t\t});\n\t}\n\n\thandleUrlDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/links/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region favorite\n\thandleMessageFavoriteAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(params.users);\n\t\tvoid this.store.dispatch('files/set', params.files);\n\t\tvoid this.store.dispatch('messages/store', [params.link.message]);\n\n\t\tvoid this.store.dispatch('sidebar/favorites/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tfavorites: [params.link],\n\t\t});\n\n\t\tconst counter = this.store.getters['sidebar/favorites/getCounter'](params.link.chatId);\n\t\tvoid this.store.dispatch('sidebar/favorites/setCounter', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tcounter: counter + 1,\n\t\t});\n\t}\n\n\thandleMessageFavoriteDelete(params)\n\t{\n\t\tif (!this.isSidebarInited(params.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/favorites/delete', {\n\t\t\tchatId: params.chatId,\n\t\t\tid: params.linkId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region files\n\thandleFileAdd(params)\n\t{\n\t\tif (!this.isSidebarInited(params.link.chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(params.users);\n\t\tvoid this.store.dispatch('files/set', params.files);\n\n\t\tconst group = params.link.group ?? SidebarDetailBlock.fileUnsorted;\n\n\t\tvoid this.store.dispatch('sidebar/files/set', {\n\t\t\tchatId: params.link.chatId,\n\t\t\tfiles: [params.link],\n\t\t\tgroup,\n\t\t});\n\t}\n\n\thandleFileDelete(params)\n\t{\n\t\tconst chatId = Type.isNumber(params.chatId) ? params.chatId : Number.parseInt(params.chatId, 10);\n\t\tif (!this.isSidebarInited(chatId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst sidebarFileId = params.linkId ?? params.fileId;\n\t\tvoid this.store.dispatch('sidebar/files/delete', {\n\t\t\tchatId,\n\t\t\tid: sidebarFileId,\n\t\t});\n\t}\n\t// endregion\n\n\t// region support24\n\n\thandleChangeMultidialogSessionsLimit(params: ChangeMultidialogSessionsLimitParams)\n\t{\n\t\tvoid this.store.dispatch('sidebar/multidialog/setOpenSessionsLimit', params.limit);\n\t}\n\n\thandleAddMultidialog(params: AddMultidialogParams)\n\t{\n\t\tconst { multidialog, count } = params;\n\t\tconst isSupport = multidialog.isSupport;\n\t\tif (!isSupport)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/multidialog/setChatsCount', count);\n\t\tvoid this.store.dispatch('sidebar/multidialog/addMultidialogs', [multidialog]);\n\t}\n\n\thandleReadMessageChat(params: ReadMessageChatParams)\n\t{\n\t\tthis.deleteUnreadSupportChats(params);\n\t}\n\n\thandleReadMessage(params: ReadMessageParams)\n\t{\n\t\tthis.deleteUnreadSupportChats(params);\n\t}\n\n\thandleChangeMultidialogStatus(params: ChangeMultidialogStatusParams)\n\t{\n\t\tconst { bot, chat, multidialog } = params;\n\n\t\tconst isSupport = multidialog.isSupport;\n\t\tif (!isSupport)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (chat)\n\t\t{\n\t\t\tvoid this.store.dispatch('chats/set', chat);\n\t\t}\n\n\t\tif (bot)\n\t\t{\n\t\t\tvoid this.userManager.setUsersToModel(bot);\n\t\t}\n\n\t\tvoid this.store.dispatch('sidebar/multidialog/addMultidialogs', [multidialog]);\n\t}\n\n\thandleMessage(params: MessageParams)\n\t{\n\t\tthis.setUnreadSupportTickets(params.multidialog);\n\t}\n\n\thandleChatUnread(params: ChatUnreadParams)\n\t{\n\t\tconst { chatId, dialogId } = params;\n\n\t\tconst isSupport = this.store.getters['sidebar/multidialog/isSupport'](dialogId);\n\t\tconst isInited = this.store.getters['sidebar/multidialog/isInited'];\n\n\t\tif (isSupport && isInited)\n\t\t{\n\t\t\tvoid this.store.dispatch('sidebar/multidialog/setUnreadChats', [chatId]);\n\t\t}\n\t}\n\t// endregion\n\n\t// region files unsorted and support24\n\thandleMessageChat(params: MessageChatParams)\n\t{\n\t\t// handle new files while migration is not finished.\n\t\tthis.setFiles(params);\n\n\t\t// handle new unread chats.\n\t\tthis.setUnreadSupportTickets(params.multidialog);\n\t}\n\t// endregion\n\n\tdeleteUnreadSupportChats(params: ReadMessageChatParams | ReadMessageParams)\n\t{\n\t\tconst notCounter = params.counter === 0;\n\n\t\tif (notCounter)\n\t\t{\n\t\t\tvoid this.store.dispatch('sidebar/multidialog/deleteUnreadChats', params.chatId);\n\t\t}\n\t}\n\n\tsetUnreadSupportTickets(multidialog: ImModelSidebarMultidialogItem)\n\t{\n\t\tif (!multidialog)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldMultidialog = this.store.getters['sidebar/multidialog/get'](multidialog.chatId);\n\t\tconst status = oldMultidialog?.status || multidialog.status;\n\n\t\tvoid this.store.dispatch('sidebar/multidialog/addMultidialogs', [{ ...multidialog, status }]);\n\t\tvoid this.store.dispatch('sidebar/multidialog/setUnreadChats', [multidialog.chatId]);\n\t}\n\n\tsetFiles(params: MessageChatParams)\n\t{\n\t\tconst { chatId, users, files } = params;\n\n\t\tif (!this.isSidebarInited(chatId) || this.areFilesMigrated())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid this.userManager.setUsersToModel(Object.values(users));\n\t\tvoid this.store.dispatch('files/set', Object.values(files));\n\n\t\tObject.values(files).forEach((file) => {\n\t\t\tconst group = file.group ?? SidebarDetailBlock.fileUnsorted;\n\t\t\tvoid this.store.dispatch('sidebar/files/set', {\n\t\t\t\tchatId: file.chatId,\n\t\t\t\tfiles: [file],\n\t\t\t\tgroup,\n\t\t\t});\n\t\t});\n\t}\n\n\tisSidebarInited(chatId: number): boolean\n\t{\n\t\treturn this.store.getters['sidebar/isInited'](chatId);\n\t}\n\n\tareFilesMigrated(): boolean\n\t{\n\t\treturn this.store.state.sidebar.isFilesMigrated;\n\t}\n\n\tgetMembersCountFromStore(chatId: number): number\n\t{\n\t\treturn this.store.getters['sidebar/members/getSize'](chatId);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { UserStatus, LocalStorageKey, Settings, RawSettings, UserType } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { MessageNotifierManager } from 'im.v2.lib.message-notifier';\nimport { DesktopManager } from 'im.v2.lib.desktop';\nimport { CallManager } from 'im.v2.lib.call';\nimport { LocalStorageManager } from 'im.v2.lib.local-storage';\n\nimport type { MessageAddParams } from './types/message';\nimport type { NotifyAddParams } from './types/notification';\n\nexport class NotifierPullHandler\n{\n\tlastNotificationId: number = 0;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\n\t\tthis.#setCurrentUserStatus();\n\t\tthis.#restoreLastNotificationId();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleMessage(params: MessageAddParams, extraData: PullExtraData)\n\t{\n\t\tthis.handleMessageAdd(params, extraData);\n\t}\n\n\thandleMessageChat(params: MessageAddParams, extraData: PullExtraData)\n\t{\n\t\tthis.handleMessageAdd(params, extraData);\n\t}\n\n\thandleMessageAdd(params: MessageAddParams, extraData: PullExtraData)\n\t{\n\t\tif (!this.#shouldHandleMessageNotification(params, extraData))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid MessageNotifierManager.getInstance().handleIncomingMessage({\n\t\t\tdialogId: params.dialogId.toString(),\n\t\t\tisImportant: this.#isImportantMessage(params),\n\t\t\tmessageId: params.message.id,\n\t\t\tisLines: Boolean(params.lines),\n\t\t});\n\n\t\tthis.#updateLastNotificationId(params.message.id);\n\t}\n\n\thandleNotifyAdd(params: NotifyAddParams, extraData: PullExtraData)\n\t{\n\t\tif (!this.#shouldHandleNotification(params, extraData))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tMessageNotifierManager.getInstance().handleIncomingNotification({\n\t\t\tnotificationId: params.id,\n\t\t\tuserId: params.userId,\n\t\t\tisSilent: params.silent === 'Y',\n\t\t});\n\n\t\tthis.#updateLastNotificationId(params.id);\n\t}\n\n\t#shouldHandleMessageNotification(params: MessageAddParams, extraData: PullExtraData): boolean\n\t{\n\t\tif (this.#isExpired(extraData))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.#checkLastNotificationId(params.message.id))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this.#isCurrentUserSender(params))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (params.lines && !this.#shouldShowLinesNotification(params))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!this.#shouldShowToUser(params) || this.#desktopWillShowNotification())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst callIsActive = CallManager.getInstance().hasCurrentCall();\n\t\tif (callIsActive && CallManager.getInstance().getCurrentCallDialogId() !== params.dialogId.toString())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst screenSharingIsActive = CallManager.getInstance().hasCurrentScreenSharing();\n\n\t\treturn !screenSharingIsActive;\n\t}\n\n\t#shouldHandleNotification(params: NotifyAddParams, extraData: PullExtraData): boolean\n\t{\n\t\tif (this.#isExpired(extraData) || !this.#checkLastNotificationId(params.id))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (\n\t\t\tparams.onlyFlash === true\n\t\t\t|| this.#isUserDnd()\n\t\t\t|| this.#desktopWillShowNotification()\n\t\t\t|| CallManager.getInstance().hasCurrentCall()\n\t\t)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (document.hasFocus())\n\t\t{\n\t\t\tconst areNotificationsOpen = this.store.getters['application/areNotificationsOpen'];\n\t\t\tif (areNotificationsOpen)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#shouldShowLinesNotification(params: MessageAddParams): boolean\n\t{\n\t\tif (this.#isLinesChatOpened(params.dialogId))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst authorId = params.message.senderId;\n\t\tif (authorId > 0 && params.users[authorId].type !== UserType.extranet)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst counter = this.store.getters['counters/getSpecificLinesCounter'](params.chatId);\n\n\t\treturn counter === 0;\n\t}\n\n\t#isLinesChatOpened(dialogId: string): boolean\n\t{\n\t\tconst isLinesChatOpen = this.store.getters['application/isLinesChatOpen'](dialogId);\n\n\t\treturn Boolean(document.hasFocus() && isLinesChatOpen);\n\t}\n\n\t#isImportantMessage(params: MessageAddParams): boolean\n\t{\n\t\tconst { message } = params;\n\n\t\treturn message.isImportant || message.importantFor.includes(Core.getUserId());\n\t}\n\n\t#shouldShowToUser(params: MessageAddParams): boolean\n\t{\n\t\tif (this.#isImportantMessage(params))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst { notify, message, dialogId } = params;\n\n\t\tconst messageParams = message?.params;\n\t\tconst isNotificationDisabled = !notify || messageParams?.NOTIFY === 'N';\n\t\tif (isNotificationDisabled)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst dialog = this.store.getters['chats/get'](dialogId, true);\n\t\tconst isMuted = dialog.muteList.includes(Core.getUserId());\n\n\t\treturn !this.#isUserDnd() && !isMuted;\n\t}\n\n\t#isUserDnd(): boolean\n\t{\n\t\tconst status = this.store.getters['application/settings/get'](Settings.user.status);\n\n\t\treturn status === UserStatus.dnd;\n\t}\n\n\t#desktopWillShowNotification(): boolean\n\t{\n\t\tconst isDesktopChatWindow = DesktopManager.isChatWindow();\n\n\t\treturn !isDesktopChatWindow && DesktopManager.getInstance().isDesktopActive();\n\t}\n\n\t#restoreLastNotificationId()\n\t{\n\t\tconst rawLastNotificationId = LocalStorageManager.getInstance().get(LocalStorageKey.lastNotificationId, 0);\n\n\t\tthis.lastNotificationId = Number.parseInt(rawLastNotificationId, 10);\n\t}\n\n\t#updateLastNotificationId(notificationId: number)\n\t{\n\t\tconst WRITE_TO_STORAGE_TIMEOUT = 2000;\n\n\t\tthis.lastNotificationId = notificationId;\n\t\tclearTimeout(this.writeToStorageTimeout);\n\t\tthis.writeToStorageTimeout = setTimeout(() => {\n\t\t\tLocalStorageManager.getInstance().set(LocalStorageKey.lastNotificationId, notificationId);\n\t\t}, WRITE_TO_STORAGE_TIMEOUT);\n\t}\n\n\t#setCurrentUserStatus()\n\t{\n\t\tconst applicationData: { settings: RawSettings } = Core.getApplicationData();\n\t\tif (!applicationData.settings?.status)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('application/settings/set', {\n\t\t\t[Settings.user.status]: applicationData.settings.status,\n\t\t});\n\t}\n\n\t#isExpired(extraData: PullExtraData): boolean\n\t{\n\t\tif (extraData.server_time_ago > 10)\n\t\t{\n\t\t\tLogger.warn('NotifierPullHandler: received notification 10 seconds after it was actually sent, ignore');\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t#checkLastNotificationId(id: number): boolean\n\t{\n\t\tif (id <= this.lastNotificationId)\n\t\t{\n\t\t\tLogger.warn('NotifierPullHandler: new message id is smaller than lastNotificationId');\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#isCurrentUserSender(params: MessageAddParams): boolean\n\t{\n\t\treturn Core.getUserId() === params.message.senderId;\n\t}\n}\n","import { Type } from 'main.core';\nimport { Core } from 'im.v2.application.core';\n\nexport class OnlinePullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'online';\n\t}\n\n\tgetSubscriptionType(): string\n\t{\n\t\treturn 'online';\n\t}\n\n\thandleUserStatus(params: {\n\t\tusers: Object,\n\t})\n\t{\n\t\tconst currentUserId = Core.getUserId();\n\t\tif (Type.isPlainObject(params.users[currentUserId]))\n\t\t{\n\t\t\tconst { status } = params.users[currentUserId];\n\t\t\tthis.store.dispatch('application/settings/set', { status });\n\t\t}\n\n\t\tObject.values(params.users).forEach((userInfo) => {\n\t\t\tthis.store.dispatch('users/update', {\n\t\t\t\tid: userInfo.id,\n\t\t\t\tfields: {\n\t\t\t\t\tlastActivityDate: userInfo.last_activity_date,\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n}\n","import { Type } from 'main.core';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { NewMessageManager } from 'im.v2.provider.pull';\nimport { Core } from 'im.v2.application.core';\nimport { CounterType, RecentType } from 'im.v2.const';\n\nimport type { MessageAddParams, PullExtraParams, ReadMessageParams, UnreadMessageParams } from 'im.v2.provider.pull';\nimport type { ChatMuteNotifyParams, ChatUnreadParams } from './types/chat';\nimport type { MessageDeleteCompleteParams } from './types/message';\n\ntype RecentTypeItem = $Values<typeof RecentType>;\n\ntype CounterParams = {\n\tdialogId: string,\n\tchatId: number,\n\tparentChatId: number,\n\tcounter: number,\n\tmuted: boolean,\n\tunread: boolean,\n\tcounterType: $Values<typeof CounterType>,\n\trecentConfig: {\n\t\tchatId: number,\n\t\tsections: RecentTypeItem[],\n\t},\n};\n\nexport class CounterPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleMessage(params: MessageAddParams, extra: PullExtraParams)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageChat(params: MessageAddParams, extra: PullExtraParams)\n\t{\n\t\tthis.handleMessageAdd(params, extra);\n\t}\n\n\thandleMessageAdd(params: MessageAddParams, extra: PullExtraParams)\n\t{\n\t\tconst manager = new NewMessageManager(params, extra);\n\t\tif (!manager.isCommentChat())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#updateCommentCounter({\n\t\t\tchannelChatId: manager.getParentChatId(),\n\t\t\tcommentChatId: manager.getChatId(),\n\t\t\tcommentCounter: params.counter,\n\t\t});\n\t}\n\n\thandleMessageDeleteComplete(params: MessageDeleteCompleteParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\thandleReadMessage(params: ReadMessageParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\thandleReadMessageChat(params: ReadMessageParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\thandleUnreadMessage(params: UnreadMessageParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\thandleUnreadMessageChat(params: UnreadMessageParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\thandleChatUnread(params: ChatUnreadParams)\n\t{\n\t\tthis.#handleCounters({\n\t\t\t...params,\n\t\t\tunread: params.active,\n\t\t});\n\t}\n\n\thandleChatMuteNotify(params: ChatMuteNotifyParams)\n\t{\n\t\tthis.#handleCounters(params);\n\t}\n\n\t#handleCounters(params: CounterParams)\n\t{\n\t\tconst {\n\t\t\tchatId,\n\t\t\tcounter,\n\t\t\tcounterType = CounterType.chat,\n\t\t\tparentChatId = 0,\n\t\t} = params;\n\n\t\tif (counterType === CounterType.openline)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.warn('CounterPullHandler: handleCounters:', params);\n\n\t\tif (counterType === CounterType.comment)\n\t\t{\n\t\t\tthis.#updateCommentCounter({\n\t\t\t\tchannelChatId: parentChatId,\n\t\t\t\tcommentChatId: chatId,\n\t\t\t\tcommentCounter: counter,\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#handleUnloadedChatCounters(params);\n\t}\n\n\t#getNewCounter(params: CounterParams): number\n\t{\n\t\tconst { counter, muted, unread } = params;\n\n\t\tlet newCounter = 0;\n\t\tif (muted)\n\t\t{\n\t\t\tnewCounter = 0;\n\t\t}\n\t\telse if (unread && counter === 0)\n\t\t{\n\t\t\tnewCounter = 1;\n\t\t}\n\t\telse if (unread && counter > 0)\n\t\t{\n\t\t\tnewCounter = counter;\n\t\t}\n\t\telse if (!unread)\n\t\t{\n\t\t\tnewCounter = counter;\n\t\t}\n\n\t\treturn newCounter;\n\t}\n\n\t#updateCommentCounter(payload: { channelChatId: number, commentChatId: number, commentCounter: number })\n\t{\n\t\tconst { channelChatId, commentChatId, commentCounter } = payload;\n\t\tif (Type.isUndefined(commentCounter))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst counters = {\n\t\t\t[channelChatId]: {\n\t\t\t\t[commentChatId]: commentCounter,\n\t\t\t},\n\t\t};\n\n\t\tCore.getStore().dispatch('counters/setCommentCounters', counters);\n\t}\n\n\t#handleUnloadedChatCounters(params: CounterParams)\n\t{\n\t\tconst { chatId, recentConfig, dialogId } = params;\n\t\tconst newCounter = this.#getNewCounter(params);\n\n\t\trecentConfig.sections.forEach((recentSection) => {\n\t\t\tconst sectionConfig = this.#getRecentSectionConfig(recentSection);\n\t\t\tif (!sectionConfig)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst isInRecentCollection = this.store.getters[sectionConfig.collectionGetter](dialogId);\n\t\t\tif (isInRecentCollection)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid Core.getStore().dispatch(sectionConfig.setUnloadedCounterAction, { [chatId]: newCounter });\n\t\t});\n\t}\n\n\t#getRecentSectionConfig(section: RecentTypeItem): ?{ setUnloadedCounterAction: string, collectionGetter: string }\n\t{\n\t\tconst handlers = {\n\t\t\t[RecentType.default]: {\n\t\t\t\tsetUnloadedCounterAction: 'counters/setUnloadedChatCounters',\n\t\t\t\tcollectionGetter: 'recent/isInRecentCollection',\n\t\t\t},\n\t\t\t[RecentType.collab]: {\n\t\t\t\tsetUnloadedCounterAction: 'counters/setUnloadedCollabCounters',\n\t\t\t\tcollectionGetter: 'recent/isInCollabCollection',\n\t\t\t},\n\t\t\t[RecentType.copilot]: {\n\t\t\t\tsetUnloadedCounterAction: 'counters/setUnloadedCopilotCounters',\n\t\t\t\tcollectionGetter: 'recent/isInCopilotCollection',\n\t\t\t},\n\t\t\t[RecentType.taskComments]: {\n\t\t\t\tsetUnloadedCounterAction: 'counters/setUnloadedTaskCounters',\n\t\t\t\tcollectionGetter: 'recent/isInTaskCollection',\n\t\t\t},\n\t\t};\n\n\t\treturn handlers[section];\n\t}\n}\n","import { PromoManager } from 'im.v2.lib.promo';\n\nimport type { PromotionUpdatedParams } from 'im.v2.provider.pull';\n\nexport class PromotionPullHandler\n{\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\thandlePromotionUpdated(params: PromotionUpdatedParams): void\n\t{\n\t\tPromoManager.getInstance().onPromotionUpdated(params);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\n\nimport type { ImModelAnchor } from 'im.v2.model';\nimport type { DeleteChatAnchorsParams } from './types/anchor';\n\nexport class AnchorPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleAddAnchor(anchor: ImModelAnchor): void\n\t{\n\t\tthis.store.dispatch('messages/anchors/addAnchor', { anchor });\n\t}\n\n\thandleDeleteAnchor(anchor: ImModelAnchor): void\n\t{\n\t\tthis.store.dispatch('messages/anchors/removeAnchor', { anchor });\n\t}\n\n\thandleDeleteAnchors(payload: { chatIds: number[] }): void\n\t{\n\t\tconst { chatIds } = payload;\n\n\t\tchatIds.forEach((chatId) => {\n\t\t\tvoid this.store.dispatch('messages/anchors/removeChatAnchors', chatId);\n\t\t});\n\t}\n\n\thandleDeleteChatAnchors(payload: DeleteChatAnchorsParams): void\n\t{\n\t\tthis.store.dispatch('messages/anchors/removeChatAnchors', payload.chatId);\n\t}\n}\n","import { Core } from 'im.v2.application.core';\n\nimport type { ImModelStickerIdentifier, ImModelStickerPackIdentifier, ImModelStickerPack, ImModelSticker } from 'im.v2.model';\n\ntype StickerUuid = ImModelStickerIdentifier & { uuid: string };\n\nexport class StickersPullHandler\n{\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'im';\n\t}\n\n\thandleStickerRecentDelete(params: ImModelStickerIdentifier)\n\t{\n\t\tconst { id, packType, packId } = params;\n\t\tvoid Core.getStore().dispatch('stickers/recent/delete', { id, packType, packId });\n\t}\n\n\thandleStickerRecentDeleteAll()\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/recent/clear');\n\t}\n\n\thandleStickerPackAdd(params: {pack: ImModelStickerPack, stickers: ImModelSticker[], uuids: StickerUuid[]})\n\t{\n\t\tconst { pack, stickers } = params;\n\t\tvoid Core.getStore().dispatch('stickers/packs/addNew', pack);\n\t\tvoid Core.getStore().dispatch('stickers/set', stickers);\n\t}\n\n\thandleStickerPackLink(params: {pack: ImModelStickerPack, stickers: ImModelSticker[]})\n\t{\n\t\tthis.handleStickerPackAdd(params);\n\t}\n\n\thandleStickerPackDelete(params: ImModelStickerPackIdentifier)\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/packs/delete', params);\n\t\tvoid Core.getStore().dispatch('stickers/deleteByPack', params);\n\t}\n\n\thandleStickerPackUnlink(params: ImModelStickerPackIdentifier)\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/packs/unlink', params);\n\t}\n\n\thandleStickerPackRename(params: ImModelStickerPackIdentifier & { name: string })\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/packs/rename', params);\n\t}\n\n\thandleStickerAdd(params: {pack: ImModelStickerPack, stickers: ImModelSticker[]})\n\t{\n\t\tthis.handleStickerPackAdd(params);\n\t}\n\n\thandleStickerDelete(params: {ids: number[], packType: string, packId: number})\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/delete', params);\n\t}\n}\n"],"names":["BotPullHandler","constructor","Core","getStore","handleBotAdd","params","Logger","warn","user","UserManager","addUsersToModel","handleBotUpdate","dispatch","id","fields","MessageDeleteManager","deleteMessage","dialogId","senderId","text","isDeleted","files","attach","replyId","deleteMessageComplete","areChannelCommentsOpened","getters","dialogUpdateFields","userId","InputActionListener","getInstance","stopAction","EventEmitter","emit","EventType","dialog","closeComments","Analytics","messageDelete","onDeletedPostNotification","Notifier","message","onNotFoundError","counter","lastMessageWasDeleted","Boolean","newLastMessage","lastMessageId","lastMessageViews","MessagePullHandler","handleMessageAdd","messageWithTemplateId","messageId","templateId","messageWithRealId","error","chatId","hasLoadingMessage","handleMessageUpdate","handleMessageDeleteV2","messages","forEach","completelyDeleted","preparedParams","handleMessageDelete","handleMessageDeleteComplete","handleAddReaction","actualReactions","reaction","actualReactionsState","usersShort","getUserId","ownReactions","userManager","handleDeleteReaction","rawReaction","reactionType","newReactionItem","ownReactionsToRemove","handleMessageParamsUpdate","handleReadMessage","extra","uuidManager","UuidManager","hasActionUuid","action_uuid","removeActionUuid","messageIds","viewedMessages","then","lastId","catch","console","handleReadMessageOpponent","handlePinAdd","additionalMessages","pin","authorId","handlePinDelete","chat","chatToAdd","dialogExists","messageWithoutNotification","notify","NOTIFY","role","UserRole","member","users","setUsersToModel","Object","values","file","additionalEntities","stickers","newMessages","type","ChatType","comment","parent_message_id","messageCount","message_count","newUserId","hasNextPage","chatIsOpened","unreadMessages","RELOAD_LIMIT","MessageService","getMessageRequestLimit","inited","length","messageService","reloadMessageList","newMessage","unread","viewed","dialogFieldsToUpdate","lastReadId","ids","isLastMessage","includes","hasFirstViewer","firstViewer","userName","date","has","Set","add","scrollToBottom","threshold","DialogScrollThreshold","nearTheBottom","temporary","copilot","copilotManager","CopilotManager","messagesAutoDeleteConfigs","hasMessageSticker","Type","isPlainObject","STICKER_PARAMS","isComplete","baseParams","ChatPullHandler","handleChatOwner","ownerId","handleChatManagers","managerList","list","userInManagerList","manager","handleChatUserAdd","newUsers","relations","currentUserId","currentUserRelation","find","relation","handleChatUserLeave","currentUserIsKicked","isHidden","isChannel","ChannelManager","channelChatId","Messenger","openChat","CallManager","deleteRecentCall","chatHasCall","getCurrentCallDialogId","leaveCurrentCall","handleInputActionNotify","startAction","lastActivityDate","Date","handleChatUnread","markedId","active","handleChatMuteNotify","muted","handleChatRename","name","handleChatAvatar","avatar","handleReadAllChats","CounterClearActionsDefault","actionName","handleReadAllChatsByType","counterClearActions","CounterClearActionsByChatType","handleChatConvert","oldType","newType","newPermissions","newTypeParams","permissions","collab","diskFolderId","collabInfo","handleChatUpdate","getChatRoleForUser","handleChatFieldsUpdate","handleChatDelete","isCommentChat","parentChatId","commentChatId","chatDelete","onChatDeletedNotification","LayoutManager","clearCurrentLayoutEntityId","deleteLastOpenedElementById","handleMessagesAutoDeleteDelayChanged","delay","userCounter","userCount","extranet","chatExtranet","containsCollaber","TariffPullHandler","handleChangeTariff","tariffRestrictions","fullChatHistory","isAvailable","UserPullHandler","handleUserInvite","invited","handleUserShowInRecent","usersToStore","items","map","item","DesktopPullHandler","handleDesktopOnline","desktopManager","DesktopManager","setDesktopActive","setDesktopVersion","version","CounterManager","removeBrowserTitleCounter","handleDesktopOffline","SettingsPullHandler","handleSettingsUpdate","entries","optionName","optionValue","CommentsPullHandler","handleCommentSubscribe","subscribe","handleReadAllChannelComments","ApplicationPullHandler","handleApplicationOpenChat","isDesktop","isChatWindow","document","hasFocus","sidePanelManager","SidePanel","Instance","hasOpenSliders","getOpenSlidersCount","isEmbeddedMode","isChatSliderFocused","MessengerSlider","isFocused","CollabPullHandler","handleUpdateCollabEntityCounter","entity","handleUpdateCollabGuestCount","guestCount","AiPullHandler","handleChangeEngine","engineCode","aiModel","handleFileTranscription","handleChatCopilotRoleUpdate","copilotRole","handleRoleUpdate","BasePullHandler","getModuleId","handleMessage","handleMessageChat","handleReadMessageChat","handleReadMessageChatOpponent","ActionNameByRecentType","RecentType","default","openChannel","taskComments","NewMessageManager","getChatId","getParentChatId","getChat","parent_chat_id","getChatType","getRecentTypes","recentConfig","sections","isLinesChat","lines","isChannelChat","channelTypes","isUserInChat","chatUsers","userInChat","isChannelListEvent","is_shared_event","needToSkipMessageEvent","getAddActions","recentTypes","recentType","RecentUpdateManager","setLastMessageInfo","getDialogId","getLastMessageId","lastMessage","lastChannelPost","buildRecentItem","newRecentItem","recentItem","isFakeElement","isBirthdayPlaceholder","liked","RecentPullHandler","addActions","action","isOwnLike","isOwnLastMessage","handleChatPin","handleChatHide","Utils","getUuidV4","handleRecentUpdate","newLastMessageId","RecentUnreadPullHandler","isUndefined","recentList","NotificationPullHandler","store","updateCounterDebounced","Runtime","debounce","updateCounter","getSubscriptionType","handleNotifyAdd","onlyFlash","handleNotifyConfirm","handleNotifyRead","read","handleNotifyUnread","handleNotifyReadAll","excludeIds","newCounter","handleNotifyDelete","idsToDelete","keys","Number","parseInt","SidebarPullHandler","getMembersCountFromStore","usersToAdd","filter","handleTaskAdd","isSidebarInited","link","tasks","handleTaskUpdate","handleTaskDelete","linkId","handleCalendarAdd","meetings","handleCalendarUpdate","handleCalendarDelete","handleUrlAdd","links","handleUrlDelete","handleMessageFavoriteAdd","favorites","handleMessageFavoriteDelete","handleFileAdd","group","SidebarDetailBlock","fileUnsorted","handleFileDelete","isNumber","sidebarFileId","fileId","handleChangeMultidialogSessionsLimit","limit","handleAddMultidialog","multidialog","count","isSupport","deleteUnreadSupportChats","handleChangeMultidialogStatus","bot","setUnreadSupportTickets","isInited","setFiles","notCounter","oldMultidialog","status","areFilesMigrated","state","sidebar","isFilesMigrated","NotifierPullHandler","lastNotificationId","extraData","MessageNotifierManager","handleIncomingMessage","toString","isImportant","isLines","handleIncomingNotification","notificationId","isSilent","silent","callIsActive","hasCurrentCall","screenSharingIsActive","hasCurrentScreenSharing","areNotificationsOpen","UserType","isLinesChatOpen","importantFor","messageParams","isNotificationDisabled","isMuted","muteList","Settings","UserStatus","dnd","isDesktopChatWindow","isDesktopActive","rawLastNotificationId","LocalStorageManager","get","LocalStorageKey","WRITE_TO_STORAGE_TIMEOUT","clearTimeout","writeToStorageTimeout","setTimeout","set","applicationData","getApplicationData","settings","server_time_ago","OnlinePullHandler","handleUserStatus","userInfo","last_activity_date","CounterPullHandler","commentCounter","handleUnreadMessage","handleUnreadMessageChat","counterType","CounterType","openline","payload","counters","recentSection","sectionConfig","isInRecentCollection","collectionGetter","setUnloadedCounterAction","section","handlers","PromotionPullHandler","handlePromotionUpdated","PromoManager","onPromotionUpdated","AnchorPullHandler","handleAddAnchor","anchor","handleDeleteAnchor","handleDeleteAnchors","chatIds","handleDeleteChatAnchors","StickersPullHandler","handleStickerRecentDelete","packType","packId","handleStickerRecentDeleteAll","handleStickerPackAdd","pack","handleStickerPackLink","handleStickerPackDelete","handleStickerPackUnlink","handleStickerPackRename","handleStickerAdd","handleStickerDelete"],"mappings":"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"}