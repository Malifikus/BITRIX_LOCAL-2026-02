this.BX=this.BX||{};(function(e,s,i){"use strict";var t=babelHelpers.classPrivateFieldLooseKey("application");var a=babelHelpers.classPrivateFieldLooseKey("authContainerNode");var o=babelHelpers.classPrivateFieldLooseKey("isQrAvailable");var r=babelHelpers.classPrivateFieldLooseKey("isStorePasswordAvailable");var l=babelHelpers.classPrivateFieldLooseKey("isCaptchaAvailable");var c=babelHelpers.classPrivateFieldLooseKey("qrText");var n=babelHelpers.classPrivateFieldLooseKey("qrConfig");var b=babelHelpers.classPrivateFieldLooseKey("focusInput");var h=babelHelpers.classPrivateFieldLooseKey("initVueApp");class d{constructor(e){Object.defineProperty(this,h,{value:p});Object.defineProperty(this,t,{writable:true,value:void 0});Object.defineProperty(this,a,{writable:true,value:void 0});Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,r,{writable:true,value:void 0});Object.defineProperty(this,l,{writable:true,value:void 0});Object.defineProperty(this,c,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,a)[a]=e.authContainerNode;babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e.isQrAvailable==="Y";babelHelpers.classPrivateFieldLooseBase(this,r)[r]=e.isStorePasswordAvailable==="Y";babelHelpers.classPrivateFieldLooseBase(this,l)[l]=e.isCaptchaAvailable==="Y";babelHelpers.classPrivateFieldLooseBase(this,c)[c]=e.qrText||"";babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.qrConfig||"";babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.focusInput||"";if(!s.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,a)[a])){return}babelHelpers.classPrivateFieldLooseBase(this,h)[h]()}}function p(){const e=this;babelHelpers.classPrivateFieldLooseBase(this,t)[t]=i.BitrixVue.createApp({name:"SystemAuthAuthorize",data(){return{isWaiting:false,authContainerNode:babelHelpers.classPrivateFieldLooseBase(this.getApplication(),a)[a],isQrAvailable:babelHelpers.classPrivateFieldLooseBase(this.getApplication(),o)[o],isStorePasswordAvailable:babelHelpers.classPrivateFieldLooseBase(this.getApplication(),r)[r],isCaptchaAvailable:babelHelpers.classPrivateFieldLooseBase(this.getApplication(),l)[l],focusInput:babelHelpers.classPrivateFieldLooseBase(this.getApplication(),b)[b],qrText:babelHelpers.classPrivateFieldLooseBase(this.getApplication(),c)[c],qrConfig:babelHelpers.classPrivateFieldLooseBase(this.getApplication(),n)[n],isFormBlockVisible:true,isCaptchaBlockVisible:false}},beforeCreate(){this.$bitrix.Application.set(e)},mounted(){BX.UI.Hint.init(this.authContainerNode);const e=document.forms.form_auth[this.focusInput];e==null?void 0:e.focus();if(this.isQrAvailable){this.initQrCode()}},methods:{onButtonClick(e){if(this.isCaptchaAvailable&&!this.isCaptchaBlockVisible){e.preventDefault();this.showCaptchaBlock()}else{this.isWaiting=true}},showCaptchaBlock(){this.isFormBlockVisible=false;this.isCaptchaBlockVisible=true},initQrCode(){new QRCode("bx_auth_qr_code",{text:this.qrText,width:220,height:220,colorDark:"#000000",colorLight:"#ffffff"});if(!this.qrConfig){return}this.qrCodeSuccessIcon=this.authContainerNode.querySelector(".intranet-qr-scan-form__code-overlay");const e=new BX.PullClient;e.subscribe({moduleId:"main",command:"qrAuthorize",callback:e=>{if(e.token){this.showQrCodeSuccessIcon();s.ajax.runAction("main.qrcodeauth.authenticate",{data:{token:e.token,remember:this.isStorePasswordAvailable?1:0}}).then((s=>{this.hideQrCodeSuccessIcon();if(s.status==="success"){window.location=e.redirectUrl!==""?e.redirectUrl:window.location}})).catch((e=>console.error(e)))}}});e.start(this.qrConfig)},showQrCodeSuccessIcon(){if(!s.Type.isDomNode(this.qrCodeSuccessIcon)){return}s.Dom.addClass(this.qrCodeSuccessIcon,"intranet-qr-scan-form__code-overlay--active")},hideQrCodeSuccessIcon(){if(!s.Type.isDomNode(this.qrCodeSuccessIcon)){return}s.Dom.removeClass(this.qrCodeSuccessIcon,"intranet-qr-scan-form__code-overlay--active")},getApplication(){return this.$bitrix.Application.get()}}});babelHelpers.classPrivateFieldLooseBase(this,t)[t].mount(babelHelpers.classPrivateFieldLooseBase(this,a)[a])}e.SystemAuthAuthorize=d})(this.BX.Intranet=this.BX.Intranet||{},BX,BX.Vue3);
//# sourceMappingURL=script.map.js