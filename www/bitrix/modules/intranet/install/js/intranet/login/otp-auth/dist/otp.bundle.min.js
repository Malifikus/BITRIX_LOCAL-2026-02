this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(t,e,n,i,s){"use strict";const o={components:{Headline:i.Headline},props:{authUrl:{type:String,required:true},authOtpHelpLink:{type:String,default:""},authLoginUrl:{type:String,default:""},rememberOtp:{type:Boolean,default:false},captchaCode:{type:String,default:""},notShowLinks:{type:Boolean,default:false},isBitrix24:{type:Boolean,default:false},errorMessage:{type:String,default:null}},data(){return{isWaiting:false,csrfToken:null}},mounted(){if(this.$refs.modalInput){this.$refs.modalInput.focus()}},methods:{onSubmitForm(){this.isWaiting=true;this.$emit("form-submit")}},template:`\n\t\t<form name="form_auth" method="post" target="_top" :action="authUrl">\n\t\t\t<input type="hidden" name="AUTH_FORM" value="Y" />\n\t\t\t<input type="hidden" name="TYPE" value="OTP" />\n\t\t\t<input type="hidden" name="sessid" :value="this.$Bitrix.Loc.getMessage('bitrix_sessid')" />\n\n\t\t\t<div class="intranet-island-otp-push-legacy-otp__wrapper">\n\t\t\t\t<Headline size='lg' class="intranet-form-title">\n\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_TITLE') }}\n\t\t\t\t</Headline>\n\t\t\t\t<div class="intranet-login-enter-form intranet-logging-in__login-form">\n\t\t\t\t\t<div v-if="errorMessage" class="intranet-login-error-block" v-html="errorMessage"></div>\n\t\t\t\t\t<div class="intranet-login-enter-form__login-wrapper">\n\t\t\t\t\t\t<div class="intranet-text-input intranet-login-enter-form__login">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\tname="USER_OTP"\n\t\t\t\t\t\t\t\tclass="ui-ctl-element intranet-text-input__field"\n\t\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\t\tvalue=""\n\t\t\t\t\t\t\t\tautocomplete="off"\n\t\t\t\t\t\t\t\t:placeholder="this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_PLACEHOLDER')"\n\t\t\t\t\t\t\t\tref="modalInput"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\n\t\t\t\t\t\t<template v-if="captchaCode">\n\t\t\t\t\t\t\t<Headline size='sm' class="intranet-form-title --vertical-padding">\n\t\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_CAPTCHA_PROMT') }}\n\t\t\t\t\t\t\t</Headline>\n\t\t\t\t\t\t\t<div class="intranet-text-captcha_item">\n\t\t\t\t\t\t\t\t<input type="hidden" name="captcha_sid" :value="captchaCode" />\n\t\t\t\t\t\t\t\t<img :src="'/bitrix/tools/captcha.php?captcha_sid=' + captchaCode" width="180" height="40" alt="CAPTCHA" />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="intranet-text-input intranet-login-enter-form__login">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\t\t\tname="captcha_word"\n\t\t\t\t\t\t\t\t\t:placeholder="this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_CAPTCHA_PROMT')"\n\t\t\t\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\t\t\t\tvalue=""\n\t\t\t\t\t\t\t\t\tautocomplete="off"\n\t\t\t\t\t\t\t\t\tclass="ui-ctl-element intranet-text-input__field"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="intranet-text-btn intranet-text-btn__reg ui-btn ui-btn-lg ui-btn-success"\n\t\t\t\t\t\ttype="submit"\n\t\t\t\t\t\t@click="onSubmitForm"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="intranet-text-btn__content-wrapper">\n\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_CONTINUE_BUTTON') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="intranet-text-btn__spinner" v-show="isWaiting"></span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<div v-if="rememberOtp" class="intranet-base-checkbox intranet-password-enter-form__remember-me">\n\t\t\t\t\t\t<input type="checkbox" id="OTP_REMEMBER" name="OTP_REMEMBER" value="Y" class="login-checkbox-user-remember"/>\n\t\t\t\t\t\t<label for="OTP_REMEMBER" class="login-item-checkbox-label">&nbsp;\n\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage("INTRANET_AUTH_OTP_REMEMBER_ME") }}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Teleport to=".intranet-body__footer-right">\n\t\t\t\t<button class="intranet-help-widget intranet-page-base__help">\n\t\t\t\t\t<i class="ui-icon-set intranet-help-widget__icon"></i>\n\t\t\t\t\t<a class="intranet-help-widget__text" :href="authOtpHelpLink">\n\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_HELP') }}\n\t\t\t\t\t</a>\n\t\t\t\t</button>\n\t\t\t</Teleport>\n\n\t\t\t<Teleport to=".intranet-body__header-right" v-if="!notShowLinks && !isBitrix24">\n\t\t\t\t<div class="intranet-text-btn intranet-text-btn--auth">\n\t\t\t\t\t<a class="intranet-text-btn-link" :href="authLoginUrl" rel="nofollow">\n\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_LINK') }}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</Teleport>\n\t\t</form>\n\t`};const a={components:{Headline:i.Headline},props:{captchaCode:{type:String,default:""}},data(){return{isWaiting:false}},computed:{getCaptchaSrc(){return`/bitrix/tools/captcha.php?captcha_sid=${this.captchaCode}`}},methods:{onSubmitForm(){this.isWaiting=true}},template:`\n\t\t<div class="intranet-island-otp-captcha__wrapper">\n\t\t\t<Headline size='md' class="intranet-form-add-block__headline --margin">\n\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_CAPTCHA_PROMT') }}\n\t\t\t</Headline>\n\t\t\t<div class="intranet-text-captcha_item">\n\t\t\t\t<input type="hidden" name="captcha_sid" :value="captchaCode" class="login-inp"/>\n\t\t\t\t<img :src="getCaptchaSrc" width="180" height="40" alt="CAPTCHA"/>\n\t\t\t</div>\n\t\t\t<div class="intranet-text-input intranet-login-enter-form__login">\n\t\t\t\t<input\n\t\t\t\t\ttype="text"\n\t\t\t\t\tname="captcha_word"\n\t\t\t\t\t:placeholder="this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_CAPTCHA_PROMT')"\n\t\t\t\t\tmaxlength="50"\n\t\t\t\t\tvalue=""\n\t\t\t\t\tclass="ui-ctl-element intranet-text-input__field"\n\t\t\t\t/>\n\t\t\t</div>\n\t\n\t\t\t<button\n\t\t\t\tclass="intranet-text-btn ui-btn ui-btn-lg ui-btn-success --wide"\n\t\t\t\ttype="submit"\n\t\t\t\t@click="onSubmitForm"\n\t\t\t>\n\t\t\t\t<span class="intranet-text-btn__content-wrapper">\n\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_CONTINUE_BUTTON') }}\n\t\t\t\t</span>\n\t\t\t\t<span class="intranet-text-btn__spinner" v-show="isWaiting"></span>\n\t\t\t</button>\n\t\t</div>\n\t`};class r{static sendAuthSms(){return n.ajax.runAction("intranet.v2.Otp.sendAuthSms",{})}static sendMobilePush(t){return n.ajax.runAction("intranet.v2.Otp.sendMobilePush",{data:{channelTag:t}})}}const l={components:{Captcha:a,Headline:i.Headline},props:{pushOtpConfig:{type:Object,default:null},authUrl:{type:String,required:true},rememberOtp:{type:Boolean,default:false},captchaCode:{type:String,default:""},userDevice:{type:Object,default:null},errorMessage:{type:String,default:null},isAlternativeMethodsAvailable:{type:Boolean,default:false}},data(){return{isPushBlockVisible:true,isCaptchaBlockVisible:false,isUserDeviceVisible:Object.keys(this.userDevice).length>0,isPushDisabled:true,cooldownSecondsLeft:0,cooldownIntervalId:null}},computed:{deviceIconClass(){return`intranet-island-otp__device-icon--${this.userDevice.icon}`},isCountdownVisible(){return this.isPushDisabled&&this.cooldownSecondsLeft>0}},mounted(){if(this.pushOtpConfig){this.initPushOtp()}const t=this.readCooldownSecondsLeft();if(t>0){this.startCooldown(t,false)}else if(this.wasCooldownInitialized()){this.isPushDisabled=false;this.cooldownSecondsLeft=0;this.clearCooldownDeadline()}else{const t=this.getCooldownSeconds();if(t>0){this.startCooldown(t)}else{this.isPushDisabled=false;this.cooldownSecondsLeft=0}}s.sendData({tool:"security",category:"fa_auth_form",event:"show"})},beforeUnmount(){this.stopCooldownTimer()},methods:{repeatPush(){if(this.isPushDisabled||!this.pushOtpConfig){return}r.sendMobilePush(this.pushOtpConfig.channelTag).then((()=>{this.startCooldown(this.getCooldownSeconds())})).catch((()=>{this.startCooldown(this.getCooldownSeconds())}))},getCooldownSeconds(){var t;const e=5;const n=Number((t=this.pushOtpConfig)==null?void 0:t.cooldownSeconds);return Number.isFinite(n)&&n>0?Math.floor(n):e},startCooldown(t,e=true){const n=Number(t);if(!n||n<=0){this.stopCooldownTimer();this.isPushDisabled=false;this.cooldownSecondsLeft=0;this.clearCooldownDeadline();return}this.cooldownSecondsLeft=Math.floor(n);this.isPushDisabled=true;if(e){this.saveCooldownDeadline(this.cooldownSecondsLeft)}this.markCooldownInitialized();this.stopCooldownTimer();this.cooldownIntervalId=setInterval((()=>{if(this.cooldownSecondsLeft<=1){this.stopCooldownTimer();this.cooldownSecondsLeft=0;this.isPushDisabled=false;this.clearCooldownDeadline();return}this.cooldownSecondsLeft-=1}),1e3)},stopCooldownTimer(){if(this.cooldownIntervalId){clearInterval(this.cooldownIntervalId);this.cooldownIntervalId=null}},getCooldownStorageKey(){var t,e;const n=(t=(e=this.pushOtpConfig)==null?void 0:e.channelTag)!=null?t:"default";return`intranet:push-otp:cooldown:${n}`},getCooldownInitKey(){return`${this.getCooldownStorageKey()}:initialized`},isStorageAvailable(){try{var t;return Boolean((t=window)==null?void 0:t.localStorage)}catch{return false}},markCooldownInitialized(){if(!this.isStorageAvailable()){return}try{window.localStorage.setItem(this.getCooldownInitKey(),"1")}catch(t){console.error(t)}},wasCooldownInitialized(){if(!this.isStorageAvailable()){return false}try{return window.localStorage.getItem(this.getCooldownInitKey())==="1"}catch(t){console.error(t)}return false},saveCooldownDeadline(t){if(!this.isStorageAvailable()){return}const e=Date.now()+Number(t)*1e3;try{window.localStorage.setItem(this.getCooldownStorageKey(),String(e))}catch(t){console.error(t)}},readCooldownSecondsLeft(){if(!this.isStorageAvailable()){return 0}try{const t=Number(window.localStorage.getItem(this.getCooldownStorageKey()));if(!Number.isFinite(t)){return 0}const e=t-Date.now();return e>0?Math.ceil(e/1e3):0}catch(t){console.error(t)}return 0},clearCooldownDeadline(){if(!this.isStorageAvailable()){return}try{window.localStorage.removeItem(this.getCooldownStorageKey())}catch(t){console.error(t)}},showAlternatives(){if(this.isAlternativeMethodsAvailable){this.$emit("show-alternatives")}else{this.$emit("show-recover-access")}s.sendData({tool:"security",category:"fa_auth_form",event:"other_type_click"})},showCaptcha(){this.isPushBlockVisible=false;this.isCaptchaBlockVisible=true},initPushOtp(){const t=window.BX;if(!t||!this.pushOtpConfig){return}const e=new t.PullClient;e.subscribe({moduleId:"security",command:"pushOtpCode",callback:t=>{if(t.code){const e=document.forms.form_auth;if(e&&e.USER_OTP){e.USER_OTP.value=t.code;if(this.captchaCode){this.showCaptcha()}else{e.submit()}}}}});e.start(this.pushOtpConfig.pullConfig)}},template:`\n\t\t<form name="form_auth" method="post" target="_top" :action="authUrl">\n\t\t\t<input type="hidden" name="AUTH_FORM" value="Y" />\n\t\t\t<input type="hidden" name="TYPE" value="OTP" />\n\t\t\t<input type="hidden" name="USER_OTP" />\n\t\t\t<input type="hidden" name="sessid" :value="this.$Bitrix.Loc.getMessage('bitrix_sessid')"/>\n\n\t\t\t<div v-show="isPushBlockVisible" class="intranet-island-otp-push__wrapper">\n\t\t\t\t<Headline size='lg' class="intranet-form-title">\n\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_CONFIRM_AUTH') }}\n\t\t\t\t</Headline>\n\t\t\t\t<div v-if="errorMessage" class="intranet-otp-error-block" v-html="errorMessage"></div>\n\t\t\t\t<div class="intranet-island-otp-push__main-content">\n\t\t\t\t\t<div class="intranet-island-otp-push__description">\n\t\t\t\t\t\t<span>{{ this.$Bitrix.Loc.getMessage("INTRANET_AUTH_OTP_PUSH_SENDED") }}</span>\n\t\t\t\t\t\t<span>{{ this.$Bitrix.Loc.getMessage("INTRANET_AUTH_OTP_CONFIRM_TEXT") }}</span>\n\t\t\t\t\t\t<div class="intranet-island-otp-push__arrow"\n\t\t\t\t\t\t\t :class="{ '--low': !isUserDeviceVisible }"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="isUserDeviceVisible" class="intranet-island-otp__device-row">\n\t\t\t\t\t\t\t<div class="intranet-island-otp__device-icon"\n\t\t\t\t\t\t\t\t :class="deviceIconClass"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t  \t{{ this.userDevice.model }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="rememberOtp" class="intranet-base-checkbox intranet-password-enter-form__remember-me">\n\t\t\t\t\t\t\t<input type="checkbox" id="OTP_REMEMBER" name="OTP_REMEMBER" value="Y" class="login-checkbox-user-remember"/>\n\t\t\t\t\t\t\t<label for="OTP_REMEMBER" class="login-item-checkbox-label">\n\t\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage("INTRANET_AUTH_OTP_REMEMBER_ME") }}\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="intranet-island-otp-push__mobile"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="intranet-island-otp-push-links__wrapper">\n\t\t\t\t\t<span \n\t\t\t\t\t\tclass="intranet-island-otp-push__link --repeat-push" \n\t\t\t\t\t\t:class="{ '--disabled': isPushDisabled }"\n\t\t\t\t\t\t@click="repeatPush"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_RESEND_PUSH') }}\n\t\t\t\t\t\t<template v-if="isCountdownVisible">\n\t\t\t\t\t\t\t({{ cooldownSecondsLeft }})\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="intranet-island-otp-push__link" @click="showAlternatives">\n\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_ALTERNATIVE_WAY') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<template v-if="captchaCode">\n\t\t\t\t<captcha\n\t\t\t\t\tv-show="isCaptchaBlockVisible"\n\t\t\t\t\t:captchaCode="captchaCode"\n\t\t\t\t></captcha>\n\t\t\t</template>\n\t\t</form>\n\t`};const c={components:{Headline:i.Headline},props:{canLoginBySms:{type:Boolean,default:false},isRecoveryCodesEnabled:{type:Boolean,default:false}},mounted(){this.sendAnalytics("other_type_show")},methods:{showPushOtp(){this.$emit("back-to-push");this.sendAnalytics("choose_auth_type","app")},showSms(){this.$emit("show-sms");this.sendAnalytics("choose_auth_type","sms")},showRecoveryCodes(){this.$emit("show-recovery-codes");this.sendAnalytics("choose_auth_type","code")},showRecoverAccess(){this.$emit("show-recover-access")},sendAnalytics(t,e=null){const n={tool:"security",category:"fa_auth_form",event:t};if(e){n.type=e}s.sendData(n)}},template:`\n\t\t<div class="intranet-island-otp-push-alternative__wrapper">\n\t\t\t<div @click="showPushOtp" class="intranet-back-button">\n\t\t\t\t<i class="ui-icon-set --arrow-left-l intranet-back-button__arrow --alternative"></i>\n\t\t\t</div>\n\t\t\t<Headline size='lg' class="intranet-form-title --padding">\n\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_ALTERNATIVE_WAY_TITLE') }}\n\t\t\t</Headline>\n\n\t\t\t<div class="intranet-island-otp-push-alternative-items__wrapper">\n\t\t\t\t<div v-if="canLoginBySms" class="intranet-island-otp-push-alternative__item" @click="showSms">\n\t\t\t\t\t<i class="ui-icon-set --o-sms intranet-island-otp-push-alternative-item__icon"></i>\n\t\t\t\t\t<span>{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_SMS') }}</span>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="isRecoveryCodesEnabled" class="intranet-island-otp-push-alternative__item" @click="showRecoveryCodes">\n\t\t\t\t\t<i class="ui-icon-set --key intranet-island-otp-push-alternative-item__icon"></i>\n\t\t\t\t\t<span>{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_RECOVERY_CODES') }}</span>\n\t\t\t\t</div>\n\t\t\t\t<span class="intranet-island-otp-push__link --gray --underline" @click="showRecoverAccess">\n\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_RECOVER_ACCESS_TITLE') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`};const d="click";const h="value-paste";const u="digit-change";const p={props:{digitValue:{type:String,default:"",validator:t=>/\d/.test(t)||t===""},isFocused:{type:Boolean,default:false},error:{type:String,required:true}},emits:[d,h,u],computed:{inputExtraClasses(){return{"intranet-digit-input--filled":this.digitValue!==""}},inputClass(){return`intranet-digit-input${this.error?" --error":""}`}},watch:{isFocused(t){if(t){this.$el.focus()}else{this.$el.blur()}}},methods:{onClick(){this.$emit(d)},deselectInputContent(){this.$el.selectionStart=this.$el.selectionEnd},onPaste(t){const e=(t.clipboardData||window.clipboardData).getData("text");this.$emit(h,e)},onKeyDown(t){const e=t.ctrlKey||t.altKey||t.metaKey;if(!e){t.preventDefault()}if(/\d/.test(t.key)||t.key==="Backspace"){this.$emit(u,t.key==="Backspace"?"":t.key)}}},template:`\n\t\t<input\n\t\t\ttype="text"\n\t\t\tmaxlength="1"\n\t\t\tinputmode="numeric"\n\t\t\t:class="inputClass"\n\t\t\t:class="inputExtraClasses"\n\t\t\t:value="digitValue"\n\t\t\t@click="onClick"\n\t\t\t@keydown="onKeyDown"\n\t\t\t@paste.prevent="onPaste"\n\t\t>\n\t`};const m="code-change";const g="code-complete";const v={components:{DigitInput:p},props:{code:{type:String,required:true},error:{type:String,required:true},isPhoneCode:{type:Boolean,default:false}},emits:[m,g],data(){return{codeArray:[],focusIndex:-1}},computed:{codeLength(){return this.isPhoneCode?6:8},isCodeComplete(){return this.codeArray.length===this.codeLength&&this.codeArray.every((t=>t!==""))}},watch:{code(t){this.fillCodeArrayFromCode(t)}},created(){this.fillCodeArrayFromCode(this.code)},mounted(){this.focusIndex=0},methods:{fillCodeArrayFromCode(t){for(let e=0;e<this.codeLength;e++){this.codeArray[e]=t.length>e?t[e]:""}},onDigitChange(t,e){this.updateCodeDigit(t,e);if(e===""){this.focusPreviousDigitInput(t)}else{this.focusNextDigitInput(t)}const n=this.codeArray.join("");this.$emit(m,n);if(this.isCodeComplete){this.$emit(g,n)}},updateCodeDigit(t,e){if(t>=0&&t<this.codeArray.length){this.codeArray[t]=e}},focusPreviousDigitInput(t){const e=t-1;if(e>=0&&this.isNextDigitEmpty(t)){this.focusIndex=e}},isNextDigitEmpty(t){let e=t+1;if(e>=this.codeLength){e=this.codeLength-1}return this.codeArray[e]===""},focusNextDigitInput(t){const e=t+1;if(this.isPreviousDigitEmpty(t)){this.focusIndex=this.calculateLastEmptyDigitIndex()}else if(e<this.codeLength){this.focusIndex=e}},isPreviousDigitEmpty(t){let e=t-1;if(e<0){e=0}return this.codeArray[e]===""},calculateLastEmptyDigitIndex(){const t=this.findLastNonEmptyDigitIndex();if(t<0){return 1}const e=t+1;return e<this.codeLength-1?e+1:e},findLastNonEmptyDigitIndex(){if(this.codeArray[0]===""){return-1}for(let t=0;t<this.codeLength;t++){if(this.codeArray[t]===""){return t>0?t-1:0}}return this.codeLength-1},isShiftedInput(t){return this.isPhoneCode&&t===this.codeLength/2},onPaste(t){if(this.isValidNumericCode(t)){this.fillCodeArrayFromCode(t)}else if(this.isSingleDigit(t)&&this.focusIndex>=0){this.codeArray[this.focusIndex]=t}const e=this.codeArray.join("");this.$emit(m,e);if(this.isCodeComplete){this.$emit(g,e)}},isValidNumericCode(t){const e=new RegExp(`^[0-9]{${this.codeLength}}$`);return e.test(t)},isSingleDigit(t){return/^\d$/.test(t)},onClick(t){this.focusIndex=t}},template:`\n\t\t<div class="intranet-verification-code">\n\t\t\t<digit-input\n\t\t\t\tv-for="digitPos in codeLength"\n\t\t\t\tclass="intranet-verification-code__digit"\n\t\t\t\t:class="{ 'intranet-verification-code__digit--shifted': isShiftedInput(digitPos - 1) }"\n\t\t\t\t:key="digitPos"\n\t\t\t\t:is-focused="focusIndex === (digitPos - 1)"\n\t\t\t\t:digit-value="codeArray[digitPos - 1] ?? ''"\n\t\t\t\t:error="error"\n\t\t\t\t@value-paste="onPaste"\n\t\t\t\t@click="onClick(digitPos - 1)"\n\t\t\t\t@digit-change="onDigitChange(digitPos - 1, $event)"\n\t\t\t></digit-input>\n\t\t</div>\n\t`};const f={components:{VerificationCode:v,Captcha:a,Headline:i.Headline},props:{authUrl:{type:String,default:""},captchaCode:{type:String,default:""},maskedUserAuthPhoneNumber:{type:String,default:""},errorMessage:{type:String,default:null}},data(){return{isWaiting:false,code:"",isSmsBlockVisible:true,isCaptchaBlockVisible:false,countdown:null,countdownInterval:null}},computed:{phoneMessage(){return this.$Bitrix.Loc.getMessage("INTRANET_AUTH_OTP_SMS_SENDED",{"#NUMBER#":`<strong>${this.maskedUserAuthPhoneNumber}</strong>`})},isResendSmsAvailable(){return this.countdown&&this.countdown<=0},isCountdownVisible(){return this.countdown&&this.countdown>0}},mounted(){this.sendSmsCode();this.sendAnalytics("sms_show")},methods:{onSubmitForm(){if(this.captchaCode){event.preventDefault();this.showCaptcha()}else{this.isWaiting=true;this.$emit("form-submit")}},async sendSmsCode(){await r.sendAuthSms().then((t=>{var e,i;this.countdown=n.Type.isNumber((e=t.data)==null?void 0:e.timeLeft)?(i=t.data)==null?void 0:i.timeLeft:0;this.startCountdownTimer()}),(t=>{var e,i;this.countdown=n.Type.isNumber((e=t.data)==null?void 0:e.timeLeft)?(i=t.data)==null?void 0:i.timeLeft:0;this.startCountdownTimer()})).catch((t=>console.error(t)))},async resendSendSmsCode(){this.sendAnalytics("sms_repeat_click");await this.sendSmsCode()},startCountdownTimer(){clearInterval(this.countdownInterval);this.countdownInterval=setInterval((()=>{this.countdown--;if(this.countdown<0){clearInterval(this.countdownInterval)}}),1e3)},onCodeChange(t){this.code=t},onCodeComplete(t){this.code=t;this.$nextTick((()=>{if(this.captchaCode){this.showCaptcha()}else{this.isWaiting=true;this.$emit("form-submit");if(this.$refs.authForm){this.$refs.authForm.submit()}}}))},showPushOtp(){this.$emit("clear-errors");this.$emit("back-to-push")},showCaptcha(){this.isSmsBlockVisible=false;this.isCaptchaBlockVisible=true},sendAnalytics(t){s.sendData({tool:"security",category:"fa_auth_form",event:t})}},template:`\n\t\t<form ref="authForm" name="form_auth" method="post" target="_top" :action="authUrl">\n\t\t\t<input type="hidden" name="AUTH_FORM" value="Y"/>\n\t\t\t<input type="hidden" name="TYPE" value="OTP"/>\n\t\t\t<input type="hidden" name="USER_OTP" :value="code"/>\n\t\t\t<input type="hidden" name="CURRENT_STEP" value="sms"/>\n\t\t\t<input type="hidden" name="sessid" :value="this.$Bitrix.Loc.getMessage('bitrix_sessid')"/>\n\n\t\t\t<div v-show="isSmsBlockVisible" class="intranet-island-otp-push-sms__wrapper">\n\t\t\t\t<div @click="showPushOtp" class="intranet-back-button">\n\t\t\t\t\t<i class="ui-icon-set --arrow-left-l intranet-back-button__arrow --smscode"></i>\n\t\t\t\t</div>\n\t\t\t\t<Headline size='lg' class="intranet-form-title --padding">\n\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_CONFIRM_LOGIN') }}\n\t\t\t\t</Headline>\n\t\t\t\t<span class="intranet-island-otp-push-sms__description">\n\t\t\t\t\t<div v-html="phoneMessage"></div>\n\t\t\t\t</span>\n\t\t\t\t<VerificationCode\n\t\t\t\t\t:code="code"\n\t\t\t\t\t:isPhoneCode=true\n\t\t\t\t\t:error="errorMessage"\n\t\t\t\t\t@code-change="onCodeChange"\n\t\t\t\t\t@code-complete="onCodeComplete"\n\t\t\t\t></VerificationCode>\n\t\t\t\t<div class="intranet-otp-error-block" v-html="errorMessage"></div>\n\n\t\t\t\t<div class="intranet-island-otp-push-sms__resend">\n\t\t\t\t\t<span v-if="isResendSmsAvailable" class="intranet-island-otp-push__link" @click="resendSendSmsCode">\n\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_SMS_RESEND') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span v-if="isCountdownVisible" class="intranet-island-otp-push-sms__countdown">\n\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_SMS_COUNTDOWN', {'#SEC#': this.countdown}) }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\n\t\t\t\t<button\n\t\t\t\t\tclass="intranet-text-btn intranet-text-btn__reg ui-btn ui-btn-lg ui-btn-success --wide"\n\t\t\t\t\ttype="submit"\n\t\t\t\t\t@click="onSubmitForm"\n\t\t\t\t>\n\t\t\t\t\t\t<span class="intranet-text-btn__content-wrapper">\n\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_CONTINUE_BUTTON') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t<span class="intranet-text-btn__spinner" v-show="isWaiting"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<template v-if="captchaCode">\n\t\t\t\t<captcha\n\t\t\t\t\tv-show="isCaptchaBlockVisible"\n\t\t\t\t\t:captchaCode="captchaCode"\n\t\t\t\t></captcha>\n\t\t\t</template>\n\t\t</form>\n\t`};const _="char-change";const C="value-paste";const y={props:{charValue:{type:String,default:""},error:{type:String,default:""},isFocused:{type:Boolean,default:false}},emits:[_,C],data(){return{inputValue:this.charValue}},computed:{inputClass(){return`intranet-char-input${this.error?" --error":""}`}},watch:{charValue(t){this.inputValue=t},isFocused(t){if(t){this.$nextTick((()=>{var t,e;(t=this.$refs.input)==null?void 0:t.focus();(e=this.$refs.input)==null?void 0:e.select()}))}}},methods:{onInput(t){const e=t.target.value;const n=e.slice(-1);if(this.isValidCharacter(n)){this.inputValue=n;this.$emit(_,this.inputValue)}},onPaste(t){t.preventDefault();const e=t.clipboardData.getData("text");this.$emit(C,e)},onKeyDown(t){if(!this.isAllowedKey(t)){t.preventDefault();return}if(t.key==="Backspace"){this.inputValue="";this.$emit(_,"")}},isValidCharacter(t){return/^[\dA-Za-z]$/.test(t)},isAllowedKey(t){const e=t.key;if(e==="Backspace"){return true}return this.isValidCharacter(e)},onClick(){this.$emit("click")}},template:`\n\t\t<input\n\t\t  ref="input"\n\t\t  type="text"\n\t\t  :class="inputClass"\n\t\t  :value="inputValue"\n\t\t  maxlength="1"\n\t\t  @input="onInput"\n\t\t  @paste="onPaste"\n\t\t  @keydown="onKeyDown"\n\t\t  @click="onClick"\n\t\t/>\n\t`};const b="code-change";const T="code-complete";const w={components:{AlphanumericInput:y},props:{code:{type:String,required:true},codeLength:{type:Number,default:8},separatorPosition:{type:Number,default:4},separator:{type:String,default:"-"},error:{type:String,default:""}},emits:[b,T],data(){return{codeArray:[],focusIndex:-1}},computed:{isCodeComplete(){return this.codeArray.length===this.codeLength&&this.codeArray.every((t=>t!==""))}},watch:{code(t){this.fillCodeArrayFromCode(t)}},created(){this.fillCodeArrayFromCode(this.code)},mounted(){this.focusIndex=0},methods:{fillCodeArrayFromCode(t){const e=t.replace(this.separator,"");for(let t=0;t<this.codeLength;t++){this.codeArray[t]=e.length>t?e[t]:""}},onCharacterChange(t,e){this.updateCodeCharacter(t,e);if(e===""){this.focusPreviousInput(t)}else{this.focusNextInput(t)}const n=this.getFormattedCode();this.$emit(b,n);if(this.isCodeComplete){this.$emit(T,n)}},updateCodeCharacter(t,e){if(t>=0&&t<this.codeArray.length){this.codeArray[t]=e.toLowerCase()}},focusPreviousInput(t){const e=t-1;if(e>=0){this.focusIndex=e}},focusNextInput(t){const e=t+1;if(e<this.codeLength){this.focusIndex=e}},getFormattedCode(){const t=this.codeArray.join("");if(t.length>this.separatorPosition){return t.slice(0,Math.max(0,this.separatorPosition))+this.separator+t.slice(Math.max(0,this.separatorPosition))}return t},onPaste(t){const e=t.replaceAll(/[^\dA-Za-z]/g,"").toLowerCase();if(this.isValidRecoveryCode(e)){this.fillCodeArrayFromCode(e)}else if(this.isSingleCharacter(t)&&this.focusIndex>=0){this.codeArray[this.focusIndex]=t.toLowerCase()}const n=this.getFormattedCode();this.$emit(b,n);if(this.isCodeComplete){this.$emit(T,n)}},isValidRecoveryCode(t){const e=new RegExp(`^[a-zA-Z0-9]{${this.codeLength}}$`);return e.test(t)},isSingleCharacter(t){return/^[\dA-Za-z]$/.test(t)},onClick(t){this.focusIndex=t}},template:`\n\t\t<div class="intranet-verification-code">\n\t\t\t<alphanumeric-input\n\t\t\t\tv-for="charPos in codeLength"\n\t\t\t\tclass="intranet-verification-code__char"\n\t\t\t\t:key="charPos"\n\t\t\t\t:is-focused="focusIndex === (charPos - 1)"\n\t\t\t\t:error="error"\n\t\t\t\t:char-value="codeArray[charPos - 1] ?? ''"\n\t\t\t\t@value-paste="onPaste"\n\t\t\t\t@click="onClick(charPos - 1)"\n\t\t\t\t@char-change="onCharacterChange(charPos - 1, $event)"\n\t\t\t/>\n\t\t</div>\n\t`};const A={components:{RecoveryCodeInput:w,Captcha:a,Headline:i.Headline},props:{rootNode:{type:HTMLElement,default:null},authUrl:{type:String,required:true},captchaCode:{type:String,default:""},recoveryCodesHelpLink:{type:String,default:""},errorMessage:{type:String,default:null}},data(){return{isWaiting:false,recoveryCode:"",isRecoveryCodeBlockVisible:true,isCaptchaBlockVisible:false}},mounted(){BX.UI.Hint.init(this.rootNode);s.sendData({tool:"security",category:"fa_auth_form",event:"form_code_show"})},methods:{onSubmitForm(t){if(this.captchaCode){t.preventDefault();this.showCaptcha()}else{this.isWaiting=true;this.$emit("form-submit")}},onRecoveryCodeChange(t){this.recoveryCode=t},onRecoveryCodeComplete(t){this.recoveryCode=t;this.$nextTick((()=>{if(this.captchaCode){this.showCaptcha()}else{this.isWaiting=true;this.$emit("form-submit");if(this.$refs.authForm){this.$refs.authForm.submit()}}}))},showPushOtp(){this.$emit("clear-errors");this.$emit("back-to-push")},showCaptcha(){this.isRecoveryCodeBlockVisible=false;this.isCaptchaBlockVisible=true}},template:`\n\t\t<form ref="authForm" name="form_auth" method="post" target="_top" :action="authUrl">\n\t\t\t<input type="hidden" name="AUTH_FORM" value="Y" />\n\t\t\t<input type="hidden" name="TYPE" value="OTP"/>\n\t\t\t<input type="hidden" name="USER_OTP" :value="recoveryCode"/>\n\t\t\t<input type="hidden" name="CURRENT_STEP" value="recoveryCodes"/>\n\t\t\t<input type="hidden" name="sessid" :value="this.$Bitrix.Loc.getMessage('bitrix_sessid')"/>\n\n\t\t\t<div v-show="isRecoveryCodeBlockVisible" class="intranet-island-otp-push-recovery-codes__wrapper">\n\t\t\t\t<div @click="showPushOtp" class="intranet-back-button">\n\t\t\t\t\t<i class="ui-icon-set --arrow-left-l intranet-back-button__arrow --recovery"></i>\n\t\t\t\t</div>\n\n\t\t\t\t<Headline size='lg' class="intranet-form-title --padding">\n\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_CONFIRM_LOGIN') }}\n\t\t\t\t</Headline>\n\t\t\t\t<span class="intranet-island-otp-push-recovery-codes__description">\n\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_INPUT_RECOVERY_CODE') }}\n\t\t\t\t</span>\n\t\t\t\t<a class="intranet-island-otp-push__link --underline" :href="recoveryCodesHelpLink" target="_blank">\n\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_MORE') }}\n\t\t\t\t</a>\n\t\t\t\t<RecoveryCodeInput \n\t\t\t\t\t:code="recoveryCode"\n\t\t\t\t\t:error="errorMessage"\n\t\t\t\t\t@code-change="onRecoveryCodeChange"\n\t\t\t\t\t@code-complete="onRecoveryCodeComplete"\n\t\t\t\t></RecoveryCodeInput>\n\t\t\t\t<div class="intranet-otp-error-block" v-html="errorMessage"></div>\n\n\t\t\t\t<button\n\t\t\t\t\tclass="intranet-text-btn intranet-text-btn__reg ui-btn ui-btn-lg ui-btn-success --wide"\n\t\t\t\t\ttype="submit"\n\t\t\t\t\t@click="onSubmitForm($event)"\n\t\t\t\t>\n\t\t\t\t\t\t<span class="intranet-text-btn__content-wrapper">\n\t\t\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_CONTINUE_BUTTON') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t<span class="intranet-text-btn__spinner" v-show="isWaiting"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\n\t\t\t<template v-if="captchaCode">\n\t\t\t\t<captcha\n\t\t\t\t\tv-show="isCaptchaBlockVisible"\n\t\t\t\t\t:captchaCode="captchaCode"\n\t\t\t\t></captcha>\n\t\t\t</template>\n\t\t</form>\n\t`};const S={components:{Headline:i.Headline},props:{isAlternativeMethodsAvailable:{type:Boolean,default:false}},mounted(){s.sendData({tool:"security",category:"fa_auth_form",event:"restore_access_show"})},methods:{showAlternatives(){if(this.isAlternativeMethodsAvailable){this.$emit("show-alternatives")}else{this.$emit("back-to-push")}}},template:`\n\t\t<div class="intranet-island-otp-recover-access__wrapper">\n\t\t\t<Headline size='lg' class="intranet-form-title">\n\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_RECOVER_ACCESS_TITLE') }}\n\t\t\t</Headline>\n\t\t\t<div class="intranet-island-otp-recover-access__description --width">\n\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_RECOVER_ACCESS_TEXT') }}\n\t\t\t</div>\n\t\t\t<div class="intranet-island-revover-access-links__wrapper">\n\t\t\t\t<span class="intranet-island-recover-access__link" @click="showAlternatives">\n\t\t\t\t\t{{ this.$Bitrix.Loc.getMessage('INTRANET_AUTH_OTP_ALTERNATIVE_WAY') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`};const P={components:{LegacyOtp:o,PushOtp:l,AlternativeMethods:c,Sms:f,RecoveryCodes:A,RecoverAccess:S,Captcha:a},props:{rootNode:{type:HTMLElement,default:null},pushOtpConfig:{type:Object,default:null},authUrl:{type:String,default:""},authOtpHelpLink:{type:String,default:""},authLoginUrl:{type:String,default:""},rememberOtp:{type:Boolean,default:false},captchaCode:{type:String,default:""},notShowLinks:{type:Boolean,default:false},isBitrix24:{type:Boolean,default:false},canLoginBySms:{type:Boolean,default:false},isRecoveryCodesEnabled:{type:Boolean,default:false},maskedUserAuthPhoneNumber:{type:String,default:""},userDevice:{type:Object,default:null},currentStep:{type:String,default:""},recoveryCodesHelpLink:{type:String,default:""},errorMessageText:{type:String,default:null}},data(){let t="legacy";if(this.pushOtpConfig){var e;t=(e=this.currentStep)!=null?e:"push"}return{isWaiting:false,errorMessage:this.errorMessageText,currentAuthStep:t,isAlternativeMethodsAvailable:this.canLoginBySms||this.isRecoveryCodesEnabled}},computed:{currentComponent(){const t={legacy:"LegacyOtp",push:"PushOtp",alternative:"AlternativeMethods",sms:"Sms",recoveryCodes:"RecoveryCodes",recoverAccess:"RecoverAccess"};return t[this.currentAuthStep]||"LegacyOtp"}},methods:{onSubmitForm(){this.isWaiting=true},onShowAlternatives(){this.currentAuthStep="alternative"},onShowSms(){this.currentAuthStep="sms"},onShowRecoveryCodes(){this.currentAuthStep="recoveryCodes"},onShowRecoverAccess(){this.currentAuthStep="recoverAccess"},onBackToPush(){this.currentAuthStep="push"},onBackToLegacy(){this.currentAuthStep="legacy"},onClearErrors(){this.errorMessage=""}},template:`\n\t\t<component\n\t\t :is="currentComponent"\n\t\t :authUrl="authUrl"\n\t\t :authOtpHelpLink="authOtpHelpLink"\n\t\t :authLoginUrl="authLoginUrl"\n\t\t :rememberOtp="rememberOtp"\n\t\t :captchaCode="captchaCode"\n\t\t :notShowLinks="notShowLinks"\n\t\t :isBitrix24="isBitrix24"\n\t\t :canLoginBySms="canLoginBySms"\n\t\t :isRecoveryCodesEnabled="isRecoveryCodesEnabled"\n\t\t :maskedUserAuthPhoneNumber="maskedUserAuthPhoneNumber"\n\t\t :userDevice="userDevice"\n\t\t :pushOtpConfig="pushOtpConfig"\n\t\t :recoveryCodesHelpLink="recoveryCodesHelpLink"\n\t\t :errorMessage="errorMessage"\n\t\t :isAlternativeMethodsAvailable="isAlternativeMethodsAvailable"\n\t\t @form-submit="onSubmitForm"\n\t\t @show-alternatives="onShowAlternatives"\n\t\t @back-to-push="onBackToPush"\n\t\t @back-to-legacy="onBackToLegacy"\n\t\t @show-sms="onShowSms"\n\t\t @show-recovery-codes="onShowRecoveryCodes"\n\t\t @show-recover-access="onShowRecoverAccess"\n\t\t @clear-errors="onClearErrors"\n\t\t/>\n\t`};var L=babelHelpers.classPrivateFieldLooseKey("rootNode");var E=babelHelpers.classPrivateFieldLooseKey("application");class k{static init(t){babelHelpers.classPrivateFieldLooseBase(this,L)[L]=t.containerNode;if(!n.Type.isDomNode(babelHelpers.classPrivateFieldLooseBase(this,L)[L])){return}babelHelpers.classPrivateFieldLooseBase(this,E)[E]=e.BitrixVue.createApp(P,{rootNode:babelHelpers.classPrivateFieldLooseBase(this,L)[L],pushOtpConfig:t.pushOtpConfig,authUrl:t.authUrl,authOtpHelpLink:t.authOtpHelpLink,authLoginUrl:t.authLoginUrl,rememberOtp:t.rememberOtp,captchaCode:t.captchaCode,notShowLinks:t.notShowLinks,canLoginBySms:t.canLoginBySms,isRecoveryCodesEnabled:t.isRecoveryCodesEnabled,maskedUserAuthPhoneNumber:t.maskedUserAuthPhoneNumber,userDevice:t.userDevice,currentStep:t.currentStep,recoveryCodesHelpLink:t.recoveryCodesHelpLink,errorMessageText:t.errorMessage});babelHelpers.classPrivateFieldLooseBase(this,E)[E].mount(babelHelpers.classPrivateFieldLooseBase(this,L)[L])}}Object.defineProperty(k,L,{writable:true,value:void 0});Object.defineProperty(k,E,{writable:true,value:void 0});t.OtpAuth=k})(this.BX.Intranet.Login=this.BX.Intranet.Login||{},BX.Vue3,BX,BX.UI.System.Typography.Vue,BX.UI.Analytics);
//# sourceMappingURL=otp.bundle.map.js