(()=>{const e=e=>jn.require(e);const{selectWholeUserById:t}=e("intranet/statemanager/redux/slices/employees/selector");const{observeListChange:s}=e("intranet/statemanager/redux/slices/employees/observers/stateful-list-observer");const{usersUpserted:n,usersAdded:i}=e("intranet/statemanager/redux/slices/employees");const{usersUpserted:r,usersAdded:o}=e("statemanager/redux/slices/users");const{batchActions:a}=e("statemanager/redux/batched-actions");const l=e("statemanager/redux/store");const{dispatch:u}=l;const{makeLibraryImagePath:d,downloadImages:m}=e("asset-manager");const{Color:c,Component:h,Indent:p}=e("tokens");const{AnalyticsEvent:g}=e("analytics");const{Loc:y}=e("loc");const{TypeGenerator:f}=e("layout/ui/stateful-list/type-generator");const{StatefulList:S}=e("layout/ui/stateful-list");const{SearchLayout:I}=e("layout/ui/search-bar");const{StatusBlock:L}=e("ui-system/blocks/status-block");const{Box:b}=e("ui-system/layout/box");const{UserProfile:E}=e("user-profile");const{UserListSorting:v,UserListMoreMenu:T,UserListFilter:R,DepartmentButton:F}=e("intranet/user-list");const{ListItemType:C,ListItemsFactory:w}=e("intranet/simple-list/items");const{openIntranetInviteWidget:M}=e("intranet/invite-opener-new");const{Type:P}=e("type");const _=Application.getPlatform()==="android";const B=61;const D=2;const O=B+p.M.toNumber();class A extends LayoutComponent{constructor(e){super(e);this.stateFulListRef=null;this.tabViewRef=null;this.userListFilter=new R({presetId:R.presetType.default,department:this.initialDepartment});this.search=new I({layout:layout,disablePresets:true,id:"users",cacheId:`users_${env.userId}`,presetId:this.userListFilter.getPresetId(),onSearch:this.onSearch,onCancel:this.onSearch});this.sorting=new v({type:v.types.WORK_DEPARTMENT,isASC:false});this.moreMenu=new T(this.sorting.getType(),this.sorting.getOrder(),{onSelectSorting:this.onSelectSorting});this.state={sorting:this.sorting.getType(),order:this.sorting.getOrder(),department:this.initialDepartment,tabItems:[],areTabsAlreadyLoaded:false,selectedTab:null};this.scrollOffset=Animated.newCalculatedValue2D(0,O);if(this.scrollOffset.getValue2().diffClampWithConfig){this.departmentTop=this.scrollOffset.getValue2().diffClampWithConfig(-52,O,{direction:"reverse",option:"disableTopBounce"})}else{this.departmentTop=O}}onMomentumScrollEnd=()=>{const e=O;const t=this.departmentTop.getValue();if(t!==e&&t!==-52){if(t>-26){const s=t-e;this.stateFulListRef.scrollBy({x:0,y:s,animated:true,duration:350})}else{const e=-t;this.stateFulListRef.scrollBy({x:0,y:e,animated:true,duration:350})}}};onScrollEndDrag=()=>{this.scrollEndTimer=setTimeout(this.onMomentumScrollEnd,250)};onMomentumScrollBegin=()=>{clearTimeout(this.scrollEndTimer)};componentDidMount(){this.unsubscribeEmployeesObserver=s(l,this.userListFilter.getEmployeesFilter,this.onVisibleEmployeesChange);this.prefetchAssets();if(this.openInviteOnMount&&this.canInvite){M({analytics:(new g).setSection("userList"),parentLayout:layout,onInviteSentHandler:this.onInviteSuccess})}}componentWillUnmount(){if(this.unsubscribeEmployeesObserver){this.unsubscribeEmployeesObserver()}}prefetchAssets(){void m([d("install-desktop.svg","recommendation-box","intranet"),d("enable-2fa.svg","recommendation-box","intranet"),d("admin.svg","recommendation-box","intranet"),d("install-mobile.svg","recommendation-box","intranet"),d("empty_employee.svg","empty-states","intranet"),d("empty_search.svg","empty-states","intranet")])}get canInvite(){return BX.componentParameters.get("canInvite",false)}get openInviteOnMount(){return BX.componentParameters.get("openInviteOnMount",false)}get initialDepartment(){const e=BX.componentParameters.get("department",null);if(P.isNumber(e?.id)&&e.id>0){return e}return R.defaultDepartment}setSorting(e){if(this.sorting.getType()!==e){this.sorting.setType(e);this.moreMenu.setSelectedSorting(e);this.setState({sorting:e},(()=>this.stateFulListRef.reload()))}}setDepartment=e=>{if(this.userListFilter.getDepartment()!==e){this.userListFilter.setDepartment(e);this.setState({department:this.userListFilter.getDepartment()},(()=>this.stateFulListRef.reload()))}};render(){return b({backgroundColor:c.bgPrimary},this.renderTabs(),View({style:{flex:1}},this.renderList()),this.renderDepartmentButton())}renderList(){return new S({testId:"user-list",showAirStyle:true,layout:layout,menuButtons:this.getLayoutMenuButtons(),needInitMenu:true,typeGenerator:{generator:f.generators.bySelectedProperties,properties:["isCollaber","isExtranet","isAdmin","workPosition","employeeStatus","department"],callbacks:{}},actions:{loadItems:"intranetmobile.employees.getUserList"},actionParams:{loadItems:{filterParams:this.getSearchParams(),sortingParams:{type:this.state.sorting}}},actionCallbacks:{loadItems:this.onItemsLoaded},itemType:C.USER,itemFactory:w,itemDetailOpenHandler:this.openUserDetail,getItemCustomStyles:this.getItemCustomStyles,isShowFloatingButton:this.canInvite,onFloatingButtonClick:this.onFloatingButtonClick,onPanListHandler:this.onPanList,getEmptyListComponent:this.getEmptyListComponent,ref:this.onListRef,sortingConfig:this.sorting.getSortingConfig(),showEmptySpaceItem:true,pull:{shouldReloadDynamically:true},onBeforeItemsRender:this.onBeforeItemsRender,onScrollCalculated:this.state.itemsCount>4&&!_?{contentOffsetWithoutOverscroll:this.scrollOffset}:{},onMomentumScrollEnd:_?this.onMomentumScrollEnd:null,onMomentumScrollBegin:_?this.onMomentumScrollBegin:null,onScrollEndDrag:_?this.onScrollEndDrag:null})}renderDepartmentButton(){return View({style:{position:"absolute",top:this.departmentTop,width:"100%",alignItems:"center",paddingHorizontal:h.paddingLr.toNumber()}},new F({department:this.state.department,onSelect:this.setDepartment,layout:layout}))}renderTabs(){const{tabItems:e,selectedTab:t}=this.state;return TabView({style:{height:B,zIndex:D},params:{items:e},onTabSelected:e=>{if(t===e.id){return}this.userListFilter.setPresetId(e.id);this.setState({selectedTab:e.id},(()=>this.stateFulListRef.reload()))},ref:e=>{this.tabViewRef=e}})}getEmptyListComponent=()=>{const e=!(this.userListFilter.isDefault()||this.userListFilter.isEmpty());let t=y.getMessage("M_INTRANET_USER_LIST_EMPTY_EMPLOYEE_TITLE");let s=y.getMessage("M_INTRANET_USER_LIST_EMPTY_EMPLOYEE_DESCRIPTION");let n=d("empty_employee.svg","empty-states","intranet");if(e){t=y.getMessage("M_INTRANET_USER_LIST_SEARCH_EMPTY_TITLE");s=y.getMessage("M_INTRANET_USER_LIST_SEARCH_EMPTY_DESCRIPTION");n=d("empty_search.svg","empty-states","intranet")}return L({testId:"empty-state",title:t,description:s,emptyScreen:false,onRefresh:()=>{},image:Image({resizeMode:"contain",style:{width:202,height:172},svg:{uri:n}})})};getLayoutMenuButtons(){return[this.search.getSearchButton(),this.moreMenu.getMenuButton()]}getSearchParams(){return{department:this.userListFilter.getDepartment().id,presetId:this.userListFilter.getPresetId(),searchString:this.userListFilter.getSearchString()}}static get presetsIds(){return{company:"company",extranet:"extranet",fired:"fired",invited:"invited",waitConfirmation:"wait_confirmation"}}getItemCustomStyles=(e,t,s)=>{if(e.key==="EmptySpace_top"){const e=52;return{minHeight:e+p.XL.toNumber()}}return{}};onBeforeItemsRender=e=>e.map(((t,s)=>({...t,showBorder:s!==e.length-1,canInvite:this.canInvite})));onVisibleEmployeesChange=({moved:e,removed:t,added:s,created:n})=>{if(!this.stateFulListRef||this.stateFulListRef.isLoading()){setTimeout((()=>{this.onVisibleEmployeesChange({moved:e,removed:t,added:s,created:n})}),30);return}if(t.length>0){void this.removeEmployees(t);void this.#e(t)}if(s.length>0){void this.addOrRestoreEmployees(s)}if(e.length>0){void this.updateEmployees(e)}};removeEmployees(e){if(e.length>0){const t=e.map((({id:e})=>e));return this.stateFulListRef.deleteItem(t)}return Promise.resolve()}addOrRestoreEmployees(e){}updateEmployees(e){return this.stateFulListRef.updateItemsData(e)}#e(e=[]){const t=[R.presetsIds.invited,R.presetsIds.waitConfirmation];const s=new Set;t.forEach((e=>{const t=new R({presetId:e,department:this.userListFilter.getDepartment()});const n=t.getEmployeesFilter();const i=Array.isArray(n?.employeeStatus)?n.employeeStatus:[];i.forEach((e=>s.add(e)))}));const n=e.some((e=>e&&s.has(e.employeeStatus)));if(n){void this.stateFulListRef.reload()}}onSelectSorting=e=>{this.setSorting(e)};onFloatingButtonClick=()=>{M({analytics:(new g).setSection("userList"),parentLayout:layout,onInviteSentHandler:this.onInviteSuccess})};onInviteSuccess=e=>{this.stateFulListRef.addItemsFromPull(e)};onPanList=()=>{this.search.close()};onListRef=e=>{this.stateFulListRef=e};onItemsLoaded=(e,t)=>{const{items:s=[],users:l=[],tabs:d=[]}=e||{};this.onTabsLoaded(d);const m=t==="cache";const c=s;const h=l;const p=[];if(c.length>0){p.push(m?o(c):r(c))}if(h.length>0){p.push(m?i(h):n(h))}if(p.length>0){u(a(p))}this.setState({itemsCount:s.length})};onTabsLoaded=e=>{const{areTabsAlreadyLoaded:t,tabItems:s}=this.state;if(e&&!t){const t=e.map((e=>{const t={id:e.id,title:e.name};if(e.value>0){t.counter=e.value;t.label=e.value.toString()}return t}));this.setState({tabItems:t,areTabsAlreadyLoaded:true});return}if(e&&this.tabViewRef){e.forEach((e=>{const t=s.find((t=>t.id===e.id));if(t){const t=e.value>0?e.value:0;const s=e.value>0?e.value.toString():"";this.tabViewRef.updateItem(e.id,{counter:t,label:s})}}))}};openUserDetail=e=>{if(!e){return}const s=t(l.getState(),e);if(!s){return}const{id:n,avatarSize100:i,fullName:r,link:o,workPosition:a}=s;void E.open({ownerId:e,analyticsSection:"intranet_user_list",widgetParams:{userId:n,imageUrl:encodeURI(i),title:y.getMessage("PROFILE_INFO"),workPosition:a,name:r,url:o}})};showSearch=()=>{this.search.show()};onSearch=({text:e,presetId:t})=>{const s=this.state.selectedTab??t;this.userListFilter.setPresetId(s);this.userListFilter.setSearchString(e);this.setState({},(()=>this.stateFulListRef.reload()))}}layout.showComponent(new A({currentUserId:Number(env.userId)}))})();
//# sourceMappingURL=component.map.js