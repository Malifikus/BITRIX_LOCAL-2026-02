this.BX=this.BX||{};this.BX.Bizprocdesigner=this.BX.Bizprocdesigner||{};(function(t,e,n,o,i,s,l,a,r,c,d,u,p,m,h,g,C,b,I,v,f,E,S){"use strict";function _(t){e.PULL.subscribe({moduleId:"bizprocdesigner",command:"bizprocdesigner_ai_draft_updated",callback:async e=>{t(e)}})}function y(t){return`${t.sourceBlockId}_${t.sourcePortId}_${t.targetBlockId}_${t.targetPortId}`}function T(t,e){return t.sourceBlockId===e.id||t.targetBlockId===e.id}function k(t){return new Map(t.map((t=>[y(t),t])))}function O(t,e,n,o){const i=[];const s=new Map(t.map((t=>[t.id,t])));const l=new Map(n.map((t=>[t.id,t])));const a=k(e);const r=k(o);const c=new Set;for(const[t,e]of s.entries()){if(!l.has(t)){i.push({type:h.ANIMATED_TYPES.REMOVE_BLOCK,item:e});for(const[t,n]of a.entries()){if(!c.has(t)&&T(n,e)){c.add(t)}}}}for(const[t,e]of a.entries()){if(!c.has(t)&&!r.has(t)){i.push({type:h.ANIMATED_TYPES.REMOVE_CONNECTION,item:e});c.add(t)}}for(const[t,e]of l.entries()){if(!s.has(t)){i.push({type:h.ANIMATED_TYPES.BLOCK,item:e});for(const[t,n]of r.entries()){if(!a.has(t)&&!c.has(t)&&T(n,e)){i.push({type:h.ANIMATED_TYPES.CONNECTION,item:n});c.add(t)}}}}for(const[t,e]of r.entries()){if(!a.has(t)&&!c.has(t)){i.push({type:h.ANIMATED_TYPES.CONNECTION,item:e});c.add(t)}}return i}function B(){return{isFeatureAvailable:t=>p.Feature.instance().isAvailable(t)}}function N(){var t,e,n,o;const i=(t=E.getCurrentInstance())==null?void 0:t.appContext.app;const s=(e=i==null?void 0:(n=i.config)==null?void 0:(o=n.globalProperties)==null?void 0:o.$bitrix)!=null?e:null;return{getMessage:(t,e)=>{var n;return s==null?void 0:(n=s.Loc)==null?void 0:n.getMessage(t,e)}}}let R=t=>t,L;const D=async(t,e)=>{if(b.Type.isUndefined(window.rootActivity)){return null}const{getMessage:n}=N();const o=`/bitrix/tools/bizproc_activity_settings.php?mode=public&bxpublic=Y&lang=${n("LANGUAGE_ID")}&app=vue`;const i=await fetch(o,{method:"POST",body:e});const s=b.Tag.render(L||(L=R`
		<form
			id="form-settings"
			class="bx-core-adm-dialog node-settings-form"
			name="bx_popup_form">
		</form>
	`));b.Dom.append(s,t);await b.Runtime.html(s,await i.text());return s};const P=({id:t,documentType:e,activity:n,workflow:o})=>{const{parameters:i,variables:s,template:l,constants:a}=o;const r={id:t,decode:"Y",module_id:e[0],entity:e[1],document_type:e[2],activity:n,arWorkflowParameters:JSON.stringify(i),arWorkflowVariables:JSON.stringify(s),arWorkflowTemplate:JSON.stringify(l),arWorkflowConstants:JSON.stringify(a),current_site_id:"s1",can_be_activated:"Y",sessid:BX.bitrix_sessid()};const c=new BX.CDialog({content:'<div class="for-camp"></div>',width:400,height:200});c.Show();const d=new FormData;Object.entries(r).forEach((([t,e])=>{d.append(t,e)}));return d};function M(){return{createFormData:P,renderPropertyDialog:D}}function w(t){function e(e,n,o){var i,s;const l=n.activity.Activated==="Y"?(i=b.Loc.getMessage("BIZPROCDESIGNER_STORES_DIAGRAM_ACTIVATE_OFF"))!=null?i:"":(s=b.Loc.getMessage("BIZPROCDESIGNER_STORES_DIAGRAM_ACTIVATE_ON"))!=null?s:"";const r=[{id:"deactivate",text:l,onclick:()=>{t.toggleBlockActivation(n.id,true);if(o){o()}a.MenuManager.destroy("node-settings-local-menu")}}];a.MenuManager.show("node-settings-local-menu",e.target,r,{autoHide:true,cacheable:false,angle:true,offsetLeft:0,offsetTop:0})}return{showActivationMenu:e}}const A={SIMPLE:"simple",TRIGGER:"trigger",COMPLEX:"complex",TOOL:"tool",FRAME:"frame"};const x=Object.freeze({input:"input",output:"output",aux:"aux",topAux:"topAux"});const F={SIMPLE:"simple",TRIGGER:"trigger",COMPLEX:"complex",FRAME:"frame",TOOL:"tool"};const V={SIMPLE:`block:${F.SIMPLE}`,TRIGGER:`block:${F.TRIGGER}`,COMPLEX:`block:${F.COMPLEX}`,FRAME:`block:${F.FRAME}`,TOOL:`block:${F.TOOL}`};const G={AUX:"connection:aux"};const Z={MAIN:"main",USER:"user",FULL:"full"};const H={WHITE:"white",ORANGE:"orange",BLUE:"blue"};const U=async(t,e)=>{const n=await b.ajax.runAction(`bizprocdesigner.v2.${t}`,{method:"POST",json:e||{}});if(n.status==="success"){return n.data}return null};const $={getCatalogData:()=>U("Catalog.get"),getDiagramData:async t=>U("Diagram.get",t),updateTemplateData:t=>U("Diagram.updateTemplate",t),publicDiagramData:t=>U("Diagram.publicate",t),publicDiagramDataDraft:t=>U("Diagram.publicateDraft",t),getNodeSettingsControls:t=>U("Activity.getSettingsControls",t),saveNodeSettings:t=>U("Activity.SaveSettings",t)};function z(t,e){if(t===e){return true}if(!b.Type.isPlainObject(t)||!b.Type.isPlainObject(e)){return false}const n=Object.keys(t);const o=Object.keys(e);if(n.length!==o.length){return false}for(const o of n){if(!z(t[o],e[o])){return false}}return true}function j(t,e){if(t.node.title!==e.node.title){return true}for(const[a]of Object.entries((n=e==null?void 0:(o=e.activity)==null?void 0:o.Properties)!=null?n:{})){var n,o,i,s,l;const r=(i=t==null?void 0:(s=t.activity)==null?void 0:(l=s.Properties)==null?void 0:l[a])!=null?i:null;const c=e.activity.Properties[a];if(!z(r,c)){return true}}return false}function X(t){return new Map(t.map((t=>[t.id,t])))}function q(t){var e;if(!(t!=null&&(e=t.activity)!=null&&e.Activated)){return true}return t.activity.Activated!=="N"}function K(t){try{return JSON.parse(t)}catch(t){console.error("JSON parse error",t);return null}}function W(t){let e=t;if(b.Type.isStringFilled(t)){e=K(t)}if(b.Type.isArray(e)){return e.flatMap((t=>t.items||[]))}return[]}const Y=t=>{const{type:e}=t.sourcePort;const{type:n}=t.targetPort;const o=e===x.input||e===x.output;const i=n===x.input||n===x.output;return o&&i&&e!==n};const J=t=>{const{type:e}=t.sourcePort;const{type:n}=t.targetPort;const o=e===x.aux||e===x.topAux;const i=n===x.aux||n===x.topAux;return o&&i&&e!==n};const Q="aux";function tt(t){const{sourceBlockId:e,sourcePortId:n,sourcePort:o,targetBlockId:i,targetPortId:s}=t;if(o.type===x.output){return{sourceBlockId:e,sourcePortId:n,targetBlockId:i,targetPortId:s}}return{sourceBlockId:i,sourcePortId:s,targetBlockId:e,targetPortId:n}}function et(t){const{sourceBlockId:e,sourcePortId:n,sourcePort:o,targetBlockId:i,targetPortId:s}=t;if(o.type===x.aux){return{sourceBlockId:e,sourcePortId:n,targetBlockId:i,targetPortId:s,type:Q}}return{sourceBlockId:i,sourcePortId:s,targetBlockId:e,targetPortId:n,type:Q}}const nt=()=>{const t=()=>Math.floor(1e3+Math.random()*9e3);return`A${t()}_${t()}_${t()}_${t()}`};function ot(t){const e=new URL(window.location.href);e.searchParams.set("ID",t);e.searchParams.delete("START_TRIGGER");history.replaceState(null,"",e.toString())}function it(t){var e;if(((e=t.errors)==null?void 0:e.length)>0){const[e]=t.errors;m.UI.Notification.Center.notify({content:b.Text.encode(e.message),autoHideDelay:4e3})}else{console.error(t)}}const st=Object.freeze({input:"G",output:"E"});const lt=Object.freeze({left:"left",right:"right"});const at={SetupTemplateActivity:"SetupTemplateActivity"};const rt=S.defineStore("bizprocdesigner-editor-diagram",{state:()=>({templateId:0,draftId:0,documentType:[],documentTypeSigned:"",companyName:"",template:{},blocks:[],connections:[],isOnline:true,blockCurrentTimestamps:{},blockSavedTimestamps:{},templatePublishStatus:Z.MAIN}),getters:{diagramData:t=>({templateId:t.templateId,draftId:t.draftId,documentType:t.documentType,documentTypeSigned:t.documentTypeSigned,companyName:t.companyName,template:t.template,blocks:t.blocks,connections:t.connections,isOnline:t.isOnline,blockCurrentTimestamps:t.blockCurrentTimestamps,blockSavedTimestamps:t.blockSavedTimestamps})},actions:{initEventListeners(){r.EventEmitter.subscribe("Bizproc:onConstantsUpdated",this.updateTemplateConstants.bind(this))},getBlockAncestors(t){const e=this.getInputConnections(t);return e.map((t=>this.blocks.find((e=>e.id===t.sourceBlockId))))},getBlockAncestorsByInputPortId(t,e){return this.getInputConnections(t).filter((t=>t.targetPortId===e)).map((t=>this.blocks.find((e=>e.id===t.sourceBlockId))))},getInputConnections(t){return this.connections.filter((e=>e.targetBlockId===t.id))},getAllBlockAncestors(t,e){const n=[];const o=new Map([[t.id,t]]);let i=this.getInputConnections(t);if(e){i=i.filter((t=>t.targetPortId===e))}n.push(...i);while(n.length>0){const t=n.shift();this.blocks.filter((e=>e.id===t.sourceBlockId)).forEach((t=>{if(!o.has(t.id)){o.set(t.id,t);n.push(...this.getInputConnections(t))}}))}o.delete(t.id);return[...o.values()]},async refreshDiagramData(t){var e,n,o,i,s,l,a,r;const c=await $.getDiagramData(t);this.templateId=(e=c==null?void 0:c.templateId)!=null?e:0;this.draftId=(n=c==null?void 0:c.draftId)!=null?n:0;this.companyName=(o=c==null?void 0:c.companyName)!=null?o:"";this.documentType=(i=c==null?void 0:c.documentType)!=null?i:[];this.documentTypeSigned=(s=c==null?void 0:c.documentTypeSigned)!=null?s:"";this.template=(l=c==null?void 0:c.template)!=null?l:{};this.blocks=this.normalyzeBlocks((a=c==null?void 0:c.blocks)!=null?a:[]);this.setConnections((r=c==null?void 0:c.connections)!=null?r:[]);for(const t of this.blocks){var d,u;const e=Date.now();this.blockCurrentTimestamps[t.id]=(d=t.node.updated)!=null?d:e;this.blockSavedTimestamps[t.id]=(u=t.node.published)!=null?u:e}},normalyzeBlocks(t){return t.map((t=>{const e=Object.entries(t.ports).reduce(((t,[e,n])=>{var o;t[e]=(o=n==null?void 0:n.map((t=>({...t,type:e}))))!=null?o:[];return t}),{});return{...t,ports:e}}))},getDeleteHandlerForBlockType(t){if(t===at.SetupTemplateActivity){return this.handleDeletingConstants}return null},handleDeletingConstants(t){var e,n,o;const i=(e=t.activity)==null?void 0:(n=e.Properties)==null?void 0:n.blocks;const s=(o=this.template)==null?void 0:o.CONSTANTS;if(!s){return}const l=W(i);l.filter((t=>(t==null?void 0:t.itemType)==="constant"&&t.id in s)).forEach((t=>{delete s[t.id]}))},deleteConnectionByBlockIdAndPortId(t,e){this.connections=this.connections.filter((n=>{const{sourceBlockId:o,sourcePortId:i,targetBlockId:s,targetPortId:l}=n;const a=o===t&&i===e;const r=s===t&&l===e;return!a&&!r}))},deleteBlockById(t){var e;const n=this.blocks.findIndex((e=>e.id===t));if(n===-1){return}const o=this.blocks[n];const i=(e=o.activity)==null?void 0:e.Type;const s=this.getDeleteHandlerForBlockType(i);if(s){s.call(this,o)}Object.values(this.blocks[n].ports).filter((t=>b.Type.isArray(t))).forEach((e=>{e.forEach((({id:e})=>{this.deleteConnectionByBlockIdAndPortId(t,e)}))}));this.blocks.splice(n,1)},setBlockCurrentTimestamp(t){this.blockCurrentTimestamps[t.id]=Date.now()},updateBlockActivityField(t,e){const n=this.blocks.find((e=>e.id===t));if(n){n.activity=e}this.updateBlockTimestamp(n)},updateBlockId(t,e){if(t===e){return}const n=this.blocks.find((e=>e.id===t));if(n){this.blockCurrentTimestamps[e]=this.blockCurrentTimestamps[n.id];this.blockSavedTimestamps[e]=this.blockSavedTimestamps[n.id];delete this.blockCurrentTimestamps[n.id];delete this.blockSavedTimestamps[n.id];n.id=e}this.connections.forEach(((n,o)=>{let i=false;if(n.sourceBlockId===t){this.connections[o].sourceBlockId=e;i=true}if(n.targetBlockId===t){this.connections[o].targetBlockId=e;i=true}if(i){this.connections[o].id=`${this.connections[o].sourceBlockId}_${this.connections[o].targetBlockId}`}}))},updateTitle(t){this.template.NAME=t},updateDescription(t){this.template.DESCRIPTION=t},updateTemplateId(t){this.templateId=t},setBlocks(t){this.blocks=t},setConnections(t){this.connections=t},setBlockUnpublished(t){const e=this.blocks.findIndex((e=>e.id===t.id));if(e===-1){return}this.blocks[e].node.publicationState=false},setInputPorts(t,e){Object.assign(t.ports,{input:e})},async updateTemplateData(t){await $.updateTemplateData({templateId:this.templateId,data:t})},async publicDraft(){const t={...this.diagramData,blocks:this.blocks.map((t=>({...t,node:{...t.node,updated:this.blockCurrentTimestamps[t.id],published:this.blockSavedTimestamps[t.id]}})))};const{templateDraftId:e}=await $.publicDiagramDataDraft(t);if(b.Type.isNumber(e)){this.draftId=e}},async publicTemplate(){const t={...this.diagramData,blocks:this.blocks.map((t=>({...t,node:{...t.node,updated:null,published:null}})))};const{templateId:e}=await $.publicDiagramData(t);if(b.Type.isNumber(e)){this.blockSavedTimestamps={...this.blockCurrentTimestamps};this.templateId=e;this.draftId=0}},updateStatus(t){this.isOnline=t},updateBlockTimestamp(t){this.blockCurrentTimestamps[t.id]=Date.now()},setBlockCurrentTimestamps(t){Object.assign(this.blockCurrentTimestamps,t)},updateExistedBlockProperties(t){const e=X(this.blocks);for(const n of t){const t=e.get(n.id);if(t&&t.activity&&t.activity.Properties&&j(t,n)){for(const[e]of Object.entries(n.activity.Properties)){t.activity.Properties[e]=n.activity.Properties[e]}t.node.title=n.node.title}}},updateNodeTitle(t,e){Object.assign(t.node,{title:e})},createPort(t,{portId:e,type:n,label:o,portTitle:i}){var s,l,a;const r=(s=t[t.length-1])!=null?s:null;const[,c]=(l=r==null?void 0:(a=r.title)==null?void 0:a.split(o))!=null?l:[];const d=i!=null?i:`${o}${Number(c!=null?c:0)+1}`;return{id:e,title:d,type:n,position:n===x.input?lt.left:lt.right}},addRulePort(t,e,n,o){const i=this.blocks.find((e=>e.id===t));if(!i){return}const{ports:s}=i;let l=s.input;let a=st.input;if(n===x.output){l=s.output;a=st.output}const r=l.filter((t=>!t.isConnectionPort));const c=this.createPort(r,{portId:e,type:n,label:a,portTitle:o});l.push(c)},addConnectionPort(t,e,n){const o=this.blocks.find((e=>e.id===t));if(!o){return}const{ports:i}=o;const s=n===x.input?i.input:i.output;const l=s.filter((t=>t.isConnectionPort));const a=this.createPort(l,{portId:e,type:n,label:"NG"});s.push({...a,isConnectionPort:true})},deletePort(t,e,n){const o=this.blocks.find((e=>e.id===t));if(!o){return}const{ports:i}=o;const s=n===x.output?i.output:i.input;const l=s.find((t=>e===t.id));s.splice(s.indexOf(l),1)},updateTemplateConstants(t){const{constantsToUpdate:e,deletedConstantIds:n}=t.getData();if(!this.template.CONSTANTS){this.template.CONSTANTS={}}let o={...this.template.CONSTANTS};if(b.Type.isArrayFilled(n)){for(const t of n){delete o[t]}}o={...o,...e};this.template.CONSTANTS=o},setSizeAutosizedBlock(t,e,n){const o=this.blocks.findIndex((e=>e.id===t));if(o<0){return}this.blocks[o].dimensions.width=e;this.blocks[o].dimensions.height=n},async toggleBlockActivation(t,e=false){var n,o;const i=this.blocks.find((e=>e.id===t));if(!i){return}const s=i.activity.Activated==="Y"?"N":"Y";const l=()=>{i.activity.Activated=s;this.updateBlockActivityField(t,i.activity)};if(e){l();return}const a=s==="N"?(n=b.Loc.getMessage("BIZPROCDESIGNER_STORES_DIAGRAM_ACTIVATE_OFF"))!=null?n:"":(o=b.Loc.getMessage("BIZPROCDESIGNER_STORES_DIAGRAM_ACTIVATE_ON"))!=null?o:"";try{l();await this.publicDraft();m.UI.Notification.Center.notify({content:a,autoHideDelay:4e3})}catch(t){it(t)}}}});const ct={name:"block-diagram",components:{UiBlockDiagram:h.BlockDiagram},props:{blocks:{type:Array,default:()=>[]},connections:{type:Array,default:()=>[]},disabled:{type:Boolean,default:false}},emits:["update:blocks","update:connections","blockTransitionEnd"],setup(t){return{blockSlotNames:V,connectionSlotNames:G}},template:`\n\t\t<UiBlockDiagram\n\t\t\t:blocks="blocks"\n\t\t\t:connections="connections"\n\t\t\t:disabled="disabled"\n\t\t\t@update:blocks="$emit('update:blocks', $event)"\n\t\t\t@update:connections="$emit('update:connections', $event)"\n\t\t\t@blockTransitionEnd="$emit('blockTransitionEnd', $event)"\n\t\t>\n\t\t\t<template #[blockSlotNames.SIMPLE]="{ block }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="blockSlotNames.SIMPLE"\n\t\t\t\t\t:block="block"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #[blockSlotNames.TRIGGER]="{ block }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="blockSlotNames.TRIGGER"\n\t\t\t\t\t:block="block"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #[blockSlotNames.COMPLEX]="{ block }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="blockSlotNames.COMPLEX"\n\t\t\t\t\t:block="block"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #[blockSlotNames.TOOL]="{ block }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="blockSlotNames.TOOL"\n\t\t\t\t\t:block="block"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #[blockSlotNames.FRAME]="{ block }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="blockSlotNames.FRAME"\n\t\t\t\t\t:block="block"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #[connectionSlotNames.AUX]="{ connection }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="connectionSlotNames.AUX"\n\t\t\t\t\t:connection="connection"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</UiBlockDiagram>\n\t`};const dt={base:"editor-chart-block-container",highlighted:"--highlighted",deactivated:"--deactivated",[H.WHITE]:"--white",[H.ORANGE]:"--orange",[H.BLUE]:"--blue"};const ut={name:"block-container",props:{contextMenuItems:{type:Array,default:()=>[]},width:{type:Number,default:null},height:{type:Number,default:null},highlighted:{type:Boolean,default:false},deactivated:{type:Boolean,default:false},disabled:{type:Boolean,default:false},colorName:{type:String,default:H.WHITE,validator(t){return Object.values(H).includes(t)}}},setup(t){const{isOpen:e,showContextMenu:n}=h.useContextMenu(t.contextMenuItems);const o=E.computed((()=>({[dt.base]:true,[dt.highlighted]:t.highlighted,[dt.deactivated]:t.deactivated,[dt[t.colorName]]:true})));const i=E.computed((()=>{const e={};if(t.width!==null){e.width=`${t.width}px`}if(t.height!==null){e.height=`${t.height}px`}return e}));function s(e){e.preventDefault();if(t.disabled){return}n(e)}return{isOpenContextMenu:e,blockContainerClassNames:o,blockContainerStyle:i,onShowContextMenu:s}},template:`\n\t\t<div\n\t\t\t:class="blockContainerClassNames"\n\t\t\t:style="blockContainerStyle"\n\t\t\t@contextmenu="onShowContextMenu"\n\t\t>\n\t\t\t<slot :isOpenContextMenu="isOpenContextMenu"/>\n\t\t</div>\n\t`};const pt={base:"editor-chart-icon-button",disabled:"--disabled"};const mt={base:"editor-chart-icon-button__icon",active:"--active"};const ht={name:"icon-button",components:{BIcon:f.BIcon},props:{iconName:{type:String,default:""},size:{type:[Number,String],default:16},color:{type:String,default:"var(--ui-color-gray-60)"},active:{type:Boolean,default:false},disabled:{type:Boolean,default:false}},setup(t){const{size:e,active:n,disabled:o}=E.toRefs(t);const i=E.computed((()=>({[pt.base]:true,[pt.disabled]:E.toValue(o)})));const s=E.computed((()=>({width:`${E.toValue(e)}px`,height:`${E.toValue(e)}px`})));const l=E.computed((()=>({[mt.base]:true,[mt.active]:E.toValue(n)})));return{iconButtonClassNames:i,iconButtonStyle:s,iconClassNames:l}},template:`\n\t\t<button\n\t\t\t:class="iconButtonClassNames"\n\t\t\t:style="iconButtonStyle"\n\t\t>\n\t\t\t<slot>\n\t\t\t\t<BIcon\n\t\t\t\t\t:class="iconClassNames"\n\t\t\t\t\t:name="iconName"\n\t\t\t\t\t:color="color"\n\t\t\t\t\t:size="size"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t</button>\n\t`};const gt={name:"icon-divider",props:{size:{type:[Number,String],default:16},color:{type:String,default:"var(--ui-color-gray-20)"}},setup(t){const{size:e,color:n}=E.toRefs(t);const o=E.computed((()=>({height:`${E.toValue(e)}px`})));const i=E.computed((()=>({height:`${Math.round(E.toValue(e)/2)}px`,background:E.toValue(n)})));return{containerStyle:o,lineStyle:i}},template:`\n\t\t<div\n\t\t\tclass="ui-block-diagram-icon-divider"\n\t\t\t:style="containerStyle"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="ui-block-diagram-icon-divider-line"\n\t\t\t\t:style="lineStyle"\n\t\t\t/>\n\t\t</div>\n\t`};const Ct="BULLET";const bt={name:"EditorChartLoader",mounted(){this.loader=new n.Loader({target:this.$refs["editor-chart-loader"],type:Ct});this.loader.render();this.loader.show()},beforeUnmount(){this.loader.hide();this.loader=null},template:`\n\t\t<div ref="editor-chart-loader"></div>\n\t`};const It={name:"ui-top-panel-menu-button",components:{UiButton:g.Button,BMenu:o.BMenu},props:{text:{type:String,default:null},icon:{type:String,default:null},buttonStyle:{type:String,default:null},options:{type:{},default:()=>({})}},data(){return{isMenuShown:false}},computed:{menuOptions(){return{bindElement:this.$refs.button.button.button,autoHide:true,offsetLeft:this.$refs.button.button.button.offsetWidth/2-120,width:240,...this.options}}},template:`\n\t\t<UiButton\n\t\t\t:text="text"\n\t\t\t:leftIcon="icon"\n\t\t\t:style="buttonStyle"\n\t\t\tref="button"\n\t\t\t@click="isMenuShown = true"\n\t\t/>\n\t\t<BMenu\n\t\t\tv-if="isMenuShown"\n\t\t\t:options="menuOptions"\n\t\t\t@close="isMenuShown = false"\n\t\t/>\n\t`};const vt={name:"split-button",props:{id:{type:String,default:""},text:{type:String,default:""},icon:{type:String,default:null},loading:Boolean},emits:["click","mainClick","menuClick"],data(){return{isMounted:false}},watch:{icon(t){const e=this.button.getContainer().classList;e.forEach((t=>{if(t.startsWith("ui-btn-icon-")){b.Dom.removeClass(this.button.getContainer(),t)}}));if(t&&!t.startsWith("ui-btn-icon")){b.Dom.addClass(this.button.getContainer(),"--with-icon");return}this.button.setProperty("icon",t,g.ButtonIcon);b.Dom.removeClass(this.button.getContainer(),"--with-icon");b.Dom.toggleClass(this.button.getContainer(),["ui-icon-set__scope",t],Boolean(t))},loading:{handler(t){var e;if(t!==((e=this.button)==null?void 0:e.isWaiting())){var n;(n=this.button)==null?void 0:n.setWaiting(t)}},immediate:true}},created(){const t=new I.SplitButton({id:this.id,text:this.text,useAirDesign:true,onclick:()=>{this.$emit("click")},mainButton:{onclick:()=>{this.$emit("mainClick")}},menuButton:{onclick:()=>{this.$emit("menuClick")}}});if(this.icon){t.addClass(`${this.icon} ui-icon-set__scope --with-left-icon`)}this.button=t},mounted(){var t;const e=(t=this.button)==null?void 0:t.render();this.$refs.button.after(e);this.isMounted=true},unmounted(){var t,e;(t=this.button)==null?void 0:(e=t.getContainer())==null?void 0:e.remove()},template:`\n\t\t<button v-if="!isMounted" ref="button"></button>\n\t`};const ft={base:"editor-chart-block-layout__top-menu",show:"--show",hide:"--hide"};const Et={base:"editor-chart-block-layout__status",hide:"--hide"};const St=15;const _t=10;const yt={name:"block-layout",components:{IconButton:ht},props:{block:{type:Object,required:true},moreMenuItems:{type:Array,default:()=>[]},topMenuOpened:{type:Boolean,default:false},dragged:{type:Boolean,default:false},resized:{type:Boolean,default:false},disabled:{type:Boolean,default:false}},computed:{activationIcon(){return this.block.activity.Activated==="Y"?this.iconSet.PAUSE_L:this.iconSet.PLAY_L}},setup(t){const e=E.useTemplateRef("buttonMore");const n=E.useSlots();const{isOpen:o,showContextMenu:i,closeContextMenu:s}=h.useContextMenu(t.moreMenuItems);const l=E.computed((()=>t.moreMenuItems.length>0));const a=E.computed((()=>({[ft.base]:true,[ft.show]:E.toValue(o)||t.topMenuOpened,[ft.hide]:t.dragged||t.resized})));const r=E.computed((()=>({[Et.base]:true,[Et.hide]:t.dragged||t.resized||!n.status})));function c(){var t,n,o;const{top:s=0,right:l=0}=(t=(n=E.toValue(e))==null?void 0:(o=n.$el)==null?void 0:o.getBoundingClientRect())!=null?t:{};i({clientX:l+St,clientY:s-_t})}const d=E.inject("onToggleBlockActivation");function u(){if(!d){console.warn("onToggleBlockActivation is not provided");return}d(t.block.id)}function p(){s()}return{iconSet:f.Outline,isOpen:o,isShowButtonMore:l,topMenuClassNames:a,statusClassNames:r,onOpenMoreMenu:c,onCloseMoreMenu:p,handleIconClick:u}},template:`\n\t\t<div\n\t\t\tclass="editor-chart-block-layout"\n\t\t\tref="editorBlockMenu"\n\t\t\t@mousedown="onCloseMoreMenu"\n\t\t>\n\t\t\t<div \n\t\t\t\t:class="topMenuClassNames"\n\t\t\t\t@mousedown.stop\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!disabled"\n\t\t\t\t\tclass="editor-chart-block-layout__top-menu-title"\n\t\t\t\t>\n\t\t\t\t\t<slot name="top-menu-title"/>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!disabled"\n\t\t\t\t\tclass="editor-chart-block-layout__top-menu-content">\n\t\t\t\t\t<slot\n\t\t\t\t\t\tname="top-menu"\n\t\t\t\t\t/>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\t:icon-name="activationIcon"\n\t\t\t\t\t\t@click="handleIconClick"\n\t\t\t\t\t/>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\tv-if="isShowButtonMore"\n\t\t\t\t\t\tref="buttonMore"\n\t\t\t\t\t\t:active="isOpen"\n\t\t\t\t\t\t:size="16"\n\t\t\t\t\t\t:icon-name="iconSet.MORE_L"\n\t\t\t\t\t\t@click="onOpenMoreMenu"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="editor-chart-block-layout__content">\n\t\t\t\t<slot/>\n\t\t\t</div>\n\t\t\t<div class="editor-chart-block-layout__left-content">\n\t\t\t\t<slot name="left"/>\n\t\t\t</div>\n\t\t\t<div :class="statusClassNames">\n\t\t\t\t<slot name="status"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Tt={base:"editor-chart-block-switcher",on:"editor-chart-block-switcher__on"};const kt={base:"editor-chart-block-switcher__icon",on:"--on"};const Ot="on";const Bt="off";const Nt={name:"block-switcher",components:{BIcon:f.BIcon},directives:{hint:i.hint},props:{on:{type:Boolean,default:true}},emits:["click"],setup(t,{emit:e}){const n=E.computed((()=>({[Tt.base]:true,[Tt.on]:t.on})));const o=E.computed((()=>({[kt.base]:true,[kt.on]:t.on})));const i=E.computed((()=>t.on?Ot:Bt));const s=()=>{e("click")};return{blockSwitcherClassNames:n,iconClassNames:o,switcherLabel:i,handleClick:s}},template:`\n\t\t<div\n\t\t\t:class="blockSwitcherClassNames"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\t:class="iconClassNames"\n\t\t\t\t:size="12"\n\t\t\t\tname="o-power" \n\t\t\t/>\n\t\t\t<p class="editor-chart-block-switcher__label">\n\t\t\t\t{{ switcherLabel }}\n\t\t\t</p>\n\t\t</div>\n\t`};const Rt={name:"block-header",props:{block:{type:Object,required:true},subIconExternal:{type:Boolean,default:false}},template:`\n\t\t<div class="editor-chart-block-header">\n\t\t\t<div class="editor-chart-block-header__icon-wrapper">\n\t\t\t\t<slot name="icon"/>\n\t\t\t</div>\n\n\t\t\t<template v-if="$slots.subIcon">\n\t\t\t\t<span class="editor-chart-block-header__divider" aria-hidden="true"></span>\n\t\t\t\t<div :class="[\n\t\t\t\t\t  'editor-chart-block-header__icon-wrapper',\n\t\t\t\t\t  'editor-chart-block-header__icon-wrapper--sub',\n\t\t\t\t\t  { 'editor-chart-block-header__icon-wrapper--sub-external': subIconExternal }\n\t\t\t\t\t]">\n\t\t\t\t\t<slot name="subIcon"/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div class="editor-chart-block-header__title">{{ block.node?.title }}</div>\n\t\t</div>\n\t`};const Lt={base:"editor-chart-block-icon",bgColor_1:"--background-color-1",bgColor_2:"--background-color-2",bgColor_3:"--background-color-3",bgColor_4:"--background-color-4",bgColor_5:"--background-color-5",bgColor_6:"--background-color-6",bgColor_7:"--background-color-7",bgColor_8:"--background-color-8"};const Dt={0:"#9C5CEF",1:"#188AE6",2:"#E08907",3:"#8E96A2",4:"#3CB811",5:"#52BCBC",6:"#B4B959",7:"#FFFFFF"};const Pt=f.Outline.FILE;const Mt={name:"block-icon",components:{BIcon:f.BIcon},props:{iconName:{type:String,default:Pt},iconColorIndex:{type:Number,default:0},customColor:{type:String,default:null},iconSize:{type:Number,default:28}},setup(t){const e=f.Outline;const n=E.computed((()=>({[Lt.base]:true,[Lt.bgColor_1]:t.iconColorIndex===0,[Lt.bgColor_2]:t.iconColorIndex===1,[Lt.bgColor_3]:t.iconColorIndex===2,[Lt.bgColor_4]:t.iconColorIndex===3,[Lt.bgColor_5]:t.iconColorIndex===4,[Lt.bgColor_6]:t.iconColorIndex===5,[Lt.bgColor_7]:t.iconColorIndex===6,[Lt.bgColor_8]:t.iconColorIndex===7})));function o(t){if(t&&Object.prototype.hasOwnProperty.call(e,t)){return e[t]}return Pt}function i(t){if(t!==false&&Dt[t]){return Dt[t]}return null}return{iconClassNames:n,getIconName:o,getIconColor:i}},template:`\n\t\t<div :class="iconClassNames">\n\t\t\t<BIcon\n\t\t\t\t:name="getIconName(iconName)" \n\t\t\t\t:size="iconSize"\n\t\t\t\t:color="customColor || getIconColor(iconColorIndex)"\n\t\t\t\tclass="editor-chart-block-icon__icon"\n\t\t\t/>\n\t\t</div>\n\t`};const wt={name:"PortsInOutCenter",components:{Port:h.Port},props:{block:{type:Object,required:true},disabled:{type:Boolean,default:false},hideInputPorts:{type:Boolean,default:false}},setup(t){const e=E.computed((()=>{var e,n,o;if(t.hideInputPorts){return null}return(e=(n=t.block.ports)==null?void 0:(o=n.input)==null?void 0:o[0])!=null?e:null}));const n=E.computed((()=>{var e,n,o;return(e=(n=t.block.ports)==null?void 0:(o=n.output)==null?void 0:o[0])!=null?e:null}));const o=E.computed((()=>{var e,n,o;return(e=(n=t.block.ports)==null?void 0:(o=n.aux)==null?void 0:o[0])!=null?e:null}));const i=E.computed((()=>{var e,n,o;return(e=(n=t.block.ports)==null?void 0:(o=n.topAux)==null?void 0:o[0])!=null?e:null}));return{inPort:e,outPort:n,auxPort:o,topAuxPort:i,validationInputOutputRule:Y,validationAuxRule:J,normalyzeInputOutputConnection:tt,normalyzeAuxConnection:et}},template:`\n\t\t<div class="editor-chart-ports-inout-center">\n\t\t\t<slot/>\n\n\t\t\t<div\n\t\t\t\tv-if="inPort"\n\t\t\t\tclass="editor-chart-ports-inout-center__port --input"\n\t\t\t>\n\t\t\t\t<Port\n\t\t\t\t\t:block="block"\n\t\t\t\t\t:port="inPort"\n\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t:styled="false"\n\t\t\t\t\t:validationRules="[validationInputOutputRule]"\n\t\t\t\t\t:normalyzeConnectionFn="normalyzeInputOutputConnection"\n\t\t\t\t\tposition="left"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tv-if="outPort"\n\t\t\t\tclass="editor-chart-ports-inout-center__port --output"\n\t\t\t>\n\t\t\t\t<Port\n\t\t\t\t\t:block="block"\n\t\t\t\t\t:port="outPort"\n\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t:styled="false"\n\t\t\t\t\t:validationRules="[validationInputOutputRule]"\n\t\t\t\t\t:normalyzeConnectionFn="normalyzeInputOutputConnection"\n\t\t\t\t\tposition="right"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="auxPort"\n\t\t\t\tclass="editor-chart-ports-bottom-center__port --bottom"\n\t\t\t>\n\t\t\t\t<Port\n\t\t\t\t\t:block="block"\n\t\t\t\t\t:port="auxPort"\n\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t:styled="false"\n\t\t\t\t\t:validationRules="[validationAuxRule]"\n\t\t\t\t\t:normalyzeConnectionFn="normalyzeAuxConnection"\n\t\t\t\t\tposition="bottom"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="topAuxPort"\n\t\t\t\tclass="editor-chart-ports-top-center__port --top"\n\t\t\t>\n\t\t\t\t<Port\n\t\t\t\t\t:block="block"\n\t\t\t\t\t:port="topAuxPort"\n\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t:styled="false"\n\t\t\t\t\t:validationRules="[validationAuxRule]"\n\t\t\t\t\t:normalyzeConnectionFn="normalyzeAuxConnection"\n\t\t\t\t\tposition="top"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const At={name:"block-status-not-published",setup(){const{getMessage:t}=N();return{getMessage:t}},template:`\n\t\t<p class="editor-chart-block-status-not-published">\n\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_BLOCK_NOT_PUBLISHED_STATUS') }}\n\t\t</p>\n\t`};const xt={name:"block-complex",components:{Port:h.Port},props:{block:{type:Object,required:true},disabled:{type:Boolean,default:false}},setup(){const{updatePortPosition:t}=h.useBlockDiagram();const{getMessage:e}=N();const{isFeatureAvailable:n}=B();return{updatePortPosition:t,getMessage:e,isFeatureAvailable:n,normalyzeInputOutputConnection:tt,validationInputOutputRule:Y}},computed:{rulePorts(){return this.block.ports.input.filter((t=>!t.isConnectionPort))},connectionPorts(){return this.block.ports.input.filter((t=>t.isConnectionPort))},inputPortsLength(){return this.block.ports.input.length},outputPortsLength(){return this.block.ports.output.length},areConnectionsAvailable(){return this.isFeatureAvailable(p.FeatureCode.complexNodeConnections)&&this.connectionPorts.length>0}},watch:{inputPortsLength(){this.$nextTick((()=>{this.block.ports.input.forEach((t=>{this.updatePortPosition(this.block.id,t.id)}))}))},outputPortsLength(){this.$nextTick((()=>{this.block.ports.output.forEach((t=>{this.updatePortPosition(this.block.id,t.id)}))}))}},template:`\n\t\t<div class="block-complex">\n\t\t\t<slot name="header" />\n\t\t\t<div class="block-complex__content">\n\t\t\t\t<div class="block-complex__content_row block-complex__content_rules">\n\t\t\t\t\t<div class="block-complex__content_col">\n\t\t\t\t\t\t<span class="block-complex__content_label">\n\t\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_BLOCK_RULES_INPUT_TITLE') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-for="port in rulePorts"\n\t\t\t\t\t\t\t:key="port.id"\n\t\t\t\t\t\t\tclass="block-complex__content_col-value"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t:port="port"\n\t\t\t\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t\t\t\t:validationRules="[validationInputOutputRule]"\n\t\t\t\t\t\t\t\t:normalyzeConnectionFn="normalyzeInputOutputConnection"\n\t\t\t\t\t\t\t\tposition="left"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<span class="block-complex__content_col-value-text">{{ port.title }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<slot name="addPortPoint" position="left" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="block-complex__content_col --right">\n\t\t\t\t\t\t<span class="block-complex__content_label">\n\t\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_BLOCK_RULES_OUTPUT_TITLE') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-for="port in block.ports.output"\n\t\t\t\t\t\t\t:key="port.id"\n\t\t\t\t\t\t\tclass="block-complex__content_col-value"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="block-complex__content_col-value-text">{{ port.title }}</span>\n\t\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t:port="port"\n\t\t\t\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t\t\t\t:validationRules="[validationInputOutputRule]"\n\t\t\t\t\t\t\t\t:normalyzeConnectionFn="normalyzeInputOutputConnection"\n\t\t\t\t\t\t\t\tposition="right"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<slot name="addPortPoint" position="right" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if="areConnectionsAvailable"\n\t\t\t\t\tclass="block-complex__content_connections"\n\t\t\t\t>\n\t\t\t\t\t<span class="block-complex__content_label">\n\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_BLOCK_CONNECTIONS_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="block-complex__content_row">\n\t\t\t\t\t\t<div class="block-complex__content_col">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-for="port in connectionPorts"\n\t\t\t\t\t\t\t\t:key="port.id"\n\t\t\t\t\t\t\t\tclass="block-complex__content_col-value"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t\t:port="port"\n\t\t\t\t\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t\t\t\t\tposition="left"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<span class="block-complex__content_col-value-text">{{ port.title }}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<slot name="addPortPoint" position="left" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="block-complex__content_col --right">\n\t\t\t\t\t\t\t<slot name="addPortPoint" position="right" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ft={name:"block-top-title",props:{title:{type:String,required:true}},template:`\n\t\t<h3 class="editor-chart-block-top-title">{{ title }}</h3>\n\t`};const Vt={name:"TemplateNameInput",components:{UiButton:g.Button,MenuButton:It},props:{title:{type:String,default:""},dropdownOptions:{type:[Object],default:()=>({})}},emits:["update:title"],setup(){return{ButtonSize:g.ButtonSize,AirButtonStyle:g.AirButtonStyle,Outline:C.Outline,Type:b.Type}},data(){return{isEditing:false,editedTitle:this.title}},computed:{preparedOptions(){const t=this.dropdownOptions;const e=b.Type.isArrayFilled(t.items)?t.items:[];const n=b.Type.isArrayFilled(e)?this.prepareItems(e):e;return{...t,items:[this.getEditingMenuItems(),...n]}}},watch:{isEditing(t){if(t){b.Event.bind(document,"click",this.onClickOutside,{capture:true})}else{b.Event.unbind(document,"click",this.onClickOutside,{capture:true})}}},methods:{getEditingMenuItems(){return{title:this.$Bitrix.Loc.getMessage("BIZPROCDESIGNER_EDITOR_TOP_PANEL_TITLE_ACTION_CHANGE"),icon:C.Outline.EDIT_M,onClick:this.onStartEditing}},onStartEditing(){this.isEditing=true;this.editedTitle=this.title;this.$nextTick((()=>{var t,e;(t=this.$refs)==null?void 0:(e=t.editInput)==null?void 0:e.focus()}))},onSaveTitle(){this.$emit("update:title",this.editedTitle);this.isEditing=false},onCancelEditing(){this.isEditing=false},prepareItems(t){return t.map((t=>{if(b.Type.isString(t.onClick)&&b.Type.isFunction(this[t.onClick])){return{...t,onClick:this[t.onClick].bind(this)}}return t}))},onClickOutside(t){if(!this.$el.contains(t.target)){this.onCancelEditing()}}},template:`\n\t\t<div\n\t\t\tv-if="!isEditing"\n\t\t\tclass="ui-top-panel-editable-title-box"\n\t\t>\n\t\t\t<div class="ui-top-panel-editable-title">\n\t\t\t\t<span @click="onStartEditing">{{ title }}</span>\n\t\t\t</div>\n\t\t\t<MenuButton\n\t\t\t\t:options="preparedOptions"\n\t\t\t\t:icon="Outline.CHEVRON_DOWN_M"\n\t\t\t\t:buttonStyle="AirButtonStyle.PLAIN_NO_ACCENT"\n\t\t\t/>\n\t\t</div>\n\t\t<div\n\t\t\tv-else\n\t\t\tclass="ui-top-panel-editable-title-edit-box"\n\t\t>\n\t\t\t<input\n\t\t\t\tv-model="editedTitle"\n\t\t\t\tref="editInput"\n\t\t\t\tclass="ui-top-panel-editable-title-edit-input"\n\t\t\t/>\n\t\t\t<div class="ui-top-panel-editable-title-edit-buttons">\n\t\t\t\t<UiButton\n\t\t\t\t\t:leftIcon="Outline.CHECK_M"\n\t\t\t\t\t:size="ButtonSize.EXTRA_EXTRA_SMALL"\n\t\t\t\t\t@click="onSaveTitle"\n\t\t\t\t/>\n\t\t\t\t<UiButton\n\t\t\t\t\t:leftIcon="Outline.CROSS_L"\n\t\t\t\t\t:size="ButtonSize.EXTRA_EXTRA_SMALL"\n\t\t\t\t\t:style="AirButtonStyle.OUTLINE"\n\t\t\t\t\t@click="onCancelEditing"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Gt={name:"bizprocdisginer-top-panel-autosave-status",directives:{hint:i.hint},props:{isOnline:{type:Boolean,required:true}},template:`\n\t\t<div>\n\t\t\t<div\n\t\t\t\tv-if="isOnline"\n\t\t\t\tv-hint="{\n\t\t\t\t\ttext: this.$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_TOP_PANEL_AUTOSAVE_STATUS_SAVED_HINT'),\n\t\t\t\t\tpopupOptions: {\n\t\t\t\t\t\twidth: 339,\n\t\t\t\t\t\toffsetTop: 20,\n\t\t\t\t\t\tbackground: '#085DC1',\n\t\t\t\t\t},\n\t\t\t\t}"\n\t\t\t\tclass="bizprocdesigner-editor-header-save-status-box bizprocdesigner-editor-header-online"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --o-circle-check"></div>\n\t\t\t\t{{$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_TOP_PANEL_AUTOSAVE_STATUS_SAVED')}}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-else\n\t\t\t\tv-hint="{\n\t\t\t\t\ttext: $Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_TOP_PANEL_AUTOSAVE_STATUS_NOT_SAVED_HINT'),\n\t\t\t\t\tpopupOptions: {\n\t\t\t\t\t\twidth: 339,\n\t\t\t\t\t\tbackground: '#085DC1',\n\t\t\t\t\t},\n\t\t\t\t}"\n\t\t\t\tclass="bizprocdesigner-editor-header-save-status-box bizprocdesigner-editor-header-offline"\n\t\t\t>\n\t\t\t\t<div class="ui-icon-set --o-circle-cross"></div>\n\t\t\t\t{{$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_TOP_PANEL_AUTOSAVE_STATUS_NOT_SAVED')}}\n\t\t\t</div>\n\t\t</div>\n\t`};const Zt={name:"DropdownMenuButton",components:{SplitButton:vt},props:{text:{type:String,default:""},icon:{type:String,default:""},loading:{type:Boolean,default:false}},emits:["change"],data(){return{isOpen:false}},mounted(){b.Event.bind(document,"mousedown",this.handleClickOutside)},beforeUnmount(){b.Event.unbind(document,"mousedown",this.handleClickOutside)},methods:{onToggleDropdown(){this.isOpen=!this.isOpen},handleClickOutside(t){const e=this.$el;if(e&&!(e!=null&&e.contains(t.target))){this.isOpen=false}}},template:`\n\t\t<div class="editor-chart-dropdown-menu-button">\n\t\t\t<SplitButton\n\t\t\t\t:text="text"\n\t\t\t\t:icon="icon"\n\t\t\t\t:loading="loading"\n\t\t\t\t@mainClick="$emit('change')"\n\t\t\t\t@menuClick="onToggleDropdown"\n\t\t\t/>\n\t\t\t<transition name="slide-fade">\n\t\t\t\t<div v-if="isOpen"\n\t\t\t\t\tclass="editor-chart-dropdown-menu-button__menu-content"\n\t\t\t\t\tref="dropdownMenu"\n\t\t\t\t>\n\t\t\t\t\t<ul class="editor-chart-dropdown-menu-button__list">\n\t\t\t\t\t\t<slot/>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<div class="editor-chart-dropdown-menu-button__footer">\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref="#"\n\t\t\t\t\t\t\tclass="editor-chart-dropdown-menu-button__help-link"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_PUBLICATION_LINK') }}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t</div>\n\t`};const Ht={name:"DropdownMenuOption",props:{title:{type:String,default:""},description:{type:String,default:""},isActive:{type:Boolean,default:false},notReleased:{type:Boolean,default:false}},template:`\n\t\t<li\n\t\t\tclass="editor-chart-dropdown-menu-option"\n\t\t\t:class="{ '--selected': isActive }"\n\t\t>\n\t\t\t<div class="editor-chart-dropdown-menu-option__content">\n\t\t\t\t<div class="editor-chart-dropdown-menu-option__title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t\t<div class="editor-chart-dropdown-menu-option__description">\n\t\t\t\t\t{{ description }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="editor-chart-dropdown-menu-option__icon">\n\t\t\t\t<slot name="icon"/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="notReleased"\n\t\t\t\t\tclass="editor-chart-dropdown-menu-option__not-released-badge"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_NOT_RELEASE_BADGE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</li>\n\t`};const Ut={active:{lightBlue:"#C4E6FF",primaryBlue:"#0075FF",secondaryBlue:"#9BD4FF",successGreen:"#1BCE7B"},inactive:{lightBlue:"#F0F0F0",primaryBlue:"#C8C9CD",secondaryBlue:"#C8C9CD",successGreen:"#C8C9CD"}};const $t={name:"WorkflowIcon",props:{active:{type:Boolean,default:false}},computed:{colors(){return this.active?Ut.active:Ut.inactive}},template:`\n\t\t<svg\n\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\twidth="71"\n\t\t\theight="67"\n\t\t\tviewBox="0 0 71 67"\n\t\t\tfill="none"\n\t\t>\n\t\t\t<g opacity="0.8">\n\t\t\t\t<path\n\t\t\t\t\td="M15.2749 17.5718C15.2749 14.8644 17.3577 12.724 19.9013 12.7906L51.5805 13.6078C53.7929 13.6655 55.5715 15.7302 55.5715 18.2217V45.8523C55.5715 48.3437 53.7929 50.4571 51.5805 50.5741L19.9013 52.2447C17.3559 52.3797 15.2749 50.2951 15.2749 47.5877V17.5718Z"\n\t\t\t\t\t:fill="colors.lightBlue"\n\t\t\t\t/>\n\t\t\t</g>\n\t\t\t<path\n\t\t\t\topacity="0.5"\n\t\t\t\td="M26.2736 39.6436C26.2736 39.3952 26.549 39.2494 26.7362 39.3988L27.2439 39.8074V40.0649H27.3033C27.4563 40.0595 27.5805 40.1891 27.5805 40.3547C27.5805 40.5203 27.4563 40.6571 27.3033 40.6625H27.2439V40.9235L26.7362 41.361C26.5508 41.5212 26.2736 41.3934 26.2736 41.145V40.6823C26.1134 40.6769 25.9568 40.6607 25.8038 40.6319C25.6525 40.6049 25.5535 40.4483 25.5841 40.2863C25.6147 40.1225 25.7606 40.0127 25.9136 40.0415C26.0324 40.0631 26.153 40.0775 26.2754 40.0829V39.6418L26.2736 39.6436ZM29.6633 40.5923L28.8784 40.6157C28.7254 40.6211 28.6012 40.4897 28.6012 40.3259C28.6012 40.1621 28.7254 40.0235 28.8784 40.0199L29.6633 39.9965V40.5923ZM23.5536 38.6175C23.6832 38.5221 23.8578 38.5545 23.9442 38.6895C24.171 39.0442 24.4608 39.3484 24.7993 39.5806L24.8425 39.6184C24.9343 39.7156 24.9505 39.8722 24.8767 39.9947C24.7903 40.1351 24.6157 40.1765 24.486 40.0883L24.3384 39.9821C24.0018 39.7246 23.7084 39.4042 23.4744 39.0388C23.3879 38.902 23.4221 38.7147 23.5518 38.6175H23.5536ZM23.1395 35.8381C23.2961 35.8345 23.4221 35.9677 23.4221 36.1333V36.8606C23.4221 37.082 23.4419 37.298 23.4816 37.5068L23.487 37.568C23.487 37.7085 23.3933 37.8363 23.2583 37.8669C23.1053 37.9029 22.9559 37.8003 22.9271 37.6382L22.8965 37.451C22.8695 37.2638 22.8569 37.0694 22.8569 36.8732V36.1441C22.8569 35.9767 22.9829 35.8399 23.1395 35.8363V35.8381ZM23.1395 32.9236C23.2961 32.9218 23.4221 33.055 23.4221 33.2207V34.677L23.4167 34.7382C23.3897 34.8768 23.2763 34.9812 23.1395 34.9848C23.0027 34.9866 22.8893 34.8858 22.8623 34.749L22.8569 34.6878V33.2297C22.8569 33.0622 22.9829 32.9254 23.1395 32.9236ZM23.9136 30.3584C23.9136 30.695 23.7102 30.9831 23.4221 31.1001V31.7661L23.4167 31.8273C23.3897 31.9641 23.2763 32.0704 23.1395 32.0722C23.0027 32.0722 22.8893 31.9713 22.8623 31.8345L22.8569 31.7733V31.0983C22.5797 30.9831 22.3853 30.7022 22.3853 30.3728L23.9136 30.3584Z"\n\t\t\t\t:fill="colors.primaryBlue"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M18.7524 21.2727C18.7524 19.5968 19.8703 18.2539 21.2403 18.2737L46.8331 18.6553C48.0608 18.6733 49.0527 19.9658 49.0527 21.5409V27.2709C49.0527 28.846 48.0626 30.1331 46.8331 30.1439L21.2403 30.3797C19.8685 30.3923 18.7524 29.044 18.7524 27.3663V21.2709V21.2727Z"\n\t\t\t\tfill="white"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\topacity="0.5"\n\t\t\t\td="M24.583 24.3347C24.583 23.6686 25.0733 23.1322 25.6766 23.1358L43.4199 23.233C43.9781 23.2366 44.4301 23.755 44.4301 24.3941C44.4301 25.0331 43.9781 25.548 43.4199 25.548L25.6766 25.5408C25.0733 25.5408 24.583 25.0007 24.583 24.3365V24.3347Z"\n\t\t\t\t:fill="colors.secondaryBlue"\n\t\t\t\tfill-opacity="var(--opacity-80)"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M27.2441 37.4979C27.2441 35.849 28.3242 34.4934 29.6492 34.47L50.3996 34.1028C51.6093 34.0812 52.585 35.3323 52.585 36.8967V42.5834C52.585 44.1477 51.6093 45.4564 50.3996 45.5068L29.6492 46.3763C28.3242 46.4321 27.2441 45.1414 27.2441 43.4924V37.4997V37.4979Z"\n\t\t\t\tfill="white"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\topacity="0.5"\n\t\t\t\td="M38.6587 40.1545C38.6587 39.5083 39.1375 38.9736 39.7244 38.9574L48.5362 38.7162C49.1014 38.7 49.5587 39.2004 49.5587 39.8305C49.5587 40.4606 49.1014 40.988 48.5362 41.006L39.7244 41.2904C39.1357 41.3102 38.6587 40.8008 38.6587 40.1563V40.1545Z"\n\t\t\t\t:fill="colors.secondaryBlue"\n\t\t\t\tfill-opacity="0.8"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\topacity="0.7"\n\t\t\t\tfill-rule="evenodd"\n\t\t\t\tclip-rule="evenodd"\n\t\t\t\td="M33.2891 44.2326C33.2891 44.2321 33.2895 44.2317 33.29 44.2317C35.2698 44.1556 36.8624 42.3556 36.8624 40.2084C36.8624 38.0608 35.2693 36.356 33.2891 36.3992C31.3089 36.4424 29.6636 38.2444 29.6636 40.4244C29.6636 42.6041 31.2922 44.3068 33.2882 44.2336C33.2887 44.2336 33.2891 44.2331 33.2891 44.2326Z"\n\t\t\t\t:fill="colors.successGreen"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tfill-rule="evenodd"\n\t\t\t\tclip-rule="evenodd"\n\t\t\t\td="M35.057 38.7832C34.9022 38.6194 34.652 38.6248 34.4971 38.7976L32.7708 40.7274L32.0795 39.9965C31.9229 39.8309 31.6691 39.8381 31.5125 40.0127C31.3559 40.1873 31.3559 40.4628 31.5125 40.6284L32.4882 41.6581C32.6448 41.8219 32.8968 41.8147 33.0516 41.6401L35.057 39.3953C35.2118 39.2224 35.2118 38.9488 35.057 38.785V38.7832Z"\n\t\t\t\tfill="white"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M47.9009 41.2902C47.9009 38.7574 49.7244 36.662 51.9548 36.6116L62.2716 36.3739C64.3849 36.3253 66.0843 38.2605 66.0843 40.6961V52.2712C66.0843 54.7068 64.3849 56.7968 62.2716 56.939L51.9548 57.6392C49.7244 57.7904 47.9009 55.8607 47.9009 53.3278V41.292V41.2902Z"\n\t\t\t\t:fill="colors.primaryBlue"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\td="M47.8608 41.2382C47.8608 38.709 49.6808 36.6172 51.9076 36.5668L62.2063 36.331C64.3161 36.2824 66.0119 38.2157 66.0119 40.6478V52.2066C66.0119 54.6386 64.3161 56.725 62.2063 56.8672L51.9076 57.5621C49.6808 57.7115 47.8608 55.7853 47.8608 53.2561V41.2364V41.2382Z"\n\t\t\t\t:fill="colors.primaryBlue"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<g filter="url(#filter1_d_2398_58856)">\n\t\t\t\t<path\n\t\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\tfill-rule="evenodd"\n\t\t\t\t\tclip-rule="evenodd"\n\t\t\t\t\td="M59.0084 45.4018C59.0084 45.3644 59.0119 45.327 59.0191 45.2897C59.0725 45.0405 59.286 44.8803 59.4978 44.9337L61.3275 45.3947C61.5019 45.4392 61.6229 45.6171 61.6229 45.8289V50.072L62.091 50.0471C62.1907 50.0418 62.2726 50.1308 62.2726 50.2465V51.3589C62.2726 51.4745 62.1907 51.5724 62.091 51.5778L51.8482 52.1562C51.7431 52.1616 51.6577 52.0708 51.6577 51.9533V50.8142C51.6577 50.6968 51.7431 50.5953 51.8482 50.59L52.3358 50.5633V42.9812C52.3358 42.5968 52.5761 42.2622 52.9036 42.1892L57.5827 41.1445C57.6183 41.1373 57.6539 41.132 57.6895 41.1302C58.0544 41.1178 58.3498 41.4541 58.3498 41.8813V50.2447L59.0084 50.2091V45.4018ZM55.2369 50.3337V47.9434L54.0356 48.0003V50.3977L55.2369 50.3337ZM57.0577 49.2159V47.8562L55.8652 47.9131V49.2765L57.0577 49.2159ZM60.8612 47.6088L59.6883 47.6639V49.0166L60.8612 48.9579V47.6088ZM57.0577 43.7074L55.8652 43.7537V45.117L57.0577 45.0672V43.7074ZM55.2369 43.7786L54.0356 43.8249V45.1936L55.2369 45.1437V43.7786ZM57.0577 45.7827L55.8652 45.8343V47.1976L57.0577 47.1425V45.7827ZM55.2369 45.861L54.0356 45.9126V47.2813L55.2369 47.2261V45.861Z"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t</g>\n\t\t\t<path\n\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\td="M65.3957 52.2278V40.6525C65.3957 38.54 63.9889 37.0067 62.3711 36.9481L62.2137 36.9466L51.8971 37.1845C50.068 37.2258 48.4456 38.9784 48.4456 41.2464V53.2839C48.4456 55.5388 50.0415 57.102 51.8413 56.98L62.158 56.2799L62.3184 56.2641C63.9682 56.0547 65.3955 54.3492 65.3957 52.2278ZM66.0122 52.2278L66.0077 52.4543C65.9062 54.7916 64.2469 56.7571 62.1994 56.8949L51.8828 57.5957L51.675 57.6033C49.6091 57.6243 47.9398 55.8574 47.8344 53.5195L47.8291 53.2839V41.2464C47.8291 38.7928 49.5404 36.7497 51.675 36.5785L51.8828 36.568L62.1994 36.3301L62.3966 36.3316C64.4177 36.4032 66.0122 38.293 66.0122 40.6525V52.2278Z"\n\t\t\t\tfill="white"\n\t\t\t\tfill-opacity="0.18"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M5.479 6.25911C5.479 3.49227 7.6554 1.35548 10.3142 1.48509L22.0171 2.05574C24.5301 2.17815 26.5499 4.42835 26.5499 7.08359V19.0997C26.5499 21.7549 24.5301 23.8953 22.0171 23.8827L10.3142 23.8215C7.6554 23.8071 5.479 21.5533 5.479 18.7864V6.25911Z"\n\t\t\t\t:fill="colors.successGreen"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M5.479 18.7867V6.25913C5.47916 3.49251 7.65539 1.3556 10.314 1.48508L22.0173 2.05643C24.5302 2.17897 26.5497 4.42901 26.5497 7.08416V19.0998L26.5437 19.3475C26.4228 21.8869 24.4516 23.895 22.0173 23.8829L22.0203 23.2664C24.157 23.277 25.9332 21.4487 25.9332 19.0998V7.08416C25.9332 4.79933 24.2507 2.89929 22.1882 2.68725L21.9872 2.67219L10.2839 2.10159C7.99746 1.99029 6.09568 3.82433 6.09552 6.25913V18.7867C6.09552 21.2337 8.01739 23.193 10.3178 23.2054L22.0203 23.2664L22.0173 23.8829L10.314 23.8219C7.73846 23.8079 5.61533 21.6924 5.48503 19.0449L5.479 18.7867Z"\n\t\t\t\tfill="white"\n\t\t\t\tfill-opacity="0.24"\n\t\t\t/>\n\t\t\t<g filter="url(#filter2_d_2398_58856)">\n\t\t\t\t<path\n\t\t\t\t\td="M11.4088 14.3314L14.0622 15.0298C14.2548 15.0802 14.2963 15.3467 14.1306 15.4529L13.299 15.9767C14.037 16.8084 15.0811 17.3358 16.2332 17.3556C16.8021 17.3664 17.3403 17.253 17.8282 17.0388C17.9164 16.9992 18.0226 17.0226 18.0874 17.1L19.0577 18.2485C19.1495 18.3565 19.1261 18.5239 19.0055 18.5905C18.1846 19.0478 17.2413 19.2998 16.235 19.2854C14.4205 19.2602 12.7877 18.3709 11.6968 16.9902L10.8633 17.5158C10.6941 17.6221 10.4817 17.4618 10.5267 17.2602L11.1424 14.5006C11.1694 14.3764 11.29 14.3008 11.4106 14.3332L11.4088 14.3314ZM18.2098 7.78058C18.2098 7.62216 18.3592 7.51776 18.4978 7.58436C20.5698 8.58525 22.0153 10.7904 22.0153 13.3035C22.0153 14.0757 21.8785 14.812 21.6301 15.4853L22.5338 16.0163C22.7012 16.1153 22.6778 16.3781 22.4942 16.4339L19.974 17.1954C19.8605 17.2296 19.7381 17.1594 19.7039 17.0388L18.9335 14.344C18.8777 14.1477 19.0739 13.9839 19.2431 14.0829L20.0172 14.5384C20.1414 14.1351 20.2098 13.7049 20.2098 13.2549C20.2098 11.7499 19.4537 10.407 18.3178 9.63474C18.2512 9.58974 18.2098 9.51233 18.2098 9.43133V7.78238V7.78058ZM15.3998 6.11183C15.3998 5.90661 15.6374 5.813 15.776 5.96422L17.6716 8.0254C17.7562 8.11721 17.7562 8.26302 17.6716 8.34943L15.776 10.2738C15.6374 10.4142 15.3998 10.3044 15.3998 10.0992V9.00829H15.3908C13.7166 9.32512 12.4205 10.7454 12.2171 12.551C12.2081 12.6374 12.1541 12.713 12.0749 12.7436L10.6131 13.3125C10.4727 13.3665 10.3161 13.2621 10.3125 13.1037C10.3125 13.0676 10.3125 13.0316 10.3125 12.9956C10.3125 9.89397 12.4997 7.40615 15.3277 7.05691C15.3511 7.05331 15.3745 7.05691 15.398 7.06052V6.11183H15.3998Z"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t</g>\n\t\t</svg>\n\t`};const zt={active:{lightBlue:"#C4E6FF",primaryBlue:"#0075FF",secondaryBlue:"#9BD4FF",successGreen:"#1BCE7B"},inactive:{lightBlue:"#F0F0F0",primaryBlue:"#C8C9CD",secondaryBlue:"#C8C9CD",successGreen:"#C8C9CD"}};const jt={name:"PersonIcon",props:{active:{type:Boolean,default:false}},computed:{colors(){return this.active?zt.active:zt.inactive}},template:`\n\t\t<svg\n\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\twidth="71"\n\t\t\theight="67"\n\t\t\tviewBox="0 0 71 67"\n\t\t\tfill="none"\n\t\t>\n\t\t\t<g opacity="0.8">\n\t\t\t\t<path\n\t\t\t\t\td="M15.2749 17.5718C15.2749 14.8644 17.3577 12.724 19.9013 12.7906L51.5805 13.6078C53.7929 13.6655 55.5715 15.7302 55.5715 18.2217V45.8523C55.5715 48.3437 53.7929 50.4571 51.5805 50.5741L19.9013 52.2447C17.3559 52.3797 15.2749 50.2951 15.2749 47.5877V17.5718Z"\n\t\t\t\t\t:fill="colors.lightBlue"\n\t\t\t\t/>\n\t\t\t</g>\n\t\t\t<path\n\t\t\t\topacity="0.5"\n\t\t\t\td="M26.2736 39.6436C26.2736 39.3952 26.549 39.2494 26.7362 39.3988L27.2439 39.8074V40.0649H27.3033C27.4563 40.0595 27.5805 40.1891 27.5805 40.3547C27.5805 40.5203 27.4563 40.6571 27.3033 40.6625H27.2439V40.9235L26.7362 41.361C26.5508 41.5212 26.2736 41.3934 26.2736 41.145V40.6823C26.1134 40.6769 25.9568 40.6607 25.8038 40.6319C25.6525 40.6049 25.5535 40.4483 25.5841 40.2863C25.6147 40.1225 25.7606 40.0127 25.9136 40.0415C26.0324 40.0631 26.153 40.0775 26.2754 40.0829V39.6418L26.2736 39.6436ZM29.6633 40.5923L28.8784 40.6157C28.7254 40.6211 28.6012 40.4897 28.6012 40.3259C28.6012 40.1621 28.7254 40.0235 28.8784 40.0199L29.6633 39.9965V40.5923ZM23.5536 38.6175C23.6832 38.5221 23.8578 38.5545 23.9442 38.6895C24.171 39.0442 24.4608 39.3484 24.7993 39.5806L24.8425 39.6184C24.9343 39.7156 24.9505 39.8722 24.8767 39.9947C24.7903 40.1351 24.6157 40.1765 24.486 40.0883L24.3384 39.9821C24.0018 39.7246 23.7084 39.4042 23.4744 39.0388C23.3879 38.902 23.4221 38.7147 23.5518 38.6175H23.5536ZM23.1395 35.8381C23.2961 35.8345 23.4221 35.9677 23.4221 36.1333V36.8606C23.4221 37.082 23.4419 37.298 23.4816 37.5068L23.487 37.568C23.487 37.7085 23.3933 37.8363 23.2583 37.8669C23.1053 37.9029 22.9559 37.8003 22.9271 37.6382L22.8965 37.451C22.8695 37.2638 22.8569 37.0694 22.8569 36.8732V36.1441C22.8569 35.9767 22.9829 35.8399 23.1395 35.8363V35.8381ZM23.1395 32.9236C23.2961 32.9218 23.4221 33.055 23.4221 33.2207V34.677L23.4167 34.7382C23.3897 34.8768 23.2763 34.9812 23.1395 34.9848C23.0027 34.9866 22.8893 34.8858 22.8623 34.749L22.8569 34.6878V33.2297C22.8569 33.0622 22.9829 32.9254 23.1395 32.9236ZM23.9136 30.3584C23.9136 30.695 23.7102 30.9831 23.4221 31.1001V31.7661L23.4167 31.8273C23.3897 31.9641 23.2763 32.0704 23.1395 32.0722C23.0027 32.0722 22.8893 31.9713 22.8623 31.8345L22.8569 31.7733V31.0983C22.5797 30.9831 22.3853 30.7022 22.3853 30.3728L23.9136 30.3584Z"\n\t\t\t\t:fill="colors.primaryBlue"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M18.7524 21.2727C18.7524 19.5968 19.8703 18.2539 21.2403 18.2737L46.8331 18.6553C48.0608 18.6733 49.0527 19.9658 49.0527 21.5409V27.2709C49.0527 28.846 48.0626 30.1331 46.8331 30.1439L21.2403 30.3797C19.8685 30.3923 18.7524 29.044 18.7524 27.3663V21.2709V21.2727Z"\n\t\t\t\tfill="white"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\topacity="0.5"\n\t\t\t\td="M24.583 24.3347C24.583 23.6686 25.0733 23.1322 25.6766 23.1358L43.4199 23.233C43.9781 23.2366 44.4301 23.755 44.4301 24.3941C44.4301 25.0331 43.9781 25.548 43.4199 25.548L25.6766 25.5408C25.0733 25.5408 24.583 25.0007 24.583 24.3365V24.3347Z"\n\t\t\t\t:fill="colors.secondaryBlue"\n\t\t\t\tfill-opacity="var(--opacity-80)"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M27.2441 37.4979C27.2441 35.849 28.3242 34.4934 29.6492 34.47L50.3996 34.1028C51.6093 34.0812 52.585 35.3323 52.585 36.8967V42.5834C52.585 44.1477 51.6093 45.4564 50.3996 45.5068L29.6492 46.3763C28.3242 46.4321 27.2441 45.1414 27.2441 43.4924V37.4997V37.4979Z"\n\t\t\t\tfill="white"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\topacity="0.5"\n\t\t\t\td="M38.6587 40.1545C38.6587 39.5083 39.1375 38.9736 39.7244 38.9574L48.5362 38.7162C49.1014 38.7 49.5587 39.2004 49.5587 39.8305C49.5587 40.4606 49.1014 40.988 48.5362 41.006L39.7244 41.2904C39.1357 41.3102 38.6587 40.8008 38.6587 40.1563V40.1545Z"\n\t\t\t\t:fill="colors.secondaryBlue"\n\t\t\t\tfill-opacity="0.8"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\topacity="0.7"\n\t\t\t\tfill-rule="evenodd"\n\t\t\t\tclip-rule="evenodd"\n\t\t\t\td="M33.2891 44.2326C33.2891 44.2321 33.2895 44.2317 33.29 44.2317C35.2698 44.1556 36.8624 42.3556 36.8624 40.2084C36.8624 38.0608 35.2693 36.356 33.2891 36.3992C31.3089 36.4424 29.6636 38.2444 29.6636 40.4244C29.6636 42.6041 31.2922 44.3068 33.2882 44.2336C33.2887 44.2336 33.2891 44.2331 33.2891 44.2326Z"\n\t\t\t\t:fill="colors.successGreen"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tfill-rule="evenodd"\n\t\t\t\tclip-rule="evenodd"\n\t\t\t\td="M35.057 38.7832C34.9022 38.6194 34.652 38.6248 34.4971 38.7976L32.7708 40.7274L32.0795 39.9965C31.9229 39.8309 31.6691 39.8381 31.5125 40.0127C31.3559 40.1873 31.3559 40.4628 31.5125 40.6284L32.4882 41.6581C32.6448 41.8219 32.8968 41.8147 33.0516 41.6401L35.057 39.3953C35.2118 39.2224 35.2118 38.9488 35.057 38.785V38.7832Z"\n\t\t\t\tfill="white"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M47.9009 41.2902C47.9009 38.7574 49.7244 36.662 51.9548 36.6116L62.2716 36.3739C64.3849 36.3253 66.0843 38.2605 66.0843 40.6961V52.2712C66.0843 54.7068 64.3849 56.7968 62.2716 56.939L51.9548 57.6392C49.7244 57.7904 47.9009 55.8607 47.9009 53.3278V41.292V41.2902Z"\n\t\t\t\t:fill="colors.primaryBlue"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M65.4675 52.2717V40.6964C65.4675 38.584 64.0607 37.0506 62.4428 36.992L62.2855 36.9905L51.9688 37.2284C50.1397 37.2697 48.5174 39.0223 48.5174 41.2903V53.3278C48.5174 55.5828 50.1133 57.1459 51.9131 57.0239L62.2298 56.3238L62.3901 56.308C64.04 56.0986 65.4673 54.3931 65.4675 52.2717ZM66.084 52.2717L66.0795 52.4983C65.9779 54.8355 64.3187 56.8011 62.2712 56.9389L51.9545 57.6397L51.7468 57.6472C49.6809 57.6683 48.0116 55.9013 47.9061 53.5635L47.9009 53.3278V41.2903C47.9009 38.8368 49.6122 36.7937 51.7468 36.6224L51.9545 36.6119L62.2712 36.374L62.4684 36.3755C64.4895 36.4472 66.084 38.3369 66.084 40.6964V52.2717Z"\n\t\t\t\tfill="white"\n\t\t\t\tfill-opacity="0.18"\n\t\t\t/>\n\t\t\t<g filter="url(#filter1_d_2398_58856)">\n\t\t\t\t<path\n\t\t\t\t\td="M55.5823 41.3313C55.5985 41.3115 55.6183 41.2917 55.6381 41.2755C55.7929 41.1476 56.0143 41.0144 56.2772 40.9082C56.5346 40.8038 56.8064 40.7372 57.0476 40.73C57.9189 40.7012 58.549 41.0936 58.9594 41.6877C59.368 42.2853 59.5588 43.0936 59.5444 43.9073C59.53 44.721 59.3068 45.5472 58.882 46.1755C58.4625 46.8073 57.8433 47.2394 57.0476 47.2754C55.7119 47.3366 54.882 46.2583 54.621 44.9442C54.369 43.6625 54.675 42.1647 55.5823 41.3295V41.3313Z"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td="M57.0548 48.4957C59.0565 48.3985 61.2599 49.0267 61.4328 51.9034C61.4328 52.114 61.2833 52.2922 61.0997 52.303L52.9306 52.7729C52.7398 52.7837 52.585 52.6198 52.585 52.4056C52.765 49.4552 55.035 48.5947 57.0548 48.4957Z"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t/>\n\t\t\t</g>\n\t\t\t<path\n\t\t\t\td="M5.479 6.25911C5.479 3.49227 7.6554 1.35548 10.3142 1.48509L22.0171 2.05574C24.5301 2.17815 26.5499 4.42835 26.5499 7.08359V19.0997C26.5499 21.7549 24.5301 23.8953 22.0171 23.8827L10.3142 23.8215C7.6554 23.8071 5.479 21.5533 5.479 18.7864V6.25911Z"\n\t\t\t\t:fill="colors.successGreen"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M5.479 18.7867V6.25913C5.47916 3.49251 7.65539 1.3556 10.314 1.48508L22.0173 2.05643C24.5302 2.17897 26.5497 4.42901 26.5497 7.08416V19.0998L26.5437 19.3475C26.4228 21.8869 24.4516 23.895 22.0173 23.8829L22.0203 23.2664C24.157 23.277 25.9332 21.4487 25.9332 19.0998V7.08416C25.9332 4.79933 24.2507 2.89929 22.1882 2.68725L21.9872 2.67219L10.2839 2.10159C7.99746 1.99029 6.09568 3.82433 6.09552 6.25913V18.7867C6.09552 21.2337 8.01739 23.193 10.3178 23.2054L22.0203 23.2664L22.0173 23.8829L10.314 23.8219C7.73846 23.8079 5.61533 21.6924 5.48503 19.0449L5.479 18.7867Z"\n\t\t\t\tfill="white"\n\t\t\t\tfill-opacity="0.24"\n\t\t\t/>\n\t\t\t<g filter="url(#filter2_d_2398_58856)">\n\t\t\t\t<path\n\t\t\t\t\td="M11.4088 14.3314L14.0622 15.0298C14.2548 15.0802 14.2963 15.3467 14.1306 15.4529L13.299 15.9767C14.037 16.8084 15.0811 17.3358 16.2332 17.3556C16.8021 17.3664 17.3403 17.253 17.8282 17.0388C17.9164 16.9992 18.0226 17.0226 18.0874 17.1L19.0577 18.2485C19.1495 18.3565 19.1261 18.5239 19.0055 18.5905C18.1846 19.0478 17.2413 19.2998 16.235 19.2854C14.4205 19.2602 12.7877 18.3709 11.6968 16.9902L10.8633 17.5158C10.6941 17.6221 10.4817 17.4618 10.5267 17.2602L11.1424 14.5006C11.1694 14.3764 11.29 14.3008 11.4106 14.3332L11.4088 14.3314ZM18.2098 7.78058C18.2098 7.62216 18.3592 7.51776 18.4978 7.58436C20.5698 8.58525 22.0153 10.7904 22.0153 13.3035C22.0153 14.0757 21.8785 14.812 21.6301 15.4853L22.5338 16.0163C22.7012 16.1153 22.6778 16.3781 22.4942 16.4339L19.974 17.1954C19.8605 17.2296 19.7381 17.1594 19.7039 17.0388L18.9335 14.344C18.8777 14.1477 19.0739 13.9839 19.2431 14.0829L20.0172 14.5384C20.1414 14.1351 20.2098 13.7049 20.2098 13.2549C20.2098 11.7499 19.4537 10.407 18.3178 9.63474C18.2512 9.58974 18.2098 9.51233 18.2098 9.43133V7.78238V7.78058ZM15.3998 6.11183C15.3998 5.90661 15.6374 5.813 15.776 5.96422L17.6716 8.0254C17.7562 8.11721 17.7562 8.26302 17.6716 8.34943L15.776 10.2738C15.6374 10.4142 15.3998 10.3044 15.3998 10.0992V9.00829H15.3908C13.7166 9.32512 12.4205 10.7454 12.2171 12.551C12.2081 12.6374 12.1541 12.713 12.0749 12.7436L10.6131 13.3125C10.4727 13.3665 10.3161 13.2621 10.3125 13.1037C10.3125 13.0676 10.3125 13.0316 10.3125 12.9956C10.3125 9.89397 12.4997 7.40615 15.3277 7.05691C15.3511 7.05331 15.3745 7.05691 15.398 7.06052V6.11183H15.3998Z"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t</g>\n\t\t</svg>\n\t`};const Xt={active:{lightBlue:"#C4E6FF",primaryBlue:"#0075FF",secondaryBlue:"#9BD4FF",successGreen:"#1BCE7B"},inactive:{lightBlue:"#F0F0F0",primaryBlue:"#C8C9CD",secondaryBlue:"#C8C9CD",successGreen:"#C8C9CD"}};const qt={name:"StopIcon",props:{active:{type:Boolean,default:false}},computed:{colors(){return this.active?Xt.active:Xt.inactive}},template:`\n\t\t<svg\n\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\twidth="71"\n\t\t\theight="67"\n\t\t\tviewBox="0 0 71 67"\n\t\t\tfill="none"\n\t\t>\n\t\t\t<g opacity="0.8">\n\t\t\t\t<path\n\t\t\t\t\td="M15.2749 17.5718C15.2749 14.8644 17.3577 12.724 19.9013 12.7906L51.5805 13.6078C53.7929 13.6655 55.5715 15.7302 55.5715 18.2217V45.8523C55.5715 48.3437 53.7929 50.4571 51.5805 50.5741L19.9013 52.2447C17.3559 52.3797 15.2749 50.2951 15.2749 47.5877V17.5718Z"\n\t\t\t\t\t:fill="colors.lightBlue"\n\t\t\t\t/>\n\t\t\t</g>\n\t\t\t<path\n\t\t\t\topacity="0.5"\n\t\t\t\td="M26.2736 39.6436C26.2736 39.3952 26.549 39.2494 26.7362 39.3988L27.2439 39.8074V40.0649H27.3033C27.4563 40.0595 27.5805 40.1891 27.5805 40.3547C27.5805 40.5203 27.4563 40.6571 27.3033 40.6625H27.2439V40.9235L26.7362 41.361C26.5508 41.5212 26.2736 41.3934 26.2736 41.145V40.6823C26.1134 40.6769 25.9568 40.6607 25.8038 40.6319C25.6525 40.6049 25.5535 40.4483 25.5841 40.2863C25.6147 40.1225 25.7606 40.0127 25.9136 40.0415C26.0324 40.0631 26.153 40.0775 26.2754 40.0829V39.6418L26.2736 39.6436ZM29.6633 40.5923L28.8784 40.6157C28.7254 40.6211 28.6012 40.4897 28.6012 40.3259C28.6012 40.1621 28.7254 40.0235 28.8784 40.0199L29.6633 39.9965V40.5923ZM23.5536 38.6175C23.6832 38.5221 23.8578 38.5545 23.9442 38.6895C24.171 39.0442 24.4608 39.3484 24.7993 39.5806L24.8425 39.6184C24.9343 39.7156 24.9505 39.8722 24.8767 39.9947C24.7903 40.1351 24.6157 40.1765 24.486 40.0883L24.3384 39.9821C24.0018 39.7246 23.7084 39.4042 23.4744 39.0388C23.3879 38.902 23.4221 38.7147 23.5518 38.6175H23.5536ZM23.1395 35.8381C23.2961 35.8345 23.4221 35.9677 23.4221 36.1333V36.8606C23.4221 37.082 23.4419 37.298 23.4816 37.5068L23.487 37.568C23.487 37.7085 23.3933 37.8363 23.2583 37.8669C23.1053 37.9029 22.9559 37.8003 22.9271 37.6382L22.8965 37.451C22.8695 37.2638 22.8569 37.0694 22.8569 36.8732V36.1441C22.8569 35.9767 22.9829 35.8399 23.1395 35.8363V35.8381ZM23.1395 32.9236C23.2961 32.9218 23.4221 33.055 23.4221 33.2207V34.677L23.4167 34.7382C23.3897 34.8768 23.2763 34.9812 23.1395 34.9848C23.0027 34.9866 22.8893 34.8858 22.8623 34.749L22.8569 34.6878V33.2297C22.8569 33.0622 22.9829 32.9254 23.1395 32.9236ZM23.9136 30.3584C23.9136 30.695 23.7102 30.9831 23.4221 31.1001V31.7661L23.4167 31.8273C23.3897 31.9641 23.2763 32.0704 23.1395 32.0722C23.0027 32.0722 22.8893 31.9713 22.8623 31.8345L22.8569 31.7733V31.0983C22.5797 30.9831 22.3853 30.7022 22.3853 30.3728L23.9136 30.3584Z"\n\t\t\t\t:fill="colors.primaryBlue"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M18.7524 21.2727C18.7524 19.5968 19.8703 18.2539 21.2403 18.2737L46.8331 18.6553C48.0608 18.6733 49.0527 19.9658 49.0527 21.5409V27.2709C49.0527 28.846 48.0626 30.1331 46.8331 30.1439L21.2403 30.3797C19.8685 30.3923 18.7524 29.044 18.7524 27.3663V21.2709V21.2727Z"\n\t\t\t\tfill="white"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\topacity="0.5"\n\t\t\t\td="M24.583 24.3347C24.583 23.6686 25.0733 23.1322 25.6766 23.1358L43.4199 23.233C43.9781 23.2366 44.4301 23.755 44.4301 24.3941C44.4301 25.0331 43.9781 25.548 43.4199 25.548L25.6766 25.5408C25.0733 25.5408 24.583 25.0007 24.583 24.3365V24.3347Z"\n\t\t\t\t:fill="colors.secondaryBlue"\n\t\t\t\tfill-opacity="var(--opacity-80)"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M27.2441 37.4979C27.2441 35.849 28.3242 34.4934 29.6492 34.47L50.3996 34.1028C51.6093 34.0812 52.585 35.3323 52.585 36.8967V42.5834C52.585 44.1477 51.6093 45.4564 50.3996 45.5068L29.6492 46.3763C28.3242 46.4321 27.2441 45.1414 27.2441 43.4924V37.4997V37.4979Z"\n\t\t\t\tfill="white"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\topacity="0.5"\n\t\t\t\td="M38.6587 40.1545C38.6587 39.5083 39.1375 38.9736 39.7244 38.9574L48.5362 38.7162C49.1014 38.7 49.5587 39.2004 49.5587 39.8305C49.5587 40.4606 49.1014 40.988 48.5362 41.006L39.7244 41.2904C39.1357 41.3102 38.6587 40.8008 38.6587 40.1563V40.1545Z"\n\t\t\t\t:fill="colors.secondaryBlue"\n\t\t\t\tfill-opacity="0.8"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\topacity="0.7"\n\t\t\t\tfill-rule="evenodd"\n\t\t\t\tclip-rule="evenodd"\n\t\t\t\td="M33.2891 44.2326C33.2891 44.2321 33.2895 44.2317 33.29 44.2317C35.2698 44.1556 36.8624 42.3556 36.8624 40.2084C36.8624 38.0608 35.2693 36.356 33.2891 36.3992C31.3089 36.4424 29.6636 38.2444 29.6636 40.4244C29.6636 42.6041 31.2922 44.3068 33.2882 44.2336C33.2887 44.2336 33.2891 44.2331 33.2891 44.2326Z"\n\t\t\t\t:fill="colors.successGreen"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\tfill-rule="evenodd"\n\t\t\t\tclip-rule="evenodd"\n\t\t\t\td="M35.057 38.7832C34.9022 38.6194 34.652 38.6248 34.4971 38.7976L32.7708 40.7274L32.0795 39.9965C31.9229 39.8309 31.6691 39.8381 31.5125 40.0127C31.3559 40.1873 31.3559 40.4628 31.5125 40.6284L32.4882 41.6581C32.6448 41.8219 32.8968 41.8147 33.0516 41.6401L35.057 39.3953C35.2118 39.2224 35.2118 38.9488 35.057 38.785V38.7832Z"\n\t\t\t\tfill="white"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\td="M47.9009 41.2902C47.9009 38.7574 49.7244 36.662 51.9548 36.6116L62.2716 36.3739C64.3849 36.3253 66.0843 38.2605 66.0843 40.6961V52.2712C66.0843 54.7068 64.3849 56.7968 62.2716 56.939L51.9548 57.6392C49.7244 57.7904 47.9009 55.8607 47.9009 53.3278V41.292V41.2902Z"\n\t\t\t\t:fill="colors.primaryBlue"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\td="M47.8608 41.2382C47.8608 38.709 49.6808 36.6172 51.9076 36.5668L62.2063 36.331C64.3161 36.2824 66.0119 38.2157 66.0119 40.6478V52.2066C66.0119 54.6386 64.3161 56.725 62.2063 56.8672L51.9076 57.5621C49.6808 57.7115 47.8608 55.7853 47.8608 53.2561V41.2364V41.2382Z"\n\t\t\t\t:fill="colors.primaryBlue"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<g filter="url(#filter1_d_2398_58856)">\n\t\t\t\t<path\n\t\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\t\tfill-rule="evenodd"\n\t\t\t\t\tclip-rule="evenodd"\n\t\t\t\t\td="M59.0084 45.4018C59.0084 45.3644 59.0119 45.327 59.0191 45.2897C59.0725 45.0405 59.286 44.8803 59.4978 44.9337L61.3275 45.3947C61.5019 45.4392 61.6229 45.6171 61.6229 45.8289V50.072L62.091 50.0471C62.1907 50.0418 62.2726 50.1308 62.2726 50.2465V51.3589C62.2726 51.4745 62.1907 51.5724 62.091 51.5778L51.8482 52.1562C51.7431 52.1616 51.6577 52.0708 51.6577 51.9533V50.8142C51.6577 50.6968 51.7431 50.5953 51.8482 50.59L52.3358 50.5633V42.9812C52.3358 42.5968 52.5761 42.2622 52.9036 42.1892L57.5827 41.1445C57.6183 41.1373 57.6539 41.132 57.6895 41.1302C58.0544 41.1178 58.3498 41.4541 58.3498 41.8813V50.2447L59.0084 50.2091V45.4018ZM55.2369 50.3337V47.9434L54.0356 48.0003V50.3977L55.2369 50.3337ZM57.0577 49.2159V47.8562L55.8652 47.9131V49.2765L57.0577 49.2159ZM60.8612 47.6088L59.6883 47.6639V49.0166L60.8612 48.9579V47.6088ZM57.0577 43.7074L55.8652 43.7537V45.117L57.0577 45.0672V43.7074ZM55.2369 43.7786L54.0356 43.8249V45.1936L55.2369 45.1437V43.7786ZM57.0577 45.7827L55.8652 45.8343V47.1976L57.0577 47.1425V45.7827ZM55.2369 45.861L54.0356 45.9126V47.2813L55.2369 47.2261V45.861Z"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t</g>\n\t\t\t<path\n\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\td="M65.3957 52.2278V40.6525C65.3957 38.54 63.9889 37.0067 62.3711 36.9481L62.2137 36.9466L51.8971 37.1845C50.068 37.2258 48.4456 38.9784 48.4456 41.2464V53.2839C48.4456 55.5388 50.0415 57.102 51.8413 56.98L62.158 56.2799L62.3184 56.2641C63.9682 56.0547 65.3955 54.3492 65.3957 52.2278ZM66.0122 52.2278L66.0077 52.4543C65.9062 54.7916 64.2469 56.7571 62.1994 56.8949L51.8828 57.5957L51.675 57.6033C49.6091 57.6243 47.9398 55.8574 47.8344 53.5195L47.8291 53.2839V41.2464C47.8291 38.7928 49.5404 36.7497 51.675 36.5785L51.8828 36.568L62.1994 36.3301L62.3966 36.3316C64.4177 36.4032 66.0122 38.293 66.0122 40.6525V52.2278Z"\n\t\t\t\tfill="white"\n\t\t\t\tfill-opacity="0.18"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\td="M5.479 6.24833C5.479 3.48688 7.6482 1.35549 10.3016 1.4851L21.9721 2.05395C24.4797 2.17637 26.4923 4.42116 26.4923 7.0692V19.0547C26.4923 21.7027 24.4779 23.8377 21.9721 23.8251L10.3016 23.7639C7.65 23.7495 5.479 21.5011 5.479 18.7414L5.479 6.24833Z"\n\t\t\t\t:fill="colors.successGreen"\n\t\t\t\tfill-opacity="0.78"\n\t\t\t/>\n\t\t\t<path\n\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\td="M5.479 18.7415V6.24861C5.47903 3.48719 7.64856 1.35549 10.302 1.4851L21.9721 2.05419C24.4797 2.17663 26.4925 4.42186 26.4925 7.06988V19.0547L26.4865 19.3016C26.366 21.8343 24.3997 23.8379 21.9721 23.8257L21.9751 23.2085C24.1046 23.2192 25.876 21.3965 25.876 19.0547V7.06988C25.876 4.79165 24.1994 2.89728 22.1423 2.68577L21.942 2.66996L10.2719 2.10162C7.99098 1.9902 6.09555 3.81866 6.09552 6.24861V18.7415C6.09552 21.1815 8.01184 23.135 10.305 23.1475L21.9751 23.2085L21.9721 23.8257L10.302 23.764C7.73322 23.75 5.61488 21.6398 5.48503 18.999L5.479 18.7415Z"\n\t\t\t\tfill="white"\n\t\t\t\tfill-opacity="0.24"\n\t\t\t/>\n\t\t\t<g\n\t\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\t\tfilter="url(#filter1_d_2398_60753)"\n\t\t\t>\n\t\t\t\t<path\n\t\t\t\t\td="M11.3891 14.2954L11.3928 14.2969L13.2537 14.7869C13.4103 15.0803 13.6068 15.3503 13.8318 15.5879L13.277 15.9387C14.0132 16.7667 15.0539 17.2941 16.2023 17.314C16.7693 17.3248 17.3061 17.212 17.7921 16.9978C17.8802 16.9582 17.9847 16.9811 18.0495 17.0565L19.0161 18.2015C19.1079 18.3095 19.0847 18.4774 18.9642 18.544C18.1451 18.9994 17.2052 19.2509 16.2007 19.2365C14.3917 19.2113 12.7624 18.3244 11.6751 16.9474L10.8456 17.4713C10.6764 17.5775 10.4634 17.4169 10.5083 17.2154L11.1226 14.4625C11.1497 14.3385 11.2704 14.2648 11.3891 14.2954Z"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td="M18.1753 7.76436C18.1753 7.60604 18.325 7.50141 18.4636 7.56789C20.5301 8.56514 21.9721 10.767 21.9722 13.2709C21.9722 14.0413 21.8349 14.7764 21.5883 15.4479L22.4901 15.977C22.6575 16.076 22.6327 16.3367 22.451 16.3926L19.9382 17.1521C19.8248 17.1863 19.7037 17.1162 19.6695 16.9955L19.0899 14.9721C19.2303 14.7237 19.3422 14.4556 19.4196 14.1712L19.9811 14.5024C20.1053 14.101 20.1716 13.6708 20.1716 13.2227C20.1716 11.7214 19.4176 10.3821 18.2837 9.61165C18.217 9.56665 18.1753 9.48866 18.1753 9.40765V7.76436Z"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td="M17.4315 11.2376C17.723 11.2464 17.9547 11.4857 17.9547 11.7774V14.5144C17.9547 14.8162 17.7069 15.0596 17.4052 15.0542L14.9798 15.0105C14.6857 15.005 14.4506 14.7649 14.4506 14.4708V11.7043C14.4506 11.4 14.7019 11.1554 15.0061 11.1646L17.4315 11.2376Z"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\td="M15.3712 6.09924C15.3712 5.89407 15.6067 5.8023 15.7453 5.9517L17.6355 8.00751C17.72 8.09925 17.7199 8.24478 17.6355 8.3312L16.3844 9.60036C16.3232 9.59496 16.2637 9.59162 16.2007 9.58982C15.9145 9.58082 15.6354 9.60812 15.3689 9.67112V8.98836H15.3599C13.6912 9.30522 12.3969 10.7203 12.1953 12.5203C12.1863 12.6067 12.1326 12.6809 12.0553 12.7115L10.5987 13.2784C10.4583 13.3324 10.3016 13.228 10.2998 13.0714V12.9652C10.2998 9.87256 12.4818 7.39018 15.3027 7.04095C15.326 7.03741 15.3497 7.04113 15.3712 7.04472V6.09924Z"\n\t\t\t\t\tfill="white"\n\t\t\t\t\tfill-opacity="0.9"\n\t\t\t\t\tshape-rendering="crispEdges"\n\t\t\t\t/>\n\t\t\t</g>\n\t\t</svg>\n\t`};const Kt={name:"connection-aux",components:{Connection:h.Connection,DeleteConnectionBtn:h.DeleteConnectionBtn},props:{connection:{type:Object,required:true}},template:`\n\t\t<Connection\n\t\t\t:stroke-dasharray="5"\n\t\t\t:connection="connection"\n\t\t\t:key="connection.id"\n\t\t>\n\t\t\t<template #default="{ isDisabled }">\n\t\t\t\t<DeleteConnectionBtn\n\t\t\t\t\t:connectionId="connection.id"\n\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</Connection>\n\t`};const Wt=async(t,e)=>{const n=await b.ajax.runAction(`bizprocdesigner.v2.${t}`,{method:"POST",json:e});if(n.status==="success"){return n.data}return null};const Yt=Object.freeze({loadSettings:async t=>{const e=await Wt("Activity.Complex.loadSettings",{activity:t});if(!e){return null}return e},saveSettings:async(t,e,n)=>{const o={...t,rules:Object.fromEntries(t.rules),actions:Object.fromEntries(t.actions)};const i=await Wt("Activity.Complex.saveSettings",{saveSettingsRequest:o,activity:e,documentType:n});if(!(i!=null&&i.activity)){return null}return i.activity},saveRuleSettings:async(t,e)=>{const n=await Wt("Activity.Complex.saveRule",{portRule:t,documentType:e});if(!n){return null}return n}});const Jt=Object.freeze({IF_CONDITION:"condition:if",AND_CONDITION:"condition:and",OR_CONDITION:"condition:or",ACTION:"action",OUTPUT:"output"});const Qt=Object.freeze({[Jt.IF_CONDITION]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_IF_CONDITION",[Jt.AND_CONDITION]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_AND_CONDITION",[Jt.OR_CONDITION]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_OR_CONDITION",[Jt.ACTION]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ACTION",[Jt.OUTPUT]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_OUTPUT"});const te=Object.freeze({[Jt.IF_CONDITION]:"condition",[Jt.AND_CONDITION]:"condition",[Jt.OR_CONDITION]:"condition",[Jt.ACTION]:"action",[Jt.OUTPUT]:"output"});const ee=Object.freeze({equal:"=",notEqual:"!=",empty:"empty",notEmpty:"!empty",contain:"contain",notContain:"!contain",in:"in",notIn:"!in",greaterThan:">",greaterThanOrEqual:">=",lessThan:"<",lessThanOrEqual:"<="});const ne=Object.freeze({DOCUMENT:"Document",CONSTANT:"Constant",PARAMETER:"Template",VARIABLE:"Variable"});const oe=Object.freeze({BEFORE_SUBMIT_EVENT:"BizprocDesigner.NodeSettings.BeforeSubmit"});const ie=t=>{const e=t.reduce(((t,e)=>Math.max(t,parseInt(e.id.slice(1),10))),0)+1;return`i${e}`};const se=(t,e)=>{var n,o;const i=rt();const{object:s,fieldId:l}=e;const a=(t,e)=>[t,e].join(" / ");const r=a(s,l);if(!Object.values(ne).includes(s)){var c,d,u;const[e,n]=(()=>{for(const e of t){const{activity:t}=e;if((t==null?void 0:t.Name)===s){return[e,t]}if(!b.Type.isArrayFilled(t==null?void 0:t.Children)){continue}const n=t.Children.find((t=>t.Name===s));if(n){return[e,n]}}return[null,null]})();if(!e||!n){return r}const o=((c=n.ReturnProperties)!=null?c:[]).find((t=>t.Id===l));if(!o){return r}return a((d=(u=n.Properties)==null?void 0:u.Title)!=null?d:e.node.title,o.Name)}const p=[{key:"PARAMETERS",idKey:"Template",title:b.Loc.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_FIELD_PARAMETER_OBJECT")},{key:"VARIABLES",idKey:"Variable",title:b.Loc.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_FIELD_VARIABLE_OBJECT")},{key:"CONSTANTS",idKey:"Constant",title:b.Loc.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_FIELD_CONSTANT_OBJECT")}];const m=p.find((t=>t.idKey===s));if(!m){return r}const h=(n=((o=i.template[m.key])!=null?o:{})[l])==null?void 0:n.Name;if(h){return a(m.title,h)}return r};const le=(t,e)=>{var n,o,i;if(!e){return b.Loc.getMessage("BIZPROCDESIGNER_EDITOR_TEMPLATE_DOCUMENT")}const[s,l]=e.replaceAll(/^{=|}$/g,"").split(":");if(!b.Type.isStringFilled(s)||!b.Type.isStringFilled(l)){return b.Loc.getMessage("BIZPROCDESIGNER_EDITOR_UNKNOWN_DOCUMENT")}const[a,r]=(()=>{for(const e of t){const{activity:t}=e;if((t==null?void 0:t.Name)===s){return[e,t]}if(!b.Type.isArrayFilled(t==null?void 0:t.Children)){continue}const n=t.Children.find((t=>t.Name===s));if(n){return[e,n]}}return[null,null]})();if(!r){return b.Loc.getMessage("BIZPROCDESIGNER_EDITOR_UNKNOWN_DOCUMENT")}const c=((n=r.ReturnProperties)!=null?n:[]).find((t=>t.Id===l));if(!c){return b.Loc.getMessage("BIZPROCDESIGNER_EDITOR_UNKNOWN_DOCUMENT")}const d=(o=(i=r.Properties)==null?void 0:i.Title)!=null?o:a.node.title;return`${c.Name} (${d})`};const ae=S.defineStore("bizprocdesigner-editor-node-settings",{state:()=>({isLoading:false,isSaving:false,isShown:false,isRuleSettingsShown:false,currentRuleId:"",prevSavedNodeSettings:null,savedBlockInputPorts:null,nodeSettings:null,block:null}),actions:{async fetchNodeSettings(t){this.nodeSettings={title:t.node.title,description:"",rules:new Map,blockId:t.id};this.isLoading=true;const{actions:e,rules:n,fixedDocumentType:o,title:i,description:s}=await Yt.loadSettings(t.activity);if(b.Type.isStringFilled(i)){this.nodeSettings.title=i}this.nodeSettings={...this.nodeSettings,actions:new Map(Object.entries(e)),rules:new Map(Object.entries(n).map((([t,e])=>[t,{...e,isFilled:e.ruleCards.some((t=>{var e;return((e=t.constructions)==null?void 0:e.length)>0}))}]))),fixedDocumentType:o,description:s};this.prevSavedNodeSettings=b.Runtime.clone(this.nodeSettings);this.savedBlockInputPorts=t.ports.input.map((t=>({...t})));this.block=t;this.isLoading=false},isCurrentBlock(t){var e;return((e=this.nodeSettings)==null?void 0:e.blockId)===t},reset(){this.currentRuleId="";this.nodeSettings=null;this.block=null},toggleVisibility(t){this.isShown=t},toggleRuleSettingsVisibility(t){this.isRuleSettingsShown=t},setCurrentRuleId(t){this.currentRuleId=t},addRule(){const t=ie(this.block.ports.input);this.nodeSettings.rules.set(t,{isFilled:false,portId:t,ruleCards:[]});return t},addConstruction(t,e,n){const o={id:nt(),type:e,expression:{title:"",valueId:"",value:""}};if(e===Jt.ACTION){o.expression.value={};o.expression.actionId=""}else{o.expression.operator="";o.expression.field=null}if(e===Jt.OUTPUT){o.expression={portId:null,title:null}}if(n){t.constructions.splice(n,0,o)}else{t.constructions.push(o)}},deleteConstruction(t,e){t.constructions.splice(t.constructions.indexOf(e),1);if(t.constructions.length===0){this.deleteRuleCard(t)}},deleteRuleSettings(t){this.nodeSettings.rules.delete(t);return this.syncOutputPortsWithRules()},selectBooleanType(t,e){Object.assign(t,{type:e})},changeRuleExpression(t,e){Object.assign(t.expression,e)},deleteRuleCard(t){const e=this.nodeSettings.rules.get(this.currentRuleId);e.ruleCards.splice(e.ruleCards.indexOf(t),1)},addRuleCard(){const t=this.nodeSettings.rules.get(this.currentRuleId);const e={id:nt(),constructions:[]};t.ruleCards.push(e);return e},reorder(t){const{draggedId:e,targetId:n,insertion:o,ruleCardId:i}=t;const s=this.nodeSettings.rules.get(this.currentRuleId);let l=s.ruleCards;if(i){const t=s.ruleCards.find((t=>t.id===i));l=t.constructions}const a=l.find((t=>t.id===e));const r=l.find((t=>t.id===n));const c=l.indexOf(a);l.splice(c,1);const d=l.indexOf(r);const u=o==="over"?d:d+1;l.splice(u,0,a)},async savePortRule(t,e){const n=this.nodeSettings.rules.get(t);if(!n){return null}const o=await Yt.saveRuleSettings(n,e);o.isFilled=o.ruleCards.some((t=>{var e;return((e=t.constructions)==null?void 0:e.length)>0}));this.nodeSettings.rules.set(t,o);this.prevSavedNodeSettings.rules.set(t,b.Runtime.clone(o));return this.syncOutputPortsWithRules()},syncOutputPortsWithRules(){if(!this.block){return null}const t=[...this.nodeSettings.rules.values()].flatMap((t=>t.ruleCards.flatMap((t=>t.constructions.filter((t=>t.type===Jt.OUTPUT))))));const e=new Set(this.block.ports.output.map((t=>t.id)));const n=new Set(e);const o=new Map;t.forEach((t=>{const{portId:i,title:s}=t.expression;if(!i||!s){return}const l=e.has(i);if(!l){o.set(i,{portId:i,title:s})}n.delete(i)}));return{outputPortsToAdd:o,outputPortsToDelete:n}},async saveRule(t){const{outputPortsToAdd:e,outputPortsToDelete:n}=await this.savePortRule(this.currentRuleId,t);this.toggleRuleSettingsVisibility(false);return{outputPortsToAdd:e,outputPortsToDelete:n}},async saveForm(t){try{return await Yt.saveSettings(this.nodeSettings,this.block.activity,t)}catch(t){console.error(t);throw t}},discardFormSettings(){this.nodeSettings=b.Runtime.clone(this.prevSavedNodeSettings)},discardRuleSettings(){const{rules:t}=this.prevSavedNodeSettings;if(!t.has(this.currentRuleId)){const t=this.nodeSettings.rules.get(this.currentRuleId);t.isFilled=false;t.ruleCards=[];return}const e=b.Runtime.clone(t.get(this.currentRuleId));this.nodeSettings.rules.set(this.currentRuleId,e)},updateSettings(t){this.nodeSettings={...this.nodeSettings,...t}}}});const re={name:"node-settings-layout",components:{BIcon:f.BIcon},props:{isLoading:{type:Boolean,required:true},isSaving:{type:Boolean,required:true},isShown:{type:Boolean,required:true}},emits:["close"],setup(){const{getMessage:t}=N();return{getMessage:t}},template:`\n\t\t<div\n\t\t\tv-if="isShown"\n\t\t\tclass="node-settings"\n\t\t\t:class="{ '--saving': isSaving, '--loading': isLoading }"\n\t\t>\n\t\t\t<template v-if="!isLoading">\n\t\t\t\t<div class="node-settings__header">\n\t\t\t\t\t<span>{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_TITLE') }}</span>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tclass="node-settings__header_close-icon"\n\t\t\t\t\t\tname="cross-m"\n\t\t\t\t\t\t:size="20"\n\t\t\t\t\t\t:data-test-id="$testId('complexNodeSettingsClose')"\n\t\t\t\t\t\tcolor="#828b95"\n\t\t\t\t\t\t@click="$emit('close')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<slot />\n\t\t\t</template>\n\t\t\t<div class="node-settings__footer">\n\t\t\t\t<slot\n\t\t\t\t\tv-if="!isLoading"\n\t\t\t\t\tname="actions"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const ce={name:"node-settings-variable",props:{variableName:{type:String,required:true},variableValue:{type:String,required:true}},template:`\n\t\t<div class="node-settings-variable">\n\t\t\t<span class="node-settings-variable_name">\n\t\t\t\t{{ variableName }}\n\t\t\t</span>\n\t\t\t<span class="node-settings-variable_eq">=</span>\n\t\t\t<span class="node-settings-variable_value">\n\t\t\t\t{{ variableValue }}\n\t\t\t</span>\n\t\t</div>\n\t`};const de={name:"node-settings-rule",components:{BIcon:f.BIcon},props:{port:{type:Object,required:true},nodeSettings:{type:Object,required:true},connectedBlocks:{type:Object,required:true}},emits:["showRuleConstructions","deleteRule"],setup(){const{getMessage:t}=N();return{getMessage:t}},computed:{ruleId(){return this.port.id},rule(){return this.nodeSettings.rules.get(this.ruleId)},isRuleFilled(){var t;return(t=this.rule)==null?void 0:t.isFilled},constructionLabels(){return Qt},constructionOperators(){return ee},generalConstructionTypes(){return te}},methods:{onRuleClick(){this.$emit("showRuleConstructions",this.ruleId)},onDeleteRule(){this.$emit("deleteRule",this.ruleId)},getExpressionTitle({expression:t,type:e}){const{actions:n}=this.nodeSettings;if(e===te.action){if(!t.actionId){return""}return n.get(t.actionId).title}if(e===te.output||!t.field){return""}return se(this.connectedBlocks,t.field)},getExpressionValue({expression:{value:t,title:e},type:n}){if(n===te.output){return e}return t}},template:`\n\t\t<div\n\t\t\tclass="node-settings-rule"\n\t\t\t:data-test-id="$testId('complexNodeSettingsRulePreview', ruleId)"\n\t\t\t@click="onRuleClick"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tclass="node-settings-rule__dnd-icon"\n\t\t\t\tname="drag-s"\n\t\t\t\tcolor="#828b95"\n\t\t\t/>\n\t\t\t<span class="node-settings-rule__title">\n\t\t\t\t{{ port.title }}\n\t\t\t</span>\n\t\t\t<div\n\t\t\t\tv-if="isRuleFilled"\n\t\t\t\tclass="node-settings-rule__card-container"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tv-for="ruleCard in rule.ruleCards"\n\t\t\t\t\t:key="ruleCard.id"\n\t\t\t\t\tclass="node-settings-rule__card"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-for="construction in ruleCard.constructions"\n\t\t\t\t\t\t:key="construction.id"\n\t\t\t\t\t\tclass="node-settings-rule__construction"\n\t\t\t\t\t\t:class="['--' + generalConstructionTypes[construction.type]]"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="node-settings-rule__construction_type">\n\t\t\t\t\t\t\t{{ getMessage(constructionLabels[construction.type]) }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="node-settings-rule__expression-part">\n\t\t\t\t\t\t\t{{ getExpressionTitle(construction) }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-if="construction.expression.operator"\n\t\t\t\t\t\t\tclass="node-settings-rule__expression-part"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ constructionOperators[construction.expression.operator] }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-if="generalConstructionTypes[construction.type] !== generalConstructionTypes.action"\n\t\t\t\t\t\t\tclass="node-settings-rule__expression-part"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ getExpressionValue(construction) }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<span\n\t\t\t\tclass="node-settings-rule__construction --empty"\n\t\t\t\tv-else\n\t\t\t>\n\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_RULE_EMPTY') }}\n\t\t\t</span>\n\t\t\t<div class="node-settings-rule__actions">\n\t\t\t\t<BIcon\n\t\t\t\t\t:size="20"\n\t\t\t\t\tclass="node-settings-rule__edit-icon"\n\t\t\t\t\tname="pencil-40"\n\t\t\t\t\tcolor="#c9ccd0"\n\t\t\t\t/>\n\t\t\t\t<BIcon\n\t\t\t\t\tclass="node-settings-rule__close-icon"\n\t\t\t\t\tname="cross-m"\n\t\t\t\t\t:size="20"\n\t\t\t\t\t:data-test-id="$testId('complexNodeSettingsRulePreview', ruleId, 'delete')"\n\t\t\t\t\tcolor="#c9ccd0"\n\t\t\t\t\t@click.stop="onDeleteRule"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const ue=Object.freeze({ruleConstruction:"rule-construction",ruleCard:"rule-card"});const pe=Object.freeze({over:"over",under:"under"});const me=t=>{const e=t.cloneNode(true);b.Dom.style(e,{position:"fixed",left:"-100%",top:"-100%"});b.Dom.append(e,t.parentElement);return e};const he=(t,e)=>{const n=e.target.closest(`[data-name=${t.dataset.name}]`);const o=n&&n!==t&&n.parentElement===t.parentElement;if(o){return n}return null};const ge=(t,e)=>{const{dataTransfer:n,currentTarget:o,target:i}=t;const s=i.closest(`[data-name=${ue.ruleConstruction}], [data-name=${ue.ruleCard}]`);const l=me(s);let a=null;n.setDragImage(l,0,0);n.effectAllowed="move";const r={dragover:t=>{a=he(s,t);if(a){t.preventDefault()}},dragend:()=>{b.Dom.remove(l);c.forEach((([t,e])=>{b.Event.unbind(o,t,e)}))},dragenter:t=>{if(a){t.preventDefault()}},drop:t=>{if(!a){return}const{top:n}=a.getBoundingClientRect();const o=t.clientY<n+a.offsetHeight/2?pe.over:pe.under;const i={draggedId:s.dataset.id,targetId:a.dataset.id,insertion:o};if(s.dataset.ruleCardId){i.ruleCardId=s.dataset.ruleCardId}e(i)}};const c=Object.entries(r);c.forEach((([t,e])=>{b.Event.bind(o,t,e)}))};const Ce={mounted(t,{value:e}){b.Event.bind(t,"dragstart",(t=>{ge(t,e)}))},unmounted(t){b.Event.unbindAll(t,"dragstart")}};const be={name:"node-settings-rules-layout",components:{BIcon:f.BIcon},directives:{"drag-construction":Ce},props:{nodeSettings:{type:Object,required:true},currentRuleId:{type:String,required:true},isSaving:{type:Boolean,required:true},isRuleSettingsShown:{type:Boolean,required:true}},emits:["close","drop","scroll-layout"],setup(){const{getMessage:t}=N();return{getMessage:t}},computed:{ruleCards(){var t,e;return(t=(e=this.nodeSettings.rules.get(this.currentRuleId))==null?void 0:e.ruleCards)!=null?t:[]}},methods:{onDrop(t){this.$emit("drop",t)}},template:`\n\t\t<transition-group name="slide-rule-panel">\n\t\t\t<div\n\t\t\t\tv-if="isRuleSettingsShown"\n\t\t\t\tclass="node-settings-rules-panel"\n\t\t\t\t:class="{ '--saving': isSaving }"\n\t\t\t>\n\t\t\t\t<div class="node-settings-rules-panel__header">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:size="20"\n\t\t\t\t\t\t:data-test-id="$testId('complexNodeRuleSettingsClose')"\n\t\t\t\t\t\tname="arrow-left-l"\n\t\t\t\t\t\tcolor="#828b95"\n\t\t\t\t\t\tclass="node-settings-rules-panel__header_back"\n\t\t\t\t\t\t@click="$emit('close')"\n\t\t\t\t\t/>\n\t\t\t\t\t<span class="node-settings-rules-panel__header_label">\n\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_RULES_LAYOUT_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<slot name="rules-dropdown" />\n\t\t\t\t\t\x3c!--\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:size="20"\n\t\t\t\t\t\tname="o-question"\n\t\t\t\t\t\tcolor="#a8adb4"\n\t\t\t\t\t\tclass="node-settings-rules-panel__header_question"\n\t\t\t\t\t/>\n\t\t\t\t\t--\x3e\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="node-settings-rules-panel__content"\n\t\t\t\t\tv-drag-construction="onDrop"\n\t\t\t\t\t@scroll="$emit('scroll-layout')"\n\t\t\t\t>\n\t\t\t\t\t<slot\n\t\t\t\t\t\tv-for="ruleCard in ruleCards"\n\t\t\t\t\t\t:key="ruleCard.id"\n\t\t\t\t\t\t:ruleCard="ruleCard"\n\t\t\t\t\t\tname="ruleCard"\n\t\t\t\t\t/>\n\t\t\t\t\t<slot v-if="ruleCards.length === 0"\n\t\t\t\t\t\tname="addRuleCardButton"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="node-settings-rules-panel__footer">\n\t\t\t\t\t<slot name="actions" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="isRuleSettingsShown"\n\t\t\t\tclass="node-settings-rules-layout__back"\n\t\t\t></div>\n\t\t</transition-group>\n\t`};const Ie={name:"rule-card",components:{BIcon:f.BIcon},props:{ruleCard:{type:Object,required:true}},created(){this.iconColor="var(--ui-color-palette-gray-50)"},template:`\n\t\t<div\n\t\t\tdata-name="rule-card"\n\t\t\tclass="rule-card"\n\t\t\t:data-id="ruleCard.id"\n\t\t>\n\t\t\t<div class="rule-card__top">\n\t\t\t\t<BIcon\n\t\t\t\t\tname="drag-s"\n\t\t\t\t\tclass="rule-card__dnd-icon"\n\t\t\t\t\tdraggable="true"\n\t\t\t\t\t:color="iconColor"\n\t\t\t\t/>\n\t\t\t\t<slot name="deleteRuleCard" />\n\t\t\t\t\x3c!--\n\t\t\t\t<div class="rule-card__top_delimeter"></div>\n\t\t\t\t<BIcon\n\t\t\t\t\t:size="20"\n\t\t\t\t\tname="o-question"\n\t\t\t\t\t:color="iconColor"\n\t\t\t\t/>\n\t\t\t\t--\x3e\n\t\t\t</div>\n\t\t\t<slot\n\t\t\t\tv-for="(construction, index) in ruleCard.constructions"\n\t\t\t\t:key="construction.id"\n\t\t\t\t:construction="construction"\n\t\t\t\t:position="index"\n\t\t\t/>\n\t\t\t<slot\n\t\t\t\tname="addConstructionButton"\n\t\t\t/>\n\t\t</div>\n\t`};const ve={standard:"standard",expert:"expert"};const fe={condition:"#b7d7ff",action:"#4de39e",output:"#d5d7db"};const Ee={name:"rule-construction",components:{BIcon:f.BIcon},props:{construction:{type:Object,required:true},position:{type:Number,required:true},ruleCardId:{type:String,required:true}},setup(){const{getMessage:t}=N();const e=Object.freeze({standard:t("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_EXPRESSION_STANDARD_MODE"),expert:t("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_EXPRESSION_EXPERT_MODE")});return{getMessage:t,"\u0441onstructionModes":e}},data(){return{selectedMode:ve.expert}},computed:{constractionClassName(){return{"--condition":te[this.construction.type]===te["condition:if"],"--action":te[this.construction.type]===te.action,"--first":this.position===0,"--output":te[this.construction.type]===te.output}},generalConstructionTypes(){return te},isBooleanType(){return this.booleanTypes.includes(this.construction.type)},booleanTypes(){return[Jt.AND_CONDITION,Jt.OR_CONDITION]},iconColor(){if(te.action===this.generalConstructionTypes[this.construction.type]){return fe.action}if(te.output===this.generalConstructionTypes[this.construction.type]){return fe.output}return fe.condition},isExpertMode(){return this.selectedMode===ve.expert},parsedMessage(){return this.construction.type===te.action?this.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ACTION_THEN"):this.getMessage(Qt[this.construction.type])}},template:`\n\t\t<div\n\t\t\tdata-name="rule-construction"\n\t\t\tclass="rule-construction"\n\t\t\t:class="constractionClassName"\n\t\t\t:data-id="construction.id"\n\t\t\t:data-rule-card-id="ruleCardId"\n\t\t>\n\t\t\t<div class="rule-construction__operator">\n\t\t\t\t<slot\n\t\t\t\t\tv-if="isBooleanType"\n\t\t\t\t\tname="booleanTypeSwitcher"\n\t\t\t\t/>\n\t\t\t\t<span\n\t\t\t\t\tv-else\n\t\t\t\t\tclass="rule-construction__operator_label"\n\t\t\t\t>\n\t\t\t\t\t{{ parsedMessage }}\n\t\t\t\t</span>\n\t\t\t\t<slot\n\t\t\t\t\tv-if="position > 0"\n\t\t\t\t\tname="addConstructionButton"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="rule-construction__content">\n\t\t\t\t<div class="rule-construction__content_top">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:size="20"\n\t\t\t\t\t\t:color="iconColor"\n\t\t\t\t\t\tclass="rule-construction__dnd-icon"\n\t\t\t\t\t\tname="drag-s"\n\t\t\t\t\t\tdraggable="true"\n\t\t\t\t\t/>\n\t\t\t\t\t\x3c!--\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="generalConstructionTypes[construction.type] === generalConstructionTypes.action"\n\t\t\t\t\t\tclass="rule-construction__content_mode"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tv-for="(label, mode) in \u0441onstructionModes"\n\t\t\t\t\t\t\tclass="rule-construction__content_mode-text"\n\t\t\t\t\t\t\t:class="{ '--selected': selectedMode === mode }"\n\t\t\t\t\t\t\t@click="selectedMode = mode"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ label }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t--\x3e\n\t\t\t\t\t<slot\n\t\t\t\t\t\tname="deleteConstructionButton"\n\t\t\t\t\t\t:iconColor="iconColor"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="rule-construction__expression-form">\n\t\t\t\t\t<slot\n\t\t\t\t\t\t:name="generalConstructionTypes[construction.type]"\n\t\t\t\t\t\t:isExpertMode="isExpertMode"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Se=S.defineStore("bizprocdesigner-app-store",{state:()=>({isShownRightPanel:false,isShownPreviewPanel:false}),actions:{showRightPanel(){this.isShownRightPanel=true},hideRightPanel(){this.isShownRightPanel=false;this.isShownPreviewPanel=false},setShowPreviewPanel(t){this.isShownPreviewPanel=t},showPreviewPanel(){this.isShownPreviewPanel=true},hidePreviewPanel(){this.isShownPreviewPanel=false}}});const _e={base:"editor-chart-app-layout__settings",withPreviewPanel:"--with-preview-panel"};const ye={base:"editor-chart-app-layout__top-right-toolbar",shifted:"--shifted"};const Te={base:"editor-chart-app-layout__bottom-right-toolbar",shifted:"--shifted"};const ke={name:"AppLayout",props:{showSettings:{type:Boolean,default:false},showPreviewPanel:{type:Boolean,default:false}},computed:{topRightClassNames(){return{[ye.base]:true,[ye.shifted]:this.showSettings}},bottomRightClassNames(){return{[Te.base]:true,[Te.shifted]:this.showSettings}},settingsClassNames(){return{[_e.base]:true,[_e.withPreviewPanel]:this.showPreviewPanel}}},template:`\n\t\t<div class="editor-chart-app-layout">\n\t\t\t<section class="editor-chart-app-layout__header">\n\t\t\t\t<slot name="header"/>\n\t\t\t</section>\n\t\t\t<main class="editor-chart-app-layout__content">\n\t\t\t\t<slot name="diagram"/>\n\n\t\t\t\t<section class="editor-chart-app-layout__catalog">\n\t\t\t\t\t<slot name="catalog"/>\n\t\t\t\t</section>\n\n\t\t\t\t<section :class="topRightClassNames">\n\t\t\t\t\t<slot name="top-right-toolbar"/>\n\t\t\t\t</section>\n\n\t\t\t\t<section :class="bottomRightClassNames">\n\t\t\t\t\t<slot name="bottom-right-toolbar"/>\n\t\t\t\t</section>\n\n\t\t\t\t<transition\n\t\t\t\t\tname="fade-settings-panel"\n\t\t\t\t\tenter-active-class="fade-settings-panel-enter-active"\n\t\t\t\t\tleave-active-class="fade-settings-panel-leave-active"\n\t\t\t\t>\n\t\t\t\t\t<section\n\t\t\t\t\t\tv-if="showSettings"\n\t\t\t\t\t\t:class="settingsClassNames"\n\t\t\t\t\t>\n\t\t\t\t\t\t<slot name="settings"/>\n\t\t\t\t\t</section>\n\t\t\t\t</transition>\n\n\t\t\t\t<transition name="fade-preview-panel">\n\t\t\t\t\t<section\n\t\t\t\t\t\tv-show="showPreviewPanel"\n\t\t\t\t\t\tclass="editor-chart-app-layout__preview-panel"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="editor-chart-app-layout__preview-panel-conatiner">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tid="preview-panel"\n\t\t\t\t\t\t\t\tclass="editor-chart-app-layout__preview-panel-content"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</section>\n\t\t\t\t</transition>\n\t\t\t</main>\n\t\t</div>\n\t`};const Oe={name:"AppHeader",template:`\n\t\t<header class="editor-chart-app-header">\n\t\t\t<div class="editor-chart-app-header__left-column">\n\t\t\t\t<slot name="left"/>\n\t\t\t</div>\n\t\t\t<div class="editor-chart-app-header__right-column">\n\t\t\t\t<slot name="right"/>\n\t\t\t</div>\n\t\t</header>\n\t`};const Be={name:"LogoLayout",template:`\n\t\t<div class="editor-chart-logo-layout">\n\t\t\t<div class="editor-chart-logo-layout__back-btn">\n\t\t\t\t<slot name="back-btn"/>\n\t\t\t</div>\n\t\t\t<div class="editor-chart-logo-layout__logo-title">\n\t\t\t\t<slot name="title"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Ne="/bizproc/templateprocesses/";const Re={name:"LogoBackBtn",components:{UiButton:g.Button},props:{backUrl:{type:String,default:Ne}},setup(){return{AirButtonStyle:g.AirButtonStyle,Outline:C.Outline}},template:`\n\t\t<UiButton\n\t\t\t:leftIcon="Outline.HOME"\n\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t:link="backUrl"\n\t\t/>\n\t`};const Le={name:"LogoTitle",props:{companyName:{type:String,default:""}},template:`\n\t\t<div class="editor-chart-logo-title">\n\t\t\t<span class="editor-chart-logo-title__company-name">\n\t\t\t\t{{ companyName }}\n\t\t\t</span>\n\t\t\t<span class="editor-chart-logo-title__tool-name">\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_TOP_PANEL_TOOLNAME') }}\n\t\t\t</span>\n\t\t</div>\n\t`};const De={name:"AppHeaderDivider",template:`\n\t\t<div class="editor-chart-app-header-divider"/>\n\t`};const Pe={name:"edit-node-settings-form",components:{BIcon:f.BIcon,IconButton:ht,BlockHeader:Rt,BlockIcon:Mt},props:{block:{type:Object,required:true}},emits:["updateTitle","updateDescription"],setup(){const t=rt();const{getMessage:e}=N();const{isFeatureAvailable:n}=B();return{iconSet:f.Outline,getMessage:e,isFeatureAvailable:n,store:t}},data(){return{activationMenuHelper:null}},computed:{...S.mapState(ae,["nodeSettings"]),iconName(){var t,e,n;return(t=f.Outline[(e=this.block)==null?void 0:(n=e.node)==null?void 0:n.icon])!=null?t:f.Outline.FILE},rulePorts(){return this.block.ports.input.filter((t=>!t.isConnectionPort))},areConnectionsAvailable(){return this.isFeatureAvailable(p.FeatureCode.complexNodeConnections)},isSubIcon(){var t,e;return((t=this.block.node)==null?void 0:t.type)===A.TOOL&&((e=this.block.node)==null?void 0:e.icon)&&f.Outline[this.block.node.icon]!==f.Outline.DATABASE},activationIcon(){return this.block.activity.Activated==="Y"?this.iconSet.PAUSE_L:this.iconSet.PLAY_L},icon(){var t,e;if(((t=this.block.node)==null?void 0:t.type)===A.TOOL){const t="MCP_LETTERS";return f.Outline[this.block.node.icon]===f.Outline.DATABASE?this.block.node.icon:t}return(e=this.block.node)==null?void 0:e.icon},colorIndex(){var t,e;return((t=this.block.node)==null?void 0:t.type)===A.TOOL?0:(e=this.block.node)==null?void 0:e.colorIndex}},created(){this.activationMenuHelper=w(this.store)},methods:{onChangeTitle({target:{value:t}}){this.$emit("updateTitle",t)},onChangeDescription({target:{value:t}}){this.$emit("updateDescription",t)},isUrl(t){if(!t||!b.Type.isString(t)){return false}try{const e=new URL(t);return e.protocol==="https:"}catch{return false}},showActivationMenu(t){this.activationMenuHelper.showActivationMenu(t,this.block)}},template:`\n\t\t<div class="node-settings-form">\n\t\t\t<div class="node-settings-form__node-brief">\n\t\t\t\t<BlockHeader :block="block" :subIconExternal="isUrl(block.node?.icon)">\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\t:iconName="icon"\n\t\t\t\t\t\t\t:iconColorIndex="colorIndex"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template #subIcon\n\t\t\t\t\t\t\t  v-if="isSubIcon">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if="isUrl(block.node.icon)"\n\t\t\t\t\t\t\t:style="getBackgroundImage(block.node.icon)"\n\t\t\t\t\t\t\tclass="ui-selector-item-avatar"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t:iconName="block.node.icon"\n\t\t\t\t\t\t\t:iconColorIndex="7"\n\t\t\t\t\t\t\t:iconSize="24"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</BlockHeader>\n\t\t\t\t<IconButton\n\t\t\t\t\t:icon-name="activationIcon"\n\t\t\t\t\t@click="showActivationMenu"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="node-settings-form__section-delimeter"></div>\n\t\t\t<div class="node-settings-form__section">\n\t\t\t\t<div>\n\t\t\t\t\t<span class="node-settings-form__label">\n\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_NODE_NAME_LABEL') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox node-settings-form__node-name-input">\n\t\t\t\t\t\t<input type="text"\n\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t:placeholder="getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_NODE_NAME_PLACEHOLDER')"\n\t\t\t\t\t\t\t:value="block.node.title"\n\t\t\t\t\t\t\t:data-test-id="$testId('complexNodeName')"\n\t\t\t\t\t\t\t@input="onChangeTitle"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="node-settings-form__node-description">\n\t\t\t\t\t<span class="node-settings-form__label">\n\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_NODE_DESCRIPTION_LABEL') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea node-settings-form__node-description_textarea">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\trows="1"\n\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t:placeholder="getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_NODE_DESCRIPTION_PLACEHOLDER')"\n\t\t\t\t\t\t\t:value="nodeSettings.description"\n\t\t\t\t\t\t\t:data-test-id="$testId('complexNodeDescription')"\n\t\t\t\t\t\t\t@input="onChangeDescription"\n\t\t\t\t\t\t></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class="node-settings-form__node-description_text">\n\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_NODE_DESCRIPTION_TEXT') }}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="node-settings-form__section-delimeter"></div>\n\t\t\t<div\n\t\t\t\tclass="node-settings-form__section --data"\n\t\t\t\tref="node-settings-form-data-section"\n\t\t\t>\n\t\t\t\t\x3c!--\n\t\t\t\t<span\n\t\t\t\t\tclass="node-settings-form__section-title"\n\t\t\t\t>\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_DATA_SECTION_TITLE') }}\n\t\t\t\t</span>\n\t\t\t\t--\x3e\n\t\t\t\t<slot\n\t\t\t\t\tv-for="[variableName, variableValue] in nodeSettings.variables"\n\t\t\t\t\t:key="variableName"\n\t\t\t\t\t:variableName="variableName"\n\t\t\t\t\t:variableValue="variableValue"\n\t\t\t\t\tname="variable"\n\t\t\t\t/>\n\t\t\t\t<slot name="addElement" itemType="element" />\n\t\t\t</div>\n\t\t\t<div class="node-settings-form__section">\n\t\t\t\t<p class="node-settings-form__section-title">\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_RULE_SECTION_TITLE') }}\n\t\t\t\t</p>\n\t\t\t\t<slot\n\t\t\t\t\tv-for="port in rulePorts"\n\t\t\t\t\t:key="port.id"\n\t\t\t\t\t:port="port"\n\t\t\t\t\tname="rule"\n\t\t\t\t/>\n\t\t\t\t<slot name="addRule" itemType="rule" />\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if="areConnectionsAvailable"\n\t\t\t\tclass="node-settings-form__section"\n\t\t\t>\n\t\t\t\t<p class="node-settings-form__section-title">\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONNECTION_SECTION_TITLE') }}\n\t\t\t\t</p>\n\t\t\t\t<slot name="addConnection" itemType="connection" />\n\t\t\t</div>\n\t\t</div>\n\t`};const Me={name:"add-settings-item",components:{BIcon:f.BIcon},props:{itemType:{type:String,required:true}},emits:["addItem"],setup(){const{getMessage:t}=N();const e=ae();const n={rule:()=>e.addRule(),connection:()=>ie(e.block.ports.input)};return{getMessage:t,actions:n}},methods:{onClick(){const t=this.actions[this.itemType]();this.$emit("addItem",t)}},template:`\n\t\t<div\n\t\t\tclass="node-settings-add-item-button"\n\t\t\t:data-test-id="$testId('complexNodeSettingsAdd', itemType)"\n\t\t\t@click="onClick"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tclass="node-settings-add-item-button__plus"\n\t\t\t\tname="plus-m"\n\t\t\t\t:size="20"\n\t\t\t\tcolor="#828b95"\n\t\t\t/>\n\t\t\t<span>\n\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ADD_SETTINGS_ITEM') }}\n\t\t\t\t<slot />\n\t\t\t</span>\n\t\t</div>\n\t`};const we="@";var Ae=babelHelpers.classPrivateFieldLooseKey("store");var xe=babelHelpers.classPrivateFieldLooseKey("currentPortId");var Fe=babelHelpers.classPrivateFieldLooseKey("currentBlock");var Ve=babelHelpers.classPrivateFieldLooseKey("fixedDocumentType");var Ge=babelHelpers.classPrivateFieldLooseKey("getTabs");var Ze=babelHelpers.classPrivateFieldLooseKey("getReturnValue");var He=babelHelpers.classPrivateFieldLooseKey("getEntities");var Ue=babelHelpers.classPrivateFieldLooseKey("processChildrenProperties");var $e=babelHelpers.classPrivateFieldLooseKey("processReturnProperties");var ze=babelHelpers.classPrivateFieldLooseKey("getDocuments");class je{constructor(t,e=null,n=null){Object.defineProperty(this,ze,{value:Je});Object.defineProperty(this,$e,{value:Ye});Object.defineProperty(this,Ue,{value:We});Object.defineProperty(this,He,{value:Ke});Object.defineProperty(this,Ze,{value:qe});Object.defineProperty(this,Ge,{value:Xe});Object.defineProperty(this,Ae,{writable:true,value:void 0});Object.defineProperty(this,xe,{writable:true,value:null});Object.defineProperty(this,Fe,{writable:true,value:void 0});Object.defineProperty(this,Ve,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]=rt();babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=t;babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=e;babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=n}show(t){const e=[{id:we,entityId:"bizproc-document",entityType:"document",title:b.Loc.getMessage("BIZPROCDESIGNER_EDITOR_TEMPLATE_DOCUMENT"),nodeOptions:{open:false,dynamic:false},tabs:"documents"},...babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]()];return new Promise((n=>{const o=new l.Dialog({targetNode:t,width:500,height:300,multiple:false,dropdownMode:true,enableSearch:true,items:e,tabs:babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge](),entities:babelHelpers.classPrivateFieldLooseBase(this,He)[He](),cacheable:false,showAvatars:false,events:{"Item:onSelect":t=>{n(babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze](t.getData().item))}},compactView:true});o.show()}))}}function Xe(){return[{id:"documents",title:b.Loc.getMessage("BIZPROCDESIGNER_EDITOR_DOCUMENT_MULTIPLE"),icon:"elements"}]}function qe(t){return t.getId()===we?null:t.getId()}function Ke(){return[{id:"bizproc-document"}]}function We(t){const e=[];t.activity.Children.forEach((t=>{if(b.Type.isArrayFilled(t.ReturnProperties)){const n=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]({id:t.Name,activity:t});if(b.Type.isArrayFilled(n)){e.push(...n)}}}));const n=[];if(b.Type.isArrayFilled(e)){n.push({id:t.id,entityId:"block-node",tabs:"documents",title:t.activity.Properties.Title,children:e,searchable:false})}return n}function Ye(t){const e=[];t.activity.ReturnProperties.filter((t=>{if(t.Type!=="document"){return false}if(!b.Type.isArrayFilled(t.Default)){return true}if(!b.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve])){return true}return JSON.stringify(t.Default)===JSON.stringify(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve])})).forEach((n=>{const o=`{=${t.id}:${n.Id}}`;e.push({id:o,entityId:"bizproc-document",entityType:"document",title:`${n.Name} (${t.activity.Properties.Title})`,nodeOptions:{open:false,dynamic:false},tabs:"documents"})}));return e}function Je(){const t=babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae].getAllBlockAncestors(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe],babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]);return t.reduce(((t,e)=>{if(b.Type.isArrayFilled(e.activity.Children)){const n=babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue](e);if(b.Type.isArrayFilled(n)){t.push(...n)}}if(b.Type.isArrayFilled(e.activity.ReturnProperties)){const n=babelHelpers.classPrivateFieldLooseBase(this,$e)[$e](e);if(b.Type.isArrayFilled(n)){t.push(...n)}}return t}),[])}const Qe={name:"edit-action-expression",components:{BIcon:f.BIcon},props:{construction:{type:Object,required:true},isExpertMode:{type:Boolean,required:true}},setup(){const{getMessage:t}=N();return{getMessage:t}},data(){return{isExpanded:true}},computed:{...S.mapState(ae,["nodeSettings","block","currentRuleId"]),connectedBlocks(){const t=rt();return t.getAllBlockAncestors(this.block,this.currentRuleId)},selectedAction(){return this.nodeSettings.actions.get(this.selectedActionId)},selectedActionId:{get(){var t;return(t=this.construction.expression.actionId)!=null?t:""},set(t){this.changeRuleExpression(this.construction,{actionId:t,activityData:null})}},actionValue(){return this.construction.expression.activityData},notSelectedMessage(){return this.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_EXPRESSION_ITEM_NOT_SELECTED")},currentActionTitle(){var t;const e=this.nodeSettings.actions.get(this.selectedActionId);return(t=e==null?void 0:e.title)!=null?t:this.notSelectedMessage},selectedDocument:{get(){return this.construction.expression.document},set(t){this.changeRuleExpression(this.construction,{document:t})}},selectedDocumentTitle(){return le(this.connectedBlocks,this.selectedDocument)}},methods:{...S.mapActions(ae,["changeRuleExpression"]),getMenuItems(){return[...this.nodeSettings.actions.values()].map((({id:t,title:e})=>({id:t,text:e,onclick:()=>{this.selectedActionId=t;this.menu.close()}})))},onShowMenu({currentTarget:t}){this.menu=a.MenuManager.create({id:"edit-actions-menu",bindElement:t,items:this.getMenuItems(),maxHeight:200,closeByEsc:true,autoHide:true,cacheable:false});this.menu.show()},onChooseDocument(t){const e=new je(this.block,this.currentRuleId,this.nodeSettings.fixedDocumentType);void e.show(t.target).then((t=>{this.selectedDocument=t}))}},template:`\n\t\t<div class="edit-action-expression-form">\n\t\t\t<div class="edit-action-expression-form__item">\n\t\t\t\t<span class="edit-action-expression-form__label">\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ACTION_EXPRESSION_NAME') }}\n\t\t\t\t</span>\n\t\t\t\t<div\n\t\t\t\t\tclass="ui-ctl ui-ctl-after-icon ui-ctl-dropdown edit-action-expression-form__dropdown"\n\t\t\t\t\t@click="onShowMenu"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t<div class="ui-ctl-element">\n\t\t\t\t\t\t{{ currentActionTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="selectedAction && selectedAction.handlesDocument"\n\t\t\t\t class="edit-action-expression-form__item"\n\t\t\t>\n\t\t\t\t<span class="edit-action-expression-form__label">\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_DOCUMENT') }}\n\t\t\t\t</span>\n\t\t\t\t<div\n\t\t\t\t\t class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown edit-action-expression-form__dropdown"\n\t\t\t\t\t @click="onChooseDocument"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t<div class="ui-ctl-element">\n\t\t\t\t\t\t{{ selectedDocumentTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="edit-action-expression-form__item">\n\t\t\t\t<div\n\t\t\t\t\tv-if="selectedActionId"\n\t\t\t\t\tclass="edit-action-expression-form__label"\n\t\t\t\t>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_EXPRESSION_VALUE') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if="isExpanded"\n\t\t\t\t\t\tname="minus-20"\n\t\t\t\t\t\tcolor="#828b95"\n\t\t\t\t\t\t@click="isExpanded=false"\n\t\t\t\t\t/>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\tname="plus-20"\n\t\t\t\t\t\tcolor="#828b95"\n\t\t\t\t\t\t@click="isExpanded=true"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-show="isExpanded"\n\t\t\t\t\tclass="edit-action-expression-form__settings node-settings-panel"\n\t\t\t\t>\n\t\t\t\t\t<slot\n\t\t\t\t\t\t:actionId="selectedActionId"\n\t\t\t\t\t\t:activityData="actionValue"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const tn=S.defineStore("bizprocdesigner-common-node-settings-store",{state:()=>({isLoading:false,block:null}),getters:{isVisible:t=>t.block!==null},actions:{isCurrentBlock(t){var e;return((e=this.block)==null?void 0:e.id)===t},showSettings(t){this.block=t},hideSettings(){this.block=null}}});var en=babelHelpers.classPrivateFieldLooseKey("getEntities");var nn=babelHelpers.classPrivateFieldLooseKey("getTabs");var on=babelHelpers.classPrivateFieldLooseKey("getValue");var sn=babelHelpers.classPrivateFieldLooseKey("getItems");var ln=babelHelpers.classPrivateFieldLooseKey("addDocumentItem");var an=babelHelpers.classPrivateFieldLooseKey("processChildrenProperties");var rn=babelHelpers.classPrivateFieldLooseKey("processReturnProperties");class cn{constructor(t,e,n=null){Object.defineProperty(this,rn,{value:Cn});Object.defineProperty(this,an,{value:gn});Object.defineProperty(this,ln,{value:hn});Object.defineProperty(this,sn,{value:mn});Object.defineProperty(this,on,{value:pn});Object.defineProperty(this,nn,{value:un});Object.defineProperty(this,en,{value:dn});this.currentPortId=null;this.store=t;this.currentBlock=e;this.currentPortId=n}show(t){return new Promise((e=>{const n=new l.Dialog({targetNode:t,width:500,height:300,multiple:false,dropdownMode:true,enableSearch:true,items:babelHelpers.classPrivateFieldLooseBase(this,sn)[sn](),tabs:babelHelpers.classPrivateFieldLooseBase(this,nn)[nn](),entities:babelHelpers.classPrivateFieldLooseBase(this,en)[en](),cacheable:false,showAvatars:false,events:{"Item:onSelect":t=>{e(babelHelpers.classPrivateFieldLooseBase(this,on)[on](t.getData().item))}},compactView:true});n.show()}))}addTemplateItems(t){const e=[{key:"PARAMETERS",idKey:"Template",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_ITEM_PARAMETERS")},{key:"VARIABLES",idKey:"Variable",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_ITEM_VARIABLES")},{key:"CONSTANTS",idKey:"Constant",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_ITEM_CONSTANTS")}];e.forEach((e=>{const n=this.store.template[e.key];if(b.Type.isObject(n)&&Object.keys(n).length>0){const o=[];Object.keys(n).forEach((t=>{const i=n[t];const s=`{=${e.idKey}:${t}}`;o.push({id:s,entityId:e.key,title:i.Name})}));t.push({id:e.idKey,entityId:"template",title:e.title,tabs:"template",children:o})}}))}getReturnItems(){const t=this.store.getAllBlockAncestors(this.currentBlock,this.currentPortId);return t.reduce(((t,e)=>{if(b.Type.isArrayFilled(e.activity.Children)){const n=babelHelpers.classPrivateFieldLooseBase(this,an)[an](e);if(b.Type.isArrayFilled(n)){t.push(...n)}}if(b.Type.isArrayFilled(e.activity.ReturnProperties)){const n=babelHelpers.classPrivateFieldLooseBase(this,rn)[rn](e);if(b.Type.isArrayFilled(n)){t.push(...n)}}return t}),[])}}function dn(){return[{id:"bizproc-document"},{id:"bizproc-system"},{id:"structure-node",options:{selectMode:"usersAndDepartments",allowFlatDepartments:true,allowSelectRootDepartment:true}}]}function un(){return[{id:"documents",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_TAB_DOCUMENTS"),icon:"elements"},{id:"returns",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_TAB_RETURNS"),icon:"flag-1"},{id:"template",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_TAB_TEMPLATE"),icon:"disk"}]}function pn(t){if(t.getEntityId()==="user"){return`${t.getTitle()} [${t.getId()}]`}if(t.getEntityId()==="structure-node"){const e=String(t.getId());if(e.indexOf(":")>0){return`${t.getTitle()} [HR${e.split(":")[0]}]`}return`${t.getTitle()} [HRR${e}]`}return t.getId()}function mn(){const t=this.getReturnItems();babelHelpers.classPrivateFieldLooseBase(this,ln)[ln](t);this.addTemplateItems(t);return t}function hn(t){t.push({id:"template-document",entityId:"bizproc-document",entityType:"document",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_DOCUMENT_FIELDS"),customData:{document:this.store.documentType,idTemplate:"{{ #FIELD_NAME# }}",supertitle:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_DOCUMENT_FIELDS")},tabs:["documents"],nodeOptions:{open:false,dynamic:true}})}function gn(t){const e=[];t.activity.Children.forEach((t=>{if(b.Type.isArrayFilled(t.ReturnProperties)){const n=babelHelpers.classPrivateFieldLooseBase(this,rn)[rn]({id:t.Name,activity:t});if(b.Type.isArrayFilled(n)){e.push(...n)}}}));const{documents:n,activities:o}=e.reduce(((t,e)=>{if(e){if(e.entityId==="bizproc-document"){t.documents.push(e)}else{t.activities.push(e)}}return t}),{documents:[],activities:[]});const i=[];if(b.Type.isArrayFilled(n)){i.push({id:t.id,entityId:"block-node",tabs:"documents",title:t.activity.Properties.Title,children:n,nodeOptions:{open:false,dynamic:false},searchable:false})}if(b.Type.isArrayFilled(o)){i.push({id:t.id,entityId:"block-node",tabs:"returns",title:t.activity.Properties.Title,children:o,searchable:false})}return i}function Cn(t){const e=t.activity.Properties.Title;const{documents:n,properties:o}=t.activity.ReturnProperties.reduce(((n,o)=>{const i=`{=${t.id}:${o.Id}}`;if(o.Type==="document"){n.documents.push({id:i,entityId:"bizproc-document",entityType:"document",title:`${o.Name} (${e})`,customData:{document:o.Default,idTemplate:`{=${t.id}:${o.Id}.#FIELD#}`},nodeOptions:{open:false,dynamic:true},tabs:"documents",searchable:false})}else{n.properties.push({id:i,entityId:"block-node-property",title:o.Name,property:o,block:t})}return n}),{documents:[],properties:[]});const i=[];if(b.Type.isArrayFilled(n)){i.push(...n)}if(b.Type.isArrayFilled(o)){i.push({id:t.id,entityId:"block-node",tabs:"returns",title:e,children:o,searchable:false})}return i}let bn=t=>t,In,vn,fn,En;const Sn={name:"CommonNodeSettingsForm",components:{BIcon:f.BIcon,BlockHeader:Rt,BlockIcon:Mt,IconButton:ht},props:{block:{type:Object,required:true},documentType:{type:Array,required:true}},emits:["showPreview"],setup(){const t=rt();return{iconSet:f.Outline,store:t}},data(){return{isLoading:false,isVisible:false,hasErrors:false,isSubmitting:false,hasSettings:false,useDocumentContext:false,settingsForm:null,nodeControls:null,inputListeners:[],shouldShowWithTransition:false,activationMenuHelper:null}},computed:{icon(){var t,e;if(((t=this.block.node)==null?void 0:t.type)===A.TOOL){const t="MCP_LETTERS";return f.Outline[this.block.node.icon]===f.Outline.DATABASE?this.block.node.icon:t}return(e=this.block.node)==null?void 0:e.icon},colorIndex(){var t,e;return((t=this.block.node)==null?void 0:t.type)===A.TOOL?0:(e=this.block.node)==null?void 0:e.colorIndex},isSubIcon(){var t,e;return((t=this.block.node)==null?void 0:t.type)===A.TOOL&&((e=this.block.node)==null?void 0:e.icon)&&f.Outline[this.block.node.icon]!==f.Outline.DATABASE},activationIcon(){return this.block.activity.Activated==="Y"?this.iconSet.PAUSE_L:this.iconSet.PLAY_L}},async mounted(){this.isVisible=true;this.currentBlock=this.block;await this.$nextTick();await this.renderControls();b.Event.bind(document,"mousedown",this.multiSelectMouseHandler);r.EventEmitter.subscribe("BX.Bizproc:setuptemplateactivity:preview",this.showPreview);window.BPAShowSelector=this.showSelector;window.HideShow=this.hideShow},unmounted(){if(this.inputListeners&&this.handleFieldInput){this.inputListeners.forEach((t=>{b.Event.unbind(t,"input",this.handleFieldInput)}));this.inputListeners=[]}b.Event.unbind(document,"mousedown",this.multiSelectMouseHandler);r.EventEmitter.unsubscribe("BX.Bizproc:setuptemplateactivity:preview",this.showPreview);r.EventEmitter.emit("BX.Bizproc.Activity.unmount")},created(){this.activationMenuHelper=w(this.store)},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)},multiSelectMouseHandler(t){if(!t.isTrusted||t.button!==0){return}const e=t.target;const n=e.parentElement;if(e.tagName==="OPTION"&&n!=null&&n.multiple){t.preventDefault();const o=n.scrollTop;e.selected=!e.selected;setTimeout((()=>n.scrollTop=o),0)}},showPreview(t){this.$emit("showPreview",t.data)},async showSettings(t,e){this.isVisible=true;this.currentBlock=t;this.shouldShowWithTransition=e;await this.$nextTick();await this.renderControls();window.BPAShowSelector=this.showSelector;window.HideShow=this.hideShow},extractFormData(t){var e,n,o,i;const s=b.ajax.prepareForm(t).data;s.documentType=this.documentType;s.activityType=(e=(n=this.currentBlock.activity)==null?void 0:n.Type)!=null?e:"";s.id=(o=(i=this.currentBlock.activity)==null?void 0:i.Name)!=null?o:"";s.arWorkflowTemplate=JSON.stringify([this.currentBlock.activity]);return s},async submitForm(t){this.isSubmitting=true;try{var e;this.validateForm(t);if(this.hasErrors){return}r.EventEmitter.emit("Bizproc.NodeSettings:nodeSettingsSaving",{formData:t});const n={...t};n.arWorkflowConstants=JSON.stringify((e=this.store.template.CONSTANTS)!=null?e:{});const o=[{Type:"NodeWorkflowActivity",Children:[],Name:"Template"}];o[0].Children.push(this.currentBlock.activity,...this.store.getAllBlockAncestors(this.currentBlock).map((t=>t.activity)));n.arWorkflowTemplate=JSON.stringify(o);const i=await $.saveNodeSettings(n);if(i){this.store.updateBlockActivityField(this.currentBlock.id,i);if(t.activity_id!==this.currentBlock.id){this.store.updateBlockId(this.currentBlock.id,n.activity_id)}this.store.publicDraft();this.handleFormCancel()}}catch(t){if(t.errors&&t.errors[0]&&t.errors[0].message){c.MessageBox.alert(t.errors[0].message)}}finally{this.isSubmitting=false}},handleFormSave(){if(this.isSubmitting){return}if(!this.settingsForm){return}const t=this.extractFormData(this.settingsForm);this.submitForm(t)},handleFormCancel(){this.$emit("close");this.isVisible=false;this.$refs.contentContainer.innerHTML=""},handleDocumentSelector(t){var e,n;const o=[{id:"@",text:b.Loc.getMessage("BIZPROCDESIGNER_EDITOR_TEMPLATE_DOCUMENT")},...this.getDocuments()];const i=(e=(n=this.currentBlock.activity)==null?void 0:n.Document)!=null?e:"@";const s=o.map((t=>{const e=t.id===i?`* ${t.text}`:t.text;const n=this.handleSelectDocument.bind(this);return{...t,text:e,onclick:n}}));a.MenuManager.show("node-settings-document-selector",t.target,s,{autoHide:true,cacheable:false})},handleSelectDocument(t,e){e.menuWindow.close();const n=e.getId();if(n==="@"){this.currentBlock.activity.Document=null;return}this.currentBlock.activity.Document=n},hideShow(t="row_activity_id"){const e=BX(t);if(e){b.Dom.toggleClass(e,"hidden")}},showSelector(t,e){const n=new cn(this.store,this.currentBlock);const o=document.getElementById(t);n.show(o).then((t=>{const n=o.selectionStart?o.value.slice(0,o.selectionStart):o.value;let i=t;const s=o.selectionEnd?o.value.slice(o.selectionEnd):"";if(e==="user"){if(n.trim().length>0&&n.trim().slice(-1)!==";"){i=`; ${i}`}i+="; "}o.value=n+i+s;o.selectionEnd=n.length+i.length;o.focus();o.dispatchEvent(new window.Event("change"))})).catch((t=>console.error(t)))},renderField(t,e){const n=b.Type.isDomNode(t)?t:null;if(!n){return null}const o=b.Tag.render(In||(In=bn`
				<div class="node-settings-alert-text">
					${0}
				</div>
			`),this.loc("BIZPROCDESIGNER_EDITOR_REQUIRED_FIELD_ERROR",{"#FIELD#":e.property.Name}));b.Dom.append(o,n.parentNode);let i="node-settings-edit-box";if(e.property.Hidden){i+=" hidden"}return b.Tag.render(vn||(vn=bn`
				<div class="${0}" id="row_${0}">
				    <div class="node-settings-edit-caption">${0}</div>
				    <div class="field-row">
				        ${0}
				        ${0}
				    </div>
				</div>
			`),i,e.fieldName,e.property.Name,n,e.fieldName==="title"?`\n\t\t\t\t        \t<a href="#" onclick="HideShow('row_activity_id'); return false;">\n\t\t\t\t        \t\t${this.loc("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ID")}\n\t\t\t\t        \t</a>\n\t\t\t\t        \t\t\t<a href="#" onclick="HideShow('row_activity_editor_comment'); return false;">\n\t\t\t\t        \t\t${this.loc("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_COMMENT")}\n\t\t\t\t        \t</a>\n\t\t\t\t        `:null)},async renderControls(){var t,e,n,o;this.isLoading=true;const i=(t=this.currentBlock.activity.Name)!=null?t:"";const s=(e=this.currentBlock.activity.Type)!=null?e:"";const l=[{Type:"NodeWorkflowActivity",Children:[],Name:"Template"}];l[0].Children.push((n=this.currentBlock)==null?void 0:n.activity,...this.store.getAllBlockAncestors(this.currentBlock).map((t=>t.activity)));const a=this.store.template.PARAMETERS;const r=this.store.template.VARIABLES;const c=this.store.template.CONSTANTS;if(window.CreateActivity){window.arAllId={};window.arWorkflowTemplate=l;window.rootActivity=window.CreateActivity(l[0]);window.arWorkflowParameters=a;window.arWorkflowVariables=r;window.arWorkflowConstants=c}const{createFormData:d}=M();const u=d({id:i,documentType:this.documentType,activity:s,workflow:{parameters:a,variables:r,template:l,constants:c}});this.isLoading=true;this.$refs.contentContainer.innerHTML="";this.hasErrors=false;this.nodeControls=[];let p=null;try{var m;p=await $.getNodeSettingsControls({documentType:this.documentType,activity:(m=this.currentBlock)==null?void 0:m.activity})}catch(t){it(t)}this.useDocumentContext=Boolean((o=p)==null?void 0:o.useDocumentContext);if(p&&b.Type.isArray(p.controls)){await this.renderNodeControls(p.controls)}else{await this.renderPropertyDialog(u)}},renderNodeControls(t){this.nodeControls=t;const e="BX.Bizproc.FieldType.onCollectionRenderControlFinished";this.nodeControls=this.nodeControls.map((t=>({...t,controlId:t.fieldName.toLowerCase()})));const n=BX.Bizproc.FieldType.renderControlCollection(this.documentType,this.nodeControls.filter((t=>t.property.Type!=="Custom")),"designer");return new Promise((t=>{b.Event.EventEmitter.subscribeOnce(e,(()=>{var e,o;const i=b.Tag.render(fn||(fn=bn`<form id="form-settings"></form>`));this.settingsForm=i;const s=(e=(o=this.currentBlock.activity)==null?void 0:o.Type)!=null?e:"";const l=`${s}Renderer`;const a=b.Type.isFunction(window[l])?window[l]:null;let r=null;let c=null;if(a){c=a?new a:null;r=c&&b.Type.isFunction(c.getControlRenderers)?c.getControlRenderers():null}this.nodeControls.forEach((t=>{let e=n[t.controlId];if(t.property.Type==="custom"&&c&&r){var o,s;const n=(o=r)==null?void 0:o[t==null?void 0:(s=t.property)==null?void 0:s.CustomType];if(b.Type.isFunction(n)){e=n(t)}}if(e){const n=this.renderField(e,t);const o=t.fieldName.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&");const s=n.querySelector(`[name^="${o}"]`);b.Event.bind(s,"input",this.handleFieldInput);this.inputListeners.push(s);if(t.property.Type!=="custom"&&(s==null?void 0:s.tagName)==="SELECT"){b.Dom.addClass(s,"ui-ctl-element");const e=b.Tag.render(En||(En=bn`
									<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100${0}">
										<div class="ui-ctl-after ui-ctl-icon-angle"></div>
										${0}
									</div>
								`),t.property.Multiple===true?" ui-ctl-multiple-select":"",s);b.Dom.append(e,n)}const l=n.querySelector('input[data-role="bp-selector-button"]');if(l){const t=document.createElement("span");t.className="node-settings-select-dotted";for(const e of l.attributes){const n=e.name;const o=e.value;t.setAttribute(n,o)}b.Dom.replace(l,t)}b.Dom.append(n,i)}}));this.$refs.contentContainer.innerHTML="";b.Dom.append(i,this.$refs.contentContainer);this.hasSettings=true;this.isLoading=false;t()}))}))},async renderPropertyDialog(t){const{renderPropertyDialog:e}=M();const n=await e(this.$refs.contentContainer,t);if(!n){this.isLoading=false;this.hasSettings=false;return}this.settingsForm=n;this.hasSettings=true;this.isLoading=false},getDocuments(){return this.store.getAllBlockAncestors(this.currentBlock).reduce(((t,e)=>{if(b.Type.isArrayFilled(e.activity.ReturnProperties)){e.activity.ReturnProperties.forEach((n=>{const o=`{=${e.id}:${n.Id}}`;if(n.Type==="document"){t.push({id:o,text:`${n.Name} (${e.activity.Properties.Title})`})}}))}return t}),[])},validateForm(t){if(!this.nodeControls){return}this.hasErrors=false;this.nodeControls.forEach((e=>{const n=t[e.fieldName];const o=e.fieldName.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&");const i=document.querySelector(`[name^="${o}"]`);if(!i){return}{b.Dom.removeClass(i,"has-error")}}))},handleFieldInput(t){if(this.hasErrors){b.Dom.removeClass(t.target,"has-error")}},isUrl(t){if(!t||!b.Type.isString(t)){return false}try{const e=new URL(t);return e.protocol==="https:"}catch{return false}},getSafeUrl(t){if(!t||!b.Type.isString(t)){return""}try{const e=new URL(t.trim());if(e.protocol!=="https:"){return""}return e.href}catch{return""}},getBackgroundImage(t){const e=this.getSafeUrl(t);if(!e){return{}}return{"background-image":`url('${e}')`}},showActivationMenu(t){this.activationMenuHelper.showActivationMenu(t,this.currentBlock,(()=>this.syncActivatedField()))},syncActivatedField(){const t=document.getElementsByName("activated")[0];if(t){t.value=t.value==="Y"?"N":"Y"}}},template:`\n\t\t<transition name="slide-fade">\n\t\t\t<div v-if="isVisible" class="node-settings-panel" ref="settingsPanel">\n\t\t\t\t<div class="node-settings-header">\n\t\t\t\t\t<h3 class="node-settings-title">{{loc('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_TITLE')}}</h3>\n\t\t\t\t\t<span class="node-settings-title-close-icon" @click="handleFormCancel"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="node-settings-form__node-brief">\n\t\t\t\t\t<BlockHeader :block="block" :subIconExternal="isUrl(block.node?.icon)">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\t\t:iconName="icon"\n\t\t\t\t\t\t\t\t:iconColorIndex="colorIndex"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<template #subIcon\n\t\t\t\t\t\t\t\t  v-if="isSubIcon">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if="isUrl(block.node.icon)"\n\t\t\t\t\t\t\t\t:style="getBackgroundImage(block.node.icon)"\n\t\t\t\t\t\t\t\tclass="ui-selector-item-avatar"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t\t:iconName="block.node.icon"\n\t\t\t\t\t\t\t\t:iconColorIndex="7"\n\t\t\t\t\t\t\t\t:iconSize="24"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</BlockHeader>\n\t\t\t\t\t<IconButton\n\t\t\t\t\t\t:icon-name="activationIcon"\n\t\t\t\t\t\t@click="showActivationMenu"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="node-settings-form__section-delimeter"></div>\n\t\t\t\t<Transition\n\t\t\t\t\t:css="shouldShowWithTransition"\n\t\t\t\t\tname="node-settings-transition"\n\t\t\t\t>\n\t\t\t\t\t<div v-show="!isLoading" class="node-settings-content">\n\t\t\t\t\t\t<div class="temp-block" v-show="!hasSettings">\n\t\t\t\t\t\t\t<svg width="330" height="162" viewBox="0 0 330 162" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t\t<g opacity="0.8">\n\t\t\t\t\t\t\t\t\t<g opacity="0.8" filter="url(#filter0_d_348_93445)">\n\t\t\t\t\t\t\t\t\t\t<path d="M87.0298 24.5516C87.0298 15.9188 93.507 9.42059 101.372 10.041L225.88 19.8304C231.526 20.272 236.027 26.4233 236.027 33.5839V117.788C236.027 124.938 231.516 131.079 225.88 131.499L101.372 140.752C93.507 141.341 87.0298 134.822 87.0298 126.179V24.5516Z" fill="#C4E6FF"/>\n\t\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t</g>\n\t\t\t\t\t\t\t\t<path opacity="0.05" fill-rule="evenodd" clip-rule="evenodd" d="M107.155 46.8539C107.155 46.4964 106.893 46.1915 106.556 46.1809C106.22 46.1704 105.957 46.4543 105.957 46.8118V56.5592L96.9034 56.3384C96.5669 56.3384 96.2935 56.6223 96.2935 56.9798C96.2935 57.3373 96.5669 57.6422 96.9034 57.6528L105.957 57.8631V77.3683H96.9034C96.5669 77.3683 96.2935 77.6627 96.2935 78.0307C96.2935 78.3988 96.5669 78.6827 96.9034 78.6827H105.957V98.1669L96.9034 98.3877C96.5669 98.3877 96.2935 98.6926 96.2935 99.0606C96.2935 99.4287 96.5669 99.7126 96.9034 99.702L105.957 99.4602V118.965L96.9034 119.407C96.5669 119.428 96.2935 119.733 96.2935 120.091C96.2935 120.448 96.5669 120.732 96.9034 120.721L105.957 120.259V130.006C105.957 130.364 106.22 130.637 106.556 130.616C106.893 130.595 107.155 130.29 107.155 129.933V120.196L124.663 119.312V128.849C124.663 129.196 124.915 129.47 125.231 129.449C125.546 129.428 125.798 129.133 125.798 128.776V119.249L142.549 118.398V127.724C142.549 128.071 142.791 128.334 143.096 128.313C143.4 128.292 143.642 127.998 143.642 127.661V118.345L159.688 117.535V126.673C159.688 127.009 159.919 127.272 160.214 127.251C160.508 127.23 160.74 126.946 160.74 126.61V117.483L176.123 116.705V125.653C176.123 125.979 176.344 126.231 176.628 126.221C176.912 126.21 177.132 125.926 177.132 125.59V116.652L191.895 115.906V124.675C191.895 125.001 192.116 125.243 192.379 125.232C192.642 125.222 192.863 124.938 192.863 124.622V115.864L207.037 115.149V123.739C207.037 124.055 207.247 124.297 207.5 124.286C207.752 124.275 207.962 124.002 207.962 123.687V115.106L221.59 114.412V122.835C221.59 123.14 221.789 123.382 222.031 123.371C222.273 123.361 222.473 123.087 222.473 122.782V114.37L228.214 114.076C228.456 114.065 228.656 113.803 228.656 113.498C228.656 113.193 228.456 112.951 228.214 112.961L222.473 113.245V96.4214L228.214 96.2742C228.456 96.2742 228.656 96.0113 228.656 95.7064C228.656 95.4014 228.456 95.1596 228.214 95.1596L222.473 95.2963V78.4724H228.214C228.456 78.4724 228.656 78.2095 228.656 77.9045C228.656 77.5996 228.456 77.3473 228.214 77.3473H222.473V60.5233L228.214 60.6495C228.456 60.6495 228.656 60.4077 228.656 60.1027C228.656 59.7978 228.456 59.5454 228.214 59.5349L222.473 59.3982V50.9863C222.473 50.6813 222.273 50.4185 222.031 50.408C221.789 50.3974 221.59 50.6393 221.59 50.9547V59.3772L207.962 59.0407V50.4605C207.962 50.1451 207.752 49.8822 207.5 49.8717C207.247 49.8612 207.037 50.1135 207.037 50.429V59.0197L192.863 58.6727V49.9138C192.863 49.5878 192.642 49.3249 192.379 49.3144C192.116 49.3039 191.895 49.5562 191.895 49.8822V58.6517L177.132 58.2942V49.3565C177.132 49.0305 176.912 48.7571 176.628 48.7466C176.344 48.7361 176.123 48.999 176.123 49.3249V58.2731L160.74 57.8946V48.7676C160.74 48.4311 160.508 48.1472 160.214 48.1367C159.919 48.1262 159.688 48.3891 159.688 48.7256V57.8631L143.642 57.474V48.1578C143.642 47.8108 143.4 47.5269 143.096 47.5163C142.791 47.5058 142.549 47.7792 142.549 48.1157V57.4425L125.798 57.0324V47.5058C125.798 47.1588 125.546 46.8644 125.231 46.8539C124.915 46.8434 124.663 47.1168 124.663 47.4638V57.0008L107.155 56.5802V46.8434V46.8539ZM221.6 113.287V96.4424L207.973 96.7999V113.96L221.6 113.287ZM207.047 114.002V96.8209L192.873 97.189V114.696L207.047 114.002ZM191.906 114.738V97.21L177.143 97.5991V115.464L191.906 114.738ZM176.134 115.517V97.6201L160.75 98.0197V116.263L176.134 115.506V115.517ZM159.699 116.326V98.0617L143.653 98.4823V117.115L159.699 116.326ZM142.559 117.167V98.5033L125.809 98.945V117.988L142.559 117.167ZM124.663 118.04V98.966L107.155 99.4287V118.902L124.663 118.04ZM124.663 97.7042L107.155 98.1353V78.6616L124.663 78.6301V97.7042ZM142.559 97.2626L125.809 97.6727V78.6301L142.559 78.5985V97.2626ZM159.699 96.842L143.653 97.2416V78.6091L159.699 78.5775V96.842ZM176.134 96.4319L160.75 96.8104V78.567L176.134 78.546V96.4424V96.4319ZM191.906 96.0428L177.143 96.4109V78.546L191.906 78.5249V96.0534V96.0428ZM207.047 95.6748L192.873 96.0218V78.5144L207.047 78.4934V95.6748ZM221.6 95.3173L207.973 95.6538V78.4934L221.6 78.4724V95.3173ZM221.6 77.3367V60.4918L207.973 60.1763V77.3367H221.6ZM207.047 77.3473V60.1658L192.873 59.8399V77.3473H207.047ZM191.906 77.3473V59.8188L177.143 59.4824V77.3473H191.906ZM176.134 77.3473V59.4508L160.75 59.1038V77.3473H176.134ZM159.699 77.3473V59.0828L143.653 58.7148V77.3473H159.699ZM142.559 77.3578V58.6937L125.809 58.3152V77.3578H142.559ZM124.663 77.3578V58.2837L107.155 57.8841V77.3578H124.663Z" fill="#1F86FF"/>\n\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M225.88 20.9239L101.372 11.3238C94.1694 10.7665 88.2495 16.718 88.2495 24.6252V126.116C88.2495 134.023 94.18 139.995 101.372 139.469L225.88 130.395C231.053 130.017 235.196 124.391 235.196 117.83V33.5314C235.196 26.97 231.053 21.3235 225.88 20.9239ZM101.372 10.041C93.507 9.42059 87.0298 15.9188 87.0298 24.5516V126.189C87.0298 134.822 93.507 141.341 101.372 140.763L225.88 131.51C231.526 131.089 236.027 124.959 236.027 117.798V33.5839C236.027 26.4338 231.516 20.272 225.88 19.8304L101.372 10.041Z" fill="#9BD4FF" fill-opacity="0.8"/>\n\t\t\t\t\t\t\t\t<path opacity="0.1" d="M87.0298 24.867C87.0298 16.0555 93.507 9.43103 101.372 10.0409L225.88 19.8303C231.526 20.2719 236.027 26.5494 236.027 33.8467V42.6583L87.0298 35.4976V24.867Z" fill="#0075FF"/>\n\t\t\t\t\t\t\t\t<path d="M96.9034 54.3721C96.9034 50.0189 100.174 46.6015 104.169 46.7487L147.459 48.2944C151.024 48.4206 153.894 51.8169 153.894 55.8862V119.68C153.894 123.75 151.024 127.22 147.459 127.44L104.169 130.132C100.174 130.385 96.9034 127.051 96.9034 122.698V54.3721Z" fill="white"/>\n\t\t\t\t\t\t\t\t<path d="M122.949 61.1113C122.949 59.881 123.843 58.9031 124.957 58.9242L144.473 59.3553C145.525 59.3763 146.376 60.3647 146.376 61.5634C146.376 62.7621 145.525 63.719 144.473 63.6979L124.957 63.372C123.853 63.351 122.949 62.3415 122.949 61.1113Z" fill="#DFE0E3" fill-opacity="0.68"/>\n\t\t\t\t\t\t\t\t<path opacity="0.8" d="M101.761 57.1054C101.761 54.2243 103.917 51.9425 106.567 52.0267L113.664 52.237C116.251 52.3106 118.333 54.6659 118.333 57.505V65.1914C118.333 68.0199 116.251 70.3017 113.664 70.2806L106.567 70.2175C103.928 70.1965 101.761 67.8412 101.761 64.9495V57.1054Z" fill="#59FBB0" fill-opacity="0.74"/>\n\t\t\t\t\t\t\t\t<path opacity="0.3" d="M96.9037 75.3916L153.884 75.5178V119.681C153.884 123.75 151.014 127.22 147.449 127.441L104.159 130.132C100.163 130.385 96.8932 127.052 96.8932 122.698V75.3916H96.9037Z" fill="#D7EFFF" fill-opacity="0.8"/>\n\t\t\t\t\t\t\t\t<path d="M134.274 90.5539C134.274 89.3342 135.146 88.3458 136.219 88.3247L144.473 88.2091C145.525 88.1986 146.376 89.1554 146.376 90.3541C146.376 91.5528 145.525 92.5412 144.473 92.5623L136.219 92.72C135.146 92.741 134.274 91.7736 134.274 90.5539Z" fill="#DFE0E3" fill-opacity="0.68"/>\n\t\t\t\t\t\t\t\t<path d="M134.274 113.171C134.274 111.952 135.146 110.932 136.219 110.89L144.473 110.553C145.525 110.511 146.376 111.447 146.376 112.646C146.376 113.844 145.525 114.854 144.473 114.896L136.219 115.274C135.146 115.327 134.274 114.381 134.274 113.161V113.171Z" fill="#DFE0E3" fill-opacity="0.68"/>\n\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M129.08 90.2276L123.612 85.9375C123.486 85.8323 123.317 85.8218 123.17 85.9164C123.033 86.0006 122.939 86.1688 122.949 86.3581V95.1275C122.949 95.3168 123.033 95.4745 123.17 95.5586C123.307 95.6428 123.475 95.6217 123.612 95.5166L129.08 91.0477C129.195 90.9531 129.258 90.8059 129.258 90.6376C129.258 90.4694 129.185 90.3222 129.08 90.2381V90.2276Z" fill="#0075FF" fill-opacity="0.78"/>\n\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M110.583 90.5222L104.863 86.1374C104.727 86.0323 104.548 86.0218 104.401 86.1059C104.253 86.19 104.159 86.3688 104.169 86.558V95.5273C104.169 95.7165 104.253 95.8848 104.401 95.9689C104.548 96.053 104.727 96.032 104.863 95.9269L110.583 91.3528C110.699 91.2582 110.773 91.1005 110.773 90.9323C110.773 90.764 110.699 90.6168 110.583 90.5222Z" fill="#DFE0E3" fill-opacity="0.68"/>\n\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M129.08 112.993L123.612 108.85C123.486 108.755 123.317 108.745 123.17 108.839C123.033 108.934 122.939 109.102 122.949 109.292V118.061C122.949 118.25 123.033 118.408 123.17 118.492C123.307 118.576 123.475 118.555 123.612 118.44L129.08 113.813C129.195 113.718 129.258 113.561 129.258 113.403C129.258 113.245 129.185 113.087 129.08 113.003V112.993Z" fill="#0075FF" fill-opacity="0.78"/>\n\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M110.583 113.792L104.863 109.565C104.727 109.459 104.548 109.459 104.401 109.554C104.253 109.649 104.159 109.827 104.169 110.017V118.986C104.169 119.175 104.253 119.344 104.401 119.428C104.548 119.512 104.727 119.491 104.863 119.375L110.583 114.643C110.699 114.549 110.773 114.391 110.773 114.223C110.773 114.054 110.699 113.907 110.583 113.813V113.792Z" fill="#DFE0E3" fill-opacity="0.68"/>\n\t\t\t\t\t\t\t\t<path d="M171.581 63.5515C171.581 60.2393 173.852 57.6105 176.638 57.6841L223.829 58.8723C226.269 58.9354 228.235 61.4695 228.235 64.5504V75.6857C228.235 78.7561 226.269 81.2586 223.829 81.2797L176.638 81.5425C173.852 81.5531 171.581 78.8823 171.581 75.5701V63.5725V63.5515Z" fill="white"/>\n\t\t\t\t\t\t\t\t<path d="M193.347 69.7651C193.347 68.64 194.104 67.7357 195.029 67.7462L217.794 68.0301C218.667 68.0406 219.371 68.9344 219.371 70.0174C219.371 71.1005 218.667 71.9837 217.794 71.9732L195.029 71.8155C194.104 71.8155 193.347 70.8902 193.347 69.7651Z" fill="#DFE0E3" fill-opacity="0.68"/>\n\t\t\t\t\t\t\t\t<path opacity="0.3" d="M175.629 66.0119C175.629 63.3727 177.427 61.2697 179.635 61.3223L185.566 61.4484C187.732 61.4905 189.477 63.625 189.477 66.2222V73.2567C189.477 75.8434 187.732 77.9464 185.566 77.9464H179.635C177.427 77.9464 175.629 75.8224 175.629 73.1831V66.0224V66.0119Z" fill="#44B0FF" fill-opacity="0.74"/>\n\t\t\t\t\t\t\t\t<path d="M177.638 93.4241C177.638 90.1329 179.877 87.4411 182.611 87.4095L220.255 86.9153C222.715 86.8838 224.702 89.3653 224.702 92.4462V103.634C224.702 106.725 222.715 109.312 220.255 109.417L182.611 111.068C179.867 111.184 177.638 108.618 177.638 105.338V93.4346V93.4241Z" fill="white"/>\n\t\t\t\t\t\t\t\t<path d="M199.077 98.7659C199.077 97.6513 199.824 96.726 200.728 96.6944L216.889 96.2738C217.762 96.2528 218.467 97.115 218.467 98.2086C218.467 99.3021 217.762 100.206 216.889 100.227L200.728 100.732C199.813 100.764 199.077 99.8804 199.077 98.7553V98.7659Z" fill="#DFE0E3" fill-opacity="0.68"/>\n\t\t\t\t\t\t\t\t<path opacity="0.3" d="M181.633 95.706C181.633 93.0878 183.41 90.9322 185.576 90.9007L191.422 90.7956C193.557 90.7535 195.271 92.8144 195.271 95.3801V102.362C195.271 104.928 193.557 107.083 191.422 107.167L185.576 107.399C183.4 107.483 181.633 105.432 181.633 102.814V95.706Z" fill="#FAA72C" fill-opacity="0.78"/>\n\t\t\t\t\t\t\t\t<path d="M213.03 113.14C213.03 107.493 216.689 102.783 221.158 102.635L243.524 101.857C247.677 101.71 251 105.948 251 111.3V139.154C251 144.516 247.667 149.196 243.524 149.616L221.158 151.887C216.689 152.34 213.03 148.134 213.03 142.487V113.129V113.14Z" fill="#1BCE7B" fill-opacity="0.78"/>\n\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M243.524 102.94L221.158 103.75C217.194 103.897 213.945 108.072 213.945 113.087V142.403C213.945 147.419 217.194 151.162 221.158 150.762L243.524 148.523C247.214 148.155 250.18 143.991 250.18 139.217V111.331C250.18 106.557 247.214 102.804 243.524 102.94ZM221.158 102.625C216.689 102.783 213.03 107.483 213.03 113.129V142.487C213.03 148.134 216.689 152.34 221.158 151.887L243.524 149.616C247.677 149.196 251 144.506 251 139.154V111.3C251 105.937 247.667 101.71 243.524 101.857L221.158 102.635V102.625Z" fill="white" fill-opacity="0.18"/>\n\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M224.082 136.314L222.368 136.451C221.558 136.514 220.896 135.736 220.896 134.716C220.896 133.696 221.558 132.813 222.368 132.75L224.082 132.624C224.681 130.426 226.301 128.765 228.204 128.628C230.107 128.491 231.684 129.911 232.273 132.003L241 131.341C241.768 131.278 242.399 132.045 242.399 133.034C242.399 134.022 241.779 134.884 241 134.948L232.273 135.652C231.684 137.829 230.086 139.5 228.204 139.658C226.322 139.816 224.692 138.417 224.082 136.314ZM231.327 122.908L222.357 123.476C221.548 123.528 220.885 122.74 220.885 121.709C220.885 120.679 221.548 119.817 222.357 119.764L231.327 119.249C231.916 117.083 233.503 115.474 235.364 115.369C237.226 115.264 238.782 116.704 239.36 118.776L241 118.681C241.768 118.639 242.399 119.406 242.399 120.405C242.399 121.404 241.779 122.245 241 122.298L239.36 122.403C238.782 124.548 237.215 126.168 235.364 126.294C233.514 126.42 231.916 125 231.327 122.908ZM235.364 122.645C236.143 122.592 236.784 121.741 236.784 120.742C236.784 119.743 236.153 118.965 235.364 119.007C234.576 119.049 233.945 119.911 233.945 120.91C233.945 121.909 234.586 122.698 235.364 122.645ZM228.193 135.978C228.992 135.915 229.634 135.042 229.634 134.022C229.634 133.002 228.992 132.235 228.193 132.298C227.394 132.361 226.742 133.234 226.742 134.254C226.742 135.273 227.394 136.041 228.193 135.978Z" fill="white" fill-opacity="0.9"/>\n\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M165.945 70.1017C164.515 70.0912 163.358 71.4371 163.358 73.109V86.442C163.358 88.7868 161.728 90.7111 159.709 90.7426L153.895 90.8372V89.607L159.709 89.5123C161.15 89.4913 162.328 88.1139 162.328 86.442V73.088C162.328 70.7432 163.958 68.861 165.955 68.882L171.591 68.9451V70.1438L165.955 70.0912L165.945 70.1017Z" fill="#44B0FF" fill-opacity="0.74"/>\n\t\t\t\t\t\t\t\t<path fill-rule="evenodd" clip-rule="evenodd" d="M168.784 100.227C167.364 100.269 166.218 101.657 166.218 103.319V108.156C166.218 110.49 164.599 112.456 162.59 112.54L153.905 112.929V111.699L162.59 111.321C164.02 111.258 165.188 109.859 165.188 108.187V103.35C165.188 101.016 166.807 99.0708 168.794 99.0182L177.658 98.7764V99.9646L168.794 100.227H168.784Z" fill="#44B0FF" fill-opacity="0.74"/>\n\t\t\t\t\t\t\t\t<defs>\n\t\t\t\t\t\t\t\t\t<filter id="filter0_d_348_93445" x="79.4698" y="4.6" width="164.117" height="145.909" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">\n\t\t\t\t\t\t\t\t\t\t<feFlood flood-opacity="0" result="BackgroundImageFix"/>\n\t\t\t\t\t\t\t\t\t\t<feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>\n\t\t\t\t\t\t\t\t\t\t<feOffset dy="2.16"/>\n\t\t\t\t\t\t\t\t\t\t<feGaussianBlur stdDeviation="3.78"/>\n\t\t\t\t\t\t\t\t\t\t<feComposite in2="hardAlpha" operator="out"/>\n\t\t\t\t\t\t\t\t\t\t<feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.02 0"/>\n\t\t\t\t\t\t\t\t\t\t<feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_348_93445"/>\n\t\t\t\t\t\t\t\t\t\t<feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_348_93445" result="shape"/>\n\t\t\t\t\t\t\t\t\t</filter>\n\t\t\t\t\t\t\t\t</defs>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<p>{{loc('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_TEXT')}}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div ref="contentContainer"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</Transition>\n\t\t\t\t<div v-if="isLoading" class="loader-spinner node-settings-content">\n\t\t\t\t\t<span class="dot dot1"></span>\n\t\t\t\t\t<span class="dot dot2"></span>\n\t\t\t\t\t<span class="dot dot3"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="node-settings-footer" v-show="hasSettings">\n\t\t\t\t\t<button class="ui-btn --air ui-btn-lg --style-outline-fill-accent ui-btn-no-caps" @click="handleFormSave">\n\t\t\t\t\t\t{{loc('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_SAVE')}}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="ui-btn --air ui-btn-lg --style-outline ui-btn-no-caps" @click="handleFormCancel">\n\t\t\t\t\t\t{{loc('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CANCEL')}}\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<div class="node-settings-document-selector" v-show="useDocumentContext">\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tname="document"\n\t\t\t\t\t\t\t:size="24"\n\t\t\t\t\t\t\t@click="handleDocumentSelector"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</transition>\n\t`};const _n=Object.freeze({[ee.equal]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_EQUAL",[ee.notEqual]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_NOT_EQUAL",[ee.empty]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_EMPTY",[ee.notEmpty]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_NOT_EMPTY",[ee.contain]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_CONTAIN",[ee.notContain]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_NOT_CONTAIN",[ee.in]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_IN",[ee.notIn]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_NOT_IN",[ee.greaterThan]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_GREATER_THAN",[ee.greaterThanOrEqual]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_GREATER_THAN_OR_EQUAL",[ee.lessThan]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_LESS_THAN",[ee.lessThanOrEqual]:"BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR_LESS_THAN_OR_EQUAL"});const yn=t=>{switch(t){case ee.empty:case ee.notEmpty:return false;default:return true}};const Tn="field";var kn=babelHelpers.classPrivateFieldLooseKey("getValue");var On=babelHelpers.classPrivateFieldLooseKey("getEntities");var Bn=babelHelpers.classPrivateFieldLooseKey("getTabs");var Nn=babelHelpers.classPrivateFieldLooseKey("getItems");var Rn=babelHelpers.classPrivateFieldLooseKey("processReturnProperties");var Ln=babelHelpers.classPrivateFieldLooseKey("processChildrenProperties");class Dn{constructor(t,e){Object.defineProperty(this,Ln,{value:Fn});Object.defineProperty(this,Rn,{value:xn});Object.defineProperty(this,Nn,{value:An});Object.defineProperty(this,Bn,{value:wn});Object.defineProperty(this,On,{value:Mn});Object.defineProperty(this,kn,{value:Pn});this.store=rt();this.currentBlock=t;this.currentPortId=e}show(t){return new Promise((e=>{const n=new l.Dialog({targetNode:t,width:500,height:300,multiple:false,dropdownMode:true,enableSearch:true,items:babelHelpers.classPrivateFieldLooseBase(this,Nn)[Nn](),tabs:babelHelpers.classPrivateFieldLooseBase(this,Bn)[Bn](),entities:babelHelpers.classPrivateFieldLooseBase(this,On)[On](),cacheable:false,showAvatars:false,events:{"Item:onSelect":t=>{e(babelHelpers.classPrivateFieldLooseBase(this,kn)[kn](t.getData().item))}},compactView:true});n.show()}))}addTemplateItems(t){const e=[{key:"PARAMETERS",idKey:"Template",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_ITEM_PARAMETERS")},{key:"VARIABLES",idKey:"Variable",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_ITEM_VARIABLES")},{key:"CONSTANTS",idKey:"Constant",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_ITEM_CONSTANTS")}];e.forEach((e=>{const n=this.store.template[e.key];if(b.Type.isObject(n)&&Object.keys(n).length>0){const o=[];Object.keys(n).forEach((t=>{const i=n[t];const s=`${e.idKey}:${t}`;o.push({id:s,entityId:e.key,title:i.Name,customData:{[Tn]:{object:e.idKey,fieldId:t,type:i.Type,multiple:i.Multiple}}})}));t.push({id:e.idKey,entityId:"template",title:e.title,tabs:"template",children:o})}}))}getReturnItems(){const t=this.store.getBlockAncestorsByInputPortId(this.currentBlock,this.currentPortId);return t.reduce(((t,e)=>{if(b.Type.isArrayFilled(e.activity.Children)){const n=babelHelpers.classPrivateFieldLooseBase(this,Ln)[Ln](e);if(b.Type.isArrayFilled(n)){t.push(...n)}}if(b.Type.isArrayFilled(e.activity.ReturnProperties)){const n=babelHelpers.classPrivateFieldLooseBase(this,Rn)[Rn](e);if(b.Type.isArrayFilled(n)){t.push(...n)}}return t}),[])}}function Pn(t){return t.getCustomData().get(Tn)}function Mn(){return[{id:"bizproc-document"}]}function wn(){return[{id:"returns",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_TAB_RETURNS"),icon:"flag-1"},{id:"template",title:b.Loc.getMessage("BIZPROCDESIGNER_SELECTOR_TAB_TEMPLATE"),icon:"disk"}]}function An(){const t=this.getReturnItems();this.addTemplateItems(t);return t}function xn(t){const e=t.activity.Properties.Title;const{properties:n}=t.activity.ReturnProperties.reduce(((e,n)=>{const o=`${t.id}:${n.Id}`;if(n.Type==="document"){return e}e.properties.push({id:o,entityId:"block-node-property",title:n.Name,property:n,block:t,customData:{[Tn]:{object:t.id,fieldId:n.Id,type:n.Type,multiple:n.Multiple}}});return e}),{properties:[]});const o=[];if(b.Type.isArrayFilled(n)){o.push({id:t.id,entityId:"block-node",tabs:"returns",title:e,children:n,searchable:false})}return o}function Fn(t){const e=[];t.activity.Children.forEach((t=>{if(b.Type.isArrayFilled(t.ReturnProperties)){const n=babelHelpers.classPrivateFieldLooseBase(this,Rn)[Rn]({id:t.Name,activity:t});if(b.Type.isArrayFilled(n)){e.push(...n)}}}));const n=[];if(b.Type.isArrayFilled(e)){n.push({id:t.id,entityId:"block-node",tabs:"returns",title:t.activity.Properties.Title,children:e,searchable:false})}return n}const Vn={name:"edit-condition-expression",props:{construction:{type:Object,required:true}},setup(){const{getMessage:t}=N();return{getMessage:t}},computed:{...S.mapState(ae,["nodeSettings","block","currentRuleId"]),availableOperators(){return Object.values(ee).map((t=>{var e;return{id:t,title:this.getMessage((e=_n[t])!=null?e:"")}}))},selectedField:{get(){return this.construction.expression.field},set(t){this.changeRuleExpression(this.construction,{field:t,value:"",operator:""})}},selectedFieldTitle(){if(!this.selectedField){return this.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_EXPRESSION_ITEM_NOT_SELECTED")}const t=rt();const e=t.getBlockAncestorsByInputPortId(this.block,this.currentRuleId);return se(e,this.selectedField)},selectedValue:{get(){return this.construction.expression.value},set(t){this.changeRuleExpression(this.construction,{value:t})}},selectedOperatorTitle(){var t,e;return(t=(e=this.availableOperators.find((({id:t})=>t===this.selectedOperator)))==null?void 0:e.title)!=null?t:this.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_EXPRESSION_ITEM_NOT_SELECTED")},selectedOperator:{get(){return this.construction.expression.operator},set(t){this.changeRuleExpression(this.construction,{operator:t})}},isShowValueEditor(){if(!this.selectedOperator){return false}return yn(this.selectedOperator)}},methods:{...S.mapActions(ae,["changeRuleExpression"]),onShowFieldChooseMenu(t){const e=new Dn(this.block,this.currentRuleId);void e.show(t.target).then((t=>{this.selectedField=t}))},onShowValueMenu(t){if(!this.block){return}const e=new cn(rt(),this.block,this.currentRuleId);void e.show(t.target).then((t=>{this.selectedValue+=t}))},onShowOperatorMenu(t){const e=this.availableOperators.map((({id:t,title:e})=>({id:t,text:e,onclick:()=>{var e;this.selectedOperator=t;(e=this.operatorMenu)==null?void 0:e.close()}})));this.operatorMenu=a.MenuManager.create({id:"operator-menu",bindElement:t.target,items:e,closeByEsc:true,autoHide:true,cacheable:false,maxHeight:200});this.operatorMenu.show()}},template:`\n\t\t<div class="edit-condition-expression-form">\n\t\t\t<div class="edit-condition-expression-form__item">\n\t\t\t\t<span class="edit-condition-expression-form__label">\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_FIELD') }}\n\t\t\t\t</span>\n\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown edit-condition-expression-form__dropdown">\n\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="fieldChooseMenu"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t@click="onShowFieldChooseMenu"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ selectedFieldTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="edit-condition-expression-form__item">\n\t\t\t\t<span class="edit-condition-expression-form__label">\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_EXPRESSION_OPERATOR') }}\n\t\t\t\t</span>\n\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown edit-condition-expression-form__dropdown"\n\t\t\t\t\t @click="onShowOperatorMenu"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ selectedOperatorTitle }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if="isShowValueEditor"\n\t\t\t\tclass="edit-condition-expression-form__item"\n\t\t\t>\n\t\t\t\t<span class="edit-condition-expression-form__label">\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_EXPRESSION_VALUE') }}\n\t\t\t\t</span>\n\t\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown edit-condition-expression-form__dropdown">\n\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-dots" style="pointer-events: all"\n\t\t\t\t\t\t @click="onShowValueMenu"\n\t\t\t\t\t></div>\n\t\t\t\t\t<input\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\tv-model="selectedValue"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Gn={name:"add-construction",components:{BIcon:f.BIcon},props:{ruleCard:{type:[Object,null],default:null},position:{type:[Number,undefined],default:undefined}},setup(){const{getMessage:t}=N();return{getMessage:t}},methods:{...S.mapActions(ae,["addConstruction","addRuleCard"]),onShowMenu(){this.menu=a.MenuManager.create("constructions-menu",this.$refs.constructionsMenu,this.getMenuItems(),{closeByEsc:true,autoHide:true,cacheable:false,offsetLeft:-50,offsetTop:7});this.menu.show()},getMenuItems(){var t,e;const n=((t=(e=this.ruleCard)==null?void 0:e.constructions)!=null?t:[]).some((t=>t.type===Jt.ACTION));return[{id:Jt.AND_CONDITION,text:this.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_BOOLEAN_MENU_ITEM"),onclick:this.onClickMenuItem,dataset:{testId:"complexNodeRuleSettingsMenuItemConstructionAnd"},disabled:this.isIfConditionNotExist(this.ruleCard)},{id:Jt.IF_CONDITION,text:this.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_CONDITION_MENU_ITEM"),dataset:{testId:"complexNodeRuleSettingsMenuItemConstructionIf"},onclick:this.onClickMenuItem},{id:Jt.ACTION,text:this.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ACTION_MENU_ITEM"),dataset:{testId:"complexNodeRuleSettingsMenuItemConstructionAction"},onclick:this.onClickMenuItem,disabled:n},{id:Jt.OUTPUT,text:this.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_OUTPUT_MENU_ITEM"),dataset:{testId:"complexNodeRuleSettingsMenuItemConstructionOutput"},onclick:this.onClickMenuItem}]},onClickMenuItem(...t){var e;const[,n]=t;const o=(e=this.ruleCard)!=null?e:this.addRuleCard();this.addConstruction(o,n.id,this.position);this.menu.close()},isIfConditionNotExist(t){if(!t){return true}return t.constructions.every((t=>t.type===Jt.ACTION))}},template:`\n\t\t<div\n\t\t\tclass="add-construction"\n\t\t\t@click="onShowMenu"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tname="plus-m"\n\t\t\t\t:size="20"\n\t\t\t\tcolor="#828b95"\n\t\t\t/>\n\t\t\t<span ref="constructionsMenu">\n\t\t\t\t<slot>\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ADD_CONSTRUCTION_LABEL') }}\n\t\t\t\t</slot>\n\t\t\t</span>\n\t\t</div>\n\t`};const Zn={name:"delete-construction",components:{BIcon:f.BIcon},props:{iconColor:{type:String,required:true},ruleCard:{type:Object,required:true},construction:{type:Object,required:true}},methods:{...S.mapActions(ae,["deleteConstruction"])},template:`\n\t\t<BIcon\n\t\t\t:color="iconColor"\n\t\t\t:data-test-id="$testId('complexNodeRuleSettingsDeleteConstruction', construction.id)"\n\t\t\tclass="delete-construction"\n\t\t\tname="cross-s"\n\t\t\t@click="deleteConstruction(ruleCard, construction)"\n\t\t/>\n\t`};const Hn={name:"select-boolean-type",props:{construction:{type:Object,required:true}},setup(){const{getMessage:t}=N();return{getMessage:t}},data(){return{selectedType:Jt.AND_CONDITION}},computed:{booleanTypes(){return[Jt.AND_CONDITION,Jt.OR_CONDITION]},constructionLabels(){return Qt}},methods:{...S.mapActions(ae,["selectBooleanType"]),onClick(t){this.selectedType=t;this.selectBooleanType(this.construction,t)}},template:`\n\t\t<div class="node-settings-boolean-type-switcher">\n\t\t\t<span\n\t\t\t\tv-for="booleanType in booleanTypes"\n\t\t\t\tclass="node-settings-boolean-type-switcher_tab"\n\t\t\t\t:class="{ '--selected': selectedType === booleanType }"\n\t\t\t\t@click="onClick(booleanType)"\n\t\t\t>\n\t\t\t\t{{ getMessage(constructionLabels[booleanType]) }}\n\t\t\t</span>\n\t\t</div>\n\t`};const Un={name:"select-rule",components:{BIcon:f.BIcon},props:{block:{type:Object,required:true}},computed:{...S.mapState(ae,["currentRuleId"]),currentRuleTitle(){const t=this.block.ports.input;const{title:e}=t.find((t=>t.id===this.currentRuleId));return e}},methods:{...S.mapActions(ae,["setCurrentRuleId"]),getMenuItems(){return this.block.ports.input.map((t=>({id:t.id,text:t.title,dataset:{testId:`menuItemRule-${t.id}`},onclick:()=>{this.setCurrentRuleId(t.id);this.menu.close()}})))},onShowMenu(){this.menu=a.MenuManager.create("constructions-menu",this.$refs.nodeSettingsRulesDropdown,this.getMenuItems(),{width:100,maxHeight:200,closeByEsc:true,autoHide:true,cacheable:false});this.menu.show()}},template:`\n\t\t<div\n\t\t\tclass="node-settings-rules-dropdown"\n\t\t\tref="nodeSettingsRulesDropdown"\n\t\t\t:data-test-id="$testId('complexNodeRuleSettingsDropdown')"\n\t\t\t@click="onShowMenu"\n\t\t>\n\t\t\t<span class="node-settings-rules-dropdown__value">\n\t\t\t\t{{ currentRuleTitle }}\n\t\t\t</span>\n\t\t\t<BIcon\n\t\t\t\t:size="14"\n\t\t\t\tname="chevron-down"\n\t\t\t\tcolor="#525C69"\n\t\t\t/>\n\t\t</div>\n\t`};const $n={name:"save-settings-button",props:{isSaving:{type:Boolean,required:true}},setup(){const{getMessage:t}=N();return{getMessage:t}},template:`\n\t\t<button\n\t\t\tclass="ui-btn --air ui-btn-lg ui-btn-no-caps"\n\t\t\t:class="{'ui-btn-wait': isSaving }"\n\t\t>\n\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_SAVE') }}\n\t\t</button>\n\t`};const zn={name:"cancel-settings-button",setup(){const{getMessage:t}=N();return{getMessage:t}},template:`\n\t\t<button class="ui-btn ui-btn-lg ui-btn-link ui-btn-no-caps">\n\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_DISCARD') }}\n\t\t</button>\n\t`};const jn={name:"delete-rule-card",components:{BIcon:f.BIcon},props:{ruleCard:{type:Object,required:true}},methods:{...S.mapActions(ae,["deleteRuleCard"])},template:`\n\t\t<BIcon\n\t\t\tclass="delete-rule-card"\n\t\t\tname="cross-m"\n\t\t\t:size="20"\n\t\t\t:data-test-id="$testId('complexNodeRuleSettingsDeleteRuleCard', ruleCard.id)"\n\t\t\tcolor="#a8adb4"\n\t\t\t@click="deleteRuleCard(ruleCard)"\n\t\t/>\n\t`};const Xn=Object.freeze({Loading:"loading",Loaded:"loaded",Error:"error"});const qn={name:"action-settings-form",components:{Loader:bt},props:{construction:{type:Object,required:true},actionId:{type:String,required:true},template:{type:[Object,null],required:true},documentType:{type:Array,required:true},activityData:{type:[Object,null],required:true}},setup(){const t=rt();return{store:t}},data(){return{status:"",settingsForm:null}},computed:{...S.mapState(ae,["block","currentRuleId"]),Status:()=>Xn},watch:{actionId(t,e){if(t===e){return}this.init()}},mounted(){this.init()},unmounted(){this.unsubscribe()},methods:{...S.mapActions(ae,["changeRuleExpression"]),async init(){try{await this.loadForm();window.BPAShowSelector=this.showSelector;window.HideShow=this.hideShow;this.subscribeOnBeforeSubmit()}catch(t){this.status=Xn.Error;console.error(t)}},subscribeOnBeforeSubmit(){this.unsubscribe();this.onChangeCallback=()=>this.onChange();r.EventEmitter.subscribe(oe.BEFORE_SUBMIT_EVENT,this.onChangeCallback)},unsubscribe(){if(this.onChangeCallback){r.EventEmitter.unsubscribe(oe.BEFORE_SUBMIT_EVENT,this.onChangeCallback)}},async showSelector(t){const e=new cn(this.store,this.block,this.currentRuleId);const n=document.getElementById(t);try{const t=await e.show(n);const o=n.value.slice(0,n.selectionEnd);const i=t;const s=n.value.slice(n.selectionEnd);n.value=o+i+s;n.selectionEnd=o.length+i.length+1;n.focus()}catch(t){console.error(t)}},getFormData(){return this.extractFormData(this.settingsForm)},onChange(){this.changeRuleExpression(this.construction,{rawActivityData:this.getFormData()})},extractFormData(t){const e=b.ajax.prepareForm(t).data;e.documentType=this.documentType;e.activityType=this.actionId;e.id=b.Type.isStringFilled(e.activity_id)?e.activity_id:nt();return e},async loadForm(){var t,e,n,o,i,s;this.$refs.contentContainer.innerHTML="";this.status=Xn.Loading;let l=this.activityData;if(!l){l={Name:nt(),Type:this.actionId,Activated:"Y",Properties:{}}}const a=[{Type:"NodeWorkflowActivity",Children:[],Name:"Template"}];a[0].Children.push(l,...this.store.getAllBlockAncestors(this.block,this.currentRuleId).map((t=>t.activity)));if(window.CreateActivity){window.arAllId={};window.arWorkflowTemplate=a;window.rootActivity=window.CreateActivity(a[0])}const{createFormData:r}=M();const c=r({id:l.Name,documentType:this.documentType,activity:this.actionId,workflow:{parameters:(t=(e=this.template)==null?void 0:e.PARAMETERS)!=null?t:[],variables:(n=(o=this.template)==null?void 0:o.VARIABLES)!=null?n:[],template:a,constants:(i=(s=this.template)==null?void 0:s.CONSTANTS)!=null?i:[]}});await this.renderPropertyDialog(c);this.status=Xn.Loaded},async renderPropertyDialog(t){const{renderPropertyDialog:e}=M();const n=await e(this.$refs.contentContainer,t);if(!n){this.hasSettings=false;return}this.settingsForm=n;this.hasSettings=true}},template:`\n\t\t<Loader v-if="status === Status.Loading" />\n\t\t<div\n\t\t\tref="contentContainer"\n\t\t></div>\n\t`};const Kn={name:"NodeSettings",components:{NodeSettingsLayout:re,EditNodeSettingsForm:Pe,CancelSettingsButton:zn,SaveSettingsButton:$n,NodeSettingsVariable:ce,NodeSettingsRule:de,AddSettingsItem:Me},setup(){const{getMessage:t}=N();return{getMessage:t}},computed:{...S.mapState(rt,["documentType"]),...S.mapState(ae,["block","isShown","isRuleSettingsShown","nodeSettings","isLoading","isSaving","savedBlockInputPorts"]),...S.mapWritableState(ae,["isSaving"])},methods:{...S.mapActions(ae,["toggleVisibility","toggleRuleSettingsVisibility","reset","setCurrentRuleId","deleteRuleSettings","saveForm","discardFormSettings","updateSettings"]),...S.mapActions(rt,["updateNodeTitle","addRulePort","addConnectionPort","deletePort","publicDraft","updateBlockActivityField","setInputPorts","getBlockAncestorsByInputPortId"]),...S.mapActions(Se,["hideRightPanel"]),onShowRuleConstructions(t){this.toggleRuleSettingsVisibility(true);this.setCurrentRuleId(t)},onAddRule(t){this.addRulePort(this.block.id,t,x.input)},onDeleteRule(t){this.deletePort(this.block.id,t);const{outputPortsToAdd:e,outputPortsToDelete:n}=this.deleteRuleSettings(t);e.values().forEach((({portId:t,title:e})=>{this.addRulePort(this.block,t,x.output,e)}));n.keys().forEach((t=>{this.deletePort(this.block.id,t,x.output)}))},onAddConnection(t){this.addConnectionPort(this.block.id,t,x.input)},async onSaveForm(){try{this.isSaving=true;const t=await this.saveForm(this.documentType);this.updateBlockActivityField(this.block.id,t);await this.publicDraft();this.hideSettings()}catch(t){console.error(t)}finally{this.isSaving=false}},hideSettings(){this.hideRightPanel();this.toggleVisibility(false);this.reset()},onClose(){this.discardFormSettings();const{title:t}=this.nodeSettings;this.updateNodeTitle(this.block,t);this.setInputPorts(this.block,this.savedBlockInputPorts);this.hideSettings()},onUpdateTitle(t,e){this.updateNodeTitle(t,e);this.updateSettings({title:e})},onUpdateDescription(t){this.updateSettings({description:t})}},template:`\n\t\t<NodeSettingsLayout\n\t\t\t:isLoading="isLoading"\n\t\t\t:isSaving="isSaving"\n\t\t\t:isShown="isShown"\n\t\t\t@close="onClose"\n\t\t>\n\t\t\t<template #default>\n\t\t\t\t<EditNodeSettingsForm\n\t\t\t\t\t:block="block"\n\t\t\t\t\t@updateTitle="onUpdateTitle(block, $event)"\n\t\t\t\t\t@updateDescription="onUpdateDescription($event)"\n\t\t\t\t>\n\t\t\t\t\t\x3c!--\n\t\t\t\t\t<template #variable="{ variableName, variableValue }">\n\t\t\t\t\t\t<NodeSettingsVariable\n\t\t\t\t\t\t\t:variableName="variableName"\n\t\t\t\t\t\t\t:variableValue="variableValue"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template #addElement="{ itemType }">\n\t\t\t\t\t\t<AddSettingsItem :itemType="itemType">\n\t\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ITEM_ELEMENT') }}\n\t\t\t\t\t\t</AddSettingsItem>\n\t\t\t\t\t</template>\n\t\t\t\t\t--\x3e\n\n\t\t\t\t\t<template #rule="{ port }">\n\t\t\t\t\t\t<NodeSettingsRule\n\t\t\t\t\t\t\t:port="port"\n\t\t\t\t\t\t\t:nodeSettings="nodeSettings"\n\t\t\t\t\t\t\t:connectedBlocks="getBlockAncestorsByInputPortId(block, port.id)"\n\t\t\t\t\t\t\t@showRuleConstructions="onShowRuleConstructions"\n\t\t\t\t\t\t\t@deleteRule="onDeleteRule"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template #addRule="{ itemType }">\n\t\t\t\t\t\t<AddSettingsItem\n\t\t\t\t\t\t\t:itemType="itemType"\n\t\t\t\t\t\t\t@addItem="onAddRule"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ITEM_RULE') }}\n\t\t\t\t\t\t</AddSettingsItem>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template #addConnection="{ itemType }">\n\t\t\t\t\t\t<AddSettingsItem\n\t\t\t\t\t\t\t:itemType="itemType"\n\t\t\t\t\t\t\t@addItem="onAddConnection"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ITEM_CONNECTION') }}\n\t\t\t\t\t\t</AddSettingsItem>\n\t\t\t\t\t</template>\n\t\t\t\t</EditNodeSettingsForm>\n\t\t\t</template>\n\n\t\t\t<template #actions>\n\t\t\t\t<SaveSettingsButton\n\t\t\t\t\t:isSaving="isSaving"\n\t\t\t\t\t:data-test-id="$testId('complexNodeSettingsSave')"\n\t\t\t\t\t@click="onSaveForm"\n\t\t\t\t/>\n\t\t\t\t<CancelSettingsButton\n\t\t\t\t\t:data-test-id="$testId('complexNodeSettingsDiscard')"\n\t\t\t\t\t@click="onClose"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</NodeSettingsLayout>\n\t\t<slot v-if="isShown" />\n\t`};const Wn={name:"edit-output-expression",components:{BIcon:f.BIcon,Popup:d.Popup},props:{construction:{type:Object,required:true},scrolling:{type:Boolean,required:true}},setup(){const{getMessage:t}=N();return{getMessage:t}},data(){return{isPopupShown:false,changedOutputPorts:[]}},computed:{...S.mapState(ae,["nodeSettings","block"]),savedOutputPorts(){var t,e;return(t=(e=this.block)==null?void 0:e.ports.output.map((t=>({portId:t.id,title:t.title}))))!=null?t:[]},selectedPort:{get(){const{portId:t,title:e}=this.construction.expression;return{title:e,portId:t}},set(t){const{portId:e,title:n}=t;this.changeRuleExpression(this.construction,{portId:e,title:n})}},notSelectedMessage(){return this.getMessage("BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_EXPRESSION_ITEM_NOT_SELECTED")},popupOptions(){return{id:"edit-output-expression-popup",bindElement:this.$refs.nodeSettingsRuleOutputDropdown,minHeight:100,maxHeight:200,padding:0,width:200}}},watch:{scrolling(t){if(t&&this.isPopupShown){this.isPopupShown=false}}},created(){this.changedOutputPorts=[...this.savedOutputPorts];if(this.changedOutputPorts.length===0){this.addNewPort()}},methods:{...S.mapActions(ae,["changeRuleExpression"]),selectPort(t){this.selectedPort=t;this.isPopupShown=false},addNewPort(){var t;const e=(t=this.changedOutputPorts[this.changedOutputPorts.length-1])!=null?t:null;const n=e?parseInt(e.portId.replace("o",""),10):0;this.changedOutputPorts.push({portId:`o${n+1}`,title:`E${n+1}`})},deletePort(t){this.changedOutputPorts=this.changedOutputPorts.filter((e=>e.portId!==t));if(t===this.selectedPort.portId){this.selectedPort={portId:null,title:null}}},async tryToScrollBottom(){await this.$nextTick();const t=this.$refs.nodeSettingsRuleOutputDropdownContent;const{scrollHeight:e,clientHeight:n}=t;if(e>n){t.scrollTop=e-n}},onAddButtonClick(){this.addNewPort();this.tryToScrollBottom()}},template:`\n\t\t<div class="edit-output-expression-form">\n\t\t\t<div class="edit-output-expression-form__item">\n\t\t\t\t<span class="edit-output-expression-form__label">\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ACTION_EXPRESSION_NAME') }}\n\t\t\t\t</span>\n\t\t\t\t<div class="ui-ctl ui-ctl-textbox">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\treadonly\n\t\t\t\t\t\t:value="getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ACTION_OUTPUT_TITLE')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="edit-output-expression-form__item">\n\t\t\t\t<span class="edit-output-expression-form__label">\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_EXPRESSION_VALUE') }}\n\t\t\t\t</span>\n\t\t\t\t<div\n\t\t\t\t\tclass="ui-ctl ui-ctl-after-icon ui-ctl-dropdown edit-output-expression-form__dropdown"\n\t\t\t\t\tref="nodeSettingsRuleOutputDropdown"\n\t\t\t\t\t@click="isPopupShown = true"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"></div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\tref="nodeSettingsRuleOutputDropdownValue"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ selectedPort.title ?? notSelectedMessage }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<Popup\n\t\t\t\t\t\tv-if="isPopupShown"\n\t\t\t\t\t\t:options="popupOptions"\n\t\t\t\t\t\t@close="isPopupShown = false"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="edit-output-expression-form__dropdown_popup">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="edit-output-expression-form__dropdown_popup-content"\n\t\t\t\t\t\t\t\tref="nodeSettingsRuleOutputDropdownContent"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-for="outputPort in changedOutputPorts"\n\t\t\t\t\t\t\t\t\tclass="edit-output-expression-form__dropdown_popup-item"\n\t\t\t\t\t\t\t\t\t@click="selectPort(outputPort)"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<span>{{ outputPort.title }}</span>\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass="ui-btn ui-btn-xss --style-outline-no-accent ui-btn-no-caps --air"\n\t\t\t\t\t\t\t\t\t\t@click.stop="deletePort(outputPort.portId)"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ACTION_OUTPUT_REMOVE') }}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="edit-output-expression-form__dropdown_popup-footer">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="edit-output-expression-form__dropdown_popup-footer-content"\n\t\t\t\t\t\t\t\t\t@click="onAddButtonClick"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\t\t\t:size="24"\n\t\t\t\t\t\t\t\t\t\tname="circle-plus"\n\t\t\t\t\t\t\t\t\t\tcolor="#0075ff"\n\t\t\t\t\t\t\t\t\t\tclass="edit-output-expression-form__dropdown_popup-footer-icon"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<span>{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ACTION_OUTPUT_ADD') }}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Popup>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Yn={name:"node-settings-rules",components:{CancelSettingsButton:zn,SaveSettingsButton:$n,NodeSettingsRulesLayout:be,RuleCard:Ie,EditActionExpression:Qe,EditOutputExpression:Wn,EditConditionExpression:Vn,AddConstruction:Gn,DeleteConstruction:Zn,RuleConstruction:Ee,SelectBooleanType:Hn,SelectRule:Un,DeleteRuleCard:jn,EditExtandedAction:qn},setup(){const{getMessage:t}=N();return{getMessage:t}},data(){return{scrolling:false}},computed:{...S.mapState(ae,["nodeSettings","currentRuleId","block","isRuleSettingsShown"]),...S.mapWritableState(ae,["isSaving"]),...S.mapState(rt,["documentTypeSigned","documentType","template"]),documentTypeForActionSettings(){if(b.Type.isArrayFilled(this.nodeSettings.fixedDocumentType)){return this.nodeSettings.fixedDocumentType}return this.documentType}},methods:{...S.mapActions(ae,["toggleRuleSettingsVisibility","reorder","saveRule","discardRuleSettings"]),...S.mapActions(rt,["addRulePort","deletePort"]),onRulesLayoutClose(){this.discardRuleSettings();this.toggleRuleSettingsVisibility(false)},async onSaveRule(){try{this.isSaving=true;await r.EventEmitter.emitAsync(oe.BEFORE_SUBMIT_EVENT);const{outputPortsToAdd:t,outputPortsToDelete:e}=await this.saveRule(this.documentType);t.values().forEach((({portId:t,title:e})=>{this.addRulePort(this.block.id,t,x.output,e)}));e.keys().forEach((t=>{this.deletePort(this.block.id,t,x.output)}))}catch(t){if(t.errors&&t.errors[0]&&t.errors[0].message){c.MessageBox.alert(b.Text.encode(t.errors[0].message))}}finally{this.isSaving=false}},onScroll(){this.scrolling=true;this.$nextTick((()=>{this.scrolling=false}))}},template:`\n\t\t<NodeSettingsRulesLayout\n\t\t\t:isRuleSettingsShown="isRuleSettingsShown"\n\t\t\t:nodeSettings="nodeSettings"\n\t\t\t:currentRuleId="currentRuleId"\n\t\t\t:isSaving="isSaving"\n\t\t\t@close="onRulesLayoutClose"\n\t\t\t@drop="reorder"\n\t\t\t@scroll-layout="onScroll"\n\t\t>\n\t\t\t<template #rules-dropdown>\n\t\t\t\t<SelectRule :block="block" />\n\t\t\t</template>\n\n\t\t\t<template #ruleCard="{ ruleCard }">\n\t\t\t\t<RuleCard :ruleCard="ruleCard">\n\t\t\t\t\t<template #deleteRuleCard>\n\t\t\t\t\t\t<DeleteRuleCard :ruleCard="ruleCard" />\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #default="{ construction, position }">\n\t\t\t\t\t\t<RuleConstruction\n\t\t\t\t\t\t\t:ruleCardId="ruleCard.id"\n\t\t\t\t\t\t\t:construction="construction"\n\t\t\t\t\t\t\t:position="position"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template #addConstructionButton>\n\t\t\t\t\t\t\t\t<AddConstruction\n\t\t\t\t\t\t\t\t\t:position="position"\n\t\t\t\t\t\t\t\t\t:ruleCard="ruleCard"\n\t\t\t\t\t\t\t\t\t:data-test-id="$testId('complexNodeRuleSettingsAddConstruction')"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t<template #deleteConstructionButton="{ iconColor }">\n\t\t\t\t\t\t\t\t<DeleteConstruction\n\t\t\t\t\t\t\t\t\t:iconColor="iconColor"\n\t\t\t\t\t\t\t\t\t:ruleCard="ruleCard"\n\t\t\t\t\t\t\t\t\t:construction="construction"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t<template #action="{ isExpertMode }">\n\t\t\t\t\t\t\t\t<EditActionExpression\n\t\t\t\t\t\t\t\t\t:construction="construction"\n\t\t\t\t\t\t\t\t\t:isExpertMode="isExpertMode"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #default="{ actionId, activityData }">\n\t\t\t\t\t\t\t\t\t\t<EditExtandedAction\n\t\t\t\t\t\t\t\t\t\t\tv-if="actionId"\n\t\t\t\t\t\t\t\t\t\t\t:actionId="actionId"\n\t\t\t\t\t\t\t\t\t\t\t:activityData="activityData"\n\t\t\t\t\t\t\t\t\t\t\t:construction="construction"\n\t\t\t\t\t\t\t\t\t\t\t:documentType="documentTypeForActionSettings"\n\t\t\t\t\t\t\t\t\t\t\t:template="template"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</EditActionExpression>\n\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t<template #booleanTypeSwitcher>\n\t\t\t\t\t\t\t\t<SelectBooleanType :construction="construction" />\n\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t<template #condition>\n\t\t\t\t\t\t\t\t<EditConditionExpression :construction="construction" />\n\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t<template #output>\n\t\t\t\t\t\t\t\t<EditOutputExpression\n\t\t\t\t\t\t\t\t\t:construction="construction"\n\t\t\t\t\t\t\t\t\t:scrolling="scrolling"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</RuleConstruction>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #addConstructionButton>\n\t\t\t\t\t\t<AddConstruction\n\t\t\t\t\t\t\t:ruleCard="ruleCard"\n\t\t\t\t\t\t\t:data-test-id="$testId('complexNodeRuleSettingsAddConstruction')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</RuleCard>\n\t\t\t</template>\n\n\t\t\t<template #addRuleCardButton>\n\t\t\t\t<AddConstruction\n\t\t\t\t\tclass="add-rule-card"\n\t\t\t\t\t:data-test-id="$testId('complexNodeRuleSettingsAddRuleCard')"\n\t\t\t\t>\n\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_NODE_SETTINGS_ADD_RULE_CARD_LABEL') }}\n\t\t\t\t</AddConstruction>\n\t\t\t</template>\n\n\t\t\t<template #actions>\n\t\t\t\t<SaveSettingsButton\n\t\t\t\t\t:isSaving="isSaving"\n\t\t\t\t\t:data-test-id="$testId('complexNodeRuleSettingsSave')"\n\t\t\t\t\t@click="onSaveRule"\n\t\t\t\t/>\n\t\t\t\t<CancelSettingsButton\n\t\t\t\t\t:data-test-id="$testId('complexNodeRuleSettingsDiscard')"\n\t\t\t\t\t@click="onRulesLayoutClose"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</NodeSettingsRulesLayout>\n\t`};const Jn=S.defineStore("bizprocdesigner-editor-catalog",{state:()=>({groups:[],searchText:"",currentGroup:null,currentItem:null,highlightedItems:new Set,isShowFoundedGroupItems:false,isShowSearch:false,isExpandedCatalog:true,isFixedCatalog:true}),getters:{canSearch:t=>t.searchText.length>2,isShowSearchResults:t=>t.canSearch&&!t.isShowFoundedGroupItems,searchResults:t=>{const e=t.searchText.toLowerCase();const n=t.groups.filter((t=>t.title.toLowerCase().includes(e)));const o=[...new Map(t.groups.flatMap((t=>t.items.filter((t=>t.title.toLowerCase().includes(e))).map((e=>[e.id,{...e,parentGroup:t}]))))).values()];return{groups:n,items:o}},searchResultsCount:t=>{const{groups:e,items:n}=t.searchResults;return e.length+n.length}},actions:{async init(){await this.fetchCatalogData()},async fetchCatalogData(){const{groups:t=[]}=await $.getCatalogData();t.forEach(((e,n)=>{e.items.forEach(((e,o)=>{e.defaultSettings.ports=Object.entries(e.defaultSettings.ports).reduce(((t,[e,n])=>{var o;t[e]=(o=n==null?void 0:n.map((t=>({...t,type:e}))))!=null?o:[];return t}),{});if(e.type==="simple"||e.type==="trigger"){t[n].items[o].defaultSettings.width=200;t[n].items[o].defaultSettings.height=48}else if(e.type==="complex"){t[n].items[o].defaultSettings.width=200;t[n].items[o].defaultSettings.height=176}}))}));this.groups=t},toggleFixedCatalog(){this.isFixedCatalog=!this.isFixedCatalog},expandCatalog(){if(!this.isFixedCatalog){this.isExpandedCatalog=true}},collapseCatalog(){if(!this.isFixedCatalog){this.isExpandedCatalog=false}},clearSearchText(){this.searchText=""},changeCurrentGroup(t){this.currentGroup=t},resetCurrentGroup(){this.currentGroup=null},changeCurrentItem(t){this.currentItem=t},resetCurrentItem(){this.currentItem=null},setHighlightedItem(t){this.highlightedItems=new Set(Array.isArray(t)?t:[t])},resetHighlightedItem(){this.highlightedItems=new Set},showFoundedGroupItems(){this.isShowFoundedGroupItems=true},hideFoundedGroupItems(){this.isShowFoundedGroupItems=false},addDevGroup(){this.groups.push({id:"dev",icon:"",title:"\u0412 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435",items:[this.getFrameNode()]})},getFrameNode(){return{id:"frame",type:"frame",title:"\u041f\u043e\u0434\u043b\u043e\u0436\u043a\u0430",subtitle:"\u041d\u043e\u0434\u0430 \u043f\u043e\u0434\u043b\u043e\u0436\u043a\u0430",iconPath:"BOTTLENECK",colorIndex:1,defaultSettings:{width:200,height:200,ports:{input:[],output:[]}}}}}});const Qn={default:"drag-item",[A.SIMPLE]:`drag-item:${A.SIMPLE}`,[A.TRIGGER]:`drag-item:${A.TRIGGER}`,[A.COMPLEX]:`drag-item:${A.COMPLEX}`,[A.FRAME]:`drag-item:${A.FRAME}`,[A.TOOL]:`drag-item:${A.TOOL}`};function to(t){var e;return(e=Qn==null?void 0:Qn[t])!=null?e:Qn.default}const eo={base:"editor-chart-catalog",expanded:"--expanded"};const no={name:"CatalogLayout",props:{hasSearchResults:{type:Boolean,default:false},expanded:{type:Boolean,default:false}},computed:{catalogClassNames(){return{[eo.base]:true,[eo.expanded]:this.expanded}}},template:`\n\t\t<section :class="catalogClassNames">\n\t\t\t<div class="editor-chart-catalog__container">\n\t\t\t\t<div class="editor-chart-catalog__header">\n\t\t\t\t\t<slot name="header"/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="editor-chart-catalog__search">\n\t\t\t\t\t<slot name="search"/>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tv-if="!hasSearchResults"\n\t\t\t\t\tclass="editor-chart-catalog__content"\n\t\t\t\t>\n\t\t\t\t\t<slot name="content"/>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tv-if="hasSearchResults"\n\t\t\t\t\tclass="editor-chart-catalog__search-results"\n\t\t\t\t>\n\t\t\t\t\t<slot name="search-results"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="editor-chart-catalog__footer">\n\t\t\t\t<slot name="footer"/>\n\t\t\t</div>\n\t\t</section>\n\t`};const oo={name:"header-layout",props:{expanded:{type:Boolean,default:false}},template:`\n\t\t<header class="editor-chart-catalog-header-layout">\n\t\t\t<div class="editor-chart-catalog-header-layout__switcher-btn">\n\t\t\t<slot name="switcher"/>\n\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="editor-chart-catalog-header-layout__logo"\n\t\t\t>\n\t\t\t\t<slot name="logo"/>\n\t\t\t</div>\n\t\t</header>\n\t`};const io={base:"editor-chart-burger-btn",openend:"--opened"};const so={name:"BurgerBtn",components:{BIcon:f.BIcon},props:{opened:{type:Boolean,default:false}},setup(){return{iconSet:f.Outline}},computed:{burgerBtnClassNames(){return{[io.base]:true,[io.opened]:this.opened}}},template:`\n\t\t<button\n\t\t\t:class="burgerBtnClassNames"\n\t\t\t:data-test-id="$testId('catalogBurger')"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\t:name="iconSet.ALIGN_JUSTIFY"\n\t\t\t\t:size="24"\n\t\t\t\tclass="editor-chart-burger-btn__icon"\n\t\t\t/>\n\t\t</button>\n\t`};const lo={name:"header-logo",setup(){const{getMessage:t}=N();return{getMessage:t}},template:`\n\t\t<div class="editor-chart-catalog-header-logo">\n\t\t\t<span class="ui-node-catalog-header__logo-text">\n\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_LOGO_TEXT') }}\n\t\t\t</span>\n\t\t</div>\n\t`};const ao={name:"catalog-input",props:{modelValue:{type:String,default:""},focusable:{type:Boolean,default:false}},setup(t){const e=E.useTemplateRef("textInput");const{getMessage:n}=N();E.onMounted((()=>{if(t.focusable){var n;(n=E.toValue(e))==null?void 0:n.focus()}}));return{getMessage:n}},template:`\n\t\t<div class="editor-chart-catalog-input">\n\t\t\t<input\n\t\t\t\tref="textInput"\n\t\t\t\t:value="modelValue"\n\t\t\t\t:placeholder="getMessage('BIZPROCDESIGNER_EDITOR_SEARCH_PLACEHOLDER')"\n\t\t\t\t:data-test-id="$testId('catalogSearchInput')"\n\t\t\t\t:class="{\n\t\t\t\t\t'editor-chart-catalog-input__input': true,\n\t\t\t\t\t'editor-chart-catalog-input__input--has-text': modelValue.length > 0\n\t\t\t\t}"\n\t\t\t\ttype="text"\n\t\t\t\t@input="$emit('update:modelValue', $event.target.value)"\n\t\t\t\t@focus="$emit('focus', $event)"\n\t\t\t\t@blur="$emit('blur', $event)"\n\t\t\t/>\n\t\t</div>\n\t`};const ro={name:"CatalogGroup",components:{BIcon:f.BIcon},props:{group:{type:Object,required:true},showItems:{type:Boolean,default:false}},emits:["changeGroup"],setup(){return{iconSet:f.Outline}},template:`\n\t\t<div class="editor-chart-catalog-group">\n\t\t\t<div\n\t\t\t\t:data-test-id="$testId('catalogGroup', group.id)"\n\t\t\t\tclass="editor-chart-catalog-group__header"\n\t\t\t\t@click="$emit('changeGroup', group)"\n\t\t\t>\n\t\t\t\t<div class="editor-chart-catalog-group__icon-wrapper">\n\t\t\t\t\t<slot name="icon"/>\n\t\t\t\t</div>\n\n\t\t\t\t<p class="editor-chart-catalog-group__title">{{ group.title }}</p>\n\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="iconSet.ARROW_RIGHT_XS"\n\t\t\t\t\t:size="30"\n\t\t\t\t\tclass="editor-chart-catalog-group__arrow"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<Transition name="catalog-items-transition">\n\t\t\t\t<div\n\t\t\t\t\tv-if="showItems"\n\t\t\t\t\tclass="editor-chart-catalog-group__content"\n\t\t\t\t>\n\t\t\t\t\t<div class="editor-chart-catalog-group__back-groups">\n\t\t\t\t\t\t<slot name="back"/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="group.items.length > 0"\n\t\t\t\t\t\tclass="editor-chart-catalog-group__items"\n\t\t\t\t\t>\n\t\t\t\t\t\t<slot name="items"/>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\tclass="editor-chart-catalog-group__empty-label">\n\t\t\t\t\t\t<slot name="empty-label"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Transition>\n\t\t</div>\n\t`};const co={name:"catalog-group-empty-label",setup(){const{getMessage:t}=N();return{getMessage:t}},template:`\n\t\t<div class="editor-chart-catalog-group-empty-label">\n\t\t\t<h2>{{ getMessage('BIZPROCDESIGNER_EDITOR_EMPTY_GROUP_TITLE') }}</h2>\n\t\t\t<p>{{ getMessage('BIZPROCDESIGNER_EDITOR_EMPTY_GROUP_DESCRIPTION') }}</p>\n\t\t</div>\n\t`};const uo="o-folder";const po={name:"catalog-group-icon",components:{BIcon:f.BIcon},props:{iconName:{type:String,default:uo,required:true}},setup(){const t=f.Outline;function e(e){if(e&&Object.prototype.hasOwnProperty.call(t,e)){return t[e]}return uo}return{getIconName:e}},template:`\n\t\t<BIcon\n\t\t\t:name="getIconName(iconName)"\n\t\t\t:size="30"\n\t\t\tclass="editor-chart-catalog-group-icon"\n\t\t/>\n\t`};const mo={base:"editor-chart-catalog-item",active:"--active",drag:"--drag"};const ho={base:"editor-chart-catalog-item__icon-wrapper",bg_0:"--bg-0",bg_1:"--bg-1",bg_2:"--bg-2",bg_3:"--bg-3",bg_4:"--bg-4",bg_5:"--bg-5",bg_6:"--bg-6",bg_7:"--bg-7",bg_8:"--bg-8"};const go={0:"#9C5CEF",1:"#188AE6",2:"#E08907",3:"#8E96A2",4:"#3CB811",5:"#52BCBC",6:"#B4B959",7:"#FFFFFF",8:"#FFFFFF"};const Co=f.Outline.FOLDER;const bo={name:"catalog-item",components:{BIcon:f.BIcon},directives:{DragBlock:h.DragBlock},props:{item:{type:Object,required:true},active:{type:Boolean,default:false}},setup(t){const e=f.Outline;const n=E.useTemplateRef("draggedItem");const o=E.ref(d(t.item));const i=E.computed((()=>({[mo.base]:true,[mo.active]:t.active})));const s=E.computed((()=>{if(p(t.item.icon)){return{[ho.base]:true,"--custom":true}}const e={[ho.base]:true,[ho.bg_0]:t.item.colorIndex===0,[ho.bg_1]:t.item.colorIndex===1,[ho.bg_2]:t.item.colorIndex===2,[ho.bg_3]:t.item.colorIndex===3,[ho.bg_4]:t.item.colorIndex===4,[ho.bg_5]:t.item.colorIndex===5,[ho.bg_6]:t.item.colorIndex===6,[ho.bg_7]:t.item.colorIndex===7,[ho.bg_8]:t.item.colorIndex===8};if(t.item.type===F.TOOL){e["--rounded"]=true}return e}));const l=E.computed((()=>({dragData:o,dragImage:n})));function a(t){if(t&&Object.prototype.hasOwnProperty.call(e,t)){return e[t]}return Co}function r(t){if(t!==false&&go[t]){return go[t]}return null}function c(t){const e=m(t);if(!e){return{}}return{"background-image":`url('${e}')`}}function d(t){const e=nt();const{id:n,type:o,presetId:i,title:s,properties:l={},returnProperties:a=[],colorIndex:r,icon:c=Co,defaultSettings:{width:d,height:u,ports:p={input:[],output:[],aux:[],topAux:[]}}}=E.toValue(t);return{id:e,type:o,activity:{Name:e,Type:n,PresetId:i,Properties:{Title:s,...l},ReturnProperties:a||[],Activated:"Y"},dimensions:{width:d,height:u},position:{x:0,y:0},ports:p,node:{colorIndex:r,icon:c,title:s,type:o}}}function u(){return{dragData:d(t.item),dragImage:n}}function p(t){if(!t||!b.Type.isString(t)){return false}return t.startsWith("https://")}function m(t){if(!t||!b.Type.isString(t)){return null}const e=t.trim();const n=["https://"];const o=n.some((t=>e.startsWith(t)));if(!o){return null}return e}return{dragPayload:l,preparedBlock:o,catalogItemClassNames:i,iconWrapperClassNames:s,getDragItemSlotName:to,getDragPayload:u,getIconName:a,getIconColor:r,isUrl:p,getBackgroundImage:c}},template:`\n\t\t<div\n\t\t\tv-drag-block="getDragPayload"\n\t\t\t:class="catalogItemClassNames"\n\t\t\t:data-test-id="$testId('catalogItem', item.id)"\n\t\t>\n\t\t\t<div\n\t\t\t\tref="draggedItem"\n\t\t\t\tclass="editor-chart-catalog-item__drag-item"\n\t\t\t>\n\t\t\t\t<slot\n\t\t\t\t\t:name="getDragItemSlotName(preparedBlock.type)"\n\t\t\t\t\t:item="preparedBlock"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div :class="iconWrapperClassNames">\n\t\t\t\t<div\n\t\t\t\t\tv-if="isUrl(item.icon)"\n\t\t\t\t\t:style="getBackgroundImage(item.icon)"\n\t\t\t\t\tclass="ui-selector-item-avatar"\n\t\t\t\t/>\n\t\t\t\t<BIcon\n\t\t\t\t\tv-else\n\t\t\t\t\t:name="getIconName(item.icon)"\n\t\t\t\t\t:color="getIconColor(item.colorIndex)"\n\t\t\t\t\t:size="28"\n\t\t\t\t\tclass="editor-chart-catalog-item__icon"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="editor-chart-catalog-item__content">\n\t\t\t\t<div class="editor-chart-catalog-item__title">\n\t\t\t\t\t{{ item.title }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if="item.subtitle"\n\t\t\t\t\tclass="editor-chart-catalog-item__subtitle">\n\t\t\t\t\t{{ item.subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Io={base:"editor-chart-catalog-group-list",withoutScroll:"--withoutScroll"};const vo={name:"CatalogGroupList",props:{groups:{type:Array,default:()=>[]},currentGroup:{type:Object,default:null}},computed:{catalogGroupListClassNames(){return{[Io.base]:true,[Io.withoutScroll]:this.currentGroup!==null}}},template:`\n\t\t<ul :class="catalogGroupListClassNames">\n\t\t\t<li\n\t\t\t\tv-for="group in groups"\n\t\t\t\t:key="group.id"\n\t\t\t\tclass="editor-chart-catalog-group-list__group"\n\t\t\t>\n\t\t\t\t<slot\n\t\t\t\t\t:group="group"\n\t\t\t\t\tname="group"\n\t\t\t\t/>\n\t\t\t</li>\n\t\t</ul>\n\t`};const fo={base:"editor-chart-group-back-btn",collapsed:"--collapsed"};const Eo={base:"editor-chart-group-back-btn__icon",collapsed:"--collapsed"};const So={name:"CatalogGroupBackBtn",components:{BIcon:f.BIcon},props:{groupTitle:{type:String,default:""},collapsed:{type:Boolean,default:false}},setup(){return{iconSet:f.Outline}},computed:{groupBackBtnCalssNames(){return{[fo.base]:true,[fo.collapsed]:this.collapsed}},iconClassNames(){return{[Eo.base]:true,[Eo.collapsed]:this.collapsed}}},template:`\n\t\t<button\n\t\t\t:class="groupBackBtnCalssNames"\n\t\t\t:data-test-id="$testId('catalogGroupBackBtn')"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-if="!collapsed"\n\t\t\t\tclass="editor-chart-group-back-btn__back-wrapper"\n\t\t\t>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="iconSet.ARROW_LEFT_XS"\n\t\t\t\t\t:size="30"\n\t\t\t\t\tclass="editor-chart-group-back-btn__back"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div :class="iconClassNames">\n\t\t\t\t<slot name="icon"/>\n\t\t\t</div>\n\n\t\t\t<p class="editor-chart-group-back-btn__title">\n\t\t\t\t{{ groupTitle }}\n\t\t\t</p>\n\t\t</button>\n\t`};const _o={base:"editor-chart-search-results-label",collapsed:"--collapsed"};const yo={name:"search-results-label",components:{BIcon:f.BIcon},props:{count:{type:Number,default:0},collapsed:{type:Boolean,default:false}},setup(t){const{getMessage:e}=N();const n=E.computed((()=>({[_o.base]:true,[_o.collapsed]:t.collapsed})));const o=E.computed((()=>t.count===0?e("BIZPROCDESIGNER_EDITOR_NOT_FOUND"):e("BIZPROCDESIGNER_EDITOR_FOUND",{"#count#":t.count})));return{iconSet:f.Outline,searchResultsLablelClassNames:n,countLabel:o,getMessage:e}},template:`\n\t\t<div :class="searchResultsLablelClassNames">\n\t\t\t<BIcon\n\t\t\t\tv-if="collapsed"\n\t\t\t\t:name="iconSet.SEARCH"\n\t\t\t\t:size="20"\n\t\t\t\tclass="editor-chart-search-results-label__icon"\n\t\t\t/>\n\t\t\t<p\n\t\t\t\tv-if="!collapsed"\n\t\t\t\tclass="editor-chart-search-results-label__count"\n\t\t\t>\n\t\t\t\t{{ countLabel }}\n\t\t\t</p>\n\t\t\t<p\n\t\t\t\tv-if="!collapsed"\n\t\t\t\tclass="editor-chart-search-results-label__location"\n\t\t\t>\n\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_EVERYWHERE') }}\n\t\t\t</p>\n\t\t</div>\n\t`};const To={base:"editor-chart-search-results-layout__title",collapsed:"--collapsed"};const ko={name:"search-results-layout",props:{groups:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]},collapsed:{type:Boolean,default:false}},setup(t){const{getMessage:e}=N();const n=E.computed((()=>({[To.base]:true,[To.collapsed]:t.collapsed})));return{getMessage:e,titleClassNames:n}},template:`\n\t\t<div class="editor-chart-search-results-layout">\n\n\t\t\t<div\n\t\t\t\tv-if="groups.length > 0 || items.length > 0"\n\t\t\t\tclass="editor-chart-search-results-layout__content"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tv-if="groups.length > 0"\n\t\t\t\t\tclass="editor-chart-search-results-layout__groups">\n\t\t\t\t\t<h2 :class="titleClassNames">\n\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_SEARCH_GROUPS') }}\n\t\t\t\t\t</h2>\n\t\t\t\t\t<slot\n\t\t\t\t\t\tv-for="group in groups"\n\t\t\t\t\t\t:key="group.id"\n\t\t\t\t\t\t:group="group"\n\t\t\t\t\t\tname="group"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tv-if="items.length > 0"\n\t\t\t\t\tclass="editor-chart-search-results-layout__items"\n\t\t\t\t>\n\t\t\t\t\t<h2 :class="titleClassNames">\n\t\t\t\t\t\t{{ getMessage('BIZPROCDESIGNER_EDITOR_SEARCH_NODES') }}\n\t\t\t\t\t</h2>\n\t\t\t\t\t<slot\n\t\t\t\t\t\tv-for="item in items"\n\t\t\t\t\t\t:key="item.id"\n\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\tname="item"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tv-else-if="!collapsed"\n\t\t\t\tclass="editor-chart-search-results-layout__empty"\n\t\t\t>\n\t\t\t\t<slot name="empty-label"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Oo={name:"search-results-empty-label",setup(){const{getMessage:t}=N();const e=t("BIZPROCDESIGNER_EDITOR_EMPTY_SEARCH_DESCRIPTION");const[n,o,i]=e.split(/\[feedback]|\[\/feedback]/);function s(t){t.preventDefault();u.Form.open({id:String(Math.random()),forms:[{zones:["by","kz","ru"],id:438,lang:"ru",sec:"odyyl1"},{zones:["com.br"],id:436,lang:"br",sec:"8fb4et"},{zones:["la","co","mx"],id:434,lang:"es",sec:"ze9mqq"},{zones:["de"],id:432,lang:"de",sec:"m8isto"},{zones:["en","eu","in","uk"],id:430,lang:"en",sec:"etg2n4"}]})}return{getMessage:t,before:n,link:o,after:i,onFeedbackLinkClick:s}},template:`\n\t\t<div class="editor-chart-search-results-empty-label">\n\t\t\t<h2>{{ getMessage('BIZPROCDESIGNER_EDITOR_EMPTY_SEARCH_TITLE') }}</h2>\n\t\t\t<p>{{ before }} <a href="#" @click="onFeedbackLinkClick">{{ link }}</a> {{ after }}</p>\n\t\t</div>\n\t`};const Bo={name:"SearchBar",components:{DiagramSearchBar:h.SearchBar},setup(){const{getMessage:t}=N();function e(t,e){return t.node.title.toLowerCase().includes(e.toLowerCase())}return{getMessage:t,searchCallback:e}},template:`\n\t\t<DiagramSearchBar\n\t\t\t:searchResultTitle="getMessage('BIZPROCDESIGNER_EDITOR_SEARCH_RESULTS')"\n\t\t\t:placeholder="getMessage('BIZPROCDESIGNER_EDITOR_SEARCH_PLACEHOLDER')"\n\t\t\t:searchCallback="searchCallback"\n\t\t/>\n\t`};const No=(t=null)=>{Ro.add((()=>U("Integration.AiAssistant.Block.set",{blockId:t})))};class Ro{static add(t){if(this.processingRequest){this.nextRequest=t;return}this.processingRequest=t().finally((()=>{this.processingRequest=null;if(b.Type.isFunction(this.nextRequest)){const t=this.nextRequest;this.nextRequest=null;this.add(t)}}))}}Ro.processingRequest=null;Ro.nextRequest=null;const Lo={name:"BlockDiagramWidget",components:{BlockDiagramEntity:ct},props:{disabled:{type:Boolean,default:false}},setup(){const t=E.inject("showBlockSettings");const e=h.useAnimationQueue();const n=rt();const{blocks:o,connections:i}=S.storeToRefs(n);const{getMessage:s}=N();const l=h.useHighlightedBlocks();const a=l.highlitedBlockIds;const{isFeatureAvailable:r}=B();const c=E.computed({get(){return E.toValue(o)},set(t){n.setBlocks(t);u()}});const d=E.computed({get(){return E.toValue(i)},set(t){n.setConnections(t);u()}});const u=b.Runtime.debounce(p,700);async function p(){const t=3;let e=0;while(e<t){try{await n.publicDraft();n.updateStatus(true);return}catch{e++;if(e>=t){n.updateStatus(false);m.UI.Notification.Center.notify({content:s("BIZPROCDESIGNER_EDITOR_TOP_PANEL_AUTOSAVE_STATUS_NOT_SAVED_HINT"),autoHideDelay:4e3})}}}}function g(t){try{n.setBlockCurrentTimestamp(t);n.publicDraft();n.updateStatus(true)}catch{n.updateStatus(false)}}async function C(n){if(!n||!n.position){console.warn("Incorrect object for block transition end event",n);return}e.pause();try{await t(n,true)}finally{e.play()}}return{blocks:c,connections:d,blockSlotNames:V,connectionSlotNames:G,onBlockTransitionEnd:C,onDropNewBlock:g,highlitedBlockIds:a,isFeatureAvailable:r}},watch:{highlitedBlockIds:{deep:true,handler(t,e){if(!this.isFeatureAvailable(p.FeatureCode.aiAssistant)){return}if(e.length>0&&t.length===0){No()}if(t.length===1){const e=t[0];const n=this.blocks.find((t=>t.id===e));if(n){No(e)}}}}},template:`\n\t\t<BlockDiagramEntity\n\t\t\tv-model:blocks="blocks"\n\t\t\tv-model:connections="connections"\n\t\t\t:disabled="disabled"\n\t\t\t@blockTransitionEnd="onBlockTransitionEnd"\n\t\t\t@dropNewBlock="onDropNewBlock"\n\t\t>\n\t\t\t<template #[blockSlotNames.SIMPLE]="{ block }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="blockSlotNames.SIMPLE"\n\t\t\t\t\t:block="block"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #[blockSlotNames.TRIGGER]="{ block }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="blockSlotNames.TRIGGER"\n\t\t\t\t\t:block="block"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #[blockSlotNames.COMPLEX]="{ block }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="blockSlotNames.COMPLEX"\n\t\t\t\t\t:block="block"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #[blockSlotNames.COMPLEX]="{ block }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="blockSlotNames.COMPLEX"\n\t\t\t\t\t:block="block"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #[blockSlotNames.TOOL]="{ block }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="blockSlotNames.TOOL"\n\t\t\t\t\t:block="block"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #[blockSlotNames.FRAME]="{ block }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="blockSlotNames.FRAME"\n\t\t\t\t\t:block="block"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template #[connectionSlotNames.AUX]="{ connection }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="connectionSlotNames.AUX"\n\t\t\t\t\t:connection="connection"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</BlockDiagramEntity>\n\t`};const Do={name:"DeleteBlockIconBtn",components:{IconButton:ht},props:{blockId:{type:String,required:true},disabled:{type:Boolean,default:false}},emits:["deletedBlock"],setup(t,{emit:e}){const n=h.useHistory();const{deleteBlockById:o,publicDraft:i,updateStatus:s}=rt();function l(){try{i();s(true)}catch{s(false)}}function a(){if(t.disabled){return}o(t.blockId);n.makeSnapshot();e("deletedBlock",t.blockId);l()}return{iconSet:f.Outline,onDeleteBlock:a}},template:`\n\t\t<IconButton\n\t\t\t:icon-name="iconSet.TRASHCAN"\n\t\t\t:color="'var(--ui-color-palette-gray-40)'"\n\t\t\t:data-test-id="$testId('blockDelete', blockId)"\n\t\t\t@click="onDeleteBlock"\n\t\t/>\n\t`};const Po={name:"UpdatePublishedStatusLabel",components:{BlockStatusNotPublished:At},props:{block:{type:Object,required:true}},setup(t){const e=rt();const n=E.computed((()=>{const n=e.blockCurrentTimestamps[t.block.id];const o=e.blockSavedTimestamps[t.block.id];return n===o}));return{isPublished:n}},template:`\n\t\t<BlockStatusNotPublished v-if="!isPublished"/>\n\t`};const Mo={right:"right"};const wo={name:"add-complex-block-port",props:{position:{type:String,required:true},highlighted:{type:Boolean,required:true}},computed:{pointClasses(){return{"--right":this.position===Mo.right,"--highlighted":this.highlighted}}},template:`\n\t\t<svg\n\t\t\txmlns="http://www.w3.org/2000/svg"\n\t\t\twidth="9"\n\t\t\theight="9"\n\t\t\tviewBox="0 0 9 9"\n\t\t\tfill="none"\n\t\t\tclass="complex-block-port-add-point"\n\t\t\t:class="pointClasses"\n\t\t>\n\t\t\t<circle cx="4.5" cy="4.5" r="4" fill="white" stroke="#DFE0E3"/>\n\t\t\t<rect x="4" y="2" width="1" height="5" rx="0.5" fill="#DFE0E3"/>\n\t\t\t<rect x="2" y="5" width="1" height="5" rx="0.5" transform="rotate(-90 2 5)" fill="#DFE0E3"/>\n\t\t</svg>\n\t`};const Ao={name:"EditTemplateName",components:{TemplateNameInput:Vt},props:{dropdownOptions:{type:Object,default:()=>({})}},computed:{...S.mapWritableState(rt,["template"]),templateName:{get(){var t,e;return(t=(e=this.template)==null?void 0:e.NAME)!=null?t:""},set(t){this.template.NAME=b.Type.isStringFilled(t)?t:this.loc("BIZPROCDESIGNER_EDITOR_DEFAULT_TITLE");this.updateTemplateData({NAME:this.template.NAME})}}},methods:{...S.mapActions(rt,["updateTemplateData"]),loc(t){return this.$bitrix.Loc.getMessage(t)}},template:`\n\t\t<TemplateNameInput\n\t\t\tv-model:title="templateName"\n\t\t\t:dropdownOptions="dropdownOptions"\n\t\t/>\n\t`};const xo={name:"PublishDropdownButton",components:{DropdownMenuButton:Zt},data(){return{isLoading:false}},computed:{...S.mapState(rt,["templatePublishStatus"]),icon(){const t={[Z.MAIN]:"ui-btn-icon-workflow",[Z.USER]:"ui-btn-icon-person",[Z.FULL]:"ui-btn-icon-workflow-stop"};return t[this.templatePublishStatus]}},methods:{...S.mapActions(rt,["publicTemplate"]),publishTemplate(){({[Z.MAIN]:this.fetchPublishMainTemplate,[Z.USER]:this.fetchPublishUserTemplate,[Z.FULL]:this.fetchPublishFullTemplate})[this.templatePublishStatus]()},async fetchPublishMainTemplate(){this.isLoading=true;try{var t;await this.publicTemplate();m.UI.Notification.Center.notify({content:(t=this.$Bitrix.Loc.getMessage("BIZPROCDESIGNER_EDITOR_MENU_SAVE_SUCCESS"))!=null?t:"",autoHideDelay:5e3})}catch(t){it(t)}finally{this.isLoading=false}},fetchPublishUserTemplate(){alert("doUserPublication");this.loading=false},fetchPublishFullTemplate(){alert("doFullPublication");this.loading=false}},template:`\n\t\t<DropdownMenuButton\n\t\t\t:text="$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_PUBLISH')"\n\t\t\t:icon="icon"\n\t\t\t:loading="isLoading"\n\t\t\t@change="publishTemplate"\n\t\t>\n\t\t\t<template #default>\n\t\t\t\t<slot/>\n\t\t\t</template>\n\t\t</DropdownMenuButton>\n\t`};const Fo={name:"PublishMainDropdownOption",components:{DropdownMenuOption:Ht,WorkflowIcon:$t},computed:{...S.mapWritableState(rt,["templatePublishStatus"]),isActive(){return this.templatePublishStatus===Z.MAIN}},methods:{onChangeOption(){this.templatePublishStatus=Z.MAIN}},template:`\n\t\t<DropdownMenuOption\n\t\t\t:title="$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_MENU_MAIN_TITLE')"\n\t\t\t:description="$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_MENU_MAIN_DESCR')"\n\t\t\t:isActive="isActive"\n\t\t\t@click="onChangeOption"\n\t\t>\n\t\t\t<template #icon>\n\t\t\t\t<WorkflowIcon :active="isActive"/>\n\t\t\t</template>\n\t\t</DropdownMenuOption>\n\t`};const Vo={name:"PublishUserDropdownOption",components:{DropdownMenuOption:Ht,PersonIcon:jt},computed:{...S.mapWritableState(rt,["templatePublishStatus"]),isActive(){return this.templatePublishStatus===Z.USER}},methods:{onChangeOption(){this.templatePublishStatus=Z.USER}},template:`\n\t\t<DropdownMenuOption\n\t\t\t:title="$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_MENU_PERSONAL_TITLE')"\n\t\t\t:description="$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_MENU_PERSONAL_DESCR')"\n\t\t\t:isActive="false"\n\t\t\t:notReleased="true"\n\t\t>\n\t\t\t<template #icon>\n\t\t\t\t<PersonIcon :active="isActive"/>\n\t\t\t</template>\n\t\t</DropdownMenuOption>\n\t`};const Go={name:"PublishFullDropdownOption",components:{DropdownMenuOption:Ht,StopIcon:qt},computed:{...S.mapWritableState(rt,["templatePublishStatus"]),isActive(){return this.templatePublishStatus===Z.FULL}},methods:{onChangeOption(){this.templatePublishStatus=Z.FULL}},template:`\n\t\t<DropdownMenuOption\n\t\t\t:title="$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_MENU_FULL_TITLE')"\n\t\t\t:description="$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_MENU_FULL_DESCR')"\n\t\t\t:isActive="false"\n\t\t\t:notReleased="true"\n\t\t>\n\t\t\t<template #icon>\n\t\t\t\t<StopIcon :active="isActive"/>\n\t\t\t</template>\n\t\t</DropdownMenuOption>\n\t`};const Zo={name:"AutosizeBlockContainer",components:{BlockContainer:ut},props:{blockId:{type:String,required:true},contextMenuItems:{type:Array,default:()=>[]},width:{type:Number,default:null},height:{type:Number,default:null},autosize:{type:Boolean,default:false},highlighted:{type:Boolean,default:false},disabled:{type:Boolean,default:false},colorName:{type:String,default:H.WHITE,validator(t){return Object.values(H).includes(t)}}},computed:{size(){if(this.autosize){return{}}return{width:this.width,height:this.height}}},mounted(){if(this.autosize){this.$nextTick((()=>{var t,e,n;const{width:o,height:i}=(t=(e=this.$refs.blockContainer)==null?void 0:(n=e.$el)==null?void 0:n.getBoundingClientRect())!=null?t:{};this.setSizeAutosizedBlock(this.blockId,o,i)}))}},methods:{...S.mapActions(rt,["setSizeAutosizedBlock"])},template:`\n\t\t<BlockContainer\n\t\t\tref="blockContainer"\n\t\t\tv-bind="size"\n\t\t\t:contextMenuItems="contextMenuItems"\n\t\t\t:highlighted="highlighted"\n\t\t\t:disabled="disabled"\n\t\t\t:colorName="colorName"\n\t\t>\n\t\t\t<template #default="{ isOpenContextMenu }">\n\t\t\t\t<slot :isOpenContextMenu="isOpenContextMenu"/>\n\t\t\t</template>\n\t\t</BlockContainer>\n\t`};const Ho=300;var Uo=babelHelpers.classPrivateFieldLooseKey("loc");var $o=babelHelpers.classPrivateFieldLooseKey("history");var zo=babelHelpers.classPrivateFieldLooseKey("appStore");var jo=babelHelpers.classPrivateFieldLooseKey("commonNodeSettingsStore");var Xo=babelHelpers.classPrivateFieldLooseKey("complexNodeSettingsStore");var qo=babelHelpers.classPrivateFieldLooseKey("diagramStore");class Ko{constructor(){Object.defineProperty(this,Uo,{writable:true,value:null});Object.defineProperty(this,$o,{writable:true,value:null});Object.defineProperty(this,zo,{writable:true,value:null});Object.defineProperty(this,jo,{writable:true,value:null});Object.defineProperty(this,Xo,{writable:true,value:null});Object.defineProperty(this,qo,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,Uo)[Uo]=N();babelHelpers.classPrivateFieldLooseBase(this,$o)[$o]=h.useHistory();babelHelpers.classPrivateFieldLooseBase(this,zo)[zo]=Se();babelHelpers.classPrivateFieldLooseBase(this,jo)[jo]=tn();babelHelpers.classPrivateFieldLooseBase(this,Xo)[Xo]=ae();babelHelpers.classPrivateFieldLooseBase(this,qo)[qo]=rt()}isCurrentBlock(t){return babelHelpers.classPrivateFieldLooseBase(this,jo)[jo].isCurrentBlock(t)||babelHelpers.classPrivateFieldLooseBase(this,Xo)[Xo].isCurrentBlock(t)}hideAllSettings(){return new Promise((t=>{babelHelpers.classPrivateFieldLooseBase(this,zo)[zo].hideRightPanel();babelHelpers.classPrivateFieldLooseBase(this,jo)[jo].hideSettings();babelHelpers.classPrivateFieldLooseBase(this,Xo)[Xo].toggleVisibility(false);setTimeout((()=>t()),Ho)}))}hideCurrentBlockSettings(t){if(this.isCurrentBlock(t)){this.hideAllSettings()}}async showNodeSettings(t){const e=["ForEachActivity","IfElseBranchActivity"];if(t.type===F.COMPLEX&&!e.includes(t.activity.Type)){this.showComplexNodeSettings(t);return}this.showCommonNodeSettings(t)}async showCommonNodeSettings(t){await this.hideAllSettings();babelHelpers.classPrivateFieldLooseBase(this,zo)[zo].showRightPanel();babelHelpers.classPrivateFieldLooseBase(this,jo)[jo].showSettings(t)}async showComplexNodeSettings(t){await this.hideAllSettings();babelHelpers.classPrivateFieldLooseBase(this,zo)[zo].showRightPanel();babelHelpers.classPrivateFieldLooseBase(this,Xo)[Xo].toggleVisibility(true);await babelHelpers.classPrivateFieldLooseBase(this,Xo)[Xo].fetchNodeSettings(t)}getCtxMenuItemShowSimpleSettings(t){return{id:"showSimpleSettings",text:babelHelpers.classPrivateFieldLooseBase(this,Uo)[Uo].getMessage("BIZPROCDESIGNER_EDITOR_BLOCK_CONTEXT_MENU_ITEM_OPEN"),onclick:()=>this.showNodeSettings(t)}}getCtxMenuItemShowComplexSettings(t){return{id:"showComplexSettings",text:babelHelpers.classPrivateFieldLooseBase(this,Uo)[Uo].getMessage("BIZPROCDESIGNER_EDITOR_BLOCK_CONTEXT_MENU_ITEM_OPEN"),onclick:()=>this.showNodeSettings(t)}}getCtxMenuItemDeleteBlock(t){return{id:"deleteBlock",text:babelHelpers.classPrivateFieldLooseBase(this,Uo)[Uo].getMessage("BIZPROCDESIGNER_EDITOR_BLOCK_CONTEXT_MENU_ITEM_DELETE"),onclick:()=>{this.hideCurrentBlockSettings(t.id);babelHelpers.classPrivateFieldLooseBase(this,qo)[qo].deleteBlockById(t.id);babelHelpers.classPrivateFieldLooseBase(this,$o)[$o].makeSnapshot()}}}}const Wo={name:"BlockSimple",components:{MoveableBlock:h.MoveableBlock,AutosizeBlockContainer:Zo,BlockLayout:yt,BlockHeader:Rt,BlockIcon:Mt,DeleteBlockIconBtn:Do,UpdatePublishedStatusLabel:Po,IconDivider:gt,IconButton:ht,PortsInOutCenter:wt},props:{block:{type:Object,required:true},autosize:{type:Boolean,default:false}},computed:{isBlockActivated(){return q(this.block)}},setup(t){return{iconSet:f.Outline,blockMediator:new Ko}},template:`\n\t\t<MoveableBlock :block="block">\n\t\t\t<template #default="{ isHighlighted, isDragged, isDisabled, isActivated }">\n\t\t\t\t<AutosizeBlockContainer\n\t\t\t\t\t:blockId="block.id"\n\t\t\t\t\t:autosize="autosize"\n\t\t\t\t\t:width="block.dimensions.width"\n\t\t\t\t\t:height="block.dimensions.height"\n\t\t\t\t\t:highlighted="isHighlighted"\n\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t:deactivated="!isBlockActivated"\n\t\t\t\t\t:contextMenuItems="[\n\t\t\t\t\t\tblockMediator.getCtxMenuItemShowSimpleSettings(block),\n\t\t\t\t\t\tblockMediator.getCtxMenuItemDeleteBlock(block),\n\t\t\t\t\t]"\n\t\t\t\t\t@dblclick.stop="blockMediator.showNodeSettings(block)"\n\t\t\t\t>\n\t\t\t\t\t<BlockLayout\n\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t:moreMenuItems="[\n\t\t\t\t\t\t\tblockMediator.getCtxMenuItemShowSimpleSettings(block),\n\t\t\t\t\t\t\tblockMediator.getCtxMenuItemDeleteBlock(block),\n\t\t\t\t\t\t]"\n\t\t\t\t\t\t:dragged="isDragged"\n\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #top-menu>\n\t\t\t\t\t\t\t<DeleteBlockIconBtn\n\t\t\t\t\t\t\t\t:blockId="block.id"\n\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\t@deletedBlock="blockMediator.hideCurrentBlockSettings($event)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<IconDivider/>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #default>\n\t\t\t\t\t\t\t<PortsInOutCenter\n\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<BlockHeader :block="block">\n\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\t\t\t\t\t:iconName="block.node.icon"\n\t\t\t\t\t\t\t\t\t\t\t:iconColorIndex="block.node.colorIndex"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</BlockHeader>\n\t\t\t\t\t\t\t</PortsInOutCenter>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #status>\n\t\t\t\t\t\t\t<UpdatePublishedStatusLabel :block="block"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</BlockLayout>\n\t\t\t\t</AutosizeBlockContainer>\n\t\t\t</template>\n\t\t</MoveableBlock>\n\t`};const Yo={name:"BlockTrigger",components:{MoveableBlock:h.MoveableBlock,AutosizeBlockContainer:Zo,BlockLayout:yt,BlockHeader:Rt,BlockIcon:Mt,DeleteBlockIconBtn:Do,UpdatePublishedStatusLabel:Po,IconDivider:gt,IconButton:ht,PortsInOutCenter:wt,BlockSwitcher:Nt},props:{block:{type:Object,required:true},autosize:{type:Boolean,default:false}},computed:{isBlockActivated(){return q(this.block)}},setup(t){const e=E.inject("onToggleBlockActivation");function n(){if(!e){console.warn("onToggleBlockActivation is not provided");return}e(t.block.id)}return{iconSet:f.Outline,blockMediator:new Ko,toggleBlock:n}},template:`\n\t\t<MoveableBlock :block="block">\n\t\t\t<template #default="{ isHighlighted, isDragged, isDisabled }">\n\t\t\t\t<AutosizeBlockContainer\n\t\t\t\t\t:blockId="block.id"\n\t\t\t\t\t:autosize="autosize"\n\t\t\t\t\t:width="block.dimensions.width"\n\t\t\t\t\t:height="block.dimensions.height"\n\t\t\t\t\t:highlighted="isHighlighted"\n\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t:deactivated="!isBlockActivated"\n\t\t\t\t\t:contextMenuItems="[\n\t\t\t\t\t\tblockMediator.getCtxMenuItemShowSimpleSettings(block),\n\t\t\t\t\t\tblockMediator.getCtxMenuItemDeleteBlock(block),\n\t\t\t\t\t]"\n\t\t\t\t\t@dblclick.stop="blockMediator.showNodeSettings(block)"\n\t\t\t\t>\n\t\t\t\t\t<BlockLayout\n\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t:moreMenuItems="[\n\t\t\t\t\t\t\tblockMediator.getCtxMenuItemShowSimpleSettings(block),\n\t\t\t\t\t\t\tblockMediator.getCtxMenuItemDeleteBlock(block),\n\t\t\t\t\t\t]"\n\t\t\t\t\t\t:dragged="isDragged"\n\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #top-menu>\n\t\t\t\t\t\t\t<DeleteBlockIconBtn\n\t\t\t\t\t\t\t\t:blockId="block.id"\n\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\t@deletedBlock="blockMediator.hideCurrentBlockSettings($event)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<IconDivider/>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #default>\n\t\t\t\t\t\t\t<PortsInOutCenter\n\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\thideInputPorts\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<BlockHeader :block="block">\n\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\t\t\t\t\t:iconName="block.node.icon"\n\t\t\t\t\t\t\t\t\t\t\t:iconColorIndex="block.node.colorIndex"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</BlockHeader>\n\t\t\t\t\t\t\t</PortsInOutCenter>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #left>\n\t\t\t\t\t\t\t<BlockSwitcher\n\t\t\t\t\t\t\t\t:on="isBlockActivated"\n\t\t\t\t\t\t\t\t@click="toggleBlock"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #status>\n\t\t\t\t\t\t\t<UpdatePublishedStatusLabel :block="block"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</BlockLayout>\n\t\t\t\t</AutosizeBlockContainer\n\t\t\t\t\t:blockId="block.id"\n\t\t\t\t\t:autosize="block.node.autosize"\n\t\t\t\t\t:width="block.dimensions.width"\n\t\t\t\t\t:height="block.dimensions.height">\n\t\t\t</template>\n\t\t</MoveableBlock>\n\t`};const Jo={name:"block-complex",components:{MoveableBlock:h.MoveableBlock,BlockContainer:ut,BlockLayout:yt,BlockHeader:Rt,BlockIcon:Mt,DeleteBlockIconBtn:Do,IconDivider:gt,IconButton:ht,PortsInOutCenter:wt,BlockComplexContent:xt,AddComplexBlockPort:wo,UpdatePublishedStatusLabel:Po},props:{block:{type:Object,required:true}},setup(t){return{iconSet:f.Outline,blockMediator:new Ko}},methods:{...S.mapActions(ae,["fetchNodeSettings","toggleVisibility"]),onBlockDblClick(){this.toggleVisibility(true);this.fetchNodeSettings(this.block)}},computed:{isBlockActivated(){return q(this.block)}},template:`\n\t\t<MoveableBlock :block="block">\n\t\t\t<template #default="{ isHighlighted, isDragged, isDisabled }">\n\t\t\t\t<BlockContainer\n\t\t\t\t\t:width="200"\n\t\t\t\t\t:contextMenuItems="[\n\t\t\t\t\t\tblockMediator.getCtxMenuItemShowComplexSettings(block),\n\t\t\t\t\t\tblockMediator.getCtxMenuItemDeleteBlock(block),\n\t\t\t\t\t]"\n\t\t\t\t\t:highlighted="isHighlighted"\n\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t:deactivated="!isBlockActivated"\n\t\t\t\t\t@dblclick.stop="blockMediator.showNodeSettings(block)"\n\t\t\t\t>\n\t\t\t\t\t<BlockLayout\n\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t:moreMenuItems="[\n\t\t\t\t\t\t\tblockMediator.getCtxMenuItemShowComplexSettings(block),\n\t\t\t\t\t\t\tblockMediator.getCtxMenuItemDeleteBlock(block),\n\t\t\t\t\t\t]"\n\t\t\t\t\t\t:dragged="isDragged"\n\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #top-menu>\n\t\t\t\t\t\t\t<DeleteBlockIconBtn\n\t\t\t\t\t\t\t\t:blockId="block.id"\n\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\t@deletedBlock="blockMediator.hideCurrentBlockSettings($event)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<IconDivider/>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #default>\n\t\t\t\t\t\t\t<BlockComplexContent\n\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<template #header>\n\t\t\t\t\t\t\t\t\t<BlockHeader :block="block">\n\t\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\t\t\t\t\t\t:iconName="block.node.icon"\n\t\t\t\t\t\t\t\t\t\t\t\t:iconColorIndex="block.node.colorIndex"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t</BlockHeader>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\x3c!--\n\t\t\t\t\t\t\t\t<template #addPortPoint="{ position }">\n\t\t\t\t\t\t\t\t\t<AddComplexBlockPort\n\t\t\t\t\t\t\t\t\t\t:position="position"\n\t\t\t\t\t\t\t\t\t\t:highlighted="isHighlighted"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t--\x3e\n\t\t\t\t\t\t\t</BlockComplexContent>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #status>\n\t\t\t\t\t\t\t<UpdatePublishedStatusLabel :block="block"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</BlockLayout>\n\t\t\t\t</BlockContainer>\n\t\t\t</template>\n\t\t</MoveableBlock>\n\t`};const Qo={name:"BlockTool",components:{MoveableBlock:h.MoveableBlock,BlockContainer:ut,BlockLayout:yt,BlockHeader:Rt,BlockIcon:Mt,DeleteBlockIconBtn:Do,UpdatePublishedStatusLabel:Po,IconDivider:gt,IconButton:ht,PortsInOutCenter:wt},props:{block:{type:Object,required:true}},setup(t){return{iconSet:f.Outline,blockMediator:new Ko}},methods:{isUrl(t){if(!t||!b.Type.isString(t)){return false}try{const e=new URL(t);return e.protocol==="https:"}catch{return false}},getSafeUrl(t){if(!t||!b.Type.isString(t)){return""}try{const e=new URL(t.trim());if(e.protocol!=="https:"){return""}return e.href}catch{return""}},getBackgroundImage(t){const e=this.getSafeUrl(t);if(!e){return{}}return{"background-image":`url('${e}')`}}},computed:{isBlockActivated(){return q(this.block)}},template:`\n\t\t<MoveableBlock :block="block">\n\t\t\t<template #default="{ isHighlighted, isDragged, isDisabled }">\n\t\t\t\t<BlockContainer\n\t\t\t\t\t:width="200"\n\t\t\t\t\t:highlighted="isHighlighted"\n\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t:deactivated="!isBlockActivated"\n\t\t\t\t\t:contextMenuItems="[\n\t\t\t\t\t\tblockMediator.getCtxMenuItemShowSimpleSettings(block),\n\t\t\t\t\t\tblockMediator.getCtxMenuItemDeleteBlock(block),\n\t\t\t\t\t]"\n\t\t\t\t\t@dblclick.stop="blockMediator.showCommonNodeSettings(block)"\n\t\t\t\t>\n\t\t\t\t\t<BlockLayout\n\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t:moreMenuItems="[\n\t\t\t\t\t\t\tblockMediator.getCtxMenuItemShowSimpleSettings(block),\n\t\t\t\t\t\t\tblockMediator.getCtxMenuItemDeleteBlock(block),\n\t\t\t\t\t\t]"\n\t\t\t\t\t\t:dragged="isDragged"\n\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #top-menu>\n\t\t\t\t\t\t\t<DeleteBlockIconBtn\n\t\t\t\t\t\t\t\t:blockId="block.id"\n\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\t@deletedBlock="blockMediator.hideCurrentBlockSettings($event)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<IconDivider/>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #default>\n\t\t\t\t\t\t\t<PortsInOutCenter\n\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<BlockHeader :block="block" :subIconExternal="isUrl(block.node?.icon)">\n\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\t\t\t\t\t:iconName="block.node.icon === 'DATABASE' ? block.node.icon : 'MCP_LETTERS'"\n\t\t\t\t\t\t\t\t\t\t\t:iconColorIndex="0"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t\t<template #subIcon v-if="block.node?.icon && block.node.icon !== 'DATABASE'">\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tv-if="isUrl(block.node.icon)"\n\t\t\t\t\t\t\t\t\t\t\t:style="getBackgroundImage(block.node.icon)"\n\t\t\t\t\t\t\t\t\t\t\tclass="ui-selector-item-avatar"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t<BlockIcon\n\t\t\t\t\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t\t\t\t\t:iconName="block.node.icon"\n\t\t\t\t\t\t\t\t\t\t\t:iconColorIndex="7"\n\t\t\t\t\t\t\t\t\t\t\t:iconSize="24"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</BlockHeader>\n\t\t\t\t\t\t\t</PortsInOutCenter>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #status>\n\t\t\t\t\t\t\t<UpdatePublishedStatusLabel :block="block"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</BlockLayout>\n\t\t\t\t</BlockContainer>\n\t\t\t</template>\n\t\t</MoveableBlock>\n\t`};const ti={name:"BlockFrame",components:{ResizableBlock:h.ResizableBlock,BlockContainer:ut,BlockLayout:yt,BlockTopTitle:Ft,DeleteBlockIconBtn:Do,UpdatePublishedStatusLabel:Po,IconDivider:gt,IconButton:ht},props:{block:{type:Object,required:true}},setup(t){return{iconSet:f.Outline,blockMediator:new Ko}},computed:{isBlockActivated(){return q(this.block)}},template:`\n\t\t<ResizableBlock :block="block">\n\t\t\t<template #default="{ isHighlighted, isResize, isDragged, isDisabled }">\n\t\t\t\t<BlockContainer\n\t\t\t\t\t:highlighted="isHighlighted"\n\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t:deactivated="!isBlockActivated"\n\t\t\t\t\t:contextMenuItems="[\n\t\t\t\t\t\tblockMediator.getCtxMenuItemDeleteBlock(block)\n\t\t\t\t\t]"\n\t\t\t\t\tcolorName="orange"\n\t\t\t\t>\n\t\t\t\t\t<BlockLayout\n\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t:moreMenuItems="[\n\t\t\t\t\t\t\tblockMediator.getCtxMenuItemDeleteBlock(block)\n\t\t\t\t\t\t]"\n\t\t\t\t\t\t:dragged="isDragged"\n\t\t\t\t\t\t:resized="isResize"\n\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t>\n\t\t\t\t\t\t<template #top-menu-title>\n\t\t\t\t\t\t\t<BlockTopTitle :title="block.node.title"/>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #top-menu>\n\t\t\t\t\t\t\t<DeleteBlockIconBtn\n\t\t\t\t\t\t\t\t:blockId="block.id"\n\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\t@deletedBlock="blockMediator.hideCurrentBlockSettings($event)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<IconDivider/>\n\t\t\t\t\t\t\t<IconButton :icon-name="iconSet.PAUSE_L"/>\n\t\t\t\t\t\t\t<IconButton :icon-name="iconSet.QUESTION"/>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #default>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #status>\n\t\t\t\t\t\t\t<UpdatePublishedStatusLabel :block="block"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</BlockLayout>\n\t\t\t\t</BlockContainer>\n\t\t\t</template>\n\t\t</ResizableBlock>\n\t`};const ei={name:"DiagramMenu",components:{MenuButton:It},setup(){return{AirButtonStyle:g.AirButtonStyle}},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},getDiagramMenu(){return{items:[{title:this.loc("BIZPROCDESIGNER_EDITOR_TOP_PANEL_MENU_ACTION_MARKET"),icon:C.Outline.MARKET,design:"disabled",disabled:true,badgeText:"\u0421\u043a\u043e\u0440\u043e"}]}}},template:`\n\t\t<MenuButton\n\t\t\t:buttonStyle="AirButtonStyle.OUTLINE_ACCENT_2"\n\t\t\t:text="loc('BIZPROCDESIGNER_EDITOR_TOP_PANEL_MENU_BUTTON')"\n\t\t\t:options="getDiagramMenu()"\n\t\t/>\n\t`};const ni={name:"AutosaveStatus",components:{AutosaveStatusEntity:Gt},computed:{...S.mapState(rt,["isOnline"])},template:`\n\t\t<AutosaveStatusEntity :isOnline="isOnline"/>\n\t`};const oi={name:"EditTemplateSettingsDialog",emits:["close"],computed:{...S.mapWritableState(rt,["template"])},beforeMount(){var t,e,n,o;this.localName=(t=(e=this.template)==null?void 0:e.NAME)!=null?t:"";this.localDescription=(n=(o=this.template)==null?void 0:o.DESCRIPTION)!=null?n:""},mounted(){this.getDialog().setContent(this.$refs.content);this.getDialog().show()},unmounted(){var t;(t=this.instance)==null?void 0:t.hide()},methods:{...S.mapActions(rt,["updateTemplateData"]),loc(t){return this.$bitrix.Loc.getMessage(t)},getDialog(){if(!this.instance){this.instance=this.createDialog()}return this.instance},createDialog(){const t=new I.Button({text:this.loc("BIZPROCDESIGNER_EDITOR_SETTINGS_BUTTON_SAVE"),useAirDesign:true,style:I.AirButtonStyle.FILLED});const e=new I.Button({text:this.loc("BIZPROCDESIGNER_EDITOR_SETTINGS_BUTTON_CANCEL"),useAirDesign:true,style:I.AirButtonStyle.OUTLINE});const n={title:this.loc("BIZPROCDESIGNER_EDITOR_SETTINGS_TITLE"),subtitle:this.loc("BIZPROCDESIGNER_EDITOR_SETTINGS_DESCRIPTION"),centerButtons:[t,e],events:{onHide:this.closePopup},width:495};const o=new v.Dialog(n);e.bindEvent("click",(()=>{o.hide()}));t.bindEvent("click",(()=>{this.template.NAME=b.Type.isStringFilled(this.localName)?this.localName:this.loc("BIZPROCDESIGNER_EDITOR_DEFAULT_TITLE");this.template.DESCRIPTION=this.localDescription;this.updateTemplateData({NAME:this.template.NAME,DESCRIPTION:this.template.DESCRIPTION});o.hide()}));return o},closePopup(){this.$emit("close")}},template:`\n\t\t<div ref="content">\n\t\t\t<div class="bizproc-template-settings-lable">\n\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_SETTINGS_LABEL') }}\n\t\t\t</div>\n\t\t\t<div class="bizproc-template-settings-title">\n\t\t\t\t<div class="ui-ctl ui-ctl-textbox">\n\t\t\t\t\t<input\n\t\t\t\t\t\tv-model="localName"\n\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_DEFAULT_TITLE')"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="bizproc-template-settings-description">\n\t\t\t\t<div class="ui-ctl ui-ctl-textarea">\n\t\t\t\t\t<textarea\n\t\t\t\t\t\tv-model="localDescription"\n\t\t\t\t\t\t:placeholder="$Bitrix.Loc.getMessage('BIZPROCDESIGNER_EDITOR_DESCRIPTION_PLACEHOLDER')"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const ii="space";const si={name:"TemplateName",components:{EditTemplateName:Ao,EditTemplateSettingsDialog:oi},data(){return{isPopupShown:false}},methods:{loc(t){return this.$bitrix.Loc.getMessage(t)},getMenuItems(){return{sections:[{code:ii}],items:[{title:this.loc("BIZPROCDESIGNER_EDITOR_TOP_PANEL_TITLE_ACTION_SETTINGS"),icon:C.Outline.SETTINGS,onClick:this.onOpenSettingsPopup}]}},onOpenSettingsPopup(){this.isPopupShown=true},onCloseSettingsPopup(){this.isPopupShown=false}},template:`\n\t\t<EditTemplateName :dropdownOptions="getMenuItems()"/>\n\t\t<EditTemplateSettingsDialog\n\t\t\tv-if="isPopupShown"\n\t\t\t@close="onCloseSettingsPopup"\n\t\t/>\n\t`};const li={name:"PublishDropdownButton",components:{PublishDropdownButtonFeature:xo,PublishMainDropdownOption:Fo,PublishUserDropdownOption:Vo,PublishFullDropdownOption:Go},template:`\n\t\t<PublishDropdownButtonFeature>\n\t\t\t<PublishMainDropdownOption/>\n\t\t\t<PublishUserDropdownOption/>\n\t\t\t<PublishFullDropdownOption/>\n\t\t</PublishDropdownButtonFeature>\n\t`};const ai={name:"CommonNodeSettings",components:{CommonNodeSettingsForm:Sn,BlockIcon:Mt},computed:{...S.mapState(tn,["isVisible","block"]),...S.mapState(rt,["documentType"])},methods:{...S.mapActions(Se,["hideRightPanel","setShowPreviewPanel"]),...S.mapActions(tn,["hideSettings"]),onCloseSettings(){this.hideSettings();this.hideRightPanel()}},template:`\n\t\t<CommonNodeSettingsForm\n\t\t\tv-if="isVisible"\n\t\t\t:block="block"\n\t\t\t:documentType="documentType"\n\t\t\t@close="onCloseSettings"\n\t\t\t@showPreview="setShowPreviewPanel"\n\t\t>\n\t\t\t<template #header-icon>\n\t\t\t\t<BlockIcon\n\t\t\t\t\t:iconName="block?.node?.icon"\n\t\t\t\t\t:iconColorIndex="block?.node?.colorIndex"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</CommonNodeSettingsForm>\n\t`};const ri={name:"fixed-catalog-burger-btn",components:{BurgerBtn:so},setup(){const t=Jn();const{isFixedCatalog:e}=S.storeToRefs(t);return{isFixedCatalog:e,toggleFixedCatalog:t.toggleFixedCatalog}},template:`\n\t\t<BurgerBtn\n\t\t\t:opened="isFixedCatalog"\n\t\t\t@click="toggleFixedCatalog"\n\t\t/>\n\t`};const ci={name:"HoverCatalogLayout",components:{CatalogLayout:no},setup(){const t=Jn();const{isExpandedCatalog:e,isShowSearchResults:n}=S.storeToRefs(t);function o(){t.expandCatalog()}function i(){t.collapseCatalog()}return{isExpandedCatalog:e,isShowSearchResults:n,onMouseOver:o,onMouseLeave:i}},template:`\n\t\t<CatalogLayout\n\t\t\t:hasSearchResults="isShowSearchResults"\n\t\t\t:expanded="isExpandedCatalog"\n\t\t\t@mouseover="onMouseOver"\n\t\t\t@mouseleave="onMouseLeave"\n\t\t>\n\t\t\t<template #header>\n\t\t\t\t<slot name="header"/>\n\t\t\t</template>\n\n\t\t\t<template #search>\n\t\t\t\t<slot name="search"/>\n\t\t\t</template>\n\n\t\t\t<template #content>\n\t\t\t\t<slot name="content"/>\n\t\t\t</template>\n\n\t\t\t<template #search-results>\n\t\t\t\t<slot name="search-results"/>\n\t\t\t</template>\n\n\t\t\t<template #footer>\n\t\t\t\t<slot name="footer"/>\n\t\t\t</template>\n\t\t</CatalogLayout>\n\t`};const di={name:"SearchCatalogItemsInput",components:{TextInput:ao,BIcon:f.BIcon},data(){return{isFocused:false}},computed:{...S.mapWritableState(Jn,["searchText","canSearch"]),iconColor(){return this.isFocused||this.searchText.length>0?"var(--ui-color-accent-main-primary)":"var(--ui-color-gray-50)"},showClearButton(){return this.isFocused||this.searchText.length>0}},watch:{canSearch(t){if(!t){this.hideFoundedGroupItems();this.resetCurrentGroup()}}},setup(t){return{iconSet:f.Outline}},methods:{...S.mapActions(Jn,["hideFoundedGroupItems","resetCurrentGroup"]),onInputSearchText(t){this.searchText=t},onClear(){this.searchText=""},onFocus(){this.isFocused=true},onBlur(){this.isFocused=false}},template:`\n\t\t<BIcon\n\t\t\t:name="iconSet.SEARCH"\n\t\t\t:size="24"\n\t\t\t:color="iconColor"\n\t\t\tclass="ui-node-catalog-icon"\n\t\t/>\n\t\t<TextInput\n\t\t\t:modelValue="searchText"\n\t\t\t@update:modelValue="onInputSearchText"\n\t\t\t@focus="onFocus"\n\t\t\t@blur="onBlur"\n\t\t/>\n\t\t<button\n\t\t\tv-if="showClearButton"\n\t\t\tclass="editor-chart-catalog-input__clear-btn"\n\t\t\t@click="onClear"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\t:name="iconSet.CROSS_L"\n\t\t\t\t:size="24"\n\t\t\t\tclass="ui-block-diagram-search-input__clear-btn-icon"\n\t\t\t/>\n\t\t</button>\n\t`};const ui={name:"ChangeCatalogGroup",components:{CatalogGroup:ro},props:{group:{type:Object,required:true}},setup(t){const e=Jn();const{currentGroup:n}=S.storeToRefs(e);const o=E.computed((()=>{var e;return t.group.id===(n==null?void 0:(e=n.value)==null?void 0:e.id)}));return{isShowItems:o,onChangeGroup:e.changeCurrentGroup}},template:`\n\t\t<CatalogGroup\n\t\t\t:group="group"\n\t\t\t:showItems="isShowItems"\n\t\t\t@changeGroup="onChangeGroup"\n\t\t>\n\t\t\t<template #icon>\n\t\t\t\t<slot name="icon"/>\n\t\t\t</template>\n\n\t\t\t<template #back>\n\t\t\t\t<slot name="back"/>\n\t\t\t</template>\n\n\t\t\t<template #items>\n\t\t\t\t<slot name="items"/>\n\t\t\t</template>\n\n\t\t\t<template #empty-label>\n\t\t\t\t<slot name="empty-label"/>\n\t\t\t</template>\n\t\t</CatalogGroup>\n\t`};const pi={name:"back-to-groups-btn",components:{CatalogGroupBackBtn:So},props:{groupTitle:{type:String,default:""},collapsed:{type:Boolean,default:false}},setup(){const t=Jn();function e(){t.resetCurrentGroup();t.resetHighlightedItem();t.hideFoundedGroupItems()}return{onResetCurrentGroup:e}},template:`\n\t\t<CatalogGroupBackBtn\n\t\t\t:groupTitle="groupTitle"\n\t\t\t:collapsed="collapsed"\n\t\t\t@click="onResetCurrentGroup"\n\t\t>\n\t\t\t<template #icon>\n\t\t\t\t<slot name="icon"/>\n\t\t\t</template>\n\t\t</CatalogGroupBackBtn>\n\t`};const mi={name:"ChangeFoundedCatalogItem",components:{CatalogItem:bo},props:{item:{type:Object,required:true}},setup(){return{getDragItemSlotName:to}},methods:{...S.mapActions(Jn,["changeCurrentGroup","showFoundedGroupItems","setHighlightedItem"]),onChangeItem(){this.changeCurrentGroup(this.item.parentGroup);this.showFoundedGroupItems();this.setHighlightedItem(this.item.id)}},template:`\n\t\t<CatalogItem\n\t\t\t:item="item"\n\t\t\t@dblclick="onChangeItem"\n\t\t>\n\t\t\t<template #[getDragItemSlotName(item.type)]="{ item }">\n\t\t\t\t<slot\n\t\t\t\t\t:name="getDragItemSlotName(item.type)"\n\t\t\t\t\t:item="item"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</CatalogItem>\n\t`};const hi={name:"ChangeFoundedCatalogGroup",components:{CatalogGroup:ro},props:{group:{type:Object,required:true}},computed:{...S.mapGetters(Jn,["searchResults"])},methods:{...S.mapActions(Jn,["showFoundedGroupItems","changeCurrentGroup","setHighlightedItem"]),onChangeGroup(){this.showFoundedGroupItems();this.changeCurrentGroup(this.group);this.setHighlightedItem(this.searchResults.items.map((t=>t.id)))}},template:`\n\t\t<CatalogGroup\n\t\t\t:group="group"\n\t\t\t:showItems="false"\n\t\t\t@changeGroup="onChangeGroup"\n\t\t>\n\t\t\t<template #icon>\n\t\t\t\t<slot name="icon"/>\n\t\t\t</template>\n\t\t</CatalogGroup>\n\t`};const gi={name:"CatalogWidget",components:{HoverCatalogLayout:ci,HeaderLogo:lo,HeaderLayout:oo,CatalogGroupList:vo,CatalogGroup:ro,CatalogGroupEmptyLabel:co,CatalogGroupIcon:po,CatalogItem:bo,SearchResultsLayout:ko,SearchResultsLabel:yo,SearchResultsEmptyLabel:Oo,FixedCatalogBurgerBtn:ri,SearchCatalogItemsInput:di,ChangeCatalogGroup:ui,ChangeFoundedCatalogGroup:hi,ChangeFoundedCatalogItem:mi,BackToGroupsBtn:pi},setup(){const t=Jn();const{isExpandedCatalog:e,groups:n,currentGroup:o,currentItem:i,searchResultsCount:s,searchResults:l,highlightedItems:a}=S.storeToRefs(t);return{isExpandedCatalog:e,searchResultsCount:s,searchResults:l,currentGroup:o,currentItem:i,groups:n,highlightedItems:a,getDragItemSlotName:to}},template:`\n\t\t<HoverCatalogLayout>\n\t\t\t<template #header>\n\t\t\t\t<HeaderLayout :expanded="isExpandedCatalog">\n\t\t\t\t\t<template #switcher>\n\t\t\t\t\t\t<FixedCatalogBurgerBtn/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template #logo>\n\t\t\t\t\t\t<HeaderLogo/>\n\t\t\t\t\t</template>\n\t\t\t\t</HeaderLayout>\n\t\t\t</template>\n\n\t\t\t<template #search>\n\t\t\t\t<SearchCatalogItemsInput/>\n\t\t\t</template>\n\n\t\t\t<template #content>\n\t\t\t\t<CatalogGroupList\n\t\t\t\t\t:groups="groups"\n\t\t\t\t\t:currentGroup="currentGroup"\n\t\t\t\t>\n\t\t\t\t\t<template #group="{ group }">\n\t\t\t\t\t\t<ChangeCatalogGroup :group="group">\n\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t<CatalogGroupIcon :iconName="group.icon"/>\n\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t<template #back>\n\t\t\t\t\t\t\t\t<BackToGroupsBtn\n\t\t\t\t\t\t\t\t\t:groupTitle="group.title"\n\t\t\t\t\t\t\t\t\t:collapsed="!isExpandedCatalog"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t\t<CatalogGroupIcon :iconName="group.icon"/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</BackToGroupsBtn>\n\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t<template #items>\n\t\t\t\t\t\t\t\t<CatalogItem\n\t\t\t\t\t\t\t\t\tv-for="item in group.items"\n\t\t\t\t\t\t\t\t\t:key="item.id"\n\t\t\t\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t\t\t\t:active="highlightedItems.has(item.id) && isExpandedCatalog"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #[getDragItemSlotName(item.type)]="{ item }">\n\t\t\t\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\t\t\t\t:name="getDragItemSlotName(item.type)"\n\t\t\t\t\t\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</CatalogItem>\n\t\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t\t<template #empty-label>\n\t\t\t\t\t\t\t\t<CatalogGroupEmptyLabel/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</ChangeCatalogGroup>\n\t\t\t\t\t</template>\n\t\t\t\t</CatalogGroupList>\n\t\t\t</template>\n\n\t\t\t<template #search-results>\n\t\t\t\t<SearchResultsLayout\n\t\t\t\t\t:groups="searchResults.groups"\n\t\t\t\t\t:items="searchResults.items"\n\t\t\t\t\t:collapsed="!isExpandedCatalog"\n\t\t\t\t>\n\n\t\t\t\t\t<template #group="{ group }">\n\t\t\t\t\t\t<ChangeFoundedCatalogGroup :group="group">\n\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t<CatalogGroupIcon :iconName="group.icon"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</ChangeFoundedCatalogGroup>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #item="{ item }">\n\t\t\t\t\t\t<ChangeFoundedCatalogItem :item="item">\n\t\t\t\t\t\t\t<template #[getDragItemSlotName(item.type)]="{ item }">\n\t\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\t\t:name="getDragItemSlotName(item.type)"\n\t\t\t\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</ChangeFoundedCatalogItem>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #empty-label>\n\t\t\t\t\t\t<SearchResultsEmptyLabel/>\n\t\t\t\t\t</template>\n\t\t\t\t</SearchResultsLayout>\n\t\t\t</template>\n\n\t\t\t<template #footer>\n\t\t\t\t<slot name="footer"/>\n\t\t\t</template>\n\t\t</HoverCatalogLayout>\n\t`};const Ci={name:"AppLayoutWidget",components:{AppLayoutEntity:ke},computed:{...S.mapState(Se,["isShownRightPanel","isShownPreviewPanel"])},template:`\n\t\t<AppLayoutEntity\n\t\t\t:showSettings="isShownRightPanel"\n\t\t\t:showPreviewPanel="isShownPreviewPanel"\n\t\t>\n\t\t\t<template #header>\n\t\t\t\t<slot name="header"/>\n\t\t\t</template>\n\n\t\t\t<template #diagram>\n\t\t\t\t<slot name="diagram"/>\n\t\t\t</template>\n\n\t\t\t<template #catalog>\n\t\t\t\t<slot name="catalog"/>\n\t\t\t</template>\n\n\t\t\t<template #top-right-toolbar>\n\t\t\t\t<slot name="top-right-toolbar"/>\n\t\t\t</template>\n\n\t\t\t<template #bottom-right-toolbar>\n\t\t\t\t<slot name="bottom-right-toolbar"/>\n\t\t\t</template>\n\n\t\t\t<template #settings>\n\t\t\t\t<slot name="settings"/>\n\t\t\t</template>\n\t\t</AppLayoutEntity>\n\t`};const bi={name:"AppHeader",components:{AppHeaderEntity:Oe,AppHeaderDivider:De,LogoLayout:Be,LogoBackBtn:Re,LogoTitle:Le},setup(){const t=rt();const{companyName:e}=S.storeToRefs(t);return{companyName:e}},template:`\n\t\t<AppHeaderEntity>\n\t\t\t<template #left>\n\t\t\t\t<LogoLayout>\n\t\t\t\t\t<template #back-btn>\n\t\t\t\t\t\t<LogoBackBtn/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #title>\n\t\t\t\t\t\t<LogoTitle :companyName="companyName"/>\n\t\t\t\t\t</template>\n\t\t\t\t</LogoLayout>\n\t\t\t</template>\n\n\t\t\t<template #right>\n\t\t\t\t<slot name="templateName"/>\n\t\t\t\t<AppHeaderDivider/>\n\t\t\t\t<slot name="autosaveStatus"/>\n\t\t\t\t<AppHeaderDivider/>\n\t\t\t\t<slot name="diagramMenu"/>\n\t\t\t\t<slot name="publishButton"/>\n\t\t\t</template>\n\t\t</AppHeaderEntity>\n\t`};const Ii={components:{AppLayout:Ci,AppHeader:bi,BlockDiagram:Lo,BlockSimple:Wo,BlockTrigger:Yo,BlockComplex:Jo,BlockTool:Qo,BlockFrame:ti,DiagramMenu:ei,AutosaveStatus:ni,TemplateName:si,PublishDropdownButton:li,ZoomBar:h.ZoomBar,ComplexNodeSettings:Kn,NodeSettingsRules:Yn,HistoryBar:h.HistoryBar,SearchBar:Bo,Catalog:gi,CommonNodeSettings:ai,ConnectionAux:Kt},provide(){return{onBlockClick:this.handleBlockClick,showBlockSettings:this.showBlockSettings,onToggleBlockActivation:this.handleToggleBlockActivation}},props:{initTemplateId:{type:Number,default:0},initDocumentType:{type:Array,default:null},initStartTrigger:{type:String,default:null}},setup(t){const e=Jn();rt().initEventListeners();const{makeSnapshot:n,setHandlers:o,commonSnapshotHandler:i,commonRevertHandler:s}=h.useHistory();const l=E.ref(true);const a=t=>({...i(t),blockCurrentTimestamps:E.markRaw(JSON.parse(JSON.stringify(rt().blockCurrentTimestamps)))});const r=t=>{s(t);rt().setBlockCurrentTimestamps(t.blockCurrentTimestamps)};o({snapshotHandler:a,revertHandler:r});const c=h.useAnimationQueue();async function d(){try{await Promise.all([rt().refreshDiagramData({templateId:t.initTemplateId,documentType:t.initDocumentType,startTrigger:t.initStartTrigger}),e.init()]);_((({blocks:t,connections:e,draftId:n,templateId:o})=>{if(rt().draftId===0&&rt().templateId===0){return}if(n!==rt().draftId||o!==rt().templateId){return}rt().updateExistedBlockProperties(t);const i=O(rt().blocks,rt().connections,t,e);c.start({items:i})}))}catch(t){it(t)}finally{l.value=false}n()}d();return{isDiagramDisabled:l,makeSnapshot:n,FeatureCode:p.FeatureCode,blockDiagramSlotNames:V,connectionSlotNames:G,dragItemSlotNames:Qn}},computed:{...S.mapWritableState(rt,["documentTypeSigned","templateId"])},watch:{templateId(t){if(t>0){ot(t)}}},methods:{handleToggleBlockActivation(t){rt().toggleBlockActivation(t)}},template:`\n\t\t<AppLayout>\n\t\t\t<template #header>\n\t\t\t\t<AppHeader>\n\t\t\t\t\t<template #templateName>\n\t\t\t\t\t\t<TemplateName/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #autosaveStatus>\n\t\t\t\t\t\t<AutosaveStatus/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #diagramMenu>\n\t\t\t\t\t\t<DiagramMenu/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #publishButton>\n\t\t\t\t\t\t<PublishDropdownButton/>\n\t\t\t\t\t</template>\n\t\t\t\t</AppHeader>\n\t\t\t</template>\n\n\t\t\t<template #diagram>\n\t\t\t\t<BlockDiagram :disabled="isDiagramDisabled">\n\t\t\t\t\t<template #[blockDiagramSlotNames.SIMPLE]="{ block }">\n\t\t\t\t\t\t<BlockSimple :block="block"/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #[blockDiagramSlotNames.TRIGGER]="{ block }">\n\t\t\t\t\t\t<BlockTrigger :block="block"/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #[blockDiagramSlotNames.COMPLEX]="{ block }">\n\t\t\t\t\t\t<BlockComplex :block="block"/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #[blockDiagramSlotNames.TOOL]="{ block }">\n\t\t\t\t\t\t<BlockTool :block="block"/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #[blockDiagramSlotNames.FRAME]="{ block }">\n\t\t\t\t\t\t<BlockFrame :block="block"/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #[connectionSlotNames.AUX]="{ connection }">\n\t\t\t\t\t\t<ConnectionAux :connection="connection" />\n\t\t\t\t\t</template>\n\t\t\t\t</BlockDiagram>\n\t\t\t</template>\n\n\t\t\t<template #catalog>\n\t\t\t\t<Catalog>\n\t\t\t\t\t<template #[dragItemSlotNames.simple]="{ item }">\n\t\t\t\t\t\t<BlockSimple\n\t\t\t\t\t\t\t:block="item"\n\t\t\t\t\t\t\tautosize\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #[dragItemSlotNames.trigger]="{ item }">\n\t\t\t\t\t\t<BlockTrigger\n\t\t\t\t\t\t\t:block="item"\n\t\t\t\t\t\t\tautosize\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #[dragItemSlotNames.complex]="{ item }">\n\t\t\t\t\t\t<BlockComplex :block="item"/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #[dragItemSlotNames.tool]="{ item }">\n\t\t\t\t\t\t<BlockTool :block="item"/>\n\t\t\t\t\t</template>\n\n\t\t\t\t\t<template #[dragItemSlotNames.frame]="{ item }">\n\t\t\t\t\t\t<BlockFrame :block="item"/>\n\t\t\t\t\t</template>\n\t\t\t\t</Catalog>\n\t\t\t</template>\n\n\t\t\t<template #top-right-toolbar>\n\t\t\t\t<HistoryBar/>\n\t\t\t\t<SearchBar/>\n\t\t\t</template>\n\n\t\t\t<template #bottom-right-toolbar>\n\t\t\t\t<ZoomBar :stepZoom="0.2"/>\n\t\t\t</template>\n\n\t\t\t<template #settings>\n\t\t\t\t<CommonNodeSettings/>\n\n\t\t\t\t<ComplexNodeSettings>\n\t\t\t\t\t<NodeSettingsRules />\n\t\t\t\t</ComplexNodeSettings>\n\t\t\t</template>\n\t\t</AppLayout>\n\t`};const vi={install(t){t.config.globalProperties.$testId=(t,...e)=>{if(!t){throw new Error("bizprocdesiner: not found test id")}const n=e.reduce(((t,e)=>`${t}-${e}`),"");return`${t}${n}`}}};class fi{static mount(t,e){const n=document.getElementById(t);const o=E.BitrixVue.createApp(Ii,e);const i=S.createPinia();o.use(i);o.use(vi);o.provide("debug",false);o.mount(n)}}t.App=fi})(this.BX.Bizprocdesigner.Editor=this.BX.Bizprocdesigner.Editor||{},BX,BX.UI,BX.UI.Vue3.Components,BX.Vue3.Directives,BX,BX.UI.EntitySelector,BX.Main,BX.Event,BX.UI.Dialogs,BX.UI.Vue3.Components,BX.UI.Feedback,BX.Bizprocdesigner,BX,BX.UI,BX.Vue3.Components,BX.UI.IconSet,BX,BX.UI,BX.UI.System,BX.UI.IconSet,BX.Vue3,BX.Vue3.Pinia);
//# sourceMappingURL=chart.bundle.map.js