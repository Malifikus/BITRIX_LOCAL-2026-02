{"version":3,"file":"disk.onlyoffice-promo-popup.bundle.js","sources":["../src/promo-popup.js"],"sourcesContent":["import {ajax as Ajax, Tag, Reflection, Loc} from \"main.core\";\nimport {EventEmitter} from \"main.core.events\";\nimport {MessageBox, MessageBoxButtons} from \"ui.dialogs.messagebox\";\n\nexport default class PromoPopup {\n\tuserBoxNode: HTMLElement = null;\n\n\tstatic shouldBlockViewAndEdit(): boolean\n\t{\n\t\tif (!BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_can_view'] === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn BX.message['disk_onlyoffice_can_view'] == false;\n\t}\n\n\tstatic shouldShowViewPromo(): boolean\n\t{\n\t\tif (!BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_got_promo_about'] === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn BX.message['disk_onlyoffice_got_promo_about'] == false;\n\t}\n\n\tstatic shouldShowEndDemo(): boolean\n\t{\n\t\tif (!BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_demo_ended'] == false)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_got_end_demo'] === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn BX.message['disk_onlyoffice_got_end_demo'] == false;\n\t}\n\n\tstatic shouldShowEditPromo(): boolean\n\t{\n\t\tif (!BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_can_edit'] === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn BX.message['disk_onlyoffice_can_edit'] == false;\n\t}\n\n\tstatic canEdit(): boolean\n\t{\n\t\tif (!BX.Disk.isAvailableOnlyOffice())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tif (BX.message['disk_onlyoffice_can_edit'] === undefined)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn BX.message['disk_onlyoffice_can_edit'] == true;\n\t}\n\n\tstatic registerView(optionName: string): void\n\t{\n\t\tBX.userOptions.save('disk', optionName, 'v', 1);\n\t\tBX.userOptions.send(null);\n\n\t\tif (optionName === 'got_promo_onlyoffice')\n\t\t{\n\t\t\tBX.message['disk_onlyoffice_got_promo_about'] = true;\n\t\t}\n\t\telse if (optionName === 'got_end_demo_onlyoffice')\n\t\t{\n\t\t\tBX.message['disk_onlyoffice_got_end_demo'] = true;\n\t\t}\n\t}\n\n\tstatic showCommonPromoForNonPaid(): void\n\t{\n\t\tif (this.shouldShowEndDemo())\n\t\t{\n\t\t\tthis.showEndOfDemo();\n\t\t}\n\t\telse if (Reflection.getClass('BX.UI.InfoHelper'))\n\t\t{\n\t\t\tBX.UI.InfoHelper.show('limit_office_no_document', {featureId: 'disk_onlyoffice_edit'});\n\t\t\tEventEmitter.subscribeOnce('BX.UI.InfoHelper:onActivateTrialFeatureSuccess', () => {\n\t\t\t\tAjax.runAction('disk.api.onlyoffice.handleTrialFeatureActivation', {});\n\t\t\t});\n\t\t}\n\t}\n\n\tstatic showEditPromo(): void\n\t{\n\t\tif (this.shouldShowEndDemo())\n\t\t{\n\t\t\tthis.showEndOfDemo();\n\t\t}\n\t\telse if (Reflection.getClass('BX.UI.InfoHelper'))\n\t\t{\n\t\t\tBX.UI.InfoHelper.show('limit_office_no_document');\n\t\t}\n\t}\n\n\tstatic showViewPromo(): void\n\t{\n\t\tconst firstRow = this.canEdit() ? Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_EDIT_POPUP_1') : Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_VIEW_POPUP_1');\n\t\tconst content = Tag.render`\n\t\t\t<div>\n\t\t\t\t<div>${firstRow}</div>\n\t\t\t\t<div style=\"padding-top: 15px;\">${Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_VIEW_POPUP_2')}</div>\n\t\t\t\t<div style=\"padding-top: 15px;\">${Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_VIEW_POPUP_3')}</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tMessageBox.show({\n\t\t\ttitle: this.canEdit()? Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_EDIT_POPUP_TITLE') : Loc.getMessage('JS_DISK_ONLYOFFICE_PROMO_VIEW_POPUP_TITLE_MSGVER_1'),\n\t\t\tmessage: content,\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.OK,\n\t\t\tokCaption: Loc.getMessage('DISK_JS_BTN_CLOSE'),\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: () => {\n\t\t\t\t\t\tthis.registerView('got_promo_onlyoffice');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic showEndOfDemo(): void\n\t{\n\t\tconst content = Tag.render`\n\t\t\t<div>\n\t\t\t\t<div>${Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_1')}</div>\n\t\t\t\t<ul>\n\t\t\t\t\t<li>${Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_LIST_1')}</li>\n\t\t\t\t\t<li>${Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_LIST_2')}</li>\n\t\t\t\t\t<li>${Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_LIST_3')}</li>\n\t\t\t\t</ul>\n\t\t\t\t<div>${Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_NOTICE')}</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tMessageBox.show({\n\t\t\ttitle: Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_TITLE'),\n\t\t\tmessage: content,\n\t\t\tmodal: true,\n\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\tokCaption: Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_CONTINUE_WORK_WITH_DOCS'),\n\t\t\tonOk: () => {\n\t\t\t\tthis.showEditPromo();\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tcancelCaption: Loc.getMessage('JS_DISK_ONLYOFFICE_END_DEMO_POPUP_SETUP_WORK'),\n\t\t\tonCancel: () => {\n\t\t\t\tBX.Disk.InformationPopups.openWindowForSelectDocumentService({});\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonPopupShow: () => {\n\t\t\t\t\t\tthis.registerView('got_end_demo_onlyoffice');\n\n\t\t\t\t\t\tBX.message.disk_document_service = null;\n\t\t\t\t\t\tAjax.runAction('disk.api.onlyoffice.handleEndOfTrialFeature', {});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n};"],"names":["PromoPopup","BX","Disk","isAvailableOnlyOffice","message","undefined","optionName","userOptions","save","send","shouldShowEndDemo","showEndOfDemo","Reflection","getClass","UI","InfoHelper","show","featureId","EventEmitter","subscribeOnce","Ajax","runAction","firstRow","canEdit","Loc","getMessage","content","Tag","render","MessageBox","title","modal","buttons","MessageBoxButtons","OK","okCaption","popupOptions","events","onPopupShow","registerView","OK_CANCEL","onOk","showEditPromo","cancelCaption","onCancel","InformationPopups","openWindowForSelectDocumentService","disk_document_service"],"mappings":"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"}