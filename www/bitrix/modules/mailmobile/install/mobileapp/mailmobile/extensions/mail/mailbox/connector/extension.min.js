jn.define("mail/mailbox/connector",((t,e,i)=>{const{Wizard:o}=t("layout/ui/wizard");const{ServicesListStep:n}=t("mail/mailbox/connector/steps/services-list");const{LoginPassword:a}=t("mail/mailbox/connector/steps/login-password");const{Imap:r}=t("mail/mailbox/connector/steps/imap");const{OAuth:s}=t("mail/mailbox/connector/steps/oauth");const{NotifyManager:c}=t("notify-manager");const{MailDialog:l}=t("mail/dialog");class d extends LayoutComponent{constructor(t){super(t);const{parentWidget:e,successCallback:i=()=>{}}=t;this.parentWidget=e;this.successCallback=i;this.connectedEmail=false;this.stepProps={};this.getStepForId=this.getStepForId.bind(this);this.oauthMode=true}validateFields(t){let e=true;Object.values(t).forEach((t=>{if(t&&!t.validate()){e=false}}));return e}loadConnectionUrl(){return BX.ajax.runAction("mail.mailboxconnecting.getConnectionUrl",{})}connectMailbox(t){const{login:e="",password:i="",server:o="",port:n=993,ssl:a=true,storageOauthUid:r="",useSmtp:s=1,serverSmtp:c="",portSmtp:l=587,sslSmtp:d=true,loginSmtp:h="",passwordSMTP:u=""}=t;return BX.ajax.runAction("mail.mailboxconnecting.connectMailbox",{data:{serviceId:this.getMailServiceId(),login:e,password:i,server:o,port:n,ssl:a?1:0,storageOauthUid:r,useSmtp:s,serverSmtp:c,portSmtp:l,sslSmtp:d?1:0,loginSmtp:h,passwordSMTP:u}})}loadServices(){return BX.ajax.runAction("mail.mailboxconnecting.getServices",{})}renderWizard(){return new o({parentLayout:this.currentLayout,steps:this.getSteps().map((t=>t.id)),stepForId:this.getStepForId,useProgressBar:true,hideProgressBarInLastTab:true,isNavigationBarBorderEnabled:true})}saveMailServiceId(t){this.currentMailServiceId=t}getMailServiceId(){return Number(this.currentMailServiceId)}saveMailServiceKey(t){this.currentMailServiceKey=t}getConnectedMailboxId(){return this.connectedMailboxId}saveConnectedMailboxId(t){this.connectedMailboxId=Number(t)}saveConnectedEmail(t){this.connectedEmail=t}getConnectedEmail(){return this.connectedEmail}getServices(){return this.mailServices}nextStep(){this.wizard.moveToNextStep()}async goToStartStep(){this.currentLayout=await this.wizard.openStepWidget("servicesList")}async goToImap(){this.currentLayout=await this.wizard.openStepWidget("imap")}async goToLoginPassword(){this.currentLayout=await this.wizard.openStepWidget("loginPassword")}async goToOauth(){this.currentLayout=await this.wizard.openStepWidget("oauth")}goToFinalStep(){l.show({type:l.CONNECTING_MAIL_TYPE_FINAL,layoutWidget:this.currentLayout,successCallback:()=>{this.successCallback(this.getConnectedMailboxId(),this.getConnectedEmail())},mailboxId:this.getConnectedMailboxId()})}getMailServiceKey(){return this.currentMailServiceKey}onErrorEnter(t,e=true){this.goToStartStep();if(e){c.showErrors(t)}}onConnectMailbox(t,e){this.saveConnectedEmail(e);this.saveConnectedMailboxId(t);c.hideLoadingIndicatorWithoutFallback();this.goToFinalStep()}getStepForId(t){const e=this.getSteps().find((e=>e.id===t));const i=this.stepProps[t]||{};i.parent=this;if(e){return new e.component(i)}return null}getSteps(){const t=[];t.push({id:"servicesList",component:n},{id:"oauth",component:s},{id:"imap",component:r},{id:"loginPassword",component:a});return t}render(){const t=this.renderWizard();this.wizard=t;return View({style:{}},t)}setConnectionUrl(t){this.connectionUrl=t}async getConnectionUrl(){if(!this.connectionUrl){await this.loadConnectionUrl().then((t=>{if(t.data){this.setConnectionUrl(t.data)}}))}return`${this.connectionUrl}?serviceName=${this.getMailServiceKey()}`}show(){c.showLoadingIndicator();this.loadServices().then((t=>{if(t.data){this.mailServices=t.data;c.hideLoadingIndicatorWithoutFallback();const e=this.parentWidget||PageManager;e.openWidget("layout",{modal:true,backdrop:{horizontalSwipeAllowed:false,mediumPositionPercent:90}}).then((t=>{this.currentLayout=t;t.showComponent(this)})).catch(console.error)}}),(t=>{c.hideLoadingIndicatorWithoutFallback();c.showErrors(t.errors)}))}}i.exports={Connector:d}}));
//# sourceMappingURL=extension.map.js