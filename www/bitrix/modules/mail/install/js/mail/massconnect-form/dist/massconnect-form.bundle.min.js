this.BX=this.BX||{};this.BX.Mail=this.BX.Mail||{};(function(t,e,n,i,r,o,a,s,c,l,u,_,d,p,m,f,h){"use strict";var v=Object.freeze({DAY:"1",WEEK:"7",MONTH:"30",TWO_MONTHS:"60",THREE_MONTHS:"90"});var S=Object.freeze({WEEK:"7",MONTH:"30",ALL_TIME:"-1"});var g=Object.freeze({LEAD:"LEAD",CONTACT:"CONTACT"});var O=Object.freeze({CALL:"CALL",EMAIL:"EMAIL",WEB:"WEB",ADVERTISING:"ADVERTISING",PARTNER:"PARTNER",RECOMMENDATION:"RECOMMENDATION",TRADE_SHOW:"TRADE_SHOW",WEBFORM:"WEBFORM",CALLBACK:"CALLBACK",RC_GENERATOR:"RC_GENERATOR",STORE:"STORE",OTHER:"OTHER",BOOKING:"BOOKING",REPEAT_SALE:"REPEAT_SALE"});var y="Y";var E="N";var b={serviceType:"imap",name:"other"};function T(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?T(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var N=f.defineStore("wizard",{state:function t(){return{connectionSettings:{imapServer:"",imapPort:null,imapSsl:true,smtpSettings:{enabled:false,server:"",port:null,ssl:true}},employees:[],addedEmployees:[],mailSettings:{sync:{enabled:true,periodValue:v.WEEK}},crmSettings:{enabled:false,sync:{enabled:true,periodValue:S.WEEK},assignKnownClientEmails:true,incoming:{enabled:true,createAction:g.LEAD},outgoing:{enabled:true,createAction:g.CONTACT},source:O.EMAIL,leadCreationAddresses:"",responsibleQueue:[]},calendarSettings:{enabled:true,autoAddEvents:true},errorState:{enabled:false,errorCnt:0},isLoginColumnShown:false,analyticsSource:"",permissions:{allowedLevels:null,canEditCrmIntegration:false}}},actions:{addEmployee:function t(e){if(this.employees.some((function(t){return t.id===e.id}))){return}this.employees.push(e)},removeEmployeeById:function t(e){this.employees=this.employees.filter((function(t){return t.id!==e}))},setEmployees:function t(e){this.employees=e},clearEmployees:function t(){this.employees=[]},setAddedEmployees:function t(e){this.addedEmployees=e},setMailSettings:function t(e){this.mailSettings=e},setCrmSettings:function t(e){this.crmSettings=e},setCalendarSettings:function t(e){this.calendarSettings=e},prepareCrmOptions:function t(){if(!this.crmSettings.enabled){return{enabled:E}}var e={enabled:y,config:{}};if(this.crmSettings.sync.enabled){e.config.crm_sync_days=parseInt(this.crmSettings.sync.periodValue,10)||0}if(this.crmSettings.assignKnownClientEmails){e.config.crm_public=this.crmSettings.assignKnownClientEmails?y:E}if(this.crmSettings.incoming.enabled){e.config.crm_new_entity_in=this.crmSettings.incoming.createAction}if(this.crmSettings.outgoing.enabled){e.config.crm_new_entity_out=this.crmSettings.outgoing.createAction}e.config.crm_lead_source=this.crmSettings.source;if(this.crmSettings.responsibleQueue.length>0){e.config.crm_lead_resp=this.crmSettings.responsibleQueue.map((function(t){return t.id}))}if(this.crmSettings.leadCreationAddresses.length>0){e.config.crm_new_lead_for=this.crmSettings.leadCreationAddresses}return e},prepareDataForBackend:function t(){var e=this;var n=this.prepareCrmOptions();var i=this.employees.map((function(t){var i=e.connectionSettings.smtpSettings.server;var r=e.connectionSettings.smtpSettings.port;var o=Boolean(i&&r);var a=e.connectionSettings.smtpSettings.enabled&&o?y:E;var s={userIdToConnect:t.id,email:t.email,login:t.login||t.email,password:t.password,loginSmtp:t.login||t.email,passwordSMTP:t.password,mailboxName:t.email,senderName:t.name,server:e.connectionSettings.imapServer,port:e.connectionSettings.imapPort,ssl:e.connectionSettings.imapSsl?y:E,useSmtp:a,serverSmtp:e.connectionSettings.smtpSettings.server,portSmtp:e.connectionSettings.smtpSettings.port,sslSmtp:e.connectionSettings.smtpSettings.ssl?y:E,iCalAccess:e.calendarSettings.enabled&&e.calendarSettings.autoAddEvents?y:E,serviceConfig:b,syncAfterConnection:E,messageMaxAge:parseInt(e.mailSettings.sync.periodValue,10)};return I(I({},s),{},{crmOptions:I({},n)})}));return{mailboxes:i}},enableErrorState:function t(e){this.errorState={enabled:true,errorCnt:e}},toggleLoginColumn:function t(){this.isLoginColumnShown=!this.isLoginColumnShown;if(!this.isLoginColumnShown){this.employees=this.employees.map((function(t){return I(I({},t),{},{login:""})}))}},setAnalyticsSource:function t(e){this.analyticsSource=e},setSmtpStatus:function t(e){this.connectionSettings.smtpSettings.enabled=e},prepareDataForHistory:function t(){return{connectionSettings:this.connectionSettings,mailSettings:this.mailSettings,crmSettings:this.crmSettings,calendarSettings:this.calendarSettings,employees:this.employees.map((function(t){return I(I({},t),{},{password:""})}))}},setPermissions:function t(e){this.permissions.allowedLevels=[e===null||e===void 0?void 0:e.allowedLevels];this.permissions.canEditCrmIntegration=e===null||e===void 0?void 0:e.canEditCrmIntegration}}});var C={props:{totalSteps:{type:Number,required:true},currentStepIndex:{type:Number,required:true}},template:'\n\t\t<div class="mail_massconnect__wizard_progress-bar">\n\t\t\t<div\n\t\t\t\tv-for="(step, index) in totalSteps"\n\t\t\t\t:key="index"\n\t\t\t\tclass="mail_massconnect__wizard_progress-bar__item"\n\t\t\t\t:data-test-id="\'mail_massconnect__wizard_progress-bar__item\' + index"\n\t\t\t\t:class="{ \'mail_massconnect__wizard_progress-bar__item--active\': index <= currentStepIndex }"\n\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\t'};var A={methods:{loc:function t(e){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this.$Bitrix.Loc.getMessage(e,n)}}};var L={components:{UiButton:m.Button},mixins:[A],props:{isFirstStep:Boolean,isLastStep:Boolean,isSubmitting:Boolean,prevDisabled:Boolean,disabledContinueButton:{type:Boolean,default:false}},emits:["prev-step","next-step","submit"],data:function t(){return{AirButtonStyle:m.AirButtonStyle}},template:'\n\t\t<div class="mail_massconnect__wizard_navigation" data-test-id="mail_massconnect__wizard_navigation">\n\t\t\t<UiButton\n\t\t\t\tv-if="isLastStep"\n\t\t\t\tclass="mail_massconnect__wizard_navigation_submit-button"\n\t\t\t\t:text="loc(\'MAIL_MASSCONNECT_FORM_NAVIGATION_PANEL_CONNECT_BUTTON_TITLE\')"\n\t\t\t\t:style="AirButtonStyle.FILLED"\n\t\t\t\t:waiting="isSubmitting"\n\t\t\t\t@click="$emit(\'submit\')"\n\t\t\t/>\n\t\t\t<UiButton\n\t\t\t\tv-else\n\t\t\t\tclass="mail_massconnect__wizard_navigation_next-button"\n\t\t\t\t:text="loc(\'MAIL_MASSCONNECT_FORM_NAVIGATION_PANEL_CONTINUTE_BUTTON_TITLE\')"\n\t\t\t\t:style="AirButtonStyle.FILLED"\n\t\t\t\t:disabled="disabledContinueButton"\n\t\t\t\t@click="$emit(\'next-step\')"\n\t\t\t/>\n\t\t\t<UiButton\n\t\t\t\tv-if="!isFirstStep && !prevDisabled"\n\t\t\t\tclass="mail_massconnect__wizard_navigation_prev-button"\n\t\t\t\t:text="loc(\'MAIL_MASSCONNECT_FORM_NAVIGATION_PANEL_BACK_BUTTON_TITLE\')"\n\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t@click="$emit(\'prev-step\')"\n\t\t\t/>\n\t\t</div>\n\t'};function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var x={components:{BInput:i.BInput},mixins:[A],props:{validationAttempted:{type:Boolean,default:false}},emits:["update:validity"],disableButtonOnInvalid:false,data:function t(){return{InputSize:n.InputSize,InputDesign:n.InputDesign}},computed:w(w({},f.mapState(N,["connectionSettings","analyticsSource"])),{},{isValid:function t(){var e=Boolean(this.connectionSettings.imapServer&&this.connectionSettings.imapPort);if(!this.connectionSettings.smtpSettings.enabled){return e}var n=this.connectionSettings.smtpSettings.server;var i=this.connectionSettings.smtpSettings.port;var r=Boolean(n||i);if(!r){return e}var o=Boolean(n&&i);return e&&o},showErrors:function t(){return this.validationAttempted},imapServerError:function t(){return this.showErrors&&!this.connectionSettings.imapServer?this.loc("MAIL_MASSCONNECT_FORM_CONNECTION_DATA_IMAP_INPUT_ERROR"):null},imapPortError:function t(){return this.showErrors&&!this.connectionSettings.imapPort?this.loc("MAIL_MASSCONNECT_FORM_CONNECTION_DATA_IMAP_PORTS_INPUT_ERROR"):null},smtpServerError:function t(){if(!this.showErrors||!this.connectionSettings.smtpSettings.enabled){return null}var e=this.connectionSettings.smtpSettings.server;var n=this.connectionSettings.smtpSettings.port;if(n&&!e){return this.loc("MAIL_MASSCONNECT_FORM_CONNECTION_DATA_SMTP_INPUT_ERROR")}return null},smtpPortError:function t(){if(!this.showErrors||!this.connectionSettings.smtpSettings.enabled){return null}var e=this.connectionSettings.smtpSettings.server;var n=this.connectionSettings.smtpSettings.port;if(e&&!n){return this.loc("MAIL_MASSCONNECT_FORM_CONNECTION_DATA_SMTP_PORTS_INPUT_ERROR")}return null}}),watch:{isValid:{handler:function t(e){this.$emit("update:validity",e)},immediate:true}},methods:{onStepComplete:function t(){h.sendData({tool:"mail",event:"mailbox_mass_step1",category:"mail_mass_ops",c_section:this.analyticsSource})},handleImapPortInput:function t(e){this.connectionSettings.imapPort=this.getSanitizedValue(e)},handleSmtpPortInput:function t(e){this.connectionSettings.smtpSettings.port=this.getSanitizedValue(e)},getSanitizedValue:function t(e){return String(e!==null&&e!==void 0?e:"").replaceAll(/\D/g,"")}},template:'\n\t\t<div class="mail_massconnect__connection-data_form" data-test-id="mail_massconnect__connection-data_form">\n\t\t\t<div class="mail_massconnect__section-title_container">\n\t\t\t\t<span class="mail_massconnect__section-title">\n\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_CARD_TITLE_MSGVER_1\') }}\n\t\t\t\t</span>\n\t\t\t\t<span class="mail_massconnect__section-description">\n\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_CARD_DESCRIPTION\') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\n\t\t\t<div v-if="false" data-test-id="mail_massconnect__connection-data_domain-group">\n\t\t\t\t<BInput\n\t\t\t\t\tclass="mail_massconnect__group"\n\t\t\t\t\t:label="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_DOMAIN_INPUT_LABEL\')"\n\t\t\t\t\t:placeholder="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_DOMAIN_INPUT_PLACEHOLDER\')"\n\t\t\t\t\t:size="InputSize.Lg"\n\t\t\t\t\t:design="InputDesign.Grey"\n\t\t\t\t\tv-model="connectionSettings.email"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div class="mail_massconnect__connection-block">\n\t\t\t\t<div class="mail_massconnect__input-group" data-test-id="mail_massconnect__connection-data_imap-group">\n\t\t\t\t\t<BInput\n\t\t\t\t\t\tclass="mail_massconnect__input-group_main"\n\t\t\t\t\t\t:label="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_IMAP_INPUT_LABEL\')"\n\t\t\t\t\t\t:placeholder="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_IMAP_INPUT_PLACEHOLDER\')"\n\t\t\t\t\t\t:size="InputSize.Lg"\n\t\t\t\t\t\t:design="InputDesign.DEFAULT"\n\t\t\t\t\t\tv-model="connectionSettings.imapServer"\n\t\t\t\t\t\t:error="imapServerError"\n\t\t\t\t\t/>\n\t\t\t\t\t<BInput\n\t\t\t\t\t\tclass="mail_massconnect__input-group_port"\n\t\t\t\t\t\t:label="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_IMAP_PORTS_INPUT_LABEL\')"\n\t\t\t\t\t\t:placeholder="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_IMAP_PORTS_INPUT_PLACEHOLDER\')"\n\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t:size="InputSize.Lg"\n\t\t\t\t\t\t:design="InputDesign.DEFAULT"\n\t\t\t\t\t\tv-model="connectionSettings.imapPort"\n\t\t\t\t\t\t:error="imapPortError"\n\t\t\t\t\t\t@input="handleImapPortInput(connectionSettings.imapPort)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="mail_massconnect__connection-data_checkbox-group">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\tid="mail_massconnect__imap-ssl"\n\t\t\t\t\t\tclass="mail_massconnect__checkbox"\n\t\t\t\t\t\tv-model="connectionSettings.imapSsl"\n\t\t\t\t\t\tdata-test-id="mail_massconnect__connection-data_imap-ssl-checkbox"\n\t\t\t\t\t/>\n\t\t\t\t\t<label for="mail_massconnect__imap-ssl">\n\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_IMAP_SSL_INPUT_LABEL\') }}\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div \n\t\t\t\tv-if="connectionSettings.smtpSettings.enabled"\n\t\t\t\tclass="mail_massconnect__connection-block"\n\t\t\t>\n\t\t\t\t<div class="mail_massconnect__input-group" data-test-id="mail_massconnect__connection-data_smtp-group">\n\t\t\t\t\t<BInput\n\t\t\t\t\t\tclass="mail_massconnect__input-group_main"\n\t\t\t\t\t\t:label="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_SMTP_INPUT_LABEL\')"\n\t\t\t\t\t\t:placeholder="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_SMTP_INPUT_PLACEHOLDER\')"\n\t\t\t\t\t\t:size="InputSize.Lg"\n\t\t\t\t\t\t:design="InputDesign.DEFAULT"\n\t\t\t\t\t\tv-model="connectionSettings.smtpSettings.server"\n\t\t\t\t\t\t:error="smtpServerError"\n\t\t\t\t\t/>\n\t\t\t\t\t<BInput\n\t\t\t\t\t\tclass="mail_massconnect__input-group_port"\n\t\t\t\t\t\t:label="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_SMTP_PORTS_INPUT_LABEL\')"\n\t\t\t\t\t\t:placeholder="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_SMTP_PORTS_INPUT_PLACEHOLDER\')"\n\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t:size="InputSize.Lg"\n\t\t\t\t\t\t:design="InputDesign.DEFAULT"\n\t\t\t\t\t\tv-model="connectionSettings.smtpSettings.port"\n\t\t\t\t\t\t:error="smtpPortError"\n\t\t\t\t\t\t@input="handleSmtpPortInput(connectionSettings.smtpSettings.port)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="mail_massconnect__connection-data_checkbox-group">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\tid="mail_massconnect__smtp-ssl"\n\t\t\t\t\t\tclass="mail_massconnect__checkbox"\n\t\t\t\t\t\tv-model="connectionSettings.smtpSettings.ssl"\n\t\t\t\t\t\tdata-test-id="mail_massconnect__connection-data_smtp-ssl-checkbox"\n\t\t\t\t\t/>\n\t\t\t\t\t<label for="mail_massconnect__smtp-ssl">\n\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_SMTP_SSL_INPUT_LABEL\') }}\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};function R(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */R=function e(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function t(e,n,i){return e[n]=i}}function l(t,e,n,r){var o=e&&e.prototype instanceof d?e:d,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:y(t,n,s)}),a}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var _={};function d(){}function p(){}function m(){}var f={};c(f,o,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(N([])));v&&v!==e&&n.call(v,o)&&(f=v);var S=m.prototype=d.prototype=Object.create(f);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,_=l.value;return _&&"object"==babelHelpers["typeof"](_)&&n.call(_,"__await")?e.resolve(_.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(_).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function t(n,i){function a(){return new e((function(t,e){r(n,i,t,e)}))}return o=o?o.then(a,a):a()}})}function y(t,e,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return C()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===_)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var c=u(t,e,n);if("normal"===c.type){if(i=n.done?"completed":"suspendedYield",c.arg===_)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i="completed",n.method="throw",n.arg=c.arg)}}}function E(t,e){var n=e.method,i=t.iterator[n];if(undefined===i)return e.delegate=null,"throw"===n&&t.iterator["return"]&&(e.method="return",e.arg=undefined,E(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),_;var r=u(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,_;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=undefined),e.delegate=null,_):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,_)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function N(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=undefined,e.done=!0,e};return r.next=r}}return{next:C}}function C(){return{value:undefined,done:!0}}return p.prototype=m,i(S,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:p,configurable:!0}),p.displayName=c(m,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,c(t,s,"GeneratorFunction")),t.prototype=Object.create(S),t},t.awrap=function(t){return{__await:t}},g(O.prototype),c(O.prototype,a,(function(){return this})),t.AsyncIterator=O,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var a=new O(l(e,n,i,r),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(S),c(S,s,"Generator"),c(S,o,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},t.values=N,I.prototype={constructor:I,reset:function t(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(T),!e)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=undefined)},stop:function t(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function t(e){if(this.done)throw e;var i=this;function r(t,n){return s.type="throw",s.arg=e,i.next=t,n&&(i.method="next",i.arg=undefined),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function t(e,i){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=i&&i<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=i,a?(this.method="next",this.next=a.finallyLoc,_):this.complete(s)},complete:function t(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),_},finish:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),T(i),_}},catch:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var o=r.arg;T(i)}return o}}throw new Error("illegal catch attempt")},delegateYield:function t(e,n,i){return this.delegate={iterator:N(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=undefined),_}},t}var P={connectMailbox:function(){var t=babelHelpers.asyncToGenerator(R().mark((function t(e,n){return R().wrap((function t(i){while(1)switch(i.prev=i.next){case 0:return i.abrupt("return",BX.ajax.runAction("mail.mailboxconnecting.connectMailboxFromMassconnect",{data:{mailbox:e,massConnectId:n}}));case 1:case"end":return i.stop()}}),t)})));function e(e,n){return t.apply(this,arguments)}return e}(),saveMailboxConnectionData:function(){var t=babelHelpers.asyncToGenerator(R().mark((function t(e){return R().wrap((function t(n){while(1)switch(n.prev=n.next){case 0:return n.abrupt("return",BX.ajax.runAction("mail.mailboxconnecting.saveMassConnectData",{data:{massConnectData:e}}));case 1:case"end":return n.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}(),getDepartmentsUsers:function(){var t=babelHelpers.asyncToGenerator(R().mark((function t(e){return R().wrap((function t(n){while(1)switch(n.prev=n.next){case 0:return n.abrupt("return",BX.ajax.runAction("mail.mailboxconnecting.getDepartmentUsers",{data:{departmentIds:e}}));case 1:case"end":return n.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()};function D(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function B(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?D(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var F={components:{UiButton:m.Button,BIcon:s.BIcon},mixins:[A],props:{isLoginColumnShown:{type:Boolean,default:true},employees:{type:Array,required:true},readonlyMode:{type:Boolean,default:false}},data:function t(){return{AirButtonStyle:m.AirButtonStyle}},computed:{outline:function t(){return s.Outline}},methods:B({},f.mapActions(N,["removeEmployeeById"])),template:'\n\t\t<div \n\t\t\tclass="mail_massconnect__employee-list_table" \n\t\t\t:class="{ \'--login-hidden\': !isLoginColumnShown }"\n\t\t\tdata-test-id="mail_massconnect__employee-list_table"\n\t\t>\n\t\t\t<div class="mail_massconnect__employee-list_table_header">\n\t\t\t\t<div class="mail_massconnect__employee-list_table_cell --name">\n\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_TABLE_NAME_COLUMN_TITLE\') }}\n\t\t\t\t</div>\n\t\t\t\t<div class="mail_massconnect__employee-list_table_cell --email">\n\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_TABLE_EMAIL_COLUMN_TITLE\') }}\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tv-if="isLoginColumnShown" \n\t\t\t\t\tclass="mail_massconnect__employee-list_table_cell --login"\n\t\t\t\t\tdata-test-id="mail_massconnect__employee-list_table_login-header"\n\t\t\t\t>\n\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_TABLE_LOGIN_COLUMN_TITLE\') }}\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tv-if="!readonlyMode" \n\t\t\t\t\tclass="mail_massconnect__employee-list_table_cell --password"\n\t\t\t\t\tdata-test-id="mail_massconnect__employee-list_table_password-header"\n\t\t\t\t>\n\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_TABLE_PASSWORD_COLUMN_TITLE\') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-for="(employee, index) in employees"\n\t\t\t\t:key="employee.id"\n\t\t\t\tclass="mail_massconnect__employee-list_table_row"\n\t\t\t\t:data-test-id="\'mail_massconnect__employee-list_table_row-\' + index"\n\t\t\t>\n\t\t\t\t<div class="mail_massconnect__employee-list_table_cell --name">\n\t\t\t\t\t<div class="mail_massconnect__employee-list_table_employee-info">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tclass="mail_massconnect__employee-list_table_employee-avatar"\n\t\t\t\t\t\t\t:src="encodeURI(employee.avatar)"\n\t\t\t\t\t\t\talt=""\n\t\t\t\t\t\t\t:data-test-id="\'mail_massconnect__employee-list_table_row-\' + index + \'_avatar\'"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span \n\t\t\t\t\t\t\tclass="mail_massconnect__employee-list_table_employee-name"\n\t\t\t\t\t\t\t:data-test-id="\'mail_massconnect__employee-list_table_row-\' + index + \'_name\'"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ employee.name }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="mail_massconnect__employee-list_table_delete-btn-container"\n\t\t\t\t\t\t\t:data-test-id="\'mail_massconnect__employee-list_table_row-\' + index + \'_delete-btn-container\'"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t\tv-if="!readonlyMode"\n\t\t\t\t\t\t\t\t:style="AirButtonStyle.OUTLINE"\n\t\t\t\t\t\t\t\t:leftIcon="outline.CROSS_M"\n\t\t\t\t\t\t\t\tclass="mail_massconnect__employee-list_table_delete-employee"\n\t\t\t\t\t\t\t\t@click="removeEmployeeById(employee.id)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="mail_massconnect__employee-list_table_cell --email">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="email"\n\t\t\t\t\t\tclass="mail_massconnect__employee-list_table_input"\n\t\t\t\t\t\tv-model="employee.email"\n\t\t\t\t\t\t:placeholder="loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_TABLE_EMAIL_COLUMN_PLACEHOLDER\')"\n\t\t\t\t\t\t:readonly="readonlyMode"\n\t\t\t\t\t\t:data-test-id="\'mail_massconnect__employee-list_table_row-\' + index + \'_email-input\'"\n\t\t\t\t\t\t:name="\'mail_massconnect__employee-list_table_row-\' + index + \'_email-input\'"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="mail_massconnect__employee-list_table_cell --login">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tclass="mail_massconnect__employee-list_table_input"\n\t\t\t\t\t\tv-model="employee.login"\n\t\t\t\t\t\t:placeholder="loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_TABLE_LOGIN_COLUMN_PLACEHOLDER\')"\n\t\t\t\t\t\t:readonly="readonlyMode"\n\t\t\t\t\t\t:data-test-id="\'mail_massconnect__employee-list_table_row-\' + index + \'_login-input\'"\n\t\t\t\t\t\t:name="\'mail_massconnect__employee-list_table_row-\' + index + \'_password-input\'"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="!readonlyMode" class="mail_massconnect__employee-list_table_cell --password">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="password"\n\t\t\t\t\t\tclass="mail_massconnect__employee-list_table_input"\n\t\t\t\t\t\tv-model="employee.password"\n\t\t\t\t\t\t:placeholder="loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_TABLE_PASSWORD_COLUMN_PLACEHOLDER\')"\n\t\t\t\t\t\t:data-test-id="\'mail_massconnect__employee-list_table_row-\' + index + \'_password-input\'"\n\t\t\t\t\t\t:name="\'mail_massconnect__employee-list_table_row-\' + index + \'_password-input\'"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};function k(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */k=function e(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function t(e,n,i){return e[n]=i}}function l(t,e,n,r){var o=e&&e.prototype instanceof d?e:d,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:y(t,n,s)}),a}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var _={};function d(){}function p(){}function m(){}var f={};c(f,o,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(N([])));v&&v!==e&&n.call(v,o)&&(f=v);var S=m.prototype=d.prototype=Object.create(f);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,_=l.value;return _&&"object"==babelHelpers["typeof"](_)&&n.call(_,"__await")?e.resolve(_.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(_).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function t(n,i){function a(){return new e((function(t,e){r(n,i,t,e)}))}return o=o?o.then(a,a):a()}})}function y(t,e,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return C()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===_)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var c=u(t,e,n);if("normal"===c.type){if(i=n.done?"completed":"suspendedYield",c.arg===_)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i="completed",n.method="throw",n.arg=c.arg)}}}function E(t,e){var n=e.method,i=t.iterator[n];if(undefined===i)return e.delegate=null,"throw"===n&&t.iterator["return"]&&(e.method="return",e.arg=undefined,E(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),_;var r=u(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,_;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=undefined),e.delegate=null,_):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,_)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function N(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=undefined,e.done=!0,e};return r.next=r}}return{next:C}}function C(){return{value:undefined,done:!0}}return p.prototype=m,i(S,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:p,configurable:!0}),p.displayName=c(m,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,c(t,s,"GeneratorFunction")),t.prototype=Object.create(S),t},t.awrap=function(t){return{__await:t}},g(O.prototype),c(O.prototype,a,(function(){return this})),t.AsyncIterator=O,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var a=new O(l(e,n,i,r),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(S),c(S,s,"Generator"),c(S,o,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},t.values=N,I.prototype={constructor:I,reset:function t(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(T),!e)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=undefined)},stop:function t(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function t(e){if(this.done)throw e;var i=this;function r(t,n){return s.type="throw",s.arg=e,i.next=t,n&&(i.method="next",i.arg=undefined),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function t(e,i){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=i&&i<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=i,a?(this.method="next",this.next=a.finallyLoc,_):this.complete(s)},complete:function t(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),_},finish:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),T(i),_}},catch:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var o=r.arg;T(i)}return o}}throw new Error("illegal catch attempt")},delegateYield:function t(e,n,i){return this.delegate={iterator:N(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=undefined),_}},t}function G(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function j(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?G(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var U={components:{UiButton:m.Button,BIcon:s.BIcon,BMenu:o.BMenu,EmployeeListTable:F},mixins:[A],emits:["update:validity"],data:function t(){return{AirButtonStyle:m.AirButtonStyle,actionsMenuActive:false,showAddedEmployees:false}},computed:j(j({},f.mapState(N,["employees","errorState","addedEmployees","isLoginColumnShown","analyticsSource","permissions"])),{},{set:function t(){return s.Set},outline:function t(){return s.Outline},isEmployeeListEmpty:function t(){return this.employees.length===0},isValid:function t(){return!this.isEmployeeListEmpty},menuOptions:function t(){var e=this;return{bindElement:this.$refs.actionsMenuActiveRef,items:[{title:this.isLoginColumnShown?this.loc("MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_CARD_ACTIONS_LOGIN_HIDE"):this.loc("MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_CARD_ACTIONS_LOGIN_SHOW"),icon:this.isLoginColumnShown?this.set.CROSSED_EYE_2:this.set.OPENED_EYE,onClick:function t(){e.toggleLoginColumn()}},{title:this.loc("MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_CARD_ACTIONS_DELETE_ALL"),icon:s.Outline.TRASHCAN,onClick:function t(){e.actionsMenuActive=false;e.clearEmployees();e.employeeDialog.deselectAll()}}]}},isFixingErrorsHintText:function t(){return p.Loc.getMessagePlural("MAIL_MASSCONNECT_FORM_UTILITY_BLOCK_IS_FIXING_ERRORS_HINT",this.errorState.errorCnt,{"#ERROR_CNT#":this.errorState.errorCnt})},helpDescLink:function t(){return null}}),watch:{isValid:{handler:function t(e){this.$emit("update:validity",e)},immediate:true}},created:function t(){this.employeeDialog=this.getEmployeeDialog()},methods:j(j({},f.mapActions(N,["setEmployees","toggleLoginColumn","addEmployee","clearEmployees"])),{},{onStepComplete:function t(){h.sendData({tool:"mail",event:"mailbox_mass_step2",category:"mail_mass_ops",c_section:this.analyticsSource})},getEmployeeDialog:function t(){var e=this;var n=new a.SaveButton({useAirDesign:true,text:this.loc("MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_CARD_DIALOG_ADD_BUTTON_TEXT"),onclick:function(){var t=babelHelpers.asyncToGenerator(k().mark((function t(n){return k().wrap((function t(i){while(1)switch(i.prev=i.next){case 0:n.setWaiting(true);i.next=3;return e.handleSaveItems(e.employeeDialog.getSelectedItems());case 3:n.setWaiting(false);case 4:case"end":return i.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()});var i=new a.CancelButton({useAirDesign:true,style:m.AirButtonStyle.OUTLINE,onclick:function t(){e.employeeDialog.hide()}});return new u.Dialog({width:420,height:400,multiple:true,showAvatars:true,enableSearch:true,context:"MAIL_MASSCONNECT_EMPLOYEES",entities:[{id:"structure-node",options:{selectMode:"usersAndDepartments",forSearch:true,allowSelectRootDepartment:true,restricted:"view",allowedPermissionLevels:this.permissions.allowedLevels}}],events:{onDestroy:function t(){e.employeeDialog=e.getEmployeeDialog()}},footer:[n.render(),i.render()],footerOptions:{containerStyles:{display:"flex","justify-content":"center",gap:"12px","background-color":"var(--ui-color-palette-white-base)"}}})},openEmployeeSelector:function t(){var e=this.$refs.addButton.button.getContainer();this.employeeDialog.setTargetNode(e);if(!this.employeeDialog.isOpen()){this.employeeDialog.setPreselectedItems(this.employees.map((function(t){return["user",t.id]})));this.employeeDialog.show()}},handleSaveItems:function t(e){var n=this;return babelHelpers.asyncToGenerator(k().mark((function t(){var i,o,a,s,c;return k().wrap((function t(l){while(1)switch(l.prev=l.next){case 0:i=[];o=[];e.forEach((function(t){if(t.entityId==="user"){i.push({id:t.getId(),entityId:"user",name:t.getTitle(),avatar:t.getAvatar(),email:"",login:"",password:""})}else if(t.entityId==="structure-node"){o.push(t.id)}}));a=[];l.prev=4;if(!(o.length>0)){l.next=10;break}l.next=8;return P.getDepartmentsUsers(o);case 8:c=l.sent;a=(s=c.data)===null||s===void 0?void 0:s.map((function(t){return{id:t.id,entityId:"user",name:t.name,avatar:t.avatar===null||t.avatar===""?n.employeeDialog.getEntity("user").getItemOption("avatar","user"):t.avatar,email:"",login:"",password:""}}));case 10:l.next=16;break;case 12:l.prev=12;l.t0=l["catch"](4);r.UI.Notification.Center.notify({content:n.loc("MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_CARD_SELECTOR_ADD_ERROR")});return l.abrupt("return");case 16:[].concat(i,babelHelpers.toConsumableArray(a)).forEach((function(t){return n.addEmployee(t)}));n.employeeDialog.deselectAll();n.employeeDialog.hide();case 19:case"end":return l.stop()}}),t,null,[[4,12]])})))()}}),template:'\n\t\t<div class="mail_massconnect__select-employees_form">\n\t\t\t<div class="mail_massconnect__employee-list_header">\n\t\t\t\t<div class="mail_massconnect__section-title_container">\n\t\t\t\t\t<span class="mail_massconnect__section-title">\n\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_CARD_TITLE\') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span v-if="!errorState.enabled" class="mail_massconnect__section-description">\n\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_CARD_DESCRIPTION\') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tv-show="!errorState.enabled" \n\t\t\t\t\tclass="mail_massconnect__employee-list_header_buttons"\n\t\t\t\t\tdata-test-id="mail_massconnect__employee-list_header_buttons"\n\t\t\t\t>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\tref="addButton"\n\t\t\t\t\t\t:text="loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_CARD_ADD_BUTTON_TITLE\')"\n\t\t\t\t\t\t:leftIcon="set.PLUS_IN_CIRCLE"\n\t\t\t\t\t\t:style="AirButtonStyle.TINTED"\n\t\t\t\t\t\t@click="openEmployeeSelector"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div v-show="!isEmployeeListEmpty" class="mail_massconnect__employee-list_container">\n\t\t\t\t<div \n\t\t\t\t\tv-if="errorState.enabled" \n\t\t\t\t\tclass="mail_massconnect__fixing-errors-hint_container"\n\t\t\t\t\tdata-test-id="mail_massconnect__fixing-errors-hint_container"\n\t\t\t\t>\n\t\t\t\t\t<div class="mail_massconnect__fixing-errors-hint_image"/>\n\t\t\t\t\t<div class="mail_massconnect__fixing-errors-hint_text">\n\t\t\t\t\t\t{{ isFixingErrorsHintText }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="helpDescLink" class="mail_massconnect__fixing-errors-hint_link">\n\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_UTILITY_BLOCK_IS_FIXING_ERRORS_LINK\') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tv-else \n\t\t\t\t\tclass="mail_massconnect__utility-block_container"\n\t\t\t\t\tdata-test-id="mail_massconnect__utility-block_container"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="mail_massconnect__employee-list_info_actions"\n\t\t\t\t\t\t@click="actionsMenuActive = true"\n\t\t\t\t\t\tref="actionsMenuActiveRef"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_CARD_ACTIONS_TITLE\') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="mail_massconnect__employee-list_info_actions-icon">\n\t\t\t\t\t\t<BIcon :name="outline.CHEVRON_DOWN_L"\n\t\t\t\t\t\t\t@click="actionsMenuActive = true"\n\t\t\t\t\t\t\t:size="18"\n\t\t\t\t\t\t\tcolor="var(--ui-color-palette-gray-50)"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</BIcon>\n\t\t\t\t\t</div>\n\t\t\t\t\t<BMenu v-if="actionsMenuActive" :options="menuOptions" @close="actionsMenuActive = false"/>\n\t\t\t\t</div>\n\t\t\t\t<EmployeeListTable\n\t\t\t\t\t:isLoginColumnShown="isLoginColumnShown"\n\t\t\t\t\t:employees="employees"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tv-if="addedEmployees.length > 0" \n\t\t\t\tclass="mail_massconnect__employee-list_added-employees_container"\n\t\t\t\tdata-test-id="mail_massconnect__employee-list_added-employees_container"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass="mail_massconnect__employee-list_added-employees_show-button"\n\t\t\t\t\tdata-test-id="mail_massconnect__employee-list_added-employees_show-button"\n\t\t\t\t\t@click="showAddedEmployees = !showAddedEmployees"\n\t\t\t\t>\n\t\t\t\t\t<div class="mail_massconnect__employee-list_added-employees_show-button-text">\n\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_EMPLOYEE_CARD_SHOW_ADDED_TITLE\') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="mail_massconnect__employee-list_added-employees_show-button-icon">\n\t\t\t\t\t\t<BIcon :name="outline.CHEVRON_DOWN_L"\n\t\t\t\t\t\t\t@click="actionsMenuActive = true"\n\t\t\t\t\t\t\t:size="18"\n\t\t\t\t\t\t\tcolor="var(--ui-color-palette-gray-50)"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</BIcon>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<EmployeeListTable\n\t\t\t\t\tv-if="showAddedEmployees"\n\t\t\t\t\t:isLoginColumnShown="isLoginColumnShown"\n\t\t\t\t\t:employees="addedEmployees"\n\t\t\t\t\t:readonlyMode="true"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t'};var H={methods:{prepareOptionPhrases:function t(e){return e.map((function(t){return{label:p.Loc.getMessage(t.labelKey),value:t.value}}))}}};var V={methods:{preparedIndirectPhrase:function t(e,n){var i=this.$Bitrix.Loc.getMessage(e);var r=i.split(n);return{beforeText:r[0]||null,afterText:r[1]||null}}}};var X={props:{modelValue:{type:[String,Number],required:true},options:{type:Array,required:true},dialogOptions:{type:Object,required:false,default:null}},emits:["update:modelValue"],selectorInstance:null,itemOnSelectHandler:null,watch:{modelValue:function t(e){if(this.selectorInstance&&e!==this.selectorInstance.getSelected()){this.selectorInstance.select(e)}}},mounted:function t(){var e=this;var n=new Map;this.options.forEach((function(t){n.set(t.value,t.label)}));var i={settingsMap:Object.fromEntries(n),selectedOptionKey:this.modelValue};if(this.dialogOptions){i.dialogOptions=this.dialogOptions}this.selectorInstance=new c.SettingSelector(i);this.itemOnSelectHandler=function(t){var n=t.getData(),i=n.item;e.$emit("update:modelValue",i.getId())};if(this.selectorInstance.settingDialog){this.selectorInstance.settingDialog.subscribe("Item:onSelect",this.itemOnSelectHandler)}this.selectorInstance.renderTo(this.$el)},beforeUnmount:function t(){if(this.selectorInstance.settingDialog){this.selectorInstance.settingDialog.unsubscribe("Item:onSelect",this.itemOnSelectHandler)}if(this.selectorInstance&&this.selectorInstance.settingDialog){this.selectorInstance.settingDialog.destroy()}},template:"<div></div>"};var z={syncPeriodOptions:[{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_MAIL_INTEGRATION_OPTION_SYNC_PERIOD_DAY",value:v.DAY},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_MAIL_INTEGRATION_OPTION_SYNC_PERIOD_WEEK",value:v.WEEK},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_MAIL_INTEGRATION_OPTION_SYNC_PERIOD_MONTH",value:v.MONTH},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_MAIL_INTEGRATION_OPTION_SYNC_PERIOD_TWO_MONTHS",value:v.TWO_MONTHS},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_MAIL_INTEGRATION_OPTION_SYNC_PERIOD_THREE_MONTHS",value:v.THREE_MONTHS}]};var K={name:"mail-integration",components:{BitrixSettingSelector:X},mixins:[A,H,V],props:{modelValue:{type:Object,required:true}},emits:["update:modelValue"],computed:{localModelValue:{get:function t(){return this.modelValue},set:function t(e){this.$emit("update:modelValue",e)}},syncLabel:function t(){return this.preparedIndirectPhrase("MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_MAIL_SYNC_LABEL","#PERIOD#")},syncPeriodOptions:function t(){return this.prepareOptionPhrases(z.syncPeriodOptions)}},template:'\n\t\t<div class="mail_massconnect__integration-block">\n\t\t\t<div class="mail_massconnect__integration-block_header">\n\t\t\t\t<div class="mail_massconnect__integration-block_title_group">\n\t\t\t\t\t<div class="mail_massconnect__integration-block_icon --mail"></div>\n\t\t\t\t\t<span class="mail_massconnect__integration-block_title">\n\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_INTEGRATION_MAIL_TITLE\') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="mail_massconnect__integration-block_content-wrapper">\n\t\t\t\t<div class="mail_massconnect__integration-block_content">\n\t\t\t\t\t<div class="mail_massconnect__checkbox-group">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\tid="mail_massconnect__mail-sync"\n\t\t\t\t\t\t\tv-model="localModelValue.sync.enabled"\n\t\t\t\t\t\t\tdata-test-id="mail_massconnect__mail-sync_checkbox"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="mail_massconnect__indirect-label" \n\t\t\t\t\t\t\tdata-test-id="mail_massconnect__mail-sync_label"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<label for="mail_massconnect__mail-sync">\n\t\t\t\t\t\t\t\t<span class="mail_massconnect__label-text_before">\n\t\t\t\t\t\t\t\t\t{{ syncLabel.beforeText }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t<BitrixSettingSelector\n\t\t\t\t\t\t\t\tv-model="localModelValue.sync.periodValue"\n\t\t\t\t\t\t\t\t:options="syncPeriodOptions"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<label for="mail_massconnect__mail-sync">\n\t\t\t\t\t\t\t\t<span class="mail_massconnect__label-text_after">\n\t\t\t\t\t\t\t\t\t{{ syncLabel.afterText }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var W={props:{modelValue:{type:Array,default:function t(){return[]}}},emits:["update:modelValue"],selectorInstance:null,targetNode:null,watch:{modelValue:function t(e){var n=this;if(!this.selectorInstance){return}var i=new Set(e.map((function(t){return"".concat(t.entityId,":").concat(t.id)})));var r=this.selectorInstance.getTags();var o=new Set(r.map((function(t){return"".concat(t.getEntityId(),":").concat(t.getId())})));r.forEach((function(t){var e="".concat(t.getEntityId(),":").concat(t.getId());if(!i.has(e)){n.selectorInstance.removeTag(t)}}));e.forEach((function(t){var e="".concat(t.entityId,":").concat(t.id);if(!o.has(e)){n.selectorInstance.addTag({id:t.id,entityId:t.entityId,title:t.name})}}))}},mounted:function t(){this.selectorInstance=new u.TagSelector({dialogOptions:{width:425,height:320,multiple:true,context:"MAIL_CRM_QUEUE",preselectedItems:this.modelValue.map((function(t){return[t.entityId,t.id]})),entities:[{id:"user",options:{intranetUsersOnly:true,emailUsers:false,inviteEmployeeLink:false}},{id:"department",options:{selectMode:"departmentsOnly"}}]},events:{onAfterTagAdd:this.onUpdate,onAfterTagRemove:this.onUpdate}});this.selectorInstance.renderTo(this.$el)},beforeUnmount:function t(){var e=this.selectorInstance.getDialog();if(e){e.destroy()}},methods:{onUpdate:function t(){var e=this.selectorInstance.getTags().map((function(t){return{id:t.getId(),entityId:t.getEntityId(),name:t.getTitle()}}));this.$emit("update:modelValue",e)}},template:"<div></div>"};var Y={syncPeriodOptions:[{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SYNC_PERIOD_WEEK",value:S.WEEK},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SYNC_PERIOD_MONTH",value:S.MONTH},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SYNC_PERIOD_ALL_TIME",value:S.ALL_TIME}],createActionOptions:[{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_CREATE_ACTION_LEAD",value:g.LEAD},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_CREATE_ACTION_CONTACT",value:g.CONTACT}],sourceOptions:[{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_CALL",value:O.CALL},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_EMAIL",value:O.EMAIL},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_WEB",value:O.WEB},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_ADVERTISING",value:O.ADVERTISING},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_PARTNER",value:O.PARTNER},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_RECOMMENDATION",value:O.RECOMMENDATION},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_TRADE_SHOW",value:O.TRADE_SHOW},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_WEBFORM",value:O.WEBFORM},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_CALLBACK",value:O.CALLBACK},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_RC_GENERATOR",value:O.RC_GENERATOR},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_STORE",value:O.STORE},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_OTHER",value:O.OTHER},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_BOOKING",value:O.BOOKING},{labelKey:"MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CRM_INTEGRATION_OPTION_SOURCE_REPEAT_SALE",value:O.REPEAT_SALE}],crmLeadSourceDialogOptions:{width:300,height:300,enableSearch:true}};var $={name:"crm-integration",directives:{hint:l.hint},components:{Switcher:_.Switcher,BitrixSettingSelector:X,UserSelector:W},mixins:[A,H,V],props:{modelValue:{type:Object,required:true},canEditCrmIntegration:{type:Boolean,default:false}},emits:["update:modelValue"],data:function t(){return{showAddressTextarea:false,crmLeadSourceDialogOptions:Y.crmLeadSourceDialogOptions}},computed:{localModelValue:{get:function t(){return this.modelValue},set:function t(e){this.$emit("update:modelValue",e)}},syncLabel:function t(){return this.preparedIndirectPhrase("MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_SYNC_LABEL","#PERIOD#")},incomingLabel:function t(){return this.preparedIndirectPhrase("MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_INCOMING_LABEL","#INCOMING#")},outgoingLabel:function t(){return this.preparedIndirectPhrase("MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_OUTGOING_LABEL","#OUTGOING#")},leadSourceIncomingLabel:function t(){return this.preparedIndirectPhrase("MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_SOURCE_INCOMING_CURRENT_LABEL","#INCOMING_CURRENT#")},syncPeriodOptions:function t(){return this.prepareOptionPhrases(Y.syncPeriodOptions)},createActionOptions:function t(){return this.prepareOptionPhrases(Y.createActionOptions)},sourceOptions:function t(){return this.prepareOptionPhrases(Y.sourceOptions)},switcherOptions:function t(){return{size:d.SwitcherSize.large,showStateTitle:false,useAirDesign:true}},noAccessHintParams:function t(){return{text:this.loc("MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_INTEGRATION_CRM_NO_ACCESS_HINT"),popupOptions:{className:"mail_massconnect-hint",darkMode:false,offsetTop:2,background:"var(--ui-color-bg-content-inapp)",padding:6,angle:true,targetContainer:document.body,offsetLeft:20}}}},methods:{handleSwitcherClick:function t(){if(this.canEditCrmIntegration){this.localModelValue.enabled=!this.localModelValue.enabled}}},template:'\n\t\t<div class="mail_massconnect__integration-block" :class="{ \'--disabled\': !localModelValue.enabled }">\n\t\t\t<div \n\t\t\t\tclass="mail_massconnect__integration-block_header"\n\t\t\t\tdata-test-id="mail_massconnect__settings_crmr-integration_header"\n\t\t\t>\n\t\t\t\t<div class="mail_massconnect__integration-block_title_group">\n\t\t\t\t\t<div class="mail_massconnect__integration-block_icon --crm"></div>\n\t\t\t\t\t<span class="mail_massconnect__integration-block_title">\n\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_INTEGRATION_CRM_TITLE\') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="mail_massconnect__integration-block_switcher-container" >\n\t\t\t\t\t<Switcher\n\t\t\t\t\t\t:isChecked="localModelValue.enabled"\n\t\t\t\t\t\t:isDisabled="!canEditCrmIntegration"\n\t\t\t\t\t\t:options="switcherOptions"\n\t\t\t\t\t\tv-hint="!canEditCrmIntegration ? noAccessHintParams : undefined"\n\t\t\t\t\t\t@click="handleSwitcherClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<transition name="mail_massconnect__integration-block_slide-down">\n\t\t\t\t<div v-if="localModelValue.enabled" class="mail_massconnect__integration-block_content-wrapper">\n\t\t\t\t\t<div class="mail_massconnect__integration-block_content">\n\t\t\t\t\t\t<div class="mail_massconnect__checkbox-group">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\tid="mail_massconnect__crm-sync"\n\t\t\t\t\t\t\t\tv-model="localModelValue.sync.enabled"\n\t\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_crm-integration_crm-sync_checkbox"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass="mail_massconnect__indirect-label"\n\t\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_crm-integration_crm-sync_label"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<label for="mail_massconnect__crm-sync">\n\t\t\t\t\t\t\t\t\t<span class="mail_massconnect__label-text_before">\n\t\t\t\t\t\t\t\t\t\t{{ syncLabel.beforeText }}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<BitrixSettingSelector\n\t\t\t\t\t\t\t\t\tv-model="localModelValue.sync.periodValue"\n\t\t\t\t\t\t\t\t\t:options="syncPeriodOptions"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<label for="mail_massconnect__crm-sync">\n\t\t\t\t\t\t\t\t\t<span class="mail_massconnect__label-text_after">\n\t\t\t\t\t\t\t\t\t\t{{ syncLabel.afterText }}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="mail_massconnect__integration-hint">\n\t\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_SYNC_HINT\') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="mail_massconnect__checkbox-group">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\tid="mail_massconnect__assign-known"\n\t\t\t\t\t\t\t\tv-model="localModelValue.assignKnownClientEmails"\n\t\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_crm-integration_assign-known_checkbox"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<label for="mail_massconnect__assign-known">\n\t\t\t\t\t\t\t\t<span class="mail_massconnect__label-text">\n\t\t\t\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_ASSIGN_KNOWN_LABEL\') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="mail_massconnect__checkbox-group">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\tid="mail_massconnect__incoming-new"\n\t\t\t\t\t\t\t\tv-model="localModelValue.incoming.enabled"\n\t\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_crm-integration_incoming-new_checkbox"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass="mail_massconnect__indirect-label"\n\t\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_crm-integration_incoming-new_label"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<label for="mail_massconnect__incoming-new">\n\t\t\t\t\t\t\t\t\t<span class="mail_massconnect__label-text_before">\n\t\t\t\t\t\t\t\t\t\t{{ incomingLabel.beforeText }}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<BitrixSettingSelector\n\t\t\t\t\t\t\t\t\tv-model="localModelValue.incoming.createAction"\n\t\t\t\t\t\t\t\t\t:options="createActionOptions"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<label for="mail_massconnect__incoming-new">\n\t\t\t\t\t\t\t\t\t<span class="mail_massconnect__label-text_after">\n\t\t\t\t\t\t\t\t\t\t{{ incomingLabel.afterText }}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="mail_massconnect__integration-hint">\n\t\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_INCOMING_HINT\') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="mail_massconnect__checkbox-group">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\t\tid="mail_massconnect__outgoing-new"\n\t\t\t\t\t\t\t\tv-model="localModelValue.outgoing.enabled"\n\t\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_crm-integration_outgoing-new_checkbox"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass="mail_massconnect__indirect-label"\n\t\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_crm-integration_outgoing-new_label"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<label for="mail_massconnect__outgoing-new">\n\t\t\t\t\t\t\t\t\t<span class="mail_massconnect__label-text_before">\n\t\t\t\t\t\t\t\t\t\t{{ outgoingLabel.beforeText }}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<BitrixSettingSelector\n\t\t\t\t\t\t\t\t\tv-model="localModelValue.outgoing.createAction"\n\t\t\t\t\t\t\t\t\t:options="createActionOptions"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<label for="mail_massconnect__outgoing-new">\n\t\t\t\t\t\t\t\t\t<span class="mail_massconnect__label-text_after">\n\t\t\t\t\t\t\t\t\t\t{{ outgoingLabel.afterText }}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="mail_massconnect__integration-hint">\n\t\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_OUTGOING_HINT\') }}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="mail_massconnect__group-inline"\n\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_source_group"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="mail_massconnect__group-inline_label">\n\t\t\t\t\t\t\t\t<span class="mail_massconnect__label-text">\n\t\t\t\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_SOURCE_LABEL\') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<BitrixSettingSelector\n\t\t\t\t\t\t\t\tv-model="localModelValue.source"\n\t\t\t\t\t\t\t\t:options="sourceOptions"\n\t\t\t\t\t\t\t\t:dialog-options="crmLeadSourceDialogOptions"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<span class="mail_massconnect__group-inline_label">\n\t\t\t\t\t\t\t<span class="mail_massconnect__label-text_before">\n\t\t\t\t\t\t\t\t{{ leadSourceIncomingLabel.beforeText }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref="#"\n\t\t\t\t\t\t\t\tclass="mail_massconnect__set-textarea-show"\n\t\t\t\t\t\t\t\t@click.prevent="showAddressTextarea = !showAddressTextarea"\n\t\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_show-address-textarea_link"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<span class="mail_massconnect__set-textarea-show_text">\n\t\t\t\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_SOURCE_INCOMING_CURRENT_BUTTON_LABEL\') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="ui-icon-set --chevron-down"\n\t\t\t\t\t\t\t\t\tstyle="--ui-icon-set__icon-size: 16px; --ui-icon-set__icon-color: #6a737f;"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<span class="mail_massconnect__label-text_after">\n\t\t\t\t\t\t\t\t{{ leadSourceIncomingLabel.afterText }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tv-if="showAddressTextarea"\n\t\t\t\t\t\t\tv-model="localModelValue.leadCreationAddresses"\n\t\t\t\t\t\t\tclass="mail_massconnect__control-textarea"\n\t\t\t\t\t\t\t:placeholder="loc(\'MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_SOURCE_INCOMING_CURRENT_PLACEHOLDER\')"\n\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_address-textarea"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t</textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="mail_massconnect__integration-block_content">\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="mail_massconnect__user-selector-group"\n\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_crm-user-queue_group"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="mail_massconnect__group-inline_label">\n\t\t\t\t\t\t\t\t<span class="mail_massconnect__label_user-selector_text">\n\t\t\t\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_SELECT_MAILBOX_SETTINGS_CRM_QUEUE_LABEL\') }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<UserSelector\n\t\t\t\t\t\t\t\tv-model="localModelValue.responsibleQueue"\n\t\t\t\t\t\t\t\tclass="mail_massconnect__control-user-selector"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t</div>\n\t'};var q={name:"calendar-integration",components:{Switcher:_.Switcher},mixins:[A],props:{modelValue:{type:Object,required:true}},emits:["update:modelValue"],computed:{localModelValue:{get:function t(){return this.modelValue},set:function t(e){this.$emit("update:modelValue",e)}},switcherOptions:function t(){return{size:d.SwitcherSize.large,showStateTitle:false,useAirDesign:true}}},template:'\n\t\t<div class="mail_massconnect__integration-block" :class="{ \'--disabled\': !localModelValue.enabled }">\n\t\t\t<div \n\t\t\t\tclass="mail_massconnect__integration-block_header"\n\t\t\t\tdata-test-id="mail_massconnect__settings_calendar-integration_header"\n\t\t\t>\n\t\t\t\t<div class="mail_massconnect__integration-block_title_group">\n\t\t\t\t\t<div class="mail_massconnect__integration-block_icon --calendar"></div>\n\t\t\t\t\t<span class="mail_massconnect__integration-block_title">\n\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_INTEGRATION_CALENDAR_TITLE\') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<Switcher\n\t\t\t\t\t:isChecked="localModelValue.enabled"\n\t\t\t\t\t:options="switcherOptions"\n\t\t\t\t\t@click="localModelValue.enabled = !localModelValue.enabled"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<transition name="mail_massconnect__integration-block_slide-down">\n\t\t\t\t<div v-if="localModelValue.enabled" class="mail_massconnect__integration-block_content">\n\t\t\t\t\t<div class="mail_massconnect__checkbox-group">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\t\tid="mail_massconnect__auto-add-events"\n\t\t\t\t\t\t\tv-model="localModelValue.autoAddEvents"\n\t\t\t\t\t\t\tdata-test-id="mail_massconnect__settings_calendar-integration_auto-add-events-checkbox"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<label for="mail_massconnect__auto-add-events">\n\t\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CALENDAR_AUTO_ADD\') }}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</transition>\n\t\t</div>\n\t'};function Q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Z(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Q(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var J={components:{MailIntegration:K,CrmIntegration:$,CalendarIntegration:q,Switcher:_.Switcher},mixins:[A],computed:Z(Z({},f.mapState(N,["mailSettings","crmSettings","calendarSettings","analyticsSource","permissions"])),{},{switcherOptions:function t(){return{size:d.SwitcherSize.large,showStateTitle:false,useAirDesign:true}}}),methods:Z(Z({},f.mapActions(N,["setMailSettings","setCrmSettings","setCalendarSettings"])),{},{onStepComplete:function t(){var e=this.calendarSettings.enabled?"true":"false";var n=this.crmSettings.enabled?"true":"false";h.sendData({tool:"mail",event:"mailbox_mass_step3",category:"mail_mass_ops",c_section:this.analyticsSource,p1:"integrationCalendar_".concat(e),p2:"integrationCRM_".concat(n)})}}),template:'\n\t\t<div class="mail_massconnect__mailbox-settings_form">\n\t\t\t<div class="mail_massconnect__section-title_container">\n\t\t\t\t<span class="mail_massconnect__section-title">\n\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CARD_TITLE\') }}\n\t\t\t\t</span>\n\t\t\t\t<span class="mail_massconnect__section-description">\n\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_MAILBOX_SETTINGS_CARD_DESCRIPTION\') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\n\t\t\t<MailIntegration\n\t\t\t\t:model-value="mailSettings"\n\t\t\t\t@update:model-value="setMailSettings($event)"\n\t\t\t/>\n\n\t\t\t<CrmIntegration\n\t\t\t\t:model-value="crmSettings"\n\t\t\t\t:can-edit-crm-integration="permissions.canEditCrmIntegration"\n\t\t\t\t@update:model-value="setCrmSettings($event)"\n\t\t\t/>\n\n\t\t\t<CalendarIntegration\n\t\t\t\t:model-value="calendarSettings"\n\t\t\t\t@update:model-value="setCalendarSettings($event)"\n\t\t\t/>\n\t\t</div>\n\t'};var tt={MAILBOX_APPEND_SUCCESS:"mail-massconnect-mailboxes-append-success"};function et(t,e){var n=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=nt(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var i=0;var r=function t(){};return{s:r,n:function e(){if(i>=t.length)return{done:true};return{done:false,value:t[i++]}},e:function t(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,s;return{s:function e(){n=n.call(t)},n:function t(){var e=n.next();o=e.done;return e},e:function t(e){a=true;s=e},f:function t(){try{if(!o&&n["return"]!=null)n["return"]()}finally{if(a)throw s}}}}function nt(t,e){if(!t)return;if(typeof t==="string")return it(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return it(t,e)}function it(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function rt(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */rt=function e(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function t(e,n,i){return e[n]=i}}function l(t,e,n,r){var o=e&&e.prototype instanceof d?e:d,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:y(t,n,s)}),a}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var _={};function d(){}function p(){}function m(){}var f={};c(f,o,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(N([])));v&&v!==e&&n.call(v,o)&&(f=v);var S=m.prototype=d.prototype=Object.create(f);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,_=l.value;return _&&"object"==babelHelpers["typeof"](_)&&n.call(_,"__await")?e.resolve(_.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(_).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function t(n,i){function a(){return new e((function(t,e){r(n,i,t,e)}))}return o=o?o.then(a,a):a()}})}function y(t,e,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return C()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===_)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var c=u(t,e,n);if("normal"===c.type){if(i=n.done?"completed":"suspendedYield",c.arg===_)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i="completed",n.method="throw",n.arg=c.arg)}}}function E(t,e){var n=e.method,i=t.iterator[n];if(undefined===i)return e.delegate=null,"throw"===n&&t.iterator["return"]&&(e.method="return",e.arg=undefined,E(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),_;var r=u(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,_;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=undefined),e.delegate=null,_):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,_)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function N(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=undefined,e.done=!0,e};return r.next=r}}return{next:C}}function C(){return{value:undefined,done:!0}}return p.prototype=m,i(S,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:p,configurable:!0}),p.displayName=c(m,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,c(t,s,"GeneratorFunction")),t.prototype=Object.create(S),t},t.awrap=function(t){return{__await:t}},g(O.prototype),c(O.prototype,a,(function(){return this})),t.AsyncIterator=O,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var a=new O(l(e,n,i,r),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(S),c(S,s,"Generator"),c(S,o,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},t.values=N,I.prototype={constructor:I,reset:function t(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(T),!e)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=undefined)},stop:function t(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function t(e){if(this.done)throw e;var i=this;function r(t,n){return s.type="throw",s.arg=e,i.next=t,n&&(i.method="next",i.arg=undefined),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function t(e,i){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=i&&i<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=i,a?(this.method="next",this.next=a.finallyLoc,_):this.complete(s)},complete:function t(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),_},finish:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),T(i),_}},catch:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var o=r.arg;T(i)}return o}}throw new Error("illegal catch attempt")},delegateYield:function t(e,n,i){return this.delegate={iterator:N(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=undefined),_}},t}function ot(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function at(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ot(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var st={name:"connection-status",components:{UiButton:m.Button},mixins:[A],props:{mailboxes:{type:Array,required:true},massConnectData:{type:Object,required:true}},emits:["fix-errors"],setup:function t(){return{AirButtonStyle:m.AirButtonStyle}},data:function t(){return{totalMailboxes:0,processedCount:0,successfulCount:0,errorCount:0,errorDetails:[],isCancelled:false,isFinished:false}},computed:at(at({},f.mapState(N,["analyticsSource","calendarSettings","crmSettings"])),{},{hasErrors:function t(){return this.isFinished&&this.errorCount>0},isSuccess:function t(){return this.isFinished&&this.errorCount===0},statusText:function t(){return this.loc("MAIL_MASSCONNECT_FORM_CONNECTION_STATUS",{"#SUCCESSFUL_CNT#":this.successfulCount,"#TOTAL_CNT#":this.totalMailboxes,"#ERROR_CNT#":this.errorCount})},errorText:function t(){return p.Loc.getMessagePlural("MAIL_MASSCONNECT_FORM_CONNECTION_FAILURE_TITLE",this.errorCount,{"#ERROR_CNT#":this.errorCount})}}),created:function t(){p.Dom.hide(document.querySelector(".ui-side-panel-toolbar"));this.totalMailboxes=this.mailboxes.length;this.startProcessing()},methods:{startProcessing:function t(){var e=this;return babelHelpers.asyncToGenerator(rt().mark((function t(){var n,i,r,o,a;return rt().wrap((function t(s){while(1)switch(s.prev=s.next){case 0:n=null;s.prev=1;s.next=4;return P.saveMailboxConnectionData(e.massConnectData);case 4:r=s.sent;n=r===null||r===void 0?void 0:(i=r.data)===null||i===void 0?void 0:i.id;if(n){s.next=8;break}throw new Error("Failed to save mailbox connection data");case 8:s.next=18;break;case 10:s.prev=10;s.t0=s["catch"](1);o="";if(p.Type.isArray(s.t0.errors)&&s.t0.errors[0]){o=(a=s.t0.errors[0])===null||a===void 0?void 0:a.message}else{o=s.t0.message}e.errorDetails=e.mailboxes.map((function(t){return{customData:{userIdToConnect:t.userIdToConnect},message:o}}));e.errorCount=e.mailboxes.length;e.isFinished=true;return s.abrupt("return");case 18:e.processMailboxes(e.mailboxes,n);case 19:case"end":return s.stop()}}),t,null,[[1,10]])})))()},processMailboxes:function t(e,n){var i=this;return babelHelpers.asyncToGenerator(rt().mark((function t(){var e,r,o,a,s;return rt().wrap((function t(c){while(1)switch(c.prev=c.next){case 0:e=et(i.mailboxes);c.prev=1;e.s();case 3:if((r=e.n()).done){c.next=23;break}o=r.value;if(!i.isCancelled){c.next=8;break}i.errorDetails.push({code:0,customData:{userIdToConnect:o.userIdToConnect},message:""});return c.abrupt("continue",21);case 8:c.prev=8;c.next=11;return P.connectMailbox(o,n);case 11:i.successfulCount++;c.next=18;break;case 14:c.prev=14;c.t0=c["catch"](8);i.errorCount++;if(c.t0.errors[0]){i.errorDetails.push(c.t0.errors[0])}case 18:c.prev=18;i.processedCount++;return c.finish(18);case 21:c.next=3;break;case 23:c.next=28;break;case 25:c.prev=25;c.t1=c["catch"](1);e.e(c.t1);case 28:c.prev=28;e.f();return c.finish(28);case 31:i.isFinished=true;a=i.calendarSettings.enabled?"true":"false";s=i.crmSettings.enabled?"true":"false";h.sendData({tool:"mail",event:"mailbox_mass_complete",category:"mail_mass_ops",c_section:i.analyticsSource,p1:"integrationCalendar_".concat(a),p2:"integrationCRM_".concat(s)});if(i.successfulCount>0&&!i.isCancelled){BX.SidePanel.Instance.postMessage(window,tt.MAILBOX_APPEND_SUCCESS)}case 36:case"end":return c.stop()}}),t,null,[[1,25,28,31],[8,14,18,21]])})))()},handleCancel:function t(){this.isCancelled=true;this.isFinished=true},handleFixErrors:function t(){p.Dom.show(document.querySelector(".ui-side-panel-toolbar"));this.$emit("fix-errors",this.errorDetails,this.successfulCount)},closeWizard:function t(){var e=BX.SidePanel.Instance.getTopSlider();if(e){e.close()}}},template:'\n\t\t<div class="mail_massconnect__connection-status-view">\n\t\t\t<div \n\t\t\t\tv-if="!isFinished" \n\t\t\t\tclass="mail_massconnect__connection-status-view_content"\n\t\t\t\tdata-test-id="mail_massconnect__connection-status-view_processing"\n\t\t\t>\n\t\t\t\t<div class="mail_massconnect__connection-status-view_icon --processing"></div>\n\t\t\t\t<span class="mail_massconnect__connection-status-view_text">{{ statusText }}</span>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_CANCEL_BUTTON_TITLE\')"\n\t\t\t\t\t:style="AirButtonStyle.FILLED"\n\t\t\t\t\t@click="handleCancel"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div \n\t\t\t\tv-if="isSuccess" \n\t\t\t\tclass="mail_massconnect__connection-status-view_content"\n\t\t\t\tdata-test-id="mail_massconnect__connection-status-view_success"\n\t\t\t>\n\t\t\t\t<div class="mail_massconnect__connection-status-view_icon --success"></div>\n\t\t\t\t<span class="mail_massconnect__connection-status-view_text">\n\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_SUCCESS_ALL_CONNECTED\') }}\n\t\t\t\t</span>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_CLOSE_WIZARD_BUTTON_TITLE\')"\n\t\t\t\t\t:style="AirButtonStyle.FILLED"\n\t\t\t\t\t@click="closeWizard"\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div \n\t\t\t\tv-if="hasErrors" \n\t\t\t\tclass="mail_massconnect__connection-status-view_content"\n\t\t\t\tdata-test-id="mail_massconnect__connection-status-view_has-errors"\n\t\t\t>\n\t\t\t\t<div class="mail_massconnect__connection-status-view_icon --failure"></div>\n\t\t\t\t<div class="mail_massconnect__connection-status_failure-text-container">\n\t\t\t\t\t<div class="mail_massconnect__connection-status_failure-text-title">\n\t\t\t\t\t\t{{ errorText }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="mail_massconnect__connection-status_failure-text-description">\n\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_FAILURE_DESCRIPTION\') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass="mail_massconnect__connection-status-view_buttons"\n\t\t\t\t\tdata-test-id="mail_massconnect__connection-status-view_has-errors_buttons"\n\t\t\t\t>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_FIX_BUTTON_TITLE\')"\n\t\t\t\t\t\t:style="AirButtonStyle.FILLED"\n\t\t\t\t\t\t:rightCounterValue="errorCount"\n\t\t\t\t\t\tsize="ui-btn-lg"\n\t\t\t\t\t\tclass="mail_massconnect__connection-status-view_has-errors_buttons_fix-button"\n\t\t\t\t\t\t@click="handleFixErrors"\n\t\t\t\t\t/>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text="loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_CLOSE_WIZARD_BUTTON_TITLE\')"\n\t\t\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t\t\tclass="mail_massconnect__connection-status-view_has-errors_buttons_close-button"\n\t\t\t\t\t\tsize="ui-btn-lg"\n\t\t\t\t\t\t@click="closeWizard"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var ct={name:"WizardHint",mixins:[A,V],computed:{hintDescriptionText:function t(){return this.preparedIndirectPhrase("MAIL_MASSCONNECT_FORM_CONNECTION_DATA_HINT_DESCRIPTION","#HELP_LINK#")}},methods:{goToBPHelp:function t(e){if(top.BX&&top.BX.Helper){if(e){e.preventDefault()}top.BX.Helper.show("redirect=detail&code=26953018")}}},template:'\n\t\t<div class="mail_massconnect__wizard_card">\n\t\t\t<div class="mail_massconnect__wizard_card_hint">\n\t\t\t\t<div class="mail_massconnect__section-title_container">\n\t\t\t\t\t<span class="mail_massconnect__section-description">\n\t\t\t\t\t\t<span>{{ hintDescriptionText.beforeText }}</span>\n\t\t\t\t\t\t<span class="mail_massconnect__section-description_hint-link" @click="goToBPHelp">\n\t\t\t\t\t\t\t{{ loc(\'MAIL_MASSCONNECT_FORM_CONNECTION_DATA_HINT_HELP_LINK\') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span>{{ hintDescriptionText.afterText }}</span>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'};function lt(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */lt=function e(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function t(e,n,i){return e[n]=i}}function l(t,e,n,r){var o=e&&e.prototype instanceof d?e:d,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:y(t,n,s)}),a}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var _={};function d(){}function p(){}function m(){}var f={};c(f,o,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h(N([])));v&&v!==e&&n.call(v,o)&&(f=v);var S=m.prototype=d.prototype=Object.create(f);function g(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(i,o,a,s){var c=u(t[i],t,o);if("throw"!==c.type){var l=c.arg,_=l.value;return _&&"object"==babelHelpers["typeof"](_)&&n.call(_,"__await")?e.resolve(_.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(_).then((function(t){l.value=t,a(l)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var o;i(this,"_invoke",{value:function t(n,i){function a(){return new e((function(t,e){r(n,i,t,e)}))}return o=o?o.then(a,a):a()}})}function y(t,e,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return C()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===_)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var c=u(t,e,n);if("normal"===c.type){if(i=n.done?"completed":"suspendedYield",c.arg===_)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i="completed",n.method="throw",n.arg=c.arg)}}}function E(t,e){var n=e.method,i=t.iterator[n];if(undefined===i)return e.delegate=null,"throw"===n&&t.iterator["return"]&&(e.method="return",e.arg=undefined,E(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),_;var r=u(i,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,_;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=undefined),e.delegate=null,_):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,_)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function N(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function e(){for(;++i<t.length;)if(n.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=undefined,e.done=!0,e};return r.next=r}}return{next:C}}function C(){return{value:undefined,done:!0}}return p.prototype=m,i(S,"constructor",{value:m,configurable:!0}),i(m,"constructor",{value:p,configurable:!0}),p.displayName=c(m,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,c(t,s,"GeneratorFunction")),t.prototype=Object.create(S),t},t.awrap=function(t){return{__await:t}},g(O.prototype),c(O.prototype,a,(function(){return this})),t.AsyncIterator=O,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var a=new O(l(e,n,i,r),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(S),c(S,s,"Generator"),c(S,o,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},t.values=N,I.prototype={constructor:I,reset:function t(e){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(T),!e)for(var i in this)"t"===i.charAt(0)&&n.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=undefined)},stop:function t(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function t(e){if(this.done)throw e;var i=this;function r(t,n){return s.type="throw",s.arg=e,i.next=t,n&&(i.method="next",i.arg=undefined),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),l=n.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function t(e,i){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=i&&i<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=i,a?(this.method="next",this.next=a.finallyLoc,_):this.complete(s)},complete:function t(e,n){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&n&&(this.next=n),_},finish:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),T(i),_}},catch:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var o=r.arg;T(i)}return o}}throw new Error("illegal catch attempt")},delegateYield:function t(e,n,i){return this.delegate={iterator:N(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=undefined),_}},t}function ut(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function _t(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ut(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ut(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var dt={components:{WizardProgressBar:C,WizardNavigation:L,ConnectionStatus:st,WizardHint:ct},mixins:[A],data:function t(){return{currentStepIndex:0,successfulCount:0,isSubmitting:false,isCurrentStepValid:false,validationAttempted:false,mailboxesToConnect:[],massConnectData:{},steps:[e.markRaw(x),e.markRaw(U),e.markRaw(J)]}},computed:_t(_t({},f.mapState(N,["analyticsSource"])),{},{isContinueButtonDisabled:function t(){var e;var n=(e=this.activeStepComponent.disableButtonOnInvalid)!==null&&e!==void 0?e:true;return n&&!this.isCurrentStepValid},totalSteps:function t(){return this.steps.length},activeStepComponent:function t(){return this.steps[this.currentStepIndex]},isFirstStep:function t(){return this.currentStepIndex===0},isLastStep:function t(){return this.currentStepIndex===this.totalSteps-1},isSecondStep:function t(){return this.currentStepIndex===1}}),watch:{currentStepIndex:function t(){this.validationAttempted=false}},mounted:function t(){h.sendData({tool:"mail",event:"mailbox_mass_open",category:"mail_mass_ops",c_section:this.analyticsSource})},methods:{nextStep:function t(){var e=this;this.validationAttempted=true;this.$nextTick((function(){if(e.isCurrentStepValid&&!e.isLastStep){e.handleStepCompletion();e.currentStepIndex++}}))},prevStep:function t(){if(!this.isFirstStep){this.currentStepIndex--}},submitWizard:function t(){var e=this;return babelHelpers.asyncToGenerator(lt().mark((function t(){var n,i;return lt().wrap((function t(r){while(1)switch(r.prev=r.next){case 0:e.handleStepCompletion();n=N();i=n.prepareDataForBackend();e.mailboxesToConnect=i.mailboxes;e.massConnectData=n.prepareDataForHistory();if(!(e.mailboxesToConnect.length===0)){r.next=7;break}return r.abrupt("return");case 7:e.isSubmitting=true;case 8:case"end":return r.stop()}}),t)})))()},handleStepCompletion:function t(){if(this.$refs.activeComponent&&p.Type.isFunction(this.$refs.activeComponent.onStepComplete)){this.$refs.activeComponent.onStepComplete()}},handleFixErrors:function t(e,n){this.successfulCount=n;var i=N();i.enableErrorState(e.length);var r=new Set(e.map((function(t){var e;return(e=t.customData)===null||e===void 0?void 0:e.userIdToConnect})));var o=i.employees.filter((function(t){return r.has(t.id)})).map((function(t){return _t(_t({},t),{},{password:""})}));var a=[].concat(babelHelpers.toConsumableArray(i.addedEmployees),babelHelpers.toConsumableArray(i.employees.filter((function(t){return!r.has(t.id)})).map((function(t){return _t(_t({},t),{},{password:""})}))));i.setAddedEmployees(a);i.setEmployees(o);this.isSubmitting=false;this.currentStepIndex=1}},template:'\n\t\t<div class="mail_massconnect__wizard_container">\n\t\t\t<template v-if="!isSubmitting">\n\t\t\t\t<WizardProgressBar\n\t\t\t\t\t:total-steps="totalSteps"\n\t\t\t\t\t:current-step-index="currentStepIndex"\n\t\t\t\t/>\n\n\t\t\t\t<WizardHint v-if="isFirstStep"/>\n\n\t\t\t\t<div class="mail_massconnect__wizard_card">\n\t\t\t\t\t<div class="mail_massconnect__wizard_card_content">\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\tref="activeComponent"\n\t\t\t\t\t\t\t:is="activeStepComponent"\n\t\t\t\t\t\t\t:validationAttempted="validationAttempted"\n\t\t\t\t\t\t\t@update:validity="isCurrentStepValid = $event"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<WizardNavigation\n\t\t\t\t\t:isFirstStep="isFirstStep"\n\t\t\t\t\t:isLastStep="isLastStep"\n\t\t\t\t\t:isSubmitting="isSubmitting"\n\t\t\t\t\t:prevDisabled="isSecondStep && successfulCount > 0"\n\t\t\t\t\t:disabledContinueButton="isContinueButtonDisabled"\n\t\t\t\t\t@prev-step="prevStep"\n\t\t\t\t\t@next-step="nextStep"\n\t\t\t\t\t@submit="submitWizard"\n\t\t\t\t/>\n\t\t\t</template>\n\n\t\t\t<template v-else>\n\t\t\t\t<div class="mail_massconnect__wizard_connection_status_container">\n\t\t\t\t\t<div class="mail_massconnect__wizard_connection_status_content">\n\t\t\t\t\t\t<ConnectionStatus\n\t\t\t\t\t\t\t:mailboxes="mailboxesToConnect"\n\t\t\t\t\t\t\t:massConnectData="massConnectData"\n\t\t\t\t\t\t\t@fixErrors="handleFixErrors"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t'};function pt(t,e,n){mt(t,e);e.set(t,n)}function mt(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var ft=new WeakMap;var ht=function(){function t(){var e;var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};babelHelpers.classCallCheck(this,t);pt(this,ft,{writable:true,value:void 0});babelHelpers.defineProperty(this,"source",null);babelHelpers.defineProperty(this,"isSmtpAvailable",false);babelHelpers.defineProperty(this,"permissions",{allowedLevels:null,canEditCrmIntegration:null});this.rootNode=document.querySelector("#".concat(n.appContainerId));this.source=n===null||n===void 0?void 0:n.source;this.isSmtpAvailable=(e=n.isSmtpAvailable)!==null&&e!==void 0?e:false;if(n!==null&&n!==void 0&&n.permissions){this.permissions=n.permissions}}babelHelpers.createClass(t,[{key:"start",value:function t(){var n=f.createPinia();babelHelpers.classPrivateFieldSet(this,ft,e.BitrixVue.createApp({components:{WizardContainer:dt},template:"<WizardContainer />"}));babelHelpers.classPrivateFieldGet(this,ft).use(n);var i=N();i.setAnalyticsSource(this.source);i.setSmtpStatus(this.isSmtpAvailable);i.setPermissions(this.permissions);babelHelpers.classPrivateFieldGet(this,ft).mount(this.rootNode)}}]);return t}();t.MassconnectForm=ht})(this.BX.Mail.Massconnect=this.BX.Mail.Massconnect||{},BX.Vue3,BX.UI.System.Input,BX.UI.System.Input.Vue,BX,BX.UI.Vue3.Components,BX.UI,BX.UI.IconSet,BX.Mail,BX.Vue3.Directives,BX.UI.EntitySelector,BX.UI.Vue3.Components,BX.UI,BX,BX.Vue3.Components,BX.Vue3.Pinia,BX.UI.Analytics);
//# sourceMappingURL=massconnect-form.bundle.map.js