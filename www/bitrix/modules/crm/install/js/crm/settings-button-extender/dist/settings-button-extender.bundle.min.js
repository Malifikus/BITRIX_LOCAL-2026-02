this.BX=this.BX||{};(function(e,s,t,a,i,l,r,o,n){"use strict";function c(e,s,t){if(o.Type.isNil(e)){return e}return b(e,s,t)}function b(e,s,t){if(e instanceof s){return e}throw new Error(`Expected ${t} be an instance of ${s.name}, got ${u(e)} instead`)}function d(e,s){if(!o.Type.isArray(e)){throw new TypeError(`Expected ${s} should be an array of strings, got ${u(e)} instead`)}e.forEach(((e,t)=>{if(!o.Type.isString(e)){throw new TypeError(`Expected ${s} should be an array of strings, instead the element at index ${t} is ${u(e)}`)}}));return e}function p(e,s){if(o.Type.isStringFilled(e)||o.Type.isNil(e)){return e}throw new Error(`Expected ${s} be either non-empty string or null, got ${u(e)} instead`)}function u(e){if(o.Type.isObject(e)&&!o.Type.isPlainObject(e)){var s;return(e==null?void 0:(s=e.constructor)==null?void 0:s.name)||"unknown"}return typeof e}const h=o.Extension.getSettings("crm.settings-button-extender").get("createTimeAliases",{});const v={};for(const e in h){v[e]={column:h[e],order:"desc"}}Object.freeze(v);var g=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var P=babelHelpers.classPrivateFieldLooseKey("grid");var L=babelHelpers.classPrivateFieldLooseKey("disableLastActivitySort");var y=babelHelpers.classPrivateFieldLooseKey("enableLastActivitySort");var T=babelHelpers.classPrivateFieldLooseKey("isColumnExists");var H=babelHelpers.classPrivateFieldLooseKey("isColumnShowed");var f=babelHelpers.classPrivateFieldLooseKey("isColumnSortable");var F=babelHelpers.classPrivateFieldLooseKey("getShowedColumnList");var B=babelHelpers.classPrivateFieldLooseKey("setSortOrder");var O=babelHelpers.classPrivateFieldLooseKey("showColumn");class C{constructor(e,s){Object.defineProperty(this,O,{value:M});Object.defineProperty(this,B,{value:w});Object.defineProperty(this,F,{value:m});Object.defineProperty(this,f,{value:E});Object.defineProperty(this,H,{value:_});Object.defineProperty(this,T,{value:A});Object.defineProperty(this,y,{value:S});Object.defineProperty(this,L,{value:I});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,g)[g]=o.Text.toInteger(e);babelHelpers.classPrivateFieldLooseBase(this,P)[P]=b(s,BX.Main.grid,"grid")}isLastActivitySortSupported(){return babelHelpers.classPrivateFieldLooseBase(this,T)[T]("LAST_ACTIVITY_TIME")}isLastActivitySortEnabled(){const e=babelHelpers.classPrivateFieldLooseBase(this,P)[P].getUserOptions().getCurrentOptions();const s=e.last_sort_by;const t=e.last_sort_order;return(s==null?void 0:s.toLowerCase())==="last_activity_time"&&(t==null?void 0:t.toLowerCase())==="desc"}toggleLastActivitySort(){if(this.isLastActivitySortEnabled()){babelHelpers.classPrivateFieldLooseBase(this,L)[L]()}else{babelHelpers.classPrivateFieldLooseBase(this,y)[y]()}}}async function I(){const e=v[babelHelpers.classPrivateFieldLooseBase(this,g)[g]];let s;if(o.Type.isPlainObject(e)&&babelHelpers.classPrivateFieldLooseBase(this,T)[T](e.column)&&babelHelpers.classPrivateFieldLooseBase(this,f)[f](e.column)){s=e.column;if(!babelHelpers.classPrivateFieldLooseBase(this,H)[H](s)){await babelHelpers.classPrivateFieldLooseBase(this,O)[O](s)}babelHelpers.classPrivateFieldLooseBase(this,B)[B](s,e.order)}else{s=babelHelpers.classPrivateFieldLooseBase(this,F)[F]().find((e=>e!=="LAST_ACTIVITY_TIME"&&babelHelpers.classPrivateFieldLooseBase(this,f)[f](e)))}babelHelpers.classPrivateFieldLooseBase(this,P)[P].sortByColumn(s)}async function S(){if(!babelHelpers.classPrivateFieldLooseBase(this,H)[H]("LAST_ACTIVITY_TIME")){await babelHelpers.classPrivateFieldLooseBase(this,O)[O]("LAST_ACTIVITY_TIME")}babelHelpers.classPrivateFieldLooseBase(this,B)[B]("LAST_ACTIVITY_TIME","desc");babelHelpers.classPrivateFieldLooseBase(this,P)[P].sortByColumn("LAST_ACTIVITY_TIME")}function A(e){return babelHelpers.classPrivateFieldLooseBase(this,P)[P].getParam("COLUMNS_ALL",{}).hasOwnProperty(e)}function _(e){return babelHelpers.classPrivateFieldLooseBase(this,F)[F]().includes(e)}function E(e){const s=babelHelpers.classPrivateFieldLooseBase(this,P)[P].getColumnByName(e);return!!(s&&s.sort!==false)}function m(){return babelHelpers.classPrivateFieldLooseBase(this,P)[P].getSettingsWindow().getShowedColumns()}function w(e,s){babelHelpers.classPrivateFieldLooseBase(this,P)[P].getColumnByName(e).sort_order=s}function M(e){return new Promise(((s,t)=>{if(!babelHelpers.classPrivateFieldLooseBase(this,T)[T](e)){t(new Error(`Column ${e} does not exists`));return}if(babelHelpers.classPrivateFieldLooseBase(this,H)[H](e)){t(new Error(`Column ${e} is showed already`));return}babelHelpers.classPrivateFieldLooseBase(this,P)[P].getSettingsWindow().select(e);const a=babelHelpers.classPrivateFieldLooseBase(this,F)[F]();a.push(e);babelHelpers.classPrivateFieldLooseBase(this,P)[P].getSettingsWindow().saveColumns(a,s)}))}const N="call";const R="chat";const j=1;const K=2;const x="menu-popup-item-accept";const G="menu-popup-item-none";const k=750;const U=300;class X{static migrateToChannelFormat(e){if(e&&e.channels){return e}const s={channels:{}};if(e&&(e.autostartOperationTypes||!o.Type.isUndefined(e.autostartCallDirections))){s.channels[N]={channelType:N,autostartOperationTypes:e.autostartOperationTypes||[],autostartTranscriptionOnlyOnFirstCallWithRecording:Boolean(e.autostartTranscriptionOnlyOnFirstCallWithRecording),autostartCallDirections:e.autostartCallDirections||[j]}}if(e&&!o.Type.isUndefined(e.autostartOnlyFirstChat)){s.channels[R]={channelType:R,autostartOperationTypes:[],autostartOnlyFirstChat:Boolean(e.autostartOnlyFirstChat)}}return s}static isValidChannelFormat(e){if(!o.Type.isPlainObject(e)){return false}if(!o.Type.isPlainObject(e.channels)){return false}for(const[s,t]of Object.entries(e.channels)){if(!o.Type.isPlainObject(t)){return false}if(t.channelType!==s){return false}if(!o.Type.isArrayFilled(t.autostartOperationTypes)){return false}}return true}}class D{constructor(e,s){this.entityTypeId=e;this.categoryId=s}saveAutostartSettings(e){return o.ajax.runAction("crm.settings.ai.saveAutostartSettings",{json:{entityTypeId:this.entityTypeId,categoryId:this.categoryId,settings:e}})}getAutostartSettings(){return o.ajax.runAction("crm.settings.ai.getAutostartSettings",{json:{entityTypeId:this.entityTypeId,categoryId:this.categoryId}})}async saveWithErrorHandling(e){try{const s=await this.saveAutostartSettings(e);return s.data.settings}catch(e){await console.error("Could not save ai settings",e);try{const e=await this.getAutostartSettings();return e.data.settings}catch(e){await console.error("Could not fetch ai settings after error in save",e);throw e}}}}class V{constructor(e,s){this.settings=null;this.extensionSettings=null;this.onActionClick=null;this.settings=e;this.extensionSettings=s}getMenuItems(e=null){throw new Error("Method getMenuItems must be implemented")}handleAction(e){throw new Error("Method handleAction must be implemented")}isActionActive(e){throw new Error("Method isActionActive must be implemented")}getAllOperationTypes(){return this.extensionSettings.get("allAIOperationTypes").map((e=>o.Text.toInteger(e)))}getTranscribeOperationType(){return o.Text.toInteger(this.extensionSettings.get("transcribeAIOperationType"))}hasAIPackages(){return this.extensionSettings.get("isAIHasPackages")}createActionHandler(e){return(s,t)=>{if(this.onActionClick){this.onActionClick(s,t,e)}this.handleAction(e)}}setActionClickHandler(e){this.onActionClick=e}}class W extends V{getMenuItems(e=null){return[{text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_FIRST_INCOMING_MSGVER_1"),className:this.isActionActive("firstCall")?x:G,onclick:e!=null?e:this.createActionHandler("firstCall")},{text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_INCOMING"),className:this.isActionActive("allCalls")?x:G,onclick:e!=null?e:this.createActionHandler("allCalls")},{text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_OUTGOING"),className:this.isActionActive("outgoingCalls")?x:G,onclick:e!=null?e:this.createActionHandler("outgoingCalls")},{text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_ALL_MSGVER_1"),className:this.isActionActive("allIncomingOutgoingCalls")?x:G,onclick:e!=null?e:this.createActionHandler("allIncomingOutgoingCalls")},{text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_MANUAL_CALLS_PROCESSING_MSGVER_1"),className:this.isActionActive("manual")?x:G,onclick:e!=null?e:this.createActionHandler("manual")}]}handleAction(e){const s=this.getAllOperationTypes();switch(e){case"manual":this.settings.autostartOperationTypes=this.getAllOperationTypes().filter((e=>e!==this.getTranscribeOperationType()));break;case"firstCall":this.settings.autostartOperationTypes=s;this.settings.autostartTranscriptionOnlyOnFirstCallWithRecording=true;this.settings.autostartCallDirections=[j];break;case"allCalls":this.settings.autostartOperationTypes=s;this.settings.autostartTranscriptionOnlyOnFirstCallWithRecording=false;this.settings.autostartCallDirections=[j];break;case"outgoingCalls":this.settings.autostartOperationTypes=s;this.settings.autostartTranscriptionOnlyOnFirstCallWithRecording=false;this.settings.autostartCallDirections=[K];break;case"allIncomingOutgoingCalls":this.settings.autostartOperationTypes=s;this.settings.autostartTranscriptionOnlyOnFirstCallWithRecording=false;this.settings.autostartCallDirections=[j,K];break;default:}}isActionActive(e){const s=this.settings.autostartOperationTypes.includes(this.getTranscribeOperationType());const t=this.hasAIPackages();const a=this.settings.autostartTranscriptionOnlyOnFirstCallWithRecording;const i=this.settings.autostartCallDirections||[];const l=i.length===1&&i.includes(j);const r=i.length===1&&i.includes(K);const o=i.includes(j)&&i.includes(K);switch(e){case"manual":return!s||!t;case"firstCall":return s&&t&&a&&l;case"allCalls":return s&&t&&l&&!a;case"outgoingCalls":return s&&t&&r&&!a;case"allIncomingOutgoingCalls":return s&&t&&o&&!a;default:return false}}}class $ extends V{getMenuItems(e=null){return[{text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_OPEN_LINES_PROCESSING_FIRST_CHAT"),className:this.isActionActive("firstChat")?x:G,onclick:e!=null?e:this.createActionHandler("firstChat")},{text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_OPEN_LINES_PROCESSING_ALL"),className:this.isActionActive("allChats")?x:G,onclick:e!=null?e:this.createActionHandler("allChats")},{text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_MANUAL_CALLS_PROCESSING_MSGVER_1"),className:this.isActionActive("manual")?x:G,onclick:e!=null?e:this.createActionHandler("manual")}]}handleAction(e){const s=this.getAllOperationTypes();switch(e){case"firstChat":this.settings.autostartOperationTypes=s;this.settings.autostartOnlyFirstChat=true;break;case"allChats":this.settings.autostartOperationTypes=s;this.settings.autostartOnlyFirstChat=false;break;case"manual":this.settings.autostartOperationTypes=[];this.settings.autostartOnlyFirstChat=false;break;default:}}isActionActive(e){const s=this.hasAIPackages();const t=this.settings.autostartOnlyFirstChat;const a=(this.settings.autostartOperationTypes||[]).length>0;switch(e){case"firstChat":return s&&a&&t;case"allChats":return s&&a&&!t;case"manual":return!a||!s;default:return false}}}class Y{static create(e,s,t){switch(e){case N:return new W(s,t);case R:return new $(s,t);default:throw new Error(`Unknown channel type: ${e}`)}}static getSupportedChannelTypes(){return[N,R]}}const z=o.Reflection.getClass("BX.CrmEntityType");var q=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var J=babelHelpers.classPrivateFieldLooseKey("categoryId");var Q=babelHelpers.classPrivateFieldLooseKey("pingSettings");var Z=babelHelpers.classPrivateFieldLooseKey("rootMenu");var ee=babelHelpers.classPrivateFieldLooseKey("targetItemId");var se=babelHelpers.classPrivateFieldLooseKey("expandsBehindThan");var te=babelHelpers.classPrivateFieldLooseKey("kanbanController");var ae=babelHelpers.classPrivateFieldLooseKey("restriction");var ie=babelHelpers.classPrivateFieldLooseKey("gridController");var le=babelHelpers.classPrivateFieldLooseKey("todoSkipMenu");var re=babelHelpers.classPrivateFieldLooseKey("todoPingSettingsMenu");var oe=babelHelpers.classPrivateFieldLooseKey("isSetSortRequestRunning");var ne=babelHelpers.classPrivateFieldLooseKey("smartActivityNotificationSupported");var ce=babelHelpers.classPrivateFieldLooseKey("aiAutostartSettings");var be=babelHelpers.classPrivateFieldLooseKey("aiCopilotLanguageId");var de=babelHelpers.classPrivateFieldLooseKey("isSetAiSettingsRequestRunning");var pe=babelHelpers.classPrivateFieldLooseKey("extensionSettings");var ue=babelHelpers.classPrivateFieldLooseKey("channelHandlers");var he=babelHelpers.classPrivateFieldLooseKey("aiSettingsService");var ve=babelHelpers.classPrivateFieldLooseKey("initializeProperties");var ge=babelHelpers.classPrivateFieldLooseKey("initializeMenus");var Pe=babelHelpers.classPrivateFieldLooseKey("parseAISettings");var Le=babelHelpers.classPrivateFieldLooseKey("initializeChannelHandlers");var ye=babelHelpers.classPrivateFieldLooseKey("bindEvents");var Te=babelHelpers.classPrivateFieldLooseKey("getItems");var He=babelHelpers.classPrivateFieldLooseKey("resolveEarlyTargetId");var fe=babelHelpers.classPrivateFieldLooseKey("getPushCrmSettings");var Fe=babelHelpers.classPrivateFieldLooseKey("shouldShowLastActivitySortToggle");var Be=babelHelpers.classPrivateFieldLooseKey("getLastActivitySortToggle");var Oe=babelHelpers.classPrivateFieldLooseKey("isLastActivitySortEnabled");var Ce=babelHelpers.classPrivateFieldLooseKey("handleLastActivitySortToggleClick");var Ie=babelHelpers.classPrivateFieldLooseKey("shouldShowTodoSkipMenu");var Se=babelHelpers.classPrivateFieldLooseKey("shouldShowTodoPingSettingsMenu");var Ae=babelHelpers.classPrivateFieldLooseKey("getCoPilotSettings");var _e=babelHelpers.classPrivateFieldLooseKey("handleChannelAction");var Ee=babelHelpers.classPrivateFieldLooseKey("saveAISettings");var me=babelHelpers.classPrivateFieldLooseKey("handleCoPilotLanguageSelect");var we=babelHelpers.classPrivateFieldLooseKey("getInfoHelper");class Me{constructor(e){Object.defineProperty(this,we,{value:Ze});Object.defineProperty(this,me,{value:Qe});Object.defineProperty(this,Ee,{value:Je});Object.defineProperty(this,_e,{value:qe});Object.defineProperty(this,Ae,{value:ze});Object.defineProperty(this,Se,{value:Ye});Object.defineProperty(this,Ie,{value:$e});Object.defineProperty(this,Ce,{value:We});Object.defineProperty(this,Oe,{value:Ve});Object.defineProperty(this,Be,{value:De});Object.defineProperty(this,Fe,{value:Xe});Object.defineProperty(this,fe,{value:Ue});Object.defineProperty(this,He,{value:ke});Object.defineProperty(this,Te,{value:Ge});Object.defineProperty(this,ye,{value:xe});Object.defineProperty(this,Le,{value:Ke});Object.defineProperty(this,Pe,{value:je});Object.defineProperty(this,ge,{value:Re});Object.defineProperty(this,ve,{value:Ne});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,J,{writable:true,value:void 0});Object.defineProperty(this,Q,{writable:true,value:void 0});Object.defineProperty(this,Z,{writable:true,value:void 0});Object.defineProperty(this,ee,{writable:true,value:void 0});Object.defineProperty(this,se,{writable:true,value:void 0});Object.defineProperty(this,te,{writable:true,value:void 0});Object.defineProperty(this,ae,{writable:true,value:void 0});Object.defineProperty(this,ie,{writable:true,value:null});Object.defineProperty(this,le,{writable:true,value:void 0});Object.defineProperty(this,re,{writable:true,value:void 0});Object.defineProperty(this,oe,{writable:true,value:false});Object.defineProperty(this,ne,{writable:true,value:false});Object.defineProperty(this,ce,{writable:true,value:null});Object.defineProperty(this,be,{writable:true,value:null});Object.defineProperty(this,de,{writable:true,value:false});Object.defineProperty(this,pe,{writable:true,value:o.Extension.getSettings("crm.settings-button-extender")});Object.defineProperty(this,ue,{writable:true,value:new Map});Object.defineProperty(this,he,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](e);babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](e);babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe](e.aiAutostartSettings);babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]();babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]()}destroy(){babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].clear();s.EventEmitter.unsubscribeAll(s.EventEmitter.GLOBAL_TARGET,"onPopupShow")}updateAISettings(e){if(!X.isValidChannelFormat(e)){throw new Error("Invalid settings format",e)}babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=e;babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]()}getChannelHandler(e){return babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].get(e)}isChannelAvailable(e){return babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].has(e)}getAvailableChannels(){return[...babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].keys()]}}function Ne(e){var s;babelHelpers.classPrivateFieldLooseBase(this,q)[q]=o.Text.toInteger(e.entityTypeId);babelHelpers.classPrivateFieldLooseBase(this,J)[J]=o.Type.isInteger(e.categoryId)?e.categoryId:null;babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]=o.Type.isPlainObject(e.pingSettings)?e.pingSettings:{};babelHelpers.classPrivateFieldLooseBase(this,se)[se]=d((s=e.expandsBehindThan)!=null?s:[],"params.expandsBehindThan");babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]=o.Text.toBoolean(e.smartActivityNotificationSupported);if(z&&!z.isDefined(babelHelpers.classPrivateFieldLooseBase(this,q)[q])){throw new Error(`Provided entityTypeId is invalid: ${babelHelpers.classPrivateFieldLooseBase(this,q)[q]}`)}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=b(e.rootMenu,n.Menu,"params.rootMenu");babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]=p(e.targetItemId,"params.targetItemId");babelHelpers.classPrivateFieldLooseBase(this,te)[te]=c(e.controller,r.SettingsController,"params.controller");babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=c(e.restriction,l.Restriction,"params.restriction");if(o.Reflection.getClass("BX.Main.grid")&&e.grid){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]=new C(babelHelpers.classPrivateFieldLooseBase(this,q)[q],e.grid)}babelHelpers.classPrivateFieldLooseBase(this,be)[be]=e.aiCopilotLanguageId;babelHelpers.classPrivateFieldLooseBase(this,he)[he]=new D(babelHelpers.classPrivateFieldLooseBase(this,q)[q],babelHelpers.classPrivateFieldLooseBase(this,J)[J])}function Re(e){babelHelpers.classPrivateFieldLooseBase(this,le)[le]=new a.TodoNotificationSkipMenu({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,q)[q],selectedValue:p(e.todoCreateNotificationSkipPeriod,"params.todoCreateNotificationSkipPeriod")});if(Object.keys(babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]).length>0){babelHelpers.classPrivateFieldLooseBase(this,re)[re]=new i.TodoPingSettingsMenu({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,q)[q],settings:babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]})}}function je(e){const s=p(e,"params.aiAutostartSettings");if(!o.Type.isStringFilled(s)){return}try{const e=JSON.parse(s);if(o.Type.isPlainObject(e)){babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=X.migrateToChannelFormat(e)}}catch(e){throw new Error("Failed to parse AI settings:",e)}}function Ke(){var e;babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].clear();if(!((e=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce])!=null&&e.channels)){return}Object.entries(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].channels).forEach((([e,s])=>{const t=Y.create(e,s,babelHelpers.classPrivateFieldLooseBase(this,pe)[pe]);if(t){t.setActionClickHandler(((s,t,a)=>{babelHelpers.classPrivateFieldLooseBase(this,_e)[_e](e,a,s,t)}));babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].set(e,t)}}))}function xe(){const e=[];s.EventEmitter.subscribe(s.EventEmitter.GLOBAL_TARGET,"onPopupShow",(s=>{const t=s.getTarget();if(t.getId()!==babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].getId()){return}const a=babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]();if(a.length<=0){return}while(e.length>0){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].removeMenuItem(e.pop())}let i=babelHelpers.classPrivateFieldLooseBase(this,He)[He]();for(const s of a.reverse()){const t=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].addMenuItem(s,i);if(t){i=t.getId();e.push(t.getId())}}}))}function Ge(){const e=[];const s=babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]();if(s){e.push(s)}const t=babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae]();if(t){e.push(t)}return e}function ke(){var e;const s=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].getMenuItems();const t=s.find((e=>babelHelpers.classPrivateFieldLooseBase(this,se)[se].includes(e.getId())));return(e=t==null?void 0:t.getId())!=null?e:babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]}function Ue(){const e=[];if(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]()){e.push(babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]())}if(babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]()){e.push(...babelHelpers.classPrivateFieldLooseBase(this,le)[le].getItems())}if(babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]()){e.push(...babelHelpers.classPrivateFieldLooseBase(this,re)[re].getItems())}if(e.length<=0){return null}return{text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_PUSH_CRM"),items:e}}function Xe(){var e,s,t;const a=((e=babelHelpers.classPrivateFieldLooseBase(this,te)[te])==null?void 0:e.getCurrentSettings().isTypeSupported(r.Type.BY_LAST_ACTIVITY_TIME))&&((s=babelHelpers.classPrivateFieldLooseBase(this,ae)[ae])==null?void 0:s.isSortTypeChangeAvailable());return!!(a||(t=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie])!=null&&t.isLastActivitySortSupported())}function De(){return{text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_PUSH_CRM_TOGGLE_SORT"),disabled:babelHelpers.classPrivateFieldLooseBase(this,oe)[oe],className:babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe]()?x:G,onclick:babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce].bind(this)}}function Ve(){if(babelHelpers.classPrivateFieldLooseBase(this,te)[te]){return babelHelpers.classPrivateFieldLooseBase(this,te)[te].getCurrentSettings().getCurrentType()===r.Type.BY_LAST_ACTIVITY_TIME}if(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]){return babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].isLastActivitySortEnabled()}return false}function We(e,s){var t,a;(t=s.getMenuWindow())==null?void 0:(a=t.getRootMenuWindow())==null?void 0:a.close();s.disable();if(babelHelpers.classPrivateFieldLooseBase(this,te)[te]){if(babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]){return}babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]=true;const e=babelHelpers.classPrivateFieldLooseBase(this,te)[te].getCurrentSettings();const t=e.getCurrentType()===r.Type.BY_LAST_ACTIVITY_TIME?e.getSupportedTypes().find((e=>e!==r.Type.BY_LAST_ACTIVITY_TIME)):r.Type.BY_LAST_ACTIVITY_TIME;babelHelpers.classPrivateFieldLooseBase(this,te)[te].setCurrentSortType(t).then((()=>{})).catch((()=>{})).finally((()=>{babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]=false;s.enable()}))}else if(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]){babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].toggleLastActivitySort();s.enable()}else{throw new Error("Can not handle last activity toggle click")}}function $e(){return babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]}function Ye(){return babelHelpers.classPrivateFieldLooseBase(this,re)[re]&&babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]()}function ze(){const e=babelHelpers.classPrivateFieldLooseBase(this,we)[we]();const s=[];const t=babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].get(N);if(t){s.push({text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS"),disabled:babelHelpers.classPrivateFieldLooseBase(this,de)[de],items:t.getMenuItems(e)})}const a=babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].get(R);if(a){s.push({text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_OPEN_LINES"),disabled:babelHelpers.classPrivateFieldLooseBase(this,de)[de],items:a.getMenuItems(e)})}if(o.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,be)[be])){var i;s.push({text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_LANGUAGE_MSGVER_1"),onclick:(i=babelHelpers.classPrivateFieldLooseBase(this,we)[we](true))!=null?i:babelHelpers.classPrivateFieldLooseBase(this,me)[me].bind(this)})}if(s.length===0){return null}return{text:o.Loc.getMessage("CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_IN_CRM"),disabled:babelHelpers.classPrivateFieldLooseBase(this,de)[de],items:s}}function qe(e,s,t,a){var i,l,r,o;(i=a.getMenuWindow())==null?void 0:(l=i.getRootMenuWindow())==null?void 0:l.close();(r=a.getMenuWindow())==null?void 0:(o=r.getParentMenuItem())==null?void 0:o.disable();if(babelHelpers.classPrivateFieldLooseBase(this,de)[de]){return}babelHelpers.classPrivateFieldLooseBase(this,de)[de]=true;setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee](a)}),50)}async function Je(e){try{babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]=await babelHelpers.classPrivateFieldLooseBase(this,he)[he].saveWithErrorHandling(babelHelpers.classPrivateFieldLooseBase(this,ce)[ce]);babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]()}catch{}finally{var s,t;(s=e.getMenuWindow())==null?void 0:(t=s.getParentMenuItem())==null?void 0:t.enable();babelHelpers.classPrivateFieldLooseBase(this,de)[de]=false}}function Qe(e){const s=new t.Dialog({targetNode:e.target,multiple:false,showAvatars:false,dropdownMode:true,compactView:true,enableSearch:true,context:`COPILOT-LANGUAGE-SELECTOR-${babelHelpers.classPrivateFieldLooseBase(this,q)[q]}-${babelHelpers.classPrivateFieldLooseBase(this,J)[J]}`,width:U,tagSelectorOptions:{textBoxWidth:"100%"},preselectedItems:[["copilot_language",babelHelpers.classPrivateFieldLooseBase(this,be)[be]]],entities:[{id:"copilot_language",options:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,q)[q],categoryId:babelHelpers.classPrivateFieldLooseBase(this,J)[J]}}],events:{"Item:onSelect":e=>{const s=e.getData().item;const t=s.id.toLowerCase();if(!o.Type.isStringFilled(t)){throw new Error("Language ID is not defined")}setTimeout((()=>{let e=`ai_config_${babelHelpers.classPrivateFieldLooseBase(this,q)[q]}`;if(o.Type.isInteger(babelHelpers.classPrivateFieldLooseBase(this,J)[J])){e+=`_${babelHelpers.classPrivateFieldLooseBase(this,J)[J]}`}o.userOptions.save("crm",e,"languageId",t);babelHelpers.classPrivateFieldLooseBase(this,be)[be]=t}),k)}}});s.show()}function Ze(e=false){if(e){if(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].get("isAIEnabledInGlobalSettings")){return null}return()=>{if(o.Reflection.getClass("BX.UI.InfoHelper.show")){BX.UI.InfoHelper.show(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].get("aiDisabledSliderCode"))}}}if(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].get("isAIEnabledInGlobalSettings")&&babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].get("isAIHasPackages")){return null}return()=>{if(o.Reflection.getClass("BX.UI.InfoHelper.show")){if(!babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].get("isAIEnabledInGlobalSettings")){BX.UI.InfoHelper.show(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].get("aiDisabledSliderCode"))}else if(!babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].get("isAIHasPackages")){BX.UI.InfoHelper.show(babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].get("aiPackagesEmptySliderCode"))}}}}e.SettingsButtonExtender=Me})(this.BX.Crm=this.BX.Crm||{},BX.Event,BX.UI.EntitySelector,BX.Crm.Activity,BX.Crm.Activity,BX.CRM.Kanban,BX.CRM.Kanban,BX,BX.Main);
//# sourceMappingURL=settings-button-extender.bundle.map.js