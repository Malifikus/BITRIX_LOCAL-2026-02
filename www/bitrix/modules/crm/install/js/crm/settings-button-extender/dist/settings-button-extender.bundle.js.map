{"version":3,"file":"settings-button-extender.bundle.js","sources":["../src/params-handling.js","../src/grid/default-sort.js","../src/grid/sort-controller.js","../src/constants.js","../src/settings-migrator.js","../src/ai-settings-service.js","../src/handlers/base-channel-handler.js","../src/handlers/call-channel-handler.js","../src/handlers/chat-channel-handler.js","../src/handlers/channel-handler-factory.js","../src/settings-button-extender.js"],"sourcesContent":["import { Type } from 'main.core';\n\nexport function requireClassOrNull(param: any, constructor: Function, paramName: string): ?Object\n{\n\tif (Type.isNil(param))\n\t{\n\t\treturn param;\n\t}\n\n\treturn requireClass(param, constructor, paramName);\n}\n\nexport function requireClass(param: any, constructor: Function, paramName: string): Object\n{\n\tif (param instanceof constructor)\n\t{\n\t\treturn param;\n\t}\n\n\tthrow new Error(`Expected ${paramName} be an instance of ${constructor.name}, got ${getType(param)} instead`);\n}\n\nexport function requireArrayOfString(param: any, paramName: string): Array<string>\n{\n\tif (!Type.isArray(param))\n\t{\n\t\tthrow new TypeError(`Expected ${paramName} should be an array of strings, got ${getType(param)} instead`);\n\t}\n\n\tparam.forEach((value, index) => {\n\t\tif (!Type.isString(value))\n\t\t{\n\t\t\tthrow new TypeError(`Expected ${paramName} should be an array of strings, instead the element at index ${index} is ${getType(value)}`);\n\t\t}\n\t});\n\n\treturn param;\n}\n\nexport function requireStringOrNull(param: any, paramName: string): ?string\n{\n\tif (Type.isStringFilled(param) || Type.isNil(param))\n\t{\n\t\treturn param;\n\t}\n\n\tthrow new Error(`Expected ${paramName} be either non-empty string or null, got ${getType(param)} instead`);\n}\n\nfunction getType(value: any): string\n{\n\tif (Type.isObject(value) && !Type.isPlainObject(value))\n\t{\n\t\treturn value?.constructor?.name || 'unknown';\n\t}\n\n\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-typeof\n\treturn typeof value;\n}\n","import { Extension } from 'main.core';\n\nconst aliases: {[key: number]: string} = Extension.getSettings('crm.settings-button-extender').get('createTimeAliases', {});\n\nconst DefaultSort: {[key: number]: {column: string, order: 'asc' | 'desc'}} = {};\n\nfor (const entityTypeId in aliases)\n{\n\tDefaultSort[entityTypeId] = {\n\t\tcolumn: aliases[entityTypeId],\n\t\torder: 'desc',\n\t};\n}\n\nObject.freeze(DefaultSort);\n\nexport {\n\tDefaultSort,\n}\n","import { Text, Type } from 'main.core';\nimport { requireClass } from '../params-handling';\nimport { DefaultSort } from './default-sort';\n\nexport class SortController\n{\n\t#entityTypeId: number;\n\t#grid: BX.Main.grid;\n\n\tconstructor(entityTypeId: number, grid: BX.Main.grid)\n\t{\n\t\tthis.#entityTypeId = Text.toInteger(entityTypeId);\n\t\tthis.#grid = requireClass(grid, BX.Main.grid, 'grid');\n\t}\n\n\tisLastActivitySortSupported(): boolean\n\t{\n\t\treturn this.#isColumnExists('LAST_ACTIVITY_TIME');\n\t}\n\n\tisLastActivitySortEnabled(): boolean\n\t{\n\t\tconst options = this.#grid.getUserOptions().getCurrentOptions();\n\n\t\tconst column = options.last_sort_by;\n\t\tconst order = options.last_sort_order;\n\n\t\treturn (\n\t\t\tcolumn?.toLowerCase() === 'last_activity_time'\n\t\t\t&& order?.toLowerCase() === 'desc'\n\t\t);\n\t}\n\n\ttoggleLastActivitySort(): void\n\t{\n\t\tif (this.isLastActivitySortEnabled())\n\t\t{\n\t\t\tthis.#disableLastActivitySort();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#enableLastActivitySort();\n\t\t}\n\t}\n\n\tasync #disableLastActivitySort(): Promise<void>\n\t{\n\t\tconst sort = DefaultSort[this.#entityTypeId];\n\n\t\tlet column: string;\n\n\t\tif (Type.isPlainObject(sort) && this.#isColumnExists(sort.column) && this.#isColumnSortable(sort.column))\n\t\t{\n\t\t\tcolumn = sort.column;\n\n\t\t\tif (!this.#isColumnShowed(column))\n\t\t\t{\n\t\t\t\tawait this.#showColumn(column);\n\t\t\t}\n\n\t\t\tthis.#setSortOrder(column, sort.order);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// fist showed different sortable\n\t\t\tcolumn = this.#getShowedColumnList().find((columnName) => {\n\t\t\t\treturn (\n\t\t\t\t\tcolumnName !== 'LAST_ACTIVITY_TIME'\n\t\t\t\t\t&& this.#isColumnSortable(columnName)\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\tthis.#grid.sortByColumn(column);\n\t}\n\n\tasync #enableLastActivitySort(): Promise<void>\n\t{\n\t\tif (!this.#isColumnShowed('LAST_ACTIVITY_TIME'))\n\t\t{\n\t\t\tawait this.#showColumn('LAST_ACTIVITY_TIME');\n\t\t}\n\n\t\tthis.#setSortOrder('LAST_ACTIVITY_TIME', 'desc');\n\n\t\tthis.#grid.sortByColumn('LAST_ACTIVITY_TIME');\n\t}\n\n\t#isColumnExists(column: string): boolean\n\t{\n\t\treturn this.#grid.getParam('COLUMNS_ALL', {}).hasOwnProperty(column);\n\t}\n\n\t#isColumnShowed(column: string): boolean\n\t{\n\t\treturn this.#getShowedColumnList().includes(column);\n\t}\n\n\t#isColumnSortable(column: string): boolean\n\t{\n\t\tconst columnParams = this.#grid.getColumnByName(column);\n\n\t\treturn !!(columnParams && columnParams.sort !== false);\n\t}\n\n\t#getShowedColumnList(): string[]\n\t{\n\t\treturn this.#grid.getSettingsWindow().getShowedColumns();\n\t}\n\n\t#setSortOrder(column: string, order: 'asc' | 'desc'): void\n\t{\n\t\tthis.#grid.getColumnByName(column).sort_order = order;\n\t}\n\n\t#showColumn(column: string): Promise<void, string>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (!this.#isColumnExists(column))\n\t\t\t{\n\t\t\t\treject(new Error(`Column ${column} does not exists`));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.#isColumnShowed(column))\n\t\t\t{\n\t\t\t\treject(new Error(`Column ${column} is showed already`));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#grid.getSettingsWindow().select(column);\n\n\t\t\tconst showedColumns = this.#getShowedColumnList();\n\t\t\tshowedColumns.push(column);\n\n\t\t\tthis.#grid.getSettingsWindow().saveColumns(showedColumns, resolve);\n\t\t});\n\t}\n}\n","/**\n * channels for autostart copilot\n */\nexport const CHANNEL_TYPE_CALL = 'call';\nexport const CHANNEL_TYPE_CHAT = 'chat';\n\n/**\n * calls directions\n */\nexport const CALL_DIRECTION_INCOMING = 1;\nexport const CALL_DIRECTION_OUTGOING = 2;\n\n/**\n * popup menu CSS classes\n */\nexport const CHECKED_CLASS = 'menu-popup-item-accept';\nexport const NOT_CHECKED_CLASS = 'menu-popup-item-none';\n\n/**\n * other constants\n */\nexport const COPILOT_LANGUAGE_ID_SAVE_REQUEST_DELAY = 750;\nexport const COPILOT_LANGUAGE_SELECTOR_POPUP_WIDTH = 300;\n","import { Type } from 'main.core';\n\nimport { CALL_DIRECTION_INCOMING, CHANNEL_TYPE_CALL, CHANNEL_TYPE_CHAT } from './constants';\n\nexport class SettingsMigrator\n{\n\tstatic migrateToChannelFormat(settings: Object): Object\n\t{\n\t\tif (settings && settings.channels)\n\t\t{\n\t\t\treturn settings;\n\t\t}\n\n\t\t// old format migration to new format\n\t\tconst result = { channels: {} };\n\n\t\t// call settings\n\t\tif (\n\t\t\tsettings\n\t\t\t&& (settings.autostartOperationTypes || !Type.isUndefined(settings.autostartCallDirections))\n\t\t)\n\t\t{\n\t\t\tresult.channels[CHANNEL_TYPE_CALL] = {\n\t\t\t\tchannelType: CHANNEL_TYPE_CALL,\n\t\t\t\tautostartOperationTypes: settings.autostartOperationTypes || [],\n\t\t\t\t// eslint-disable-next-line max-len\n\t\t\t\tautostartTranscriptionOnlyOnFirstCallWithRecording: Boolean(settings.autostartTranscriptionOnlyOnFirstCallWithRecording),\n\t\t\t\tautostartCallDirections: settings.autostartCallDirections || [CALL_DIRECTION_INCOMING],\n\t\t\t};\n\t\t}\n\n\t\t// chat settings\n\t\tif (settings && !Type.isUndefined(settings.autostartOnlyFirstChat))\n\t\t{\n\t\t\tresult.channels[CHANNEL_TYPE_CHAT] = {\n\t\t\t\tchannelType: CHANNEL_TYPE_CHAT,\n\t\t\t\tautostartOperationTypes: [], // no such setting in old format\n\t\t\t\tautostartOnlyFirstChat: Boolean(settings.autostartOnlyFirstChat),\n\t\t\t};\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tstatic isValidChannelFormat(settings: Object): boolean\n\t{\n\t\tif (!Type.isPlainObject(settings))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isPlainObject(settings.channels))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// check each channel settings\n\t\tfor (const [channelType, channelSettings] of Object.entries(settings.channels))\n\t\t{\n\t\t\tif (!Type.isPlainObject(channelSettings))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (channelSettings.channelType !== channelType)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (!Type.isArrayFilled(channelSettings.autostartOperationTypes))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n}\n","import { ajax as Ajax } from 'main.core';\n\nexport class AISettingsService\n{\n\tconstructor(entityTypeId, categoryId): void\n\t{\n\t\tthis.entityTypeId = entityTypeId;\n\t\tthis.categoryId = categoryId;\n\t}\n\n\tsaveAutostartSettings(settings: Object): Promise\n\t{\n\t\treturn Ajax.runAction('crm.settings.ai.saveAutostartSettings', {\n\t\t\tjson: {\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tcategoryId: this.categoryId,\n\t\t\t\tsettings,\n\t\t\t},\n\t\t});\n\t}\n\n\tgetAutostartSettings(): Promise\n\t{\n\t\treturn Ajax.runAction('crm.settings.ai.getAutostartSettings', {\n\t\t\tjson: {\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tcategoryId: this.categoryId,\n\t\t\t},\n\t\t});\n\t}\n\n\tasync saveWithErrorHandling(settings): Promise\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst response = await this.saveAutostartSettings(settings);\n\n\t\t\treturn response.data.settings;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tawait console.error('Could not save ai settings', error);\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst response = await this.getAutostartSettings();\n\n\t\t\t\treturn response.data.settings;\n\t\t\t}\n\t\t\tcatch (fetchError)\n\t\t\t{\n\t\t\t\tawait console.error('Could not fetch ai settings after error in save', fetchError);\n\n\t\t\t\tthrow fetchError;\n\t\t\t}\n\t\t}\n\t}\n}\n","import { Text } from 'main.core';\nimport { MenuItem, MenuItemOptions } from 'main.popup';\n\nexport type ChannelParams = {\n\tautostartOperationTypes: number[],\n\tautostartTranscriptionOnlyOnFirstCallWithRecording?: boolean,\n\tautostartCallDirections?: string[],\n\tautostartOnlyFirstChat?: boolean,\n};\n\n/**\n * @abstract\n */\nexport class BaseChannelHandler\n{\n\tsettings: ChannelParams = null;\n\textensionSettings: Object = null;\n\tonActionClick: ?Function = null;\n\n\tconstructor(settings: ChannelParams, extensionSettings: Object)\n\t{\n\t\tthis.settings = settings;\n\t\tthis.extensionSettings = extensionSettings;\n\t}\n\n\tgetMenuItems(showInfoHelper: ?Function = null): MenuItemOptions[]\n\t{\n\t\tthrow new Error('Method getMenuItems must be implemented');\n\t}\n\n\thandleAction(action: string): void\n\t{\n\t\tthrow new Error('Method handleAction must be implemented');\n\t}\n\n\tisActionActive(action: string): boolean\n\t{\n\t\tthrow new Error('Method isActionActive must be implemented');\n\t}\n\n\tgetAllOperationTypes(): number[]\n\t{\n\t\treturn this.extensionSettings.get('allAIOperationTypes').map((id) => Text.toInteger(id));\n\t}\n\n\tgetTranscribeOperationType(): number\n\t{\n\t\treturn Text.toInteger(this.extensionSettings.get('transcribeAIOperationType'));\n\t}\n\n\thasAIPackages(): boolean\n\t{\n\t\treturn this.extensionSettings.get('isAIHasPackages');\n\t}\n\n\tcreateActionHandler(action: string): Function\n\t{\n\t\treturn (event: PointerEvent, menuItem: MenuItem) => {\n\t\t\tif (this.onActionClick)\n\t\t\t{\n\t\t\t\tthis.onActionClick(event, menuItem, action);\n\t\t\t}\n\n\t\t\tthis.handleAction(action);\n\t\t};\n\t}\n\n\tsetActionClickHandler(callback: Function): void\n\t{\n\t\tthis.onActionClick = callback;\n\t}\n}\n","import { Loc } from 'main.core';\nimport { MenuItemOptions } from 'main.popup';\n\nimport { CALL_DIRECTION_INCOMING, CALL_DIRECTION_OUTGOING, CHECKED_CLASS, NOT_CHECKED_CLASS } from '../constants';\n\nimport { BaseChannelHandler } from './base-channel-handler.js';\n\ntype CallAction = 'firstCall' | 'allCalls' | 'outgoingCalls' | 'allIncomingOutgoingCalls' | 'manual';\n\nexport class CallChannelHandler extends BaseChannelHandler\n{\n\tgetMenuItems(showInfoHelper: ?Function = null): MenuItemOptions[]\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_FIRST_INCOMING_MSGVER_1'),\n\t\t\t\tclassName: this.isActionActive('firstCall') ? CHECKED_CLASS : NOT_CHECKED_CLASS,\n\t\t\t\tonclick: showInfoHelper ?? this.createActionHandler('firstCall'),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_INCOMING'),\n\t\t\t\tclassName: this.isActionActive('allCalls') ? CHECKED_CLASS : NOT_CHECKED_CLASS,\n\t\t\t\tonclick: showInfoHelper ?? this.createActionHandler('allCalls'),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_OUTGOING'),\n\t\t\t\tclassName: this.isActionActive('outgoingCalls') ? CHECKED_CLASS : NOT_CHECKED_CLASS,\n\t\t\t\tonclick: showInfoHelper ?? this.createActionHandler('outgoingCalls'),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS_PROCESSING_ALL_MSGVER_1'),\n\t\t\t\tclassName: this.isActionActive('allIncomingOutgoingCalls') ? CHECKED_CLASS : NOT_CHECKED_CLASS,\n\t\t\t\tonclick: showInfoHelper ?? this.createActionHandler('allIncomingOutgoingCalls'),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_MANUAL_CALLS_PROCESSING_MSGVER_1'),\n\t\t\t\tclassName: this.isActionActive('manual') ? CHECKED_CLASS : NOT_CHECKED_CLASS,\n\t\t\t\tonclick: showInfoHelper ?? this.createActionHandler('manual'),\n\t\t\t},\n\t\t];\n\t}\n\n\thandleAction(action: CallAction): void\n\t{\n\t\tconst operationTypes = this.getAllOperationTypes();\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase 'manual':\n\t\t\t\tthis.settings.autostartOperationTypes = this.getAllOperationTypes().filter(\n\t\t\t\t\t(typeId) => typeId !== this.getTranscribeOperationType(),\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase 'firstCall':\n\t\t\t\tthis.settings.autostartOperationTypes = operationTypes;\n\t\t\t\tthis.settings.autostartTranscriptionOnlyOnFirstCallWithRecording = true;\n\t\t\t\tthis.settings.autostartCallDirections = [CALL_DIRECTION_INCOMING];\n\t\t\t\tbreak;\n\t\t\tcase 'allCalls':\n\t\t\t\tthis.settings.autostartOperationTypes = operationTypes;\n\t\t\t\tthis.settings.autostartTranscriptionOnlyOnFirstCallWithRecording = false;\n\t\t\t\tthis.settings.autostartCallDirections = [CALL_DIRECTION_INCOMING];\n\t\t\t\tbreak;\n\t\t\tcase 'outgoingCalls':\n\t\t\t\tthis.settings.autostartOperationTypes = operationTypes;\n\t\t\t\tthis.settings.autostartTranscriptionOnlyOnFirstCallWithRecording = false;\n\t\t\t\tthis.settings.autostartCallDirections = [CALL_DIRECTION_OUTGOING];\n\t\t\t\tbreak;\n\t\t\tcase 'allIncomingOutgoingCalls':\n\t\t\t\tthis.settings.autostartOperationTypes = operationTypes;\n\t\t\t\tthis.settings.autostartTranscriptionOnlyOnFirstCallWithRecording = false;\n\t\t\t\tthis.settings.autostartCallDirections = [\n\t\t\t\t\tCALL_DIRECTION_INCOMING,\n\t\t\t\t\tCALL_DIRECTION_OUTGOING,\n\t\t\t\t];\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\t}\n\n\tisActionActive(action: CallAction): boolean\n\t{\n\t\tconst isTranscriptionEnabled = this.settings\n\t\t\t.autostartOperationTypes\n\t\t\t.includes(this.getTranscribeOperationType())\n\t\t;\n\t\tconst hasPackages = this.hasAIPackages();\n\t\tconst isOnlyFirst = this.settings.autostartTranscriptionOnlyOnFirstCallWithRecording;\n\t\tconst directions = this.settings.autostartCallDirections || [];\n\n\t\tconst isOnlyIncoming = directions.length === 1 && directions.includes(CALL_DIRECTION_INCOMING);\n\t\tconst isOnlyOutgoing = directions.length === 1 && directions.includes(CALL_DIRECTION_OUTGOING);\n\t\tconst isBothDirections = directions.includes(CALL_DIRECTION_INCOMING)\n\t\t\t&& directions.includes(CALL_DIRECTION_OUTGOING)\n\t\t;\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase 'manual':\n\t\t\t\treturn !isTranscriptionEnabled || !hasPackages;\n\t\t\tcase 'firstCall':\n\t\t\t\treturn isTranscriptionEnabled && hasPackages && isOnlyFirst && isOnlyIncoming;\n\t\t\tcase 'allCalls':\n\t\t\t\treturn isTranscriptionEnabled && hasPackages && isOnlyIncoming && !isOnlyFirst;\n\t\t\tcase 'outgoingCalls':\n\t\t\t\treturn isTranscriptionEnabled && hasPackages && isOnlyOutgoing && !isOnlyFirst;\n\t\t\tcase 'allIncomingOutgoingCalls':\n\t\t\t\treturn isTranscriptionEnabled && hasPackages && isBothDirections && !isOnlyFirst;\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t}\n\t}\n}\n","import { Loc } from 'main.core';\nimport { MenuItemOptions } from 'main.popup';\n\nimport { CHECKED_CLASS, NOT_CHECKED_CLASS } from '../constants';\n\nimport { BaseChannelHandler } from './base-channel-handler.js';\n\ntype ChatAction = 'firstChat' | 'allChats' | 'manual';\n\nexport class ChatChannelHandler extends BaseChannelHandler\n{\n\tgetMenuItems(showInfoHelper: ?Function = null): MenuItemOptions[]\n\t{\n\t\treturn [\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_OPEN_LINES_PROCESSING_FIRST_CHAT'),\n\t\t\t\tclassName: this.isActionActive('firstChat') ? CHECKED_CLASS : NOT_CHECKED_CLASS,\n\t\t\t\tonclick: showInfoHelper ?? this.createActionHandler('firstChat'),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_OPEN_LINES_PROCESSING_ALL'),\n\t\t\t\tclassName: this.isActionActive('allChats') ? CHECKED_CLASS : NOT_CHECKED_CLASS,\n\t\t\t\tonclick: showInfoHelper ?? this.createActionHandler('allChats'),\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_MANUAL_CALLS_PROCESSING_MSGVER_1'),\n\t\t\t\tclassName: this.isActionActive('manual') ? CHECKED_CLASS : NOT_CHECKED_CLASS,\n\t\t\t\tonclick: showInfoHelper ?? this.createActionHandler('manual'),\n\t\t\t},\n\t\t];\n\t}\n\n\thandleAction(action: ChatAction): void\n\t{\n\t\tconst operationTypes = this.getAllOperationTypes();\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase 'firstChat':\n\t\t\t\tthis.settings.autostartOperationTypes = operationTypes;\n\t\t\t\tthis.settings.autostartOnlyFirstChat = true;\n\t\t\t\tbreak;\n\t\t\tcase 'allChats':\n\t\t\t\tthis.settings.autostartOperationTypes = operationTypes;\n\t\t\t\tthis.settings.autostartOnlyFirstChat = false;\n\t\t\t\tbreak;\n\t\t\tcase 'manual':\n\t\t\t\tthis.settings.autostartOperationTypes = [];\n\t\t\t\tthis.settings.autostartOnlyFirstChat = false;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t}\n\t}\n\n\tisActionActive(action: ChatAction): boolean\n\t{\n\t\tconst hasPackages = this.hasAIPackages();\n\t\tconst isOnlyFirst = this.settings.autostartOnlyFirstChat;\n\t\tconst hasOperations = (this.settings.autostartOperationTypes || []).length > 0;\n\n\t\tswitch (action)\n\t\t{\n\t\t\tcase 'firstChat':\n\t\t\t\treturn hasPackages && hasOperations && isOnlyFirst;\n\t\t\tcase 'allChats':\n\t\t\t\treturn hasPackages && hasOperations && !isOnlyFirst;\n\t\t\tcase 'manual':\n\t\t\t\treturn !hasOperations || !hasPackages;\n\t\t\tdefault:\n\t\t\t\treturn false;\n\t\t}\n\t}\n}\n","import { CHANNEL_TYPE_CALL, CHANNEL_TYPE_CHAT } from '../constants';\n\nimport type { ChannelParams } from './base-channel-handler';\nimport { BaseChannelHandler } from './base-channel-handler';\nimport { CallChannelHandler } from './call-channel-handler';\nimport { ChatChannelHandler } from './chat-channel-handler';\n\ntype ChannelType = CHANNEL_TYPE_CALL | CHANNEL_TYPE_CHAT;\n\nexport class ChannelHandlerFactory\n{\n\t// eslint-disable-next-line max-len\n\tstatic create(channelType: ChannelType, settings: ChannelParams, extensionSettings): BaseChannelHandler | null\n\t{\n\t\tswitch (channelType)\n\t\t{\n\t\t\tcase CHANNEL_TYPE_CALL:\n\t\t\t\treturn new CallChannelHandler(settings, extensionSettings);\n\t\t\tcase CHANNEL_TYPE_CHAT:\n\t\t\t\treturn new ChatChannelHandler(settings, extensionSettings);\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unknown channel type: ${channelType}`);\n\t\t}\n\t}\n\n\tstatic getSupportedChannelTypes(): ChannelType[]\n\t{\n\t\treturn [\n\t\t\tCHANNEL_TYPE_CALL,\n\t\t\tCHANNEL_TYPE_CHAT,\n\t\t];\n\t}\n}\n","import { Extension, Loc, Reflection, Text, Type, userOptions as UserOptions } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Menu, MenuItemOptions } from 'main.popup';\nimport { Dialog } from 'ui.entity-selector';\nimport { TodoNotificationSkipMenu } from 'crm.activity.todo-notification-skip-menu';\nimport { TodoPingSettingsMenu } from 'crm.activity.todo-ping-settings-menu';\nimport { Restriction } from 'crm.kanban.restriction';\nimport { SettingsController, Type as SortType } from 'crm.kanban.sort';\n\nimport { SortController as GridSortController } from './grid/sort-controller.js';\nimport { SettingsMigrator } from './settings-migrator';\nimport { AISettingsService } from './ai-settings-service';\nimport { BaseChannelHandler } from './handlers/base-channel-handler';\nimport {\n\tCHANNEL_TYPE_CALL,\n\tCHANNEL_TYPE_CHAT,\n\tCHECKED_CLASS,\n\tCOPILOT_LANGUAGE_ID_SAVE_REQUEST_DELAY,\n\tCOPILOT_LANGUAGE_SELECTOR_POPUP_WIDTH,\n\tNOT_CHECKED_CLASS,\n} from './constants';\n\nimport { requireArrayOfString, requireClass, requireClassOrNull, requireStringOrNull } from './params-handling';\nimport { ChannelHandlerFactory } from './handlers/channel-handler-factory';\n\nconst EntityType = Reflection.getClass('BX.CrmEntityType');\n\nexport type SettingsButtonExtenderParams = {\n\tentityTypeId: number,\n\tcategoryId: ?number,\n\taiAutostartSettings: ?string, // json\n\taiCopilotLanguageId: ?string,\n\tpingSettings: Object,\n\trootMenu: Menu,\n\ttodoCreateNotificationSkipPeriod: ?string,\n\ttargetItemId: ?string,\n\texpandsBehindThan: Array<string>;\n\tcontroller: ?SettingsController,\n\trestriction: ?Restriction,\n\tgrid: ?BX.Main.grid,\n\tsmartActivityNotificationSupported: ?boolean,\n};\n\n/**\n * @memberOf BX.Crm\n */\nexport class SettingsButtonExtender\n{\n\t#entityTypeId: number;\n\t#categoryId: ?number;\n\t#pingSettings: Object;\n\t#rootMenu: Menu;\n\t#targetItemId: ?string;\n\t#expandsBehindThan: Array<string>;\n\t#kanbanController: ?SettingsController;\n\t#restriction: ?Restriction;\n\t#gridController: ?GridSortController = null;\n\n\t#todoSkipMenu: TodoNotificationSkipMenu;\n\t#todoPingSettingsMenu: TodoPingSettingsMenu;\n\n\t#isSetSortRequestRunning: boolean = false;\n\t#smartActivityNotificationSupported: boolean = false;\n\n\t#aiAutostartSettings: null | Object = null;\n\t#aiCopilotLanguageId: null | string = null;\n\t#isSetAiSettingsRequestRunning: boolean = false;\n\n\t#extensionSettings: Collections.SettingsCollection = Extension.getSettings('crm.settings-button-extender');\n\t#channelHandlers = new Map();\n\t#aiSettingsService: AISettingsService;\n\n\tconstructor(params: SettingsButtonExtenderParams)\n\t{\n\t\tthis.#initializeProperties(params);\n\t\tthis.#initializeMenus(params);\n\t\tthis.#parseAISettings(params.aiAutostartSettings);\n\t\tthis.#initializeChannelHandlers();\n\t\tthis.#bindEvents();\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#channelHandlers.clear();\n\n\t\tEventEmitter.unsubscribeAll(EventEmitter.GLOBAL_TARGET, 'onPopupShow');\n\t}\n\n\t#initializeProperties(params: SettingsButtonExtenderParams): void\n\t{\n\t\tthis.#entityTypeId = Text.toInteger(params.entityTypeId);\n\t\tthis.#categoryId = Type.isInteger(params.categoryId) ? params.categoryId : null;\n\t\tthis.#pingSettings = Type.isPlainObject(params.pingSettings) ? params.pingSettings : {};\n\t\tthis.#expandsBehindThan = requireArrayOfString(params.expandsBehindThan ?? [], 'params.expandsBehindThan');\n\t\tthis.#smartActivityNotificationSupported = Text.toBoolean(params.smartActivityNotificationSupported);\n\n\t\tif (EntityType && !EntityType.isDefined(this.#entityTypeId))\n\t\t{\n\t\t\tthrow new Error(`Provided entityTypeId is invalid: ${this.#entityTypeId}`);\n\t\t}\n\n\t\tthis.#rootMenu = requireClass(params.rootMenu, Menu, 'params.rootMenu');\n\t\tthis.#targetItemId = requireStringOrNull(params.targetItemId, 'params.targetItemId');\n\n\t\tthis.#kanbanController = requireClassOrNull(params.controller, SettingsController, 'params.controller');\n\t\tthis.#restriction = requireClassOrNull(params.restriction, Restriction, 'params.restriction');\n\n\t\tif (Reflection.getClass('BX.Main.grid') && params.grid)\n\t\t{\n\t\t\tthis.#gridController = new GridSortController(this.#entityTypeId, params.grid);\n\t\t}\n\n\t\tthis.#aiCopilotLanguageId = params.aiCopilotLanguageId;\n\t\tthis.#aiSettingsService = new AISettingsService(this.#entityTypeId, this.#categoryId);\n\t}\n\n\t#initializeMenus(params: SettingsButtonExtenderParams): void\n\t{\n\t\tthis.#todoSkipMenu = new TodoNotificationSkipMenu({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tselectedValue: requireStringOrNull(params.todoCreateNotificationSkipPeriod, 'params.todoCreateNotificationSkipPeriod'),\n\t\t});\n\n\t\tif (Object.keys(this.#pingSettings).length > 0)\n\t\t{\n\t\t\tthis.#todoPingSettingsMenu = new TodoPingSettingsMenu({\n\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\tsettings: this.#pingSettings,\n\t\t\t});\n\t\t}\n\t}\n\n\t#parseAISettings(aiSettingsJson: string | null): void\n\t{\n\t\tconst settingsJson = requireStringOrNull(aiSettingsJson, 'params.aiAutostartSettings');\n\t\tif (!Type.isStringFilled(settingsJson))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst rawSettings = JSON.parse(settingsJson);\n\t\t\tif (Type.isPlainObject(rawSettings))\n\t\t\t{\n\t\t\t\tthis.#aiAutostartSettings = SettingsMigrator.migrateToChannelFormat(rawSettings);\n\t\t\t}\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthrow new Error('Failed to parse AI settings:', error);\n\t\t}\n\t}\n\n\t#initializeChannelHandlers(): void\n\t{\n\t\tthis.#channelHandlers.clear();\n\n\t\tif (!this.#aiAutostartSettings?.channels)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tObject.entries(this.#aiAutostartSettings.channels).forEach(([channelType, settings]) => {\n\t\t\tconst handler = ChannelHandlerFactory.create(channelType, settings, this.#extensionSettings);\n\t\t\tif (handler)\n\t\t\t{\n\t\t\t\thandler.setActionClickHandler((event, menuItem, action) => {\n\t\t\t\t\tthis.#handleChannelAction(channelType, action, event, menuItem);\n\t\t\t\t});\n\n\t\t\t\tthis.#channelHandlers.set(channelType, handler);\n\t\t\t}\n\t\t});\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tconst createdMenuItemIds = [];\n\n\t\tEventEmitter.subscribe(EventEmitter.GLOBAL_TARGET, 'onPopupShow', (event: BaseEvent) => {\n\t\t\tconst popup = event.getTarget();\n\t\t\tif (popup.getId() !== this.#rootMenu.getId())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst items = this.#getItems();\n\t\t\tif (items.length <= 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twhile (createdMenuItemIds.length > 0)\n\t\t\t{\n\t\t\t\tthis.#rootMenu.removeMenuItem(createdMenuItemIds.pop());\n\t\t\t}\n\n\t\t\tlet targetItemId = this.#resolveEarlyTargetId();\n\t\t\tfor (const item of items.reverse()) // new item is *prepended* on top of target item, therefore reverse\n\t\t\t{\n\t\t\t\tconst newItem = this.#rootMenu.addMenuItem(\n\t\t\t\t\titem,\n\t\t\t\t\ttargetItemId,\n\t\t\t\t);\n\n\t\t\t\tif (newItem)\n\t\t\t\t{\n\t\t\t\t\ttargetItemId = newItem.getId();\n\t\t\t\t\tcreatedMenuItemIds.push(newItem.getId());\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t#getItems(): MenuItemOptions[]\n\t{\n\t\tconst items = [];\n\n\t\tconst pushCrmSettings = this.#getPushCrmSettings();\n\t\tif (pushCrmSettings)\n\t\t{\n\t\t\titems.push(pushCrmSettings);\n\t\t}\n\n\t\tconst coPilotSettings = this.#getCoPilotSettings();\n\t\tif (coPilotSettings)\n\t\t{\n\t\t\titems.push(coPilotSettings);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\t#resolveEarlyTargetId(): string | null\n\t{\n\t\tconst items = this.#rootMenu.getMenuItems();\n\t\tconst earlyItem = items.find((item: MenuItem) => this.#expandsBehindThan.includes(item.getId()));\n\n\t\treturn earlyItem?.getId() ?? this.#targetItemId;\n\t}\n\n\t#getPushCrmSettings(): ?MenuItemOptions\n\t{\n\t\tconst pushCrmItems = [];\n\n\t\tif (this.#shouldShowLastActivitySortToggle())\n\t\t{\n\t\t\tpushCrmItems.push(this.#getLastActivitySortToggle());\n\t\t}\n\n\t\tif (this.#shouldShowTodoSkipMenu())\n\t\t{\n\t\t\tpushCrmItems.push(...this.#todoSkipMenu.getItems());\n\t\t}\n\n\t\tif (this.#shouldShowTodoPingSettingsMenu())\n\t\t{\n\t\t\tpushCrmItems.push(...this.#todoPingSettingsMenu.getItems());\n\t\t}\n\n\t\tif (pushCrmItems.length <= 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_PUSH_CRM'),\n\t\t\titems: pushCrmItems,\n\t\t};\n\t}\n\n\t#shouldShowLastActivitySortToggle(): boolean\n\t{\n\t\tconst shouldShowInKanban = (\n\t\t\tthis.#kanbanController?.getCurrentSettings().isTypeSupported(SortType.BY_LAST_ACTIVITY_TIME)\n\t\t\t&& this.#restriction?.isSortTypeChangeAvailable()\n\t\t);\n\n\t\treturn !!(shouldShowInKanban || this.#gridController?.isLastActivitySortSupported());\n\t}\n\n\t#getLastActivitySortToggle(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_PUSH_CRM_TOGGLE_SORT'),\n\t\t\tdisabled: this.#isSetSortRequestRunning,\n\t\t\tclassName: this.#isLastActivitySortEnabled() ? CHECKED_CLASS : NOT_CHECKED_CLASS,\n\t\t\tonclick: this.#handleLastActivitySortToggleClick.bind(this),\n\t\t};\n\t}\n\n\t#isLastActivitySortEnabled(): boolean\n\t{\n\t\tif (this.#kanbanController)\n\t\t{\n\t\t\treturn this.#kanbanController.getCurrentSettings().getCurrentType() === SortType.BY_LAST_ACTIVITY_TIME;\n\t\t}\n\n\t\tif (this.#gridController)\n\t\t{\n\t\t\treturn this.#gridController.isLastActivitySortEnabled();\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t#handleLastActivitySortToggleClick(event: PointerEvent, item: MenuItem): void\n\t{\n\t\titem.getMenuWindow()?.getRootMenuWindow()?.close();\n\t\titem.disable();\n\n\t\tif (this.#kanbanController)\n\t\t{\n\t\t\tif (this.#isSetSortRequestRunning)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#isSetSortRequestRunning = true;\n\n\t\t\tconst settings = this.#kanbanController.getCurrentSettings();\n\n\t\t\tconst newSortType = settings.getCurrentType() === SortType.BY_LAST_ACTIVITY_TIME\n\t\t\t\t? settings.getSupportedTypes().find((sortType) => sortType !== SortType.BY_LAST_ACTIVITY_TIME)\n\t\t\t\t: SortType.BY_LAST_ACTIVITY_TIME\n\t\t\t;\n\n\t\t\tthis.#kanbanController.setCurrentSortType(newSortType)\n\t\t\t\t.then(() => {})\n\t\t\t\t.catch(() => {})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis.#isSetSortRequestRunning = false;\n\t\t\t\t\titem.enable();\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse if (this.#gridController)\n\t\t{\n\t\t\tthis.#gridController.toggleLastActivitySort();\n\t\t\titem.enable();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error('Can not handle last activity toggle click');\n\t\t}\n\t}\n\n\t#shouldShowTodoSkipMenu(): boolean\n\t{\n\t\treturn this.#smartActivityNotificationSupported;\n\t}\n\n\t#shouldShowTodoPingSettingsMenu(): boolean\n\t{\n\t\treturn this.#todoPingSettingsMenu && this.#shouldShowLastActivitySortToggle();\n\t}\n\n\t#getCoPilotSettings(): ?MenuItemOptions\n\t{\n\t\tconst showInfoHelper = this.#getInfoHelper();\n\t\tconst menuItems = [];\n\n\t\t// call settings\n\t\tconst callHandler = this.#channelHandlers.get(CHANNEL_TYPE_CALL);\n\t\tif (callHandler)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_CALLS'),\n\t\t\t\tdisabled: this.#isSetAiSettingsRequestRunning,\n\t\t\t\titems: callHandler.getMenuItems(showInfoHelper),\n\t\t\t});\n\t\t}\n\n\t\t// chat settings\n\t\tconst chatHandler = this.#channelHandlers.get(CHANNEL_TYPE_CHAT);\n\t\tif (chatHandler)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_AUTO_OPEN_LINES'),\n\t\t\t\tdisabled: this.#isSetAiSettingsRequestRunning,\n\t\t\t\titems: chatHandler.getMenuItems(showInfoHelper),\n\t\t\t});\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#aiCopilotLanguageId))\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_LANGUAGE_MSGVER_1'),\n\t\t\t\tonclick: this.#getInfoHelper(true) ?? this.#handleCoPilotLanguageSelect.bind(this),\n\t\t\t});\n\t\t}\n\n\t\tif (menuItems.length === 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttext: Loc.getMessage('CRM_SETTINGS_BUTTON_EXTENDER_COPILOT_IN_CRM'),\n\t\t\tdisabled: this.#isSetAiSettingsRequestRunning,\n\t\t\titems: menuItems,\n\t\t};\n\t}\n\n\t#handleChannelAction(channelType: string, action: string, event: PointerEvent, menuItem: MenuItem): void\n\t{\n\t\tmenuItem.getMenuWindow()?.getRootMenuWindow()?.close();\n\t\tmenuItem.getMenuWindow()?.getParentMenuItem()?.disable();\n\n\t\tif (this.#isSetAiSettingsRequestRunning)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isSetAiSettingsRequestRunning = true;\n\n\t\tsetTimeout(() => {\n\t\t\tthis.#saveAISettings(menuItem);\n\t\t}, 50);\n\t}\n\n\tasync #saveAISettings(menuItem: MenuItem): void\n\t{\n\t\ttry\n\t\t{\n\t\t\tthis.#aiAutostartSettings = await this.#aiSettingsService.saveWithErrorHandling(this.#aiAutostartSettings);\n\t\t\tthis.#initializeChannelHandlers();\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\t// error already handled in service\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tmenuItem.getMenuWindow()?.getParentMenuItem()?.enable();\n\n\t\t\tthis.#isSetAiSettingsRequestRunning = false;\n\t\t}\n\t}\n\n\t#handleCoPilotLanguageSelect(event: PointerEvent): void\n\t{\n\t\tconst languageSelector = new Dialog({\n\t\t\ttargetNode: event.target,\n\t\t\tmultiple: false,\n\t\t\tshowAvatars: false,\n\t\t\tdropdownMode: true,\n\t\t\tcompactView: true,\n\t\t\tenableSearch: true,\n\t\t\tcontext: `COPILOT-LANGUAGE-SELECTOR-${this.#entityTypeId}-${this.#categoryId}`,\n\t\t\twidth: COPILOT_LANGUAGE_SELECTOR_POPUP_WIDTH,\n\t\t\ttagSelectorOptions: {\n\t\t\t\ttextBoxWidth: '100%',\n\t\t\t},\n\t\t\tpreselectedItems: [\n\t\t\t\t['copilot_language', this.#aiCopilotLanguageId],\n\t\t\t],\n\t\t\tentities: [{\n\t\t\t\tid: 'copilot_language',\n\t\t\t\toptions: {\n\t\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\t\tcategoryId: this.#categoryId,\n\t\t\t\t},\n\t\t\t}],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (selectEvent: BaseEvent): void => {\n\t\t\t\t\tconst item = selectEvent.getData().item;\n\t\t\t\t\tconst languageId = item.id.toLowerCase();\n\t\t\t\t\tif (!Type.isStringFilled(languageId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthrow new Error('Language ID is not defined');\n\t\t\t\t\t}\n\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tlet optionName = `ai_config_${this.#entityTypeId}`;\n\t\t\t\t\t\tif (Type.isInteger(this.#categoryId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptionName += `_${this.#categoryId}`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tUserOptions.save('crm', optionName, 'languageId', languageId);\n\n\t\t\t\t\t\tthis.#aiCopilotLanguageId = languageId;\n\t\t\t\t\t}, COPILOT_LANGUAGE_ID_SAVE_REQUEST_DELAY);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tlanguageSelector.show();\n\t}\n\n\t#getInfoHelper(skipPackagesCheck: boolean = false): ?Function\n\t{\n\t\tif (skipPackagesCheck)\n\t\t{\n\t\t\tif (this.#extensionSettings.get('isAIEnabledInGlobalSettings'))\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (): void => {\n\t\t\t\tif (Reflection.getClass('BX.UI.InfoHelper.show'))\n\t\t\t\t{\n\t\t\t\t\tBX.UI.InfoHelper.show(this.#extensionSettings.get('aiDisabledSliderCode'));\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\tif (\n\t\t\tthis.#extensionSettings.get('isAIEnabledInGlobalSettings')\n\t\t\t&& this.#extensionSettings.get('isAIHasPackages')\n\t\t)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn (): void => {\n\t\t\tif (Reflection.getClass('BX.UI.InfoHelper.show'))\n\t\t\t{\n\t\t\t\tif (!this.#extensionSettings.get('isAIEnabledInGlobalSettings'))\n\t\t\t\t{\n\t\t\t\t\tBX.UI.InfoHelper.show(this.#extensionSettings.get('aiDisabledSliderCode'));\n\t\t\t\t}\n\t\t\t\telse if (!this.#extensionSettings.get('isAIHasPackages'))\n\t\t\t\t{\n\t\t\t\t\tBX.UI.InfoHelper.show(this.#extensionSettings.get('aiPackagesEmptySliderCode'));\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\t// region Public methods\n\tupdateAISettings(settings: Object): void\n\t{\n\t\tif (!SettingsMigrator.isValidChannelFormat(settings))\n\t\t{\n\t\t\tthrow new Error('Invalid settings format', settings);\n\t\t}\n\n\t\tthis.#aiAutostartSettings = settings;\n\t\tthis.#initializeChannelHandlers();\n\t}\n\n\tgetChannelHandler(channelType: string): BaseChannelHandler | null\n\t{\n\t\treturn this.#channelHandlers.get(channelType);\n\t}\n\n\tisChannelAvailable(channelType: string): boolean\n\t{\n\t\treturn this.#channelHandlers.has(channelType);\n\t}\n\n\tgetAvailableChannels(): string[]\n\t{\n\t\treturn [...this.#channelHandlers.keys()];\n\t}\n\t// endregion\n}\n"],"names":["requireClassOrNull","param","constructor","paramName","Type","isNil","requireClass","Error","name","getType","requireArrayOfString","isArray","TypeError","forEach","value","index","isString","requireStringOrNull","isStringFilled","isObject","isPlainObject","aliases","Extension","getSettings","get","DefaultSort","entityTypeId","column","order","Object","freeze","SortController","grid","Text","toInteger","BX","Main","isLastActivitySortSupported","isLastActivitySortEnabled","options","getUserOptions","getCurrentOptions","last_sort_by","last_sort_order","toLowerCase","toggleLastActivitySort","sort","find","columnName","sortByColumn","getParam","hasOwnProperty","includes","columnParams","getColumnByName","getSettingsWindow","getShowedColumns","sort_order","Promise","resolve","reject","select","showedColumns","push","saveColumns","CHANNEL_TYPE_CALL","CHANNEL_TYPE_CHAT","CALL_DIRECTION_INCOMING","CALL_DIRECTION_OUTGOING","CHECKED_CLASS","NOT_CHECKED_CLASS","COPILOT_LANGUAGE_ID_SAVE_REQUEST_DELAY","COPILOT_LANGUAGE_SELECTOR_POPUP_WIDTH","SettingsMigrator","migrateToChannelFormat","settings","channels","result","autostartOperationTypes","isUndefined","autostartCallDirections","channelType","autostartTranscriptionOnlyOnFirstCallWithRecording","Boolean","autostartOnlyFirstChat","isValidChannelFormat","channelSettings","entries","isArrayFilled","AISettingsService","categoryId","saveAutostartSettings","Ajax","runAction","json","getAutostartSettings","saveWithErrorHandling","response","data","error","console","fetchError","BaseChannelHandler","extensionSettings","onActionClick","getMenuItems","showInfoHelper","handleAction","action","isActionActive","getAllOperationTypes","map","id","getTranscribeOperationType","hasAIPackages","createActionHandler","event","menuItem","setActionClickHandler","callback","CallChannelHandler","text","Loc","getMessage","className","onclick","operationTypes","filter","typeId","isTranscriptionEnabled","hasPackages","isOnlyFirst","directions","isOnlyIncoming","length","isOnlyOutgoing","isBothDirections","ChatChannelHandler","hasOperations","ChannelHandlerFactory","create","getSupportedChannelTypes","EntityType","Reflection","getClass","SettingsButtonExtender","params","Map","aiAutostartSettings","destroy","clear","EventEmitter","unsubscribeAll","GLOBAL_TARGET","updateAISettings","getChannelHandler","isChannelAvailable","has","getAvailableChannels","keys","isInteger","pingSettings","expandsBehindThan","toBoolean","smartActivityNotificationSupported","isDefined","rootMenu","Menu","targetItemId","controller","SettingsController","restriction","Restriction","GridSortController","aiCopilotLanguageId","TodoNotificationSkipMenu","selectedValue","todoCreateNotificationSkipPeriod","TodoPingSettingsMenu","aiSettingsJson","settingsJson","rawSettings","JSON","parse","handler","set","createdMenuItemIds","subscribe","popup","getTarget","getId","items","removeMenuItem","pop","item","reverse","newItem","addMenuItem","pushCrmSettings","coPilotSettings","earlyItem","pushCrmItems","getItems","shouldShowInKanban","getCurrentSettings","isTypeSupported","SortType","BY_LAST_ACTIVITY_TIME","isSortTypeChangeAvailable","disabled","bind","getCurrentType","getMenuWindow","getRootMenuWindow","close","disable","newSortType","getSupportedTypes","sortType","setCurrentSortType","then","catch","finally","enable","menuItems","callHandler","chatHandler","getParentMenuItem","setTimeout","languageSelector","Dialog","targetNode","target","multiple","showAvatars","dropdownMode","compactView","enableSearch","context","width","tagSelectorOptions","textBoxWidth","preselectedItems","entities","events","selectEvent","getData","languageId","optionName","UserOptions","save","show","skipPackagesCheck","UI","InfoHelper"],"mappings":"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"}