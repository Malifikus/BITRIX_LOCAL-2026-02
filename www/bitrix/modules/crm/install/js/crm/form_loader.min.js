(function(){function e(e){if(window.console&&console.warn){}}e();function t(e){return e.match(/((http|https):\/\/[^\/]+?)\//)[1]}var i=function(){var e=document.querySelector('script[src*="/bitrix/js/crm/form_loader.js"]');if(e&&e.src){return t(e.src)}return null}();var n={};try{n=JSON.parse(window.sessionStorage.getItem("b24:form:compatible:loaders"))||{}}catch(e){}var o=[];function r(e,t){o.push(e);e.compatibility={id:Math.random().toString().split(".")[1]+Math.random().toString().split(".")[1]};var i=document.createElement("div");i.innerHTML=t.form[e.type];i=i.children[0];i.dataset.b24Id=e.compatibility.id;e.compatibility.anchorScript=i;var n=document.createElement("script");n.type="text/javascript";n.appendChild(document.createTextNode(i.textContent));if(e.click&&e.type==="click"){e.click.forEach((function(e){e.parentNode.insertBefore(i.cloneNode(true),e)}))}else if(e.node){e.node.appendChild(i)}else if(e.defaultNode){if(e.defaultNode.nextElementSibling){e.defaultNode.parentNode.insertBefore(i,e.defaultNode.nextElementSibling)}else if(e.defaultNode){e.defaultNode.parentNode.appendChild(i)}}else{return}if(o.length===1){window.addEventListener("b24:form:init:before",(function(e){var t=e.detail.data;var i=e.detail.object;if(!t||!t.identification){return}var n=o.filter((function(e){if(parseInt(t.identification.id)!==parseInt(e.id)){return false}if(t.identification.sec!==e.sec){return false}if(t.id&&e.compatibility&&e.compatibility.id){return parseInt(t.id)===parseInt(e.compatibility.id)}return true}))[0];if(!n){return}if(n.compatibility&&i){n.compatibility.instance=i}window.b24form.Compatibility.applyOldenLoaderData(t,n)}))}document.head.appendChild(n)}var a={};function c(e){var o=t(e.ref)||i;if(!o){throw new Error("Could not load form without parameter `ref`")}var c=o+"|"+e.id;if(n[c]){r(e,n[c]);return}if(!a[c]){a[c]=new Promise((function(t,i){var r=o+"/bitrix/services/main/ajax.php?action=crm.site.form.get"+"&id="+e.id+"&sec="+e.sec+"&loaderOnly=y";window.fetch(r,{method:"GET",mode:"cors",cache:"no-cache",headers:{Origin:window.location.origin}}).then((function(e){return e.json()})).then((function(i){n[c]=i.result.loader;try{window.sessionStorage.setItem("b24:form:compatible:loaders",JSON.stringify(n))}catch(e){}t(e,i.result.loader)})).catch(i)}))}a[c].then((function(){r(e,n[c])}))}function d(e){if(!e.compatibility||!e.compatibility.instance){return}e.compatibility.instance.destroy();e.compatibility.anchorScript.remove()}window.Bitrix24FormLoader={init:function(){this.yaId=null;this.forms={};this.eventHandlers=[];this.frameHeight="200";this.defaultNodeId="bx24_form_";if(!window.Bitrix24FormObject||!window[window.Bitrix24FormObject])return;var e=window[window.Bitrix24FormObject];e.forms=e.forms||[];var t=e.forms;t.ntpush=t.push;t.push=function(e){t.ntpush(e);this.preLoad(e)}.bind(this);t.forEach(this.preLoad,this)},preLoad:function(e){var t=e.defaultNode=document.getElementById(this.defaultNodeId+e.type);if(!e.node&&!e.defaultNode){throw new Error("Could not load form: node not found.")}switch(e.type){case"click":case"button":case"link":var i=e.click||Array.prototype.slice.call(document.getElementsByClassName("b24-web-form-popup-btn-"+e.id));if(i&&Object.prototype.toString.call(i)!=="[object Array]"){i=[i]}if(!i&&t){i=[t.nextElementSibling]}e.click=i;e.type="click";break;case"delay":e.type="auto";break;case"inline":default:e.type="inline";break}this.load(e)},createPopup:function(t){e()},resizePopup:function(){e()},showPopup:function(t){e()},hidePopup:function(t){e()},scrollToPopupMiddle:function(t){e()},util:{addClass:function(e,t){if(e&&typeof e.className=="string"&&e.className.indexOf(t)===-1){e.className+=" "+t;e.className=e.className.replace("  "," ")}},removeClass:function(e,t){if(!e||!e.className){return}e.className=e.className.replace(t,"").replace("  "," ")},hasClass:function(e,t){var i=this.nodeListToArray(e.classList);var n=i.filter((function(e){return e==t}));return n.length>0},isIOS:function(){return/(iPad;)|(iPhone;)/i.test(navigator.userAgent)},isMobile:function(){return/(ipad|iphone|android|mobile|touch)/i.test(navigator.userAgent)}},createFrame:function(t){e()},getUniqueLoadId:function(e){var t=e.type;switch(t){case"click":case"button":case"link":t="button";break}return t+"_"+e.id},isFormExisted:function(e){return!!this.forms[this.getUniqueLoadId(e)]},load:function(e){e.loaded=false;e.handlers=e.handlers||{};e.options=e.options||{};c(e)},unload:function(e){e=e||{};d(e);var t=this.getUniqueLoadId(e);this.forms[t]=null},doFrameAction:function(t,i){e()},checkHash:function(t){e()},sendDataToFrame:function(t,i){e()},onFrameLoad:function(t){e()},isGuestLoaded:function(){return window.b24Tracker&&window.b24Tracker.guest},guestLoadedChecker:function(){e()},onGuestLoaded:function(){e()},addEventListener:function(e,t,i){e=e||window;if(window.addEventListener){e.addEventListener(t,i,false)}else{e.attachEvent("on"+t,i)}},addEventHandler:function(t,i,n){e()},execEventHandler:function(t,i,n){e()},setFrameHeight:function(t,i){e()}};window.Bitrix24FormLoader.init()})();
//# sourceMappingURL=form_loader.map.js