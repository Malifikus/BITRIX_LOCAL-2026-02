{"version":3,"file":"editor.bundle.js","sources":["../src/menu-popup.js","../src/preview-popup.js","../src/previewer.js","../src/text-popup.js","../src/utils.js","../src/editor.js"],"sourcesContent":["import { Loc, Runtime, Text } from 'main.core';\nimport { Menu, MenuItemOptions, MenuManager } from 'main.popup';\n\nexport default class MenuPopup\n{\n\t#menu: Menu = null;\n\t#bindElement: HTMLElement = null;\n\t#isTextItemFirst: boolean = false;\n\t#onEditorItemClick: Function = () => {};\n\t#onTextItemClick: Function = () => {};\n\n\tconstructor({ bindElement, isTextItemFirst, onEditorItemClick, onTextItemClick })\n\t{\n\t\tthis.#bindElement = bindElement;\n\t\tthis.#isTextItemFirst = isTextItemFirst;\n\t\tthis.#onEditorItemClick = onEditorItemClick;\n\t\tthis.#onTextItemClick = onTextItemClick;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getMenuPopup().show();\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#menu?.destroy();\n\t\tthis.#menu = null;\n\n\t\tRuntime.destroy(this);\n\t}\n\n\t#getMenuPopup(): Menu\n\t{\n\t\tif (this.#menu === null)\n\t\t{\n\t\t\tthis.#menu = MenuManager.create({\n\t\t\t\tid: 'crm-template-editor-placeholder-selector',\n\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: 20,\n\t\t\t\tangle: true,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tcacheable: false,\n\t\t\t\titems: this.#getItems(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t#getItems(): Object[]\n\t{\n\t\tconst editorItem = this.#getEditorItem();\n\t\tconst textItem = this.#getTextItem();\n\n\t\tif (this.#isTextItemFirst)\n\t\t{\n\t\t\treturn [\n\t\t\t\ttextItem,\n\t\t\t\teditorItem,\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\teditorItem,\n\t\t\ttextItem,\n\t\t];\n\t}\n\n\t#getEditorItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\thtml: this.#getItemTitle('CRM_TEMPLATE_EDITOR_SELECT_FIELD'),\n\t\t\tonclick: () => {\n\t\t\t\tthis.#onEditorItemClick(this.#bindElement);\n\t\t\t},\n\t\t};\n\t}\n\n\t#getTextItem(): MenuItemOptions\n\t{\n\t\tconst code = (\n\t\t\tthis.#isTextItemFirst\n\t\t\t\t? 'CRM_TEMPLATE_EDITOR_UPDATE_TEXT'\n\t\t\t\t: 'CRM_TEMPLATE_EDITOR_CREATE_TEXT'\n\t\t);\n\n\t\treturn {\n\t\t\thtml: this.#getItemTitle(code),\n\t\t\tonclick: () => {\n\t\t\t\tthis.#getMenuPopup().close();\n\t\t\t\tthis.#onTextItemClick(this.#bindElement);\n\t\t\t},\n\t\t};\n\t}\n\n\t#getItemTitle(code: string): string\n\t{\n\t\tconst placeholder = '<span class=\"crm-template-editor-placeholder-selector-menu-item\">#ITEM_TEXT#</span>';\n\n\t\treturn placeholder.replace('#ITEM_TEXT#', Text.encode(Loc.getMessage(code)));\n\t}\n}\n","import { Dom, Loc, Tag, Text } from 'main.core';\nimport { Popup, PopupWindowManager } from 'main.popup';\nimport { UI } from 'ui.notification';\nimport { ProgressBar } from 'ui.progressbar';\n\nexport const PREVIEW_POPUP_CONTENT_STATUS = {\n\tLOADING: 1,\n\tSUCCESS: 2,\n\tFAILED: 3,\n};\n\nexport default class PreviewPopup\n{\n\t#popup: Popup = null;\n\t#bindElement: HTMLElement = null;\n\t#previewContentContainer: HTMLElement = null;\n\t#previewLoader: ProgressBar = null;\n\t#entityTypeId: number = null;\n\t#entityId: number = null;\n\n\tconstructor(bindElement: HTMLElement, entityTypeId: number, entityId: number)\n\t{\n\t\tthis.#bindElement = bindElement;\n\t\tthis.#entityTypeId = entityTypeId;\n\t\tthis.#entityId = entityId;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#getPopup()?.destroy();\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#getPopup()?.isShown() ?? false;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getPopup()?.show();\n\t}\n\n\tapply(status: number, data: string = ''): void\n\t{\n\t\tconst closeIconElement = this\n\t\t\t.#getPopup()\n\t\t\t.getPopupContainer()\n\t\t\t.querySelector('.popup-window-close-icon')\n\t\t;\n\n\t\tswitch (status)\n\t\t{\n\t\t\tcase PREVIEW_POPUP_CONTENT_STATUS.LOADING:\n\t\t\t{\n\t\t\t\tDom.addClass(closeIconElement, '--hidden');\n\n\t\t\t\tthis.#previewContentContainer.innerText = '';\n\n\t\t\t\tif (!this.#previewLoader)\n\t\t\t\t{\n\t\t\t\t\tthis.#previewLoader = new ProgressBar({\n\t\t\t\t\t\tcolor: ProgressBar.Color.PRIMARY,\n\t\t\t\t\t\tsize: 10,\n\t\t\t\t\t\tmaxValue: 100,\n\t\t\t\t\t\tvalue: 30,\n\t\t\t\t\t\tinfiniteLoading: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.#getPopup().setHeight(75);\n\t\t\t\tthis.#previewLoader.renderTo(this.#previewContentContainer);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase PREVIEW_POPUP_CONTENT_STATUS.SUCCESS:\n\t\t\t{\n\t\t\t\tthis.#getPopup().setHeight(null);\n\t\t\t\tthis.#getPopup().setAutoHide(true);\n\t\t\t\tthis.#previewContentContainer.innerText = data;\n\n\t\t\t\tDom.removeClass(closeIconElement, '--hidden');\n\t\t\t\tDom.addClass(this.#previewContentContainer, '--loaded');\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase PREVIEW_POPUP_CONTENT_STATUS.FAILED:\n\t\t\t{\n\t\t\t\tthis.#getPopup().destroy();\n\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Text.encode(data),\n\t\t\t\t\tautoHideDelay: 5000,\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tthrow new TypeError(`Unsupported preview popup content status ${status}`);\n\t\t}\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif (this.#popup === null)\n\t\t{\n\t\t\tthis.#popup = PopupWindowManager.create({\n\t\t\t\tid: `crm-template-editor-preview-popup-${this.#entityTypeId}-${this.#entityId}`,\n\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\tcloseIcon: { top: '10px' },\n\t\t\t\tcacheable: false,\n\t\t\t\tcloseByEsc: false,\n\t\t\t\tautoHide: false,\n\t\t\t\tangle: {\n\t\t\t\t\tposition: 'top',\n\t\t\t\t\toffset: 70,\n\t\t\t\t},\n\t\t\t\tcontent: this.#getContent(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tthis.#previewContentContainer = Tag.render`<div class=\"crm-template-editor-preview-popup-content\"></div>`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-template-editor-preview-popup-wrapper\">\n\t\t\t\t<div class=\"crm-template-editor-preview-popup-title\">\n\t\t\t\t\t${Loc.getMessage('CRM_TEMPLATE_EDITOR_PREVIEW_POPUP_TITLE')}\n\t\t\t\t</div>\n\t\t\t\t${this.#previewContentContainer}\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import { ajax as Ajax, Runtime, Text, Type } from 'main.core';\nimport PreviewPopup, { PREVIEW_POPUP_CONTENT_STATUS } from './preview-popup';\nimport 'crm_common';\n\nexport type PreviewerParams = {\n\tentityTypeId: number,\n\tentityId: number,\n\tcategoryId: ?number,\n\tbindElement?: HTMLElement,\n\tisDisplayFormat: ?boolean,\n};\n\nexport class Previewer\n{\n\t#entityTypeId: number = null;\n\t#entityId: number = null;\n\t#categoryId: ?number = null;\n\t#bindElement: ?HTMLElement = null;\n\t#isDisplayFormat: boolean = false;\n\n\t#isUsePreviewRequestRunning: boolean = false;\n\t#previewCache: Map<string, string> = new Map();\n\t#previewPopup: ?PreviewPopup = null;\n\t#unsubscribe: ?() => void = null;\n\n\tconstructor(params: PreviewerParams)\n\t{\n\t\tthis.#entityTypeId = Text.toInteger(params.entityTypeId);\n\t\tif (!BX.CrmEntityType.isDefined(this.#entityTypeId))\n\t\t{\n\t\t\tthrow new Error('Previewer: entityTypeId must be a valid entity type ID');\n\t\t}\n\n\t\tthis.#entityId = Text.toInteger(params.entityId);\n\t\tif (params.entityId <= 0)\n\t\t{\n\t\t\tthrow new Error('Previewer: entityId must be greater than 0');\n\t\t}\n\n\t\tthis.#categoryId = Type.isNil(params.categoryId) ? null : Text.toInteger(params.categoryId);\n\t\tif (!Type.isNil(this.#categoryId) && this.#categoryId < 0)\n\t\t{\n\t\t\tthrow new Error('Previewer: categoryId must be a non-negative integer');\n\t\t}\n\n\t\tthis.#bindElement = Type.isDomNode(params.bindElement) ? params.bindElement : null;\n\n\t\tthis.#isDisplayFormat = Type.isBoolean(params.isDisplayFormat) ? params.isDisplayFormat : this.#isDisplayFormat;\n\n\t\tthis.#unsubscribe = BX.Crm.EntityEvent.subscribeToItem(this.#entityTypeId, this.#entityId, () => {\n\t\t\tthis.#previewCache.clear();\n\t\t});\n\t}\n\n\tpreview(template: string, bindElement?: HTMLElement): void\n\t{\n\t\tconst bindElementToUse = Type.isDomNode(bindElement) ? bindElement : this.#bindElement;\n\t\tif (!Type.isDomNode(bindElementToUse))\n\t\t{\n\t\t\tthrow new Error('Previewer: bindElement must be a valid DOM element');\n\t\t}\n\n\t\tif (this.#previewPopup?.isShown())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#isUsePreviewRequestRunning)\n\t\t{\n\t\t\tthis.#previewPopup?.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#previewPopup?.destroy();\n\n\t\tconst cachedPreview = this.#previewCache.get(template);\n\n\t\tif (cachedPreview)\n\t\t{\n\t\t\tthis.#previewPopup = new PreviewPopup(bindElementToUse, this.#entityTypeId, this.#entityId);\n\t\t\tthis.#previewPopup.apply(PREVIEW_POPUP_CONTENT_STATUS.SUCCESS, cachedPreview);\n\t\t\tthis.#previewPopup.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#previewPopup = new PreviewPopup(bindElementToUse, this.#entityTypeId, this.#entityId);\n\t\tthis.#previewPopup.apply(PREVIEW_POPUP_CONTENT_STATUS.LOADING);\n\t\tthis.#previewPopup.show();\n\t\tthis.#isUsePreviewRequestRunning = true;\n\n\t\tAjax.runAction(\n\t\t\t'crm.activity.smsplaceholder.preview',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\t\tentityId: this.#entityId,\n\t\t\t\t\tmessage: template,\n\t\t\t\t\tentityCategoryId: this.#categoryId,\n\t\t\t\t\tisDisplayFormat: this.#isDisplayFormat,\n\t\t\t\t},\n\t\t\t},\n\t\t).then((response) => {\n\t\t\tthis.#previewPopup?.apply(\n\t\t\t\tPREVIEW_POPUP_CONTENT_STATUS.SUCCESS,\n\t\t\t\tresponse.data.preview,\n\t\t\t);\n\t\t\tthis.#isUsePreviewRequestRunning = false;\n\n\t\t\tthis.#previewCache.set(template, response.data.preview);\n\t\t}).catch((response) => {\n\t\t\tthis.#previewPopup?.apply(\n\t\t\t\tPREVIEW_POPUP_CONTENT_STATUS.FAILED,\n\t\t\t\tresponse.errors[0].message ?? 'Unknown error',\n\t\t\t);\n\t\t\tthis.#isUsePreviewRequestRunning = false;\n\t\t});\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.#previewPopup?.isShown() ?? false;\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#isUsePreviewRequestRunning = false;\n\t\tthis.#previewPopup?.destroy();\n\t\tthis.#previewPopup = null;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#previewPopup?.destroy();\n\t\tthis.#previewPopup = null;\n\n\t\tthis.#unsubscribe?.();\n\n\t\tthis.#previewCache = null;\n\n\t\tRuntime.destroy(this);\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text, Type } from 'main.core';\nimport { Popup, PopupWindowManager } from 'main.popup';\nimport { Button, ButtonState } from 'ui.buttons';\n\nexport default class TextPopup\n{\n\t#popup: Popup = null;\n\t#input: HTMLInputElement = null;\n\t#bindElement: HTMLElement = null;\n\t#value: string = null;\n\t#onApply: Function = () => {};\n\n\tconstructor({ bindElement, value, onApply })\n\t{\n\t\tthis.#bindElement = bindElement;\n\t\tthis.#value = value;\n\t\tthis.#onApply = onApply;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#popup?.destroy();\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getPopup().show();\n\t}\n\n\t#getPopup(): Popup\n\t{\n\t\tif (this.#popup === null)\n\t\t{\n\t\t\tthis.#popup = PopupWindowManager.create(\n\t\t\t\t'crm-template-editor-text-popup',\n\t\t\t\tthis.#bindElement,\n\t\t\t\t{\n\t\t\t\t\tautoHide: true,\n\t\t\t\t\tcontent: this.#getContent(),\n\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\tcloseIcon: false,\n\t\t\t\t\tbuttons: this.#getMenuButtons(),\n\t\t\t\t\tcacheable: false,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tthis.#popup.subscribe('onShow', () => {\n\t\t\t\t// Give time for input to render before setting focus.\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.#input.focus();\n\t\t\t\t\tthis.#setCursorToEnd();\n\t\t\t\t}, 0);\n\t\t\t});\n\t\t}\n\n\t\treturn this.#popup;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\tconst content = Tag.render`<div class=\"crm-template-editor-text-popup-wrapper\"></div>`;\n\n\t\tthis.#input = Tag.render`\n\t\t\t<input \n\t\t\t\ttype=\"text\" \n\t\t\t\tvalue=\"${Text.encode(this.#value)}\"\n\t\t\t\tmaxlength=\"255\"\n\t\t\t\tplaceholder=\"${Loc.getMessage('CRM_TEMPLATE_EDITOR_SELECT_FIELD_PLACEHOLDER')}\n\t\t\t\">\n\t\t`;\n\t\tDom.append(this.#input, content);\n\n\t\tthis.#bindInputEvents();\n\n\t\treturn content;\n\t}\n\n\t#bindInputEvents(): void\n\t{\n\t\tEvent.bind(this.#input, 'keyup', (event: Event) => {\n\t\t\tconst button = this.#getApplyButtonInstance();\n\t\t\tif (!button)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { value } = event.target;\n\t\t\tthis.#adjustButtonState(button, value);\n\t\t});\n\t}\n\n\t#getMenuButtons(): Button[]\n\t{\n\t\treturn [\n\t\t\tthis.#getApplyButton(),\n\t\t\tthis.#getCancelButton(),\n\t\t];\n\t}\n\n\t#getApplyButton(): Button\n\t{\n\t\tconst button = new Button({\n\t\t\tid: 'apply-button',\n\t\t\ttext: this.#getApplyButtonText(),\n\t\t\tclassName: 'ui-btn ui-btn-xs ui-btn-primary ui-btn-round',\n\t\t\tonclick: () => {\n\t\t\t\tthis.#onApplyButtonClick();\n\t\t\t},\n\t\t});\n\n\t\tconst { value } = this.#input;\n\t\tthis.#adjustButtonState(button, value);\n\n\t\treturn button;\n\t}\n\n\t#adjustButtonState(button: Button, value: string): void\n\t{\n\t\tbutton.setState(\n\t\t\t(Type.isStringFilled(value) && Type.isStringFilled(value.trim()))\n\t\t\t\t? ButtonState.ACTIVE\n\t\t\t\t: ButtonState.DISABLED\n\t\t);\n\t}\n\n\t#getApplyButtonText(): string\n\t{\n\t\tif (Type.isStringFilled(this.#value))\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_TEMPLATE_EDITOR_TEXT_POPUP_UPDATE');\n\t\t}\n\n\t\treturn Loc.getMessage('CRM_TEMPLATE_EDITOR_TEXT_POPUP_ADD');\n\t}\n\n\t#onApplyButtonClick(): void\n\t{\n\t\tconst button = this.#getApplyButtonInstance();\n\t\tif (button.getState() !== ButtonState.ACTIVE)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.destroy();\n\n\t\tconst { value } = this.#input;\n\t\tthis.#bindElement.textContent = Text.encode(value);\n\n\t\tthis.#onApply(value.trim());\n\t}\n\n\t#getApplyButtonInstance(): Button\n\t{\n\t\treturn this.#popup.getButton('apply-button');\n\t}\n\n\t#getCancelButton(): Button\n\t{\n\t\treturn new Button({\n\t\t\ttext: Loc.getMessage('CRM_TEMPLATE_EDITOR_TEXT_POPUP_CANCEL'),\n\t\t\tclassName: 'ui-btn ui-btn-xs ui-btn-light ui-btn-round',\n\t\t\tonclick: () => {\n\t\t\t\tthis.destroy();\n\t\t\t},\n\t\t});\n\t}\n\n\t#setCursorToEnd(): void\n\t{\n\t\tconst { length } = this.#input.value;\n\n\t\tthis.#input.selectionStart = length;\n\t\tthis.#input.selectionEnd = length;\n\t}\n}\n","import { Type } from 'main.core';\n\nexport function getPlainText(templateBody: string, placeholders: Array, filledPlaceholders: Array): string\n{\n\tlet result = templateBody;\n\n\tif (Type.isArrayFilled(filledPlaceholders))\n\t{\n\t\tfilledPlaceholders.forEach((filledPlaceholder) => {\n\t\t\tif (Type.isStringFilled(filledPlaceholder.FIELD_NAME))\n\t\t\t{\n\t\t\t\tresult = result.replace(filledPlaceholder.PLACEHOLDER_ID, `{${filledPlaceholder.FIELD_NAME}}`);\n\t\t\t}\n\t\t\telse if (Type.isStringFilled(filledPlaceholder.FIELD_VALUE))\n\t\t\t{\n\t\t\t\tconst fieldValue = filledPlaceholder.FIELD_VALUE\n\t\t\t\t\t.replaceAll('{', '&#123;')\n\t\t\t\t\t.replaceAll('}', '&#125;')\n\t\t\t\t;\n\t\t\t\tresult = result.replace(filledPlaceholder.PLACEHOLDER_ID, fieldValue);\n\t\t\t}\n\t\t});\n\t}\n\n\tif (Type.isArrayFilled(placeholders))\n\t{\n\t\tplaceholders.forEach((placeholder) => {\n\t\t\tresult = result.replace(placeholder, ' ');\n\t\t});\n\t}\n\n\treturn result;\n}\n","import { Dialog } from 'crm.entity-selector';\nimport { Dom, Event, Loc, Runtime, Tag, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Menu, Popup } from 'main.popup';\n\nimport 'ui.design-tokens';\nimport { DialogOptions } from 'ui.entity-selector';\nimport type { EditorOptions } from './editor-options';\nimport './editor.css';\nimport MenuPopup from './menu-popup';\nimport { Previewer } from './previewer';\nimport TextPopup from './text-popup';\nimport type { FilledPlaceholder, OnSelectParams } from './types';\nimport { getPlainText } from './utils';\n\nconst UPDATE_ACTION = 'update';\nconst DELETE_ACTION = 'delete';\n\nconst HEADER_POSITION = 'HEADER';\nconst PREVIEW_POSITION = 'PREVIEW';\nconst FOOTER_POSITION = 'FOOTER';\n\nexport class Editor\n{\n\t#id: ?string;\n\t#target: HTMLElement = null;\n\t#entityTypeId: number = null;\n\t#entityId: number = null;\n\t#categoryId: ?number = null;\n\t#canUseFieldsDialog: boolean = true;\n\t#canUseFieldValueInput: boolean = true;\n\t#isReadOnly: boolean = false;\n\n\t#previewer: ?Previewer = null;\n\tplaceholders: string[] = [];\n\tfilledPlaceholders: FilledPlaceholder[] = [];\n\tonSelect = () => {};\n\n\t// @todo replace this variables with a generic container\n\t#headerContainerEl: ?HTMLElement = null;\n\t#bodyContainerEl: ?HTMLElement = null;\n\t#footerContainerEl: ?HTMLElement = null;\n\n\t#placeHoldersDialogDefaultOptions: ?DialogOptions = null;\n\n\t#headerRaw: ?string = null;\n\t#bodyRaw: ?string = null;\n\t#footerRaw: ?string = null;\n\n\t#popupMenu: ?Menu = null;\n\t#inputPopup: ?Popup = null;\n\n\t#dialogsCache: WeakMap<DialogOptions, Dialog> = new WeakMap();\n\n\tconstructor(params: EditorOptions)\n\t{\n\t\tthis.#assertValidParams(params);\n\n\t\tthis.#id = params.id || `crm-template-editor-${Text.getRandom()}`;\n\t\tthis.#target = params.target;\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#categoryId = Type.isNumber(params.categoryId) ? params.categoryId : null;\n\t\tthis.onSelect = params.onSelect;\n\n\t\tthis.#canUseFieldsDialog = Boolean(params.canUseFieldsDialog ?? true);\n\t\tthis.#canUseFieldValueInput = Boolean(params.canUseFieldValueInput ?? true);\n\t\tthis.#isReadOnly = Boolean(params.isReadOnly ?? false);\n\n\t\tconst canUsePreview = Boolean(params.canUsePreview ?? false);\n\t\tif (canUsePreview && this.#entityId > 0)\n\t\t{\n\t\t\tthis.#previewer = new Previewer({\n\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\tentityId: this.#entityId,\n\t\t\t\tcategoryId: this.#categoryId,\n\t\t\t});\n\t\t}\n\n\t\tthis.onPlaceholderClick = this.onPlaceholderClick.bind(this);\n\t\tthis.onShowInputPopup = this.onShowInputPopup.bind(this);\n\n\t\tthis.#placeHoldersDialogDefaultOptions = {\n\t\t\tmultiple: false,\n\t\t\tshowAvatars: false,\n\t\t\tdropdownMode: true,\n\t\t\tcompactView: true,\n\t\t\tenableSearch: true,\n\t\t\ttagSelectorOptions: {\n\t\t\t\ttextBoxWidth: '100%',\n\t\t\t},\n\t\t};\n\n\t\tif (!this.#isReadOnly && this.#canUsePlaceholderProvider(params.usePlaceholderProvider))\n\t\t{\n\t\t\tthis.#placeHoldersDialogDefaultOptions.entities = [{\n\t\t\t\tid: 'placeholder',\n\t\t\t\toptions: {\n\t\t\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\t\t\tentityId: this.#entityId,\n\t\t\t\t\tcategoryId: this.#categoryId ?? null,\n\t\t\t\t},\n\t\t\t}];\n\t\t}\n\n\t\tif (Type.isPlainObject(params.dialogOptions))\n\t\t{\n\t\t\tthis.#placeHoldersDialogDefaultOptions = { ...this.#placeHoldersDialogDefaultOptions, ...params.dialogOptions };\n\t\t}\n\n\t\tthis.#createContainer();\n\t}\n\n\tsetPlaceholders(placeholders: string[]): this\n\t{\n\t\tthis.placeholders = placeholders;\n\n\t\treturn this;\n\t}\n\n\tsetFilledPlaceholders(filledPlaceholders: FilledPlaceholder[]): this\n\t{\n\t\tthis.filledPlaceholders = filledPlaceholders;\n\n\t\treturn this;\n\t}\n\n\t// region Public methods\n\tsetHeader(input: string): void\n\t{\n\t\tif (!Type.isStringFilled(input))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#headerRaw = input;\n\t\tDom.clean(this.#headerContainerEl);\n\t\tDom.append(this.#createContainerWithSelectors(input), this.#headerContainerEl);\n\t}\n\n\tsetBody(input: string): void\n\t{\n\t\tif (!Type.isStringFilled(input))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#bodyRaw = input;\n\t\tDom.clean(this.#bodyContainerEl);\n\t\tDom.append(this.#createContainerWithSelectors(input), this.#bodyContainerEl);\n\t}\n\n\tsetFooter(input: string): void\n\t{\n\t\tif (!Type.isStringFilled(input))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#footerRaw = input;\n\t\tDom.clean(this.#footerContainerEl);\n\t\tDom.append(this.#createContainerWithSelectors(input), this.#footerContainerEl);\n\t}\n\n\tgetData(): ?Object\n\t{\n\t\tif (this.placeholders === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\theader: this.#getPlainText(HEADER_POSITION),\n\t\t\tbody: this.#getPlainText(PREVIEW_POSITION),\n\t\t\tfooter: this.#getPlainText(FOOTER_POSITION),\n\t\t};\n\t}\n\n\tgetRawData(): Object\n\t{\n\t\treturn {\n\t\t\theader: this.#headerRaw,\n\t\t\tbody: this.#bodyRaw,\n\t\t\tfooter: this.#footerRaw,\n\t\t};\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#previewer?.destroy();\n\t\tthis.#previewer = null;\n\n\t\tthis.#inputPopup?.destroy();\n\t\tthis.#inputPopup = null;\n\n\t\tthis.#popupMenu?.destroy();\n\t\tthis.#popupMenu = null;\n\n\t\tRuntime.destroy(this);\n\t}\n\t// endregion\n\n\t#createContainer(): void\n\t{\n\t\tif (!this.#target)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst containerEl = Tag.render`\n\t\t\t<div id=\"${this.#id}\" class=\"crm-template-editor crm-template-editor__scope\"></div>\n\t\t`;\n\t\tif (this.#isReadOnly)\n\t\t{\n\t\t\tDom.addClass(containerEl, '--read-only');\n\t\t}\n\n\t\tthis.#headerContainerEl = Tag.render`<div class=\"crm-template-editor-header\"></div>`;\n\t\tDom.append(this.#headerContainerEl, containerEl);\n\t\tthis.#bodyContainerEl = Tag.render`<div class=\"crm-template-editor-body\"></div>`;\n\t\tDom.append(this.#bodyContainerEl, containerEl);\n\t\tthis.#footerContainerEl = Tag.render`<div class=\"crm-template-editor-footer\"></div>`;\n\t\tDom.append(this.#footerContainerEl, containerEl);\n\n\t\tif (this.#previewer)\n\t\t{\n\t\t\tconst previewLink = Tag.render`\n\t\t\t\t<div class=\"crm-template-editor-preview-link\" href=\"#\">\n\t\t\t\t\t${Loc.getMessage('CRM_TEMPLATE_EDITOR_PREVIEW_LINK_TITLE')}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(previewLink, 'click', this.#onPreviewTemplate.bind(this));\n\t\t\tDom.append(previewLink, containerEl);\n\t\t}\n\n\t\tDom.clean(this.#target);\n\t\tDom.append(containerEl, this.#target);\n\t}\n\n\t#createContainerWithSelectors(input: string, position: string = PREVIEW_POSITION): ?HTMLElement\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\t\tif (placeholders === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst container = this.#getInputContainer(input, position);\n\n\t\tplaceholders.forEach((placeholder, key) => {\n\t\t\tconst element = [...container.childNodes].find(\n\t\t\t\t(node) => node.dataset && Number(node.dataset.templatePlaceholder) === key,\n\t\t\t);\n\n\t\t\tif (!element)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.#isReadOnly)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst dialogOptions = Runtime.clone(this.#placeHoldersDialogDefaultOptions);\n\t\t\tthis.#prepareDlgOptions(dialogOptions, element, position);\n\n\t\t\tEvent.bind(element, 'click', (event) => {\n\t\t\t\tthis.onPlaceholderClick({ dialogOptions, event });\n\t\t\t});\n\t\t});\n\n\t\treturn container;\n\t}\n\n\tonPlaceholderClick({ dialogOptions, event }): void\n\t{\n\t\tthis.#inputPopup?.destroy();\n\n\t\tconst filledPlaceholder = this.#getFilledPlaceholderByElement(event.target, PREVIEW_POSITION);\n\t\tconst isTextItemFirst = Type.isStringFilled(filledPlaceholder?.FIELD_VALUE);\n\n\t\tif (this.#canUseFieldsDialog && this.#canUseFieldValueInput)\n\t\t{\n\t\t\tthis.#popupMenu = new MenuPopup({\n\t\t\t\tbindElement: event.target,\n\t\t\t\tisTextItemFirst,\n\t\t\t\tonEditorItemClick: () => {\n\t\t\t\t\tthis.onShowDialogPopup(filledPlaceholder, dialogOptions);\n\t\t\t\t},\n\t\t\t\tonTextItemClick: (element: HTMLElement) => {\n\t\t\t\t\tthis.onShowInputPopup(element);\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.#popupMenu.show();\n\t\t}\n\t\telse if (this.#canUseFieldsDialog)\n\t\t{\n\t\t\tthis.onShowDialogPopup(filledPlaceholder, dialogOptions);\n\t\t}\n\t\telse if (this.#canUseFieldValueInput)\n\t\t{\n\t\t\tthis.onShowInputPopup(event.target);\n\t\t}\n\t}\n\n\tonShowDialogPopup(filledPlaceholder: FilledPlaceholder, dialogOptions: DialogOptions): void\n\t{\n\t\tconst dialog = this.#getDialog(dialogOptions);\n\n\t\tif (Type.isStringFilled(filledPlaceholder?.FIELD_VALUE))\n\t\t{\n\t\t\tdialog.getPreselectedItems().forEach((preselectedItem) => {\n\t\t\t\tconst item = dialog.getItem(preselectedItem);\n\t\t\t\tif (item)\n\t\t\t\t{\n\t\t\t\t\titem.deselect();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tdialog.show();\n\t}\n\n\t/**\n\t * Dialog with preselected items makes backend request on construction.\n\t * Create dialog only when user clicks, and then cache it.\n\t */\n\t#getDialog(dialogOptions: DialogOptions): Dialog\n\t{\n\t\tif (this.#dialogsCache.has(dialogOptions))\n\t\t{\n\t\t\treturn this.#dialogsCache.get(dialogOptions);\n\t\t}\n\n\t\tconst dialog = new Dialog(dialogOptions);\n\t\tthis.#dialogsCache.set(dialogOptions, dialog);\n\n\t\treturn dialog;\n\t}\n\n\tonShowInputPopup(bindElement: HTMLElement): void\n\t{\n\t\tconst filledPlaceholder = this.#getFilledPlaceholderByElement(bindElement);\n\t\tconst value = Type.isStringFilled(filledPlaceholder?.FIELD_VALUE) ? filledPlaceholder.FIELD_VALUE : '';\n\n\t\tthis.#inputPopup = new TextPopup({\n\t\t\tbindElement,\n\t\t\tvalue,\n\t\t\tonApply: (newValue: string) => {\n\t\t\t\tthis.#onApplyInputPopup(newValue, bindElement);\n\t\t\t},\n\t\t});\n\n\t\tthis.#inputPopup.show();\n\t}\n\n\t#onApplyInputPopup(value: string, bindElement: HTMLElement): void\n\t{\n\t\tconst placeholderId = this.#getPlaceholderIdByElement(bindElement, PREVIEW_POSITION);\n\n\t\tconst params: OnSelectParams = {\n\t\t\tid: placeholderId,\n\t\t\tparentTitle: null,\n\t\t\ttext: value,\n\t\t\ttitle: value,\n\t\t\tentityType: BX.CrmEntityType.resolveName(this.#entityTypeId).toLowerCase(),\n\t\t};\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tbindElement.textContent = value;\n\t\tDom.addClass(bindElement, '--selected');\n\n\t\tthis.#adjustFilledPlaceholders(params);\n\t\tthis.onSelect(params);\n\t}\n\n\t#onPreviewTemplate(event: BaseEvent): void\n\t{\n\t\tconst currentTemplate = this.placeholders === null\n\t\t\t? this.getRawData().body\n\t\t\t: this.getData().body; // TODO: implement header and footer processing\n\n\t\tthis.#previewer.preview(currentTemplate, event.target);\n\n\t\tEventEmitter.emit('BX.Crm.Template.Editor:shown');\n\t}\n\n\t#getInputContainer(input: string, position: string): ?HTMLElement\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\t\tif (placeholders === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet i = 0;\n\t\tplaceholders.forEach((placeholder) => {\n\t\t\tconst filledPlaceholder = this.#getFilledPlaceholderById(placeholder);\n\n\t\t\tlet title = Loc.getMessage('CRM_TEMPLATE_EDITOR_EMPTY_PLACEHOLDER_LABEL');\n\t\t\tlet spanClass = 'crm-template-editor-element-pill';\n\t\t\tif (filledPlaceholder)\n\t\t\t{\n\t\t\t\tif (\n\t\t\t\t\tType.isStringFilled(filledPlaceholder.PARENT_TITLE)\n\t\t\t\t\t&& Type.isStringFilled(filledPlaceholder.TITLE))\n\t\t\t\t{\n\t\t\t\t\ttitle = `${filledPlaceholder.PARENT_TITLE}: ${filledPlaceholder.TITLE}`;\n\t\t\t\t}\n\t\t\t\telse if (Type.isStringFilled(filledPlaceholder.TITLE))\n\t\t\t\t{\n\t\t\t\t\ttitle = filledPlaceholder.TITLE;\n\t\t\t\t}\n\t\t\t\telse if (Type.isStringFilled(filledPlaceholder.FIELD_NAME))\n\t\t\t\t{\n\t\t\t\t\ttitle = filledPlaceholder.FIELD_NAME;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttitle = filledPlaceholder.FIELD_VALUE;\n\t\t\t\t}\n\n\t\t\t\ttitle = Text.encode(title);\n\t\t\t\tspanClass += ' --selected';\n\t\t\t}\n\n\t\t\tconst replaceValue = `<span class=\"${spanClass}\" data-test-role=\"placeholder\" data-template-placeholder=\"${i++}\">${title}</span>`;\n\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\tinput = input.replace(placeholder, replaceValue);\n\t\t});\n\n\t\treturn Tag.render`<div>${input}</div>`;\n\t}\n\n\t#getPlaceholders(position: string): ?[]\n\t{\n\t\tconst allPlaceholders = Type.isPlainObject(this.placeholders) ? this.placeholders : {};\n\t\tconst placeholders = Type.isArrayFilled(allPlaceholders[position]) ? allPlaceholders[position] : [];\n\n\t\treturn Type.isArrayLike(placeholders) ? placeholders : null;\n\t}\n\n\t#prepareDlgOptions(dlgOptions: DialogOptions, element: HTMLElement, position: string): void\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\t\tconst placeholderId = placeholders[element.dataset.templatePlaceholder] ?? null;\n\t\tif (placeholderId)\n\t\t{\n\t\t\tconst filledPlaceholder = this.#getFilledPlaceholderById(placeholderId);\n\t\t\tif (filledPlaceholder)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tdlgOptions.preselectedItems = [\n\t\t\t\t\t[\n\t\t\t\t\t\tfilledPlaceholder.FIELD_ENTITY_TYPE,\n\t\t\t\t\t\tfilledPlaceholder.FIELD_NAME,\n\t\t\t\t\t],\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tdlgOptions.events = {\n\t\t\tonShow: () => {\n\t\t\t\tconst keyframes = [\n\t\t\t\t\t{ transform: 'rotate(0)' },\n\t\t\t\t\t{ transform: 'rotate(90deg)' },\n\t\t\t\t\t{ transform: 'rotate(180deg)' },\n\t\t\t\t];\n\t\t\t\tconst options = {\n\t\t\t\t\tduration: 200,\n\t\t\t\t\tpseudoElement: '::after',\n\t\t\t\t};\n\n\t\t\t\telement.animate(keyframes, options);\n\t\t\t\tDom.addClass(element, '--flipped');\n\t\t\t},\n\t\t\tonHide: () => {\n\t\t\t\tconst keyframes = [\n\t\t\t\t\t{ transform: 'rotate(180deg)' },\n\t\t\t\t\t{ transform: 'rotate(90deg)' },\n\t\t\t\t\t{ transform: 'rotate(0)' },\n\t\t\t\t];\n\t\t\t\tconst options = {\n\t\t\t\t\tduration: 200,\n\t\t\t\t\tpseudoElement: '::after',\n\t\t\t\t};\n\n\t\t\t\telement.animate(keyframes, options);\n\t\t\t\tDom.removeClass(element, '--flipped');\n\t\t\t},\n\t\t\t'Item:onSelect': (event: BaseEvent): void => {\n\t\t\t\tDom.addClass(element, '--selected');\n\n\t\t\t\tconst item = event.getData().item;\n\t\t\t\tconst parentTitle = item.supertitle.text;\n\t\t\t\tconst title = item.title.text;\n\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\telement.textContent = `${parentTitle}: ${title}`;\n\n\t\t\t\tconst value = item.id;\n\t\t\t\tconst entityType = item.entityId;\n\n\t\t\t\tconst params = {\n\t\t\t\t\tid: placeholderId,\n\t\t\t\t\tvalue,\n\t\t\t\t\tparentTitle,\n\t\t\t\t\ttitle,\n\t\t\t\t\tentityType,\n\t\t\t\t};\n\n\t\t\t\tthis.#adjustFilledPlaceholders(params);\n\t\t\t\tthis.onSelect(params);\n\t\t\t},\n\t\t};\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tdlgOptions.targetNode = element;\n\t}\n\n\t#adjustFilledPlaceholders({ id, value, text, parentTitle, title }, action: string = UPDATE_ACTION): void\n\t{\n\t\tif (action === DELETE_ACTION)\n\t\t{\n\t\t\tthis.#deleteFromFilledPlaceholders(id, value);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#updateForFilledPlaceholders({ id, value, text, parentTitle, title });\n\t}\n\n\t#deleteFromFilledPlaceholders(id: string, value: string): void\n\t{\n\t\tthis.filledPlaceholders = this.filledPlaceholders.filter(\n\t\t\t(filledPlaceholder) => {\n\t\t\t\treturn filledPlaceholder.PLACEHOLDER_ID !== id || filledPlaceholder.FIELD_NAME !== value;\n\t\t\t},\n\t\t);\n\t}\n\n\t#updateForFilledPlaceholders({ id, value, text, parentTitle, title }): void\n\t{\n\t\tconst filledPlaceholder = this.#getFilledPlaceholderById(id);\n\n\t\tif (filledPlaceholder)\n\t\t{\n\t\t\tfilledPlaceholder.FIELD_NAME = value ?? null;\n\t\t\tfilledPlaceholder.FIELD_VALUE = text ?? null;\n\t\t\tfilledPlaceholder.PARENT_TITLE = parentTitle;\n\t\t\tfilledPlaceholder.TITLE = title;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.filledPlaceholders.push({\n\t\t\t\tPLACEHOLDER_ID: id,\n\t\t\t\tFIELD_NAME: value,\n\t\t\t\tFIELD_VALUE: text,\n\t\t\t\tPARENT_TITLE: parentTitle,\n\t\t\t\tTITLE: title,\n\t\t\t});\n\t\t}\n\t}\n\n\t#getFilledPlaceholderByElement(element: HTMLElement, position: string = PREVIEW_POSITION): ?FilledPlaceholder\n\t{\n\t\tconst placeholderId = this.#getPlaceholderIdByElement(element, position);\n\n\t\treturn this.#getFilledPlaceholderById(placeholderId);\n\t}\n\n\t#getPlaceholderIdByElement(element: HTMLElement, position: string = PREVIEW_POSITION): ?string\n\t{\n\t\tconst placeholders = this.#getPlaceholders(position);\n\n\t\treturn placeholders[element.dataset.templatePlaceholder] ?? null;\n\t}\n\n\t#getFilledPlaceholderById(placeholderId: string): ?FilledPlaceholder\n\t{\n\t\treturn this.filledPlaceholders.find(\n\t\t\t(filledPlaceholderItem) => filledPlaceholderItem.PLACEHOLDER_ID === placeholderId,\n\t\t);\n\t}\n\n\t#getPlainText(position: string): ?string\n\t{\n\t\tconst text = this.#getRawTextByPosition(position);\n\t\tif (text === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn getPlainText(text, this.placeholders[position], this.filledPlaceholders);\n\t}\n\n\t#getRawTextByPosition(position: string): ?string\n\t{\n\t\tif (position === HEADER_POSITION)\n\t\t{\n\t\t\treturn this.#headerRaw;\n\t\t}\n\n\t\tif (position === PREVIEW_POSITION)\n\t\t{\n\t\t\treturn this.#bodyRaw;\n\t\t}\n\n\t\tif (position === FOOTER_POSITION)\n\t\t{\n\t\t\treturn this.#footerRaw;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#assertValidParams(params: EditorOptions): void\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tthrow new TypeError('BX.Crm.Template.Editor: The \"params\" argument must be object');\n\t\t}\n\n\t\tif (!Type.isDomNode(params.target))\n\t\t{\n\t\t\tthrow new Error('BX.Crm.Template.Editor: The \"target\" argument must be DOM node');\n\t\t}\n\n\t\tconst isReadOnly = Boolean(params.isReadOnly ?? false);\n\n\t\tif (\n\t\t\t!isReadOnly\n\t\t\t&& this.#canUsePlaceholderProvider(params.usePlaceholderProvider)\n\t\t\t&& !BX.CrmEntityType.isDefined(params.entityTypeId)\n\t\t)\n\t\t{\n\t\t\tthrow new TypeError('BX.Crm.Template.Editor: The \"entityTypeId\" argument is not correct');\n\t\t}\n\n\t\tif (!isReadOnly && !Type.isFunction(params.onSelect))\n\t\t{\n\t\t\tthrow new TypeError('BX.Crm.Template.Editor: The \"onSelect\" argument is not correct');\n\t\t}\n\t}\n\n\t#canUsePlaceholderProvider(value): boolean\n\t{\n\t\treturn (Type.isNil(value) || value === true);\n\t}\n}\n"],"names":["MenuPopup","constructor","bindElement","isTextItemFirst","onEditorItemClick","onTextItemClick","show","destroy","Runtime","MenuManager","create","id","autoHide","offsetLeft","angle","closeByEsc","cacheable","items","editorItem","textItem","html","onclick","code","close","placeholder","replace","Text","encode","Loc","getMessage","PREVIEW_POPUP_CONTENT_STATUS","LOADING","SUCCESS","FAILED","PreviewPopup","entityTypeId","entityId","isShown","apply","status","data","closeIconElement","getPopupContainer","querySelector","Dom","addClass","innerText","ProgressBar","color","Color","PRIMARY","size","maxValue","value","infiniteLoading","setHeight","renderTo","setAutoHide","removeClass","UI","Notification","Center","notify","content","autoHideDelay","TypeError","PopupWindowManager","closeIcon","top","position","offset","Tag","render","Previewer","params","Map","toInteger","BX","CrmEntityType","isDefined","Error","Type","isNil","categoryId","isDomNode","isBoolean","isDisplayFormat","Crm","EntityEvent","subscribeToItem","clear","preview","template","bindElementToUse","cachedPreview","get","Ajax","runAction","message","entityCategoryId","then","response","set","catch","errors","TextPopup","onApply","buttons","subscribe","setTimeout","focus","append","Event","bind","event","button","target","Button","text","className","setState","isStringFilled","trim","ButtonState","ACTIVE","DISABLED","getState","textContent","getButton","length","selectionStart","selectionEnd","getPlainText","templateBody","placeholders","filledPlaceholders","result","isArrayFilled","forEach","filledPlaceholder","FIELD_NAME","PLACEHOLDER_ID","FIELD_VALUE","fieldValue","replaceAll","UPDATE_ACTION","DELETE_ACTION","HEADER_POSITION","PREVIEW_POSITION","FOOTER_POSITION","Editor","onSelect","WeakMap","getRandom","isNumber","Boolean","canUseFieldsDialog","canUseFieldValueInput","isReadOnly","canUsePreview","onPlaceholderClick","onShowInputPopup","multiple","showAvatars","dropdownMode","compactView","enableSearch","tagSelectorOptions","textBoxWidth","usePlaceholderProvider","entities","options","isPlainObject","dialogOptions","setPlaceholders","setFilledPlaceholders","setHeader","input","clean","setBody","setFooter","getData","header","body","footer","getRawData","onShowDialogPopup","element","dialog","getPreselectedItems","preselectedItem","item","getItem","deselect","newValue","containerEl","previewLink","container","key","childNodes","find","node","dataset","Number","templatePlaceholder","clone","has","Dialog","placeholderId","parentTitle","title","entityType","resolveName","toLowerCase","currentTemplate","EventEmitter","emit","i","spanClass","PARENT_TITLE","TITLE","replaceValue","allPlaceholders","isArrayLike","dlgOptions","preselectedItems","FIELD_ENTITY_TYPE","events","onShow","keyframes","transform","duration","pseudoElement","animate","onHide","supertitle","targetNode","action","filter","push","filledPlaceholderItem","isFunction"],"mappings":"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"}