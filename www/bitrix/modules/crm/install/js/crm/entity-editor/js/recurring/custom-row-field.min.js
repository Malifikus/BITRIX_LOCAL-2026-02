BX.namespace("BX.Crm");if(typeof BX.Crm.EntityEditorRecurringCustomRowField==="undefined"){BX.Crm.EntityEditorRecurringCustomRowField=function(){BX.Crm.EntityEditorRecurringCustomRowField.superclass.constructor.apply(this);this._amountInput=null;this._selectInput=null;this._sumElement=null;this._selectContainer=null;this._inputWrapper=null;this._innerWrapper=null;this._selectedValue="";this._selectClickHandler=BX.delegate(this.onSelectorClick,this);this._isMesureMenuOpened=false};BX.extend(BX.Crm.EntityEditorRecurringCustomRowField,BX.Crm.EntityEditorField);BX.Crm.EntityEditorRecurringCustomRowField.prototype.getModeSwitchType=function(t){var e=BX.UI.EntityEditorModeSwitchType.common;if(t===BX.UI.EntityEditorMode.edit){e|=BX.UI.EntityEditorModeSwitchType.button|BX.UI.EntityEditorModeSwitchType.content}return e};BX.Crm.EntityEditorRecurringCustomRowField.prototype.getContentWrapper=function(){return this._innerWrapper};BX.Crm.EntityEditorRecurringCustomRowField.prototype.focus=function(){if(this._amountInput){BX.focus(this._amountInput);BX.Crm.EditorTextHelper.getCurrent().selectAll(this._amountInput)}};BX.Crm.EntityEditorRecurringCustomRowField.prototype.getValue=function(t){if(!this._model){return""}return this._model.getStringField(this.getAmountFieldName(),t!==undefined?t:"")};BX.Crm.EntityEditorRecurringCustomRowField.prototype.layout=function(t){if(this._hasLayout){return}this.ensureWrapperCreated({classNames:["crm-entity-widget-content-block-field-recurring-custom"]});this.adjustWrapper();if(!this.isNeedToDisplay()){this.registerLayout(t);this._hasLayout=true;return}var e=this.getTitle();var i=this.getData();var n=this.getSelectFieldName();this._selectedValue=this.getValue(n);var r=BX.prop.getArray(BX.prop.getObject(i,"select"),"items");var s="";if(!this._selectedValue){var o=r.length>0?r[0]:null;if(o){this._selectedValue=o["VALUE"];s=o["NAME"]}}else{s=this._editor.findOption(this._selectedValue,r)}var u=this.getAmountFieldName();var l=this.getValue(u);this._amountInput=null;this._selectInput=null;this._selectContainer=null;this._innerWrapper=null;this._sumElement=null;if(this._mode===BX.UI.EntityEditorMode.edit){this._wrapper.appendChild(this.createTitleNode(e));this._amountInput=BX.create("input",{attrs:{className:"crm-entity-widget-content-input",name:u,type:"text",value:l}});BX.bind(this._amountInput,"input",this._changeHandler);this._selectInput=BX.create("input",{attrs:{name:n,type:"hidden",value:this._selectedValue}});this._selectContainer=BX.create("div",{props:{className:"crm-entity-widget-content-select"},text:s});BX.bind(this._selectContainer,"click",this._selectClickHandler);this._inputWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-input-wrapper"},children:[this._amountInput,this._selectInput,BX.create("div",{props:{className:"crm-entity-widget-content-block-select"},children:[this._selectContainer]})]});this._innerWrapper=BX.create("div",{props:{className:"crm-entity-widget-content-block-inner crm-entity-widget-content-block-colums-input"},children:[this._inputWrapper]})}this._wrapper.appendChild(this._innerWrapper);this.registerLayout(t);this._hasLayout=true};BX.Crm.EntityEditorRecurringCustomRowField.prototype.doClearLayout=function(t){BX.PopupMenu.destroy(this._id);this._amountInput=null;this._selectInput=null;this._sumElement=null;this._selectContainer=null;this._inputWrapper=null;this._innerWrapper=null};BX.Crm.EntityEditorRecurringCustomRowField.prototype.getAmountFieldName=function(){return this._schemeElement.getDataStringParam("amount","")};BX.Crm.EntityEditorRecurringCustomRowField.prototype.getSelectFieldName=function(){return BX.prop.getString(this._schemeElement.getDataObjectParam("select",{}),"name","")};BX.Crm.EntityEditorRecurringCustomRowField.prototype.onSelectorClick=function(t){this.openListMenu()};BX.Crm.EntityEditorRecurringCustomRowField.prototype.openListMenu=function(){if(this._isListMenuOpened){return}var t=this._schemeElement.getData();var e=BX.prop.getArray(BX.prop.getObject(t,"select"),"items");var i=0;var n=[];while(i<e.length){n.push({text:e[i]["NAME"],value:e[i]["VALUE"],onclick:BX.delegate(this.onSelectItem,this)});i++}BX.PopupMenu.show(this._id,this._selectContainer,n,{angle:false,width:this._selectContainer.offsetWidth+"px",events:{onPopupShow:BX.delegate(this.onListMenuOpen,this),onPopupClose:BX.delegate(this.onListMenuClose,this)}});BX.PopupMenu.currentItem.popupWindow.setWidth(BX.pos(this._selectContainer)["width"])};BX.Crm.EntityEditorRecurringCustomRowField.prototype.closeListMenu=function(){if(!this._isListMenuOpened){return}var t=BX.PopupMenu.getMenuById(this._id);if(t){t.popupWindow.close()}};BX.Crm.EntityEditorRecurringCustomRowField.prototype.onListMenuOpen=function(){BX.addClass(this._selectContainer,"active");this._isListMenuOpened=true};BX.Crm.EntityEditorRecurringCustomRowField.prototype.onListMenuClose=function(){BX.PopupMenu.destroy(this._id);BX.removeClass(this._selectContainer,"active");this._isListMenuOpened=false};BX.Crm.EntityEditorRecurringCustomRowField.prototype.onSelectItem=function(t,e){this.closeListMenu();this._selectedValue=this._selectInput.value=e.value;this._selectContainer.innerHTML=BX.util.htmlspecialchars(e.text);this.markAsChanged({fieldName:this.getSelectFieldName(),fieldValue:this._selectedValue})};BX.Crm.EntityEditorRecurringCustomRowField.prototype.getRuntimeValue=function(){var t=[];if(this._mode===BX.UI.EntityEditorMode.edit){if(this._amountInput){t[this.getAmountFieldName()]=this._amountInput.value}t[this.getSelectFieldName()]=this._selectedValue;return t}return""};BX.Crm.EntityEditorRecurringCustomRowField.prototype.save=function(){this._model.setField(this.getSelectFieldName(),this._selectedValue);if(this._amountInput){this._model.setField(this.getAmountFieldName(),this._amountInput.value)}};BX.Crm.EntityEditorRecurringCustomRowField.create=function(t,e){var i=new BX.Crm.EntityEditorRecurringCustomRowField;i.initialize(t,e);return i}}
//# sourceMappingURL=custom-row-field.map.js