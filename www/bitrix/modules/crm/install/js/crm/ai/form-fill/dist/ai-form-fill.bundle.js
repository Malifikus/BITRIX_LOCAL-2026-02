this.BX=this.BX||{},function(e,t,i,s,o,l,a,n,r,d,c,b,u){"use strict";const p=e=>new Promise(t=>{setTimeout(t,e)}),m=async(e,t,i)=>{if(i<=0)return;const s=(t-e.scrollTop)/i*10;await p(10),e.scrollTop+=s,e.scrollTop!==t&&await m(e,t,i-10)},h={name:"CloseConfirm",data:()=>({messageBoxInstance:null,uniquePopupId:"ai-form-fill-feedback-popup_"+c.Text.getRandom(20).toLowerCase()}),computed:{...o.mapGetters(["isFooterHiddenAndSaveDisabled"])},methods:{...o.mapMutations(["setIsConfirmPopupShow"]),onMessageClose(e){e.uniquePopupId===this.uniquePopupId&&this.setIsConfirmPopupShow(!1)}},mounted(){this.messageBoxInstance=i.MessageBox.create({message:c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_CANCEL_CONFIRM_TEXT"),title:c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_CANCEL_CONFIRM_TITLE"),okCaption:c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_CANCEL_CONFIRM_CLOSE"),cancelCaption:c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_CANCEL_CONFIRM_CANCEL"),onOk:()=>{this.$Bitrix.eventEmitter.emit("crm:ai:form-fill:close-confirm:confirmClose",{})},onCancel:()=>{this.setIsConfirmPopupShow(!1)},buttons:BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,popupOptions:{targetContainer:this.$refs.closeConfirmRoot,id:this.uniquePopupId}}),c.addCustomEvent(window,"BX.Main.Popup:onClose",this.onMessageClose),this.messageBoxInstance.show()},unmounted(){this.messageBoxInstance&&this.messageBoxInstance.close(),c.removeCustomEvent(window,"BX.Main.Popup:onClose",this.onMessageClose)},template:'\n\t\t<div \n\t\t\tref="closeConfirmRoot" \n\t\t\tclass="crm-ai-form-fill__close-confirm"\n\t\t\t:class="{\'hidden-footer\': isFooterHiddenAndSaveDisabled}"\n\t\t></div>\n\t'},v={name:"EntityEditorWrapper",computed:{...o.mapGetters(["mergeUuid"]),entityEditorContainerId(){return`crm-ai-merge-fields__container__${this.mergeUuid}_container`}},template:'<div v-bind:id="entityEditorContainerId"></div>'},f={name:"FeedbackMessage",data:()=>({messageBoxInstance:null,uniquePopupId:"ai-form-fill-feedback-popup_"+c.Text.getRandom(20).toLowerCase()}),computed:{...o.mapGetters(["isFooterHiddenAndSaveDisabled"])},methods:{...o.mapActions(["closeFeedbackMessage","sendAiCallParsingData"]),async onOKButton(){this.closeFeedbackMessage(!0)},onCancelButton(){this.closeFeedbackMessage(!1),this.sendAiCallParsingData("feedback_refused")},onMessageClose(e){e.uniquePopupId===this.uniquePopupId&&this.closeFeedbackMessage(!1)}},mounted(){this.messageBoxInstance=a.createFeedbackMessageBox({onOk:this.onOKButton,onCancel:this.onCancelButton,popupOptions:{targetContainer:this.$refs.feedbackMessageRoot,id:this.uniquePopupId}}),c.addCustomEvent(window,"BX.Main.Popup:onClose",this.onMessageClose),this.messageBoxInstance.show()},unmounted(){this.messageBoxInstance&&this.messageBoxInstance.close(),c.removeCustomEvent(window,"BX.Main.Popup:onClose",this.onMessageClose)},template:'\n\t\t<div \n\t\t\tref="feedbackMessageRoot" \n\t\t\tclass="crm-ai-form-fill__confirm" \n\t\t\t:class="{\'hidden-footer\': isFooterHiddenAndSaveDisabled}"\n\t\t></div>\n\t'},g={name:"FloatingActionButton",computed:{...o.mapGetters({count:"getNotVisibleUnresolvedCount"}),showCounter(){return this.count>0}},methods:{click(){this.$Bitrix.eventEmitter.emit("crm:ai:form-fill:scroll-to-next",{})}},template:'\n\t\t<div @click="click" class="bx-crm-ai-merge-fields-fab">\n\t\t\t<div\n\t\t\t\tv-if="showCounter"\n\t\t\t\tclass="bx-crm-ai-merge-fields-fab_counter"\n\t\t\t>{{count}}</div>\n\t\t\t<i class="bx-crm-ai-merge-fields-fab_icon"></i>\n\t\t</div>\n\t'},F={name:"Main",components:{Loader:{name:"Loader",data:()=>({loaderInstance:null}),template:'\n\t\t<div ref="root" class="bx-crm-ai-merge-fields-loading">\n\t\t\t<div class="bx-crm-ai-merge-fields-loading__image"></div>\n\t\t</div>\n\t'},EntityEditorWrapper:v,ToolBar:{name:"ToolBar",computed:{...o.mapGetters(["conflictFields"]),conflictCount(){return this.conflictFields.length},resolvedCount(){return this.conflictFields.filter(e=>e.isAiValuesUsed).length},isApplyAllDisabled(){return this.conflictCount===this.resolvedCount},isRevertDisabled(){return 0===this.resolvedCount},titleText:()=>c.Loc.getMessage("CRM_AI_FORM_FILL_TOOLBAR_CONFLICT_COUNT_TITLE"),applyAllBtnText:()=>c.Loc.getMessage("CRM_AI_FORM_FILL_TOOLBAR_BUTTON_APPLY_ALL"),revertText:()=>c.Loc.getMessage("CRM_AI_FORM_FILL_TOOLBAR_BUTTON_ROLLBACK")},methods:{...o.mapActions(["applyAllAiFields","revertAllAiFields"])},template:'\n\t\t<div class="bx-crm-ai-form-fill__toolbar">\n\t\t\t<div class="bx-crm-ai-form-fill__toolbar__conflict_count">\n\t\t\t\t{{ titleText }}<span class="bx-crm-ai-form-fill__toolbar__conflict_count__count">{{conflictCount}}</span>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="bx-crm-ai-form-fill__toolbar__button"\n\t\t\t\t@click="applyAllAiFields"\n\t\t\t>{{ applyAllBtnText }}</div>\n\t\t\t<div\n\t\t\t\tclass="bx-crm-ai-form-fill__toolbar__button"\n\t\t\t\t@click="revertAllAiFields"\n\t\t\t>{{ revertText }}</div>\n\t\t</div>\n\t'},Merger:{name:"Merger",components:{MergeControl:{name:"MergeControl",props:{field:{type:Object,required:!0},tmp:Number},data:()=>({hasLargeContent:!0,isExpanded:!1,coveredByAnother:!1}),computed:{...o.mapGetters(["getexpandedConflictControls","eeControlPositions"]),replaceBtnText(){return this.field.isAiValuesUsed?c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_REPLACE_BTN_BACK"):c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_REPLACE_BTN_FORTH")},value(){return this.field.isAiValuesUsed?this.field.originalValue:this.field.aiValue}},methods:{...o.mapActions(["setEditorFieldValue","showEntityEditorControlOutline"]),...o.mapMutations(["toggleExpandedConflictControls"]),async toggleAiValue(e){await this.setEditorFieldValue(e),await this.expand(!1),this.hasLargeContent=this.checkHasLargeContent()},async expand(e){this.hasLargeContent&&(this.isExpanded=e,await s.nextTick(),this.toggleExpandedConflictControls({fieldId:this.field.name,size:this.$refs.root.getBoundingClientRect().height,isExpanded:e}))},onControlsExpandedModeChange(){let e=!1;const t=this.eeControlPositions.get(this.field.name,0);for(const[i,s]of this.getexpandedConflictControls){const o=this.eeControlPositions.get(i,0);if(t>o&&t-o<s){e=!0;break}}this.coveredByAnother=e},checkHasLargeContent(){return this.$refs.fieldValue.scrollWidth>this.$refs.fieldValue.clientWidth},onMouseenter(e){this.showEntityEditorControlOutline({fieldName:this.field.name,isShow:!0}),this.expand(!0)},onMouseleave(e){this.showEntityEditorControlOutline({fieldName:this.field.name,isShow:!1}),this.expand(!1)}},mounted(){this.hasLargeContent=this.checkHasLargeContent(),s.watch(this.getexpandedConflictControls,this.onControlsExpandedModeChange)},template:'\n\t\t<div \n\t\t\tclass="bx-crm-ai-form-fill-merge-control__container"\n\t\t\t:class="{\'expanded\': isExpanded, \'covered\': coveredByAnother}"\n\t\t\t@mouseenter="onMouseenter"\n\t\t\t@mouseleave="onMouseleave"\n\t\t\tref="root"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass="bx-crm-ai-form-fill-merge-control-icon"\n\t\t\t\t@click="toggleAiValue(field)"\n\t\t\t>\n\n\t\t\t</div>\n\t\t\t<div class="bx-crm-ai-form-fill-merge-control-field">\n\t\t\t\t<div\n\t\t\t\t\tclass="bx-crm-ai-form-fill-merge-control-field-title"\n\t\t\t\t\t:title="field.title"\n\t\t\t\t>{{ field.title }}</div>\n\t\t\t\t<div class="bx-crm-ai-form-fill-merge-control-field-value-container">\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="fieldValue"\n\t\t\t\t\t\tclass="bx-crm-ai-form-fill-merge-control-field-value-container__value"\n\t\t\t\t\t\t:class="{\'expanded\': isExpanded, \'ai-value\': !field.isAiValuesUsed}"\n\t\t\t\t\t\t:title="this.value"\n\t\t\t\t\t>{{ this.value }}</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="bx-crm-ai-form-fill-merge-control-field-value-container__control"\n\t\t\t\t\t\t:class="{\'expanded\': isExpanded}"\n\t\t\t\t\t\t:style="{display: hasLargeContent ? \'block\': \'none\'}"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass="bx-crm-ai-form-fill-merge-control-right-column"\n\t\t\t\t@click="toggleAiValue(field)"\n\t\t\t>\n\t\t\t\t<div \n\t\t\t\t\tclass="bx-crm-ai-form-fill-merge-control-button">\n\t\t\t\t\t{{ replaceBtnText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'}},data:()=>({isRootMounted:!1}),computed:{...o.mapGetters(["conflictFields","eeControlPosition","eeControlPositions","getMainLayoutScrollPosition"])},methods:{getControlTopOffset(e){return this.eeControlPositions.get(e.name,0)}},mounted(){this.isRootMounted=!0},template:'\n\t\t<div ref="root" class="bx-crm-ai-merge-fields-merger ">\n\t\t\t<MergeControl\n\t\t\t\tv-if="isRootMounted"\n\t\t\t\tv-for="field in conflictFields" :key="field.name"\n\t\t\t\tclass="bx-crm-ai-merge-fields-merger__field"\n\t\t\t\t:style="{top: getControlTopOffset(field) + \'px\'}"\n\t\t\t\t:field="field"\n\t\t\t\t:tmp="getControlTopOffset(field)"\n\t\t\t></MergeControl>\n\t\t</div>\n\t'},FloatingActionButton:g,CloseConfirm:h,FeedbackMessage:f},data:()=>({}),computed:{...o.mapGetters(["conflictFields","isLoading","eeControlPositions","getFirstUnseenFieldPosition","aiValuesAppliedCount","mergeUuid","isSliderConfirmPopupShown","isFeedbackMessageShown","isFooterHiddenAndSaveDisabled"])},methods:{...o.mapActions(["initialize","saveFormFieldsToMerge","updateControlPositionInfo","updateSliderFooter","closeFormWithoutConfirm","sendAiCallParsingData"]),...o.mapMutations(["changeMainLayoutScrollPosition","startLoading","stopLoading","setMainLayoutScrollHeight"]),onFooterSaveBtn(){this.saveFormFieldsToMerge().then(()=>this.sendAiCallParsingData("conflict_accept_changes")).catch(()=>{})},onFooterCancelBtn(){this.closeFormWithoutConfirm(),this.sendAiCallParsingData("conflict_cancel_changes")},onCloseConfirm(){this.closeFormWithoutConfirm()},handleScroll:null,positionChanged(){this.setMainLayoutScrollHeight(this.$refs.layout.scrollHeight),this.changeMainLayoutScrollPosition({scrollTop:this.$refs.layout.scrollTop,containerHeight:this.$refs.layout.getBoundingClientRect().height})},resizeHandler(){this.handleScroll()},scrollToNext(){const e=this.getFirstUnseenFieldPosition;e&&m(this.$refs.layout,e,300)},subscribeInternalEvents(){this.$Bitrix.eventEmitter.subscribe("crm:ai:form-fill:scroll-to-next",this.scrollToNext),this.$Bitrix.eventEmitter.subscribe("crm:ai:form-fill:close-confirm:confirmClose",this.onCloseConfirm),this.$Bitrix.eventEmitter.subscribe("crm:ai:form-fill:close-confirm:cancelClose",this.scrollToNext)},unSubscribeInternalEvents(){this.$Bitrix.eventEmitter.unsubscribe("crm:ai:form-fill:scroll-to-next",this.scrollToNext),this.$Bitrix.eventEmitter.unsubscribe("crm:ai:form-fill:close-confirm:confirmClose",this.onCloseConfirm),this.$Bitrix.eventEmitter.unsubscribe("crm:ai:form-fill:close-confirm:cancelClose",this.scrollToNext)},autoScrollToFirst(){const e=this.$refs.layout.getBoundingClientRect().height,t=this.getFirstUnseenFieldPosition;t&&t>e&&m(this.$refs.layout,t,800)}},async mounted(){this.updateSliderFooter(),this.startLoading(),this.handleScroll=c.Runtime.throttle(()=>{this.positionChanged()},300),await this.initialize(),this.positionChanged(),this.subscribeInternalEvents(),await this.$nextTick(()=>{c.Event.bind(window,"resize",this.resizeHandler)}),this.stopLoading(),this.autoScrollToFirst(),e.sliderButtonsAdapter.onSaveCallback=this.onFooterSaveBtn,e.sliderButtonsAdapter.onCancelCallback=this.onFooterCancelBtn},watch:{aiValuesAppliedCount:{handler(e,t){this.updateSliderFooter()},immediate:!0}},unmounted(){this.unSubscribeInternalEvents(),c.Event.unbind(window,"resize",this.resizeHandler)},template:'\n\t\t<div class="bx-crm-ai-merge-fields" :class="{\'hidden-footer\': isFooterHiddenAndSaveDisabled}">\n\t\t\t<div \n\t\t\t\tclass="bx-crm-ai-merge-fields-layout" \n\t\t\t\t@scroll="handleScroll"\n\t\t\t\tref="layout"\n\t\t\t\t:style="{\'visibility\': !isLoading ? \'visible\' : \'hidden\'}"\n\t\t\t\t:class="{\'hidden-footer\': isFooterHiddenAndSaveDisabled}"\n\t\t\t>\n\t\t\t\t<EntityEditorWrapper class="bx-crm-ai-merge-fields-layout__ee_column"/>\n\t\t\t\t<Merger class="bx-crm-ai-merge-fields-layout__aifields_column"/>\n\t\t\t\t<div class="bx-crm-ai-merge-fields-layout__floating-button_column">\n\t\t\t\t\t<FloatingActionButton/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Loader v-if="isLoading" />\n\t\t\t<CloseConfirm v-if="isSliderConfirmPopupShown" />\n\t\t\t<FeedbackMessage v-if="isFeedbackMessageShown" />\n\t\t</div>\n\t'};var C=babelHelpers.classPrivateFieldLooseKey("editor"),L=babelHelpers.classPrivateFieldLooseKey("initialContainerTop"),B=babelHelpers.classPrivateFieldLooseKey("onUserFieldDeployedCb"),P=babelHelpers.classPrivateFieldLooseKey("refreshControlLayout"),y=babelHelpers.classPrivateFieldLooseKey("setEntityEditorBBValue"),E=babelHelpers.classPrivateFieldLooseKey("setPlainTextFieldValue"),I=babelHelpers.classPrivateFieldLooseKey("setUserFieldValue"),_=babelHelpers.classPrivateFieldLooseKey("getValueFromControl");class A{constructor(){Object.defineProperty(this,_,{value:T}),Object.defineProperty(this,I,{value:w}),Object.defineProperty(this,E,{value:M}),Object.defineProperty(this,y,{value:S}),Object.defineProperty(this,P,{value:H}),Object.defineProperty(this,C,{writable:!0,value:null}),Object.defineProperty(this,L,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:null})}async init(e){babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getContainer().getBoundingClientRect().y+5,c.addCustomEvent(window,"BX.UI.EntityUserFieldLayoutLoader:onUserFieldDeployed",e=>{c.Type.isFunction(babelHelpers.classPrivateFieldLooseBase(this,B)[B])&&babelHelpers.classPrivateFieldLooseBase(this,B)[B](e)})}setOnUserFieldDeployedCb(e){babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e}async getEditorControlsParams(e){await p(10);const t=[];let i=0;for(const s of babelHelpers.classPrivateFieldLooseBase(this,C)[C].getAllControls()){if(!e.has(s.getId())||!s.getWrapper())continue;const[o,l]=babelHelpers.classPrivateFieldLooseBase(this,_)[_](s);t.push({fieldId:s.getId(),relatedFieldOffsetY:s.getWrapper().getBoundingClientRect().y,originalValue:o,originalModel:l,order:i}),i++}return t}async getEditorControlsPositions(e){const t=new Map;for(const i of babelHelpers.classPrivateFieldLooseBase(this,C)[C].getAllControls()){if(!e.has(i.getId())||!i.getWrapper())continue;const s=i.getWrapper().getBoundingClientRect().y;t.set(i.getId(),s-babelHelpers.classPrivateFieldLooseBase(this,L)[L])}return t}setControlOutline(e,t){const i=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getControlById(e);if(!i)return;const s=i.getWrapper();t?c.Dom.addClass(s,"bx-crm-ai-merge-fields-ee-control-outline"):c.Dom.removeClass(s,"bx-crm-ai-merge-fields-ee-control-outline")}setControlAiClass(e,t){const i=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getControlById(e);if(!i)return;const s=i.getWrapper();t?c.Dom.addClass(s,"bx-crm-ai-merge-fields-ee-control-ai-value"):c.Dom.removeClass(s,"bx-crm-ai-merge-fields-ee-control-ai-value")}async setFieldValue(e,t){const i=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getControlById(e);if(i)switch(i.constructor){case BX.Crm.EntityEditorText:babelHelpers.classPrivateFieldLooseBase(this,E)[E](e,t.value);break;case BX.UI.EntityEditorBB:babelHelpers.classPrivateFieldLooseBase(this,y)[y](e,t.value),babelHelpers.classPrivateFieldLooseBase(this,P)[P](i);break;case BX.Crm.EntityEditorUserField:babelHelpers.classPrivateFieldLooseBase(this,I)[I](e,t.model),babelHelpers.classPrivateFieldLooseBase(this,P)[P](i);break;default:throw new Error("Not supported field type")}}}function H(e){e.refreshLayout({reset:!0})}function S(e,t){const i=e+"_HTML";babelHelpers.classPrivateFieldLooseBase(this,C)[C].getModel().setField(i,t,{enableNotification:!0})}function M(e,t){babelHelpers.classPrivateFieldLooseBase(this,C)[C].getModel().setField(e,t,{enableNotification:!0})}function w(e,t){babelHelpers.classPrivateFieldLooseBase(this,C)[C].getModel().setField(e,t)}function T(e){const t=e.getValue();let i=null,s=null;if(e.constructor===BX.UI.EntityEditorBB){const t=babelHelpers.classPrivateFieldLooseBase(this,C)[C].getModel(),s=e.getId()+"_HTML";i=t.getField(s,"")}else c.Type.isObject(t)&&Object.hasOwn(t,"VALUE")?(i=t.VALUE,s=t):(c.Type.isString(t)||c.Type.isNumber(t))&&(i=t,s=null);return[i,s]}var O={isLoading:e=>e.isLoading,conflictFields:e=>e.conflictFields.sort((e,t)=>e.order-t.order),mergeUuid:e=>e.mergeUuid,activityId:e=>e.activityId,activityDirection:e=>e.activityDirection,activityProvider:e=>e.activityProvider,summarizeJobId:e=>e.summarizeJobId,getEntityInfo:e=>e.entityInfo,isEntityEditorLoaded:e=>e.isEntityEditorLoaded,eeControlPosition:e=>t=>e.eeControlPositions.get(t,0),eeControlPositions:e=>e.eeControlPositions,getexpandedConflictControls:e=>e.expandedConflictControls,getNotVisibleUnresolvedCount:e=>e.notVisibleUnresolvedCount,getMainLayoutScrollPosition:e=>e.mainLayoutScrollPosition,getMainLayoutContainerHeight:e=>e.mainLayoutContainerHeight,getMainLayoutScrollHeight:e=>e.mainLayoutScrollHeight,getFirstUnseenFieldPosition:e=>{const t=e.mainLayoutScrollPosition;let i=null,s=1/0;for(const[o,l]of e.eeControlPositions){const a=e.conflictFields.find(e=>e.name===o);!a||a.isAiValuesUsed||t+120>l||l<s&&(s=l,i=o)}return i?e.eeControlPositions.get(i):null},isFieldsTouched:e=>e.isFieldsTouched,aiValuesAppliedCount:e=>e.aiValuesAppliedCount,isFooterHiddenAndSaveDisabled:e=>0===e.aiValuesAppliedCount,isSliderConfirmPopupShown:e=>e.isSliderConfirmPopupShown,isNeededShowCloseConfirm:e=>e.isNeededShowCloseConfirm,isFeedbackMessageShown:e=>e.aiFeedback.isMessageComponentShown,isAiFeedbackShowBeforeClose:e=>e.aiFeedback.showBeforeClose&&e.activityProvider===l.ActivityProvider.call,aiFeedback:e=>e.aiFeedback},R={setMergeUUID:(e,t)=>{e.mergeUuid=t},setActivityId:(e,t)=>{e.activityId=t},setActivityDirection:(e,t)=>{e.activityDirection=t},setActivityProvider:(e,t)=>{e.activityProvider=t},setSummarizeJobId:(e,t)=>{e.summarizeJobId=t},startLoading:e=>{e.isLoading=!0},stopLoading:e=>{e.isLoading=!1},setEntityInfo:(e,t)=>{e.entityInfo=t},setConflictFields:(e,t)=>{e.conflictFields=t},setEditMode:(e,t)=>{e.isEditMode=t},setIsEntityEditorLoaded(e,t){e.isEntityEditorLoaded=t},updateConflictField:(e,{name:t,field:i})=>{e.conflictFields=e.conflictFields.map(e=>e.name===t?{...e,...i}:e);const s=e.conflictFields.filter(e=>e.isAiValuesUsed).length;e.aiValuesAppliedCount=s,e.isNeededShowCloseConfirm=s>0},setEeControlPositions:(e,{fieldId:t,topPosition:i})=>{e.eeControlPositions.set(t,i)},toggleExpandedConflictControls:(e,{fieldId:t,size:i,isExpanded:s})=>{s?e.expandedConflictControls.set(t,i):e.expandedConflictControls.delete(t)},changeMainLayoutScrollPosition:(e,{scrollTop:t,containerHeight:i})=>{const s=t+i;e.mainLayoutScrollPosition=t,e.mainLayoutContainerHeight=i;const o=[];for(const[t,i]of e.eeControlPositions)s<i+30&&o.push(t);if(0===o.length)return void(e.notVisibleUnresolvedCount=0);let l=0;for(const t of o){const i=e.conflictFields.find(e=>e.name===t);i&&!i.isAiValuesUsed&&l++}e.notVisibleUnresolvedCount=l},setIsFieldsTouched(e,t){e.isFieldsTouched=t},setIsConfirmPopupShow(e,t){e.isSliderConfirmPopupShown=t},setNeededShowCloseConfirm(e,t){e.isNeededShowCloseConfirm=t},showFeedbackMessageIfNeeded(e,t){e.aiFeedback.feedbackWasSent||"FEEDBACK_TRIGGER_CONTROL"===t&&e.aiFeedback.isShownByReturnBtn||e.activityProvider===l.ActivityProvider.openLine||(e.aiFeedback.lastTriggeredBy=t,"FEEDBACK_TRIGGER_CONTROL"===t&&(e.aiFeedback.isShownByReturnBtn=!0),e.aiFeedback.isMessageComponentShown=!0)},hideFeedbackMessage(e){e.aiFeedback.isMessageComponentShown=!1},setAiFeedbackWasSent(e,t){e.aiFeedback.feedbackWasSent=t},setAiFeedbackShowBeforeClose(e,t){e.aiFeedback.showBeforeClose=t},setMainLayoutScrollHeight(e,t){e.mainLayoutScrollHeight=t}},x=babelHelpers.classPrivateFieldLooseKey("params"),U=babelHelpers.classPrivateFieldLooseKey("fetchEntityEditor");class k{constructor(e){Object.defineProperty(this,U,{value:D}),Object.defineProperty(this,x,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,x)[x]=e}async render(){return babelHelpers.classPrivateFieldLooseBase(this,U)[U](babelHelpers.classPrivateFieldLooseBase(this,x)[x]),new Promise(e=>{c.addCustomEvent(window,"BX.Crm.EntityEditor:onUserFieldsDeployed",async t=>{t.getId()===babelHelpers.classPrivateFieldLooseBase(this,x)[x].domContainerId&&e(t)})})}}function D(e){let t="";switch(e.entityTypeName){case"DEAL":t="/bitrix/components/bitrix/crm.deal.details/ajax.php";break;case"LEAD":t="/bitrix/components/bitrix/crm.lead.details/ajax.php";break;default:throw new Error("Unknown entity type: "+e.entityTypeName)}t=`${t}?sessid=${BX.bitrix_sessid()}`,BX.ajax.post(t,{ACTION:"PREPARE_EDITOR_HTML",ACTION_ENTITY_TYPE_NAME:e.entityTypeName,ACTION_ENTITY_ID:e.entityId,GUID:e.domContainerId,CONFIG_ID:e.configId,FORCE_DEFAULT_CONFIG:"N",FORCE_DEFAULT_OPTIONS:"Y",IS_EMBEDDED:"Y",ENABLE_CONFIG_SCOPE_TOGGLE:"N",ENABLE_CONFIGURATION_UPDATE:"N",ENABLE_REQUIRED_USER_FIELD_CHECK:"N",ENABLE_FIELDS_CONTEXT_MENU:"N",CONTEXT:{},READ_ONLY:"Y",MODULE_ID:"crm"},()=>{})}var N={async initialize({dispatch:e,getters:t}){await e("fetchFormFieldsToMerge"),await e("createEntityEditor"),await e("collectFieldDataFromEntityEditor"),await e("updateControlPositionInfo")},async fetchFormFieldsToMerge({commit:e,getters:t}){const i=await G(t.mergeUuid);e("setConflictFields",i.fields.map(e=>({name:e.name,type:e.type,title:e.title,aiModel:e.aiModel,isMultiple:e.isMultiple,isUserField:e.isUserField,aiValue:e.aiModel.VALUE,originalValue:null,originalModel:null,isAiValuesUsed:!1}))),e("setEditMode",i.editMode),e("setEntityInfo",i.target),e("setAiFeedbackWasSent",i.target.feedbackWasSent),e("setAiFeedbackShowBeforeClose",!i.target.feedbackWasSent)},async saveFormFieldsToMerge({getters:e,commit:t,dispatch:i}){const s=e.conflictFields.filter(e=>e.isAiValuesUsed).map(e=>e.name),o=e.mergeUuid,l=await BX.ajax.runAction("crm.timeline.ai.applyMerge",{method:"GET",getParameters:{mergeUuid:o,fieldNamesToApply:s}});t("setAiFeedbackShowBeforeClose",!1),"success"===l.status?i("closeFormWithoutConfirm"):d.UI.Notification.Center.notify({content:c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_SAVE_ERROR"),autoHideDelay:5e3})},showFeedbackMessageBeforeClose({getters:e,commit:t}){t("showFeedbackMessageIfNeeded","FEEDBACK_TRIGGER_APP_CLOSE"),t("setAiFeedbackShowBeforeClose",!1)},closeFeedbackMessage({getters:e,commit:t,dispatch:i},s=!1){s&&(i("sendFeedBack"),t("setAiFeedbackShowBeforeClose",!1)),t("hideFeedbackMessage"),"FEEDBACK_TRIGGER_APP_CLOSE"===e.aiFeedback.lastTriggeredBy&&i("closeFormWithoutConfirm")},closeFormWithoutConfirm({getters:e,commit:t}){t("setNeededShowCloseConfirm",!1),t("setIsConfirmPopupShow",!1);const i=e.mergeUuid;c.onCustomEvent(window,"BX.Crm.AiFormFill:CloseSlider",{mergeUuid:i})},async setEditorFieldValue({dispatch:e,getters:t,commit:i},s){const o=s.name,l=!s.isAiValuesUsed,a=l?s.aiValue:s.originalValue,n=l?s.aiModel:s.originalModel;l||setTimeout(()=>{i("showFeedbackMessageIfNeeded","FEEDBACK_TRIGGER_CONTROL")},300);const r={value:a,model:n};await K.setFieldValue(o,r),await K.setControlAiClass(o,l),i("setIsFieldsTouched",!0),i("updateConflictField",{name:o,field:{isAiValuesUsed:!s.isAiValuesUsed}})},async createEntityEditor({getters:e,commit:t,dispatch:i}){const s=e.getEntityInfo,o=new k({entityId:s.entityId,configId:s.editorId,entityTypeName:s.entityTypeName,domContainerId:"crm-ai-merge-fields__container__"+e.mergeUuid}),l=await o.render();await K.init(l),K.setOnUserFieldDeployedCb(async()=>{const t=Math.floor(e.getMainLayoutScrollPosition+e.getMainLayoutContainerHeight);let s=0;(e.getMainLayoutScrollHeight||0)-t<40&&(s=400),await p(s),i("updateControlPositionInfo")})},async collectFieldDataFromEntityEditor({getters:e,commit:t,dispatch:i}){const s=e.conflictFields,o=new Set(s.map(e=>e.name)),l=await K.getEditorControlsParams(o);if(0!==l.length){for(const e of l)t("updateConflictField",{name:e.fieldId,field:{originalValue:e.originalValue,originalModel:e.originalModel,order:e.order}}),t("setEeControlPositions",{fieldId:e.fieldId,topPosition:e.relatedFieldOffsetY});t("setIsEntityEditorLoaded",!0)}},async updateControlPositionInfo({getters:e,commit:t},{updateOnlyFrom:i}={}){const s=e.conflictFields;if(0===s.length)return;const o=new Set(s.map(e=>e.name)),l=await K.getEditorControlsPositions(o),a=e.getMainLayoutScrollPosition||0;for(const[e,t]of l)l.set(e,a+t);for(const e of s){const s=e.name;!i&&i>e.order||l.has(s)&&t("setEeControlPositions",{fieldId:s,topPosition:l.get(s)})}},async applyAllAiFields({dispatch:e,getters:t}){for(const i of t.conflictFields)i.isAiValuesUsed||e("setEditorFieldValue",i)},revertAllAiFields({dispatch:e,getters:t}){for(const i of t.conflictFields)i.isAiValuesUsed&&e("setEditorFieldValue",i)},showEntityEditorControlOutline(e,{fieldName:t,isShow:i}){K.setControlOutline(t,i)},updateSliderFooter({getters:t}){const i=t.isFooterHiddenAndSaveDisabled;e.sliderButtonsAdapter.saveButton.setDisabled(i),null==e.copilotSliderInstance||e.copilotSliderInstance.footerDisplay(!i)},async sendFeedBack({commit:e,getters:t}){const i=t.mergeUuid;if(t.aiFeedback.checkFeedbackBeforeSend){if(await V(i))return void e("setAiFeedbackWasSent",!0)}const s=t.getEntityInfo.entityTypeName;a.sendFeedback(i,s,t.activityId),e("setAiFeedbackWasSent",!0)},sendAiCallParsingData({getters:e},t){const i=e.getEntityInfo.entityTypeName,s=e.activityId,o=e.activityDirection;r.sendData(n.Builder.AI.CallParsingEvent.createDefault(i,s,n.Dictionary.STATUS_SUCCESS).setElement(t).setActivityDirection(o).buildData()),r.sendData(n.Builder.AI.CallParsingEvent.createDefault(i,s,n.Dictionary.STATUS_SUCCESS).setTool(n.Dictionary.TOOL_CRM).setCategory(n.Dictionary.CATEGORY_AI_OPERATIONS).setElement(t).setActivityDirection(o).buildData())}};const V=async e=>a.wasFeedbackSent(e),G=async e=>(await BX.ajax.runAction("crm.timeline.ai.mergeFields",{method:"GET",getParameters:{mergeUuid:e}})).data;let K=null;var X=babelHelpers.classPrivateFieldLooseKey("application"),j=babelHelpers.classPrivateFieldLooseKey("options"),W=babelHelpers.classPrivateFieldLooseKey("store");class z{constructor(e,t={}){if(Object.defineProperty(this,X,{writable:!0,value:void 0}),Object.defineProperty(this,j,{writable:!0,value:void 0}),Object.defineProperty(this,W,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,j)[j]=t,this.rootNode=document.querySelector("#"+e),!babelHelpers.classPrivateFieldLooseBase(this,j)[j].mergeUuid)throw new Error("param mergeUuid is required")}get application(){return babelHelpers.classPrivateFieldLooseBase(this,X)[X]}get store(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W]}start(){K=new A,babelHelpers.classPrivateFieldLooseBase(this,W)[W]=o.createStore({state:{mergeUuid:null,isLoading:!0,conflictFields:[],isEditMode:!1,isEntityEditorLoaded:!1,entityInfo:null,eeControlPositions:new Map,expandedConflictControls:new Map,mainLayoutScrollPosition:null,mainLayoutContainerHeight:null,mainLayoutScrollHeight:null,notVisibleUnresolvedCount:0,isFieldsTouched:!1,aiValuesAppliedCount:0,isSliderConfirmPopupShown:!1,isNeededShowCloseConfirm:!1,aiFeedback:{feedbackWasSent:!1,isShownByReturnBtn:!1,isMessageComponentShown:!1,lastTriggeredBy:null,showBeforeClose:!0,checkFeedbackBeforeSend:!1}},getters:O,mutations:R,actions:N}),babelHelpers.classPrivateFieldLooseBase(this,X)[X]=s.BitrixVue.createApp({name:"AiFormFill",components:{Main:F},beforeCreate(){this.$bitrix.Application.set(this)},template:"\n\t\t\t\t<Main/>\n\t\t\t"}),babelHelpers.classPrivateFieldLooseBase(this,W)[W].commit("setMergeUUID",babelHelpers.classPrivateFieldLooseBase(this,j)[j].mergeUuid),babelHelpers.classPrivateFieldLooseBase(this,W)[W].commit("setActivityId",babelHelpers.classPrivateFieldLooseBase(this,j)[j].activityId),babelHelpers.classPrivateFieldLooseBase(this,W)[W].commit("setActivityDirection",babelHelpers.classPrivateFieldLooseBase(this,j)[j].activityDirection),babelHelpers.classPrivateFieldLooseBase(this,W)[W].commit("setActivityProvider",babelHelpers.classPrivateFieldLooseBase(this,j)[j].activityProvider),babelHelpers.classPrivateFieldLooseBase(this,W)[W].commit("setSummarizeJobId",babelHelpers.classPrivateFieldLooseBase(this,j)[j].summarizeJobId),babelHelpers.classPrivateFieldLooseBase(this,X)[X].use(babelHelpers.classPrivateFieldLooseBase(this,W)[W]),babelHelpers.classPrivateFieldLooseBase(this,X)[X].mount(this.rootNode)}stop(){babelHelpers.classPrivateFieldLooseBase(this,X)[X].unmount(),babelHelpers.classPrivateFieldLooseBase(this,X)[X]=null,babelHelpers.classPrivateFieldLooseBase(this,W)[W]=null,K=null}isNeededShowCloseConfirm(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].getters.isNeededShowCloseConfirm}showCloseConfirm(){babelHelpers.classPrivateFieldLooseBase(this,W)[W].commit("setIsConfirmPopupShow",!0)}isShowAiFeedbackBeforeClose(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].getters.isAiFeedbackShowBeforeClose}showAiFeedbackBeforeClose(){babelHelpers.classPrivateFieldLooseBase(this,W)[W].dispatch("showFeedbackMessageBeforeClose")}isAppLoading(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W].getters.isLoading}}var $=babelHelpers.classPrivateFieldLooseKey("onSaveCallback"),q=babelHelpers.classPrivateFieldLooseKey("onCancelCallback"),Y=babelHelpers.classPrivateFieldLooseKey("saveButton"),J=babelHelpers.classPrivateFieldLooseKey("cancelButton"),Q=babelHelpers.classPrivateFieldLooseKey("createButtons");class Z{constructor(){Object.defineProperty(this,Q,{value:ee}),Object.defineProperty(this,$,{writable:!0,value:null}),Object.defineProperty(this,q,{writable:!0,value:null}),Object.defineProperty(this,Y,{writable:!0,value:null}),Object.defineProperty(this,J,{writable:!0,value:null}),babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]()}set onSaveCallback(e){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=e}set onCancelCallback(e){babelHelpers.classPrivateFieldLooseBase(this,q)[q]=e}get saveButton(){return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]}get cancelButton(){return babelHelpers.classPrivateFieldLooseBase(this,J)[J]}getButtons(){return[babelHelpers.classPrivateFieldLooseBase(this,Y)[Y],babelHelpers.classPrivateFieldLooseBase(this,J)[J]]}}function ee(){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=new b.Button({text:c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_SAVE"),size:b.Button.Size.MEDIUM,color:b.Button.Color.SUCCESS,dependOnTheme:!0,onclick:()=>{c.Type.isFunction(babelHelpers.classPrivateFieldLooseBase(this,$)[$])&&babelHelpers.classPrivateFieldLooseBase(this,$)[$]()}}),babelHelpers.classPrivateFieldLooseBase(this,J)[J]=new b.Button({text:c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_CANCEL"),size:b.Button.Size.MEDIUM,color:b.ButtonColor.LIGHT_BORDER,onclick:()=>{c.Type.isFunction(babelHelpers.classPrivateFieldLooseBase(this,q)[q])&&babelHelpers.classPrivateFieldLooseBase(this,q)[q]()}})}e.sliderButtonsAdapter=null,e.copilotSliderInstance=null;var te=babelHelpers.classPrivateFieldLooseKey("options"),ie=babelHelpers.classPrivateFieldLooseKey("copilotSliderClass"),se=babelHelpers.classPrivateFieldLooseKey("app"),oe=babelHelpers.classPrivateFieldLooseKey("sliderInstance"),le=babelHelpers.classPrivateFieldLooseKey("onLoadEventName"),ae=babelHelpers.classPrivateFieldLooseKey("onCloseEventName"),ne=babelHelpers.classPrivateFieldLooseKey("sliderUrl"),re=babelHelpers.classPrivateFieldLooseKey("containerId"),de=babelHelpers.classPrivateFieldLooseKey("makeSliderToolbar"),ce=babelHelpers.classPrivateFieldLooseKey("createSliderWrapper"),be=babelHelpers.classPrivateFieldLooseKey("calculateSliderWidth"),ue=babelHelpers.classPrivateFieldLooseKey("onSliderLoadFn"),pe=babelHelpers.classPrivateFieldLooseKey("onSliderCloseFn"),me=babelHelpers.classPrivateFieldLooseKey("onAiFormFillDownFn");class he{constructor(t,i){Object.defineProperty(this,me,{value:Ee}),Object.defineProperty(this,pe,{value:ye}),Object.defineProperty(this,ue,{value:Pe}),Object.defineProperty(this,be,{value:Be}),Object.defineProperty(this,ce,{value:Le}),Object.defineProperty(this,de,{value:Ce}),Object.defineProperty(this,re,{get:Fe,set:void 0}),Object.defineProperty(this,ne,{get:ge,set:void 0}),Object.defineProperty(this,ae,{get:fe,set:void 0}),Object.defineProperty(this,le,{get:ve,set:void 0}),Object.defineProperty(this,te,{writable:!0,value:void 0}),Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,se,{writable:!0,value:void 0}),Object.defineProperty(this,oe,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,te)[te]=t,babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]=i,e.sliderButtonsAdapter=new Z}create(){babelHelpers.classPrivateFieldLooseBase(this,oe)[oe]=babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](),c.addCustomEvent("SidePanel.Slider:onLoad",babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].bind(this),babelHelpers.classPrivateFieldLooseBase(this,le)[le]),c.addCustomEvent("SidePanel.Slider:onClose",babelHelpers.classPrivateFieldLooseBase(this,pe)[pe].bind(this),babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]),c.addCustomEvent(window,"BX.Crm.AiFormFill:CloseSlider",babelHelpers.classPrivateFieldLooseBase(this,me)[me].bind(this)),babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].open()}}function ve(){return"CopilotSliderWrapper:onLoad_"+babelHelpers.classPrivateFieldLooseBase(this,te)[te].mergeUuid}function fe(){return"CopilotSliderWrapper:onClose_"+babelHelpers.classPrivateFieldLooseBase(this,te)[te].mergeUuid}function ge(){return"crm:copilot-wrapper-slider-"+babelHelpers.classPrivateFieldLooseBase(this,te)[te].mergeUuid}function Fe(){return"crm-ai-merge-fields__container__"+babelHelpers.classPrivateFieldLooseBase(this,te)[te].mergeUuid}function Ce(){const e=babelHelpers.classPrivateFieldLooseBase(this,ie)[ie].makeDefaultToolbarButtons(),t=new b.Button({text:c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_TRANSCRIPTION"),size:u.Settings.get(u.Setting.UseAirDesign)?b.Button.Size.SMALL:b.Button.Size.MEDIUM,color:b.Button.Color.LIGHT_BORDER,dependOnTheme:!0,useAirDesign:u.Settings.get(u.Setting.UseAirDesign),style:b.Button.AirStyle.OUTLINE,onclick:()=>{if(top.BX.Helper){new l.Call.Transcription({activityId:babelHelpers.classPrivateFieldLooseBase(this,te)[te].activityId,ownerTypeId:babelHelpers.classPrivateFieldLooseBase(this,te)[te].ownerTypeId,ownerId:babelHelpers.classPrivateFieldLooseBase(this,te)[te].ownerId,languageTitle:babelHelpers.classPrivateFieldLooseBase(this,te)[te].languageTitle}).open()}}});let i=[new b.Button({text:c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_RESUME"),size:u.Settings.get(u.Setting.UseAirDesign)?b.Button.Size.SMALL:b.Button.Size.MEDIUM,color:b.Button.Color.LIGHT_BORDER,dependOnTheme:!0,useAirDesign:u.Settings.get(u.Setting.UseAirDesign),style:b.Button.AirStyle.OUTLINE,onclick:()=>{if(top.BX.Helper){new l.Call.Summary({activityId:babelHelpers.classPrivateFieldLooseBase(this,te)[te].activityId,ownerTypeId:babelHelpers.classPrivateFieldLooseBase(this,te)[te].ownerTypeId,ownerId:babelHelpers.classPrivateFieldLooseBase(this,te)[te].ownerId,languageTitle:babelHelpers.classPrivateFieldLooseBase(this,te)[te].languageTitle,activityProvider:babelHelpers.classPrivateFieldLooseBase(this,te)[te].activityProvider,jobId:babelHelpers.classPrivateFieldLooseBase(this,te)[te].summarizeJobId}).open()}}}),...e];return babelHelpers.classPrivateFieldLooseBase(this,te)[te].activityProvider===l.ActivityProvider.call&&(i=[t,...i]),i}function Le(){const t=e.sliderButtonsAdapter.getButtons(),i=babelHelpers.classPrivateFieldLooseBase(this,de)[de]();return new(babelHelpers.classPrivateFieldLooseBase(this,ie)[ie])({content:()=>`<div id="${babelHelpers.classPrivateFieldLooseBase(this,re)[re]}"></div>`,sliderTitle:c.Loc.getMessage("CRM_AI_FORM_FILL_MERGER_TITLE"),label:babelHelpers.classPrivateFieldLooseBase(this,te)[te].label,extensions:["crm.ai.form-fill","crm.entity-editor"],url:babelHelpers.classPrivateFieldLooseBase(this,ne)[ne],width:babelHelpers.classPrivateFieldLooseBase(this,be)[be](),toolbar:()=>i,buttons:()=>t})}function Be(){const e=BX.SidePanel.Instance.getTopSlider().getWidth()||.86*window.screen.width;return Math.floor(.86*e)}function Pe(t){t.getSlider().getUrl()===babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]&&(e.copilotSliderInstance=babelHelpers.classPrivateFieldLooseBase(this,oe)[oe],babelHelpers.classPrivateFieldLooseBase(this,se)[se]=new z(babelHelpers.classPrivateFieldLooseBase(this,re)[re],{mergeUuid:babelHelpers.classPrivateFieldLooseBase(this,te)[te].mergeUuid,activityId:babelHelpers.classPrivateFieldLooseBase(this,te)[te].activityId,activityDirection:babelHelpers.classPrivateFieldLooseBase(this,te)[te].activityDirection,activityProvider:babelHelpers.classPrivateFieldLooseBase(this,te)[te].activityProvider,summarizeJobId:babelHelpers.classPrivateFieldLooseBase(this,te)[te].summarizeJobId}),babelHelpers.classPrivateFieldLooseBase(this,se)[se].start(),c.removeAllCustomEvents("SidePanel.Slider:onLoad",babelHelpers.classPrivateFieldLooseBase(this,le)[le]))}function ye(t){if(t.getSlider().getUrl()===babelHelpers.classPrivateFieldLooseBase(this,ne)[ne])if(babelHelpers.classPrivateFieldLooseBase(this,se)[se]&&!babelHelpers.classPrivateFieldLooseBase(this,se)[se].isAppLoading()){if(babelHelpers.classPrivateFieldLooseBase(this,se)[se].isNeededShowCloseConfirm())return babelHelpers.classPrivateFieldLooseBase(this,se)[se].showCloseConfirm(),void t.denyAction();if(babelHelpers.classPrivateFieldLooseBase(this,se)[se].isShowAiFeedbackBeforeClose())return babelHelpers.classPrivateFieldLooseBase(this,se)[se].showAiFeedbackBeforeClose(),void t.denyAction();c.removeAllCustomEvents("SidePanel.Slider:onClose",babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]),c.removeAllCustomEvents(window,"BX.Crm.AiFormFill:CloseSlider"),babelHelpers.classPrivateFieldLooseBase(this,se)[se]&&(babelHelpers.classPrivateFieldLooseBase(this,se)[se].stop(),babelHelpers.classPrivateFieldLooseBase(this,se)[se]=null),e.sliderButtonsAdapter=null,e.copilotSliderInstance=null}else t.denyAction()}function Ee(e){var t;(null==e||null==(t=e.data)?void 0:t.mergeUuid)===babelHelpers.classPrivateFieldLooseBase(this,te)[te].mergeUuid&&babelHelpers.classPrivateFieldLooseBase(this,oe)[oe].close()}e.createAiFormFillApplicationInsideSlider=function(e){var t,i,s;const o=t=>{new he(e,t).create()};c.Type.isFunction(null==(t=BX)||null==(i=t.Crm)||null==(s=i.AI)?void 0:s.Slider)?o(BX.Crm.AI.Slider):top.BX.Runtime.loadExtension("crm.ai.slider").then(e=>{const{Slider:t}=e;o(t)}).catch(()=>{throw new Error("Cant load Crm.AI.Slider extension")})}}(this.BX.Crm=this.BX.Crm||{},BX.Crm.AI,BX.UI.Dialogs,BX.Vue3,BX.Vue3.Vuex,BX.Crm.AI,BX.Crm.AI.Feedback,BX.Crm.Integration.Analytics,BX.UI.Analytics,BX,BX,BX.UI,BX.Crm.Integration.UI);
//# sourceMappingURL=ai-form-fill.bundle.js.map
