this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};this.BX.Crm.MessageSender=this.BX.Crm.MessageSender||{};(function(e,s,i,t,l,a){"use strict";let r=e=>e,n,o,c,d,b,v,p,h,u,m,P,L;var H=babelHelpers.classPrivateFieldLooseKey("bindElement");var y=babelHelpers.classPrivateFieldLooseKey("items");var g=babelHelpers.classPrivateFieldLooseKey("banners");var F=babelHelpers.classPrivateFieldLooseKey("itemsSort");var B=babelHelpers.classPrivateFieldLooseKey("analytics");var f=babelHelpers.classPrivateFieldLooseKey("popup");var S=babelHelpers.classPrivateFieldLooseKey("buildPopup");var E=babelHelpers.classPrivateFieldLooseKey("renderContent");var T=babelHelpers.classPrivateFieldLooseKey("renderBody");var C=babelHelpers.classPrivateFieldLooseKey("renderVisibleItems");var O=babelHelpers.classPrivateFieldLooseKey("renderItem");var x=babelHelpers.classPrivateFieldLooseKey("normalizeItemsSort");var N=babelHelpers.classPrivateFieldLooseKey("isHidden");var M=babelHelpers.classPrivateFieldLooseKey("sortItems");var A=babelHelpers.classPrivateFieldLooseKey("renderBanners");var $=babelHelpers.classPrivateFieldLooseKey("renderSingleBanner");var w=babelHelpers.classPrivateFieldLooseKey("renderFooter");var j=babelHelpers.classPrivateFieldLooseKey("openMessageSenderConnectionsSlider");var I=babelHelpers.classPrivateFieldLooseKey("openSlider");var _=babelHelpers.classPrivateFieldLooseKey("enterEditMode");var K=babelHelpers.classPrivateFieldLooseKey("getMaxVisibleChannels");var R=babelHelpers.classPrivateFieldLooseKey("getMinVisibleChannels");var D=babelHelpers.classPrivateFieldLooseKey("save");var X=babelHelpers.classPrivateFieldLooseKey("ensureMinVisibleChannels");var k=babelHelpers.classPrivateFieldLooseKey("ensureMaxVisibleChannels");var V=babelHelpers.classPrivateFieldLooseKey("updateItemsSort");class z extends i.EventEmitter{constructor(e={}){var i;super();Object.defineProperty(this,V,{value:be});Object.defineProperty(this,k,{value:de});Object.defineProperty(this,X,{value:ce});Object.defineProperty(this,D,{value:oe});Object.defineProperty(this,R,{value:ne});Object.defineProperty(this,K,{value:re});Object.defineProperty(this,_,{value:ae});Object.defineProperty(this,I,{value:le});Object.defineProperty(this,j,{value:te});Object.defineProperty(this,w,{value:ie});Object.defineProperty(this,$,{value:se});Object.defineProperty(this,A,{value:ee});Object.defineProperty(this,M,{value:Z});Object.defineProperty(this,N,{value:Y});Object.defineProperty(this,x,{value:Q});Object.defineProperty(this,O,{value:J});Object.defineProperty(this,C,{value:q});Object.defineProperty(this,T,{value:W});Object.defineProperty(this,E,{value:U});Object.defineProperty(this,S,{value:G});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});this.setEventNamespace("BX.Crm.MessageSender.ChannelSelector.Selector");babelHelpers.classPrivateFieldLooseBase(this,y)[y]=s.Type.isArray(e.items)?e.items:[];babelHelpers.classPrivateFieldLooseBase(this,g)[g]=s.Type.isArray(e.banners)?e.banners:[];babelHelpers.classPrivateFieldLooseBase(this,F)[F]=s.Type.isArray(e.itemsSort)?e.itemsSort:[];babelHelpers.classPrivateFieldLooseBase(this,x)[x](babelHelpers.classPrivateFieldLooseBase(this,y)[y],babelHelpers.classPrivateFieldLooseBase(this,F)[F]);babelHelpers.classPrivateFieldLooseBase(this,M)[M](babelHelpers.classPrivateFieldLooseBase(this,y)[y]);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=s.Type.isDomNode(e.bindElement)?e.bindElement:null;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=s.Type.isPlainObject(e.analytics)?e.analytics:null;this.subscribeFromOptions((i=e.events)!=null?i:{})}isShown(){var e;return Boolean((e=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:e.isShown())}show(){var e,s;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,f))[f])!=null?s:e[f]=babelHelpers.classPrivateFieldLooseBase(this,S)[S]();babelHelpers.classPrivateFieldLooseBase(this,f)[f].show()}close(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:e.close()}destroy(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:e.destroy();this.unsubscribeAll();babelHelpers.classPrivateFieldLooseBase(this,f)[f]=null;s.Runtime.destroy(this)}}function G(){return new t.Popup({bindElement:babelHelpers.classPrivateFieldLooseBase(this,H)[H],content:babelHelpers.classPrivateFieldLooseBase(this,E)[E](),autoHide:true,closeByEsc:true,padding:0,borderRadius:"24px",minWidth:350,maxWidth:650,events:{onShow:()=>{this.emit("onShow")},onClose:()=>{this.emit("onClose")},onDestroy:()=>{this.emit("onDestroy")}}})}function U(){const e=s.Tag.render(n||(n=r`<div class="crm-messagesender-channel-selector"></div>`));s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,T)[T](),e);if(s.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,g)[g])){s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,A)[A](),e)}s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,w)[w](),e);return e}function W(){return s.Tag.render(o||(o=r`
			<div class="crm-messagesender-channel-selector-body">
				<div class="crm-messagesender-channel-selector-title">${0}</div>
				<div class="crm-messagesender-channel-selector-list">${0}</div>
			</div>
		`),s.Loc.getMessage("CRM_MESSAGESENDER_CHANNEL_SELECTOR_ALL_CHANNELS"),babelHelpers.classPrivateFieldLooseBase(this,C)[C]())}function q(){const e=babelHelpers.classPrivateFieldLooseBase(this,y)[y].filter((e=>!babelHelpers.classPrivateFieldLooseBase(this,N)[N](e)));return e.map((e=>babelHelpers.classPrivateFieldLooseBase(this,O)[O](e)))}function J(e){const i=new a.Icon({icon:e.appearance.icon.title,color:e.appearance.icon.color});const t=()=>{e.onclick==null?void 0:e.onclick(e)};const l=s.Tag.render(c||(c=r`
			<div class="crm-messagesender-channel-selector-content">
				<div
					class="
						crm-messagesender-channel-selector-item-title
						crm-messagesender-channel-selector-ellipsis
					"
					title="${0}"
				>${0}</div>
			</div>
		`),s.Text.encode(e.appearance.title),s.Text.encode(e.appearance.title));if(s.Type.isStringFilled(e.appearance.subtitle)){s.Dom.append(s.Tag.render(d||(d=r`
					<div
						class="
							crm-messagesender-channel-selector-item-subtitle 
							crm-messagesender-channel-selector-ellipsis
						"
						title="${0}"
					>${0}</div>
				`),s.Text.encode(e.appearance.subtitle),s.Text.encode(e.appearance.subtitle)),l)}return s.Tag.render(b||(b=r`
			<div class="crm-messagesender-channel-selector-item" onclick="${0}">
				<div
					class="crm-messagesender-channel-selector-icon"
					style="background: ${0};"
				>${0}</div>
				${0}
			</div>
		`),t,s.Text.encode(e.appearance.icon.background),i.render(),l)}function Q(e,s){for(const i of e){if(!s.some((e=>e.channelId===i.id))){s.unshift({channelId:i.id,isHidden:false})}}babelHelpers.classPrivateFieldLooseBase(this,k)[k](s);babelHelpers.classPrivateFieldLooseBase(this,X)[X](s)}function Y(e){const s=babelHelpers.classPrivateFieldLooseBase(this,F)[F].find((s=>s.channelId===e.id));if(!s){throw new Error(`Position not found for item: ${e.id}`)}return s.isHidden}function Z(e){e.sort(((e,i)=>{const t=babelHelpers.classPrivateFieldLooseBase(this,F)[F].find((s=>s.channelId===e.id));const l=babelHelpers.classPrivateFieldLooseBase(this,F)[F].find((e=>e.channelId===i.id));if(t.isHidden&&!l.isHidden){return 1}if(!t.isHidden&&l.isHidden){return-1}const a=s.Type.isNil(t)?-1:babelHelpers.classPrivateFieldLooseBase(this,F)[F].indexOf(t);const r=s.Type.isNil(l)?-1:babelHelpers.classPrivateFieldLooseBase(this,F)[F].indexOf(l);return a-r}))}function ee(){const e=babelHelpers.classPrivateFieldLooseBase(this,g)[g].map((e=>babelHelpers.classPrivateFieldLooseBase(this,$)[$](e)));return s.Tag.render(v||(v=r`
			<div class="crm-messagesender-channel-selector-banner-container">
				<div class="crm-messagesender-channel-selector-banner-title">${0}</div>
				<div class="crm-messagesender-channel-selector-banner-list">${0}</div>
			</div>
		`),s.Loc.getMessage("CRM_MESSAGESENDER_CHANNEL_SELECTOR_RECOMMENDED"),e)}function se(e){let i=null;if(s.Type.isStringFilled(e.customIconName)&&/^[\w-]+$/.test(e.customIconName)){const t=`/bitrix/js/crm/messagesender/channel-selector/images/custom-icons/${s.Text.encode(e.customIconName)}.svg`;i=s.Tag.render(p||(p=r`
				<div class="crm-messagesender-channel-selector-icon">
					<img alt="${0}" src="${0}">
				</div>
			`),s.Text.encode(e.title),t)}else if(s.Type.isPlainObject(e.icon)){const t=new a.Icon({icon:e.icon.title,color:e.icon.color});i=s.Tag.render(h||(h=r`
				<div
					class="crm-messagesender-channel-selector-icon"
					style="background: ${0};"
				>${0}</div>
			`),s.Text.encode(e.icon.background),t.render())}else{throw new TypeError("Banner icon is not defined")}const t=new l.Button({text:s.Loc.getMessage("CRM_MESSAGESENDER_CHANNEL_SELECTOR_CONNECT"),useAirDesign:true,style:l.AirButtonStyle.OUTLINE,size:l.ButtonSize.SMALL,onclick:async()=>{const s=await babelHelpers.classPrivateFieldLooseBase(this,I)[I](e.connectionUrl,{width:700});this.emit("onPromoBannerSliderClose",{bannerId:e.id,connectStatus:s.getData().get("status")})}});return s.Tag.render(u||(u=r`
			<div class="crm-messagesender-channel-selector-item" style="background: ${0};">
				${0}
				<div class="crm-messagesender-channel-selector-content">
					<div
						class="
							crm-messagesender-channel-selector-item-title 
							crm-messagesender-channel-selector-ellipsis
						"
						title="${0}"
					>${0}</div>
					<div 
						class="
							crm-messagesender-channel-selector-item-subtitle 
							crm-messagesender-channel-selector-ellipsis
						"
						title="${0}"
					>${0}</div>
				</div>
				<div class="crm-messagesender-channel-selector-banner-link">${0}</div>
			</div>
		`),s.Text.encode(e.background),i,s.Text.encode(e.title),s.Text.encode(e.title),s.Text.encode(e.subtitle),s.Text.encode(e.subtitle),t.render())}function ie(){const e=new l.Button({text:s.Loc.getMessage("CRM_MESSAGESENDER_CHANNEL_SELECTOR_ADD_CHANNEL"),useAirDesign:true,style:l.AirButtonStyle.PLAIN_NO_ACCENT,size:l.ButtonSize.SMALL,icon:a.Outline.PLUS_L,onclick:async()=>{await babelHelpers.classPrivateFieldLooseBase(this,j)[j]();this.emit("onConnectionsSliderClose")}});const i=new l.Button({text:s.Loc.getMessage("CRM_MESSAGESENDER_CHANNEL_SELECTOR_CONFIGURE"),useAirDesign:true,style:l.AirButtonStyle.PLAIN_NO_ACCENT,size:l.ButtonSize.SMALL,icon:a.Outline.SETTINGS,onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_]()}});return s.Tag.render(m||(m=r`
			<div class="crm-messagesender-channel-selector-footer">
				${0}
				${0}
			</div>
		`),e.render(),i.render())}async function te(){const{Router:e}=await s.Runtime.loadExtension("crm.router");return e.Instance.openMessageSenderConnectionsSlider(babelHelpers.classPrivateFieldLooseBase(this,B)[B])}function le(e,i=null){return s.Runtime.loadExtension("crm.router").then((({Router:s})=>s.openSlider(e,i))).catch((e=>{console.error("cant load crm.router",e);throw e}))}function ae(){const e=this.isShown();s.Runtime.loadExtension("ui.menu-configurable").then((({Menu:e})=>{const i=babelHelpers.classPrivateFieldLooseBase(this,y)[y].map((e=>{const i=s.Tag.render(P||(P=r`
						<span>
							<span
								class="crm-messagesender-channel-selector-ellipsis"
								title="${0}"
							>${0}</span>
						</span>
					`),s.Text.encode(e.appearance.title),s.Text.encode(e.appearance.title));if(s.Type.isStringFilled(e.appearance.subtitle)){s.Dom.append(s.Tag.render(L||(L=r`
								<span
									class="
										crm-messagesender-channel-selector-edit-item-subtitle 
										crm-messagesender-channel-selector-ellipsis
									"
									title="${0}"
								>${0}</span>
							`),s.Text.encode(e.appearance.subtitle),s.Text.encode(e.appearance.subtitle)),i)}return{id:e.id,isHidden:babelHelpers.classPrivateFieldLooseBase(this,N)[N](e),html:i}}));const t=new e({items:i,bindElement:babelHelpers.classPrivateFieldLooseBase(this,H)[H],maxVisibleItems:babelHelpers.classPrivateFieldLooseBase(this,K)[K](),maxWidth:600});this.close();return t.open()})).then((i=>{if(!i.isCanceled&&s.Type.isArray(i==null?void 0:i.items)){babelHelpers.classPrivateFieldLooseBase(this,D)[D](i.items)}if(e){this.show()}})).catch((e=>{console.error("cant load ui.menu-configurable",e)}))}function re(){const e=s.Extension.getSettings("crm.messagesender.channel-selector");return s.Text.toInteger(e.get("maxVisibleChannels"))}function ne(){const e=s.Extension.getSettings("crm.messagesender.channel-selector");return s.Text.toInteger(e.get("minVisibleChannels"))}function oe(e){var s;babelHelpers.classPrivateFieldLooseBase(this,X)[X](e);babelHelpers.classPrivateFieldLooseBase(this,V)[V](e);(s=babelHelpers.classPrivateFieldLooseBase(this,f)[f])==null?void 0:s.setContent(babelHelpers.classPrivateFieldLooseBase(this,E)[E]());this.emit("onSave",{itemsSort:babelHelpers.classPrivateFieldLooseBase(this,F)[F]})}function ce(e){const s=e.filter((e=>!e.isHidden)).length;if(s>=babelHelpers.classPrivateFieldLooseBase(this,R)[R]()){return}const i=babelHelpers.classPrivateFieldLooseBase(this,R)[R]()-s;let t=0;for(const s of e){if(s.isHidden){s.isHidden=false;t+=1}if(t>=i){return}}}function de(e){const s=e.filter((e=>!e.isHidden));if(s.length<=babelHelpers.classPrivateFieldLooseBase(this,K)[K]()){return}const i=s.slice(babelHelpers.classPrivateFieldLooseBase(this,K)[K](),s.length);for(const e of i){e.isHidden=true}}function be(e){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.map((e=>({channelId:e.id,isHidden:e.isHidden})));babelHelpers.classPrivateFieldLooseBase(this,x)[x](babelHelpers.classPrivateFieldLooseBase(this,y)[y],babelHelpers.classPrivateFieldLooseBase(this,F)[F]);babelHelpers.classPrivateFieldLooseBase(this,M)[M](babelHelpers.classPrivateFieldLooseBase(this,y)[y])}e.Selector=z})(this.BX.Crm.MessageSender.ChannelSelector=this.BX.Crm.MessageSender.ChannelSelector||{},BX,BX.Event,BX.Main,BX.UI,BX.UI.IconSet);
//# sourceMappingURL=channel-selector.bundle.map.js