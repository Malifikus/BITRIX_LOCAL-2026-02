this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,n,a,o,r,l,d,h,c,p,u,k,S,m,T,I){"use strict";const g=Object.freeze({id:c.TaskField.Responsible,getTitle:t=>{if(t){return m.Loc.getMessage("TASKS_V2_RESPONSIBLE_TITLE_MANY")}return m.Loc.getMessage("TASKS_V2_RESPONSIBLE_TITLE")}});const v={name:"ForNewUserSwitcher",components:{Switcher:k.Switcher,TextSm:p.TextSm,QuestionMark:S.QuestionMark},props:{modelValue:{type:Boolean,required:true}},emits:["update:modelValue"],computed:{switcherOptions(){return Object.freeze({size:u.SwitcherSize.extraSmall,useAirDesign:true})},hint(){return this.loc("TASKS_V2_RESPONSIBLE_FOR_NEW_USER_HINT")}},methods:{toggleChecked(t){this.$emit("update:modelValue",t)}},template:`\n\t\t<div class="tasks-field-responsible-for-new-user-switcher" @click="toggleChecked(!this.modelValue)">\n\t\t\t<Switcher :isChecked="modelValue" :options="switcherOptions"/>\n\t\t\t<TextSm className="tasks-field-responsible-for-new-user-switcher-label">\n\t\t\t\t{{ loc('TASKS_V2_RESPONSIBLE_FOR_NEW_USER') }}\n\t\t\t</TextSm>\n\t\t\t<QuestionMark v-if="hint" :hintText="hint" :hintMaxWidth="320" @click.stop/>\n\t\t</div>\n\t`};const A=T.h(I.UserAvatarListUsers,{users:[{name:m.Loc.getMessage("TASKS_V2_RESPONSIBLE_NEW_USER"),type:"employee"}],readonly:true});const B={name:"TaskResponsible",components:{Participants:n.Participants,BIcon:e.BIcon,ForNewUserSwitcher:v,NewUserLabel:A,Hint:a.Hint,TextXs:p.TextXs},inject:{analytics:{},cardType:{}},props:{taskId:{type:[Number,String],required:true},isSingle:{type:Boolean,default:false},avatarOnly:{type:Boolean,default:false}},setup(){return{Outline:e.Outline,responsibleMeta:g}},data(){return{isManyAhaShown:false}},computed:{forNewUser:{get(){return this.task.isForNewUser},set(t){void h.taskService.update(this.taskId,{isForNewUser:t})}},currentUserId(){return i.Core.getParams().currentUser.id},task(){return h.taskService.getStoreTask(this.taskId)},isEdit(){return d.idUtils.isReal(this.taskId)},isTemplate(){return d.idUtils.isTemplate(this.taskId)},isFlowFilledOnAdd(){return this.task.flowId>0&&!this.isEdit},single(){return this.isSingle||!this.isTemplate&&this.isEdit},dataset(){return{"data-task-id":this.taskId,"data-task-field-id":g.id,"data-task-field-value":this.task.responsibleIds[0]}},isAdmin(){return i.Core.getParams().rights.user.admin}},methods:{updateTask(t){if(t.length===0){t.push(this.task.responsibleIds[0])}const e=new Set(this.task.responsibleIds);void h.taskService.update(this.taskId,{responsibleIds:t});if(t.some((t=>!e.has(t)))){var s,i,n,a;l.analytics.sendAssigneeChange(this.analytics,{cardType:this.cardType,taskId:m.Type.isNumber(this.taskId)?this.taskId:0,viewersCount:(s=(i=this.task.auditorsIds)==null?void 0:i.length)!=null?s:0,coexecutorsCount:(n=(a=this.task.accomplicesIds)==null?void 0:a.length)!=null?n:0})}if(t.length>1){this.showManyAha()}},handleHintClick(){void h.taskService.update(this.taskId,{creatorId:this.currentUserId})},showManyAha(){if(o.ahaMoments.shouldShow(c.Option.AhaResponsibleMany)){o.ahaMoments.setActive(c.Option.AhaResponsibleMany);this.isManyAhaShown=true;o.ahaMoments.setPopupShown(c.Option.AhaResponsibleMany);void r.fieldHighlighter.highlight(g.id)}},stopManyAha(){o.ahaMoments.setShown(c.Option.AhaResponsibleMany);this.closeManyAha()},closeManyAha(){this.isManyAhaShown=false;o.ahaMoments.setInactive(c.Option.AhaResponsibleMany)}},template:`\n\t\t<div ref="container">\n\t\t\t<div v-if="isFlowFilledOnAdd" class="tasks-field-responsible-auto">\n\t\t\t\t<BIcon :name="Outline.BOTTLENECK"/>\n\t\t\t\t<div v-if="!avatarOnly">{{ loc('TASKS_V2_RESPONSIBLE_AUTO') }}</div>\n\t\t\t</div>\n\t\t\t<NewUserLabel v-else-if="forNewUser"/>\n\t\t\t<Participants\n\t\t\t\tv-else\n\t\t\t\t:taskId\n\t\t\t\t:context="responsibleMeta.id"\n\t\t\t\t:userIds="task.responsibleIds"\n\t\t\t\t:canAdd="task.rights.delegate || task.rights.changeResponsible"\n\t\t\t\t:canRemove="task.rights.delegate || task.rights.changeResponsible"\n\t\t\t\t:withHint="!isAdmin && !isEdit && task.creatorId !== currentUserId"\n\t\t\t\t:hintText="loc('TASKS_V2_RESPONSIBLE_CANT_CHANGE')"\n\t\t\t\t:single\n\t\t\t\t:multipleOnPlus="!single && task.responsibleIds.length === 1"\n\t\t\t\t:inline="avatarOnly || single"\n\t\t\t\t:avatarOnly\n\t\t\t\t:dataset\n\t\t\t\t:showMenu="false"\n\t\t\t\t@hintClick="handleHintClick"\n\t\t\t\t@update="updateTask"\n\t\t\t/>\n\t\t\t<ForNewUserSwitcher v-if="!isEdit && isTemplate && !avatarOnly" v-model="forNewUser"/>\n\t\t</div>\n\t\t<Hint v-if="isManyAhaShown" :bindElement="$refs.container" @close="isManyAhaShown = false">\n\t\t\t<div class="tasks-field-responsible-many-aha">\n\t\t\t\t<div>{{ loc('TASKS_V2_RESPONSIBLE_MANY_AHA') }}</div>\n\t\t\t\t<TextXs @click="stopManyAha">{{ loc('TASKS_V2_RESPONSIBLE_MANY_AHA_STOP') }}</TextXs>\n\t\t\t</div>\n\t\t</Hint>\n\t`};t.Responsible=B;t.responsibleMeta=g})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.UI.IconSet,BX,BX.Tasks.V2,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Const,BX.UI.System.Typography.Vue,BX.UI,BX.UI.Vue3.Components,BX.Tasks.V2.Component.Elements,BX,BX.Vue3,BX.Tasks.V2.Component.Elements);
//# sourceMappingURL=responsible.bundle.map.js