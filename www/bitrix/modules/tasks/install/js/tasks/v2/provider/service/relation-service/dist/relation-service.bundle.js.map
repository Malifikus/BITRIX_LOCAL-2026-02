{"version":3,"file":"relation-service.bundle.js","sources":["../src/relation-service.js","../src/sub-tasks-service.js","../src/related-tasks-service.js","../src/mappers.js","../src/gantt-service.js","../src/meta.js","../src/index.js"],"sourcesContent":["import type { AjaxResponse } from 'main.core';\nimport type { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'tasks.v2.core';\nimport { Limit, Model } from 'tasks.v2.const';\nimport { idUtils, type TaskId } from 'tasks.v2.lib.id-utils';\nimport { apiClient } from 'tasks.v2.lib.api-client';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskDto } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport type { RelationMeta } from './types';\n\nconst limit = Limit.RelationList;\n\nexport class RelationService\n{\n\t#meta: RelationMeta;\n\t#updatePromises: Promise[] = [];\n\n\tconstructor(meta: RelationMeta)\n\t{\n\t\tthis.#meta = meta;\n\t}\n\n\tasync list(taskId: TaskId, withIds: boolean = false): Promise<TaskDto[]>\n\t{\n\t\tconst hasUpdatePromises = this.#updatePromises.length > 0;\n\n\t\tawait Promise.all(this.#updatePromises);\n\n\t\tconst { tasks, ids } = await this.requestTasks(taskId, withIds);\n\n\t\tif (withIds)\n\t\t{\n\t\t\tif (!hasUpdatePromises && ids.length === 0)\n\t\t\t{\n\t\t\t\tvoid this.$store.dispatch(`${Model.Tasks}/setFieldFilled`, {\n\t\t\t\t\tid: taskId,\n\t\t\t\t\tfieldName: this.#meta.id,\n\t\t\t\t\tisFilled: false,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.#updateStoreRelationTasks(taskId, ids);\n\t\t}\n\n\t\ttasks.forEach((taskDto: TaskDto): void => {\n\t\t\tif (!taskService.hasStoreTask(taskDto.id, false))\n\t\t\t{\n\t\t\t\tvoid this.$store.dispatch(`${Model.Tasks}/addPartiallyLoaded`, taskDto.id);\n\t\t\t}\n\n\t\t\ttaskService.extractTask({ ...taskDto, [this.#meta.relationToField]: taskId });\n\t\t});\n\n\t\treturn tasks;\n\t}\n\n\tasync setParent(taskId: number, parentId: number): Promise<?string>\n\t{\n\t\treturn this.add(parentId, [taskId]);\n\t}\n\n\tasync add(taskId: number, taskIds: number[], noOverride: boolean = false): Promise<?string>\n\t{\n\t\tconst parentIds = Object.fromEntries(taskIds.map((id: number) => {\n\t\t\treturn [id, taskService.getStoreTask(id)?.[this.#meta.relationToField] ?? 0];\n\t\t}));\n\n\t\tthis.addStore(taskId, taskIds);\n\n\t\tif (!idUtils.isReal(taskId) || taskIds.length === 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst error = await this.requestAdd(taskId, taskIds, noOverride);\n\n\t\tif (error)\n\t\t{\n\t\t\tconst failedIds = Object.entries(error.data)\n\t\t\t\t.filter(([, success]) => !success)\n\t\t\t\t.map(([id]) => Number(id))\n\t\t\t;\n\n\t\t\tthis.deleteStore(taskId, failedIds);\n\t\t\tfailedIds.forEach((id: number) => this.addStore(parentIds[id], [id]));\n\n\t\t\tconsole.error(`${this.#meta.controller}.add error`, error);\n\n\t\t\tconst accessErrors = error.errors.filter(({ code }) => code === 'Access denied');\n\t\t\tif (accessErrors.length === 1)\n\t\t\t{\n\t\t\t\treturn this.#meta.addError;\n\t\t\t}\n\n\t\t\tif (accessErrors.length > 1)\n\t\t\t{\n\t\t\t\treturn this.#meta.addErrorMany;\n\t\t\t}\n\n\t\t\tconst overrideErrors = error.errors.filter(({ code }) => code === 'No override parentId');\n\t\t\tif (overrideErrors.length === 1)\n\t\t\t{\n\t\t\t\treturn this.#meta.overrideError;\n\t\t\t}\n\n\t\t\tif (overrideErrors.length > 1)\n\t\t\t{\n\t\t\t\treturn this.#meta.overrideErrorMany;\n\t\t\t}\n\n\t\t\treturn error.errors?.[0]?.message;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\taddStore(taskId: number, taskIds: number[]): void\n\t{\n\t\tconst meta = this.#meta;\n\t\tconst task = taskService.getStoreTask(taskId);\n\t\tthis.#updateStoreRelationTasks(taskId, [...(task?.[meta.idsField] || []), ...taskIds]);\n\t\ttaskIds.forEach((it) => taskService.updateStoreTask(it, { [meta.relationToField]: taskId }));\n\t}\n\n\tasync delete(taskId: number, taskIds: number[]): Promise<void>\n\t{\n\t\tthis.deleteStore(taskId, taskIds);\n\n\t\tif (!idUtils.isReal(taskId) || taskIds.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst error = await this.requestDelete(taskId, taskIds);\n\n\t\tif (error)\n\t\t{\n\t\t\tthis.addStore(taskId, taskIds);\n\n\t\t\tconsole.error(`${this.#meta.controller}.delete error`, error);\n\t\t}\n\t}\n\n\tunlinkStore(taskId: number): void\n\t{\n\t\tconst relationIds = this.$store.getters[`${Model.Tasks}/getAll`]\n\t\t\t.filter((task: TaskModel) => task[this.#meta.relationToField] === taskId)\n\t\t\t.map(({ id }) => id)\n\t\t;\n\n\t\tconst relationToIds = this.$store.getters[`${Model.Tasks}/getAll`]\n\t\t\t.filter((task: TaskModel) => task[this.#meta.idsField]?.includes(taskId))\n\t\t\t.map(({ id }) => id)\n\t\t;\n\n\t\tthis.deleteStore(taskId, relationIds);\n\t\trelationToIds.forEach((id: number) => this.deleteStore(id, [taskId]));\n\t}\n\n\tdeleteStore(taskId: number, taskIds: number[]): void\n\t{\n\t\tconst meta = this.#meta;\n\t\tconst task = taskService.getStoreTask(taskId);\n\t\tthis.#updateStoreRelationTasks(taskId, task?.[meta.idsField].filter((it) => !taskIds.includes(it)));\n\t\ttaskIds.forEach((it) => taskService.updateStoreTask(it, { [meta.relationToField]: 0 }));\n\t}\n\n\tareIdsLoaded(taskId: number): boolean\n\t{\n\t\tconst meta = this.#meta;\n\t\tconst task = taskService.getStoreTask(taskId);\n\t\tif (!task)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn !task[meta.containsField] || task[meta.idsField].length > 0;\n\t}\n\n\thasUnloadedIds(taskId: number): boolean\n\t{\n\t\tconst ids = taskService.getStoreTask(taskId)[this.#meta.idsField];\n\n\t\treturn this.getVisibleIds(ids).some((id) => !this.hasStoreTask(id));\n\t}\n\n\thasStoreTask(id: number | string): boolean\n\t{\n\t\tconst rights = taskService.getStoreTask(id)?.rights ?? {};\n\n\t\treturn this.#meta.uniqueRight in rights;\n\t}\n\n\t/** @protected */\n\tasync requestTasks(taskId: number, withIds: boolean = false): Promise<{ tasks: TaskDto[], ids?: number[] }>\n\t{\n\t\tif (!idUtils.isReal(taskId))\n\t\t{\n\t\t\tconst ids = taskService.getStoreTask(taskId)[this.#meta.idsField];\n\n\t\t\tconst { tasks } = await apiClient.post(`${this.#meta.controller}.listByIds`, {\n\t\t\t\ttaskIds: this.getVisibleIds(ids),\n\t\t\t});\n\n\t\t\treturn { tasks, ids };\n\t\t}\n\n\t\tconst { tasks, ids } = await apiClient.post(`${this.#meta.controller}.list`, {\n\t\t\ttaskId,\n\t\t\twithIds,\n\t\t\tnavigation: {\n\t\t\t\tsize: limit,\n\t\t\t},\n\t\t});\n\n\t\treturn { tasks, ids };\n\t}\n\n\t/** @protected */\n\trequestAdd(taskId: number, taskIds: number[], noOverride: boolean = false): Promise<?AjaxResponse>\n\t{\n\t\treturn this.requestUpdate(`${this.#meta.controller}.add`, { taskId, taskIds, noOverride });\n\t}\n\n\t/** @protected */\n\trequestDelete(taskId: number, taskIds: number[]): Promise<?AjaxResponse>\n\t{\n\t\treturn this.requestUpdate(`${this.#meta.controller}.delete`, { taskId, taskIds });\n\t}\n\n\t/** @protected */\n\tasync requestUpdate(endpoint: string, data: Object): Promise<?AjaxResponse>\n\t{\n\t\tconst promise = this.#safePromise(apiClient.post(endpoint, data));\n\t\tthis.#updatePromises.push(promise);\n\t\tconst error = await promise;\n\t\tthis.#updatePromises = this.#updatePromises.filter((it) => it !== promise);\n\n\t\treturn error;\n\t}\n\n\tasync #safePromise(promise: Promise): Promise<?AjaxResponse>\n\t{\n\t\ttry\n\t\t{\n\t\t\tawait promise;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\treturn error;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/** @protected */\n\tgetVisibleIds(ids: number[]): number[]\n\t{\n\t\treturn this.getSortedIds(ids).slice(0, limit);\n\t}\n\n\tgetSortedIds(ids: number[]): number[]\n\t{\n\t\treturn ids.sort((id1: number, id2: number) => this.#getTitle(id1).localeCompare(this.#getTitle(id2)));\n\t}\n\n\t#getTitle(id: number): string\n\t{\n\t\treturn taskService.getStoreTask(id)?.title ?? this.$store.getters[`${Model.Tasks}/getTitle`](id) ?? '\\uFFFF';\n\t}\n\n\t#updateStoreRelationTasks(taskId: number, taskIds: number[]): void\n\t{\n\t\tconst meta = this.#meta;\n\t\tconst relationIds = [...new Set(taskIds)];\n\t\tconst contains = relationIds.length > 0;\n\t\tif (taskService.hasStoreTask(taskId, false))\n\t\t{\n\t\t\tvoid taskService.updateStoreTask(taskId, { [meta.idsField]: relationIds, [meta.containsField]: contains });\n\t\t}\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n","import { Loc, type AjaxResponse } from 'main.core';\n\nimport { Limit, Model, TaskField, Endpoint } from 'tasks.v2.const';\nimport { apiClient } from 'tasks.v2.lib.api-client';\nimport { idUtils, type TaskId } from 'tasks.v2.lib.id-utils';\nimport { taskService, type TaskDto } from 'tasks.v2.provider.service.task-service';\nimport { templateService, TemplateMappers } from 'tasks.v2.provider.service.template-service';\n\nimport { RelationService } from './relation-service';\n\nconst limit = Limit.RelationList;\n\nexport class SubTasksService extends RelationService\n{\n\tasync getParent(taskId: TaskId, parentId: number): Promise<void>\n\t{\n\t\tif (taskService.hasStoreTask(parentId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst parent = await this.#requestParent(parentId);\n\t\tif (!parent)\n\t\t{\n\t\t\tvoid taskService.updateStoreTask(taskId, { parentId: 0 });\n\t\t\tvoid this.$store.dispatch(`${Model.Tasks}/setFieldFilled`, {\n\t\t\t\tid: taskId,\n\t\t\t\tfieldName: TaskField.Parent,\n\t\t\t\tisFilled: false,\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\ttaskService.extractTask(parent);\n\t\tvoid this.$store.dispatch(`${Model.Tasks}/addPartiallyLoaded`, parentId);\n\t}\n\n\tasync setParent(taskId: TaskId, parentId: number): Promise<?string>\n\t{\n\t\tconst currentParentId = taskService.getStoreTask(taskId).parentId;\n\t\tif (currentParentId === parentId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (parentId === 0 && idUtils.isReal(taskId))\n\t\t{\n\t\t\tif (idUtils.isTemplate(taskId))\n\t\t\t{\n\t\t\t\tawait templateService.update(taskId, { parentId });\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this.delete(currentParentId, [taskId]);\n\t\t}\n\n\t\tif (parentId === taskId)\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_V2_RELATION_PARENT_CANNOT_BE_PARENT');\n\t\t}\n\n\t\tif (taskService.getStoreTask(taskId)?.subTaskIds.includes(parentId))\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_V2_RELATION_SUB_TASK_CANNOT_BE_PARENT');\n\t\t}\n\n\t\tif (!idUtils.isReal(taskId))\n\t\t{\n\t\t\treturn this.addStore(parentId, [taskId]);\n\t\t}\n\n\t\tif (idUtils.isTemplate(taskId) && !idUtils.isTemplate(parentId))\n\t\t{\n\t\t\tawait templateService.update(taskId, { parentId });\n\n\t\t\treturn null;\n\t\t}\n\n\t\tconst error = await this.add(parentId, [taskId], false);\n\n\t\tif (error)\n\t\t{\n\t\t\tthis.addStore(currentParentId, [taskId]);\n\t\t}\n\n\t\treturn error;\n\t}\n\n\tasync add(taskId: number, taskIds: number[], noOverride: boolean = true): Promise<?string>\n\t{\n\t\tlet error = null;\n\n\t\tif (taskIds.includes(taskId))\n\t\t{\n\t\t\terror ??= Loc.getMessage('TASKS_V2_RELATION_SELF_CANNOT_BE_SUB_TASK');\n\t\t}\n\n\t\tconst parentId = taskService.getStoreTask(taskId)?.parentId;\n\t\tif (taskIds.includes(parentId))\n\t\t{\n\t\t\terror ??= Loc.getMessage('TASKS_V2_RELATION_PARENT_CANNOT_BE_SUB_TASK');\n\t\t}\n\n\t\tconst ids = taskIds.filter((id: number) => id !== taskId && id !== parentId);\n\n\t\tconst parentError = await super.add(taskId, ids, noOverride);\n\n\t\terror ??= parentError;\n\n\t\tif (taskService.getStoreTask(taskId)?.matchesSubTasksTime)\n\t\t{\n\t\t\tvoid taskService.get(taskId, {}, true);\n\t\t}\n\n\t\treturn error;\n\t}\n\n\tasync delete(taskId: number, taskIds: number[]): Promise<void>\n\t{\n\t\tawait super.delete(taskId, taskIds);\n\n\t\tif (taskService.getStoreTask(taskId)?.matchesSubTasksTime)\n\t\t{\n\t\t\tvoid taskService.get(taskId, {}, true);\n\t\t}\n\t}\n\n\taddStore(id: TaskId, ids: number[]): void\n\t{\n\t\tids.forEach((it) => this.deleteStore(taskService.getStoreTask(it)?.parentId, [it]));\n\n\t\tsuper.addStore(id, ids);\n\t}\n\n\t/** @protected */\n\tasync requestTasks(taskId: TaskId, withIds: boolean = false): Promise<{ tasks: TaskDto[], ids?: number[] }>\n\t{\n\t\tconst task = taskService.getStoreTask(taskId);\n\t\tif (withIds && !task.subTaskIds?.length && task.templateId)\n\t\t{\n\t\t\tconst { templates, ids } = await apiClient.post('Template.Relation.Child.list', {\n\t\t\t\ttemplateId: task.templateId,\n\t\t\t\twithIds,\n\t\t\t\tnavigation: {\n\t\t\t\t\tsize: limit,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst idsMap = ids.reduce((map, id) => map.set(id, `tmp.${id}`), new Map());\n\t\t\tconst tasks = templates.map((template) => ({\n\t\t\t\t...TemplateMappers.mapDtoToTaskDto(template),\n\t\t\t\tid: idsMap.get(template.id),\n\t\t\t\trights: {\n\t\t\t\t\tread: true,\n\t\t\t\t\tdelegate: false,\n\t\t\t\t\tchangeResponsible: false,\n\t\t\t\t\tdetachParent: false,\n\t\t\t\t},\n\t\t\t}));\n\n\t\t\treturn { tasks, ids: [...idsMap.values()] };\n\t\t}\n\n\t\tif (!idUtils.isTemplate(taskId))\n\t\t{\n\t\t\treturn super.requestTasks(taskId, withIds);\n\t\t}\n\n\t\tif (!idUtils.isReal(taskId))\n\t\t{\n\t\t\tconst ids = taskService.getStoreTask(taskId).subTaskIds;\n\n\t\t\tconst { templates } = await apiClient.post('Template.Relation.Child.listByIds', {\n\t\t\t\ttemplateIds: this.getVisibleIds(ids).map((id) => idUtils.unbox(id)),\n\t\t\t});\n\n\t\t\tconst tasks = templates.map((it) => ({ ...it, id: idUtils.boxTemplate(it.id) }));\n\n\t\t\treturn { tasks, ids };\n\t\t}\n\n\t\tconst { templates, ids } = await apiClient.post('Template.Relation.Child.list', {\n\t\t\ttemplateId: idUtils.unbox(taskId),\n\t\t\twithIds,\n\t\t\tnavigation: {\n\t\t\t\tsize: limit,\n\t\t\t},\n\t\t});\n\n\t\tconst tasks = templates.map((it) => ({ ...it, id: idUtils.boxTemplate(it.id) }));\n\n\t\treturn { tasks, ids: ids?.map((id) => idUtils.boxTemplate(id)) };\n\t}\n\n\t/** @protected */\n\trequestAdd(taskId: number, taskIds: number[], noOverride: boolean = false): Promise<?AjaxResponse>\n\t{\n\t\tif (!idUtils.isTemplate(taskId))\n\t\t{\n\t\t\treturn super.requestAdd(taskId, taskIds, noOverride);\n\t\t}\n\n\t\treturn this.requestUpdate('Template.Relation.Child.add', {\n\t\t\ttemplateId: idUtils.unbox(taskId),\n\t\t\ttemplateIds: taskIds.map((id) => idUtils.unbox(id)),\n\t\t\tnoOverride,\n\t\t});\n\t}\n\n\t/** @protected */\n\trequestDelete(taskId: number, taskIds: number[]): Promise<?AjaxResponse>\n\t{\n\t\tif (!idUtils.isTemplate(taskId))\n\t\t{\n\t\t\treturn super.requestDelete(taskId, taskIds);\n\t\t}\n\n\t\treturn this.requestUpdate('Template.Relation.Child.delete', {\n\t\t\ttemplateId: idUtils.unbox(taskId),\n\t\t\ttemplateIds: taskIds.map((id) => idUtils.unbox(id)),\n\t\t});\n\t}\n\n\tasync #requestParent(taskId: number): Promise<?TaskDto>\n\t{\n\t\tif (idUtils.isTemplate(taskId))\n\t\t{\n\t\t\tconst { templates } = await apiClient.post('Template.Relation.Child.listByIds', {\n\t\t\t\ttemplateIds: [idUtils.unbox(taskId)],\n\t\t\t});\n\n\t\t\tconst parent = templates[0];\n\t\t\tif (parent)\n\t\t\t{\n\t\t\t\tparent.id = idUtils.boxTemplate(parent.id);\n\t\t\t}\n\n\t\t\treturn parent;\n\t\t}\n\n\t\tconst { tasks } = await apiClient.post(Endpoint.TaskRelationChildListByIds, {\n\t\t\ttaskIds: [taskId],\n\t\t});\n\n\t\treturn tasks[0];\n\t}\n}\n","import { Loc, type AjaxResponse } from 'main.core';\n\nimport { Limit } from 'tasks.v2.const';\nimport { apiClient } from 'tasks.v2.lib.api-client';\nimport { idUtils, type TaskId } from 'tasks.v2.lib.id-utils';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskDto } from 'tasks.v2.provider.service.task-service';\n\nimport { RelationService } from './relation-service';\n\nconst limit = Limit.RelationList;\n\nexport class RelatedTasksService extends RelationService\n{\n\tasync add(taskId: TaskId, taskIds: number[], noOverride: boolean = false): Promise<?string>\n\t{\n\t\tlet error = null;\n\n\t\tif (taskIds.includes(taskId))\n\t\t{\n\t\t\terror ??= Loc.getMessage('TASKS_V2_RELATION_SELF_CANNOT_BE_RELATED_TASK');\n\t\t}\n\n\t\tconst ids = taskIds.filter((id: number) => id !== taskId);\n\n\t\tconst parentError = await super.add(taskId, ids, noOverride);\n\n\t\terror ??= parentError;\n\n\t\treturn error;\n\t}\n\n\t/** @protected */\n\tasync requestTasks(taskId: TaskId, withIds: boolean = false): Promise<{ tasks: TaskDto[], ids?: number[] }>\n\t{\n\t\tconst task = taskService.getStoreTask(taskId);\n\t\tif (withIds && !task.relatedTaskIds?.length && task.templateId)\n\t\t{\n\t\t\tconst { tasks, ids } = await apiClient.post('Template.Relation.Related.list', {\n\t\t\t\ttemplateId: task.templateId,\n\t\t\t\twithIds,\n\t\t\t\tnavigation: {\n\t\t\t\t\tsize: limit,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn { tasks, ids };\n\t\t}\n\n\t\tif (!idUtils.isTemplate(taskId) || !idUtils.isReal(taskId))\n\t\t{\n\t\t\treturn super.requestTasks(taskId, withIds);\n\t\t}\n\n\t\tconst { tasks, ids } = await apiClient.post('Template.Relation.Related.list', {\n\t\t\ttemplateId: idUtils.unbox(taskId),\n\t\t\twithIds,\n\t\t\tnavigation: {\n\t\t\t\tsize: limit,\n\t\t\t},\n\t\t});\n\n\t\treturn { tasks, ids };\n\t}\n\n\t/** @protected */\n\trequestAdd(taskId: number, taskIds: number[], noOverride: boolean = false): Promise<?AjaxResponse>\n\t{\n\t\tif (!idUtils.isTemplate(taskId))\n\t\t{\n\t\t\treturn super.requestAdd(taskId, taskIds, noOverride);\n\t\t}\n\n\t\treturn this.requestUpdate('Template.Relation.Related.add', {\n\t\t\ttemplateId: idUtils.unbox(taskId),\n\t\t\ttaskIds,\n\t\t\tnoOverride,\n\t\t});\n\t}\n\n\t/** @protected */\n\trequestDelete(taskId: number, taskIds: number[]): Promise<?AjaxResponse>\n\t{\n\t\tif (!idUtils.isTemplate(taskId))\n\t\t{\n\t\t\treturn super.requestDelete(taskId, taskIds);\n\t\t}\n\n\t\treturn this.requestUpdate('Template.Relation.Related.delete', {\n\t\t\ttemplateId: idUtils.unbox(taskId),\n\t\t\ttaskIds,\n\t\t});\n\t}\n}\n","import type { GanttLinkModel } from 'tasks.v2.model.gantt-links';\nimport type { GanttLinksDto } from './types';\n\nexport function mapGanttLinksToModels(dependentId: number, ganttLinks: GanttLinksDto): GanttLinkModel[]\n{\n\tif (!ganttLinks)\n\t{\n\t\treturn [];\n\t}\n\n\treturn Object.entries(ganttLinks).map(([taskId, type]): GanttLinkModel => ({\n\t\ttaskId,\n\t\tdependentId,\n\t\ttype,\n\t}));\n}\n","import { Model } from 'tasks.v2.const';\nimport { idUtils, type TaskId } from 'tasks.v2.lib.id-utils';\nimport type { TaskDto } from 'tasks.v2.provider.service.task-service';\nimport type { GanttLinkModel } from 'tasks.v2.model.gantt-links';\n\nimport { mapGanttLinksToModels } from './mappers';\nimport { RelationService } from './relation-service';\n\nexport class GanttService extends RelationService\n{\n\tasync list(taskId: TaskId, withIds: boolean = false): Promise<TaskDto[]>\n\t{\n\t\tconst tasks = await super.list(taskId, withIds);\n\n\t\ttasks.forEach((taskDto: TaskDto) => {\n\t\t\tconst ganttLinks = mapGanttLinksToModels(taskDto.id, taskDto.ganttLinks);\n\t\t\tvoid this.$store.dispatch(`${Model.GanttLinks}/upsertMany`, ganttLinks);\n\t\t});\n\t}\n\n\tasync checkDependence(ganttLink: GanttLinkModel): Promise<?string>\n\t{\n\t\tif (!idUtils.isReal(ganttLink.taskId))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst error = await this.requestUpdate('Task.Relation.Gantt.Dependence.check', { ganttLink });\n\n\t\tif (error)\n\t\t{\n\t\t\treturn error.errors?.[0]?.message;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tasync addDependence(ganttLink: GanttLinkModel): Promise<?string>\n\t{\n\t\tconst { taskId, dependentId } = ganttLink;\n\n\t\tthis.addStore(taskId, [dependentId]);\n\n\t\tvoid this.$store.dispatch(`${Model.GanttLinks}/upsert`, ganttLink);\n\n\t\tif (!idUtils.isReal(taskId))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst error = await this.requestUpdate('Task.Relation.Gantt.Dependence.add', { ganttLink });\n\n\t\tif (error)\n\t\t{\n\t\t\tthis.deleteStore(taskId, [dependentId]);\n\n\t\t\tconsole.error('Task.Relation.Gantt.Dependence.add error', error);\n\n\t\t\treturn error.errors?.[0]?.message;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tasync updateDependence(ganttLink: GanttLinkModel): Promise<void>\n\t{\n\t\tvoid this.$store.dispatch(`${Model.GanttLinks}/upsert`, ganttLink);\n\n\t\tif (!idUtils.isReal(ganttLink.taskId))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst error = await this.requestUpdate('Task.Relation.Gantt.Dependence.update', { ganttLink });\n\n\t\tif (error)\n\t\t{\n\t\t\tconsole.error('Task.Relation.Gantt.Dependence.update error', error);\n\n\t\t\treturn error.errors?.[0]?.message;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tasync delete(taskId: TaskId, taskIds: number[]): Promise<void>\n\t{\n\t\tconst ganttLink = { taskId, dependentId: taskIds[0] };\n\n\t\tthis.deleteStore(taskId, taskIds);\n\n\t\tif (!idUtils.isReal(taskId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst error = await this.requestUpdate('Task.Relation.Gantt.Dependence.delete', { ganttLink });\n\n\t\tif (error)\n\t\t{\n\t\t\tthis.addStore(taskId, taskIds);\n\n\t\t\tconsole.error('Task.Relation.Gantt.Dependence.delete error', error);\n\t\t}\n\t}\n}\n","import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\nimport { RelationMeta } from './types';\n\nexport const subTasksMeta: RelationMeta = Object.freeze({\n\tid: TaskField.SubTasks,\n\tidsField: 'subTaskIds',\n\tcontainsField: 'containsSubTasks',\n\trelationToField: 'parentId',\n\tcontroller: 'Task.Relation.Child',\n\tuniqueRight: 'detachParent',\n\taddError: Loc.getMessage('TASKS_V2_RELATION_SUBTASKS_NO_ACCESS'),\n\taddErrorMany: Loc.getMessage('TASKS_V2_RELATION_SUBTASKS_NO_ACCESS_MANY'),\n\toverrideError: Loc.getMessage('TASKS_V2_RELATION_CANNOT_OVERRIDE_PARENT'),\n\toverrideErrorMany: Loc.getMessage('TASKS_V2_RELATION_CANNOT_OVERRIDE_PARENT_MANY'),\n});\n\nexport const relatedTasksMeta: RelationMeta = Object.freeze({\n\tid: TaskField.RelatedTasks,\n\tidsField: 'relatedTaskIds',\n\tcontainsField: 'containsRelatedTasks',\n\trelationToField: 'relatedToTaskId',\n\tcontroller: 'Task.Relation.Related',\n\tuniqueRight: 'detachRelated',\n\taddError: Loc.getMessage('TASKS_V2_RELATION_RELATED_TASKS_NO_ACCESS'),\n\taddErrorMany: Loc.getMessage('TASKS_V2_RELATION_RELATED_TASKS_NO_ACCESS_MANY'),\n});\n\nexport const ganttMeta: RelationMeta = Object.freeze({\n\tid: TaskField.Gantt,\n\tidsField: 'ganttTaskIds',\n\tcontainsField: 'containsGanttLinks',\n\trelationToField: 'ganttParentId',\n\tcontroller: 'Task.Relation.Gantt.Dependence',\n\tuniqueRight: 'changeDependence',\n});\n","import { SubTasksService } from './sub-tasks-service';\nimport { RelatedTasksService } from './related-tasks-service';\nimport { GanttService } from './gantt-service';\nimport { relatedTasksMeta, subTasksMeta, ganttMeta } from './meta';\n\nexport const subTasksService = new SubTasksService(subTasksMeta);\nexport const relatedTasksService = new RelatedTasksService(relatedTasksMeta);\nexport const ganttService = new GanttService(ganttMeta);\nexport type { RelationService } from './relation-service';\nexport type { GanttLinksDto, GanttLinkType } from './types';\n"],"names":["limit","Limit","RelationList","RelationService","constructor","meta","list","taskId","withIds","hasUpdatePromises","length","Promise","all","tasks","ids","requestTasks","$store","dispatch","Model","Tasks","id","fieldName","isFilled","forEach","taskDto","taskService","hasStoreTask","extractTask","relationToField","setParent","parentId","add","taskIds","noOverride","parentIds","Object","fromEntries","map","getStoreTask","addStore","idUtils","isReal","error","requestAdd","failedIds","entries","data","filter","success","Number","deleteStore","console","controller","accessErrors","errors","code","addError","addErrorMany","overrideErrors","overrideError","overrideErrorMany","message","task","idsField","it","updateStoreTask","delete","requestDelete","unlinkStore","relationIds","getters","relationToIds","includes","areIdsLoaded","containsField","hasUnloadedIds","getVisibleIds","some","rights","uniqueRight","apiClient","post","navigation","size","requestUpdate","endpoint","promise","push","getSortedIds","slice","sort","id1","id2","localeCompare","Core","getStore","title","Set","contains","SubTasksService","getParent","parent","TaskField","Parent","currentParentId","isTemplate","templateService","update","Loc","getMessage","subTaskIds","parentError","matchesSubTasksTime","get","templateId","templates","idsMap","reduce","set","Map","template","TemplateMappers","mapDtoToTaskDto","read","delegate","changeResponsible","detachParent","values","templateIds","unbox","boxTemplate","Endpoint","TaskRelationChildListByIds","RelatedTasksService","relatedTaskIds","mapGanttLinksToModels","dependentId","ganttLinks","type","GanttService","GanttLinks","checkDependence","ganttLink","addDependence","updateDependence","subTasksMeta","freeze","SubTasks","relatedTasksMeta","RelatedTasks","ganttMeta","Gantt","subTasksService","relatedTasksService","ganttService"],"mappings":"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"}