{"version":3,"file":"placement-service.bundle.js","sources":["../src/mappers.js","../src/placement-service.js"],"sourcesContent":["import type { PlacementModel } from 'tasks.v2.model.placements';\nimport type { PlacementDto } from './types';\n\nexport function mapDtoToModel(placementDto: PlacementDto): PlacementModel\n{\n\treturn {\n\t\tid: placementDto.id,\n\t\tappId: placementDto.appId,\n\t\ttitle: placementDto.title,\n\t\tdescription: placementDto.description,\n\t\ttype: placementDto.type,\n\t};\n}\n","import { Store } from 'ui.vue3.vuex';\n\nimport { Model } from 'tasks.v2.const';\nimport { Core } from 'tasks.v2.core';\nimport { apiClient } from 'tasks.v2.lib.api-client';\nimport { placementsMeta } from 'tasks.v2.component.fields.placements';\nimport type { PlacementModel } from 'tasks.v2.model.placements';\n\nimport { mapDtoToModel } from './mappers';\nimport type { PlacementDto } from './types';\n\nclass PlacementService\n{\n\tasync get(taskId: number): Promise<void>\n\t{\n\t\tconst { placements } = await apiClient.post('Task.Placement.list', { taskId });\n\t\tconst placementModels = placements.map((dto: PlacementDto): PlacementModel => mapDtoToModel(dto));\n\t\tconst placementIds = placementModels.map(({ id }: PlacementModel) => id);\n\n\t\tawait Promise.all([\n\t\t\tthis.$store.dispatch(`${Model.Placements}/upsertMany`, placementModels),\n\t\t\tthis.$store.dispatch(`${Model.Tasks}/update`, {\n\t\t\t\tid: taskId,\n\t\t\t\tfields: {\n\t\t\t\t\tplacementIds,\n\t\t\t\t\tcontainsPlacements: placementIds.length > 0,\n\t\t\t\t},\n\t\t\t}),\n\t\t\tthis.$store.dispatch(`${Model.Tasks}/setFieldFilled`, {\n\t\t\t\tid: taskId,\n\t\t\t\tfieldName: placementsMeta.id,\n\t\t\t\tisFilled: placementIds.length > 0,\n\t\t\t}),\n\t\t]);\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n\nexport const placementService = new PlacementService();\n"],"names":["mapDtoToModel","placementDto","id","appId","title","description","type","PlacementService","get","taskId","placements","apiClient","post","placementModels","map","dto","placementIds","Promise","all","$store","dispatch","Model","Placements","Tasks","fields","containsPlacements","length","fieldName","placementsMeta","isFilled","Core","getStore","placementService"],"mappings":";;;;;;;;CAGO,SAASA,aAAa,CAACC,YAA0B,EACxD;GACC,OAAO;KACNC,EAAE,EAAED,YAAY,CAACC,EAAE;KACnBC,KAAK,EAAEF,YAAY,CAACE,KAAK;KACzBC,KAAK,EAAEH,YAAY,CAACG,KAAK;KACzBC,WAAW,EAAEJ,YAAY,CAACI,WAAW;KACrCC,IAAI,EAAEL,YAAY,CAACK;IACnB;CACF;;CCDA,MAAMC,gBAAgB,CACtB;GACC,MAAMC,GAAG,CAACC,MAAc,EACxB;KACC,MAAM;OAAEC;MAAY,GAAG,MAAMC,gCAAS,CAACC,IAAI,CAAC,qBAAqB,EAAE;OAAEH;MAAQ,CAAC;KAC9E,MAAMI,eAAe,GAAGH,UAAU,CAACI,GAAG,CAAEC,GAAiB,IAAqBf,aAAa,CAACe,GAAG,CAAC,CAAC;KACjG,MAAMC,YAAY,GAAGH,eAAe,CAACC,GAAG,CAAC,CAAC;OAAEZ;MAAoB,KAAKA,EAAE,CAAC;KAExE,MAAMe,OAAO,CAACC,GAAG,CAAC,CACjB,IAAI,CAACC,MAAM,CAACC,QAAQ,CAAE,GAAEC,oBAAK,CAACC,UAAW,aAAY,EAAET,eAAe,CAAC,EACvE,IAAI,CAACM,MAAM,CAACC,QAAQ,CAAE,GAAEC,oBAAK,CAACE,KAAM,SAAQ,EAAE;OAC7CrB,EAAE,EAAEO,MAAM;OACVe,MAAM,EAAE;SACPR,YAAY;SACZS,kBAAkB,EAAET,YAAY,CAACU,MAAM,GAAG;;MAE3C,CAAC,EACF,IAAI,CAACP,MAAM,CAACC,QAAQ,CAAE,GAAEC,oBAAK,CAACE,KAAM,iBAAgB,EAAE;OACrDrB,EAAE,EAAEO,MAAM;OACVkB,SAAS,EAAEC,mDAAc,CAAC1B,EAAE;OAC5B2B,QAAQ,EAAEb,YAAY,CAACU,MAAM,GAAG;MAChC,CAAC,CACF,CAAC;;GAGH,IAAIP,MAAM,GACV;KACC,OAAOW,kBAAI,CAACC,QAAQ,EAAE;;CAExB;AAEA,OAAaC,gBAAgB,GAAG,IAAIzB,gBAAgB,EAAE;;;;;;;;"}