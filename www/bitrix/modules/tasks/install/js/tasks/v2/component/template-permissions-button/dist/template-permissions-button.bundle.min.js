this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};(function(t,e,s,i,n,o,r,p,a,l,m,u,d,c,S){"use strict";const h={name:"TemplatePermissionUserRow",components:{BMenu:r.BMenu,UserLabel:p.UserLabel,BIcon:a.BIcon},inject:{task:{},isEdit:{},settings:{}},props:{permission:{type:Object,required:true},freeze:{type:Function,required:true},unfreeze:{type:Function,required:true}},emits:["update","remove"],setup(){return{Outline:a.Outline}},data(){return{isMenuShown:false}},computed:{isGranted(){const t=new Set([this.settings.currentUser.id]);if(!this.isEdit){t.add(this.task.creatorId)}return this.permission.entityType===d.EntitySelectorEntity.User&&t.has(this.permission.entityId)},permissionLabel(){if(this.permission.permission===d.PermissionType.Full){return this.loc("TASKS_V2_TEMPLATE_PERMISSIONS_POPUP_FULL_ACCESS")}return this.loc("TASKS_V2_TEMPLATE_PERMISSIONS_POPUP_READ_ONLY_ACCESS")},options(){return[{permission:d.PermissionType.Full,title:this.loc("TASKS_V2_TEMPLATE_PERMISSIONS_POPUP_FULL_ACCESS"),description:this.loc("TASKS_V2_TEMPLATE_PERMISSIONS_POPUP_FULL_ACCESS_DESCRIPTION")},!this.isGranted&&{permission:d.PermissionType.Read,title:this.loc("TASKS_V2_TEMPLATE_PERMISSIONS_POPUP_READ_ONLY_ACCESS"),description:this.loc("TASKS_V2_TEMPLATE_PERMISSIONS_POPUP_READ_ONLY_ACCESS_DESCRIPTION")}].filter(Boolean)},menuOptions(){return{id:`template-permission-menu-${this.permission.entityType}-${this.permission.entityId}`,className:"tasks-template-permissions-of-user",bindElement:this.$refs.permission,minWidth:238,maxWidth:244,padding:18,offsetTop:8,items:this.options.map((t=>({title:t.title,subtitle:t.description,onClick:()=>this.$emit("update",{id:this.permission.id,permission:t.permission})}))),targetContainer:document.body}}},watch:{isMenuShown(t){if(t){setTimeout((()=>this.freeze()))}else{this.unfreeze()}}},template:`\n\t\t<UserLabel :user="{ name: permission.title, image: permission.image }"/>\n\t\t<a\n\t\t\tclass="tasks-template-permissions-permission"\n\t\t\tref="permission"\n\t\t\t@click="isMenuShown = true"\n\t\t>\n\t\t\t{{ permissionLabel }}\n\t\t</a>\n\t\t<div class="tasks-template-permissions-remove" @click="$emit('remove')">\n\t\t\t<BIcon v-if="!isGranted" :name="Outline.CROSS_L"/>\n\t\t</div>\n\t\t<div class="tasks-template-permissions-separator"/>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions" @close="isMenuShown = false"/>\n\t`};const P={name:"AddUsersButton",components:{BIcon:a.BIcon,UiButton:l.Button},props:{templateId:{type:String,required:true},permissions:{type:Array,required:true},freeze:{type:Function,required:true},unfreeze:{type:Function,required:true}},emits:["update:permissions"],setup(){return{AirButtonStyle:l.AirButtonStyle,ButtonSize:l.ButtonSize,Outline:a.Outline}},computed:{preselected(){return this.permissions.map((t=>S.permissionBuilder.buildItemId(t)))}},unmounted(){var t;(t=this.selector)==null?void 0:t.destroy()},methods:{showDialog(){var t;const e=u.Core.getParams().restrictions;(t=this.selector)!=null?t:this.selector=new c.EntitySelectorDialog({id:`tasks-template-permissions-${this.templateId}`,targetNode:this.$el,context:"tasks-card",enableSearch:true,width:387,preselectedItems:this.preselected,entities:[{id:d.EntitySelectorEntity.User,options:{emailUsers:true,analyticsSource:"tasks",lockGuestLink:!e.mailUserIntegration.available,lockGuestLinkFeatureId:e.mailUserIntegration.featureId}},{id:d.EntitySelectorEntity.Department,options:{selectMode:"usersAndDepartments"}},{id:d.EntitySelectorEntity.MetaUser,options:{"all-users":true}},{id:d.EntitySelectorEntity.Project,itemOptions:{default:{entityType:d.EntitySelectorEntity.Project,link:"",linkTitle:""}}}],events:{"Item:onSelect":this.update,"Item:onDeselect":this.update},popupOptions:{events:{onClose:this.unfreeze}}});this.selector.selectItemsByIds(this.preselected);this.selector.show(this.$el);setTimeout((()=>this.freeze()))},update(){const t=this.selector.getSelectedItems().map((t=>{const e=S.permissionBuilder.buildFromItem(t);const s=this.permissions.find((({entityType:t,entityId:s})=>t===e.entityType&&s===e.entityId));return s!=null?s:e}));this.$emit("update:permissions",t)}},template:`\n\t\t<div>\n\t\t\t<UiButton\n\t\t\t\t:text="loc('TASKS_V2_TEMPLATE_PERMISSIONS_POPUP_ADD_USERS_BUTTON')"\n\t\t\t\t:leftIcon="Outline.PLUS_M"\n\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t:style="AirButtonStyle.OUTLINE"\n\t\t\t\tnoCaps\n\t\t\t\t@click="showDialog"\n\t\t\t/>\n\t\t</div>\n\t`};const T={name:"TemplatePermissionsPopup",components:{BIcon:a.BIcon,Popup:i.Popup,UiButton:l.Button,TemplatePermissionUserRow:h,AddUsersButton:P,HeadlineSm:n.HeadlineSm,Text2Xs:n.Text2Xs},inject:{task:{},taskId:{}},props:{bindElement:{type:HTMLElement,default:null}},emits:["close"],setup(){return{AirButtonStyle:l.AirButtonStyle,ButtonSize:l.ButtonSize,Outline:a.Outline}},data(){return{permissions:[]}},computed:{options(){return{id:`tasks-template-permissions-popup-${this.taskId}`,bindElement:this.bindElement,padding:14,minHeight:320,maxHeight:600,width:400,targetContainer:this.$root.$el.firstElementChild}}},watch:{permissions:{handler(){void this.$nextTick((()=>{var t;return(t=this.$refs.popup)==null?void 0:t.adjustPosition()}))},deep:true}},created(){this.permissions=S.permissionBuilder.getPermissions(this.task)},methods:{removeItem(t){this.permissions=this.permissions.filter((e=>e.id!==t))},updateItem({id:t,permission:e}){this.permissions.find((e=>e.id===t)).permission=e},save(){void o.taskService.update(this.taskId,{permissions:this.permissions});this.$emit("close")}},template:`\n\t\t<Popup v-slot="{ freeze, unfreeze }" :options ref="popup" @close="$emit('close')">\n\t\t\t<div class="tasks-template-permissions-popup">\n\t\t\t\t<div class="tasks-template-permissions-popup-title">\n\t\t\t\t\t<HeadlineSm>{{ loc('TASKS_V2_TEMPLATE_PERMISSIONS_POPUP_HEADER') }}</HeadlineSm>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tclass="tasks-template-permissions-popup-close"\n\t\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\t@click="$emit('close')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-template-permissions-popup-content">\n\t\t\t\t\t<div class="tasks-template-permissions-separator --header"/>\n\t\t\t\t\t<Text2Xs className="tasks-template-permissions-popup-header">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TEMPLATE_PERMISSIONS_POPUP_USERS_COLUMN') }}\n\t\t\t\t\t</Text2Xs>\n\t\t\t\t\t<Text2Xs className="tasks-template-permissions-popup-header">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TEMPLATE_PERMISSIONS_POPUP_PERMISSIONS_COLUMN') }}\n\t\t\t\t\t</Text2Xs>\n\t\t\t\t\t<div></div>\n\t\t\t\t\t<div class="tasks-template-permissions-separator --header"/>\n\t\t\t\t\t<TemplatePermissionUserRow\n\t\t\t\t\t\tv-for="permission of permissions"\n\t\t\t\t\t\t:key="permission.id"\n\t\t\t\t\t\t:permission\n\t\t\t\t\t\t:freeze\n\t\t\t\t\t\t:unfreeze\n\t\t\t\t\t\t@update="updateItem"\n\t\t\t\t\t\t@remove="removeItem(permission.id)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-template-permissions-popup-footer">\n\t\t\t\t\t<AddUsersButton v-model:permissions="permissions" :templateId="taskId" :freeze :unfreeze/>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text="loc('TASKS_V2_TEMPLATE_PERMISSIONS_POPUP_SAVE_BUTTON')"\n\t\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t\t:style="AirButtonStyle.FILLED"\n\t\t\t\t\t\tnoCaps\n\t\t\t\t\t\t@click="save"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`};const I={name:"TemplatePermissionsButton",components:{BIcon:a.BIcon,TemplatePermissionsPopup:T,UiButton:l.Button,HoverPill:s.HoverPill,TextSm:n.TextSm},inject:{task:{}},setup(){return{AirButtonStyle:l.AirButtonStyle,ButtonSize:l.ButtonSize,Outline:a.Outline}},data(){return{shown:false}},computed:{permissions(){return S.permissionBuilder.getPermissions(this.task)},isLocked(){return!u.Core.getParams().restrictions.templatesAccessPermissions.available},featureId(){return u.Core.getParams().restrictions.templatesAccessPermissions.featureId},buttonIcon(){return this.isLocked?a.Outline.LOCK_M:a.Outline.SETTINGS_M}},methods:{showPopup(){if(this.isLocked){void e.showLimit({featureId:this.featureId});return}this.shown=true}},template:`\n\t\t<div class="tasks--template-permissions-button">\n\t\t\t<HoverPill @click="showPopup">\n\t\t\t\t<div class="tasks--template-permissions-button--wrapper">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="Outline.SETTINGS"\n\t\t\t\t\t\t:size="24"\n\t\t\t\t\t\tcolor="var(--ui-color-base-3)"\n\t\t\t\t\t/>\n\t\t\t\t\t<TextSm className="tasks--template-permissions-button--text">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TEMPLATE_PERMISSIONS_BUTTON') }}\n\t\t\t\t\t</TextSm>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if="isLocked"\n\t\t\t\t\t\t:name="Outline.LOCK_L"\n\t\t\t\t\t\t:size="24"\n\t\t\t\t\t\tcolor="var(--ui-color-accent-main-primary-alt-2)"\n\t\t\t\t\t/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\tclass="tasks--template-permissions-button--counter"\n\t\t\t\t\t>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name="Outline.GROUP"\n\t\t\t\t\t\t\t:size="18"\n\t\t\t\t\t\t\tcolor="var(--ui-color-accent-main-primary)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<span class="tasks--template-permissions-button--counter__count">\n\t\t\t\t\t\t\t{{ permissions.length }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</HoverPill>\n\t\t\t<TemplatePermissionsPopup\n\t\t\t\tv-if="!isLocked && shown"\n\t\t\t\t:bindElement="$el"\n\t\t\t\t@close="shown = false"\n\t\t\t/>\n\t\t</div>\n\t`};t.TemplatePermissionsButton=I})(this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{},BX.Tasks.V2.Lib,BX.Tasks.V2.Component.Elements,BX.UI.Vue3.Components,BX.UI.System.Typography.Vue,BX.Tasks.V2.Provider.Service,BX.UI.Vue3.Components,BX.Tasks.V2.Component.Elements,BX.UI.IconSet,BX.Vue3.Components,BX,BX.Tasks.V2,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=template-permissions-button.bundle.map.js