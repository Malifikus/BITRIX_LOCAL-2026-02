{"version":3,"file":"files.bundle.js","sources":["../src/files-meta.js","../src/component/upload-button.js","../src/component/download-archive-button.js","../src/files-sheet.js","../src/files.js","../src/files-popup/files-popup.js","../src/files-chip.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\n\nexport const filesMeta = Object.freeze({\n\tid: TaskField.Files,\n\ttitle: Loc.getMessage('TASKS_V2_FILES_TITLE'),\n});\n","import { Button as UiButton, ButtonSize, AirButtonStyle } from 'ui.vue3.components.button';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { fileService } from 'tasks.v2.provider.service.file-service';\n\n// @vue/component\nexport const UploadButton = {\n\tcomponents: {\n\t\tUiButton,\n\t},\n\tinject: {\n\t\ttaskId: {},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tAirButtonStyle,\n\t\t\tOutline,\n\t\t};\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tfileService.get(this.taskId).browse({\n\t\t\t\tbindElement: this.$el,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<span data-task-files-upload>\n\t\t\t<UiButton\n\t\t\t\t:text=\"loc('TASKS_V2_FILES_UPLOAD')\"\n\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t:style=\"AirButtonStyle.SELECTION\"\n\t\t\t\t:leftIcon=\"Outline.ATTACH\"\n\t\t\t\t@click=\"handleClick\"\n\t\t\t/>\n\t\t</span>\n\t`,\n};\n","import { SidePanel } from 'main.sidepanel';\nimport { fileService } from 'tasks.v2.provider.service.file-service';\n\nimport { type UploaderFileInfo, formatFileSize } from 'ui.uploader.core';\nimport { Button as UiButton, ButtonSize, AirButtonStyle, ButtonCounterColor, ButtonState } from 'ui.vue3.components.button';\nimport { Outline } from 'ui.icon-set.api.vue';\n\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\n// @vue/component\nexport const DownloadArchiveButton = {\n\tcomponents: {\n\t\tUiButton,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t},\n\tprops: {\n\t\tfiles: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tAirButtonStyle,\n\t\t\tButtonCounterColor,\n\t\t\tButtonState,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tloading: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tarchiveLink(): ?string\n\t\t{\n\t\t\treturn this.task.archiveLink;\n\t\t},\n\t\tfilesSize(): number\n\t\t{\n\t\t\treturn this.files.reduce((total, file: UploaderFileInfo) => total + file.size, 0);\n\t\t},\n\t\tformattedFilesSize(): string\n\t\t{\n\t\t\treturn formatFileSize(this.filesSize);\n\t\t},\n\t},\n\tmethods: {\n\t\tasync downloadArchive(): void\n\t\t{\n\t\t\tif (fileService.get(this.taskId).hasPendingRequests())\n\t\t\t{\n\t\t\t\tthis.loading = true;\n\t\t\t\tawait fileService.get(this.taskId).handleSave();\n\t\t\t\tthis.loading = false;\n\t\t\t}\n\n\t\t\tSidePanel.Instance.emulateAnchorClick(this.archiveLink);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div data-task-files-download-archive @click=\"downloadArchive\">\n\t\t\t<UiButton\n\t\t\t\t:text=\"loc('TASKS_V2_FILES_DOWNLOAD_ARCHIVE', { '#FILES_SIZE#': formattedFilesSize })\"\n\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t:style=\"AirButtonStyle.PLAIN_NO_ACCENT\"\n\t\t\t\t:state=\"loading ? ButtonState.WAITING : null\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\n\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\nimport 'ui.icon-set.outline';\n\nimport type { UserFieldWidgetOptions } from 'disk.uploader.user-field-widget';\n\nimport { BottomSheet } from 'tasks.v2.component.elements.bottom-sheet';\nimport { DropZone } from 'tasks.v2.component.drop-zone';\nimport { DiskUserFieldWidgetComponent } from 'tasks.v2.component.elements.user-field-widget-component';\nimport { fileService, EntityTypes, type FileService } from 'tasks.v2.provider.service.file-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { UploadButton } from './component/upload-button';\nimport { DownloadArchiveButton } from './component/download-archive-button';\n\n// @vue/component\nexport const FilesSheet = {\n\tname: 'TaskFilesSheet',\n\tcomponents: {\n\t\tUploadButton,\n\t\tDownloadArchiveButton,\n\t\tBottomSheet,\n\t\tBIcon,\n\t\tDropZone,\n\t\tUserFieldWidgetComponent: DiskUserFieldWidgetComponent,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\tisEdit: {},\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tsheetBindProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['close'],\n\tsetup(props): { task: TaskModel, fileService: FileService, uploaderAdapter: VueUploaderAdapter }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tEntityTypes,\n\t\t\tfileService: fileService.get(props.taskId),\n\t\t\tuploaderAdapter: fileService.get(props.taskId).getAdapter(),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tuniqueKey: Text.getRandom(),\n\t\t\tfiles: this.fileService.getFiles(),\n\t\t};\n\t},\n\tcomputed: {\n\t\tcanAttachFiles(): boolean\n\t\t{\n\t\t\treturn this.task.rights.attachFile || this.task.rights.edit;\n\t\t},\n\t\tfilesCount(): number\n\t\t{\n\t\t\treturn this.files.length;\n\t\t},\n\t\tarchiveLink(): ?string\n\t\t{\n\t\t\treturn this.task.archiveLink;\n\t\t},\n\t\twidgetOptions(): UserFieldWidgetOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmbedded: true,\n\t\t\t\twithControlPanel: false,\n\t\t\t\tcanCreateDocuments: false,\n\t\t\t\ttileWidgetOptions: {\n\t\t\t\t\tcompact: true,\n\t\t\t\t\tautoCollapse: false,\n\t\t\t\t\treadonly: !this.canAttachFiles,\n\t\t\t\t\tenableDropzone: false,\n\t\t\t\t\thideDropArea: true,\n\t\t\t\t\tremoveFromServer: !this.isEdit,\n\t\t\t\t\tforceDisableSelection: true,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tshowFooter(): boolean\n\t\t{\n\t\t\treturn this.filesCount > 1 || this.canAttachFiles;\n\t\t},\n\t\tcanDownloadArchive(): boolean\n\t\t{\n\t\t\treturn this.filesCount > 1 && this.archiveLink;\n\t\t},\n\t\tbottomSheetContainer(): HTMLElement | null\n\t\t{\n\t\t\treturn document.getElementById(`b24-bottom-sheet-${this.uniqueKey}`) || null;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BottomSheet\n\t\t\t:sheetBindProps\n\t\t\t:padding=\"0\"\n\t\t\t:uniqueKey\n\t\t\t@close=\"$emit('close')\"\n\t\t>\n\t\t\t<div class=\"tasks-field-files-sheet\" :data-task-id=\"taskId\" ref=\"content\">\n\t\t\t\t<div class=\"tasks-field-files-header\">\n\t\t\t\t\t<div class=\"tasks-field-files-title\">{{ loc('TASKS_V2_FILES_TITLE') }}</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tdata-task-files-close\n\t\t\t\t\t\tclass=\"tasks-field-files-close\"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\t:name=\"Outline.CROSS_L\"\n\t\t\t\t\t\t@click=\"$emit('close')\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-field-files-list\">\n\t\t\t\t\t<UserFieldWidgetComponent :uploaderAdapter :widgetOptions/>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"showFooter\"\n\t\t\t\t\tclass=\"tasks-field-files-footer\"\n\t\t\t\t\t:class=\"{ '--with-archive': canDownloadArchive }\"\n\t\t\t\t>\n\t\t\t\t\t<DownloadArchiveButton v-if=\"canDownloadArchive\" :files/>\n\t\t\t\t\t<UploadButton v-if=\"canAttachFiles\"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<DropZone\n\t\t\t\tv-if=\"canAttachFiles\"\n\t\t\t\t:container=\"bottomSheetContainer || {}\"\n\t\t\t\t:entityId=\"taskId\"\n\t\t\t\t:entityType=\"EntityTypes.Task\"\n\t\t\t/>\n\t\t</BottomSheet>\n\t`,\n};\n","import { FileStatus } from 'ui.uploader.core';\nimport { BIcon, Animated, Outline } from 'ui.icon-set.api.vue';\nimport { hint, type HintParams } from 'ui.vue3.directives.hint';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\n\nimport 'ui.icon-set.animated';\nimport 'ui.icon-set.outline';\n\nimport type { UserFieldWidgetOptions } from 'disk.uploader.user-field-widget';\n\nimport { tooltip } from 'tasks.v2.component.elements.hint';\nimport { fileService, type FileService } from 'tasks.v2.provider.service.file-service';\nimport { DiskUserFieldWidgetComponent } from 'tasks.v2.component.elements.user-field-widget-component';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { filesMeta } from './files-meta';\nimport { FilesSheet } from './files-sheet';\nimport './files.css';\n\n// @vue/component\nexport const Files = {\n\tname: 'TaskFiles',\n\tcomponents: {\n\t\tBIcon,\n\t\tUserFieldWidgetComponent: DiskUserFieldWidgetComponent,\n\t\tFilesSheet,\n\t},\n\tdirectives: { hint },\n\tinject: {\n\t\ttask: {},\n\t\tisEdit: {},\n\t},\n\tprops: {\n\t\tisSheetShown: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tsheetBindProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:isSheetShown'],\n\tsetup(props): { task: TaskModel, uploaderAdapter: VueUploaderAdapter, fileService: FileService }\n\t{\n\t\treturn {\n\t\t\tAnimated,\n\t\t\tOutline,\n\t\t\tfilesMeta,\n\t\t\tfileService: fileService.get(props.taskId),\n\t\t\tuploaderAdapter: fileService.get(props.taskId).getAdapter(),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tfiles: this.fileService.getFiles(),\n\t\t\tisFilesScrollable: false,\n\t\t\tshowPreview: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tfilesCount(): number\n\t\t{\n\t\t\treturn this.files.length;\n\t\t},\n\t\ttextFormatted(): string\n\t\t{\n\t\t\tif (this.filesCount > 0)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_FILES_COUNT', {\n\t\t\t\t\t'#COUNT#': this.filesCount,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.loc('TASKS_V2_FILES_TITLE');\n\t\t},\n\t\tisUploading(): boolean\n\t\t{\n\t\t\treturn this.files.some(({ status }) => [\n\t\t\t\tFileStatus.UPLOADING,\n\t\t\t\tFileStatus.LOADING,\n\t\t\t].includes(status));\n\t\t},\n\t\tcanAttachFiles(): boolean\n\t\t{\n\t\t\treturn this.task.rights.attachFile || this.task.rights.edit;\n\t\t},\n\t\twidgetOptions(): UserFieldWidgetOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmbedded: true,\n\t\t\t\twithControlPanel: false,\n\t\t\t\tcanCreateDocuments: false,\n\t\t\t\ttileWidgetOptions: {\n\t\t\t\t\tcompact: true,\n\t\t\t\t\thideDropArea: true,\n\t\t\t\t\tenableDropzone: false,\n\t\t\t\t\treadonly: !this.canAttachFiles,\n\t\t\t\t\tautoCollapse: false,\n\t\t\t\t\tremoveFromServer: !this.isEdit,\n\t\t\t\t\tforceDisableSelection: true,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\ttooltip(): Function\n\t\t{\n\t\t\treturn (): HintParams => tooltip({\n\t\t\t\ttext: this.loc('TASKS_V2_FILES_ADD'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\toffsetLeft: this.$refs.add.$el.offsetWidth / 2,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\twatch: {\n\t\tfiles: {\n\t\t\thandler(newFiles): void\n\t\t\t{\n\t\t\t\tif (newFiles.length > 0 && this.fileService.isFileBrowserClosed())\n\t\t\t\t{\n\t\t\t\t\tthis.showPreview = true;\n\t\t\t\t\tthis.fileService.resetFileBrowserClosedState();\n\t\t\t\t}\n\t\t\t\tthis.handleFilesScrollable();\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.showPreview = this.isEdit;\n\n\t\tthis.fileService.subscribe('onFileAdd', this.handleFilesScrollable);\n\t\tthis.fileService.subscribe('onFileRemove', this.handleFilesScrollable);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.fileService.unsubscribe('onFileAdd', this.handleFilesScrollable);\n\t\tthis.fileService.unsubscribe('onFileRemove', this.handleFilesScrollable);\n\t},\n\tmethods: {\n\t\thandleAddClick(): void\n\t\t{\n\t\t\tthis.fileService.browse({\n\t\t\t\tbindElement: this.$refs.add.$el,\n\t\t\t\tonHideCallback: this.onFileBrowserClose,\n\t\t\t});\n\t\t},\n\t\thandleOpenClick(): void\n\t\t{\n\t\t\tif (this.filesCount === 0)\n\t\t\t{\n\t\t\t\tthis.fileService.browse({\n\t\t\t\t\tbindElement: this.$refs.title,\n\t\t\t\t\tonHideCallback: this.onFileBrowserClose,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.setSheetShown(true);\n\t\t\t}\n\t\t},\n\t\tasync handleFilesScrollable(): void\n\t\t{\n\t\t\tawait this.$nextTick();\n\n\t\t\tthis.checkFilesScrollable();\n\t\t},\n\t\tcheckFilesScrollable(): void\n\t\t{\n\t\t\tif (this.$refs.files)\n\t\t\t{\n\t\t\t\tthis.isFilesScrollable = this.$refs.files.scrollHeight > this.$refs.files.clientHeight;\n\t\t\t}\n\t\t},\n\t\tonFileBrowserClose(): void\n\t\t{\n\t\t\tthis.fileService.setFileBrowserClosed(true);\n\t\t},\n\t\tsetSheetShown(isShown: boolean): void\n\t\t{\n\t\t\tthis.$emit('update:isSheetShown', isShown);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-field-files\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-field-id=\"filesMeta.id\"\n\t\t\t:data-task-files-count=\"filesCount\"\n\t\t>\n\t\t\t<div class=\"tasks-field-files-title\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"tasks-field-files-main\"\n\t\t\t\t\tdata-task-files-open\n\t\t\t\t\t@click=\"handleOpenClick\"\n\t\t\t\t\tref=\"title\"\n\t\t\t\t>\n\t\t\t\t\t<template v-if=\"isUploading\">\n\t\t\t\t\t\t<BIcon class=\"tasks-field-files-icon\" :name=\"Animated.LOADER_WAIT\"/>\n\t\t\t\t\t\t<div class=\"tasks-field-files-text\">{{ loc('TASKS_V2_FILES_LOADING') }}</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<BIcon class=\"tasks-field-files-icon\" :name=\"Outline.ATTACH\"/>\n\t\t\t\t\t\t<div class=\"tasks-field-files-text\">{{ textFormatted }}</div>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"canAttachFiles\" class=\"tasks-field-files-add-container\" v-hint=\"tooltip\">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tclass=\"tasks-field-files-add\"\n\t\t\t\t\t\t:name=\"Outline.PLUS_L\"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\tdata-task-files-plus\n\t\t\t\t\t\t@click=\"handleAddClick\"\n\t\t\t\t\t\tref=\"add\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"showPreview && filesCount > 0\"\n\t\t\t\tclass=\"tasks-field-files-list --card\"\n\t\t\t\tref=\"files\"\n\t\t\t>\n\t\t\t\t<UserFieldWidgetComponent :uploaderAdapter :widgetOptions/>\n\t\t\t</div>\n\t\t\t<template v-if=\"isFilesScrollable\">\n\t\t\t\t<div class=\"tasks-field-files-shadow\">\n\t\t\t\t\t<div class=\"tasks-field-files-shadow-white\"/>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"tasks-field-files-more-button\"\n\t\t\t\t\t@click=\"setSheetShown(true)\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"tasks-field-files-more-button-text\">{{ loc('TASKS_V2_FILES_MORE') }}</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t\t<FilesSheet\n\t\t\tv-if=\"isSheetShown\"\n\t\t\t:taskId\n\t\t\t:sheetBindProps\n\t\t\t@close=\"setSheetShown(false)\"\n\t\t/>\n\t`,\n};\n","import type { PopupOptions } from 'main.popup';\n\nimport { Popup } from 'ui.vue3.components.popup';\nimport { Button as UiButton, AirButtonStyle, ButtonSize, ButtonIcon } from 'ui.vue3.components.button';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\nimport 'ui.icon-set.outline';\n\nimport type { UserFieldWidgetOptions } from 'disk.uploader.user-field-widget';\n\nimport { fileService } from 'tasks.v2.provider.service.file-service';\nimport { DiskUserFieldWidgetComponent } from 'tasks.v2.component.elements.user-field-widget-component';\n\nimport './files-popup.css';\n\n// @vue/component\nexport const FilesPopup = {\n\tcomponents: {\n\t\tPopup,\n\t\tUiButton,\n\t\tUserFieldWidgetComponent: DiskUserFieldWidgetComponent,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tgetBindElement: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['upload', 'close'],\n\tsetup(props): { uploaderAdapter: VueUploaderAdapter }\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tAirButtonStyle,\n\t\t\tButtonIcon,\n\t\t\tOutline,\n\t\t\tuploaderAdapter: fileService.get(props.taskId).getAdapter(),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tfiles: fileService.get(this.taskId).getFiles(),\n\t\t};\n\t},\n\tcomputed: {\n\t\tbindElement(): HTMLElement\n\t\t{\n\t\t\treturn this.getBindElement();\n\t\t},\n\t\toptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: 'tasks-field-files-popup',\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tminWidth: 380,\n\t\t\t\tmaxHeight: 320,\n\t\t\t\tpadding: 18,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\tforceTop: true,\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHideHandler: (event: MouseEvent): boolean => {\n\t\t\t\t\tconst anyTileMenuShown = this.files.some(({ isMenuShown }) => isMenuShown);\n\n\t\t\t\t\treturn this.$refs.popup?.autoHideHandler(event) && !anyTileMenuShown;\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\twidgetOptions(): UserFieldWidgetOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmbedded: true,\n\t\t\t\twithControlPanel: false,\n\t\t\t\tcanCreateDocuments: false,\n\t\t\t\ttileWidgetOptions: {\n\t\t\t\t\thideDropArea: true,\n\t\t\t\t\tenableDropzone: false,\n\t\t\t\t\tcompact: true,\n\t\t\t\t\tautoCollapse: false,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tfilesCount(): number\n\t\t{\n\t\t\treturn this.files.length;\n\t\t},\n\t},\n\twatch: {\n\t\tfilesCount(): void\n\t\t{\n\t\t\tif (this.filesCount === 0)\n\t\t\t{\n\t\t\t\tthis.closePopup();\n\t\t\t}\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClearClick(): void\n\t\t{\n\t\t\tfileService.get(this.taskId).getAdapter().getUploader().removeFiles();\n\n\t\t\tthis.closePopup();\n\t\t},\n\t\thandleUploadClick(): void\n\t\t{\n\t\t\tfileService.get(this.taskId).browseFiles();\n\t\t},\n\t\thandleMyDriveClick(): void\n\t\t{\n\t\t\tfileService.get(this.taskId).browseMyDrive();\n\t\t},\n\t\tclosePopup(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Popup :options ref=\"popup\" @close=\"closePopup\">\n\t\t\t<div class=\"tasks-field-files-popup\">\n\t\t\t\t<div class=\"tasks-field-files-popup-files\">\n\t\t\t\t\t<UserFieldWidgetComponent :uploaderAdapter :widgetOptions/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-field-files-popup-footer\">\n\t\t\t\t\t<div class=\"tasks-field-files-popup-add-buttons\">\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text=\"loc('TASKS_V2_FILES_UPLOAD_BUTTON')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t\t\t\t:style=\"AirButtonStyle.TINTED\"\n\t\t\t\t\t\t\t:leftIcon=\"Outline.DOWNLOAD\"\n\t\t\t\t\t\t\t@click=\"handleUploadClick\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text=\"loc('TASKS_V2_FILES_MY_DRIVE')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t\t\t\t:style=\"AirButtonStyle.TINTED\"\n\t\t\t\t\t\t\t:leftIcon=\"Outline.UPLOAD\"\n\t\t\t\t\t\t\t@click=\"handleMyDriveClick\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text=\"loc('TASKS_V2_FILES_CLEAR')\"\n\t\t\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t\t\t:style=\"AirButtonStyle.PLAIN_NO_ACCENT\"\n\t\t\t\t\t\t:leftIcon=\"Outline.TRASHCAN\"\n\t\t\t\t\t\t@click=\"handleClearClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`,\n};\n","import { groupMeta } from 'tasks.v2.component.fields.group';\nimport { FileStatus, UploaderFileInfo } from 'ui.uploader.core';\nimport { Chip, ChipDesign } from 'ui.system.chip.vue';\nimport { Animated, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.animated';\nimport 'ui.icon-set.outline';\n\nimport { GroupType, Model, CardType } from 'tasks.v2.const';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { fileService, type FileService } from 'tasks.v2.provider.service.file-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { GroupModel } from 'tasks.v2.model.groups';\n\nimport { filesMeta } from './files-meta';\nimport { FilesPopup } from './files-popup/files-popup';\n\n// @vue/component\nexport const FilesChip = {\n\tcomponents: {\n\t\tChip,\n\t\tFilesPopup,\n\t},\n\tinject: {\n\t\tanalytics: {},\n\t\tcardType: {},\n\t\ttask: {},\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisAutonomous: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): { task: TaskModel, fileService: FileService }\n\t{\n\t\treturn {\n\t\t\tfilesMeta,\n\t\t\tfileService: fileService.get(props.taskId),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tfiles: this.fileService.getFiles(),\n\t\t\tisPopupShown: false,\n\t\t\tisPopupShownWithFiles: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tgroup(): ?GroupModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Groups}/getById`](this.task.groupId);\n\t\t},\n\t\tfilesCount(): number\n\t\t{\n\t\t\treturn this.files.length;\n\t\t},\n\t\tdesign(): string\n\t\t{\n\t\t\treturn {\n\t\t\t\t[!this.isAutonomous && !this.isSelected]: ChipDesign.ShadowNoAccent,\n\t\t\t\t[!this.isAutonomous && this.isSelected]: ChipDesign.ShadowAccent,\n\t\t\t\t[this.isAutonomous && !this.isSelected]: ChipDesign.OutlineNoAccent,\n\t\t\t\t[this.isAutonomous && this.isSelected]: ChipDesign.OutlineAccent,\n\t\t\t\t[this.hasError]: ChipDesign.OutlineAlert,\n\t\t\t}.true;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\tif (this.isAutonomous)\n\t\t\t{\n\t\t\t\treturn this.files.length > 0;\n\t\t\t}\n\n\t\t\treturn this.task.filledFields[filesMeta.id] || this.files.length > 0;\n\t\t},\n\t\ticon(): string\n\t\t{\n\t\t\tif (this.isAutonomous && this.isUploading)\n\t\t\t{\n\t\t\t\treturn Animated.LOADER_WAIT;\n\t\t\t}\n\n\t\t\treturn Outline.ATTACH;\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\tif (this.isAutonomous && this.filesCount > 0)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_FILES_COUNT', {\n\t\t\t\t\t'#COUNT#': this.filesCount,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn filesMeta.title;\n\t\t},\n\t\tisUploading(): boolean\n\t\t{\n\t\t\treturn this.fileService.isUploading();\n\t\t},\n\t\thasError(): boolean\n\t\t{\n\t\t\treturn this.files.some(({ status }) => [FileStatus.UPLOAD_FAILED, FileStatus.LOAD_FAILED].includes(status));\n\t\t},\n\t\tcanAttachFiles(): boolean\n\t\t{\n\t\t\treturn this.task.rights.attachFile || this.task.rights.edit;\n\t\t},\n\t\tpopupHasAlreadyBeenShown(): boolean\n\t\t{\n\t\t\treturn this.filesCount > 0 && this.isPopupShownWithFiles;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.fileService.subscribe('onFileAdd', this.handleFileAdd);\n\t\tthis.fileService.subscribe('onFileComplete', this.handleFileComplete);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.fileService.unsubscribe('onFileAdd', this.handleFileAdd);\n\t\tthis.fileService.unsubscribe('onFileComplete', this.handleFileComplete);\n\t},\n\tmethods: {\n\t\thandleFileAdd(): void\n\t\t{\n\t\t\tif (this.isAutonomous && this.popupHasAlreadyBeenShown)\n\t\t\t{\n\t\t\t\tthis.showPopup();\n\t\t\t}\n\t\t},\n\t\thandleFileComplete(event): void\n\t\t{\n\t\t\tthis.sendAnalytics(event.getData());\n\t\t},\n\t\tsendAnalytics(file: UploaderFileInfo): void\n\t\t{\n\t\t\tanalytics.sendAttachFile(this.analytics, {\n\t\t\t\tcardType: this.cardType,\n\t\t\t\tcollabId: this.group?.type === GroupType.Collab ? this.group.id : null,\n\t\t\t\tfileOrigin: file.origin,\n\t\t\t\tfileSize: file.size,\n\t\t\t\tfileExtension: file.extension,\n\t\t\t\tfilesCount: this.filesCount,\n\t\t\t});\n\t\t},\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (!this.isAutonomous && this.isSelected)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.files.length > 0)\n\t\t\t{\n\t\t\t\tthis.isPopupShownWithFiles = true;\n\n\t\t\t\tthis.showPopup();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.browseFiles();\n\t\t\t}\n\t\t},\n\t\tshowPopup(): void\n\t\t{\n\t\t\tthis.isPopupShown = true;\n\t\t},\n\t\tclosePopup(): void\n\t\t{\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tif (!this.filesCount)\n\t\t\t{\n\t\t\t\tthis.isPopupShownWithFiles = false;\n\t\t\t}\n\t\t},\n\t\tbrowseFiles(): void\n\t\t{\n\t\t\tthis.fileService.browse({\n\t\t\t\tbindElement: this.$refs.chip.$el,\n\t\t\t\tonHideCallback: this.onFileBrowserClose,\n\t\t\t\tcompact: this.cardType === CardType.Compact,\n\t\t\t});\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(filesMeta.id);\n\t\t},\n\t\tonFileBrowserClose(): void\n\t\t{\n\t\t\tthis.$refs.chip?.$el.focus();\n\t\t\tthis.fileService.setFileBrowserClosed(true);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\tv-if=\"isSelected || canAttachFiles\"\n\t\t\t:design\n\t\t\t:icon\n\t\t\t:text\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"filesMeta.id\"\n\t\t\tref=\"chip\"\n\t\t\t@click=\"handleClick\"\n\t\t/>\n\t\t<FilesPopup\n\t\t\tv-if=\"isPopupShown\"\n\t\t\t:taskId\n\t\t\t:getBindElement=\"() => $refs.chip.$el\"\n\t\t\t@upload=\"browseFiles\"\n\t\t\t@close=\"closePopup\"\n\t\t/>\n\t`,\n};\n"],"names":["filesMeta","Object","freeze","id","TaskField","Files","title","Loc","getMessage","UploadButton","components","UiButton","inject","taskId","setup","ButtonSize","AirButtonStyle","Outline","methods","handleClick","fileService","get","browse","bindElement","$el","template","DownloadArchiveButton","task","props","files","type","Array","required","ButtonCounterColor","ButtonState","data","loading","computed","archiveLink","filesSize","reduce","total","file","size","formattedFilesSize","formatFileSize","downloadArchive","hasPendingRequests","handleSave","SidePanel","Instance","emulateAnchorClick","FilesSheet","name","BottomSheet","BIcon","DropZone","UserFieldWidgetComponent","DiskUserFieldWidgetComponent","isEdit","Number","String","sheetBindProps","emits","EntityTypes","uploaderAdapter","getAdapter","uniqueKey","Text","getRandom","getFiles","canAttachFiles","rights","attachFile","edit","filesCount","length","widgetOptions","isEmbedded","withControlPanel","canCreateDocuments","tileWidgetOptions","compact","autoCollapse","readonly","enableDropzone","hideDropArea","removeFromServer","forceDisableSelection","showFooter","canDownloadArchive","bottomSheetContainer","document","getElementById","directives","hint","isSheetShown","Boolean","Animated","isFilesScrollable","showPreview","textFormatted","loc","isUploading","some","status","FileStatus","UPLOADING","LOADING","includes","tooltip","text","popupOptions","offsetLeft","$refs","add","offsetWidth","watch","handler","newFiles","isFileBrowserClosed","resetFileBrowserClosedState","handleFilesScrollable","deep","mounted","subscribe","beforeUnmount","unsubscribe","handleAddClick","onHideCallback","onFileBrowserClose","handleOpenClick","setSheetShown","$nextTick","checkFilesScrollable","scrollHeight","clientHeight","setFileBrowserClosed","isShown","$emit","FilesPopup","Popup","getBindElement","Function","ButtonIcon","options","minWidth","maxHeight","padding","bindOptions","forceBindPosition","forceTop","position","closeByEsc","autoHideHandler","event","anyTileMenuShown","isMenuShown","popup","closePopup","handleClearClick","getUploader","removeFiles","handleUploadClick","browseFiles","handleMyDriveClick","browseMyDrive","FilesChip","Chip","analytics","cardType","isAutonomous","default","isPopupShown","isPopupShownWithFiles","group","$store","getters","Model","Groups","groupId","design","isSelected","ChipDesign","ShadowNoAccent","ShadowAccent","OutlineNoAccent","OutlineAccent","hasError","OutlineAlert","true","filledFields","icon","LOADER_WAIT","ATTACH","UPLOAD_FAILED","LOAD_FAILED","popupHasAlreadyBeenShown","handleFileAdd","handleFileComplete","showPopup","sendAnalytics","getData","sendAttachFile","collabId","GroupType","Collab","fileOrigin","origin","fileSize","fileExtension","extension","highlightField","chip","CardType","Compact","fieldHighlighter","setContainer","$root","highlight","focus"],"mappings":"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"}