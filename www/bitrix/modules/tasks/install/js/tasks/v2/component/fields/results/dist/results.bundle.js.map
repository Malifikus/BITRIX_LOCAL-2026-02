{"version":3,"file":"results.bundle.js","sources":["../src/results-meta.js","../src/components/result/result-card-item.js","../src/components/result-required-aha/result-required-aha.js","../src/components/result/result-list-item.js","../src/components/result/result-skeleton.js","../src/components/result-editor-sheet/result-editor.js","../src/components/result-editor-sheet/result-editor-sheet.js","../src/components/result-list-sheet/result-list-empty.js","../src/components/result-list-sheet/result-list-sheet.js","../src/results.js","../src/results-chip.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\n\nexport const resultsMeta = Object.freeze({\n\tid: TaskField.Results,\n\ttitle: Loc.getMessage('TASKS_V2_RESULT_TITLE_META'),\n});\n","import { Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport { shallowRef } from 'ui.vue3';\nimport { hint, type HintParams } from 'ui.vue3.directives.hint';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { TextMd, TextXs, TextSm } from 'ui.system.typography.vue';\nimport { BMenu, type MenuOptions, type MenuItemOptions } from 'ui.vue3.components.menu';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\n\nimport type { UserFieldWidgetOptions } from 'disk.uploader.user-field-widget';\n\nimport { EventName, Model, Option } from 'tasks.v2.const';\nimport { ahaMoments } from 'tasks.v2.lib.aha-moments';\nimport { calendar } from 'tasks.v2.lib.calendar';\nimport { Hint, tooltip } from 'tasks.v2.component.elements.hint';\nimport { UserAvatar, UserAvatarSize } from 'tasks.v2.component.elements.user-avatar';\nimport { EntityCollapsibleText } from 'tasks.v2.component.entity-text';\nimport { DiskUserFieldWidgetComponent } from 'tasks.v2.component.elements.user-field-widget-component';\nimport { userService } from 'tasks.v2.provider.service.user-service';\nimport { EntityTypes, fileService, type FileService } from 'tasks.v2.provider.service.file-service';\nimport { resultService } from 'tasks.v2.provider.service.result-service';\nimport type { ResultModel } from 'tasks.v2.model.results';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nimport { resultsMeta } from '../../results-meta';\n\nimport './result.css';\nimport '../../results.css';\n\n// @vue/component\nexport const ResultCardItem = {\n\tcomponents: {\n\t\tBIcon,\n\t\tBMenu,\n\t\tUserAvatar,\n\t\tUserFieldWidgetComponent: DiskUserFieldWidgetComponent,\n\t\tEntityCollapsibleText,\n\t\tTextSm,\n\t\tTextXs,\n\t\tTextMd,\n\t\tHint,\n\t},\n\tdirectives: { hint },\n\tinject: {\n\t\ttaskId: {},\n\t},\n\tprops: {\n\t\tresultId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['titleClick', 'edit', 'highlightField'],\n\tsetup(props): { fileService: FileService, uploaderAdapter: VueUploaderAdapter }\n\t{\n\t\tconst fileServiceInstance = fileService.get(props.resultId, EntityTypes.Result);\n\n\t\tconst fileServiceRef = shallowRef(fileServiceInstance);\n\t\tconst uploaderAdapterRef = shallowRef(fileServiceInstance.getAdapter());\n\n\t\treturn {\n\t\t\tOutline,\n\t\t\tresultsMeta,\n\t\t\tUserAvatarSize,\n\t\t\tfileService: fileServiceRef,\n\t\t\tuploaderAdapter: uploaderAdapterRef,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\topened: false,\n\t\t\tisMenuShown: false,\n\t\t\tshowResultFromMessageHint: false,\n\t\t\tfiles: this.fileService.getFiles(),\n\t\t};\n\t},\n\tcomputed: {\n\t\tresult(): ResultModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Results}/getById`](this.resultId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.resultId) && this.resultId > 0;\n\t\t},\n\t\tresultTitle(): string\n\t\t{\n\t\t\treturn this.loc('TASKS_V2_RESULT_TITLE_WITH_DATE', {\n\t\t\t\t'#DATE#': this.resultDate,\n\t\t\t});\n\t\t},\n\t\tresultDate(): string\n\t\t{\n\t\t\tif (!this.result.createdAtTs)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn calendar.formatDateTime(this.result.createdAtTs);\n\t\t},\n\t\tresultText(): string\n\t\t{\n\t\t\treturn this.result.text ?? '';\n\t\t},\n\t\tresultAuthor(): UserModel\n\t\t{\n\t\t\treturn this.result.author;\n\t\t},\n\t\tfilesCount(): number\n\t\t{\n\t\t\treturn this.files.length;\n\t\t},\n\t\twidgetOptions(): UserFieldWidgetOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmbedded: true,\n\t\t\t\twithControlPanel: false,\n\t\t\t\tcanCreateDocuments: false,\n\t\t\t\ttileWidgetOptions: {\n\t\t\t\t\tcompact: true,\n\t\t\t\t\thideDropArea: true,\n\t\t\t\t\treadonly: true,\n\t\t\t\t\tenableDropzone: false,\n\t\t\t\t\tautoCollapse: false,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tmenuOptions(): MenuOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `result-action-menu-${Text.getRandom()}`,\n\t\t\t\tbindOptions: { forceBindPosition: true },\n\t\t\t\tbindElement: this.$refs.moreIcon.$el,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\toffsetLeft: -100,\n\t\t\t\tminWidth: 250,\n\t\t\t\titems: this.menuItems,\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t};\n\t\t},\n\t\tmenuItems(): MenuItemOptions[]\n\t\t{\n\t\t\treturn [\n\t\t\t\tthis.result.rights.edit && this.isEdit && {\n\t\t\t\t\ttitle: this.loc('TASKS_V2_RESULT_EDIT'),\n\t\t\t\t\ticon: Outline.EDIT_L,\n\t\t\t\t\tonClick: this.handleEditClick.bind(this),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuResultEdit-${this.resultId}`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.result.rights.remove && {\n\t\t\t\t\tdesign: 'alert',\n\t\t\t\t\ttitle: this.loc('TASKS_V2_RESULT_REMOVE'),\n\t\t\t\t\ticon: Outline.TRASHCAN,\n\t\t\t\t\tonClick: this.handleDeleteClick.bind(this),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuResultRemove-${this.resultId}`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t].filter(Boolean);\n\t\t},\n\t\thasMenuItems(): boolean\n\t\t{\n\t\t\treturn this.menuItems.length > 0;\n\t\t},\n\t\ttooltip(): Function\n\t\t{\n\t\t\treturn (): HintParams => tooltip({\n\t\t\t\ttext: this.loc('TASKS_V2_RESULT_ADD'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\toffsetLeft: this.$refs.addIcon.offsetWidth / 2,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\twatch: {\n\t\tresultId(newResultId): void\n\t\t{\n\t\t\tthis.fileService = fileService.get(newResultId, EntityTypes.Result);\n\t\t\tthis.uploaderAdapter = this.fileService.getAdapter();\n\t\t\tthis.files = this.fileService.getFiles();\n\t\t\tthis.opened = false;\n\t\t},\n\t\tresultText(): void\n\t\t{\n\t\t\tvoid this.$nextTick(this.$refs.collapsible?.updateIsOverflowing);\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tEventEmitter.subscribe(EventName.ResultFromMessageAdded, this.handleResultFromMessageAdded);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEventEmitter.unsubscribe(EventName.ResultFromMessageAdded, this.handleResultFromMessageAdded);\n\t},\n\tmethods: {\n\t\thandleEditClick(): void\n\t\t{\n\t\t\tthis.$emit('edit', this.resultId);\n\t\t},\n\t\thandleDeleteClick(): void\n\t\t{\n\t\t\tvoid resultService.delete(this.resultId);\n\t\t},\n\t\thandleAuthorClick(): void\n\t\t{\n\t\t\tBX.SidePanel.Instance.emulateAnchorClick(userService.getUrl(this.resultAuthor.id));\n\t\t},\n\t\thandleResultFromMessageAdded(event: BaseEvent): void\n\t\t{\n\t\t\tconst { taskId } = event.getData();\n\n\t\t\tif (this.taskId !== taskId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('highlightField');\n\n\t\t\tif (!ahaMoments.shouldShow(Option.AhaResultFromMessagePopup))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tahaMoments.setActive(Option.AhaResultFromMessagePopup);\n\t\t\tthis.showResultFromMessageHint = true;\n\t\t},\n\t\thandleResultFromMessageHintClose(): void\n\t\t{\n\t\t\tthis.showResultFromMessageHint = false;\n\t\t\tahaMoments.setInactive(Option.AhaResultFromMessagePopup);\n\t\t},\n\t\thandleResultFromMessageHintCloseComplete(): void\n\t\t{\n\t\t\tif (!this.showResultFromMessageHint)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showResultFromMessageHint = false;\n\n\t\t\tahaMoments.setShown(Option.AhaResultFromMessagePopup);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-field-results-result --card\"\n\t\t\t:data-task-field-id=\"resultsMeta.id\"\n\t\t\tdata-field-container\n\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"tasks-field-results-title\"\n\t\t\t\tref=\"title\"\n\t\t\t\t@click=\"$emit('titleClick', resultId)\"\n\t\t\t>\n\t\t\t\t<div class=\"tasks-field-results-title-main\">\n\t\t\t\t\t<BIcon :name=\"Outline.WINDOW_FLAG\"/>\n\t\t\t\t\t<TextMd accent>{{ resultTitle }}</TextMd>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-field-results-title-actions\">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if=\"hasMenuItems\"\n\t\t\t\t\t\tclass=\"tasks-field-results-title-icon\"\n\t\t\t\t\t\t:name=\"Outline.MORE_L\"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\tref=\"moreIcon\"\n\t\t\t\t\t\t@click.stop=\"isMenuShown = true\"\n\t\t\t\t\t/>\n\t\t\t\t\t<BMenu v-if=\"isMenuShown\" :options=\"menuOptions\" @close=\"isMenuShown = false\"/>\n\t\t\t\t\t<Hint\n\t\t\t\t\t\tv-if=\"showResultFromMessageHint\"\n\t\t\t\t\t\t:bindElement=\"$refs.moreIcon.$el\"\n\t\t\t\t\t\t:options=\"{\n\t\t\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\t\t\toffsetLeft: 10,\n\t\t\t\t\t\t\tminWidth: 340,\n\t\t\t\t\t\t\tmaxWidth: 340,\n\t\t\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\"\n\t\t\t\t\t\t@close=\"handleResultFromMessageHintClose\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"tasks-field-results-hint-info\">\n\t\t\t\t\t\t\t<TextMd className=\"tasks-field-results-hint-info-text\">\n\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_RESULT_AHA_RESULT_FROM_MESSAGE') }}\n\t\t\t\t\t\t\t</TextMd>\n\t\t\t\t\t\t\t<TextXs\n\t\t\t\t\t\t\t\tclassName=\"tasks-field-results-hint-info-link\"\n\t\t\t\t\t\t\t\t@click.stop=\"handleResultFromMessageHintCloseComplete\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_RESULT_AHA_SHOW_NO_MORE') }}\n\t\t\t\t\t\t\t</TextXs>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Hint>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-field-results-result-content\" ref=\"content\">\n\t\t\t\t<div class=\"tasks-field-results-result-author-border\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"tasks-field-results-result-author-border-clickable\"\n\t\t\t\t\t\t@click=\"handleAuthorClick\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserAvatar\n\t\t\t\t\t\t\t:src=\"resultAuthor.image\"\n\t\t\t\t\t\t\t:type=\"resultAuthor.type\"\n\t\t\t\t\t\t\t:size=\"UserAvatarSize.XS\"\n\t\t\t\t\t\t\t:bx-tooltip-user-id=\"resultAuthor.id\"\n\t\t\t\t\t\t\tbx-tooltip-context=\"b24\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<TextSm\n\t\t\t\t\t\t\tclassName=\"tasks-field-results-result-author-name\"\n\t\t\t\t\t\t\t:bx-tooltip-user-id=\"resultAuthor.id\"\n\t\t\t\t\t\t\tbx-tooltip-context=\"b24\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ resultAuthor.name }}\n\t\t\t\t\t\t</TextSm>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<EntityCollapsibleText\n\t\t\t\t\tref=\"collapsible\"\n\t\t\t\t\t:files\n\t\t\t\t\t:content=\"resultText\"\n\t\t\t\t\treadonly\n\t\t\t\t\t:showFilesIndicator=\"false\"\n\t\t\t\t\tv-model:opened=\"opened\"\n\t\t\t\t/>\n\t\t\t\t<div v-if=\"filesCount > 0\" class=\"tasks-field-results-result-files\" :key=\"resultId\">\n\t\t\t\t\t<UserFieldWidgetComponent :uploaderAdapter :widgetOptions/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Button as UiButton, AirButtonStyle, ButtonSize } from 'ui.vue3.components.button';\nimport { HeadlineSm, TextMd } from 'ui.system.typography.vue';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Hint } from 'tasks.v2.component.elements.hint';\n\nimport './result-required-aha.css';\n\n// @vue/component\nexport const ResultRequiredAha = {\n\tcomponents: {\n\t\tUiButton,\n\t\tHint,\n\t\tTextMd,\n\t\tHeadlineSm,\n\t},\n\tprops: {\n\t\tbindElement: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tpopupWidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 530,\n\t\t},\n\t\thasResults: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['close', 'addResult'],\n\tsetup(): void\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.hasResults\n\t\t\t\t? this.loc('TASKS_V2_RESULT_AHA_REQUIRE_NEW_RESULT_RESPONSIBLE_TITLE')\n\t\t\t\t: this.loc('TASKS_V2_RESULT_AHA_REQUIRE_RESULT_RESPONSIBLE_TITLE')\n\t\t\t;\n\t\t},\n\t\tdescription(): string\n\t\t{\n\t\t\treturn this.hasResults\n\t\t\t\t? this.loc('TASKS_V2_RESULT_AHA_REQUIRE_NEW_RESULT_RESPONSIBLE_DESC')\n\t\t\t\t: this.loc('TASKS_V2_RESULT_AHA_REQUIRE_RESULT_RESPONSIBLE_DESC')\n\t\t\t;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Hint\n\t\t\t:bindElement\n\t\t\t:options=\"{\n\t\t\t\tcloseIcon: true,\n\t\t\t\tminWidth: popupWidth,\n\t\t\t\tmaxWidth: popupWidth,\n\t\t\t\tpadding: 0,\n\t\t\t}\"\n\t\t\t@close=\"$emit('close')\"\n\t\t>\n\t\t\t<div class=\"tasks-field-results-hint-container\">\n\t\t\t\t<div class=\"tasks-field-results-hint-icon\"/>\n\t\t\t\t<div class=\"tasks-field-results-hint-info\">\n\t\t\t\t\t<HeadlineSm className=\"tasks-field-results-hint-info-text\">{{ title }}</HeadlineSm>\n\t\t\t\t\t<TextMd className=\"tasks-field-results-hint-info-text\">{{ description }}</TextMd>\n\t\t\t\t\t<div class=\"tasks-field-results-hint-button\">\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text=\"loc('TASKS_V2_RESULT_ADD')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t\t\t\t:style=\"AirButtonStyle.TINTED\"\n\t\t\t\t\t\t\t:leftIcon=\"Outline.PLUS_L\"\n\t\t\t\t\t\t\t:wide=\"false\"\n\t\t\t\t\t\t\t@click=\"$emit('addResult')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Hint>\n\t`,\n};\n","import { Text, Event, Type } from 'main.core';\n\nimport { shallowRef } from 'ui.vue3';\nimport { hint } from 'ui.vue3.directives.hint';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { HeadlineSm, TextSm } from 'ui.system.typography.vue';\nimport { BMenu, type MenuOptions, type MenuItemOptions } from 'ui.vue3.components.menu';\nimport type { VueUploaderAdapter } from 'ui.uploader.vue';\n\nimport type { UserFieldWidgetOptions } from 'disk.uploader.user-field-widget';\n\nimport { Model } from 'tasks.v2.const';\nimport { calendar } from 'tasks.v2.lib.calendar';\nimport { UserAvatar, UserAvatarSize } from 'tasks.v2.component.elements.user-avatar';\nimport { EntityCollapsibleText } from 'tasks.v2.component.entity-text';\nimport { DiskUserFieldWidgetComponent } from 'tasks.v2.component.elements.user-field-widget-component';\nimport { userService } from 'tasks.v2.provider.service.user-service';\nimport { EntityTypes, fileService } from 'tasks.v2.provider.service.file-service';\nimport { resultService } from 'tasks.v2.provider.service.result-service';\nimport type { FileService } from 'tasks.v2.provider.service.file-service';\nimport type { ResultModel } from 'tasks.v2.model.results';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nimport { resultsMeta } from '../../results-meta';\n\nimport './result.css';\nimport '../../results.css';\n\n// @vue/component\nexport const ResultListItem = {\n\tname: 'TaskResultListItem',\n\tcomponents: {\n\t\tBIcon,\n\t\tBMenu,\n\t\tHeadlineSm,\n\t\tUserAvatar,\n\t\tUserFieldWidgetComponent: DiskUserFieldWidgetComponent,\n\t\tEntityCollapsibleText,\n\t\tTextSm,\n\t},\n\tdirectives: { hint },\n\tprops: {\n\t\tresultId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tshowDelimiter: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisResized: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['titleClick', 'edit', 'resize'],\n\tsetup(props): { fileService: FileService, uploaderAdapter: VueUploaderAdapter }\n\t{\n\t\tconst fileServiceInstance = fileService.get(props.resultId, EntityTypes.Result);\n\n\t\tconst fileServiceRef = shallowRef(fileServiceInstance);\n\t\tconst uploaderAdapterRef = shallowRef(fileServiceInstance.getAdapter());\n\n\t\treturn {\n\t\t\tOutline,\n\t\t\tresultsMeta,\n\t\t\tUserAvatarSize,\n\t\t\tfileService: fileServiceRef,\n\t\t\tuploaderAdapter: uploaderAdapterRef,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisSticky: false,\n\t\t\tscrollContainer: null,\n\t\t\tmutationObserver: null,\n\t\t\tisMenuShown: false,\n\t\t\tfiles: this.fileService.getFiles(),\n\t\t};\n\t},\n\tcomputed: {\n\t\tresult(): ResultModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Results}/getById`](this.resultId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.resultId) && this.resultId > 0;\n\t\t},\n\t\tresultTitle(): string\n\t\t{\n\t\t\treturn this.loc('TASKS_V2_RESULT_TITLE_WITH_DATE', {\n\t\t\t\t'#DATE#': this.resultDate,\n\t\t\t});\n\t\t},\n\t\tresultDate(): string\n\t\t{\n\t\t\tif (!this.result.createdAtTs)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn calendar.formatDateTime(this.result.createdAtTs);\n\t\t},\n\t\tresultText(): string\n\t\t{\n\t\t\treturn this.result.text ?? '';\n\t\t},\n\t\tresultAuthor(): UserModel\n\t\t{\n\t\t\treturn this.result.author;\n\t\t},\n\t\tfilesCount(): number\n\t\t{\n\t\t\treturn this.files.length;\n\t\t},\n\t\twidgetOptions(): UserFieldWidgetOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmbedded: true,\n\t\t\t\twithControlPanel: false,\n\t\t\t\tcanCreateDocuments: false,\n\t\t\t\ttileWidgetOptions: {\n\t\t\t\t\tcompact: true,\n\t\t\t\t\thideDropArea: true,\n\t\t\t\t\treadonly: true,\n\t\t\t\t\tenableDropzone: false,\n\t\t\t\t\tautoCollapse: false,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tmenuOptions(): MenuOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `result-action-menu-${Text.getRandom()}`,\n\t\t\t\tbindOptions: { forceBindPosition: true },\n\t\t\t\tbindElement: this.$refs.moreIcon.$el,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\toffsetLeft: -100,\n\t\t\t\tminWidth: 250,\n\t\t\t\titems: this.menuItems,\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t};\n\t\t},\n\t\tmenuItems(): MenuItemOptions[]\n\t\t{\n\t\t\treturn [\n\t\t\t\tthis.result.rights.edit && this.isEdit && {\n\t\t\t\t\ttitle: this.loc('TASKS_V2_RESULT_EDIT'),\n\t\t\t\t\ticon: Outline.EDIT_L,\n\t\t\t\t\tonClick: this.handleEditClick.bind(this),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuResultEdit-${this.resultId}`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.result.rights.remove && {\n\t\t\t\t\tdesign: 'alert',\n\t\t\t\t\ttitle: this.loc('TASKS_V2_RESULT_REMOVE'),\n\t\t\t\t\ticon: Outline.TRASHCAN,\n\t\t\t\t\tonClick: this.handleDeleteClick.bind(this),\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuResultRemove-${this.resultId}`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t].filter(Boolean);\n\t\t},\n\t\thasMenuItems(): boolean\n\t\t{\n\t\t\treturn this.menuItems.length > 0;\n\t\t},\n\t\tresizeIcon(): string\n\t\t{\n\t\t\treturn this.isResized ? Outline.COLLAPSE_L : Outline.EXPAND_L;\n\t\t},\n\t},\n\twatch: {\n\t\tresultId(newResultId): void\n\t\t{\n\t\t\tthis.fileService = fileService.get(newResultId, EntityTypes.Result);\n\t\t\tthis.uploaderAdapter = this.fileService.getAdapter();\n\t\t\tthis.files = this.fileService.getFiles();\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.scrollContainer = this.$el?.closest('.tasks-field-results-result-list-content');\n\n\t\tif (this.scrollContainer)\n\t\t{\n\t\t\tEvent.bind(this.scrollContainer, 'scroll', this.handleScroll);\n\n\t\t\tvoid this.$nextTick(this.checkSticky);\n\n\t\t\tthis.mutationObserver = new MutationObserver(() => this.checkSticky());\n\n\t\t\tthis.mutationObserver.observe(\n\t\t\t\tthis.scrollContainer,\n\t\t\t\t{\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tsubtree: true,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tif (this.scrollContainer)\n\t\t{\n\t\t\tEvent.unbind(this.scrollContainer, 'scroll', this.handleScroll);\n\t\t}\n\n\t\tif (this.mutationObserver)\n\t\t{\n\t\t\tthis.mutationObserver.disconnect();\n\t\t}\n\t},\n\tmethods: {\n\t\thandleEditClick(): void\n\t\t{\n\t\t\tthis.$emit('edit', this.resultId);\n\t\t},\n\t\thandleDeleteClick(): void\n\t\t{\n\t\t\tvoid resultService.delete(this.resultId);\n\t\t},\n\t\thandleResizeClick(): void\n\t\t{\n\t\t\tthis.$emit('resize');\n\t\t},\n\t\thandleScroll(): void\n\t\t{\n\t\t\tthis.checkSticky();\n\t\t},\n\t\tcheckSticky(): void\n\t\t{\n\t\t\tif (!this.scrollContainer || !this.$refs.title)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst itemRect = this.$refs.title.getBoundingClientRect();\n\t\t\tconst containerRect = this.scrollContainer.getBoundingClientRect();\n\t\t\tthis.isSticky = itemRect.top <= (containerRect.top + itemRect.height / 2);\n\t\t},\n\t\thandleAuthorClick(): void\n\t\t{\n\t\t\tBX.SidePanel.Instance.emulateAnchorClick(userService.getUrl(this.resultAuthor.id));\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-results-result --list-mode\">\n\t\t\t<div\n\t\t\t\tclass=\"tasks-field-results-title --list-mode\"\n\t\t\t\t:class=\"{ '--sticky': isSticky }\"\n\t\t\t\tref=\"title\"\n\t\t\t\t@click=\"$emit('titleClick', resultId)\"\n\t\t\t>\n\t\t\t\t<div class=\"tasks-field-results-title-main\">\n\t\t\t\t\t<BIcon :name=\"Outline.WINDOW_FLAG\"/>\n\t\t\t\t\t<HeadlineSm>{{ resultTitle }}</HeadlineSm>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-field-results-title-actions\">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if=\"hasMenuItems\"\n\t\t\t\t\t\tclass=\"tasks-field-results-title-icon --big\"\n\t\t\t\t\t\t:name=\"Outline.MORE_L\"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\tref=\"moreIcon\"\n\t\t\t\t\t\t@click.stop=\"isMenuShown = true\"\n\t\t\t\t\t/>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if=\"isSticky\"\n\t\t\t\t\t\tclass=\"tasks-field-results-title-icon --big\"\n\t\t\t\t\t\t:name=\"resizeIcon\"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\t@click.stop=\"handleResizeClick\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div v-if=\"isSticky\" class=\"tasks-field-results-result-empty\"/>\n\t\t\t\t\t<BMenu\n\t\t\t\t\t\tv-if=\"isMenuShown\"\n\t\t\t\t\t\t:options=\"menuOptions\"\n\t\t\t\t\t\t@close=\"isMenuShown = false\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass=\"tasks-field-results-result-content\"\n\t\t\t\tref=\"content\"\n\t\t\t>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"tasks-field-results-result-author\"\n\t\t\t\t\t@click=\"handleAuthorClick\"\n\t\t\t\t>\n\t\t\t\t\t<UserAvatar\n\t\t\t\t\t\t:src=\"resultAuthor.image\"\n\t\t\t\t\t\t:type=\"resultAuthor.type\"\n\t\t\t\t\t\t:size=\"UserAvatarSize.XS\"\n\t\t\t\t\t\t:bx-tooltip-user-id=\"resultAuthor.id\"\n\t\t\t\t\t\tbx-tooltip-context=\"b24\"\n\t\t\t\t\t/>\n\t\t\t\t\t<TextSm\n\t\t\t\t\t\tclassName=\"tasks-field-results-result-author-name\"\n\t\t\t\t\t\t:bx-tooltip-user-id=\"resultAuthor.id\"\n\t\t\t\t\t\tbx-tooltip-context=\"b24\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ resultAuthor.name }}\n\t\t\t\t\t</TextSm>\n\t\t\t\t</div>\n\t\t\t\t<EntityCollapsibleText\n\t\t\t\t\tref=\"collapsible\"\n\t\t\t\t\t:content=\"resultText\"\n\t\t\t\t\t:files\n\t\t\t\t\treadonly\n\t\t\t\t\tshowFilesIndicator\n\t\t\t\t\topenByDefault\n\t\t\t\t\topened\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"filesCount > 0\"\n\t\t\t\t\tclass=\"tasks-field-results-result-files --list-mode\"\n\t\t\t\t>\n\t\t\t\t\t<UserFieldWidgetComponent :uploaderAdapter :widgetOptions/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"showDelimiter\" class=\"tasks-field-results-result-separator\"/>\n\t\t\t<div v-else class=\"tasks-field-results-result-last-padding\"/>\n\t\t</div>\n\t`,\n};\n","import { BLine } from 'ui.system.skeleton.vue';\nimport './result.css';\n\n// @vue/component\nexport const ResultSkeleton = {\n\tcomponents: {\n\t\tBLine,\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-results-result-skeleton-container\">\n\t\t\t<BLine :width=\"460\" :height=\"12\" :radius=\"60\"/>\n\t\t\t<BLine :width=\"460\" :height=\"12\" :radius=\"60\"/>\n\t\t\t<BLine :width=\"460\" :height=\"12\" :radius=\"60\"/>\n\t\t\t<BLine :width=\"197\" :height=\"12\" :radius=\"60\"/>\n\t\t</div>\n\t`,\n};\n","import { Type, Event } from 'main.core';\n\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { TextEditor } from 'ui.text-editor';\nimport { Button as UiButton, ButtonColor, ButtonSize } from 'ui.vue3.components.button';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { Model, EventName, ResultStatus, Analytics } from 'tasks.v2.const';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { calendar } from 'tasks.v2.lib.calendar';\nimport { resultService } from 'tasks.v2.provider.service.result-service';\nimport { fileService, EntityTypes, type FileService } from 'tasks.v2.provider.service.file-service';\nimport {\n\tEntityTextArea,\n\tEntityTextTypes,\n\tentityTextEditor,\n\tCopilotButton,\n\tAttachButton,\n\tMentionButton,\n\tMoreButton,\n\tNumberListButton,\n\tBulletListButton,\n\ttype EntityTextEditor,\n} from 'tasks.v2.component.entity-text';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { ResultModel } from 'tasks.v2.model.results';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nimport { resultsMeta } from '../../results-meta';\n\nimport './result-editor-sheet.css';\n\n// @vue/component\nexport const ResultEditor = {\n\tname: 'TaskResultEditor',\n\tcomponents: {\n\t\tBIcon,\n\t\tUiButton,\n\t\tEntityTextArea,\n\t\tCopilotButton,\n\t\tAttachButton,\n\t\tMentionButton,\n\t\tMoreButton,\n\t\tNumberListButton,\n\t\tBulletListButton,\n\t},\n\tinject: {\n\t\ttaskId: {},\n\t\ttask: {},\n\t\tanalytics: {},\n\t\tcardType: {},\n\t},\n\tprovide(): { fileService: FileService, entityTextEditor: EntityTextEditor }\n\t{\n\t\treturn {\n\t\t\teditor: () => this.editor,\n\t\t\tfileService: () => this.fileService,\n\t\t};\n\t},\n\tprops: {\n\t\tresultId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tcontent: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tisResized: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tshowResize: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['close', 'resize'],\n\tsetup(props): { task: TaskModel, fileService: FileService, entityTextEditor: EntityTextEditor }\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tButtonColor,\n\t\t\tOutline,\n\t\t\tEntityTypes,\n\t\t\tEntityTextTypes,\n\t\t\tfileService: fileService.get(props.resultId, EntityTypes.Result),\n\t\t\tentityTextEditor: entityTextEditor.get(\n\t\t\t\tprops.resultId,\n\t\t\t\tEntityTextTypes.Result,\n\t\t\t\t{\n\t\t\t\t\tcontent: props.content,\n\t\t\t\t\tblockSpaceInline: 'var(--ui-space-stack-xl)',\n\t\t\t\t},\n\t\t\t),\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisSaving: false,\n\t\t\thasChanges: false,\n\t\t\thasFilesChanges: false,\n\t\t\tbuttonDisabled: !Type.isStringFilled(this.content),\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t}),\n\t\tresult(): ResultModel | null\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Results}/getById`](this.resultId);\n\t\t},\n\t\tcurrentUser(): UserModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Users}/getById`](this.currentUserId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.resultId) && this.resultId > 0;\n\t\t},\n\t\tresultDate(): string\n\t\t{\n\t\t\tif (!this.result.createdAtTs)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn calendar.formatDateTime(this.result.createdAtTs);\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\tif (this.isEdit)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_RESULT_TITLE_WITH_DATE', {\n\t\t\t\t\t'#DATE#': this.resultDate,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.loc('TASKS_V2_RESULT_ADD');\n\t\t},\n\t\tbuttonTitle(): string\n\t\t{\n\t\t\treturn this.isEdit\n\t\t\t\t? this.loc('TASKS_V2_RESULT_BUTTON_SAVE')\n\t\t\t\t: this.loc('TASKS_V2_RESULT_BUTTON_SEND')\n\t\t\t;\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\tif (!this.result)\n\t\t\t{\n\t\t\t\treturn !this.task?.rights?.read;\n\t\t\t}\n\n\t\t\treturn !this.result?.rights?.edit;\n\t\t},\n\t\teditor(): TextEditor\n\t\t{\n\t\t\treturn this.entityTextEditor.getEditor();\n\t\t},\n\t\thasEditorChanges(): boolean\n\t\t{\n\t\t\treturn this.hasChanges || this.hasFilesChanges;\n\t\t},\n\t\tresizeIcon(): string\n\t\t{\n\t\t\treturn this.isResized ? Outline.COLLAPSE_L : Outline.EXPAND_L;\n\t\t},\n\t\tisDiskModuleInstalled(): boolean\n\t\t{\n\t\t\treturn Core.getParams().features.disk;\n\t\t},\n\t\tisCopilotEnabled(): boolean\n\t\t{\n\t\t\treturn Core.getParams().features.isCopilotEnabled;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tif (!this.task.filledFields[resultsMeta.id])\n\t\t{\n\t\t\tvoid this.$store.dispatch(`${Model.Tasks}/setFieldFilled`, {\n\t\t\t\tid: this.taskId,\n\t\t\t\tfieldName: resultsMeta.id,\n\t\t\t});\n\t\t}\n\n\t\tif (!Type.isStringFilled(this.content) || this.resultId === 0)\n\t\t{\n\t\t\tsetTimeout(this.focusToEnd, 400);\n\t\t}\n\t},\n\tunmounted(): void\n\t{\n\t\tif (!this.isEdit && !this.isSaving)\n\t\t{\n\t\t\tvoid this.$store.dispatch(`${Model.Results}/delete`, this.resultId);\n\n\t\t\tfileService.delete(this.resultId, EntityTypes.Result);\n\t\t\tentityTextEditor.delete(this.resultId, EntityTextTypes.Result);\n\t\t}\n\t},\n\tmethods: {\n\t\thandleEditButtonClick(): void\n\t\t{\n\t\t\tif (this.isEdit)\n\t\t\t{\n\t\t\t\tthis.handleClose();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.handleAddResult();\n\t\t\t}\n\t\t},\n\t\thandleAddResult(): void\n\t\t{\n\t\t\tthis.isSaving = true;\n\n\t\t\tconst result = {\n\t\t\t\t...this.result,\n\t\t\t\ttext: this.editor.getText(),\n\t\t\t\tauthor: this.currentUser,\n\t\t\t\tstatus: ResultStatus.Open,\n\t\t\t\tcreatedAtTs: Date.now(),\n\t\t\t\tupdatedAtTs: Date.now(),\n\t\t\t};\n\n\t\t\tvoid this.addResult(result);\n\n\t\t\tthis.handleClose();\n\n\t\t\tEvent.EventEmitter.emit(EventName.ResultAdded, { taskId: this.taskId });\n\t\t},\n\t\tasync addResult(result): void\n\t\t{\n\t\t\tconst isSuccess = await resultService.add(this.taskId, result);\n\n\t\t\tthis.sendAnalyticsResultAdd(isSuccess);\n\t\t},\n\t\tsendAnalyticsResultAdd(isSuccess: boolean): void\n\t\t{\n\t\t\tanalytics.sendStatusSummaryAdd(this.analytics, {\n\t\t\t\tisSuccess,\n\t\t\t\tcardType: this.cardType,\n\t\t\t\ttaskId: Type.isNumber(this.taskId) ? this.taskId : 0,\n\t\t\t\telement: Analytics.Element.AddResult,\n\t\t\t\tsubSection: Analytics.SubSection.TaskCard,\n\t\t\t});\n\t\t},\n\t\thandleUpdateResult(): void\n\t\t{\n\t\t\tif (!this.hasEditorChanges)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst fields = {\n\t\t\t\ttext: this.editor.getText(),\n\t\t\t\tupdatedAtTs: Date.now() / 1000,\n\t\t\t\tstatus: ResultStatus.Open,\n\t\t\t};\n\n\t\t\tvoid resultService.update(this.resultId, fields);\n\n\t\t\tthis.hasChanges = false;\n\t\t\tthis.hasFilesChanges = false;\n\n\t\t\tEvent.EventEmitter.emit(EventName.ResultUpdated, { taskId: this.taskId, resultId: this.resultId });\n\t\t},\n\t\thandleEditorChange(): void\n\t\t{\n\t\t\tconst preparedOldText = this.getPreparedText(this.content);\n\t\t\tconst preparedNewText = this.getPreparedText(this.editor?.getText());\n\n\t\t\tthis.hasChanges = preparedOldText !== preparedNewText;\n\t\t\tthis.buttonDisabled = !Type.isStringFilled(preparedNewText);\n\t\t},\n\t\tgetPreparedText(text): string | null\n\t\t{\n\t\t\treturn text\n\t\t\t\t.replaceAll(/\\[p]\\n|\\[p]\\[\\/p]|\\[\\/p]/gi, '')\n\t\t\t\t.trim()\n\t\t\t;\n\t\t},\n\t\tfocusToEnd(): void\n\t\t{\n\t\t\tthis.editor?.focus(null, { defaultSelection: 'rootEnd' });\n\t\t},\n\t\thandleClose(): void\n\t\t{\n\t\t\tif (this.isEdit)\n\t\t\t{\n\t\t\t\tthis.handleUpdateResult();\n\t\t\t}\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-result-editor-wrapper\" ref=\"wrapper\">\n\t\t\t<div class=\"tasks-result-editor-header\" ref=\"resultHeader\">\n\t\t\t\t<div class=\"tasks-result-editor-title\">{{ title }}</div>\n\t\t\t\t<div class=\"tasks-result-editor-field-actions\">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if=\"showResize\"\n\t\t\t\t\t\tclass=\"tasks-result-editor-field-icon\"\n\t\t\t\t\t\t:name=\"resizeIcon\"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\t@click=\"$emit('resize')\"\n\t\t\t\t\t/>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name=\"Outline.CROSS_L\"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\tclass=\"tasks-result-editor-field-icon\"\n\t\t\t\t\t\t@click=\"handleClose\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-result-editor-container\">\n\t\t\t\t<EntityTextArea\n\t\t\t\t\t:entityId=\"resultId\"\n\t\t\t\t\t:entityType=\"EntityTextTypes.Result\"\n\t\t\t\t\t:readonly\n\t\t\t\t\t:removeFromServer=\"!isEdit\"\n\t\t\t\t\tref=\"resultTextArea\"\n\t\t\t\t\t@change=\"handleEditorChange\"\n\t\t\t\t\t@filesChange=\"hasFilesChanges = true\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-if=\"!readonly\" class=\"tasks-result-editor-footer\" ref=\"resultActions\">\n\t\t\t\t<div class=\"tasks-result-editor-action-list\">\n\t\t\t\t\t<AttachButton v-if=\"isDiskModuleInstalled\" :fileService/>\n\t\t\t\t\t<MentionButton :editor/>\n\t\t\t\t\t<BulletListButton :editor/>\n\t\t\t\t\t<NumberListButton :editor/>\n\t\t\t\t\t<MoreButton :editor/>\n\t\t\t\t\t<CopilotButton v-if=\"isCopilotEnabled\" :editor/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-result-editor-footer-buttons\">\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text=\"buttonTitle\"\n\t\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t\t:color=\"ButtonColor.PRIMARY\"\n\t\t\t\t\t\t:disabled=\"buttonDisabled || isSaving\"\n\t\t\t\t\t\t@click=\"handleEditButtonClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport { Core } from 'tasks.v2.core';\nimport { EventName, Model } from 'tasks.v2.const';\nimport { EntityTypes } from 'tasks.v2.provider.service.file-service';\nimport { DropZone } from 'tasks.v2.component.drop-zone';\nimport { BottomSheet } from 'tasks.v2.component.elements.bottom-sheet';\nimport type { ResultModel } from 'tasks.v2.model.results';\n\nimport { ResultEditor } from './result-editor';\n\n// @vue/component\nexport const ResultEditorSheet = {\n\tcomponents: {\n\t\tBottomSheet,\n\t\tDropZone,\n\t\tResultEditor,\n\t},\n\tinject: {\n\t\ttaskId: {},\n\t},\n\tprops: {\n\t\tresultId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tshowResize: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tsheetBindProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['close'],\n\tsetup(): void\n\t{\n\t\treturn {\n\t\t\tEntityTypes,\n\t\t};\n\t},\n\tdata(): void\n\t{\n\t\treturn {\n\t\t\tisResized: false,\n\t\t\tuniqueKey: Text.getRandom(),\n\t\t};\n\t},\n\tcomputed: {\n\t\tresult(): ResultModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Results}/getById`](this.resultId);\n\t\t},\n\t\tbottomSheetContainer(): HTMLElement | null\n\t\t{\n\t\t\treturn document.getElementById(`b24-bottom-sheet-${this.uniqueKey}`) || null;\n\t\t},\n\t\tisDiskModuleInstalled(): boolean\n\t\t{\n\t\t\treturn Core.getParams().features.disk;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tEventEmitter.subscribe(EventName.OpenResultFromChat, this.handleOpenResultFromMessage);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEventEmitter.unsubscribe(EventName.OpenResultFromChat, this.handleOpenResultFromMessage);\n\t},\n\tmethods: {\n\t\thandleOpenResultFromMessage(event: BaseEvent): void\n\t\t{\n\t\t\tconst { taskId } = event.getData();\n\n\t\t\tif (this.taskId === taskId)\n\t\t\t{\n\t\t\t\tthis.$emit('close');\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BottomSheet\n\t\t\t:sheetBindProps\n\t\t\t:isExpanded=\"isResized\"\n\t\t\t:padding=\"0\"\n\t\t\t:popupPadding=\"0\"\n\t\t\t:uniqueKey\n\t\t\t@close=\"$emit('close')\"\n\t\t>\n\t\t\t<ResultEditor\n\t\t\t\t:resultId\n\t\t\t\t:content=\"result.text || ''\"\n\t\t\t\t:isResized\n\t\t\t\t:showResize\n\t\t\t\t@close=\"$emit('close')\"\n\t\t\t\t@resize=\"isResized = !isResized\"\n\t\t\t/>\n\t\t\t<DropZone\n\t\t\t\tv-if=\"isDiskModuleInstalled\"\n\t\t\t\t:container=\"bottomSheetContainer || {}\"\n\t\t\t\t:entityId=\"resultId || 0\"\n\t\t\t\t:entityType=\"EntityTypes.Result\"\n\t\t\t/>\n\t\t</BottomSheet>\n\t`,\n};\n","import { TextLg } from 'ui.system.typography.vue';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport { Button as UiButton, AirButtonStyle, ButtonSize } from 'ui.vue3.components.button';\n\n// @vue/component\nexport const ResultListEmpty = {\n\tname: 'ResultListEmpty',\n\tcomponents: {\n\t\tTextLg,\n\t\tUiButton,\n\t},\n\temits: ['addResult'],\n\tsetup(): void\n\t{\n\t\treturn {\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t\tOutline,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-results-result-list-empty\">\n\t\t\t<div class=\"tasks-field-results-result-list-empty-image\"/>\n\t\t\t<TextLg className=\"tasks-field-results-result-list-empty-title\">\n\t\t\t\t{{ loc('TASKS_V2_RESULT_LIST_EMPTY') }}\n\t\t\t</TextLg>\n\t\t\t<div class=\"tasks-field-results-result-list-empty-button\">\n\t\t\t\t<UiButton\n\t\t\t\t\t:text=\"loc('TASKS_V2_RESULT_ADD')\"\n\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t:style=\"AirButtonStyle.FILLED\"\n\t\t\t\t\t:leftIcon=\"Outline.PLUS_L\"\n\t\t\t\t\t:wide=\"false\"\n\t\t\t\t\t@click=\"$emit('addResult')\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\n\nimport { HeadlineMd } from 'ui.system.typography.vue';\nimport { Button as UiButton, AirButtonStyle, ButtonSize } from 'ui.vue3.components.button';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { EventName, Model } from 'tasks.v2.const';\nimport { BottomSheet } from 'tasks.v2.component.elements.bottom-sheet';\nimport { highlighter } from 'tasks.v2.lib.highlighter';\nimport { resultService } from 'tasks.v2.provider.service.result-service';\nimport type { ResultId } from 'tasks.v2.provider.service.result-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { ResultListItem } from '../result/result-list-item';\nimport { ResultSkeleton } from '../result/result-skeleton';\nimport { ResultEditorSheet } from '../result-editor-sheet/result-editor-sheet';\nimport { ResultListEmpty } from './result-list-empty';\n\nimport './result-list-sheet.css';\n\n// @vue/component\nexport const ResultListSheet = {\n\tcomponents: {\n\t\tBottomSheet,\n\t\tBIcon,\n\t\tUiButton,\n\t\tResultListItem,\n\t\tResultSkeleton,\n\t\tResultEditorSheet,\n\t\tResultListEmpty,\n\t\tHeadlineMd,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t},\n\tprops: {\n\t\tresultId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tsheetBindProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['close'],\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\teditResultId: 0,\n\t\t\tisResultEditorShown: false,\n\t\t\tisResized: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tresults(): ResultId[]\n\t\t{\n\t\t\treturn this.task.results;\n\t\t},\n\t\tloadedResults(): ResultId[]\n\t\t{\n\t\t\treturn this.results.filter((resultId) => this.isResultLoaded(resultId));\n\t\t},\n\t\thasUnloadedResults(): boolean\n\t\t{\n\t\t\treturn this.results.length !== this.loadedResults.length;\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.results.length === 0;\n\t\t},\n\t},\n\twatch: {\n\t\tasync resultId(newResultId: string | number): void\n\t\t{\n\t\t\tawait this.$nextTick();\n\n\t\t\tif (newResultId)\n\t\t\t{\n\t\t\t\tthis.focusTo(newResultId);\n\t\t\t}\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tif (this.hasUnloadedResults)\n\t\t{\n\t\t\tvoid resultService.getAll(this.taskId);\n\t\t}\n\n\t\tthis.focusTo(this.resultId);\n\n\t\tEventEmitter.subscribe(EventName.ResultAdded, this.handleResultAdded);\n\t\tEventEmitter.subscribe(EventName.ResultUpdated, this.handleResultUpdated);\n\t\tEventEmitter.subscribe(EventName.OpenResultFromChat, this.handleOpenResultFromMessage);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEventEmitter.unsubscribe(EventName.ResultAdded, this.handleResultAdded);\n\t\tEventEmitter.unsubscribe(EventName.ResultUpdated, this.handleResultUpdated);\n\t\tEventEmitter.unsubscribe(EventName.OpenResultFromChat, this.handleOpenResultFromMessage);\n\t},\n\tmethods: {\n\t\tisResultLoaded(resultId: string | number): boolean\n\t\t{\n\t\t\treturn Boolean(this.$store.getters[`${Model.Results}/getById`](resultId));\n\t\t},\n\t\tfocusTo(resultId: string | number): void\n\t\t{\n\t\t\tif (!resultId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst scrollContainer = this.$refs.scrollContainer;\n\t\t\tif (!scrollContainer)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { targetId, offset, shouldHighlight } = this.calculateFocusTarget(resultId);\n\n\t\t\tthis.scrollToTarget(targetId, offset, shouldHighlight);\n\t\t},\n\t\tcalculateFocusTarget(resultId: string | number): {\n\t\t\ttargetId: string | number,\n\t\t\toffset: number,\n\t\t\tshouldHighlight: boolean,\n\t\t}\n\t\t{\n\t\t\treturn {\n\t\t\t\ttargetId: resultId,\n\t\t\t\toffset: 80,\n\t\t\t\tshouldHighlight: true,\n\t\t\t};\n\t\t},\n\t\tscrollToTarget(targetId: string | number, offset: number, shouldHighlight: boolean): void\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst targetNode = this.$refs.scrollContainer.querySelector(`[data-result-id=\"${targetId}\"]`);\n\t\t\t\tif (!targetNode)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (shouldHighlight)\n\t\t\t\t{\n\t\t\t\t\tthis.highlightResult(targetId);\n\t\t\t\t}\n\n\t\t\t\tthis.$refs.scrollContainer.scrollTop = targetNode.offsetTop - offset;\n\t\t\t}, 0);\n\t\t},\n\t\thighlightResult(targetId: string | number): void\n\t\t{\n\t\t\tconst highlightElement = this.$refs.scrollContainer.querySelector(`[data-result-id=\"${targetId}\"]`);\n\n\t\t\tif (highlightElement)\n\t\t\t{\n\t\t\t\tvoid highlighter.highlight(highlightElement);\n\t\t\t}\n\t\t},\n\t\topenAddResultSheet(): void\n\t\t{\n\t\t\tthis.editResultId = Text.getRandom();\n\n\t\t\tconst payload = {\n\t\t\t\tid: this.editResultId,\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\tauthor: Core.getParams().currentUser,\n\t\t\t};\n\n\t\t\tvoid this.$store.dispatch(`${Model.Results}/insert`, payload);\n\n\t\t\tthis.isResultEditorShown = true;\n\t\t},\n\t\topenEditResult(resultId: number): void\n\t\t{\n\t\t\tthis.editResultId = resultId;\n\t\t\tthis.isResultEditorShown = true;\n\t\t},\n\t\tcloseResultEditor(): void\n\t\t{\n\t\t\tthis.isResultEditorShown = false;\n\t\t\tthis.editResultId = 0;\n\t\t},\n\t\thandleResultAdded(event: BaseEvent): void\n\t\t{\n\t\t\tconst { taskId } = event.getData();\n\n\t\t\tif (taskId !== this.taskId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t\thandleResultUpdated(event: BaseEvent): void\n\t\t{\n\t\t\tconst { taskId, resultId } = event.getData();\n\n\t\t\tif (taskId !== this.taskId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.focusTo(resultId);\n\t\t},\n\t\thandleOpenResultFromMessage(event: BaseEvent): void\n\t\t{\n\t\t\tconst { taskId, resultId } = event.getData();\n\n\t\t\tif (this.taskId !== taskId || !this.isShown)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.focusTo(resultId);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BottomSheet\n\t\t\t:sheetBindProps\n\t\t\t:isExpanded=\"isResized\"\n\t\t\t:padding=\"0\"\n\t\t\t:popupPadding=\"0\"\n\t\t\t@close=\"$emit('close')\"\n\t\t>\n\t\t\t<div class=\"tasks-field-results-result-list\" ref=\"main\">\n\t\t\t\t<div class=\"tasks-field-results-result-list-close-icon\">\n\t\t\t\t\t<BIcon :name=\"Outline.CROSS_L\" hoverable @click=\"$emit('close')\"/>\n\t\t\t\t</div>\n\t\t\t\t<div  v-if=\"isEmptyState\" class=\"tasks-field-results-result-list-header\">\n\t\t\t\t\t<HeadlineMd className=\"tasks-field-results-result-list-title\">\n\t\t\t\t\t\t{{ loc('TASKS_V2_RESULT_LIST_EMPTY_TITLE') }}\n\t\t\t\t\t</HeadlineMd>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-field-results-result-list-content\" ref=\"scrollContainer\">\n\t\t\t\t\t<ResultListEmpty v-if=\"isEmptyState\" @addResult=\"openAddResultSheet\"/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\tv-for=\"(result, resultIndex) in results\"\n\t\t\t\t\t\t:key=\"result\"\n\t\t\t\t\t\t:data-result-id=\"result\"\n\t\t\t\t\t\tclass=\"tasks-field-results-result-item\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<ResultListItem\n\t\t\t\t\t\t\tv-if=\"isResultLoaded(result)\"\n\t\t\t\t\t\t\t:resultId=\"result\"\n\t\t\t\t\t\t\tlistMode\n\t\t\t\t\t\t\t:showDelimiter=\"resultIndex !== results.length - 1\"\n\t\t\t\t\t\t\t:isResized\n\t\t\t\t\t\t\t@edit=\"openEditResult\"\n\t\t\t\t\t\t\t@resize=\"isResized = !isResized\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ResultSkeleton v-else/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"!isEmptyState\"\n\t\t\t\tclass=\"tasks-field-results-result-add-button\"\n\t\t\t>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text=\"loc('TASKS_V2_RESULT_ADD')\"\n\t\t\t\t\t:style=\"AirButtonStyle.SELECTION\"\n\t\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t\t@click=\"openAddResultSheet\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<ResultEditorSheet\n\t\t\t\tv-if=\"isResultEditorShown\"\n\t\t\t\t:resultId=\"editResultId\"\n\t\t\t\t:sheetBindProps\n\t\t\t\t:showResize=\"false\"\n\t\t\t\t@close=\"closeResultEditor\"\n\t\t\t/>\n\t\t</BottomSheet>\n\t`,\n};\n","import { Loc, Type, Text } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { showLimit } from 'tasks.v2.lib.show-limit';\n\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { hint } from 'ui.vue3.directives.hint';\nimport { BMenu, type MenuOptions, type MenuItemOptions } from 'ui.vue3.components.menu';\nimport { TextMd, TextXs } from 'ui.system.typography.vue';\nimport { BIcon, Animated, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.animated';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { EventName, Model, Option } from 'tasks.v2.const';\nimport { ahaMoments } from 'tasks.v2.lib.aha-moments';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { Hint } from 'tasks.v2.component.elements.hint';\nimport { resultService, type ResultId } from 'tasks.v2.provider.service.result-service';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { stateService } from 'tasks.v2.provider.service.state-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { resultsMeta } from './results-meta';\nimport { ResultCardItem } from './components/result/result-card-item';\nimport { ResultRequiredAha } from './components/result-required-aha/result-required-aha';\nimport { ResultListSheet } from './components/result-list-sheet/result-list-sheet';\nimport { ResultEditorSheet } from './components/result-editor-sheet/result-editor-sheet';\n\nimport './results.css';\n\n// @vue/component\nexport const Results = {\n\tname: 'TaskResults',\n\tcomponents: {\n\t\tBIcon,\n\t\tBMenu,\n\t\tHint,\n\t\tTextMd,\n\t\tTextXs,\n\t\tResultCardItem,\n\t\tResultRequiredAha,\n\t\tResultEditorSheet,\n\t\tResultListSheet,\n\t},\n\tdirectives: { hint },\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t\tisEdit: {},\n\t},\n\tprops: {\n\t\tisSheetShown: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisListSheetShown: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tsheetBindProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tresultsMeta,\n\t\t\tOutline,\n\t\t\tAnimated,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisMenuShown: false,\n\t\t\tisLoading: null,\n\t\t\tshowCreatorResultHint: false,\n\t\t\tshowResponsibleResultHint: false,\n\t\t\tsheetResultId: 0,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tstateFlags: `${Model.Interface}/stateFlags`,\n\t\t}),\n\t\trequireResult(): boolean\n\t\t{\n\t\t\treturn this.task?.requireResult || false;\n\t\t},\n\t\tisCreator(): boolean\n\t\t{\n\t\t\treturn Core.getParams().currentUser.id === this?.task.creatorId;\n\t\t},\n\t\tisResponsible(): boolean\n\t\t{\n\t\t\tconst userId = Core.getParams().currentUser.id;\n\n\t\t\treturn this.task?.responsibleIds?.includes(userId) || this.task?.accomplicesIds.includes(userId);\n\t\t},\n\t\tcontainsResults(): boolean\n\t\t{\n\t\t\treturn this.task.containsResults;\n\t\t},\n\t\tresults(): number[]\n\t\t{\n\t\t\treturn this.task.results || [];\n\t\t},\n\t\thasResults(): boolean\n\t\t{\n\t\t\treturn this.results.length > 0;\n\t\t},\n\t\tshowMore(): boolean\n\t\t{\n\t\t\treturn this.results.length > 1;\n\t\t},\n\t\tlastResultId(): ResultId | null\n\t\t{\n\t\t\treturn this.hasResults ? this.results[0] : null;\n\t\t},\n\t\tmoreText(): number\n\t\t{\n\t\t\tconst count = this.results.length - 1;\n\n\t\t\treturn Loc.getMessagePlural('TASKS_V2_RESULT_SHOW_MORE', count, {\n\t\t\t\t'#COUNT#': count,\n\t\t\t});\n\t\t},\n\t\temptyResultTitle(): string\n\t\t{\n\t\t\treturn this.requireResult\n\t\t\t\t? Loc.getMessage('TASKS_V2_RESULT_TITLE_REQUIRED')\n\t\t\t\t: resultsMeta.title\n\t\t\t;\n\t\t},\n\t\tshowMoreIcon(): boolean\n\t\t{\n\t\t\treturn this.task.rights.edit;\n\t\t},\n\t\tmenuOptions(): MenuOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `result-field-menu-${Text.getRandom()}`,\n\t\t\t\tbindOptions: { forceBindPosition: true },\n\t\t\t\tbindElement: this.$refs.moreIcon.$el,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tminWidth: 240,\n\t\t\t\toffsetLeft: -100,\n\t\t\t\titems: this.menuItems,\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t};\n\t\t},\n\t\tmenuItems(): MenuItemOptions[]\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttitle: this.loc('TASKS_V2_RESULT_ADD'),\n\t\t\t\t\ticon: Outline.PLUS_L,\n\t\t\t\t\tonClick: this.openAddResultSheet,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuResultAdd-${this.taskId}`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.requireResult && {\n\t\t\t\t\ttitle: this.loc('TASKS_V2_RESULT_NOT_REQUIRED'),\n\t\t\t\t\tdesign: 'alert',\n\t\t\t\t\ticon: Outline.CROSS_L,\n\t\t\t\t\tonClick: this.handleUnrequireResult,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuResultNotRequire-${this.taskId}`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t!this.requireResult && {\n\t\t\t\t\ttitle: this.loc('TASKS_V2_RESULT_REQUIRE'),\n\t\t\t\t\ticon: Outline.WINDOW_FLAG,\n\t\t\t\t\tisLocked: this.isLocked,\n\t\t\t\t\tonClick: this.handleRequireResult,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuResultRequire-${this.taskId}`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\tisLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.requiredResult.available;\n\t\t},\n\t\tfeatureId(): string\n\t\t{\n\t\t\treturn Core.getParams().restrictions.requiredResult.featureId;\n\t\t},\n\t},\n\twatch: {\n\t\trequireResult: {\n\t\t\tasync handler(newVal): void\n\t\t\t{\n\t\t\t\tif (newVal)\n\t\t\t\t{\n\t\t\t\t\tawait this.$nextTick();\n\n\t\t\t\t\tthis.tryShowResultHints();\n\t\t\t\t}\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\tasync created(): void\n\t{\n\t\tif (!this.isEdit || !this.containsResults)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isArrayFilled(this.results))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isLoading = true;\n\n\t\tawait resultService.tail(this.taskId);\n\n\t\tthis.isLoading = false;\n\t},\n\tmounted(): void\n\t{\n\t\tthis.tryShowResultHints();\n\n\t\tEventEmitter.subscribe(EventName.ResultAdded, this.handleHighlightFieldAfterEdit);\n\t\tEventEmitter.subscribe(EventName.ResultUpdated, this.handleHighlightFieldAfterEdit);\n\t\tEventEmitter.subscribe(EventName.RequiredResultsMissing, this.showResponsibleHint);\n\t\tEventEmitter.subscribe(EventName.OpenResultFromChat, this.handleOpenResultFromMessage);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEventEmitter.unsubscribe(EventName.ResultAdded, this.handleHighlightFieldAfterEdit);\n\t\tEventEmitter.unsubscribe(EventName.ResultUpdated, this.handleHighlightFieldAfterEdit);\n\t\tEventEmitter.unsubscribe(EventName.RequiredResultsMissing, this.showResponsibleHint);\n\t\tEventEmitter.unsubscribe(EventName.OpenResultFromChat, this.handleOpenResultFromMessage);\n\t},\n\tmethods: {\n\t\topenMore(): void\n\t\t{\n\t\t\tthis.openResultSheet(0);\n\t\t},\n\t\thandleTitleClick(): void\n\t\t{\n\t\t\tif (!this.isLoading)\n\t\t\t{\n\t\t\t\tthis.openAddResultSheet();\n\t\t\t}\n\t\t},\n\t\topenAddResultSheet(): void\n\t\t{\n\t\t\tconst id = Text.getRandom();\n\n\t\t\tconst payload = {\n\t\t\t\tid,\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\tauthor: Core.getParams().currentUser,\n\t\t\t};\n\n\t\t\tvoid this.$store.dispatch(`${Model.Results}/insert`, payload);\n\n\t\t\tthis.openEditSheet(id);\n\t\t},\n\t\thandleResponsibleHintButtonClick(): void\n\t\t{\n\t\t\tthis.handleResponsibleHintClose();\n\t\t\tthis.openAddResultSheet();\n\t\t},\n\t\thandleRequireResult(): void\n\t\t{\n\t\t\tif (this.isLocked)\n\t\t\t{\n\t\t\t\tvoid showLimit({ featureId: this.featureId });\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setRequireResult(true);\n\t\t},\n\t\thandleUnrequireResult(): void\n\t\t{\n\t\t\tthis.setRequireResult(false);\n\t\t},\n\t\tasync setRequireResult(requireResult: boolean): void\n\t\t{\n\t\t\tvoid taskService.update(this.taskId, { requireResult });\n\n\t\t\tif (!this.isEdit)\n\t\t\t{\n\t\t\t\tawait this.$store.dispatch(`${Model.Interface}/updateStateFlags`, { defaultRequireResult: requireResult });\n\n\t\t\t\tvoid stateService.set(this.stateFlags);\n\t\t\t}\n\t\t},\n\t\ttryShowResultHints(): void\n\t\t{\n\t\t\tif (!this.requireResult || this.containsResults)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!this.isEdit\n\t\t\t\t&& ahaMoments.shouldShow(Option.AhaRequiredResultCreatorPopup)\n\t\t\t)\n\t\t\t{\n\t\t\t\tahaMoments.setActive(Option.AhaRequiredResultCreatorPopup);\n\t\t\t\tthis.showCreatorHint();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tthis.isEdit\n\t\t\t\t&& this.isResponsible\n\t\t\t\t&& !this.isCreator\n\t\t\t\t&& ahaMoments.shouldShow(Option.AhaRequiredResultResponsiblePopup)\n\t\t\t)\n\t\t\t{\n\t\t\t\tahaMoments.setActive(Option.AhaRequiredResultResponsiblePopup);\n\n\t\t\t\tsetTimeout((): void => {\n\t\t\t\t\tthis.showResponsibleHint();\n\t\t\t\t}, 2000);\n\t\t\t}\n\t\t},\n\t\tshowCreatorHint(): void\n\t\t{\n\t\t\tthis.showCreatorResultHint = true;\n\t\t\tthis.highlightField();\n\t\t},\n\t\tshowResponsibleHint(): void\n\t\t{\n\t\t\tthis.showResponsibleResultHint = true;\n\t\t\tthis.highlightField();\n\t\t},\n\t\thandleHighlightFieldAfterEdit(event: BaseEvent): void\n\t\t{\n\t\t\tconst { taskId } = event.getData();\n\n\t\t\tif (this.taskId !== taskId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.highlightField();\n\t\t},\n\t\thandleCreatorHintClose(): void\n\t\t{\n\t\t\tif (!this.showCreatorResultHint)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showCreatorResultHint = false;\n\t\t\tahaMoments.setInactive(Option.AhaRequiredResultCreatorPopup);\n\n\t\t\tahaMoments.setShown(Option.AhaRequiredResultCreatorPopup);\n\t\t},\n\t\thandleResponsibleHintClose(): void\n\t\t{\n\t\t\tif (!this.showResponsibleResultHint)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showResponsibleResultHint = false;\n\t\t\tahaMoments.setInactive(Option.AhaRequiredResultResponsiblePopup);\n\n\t\t\tif (ahaMoments.shouldShow(Option.AhaRequiredResultResponsiblePopup))\n\t\t\t{\n\t\t\t\tahaMoments.setShown(Option.AhaRequiredResultResponsiblePopup);\n\t\t\t}\n\t\t},\n\t\thandleOpenResultFromMessage(event: BaseEvent): void\n\t\t{\n\t\t\tconst { taskId, resultId } = event.getData();\n\n\t\t\tif (this.taskId !== taskId || this.isListSheetShown)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.openResultSheet(resultId);\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(resultsMeta.id);\n\t\t},\n\t\tgetRequiredResultAhaWidth(): number\n\t\t{\n\t\t\treturn Type.isNumber(this.$refs?.resultsContainer?.offsetWidth)\n\t\t\t\t? Math.min(this.$refs.resultsContainer.offsetWidth, 530)\n\t\t\t\t: 530\n\t\t\t;\n\t\t},\n\t\topenEditSheet(resultId: ResultId): void\n\t\t{\n\t\t\tthis.sheetResultId = resultId;\n\t\t\tthis.setSheetShown(true);\n\t\t},\n\t\topenResultSheet(resultId: ResultId): void\n\t\t{\n\t\t\tthis.sheetResultId = resultId;\n\t\t\tthis.setListSheetShown(true);\n\t\t},\n\t\tsetSheetShown(isShown: boolean): void\n\t\t{\n\t\t\tthis.$emit('update:isSheetShown', isShown);\n\t\t},\n\t\tsetListSheetShown(isShown: boolean): void\n\t\t{\n\t\t\tthis.$emit('update:isListSheetShown', isShown);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-field-results\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t>\n\t\t\t<template v-if=\"lastResultId\">\n\t\t\t\t<div ref=\"resultsContainer\">\n\t\t\t\t\t<ResultCardItem\n\t\t\t\t\t\t:resultId=\"lastResultId\"\n\t\t\t\t\t\t@titleClick=\"openResultSheet\"\n\t\t\t\t\t\t@add=\"openAddResultSheet\"\n\t\t\t\t\t\t@edit=\"openEditSheet\"\n\t\t\t\t\t\t@highlightField=\"highlightField\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-field-results-more-container\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"showMore\"\n\t\t\t\t\t\tclass=\"tasks-field-results-more\"\n\t\t\t\t\t\t@click=\"openMore\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"tasks-field-results-more-text\">{{ moreText }}</div>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tclass=\"tasks-field-results-title-icon --auto-left\"\n\t\t\t\t\t\t\t:name=\"Outline.CHEVRON_RIGHT_L\"\n\t\t\t\t\t\t\thoverable\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"tasks-field-results-more\"\n\t\t\t\t\t\t:class=\"{ '--border': showMore }\"\n\t\t\t\t\t\t@click=\"openAddResultSheet\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"tasks-field-results-more-text\">{{ loc('TASKS_V2_RESULT_ADD_MORE') }}</div>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tclass=\"tasks-field-results-title-icon --auto-left\"\n\t\t\t\t\t\t\t:name=\"Outline.PLUS_L\"\n\t\t\t\t\t\t\thoverable\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"tasks-field-results-empty-container\"\n\t\t\t\t\t:data-task-field-id=\"resultsMeta.id\"\n\t\t\t\t\tdata-field-container\n\t\t\t\t\tref=\"resultsContainer\"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"tasks-field-results-title\"\n\t\t\t\t\t\t@click=\"handleTitleClick\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"isLoading\"\n\t\t\t\t\t\t\tclass=\"tasks-field-results-title-main\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon :name=\"Animated.LOADER_WAIT\"/>\n\t\t\t\t\t\t\t<TextMd accent>{{ loc('TASKS_V2_RESULT_TITLE_LOADING') }}</TextMd>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"tasks-field-results-title-main\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon :name=\"Outline.WINDOW_FLAG\"/>\n\t\t\t\t\t\t\t<TextMd accent>{{ emptyResultTitle }}</TextMd>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"tasks-field-results-title-actions\">\n\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\tv-if=\"showMoreIcon\"\n\t\t\t\t\t\t\t\tclass=\"tasks-field-results-title-icon\"\n\t\t\t\t\t\t\t\t:name=\"Outline.MORE_L\"\n\t\t\t\t\t\t\t\thoverable\n\t\t\t\t\t\t\t\tref=\"moreIcon\"\n\t\t\t\t\t\t\t\t@click.stop=\"isMenuShown = true\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\t\tclass=\"tasks-field-results-title-icon\"\n\t\t\t\t\t\t\t\t:name=\"Outline.PLUS_L\"\n\t\t\t\t\t\t\t\thoverable\n\t\t\t\t\t\t\t\t:data-task-results-add=\"resultsMeta.id\"\n\t\t\t\t\t\t\t\t@click.stop=\"openAddResultSheet\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<BMenu\n\t\t\t\t\t\tv-if=\"isMenuShown\"\n\t\t\t\t\t\t:options=\"menuOptions\"\n\t\t\t\t\t\t@close=\"isMenuShown = false\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<Hint\n\t\t\t\t\tv-if=\"showCreatorResultHint\"\n\t\t\t\t\t:bindElement=\"$refs.resultsContainer\"\n\t\t\t\t\t:options=\"{ closeIcon: true }\"\n\t\t\t\t\t@close=\"handleCreatorHintClose\"\n\t\t\t\t>\n\t\t\t\t\t{{ loc('TASKS_V2_RESULT_AHA_REQUIRE_RESULT_CREATOR') }}\n\t\t\t\t</Hint>\n\t\t\t</template>\n\t\t\t<ResultRequiredAha\n\t\t\t\tv-if=\"showResponsibleResultHint\"\n\t\t\t\t:bindElement=\"$refs.resultsContainer\"\n\t\t\t\t:popupWidth=\"getRequiredResultAhaWidth()\"\n\t\t\t\t:hasResults\n\t\t\t\t@close=\"handleResponsibleHintClose\"\n\t\t\t\t@addResult=\"handleResponsibleHintButtonClick\"\n\t\t\t/>\n\t\t</div>\n\t\t<ResultEditorSheet\n\t\t\tv-if=\"isSheetShown\"\n\t\t\t:resultId=\"sheetResultId\"\n\t\t\t:sheetBindProps\n\t\t\t@close=\"setSheetShown(false)\"\n\t\t/>\n\t\t<ResultListSheet\n\t\t\tv-if=\"isListSheetShown\"\n\t\t\t:resultId=\"sheetResultId\"\n\t\t\t:sheetBindProps\n\t\t\t@close=\"setListSheetShown(false)\"\n\t\t/>\n\t`,\n};\n","import { Text, Event, Type } from 'main.core';\n\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { BMenu, type MenuOptions, type MenuItemOptions } from 'ui.vue3.components.menu';\nimport { Chip, ChipDesign } from 'ui.system.chip.vue';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { Model, EventName, Analytics } from 'tasks.v2.const';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { showLimit } from 'tasks.v2.lib.show-limit';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { resultService } from 'tasks.v2.provider.service.result-service';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { stateService } from 'tasks.v2.provider.service.state-service';\nimport { UserMappers, type UserDto } from 'tasks.v2.provider.service.user-service';\nimport type { UserModel } from 'tasks.v2.model.users';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { resultsMeta } from './results-meta';\nimport { ResultEditorSheet } from './components/result-editor-sheet/result-editor-sheet';\n\n// @vue/component\nexport const ResultsChip = {\n\tcomponents: {\n\t\tChip,\n\t\tBMenu,\n\t\tResultEditorSheet,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t\tisEdit: {},\n\t\tanalytics: {},\n\t\tcardType: {},\n\t},\n\tprops: {\n\t\tisSheetShown: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tsheetBindProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:isSheetShown'],\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tresultsMeta,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisMenuShown: false,\n\t\t\tsheetResultId: 0,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t\tstateFlags: `${Model.Interface}/stateFlags`,\n\t\t}),\n\t\tdesign(): string\n\t\t{\n\t\t\treturn this.isSelected ? ChipDesign.ShadowAccent : ChipDesign.ShadowNoAccent;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\treturn this.task.filledFields[resultsMeta.id] || this.task.requireResult;\n\t\t},\n\t\tmenuOptions(): MenuOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `result-chip-menu-${Text.getRandom()}`,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\tforceTop: true,\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t\tbindElement: this.$refs.chip.$el,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t\tminWidth: 240,\n\t\t\t\titems: this.menuItems,\n\t\t\t\tautoHide: true,\n\t\t\t\tcloseByEsc: true,\n\t\t\t};\n\t\t},\n\t\tmenuItems(): MenuItemOptions[]\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttitle: this.loc('TASKS_V2_RESULT_ADD'),\n\t\t\t\t\ticon: Outline.PLUS_L,\n\t\t\t\t\tonClick: this.openAddResultSheet,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuResultAdd-${this.taskId}`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: this.loc('TASKS_V2_RESULT_REQUIRE'),\n\t\t\t\t\ticon: Outline.WINDOW_FLAG,\n\t\t\t\t\tonClick: this.requireResult,\n\t\t\t\t\tisLocked: this.isLocked,\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tid: `MenuResultRequire-${this.taskId}`,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t\tisLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.requiredResult.available;\n\t\t},\n\t\tfeatureId(): string\n\t\t{\n\t\t\treturn Core.getParams().restrictions.requiredResult.featureId;\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tEvent.EventEmitter.subscribe(EventName.AddResultFromChat, this.handleAddResultFromChat);\n\t\tEvent.EventEmitter.subscribe(EventName.DeleteResultFromChat, this.handleDeleteResultFromChat);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tEvent.EventEmitter.unsubscribe(EventName.AddResultFromChat, this.handleAddResultFromChat);\n\t\tEvent.EventEmitter.unsubscribe(EventName.DeleteResultFromChat, this.handleDeleteResultFromChat);\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isSelected)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.isEdit && !this.isLocked)\n\t\t\t{\n\t\t\t\tthis.requireResult();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.task.rights.edit)\n\t\t\t{\n\t\t\t\tthis.isMenuShown = true;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.openAddResultSheet();\n\t\t\t}\n\t\t},\n\t\tasync handleAddResultFromChat(event): void\n\t\t{\n\t\t\tconst { taskId, messageId, text, authorId } = event.data;\n\n\t\t\tif (taskId !== this.taskId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst payload = {\n\t\t\t\ttext: Type.isStringFilled(text) ? text : this.loc('TASKS_V2_RESULT_DEFAULT_TITLE_FROM_MESSAGE'),\n\t\t\t\tauthor: this.getUserDto(authorId),\n\t\t\t\tid: Text.getRandom(),\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\tcreatedAtTs: Date.now() / 1000,\n\t\t\t\tupdatedAtTs: Date.now() / 1000,\n\t\t\t\trights: {\n\t\t\t\t\tedit: true,\n\t\t\t\t\tremove: true,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst isSuccess = await resultService.addResultFromMessage(taskId, messageId, payload);\n\n\t\t\tthis.sendAnalyticsResultFromMessageAdd(isSuccess);\n\n\t\t\tif (isSuccess)\n\t\t\t{\n\t\t\t\tEvent.EventEmitter.emit(EventName.ResultFromMessageAdded, { taskId });\n\t\t\t}\n\t\t},\n\t\tsendAnalyticsResultFromMessageAdd(isSuccess: boolean): void\n\t\t{\n\t\t\tanalytics.sendStatusSummaryAdd(this.analytics, {\n\t\t\t\tisSuccess,\n\t\t\t\tcardType: this.cardType,\n\t\t\t\ttaskId: Type.isNumber(this.taskId) ? this.taskId : 0,\n\t\t\t\telement: Analytics.Element.ChatContextMenu,\n\t\t\t\tsubSection: Analytics.SubSection.Chat,\n\t\t\t});\n\t\t},\n\t\thandleDeleteResultFromChat(event): void\n\t\t{\n\t\t\tconst { taskId, resultId } = event.data;\n\n\t\t\tif (taskId !== this.taskId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid resultService.delete(resultId);\n\t\t},\n\t\topenAddResultSheet(): void\n\t\t{\n\t\t\tconst id = Text.getRandom();\n\n\t\t\tconst payload = {\n\t\t\t\tid,\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\tauthor: this.getUser(this.currentUserId),\n\t\t\t};\n\n\t\t\tvoid this.$store.dispatch(`${Model.Results}/insert`, payload);\n\n\t\t\tthis.sheetResultId = id;\n\t\t\tthis.setSheetShown(true);\n\t\t},\n\t\tasync requireResult(): void\n\t\t{\n\t\t\tif (this.isLocked)\n\t\t\t{\n\t\t\t\tvoid showLimit({ featureId: this.featureId });\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid taskService.update(this.taskId, { requireResult: true });\n\n\t\t\tif (!this.isEdit)\n\t\t\t{\n\t\t\t\tawait this.$store.dispatch(`${Model.Interface}/updateStateFlags`, { defaultRequireResult: true });\n\n\t\t\t\tvoid stateService.set(this.stateFlags);\n\t\t\t}\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(resultsMeta.id);\n\t\t},\n\t\tgetUser(userId): UserModel | null\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Users}/getById`](userId);\n\t\t},\n\t\tgetUserDto(userId): UserDto | null\n\t\t{\n\t\t\treturn UserMappers.mapModelToDto(this.getUser(userId));\n\t\t},\n\t\tsetSheetShown(isShown: boolean): void\n\t\t{\n\t\t\tthis.$emit('update:isSheetShown', isShown);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\t:design\n\t\t\t:text=\"resultsMeta.title\"\n\t\t\t:icon=\"Outline.WINDOW_FLAG\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"resultsMeta.id\"\n\t\t\tref=\"chip\"\n\t\t\t@click=\"handleClick\"\n\t\t/>\n\t\t<BMenu v-if=\"isMenuShown\" :options=\"menuOptions\" @close=\"isMenuShown = false\"/>\n\t\t<ResultEditorSheet\n\t\t\tv-if=\"isSheetShown\"\n\t\t\t:resultId=\"sheetResultId\"\n\t\t\t:sheetBindProps\n\t\t\t@close=\"setSheetShown(false)\"\n\t\t/>\n\t`,\n};\n"],"names":["resultsMeta","Object","freeze","id","TaskField","Results","title","Loc","getMessage","ResultCardItem","components","BIcon","BMenu","UserAvatar","UserFieldWidgetComponent","DiskUserFieldWidgetComponent","EntityCollapsibleText","TextSm","TextXs","TextMd","Hint","directives","hint","inject","taskId","props","resultId","type","Number","String","required","emits","setup","fileServiceInstance","fileService","get","EntityTypes","Result","fileServiceRef","shallowRef","uploaderAdapterRef","getAdapter","Outline","UserAvatarSize","uploaderAdapter","data","opened","isMenuShown","showResultFromMessageHint","files","getFiles","computed","result","$store","getters","Model","isEdit","Type","isNumber","resultTitle","loc","resultDate","createdAtTs","calendar","formatDateTime","resultText","text","resultAuthor","author","filesCount","length","widgetOptions","isEmbedded","withControlPanel","canCreateDocuments","tileWidgetOptions","compact","hideDropArea","readonly","enableDropzone","autoCollapse","menuOptions","Text","getRandom","bindOptions","forceBindPosition","bindElement","$refs","moreIcon","$el","targetContainer","document","body","offsetLeft","minWidth","items","menuItems","autoHide","closeByEsc","rights","edit","icon","EDIT_L","onClick","handleEditClick","bind","dataset","remove","design","TRASHCAN","handleDeleteClick","filter","Boolean","hasMenuItems","tooltip","popupOptions","addIcon","offsetWidth","watch","newResultId","$nextTick","collapsible","updateIsOverflowing","mounted","EventEmitter","subscribe","EventName","ResultFromMessageAdded","handleResultFromMessageAdded","beforeUnmount","unsubscribe","methods","$emit","resultService","delete","handleAuthorClick","BX","SidePanel","Instance","emulateAnchorClick","userService","getUrl","event","getData","ahaMoments","shouldShow","Option","AhaResultFromMessagePopup","setActive","handleResultFromMessageHintClose","setInactive","handleResultFromMessageHintCloseComplete","setShown","template","ResultRequiredAha","UiButton","HeadlineSm","popupWidth","default","hasResults","AirButtonStyle","ButtonSize","description","ResultListItem","name","showDelimiter","isResized","isSticky","scrollContainer","mutationObserver","resizeIcon","COLLAPSE_L","EXPAND_L","closest","Event","handleScroll","checkSticky","MutationObserver","observe","childList","subtree","unbind","disconnect","handleResizeClick","itemRect","getBoundingClientRect","containerRect","top","height","ResultSkeleton","BLine","ResultEditor","EntityTextArea","CopilotButton","AttachButton","MentionButton","MoreButton","NumberListButton","BulletListButton","task","analytics","cardType","provide","editor","content","showResize","ButtonColor","EntityTextTypes","entityTextEditor","blockSpaceInline","isSaving","hasChanges","hasFilesChanges","buttonDisabled","isStringFilled","mapGetters","currentUserId","Interface","currentUser","Users","buttonTitle","read","getEditor","hasEditorChanges","isDiskModuleInstalled","Core","getParams","features","disk","isCopilotEnabled","filledFields","dispatch","Tasks","fieldName","setTimeout","focusToEnd","unmounted","handleEditButtonClick","handleClose","handleAddResult","getText","status","ResultStatus","Open","Date","now","updatedAtTs","addResult","emit","ResultAdded","isSuccess","add","sendAnalyticsResultAdd","sendStatusSummaryAdd","element","Analytics","Element","AddResult","subSection","SubSection","TaskCard","handleUpdateResult","fields","update","ResultUpdated","handleEditorChange","preparedOldText","getPreparedText","preparedNewText","replaceAll","trim","focus","defaultSelection","ResultEditorSheet","BottomSheet","DropZone","sheetBindProps","uniqueKey","bottomSheetContainer","getElementById","OpenResultFromChat","handleOpenResultFromMessage","ResultListEmpty","TextLg","ResultListSheet","HeadlineMd","editResultId","isResultEditorShown","results","loadedResults","isResultLoaded","hasUnloadedResults","isEmptyState","focusTo","getAll","handleResultAdded","handleResultUpdated","targetId","offset","shouldHighlight","calculateFocusTarget","scrollToTarget","targetNode","querySelector","highlightResult","scrollTop","offsetTop","highlightElement","highlighter","highlight","openAddResultSheet","payload","openEditResult","closeResultEditor","isShown","isSheetShown","isListSheetShown","Animated","isLoading","showCreatorResultHint","showResponsibleResultHint","sheetResultId","stateFlags","requireResult","isCreator","creatorId","isResponsible","userId","responsibleIds","includes","accomplicesIds","containsResults","showMore","lastResultId","moreText","count","getMessagePlural","emptyResultTitle","showMoreIcon","PLUS_L","CROSS_L","handleUnrequireResult","WINDOW_FLAG","isLocked","handleRequireResult","restrictions","requiredResult","available","featureId","handler","newVal","tryShowResultHints","deep","created","isArrayFilled","tail","handleHighlightFieldAfterEdit","RequiredResultsMissing","showResponsibleHint","openMore","openResultSheet","handleTitleClick","openEditSheet","handleResponsibleHintButtonClick","handleResponsibleHintClose","showLimit","setRequireResult","taskService","defaultRequireResult","stateService","set","AhaRequiredResultCreatorPopup","showCreatorHint","AhaRequiredResultResponsiblePopup","highlightField","handleCreatorHintClose","fieldHighlighter","setContainer","$root","getRequiredResultAhaWidth","resultsContainer","Math","min","setSheetShown","setListSheetShown","ResultsChip","Chip","isSelected","ChipDesign","ShadowAccent","ShadowNoAccent","forceTop","position","chip","AddResultFromChat","handleAddResultFromChat","DeleteResultFromChat","handleDeleteResultFromChat","handleClick","messageId","authorId","getUserDto","addResultFromMessage","sendAnalyticsResultFromMessageAdd","ChatContextMenu","Chat","getUser","UserMappers","mapModelToDto"],"mappings":"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"}