this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};(function(t,e,s,i,a,l,n,o,r,d,c,p,u,h,v,b,k,m,C,f,P,y,B,T,g,F,I,H,L,E,S,A,w){"use strict";const O={components:{Hint:L.Hint,UiButton:F.Button},inject:{analytics:{},task:{},taskId:{}},props:{isOpening:{type:Boolean,required:true}},emits:["update:isOpening"],setup(){return{AirButtonStyle:F.AirButtonStyle,ButtonSize:F.ButtonSize}},data(){return{isHintShown:false,hintBindElement:null,showAuditorsHint:false,auditorsHintBindElement:null}},computed:{checkLists(){return this.$store.getters[`${H.Model.CheckList}/getByIds`](this.task.checklist)},isDisabled(){return this.isUploading||this.isCheckListUploading},isUploading(){return w.fileService.get(this.taskId).isUploading()},isCheckListUploading(){var t;return(t=this.task.checklist)==null?void 0:t.some((t=>w.fileService.get(t,w.EntityTypes.CheckListItem).isUploading()))},hasAuditors(){var t;return Array.isArray((t=this.task)==null?void 0:t.auditorsIds)&&this.task.auditorsIds.length>0},auditorsHintOptions(){return{closeIcon:true,offsetLeft:-60,angle:{offset:140},bindOptions:{forceBindPosition:true,forceTop:true,position:"top"}}}},mounted(){if(this.hasAuditors&&A.ahaMoments.shouldShow(H.Option.AhaAuditorsInCompactFormPopup)){A.ahaMoments.setActive(H.Option.AhaAuditorsInCompactFormPopup);this.$nextTick((()=>{this.auditorsHintBindElement=this.$refs.fullCardButtonContainer;this.showAuditorsHint=true}))}},methods:{handleClick(){if(this.isUploading){this.highlightFiles()}else if(this.isCheckListUploading){this.highlightChecklist()}else{this.openFullCard()}},highlightFiles(){this.hintBindElement=E.fieldHighlighter.setContainer(this.$root.$el).addChipHighlight(H.TaskField.Files).getChipContainer(H.TaskField.Files);this.showHint()},highlightChecklist(){this.hintBindElement=E.fieldHighlighter.setContainer(this.$root.$el).addChipHighlight(H.TaskField.CheckList).getChipContainer(H.TaskField.CheckList);this.showHint()},showHint(){const t=()=>{this.isHintShown=false;g.Event.unbind(window,"keydown",t)};g.Event.bind(window,"keydown",t);this.isHintShown=true},openFullCard(){if(this.isOpening){return}this.$emit("update:isOpening",true);const t=I.Core.getParams().features;S.analytics.sendOpenFullCard(this.analytics);const e=t.isV2Enabled||g.Type.isArray(t.allowedGroups)&&t.allowedGroups.includes(this.task.groupId);if(e){g.Event.EventEmitter.emit(`${H.EventName.OpenFullCard}:${this.taskId}`,this.taskId)}else{g.Event.EventEmitter.emit(`${H.EventName.OpenSliderCard}:${this.taskId}`,{task:this.task,checkLists:this.checkLists})}},closeAuditorsHint(){this.showAuditorsHint=false;A.ahaMoments.setInactive(H.Option.AhaAuditorsInCompactFormPopup)},handleAuditorsHintLinkClick(){A.ahaMoments.setShown(H.Option.AhaAuditorsInCompactFormPopup);this.closeAuditorsHint()}},template:`\n\t\t<div\n\t\t\tref="fullCardButtonContainer"\n\t\t\tclass="tasks-compact-card-full-button-container"\n\t\t\t:class="{ '--disabled': isDisabled }"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<UiButton\n\t\t\t\tclass="tasks-compact-card-full-button"\n\t\t\t\t:text="loc('TASKS_V2_TCC_FULL_CARD_BTN')"\n\t\t\t\t:size="ButtonSize.SMALL"\n\t\t\t\t:style="AirButtonStyle.PLAIN_NO_ACCENT"\n\t\t\t\t:loading="isOpening"\n\t\t\t\t:dataset="{taskButtonId: 'full'}"\n\t\t\t\t:disabled="isDisabled"\n\t\t\t/>\n\t\t\t<Hint\n\t\t\t\tv-if="showAuditorsHint"\n\t\t\t\t:bindElement="auditorsHintBindElement"\n\t\t\t\t@close="closeAuditorsHint"\n\t\t\t\t:options="auditorsHintOptions"\n\t\t\t>\n\t\t\t\t<div class="tasks-compact-card-full-button-auditors-hint">\n\t\t\t\t\t<div class="tasks-compact-card-full-button-auditors-hint-title">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TCC_AUDITORS_HINT_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-compact-card-full-button-auditors-hint-content">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TCC_AUDITORS_HINT_CONTENT') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-compact-card-full-button-auditors-hint-link"\n\t\t\t\t\t\t@click.stop="handleAuditorsHintLinkClick"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('TASKS_V2_TCC_AUDITORS_HINT_DO_NOT_SHOW_AGAIN') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Hint>\n\t\t</div>\n\t\t<Hint\n\t\t\tv-if="isHintShown"\n\t\t\t:bindElement="hintBindElement"\n\t\t\t@close="isHintShown = false"\n\t\t>\n\t\t\t{{ loc('TASKS_V2_TCC_FILE_IS_UPLOADING') }}\n\t\t</Hint>\n\t`};const $={name:"TaskCompactCard",components:{BIcon:d.BIcon,FieldTitle:u.Title,DescriptionInline:v.DescriptionInline,Importance:h.Importance,FieldList:b.FieldList,UiButton:F.Button,AddTaskButton:p.AddTaskButton,CheckList:f.CheckList,FullCardButton:O,DropZone:k.DropZone},mixins:[r.DragOverMixin],provide(){return{analytics:this.analytics,cardType:H.CardType.Compact,task:l.computed((()=>T.taskService.getStoreTask(this.taskId))),taskId:l.computed((()=>this.taskId)),isEdit:l.computed((()=>false)),isTemplate:l.computed((()=>B.idUtils.isTemplate(this.taskId)))}},props:{id:{type:[Number,String],required:true},initialTask:{type:Object,required:true},analytics:{type:Object,default:()=>({})}},setup(){return{ButtonSize:F.ButtonSize,AirButtonStyle:F.AirButtonStyle,Outline:d.Outline,EntityTypes:w.EntityTypes}},data(){return{taskId:this.id,openingFullCard:false,isCheckListPopupShown:false,creationError:false,popupCount:0,isHovered:false}},computed:{...n.mapGetters({titleFieldOffsetHeight:`${H.Model.Interface}/titleFieldOffsetHeight`,currentUserId:`${H.Model.Interface}/currentUserId`,defaultDeadlineTs:`${H.Model.Interface}/defaultDeadlineTs`,stateFlags:`${H.Model.Interface}/stateFlags`}),task(){return T.taskService.getStoreTask(this.taskId)},isTemplate(){return B.idUtils.isTemplate(this.taskId)},group(){return this.$store.getters[`${H.Model.Groups}/getById`](this.task.groupId)},checklist(){if(!this.task.checklist){return[]}return this.$store.getters[`${H.Model.CheckList}/getByIds`](this.task.checklist)},fields(){return[{title:m.responsibleMeta.getTitle(false),component:m.Responsible,props:{taskId:this.taskId,isSingle:true}},{title:C.deadlineMeta.title,component:C.Deadline,props:{taskId:this.taskId,isTemplate:this.isTemplate,isAutonomous:true,isHovered:this.isHovered}},I.Core.getParams().features.disk&&{chip:{component:P.FilesChip,props:{taskId:this.taskId}}},{chip:{component:f.CheckListChip,events:{showCheckList:this.showCheckListPopup}}},I.Core.getParams().features.isProjectsEnabled&&{chip:{component:y.GroupChip}}].filter((t=>t))},primaryFields(){return this.getFields(new WeakMap([[m.Responsible,true],[C.Deadline,true]]))},chips(){return this.fields.filter((({chip:t})=>t)).map((({chip:t})=>t))},isDiskModuleInstalled(){return I.Core.getParams().features.disk}},created(){var t,e,s,i,a;this.insert({...this.initialTask,id:this.taskId,creatorId:this.currentUserId,responsibleIds:[this.currentUserId],deadlineTs:(t=this.initialTask.deadlineTs)!=null?t:this.defaultDeadlineTs,needsControl:(e=this.stateFlags.needsControl)!=null?e:null,matchesWorkTime:(s=this.stateFlags.matchesWorkTime)!=null?s:null,requireResult:(i=this.stateFlags.defaultRequireResult)!=null?i:false});if(((a=this.task.fileIds)==null?void 0:a.length)>0){void w.fileService.get(this.taskId).list(this.task.fileIds)}if(this.analytics.context){var l,n,o,r,d,c,p;S.analytics.sendClickCreate(this.analytics,{collabId:((l=this.group)==null?void 0:l.type)===H.GroupType.Collab?this.group.id:null,cardType:H.CardType.Compact,viewersCount:(n=(o=this.initialTask)==null?void 0:(r=o.auditorsIds)==null?void 0:r.length)!=null?n:0,coexecutorsCount:(d=(c=this.initialTask)==null?void 0:(p=c.accomplicesIds)==null?void 0:p.length)!=null?d:0})}},mounted(){this.resizeObserver=new ResizeObserver((async t=>{const e=t.find((({target:t})=>t===this.$refs.title));if(e){await this.updateTitleFieldOffsetHeight(e.contentRect.height)}}));this.resizeObserver.observe(this.$refs.title);this.subscribeEvents()},beforeUnmount(){var t;(t=this.resizeObserver)==null?void 0:t.disconnect();this.unsubscribeEvents()},unmounted(){if(this.openingFullCard===false){this.destroy()}},methods:{...n.mapActions(H.Model.Tasks,["insert","delete"]),...n.mapActions(H.Model.Interface,["updateTitleFieldOffsetHeight"]),getFields(t){return this.fields.filter((({component:e})=>t.get(e)))},close(){a.EventEmitter.emit(`${H.EventName.CloseCard}:${this.id}`)},async addTask(){var t,e,s;const i=this.checklist;const[l,n]=await T.taskService.add(this.task);if(!l){this.creationError=true;o.Notifier.notifyViaBrowserProvider({id:"task-notify-add-error",text:n.message});this.sendAddTaskAnalytics(false,i);return}this.taskId=l;this.sendAddTaskAnalytics(true,i);S.analytics.sendDescription(this.analytics,{hasDescription:g.Type.isStringFilled((t=this.task)==null?void 0:t.description),hasScroll:(e=this.$refs)==null?void 0:(s=e.description)==null?void 0:s.hasScroll(),cardType:H.CardType.Compact});w.fileService.replace(this.id,l);a.EventEmitter.emit(H.EventName.NotifyGrid,new a.BaseEvent({data:l,compatData:["ADD",{task:this.task,options:{}}]}));this.close()},sendAddTaskAnalytics(t,e){var s;const i=((s=this.group)==null?void 0:s.type)===H.GroupType.Collab?this.group.id:null;const a=this.task.auditorsIds.length;const l=this.task.accomplicesIds.length;if(this.task.templateId){S.analytics.sendAddTask(this.analytics,{isSuccess:t,collabId:i,viewersCount:a,coexecutorsCount:l,event:H.Analytics.Event.PatternTaskCreate,cardType:H.CardType.Compact,taskId:this.taskId})}else if(this.task.parentId){S.analytics.sendAddTask(this.analytics,{isSuccess:t,collabId:i,viewersCount:a,coexecutorsCount:l,event:H.Analytics.Event.SubTaskAdd,cardType:H.CardType.Compact,taskId:this.taskId})}else if(e.length>0){const s=e.filter((({parentId:t})=>t===0)).length;const a=e.filter((({parentId:t})=>t!==0)).length;S.analytics.sendAddTaskWithCheckList(this.analytics,{isSuccess:t,collabId:i,viewersCount:this.task.auditorsIds.length,checklistCount:s,checklistItemsCount:a,cardType:H.CardType.Compact,taskId:this.taskId})}else{S.analytics.sendAddTask(this.analytics,{isSuccess:t,collabId:i,viewersCount:a,coexecutorsCount:l,event:H.Analytics.Event.TaskCreate,cardType:H.CardType.Compact,taskId:this.taskId})}},handleShowingPopup(t){a.EventEmitter.emit(`${H.EventName.ShowOverlay}:${this.taskId}`);a.EventEmitter.emit(`${H.EventName.AdjustPosition}:${this.taskId}`);this.externalPopup=t.popupInstance;this.adjustCardPopup(true)},handleHidingPopup(){a.EventEmitter.emit(`${H.EventName.HideOverlay}:${this.taskId}`);a.EventEmitter.emit(`${H.EventName.AdjustPosition}:${this.taskId}`);this.externalPopup=null},handleResizingPopup(){this.adjustCardPopup()},adjustCardPopup(t=false){if(!this.externalPopup){a.EventEmitter.emit(`${H.EventName.AdjustPosition}:${this.taskId}`);return}a.EventEmitter.emit(`${H.EventName.AdjustPosition}:${this.taskId}`,{titleFieldHeight:this.titleFieldOffsetHeight,innerPopup:this.externalPopup,animate:t})},showCheckListPopup(){this.isCheckListPopupShown=true},closeCheckListPopup(){this.isCheckListPopupShown=false},subscribeEvents(){a.EventEmitter.subscribe("BX.Main.Popup:onShow",this.handlePopupShow);g.Event.bind(document,"keydown",this.handleKeyDown,{capture:true})},unsubscribeEvents(){a.EventEmitter.unsubscribe("BX.Main.Popup:onShow",this.handlePopupShow);g.Event.unbind(document,"keydown",this.handleKeyDown,{capture:true})},handlePopupShow(t){const e=t.getCompatData()[0];const s=()=>{e.unsubscribe("onClose",s);e.unsubscribe("onDestroy",s);this.popupCount--};e.subscribe("onClose",s);e.subscribe("onDestroy",s);this.popupCount++},handleKeyDown(t){if(this.popupCount>0){return}if(t.key==="Enter"&&(t.ctrlKey||t.metaKey)){this.$refs.addTaskButton.handleClick()}else if(t.key==="Escape"){setTimeout((()=>this.close()))}},destroy(){this.delete(this.id);w.fileService.delete(this.id)}},template:`\n\t\t<div v-drop class="tasks-compact-card-container" ref="main">\n\t\t\t<div v-if="task" class="tasks-compact-card" :data-task-id="taskId" data-task-compact>\n\t\t\t\t<div class="tasks-compact-card-fields">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-compact-card-fields-title"\n\t\t\t\t\t\t:class="{'--no-gap': task.description.length > 0}"\n\t\t\t\t\t\tref="title"\n\t\t\t\t\t>\n\t\t\t\t\t\t<FieldTitle :disabled="isCheckListPopupShown"/>\n\t\t\t\t\t\t<Importance/>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tclass="tasks-compact-card-fields-close"\n\t\t\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\t\t\tdata-task-button-id="close"\n\t\t\t\t\t\t\t@click="close"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DescriptionInline ref="description"/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-compact-card-fields-list"\n\t\t\t\t\t\t@mouseover="isHovered = true"\n\t\t\t\t\t\t@mouseleave="isHovered = false"\n\t\t\t\t\t>\n\t\t\t\t\t\t<FieldList :fields="primaryFields"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<CheckList\n\t\t\t\t\t\tv-if="isCheckListPopupShown"\n\t\t\t\t\t\tisAutonomous\n\t\t\t\t\t\t@show="handleShowingPopup"\n\t\t\t\t\t\t@close="handleHidingPopup(); closeCheckListPopup();"\n\t\t\t\t\t\t@resize="handleResizingPopup"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-compact-card-footer">\n\t\t\t\t\t<div class="tasks-compact-card-chips">\n\t\t\t\t\t\t<template v-for="(chip, key) of chips" :key>\n\t\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t\t:is="chip.component"\n\t\t\t\t\t\t\t\tv-bind="{ isAutonomous: true, ...chip.props }"\n\t\t\t\t\t\t\t\tv-on="chip.events ?? {}"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-compact-card-buttons">\n\t\t\t\t\t\t<div class="tasks-compact-card-main-buttons">\n\t\t\t\t\t\t\t<AddTaskButton\n\t\t\t\t\t\t\t\tref="addTaskButton"\n\t\t\t\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t\t\t\tv-model:hasError="creationError"\n\t\t\t\t\t\t\t\t@addTask="addTask"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t\t:text="loc('TASKS_V2_TCC_CANCEL_BTN')"\n\t\t\t\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t\t\t\t\t:dataset="{\n\t\t\t\t\t\t\t\t\ttaskButtonId: 'cancel',\n\t\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t\t@click="close"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<FullCardButton v-model:isOpening="openingFullCard"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<DropZone\n\t\t\t\tv-if="isDiskModuleInstalled && !isCheckListPopupShown"\n\t\t\t\t:container="$refs.main || {}"\n\t\t\t\t:entityId="taskId"\n\t\t\t\t:entityType="EntityTypes.Task"\n\t\t\t\t:bottom="18"\n\t\t\t/>\n\t\t</div>\n\t`};let D=t=>t,X;var V=babelHelpers.classPrivateFieldLooseKey("params");var _=babelHelpers.classPrivateFieldLooseKey("popup");var j=babelHelpers.classPrivateFieldLooseKey("application");var N=babelHelpers.classPrivateFieldLooseKey("handlers");var U=babelHelpers.classPrivateFieldLooseKey("openingFullCard");var M=babelHelpers.classPrivateFieldLooseKey("mountApplication");var K=babelHelpers.classPrivateFieldLooseKey("unmountApplication");var x=babelHelpers.classPrivateFieldLooseKey("subscribe");var R=babelHelpers.classPrivateFieldLooseKey("unsubscribe");var z=babelHelpers.classPrivateFieldLooseKey("openFullCard");var G=babelHelpers.classPrivateFieldLooseKey("openSliderCard");var q=babelHelpers.classPrivateFieldLooseKey("closeCard");var W=babelHelpers.classPrivateFieldLooseKey("showOverlay");var Z=babelHelpers.classPrivateFieldLooseKey("hideOverlay");var J=babelHelpers.classPrivateFieldLooseKey("handleAdjustPosition");var Q=babelHelpers.classPrivateFieldLooseKey("adjustPosition");var Y=babelHelpers.classPrivateFieldLooseKey("handlePopupShow");var tt=babelHelpers.classPrivateFieldLooseKey("getInitialGroupId");class et{constructor(t={}){var e;Object.defineProperty(this,tt,{value:ot});Object.defineProperty(this,Q,{value:nt});Object.defineProperty(this,R,{value:lt});Object.defineProperty(this,x,{value:at});Object.defineProperty(this,K,{value:it});Object.defineProperty(this,M,{value:st});Object.defineProperty(this,V,{writable:true,value:void 0});Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,j,{writable:true,value:void 0});Object.defineProperty(this,N,{writable:true,value:void 0});Object.defineProperty(this,U,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:()=>{babelHelpers.classPrivateFieldLooseBase(this,U)[U]=true;babelHelpers.classPrivateFieldLooseBase(this,q)[q]();s.TaskCard.showFullCard(babelHelpers.classPrivateFieldLooseBase(this,V)[V])}});Object.defineProperty(this,G,{writable:true,value:t=>{var e,s,i;const a=t.getData().task;const l=t.getData().checkLists;const n=T.TaskMappers.mapModelToSliderData(a,l);const o=BX.Uri.addParam(I.Core.getParams().paths.editPath,{SCOPE:"tasks_grid",ta_sec:(e=babelHelpers.classPrivateFieldLooseBase(this,V)[V].analytics)==null?void 0:e.context,ta_sub:(s=babelHelpers.classPrivateFieldLooseBase(this,V)[V].analytics)==null?void 0:s.additionalContext,ta_el:(i=babelHelpers.classPrivateFieldLooseBase(this,V)[V].analytics)==null?void 0:i.element,p1:H.Analytics.Params.IsDemo(S.settings.isDemo),p2:S.settings.userType});BX.SidePanel.Instance.open(o,{requestMethod:"post",requestParams:n,cacheable:false});babelHelpers.classPrivateFieldLooseBase(this,q)[q]()}});Object.defineProperty(this,q,{writable:true,value:()=>{babelHelpers.classPrivateFieldLooseBase(this,_)[_].close()}});Object.defineProperty(this,W,{writable:true,value:()=>{g.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,_)[_].getPopupContainer(),"--overlay")}});Object.defineProperty(this,Z,{writable:true,value:()=>{g.Dom.removeClass(babelHelpers.classPrivateFieldLooseBase(this,_)[_].getPopupContainer(),"--overlay")}});Object.defineProperty(this,J,{writable:true,value:t=>{var e;const{innerPopup:s,titleFieldHeight:i,animate:a}=(e=t==null?void 0:t.getData())!=null?e:{};if(!s){babelHelpers.classPrivateFieldLooseBase(this,_)[_].setOffset({offsetTop:0});babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();return}const l=s.getPopupContainer();const n=babelHelpers.classPrivateFieldLooseBase(this,_)[_].getPopupContainer();const o=l.offsetHeight-n.offsetHeight;const r=20;const d=i+o/2+r*2;g.Dom.style(n,"--overlay-offset-top",`-${d}px`);if(!a){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();g.Dom.style(n,"transition","none");setTimeout((()=>g.Dom.style(n,"transition",null)))}}});Object.defineProperty(this,Y,{writable:true,value:t=>{var e,s;(s=(e=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]).openedPopupsCount)!=null?s:e.openedPopupsCount=0;const i=t.getCompatData()[0];const a=babelHelpers.classPrivateFieldLooseBase(this,_)[_].getPopupContainer();const l=()=>{i.unsubscribe("onClose",l);i.unsubscribe("onDestroy",l);babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].openedPopupsCount--;if(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].openedPopupsCount===0){g.Dom.removeClass(a,"--disable-drag")}};i.subscribe("onClose",l);i.subscribe("onDestroy",l);babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].openedPopupsCount++;g.Dom.addClass(a,"--disable-drag")}});babelHelpers.classPrivateFieldLooseBase(this,V)[V]=t;(e=babelHelpers.classPrivateFieldLooseBase(this,V)[V]).taskId||(e.taskId=g.Text.getRandom());if(babelHelpers.classPrivateFieldLooseBase(this,V)[V].taskId==="template0"){babelHelpers.classPrivateFieldLooseBase(this,V)[V].taskId=B.idUtils.boxTemplate(g.Text.getRandom())}babelHelpers.classPrivateFieldLooseBase(this,V)[V].groupId=babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]()}async mount(t){babelHelpers.classPrivateFieldLooseBase(this,_)[_]=t;await babelHelpers.classPrivateFieldLooseBase(this,M)[M](t.getContentContainer());babelHelpers.classPrivateFieldLooseBase(this,Q)[Q]();babelHelpers.classPrivateFieldLooseBase(this,x)[x]();const e=g.Tag.render(X||(X=D`<div class="tasks-compact-card-popup-drag-handle"/>`));g.Dom.append(e,t.getContentContainer());babelHelpers.classPrivateFieldLooseBase(this,_)[_].setDraggable({element:e,restrict:true})}unmount(){babelHelpers.classPrivateFieldLooseBase(this,K)[K]();babelHelpers.classPrivateFieldLooseBase(this,R)[R]()}}async function st(t){await I.Core.init();const{taskId:s,analytics:i,url:a,closeCompleteUrl:n,...o}=babelHelpers.classPrivateFieldLooseBase(this,V)[V];const r=l.BitrixVue.createApp($,{id:s,initialTask:Object.fromEntries(Object.entries(o).filter((([,t])=>!g.Type.isNil(t)))),analytics:i});r.mixin(e.locMixin);r.use(I.Core.getStore());r.mount(t);babelHelpers.classPrivateFieldLooseBase(this,j)[j]=r}function it(){babelHelpers.classPrivateFieldLooseBase(this,j)[j].unmount();if(!babelHelpers.classPrivateFieldLooseBase(this,U)[U]){a.EventEmitter.emit(H.EventName.CardClosed,babelHelpers.classPrivateFieldLooseBase(this,V)[V])}}function at(){babelHelpers.classPrivateFieldLooseBase(this,N)[N]={[`${H.EventName.CloseCard}:${babelHelpers.classPrivateFieldLooseBase(this,V)[V].taskId}`]:babelHelpers.classPrivateFieldLooseBase(this,q)[q],[`${H.EventName.OpenFullCard}:${babelHelpers.classPrivateFieldLooseBase(this,V)[V].taskId}`]:babelHelpers.classPrivateFieldLooseBase(this,z)[z],[`${H.EventName.OpenSliderCard}:${babelHelpers.classPrivateFieldLooseBase(this,V)[V].taskId}`]:babelHelpers.classPrivateFieldLooseBase(this,G)[G],[`${H.EventName.ShowOverlay}:${babelHelpers.classPrivateFieldLooseBase(this,V)[V].taskId}`]:babelHelpers.classPrivateFieldLooseBase(this,W)[W],[`${H.EventName.HideOverlay}:${babelHelpers.classPrivateFieldLooseBase(this,V)[V].taskId}`]:babelHelpers.classPrivateFieldLooseBase(this,Z)[Z],[`${H.EventName.AdjustPosition}:${babelHelpers.classPrivateFieldLooseBase(this,V)[V].taskId}`]:babelHelpers.classPrivateFieldLooseBase(this,J)[J],"BX.Main.Popup:onShow":babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]};Object.entries(babelHelpers.classPrivateFieldLooseBase(this,N)[N]).forEach((([t,e])=>a.EventEmitter.subscribe(t,e)))}function lt(){Object.entries(babelHelpers.classPrivateFieldLooseBase(this,N)[N]).forEach((([t,e])=>a.EventEmitter.unsubscribe(t,e)))}function nt(){babelHelpers.classPrivateFieldLooseBase(this,_)[_].adjustPosition({forceBindPosition:true})}function ot(){var t,e;if(babelHelpers.classPrivateFieldLooseBase(this,V)[V].groupId&&((t=I.Core.getParams().currentUser)==null?void 0:t.type)===i.UserTypes.Collaber){var s;const t=(s=I.Core.getStore())==null?void 0:s.getters[`${H.Model.Groups}/getById`](babelHelpers.classPrivateFieldLooseBase(this,V)[V].groupId);if(t&&t.type!==H.GroupType.Collab){var a;return(a=I.Core.getParams().defaultCollab)==null?void 0:a.id}}return babelHelpers.classPrivateFieldLooseBase(this,V)[V].groupId||((e=I.Core.getParams().defaultCollab)==null?void 0:e.id)||undefined}t.TaskCompactCard=et})(this.BX.Tasks.V2.Application=this.BX.Tasks.V2.Application||{},BX.Vue3.Mixins,BX.Tasks.V2.Application,BX.Tasks.V2.Model,BX.Event,BX.Vue3,BX.Vue3.Vuex,BX.UI.NotificationManager,BX.UI.Uploader,BX.UI.IconSet,BX,BX.Tasks.V2.Component,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX,BX.Vue3.Components,BX.Tasks.V2,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=task-compact-card.bundle.map.js