this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};(function(e,s,t,a,l,i,r,o,d,b,c){"use strict";let n=e=>e,v;var p=babelHelpers.classPrivateFieldLooseKey("dialogs");var h=babelHelpers.classPrivateFieldLooseKey("meta");var P=babelHelpers.classPrivateFieldLooseKey("taskId");var F=babelHelpers.classPrivateFieldLooseKey("ids");var L=babelHelpers.classPrivateFieldLooseKey("onClose");var u=babelHelpers.classPrivateFieldLooseKey("onUpdate");var B=babelHelpers.classPrivateFieldLooseKey("analytics");var H=babelHelpers.classPrivateFieldLooseKey("createDialog");var T=babelHelpers.classPrivateFieldLooseKey("createFooter");var g=babelHelpers.classPrivateFieldLooseKey("clickCreate");var f=babelHelpers.classPrivateFieldLooseKey("addTaskItems");var y=babelHelpers.classPrivateFieldLooseKey("deleteTaskItems");var k=babelHelpers.classPrivateFieldLooseKey("updateTask");var m=babelHelpers.classPrivateFieldLooseKey("add");var E=babelHelpers.classPrivateFieldLooseKey("selectableItems");var S=babelHelpers.classPrivateFieldLooseKey("items");var I=babelHelpers.classPrivateFieldLooseKey("mapIdsToItemIds");var C=babelHelpers.classPrivateFieldLooseKey("entityId");var K=babelHelpers.classPrivateFieldLooseKey("isTemplate");var O=babelHelpers.classPrivateFieldLooseKey("task");class j{constructor(e){Object.defineProperty(this,O,{get:$,set:void 0});Object.defineProperty(this,K,{get:M,set:void 0});Object.defineProperty(this,C,{get:z,set:void 0});Object.defineProperty(this,I,{value:U});Object.defineProperty(this,S,{get:R,set:void 0});Object.defineProperty(this,E,{get:N,set:void 0});Object.defineProperty(this,m,{value:D});Object.defineProperty(this,k,{value:_});Object.defineProperty(this,y,{value:x});Object.defineProperty(this,f,{value:A});Object.defineProperty(this,g,{value:V});Object.defineProperty(this,T,{value:X});Object.defineProperty(this,H,{value:w});Object.defineProperty(this,p,{writable:true,value:{}});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,L,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,h)[h]=e;s.EventEmitter.subscribe(b.EventName.TaskAdded,(e=>{const s=e.getData().task;babelHelpers.classPrivateFieldLooseBase(this,f)[f]([s.id])}));s.EventEmitter.subscribe(b.EventName.TaskDeleted,(e=>{const s=e.getData();babelHelpers.classPrivateFieldLooseBase(this,y)[y]([s.id])}))}show(e){babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e.ids;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e.taskId;babelHelpers.classPrivateFieldLooseBase(this,L)[L]=e.onClose;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e.onUpdate;babelHelpers.classPrivateFieldLooseBase(this,B)[B]=e.analytics;if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F]&&!babelHelpers.classPrivateFieldLooseBase(this,h)[h].service.areIdsLoaded(babelHelpers.classPrivateFieldLooseBase(this,P)[P])){return}if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F]&&this.dialog.isLoaded()){babelHelpers.classPrivateFieldLooseBase(this,f)[f](babelHelpers.classPrivateFieldLooseBase(this,O)[O][babelHelpers.classPrivateFieldLooseBase(this,h)[h].idsField]);this.dialog.setSelectableByIds(babelHelpers.classPrivateFieldLooseBase(this,E)[E])}this.dialog.selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,S)[S]);this.dialog.getPopup().setTargetContainer(e.targetContainer);this.dialog.showTo(e.targetNode)}get dialog(){var e,s,t;(t=(e=babelHelpers.classPrivateFieldLooseBase(this,p)[p])[s=babelHelpers.classPrivateFieldLooseBase(this,P)[P]])!=null?t:e[s]=babelHelpers.classPrivateFieldLooseBase(this,H)[H]();return babelHelpers.classPrivateFieldLooseBase(this,p)[p][babelHelpers.classPrivateFieldLooseBase(this,P)[P]]}}function w(){return new l.EntitySelectorDialog({context:"tasks-card",multiple:!babelHelpers.classPrivateFieldLooseBase(this,F)[F],enableSearch:true,width:500,entities:[{id:babelHelpers.classPrivateFieldLooseBase(this,C)[C],options:{withFooter:false}}],preselectedItems:babelHelpers.classPrivateFieldLooseBase(this,S)[S],events:{onLoad:()=>{const e=this.dialog.getItems().map((e=>({id:babelHelpers.classPrivateFieldLooseBase(this,K)[K]?r.idUtils.boxTemplate(e.getId()):e.getId(),title:e.getTitle().replace(new RegExp(`\\[${e.getId()}\\]$`),"")})));void a.Core.getStore().dispatch(`${b.Model.Tasks}/setTitles`,e)}},popupOptions:{events:{onClose:()=>{var e,s;(e=(s=babelHelpers.classPrivateFieldLooseBase(this,L))[L])==null?void 0:e.call(s,this.dialog.getSelectedItems());if(this.dialog.isLoaded()&&!babelHelpers.classPrivateFieldLooseBase(this,F)[F]){void babelHelpers.classPrivateFieldLooseBase(this,k)[k]()}}}},footer:babelHelpers.classPrivateFieldLooseBase(this,K)[K]?null:babelHelpers.classPrivateFieldLooseBase(this,T)[T]()})}function X(){const e=d.Tag.render(v||(v=n`
			<span class="ui-selector-footer-link ui-selector-footer-link-add">${0}</span>
		`),babelHelpers.classPrivateFieldLooseBase(this,h)[h].footerText);d.Event.bind(e,"click",babelHelpers.classPrivateFieldLooseBase(this,g)[g].bind(this));return e}function V(){var e,a,l;t.TaskCard.showCompactCard({title:(e=this.dialog.getTagSelector())==null?void 0:e.getTextBoxValue(),groupId:babelHelpers.classPrivateFieldLooseBase(this,O)[O].groupId,[babelHelpers.classPrivateFieldLooseBase(this,h)[h].relationToField]:babelHelpers.classPrivateFieldLooseBase(this,P)[P],analytics:{context:(a=(l=babelHelpers.classPrivateFieldLooseBase(this,B)[B])==null?void 0:l.context)!=null?a:b.Analytics.Section.Tasks,additionalContext:b.Analytics.SubSection.TaskCard,element:b.Analytics.Element.CreateButton}});this.dialog.clearSearch();this.dialog.freeze();const i=()=>{this.dialog.unfreeze();s.EventEmitter.unsubscribe(b.EventName.CardClosed,i);s.EventEmitter.unsubscribe(b.EventName.FullCardClosed,i);if(babelHelpers.classPrivateFieldLooseBase(this,F)[F]){this.dialog.hide()}};s.EventEmitter.subscribe(b.EventName.CardClosed,i);s.EventEmitter.subscribe(b.EventName.FullCardClosed,i)}function A(e){if(!this.dialog||babelHelpers.classPrivateFieldLooseBase(this,K)[K]){return}const s=new Set(this.dialog.getItems().map((e=>e.getId())));e.filter((e=>!s.has(e))).forEach((e=>{const s=o.taskService.getStoreTask(e);this.dialog.addItem({id:e,entityId:b.EntitySelectorEntity.Task,title:s.title,selected:true,sort:0,tabs:["recents"]})}))}function x(e){if(!this.dialog||babelHelpers.classPrivateFieldLooseBase(this,K)[K]){return}e.forEach((e=>this.dialog.removeItem([b.EntitySelectorEntity.Task,e])))}async function _(){const e=babelHelpers.classPrivateFieldLooseBase(this,O)[O][babelHelpers.classPrivateFieldLooseBase(this,h)[h].idsField];const s=this.dialog.getSelectedItems().map((e=>babelHelpers.classPrivateFieldLooseBase(this,K)[K]?r.idUtils.boxTemplate(e.getId()):e.getId()));const t=e.filter((e=>!s.includes(e)));const a=s.filter((s=>!e.includes(s)));if(t.length>0||a.length>0){var l,i;await Promise.all([babelHelpers.classPrivateFieldLooseBase(this,h)[h].service.delete(babelHelpers.classPrivateFieldLooseBase(this,P)[P],t),babelHelpers.classPrivateFieldLooseBase(this,m)[m](a)]);(l=(i=babelHelpers.classPrivateFieldLooseBase(this,u))[u])==null?void 0:l.call(i)}}async function D(e){const s=await babelHelpers.classPrivateFieldLooseBase(this,h)[h].service.add(babelHelpers.classPrivateFieldLooseBase(this,P)[P],e);if(s){void i.relationError.setTaskId(babelHelpers.classPrivateFieldLooseBase(this,P)[P]).showError(s,babelHelpers.classPrivateFieldLooseBase(this,h)[h].id)}}function N(){const e=[];const s=[];babelHelpers.classPrivateFieldLooseBase(this,O)[O][babelHelpers.classPrivateFieldLooseBase(this,h)[h].idsField].forEach((t=>{const a=o.taskService.getStoreTask(t);if(!a||a.rights.detachParent||a.rights.detachRelated){e.push(t)}else{s.push(t)}}));return{selectable:babelHelpers.classPrivateFieldLooseBase(this,I)[I](e),unselectable:babelHelpers.classPrivateFieldLooseBase(this,I)[I](s)}}function R(){var e,s,t;return babelHelpers.classPrivateFieldLooseBase(this,I)[I]((e=(s=babelHelpers.classPrivateFieldLooseBase(this,F)[F])!=null?s:(t=babelHelpers.classPrivateFieldLooseBase(this,O)[O])==null?void 0:t[babelHelpers.classPrivateFieldLooseBase(this,h)[h].idsField])!=null?e:[])}function U(e){return e.map((e=>[babelHelpers.classPrivateFieldLooseBase(this,C)[C],r.idUtils.unbox(e)]))}function z(){return babelHelpers.classPrivateFieldLooseBase(this,K)[K]?b.EntitySelectorEntity.Template:b.EntitySelectorEntity.Task}function M(){return babelHelpers.classPrivateFieldLooseBase(this,h)[h].isTemplate&&r.idUtils.isTemplate(babelHelpers.classPrivateFieldLooseBase(this,P)[P])}function $(){return o.taskService.getStoreTask(babelHelpers.classPrivateFieldLooseBase(this,P)[P])}const G=Object.freeze({id:b.TaskField.SubTasks,idsField:"subTaskIds",relationToField:"parentId",footerText:d.Loc.getMessage("TASKS_V2_SUB_TASKS_CREATE"),service:c.subTasksService,isTemplate:true});const q=Object.freeze({id:b.TaskField.RelatedTasks,idsField:"relatedTaskIds",relationToField:"relatedToTaskId",footerText:d.Loc.getMessage("TASKS_V2_RELATED_TASKS_CREATE"),service:c.relatedTasksService});const J=Object.freeze({footerText:d.Loc.getMessage("TASKS_V2_GANTT_CREATE")});const Q=new j(G);const W=new j(q);const Y=new j(J);e.Item=l.Item;e.subTasksDialog=Q;e.relatedTasksDialog=W;e.ganttDialog=Y})(this.BX.Tasks.V2.Lib=this.BX.Tasks.V2.Lib||{},BX.Event,BX.Tasks.V2.Application,BX.Tasks.V2,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=relation-tasks-dialog.bundle.map.js