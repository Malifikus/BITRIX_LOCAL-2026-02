this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,n,r,o,a,d,u,l,h,p,c,m){"use strict";const I=4;const v={name:"TaskParticipantList",components:{BIcon:o.BIcon,UserAvatarListUsers:h.UserAvatarListUsers,AddButton:u.AddButton,FieldAdd:l.FieldAdd,BMenu:n.BMenu,Popup:r.Popup},props:{taskId:{type:[Number,String],required:true},dataset:{type:Object,required:true},context:{type:String,required:true},usersIds:{type:Array,required:true},canAdd:{type:Boolean,default:true},canRemove:{type:Boolean,default:true},useRemoveAll:{type:Boolean,default:false}},emits:["update"],setup(){return{Outline:o.Outline}},data(){return{menuUserId:null,isDialogShown:false,isPopupShown:false,isHovered:false}},computed:{...i.mapGetters({currentUserId:`${d.Model.Interface}/currentUserId`}),task(){return this.$store.getters[`${d.Model.Tasks}/getById`](this.taskId)},isEdit(){return Number.isInteger(this.taskId)&&this.taskId>0},users(){return this.$store.getters[`${d.Model.Users}/getByIds`](this.usersIds)},withActionMenu(){return e.Type.isNumber(this.taskId)&&this.taskId>0},testId(){return`${this.$options.name}-${this.context}-${this.taskId}`},popupOptions(){return()=>({id:"tasks-participant-list-more-popup",bindElement:this.$refs.more,padding:18,maxWidth:300,maxHeight:window.innerHeight/2-40,offsetTop:8,offsetLeft:-18,targetContainer:document.body})},menuOptions(){var t;const e=this.menuUserId;return{id:"tasks-participant-list-menu-user",bindElement:(t=this.$refs.userList.getNode(e))!=null?t:this.$refs.popupUserList.getNode(e),items:this.getMenuItems(e),offsetTop:8,targetContainer:document.body}},moreFormatted(){return this.loc("TASKS_V2_PARTICIPANT_LIST_MORE_COUNT",{"#COUNT#":this.popupUsers.length})},displayedUsers(){return this.users.slice(0,I-(this.usersLength>I))},popupUsers(){return this.users.slice(I-(this.usersLength>I))},usersLength(){return this.users.length},isRemoveAllActive(){if(!this.canRemove){return false}if(!this.useRemoveAll||this.usersLength<=I){return false}return this.isDialogShown||this.isHovered},isAddVisible(){return this.isDialogShown||this.isHovered},removableUserId(){return this.canAdd?this.currentUserId:0}},watch:{usersLength(){if(this.popupUsers.length===0){this.isPopupShown=false}}},mounted(){c.heightTransition.animate(this.$el);if(!this.isEdit){p.usersDialog.init(this.usersIds)}},updated(){c.heightTransition.animate(this.$el)},methods:{handleClickUser(t){if(!this.canRemove&&this.currentUserId!==t){BX.SidePanel.Instance.emulateAnchorClick(m.userService.getUrl(t));return}if(this.withActionMenu){this.showMenu(t)}else{this.showDialog()}},showMenu(t){if(this.menuUserId!==t){setTimeout((()=>{this.menuUserId=t}))}},showDialog(){this.isDialogShown=true;void p.usersDialog.show({targetNode:this.$refs.anchor,ids:this.usersIds,selectableIds:this.canRemove?null:new Set([this.currentUserId]),onClose:this.handleClose})},handleClose(t){this.isDialogShown=false;if(p.usersDialog.getDialog().isLoaded()){this.updateUsers(t)}},getMenuItems(t){const e=[{title:this.loc("TASKS_V2_PARTICIPANT_LIST_USER_MENU_PROFILE"),icon:o.Outline.PERSON,dataset:{id:`UserMenuProfile-${this.testId}`},onClick:()=>BX.SidePanel.Instance.emulateAnchorClick(m.userService.getUrl(t))}];const i=s.EventEmitter.emit(d.EventName.UserMenuExternalItems,{taskId:this.taskId,userId:t});e.push(...i.flat());e.push({design:n.MenuItemDesign.Alert,title:this.loc("TASKS_V2_PARTICIPANT_LIST_USER_MENU_REMOVE"),icon:o.Outline.TRASHCAN,dataset:{id:`UserMenuRemove-${this.testId}`},onClick:()=>this.removeUser(t)});return e},removeUser(t){this.updateUsers(this.usersIds.filter((e=>e!==t)))},removeAllUsers(){this.updateUsers([])},updateUsers(t){this.$emit("update",t)}},template:`\n\t\t<div v-bind="dataset">\n\t\t\t<div\n\t\t\t\tv-if="usersLength > 0"\n\t\t\t\t@mouseenter="isHovered = true"\n\t\t\t\t@mouseleave="isHovered = false"\n\t\t\t>\n\t\t\t\t<div class="tasks-field-users-container">\n\t\t\t\t\t<AddButton v-if="canAdd" :isVisible="isAddVisible" @click="showDialog"/>\n\t\t\t\t\t<div class="tasks-field-users">\n\t\t\t\t\t\t<UserAvatarListUsers\n\t\t\t\t\t\t\t:users="displayedUsers"\n\t\t\t\t\t\t\t:readonly="!canRemove"\n\t\t\t\t\t\t\t:removableUserId="removableUserId"\n\t\t\t\t\t\t\t:activeUserId="menuUserId"\n\t\t\t\t\t\t\tref="userList"\n\t\t\t\t\t\t\t@onUserClick="(userId) => handleClickUser(userId)"\n\t\t\t\t\t\t\t@onUserCrossClick="(userId) => removeUser(userId)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-field-participant-footer">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="popupUsers.length > 0"\n\t\t\t\t\t\tclass="tasks-field-participant-list-more"\n\t\t\t\t\t\tref="more"\n\t\t\t\t\t\t@click="isPopupShown = true"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ moreFormatted }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isRemoveAllActive"\n\t\t\t\t\t\tclass="tasks-field-participant-remove-all"\n\t\t\t\t\t\t@click="removeAllUsers"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('TASKS_V2_PARTICIPANT_LIST_REMOVE_ALL') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<FieldAdd v-else :icon="Outline.PERSON" @click="showDialog"/>\n\t\t\t<div ref="anchor"></div>\n\t\t</div>\n\t\t<BMenu v-if="menuUserId" :options="menuOptions" @close="menuUserId = null"/>\n\t\t<Popup\n\t\t\tv-if="isPopupShown"\n\t\t\t:options="popupOptions()"\n\t\t\t@close="isPopupShown = false"\n\t\t>\n\t\t\t<div class="tasks-field-users --popup">\n\t\t\t\t<UserAvatarListUsers\n\t\t\t\t\t:users="popupUsers"\n\t\t\t\t\t:readonly="!canRemove"\n\t\t\t\t\t:removableUserId="removableUserId"\n\t\t\t\t\tref="popupUserList"\n\t\t\t\t\t@onUserClick="(userId) => handleClickUser(userId)"\n\t\t\t\t\t@onUserCrossClick="(userId) => removeUser(userId)"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</Popup>\n\t`};t.ParticipantList=v})(this.BX.Tasks.V2.Component.Elements=this.BX.Tasks.V2.Component.Elements||{},BX,BX.Event,BX.Vue3.Vuex,BX.UI.System.Menu,BX.UI.Vue3.Components,BX.UI.IconSet,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=participant-list.bundle.map.js