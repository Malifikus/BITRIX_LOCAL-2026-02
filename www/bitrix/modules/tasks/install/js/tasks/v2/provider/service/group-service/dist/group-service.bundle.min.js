this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Provider=this.BX.Tasks.V2.Provider||{};(function(e,r,s,t,o,a){"use strict";function i(e){var r,s;return{id:e.id,name:e.name,image:(r=e.image)==null?void 0:r.src,type:e.type,stagesIds:(s=e.stages)==null?void 0:s.map((({id:e})=>e))}}function l(e){const s={id:e.id,title:e.title,color:e.color,systemType:e.systemType,sort:e.sort};return Object.fromEntries(Object.entries(s).filter((([,e])=>!r.Type.isNil(e))))}var n=babelHelpers.classPrivateFieldLooseKey("scrumInfoPromises");var c=babelHelpers.classPrivateFieldLooseKey("groupInfoPromises");class p{constructor(){Object.defineProperty(this,n,{writable:true,value:{}});Object.defineProperty(this,c,{writable:true,value:{}})}async getUrl(e,r){if(r!==t.GroupType.Collab){return`/workgroups/group/${e}/`}try{return o.apiClient.post(t.Endpoint.GroupUrlGet,{group:{id:e,type:r}})}catch(e){console.error("GroupService: getUrl error",e);return""}}async getStages(e){try{const r=await o.apiClient.post(t.Endpoint.GroupStageList,{group:{id:e}});const a=r.map((e=>l(e)));const i=a.map((e=>e.id));await Promise.all([s.Core.getStore().dispatch(`${t.Model.Stages}/upsertMany`,a),s.Core.getStore().dispatch(`${t.Model.Groups}/update`,{id:e,fields:{stagesIds:i}})])}catch(e){console.error("GroupService: getStages error",e)}}async getGroup(e){try{const r=await o.apiClient.post(t.Endpoint.GroupGet,{group:{id:e}});const a=i(r);await s.Core.getStore().dispatch(`${t.Model.Groups}/insert`,a);return a}catch(e){console.error("GroupService: getGroup error",e);return null}}async getScrumInfo(e){if(this.hasScrumInfo(e)){await babelHelpers.classPrivateFieldLooseBase(this,n)[n][e];return}babelHelpers.classPrivateFieldLooseBase(this,n)[n][e]=new d;try{var r;const i=await o.apiClient.post(t.Endpoint.ScrumGetTaskInfo,{taskId:e});await Promise.all([s.Core.getStore().dispatch(`${t.Model.Epics}/upsert`,i.epic),a.taskService.updateStoreTask(e,{storyPoints:i.storyPoints,epicId:(r=i.epic)==null?void 0:r.id})]);babelHelpers.classPrivateFieldLooseBase(this,n)[n][e].resolve()}catch(e){console.error("GroupService: getScrumInfo error",e)}}setHasScrumInfo(e){babelHelpers.classPrivateFieldLooseBase(this,n)[n][e]=new d;babelHelpers.classPrivateFieldLooseBase(this,n)[n][e].resolve()}hasScrumInfo(e){return Number.isInteger(e)&&e>0?e in babelHelpers.classPrivateFieldLooseBase(this,n)[n]:true}async getGroupInfo(e){if(babelHelpers.classPrivateFieldLooseBase(this,c)[c][e]){return babelHelpers.classPrivateFieldLooseBase(this,c)[c][e]}babelHelpers.classPrivateFieldLooseBase(this,c)[c][e]=new d;try{var r,s,t;const o=Object.freeze({OwnerData:"OWNER_DATA",DateCreate:"DATE_CREATE",SubjectData:"SUBJECT_DATA",NumberOfMembers:"NUMBER_OF_MEMBERS"});const{data:a}=await BX.ajax.runAction("socialnetwork.api.workgroup.get",{data:{params:{select:Object.values(o),groupId:e}}});babelHelpers.classPrivateFieldLooseBase(this,c)[c][e].resolve({ownerId:(r=a[o.OwnerData])==null?void 0:r.ID,ownerName:(s=a[o.OwnerData])==null?void 0:s.FORMATTED_NAME,dateCreate:a[o.DateCreate],subjectTitle:(t=a[o.SubjectData])==null?void 0:t.NAME,numberOfMembers:a[o.NumberOfMembers]});return babelHelpers.classPrivateFieldLooseBase(this,c)[c][e]}catch(e){console.error("GroupService: getGroupInfo error",e);return{}}}}const u=new p;function d(){const e=new Promise((e=>{this.resolve=e}));e.resolve=this.resolve;return e}const v={mapDtoToModel:i,mapStageDtoToModel:l};e.GroupMappers=v;e.groupService=u})(this.BX.Tasks.V2.Provider.Service=this.BX.Tasks.V2.Provider.Service||{},BX,BX.Tasks.V2,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=group-service.bundle.map.js