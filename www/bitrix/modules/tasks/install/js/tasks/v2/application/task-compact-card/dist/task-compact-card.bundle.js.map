{"version":3,"file":"task-compact-card.bundle.js","sources":["../src/component/full-card-button/full-card-button.js","../src/component/app.js","../src/task-compact-card.js"],"sourcesContent":["import { Event, Type } from 'main.core';\nimport { Button as UiButton, AirButtonStyle, ButtonSize } from 'ui.vue3.components.button';\n\nimport { Core } from 'tasks.v2.core';\nimport { EventName, Model, Option, TaskField } from 'tasks.v2.const';\nimport { Hint } from 'tasks.v2.component.elements.hint';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { ahaMoments } from 'tasks.v2.lib.aha-moments';\nimport { EntityTypes, fileService } from 'tasks.v2.provider.service.file-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\n\nimport './full-card-button.css';\n\n// @vue/component\nexport const FullCardButton = {\n\tcomponents: {\n\t\tHint,\n\t\tUiButton,\n\t},\n\tinject: {\n\t\tanalytics: {},\n\t\ttask: {},\n\t\ttaskId: {},\n\t},\n\tprops: {\n\t\tisOpening: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:isOpening'],\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisHintShown: false,\n\t\t\thintBindElement: null,\n\t\t\tshowAuditorsHint: false,\n\t\t\tauditorsHintBindElement: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\tcheckLists(): CheckListModel[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tisDisabled(): boolean\n\t\t{\n\t\t\treturn this.isUploading || this.isCheckListUploading;\n\t\t},\n\t\tisUploading(): boolean\n\t\t{\n\t\t\treturn fileService.get(this.taskId).isUploading();\n\t\t},\n\t\tisCheckListUploading(): boolean\n\t\t{\n\t\t\treturn this.task.checklist?.some((itemId) => fileService.get(itemId, EntityTypes.CheckListItem).isUploading());\n\t\t},\n\t\thasAuditors(): boolean\n\t\t{\n\t\t\treturn Array.isArray(this.task?.auditorsIds) && this.task.auditorsIds.length > 0;\n\t\t},\n\t\tauditorsHintOptions(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tcloseIcon: true,\n\t\t\t\toffsetLeft: -60,\n\t\t\t\tangle: {\n\t\t\t\t\toffset: 140,\n\t\t\t\t},\n\t\t\t\tbindOptions: {\n\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\tforceTop: true,\n\t\t\t\t\tposition: 'top',\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\t// Show auditors hint if auditorsIds is not empty\n\t\tif (this.hasAuditors && ahaMoments.shouldShow(Option.AhaAuditorsInCompactFormPopup))\n\t\t{\n\t\t\tahaMoments.setActive(Option.AhaAuditorsInCompactFormPopup);\n\t\t\tthis.$nextTick(() => {\n\t\t\t\t// Bind to the button element\n\t\t\t\tthis.auditorsHintBindElement = this.$refs.fullCardButtonContainer;\n\t\t\t\tthis.showAuditorsHint = true;\n\t\t\t});\n\t\t}\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isUploading)\n\t\t\t{\n\t\t\t\tthis.highlightFiles();\n\t\t\t}\n\t\t\telse if (this.isCheckListUploading)\n\t\t\t{\n\t\t\t\tthis.highlightChecklist();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.openFullCard();\n\t\t\t}\n\t\t},\n\t\thighlightFiles(): void\n\t\t{\n\t\t\tthis.hintBindElement = fieldHighlighter\n\t\t\t\t.setContainer(this.$root.$el)\n\t\t\t\t.addChipHighlight(TaskField.Files)\n\t\t\t\t.getChipContainer(TaskField.Files)\n\t\t\t;\n\n\t\t\tthis.showHint();\n\t\t},\n\t\thighlightChecklist(): void\n\t\t{\n\t\t\tthis.hintBindElement = fieldHighlighter\n\t\t\t\t.setContainer(this.$root.$el)\n\t\t\t\t.addChipHighlight(TaskField.CheckList)\n\t\t\t\t.getChipContainer(TaskField.CheckList)\n\t\t\t;\n\n\t\t\tthis.showHint();\n\t\t},\n\t\tshowHint(): void\n\t\t{\n\t\t\tconst removeHighlight = () => {\n\t\t\t\tthis.isHintShown = false;\n\t\t\t\tEvent.unbind(window, 'keydown', removeHighlight);\n\t\t\t};\n\t\t\tEvent.bind(window, 'keydown', removeHighlight);\n\n\t\t\tthis.isHintShown = true;\n\t\t},\n\t\topenFullCard(): void\n\t\t{\n\t\t\tif (this.isOpening)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('update:isOpening', true);\n\n\t\t\tconst features = Core.getParams().features;\n\t\t\tanalytics.sendOpenFullCard(this.analytics);\n\n\t\t\tconst canOpenFullCard = (\n\t\t\t\tfeatures.isV2Enabled\n\t\t\t\t|| (\n\t\t\t\t\tType.isArray(features.allowedGroups)\n\t\t\t\t\t&& features.allowedGroups.includes(this.task.groupId)\n\t\t\t\t)\n\t\t\t);\n\n\t\t\tif (canOpenFullCard)\n\t\t\t{\n\t\t\t\tEvent.EventEmitter.emit(`${EventName.OpenFullCard}:${this.taskId}`, this.taskId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tEvent.EventEmitter.emit(`${EventName.OpenSliderCard}:${this.taskId}`, {\n\t\t\t\t\ttask: this.task,\n\t\t\t\t\tcheckLists: this.checkLists,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tcloseAuditorsHint()\n\t\t{\n\t\t\tthis.showAuditorsHint = false;\n\t\t\tahaMoments.setInactive(Option.AhaAuditorsInCompactFormPopup);\n\t\t},\n\t\thandleAuditorsHintLinkClick()\n\t\t{\n\t\t\tahaMoments.setShown(Option.AhaAuditorsInCompactFormPopup);\n\t\t\tthis.closeAuditorsHint();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tref=\"fullCardButtonContainer\"\n\t\t\tclass=\"tasks-compact-card-full-button-container\"\n\t\t\t:class=\"{ '--disabled': isDisabled }\"\n\t\t\t@click=\"handleClick\"\n\t\t>\n\t\t\t<UiButton\n\t\t\t\tclass=\"tasks-compact-card-full-button\"\n\t\t\t\t:text=\"loc('TASKS_V2_TCC_FULL_CARD_BTN')\"\n\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t:style=\"AirButtonStyle.PLAIN_NO_ACCENT\"\n\t\t\t\t:loading=\"isOpening\"\n\t\t\t\t:dataset=\"{taskButtonId: 'full'}\"\n\t\t\t\t:disabled=\"isDisabled\"\n\t\t\t/>\n\t\t\t<Hint\n\t\t\t\tv-if=\"showAuditorsHint\"\n\t\t\t\t:bindElement=\"auditorsHintBindElement\"\n\t\t\t\t@close=\"closeAuditorsHint\"\n\t\t\t\t:options=\"auditorsHintOptions\"\n\t\t\t>\n\t\t\t\t<div class=\"tasks-compact-card-full-button-auditors-hint\">\n\t\t\t\t\t<div class=\"tasks-compact-card-full-button-auditors-hint-title\">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TCC_AUDITORS_HINT_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-compact-card-full-button-auditors-hint-content\">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TCC_AUDITORS_HINT_CONTENT') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"tasks-compact-card-full-button-auditors-hint-link\"\n\t\t\t\t\t\t@click.stop=\"handleAuditorsHintLinkClick\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('TASKS_V2_TCC_AUDITORS_HINT_DO_NOT_SHOW_AGAIN') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Hint>\n\t\t</div>\n\t\t<Hint\n\t\t\tv-if=\"isHintShown\"\n\t\t\t:bindElement=\"hintBindElement\"\n\t\t\t@close=\"isHintShown = false\"\n\t\t>\n\t\t\t{{ loc('TASKS_V2_TCC_FILE_IS_UPLOADING') }}\n\t\t</Hint>\n\t`,\n};\n","import { Event, Type } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\nimport type { Popup } from 'main.popup';\n\nimport { computed } from 'ui.vue3';\nimport { mapActions, mapGetters } from 'ui.vue3.vuex';\nimport { Notifier } from 'ui.notification-manager';\nimport { DragOverMixin } from 'ui.uploader.tile-widget';\nimport { Button as UiButton, AirButtonStyle, ButtonSize } from 'ui.vue3.components.button';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { EventName, Model, CardType, GroupType, Analytics } from 'tasks.v2.const';\nimport { AddTaskButton } from 'tasks.v2.component.add-task-button';\nimport { Title as FieldTitle } from 'tasks.v2.component.fields.title';\nimport { Importance } from 'tasks.v2.component.fields.importance';\nimport { DescriptionInline } from 'tasks.v2.component.fields.description';\nimport { FieldList } from 'tasks.v2.component.elements.field-list';\nimport { DropZone } from 'tasks.v2.component.drop-zone';\nimport { Responsible, responsibleMeta } from 'tasks.v2.component.fields.responsible';\nimport { Deadline, deadlineMeta } from 'tasks.v2.component.fields.deadline';\nimport { CheckListChip, CheckList } from 'tasks.v2.component.fields.check-list';\nimport { FilesChip } from 'tasks.v2.component.fields.files';\nimport { GroupChip } from 'tasks.v2.component.fields.group';\n\nimport { idUtils } from 'tasks.v2.lib.id-utils';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { fileService, EntityTypes } from 'tasks.v2.provider.service.file-service';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { GroupModel } from 'tasks.v2.model.groups';\nimport type { CheckListModel } from 'tasks.v2.model.check-list';\nimport type { AppField, AppChip } from 'tasks.v2.application.task-card';\n\nimport { FullCardButton } from './full-card-button/full-card-button';\nimport './app.css';\n\n// @vue/component\nexport const App = {\n\tname: 'TaskCompactCard',\n\tcomponents: {\n\t\tBIcon,\n\t\tFieldTitle,\n\t\tDescriptionInline,\n\t\tImportance,\n\t\tFieldList,\n\t\tUiButton,\n\t\tAddTaskButton,\n\t\tCheckList,\n\t\tFullCardButton,\n\t\tDropZone,\n\t},\n\tmixins: [DragOverMixin],\n\tprovide(): Object\n\t{\n\t\treturn {\n\t\t\tanalytics: this.analytics,\n\t\t\tcardType: CardType.Compact,\n\t\t\t/** @type { TaskModel } */\n\t\t\ttask: computed((): TaskModel => taskService.getStoreTask(this.taskId)),\n\t\t\t/** @type { number | string } */\n\t\t\ttaskId: computed((): number | string => this.taskId),\n\t\t\t/** @type { boolean } */\n\t\t\tisEdit: computed((): boolean => false),\n\t\t\t/** @type { boolean } */\n\t\t\tisTemplate: computed((): boolean => idUtils.isTemplate(this.taskId)),\n\t\t};\n\t},\n\tprops: {\n\t\tid: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tinitialTask: {\n\t\t\t/**\n\t\t\t * @type TaskModel\n\t\t\t */\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tanalytics: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({}),\n\t\t},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tButtonSize,\n\t\t\tAirButtonStyle,\n\t\t\tOutline,\n\t\t\tEntityTypes,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\ttaskId: this.id,\n\t\t\topeningFullCard: false,\n\t\t\tisCheckListPopupShown: false,\n\t\t\tcreationError: false,\n\t\t\tpopupCount: 0,\n\t\t\tisHovered: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\ttitleFieldOffsetHeight: `${Model.Interface}/titleFieldOffsetHeight`,\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t\tdefaultDeadlineTs: `${Model.Interface}/defaultDeadlineTs`,\n\t\t\tstateFlags: `${Model.Interface}/stateFlags`,\n\t\t}),\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn taskService.getStoreTask(this.taskId);\n\t\t},\n\t\tisTemplate(): boolean\n\t\t{\n\t\t\treturn idUtils.isTemplate(this.taskId);\n\t\t},\n\t\tgroup(): GroupModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Groups}/getById`](this.task.groupId);\n\t\t},\n\t\tchecklist(): CheckListModel[]\n\t\t{\n\t\t\tif (!this.task.checklist)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn this.$store.getters[`${Model.CheckList}/getByIds`](this.task.checklist);\n\t\t},\n\t\tfields(): AppField[]\n\t\t{\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\ttitle: responsibleMeta.getTitle(false),\n\t\t\t\t\tcomponent: Responsible,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t\t\tisSingle: true,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: deadlineMeta.title,\n\t\t\t\t\tcomponent: Deadline,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t\t\tisTemplate: this.isTemplate,\n\t\t\t\t\t\tisAutonomous: true,\n\t\t\t\t\t\tisHovered: this.isHovered,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tCore.getParams().features.disk && {\n\t\t\t\t\tchip: {\n\t\t\t\t\t\tcomponent: FilesChip,\n\t\t\t\t\t\tprops: {\n\t\t\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tchip: {\n\t\t\t\t\t\tcomponent: CheckListChip,\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tshowCheckList: this.showCheckListPopup,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tCore.getParams().features.isProjectsEnabled && {\n\t\t\t\t\tchip: {\n\t\t\t\t\t\tcomponent: GroupChip,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t].filter((field) => field);\n\t\t},\n\t\tprimaryFields(): AppField[]\n\t\t{\n\t\t\treturn this.getFields(new WeakMap([\n\t\t\t\t[Responsible, true],\n\t\t\t\t[Deadline, true],\n\t\t\t]));\n\t\t},\n\t\tchips(): AppChip[]\n\t\t{\n\t\t\treturn this.fields.filter(({ chip }) => chip).map(({ chip }) => chip);\n\t\t},\n\t\tisDiskModuleInstalled(): boolean\n\t\t{\n\t\t\treturn Core.getParams().features.disk;\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.insert({\n\t\t\t...this.initialTask,\n\t\t\tid: this.taskId,\n\t\t\tcreatorId: this.currentUserId,\n\t\t\tresponsibleIds: [this.currentUserId],\n\t\t\tdeadlineTs: this.initialTask.deadlineTs ?? this.defaultDeadlineTs,\n\t\t\tneedsControl: this.stateFlags.needsControl ?? null,\n\t\t\tmatchesWorkTime: this.stateFlags.matchesWorkTime ?? null,\n\t\t\trequireResult: this.stateFlags.defaultRequireResult ?? false,\n\t\t});\n\n\t\tif (this.task.fileIds?.length > 0)\n\t\t{\n\t\t\tvoid fileService.get(this.taskId).list(this.task.fileIds);\n\t\t}\n\n\t\tif (this.analytics.context)\n\t\t{\n\t\t\tanalytics.sendClickCreate(this.analytics, {\n\t\t\t\tcollabId: this.group?.type === GroupType.Collab ? this.group.id : null,\n\t\t\t\tcardType: CardType.Compact,\n\t\t\t\tviewersCount: this.initialTask?.auditorsIds?.length ?? 0,\n\t\t\t\tcoexecutorsCount: this.initialTask?.accomplicesIds?.length ?? 0,\n\t\t\t});\n\t\t}\n\t},\n\tmounted(): void\n\t{\n\t\tthis.resizeObserver = new ResizeObserver(async (entries) => {\n\t\t\tconst title = entries.find(({ target }) => target === this.$refs.title);\n\t\t\tif (title)\n\t\t\t{\n\t\t\t\tawait this.updateTitleFieldOffsetHeight(title.contentRect.height);\n\t\t\t}\n\t\t});\n\n\t\tthis.resizeObserver.observe(this.$refs.title);\n\t\tthis.subscribeEvents();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.resizeObserver?.disconnect();\n\t\tthis.unsubscribeEvents();\n\t},\n\tunmounted(): void\n\t{\n\t\tif (this.openingFullCard === false)\n\t\t{\n\t\t\tthis.destroy();\n\t\t}\n\t},\n\tmethods: {\n\t\t...mapActions(Model.Tasks, [\n\t\t\t'insert',\n\t\t\t'delete',\n\t\t]),\n\t\t...mapActions(Model.Interface, [\n\t\t\t'updateTitleFieldOffsetHeight',\n\t\t]),\n\t\tgetFields(map: WeakMap): boolean\n\t\t{\n\t\t\treturn this.fields.filter(({ component }) => map.get(component));\n\t\t},\n\t\tclose(): void\n\t\t{\n\t\t\tEventEmitter.emit(`${EventName.CloseCard}:${this.id}`);\n\t\t},\n\t\tasync addTask(): void\n\t\t{\n\t\t\tconst checklists = this.checklist;\n\n\t\t\tconst [id, error] = await taskService.add(this.task);\n\n\t\t\tif (!id)\n\t\t\t{\n\t\t\t\tthis.creationError = true;\n\n\t\t\t\tNotifier.notifyViaBrowserProvider({\n\t\t\t\t\tid: 'task-notify-add-error',\n\t\t\t\t\ttext: error.message,\n\t\t\t\t});\n\n\t\t\t\tthis.sendAddTaskAnalytics(false, checklists);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.taskId = id;\n\n\t\t\tthis.sendAddTaskAnalytics(true, checklists);\n\n\t\t\tanalytics.sendDescription(this.analytics, {\n\t\t\t\thasDescription: Type.isStringFilled(this.task?.description),\n\t\t\t\thasScroll: this.$refs?.description?.hasScroll(),\n\t\t\t\tcardType: CardType.Compact,\n\t\t\t});\n\n\t\t\tfileService.replace(this.id, id);\n\n\t\t\tEventEmitter.emit(EventName.NotifyGrid, new BaseEvent({\n\t\t\t\tdata: id,\n\t\t\t\tcompatData: [\n\t\t\t\t\t'ADD',\n\t\t\t\t\t{\n\t\t\t\t\t\ttask: this.task,\n\t\t\t\t\t\toptions: {},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t}));\n\n\t\t\tthis.close();\n\t\t},\n\t\tsendAddTaskAnalytics(isSuccess: boolean, checklists: CheckListModel[]): void\n\t\t{\n\t\t\tconst collabId = this.group?.type === GroupType.Collab ? this.group.id : null;\n\t\t\tconst viewersCount = this.task.auditorsIds.length;\n\t\t\tconst coexecutorsCount = this.task.accomplicesIds.length;\n\n\t\t\tif (this.task.templateId)\n\t\t\t{\n\t\t\t\tanalytics.sendAddTask(this.analytics, {\n\t\t\t\t\tisSuccess,\n\t\t\t\t\tcollabId,\n\t\t\t\t\tviewersCount,\n\t\t\t\t\tcoexecutorsCount,\n\t\t\t\t\tevent: Analytics.Event.PatternTaskCreate,\n\t\t\t\t\tcardType: CardType.Compact,\n\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (this.task.parentId)\n\t\t\t{\n\t\t\t\tanalytics.sendAddTask(this.analytics, {\n\t\t\t\t\tisSuccess,\n\t\t\t\t\tcollabId,\n\t\t\t\t\tviewersCount,\n\t\t\t\t\tcoexecutorsCount,\n\t\t\t\t\tevent: Analytics.Event.SubTaskAdd,\n\t\t\t\t\tcardType: CardType.Compact,\n\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (checklists.length > 0)\n\t\t\t{\n\t\t\t\tconst checklistCount = checklists.filter(({ parentId }) => parentId === 0).length;\n\t\t\t\tconst checklistItemsCount = checklists.filter(({ parentId }) => parentId !== 0).length;\n\t\t\t\tanalytics.sendAddTaskWithCheckList(this.analytics, {\n\t\t\t\t\tisSuccess,\n\t\t\t\t\tcollabId,\n\t\t\t\t\tviewersCount: this.task.auditorsIds.length,\n\t\t\t\t\tchecklistCount,\n\t\t\t\t\tchecklistItemsCount,\n\t\t\t\t\tcardType: CardType.Compact,\n\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tanalytics.sendAddTask(this.analytics, {\n\t\t\t\t\tisSuccess,\n\t\t\t\t\tcollabId,\n\t\t\t\t\tviewersCount,\n\t\t\t\t\tcoexecutorsCount,\n\t\t\t\t\tevent: Analytics.Event.TaskCreate,\n\t\t\t\t\tcardType: CardType.Compact,\n\t\t\t\t\ttaskId: this.taskId,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\thandleShowingPopup(event: BaseEvent): void\n\t\t{\n\t\t\tEventEmitter.emit(`${EventName.ShowOverlay}:${this.taskId}`);\n\t\t\tEventEmitter.emit(`${EventName.AdjustPosition}:${this.taskId}`);\n\t\t\tthis.externalPopup = event.popupInstance;\n\t\t\tthis.adjustCardPopup(true);\n\t\t},\n\t\thandleHidingPopup(): void\n\t\t{\n\t\t\tEventEmitter.emit(`${EventName.HideOverlay}:${this.taskId}`);\n\t\t\tEventEmitter.emit(`${EventName.AdjustPosition}:${this.taskId}`);\n\t\t\tthis.externalPopup = null;\n\t\t},\n\t\thandleResizingPopup(): void\n\t\t{\n\t\t\tthis.adjustCardPopup();\n\t\t},\n\t\tadjustCardPopup(animate: boolean = false): void\n\t\t{\n\t\t\tif (!this.externalPopup)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(`${EventName.AdjustPosition}:${this.taskId}`);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(`${EventName.AdjustPosition}:${this.taskId}`, {\n\t\t\t\ttitleFieldHeight: this.titleFieldOffsetHeight,\n\t\t\t\tinnerPopup: this.externalPopup,\n\t\t\t\tanimate,\n\t\t\t});\n\t\t},\n\t\tshowCheckListPopup(): void\n\t\t{\n\t\t\tthis.isCheckListPopupShown = true;\n\t\t},\n\t\tcloseCheckListPopup(): void\n\t\t{\n\t\t\tthis.isCheckListPopupShown = false;\n\t\t},\n\t\tsubscribeEvents(): void\n\t\t{\n\t\t\tEventEmitter.subscribe('BX.Main.Popup:onShow', this.handlePopupShow);\n\t\t\tEvent.bind(document, 'keydown', this.handleKeyDown, { capture: true });\n\t\t},\n\t\tunsubscribeEvents(): void\n\t\t{\n\t\t\tEventEmitter.unsubscribe('BX.Main.Popup:onShow', this.handlePopupShow);\n\t\t\tEvent.unbind(document, 'keydown', this.handleKeyDown, { capture: true });\n\t\t},\n\t\thandlePopupShow(event): void\n\t\t{\n\t\t\tconst popup: Popup = event.getCompatData()[0];\n\n\t\t\tconst onClose = (): void => {\n\t\t\t\tpopup.unsubscribe('onClose', onClose);\n\t\t\t\tpopup.unsubscribe('onDestroy', onClose);\n\n\t\t\t\tthis.popupCount--;\n\t\t\t};\n\n\t\t\tpopup.subscribe('onClose', onClose);\n\t\t\tpopup.subscribe('onDestroy', onClose);\n\n\t\t\tthis.popupCount++;\n\t\t},\n\t\thandleKeyDown(event: KeyboardEvent): void\n\t\t{\n\t\t\tif (this.popupCount > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.key === 'Enter' && (event.ctrlKey || event.metaKey))\n\t\t\t{\n\t\t\t\tthis.$refs.addTaskButton.handleClick();\n\t\t\t}\n\t\t\telse if (event.key === 'Escape')\n\t\t\t{\n\t\t\t\tsetTimeout(() => this.close());\n\t\t\t}\n\t\t},\n\t\tdestroy(): void\n\t\t{\n\t\t\tthis.delete(this.id);\n\t\t\tfileService.delete(this.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-drop class=\"tasks-compact-card-container\" ref=\"main\">\n\t\t\t<div v-if=\"task\" class=\"tasks-compact-card\" :data-task-id=\"taskId\" data-task-compact>\n\t\t\t\t<div class=\"tasks-compact-card-fields\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"tasks-compact-card-fields-title\"\n\t\t\t\t\t\t:class=\"{'--no-gap': task.description.length > 0}\"\n\t\t\t\t\t\tref=\"title\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<FieldTitle :disabled=\"isCheckListPopupShown\"/>\n\t\t\t\t\t\t<Importance/>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tclass=\"tasks-compact-card-fields-close\"\n\t\t\t\t\t\t\t:name=\"Outline.CROSS_L\"\n\t\t\t\t\t\t\tdata-task-button-id=\"close\"\n\t\t\t\t\t\t\t@click=\"close\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<DescriptionInline ref=\"description\"/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"tasks-compact-card-fields-list\"\n\t\t\t\t\t\t@mouseover=\"isHovered = true\"\n\t\t\t\t\t\t@mouseleave=\"isHovered = false\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<FieldList :fields=\"primaryFields\"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<CheckList\n\t\t\t\t\t\tv-if=\"isCheckListPopupShown\"\n\t\t\t\t\t\tisAutonomous\n\t\t\t\t\t\t@show=\"handleShowingPopup\"\n\t\t\t\t\t\t@close=\"handleHidingPopup(); closeCheckListPopup();\"\n\t\t\t\t\t\t@resize=\"handleResizingPopup\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-compact-card-footer\">\n\t\t\t\t\t<div class=\"tasks-compact-card-chips\">\n\t\t\t\t\t\t<template v-for=\"(chip, key) of chips\" :key>\n\t\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t\t:is=\"chip.component\"\n\t\t\t\t\t\t\t\tv-bind=\"{ isAutonomous: true, ...chip.props }\"\n\t\t\t\t\t\t\t\tv-on=\"chip.events ?? {}\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-compact-card-buttons\">\n\t\t\t\t\t\t<div class=\"tasks-compact-card-main-buttons\">\n\t\t\t\t\t\t\t<AddTaskButton\n\t\t\t\t\t\t\t\tref=\"addTaskButton\"\n\t\t\t\t\t\t\t\t:size=\"ButtonSize.LARGE\"\n\t\t\t\t\t\t\t\tv-model:hasError=\"creationError\"\n\t\t\t\t\t\t\t\t@addTask=\"addTask\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t\t:text=\"loc('TASKS_V2_TCC_CANCEL_BTN')\"\n\t\t\t\t\t\t\t\t:size=\"ButtonSize.LARGE\"\n\t\t\t\t\t\t\t\t:style=\"AirButtonStyle.PLAIN\"\n\t\t\t\t\t\t\t\t:dataset=\"{\n\t\t\t\t\t\t\t\t\ttaskButtonId: 'cancel',\n\t\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t\t\t@click=\"close\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<FullCardButton v-model:isOpening=\"openingFullCard\"/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<DropZone\n\t\t\t\tv-if=\"isDiskModuleInstalled && !isCheckListPopupShown\"\n\t\t\t\t:container=\"$refs.main || {}\"\n\t\t\t\t:entityId=\"taskId\"\n\t\t\t\t:entityType=\"EntityTypes.Task\"\n\t\t\t\t:bottom=\"18\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Dom, Tag, Text, Type } from 'main.core';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\nimport type { Popup } from 'main.popup';\n\nimport { BitrixVue, type VueCreateAppResult } from 'ui.vue3';\nimport { locMixin } from 'ui.vue3.mixins.loc-mixin';\n\nimport { settings } from 'tasks.v2.lib.analytics';\nimport { TaskCard, type Params } from 'tasks.v2.application.task-card';\nimport { idUtils } from 'tasks.v2.lib.id-utils';\nimport { TaskMappers } from 'tasks.v2.provider.service.task-service';\nimport { Core } from 'tasks.v2.core';\nimport { EventName, GroupType, Model, Analytics } from 'tasks.v2.const';\nimport { UserTypes } from 'tasks.v2.model.users';\n\nimport { App } from './component/app';\n\nexport class TaskCompactCard\n{\n\t#params: Params;\n\t#popup: Popup;\n\t#application: ?VueCreateAppResult;\n\t#handlers: { [eventName: string]: Function };\n\t#openingFullCard: boolean;\n\n\tconstructor(params: Params = {})\n\t{\n\t\tthis.#params = params;\n\n\t\tthis.#params.taskId ||= Text.getRandom();\n\t\tif (this.#params.taskId === 'template0')\n\t\t{\n\t\t\tthis.#params.taskId = idUtils.boxTemplate(Text.getRandom());\n\t\t}\n\t\tthis.#params.groupId = this.#getInitialGroupId();\n\t}\n\n\tasync mount(popup: Popup): Promise<void>\n\t{\n\t\tthis.#popup = popup;\n\n\t\tawait this.#mountApplication(popup.getContentContainer());\n\n\t\tthis.#adjustPosition();\n\t\tthis.#subscribe();\n\n\t\tconst dragHandle = Tag.render`<div class=\"tasks-compact-card-popup-drag-handle\"/>`;\n\t\tDom.append(dragHandle, popup.getContentContainer());\n\t\tthis.#popup.setDraggable({\n\t\t\telement: dragHandle,\n\t\t\trestrict: true,\n\t\t});\n\t}\n\n\tunmount(): void\n\t{\n\t\tthis.#unmountApplication();\n\n\t\tthis.#unsubscribe();\n\t}\n\n\tasync #mountApplication(container: HTMLElement): Promise<void>\n\t{\n\t\tawait Core.init();\n\n\t\tconst { taskId, analytics, url, closeCompleteUrl, ...initialTask } = this.#params;\n\n\t\tconst application = BitrixVue.createApp(App, {\n\t\t\tid: taskId,\n\t\t\tinitialTask: Object.fromEntries(Object.entries(initialTask).filter(([, value]) => !Type.isNil(value))),\n\t\t\tanalytics,\n\t\t});\n\n\t\tapplication.mixin(locMixin);\n\t\tapplication.use(Core.getStore());\n\t\tapplication.mount(container);\n\n\t\tthis.#application = application;\n\t}\n\n\t#unmountApplication(): void\n\t{\n\t\tthis.#application.unmount();\n\n\t\tif (!this.#openingFullCard)\n\t\t{\n\t\t\tEventEmitter.emit(EventName.CardClosed, this.#params);\n\t\t}\n\t}\n\n\t#subscribe(): void\n\t{\n\t\tthis.#handlers = {\n\t\t\t[`${EventName.CloseCard}:${this.#params.taskId}`]: this.#closeCard,\n\t\t\t[`${EventName.OpenFullCard}:${this.#params.taskId}`]: this.#openFullCard,\n\t\t\t[`${EventName.OpenSliderCard}:${this.#params.taskId}`]: this.#openSliderCard,\n\t\t\t[`${EventName.ShowOverlay}:${this.#params.taskId}`]: this.#showOverlay,\n\t\t\t[`${EventName.HideOverlay}:${this.#params.taskId}`]: this.#hideOverlay,\n\t\t\t[`${EventName.AdjustPosition}:${this.#params.taskId}`]: this.#handleAdjustPosition,\n\t\t\t'BX.Main.Popup:onShow': this.#handlePopupShow,\n\t\t};\n\n\t\tObject.entries(this.#handlers).forEach(([event, handler]) => EventEmitter.subscribe(event, handler));\n\t}\n\n\t#unsubscribe(): void\n\t{\n\t\tObject.entries(this.#handlers).forEach(([event, handler]) => EventEmitter.unsubscribe(event, handler));\n\t}\n\n\t#openFullCard = (): void => {\n\t\tthis.#openingFullCard = true;\n\n\t\tthis.#closeCard();\n\n\t\tTaskCard.showFullCard(this.#params);\n\t};\n\n\t#openSliderCard = (baseEvent: BaseEvent): void => {\n\t\tconst task = baseEvent.getData().task;\n\t\tconst checkLists = baseEvent.getData().checkLists;\n\n\t\tconst data = TaskMappers.mapModelToSliderData(task, checkLists);\n\t\t// Analytic data\n\t\t// ta_sec=tasks&ta_sub=list&ta_el=create_button&p1=isDemo_N&p2=user_intranet\n\t\tconst path = BX.Uri.addParam(Core.getParams().paths.editPath, {\n\t\t\tSCOPE: 'tasks_grid',\n\t\t\tta_sec: this.#params.analytics?.context,\n\t\t\tta_sub: this.#params.analytics?.additionalContext,\n\t\t\tta_el: this.#params.analytics?.element,\n\t\t\tp1: Analytics.Params.IsDemo(settings.isDemo),\n\t\t\tp2: settings.userType,\n\t\t});\n\n\t\tBX.SidePanel.Instance.open(path, {\n\t\t\trequestMethod: 'post',\n\t\t\trequestParams: data,\n\t\t\tcacheable: false,\n\t\t});\n\n\t\tthis.#closeCard();\n\t};\n\n\t#closeCard = (): void => {\n\t\tthis.#popup.close();\n\t};\n\n\t#showOverlay = (): void => {\n\t\tDom.addClass(this.#popup.getPopupContainer(), '--overlay');\n\t};\n\n\t#hideOverlay = (): void => {\n\t\tDom.removeClass(this.#popup.getPopupContainer(), '--overlay');\n\t};\n\n\t#handleAdjustPosition = (baseEvent?: BaseEvent): void => {\n\t\tconst { innerPopup, titleFieldHeight, animate } = baseEvent?.getData() ?? {};\n\t\tif (!innerPopup)\n\t\t{\n\t\t\tthis.#popup.setOffset({\n\t\t\t\toffsetTop: 0,\n\t\t\t});\n\t\t\tthis.#adjustPosition();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst innerPopupContainer = innerPopup.getPopupContainer();\n\t\tconst popupContainer = this.#popup.getPopupContainer();\n\n\t\tconst heightDifference = innerPopupContainer.offsetHeight - popupContainer.offsetHeight;\n\t\tconst popupPaddingTop = 20;\n\t\tconst offset = titleFieldHeight + heightDifference / 2 + popupPaddingTop * 2;\n\n\t\tDom.style(popupContainer, '--overlay-offset-top', `-${offset}px`);\n\t\tif (!animate)\n\t\t{\n\t\t\tthis.#adjustPosition();\n\t\t\tDom.style(popupContainer, 'transition', 'none');\n\t\t\tsetTimeout(() => Dom.style(popupContainer, 'transition', null));\n\t\t}\n\t};\n\n\t#adjustPosition(): void\n\t{\n\t\tthis.#popup.adjustPosition({\n\t\t\tforceBindPosition: true,\n\t\t});\n\t}\n\n\t#handlePopupShow = (event): void => {\n\t\tthis.#handlePopupShow.openedPopupsCount ??= 0;\n\n\t\tconst popup: Popup = event.getCompatData()[0];\n\t\tconst popupContainer = this.#popup.getPopupContainer();\n\n\t\tconst onClose = (): void => {\n\t\t\tpopup.unsubscribe('onClose', onClose);\n\t\t\tpopup.unsubscribe('onDestroy', onClose);\n\n\t\t\tthis.#handlePopupShow.openedPopupsCount--;\n\t\t\tif (this.#handlePopupShow.openedPopupsCount === 0)\n\t\t\t{\n\t\t\t\tDom.removeClass(popupContainer, '--disable-drag');\n\t\t\t}\n\t\t};\n\n\t\tpopup.subscribe('onClose', onClose);\n\t\tpopup.subscribe('onDestroy', onClose);\n\n\t\tthis.#handlePopupShow.openedPopupsCount++;\n\t\tDom.addClass(popupContainer, '--disable-drag');\n\t};\n\n\t#getInitialGroupId(): number | null\n\t{\n\t\tif (this.#params.groupId && Core.getParams().currentUser?.type === UserTypes.Collaber)\n\t\t{\n\t\t\tconst group = Core.getStore()?.getters[`${Model.Groups}/getById`](this.#params.groupId);\n\t\t\tif (group && group.type !== GroupType.Collab)\n\t\t\t{\n\t\t\t\treturn Core.getParams().defaultCollab?.id;\n\t\t\t}\n\t\t}\n\n\t\treturn this.#params.groupId || Core.getParams().defaultCollab?.id || undefined;\n\t}\n}\n"],"names":["FullCardButton","components","Hint","UiButton","inject","analytics","task","taskId","props","isOpening","type","Boolean","required","emits","setup","AirButtonStyle","ButtonSize","data","isHintShown","hintBindElement","showAuditorsHint","auditorsHintBindElement","computed","checkLists","$store","getters","Model","CheckList","checklist","isDisabled","isUploading","isCheckListUploading","fileService","get","some","itemId","EntityTypes","CheckListItem","hasAuditors","Array","isArray","auditorsIds","length","auditorsHintOptions","closeIcon","offsetLeft","angle","offset","bindOptions","forceBindPosition","forceTop","position","mounted","ahaMoments","shouldShow","Option","AhaAuditorsInCompactFormPopup","setActive","$nextTick","$refs","fullCardButtonContainer","methods","handleClick","highlightFiles","highlightChecklist","openFullCard","fieldHighlighter","setContainer","$root","$el","addChipHighlight","TaskField","Files","getChipContainer","showHint","removeHighlight","Event","unbind","window","bind","$emit","features","Core","getParams","sendOpenFullCard","canOpenFullCard","isV2Enabled","Type","allowedGroups","includes","groupId","EventEmitter","emit","EventName","OpenFullCard","OpenSliderCard","closeAuditorsHint","setInactive","handleAuditorsHintLinkClick","setShown","template","App","name","BIcon","FieldTitle","DescriptionInline","Importance","FieldList","AddTaskButton","DropZone","mixins","DragOverMixin","provide","cardType","CardType","Compact","taskService","getStoreTask","isEdit","isTemplate","idUtils","id","Number","String","initialTask","Object","default","Outline","openingFullCard","isCheckListPopupShown","creationError","popupCount","isHovered","mapGetters","titleFieldOffsetHeight","Interface","currentUserId","defaultDeadlineTs","stateFlags","group","Groups","fields","title","responsibleMeta","getTitle","component","Responsible","isSingle","deadlineMeta","Deadline","isAutonomous","disk","chip","FilesChip","CheckListChip","events","showCheckList","showCheckListPopup","isProjectsEnabled","GroupChip","filter","field","primaryFields","getFields","WeakMap","chips","map","isDiskModuleInstalled","created","insert","creatorId","responsibleIds","deadlineTs","needsControl","matchesWorkTime","requireResult","defaultRequireResult","fileIds","list","context","sendClickCreate","collabId","GroupType","Collab","viewersCount","coexecutorsCount","accomplicesIds","resizeObserver","ResizeObserver","entries","find","target","updateTitleFieldOffsetHeight","contentRect","height","observe","subscribeEvents","beforeUnmount","disconnect","unsubscribeEvents","unmounted","destroy","mapActions","Tasks","close","CloseCard","addTask","checklists","error","add","Notifier","notifyViaBrowserProvider","text","message","sendAddTaskAnalytics","sendDescription","hasDescription","isStringFilled","description","hasScroll","replace","NotifyGrid","BaseEvent","compatData","options","isSuccess","templateId","sendAddTask","event","Analytics","PatternTaskCreate","parentId","SubTaskAdd","checklistCount","checklistItemsCount","sendAddTaskWithCheckList","TaskCreate","handleShowingPopup","ShowOverlay","AdjustPosition","externalPopup","popupInstance","adjustCardPopup","handleHidingPopup","HideOverlay","handleResizingPopup","animate","titleFieldHeight","innerPopup","closeCheckListPopup","subscribe","handlePopupShow","document","handleKeyDown","capture","unsubscribe","popup","getCompatData","onClose","key","ctrlKey","metaKey","addTaskButton","setTimeout","delete","TaskCompactCard","constructor","params","TaskCard","showFullCard","baseEvent","getData","TaskMappers","mapModelToSliderData","path","BX","Uri","addParam","paths","editPath","SCOPE","ta_sec","ta_sub","additionalContext","ta_el","element","p1","Params","IsDemo","settings","isDemo","p2","userType","SidePanel","Instance","open","requestMethod","requestParams","cacheable","Dom","addClass","getPopupContainer","removeClass","setOffset","offsetTop","innerPopupContainer","popupContainer","heightDifference","offsetHeight","popupPaddingTop","style","openedPopupsCount","Text","getRandom","boxTemplate","mount","getContentContainer","dragHandle","Tag","render","append","setDraggable","restrict","unmount","container","init","url","closeCompleteUrl","application","BitrixVue","createApp","fromEntries","value","isNil","mixin","locMixin","use","getStore","CardClosed","forEach","handler","adjustPosition","currentUser","UserTypes","Collaber","defaultCollab","undefined"],"mappings":"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"}