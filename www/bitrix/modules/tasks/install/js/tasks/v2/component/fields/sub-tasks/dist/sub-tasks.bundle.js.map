{"version":3,"file":"sub-tasks.bundle.js","sources":["../src/sub-tasks-meta.js","../src/sub-tasks.js","../src/sub-tasks-chip.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { TaskField } from 'tasks.v2.const';\nimport { subTasksService } from 'tasks.v2.provider.service.relation-service';\nimport type { RelationFieldMeta } from 'tasks.v2.component.fields.relation-tasks';\n\nexport const subTasksMeta: RelationFieldMeta = Object.freeze({\n\tid: TaskField.SubTasks,\n\ticon: Outline.RELATED_TASKS,\n\tidsField: 'subTaskIds',\n\tcontainsField: 'containsSubTasks',\n\tgetTitle: (isTemplate: boolean): string => {\n\t\tif (isTemplate)\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_V2_SUB_TEMPLATES_TITLE');\n\t\t}\n\n\t\treturn Loc.getMessage('TASKS_V2_SUB_TASKS_TITLE');\n\t},\n\tgetChipTitle: (isTemplate: boolean): string => {\n\t\tif (isTemplate)\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_V2_SUB_TEMPLATES_TITLE_CHIP');\n\t\t}\n\n\t\treturn Loc.getMessage('TASKS_V2_SUB_TASKS_TITLE_CHIP');\n\t},\n\tgetCountLoc: (isTemplate: boolean): string => {\n\t\tif (isTemplate)\n\t\t{\n\t\t\treturn 'TASKS_V2_SUB_TEMPLATES_TITLE_COUNT';\n\t\t}\n\n\t\treturn 'TASKS_V2_SUB_TASKS_TITLE_COUNT';\n\t},\n\tgetHint: (isTemplate: boolean) => {\n\t\tif (isTemplate)\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_V2_SUB_TEMPLATES_ADD');\n\t\t}\n\n\t\treturn Loc.getMessage('TASKS_V2_SUB_TASKS_ADD');\n\t},\n\tservice: subTasksService,\n\tright: 'createSubtask',\n});\n","import { Core } from 'tasks.v2.core';\nimport { RelationTasks } from 'tasks.v2.component.fields.relation-tasks';\nimport { subTasksDialog } from 'tasks.v2.lib.relation-tasks-dialog';\nimport { subTasksMeta } from './sub-tasks-meta';\n\n// @vue/component\nexport const SubTasks = {\n\tname: 'TaskSubTasks',\n\tcomponents: {\n\t\tRelationTasks,\n\t},\n\tinject: {\n\t\ttaskId: {},\n\t\tisTemplate: {},\n\t\tanalytics: {},\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tsubTasksMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\tisLocked(): boolean\n\t\t{\n\t\t\treturn this.isTemplate && !Core.getParams().restrictions.templatesSubtasks.available;\n\t\t},\n\t\tfeatureId(): string\n\t\t{\n\t\t\treturn Core.getParams().restrictions.templatesSubtasks.featureId;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleAdd(targetNode: HTMLElement): void\n\t\t{\n\t\t\tsubTasksDialog.show({\n\t\t\t\ttargetNode,\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\tanalytics: this.analytics,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<RelationTasks \n\t\t\t:meta=\"subTasksMeta\"\n\t\t\t:isLocked\n\t\t\t:featureId\n\t\t\t@add=\"handleAdd\"\n\t\t/>\n\t`,\n};\n","import { Core } from 'tasks.v2.core';\nimport { hint, type HintParams } from 'ui.vue3.directives.hint';\n\nimport { tooltip } from 'tasks.v2.component.elements.hint';\nimport { RelationTasksChip } from 'tasks.v2.component.fields.relation-tasks';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { subTasksDialog } from 'tasks.v2.lib.relation-tasks-dialog';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { subTasksMeta } from './sub-tasks-meta';\n\n// @vue/component\nexport const SubTasksChip = {\n\tcomponents: {\n\t\tRelationTasksChip,\n\t},\n\tdirectives: { hint },\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t\tisEdit: {},\n\t\tisTemplate: {},\n\t\tanalytics: {},\n\t},\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tsubTasksMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\tdisabled(): boolean\n\t\t{\n\t\t\treturn !this.isEdit && !this.isLocked && !this.task.templateId;\n\t\t},\n\t\tisLocked(): boolean\n\t\t{\n\t\t\treturn this.isTemplate && !Core.getParams().restrictions.templatesSubtasks.available;\n\t\t},\n\t\tfeatureId(): string\n\t\t{\n\t\t\treturn Core.getParams().restrictions.templatesSubtasks.featureId;\n\t\t},\n\t\ttooltip(): ?Function\n\t\t{\n\t\t\tif (!this.disabled)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (): HintParams => tooltip({\n\t\t\t\ttext: this.loc(this.isTemplate ? 'TASKS_V2_SUB_TEMPLATES_DISABLED_HINT' : 'TASKS_V2_SUB_TASKS_DISABLED_HINT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\toffsetLeft: this.$el.offsetWidth / 2,\n\t\t\t\t\ttargetContainer: document.querySelector(`[data-task-card-scroll=\"${this.taskId}\"]`),\n\t\t\t\t},\n\t\t\t\ttimeout: 200,\n\t\t\t});\n\t\t},\n\t},\n\tmethods: {\n\t\thandleAdd(targetNode: HTMLElement): void\n\t\t{\n\t\t\tsubTasksDialog.show({\n\t\t\t\ttargetNode,\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\tonClose: this.highlightField,\n\t\t\t\tanalytics: this.analytics,\n\t\t\t});\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(subTasksMeta.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<RelationTasksChip \n\t\t\tv-hint=\"tooltip\" \n\t\t\t:meta=\"subTasksMeta\" \n\t\t\t:disabled\n\t\t\t:isLocked\n\t\t\t:featureId\n\t\t\t@add=\"handleAdd\"\n\t\t/>\n\t`,\n};\n"],"names":["subTasksMeta","Object","freeze","id","TaskField","SubTasks","icon","Outline","RELATED_TASKS","idsField","containsField","getTitle","isTemplate","Loc","getMessage","getChipTitle","getCountLoc","getHint","service","subTasksService","right","name","components","RelationTasks","inject","taskId","analytics","setup","computed","isLocked","Core","getParams","restrictions","templatesSubtasks","available","featureId","methods","handleAdd","targetNode","subTasksDialog","show","template","SubTasksChip","RelationTasksChip","directives","hint","task","isEdit","disabled","templateId","tooltip","text","loc","popupOptions","offsetLeft","$el","offsetWidth","targetContainer","document","querySelector","timeout","onClose","highlightField","fieldHighlighter","setContainer","$root","highlight"],"mappings":"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"}