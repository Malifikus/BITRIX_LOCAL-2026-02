{"version":3,"file":"duration.bundle.js","sources":["../src/duration.js"],"sourcesContent":["import { DurationFormat } from 'main.date';\nimport { BInput } from 'ui.system.input.vue';\nimport { BMenu, type MenuOptions } from 'ui.system.menu.vue';\n\nimport { DurationUnit } from 'tasks.v2.const';\nimport { calendar } from 'tasks.v2.lib.calendar';\n\nimport './duration.css';\n\ntype UnitParams = {\n\tduration: number,\n\ttitle: string,\n};\n\nconst unitDurations = DurationFormat.getUnitDurations();\n\nexport const Duration = {\n\tcomponents: {\n\t\tBInput,\n\t\tBMenu,\n\t},\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tmatchesWorkTime: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tlabel: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tdesign: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\terror: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tmaxValue: {\n\t\t\ttype: Number,\n\t\t\tdefault: 20000,\n\t\t},\n\t},\n\temits: ['update:modelValue', 'focus', 'blur', 'menuShown', 'menuHidden'],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisMenuShown: false,\n\t\t\tdurationValue: '',\n\t\t\tunitId: DurationUnit.Days,\n\t\t};\n\t},\n\tcomputed: {\n\t\tmenuOptions(): Function\n\t\t{\n\t\t\treturn (): MenuOptions => ({\n\t\t\t\tbindElement: this.$refs.unit.$el,\n\t\t\t\titems: Object.entries(this.units).map(([unitId, { title }]) => ({\n\t\t\t\t\ttitle,\n\t\t\t\t\tisSelected: unitId === this.unitId,\n\t\t\t\t\tonClick: (): void => {\n\t\t\t\t\t\tthis.unitId = unitId;\n\n\t\t\t\t\t\tthis.update();\n\t\t\t\t\t},\n\t\t\t\t})),\n\t\t\t\ttargetContainer: document.body,\n\t\t\t});\n\t\t},\n\t\tunits(): { [unitId: string]: UnitParams }\n\t\t{\n\t\t\treturn {\n\t\t\t\t[DurationUnit.Days]: {\n\t\t\t\t\tduration: this.matchesWorkTime ? calendar.workdayDuration : unitDurations.d,\n\t\t\t\t\ttitle: this.formatUnit('d'),\n\t\t\t\t},\n\t\t\t\t[DurationUnit.Hours]: {\n\t\t\t\t\tduration: unitDurations.H,\n\t\t\t\t\ttitle: this.formatUnit('H'),\n\t\t\t\t},\n\t\t\t\t[DurationUnit.Minutes]: {\n\t\t\t\t\tduration: unitDurations.i,\n\t\t\t\t\ttitle: this.formatUnit('i'),\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\twatch: {\n\t\tmodelValue(): void\n\t\t{\n\t\t\tthis.setDuration(this.modelValue);\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.setDuration(this.modelValue);\n\t},\n\tmethods: {\n\t\tsetDuration(duration: number): void\n\t\t{\n\t\t\tif (!duration)\n\t\t\t{\n\t\t\t\tthis.durationValue = '';\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst minutes = duration / this.units[DurationUnit.Minutes].duration;\n\t\t\tconst hours = duration / this.units[DurationUnit.Hours].duration;\n\t\t\tconst days = duration / this.units[DurationUnit.Days].duration;\n\n\t\t\tconst [durationValue, unitId] = {\n\t\t\t\t[true]: [Math.floor(minutes), DurationUnit.Minutes],\n\t\t\t\t[Number.isInteger(hours)]: [hours, DurationUnit.Hours],\n\t\t\t\t[Number.isInteger(days)]: [days, DurationUnit.Days],\n\t\t\t}.true;\n\n\t\t\tthis.unitId = unitId;\n\t\t\tthis.durationValue = String(durationValue);\n\t\t},\n\t\tshowMenu(): void\n\t\t{\n\t\t\tthis.$emit('menuShown');\n\n\t\t\tthis.isMenuShown = true;\n\t\t},\n\t\thideMenu(): void\n\t\t{\n\t\t\tthis.$emit('menuHidden');\n\n\t\t\tthis.isMenuShown = false;\n\t\t},\n\t\thandleInput(): void\n\t\t{\n\t\t\tconst durationValue = this.durationValue.replaceAll(/\\D/g, '');\n\t\t\tif (Number(durationValue) < 0 || Number(durationValue) > this.maxValue)\n\t\t\t{\n\t\t\t\tthis.durationValue = this.previousValue ?? '';\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.durationValue = durationValue;\n\t\t\tthis.previousValue = durationValue;\n\n\t\t\tthis.update();\n\t\t},\n\t\tupdate(): void\n\t\t{\n\t\t\tthis.$emit('update:modelValue', this.durationValue * this.units[this.unitId].duration);\n\t\t},\n\t\tformatUnit(format: string): string\n\t\t{\n\t\t\tconst value = Number(this.durationValue) % 1000;\n\n\t\t\treturn new DurationFormat(value * unitDurations[format]).format({ format }).replace(value, '').trim();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"b24-duration\">\n\t\t\t<BInput\n\t\t\t\tv-model=\"durationValue\"\n\t\t\t\t:label\n\t\t\t\t:design\n\t\t\t\t:error\n\t\t\t\tstretched\n\t\t\t\t@input=\"handleInput\"\n\t\t\t\t@focus=\"$emit('focus')\"\n\t\t\t\t@blur=\"$emit('blur')\"\n\t\t\t/>\n\t\t\t<BInput\n\t\t\t\t:modelValue=\"units[unitId].title\"\n\t\t\t\t:design\n\t\t\t\tdropdown\n\t\t\t\tclickable\n\t\t\t\tstretched\n\t\t\t\t:active=\"isMenuShown\"\n\t\t\t\tref=\"unit\"\n\t\t\t\t@click=\"showMenu\"\n\t\t\t/>\n\t\t</div>\n\t\t<BMenu v-if=\"isMenuShown\" :options=\"menuOptions()\" @close=\"hideMenu\"/>\n\t`,\n};\n"],"names":["unitDurations","DurationFormat","getUnitDurations","Duration","components","BInput","BMenu","props","modelValue","type","Number","required","matchesWorkTime","Boolean","default","label","String","design","error","maxValue","emits","data","isMenuShown","durationValue","unitId","DurationUnit","Days","computed","menuOptions","bindElement","$refs","unit","$el","items","Object","entries","units","map","title","isSelected","onClick","update","targetContainer","document","body","duration","calendar","workdayDuration","d","formatUnit","Hours","H","Minutes","i","watch","setDuration","created","methods","minutes","hours","days","Math","floor","isInteger","true","showMenu","$emit","hideMenu","handleInput","replaceAll","previousValue","format","value","replace","trim","template"],"mappings":"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"}