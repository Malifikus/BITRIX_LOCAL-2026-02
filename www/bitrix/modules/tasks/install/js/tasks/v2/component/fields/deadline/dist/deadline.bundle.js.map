{"version":3,"file":"deadline.bundle.js","sources":["../src/deadline-popup/deadline-popup-content.js","../src/deadline-popup/deadline-popup.js","../src/deadline-change-reason-popup/deadline-change-reason-popup.js","../src/deadline-after-popup/deadline-after-popup-content.js","../src/deadline-after-popup/deadline-after-popup.js","../src/deadline-meta.js","../src/deadline.js"],"sourcesContent":["import { Dom, Type } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\nimport type { BaseEvent } from 'main.core.events';\n\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { DatePicker, DatePickerEvent, createDate, createUtcDate } from 'ui.date-picker';\n\nimport { Core } from 'tasks.v2.core';\nimport { Model, Analytics } from 'tasks.v2.const';\nimport { idUtils } from 'tasks.v2.lib.id-utils';\nimport { calendar } from 'tasks.v2.lib.calendar';\nimport { timezone } from 'tasks.v2.lib.timezone';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { Hint } from 'tasks.v2.component.elements.hint';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport './deadline-popup-content.css';\n\ntype Preset = {\n\tid: string,\n\ttitle: string,\n\ttimestamp: number,\n\tformatted: string,\n\tdisabled: boolean,\n};\n\n// @vue/component\nexport const DeadlinePopupContent = {\n\tcomponents: {\n\t\tHint,\n\t},\n\tinject: {\n\t\tanalytics: {},\n\t\tcardType: {},\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update', 'close'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\ttoday: new Date(),\n\t\t\t/** @type DatePicker */\n\t\t\tdatePicker: null,\n\t\t\tdateTs: null,\n\t\t\thour: null,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisLimitHintShown: false,\n\t\t\thintBindElement: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t}),\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn taskService.getStoreTask(this.taskId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn idUtils.isReal(this.taskId);\n\t\t},\n\t\tisCreator(): boolean\n\t\t{\n\t\t\treturn this.currentUserId === this.task.creatorId;\n\t\t},\n\t\tisAdmin(): boolean\n\t\t{\n\t\t\treturn Core.getParams().rights.user.admin;\n\t\t},\n\t\tcanChangeDeadlineWithoutLimitation(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\t!this.isEdit\n\t\t\t\t|| this.isCreator\n\t\t\t\t|| this.task.rights.edit\n\t\t\t\t|| this.isAdmin\n\t\t\t);\n\t\t},\n\t\tmaxDeadlineDate(): Date | null\n\t\t{\n\t\t\tif (this.canChangeDeadlineWithoutLimitation || !this.task.maxDeadlineChangeDate)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst dateFormat = DateTimeFormat.getFormat('FORMAT_DATETIME');\n\n\t\t\treturn createDate(this.task.maxDeadlineChangeDate, dateFormat);\n\t\t},\n\t\tpresets(): Preset[]\n\t\t{\n\t\t\tconst [year, month, date] = [this.today.getFullYear(), this.today.getMonth(), this.today.getDate()];\n\t\t\tconst format = DateTimeFormat.getFormat('DAY_OF_WEEK_MONTH_FORMAT');\n\n\t\t\tconst allPresets = [\n\t\t\t\t{\n\t\t\t\t\tid: `today-${this.taskId}`,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_TODAY'),\n\t\t\t\t\tdate: new Date(year, month, date),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: `tomorrow-${this.taskId}`,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_TOMORROW'),\n\t\t\t\t\tdate: new Date(year, month, date + 1),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: `end-week-${this.taskId}`,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_IN_THE_END_OF_THE_WEEK'),\n\t\t\t\t\tdate: new Date(year, month, date - this.today.getDay() + 5),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: `in-week-${this.taskId}`,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_IN_A_WEEK'),\n\t\t\t\t\tdate: new Date(year, month, date + 7),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: `month-${this.taskId}`,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_IN_THE_END_OF_THE_MONTH'),\n\t\t\t\t\tdate: new Date(year, month + 1, 0),\n\t\t\t\t},\n\t\t\t];\n\n\t\t\treturn allPresets.map((preset: Object): Preset => {\n\t\t\t\tlet disabled = false;\n\n\t\t\t\tif (this.maxDeadlineDate)\n\t\t\t\t{\n\t\t\t\t\tconst presetUtcDate = createUtcDate(\n\t\t\t\t\t\tpreset.date.getFullYear(),\n\t\t\t\t\t\tpreset.date.getMonth(),\n\t\t\t\t\t\tpreset.date.getDate(),\n\t\t\t\t\t);\n\t\t\t\t\tconst maxUtcDate = createUtcDate(\n\t\t\t\t\t\tthis.maxDeadlineDate.getUTCFullYear(),\n\t\t\t\t\t\tthis.maxDeadlineDate.getUTCMonth(),\n\t\t\t\t\t\tthis.maxDeadlineDate.getUTCDate(),\n\t\t\t\t\t);\n\n\t\t\t\t\tdisabled = presetUtcDate > maxUtcDate;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tid: preset.id,\n\t\t\t\t\ttitle: preset.title,\n\t\t\t\t\ttimestamp: preset.date.getTime(),\n\t\t\t\t\tformatted: DateTimeFormat.format(format, preset.date),\n\t\t\t\t\tdisabled,\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t\tlimitHintText(): string\n\t\t{\n\t\t\tif (!this.maxDeadlineDate)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tconst format = DateTimeFormat.getFormat('DAY_MONTH_FORMAT');\n\t\t\tconst date = DateTimeFormat.format(format, this.maxDeadlineDate.getTime() / 1000);\n\n\t\t\treturn this.loc('TASKS_V2_DEADLINE_CAN_MAX_CHANGE_DATE_HINT', { '#DATE#': date });\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.datePicker = this.createDatePicker();\n\n\t\tconst date = new Date(this.task.deadlineTs + timezone.getOffset(this.task.deadlineTs));\n\t\tthis.dateTs = new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime();\n\t\tthis.hour = date.getHours();\n\t},\n\tmounted(): void\n\t{\n\t\tthis.datePicker.setTargetNode(this.$refs.picker);\n\t\tthis.datePicker.show();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.datePicker.destroy();\n\t},\n\tmethods: {\n\t\tcreateDatePicker(): DatePicker\n\t\t{\n\t\t\tconst offset = timezone.getOffset(this.task.deadlineTs);\n\n\t\t\tconst dayColors = [];\n\t\t\tif (this.maxDeadlineDate)\n\t\t\t{\n\t\t\t\tdayColors.push({\n\t\t\t\t\tmatcher: (date: Date) => {\n\t\t\t\t\t\tconst compareDate = createUtcDate(\n\t\t\t\t\t\t\tdate.getUTCFullYear(),\n\t\t\t\t\t\t\tdate.getUTCMonth(),\n\t\t\t\t\t\t\tdate.getUTCDate(),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn compareDate > this.maxDeadlineDate;\n\t\t\t\t\t},\n\t\t\t\t\ttextColor: '#DFE0E3',\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst picker = new DatePicker({\n\t\t\t\tselectedDates: this.task.deadlineTs ? [this.task.deadlineTs + offset] : null,\n\t\t\t\tdefaultTime: calendar.dayEndTime,\n\t\t\t\tinline: true,\n\t\t\t\tenableTime: true,\n\t\t\t\tdayColors,\n\t\t\t\tevents: {\n\t\t\t\t\t[DatePickerEvent.SELECT]: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { date } = event.getData();\n\t\t\t\t\t\tconst dateTs = calendar.createDateFromUtc(date).getTime();\n\t\t\t\t\t\tthis.$emit('update', dateTs - timezone.getOffset(dateTs));\n\t\t\t\t\t},\n\t\t\t\t\t[DatePickerEvent.BEFORE_SELECT]: (event: BaseEvent) => {\n\t\t\t\t\t\tif (!this.maxDeadlineDate)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst { date } = event.getData();\n\t\t\t\t\t\tconst selectedDate = createUtcDate(\n\t\t\t\t\t\t\tdate.getUTCFullYear(),\n\t\t\t\t\t\t\tdate.getUTCMonth(),\n\t\t\t\t\t\t\tdate.getUTCDate(),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (selectedDate > this.maxDeadlineDate)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tpicker.getPicker('day').subscribe('onSelect', (event: BaseEvent) => {\n\t\t\t\tconst { year, month, day } = event.getData();\n\t\t\t\tconst dateTs = new Date(year, month, day).getTime();\n\n\t\t\t\tthis.close();\n\t\t\t\tthis.sendAnalytics(Analytics.Element.Calendar);\n\n\t\t\t\tthis.dateTs = dateTs;\n\t\t\t});\n\n\t\t\tpicker.getPicker('day').subscribe('onFocus', this.handleDayFocus);\n\n\t\t\tpicker.getPicker('time').subscribe('onSelect', (event: BaseEvent) => {\n\t\t\t\tconst { hour, minute } = event.getData();\n\t\t\t\tif (Number.isInteger(minute) || hour === this.hour)\n\t\t\t\t{\n\t\t\t\t\tthis.close();\n\t\t\t\t}\n\n\t\t\t\tthis.hour = hour;\n\t\t\t});\n\n\t\t\treturn picker;\n\t\t},\n\t\tasync focusDate(timestamp: ?number, disabled: boolean = false, event: ?Event = null): Promise<void>\n\t\t{\n\t\t\tif (this.maxDeadlineDate)\n\t\t\t{\n\t\t\t\tthis.isLimitHintShown = false;\n\t\t\t\tthis.hintBindElement = null;\n\n\t\t\t\tawait this.$nextTick();\n\n\t\t\t\tif (disabled && event)\n\t\t\t\t{\n\t\t\t\t\tconst presetElement = event.currentTarget;\n\t\t\t\t\tif (presetElement && timestamp)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.hintBindElement = presetElement;\n\t\t\t\t\t\tthis.isLimitHintShown = true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.datePicker.setFocusDate(timestamp);\n\t\t},\n\t\tselectPresetDate(timestamp: number, disabled: boolean = false): void\n\t\t{\n\t\t\tif (disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst date = new Date(timestamp);\n\t\t\tconst [year, mount, day] = [date.getFullYear(), date.getMonth(), date.getDate()];\n\n\t\t\tthis.datePicker.selectDate(new Date(`${mount + 1}/${day}/${year} ${calendar.dayEndTime}`));\n\t\t\tthis.sendAnalytics(Analytics.Element.DeadlinePreset);\n\n\t\t\tthis.close();\n\t\t},\n\t\tclose(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tsendAnalytics(element: string): void\n\t\t{\n\t\t\tanalytics.sendDeadlineSet(this.analytics, {\n\t\t\t\telement,\n\t\t\t\tcardType: this.cardType,\n\t\t\t\ttaskId: Type.isNumber(this.taskId) ? this.taskId : 0,\n\t\t\t\tviewersCount: this.task.auditorsIds?.length ?? 0,\n\t\t\t\tcoexecutorsCount: this.task.accomplicesIds?.length ?? 0,\n\t\t\t});\n\t\t},\n\t\tasync handleDayFocus(event: BaseEvent): Promise<void>\n\t\t{\n\t\t\tconst { year, month, day } = event.getData();\n\t\t\tconst dayPicker = event.getTarget();\n\n\t\t\tif (!this.maxDeadlineDate)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst dayElement = dayPicker\n\t\t\t\t.getMonthContainer()\n\t\t\t\t.querySelector(\n\t\t\t\t\t`.ui-day-picker-day[data-year=\"${year}\"][data-month=\"${month}\"][data-day=\"${day}\"]`,\n\t\t\t\t)\n\t\t\t;\n\t\t\tif (!dayElement)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.style(dayElement, 'cursor', 'pointer');\n\n\t\t\tthis.isLimitHintShown = false;\n\t\t\tthis.hintBindElement = null;\n\n\t\t\tawait this.$nextTick();\n\n\t\t\tconst focusedDate = createUtcDate(year, month, day);\n\t\t\tconst maxUtcDate = createUtcDate(\n\t\t\t\tthis.maxDeadlineDate.getUTCFullYear(),\n\t\t\t\tthis.maxDeadlineDate.getUTCMonth(),\n\t\t\t\tthis.maxDeadlineDate.getUTCDate(),\n\t\t\t);\n\n\t\t\tif (focusedDate > maxUtcDate)\n\t\t\t{\n\t\t\t\tthis.datePicker.setFocusDate(null);\n\n\t\t\t\tDom.style(dayElement, 'cursor', 'default');\n\n\t\t\t\tthis.hintBindElement = dayElement;\n\t\t\t\tthis.isLimitHintShown = true;\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-deadline-popup\">\n\t\t\t<div class=\"tasks-field-deadline-picker-container\">\n\t\t\t\t<div class=\"tasks-field-deadline-picker\" ref=\"picker\"/>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-field-deadline-presets\">\n\t\t\t\t<template v-for=\"(preset, key) of presets\" :key>\n\t\t\t\t\t<div\n\t\t\t\t\t\t:data-task-preset-id=\"preset.id\"\n\t\t\t\t\t\t:class=\"['tasks-field-deadline-preset', { '--disabled': preset.disabled }]\"\n\t\t\t\t\t\t@click=\"selectPresetDate(preset.timestamp, preset.disabled)\"\n\t\t\t\t\t\t@mouseenter=\"focusDate(preset.timestamp, preset.disabled, $event)\"\n\t\t\t\t\t\t@mouseleave=\"focusDate(null, preset.disabled, $event)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"tasks-field-deadline-preset-title\">{{ preset.title }}</div>\n\t\t\t\t\t\t<div class=\"tasks-field-deadline-preset-date\">{{ preset.formatted }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<div v-if=\"false\" class=\"tasks-field-deadline-settings\">\n\t\t\t</div>\n\t\t\t<Hint\n\t\t\t\tv-if=\"isLimitHintShown\"\n\t\t\t\t:bindElement=\"hintBindElement\"\n\t\t\t\t:options=\"{\n\t\t\t\t\tmaxWidth: 300,\n\t\t\t\t\tpadding: 12,\n\t\t\t\t\tcloseIcon: false,\n\t\t\t\t\toffsetLeft: hintBindElement.offsetWidth / 2,\n\t\t\t\t}\"\n\t\t\t\t@close=\"isLimitHintShown = false\"\n\t\t\t>\n\t\t\t\t<div class=\"tasks-field-deadline-date-picker-hint\">{{ limitHintText }}</div>\n\t\t\t</Hint>\n\t\t</div>\n\t`,\n};\n","import type { PopupOptions } from 'main.popup';\nimport { Popup } from 'ui.vue3.components.popup';\n\nimport { DeadlinePopupContent } from './deadline-popup-content';\n\n// @vue/component\nexport const DeadlinePopup = {\n\tcomponents: {\n\t\tPopup,\n\t\tDeadlinePopupContent,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tdeadlineTs: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\trequired: true,\n\t\t},\n\t\tcoordinates: {\n\t\t\ttype: Object,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\temits: ['update:deadlineTs', 'close'],\n\tcomputed: {\n\t\toptions(): PopupOptions\n\t\t{\n\t\t\tconst baseOptions = {\n\t\t\t\tid: `tasks-field-deadline-popup-${this.taskId}`,\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tpadding: 24,\n\t\t\t\toffsetTop: 5,\n\t\t\t\toffsetLeft: -100,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t};\n\n\t\t\tif (this.coordinates?.x)\n\t\t\t{\n\t\t\t\tconst bindElementRect = this.bindElement.getBoundingClientRect();\n\n\t\t\t\tbaseOptions.offsetLeft += this.coordinates.x - bindElementRect.left;\n\t\t\t}\n\n\t\t\treturn baseOptions;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleUpdate(dateTs: number): void\n\t\t{\n\t\t\tthis.$emit('update:deadlineTs', dateTs);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Popup :options @close=\"$emit('close')\">\n\t\t\t<DeadlinePopupContent :taskId @update=\"handleUpdate\" @close=\"$emit('close')\"/>\n\t\t</Popup>\n\t`,\n};\n","import type { PopupOptions } from 'main.popup';\n\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { BInput } from 'ui.system.input.vue';\nimport 'ui.icon-set.outline';\nimport { AirButtonStyle, Button as UiButton, ButtonSize } from 'ui.vue3.components.button';\nimport { Popup } from 'ui.vue3.components.popup';\nimport 'ui.forms';\n\nimport './deadline-change-reason-popup.css';\n\n// @vue/component\nexport const DeadlineChangeReasonPopup = {\n\tname: 'DeadlineChangeReasonPopup',\n\tcomponents: {\n\t\tBIcon,\n\t\tBInput,\n\t\tUiButton,\n\t\tPopup,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\trequired: true,\n\t\t},\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:modelValue', 'close'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tresolve: null,\n\t\t\treject: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\toptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `tasks-deadline-change-reason-popup-${this.taskId}`,\n\t\t\t\tclassName: 'tasks-deadline-change-reason-popup',\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tpadding: 24,\n\t\t\t\twidth: 472,\n\t\t\t\theight: 324,\n\t\t\t\toffsetLeft: -24,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t};\n\t\t},\n\t\treason: {\n\t\t\tget(): string\n\t\t\t{\n\t\t\t\treturn this.modelValue;\n\t\t\t},\n\t\t\tset(value: string): void\n\t\t\t{\n\t\t\t\tthis.$emit('update:modelValue', value);\n\t\t\t},\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClose(): void\n\t\t{\n\t\t\tthis.reason = '';\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t\thandleSave(): void\n\t\t{\n\t\t\tif (this.reason === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Popup :options @close=\"handleClose\">\n\t\t\t<div class=\"tasks-deadline-change-reason-popup-header\">\n\t\t\t\t<div class=\"tasks-deadline-change-reason-popup-title\">\n\t\t\t\t\t{{ loc('TASKS_V2_DEADLINE_CHANGE_REASON_POPUP_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"Outline.CROSS_L\"\n\t\t\t\t\thoverable\n\t\t\t\t\tclass=\"tasks-deadline-change-reason-popup-close-icon\"\n\t\t\t\t\t@click=\"handleClose\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-deadline-change-reason-popup-content\">\n\t\t\t\t<div class=\"tasks-deadline-change-reason-popup-message\">\n\t\t\t\t\t{{ loc('TASKS_V2_DEADLINE_CHANGE_REASON_POPUP_MESSAGE') }}\n\t\t\t\t</div>\n\t\t\t\t<BInput\n\t\t\t\t\tv-model=\"reason\"\n\t\t\t\t\t:rowsQuantity=\"6\"\n\t\t\t\t\tactive\n\t\t\t\t\tresize=\"none\"\n\t\t\t\t\tdata-id=\"tasks-deadline-change-reason-popup-reason\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-deadline-change-reason-popup-footer\">\n\t\t\t\t<UiButton\n\t\t\t\t\t:text=\"loc('TASKS_V2_DEADLINE_CHANGE_REASON_POPUP_BTN_CANCEL')\"\n\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t:style=\"AirButtonStyle.PLAIN\"\n\t\t\t\t\t:dataset=\"{\n\t\t\t\t\t\tdeadlineChangeReasonButtonId: 'cancel',\n\t\t\t\t\t}\"\n\t\t\t\t\t@click=\"handleClose\"\n\t\t\t\t/>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text=\"loc('TASKS_V2_DEADLINE_CHANGE_REASON_POPUP_BTN_SAVE')\"\n\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t\t:disabled=\"reason === ''\"\n\t\t\t\t\t:style=\"AirButtonStyle.FILLED\"\n\t\t\t\t\t:dataset=\"{\n\t\t\t\t\t\tdeadlineChangeReasonButtonId: 'save',\n\t\t\t\t\t}\"\n\t\t\t\t\t@click=\"handleSave\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</Popup>\n\t`,\n};\n","import { DurationFormat } from 'main.date';\n\nimport { TextSm } from 'ui.system.typography.vue';\nimport { Chip, ChipDesign } from 'ui.system.chip.vue';\n\nimport { QuestionMark } from 'tasks.v2.component.elements.question-mark';\nimport { Duration } from 'tasks.v2.component.elements.duration';\nimport { calendar } from 'tasks.v2.lib.calendar';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport './deadline-after-popup.css';\n\nconst unitDurations = DurationFormat.getUnitDurations();\n\n// @vue/component\nexport const DeadlineAfterPopupContent = {\n\tcomponents: {\n\t\tTextSm,\n\t\tChip,\n\t\tQuestionMark,\n\t\tDuration,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tfreeze: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t\tunfreeze: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update', 'close'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tChipDesign,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineAfter: 0,\n\t\t};\n\t},\n\tcomputed: {\n\t\tduration: {\n\t\t\tget(): number\n\t\t\t{\n\t\t\t\treturn this.deadlineAfter;\n\t\t\t},\n\t\t\tset(deadlineAfter: number): number\n\t\t\t{\n\t\t\t\tthis.$emit('update', deadlineAfter);\n\t\t\t},\n\t\t},\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn taskService.getStoreTask(this.taskId);\n\t\t},\n\t\tpresets(): Object\n\t\t{\n\t\t\tconst dayDuration = this.task?.matchesWorkTime ? calendar.workdayDuration : unitDurations.d;\n\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tduration: dayDuration,\n\t\t\t\t\ttitle: new DurationFormat(unitDurations.d).format(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tduration: dayDuration * 3,\n\t\t\t\t\ttitle: new DurationFormat(unitDurations.d * 3).format(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tduration: dayDuration * 7,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_A_WEEK'),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tduration: dayDuration * 14,\n\t\t\t\t\ttitle: this.loc('TASKS_V2_DEADLINE_TWO_WEEKS'),\n\t\t\t\t},\n\t\t\t];\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.deadlineAfter = this.task?.deadlineAfter;\n\t},\n\tmethods: {\n\t\tapplyPreset(duration: number): void\n\t\t{\n\t\t\tthis.duration = duration;\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-deadline-after-header\">\n\t\t\t<TextSm>{{ loc('TASKS_V2_DEADLINE_AFTER_TEXT') }}</TextSm>\n\t\t\t<QuestionMark :hintText=\"loc('TASKS_V2_DEADLINE_AFTER_HINT')\"/>\n\t\t</div>\n\t\t<div class=\"tasks-field-deadline-after-chips\">\n\t\t\t<template v-for=\"preset in presets\" :key=\"preset.title\">\n\t\t\t\t<Chip\n\t\t\t\t\t:text=\"preset.title\"\n\t\t\t\t\t:design=\"ChipDesign.Outline\"\n\t\t\t\t\t:compact=\"false\"\n\t\t\t\t\t@click=\"applyPreset(preset.duration)\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</div>\n\t\t<Duration\n\t\t\tv-model=\"duration\"\n\t\t\t:label=\"loc('TASKS_V2_DEADLINE_AFTER_CUSTOM')\"\n\t\t\t:matchesWorkTime=\"task?.matchesWorkTime\"\n\t\t\t@menuShown=\"freeze\"\n\t\t\t@menuHidden=\"unfreeze\"\n\t\t/>\n\t`,\n};\n","import type { PopupOptions } from 'main.popup';\n\nimport { Popup } from 'ui.vue3.components.popup';\n\nimport { DeadlineAfterPopupContent } from './deadline-after-popup-content';\n\n// @vue/component\nexport const DeadlineAfterPopup = {\n\tcomponents: {\n\t\tPopup,\n\t\tDeadlineAfterPopupContent,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tdeadlineAfter: {\n\t\t\ttype: [Number, null],\n\t\t\trequired: true,\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:deadlineAfter', 'close'],\n\tcomputed: {\n\t\toptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `tasks-field-deadline-after-popup-${this.taskId}`,\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\twidth: 300,\n\t\t\t\tpadding: 24,\n\t\t\t\toffsetTop: 5,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\thandleUpdate(dateTs: number): void\n\t\t{\n\t\t\tthis.$emit('update:deadlineAfter', dateTs);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Popup\n\t\t\tv-slot=\"{ freeze, unfreeze }\"\n\t\t\t:options\n\t\t\t@close=\"$emit('close')\"\n\t\t>\n\t\t\t<DeadlineAfterPopupContent :taskId :freeze :unfreeze @update=\"handleUpdate\" @close=\"$emit('close')\"/>\n\t\t</Popup>\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\n\nexport const deadlineMeta = Object.freeze({\n\tid: TaskField.Deadline,\n\ttitle: Loc.getMessage('TASKS_V2_DEADLINE_TITLE'),\n});\n","import { Runtime } from 'main.core';\nimport { DurationFormat } from 'main.date';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\n\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { Notifier } from 'ui.notification-manager';\nimport { hint, type HintParams } from 'ui.vue3.directives.hint';\nimport { TextMd, Text2Xs } from 'ui.system.typography.vue';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { Model, EventName, TaskStatus, Endpoint } from 'tasks.v2.const';\nimport { TaskSettingsPopup } from 'tasks.v2.component.task-settings-popup';\nimport { SettingsLabel } from 'tasks.v2.component.elements.settings-label';\nimport { Hint, tooltip } from 'tasks.v2.component.elements.hint';\nimport { HoverPill } from 'tasks.v2.component.elements.hover-pill';\nimport { idUtils } from 'tasks.v2.lib.id-utils';\nimport { calendar } from 'tasks.v2.lib.calendar';\nimport { heightTransition } from 'tasks.v2.lib.height-transition';\nimport { deadlineService } from 'tasks.v2.provider.service.deadline-service';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { DeadlinePopup } from './deadline-popup/deadline-popup';\nimport { DeadlineChangeReasonPopup } from './deadline-change-reason-popup/deadline-change-reason-popup';\nimport { DeadlineAfterPopup } from './deadline-after-popup/deadline-after-popup';\nimport { deadlineMeta } from './deadline-meta';\nimport './deadline.css';\n\n// @vue/component\nexport const Deadline = {\n\tcomponents: {\n\t\tTextMd,\n\t\tText2Xs,\n\t\tHint,\n\t\tHoverPill,\n\t\tBIcon,\n\t\tDeadlinePopup,\n\t\tDeadlineAfterPopup,\n\t\tDeadlineChangeReasonPopup,\n\t\tSettingsLabel,\n\t\tTaskSettingsPopup,\n\t},\n\tdirectives: { hint },\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisTemplate: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisAutonomous: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisHovered: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tcompact: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['isSettingsPopupShown'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tdeadlineMeta,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tnowTs: Date.now(),\n\t\t\tisPopupShown: false,\n\t\t\tisSettingsPopupShown: false,\n\t\t\tisExceededHintShown: false,\n\t\t\tisChangeReasonPopupShown: false,\n\t\t\tdateTs: null,\n\t\t\texternalBindElement: null,\n\t\t\tcoordinates: null,\n\t\t\tsaveCallback: null,\n\t\t\tchangeReason: '',\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tdeadlineChangeCount: `${Model.Interface}/deadlineChangeCount`,\n\t\t}),\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn taskService.getStoreTask(this.taskId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn idUtils.isReal(this.taskId);\n\t\t},\n\t\tdeadlineTs(): number\n\t\t{\n\t\t\treturn this.dateTs ?? (this.isTemplate ? this.task.deadlineAfter : this.task.deadlineTs);\n\t\t},\n\t\texpiredDuration(): number\n\t\t{\n\t\t\tconst isCompleted = this.task.status === TaskStatus.Completed;\n\t\t\tconst cannotExpire = this.isTemplate || !this.deadlineTs || this.isFlowFilledOnAdd || isCompleted;\n\n\t\t\treturn cannotExpire ? 0 : this.nowTs - this.deadlineTs;\n\t\t},\n\t\tisExpired(): boolean\n\t\t{\n\t\t\treturn this.expiredDuration > 0;\n\t\t},\n\t\texpiredFormatted(): string\n\t\t{\n\t\t\treturn this.loc('TASKS_V2_DEADLINE_EXPIRED', {\n\t\t\t\t'#EXPIRED_DURATION#': new DurationFormat(this.expiredDuration).formatClosest(),\n\t\t\t});\n\t\t},\n\t\tdeadlineFormatted(): string\n\t\t{\n\t\t\tif (this.isFlowFilledOnAdd)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_DEADLINE_AUTO');\n\t\t\t}\n\n\t\t\tif (!this.deadlineTs)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_DEADLINE_EMPTY');\n\t\t\t}\n\n\t\t\tif (this.isTemplate)\n\t\t\t{\n\t\t\t\treturn calendar.formatDuration(this.deadlineTs, this.task.matchesWorkTime);\n\t\t\t}\n\n\t\t\tif (this.isExpired && this.compact)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_TASK_LIST_DEADLINE_EXPIRED', {\n\t\t\t\t\t'#DURATION#': new DurationFormat(this.expiredDuration).formatClosest(),\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn calendar.formatDateTime(this.deadlineTs);\n\t\t},\n\t\ticonName(): string\n\t\t{\n\t\t\treturn this.isFlowFilledOnAdd ? Outline.BOTTLENECK : Outline.CALENDAR_WITH_SLOTS;\n\t\t},\n\t\tbindElement(): HTMLElement\n\t\t{\n\t\t\treturn this.externalBindElement ?? this.$refs.deadline.$el;\n\t\t},\n\t\tisFlowFilledOnAdd(): boolean\n\t\t{\n\t\t\treturn !this.isEdit && this.task.flowId > 0;\n\t\t},\n\t\tcanChangeSettings(): boolean\n\t\t{\n\t\t\tconst features = Core.getParams().features;\n\t\t\tif (!features.isV2Enabled)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.task.rights.edit;\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn !this.task.rights.deadline || this.exceededChangeCount || this.isFlowFilledOnAdd;\n\t\t},\n\t\tcanChangeDeadlineWithoutLimitation(): boolean\n\t\t{\n\t\t\tconst isCreator = Core.getParams().currentUser.id === this.task.creatorId;\n\n\t\t\treturn !this.isEdit || isCreator || this.task.rights.edit || Core.getParams().rights.user.admin;\n\t\t},\n\t\trequireChangeReason(): boolean\n\t\t{\n\t\t\treturn this.task.requireDeadlineChangeReason && !this.canChangeDeadlineWithoutLimitation;\n\t\t},\n\t\texceededChangeCount(): boolean\n\t\t{\n\t\t\tif (this.isTemplate || this.canChangeDeadlineWithoutLimitation || !this.task.maxDeadlineChanges)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.deadlineChangeCount >= this.task.maxDeadlineChanges;\n\t\t},\n\t\tcanChangeTooltip(): ?Function\n\t\t{\n\t\t\tif (!this.isEdit || !this.readonly || this.exceededChangeCount)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (): HintParams => tooltip({\n\t\t\t\ttext: this.loc('TASKS_V2_DEADLINE_CAN_CHANGE_HINT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\twidth: 280,\n\t\t\t\t\toffsetLeft: this.hintAngleOffset + 3,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\thintBindElement(): HTMLElement\n\t\t{\n\t\t\treturn this.$refs.deadlineIcon?.$el ?? this.$refs.deadline?.$el;\n\t\t},\n\t\thintAngleOffset(): number\n\t\t{\n\t\t\treturn this.hintBindElement.offsetWidth / 2;\n\t\t},\n\t},\n\twatch: {\n\t\tisSettingsPopupShown(value): void\n\t\t{\n\t\t\tthis.$emit('isSettingsPopupShown', value);\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\theightTransition.animate(this.$refs.container);\n\t\tthis.nowTsInterval = setInterval(() => {\n\t\t\tthis.nowTs = Date.now();\n\t\t}, 1000);\n\n\t\tEventEmitter.subscribe(EventName.OpenDeadlinePicker, this.handleOpenDeadlinePickerEvent);\n\t},\n\tcreated(): void\n\t{\n\t\tthis.showErrorDebounce = Runtime.debounce(this.showError, 300);\n\t},\n\tupdated(): void\n\t{\n\t\theightTransition.animate(this.$refs.container);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tclearInterval(this.nowTsInterval);\n\n\t\tEventEmitter.unsubscribe(EventName.OpenDeadlinePicker, this.handleOpenDeadlinePickerEvent);\n\t},\n\tmethods: {\n\t\thandleOpenDeadlinePickerEvent(event: BaseEvent): void\n\t\t{\n\t\t\tconst { taskId, bindElement, coordinates } = event.getData();\n\n\t\t\tif (Number(taskId) === Number(this.taskId))\n\t\t\t{\n\t\t\t\tthis.showPopup(bindElement, coordinates);\n\t\t\t}\n\t\t},\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (!this.readonly)\n\t\t\t{\n\t\t\t\tthis.showPopup();\n\t\t\t}\n\t\t},\n\t\tshowPopup(bindElement: HTMLElement, coordinates: { x: number, y: number }): void\n\t\t{\n\t\t\tthis.dateTs = this.deadlineTs;\n\t\t\tthis.externalBindElement = bindElement;\n\t\t\tthis.coordinates = coordinates;\n\t\t\tthis.isPopupShown = true;\n\t\t},\n\t\thandleCrossClick(): void\n\t\t{\n\t\t\tif (this.requireChangeReason)\n\t\t\t{\n\t\t\t\tthis.isChangeReasonPopupShown = true;\n\n\t\t\t\tthis.saveCallback = this.clearDeadline;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvoid this.clearDeadline();\n\t\t\t}\n\t\t},\n\t\thandleClose(): void\n\t\t{\n\t\t\tif (this.requireChangeReason && this.dateTs)\n\t\t\t{\n\t\t\t\tthis.isChangeReasonPopupShown = true;\n\n\t\t\t\tthis.saveCallback = this.saveDeadline;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvoid this.saveDeadline();\n\t\t\t}\n\n\t\t\tthis.isPopupShown = false;\n\t\t\tthis.$refs.deadline?.$el?.focus();\n\t\t},\n\t\tasync handleChangeReasonPopupClose(): void\n\t\t{\n\t\t\tthis.isChangeReasonPopupShown = false;\n\n\t\t\tawait this.saveCallback();\n\n\t\t\tthis.saveCallback = null;\n\t\t},\n\t\thandleKeydown(event: KeyboardEvent): void\n\t\t{\n\t\t\tif (event.key === 'Enter' && !(event.ctrlKey || event.metaKey))\n\t\t\t{\n\t\t\t\tvoid this.handleClick();\n\t\t\t}\n\t\t},\n\t\tasync saveDeadline(): Promise<void>\n\t\t{\n\t\t\tif (this.requireChangeReason && this.changeReason === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dateTs)\n\t\t\t{\n\t\t\t\tawait this.setDeadline(this.dateTs);\n\t\t\t}\n\n\t\t\tif (!this.isTemplate && !this.canChangeDeadlineWithoutLimitation && this.task.maxDeadlineChanges)\n\t\t\t{\n\t\t\t\tvoid deadlineService.updateDeadlineChangeCount(this.task.id);\n\t\t\t}\n\t\t},\n\t\tasync clearDeadline(): Promise<void>\n\t\t{\n\t\t\tif (this.requireChangeReason && this.changeReason === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.setDeadline(0);\n\t\t},\n\t\tasync setDeadline(dateTs: number): Promise<void>\n\t\t{\n\t\t\tthis.dateTs = dateTs;\n\t\t\tif (this.isTemplate)\n\t\t\t{\n\t\t\t\tawait taskService.update(this.taskId, { deadlineAfter: dateTs });\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst result = await taskService.update(this.taskId, {\n\t\t\t\t\tdeadlineTs: dateTs,\n\t\t\t\t\tdeadlineChangeReason: this.changeReason,\n\t\t\t\t});\n\n\t\t\t\tif (result[Endpoint.TaskDeadlineUpdate]?.length)\n\t\t\t\t{\n\t\t\t\t\tconst error = result[Endpoint.TaskDeadlineUpdate][0];\n\n\t\t\t\t\tthis.showErrorDebounce(error);\n\n\t\t\t\t\tthis.dateTs = this.task.deadlineTs;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tshowError(error): void\n\t\t{\n\t\t\tNotifier.notifyViaBrowserProvider({\n\t\t\t\tid: 'task-notify-deadline-update-error',\n\t\t\t\ttext: error?.message,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tv-hint=\"canChangeTooltip\"\n\t\t\tclass=\"tasks-field-deadline\"\n\t\t\t:class=\"{ '--expired': isExpired }\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-field-id=\"deadlineMeta.id\"\n\t\t\t:data-task-field-value=\"task.deadlineTs\"\n\t\t\tref=\"container\"\n\t\t>\n\t\t\t<div class=\"tasks-field-deadline-inner\">\n\t\t\t\t<HoverPill\n\t\t\t\t\t:withClear=\"Boolean(deadlineTs)\"\n\t\t\t\t\t:readonly\n\t\t\t\t\t:textOnly=\"compact\"\n\t\t\t\t\t:noOffset=\"compact\"\n\t\t\t\t\t:active=\"isPopupShown\"\n\t\t\t\t\tref=\"deadline\"\n\t\t\t\t\t@click=\"handleClick\"\n\t\t\t\t\t@clear=\"handleCrossClick\"\n\t\t\t\t\t@keydown=\"handleKeydown\"\n\t\t\t\t\t@mouseover=\"isExceededHintShown = true\"\n\t\t\t\t\t@mouseleave=\"isExceededHintShown = false\"\n\t\t\t\t>\n\t\t\t\t\t<BIcon v-if=\"!compact\" class=\"tasks-field-deadline-icon\" :name=\"iconName\" ref=\"deadlineIcon\"/>\n\t\t\t\t\t<TextMd class=\"tasks-field-deadline-text\" :accent=\"isExpired\">{{ deadlineFormatted }}</TextMd>\n\t\t\t\t</HoverPill>\n\t\t\t\t<div v-if=\"!isFlowFilledOnAdd && !isTemplate && !compact\" ref=\"settings\" class=\"tasks-field-deadline-settings-label\">\n\t\t\t\t\t<SettingsLabel\n\t\t\t\t\t\tv-if=\"canChangeSettings && (isHovered || isSettingsPopupShown)\"\n\t\t\t\t\t\tdata-settings-label\n\t\t\t\t\t\t@click=\"isSettingsPopupShown = true\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<Text2Xs v-if=\"isExpired && !compact\" class=\"tasks-field-deadline-expired\">{{ expiredFormatted }}</Text2Xs>\n\t\t</div>\n\t\t<DeadlinePopup\n\t\t\tv-if=\"!isTemplate && isPopupShown\"\n\t\t\tv-model:deadlineTs=\"dateTs\"\n\t\t\t:taskId\n\t\t\t:bindElement\n\t\t\t:coordinates\n\t\t\t@close=\"handleClose\"\n\t\t/>\n\t\t<DeadlineAfterPopup\n\t\t\tv-if=\"isTemplate && isPopupShown\"\n\t\t\tv-model:deadlineAfter=\"dateTs\"\n\t\t\t:taskId\n\t\t\t:bindElement\n\t\t\t@close=\"handleClose\"\n\t\t/>\n\t\t<DeadlineChangeReasonPopup\n\t\t\tv-if=\"isChangeReasonPopupShown\"\n\t\t\tv-model=\"changeReason\"\n\t\t\t:taskId\n\t\t\t:bindElement=\"$refs.container\"\n\t\t\t@close=\"handleChangeReasonPopupClose\"\n\t\t/>\n\t\t<TaskSettingsPopup v-if=\"isSettingsPopupShown\" @close=\"isSettingsPopupShown = false\"/>\n\t\t<Hint\n\t\t\tv-if=\"exceededChangeCount && isExceededHintShown\"\n\t\t\t:bindElement=\"hintBindElement\"\n\t\t\t:options=\"{\n\t\t\t\tmaxWidth: 330,\n\t\t\t\tpadding: 12,\n\t\t\t\tcloseIcon: false,\n\t\t\t\toffsetLeft: hintAngleOffset,\n\t\t\t}\"\n\t\t\t@close=\"isExceededHintShown = false\"\n\t\t>\n\t\t\t<div class=\"tasks-field-deadline-exceeded-hint\">\n\t\t\t\t<span>{{ loc('TASKS_V2_DEADLINE_CAN_MAX_CHANGE_HINT_1') }}</span>\n\t\t\t\t<span>{{ loc('TASKS_V2_DEADLINE_CAN_MAX_CHANGE_HINT_2') }}</span>\n\t\t\t</div>\n\t\t</Hint>\n\t`,\n};\n"],"names":["DeadlinePopupContent","components","Hint","inject","analytics","cardType","props","taskId","type","Number","String","required","emits","setup","today","Date","datePicker","dateTs","hour","data","isLimitHintShown","hintBindElement","computed","mapGetters","currentUserId","Model","Interface","task","taskService","getStoreTask","isEdit","idUtils","isReal","isCreator","creatorId","isAdmin","Core","getParams","rights","user","admin","canChangeDeadlineWithoutLimitation","edit","maxDeadlineDate","maxDeadlineChangeDate","dateFormat","DateTimeFormat","getFormat","createDate","presets","year","month","date","getFullYear","getMonth","getDate","format","allPresets","id","title","loc","getDay","map","preset","disabled","presetUtcDate","createUtcDate","maxUtcDate","getUTCFullYear","getUTCMonth","getUTCDate","timestamp","getTime","formatted","limitHintText","created","createDatePicker","deadlineTs","timezone","getOffset","getHours","mounted","setTargetNode","$refs","picker","show","beforeUnmount","destroy","methods","offset","dayColors","push","matcher","compareDate","textColor","DatePicker","selectedDates","defaultTime","calendar","dayEndTime","inline","enableTime","events","DatePickerEvent","SELECT","event","getData","createDateFromUtc","$emit","BEFORE_SELECT","selectedDate","preventDefault","getPicker","subscribe","day","close","sendAnalytics","Analytics","Element","Calendar","handleDayFocus","minute","isInteger","focusDate","$nextTick","presetElement","currentTarget","setFocusDate","selectPresetDate","mount","selectDate","DeadlinePreset","element","sendDeadlineSet","Type","isNumber","viewersCount","auditorsIds","length","coexecutorsCount","accomplicesIds","dayPicker","getTarget","dayElement","getMonthContainer","querySelector","Dom","style","focusedDate","template","DeadlinePopup","Popup","bindElement","HTMLElement","coordinates","Object","default","options","baseOptions","padding","offsetTop","offsetLeft","targetContainer","document","body","x","bindElementRect","getBoundingClientRect","left","handleUpdate","DeadlineChangeReasonPopup","name","BIcon","BInput","UiButton","modelValue","AirButtonStyle","ButtonSize","Outline","resolve","reject","className","width","height","reason","get","set","value","handleClose","handleSave","unitDurations","DurationFormat","getUnitDurations","DeadlineAfterPopupContent","TextSm","Chip","QuestionMark","Duration","freeze","Function","unfreeze","ChipDesign","deadlineAfter","duration","dayDuration","matchesWorkTime","workdayDuration","d","applyPreset","DeadlineAfterPopup","deadlineMeta","TaskField","Deadline","Loc","getMessage","TextMd","Text2Xs","HoverPill","SettingsLabel","TaskSettingsPopup","directives","hint","isTemplate","Boolean","isAutonomous","isHovered","compact","nowTs","now","isPopupShown","isSettingsPopupShown","isExceededHintShown","isChangeReasonPopupShown","externalBindElement","saveCallback","changeReason","deadlineChangeCount","expiredDuration","isCompleted","status","TaskStatus","Completed","cannotExpire","isFlowFilledOnAdd","isExpired","expiredFormatted","formatClosest","deadlineFormatted","formatDuration","formatDateTime","iconName","BOTTLENECK","CALENDAR_WITH_SLOTS","deadline","$el","flowId","canChangeSettings","features","isV2Enabled","readonly","exceededChangeCount","currentUser","requireChangeReason","requireDeadlineChangeReason","maxDeadlineChanges","canChangeTooltip","tooltip","text","popupOptions","hintAngleOffset","deadlineIcon","offsetWidth","watch","heightTransition","animate","container","nowTsInterval","setInterval","EventEmitter","EventName","OpenDeadlinePicker","handleOpenDeadlinePickerEvent","showErrorDebounce","Runtime","debounce","showError","updated","clearInterval","unsubscribe","showPopup","handleClick","handleCrossClick","clearDeadline","saveDeadline","focus","handleChangeReasonPopupClose","handleKeydown","key","ctrlKey","metaKey","setDeadline","deadlineService","updateDeadlineChangeCount","update","result","deadlineChangeReason","Endpoint","TaskDeadlineUpdate","error","Notifier","notifyViaBrowserProvider","message"],"mappings":";;;;;;;;CA2BA;AACA,CAAO,MAAMA,oBAAoB,GAAG;GACnCC,UAAU,EAAE;WACXC;IACA;GACDC,MAAM,EAAE;KACPC,SAAS,EAAE,EAAE;KACbC,QAAQ,EAAE;IACV;GACDC,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;;IAEX;GACDC,KAAK,EAAE,CAAC,QAAQ,EAAE,OAAO,CAAC;GAC1BC,KAAK,GACL;KACC,OAAO;OACNC,KAAK,EAAE,IAAIC,IAAI,EAAE;;OAEjBC,UAAU,EAAE,IAAI;OAChBC,MAAM,EAAE,IAAI;OACZC,IAAI,EAAE;MACN;IACD;GACDC,IAAI,GACJ;KACC,OAAO;OACNC,gBAAgB,EAAE,KAAK;OACvBC,eAAe,EAAE;MACjB;IACD;GACDC,QAAQ,EAAE;KACT,GAAGC,uBAAU,CAAC;OACbC,aAAa,EAAG,GAAEC,oBAAK,CAACC,SAAU;MAClC,CAAC;KACFC,IAAI,GACJ;OACC,OAAOC,iDAAW,CAACC,YAAY,CAAC,IAAI,CAACtB,MAAM,CAAC;MAC5C;KACDuB,MAAM,GACN;OACC,OAAOC,4BAAO,CAACC,MAAM,CAAC,IAAI,CAACzB,MAAM,CAAC;MAClC;KACD0B,SAAS,GACT;OACC,OAAO,IAAI,CAACT,aAAa,KAAK,IAAI,CAACG,IAAI,CAACO,SAAS;MACjD;KACDC,OAAO,GACP;OACC,OAAOC,kBAAI,CAACC,SAAS,EAAE,CAACC,MAAM,CAACC,IAAI,CAACC,KAAK;MACzC;KACDC,kCAAkC,GAClC;OACC,OACC,CAAC,IAAI,CAACX,MAAM,IACT,IAAI,CAACG,SAAS,IACd,IAAI,CAACN,IAAI,CAACW,MAAM,CAACI,IAAI,IACrB,IAAI,CAACP,OAAO;MAEhB;KACDQ,eAAe,GACf;OACC,IAAI,IAAI,CAACF,kCAAkC,IAAI,CAAC,IAAI,CAACd,IAAI,CAACiB,qBAAqB,EAC/E;SACC,OAAO,IAAI;;OAGZ,MAAMC,UAAU,GAAGC,wBAAc,CAACC,SAAS,CAAC,iBAAiB,CAAC;OAE9D,OAAOC,wBAAU,CAAC,IAAI,CAACrB,IAAI,CAACiB,qBAAqB,EAAEC,UAAU,CAAC;MAC9D;KACDI,OAAO,GACP;OACC,MAAM,CAACC,IAAI,EAAEC,KAAK,EAAEC,IAAI,CAAC,GAAG,CAAC,IAAI,CAACtC,KAAK,CAACuC,WAAW,EAAE,EAAE,IAAI,CAACvC,KAAK,CAACwC,QAAQ,EAAE,EAAE,IAAI,CAACxC,KAAK,CAACyC,OAAO,EAAE,CAAC;OACnG,MAAMC,MAAM,GAAGV,wBAAc,CAACC,SAAS,CAAC,0BAA0B,CAAC;OAEnE,MAAMU,UAAU,GAAG,CAClB;SACCC,EAAE,EAAG,SAAQ,IAAI,CAACnD,MAAO,EAAC;SAC1BoD,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,yBAAyB,CAAC;SAC1CR,IAAI,EAAE,IAAIrC,IAAI,CAACmC,IAAI,EAAEC,KAAK,EAAEC,IAAI;QAChC,EACD;SACCM,EAAE,EAAG,YAAW,IAAI,CAACnD,MAAO,EAAC;SAC7BoD,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,4BAA4B,CAAC;SAC7CR,IAAI,EAAE,IAAIrC,IAAI,CAACmC,IAAI,EAAEC,KAAK,EAAEC,IAAI,GAAG,CAAC;QACpC,EACD;SACCM,EAAE,EAAG,YAAW,IAAI,CAACnD,MAAO,EAAC;SAC7BoD,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,0CAA0C,CAAC;SAC3DR,IAAI,EAAE,IAAIrC,IAAI,CAACmC,IAAI,EAAEC,KAAK,EAAEC,IAAI,GAAG,IAAI,CAACtC,KAAK,CAAC+C,MAAM,EAAE,GAAG,CAAC;QAC1D,EACD;SACCH,EAAE,EAAG,WAAU,IAAI,CAACnD,MAAO,EAAC;SAC5BoD,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,6BAA6B,CAAC;SAC9CR,IAAI,EAAE,IAAIrC,IAAI,CAACmC,IAAI,EAAEC,KAAK,EAAEC,IAAI,GAAG,CAAC;QACpC,EACD;SACCM,EAAE,EAAG,SAAQ,IAAI,CAACnD,MAAO,EAAC;SAC1BoD,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,2CAA2C,CAAC;SAC5DR,IAAI,EAAE,IAAIrC,IAAI,CAACmC,IAAI,EAAEC,KAAK,GAAG,CAAC,EAAE,CAAC;QACjC,CACD;OAED,OAAOM,UAAU,CAACK,GAAG,CAAEC,MAAc,IAAa;SACjD,IAAIC,QAAQ,GAAG,KAAK;SAEpB,IAAI,IAAI,CAACrB,eAAe,EACxB;WACC,MAAMsB,aAAa,GAAGC,2BAAa,CAClCH,MAAM,CAACX,IAAI,CAACC,WAAW,EAAE,EACzBU,MAAM,CAACX,IAAI,CAACE,QAAQ,EAAE,EACtBS,MAAM,CAACX,IAAI,CAACG,OAAO,EAAE,CACrB;WACD,MAAMY,UAAU,GAAGD,2BAAa,CAC/B,IAAI,CAACvB,eAAe,CAACyB,cAAc,EAAE,EACrC,IAAI,CAACzB,eAAe,CAAC0B,WAAW,EAAE,EAClC,IAAI,CAAC1B,eAAe,CAAC2B,UAAU,EAAE,CACjC;WAEDN,QAAQ,GAAGC,aAAa,GAAGE,UAAU;;SAGtC,OAAO;WACNT,EAAE,EAAEK,MAAM,CAACL,EAAE;WACbC,KAAK,EAAEI,MAAM,CAACJ,KAAK;WACnBY,SAAS,EAAER,MAAM,CAACX,IAAI,CAACoB,OAAO,EAAE;WAChCC,SAAS,EAAE3B,wBAAc,CAACU,MAAM,CAACA,MAAM,EAAEO,MAAM,CAACX,IAAI,CAAC;WACrDY;UACA;QACD,CAAC;MACF;KACDU,aAAa,GACb;OACC,IAAI,CAAC,IAAI,CAAC/B,eAAe,EACzB;SACC,OAAO,EAAE;;OAGV,MAAMa,MAAM,GAAGV,wBAAc,CAACC,SAAS,CAAC,kBAAkB,CAAC;OAC3D,MAAMK,IAAI,GAAGN,wBAAc,CAACU,MAAM,CAACA,MAAM,EAAE,IAAI,CAACb,eAAe,CAAC6B,OAAO,EAAE,GAAG,IAAI,CAAC;OAEjF,OAAO,IAAI,CAACZ,GAAG,CAAC,4CAA4C,EAAE;SAAE,QAAQ,EAAER;QAAM,CAAC;;IAElF;GACDuB,OAAO,GACP;KACC,IAAI,CAAC3D,UAAU,GAAG,IAAI,CAAC4D,gBAAgB,EAAE;KAEzC,MAAMxB,IAAI,GAAG,IAAIrC,IAAI,CAAC,IAAI,CAACY,IAAI,CAACkD,UAAU,GAAGC,8BAAQ,CAACC,SAAS,CAAC,IAAI,CAACpD,IAAI,CAACkD,UAAU,CAAC,CAAC;KACtF,IAAI,CAAC5D,MAAM,GAAG,IAAIF,IAAI,CAACqC,IAAI,CAACC,WAAW,EAAE,EAAED,IAAI,CAACE,QAAQ,EAAE,EAAEF,IAAI,CAACG,OAAO,EAAE,CAAC,CAACiB,OAAO,EAAE;KACrF,IAAI,CAACtD,IAAI,GAAGkC,IAAI,CAAC4B,QAAQ,EAAE;IAC3B;GACDC,OAAO,GACP;KACC,IAAI,CAACjE,UAAU,CAACkE,aAAa,CAAC,IAAI,CAACC,KAAK,CAACC,MAAM,CAAC;KAChD,IAAI,CAACpE,UAAU,CAACqE,IAAI,EAAE;IACtB;GACDC,aAAa,GACb;KACC,IAAI,CAACtE,UAAU,CAACuE,OAAO,EAAE;IACzB;GACDC,OAAO,EAAE;KACRZ,gBAAgB,GAChB;OACC,MAAMa,MAAM,GAAGX,8BAAQ,CAACC,SAAS,CAAC,IAAI,CAACpD,IAAI,CAACkD,UAAU,CAAC;OAEvD,MAAMa,SAAS,GAAG,EAAE;OACpB,IAAI,IAAI,CAAC/C,eAAe,EACxB;SACC+C,SAAS,CAACC,IAAI,CAAC;WACdC,OAAO,EAAGxC,IAAU,IAAK;aACxB,MAAMyC,WAAW,GAAG3B,2BAAa,CAChCd,IAAI,CAACgB,cAAc,EAAE,EACrBhB,IAAI,CAACiB,WAAW,EAAE,EAClBjB,IAAI,CAACkB,UAAU,EAAE,CACjB;aAED,OAAOuB,WAAW,GAAG,IAAI,CAAClD,eAAe;YACzC;WACDmD,SAAS,EAAE;UACX,CAAC;;OAGH,MAAMV,MAAM,GAAG,IAAIW,wBAAU,CAAC;SAC7BC,aAAa,EAAE,IAAI,CAACrE,IAAI,CAACkD,UAAU,GAAG,CAAC,IAAI,CAAClD,IAAI,CAACkD,UAAU,GAAGY,MAAM,CAAC,GAAG,IAAI;SAC5EQ,WAAW,EAAEC,8BAAQ,CAACC,UAAU;SAChCC,MAAM,EAAE,IAAI;SACZC,UAAU,EAAE,IAAI;SAChBX,SAAS;SACTY,MAAM,EAAE;WACP,CAACC,6BAAe,CAACC,MAAM,GAAIC,KAAgB,IAAK;aAC/C,MAAM;eAAErD;cAAM,GAAGqD,KAAK,CAACC,OAAO,EAAE;aAChC,MAAMzF,MAAM,GAAGiF,8BAAQ,CAACS,iBAAiB,CAACvD,IAAI,CAAC,CAACoB,OAAO,EAAE;aACzD,IAAI,CAACoC,KAAK,CAAC,QAAQ,EAAE3F,MAAM,GAAG6D,8BAAQ,CAACC,SAAS,CAAC9D,MAAM,CAAC,CAAC;YACzD;WACD,CAACsF,6BAAe,CAACM,aAAa,GAAIJ,KAAgB,IAAK;aACtD,IAAI,CAAC,IAAI,CAAC9D,eAAe,EACzB;eACC;;aAGD,MAAM;eAAES;cAAM,GAAGqD,KAAK,CAACC,OAAO,EAAE;aAChC,MAAMI,YAAY,GAAG5C,2BAAa,CACjCd,IAAI,CAACgB,cAAc,EAAE,EACrBhB,IAAI,CAACiB,WAAW,EAAE,EAClBjB,IAAI,CAACkB,UAAU,EAAE,CACjB;aAED,IAAIwC,YAAY,GAAG,IAAI,CAACnE,eAAe,EACvC;eACC8D,KAAK,CAACM,cAAc,EAAE;;;;QAIzB,CAAC;OAEF3B,MAAM,CAAC4B,SAAS,CAAC,KAAK,CAAC,CAACC,SAAS,CAAC,UAAU,EAAGR,KAAgB,IAAK;SACnE,MAAM;WAAEvD,IAAI;WAAEC,KAAK;WAAE+D;UAAK,GAAGT,KAAK,CAACC,OAAO,EAAE;SAC5C,MAAMzF,MAAM,GAAG,IAAIF,IAAI,CAACmC,IAAI,EAAEC,KAAK,EAAE+D,GAAG,CAAC,CAAC1C,OAAO,EAAE;SAEnD,IAAI,CAAC2C,KAAK,EAAE;SACZ,IAAI,CAACC,aAAa,CAACC,wBAAS,CAACC,OAAO,CAACC,QAAQ,CAAC;SAE9C,IAAI,CAACtG,MAAM,GAAGA,MAAM;QACpB,CAAC;OAEFmE,MAAM,CAAC4B,SAAS,CAAC,KAAK,CAAC,CAACC,SAAS,CAAC,SAAS,EAAE,IAAI,CAACO,cAAc,CAAC;OAEjEpC,MAAM,CAAC4B,SAAS,CAAC,MAAM,CAAC,CAACC,SAAS,CAAC,UAAU,EAAGR,KAAgB,IAAK;SACpE,MAAM;WAAEvF,IAAI;WAAEuG;UAAQ,GAAGhB,KAAK,CAACC,OAAO,EAAE;SACxC,IAAIjG,MAAM,CAACiH,SAAS,CAACD,MAAM,CAAC,IAAIvG,IAAI,KAAK,IAAI,CAACA,IAAI,EAClD;WACC,IAAI,CAACiG,KAAK,EAAE;;SAGb,IAAI,CAACjG,IAAI,GAAGA,IAAI;QAChB,CAAC;OAEF,OAAOkE,MAAM;MACb;KACD,MAAMuC,SAAS,CAACpD,SAAkB,EAAEP,QAAiB,GAAG,KAAK,EAAEyC,KAAa,GAAG,IAAI,EACnF;OACC,IAAI,IAAI,CAAC9D,eAAe,EACxB;SACC,IAAI,CAACvB,gBAAgB,GAAG,KAAK;SAC7B,IAAI,CAACC,eAAe,GAAG,IAAI;SAE3B,MAAM,IAAI,CAACuG,SAAS,EAAE;SAEtB,IAAI5D,QAAQ,IAAIyC,KAAK,EACrB;WACC,MAAMoB,aAAa,GAAGpB,KAAK,CAACqB,aAAa;WACzC,IAAID,aAAa,IAAItD,SAAS,EAC9B;aACC,IAAI,CAAClD,eAAe,GAAGwG,aAAa;aACpC,IAAI,CAACzG,gBAAgB,GAAG,IAAI;;WAG7B;;;OAIF,IAAI,CAACJ,UAAU,CAAC+G,YAAY,CAACxD,SAAS,CAAC;MACvC;KACDyD,gBAAgB,CAACzD,SAAiB,EAAEP,QAAiB,GAAG,KAAK,EAC7D;OACC,IAAIA,QAAQ,EACZ;SACC;;OAGD,MAAMZ,IAAI,GAAG,IAAIrC,IAAI,CAACwD,SAAS,CAAC;OAChC,MAAM,CAACrB,IAAI,EAAE+E,KAAK,EAAEf,GAAG,CAAC,GAAG,CAAC9D,IAAI,CAACC,WAAW,EAAE,EAAED,IAAI,CAACE,QAAQ,EAAE,EAAEF,IAAI,CAACG,OAAO,EAAE,CAAC;OAEhF,IAAI,CAACvC,UAAU,CAACkH,UAAU,CAAC,IAAInH,IAAI,CAAE,GAAEkH,KAAK,GAAG,CAAE,IAAGf,GAAI,IAAGhE,IAAK,IAAGgD,8BAAQ,CAACC,UAAW,EAAC,CAAC,CAAC;OAC1F,IAAI,CAACiB,aAAa,CAACC,wBAAS,CAACC,OAAO,CAACa,cAAc,CAAC;OAEpD,IAAI,CAAChB,KAAK,EAAE;MACZ;KACDA,KAAK,GACL;OACC,IAAI,CAACP,KAAK,CAAC,OAAO,CAAC;MACnB;KACDQ,aAAa,CAACgB,OAAe,EAC7B;OAAA;OACChI,gCAAS,CAACiI,eAAe,CAAC,IAAI,CAACjI,SAAS,EAAE;SACzCgI,OAAO;SACP/H,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvBE,MAAM,EAAE+H,cAAI,CAACC,QAAQ,CAAC,IAAI,CAAChI,MAAM,CAAC,GAAG,IAAI,CAACA,MAAM,GAAG,CAAC;SACpDiI,YAAY,qDAAE,IAAI,CAAC7G,IAAI,CAAC8G,WAAW,qBAArB,uBAAuBC,MAAM,oCAAI,CAAC;SAChDC,gBAAgB,qDAAE,IAAI,CAAChH,IAAI,CAACiH,cAAc,qBAAxB,uBAA0BF,MAAM,oCAAI;QACtD,CAAC;MACF;KACD,MAAMlB,cAAc,CAACf,KAAgB,EACrC;OACC,MAAM;SAAEvD,IAAI;SAAEC,KAAK;SAAE+D;QAAK,GAAGT,KAAK,CAACC,OAAO,EAAE;OAC5C,MAAMmC,SAAS,GAAGpC,KAAK,CAACqC,SAAS,EAAE;OAEnC,IAAI,CAAC,IAAI,CAACnG,eAAe,EACzB;SACC;;OAGD,MAAMoG,UAAU,GAAGF,SAAS,CAC1BG,iBAAiB,EAAE,CACnBC,aAAa,CACZ,iCAAgC/F,IAAK,kBAAiBC,KAAM,gBAAe+D,GAAI,IAAG,CACnF;OAEF,IAAI,CAAC6B,UAAU,EACf;SACC;;OAGDG,aAAG,CAACC,KAAK,CAACJ,UAAU,EAAE,QAAQ,EAAE,SAAS,CAAC;OAE1C,IAAI,CAAC3H,gBAAgB,GAAG,KAAK;OAC7B,IAAI,CAACC,eAAe,GAAG,IAAI;OAE3B,MAAM,IAAI,CAACuG,SAAS,EAAE;OAEtB,MAAMwB,WAAW,GAAGlF,2BAAa,CAAChB,IAAI,EAAEC,KAAK,EAAE+D,GAAG,CAAC;OACnD,MAAM/C,UAAU,GAAGD,2BAAa,CAC/B,IAAI,CAACvB,eAAe,CAACyB,cAAc,EAAE,EACrC,IAAI,CAACzB,eAAe,CAAC0B,WAAW,EAAE,EAClC,IAAI,CAAC1B,eAAe,CAAC2B,UAAU,EAAE,CACjC;OAED,IAAI8E,WAAW,GAAGjF,UAAU,EAC5B;SACC,IAAI,CAACnD,UAAU,CAAC+G,YAAY,CAAC,IAAI,CAAC;SAElCmB,aAAG,CAACC,KAAK,CAACJ,UAAU,EAAE,QAAQ,EAAE,SAAS,CAAC;SAE1C,IAAI,CAAC1H,eAAe,GAAG0H,UAAU;SACjC,IAAI,CAAC3H,gBAAgB,GAAG,IAAI;;;IAG9B;GACDiI,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAoCZ,CAAC;;CChZD;AACA,OAAaC,aAAa,GAAG;GAC5BrJ,UAAU,EAAE;YACXsJ,8BAAK;KACLvJ;IACA;GACDM,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACDkE,UAAU,EAAE;OACXrE,IAAI,EAAE,CAACC,MAAM,EAAE,IAAI,CAAC;OACpBE,QAAQ,EAAE;MACV;KACD6I,WAAW,EAAE;OACZhJ,IAAI,EAAEiJ,WAAW;OACjB9I,QAAQ,EAAE;MACV;KACD+I,WAAW,EAAE;OACZlJ,IAAI,EAAEmJ,MAAM;OACZC,OAAO,EAAE;;IAEV;GACDhJ,KAAK,EAAE,CAAC,mBAAmB,EAAE,OAAO,CAAC;GACrCU,QAAQ,EAAE;KACTuI,OAAO,GACP;OAAA;OACC,MAAMC,WAAW,GAAG;SACnBpG,EAAE,EAAG,8BAA6B,IAAI,CAACnD,MAAO,EAAC;SAC/CiJ,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7BO,OAAO,EAAE,EAAE;SACXC,SAAS,EAAE,CAAC;SACZC,UAAU,EAAE,CAAC,GAAG;SAChBC,eAAe,EAAEC,QAAQ,CAACC;QAC1B;OAED,yBAAI,IAAI,CAACV,WAAW,aAAhB,kBAAkBW,CAAC,EACvB;SACC,MAAMC,eAAe,GAAG,IAAI,CAACd,WAAW,CAACe,qBAAqB,EAAE;SAEhET,WAAW,CAACG,UAAU,IAAI,IAAI,CAACP,WAAW,CAACW,CAAC,GAAGC,eAAe,CAACE,IAAI;;OAGpE,OAAOV,WAAW;;IAEnB;GACDtE,OAAO,EAAE;KACRiF,YAAY,CAACxJ,MAAc,EAC3B;OACC,IAAI,CAAC2F,KAAK,CAAC,mBAAmB,EAAE3F,MAAM,CAAC;;IAExC;GACDoI,QAAQ,EAAG;;;;;CAKZ,CAAC;;CCpDD;AACA,CAAO,MAAMqB,yBAAyB,GAAG;GACxCC,IAAI,EAAE,2BAA2B;GACjC1K,UAAU,EAAE;YACX2K,wBAAK;aACLC,0BAAM;eACNC,gCAAQ;YACRvB;IACA;GACDjJ,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACD6I,WAAW,EAAE;OACZhJ,IAAI,EAAEiJ,WAAW;OACjB9I,QAAQ,EAAE;MACV;KACDoK,UAAU,EAAE;OACXvK,IAAI,EAAEE,MAAM;OACZC,QAAQ,EAAE;;IAEX;GACDC,KAAK,EAAE,CAAC,mBAAmB,EAAE,OAAO,CAAC;GACrCC,KAAK,GACL;KACC,OAAO;uBACNmK,wCAAc;mBACdC,oCAAU;gBACVC;MACA;IACD;GACD/J,IAAI,GACJ;KACC,OAAO;OACNgK,OAAO,EAAE,IAAI;OACbC,MAAM,EAAE;MACR;IACD;GACD9J,QAAQ,EAAE;KACTuI,OAAO,GACP;OACC,OAAO;SACNnG,EAAE,EAAG,sCAAqC,IAAI,CAACnD,MAAO,EAAC;SACvD8K,SAAS,EAAE,oCAAoC;SAC/C7B,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7BO,OAAO,EAAE,EAAE;SACXuB,KAAK,EAAE,GAAG;SACVC,MAAM,EAAE,GAAG;SACXtB,UAAU,EAAE,CAAC,EAAE;SACfC,eAAe,EAAEC,QAAQ,CAACC;QAC1B;MACD;KACDoB,MAAM,EAAE;OACPC,GAAG,GACH;SACC,OAAO,IAAI,CAACV,UAAU;QACtB;OACDW,GAAG,CAACC,KAAa,EACjB;SACC,IAAI,CAAC/E,KAAK,CAAC,mBAAmB,EAAE+E,KAAK,CAAC;;;IAGxC;GACDnG,OAAO,EAAE;KACRoG,WAAW,GACX;OACC,IAAI,CAACJ,MAAM,GAAG,EAAE;OAEhB,IAAI,CAAC5E,KAAK,CAAC,OAAO,CAAC;MACnB;KACDiF,UAAU,GACV;OACC,IAAI,IAAI,CAACL,MAAM,KAAK,EAAE,EACtB;SACC;;OAGD,IAAI,CAAC5E,KAAK,CAAC,OAAO,CAAC;;IAEpB;GACDyC,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAgDZ,CAAC;;CC/HD,MAAMyC,aAAa,GAAGC,wBAAc,CAACC,gBAAgB,EAAE;;CAEvD;AACA,CAAO,MAAMC,yBAAyB,GAAG;GACxChM,UAAU,EAAE;aACXiM,+BAAM;WACNC,uBAAI;mBACJC,qDAAY;eACZC;IACA;GACD/L,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACD2L,MAAM,EAAE;OACP9L,IAAI,EAAE+L,QAAQ;OACd5L,QAAQ,EAAE;MACV;KACD6L,QAAQ,EAAE;OACThM,IAAI,EAAE+L,QAAQ;OACd5L,QAAQ,EAAE;;IAEX;GACDC,KAAK,EAAE,CAAC,QAAQ,EAAE,OAAO,CAAC;GAC1BC,KAAK,GACL;KACC,OAAO;mBACN4L;MACA;IACD;GACDtL,IAAI,GACJ;KACC,OAAO;OACNuL,aAAa,EAAE;MACf;IACD;GACDpL,QAAQ,EAAE;KACTqL,QAAQ,EAAE;OACTlB,GAAG,GACH;SACC,OAAO,IAAI,CAACiB,aAAa;QACzB;OACDhB,GAAG,CAACgB,aAAqB,EACzB;SACC,IAAI,CAAC9F,KAAK,CAAC,QAAQ,EAAE8F,aAAa,CAAC;;MAEpC;KACD/K,IAAI,GACJ;OACC,OAAOC,iDAAW,CAACC,YAAY,CAAC,IAAI,CAACtB,MAAM,CAAC;MAC5C;KACD0C,OAAO,GACP;OAAA;OACC,MAAM2J,WAAW,GAAG,kBAAI,CAACjL,IAAI,aAAT,WAAWkL,eAAe,GAAG3G,8BAAQ,CAAC4G,eAAe,GAAGhB,aAAa,CAACiB,CAAC;OAE3F,OAAO,CACN;SACCJ,QAAQ,EAAEC,WAAW;SACrBjJ,KAAK,EAAE,IAAIoI,wBAAc,CAACD,aAAa,CAACiB,CAAC,CAAC,CAACvJ,MAAM;QACjD,EACD;SACCmJ,QAAQ,EAAEC,WAAW,GAAG,CAAC;SACzBjJ,KAAK,EAAE,IAAIoI,wBAAc,CAACD,aAAa,CAACiB,CAAC,GAAG,CAAC,CAAC,CAACvJ,MAAM;QACrD,EACD;SACCmJ,QAAQ,EAAEC,WAAW,GAAG,CAAC;SACzBjJ,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,0BAA0B;QAC1C,EACD;SACC+I,QAAQ,EAAEC,WAAW,GAAG,EAAE;SAC1BjJ,KAAK,EAAE,IAAI,CAACC,GAAG,CAAC,6BAA6B;QAC7C,CACD;;IAEF;GACDe,OAAO,GACP;KAAA;KACC,IAAI,CAAC+H,aAAa,kBAAG,IAAI,CAAC/K,IAAI,qBAAT,YAAW+K,aAAa;IAC7C;GACDlH,OAAO,EAAE;KACRwH,WAAW,CAACL,QAAgB,EAC5B;OACC,IAAI,CAACA,QAAQ,GAAGA,QAAQ;OACxB,IAAI,CAAC/F,KAAK,CAAC,OAAO,CAAC;;IAEpB;GACDyC,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;CAuBZ,CAAC;;CCrHD;AACA,OAAa4D,kBAAkB,GAAG;GACjChN,UAAU,EAAE;YACXsJ,8BAAK;KACL0C;IACA;GACD3L,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACD+L,aAAa,EAAE;OACdlM,IAAI,EAAE,CAACC,MAAM,EAAE,IAAI,CAAC;OACpBE,QAAQ,EAAE;MACV;KACD6I,WAAW,EAAE;OACZhJ,IAAI,EAAEiJ,WAAW;OACjB9I,QAAQ,EAAE;;IAEX;GACDC,KAAK,EAAE,CAAC,sBAAsB,EAAE,OAAO,CAAC;GACxCU,QAAQ,EAAE;KACTuI,OAAO,GACP;OACC,OAAO;SACNnG,EAAE,EAAG,oCAAmC,IAAI,CAACnD,MAAO,EAAC;SACrDiJ,WAAW,EAAE,IAAI,CAACA,WAAW;SAC7B8B,KAAK,EAAE,GAAG;SACVvB,OAAO,EAAE,EAAE;SACXC,SAAS,EAAE,CAAC;SACZE,eAAe,EAAEC,QAAQ,CAACC;QAC1B;;IAEF;GACD5E,OAAO,EAAE;KACRiF,YAAY,CAACxJ,MAAc,EAC3B;OACC,IAAI,CAAC2F,KAAK,CAAC,sBAAsB,EAAE3F,MAAM,CAAC;;IAE3C;GACDoI,QAAQ,EAAG;;;;;;;;;CASZ,CAAC;;OCpDY6D,YAAY,GAAGvD,MAAM,CAAC2C,MAAM,CAAC;GACzC5I,EAAE,EAAEyJ,wBAAS,CAACC,QAAQ;GACtBzJ,KAAK,EAAE0J,aAAG,CAACC,UAAU,CAAC,yBAAyB;CAChD,CAAC,CAAC;;CCwBF;AACA,OAAaF,QAAQ,GAAG;GACvBnN,UAAU,EAAE;aACXsN,+BAAM;cACNC,gCAAO;WACPtN,qCAAI;gBACJuN,+CAAS;YACT7C,wBAAK;KACLtB,aAAa;KACb2D,kBAAkB;KAClBvC,yBAAyB;oBACzBgD,uDAAa;wBACbC;IACA;GACDC,UAAU,EAAE;WAAEC;IAAM;GACpBvN,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACDmN,UAAU,EAAE;OACXtN,IAAI,EAAEuN,OAAO;OACbnE,OAAO,EAAE;MACT;KACDoE,YAAY,EAAE;OACbxN,IAAI,EAAEuN,OAAO;OACbnE,OAAO,EAAE;MACT;KACDqE,SAAS,EAAE;OACVzN,IAAI,EAAEuN,OAAO;OACbnE,OAAO,EAAE;MACT;KACDsE,OAAO,EAAE;OACR1N,IAAI,EAAEuN,OAAO;OACbnE,OAAO,EAAE;;IAEV;GACDhJ,KAAK,EAAE,CAAC,sBAAsB,CAAC;GAC/BC,KAAK,GACL;KACC,OAAO;OACNqM;MACA;IACD;GACD/L,IAAI,GACJ;KACC,OAAO;OACNgN,KAAK,EAAEpN,IAAI,CAACqN,GAAG,EAAE;OACjBC,YAAY,EAAE,KAAK;OACnBC,oBAAoB,EAAE,KAAK;OAC3BC,mBAAmB,EAAE,KAAK;OAC1BC,wBAAwB,EAAE,KAAK;OAC/BvN,MAAM,EAAE,IAAI;OACZwN,mBAAmB,EAAE,IAAI;OACzB/E,WAAW,EAAE,IAAI;OACjBgF,YAAY,EAAE,IAAI;OAClBC,YAAY,EAAE;MACd;IACD;GACDrN,QAAQ,EAAE;KACT,GAAGC,uBAAU,CAAC;OACbqN,mBAAmB,EAAG,GAAEnN,oBAAK,CAACC,SAAU;MACxC,CAAC;KACFC,IAAI,GACJ;OACC,OAAOC,iDAAW,CAACC,YAAY,CAAC,IAAI,CAACtB,MAAM,CAAC;MAC5C;KACDuB,MAAM,GACN;OACC,OAAOC,4BAAO,CAACC,MAAM,CAAC,IAAI,CAACzB,MAAM,CAAC;MAClC;KACDsE,UAAU,GACV;OAAA;OACC,uBAAO,IAAI,CAAC5D,MAAM,2BAAK,IAAI,CAAC6M,UAAU,GAAG,IAAI,CAACnM,IAAI,CAAC+K,aAAa,GAAG,IAAI,CAAC/K,IAAI,CAACkD,UAAU;MACvF;KACDgK,eAAe,GACf;OACC,MAAMC,WAAW,GAAG,IAAI,CAACnN,IAAI,CAACoN,MAAM,KAAKC,yBAAU,CAACC,SAAS;OAC7D,MAAMC,YAAY,GAAG,IAAI,CAACpB,UAAU,IAAI,CAAC,IAAI,CAACjJ,UAAU,IAAI,IAAI,CAACsK,iBAAiB,IAAIL,WAAW;OAEjG,OAAOI,YAAY,GAAG,CAAC,GAAG,IAAI,CAACf,KAAK,GAAG,IAAI,CAACtJ,UAAU;MACtD;KACDuK,SAAS,GACT;OACC,OAAO,IAAI,CAACP,eAAe,GAAG,CAAC;MAC/B;KACDQ,gBAAgB,GAChB;OACC,OAAO,IAAI,CAACzL,GAAG,CAAC,2BAA2B,EAAE;SAC5C,oBAAoB,EAAE,IAAImI,wBAAc,CAAC,IAAI,CAAC8C,eAAe,CAAC,CAACS,aAAa;QAC5E,CAAC;MACF;KACDC,iBAAiB,GACjB;OACC,IAAI,IAAI,CAACJ,iBAAiB,EAC1B;SACC,OAAO,IAAI,CAACvL,GAAG,CAAC,wBAAwB,CAAC;;OAG1C,IAAI,CAAC,IAAI,CAACiB,UAAU,EACpB;SACC,OAAO,IAAI,CAACjB,GAAG,CAAC,yBAAyB,CAAC;;OAG3C,IAAI,IAAI,CAACkK,UAAU,EACnB;SACC,OAAO5H,8BAAQ,CAACsJ,cAAc,CAAC,IAAI,CAAC3K,UAAU,EAAE,IAAI,CAAClD,IAAI,CAACkL,eAAe,CAAC;;OAG3E,IAAI,IAAI,CAACuC,SAAS,IAAI,IAAI,CAAClB,OAAO,EAClC;SACC,OAAO,IAAI,CAACtK,GAAG,CAAC,qCAAqC,EAAE;WACtD,YAAY,EAAE,IAAImI,wBAAc,CAAC,IAAI,CAAC8C,eAAe,CAAC,CAACS,aAAa;UACpE,CAAC;;OAGH,OAAOpJ,8BAAQ,CAACuJ,cAAc,CAAC,IAAI,CAAC5K,UAAU,CAAC;MAC/C;KACD6K,QAAQ,GACR;OACC,OAAO,IAAI,CAACP,iBAAiB,GAAGjE,0BAAO,CAACyE,UAAU,GAAGzE,0BAAO,CAAC0E,mBAAmB;MAChF;KACDpG,WAAW,GACX;OAAA;OACC,gCAAO,IAAI,CAACiF,mBAAmB,oCAAI,IAAI,CAACtJ,KAAK,CAAC0K,QAAQ,CAACC,GAAG;MAC1D;KACDX,iBAAiB,GACjB;OACC,OAAO,CAAC,IAAI,CAACrN,MAAM,IAAI,IAAI,CAACH,IAAI,CAACoO,MAAM,GAAG,CAAC;MAC3C;KACDC,iBAAiB,GACjB;OACC,MAAMC,QAAQ,GAAG7N,kBAAI,CAACC,SAAS,EAAE,CAAC4N,QAAQ;OAC1C,IAAI,CAACA,QAAQ,CAACC,WAAW,EACzB;SACC,OAAO,KAAK;;OAGb,OAAO,IAAI,CAACvO,IAAI,CAACW,MAAM,CAACI,IAAI;MAC5B;KACDyN,QAAQ,GACR;OACC,OAAO,CAAC,IAAI,CAACxO,IAAI,CAACW,MAAM,CAACuN,QAAQ,IAAI,IAAI,CAACO,mBAAmB,IAAI,IAAI,CAACjB,iBAAiB;MACvF;KACD1M,kCAAkC,GAClC;OACC,MAAMR,SAAS,GAAGG,kBAAI,CAACC,SAAS,EAAE,CAACgO,WAAW,CAAC3M,EAAE,KAAK,IAAI,CAAC/B,IAAI,CAACO,SAAS;OAEzE,OAAO,CAAC,IAAI,CAACJ,MAAM,IAAIG,SAAS,IAAI,IAAI,CAACN,IAAI,CAACW,MAAM,CAACI,IAAI,IAAIN,kBAAI,CAACC,SAAS,EAAE,CAACC,MAAM,CAACC,IAAI,CAACC,KAAK;MAC/F;KACD8N,mBAAmB,GACnB;OACC,OAAO,IAAI,CAAC3O,IAAI,CAAC4O,2BAA2B,IAAI,CAAC,IAAI,CAAC9N,kCAAkC;MACxF;KACD2N,mBAAmB,GACnB;OACC,IAAI,IAAI,CAACtC,UAAU,IAAI,IAAI,CAACrL,kCAAkC,IAAI,CAAC,IAAI,CAACd,IAAI,CAAC6O,kBAAkB,EAC/F;SACC,OAAO,KAAK;;OAGb,OAAO,IAAI,CAAC5B,mBAAmB,IAAI,IAAI,CAACjN,IAAI,CAAC6O,kBAAkB;MAC/D;KACDC,gBAAgB,GAChB;OACC,IAAI,CAAC,IAAI,CAAC3O,MAAM,IAAI,CAAC,IAAI,CAACqO,QAAQ,IAAI,IAAI,CAACC,mBAAmB,EAC9D;SACC,OAAO,IAAI;;OAGZ,OAAO,MAAkBM,wCAAO,CAAC;SAChCC,IAAI,EAAE,IAAI,CAAC/M,GAAG,CAAC,mCAAmC,CAAC;SACnDgN,YAAY,EAAE;WACbtF,KAAK,EAAE,GAAG;WACVrB,UAAU,EAAE,IAAI,CAAC4G,eAAe,GAAG;;QAEpC,CAAC;MACF;KACDxP,eAAe,GACf;OAAA;OACC,0DAAO,IAAI,CAAC8D,KAAK,CAAC2L,YAAY,qBAAvB,uBAAyBhB,GAAG,4DAAI,IAAI,CAAC3K,KAAK,CAAC0K,QAAQ,qBAAnB,qBAAqBC,GAAG;MAC/D;KACDe,eAAe,GACf;OACC,OAAO,IAAI,CAACxP,eAAe,CAAC0P,WAAW,GAAG,CAAC;;IAE5C;GACDC,KAAK,EAAE;KACN1C,oBAAoB,CAAC3C,KAAK,EAC1B;OACC,IAAI,CAAC/E,KAAK,CAAC,sBAAsB,EAAE+E,KAAK,CAAC;;IAE1C;GACD1G,OAAO,GACP;KACCgM,8CAAgB,CAACC,OAAO,CAAC,IAAI,CAAC/L,KAAK,CAACgM,SAAS,CAAC;KAC9C,IAAI,CAACC,aAAa,GAAGC,WAAW,CAAC,MAAM;OACtC,IAAI,CAAClD,KAAK,GAAGpN,IAAI,CAACqN,GAAG,EAAE;MACvB,EAAE,IAAI,CAAC;KAERkD,6BAAY,CAACrK,SAAS,CAACsK,wBAAS,CAACC,kBAAkB,EAAE,IAAI,CAACC,6BAA6B,CAAC;IACxF;GACD9M,OAAO,GACP;KACC,IAAI,CAAC+M,iBAAiB,GAAGC,iBAAO,CAACC,QAAQ,CAAC,IAAI,CAACC,SAAS,EAAE,GAAG,CAAC;IAC9D;GACDC,OAAO,GACP;KACCb,8CAAgB,CAACC,OAAO,CAAC,IAAI,CAAC/L,KAAK,CAACgM,SAAS,CAAC;IAC9C;GACD7L,aAAa,GACb;KACCyM,aAAa,CAAC,IAAI,CAACX,aAAa,CAAC;KAEjCE,6BAAY,CAACU,WAAW,CAACT,wBAAS,CAACC,kBAAkB,EAAE,IAAI,CAACC,6BAA6B,CAAC;IAC1F;GACDjM,OAAO,EAAE;KACRiM,6BAA6B,CAAChL,KAAgB,EAC9C;OACC,MAAM;SAAElG,MAAM;SAAEiJ,WAAW;SAAEE;QAAa,GAAGjD,KAAK,CAACC,OAAO,EAAE;OAE5D,IAAIjG,MAAM,CAACF,MAAM,CAAC,KAAKE,MAAM,CAAC,IAAI,CAACF,MAAM,CAAC,EAC1C;SACC,IAAI,CAAC0R,SAAS,CAACzI,WAAW,EAAEE,WAAW,CAAC;;MAEzC;KACDwI,WAAW,GACX;OACC,IAAI,CAAC,IAAI,CAAC/B,QAAQ,EAClB;SACC,IAAI,CAAC8B,SAAS,EAAE;;MAEjB;KACDA,SAAS,CAACzI,WAAwB,EAAEE,WAAqC,EACzE;OACC,IAAI,CAACzI,MAAM,GAAG,IAAI,CAAC4D,UAAU;OAC7B,IAAI,CAAC4J,mBAAmB,GAAGjF,WAAW;OACtC,IAAI,CAACE,WAAW,GAAGA,WAAW;OAC9B,IAAI,CAAC2E,YAAY,GAAG,IAAI;MACxB;KACD8D,gBAAgB,GAChB;OACC,IAAI,IAAI,CAAC7B,mBAAmB,EAC5B;SACC,IAAI,CAAC9B,wBAAwB,GAAG,IAAI;SAEpC,IAAI,CAACE,YAAY,GAAG,IAAI,CAAC0D,aAAa;QACtC,MAED;SACC,KAAK,IAAI,CAACA,aAAa,EAAE;;MAE1B;KACDxG,WAAW,GACX;OAAA;OACC,IAAI,IAAI,CAAC0E,mBAAmB,IAAI,IAAI,CAACrP,MAAM,EAC3C;SACC,IAAI,CAACuN,wBAAwB,GAAG,IAAI;SAEpC,IAAI,CAACE,YAAY,GAAG,IAAI,CAAC2D,YAAY;QACrC,MAED;SACC,KAAK,IAAI,CAACA,YAAY,EAAE;;OAGzB,IAAI,CAAChE,YAAY,GAAG,KAAK;OACzB,6BAAI,CAAClJ,KAAK,CAAC0K,QAAQ,8CAAnB,sBAAqBC,GAAG,qBAAxB,sBAA0BwC,KAAK,EAAE;MACjC;KACD,MAAMC,4BAA4B,GAClC;OACC,IAAI,CAAC/D,wBAAwB,GAAG,KAAK;OAErC,MAAM,IAAI,CAACE,YAAY,EAAE;OAEzB,IAAI,CAACA,YAAY,GAAG,IAAI;MACxB;KACD8D,aAAa,CAAC/L,KAAoB,EAClC;OACC,IAAIA,KAAK,CAACgM,GAAG,KAAK,OAAO,IAAI,EAAEhM,KAAK,CAACiM,OAAO,IAAIjM,KAAK,CAACkM,OAAO,CAAC,EAC9D;SACC,KAAK,IAAI,CAACT,WAAW,EAAE;;MAExB;KACD,MAAMG,YAAY,GAClB;OACC,IAAI,IAAI,CAAC/B,mBAAmB,IAAI,IAAI,CAAC3B,YAAY,KAAK,EAAE,EACxD;SACC;;OAGD,IAAI,IAAI,CAAC1N,MAAM,EACf;SACC,MAAM,IAAI,CAAC2R,WAAW,CAAC,IAAI,CAAC3R,MAAM,CAAC;;OAGpC,IAAI,CAAC,IAAI,CAAC6M,UAAU,IAAI,CAAC,IAAI,CAACrL,kCAAkC,IAAI,IAAI,CAACd,IAAI,CAAC6O,kBAAkB,EAChG;SACC,KAAKqC,yDAAe,CAACC,yBAAyB,CAAC,IAAI,CAACnR,IAAI,CAAC+B,EAAE,CAAC;;MAE7D;KACD,MAAM0O,aAAa,GACnB;OACC,IAAI,IAAI,CAAC9B,mBAAmB,IAAI,IAAI,CAAC3B,YAAY,KAAK,EAAE,EACxD;SACC;;OAGD,MAAM,IAAI,CAACiE,WAAW,CAAC,CAAC,CAAC;MACzB;KACD,MAAMA,WAAW,CAAC3R,MAAc,EAChC;OACC,IAAI,CAACA,MAAM,GAAGA,MAAM;OACpB,IAAI,IAAI,CAAC6M,UAAU,EACnB;SACC,MAAMlM,iDAAW,CAACmR,MAAM,CAAC,IAAI,CAACxS,MAAM,EAAE;WAAEmM,aAAa,EAAEzL;UAAQ,CAAC;QAChE,MAED;SAAA;SACC,MAAM+R,MAAM,GAAG,MAAMpR,iDAAW,CAACmR,MAAM,CAAC,IAAI,CAACxS,MAAM,EAAE;WACpDsE,UAAU,EAAE5D,MAAM;WAClBgS,oBAAoB,EAAE,IAAI,CAACtE;UAC3B,CAAC;SAEF,6BAAIqE,MAAM,CAACE,uBAAQ,CAACC,kBAAkB,CAAC,aAAnC,sBAAqCzK,MAAM,EAC/C;WACC,MAAM0K,KAAK,GAAGJ,MAAM,CAACE,uBAAQ,CAACC,kBAAkB,CAAC,CAAC,CAAC,CAAC;WAEpD,IAAI,CAACzB,iBAAiB,CAAC0B,KAAK,CAAC;WAE7B,IAAI,CAACnS,MAAM,GAAG,IAAI,CAACU,IAAI,CAACkD,UAAU;;;MAGpC;KACDgN,SAAS,CAACuB,KAAK,EACf;OACCC,+BAAQ,CAACC,wBAAwB,CAAC;SACjC5P,EAAE,EAAE,mCAAmC;SACvCiN,IAAI,EAAEyC,KAAK,oBAALA,KAAK,CAAEG;QACb,CAAC;;IAEH;GACDlK,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA6EZ,CAAC;;;;;;;;;;;"}