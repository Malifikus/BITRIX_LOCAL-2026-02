this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Provider=this.BX.Tasks.V2.Provider||{};(function(e,s,t,i,r,d,n){"use strict";function a(e){return{id:e.id,taskId:e.taskId,userId:e.userId,nextRemindTs:c(e.nextRemindTs,Math.floor(e.nextRemindTs/1e3)),remindBy:e.remindBy,remindVia:e.remindVia,recipient:e.recipient,before:c(e.before,Math.floor(e.before/1e3))}}function o(e){var s;return{id:e.id,taskId:e.taskId,userId:e.userId,nextRemindTs:c(e.nextRemindTs,e.nextRemindTs*1e3),remindBy:e.remindBy,remindVia:e.remindVia,recipient:e.recipient,before:c((s=e.before)!=null?s:undefined,e.before*1e3)}}function c(e,t){return s.Type.isUndefined(e)?undefined:t}var l=babelHelpers.classPrivateFieldLooseKey("cache");class m{constructor(){Object.defineProperty(this,l,{writable:true,value:{}})}async list(e){if(babelHelpers.classPrivateFieldLooseBase(this,l)[l][e]||!Number.isInteger(e)){return}babelHelpers.classPrivateFieldLooseBase(this,l)[l][e]=true;try{const s=await d.apiClient.post(i.Endpoint.TaskReminderList,{taskId:e});await this.$store.dispatch(`${i.Model.Reminders}/upsertMany`,s.map((e=>o(e))))}catch(e){console.error("Reminder.list",e)}}async set(e,s){void n.taskService.updateStoreTask(e,{numberOfReminders:s.length});void this.$store.dispatch(`${i.Model.Reminders}/upsertMany`,s.map((s=>({...s,taskId:e}))));try{const t=n.TaskMappers.mapModelToDto({id:e,reminders:s});await d.apiClient.post(i.Endpoint.TaskReminderSet,{task:t});await this.$store.dispatch(`${i.Model.Reminders}/deleteMany`,s.map((({id:e})=>e)))}catch(e){console.error("Reminder.set",e)}}async add(e){const s=n.taskService.getStoreTask(e.taskId);void n.taskService.updateStoreTask(e.taskId,{numberOfReminders:s.numberOfReminders+1});void this.$store.dispatch(`${i.Model.Reminders}/upsert`,e);if(!r.idUtils.isReal(e.taskId)){return}try{const s=await d.apiClient.post(i.Endpoint.TaskReminderAdd,{reminder:a(e)});void this.$store.dispatch(`${i.Model.Reminders}/update`,{id:e.id,fields:o(s)})}catch(e){console.error("Reminder.add",e)}}async update(e){const{id:s,...t}=e;const n=this.$store.getters[`${i.Model.Reminders}/getById`](s);if(JSON.stringify(n)===JSON.stringify(e)){return}void this.$store.dispatch(`${i.Model.Reminders}/update`,{id:s,fields:t});if(!r.idUtils.isReal(s)){return}try{await d.apiClient.post(i.Endpoint.TaskReminderUpdate,{reminder:a(e)})}catch(e){console.error("Reminder.add",e)}}async delete(e){const s=this.$store.getters[`${i.Model.Reminders}/getById`](e);const t=n.taskService.getStoreTask(s.taskId);void n.taskService.updateStoreTask(s.taskId,{numberOfReminders:t.numberOfReminders-1});void this.$store.dispatch(`${i.Model.Reminders}/delete`,e);if(!r.idUtils.isReal(s.taskId)){return}try{await d.apiClient.post(i.Endpoint.TaskReminderDelete,{reminder:{id:e}})}catch(e){console.error("Reminder.delete",e)}}get $store(){return t.Core.getStore()}}const p=new m;const k={mapModelToDto:a,mapDtoToModel:o};e.remindersService=p;e.RemindersMappers=k})(this.BX.Tasks.V2.Provider.Service=this.BX.Tasks.V2.Provider.Service||{},BX,BX.Tasks.V2,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=reminders-service.bundle.map.js