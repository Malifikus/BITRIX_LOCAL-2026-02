{"version":3,"file":"relation-tasks-dialog.bundle.js","sources":["../src/relation-tasks-dialog.js","../src/meta.js","../src/index.js"],"sourcesContent":["import { Event, Tag } from 'main.core';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\n\nimport { TaskCard } from 'tasks.v2.application.task-card';\nimport { Core } from 'tasks.v2.core';\nimport { Model, EntitySelectorEntity, EventName, Analytics } from 'tasks.v2.const';\nimport { EntitySelectorDialog, type Item, type ItemId } from 'tasks.v2.lib.entity-selector-dialog';\nimport { relationError } from 'tasks.v2.lib.relation-error';\nimport { idUtils, type TaskId } from 'tasks.v2.lib.id-utils';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport type { RelationDialogMeta } from './types';\n\ntype Params = {\n\ttargetNode: HTMLElement,\n\ttargetContainer: HTMLElement,\n\ttaskId: TaskId,\n\tids: number[],\n\tonClose: Function,\n\tonUpdate: Function,\n\tanalytics: Object,\n};\n\nexport class RelationTasksDialog\n{\n\t#dialogs: { [taskId: TaskId]: EntitySelectorDialog } = {};\n\t#meta: RelationDialogMeta;\n\n\t#taskId: TaskId;\n\t#ids: number[];\n\t#onClose: Function | null;\n\t#onUpdate: Function | null;\n\t#analytics: Object | null;\n\n\tconstructor(meta: RelationDialogMeta)\n\t{\n\t\tthis.#meta = meta;\n\n\t\tEventEmitter.subscribe(EventName.TaskAdded, (event: BaseEvent) => {\n\t\t\tconst task: TaskModel = event.getData().task;\n\n\t\t\tthis.#addTaskItems([task.id]);\n\t\t});\n\n\t\tEventEmitter.subscribe(EventName.TaskDeleted, (event: BaseEvent) => {\n\t\t\tconst task: TaskModel = event.getData();\n\n\t\t\tthis.#deleteTaskItems([task.id]);\n\t\t});\n\t}\n\n\tshow(params: Params): void\n\t{\n\t\tthis.#ids = params.ids;\n\t\tthis.#taskId = params.taskId;\n\t\tthis.#onClose = params.onClose;\n\t\tthis.#onUpdate = params.onUpdate;\n\t\tthis.#analytics = params.analytics;\n\n\t\tif (!this.#ids && !this.#meta.service.areIdsLoaded(this.#taskId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#ids && this.dialog.isLoaded())\n\t\t{\n\t\t\tthis.#addTaskItems(this.#task[this.#meta.idsField]);\n\t\t\tthis.dialog.setSelectableByIds(this.#selectableItems);\n\t\t}\n\n\t\tthis.dialog.selectItemsByIds(this.#items);\n\t\tthis.dialog.getPopup().setTargetContainer(params.targetContainer);\n\t\tthis.dialog.showTo(params.targetNode);\n\t}\n\n\tget dialog(): EntitySelectorDialog\n\t{\n\t\tthis.#dialogs[this.#taskId] ??= this.#createDialog();\n\n\t\treturn this.#dialogs[this.#taskId];\n\t}\n\n\t#createDialog(): EntitySelectorDialog\n\t{\n\t\treturn new EntitySelectorDialog({\n\t\t\tcontext: 'tasks-card',\n\t\t\tmultiple: !this.#ids,\n\t\t\tenableSearch: true,\n\t\t\twidth: 500,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: this.#entityId,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\twithFooter: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tpreselectedItems: this.#items,\n\t\t\tevents: {\n\t\t\t\tonLoad: (): void => {\n\t\t\t\t\tconst titles = this.dialog.getItems().map((item: Item): TaskModel => ({\n\t\t\t\t\t\tid: this.#isTemplate ? idUtils.boxTemplate(item.getId()) : item.getId(),\n\t\t\t\t\t\ttitle: item.getTitle().replace(new RegExp(`\\\\[${item.getId()}\\\\]$`), ''),\n\t\t\t\t\t}));\n\n\t\t\t\t\tvoid Core.getStore().dispatch(`${Model.Tasks}/setTitles`, titles);\n\t\t\t\t},\n\t\t\t},\n\t\t\tpopupOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: (): void => {\n\t\t\t\t\t\tthis.#onClose?.(this.dialog.getSelectedItems());\n\t\t\t\t\t\tif (this.dialog.isLoaded() && !this.#ids)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvoid this.#updateTask();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\tfooter: this.#isTemplate ? null : this.#createFooter(),\n\t\t});\n\t}\n\n\t#createFooter(): ?HTMLElement\n\t{\n\t\tconst footer = Tag.render`\n\t\t\t<span class=\"ui-selector-footer-link ui-selector-footer-link-add\">${this.#meta.footerText}</span>\n\t\t`;\n\n\t\tEvent.bind(footer, 'click', this.#clickCreate.bind(this));\n\n\t\treturn footer;\n\t}\n\n\t#clickCreate(): void\n\t{\n\t\tTaskCard.showCompactCard({\n\t\t\ttitle: this.dialog.getTagSelector()?.getTextBoxValue(),\n\t\t\tgroupId: this.#task.groupId,\n\t\t\t[this.#meta.relationToField]: this.#taskId,\n\t\t\tanalytics: {\n\t\t\t\tcontext: this.#analytics?.context ?? Analytics.Section.Tasks,\n\t\t\t\tadditionalContext: Analytics.SubSection.TaskCard,\n\t\t\t\telement: Analytics.Element.CreateButton,\n\t\t\t},\n\t\t});\n\n\t\tthis.dialog.clearSearch();\n\t\tthis.dialog.freeze();\n\n\t\tconst unfreeze = () => {\n\t\t\tthis.dialog.unfreeze();\n\t\t\tEventEmitter.unsubscribe(EventName.CardClosed, unfreeze);\n\t\t\tEventEmitter.unsubscribe(EventName.FullCardClosed, unfreeze);\n\n\t\t\tif (this.#ids)\n\t\t\t{\n\t\t\t\tthis.dialog.hide();\n\t\t\t}\n\t\t};\n\n\t\tEventEmitter.subscribe(EventName.CardClosed, unfreeze);\n\t\tEventEmitter.subscribe(EventName.FullCardClosed, unfreeze);\n\t}\n\n\t#addTaskItems(ids: number[]): void\n\t{\n\t\tif (!this.dialog || this.#isTemplate)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst itemIds = new Set(this.dialog.getItems().map((it) => it.getId()));\n\t\tids.filter((id) => !itemIds.has(id)).forEach((id: number) => {\n\t\t\tconst task = taskService.getStoreTask(id);\n\t\t\tthis.dialog.addItem({\n\t\t\t\tid,\n\t\t\t\tentityId: EntitySelectorEntity.Task,\n\t\t\t\ttitle: task.title,\n\t\t\t\tselected: true,\n\t\t\t\tsort: 0,\n\t\t\t\ttabs: ['recents'],\n\t\t\t});\n\t\t});\n\t}\n\n\t#deleteTaskItems(ids: number[]): void\n\t{\n\t\tif (!this.dialog || this.#isTemplate)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tids.forEach((id: number) => this.dialog.removeItem([EntitySelectorEntity.Task, id]));\n\t}\n\n\tasync #updateTask(): Promise<void>\n\t{\n\t\tconst currentTaskIds = this.#task[this.#meta.idsField];\n\t\tconst newTaskIds = this.dialog.getSelectedItems().map((item) => {\n\t\t\treturn this.#isTemplate ? idUtils.boxTemplate(item.getId()) : item.getId();\n\t\t});\n\n\t\tconst idsToDelete = currentTaskIds.filter((id) => !newTaskIds.includes(id));\n\t\tconst idsToAdd = newTaskIds.filter((id) => !currentTaskIds.includes(id));\n\n\t\tif (idsToDelete.length > 0 || idsToAdd.length > 0)\n\t\t{\n\t\t\tawait Promise.all([\n\t\t\t\tthis.#meta.service.delete(this.#taskId, idsToDelete),\n\t\t\t\tthis.#add(idsToAdd),\n\t\t\t]);\n\n\t\t\tthis.#onUpdate?.();\n\t\t}\n\t}\n\n\tasync #add(ids: number[]): Promise<void>\n\t{\n\t\tconst error = await this.#meta.service.add(this.#taskId, ids);\n\n\t\tif (error)\n\t\t{\n\t\t\tvoid relationError.setTaskId(this.#taskId).showError(error, this.#meta.id);\n\t\t}\n\t}\n\n\tget #selectableItems(): { selectable: ItemId[], unselectable: ItemId[] }\n\t{\n\t\tconst selectableIds = [];\n\t\tconst unselectableIds = [];\n\n\t\tthis.#task[this.#meta.idsField].forEach((id: number) => {\n\t\t\tconst task = taskService.getStoreTask(id);\n\t\t\tif (!task || task.rights.detachParent || task.rights.detachRelated)\n\t\t\t{\n\t\t\t\tselectableIds.push(id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tunselectableIds.push(id);\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tselectable: this.#mapIdsToItemIds(selectableIds),\n\t\t\tunselectable: this.#mapIdsToItemIds(unselectableIds),\n\t\t};\n\t}\n\n\tget #items(): ItemId[]\n\t{\n\t\treturn this.#mapIdsToItemIds(this.#ids ?? this.#task?.[this.#meta.idsField] ?? []);\n\t}\n\n\t#mapIdsToItemIds(ids: number[]): ItemId[]\n\t{\n\t\treturn ids.map((id: number) => [this.#entityId, idUtils.unbox(id)]);\n\t}\n\n\tget #entityId(): string\n\t{\n\t\treturn this.#isTemplate ? EntitySelectorEntity.Template : EntitySelectorEntity.Task;\n\t}\n\n\tget #isTemplate(): boolean\n\t{\n\t\treturn this.#meta.isTemplate && idUtils.isTemplate(this.#taskId);\n\t}\n\n\tget #task(): TaskModel\n\t{\n\t\treturn taskService.getStoreTask(this.#taskId);\n\t}\n}\n","import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\nimport { relatedTasksService, subTasksService } from 'tasks.v2.provider.service.relation-service';\nimport type { RelationDialogMeta } from './types';\n\nexport const subTasksMeta: RelationDialogMeta = Object.freeze({\n\tid: TaskField.SubTasks,\n\tidsField: 'subTaskIds',\n\trelationToField: 'parentId',\n\tfooterText: Loc.getMessage('TASKS_V2_SUB_TASKS_CREATE'),\n\tservice: subTasksService,\n\tisTemplate: true,\n});\n\nexport const relatedTasksMeta: RelationDialogMeta = Object.freeze({\n\tid: TaskField.RelatedTasks,\n\tidsField: 'relatedTaskIds',\n\trelationToField: 'relatedToTaskId',\n\tfooterText: Loc.getMessage('TASKS_V2_RELATED_TASKS_CREATE'),\n\tservice: relatedTasksService,\n});\n\nexport const ganttMeta: RelationDialogMeta = Object.freeze({\n\tfooterText: Loc.getMessage('TASKS_V2_GANTT_CREATE'),\n});\n","export { Item } from 'tasks.v2.lib.entity-selector-dialog';\nimport { RelationTasksDialog } from './relation-tasks-dialog';\nimport { subTasksMeta, relatedTasksMeta, ganttMeta } from './meta';\n\nexport const subTasksDialog = new RelationTasksDialog(subTasksMeta);\nexport const relatedTasksDialog = new RelationTasksDialog(relatedTasksMeta);\nexport const ganttDialog = new RelationTasksDialog(ganttMeta);\nexport type { RelationTasksDialog };\n"],"names":["RelationTasksDialog","constructor","meta","EventEmitter","subscribe","EventName","TaskAdded","event","task","getData","id","TaskDeleted","show","params","ids","taskId","onClose","onUpdate","analytics","service","areIdsLoaded","dialog","isLoaded","idsField","setSelectableByIds","selectItemsByIds","getPopup","setTargetContainer","targetContainer","showTo","targetNode","EntitySelectorDialog","context","multiple","enableSearch","width","entities","options","withFooter","preselectedItems","events","onLoad","titles","getItems","map","item","idUtils","boxTemplate","getId","title","getTitle","replace","RegExp","Core","getStore","dispatch","Model","Tasks","popupOptions","getSelectedItems","footer","Tag","render","footerText","Event","bind","TaskCard","showCompactCard","getTagSelector","getTextBoxValue","groupId","relationToField","Analytics","Section","additionalContext","SubSection","element","Element","CreateButton","clearSearch","freeze","unfreeze","unsubscribe","CardClosed","FullCardClosed","hide","itemIds","Set","it","filter","has","forEach","taskService","getStoreTask","addItem","entityId","EntitySelectorEntity","Task","selected","sort","tabs","removeItem","currentTaskIds","newTaskIds","idsToDelete","includes","idsToAdd","length","Promise","all","delete","error","add","relationError","setTaskId","showError","selectableIds","unselectableIds","rights","detachParent","detachRelated","push","selectable","unselectable","unbox","Template","isTemplate","subTasksMeta","Object","TaskField","SubTasks","Loc","getMessage","subTasksService","relatedTasksMeta","RelatedTasks","relatedTasksService","ganttMeta","subTasksDialog","relatedTasksDialog","ganttDialog"],"mappings":"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"}