{"version":3,"file":"result-service.bundle.js","sources":["../src/mappers.js","../src/result-service.js","../src/index.js"],"sourcesContent":["import { Text } from 'main.core';\nimport { UserMappers } from 'tasks.v2.provider.service.user-service';\nimport type { ResultModel } from 'tasks.v2.model.results';\nimport type { ResultDto } from './types';\n\nexport function mapDtoToModel(resultDto: ResultDto): ResultModel\n{\n\treturn {\n\t\tid: resultDto.id,\n\t\ttaskId: resultDto.taskId,\n\t\ttext: Text.decode(resultDto.text),\n\t\tauthor: resultDto.author ? UserMappers.mapDtoToModel(resultDto.author) : null,\n\t\tcreatedAtTs: resultDto.createdAtTs * 1000,\n\t\tupdatedAtTs: resultDto.updatedAtTs * 1000,\n\t\tstatus: resultDto.status,\n\t\tfileIds: resultDto.fileIds,\n\t\tpreviewId: resultDto.previewId,\n\t\trights: resultDto.rights,\n\t\tfiles: resultDto.files,\n\t};\n}\n\nexport function mapModelToDto(result: ResultModel): ResultDto\n{\n\treturn {\n\t\tid: result.id,\n\t\ttaskId: result.taskId,\n\t\ttext: result.text,\n\t\tauthor: result.author.id,\n\t\tstatus: result.status,\n\t\tfileIds: result.fileIds,\n\t\tpreviewId: result.previewId,\n\t};\n}\n","import { Type } from 'main.core';\nimport type { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'tasks.v2.core';\nimport { Endpoint, Limit, Model, ResultStatus } from 'tasks.v2.const';\nimport { idUtils } from 'tasks.v2.lib.id-utils';\nimport { apiClient } from 'tasks.v2.lib.api-client';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { fileService, EntityTypes } from 'tasks.v2.provider.service.file-service';\nimport { entityTextEditor, EntityTextTypes } from 'tasks.v2.component.entity-text';\nimport type { ResultModel } from 'tasks.v2.model.results';\n\nimport { mapDtoToModel, mapModelToDto } from './mappers';\nimport type { ResultDto } from './types';\n\nconst limit = Limit.Results;\n\nclass ResultService\n{\n\tasync get(id: number): Promise<void>\n\t{\n\t\tconst data = await apiClient.post(Endpoint.TaskResultGet, { result: { id } });\n\n\t\tawait this.#addResultToStore(data);\n\t}\n\n\tasync tail(taskId: number, withMap: boolean = true): Promise<void>\n\t{\n\t\tconst size = limit;\n\t\tconst page = 1;\n\n\t\tconst { results, map } = await apiClient.post(Endpoint.TaskResultTail, {\n\t\t\ttaskId,\n\t\t\twithMap,\n\t\t\tnavigation: { size, page },\n\t\t});\n\n\t\tfor (const result of results)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#addResultToStore(result);\n\t\t}\n\n\t\tif (withMap)\n\t\t{\n\t\t\tconst ids = Object.keys(map).map((it) => parseInt(it, 10)).reverse();\n\n\t\t\tvoid taskService.updateStoreTask(taskId, {\n\t\t\t\tresults: ids,\n\t\t\t\tresultsMessageMap: map,\n\t\t\t});\n\t\t}\n\t}\n\n\tasync getAll(taskId: number): Promise<void>\n\t{\n\t\tconst { results } = await apiClient.post(Endpoint.TaskResultGetAll, {\n\t\t\ttaskId,\n\t\t\twithMap: false,\n\t\t});\n\n\t\tfor (const result of results)\n\t\t{\n\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\tawait this.#addResultToStore(result);\n\t\t}\n\t}\n\n\tasync save(taskId: number, results: ResultModel[], skipNotification: boolean = false): Promise<void>\n\t{\n\t\tconst resultsToAdd = results.map((result) => {\n\t\t\treturn mapModelToDto({ ...result, taskId });\n\t\t});\n\n\t\tconst tempIds = resultsToAdd.map((result) => result.id);\n\n\t\ttry\n\t\t{\n\t\t\tconst data = await apiClient.post(Endpoint.TaskResultAdd, { results: resultsToAdd, skipNotification });\n\n\t\t\tfor (const result of data)\n\t\t\t{\n\t\t\t\tconst index = data.indexOf(result);\n\t\t\t\tconst tempId = tempIds[index];\n\n\t\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\t\tawait this.#handleResultAfterAdd(taskId, tempId, result);\n\t\t\t}\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResultService.save error', error);\n\n\t\t\ttempIds.forEach((tempId) => {\n\t\t\t\tthis.deleteResultFromTask(taskId, tempId);\n\t\t\t\tvoid this.deleteStoreResult(tempId);\n\t\t\t});\n\t\t}\n\t}\n\n\tasync add(taskId: number | string, result: ResultModel): Promise<boolean>\n\t{\n\t\tconst tempId = result.id;\n\n\t\ttry\n\t\t{\n\t\t\tawait this.updateStoreResult(tempId, result);\n\n\t\t\tthis.addResultToTask(taskId, tempId);\n\n\t\t\tif (!idUtils.isReal(taskId))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst data = await apiClient.post(Endpoint.TaskResultAdd, { results: [mapModelToDto(result)] });\n\n\t\t\tawait this.#handleResultAfterAdd(taskId, tempId, data[0]);\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResultService.add error', error);\n\n\t\t\tthis.deleteResultFromTask(taskId, tempId);\n\n\t\t\tawait this.deleteStoreResult(tempId);\n\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tasync update(id: number, fields: ResultModel): Promise<void>\n\t{\n\t\tconst resultBeforeUpdate = this.getStoreResult(id);\n\t\tconst taskId = resultBeforeUpdate?.taskId;\n\n\t\tconst result = { ...resultBeforeUpdate, ...fields };\n\n\t\tawait this.updateStoreResult(id, fields);\n\n\t\tif (!idUtils.isReal(taskId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tawait apiClient.post(Endpoint.TaskResultUpdate, { result: mapModelToDto(result) });\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tawait this.updateStoreResult(id, resultBeforeUpdate);\n\n\t\t\tconsole.error('ResultService.update error', error);\n\t\t}\n\t}\n\n\tasync delete(id: number): Promise<void>\n\t{\n\t\tconst resultBeforeDelete = this.getStoreResult(id);\n\t\tconst taskId = resultBeforeDelete?.taskId;\n\n\t\tthis.deleteResultFromTask(taskId, id);\n\n\t\tawait this.deleteStoreResult(id);\n\n\t\tif (!idUtils.isReal(taskId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tawait apiClient.post(Endpoint.TaskResultDelete, { result: { id } });\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResultService.delete error', error);\n\n\t\t\tawait this.insertStoreResult(resultBeforeDelete);\n\n\t\t\tthis.addResultToTask(taskId, id);\n\t\t}\n\t}\n\n\tasync addResultFromMessage(taskId: number, messageId: number, result: ResultModel): Promise<boolean>\n\t{\n\t\tconst tempId = result.id;\n\n\t\ttry\n\t\t{\n\t\t\tawait this.#addResultToStore(result);\n\n\t\t\tthis.addResultToTask(taskId, tempId, messageId);\n\n\t\t\tconst data = await apiClient.post(Endpoint.TaskResultMessageAdd, { message: { id: messageId } });\n\n\t\t\tawait this.#handleResultAfterAdd(taskId, tempId, data);\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ResultService.addResultFromMessage error', error);\n\n\t\t\tthis.deleteResultFromTask(taskId, tempId);\n\n\t\t\tawait this.deleteStoreResult(tempId);\n\n\t\t\treturn false;\n\t\t}\n\t}\n\n\thasOpenedResults(taskId: number): boolean\n\t{\n\t\tconst task = taskService.getStoreTask(taskId);\n\t\tif (!task?.results.length > 0)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tfor (const resultId of task.results)\n\t\t{\n\t\t\tconst result = this.getStoreResult(resultId);\n\n\t\t\tif (result && result.status === ResultStatus.Open)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tasync closeResults(taskId: number): void\n\t{\n\t\tconst task = taskService.getStoreTask(taskId);\n\t\tif (!task?.results.length > 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const resultId of task.results)\n\t\t{\n\t\t\tconst result = this.getStoreResult(resultId);\n\n\t\t\tif (result && result.status === ResultStatus.Open)\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\t\tawait this.updateStoreResult(resultId, { status: ResultStatus.Closed });\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #handleResultAfterAdd(taskId: number | string, tempId: string, data: ResultDto): Promise<ResultDto>\n\t{\n\t\tconst { id } = data;\n\n\t\tfileService.replace(tempId, id, EntityTypes.Result);\n\t\tentityTextEditor.replace(tempId, id, EntityTextTypes.Result);\n\n\t\tawait this.#addResultToStore(data);\n\n\t\tconst task = taskService.getStoreTask(taskId);\n\t\tconst hasResultInTask = (task?.results || []).includes(tempId);\n\n\t\tif (hasResultInTask)\n\t\t{\n\t\t\tconst results = (task?.results || []).map((resultId) => (resultId === tempId ? id : resultId));\n\n\t\t\tconst resultsMessageMap = { ...(task?.resultsMessageMap) };\n\t\t\tresultsMessageMap[id] = resultsMessageMap[tempId];\n\t\t\tdelete resultsMessageMap[tempId];\n\n\t\t\tthis.#updateStoreTask(taskId, results, resultsMessageMap);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.addResultToTask(taskId, id);\n\t\t}\n\n\t\tawait this.deleteStoreResult(tempId);\n\t}\n\n\tgetStoreResult(id: number): ?ResultModel\n\t{\n\t\treturn this.$store.getters[`${Model.Results}/getById`](id) || null;\n\t}\n\n\thasStoreResult(id: number): boolean\n\t{\n\t\treturn Boolean(this.getStoreResult(id));\n\t}\n\n\tasync insertStoreResult(result: ResultModel): Promise<void>\n\t{\n\t\tawait this.$store.dispatch(`${Model.Results}/insert`, result);\n\t}\n\n\tasync updateStoreResult(id: number, fields: ResultModel): Promise<void>\n\t{\n\t\tawait this.$store.dispatch(`${Model.Results}/update`, { id, fields });\n\t}\n\n\tasync deleteStoreResult(id: number): Promise<void>\n\t{\n\t\tawait this.$store.dispatch(`${Model.Results}/delete`, id);\n\t}\n\n\tasync #addResultToStore(result: ResultDto): void\n\t{\n\t\tconst mappedResult = mapDtoToModel(result);\n\n\t\tawait this.insertStoreResult(mappedResult);\n\n\t\tif (Type.isArrayFilled(mappedResult.files))\n\t\t{\n\t\t\tfileService.get(mappedResult.id, EntityTypes.Result).loadFilesFromData(mappedResult.files);\n\t\t}\n\n\t\tentityTextEditor.get(\n\t\t\tmappedResult.id,\n\t\t\tEntityTextTypes.Result,\n\t\t\t{\n\t\t\t\tcontent: mappedResult.text,\n\t\t\t\tblockSpaceInline: 'var(--ui-space-stack-xl)',\n\t\t\t},\n\t\t);\n\t}\n\n\taddResultToTask(taskId: number, resultId: number, messageId: number | null = null): void\n\t{\n\t\tconst task = taskService.getStoreTask(taskId);\n\n\t\tconst results = [resultId, ...(task?.results || [])];\n\n\t\tconst resultsMessageMap = { ...(task?.resultsMessageMap), [resultId]: messageId };\n\n\t\tthis.#updateStoreTask(taskId, results, resultsMessageMap);\n\t}\n\n\tdeleteResultFromTask(taskId: number, resultId: number): void\n\t{\n\t\tconst task = taskService.getStoreTask(taskId);\n\n\t\tconst results = (task?.results || []).filter((it) => it !== resultId);\n\n\t\tconst resultsMessageMap = { ...(task?.resultsMessageMap) };\n\t\tdelete resultsMessageMap[resultId];\n\n\t\tthis.#updateStoreTask(taskId, results, resultsMessageMap);\n\t}\n\n\t#updateStoreTask(taskId: number, results: number[], resultsMessageMap: {}): void\n\t{\n\t\tconst containsResults = results.length > 0;\n\n\t\tvoid taskService.updateStoreTask(taskId, {\n\t\t\tresults,\n\t\t\tresultsMessageMap,\n\t\t\tcontainsResults,\n\t\t});\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n\nexport const resultService = new ResultService();\n","import { mapDtoToModel, mapModelToDto } from './mappers';\n\nexport { resultService } from './result-service';\nexport type { ResultDto } from './types';\nexport type { ResultId } from './types';\n\nexport const ResultMappers = {\n\tmapModelToDto,\n\tmapDtoToModel,\n};\n"],"names":["mapDtoToModel","resultDto","id","taskId","text","Text","decode","author","UserMappers","createdAtTs","updatedAtTs","status","fileIds","previewId","rights","files","mapModelToDto","result","limit","Limit","Results","ResultService","get","data","apiClient","post","Endpoint","TaskResultGet","tail","withMap","size","page","results","map","TaskResultTail","navigation","ids","Object","keys","it","parseInt","reverse","taskService","updateStoreTask","resultsMessageMap","getAll","TaskResultGetAll","save","skipNotification","resultsToAdd","tempIds","TaskResultAdd","index","indexOf","tempId","error","console","forEach","deleteResultFromTask","deleteStoreResult","add","updateStoreResult","addResultToTask","idUtils","isReal","update","fields","resultBeforeUpdate","getStoreResult","TaskResultUpdate","delete","resultBeforeDelete","TaskResultDelete","insertStoreResult","addResultFromMessage","messageId","TaskResultMessageAdd","message","hasOpenedResults","task","getStoreTask","length","resultId","ResultStatus","Open","closeResults","Closed","$store","getters","Model","hasStoreResult","Boolean","dispatch","filter","Core","getStore","fileService","replace","EntityTypes","Result","entityTextEditor","EntityTextTypes","hasResultInTask","includes","mappedResult","Type","isArrayFilled","loadFilesFromData","content","blockSpaceInline","containsResults","resultService","ResultMappers"],"mappings":"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"}