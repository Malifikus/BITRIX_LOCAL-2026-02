{"version":3,"file":"growing-text-area.bundle.js","sources":["../src/growing-text-area.js"],"sourcesContent":["import { Dom, Text, Type } from 'main.core';\nimport { hint, type HintParams } from 'ui.vue3.directives.hint';\n\nconst URL_REGEXP = /((https?:\\/\\/(www\\.)?)|(www\\.))[\\w#%+.:=@~-]{1,256}\\.[\\d()A-Za-z]{1,6}\\b([\\w#%&()+./:=?@[\\]~-]*)(?<![%()+.:\\]-])/;\nconst EMAIL_REGEXP = /(([^\\s\"(),.:;<>@[\\\\\\]]+(\\.[^\\s\"(),.:;<>@[\\\\\\]]+)*)|(\".+\"))@((\\[(?:\\d{1,3}\\.){3}\\d{1,3}])|(([\\dA-Za-z-]+\\.)+[A-Za-z]{2,}))/;\nconst PUNCTUATION_OR_SPACE = /[\\s(),.;[\\]]/;\n\nfunction createLinkMatcherWithRegExp(regExp, urlTransformer = (text) => text): Function\n{\n\treturn (text) => {\n\t\tconst match = regExp.exec(text);\n\t\tif (match === null)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\tindex: match.index,\n\t\t\tlength: match[0].length,\n\t\t\ttext: match[0],\n\t\t\turl: urlTransformer(match[0]),\n\t\t};\n\t};\n}\n\nconst LINK_MATCHERS = [\n\tcreateLinkMatcherWithRegExp(URL_REGEXP, (text) => (text.startsWith('http') ? text : `https://${text}`)),\n\tcreateLinkMatcherWithRegExp(EMAIL_REGEXP, (text) => `mailto:${text}`),\n];\n\nimport './growing-text-area.css';\n\n// @vue/component\nexport const GrowingTextArea = {\n\tname: 'GrowingTextArea',\n\tdirectives: { hint },\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tfontColor: {\n\t\t\ttype: String,\n\t\t\tdefault: 'var(--ui-color-base-1)',\n\t\t},\n\t\tlinkColor: {\n\t\t\ttype: String,\n\t\t\tdefault: 'var(--ui-color-accent-main-link)',\n\t\t},\n\t\tfontSize: {\n\t\t\ttype: Number,\n\t\t\tdefault: 21,\n\t\t},\n\t\tfontWeight: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 'inherit',\n\t\t},\n\t\tlineHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 29,\n\t\t},\n\t\treadonly: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: [\n\t\t'update:modelValue',\n\t\t'input',\n\t\t'focus',\n\t\t'blur',\n\t\t'emptyFocus',\n\t\t'emptyBlur',\n\t\t'enterBlur',\n\t\t'linkClick',\n\t],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tfocus: false,\n\t\t\toverflowing: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tisEmpty(): boolean\n\t\t{\n\t\t\treturn this.modelValue.trim() === '';\n\t\t},\n\t\tisDisplay(): boolean\n\t\t{\n\t\t\treturn !this.isEmpty && !this.focus && (this.overflowing || this.hasLinks);\n\t\t},\n\t\tlinkMatches(): Array<Object>\n\t\t{\n\t\t\treturn this.findLinkMatches(this.modelValue);\n\t\t},\n\t\thasLinks(): boolean\n\t\t{\n\t\t\treturn this.linkMatches.length > 0;\n\t\t},\n\t\tdisplayHtml(): string\n\t\t{\n\t\t\treturn this.getLinkifiedHtml(this.modelValue, this.linkMatches);\n\t\t},\n\t\ttooltip(): ?Function\n\t\t{\n\t\t\tif (!this.overflowing)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn (): HintParams => ({\n\t\t\t\thtml: this.displayHtml,\n\t\t\t\tinteractivity: true,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tclassName: 'b24-growing-text-area-popup',\n\t\t\t\t\tbindElement: this.$el,\n\t\t\t\t\toffsetLeft: 40,\n\t\t\t\t\tmaxWidth: 440,\n\t\t\t\t\tmaxHeight: 360,\n\t\t\t\t\tangle: {\n\t\t\t\t\t\toffset: 40,\n\t\t\t\t\t},\n\t\t\t\t\tdarkMode: false,\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\trequestAnimationFrame(() => {\n\t\t\tif (this.isEmpty)\n\t\t\t{\n\t\t\t\tthis.focusToEnd();\n\t\t\t}\n\n\t\t\tthis.overflowing = this.isOverflowing();\n\n\t\t\tvoid this.adjustTextareaHeight();\n\t\t});\n\t},\n\tmethods: {\n\t\tgetLinkifiedHtml(value: string, matches: Array<Object>): string\n\t\t{\n\t\t\tif (!Type.isStringFilled(value))\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (!Array.isArray(matches) || matches.length === 0)\n\t\t\t{\n\t\t\t\treturn Text.encode(value);\n\t\t\t}\n\n\t\t\tlet result = '';\n\t\t\tlet lastIndex = 0;\n\n\t\t\tmatches.forEach((match) => {\n\t\t\t\tresult += Text.encode(value.slice(lastIndex, match.start));\n\n\t\t\t\tconst safeHref = Text.encode(match.href);\n\t\t\t\tconst safeText = Text.encode(match.text);\n\n\t\t\t\tresult += `\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass=\"b24-growing-text-area-link\"\n\t\t\t\t\t\thref=\"${safeHref}\"\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\t\t\tstyle=\"color: ${this.linkColor};\"\n\t\t\t\t\t>${safeText}</a>\n\t\t\t\t`.trim();\n\n\t\t\t\tlastIndex = match.end;\n\t\t\t});\n\n\t\t\tresult += Text.encode(value.slice(lastIndex));\n\n\t\t\treturn result;\n\t\t},\n\t\tfindLinkMatches(value: string): Array<Object>\n\t\t{\n\t\t\tif (!Type.isStringFilled(value))\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tconst matches = [];\n\t\t\tlet text = value;\n\t\t\tlet offset = 0;\n\t\t\tlet match = this.getFirstLinkMatch(text);\n\n\t\t\twhile (match)\n\t\t\t{\n\t\t\t\tconst start = offset + match.index;\n\t\t\t\tconst end = start + match.length;\n\n\t\t\t\tif (this.isMatchBoundariesValid(value, start, end))\n\t\t\t\t{\n\t\t\t\t\tmatches.push({\n\t\t\t\t\t\tstart,\n\t\t\t\t\t\tend,\n\t\t\t\t\t\ttext: match.text,\n\t\t\t\t\t\thref: match.url,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst sliceIndex = match.index + match.length;\n\t\t\t\toffset += sliceIndex;\n\t\t\t\ttext = text.slice(sliceIndex);\n\t\t\t\tmatch = this.getFirstLinkMatch(text);\n\t\t\t}\n\n\t\t\treturn matches;\n\t\t},\n\t\tgetFirstLinkMatch(text: string): ?Object\n\t\t{\n\t\t\tif (!Type.isStringFilled(text))\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tfor (const matcher of LINK_MATCHERS)\n\t\t\t{\n\t\t\t\tconst match = matcher(text);\n\t\t\t\tif (match)\n\t\t\t\t{\n\t\t\t\t\treturn match;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\tisMatchBoundariesValid(text: string, start: number, end: number): boolean\n\t\t{\n\t\t\tconst beforeChar = start > 0 ? text[start - 1] : '';\n\t\t\tconst afterChar = end < text.length ? text[end] : '';\n\n\t\t\treturn this.isSeparator(beforeChar) && this.isSeparator(afterChar);\n\t\t},\n\t\tisSeparator(char: string): boolean\n\t\t{\n\t\t\tif (!Type.isStringFilled(char))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn PUNCTUATION_OR_SPACE.test(char);\n\t\t},\n\t\tisOverflowing(): boolean\n\t\t{\n\t\t\tconst textarea = this.$refs.textarea;\n\t\t\tconst display = this.$refs.display;\n\n\t\t\tif (textarea)\n\t\t\t{\n\t\t\t\tconst maxHeight = this.lineHeight * 3;\n\n\t\t\t\treturn textarea.scrollHeight > maxHeight;\n\t\t\t}\n\n\t\t\tif (display)\n\t\t\t{\n\t\t\t\treturn display.offsetHeight >= 60;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tasync adjustTextareaHeight(): Promise<void>\n\t\t{\n\t\t\tconst textarea = this.$refs.textarea;\n\t\t\tif (!textarea)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tDom.style(textarea, 'height', 'auto');\n\n\t\t\tconst maxHeight = this.lineHeight * 3;\n\t\t\tconst height = Math.min(textarea.scrollHeight, maxHeight);\n\n\t\t\tthis.overflowing = this.isOverflowing();\n\n\t\t\tDom.style(textarea, 'height', `${height}px`);\n\t\t\tDom.style(textarea, 'maxHeight', `${maxHeight}px`);\n\t\t},\n\t\tfocusToEnd(): void\n\t\t{\n\t\t\tconst textarea = this.$refs.textarea;\n\t\t\tif (!textarea)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.readonly)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttextarea.focus({ preventScroll: true });\n\t\t\ttextarea.setSelectionRange(textarea.value.length, textarea.value.length);\n\t\t\tthis.scrollToBeginning();\n\t\t\tthis.scrollToEnd();\n\t\t},\n\t\tfocusTextarea(): void\n\t\t{\n\t\t\tif (this.readonly)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.focus)\n\t\t\t{\n\t\t\t\tvoid this.handleFocus();\n\t\t\t}\n\n\t\t\tthis.focus = true;\n\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tthis.$refs.textarea.focus();\n\t\t\t});\n\t\t},\n\t\tscrollToBeginning(): void\n\t\t{\n\t\t\tif (!this.$refs.textarea)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$refs.textarea.scrollTop = 0;\n\t\t},\n\t\tscrollToEnd(): void\n\t\t{\n\t\t\tconst textarea = this.$refs.textarea;\n\t\t\ttextarea.scrollTo({\n\t\t\t\ttop: textarea.scrollHeight,\n\t\t\t\tbehavior: 'smooth',\n\t\t\t});\n\t\t},\n\t\thandleDisplayClick(event: PointerEvent): void\n\t\t{\n\t\t\tif (\n\t\t\t\tevent\n\t\t\t\t&& event.target\n\t\t\t\t&& event.target.closest\n\t\t\t\t&& event.target.closest('.b24-growing-text-area-link')\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.$emit('linkClick', event);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.focusTextarea();\n\t\t\t}\n\t\t},\n\t\thandleInput(event): void\n\t\t{\n\t\t\tthis.$emit('input', event.target.value);\n\n\t\t\tvoid this.adjustTextareaHeight();\n\t\t},\n\t\thandleKeyDown(event: KeyboardEvent): void\n\t\t{\n\t\t\tif (event.key === 'Enter' && (event.ctrlKey || event.metaKey))\n\t\t\t{\n\t\t\t\tevent.stopPropagation();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.key === 'Enter')\n\t\t\t{\n\t\t\t\tthis.$emit('enterBlur', this.modelValue === '');\n\n\t\t\t\tevent.target.blur();\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\n\t\t\tif (event.key === 'Escape')\n\t\t\t{\n\t\t\t\tevent.target.blur();\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t},\n\t\tasync handleFocus(event?: FocusEvent): Promise<void>\n\t\t{\n\t\t\tthis.focus = true;\n\n\t\t\tawait this.adjustTextareaHeight();\n\t\t\tthis.focusToEnd();\n\n\t\t\tif (this.modelValue === '')\n\t\t\t{\n\t\t\t\tthis.$emit('emptyFocus');\n\t\t\t}\n\n\t\t\tthis.$emit('focus', event);\n\t\t},\n\t\tasync handleBlur(event: FocusEvent): Promise<void>\n\t\t{\n\t\t\tif (!this.$refs.textarea)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.overflowing)\n\t\t\t{\n\t\t\t\tawait this.adjustTextareaHeight();\n\t\t\t\tthis.scrollToBeginning();\n\t\t\t}\n\n\t\t\tconst value = this.$refs.textarea.value.trim();\n\t\t\tif (value !== this.modelValue)\n\t\t\t{\n\t\t\t\tthis.$emit('update:modelValue', value);\n\t\t\t}\n\n\t\t\tthis.$refs.textarea.value = value;\n\n\t\t\tif (value === '')\n\t\t\t{\n\t\t\t\tthis.$emit('emptyBlur');\n\t\t\t}\n\n\t\t\tthis.$emit('blur', event);\n\n\t\t\tthis.focus = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"b24-growing-text-area\" :class=\"{ '--readonly': readonly }\">\n\t\t\t<div\n\t\t\t\tref=\"display\"\n\t\t\t\tv-if=\"isDisplay\"\n\t\t\t\tv-hint=\"tooltip\"\n\t\t\t\tclass=\"b24-growing-text-area-display\"\n\t\t\t\t:style=\"{\n\t\t\t\t\tlineHeight: lineHeight + 'px',\n\t\t\t\t\tcolor: fontColor,\n\t\t\t\t\tfontSize: fontSize + 'px',\n\t\t\t\t\tfontWeight: fontWeight,\n\t\t\t\t}\"\n\t\t\t\t@click=\"handleDisplayClick\"\n\t\t\t>\n\t\t\t\t<span v-html=\"displayHtml\"/>\n\t\t\t</div>\n\t\t\t<textarea\n\t\t\t\tv-else\n\t\t\t\tclass=\"b24-growing-text-area-edit\"\n\t\t\t\trows=\"1\"\n\t\t\t\t:value=\"modelValue\"\n\t\t\t\t:placeholder\n\t\t\t\t:style=\"{\n\t\t\t\t\tlineHeight: lineHeight + 'px',\n\t\t\t\t\tcolor: fontColor,\n\t\t\t\t\tfontSize: fontSize + 'px',\n\t\t\t\t\tfontWeight: fontWeight,\n\t\t\t\t}\"\n\t\t\t\t:readonly\n\t\t\t\tref=\"textarea\"\n\t\t\t\t@input=\"handleInput\"\n\t\t\t\t@keydown=\"handleKeyDown\"\n\t\t\t\t@focus=\"handleFocus\"\n\t\t\t\t@blur=\"handleBlur\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n"],"names":["URL_REGEXP","EMAIL_REGEXP","PUNCTUATION_OR_SPACE","createLinkMatcherWithRegExp","regExp","urlTransformer","text","match","exec","index","length","url","LINK_MATCHERS","startsWith","GrowingTextArea","name","directives","hint","props","modelValue","type","String","default","placeholder","fontColor","linkColor","fontSize","Number","fontWeight","lineHeight","readonly","Boolean","emits","data","focus","overflowing","computed","isEmpty","trim","isDisplay","hasLinks","linkMatches","findLinkMatches","displayHtml","getLinkifiedHtml","tooltip","html","interactivity","popupOptions","className","bindElement","$el","offsetLeft","maxWidth","maxHeight","angle","offset","darkMode","targetContainer","document","body","mounted","requestAnimationFrame","focusToEnd","isOverflowing","adjustTextareaHeight","methods","value","matches","Type","isStringFilled","Array","isArray","Text","encode","result","lastIndex","forEach","slice","start","safeHref","href","safeText","end","getFirstLinkMatch","isMatchBoundariesValid","push","sliceIndex","matcher","beforeChar","afterChar","isSeparator","char","test","textarea","$refs","display","scrollHeight","offsetHeight","Dom","style","height","Math","min","preventScroll","setSelectionRange","scrollToBeginning","scrollToEnd","focusTextarea","handleFocus","$nextTick","scrollTop","scrollTo","top","behavior","handleDisplayClick","event","target","closest","$emit","handleInput","handleKeyDown","key","ctrlKey","metaKey","stopPropagation","blur","preventDefault","handleBlur","template"],"mappings":"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"}