this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};(function(t,e,s,i,a,n,l,o,r,d,h,c,u,p,m,k,T,S,v,g,f,C,F,I,A,_,b,B,L,y,w,E,P,M,R,O,H,U,D,K,V,N,x,X,G,$,j,z,W,q,Y,Z,J,Q,tt,et,st,it,at,nt,lt,ot,rt,dt,ht,ct,ut){"use strict";const pt="sectionPersonal";const mt="sectionTasks";const kt="sectionCopy";const Tt="sectionLinks";const St={name:"TaskFullCardBurgerMenu",components:{BIcon:tt.BIcon,BMenu:Q.BMenu},inject:{task:{},taskId:{},analytics:{}},setup(){return{Outline:tt.Outline,userRights:X.Core.getParams().rights}},data(){return{isMenuShown:false}},computed:{...J.mapGetters({currentUserId:`${it.Model.Interface}/currentUserId`}),menuOptions(){return()=>({id:"tasks-full-card-header-burger-menu",bindElement:this.$refs.container,sections:[{code:pt},{code:mt},{code:kt},{code:Tt}],items:this.menuItems})},menuItems(){return[this.task.rights.favorite&&this.getFavoriteItem(),this.task.rights.watch&&this.getWatchItem(),this.task.rights.mute&&this.getMuteItem(),this.userRights.tasks.create&&this.getCreateNewTaskItem(),this.task.rights.createSubtask&&this.getCreateSubtaskItem(),this.task.rights.copy&&this.getCreateTaskCopyItem(),this.userRights.tasks.createFromTemplate&&this.getCreateNewTaskWithTemplateItem(),false&&this.task.rights.saveAsTemplate&&this.getCreateTemplateFromTaskItem(),this.getCopyTaskIdItem(),this.getGoToBitrixMarketItem(),this.userRights.tasks.robot&&this.getGoToRobotsItem()].filter((t=>t))},isStakeholderLocked(){return!X.Core.getParams().restrictions.stakeholder.available}},methods:{getFavoriteItem(){const t={title:this.loc("TASKS_V2_TASK_FULL_CARD_FAVOR_ACTION"),icon:tt.Outline.FAVORITE,successNotification:this.loc("TASKS_V2_TASK_FULL_CARD_FAVOR_NOTIF_SUCC"),failNotification:this.loc("TASKS_V2_TASK_FULL_CARD_FAVOR_NOTIF_FAIL")};const e={title:this.loc("TASKS_V2_TASK_FULL_CARD_UNFAVOR_ACTION"),icon:tt.Outline.NON_FAVORITE,successNotification:this.loc("TASKS_V2_TASK_FULL_CARD_UNFAVOR_NOTIF_SUCC"),failNotification:this.loc("TASKS_V2_TASK_FULL_CARD_UNFAVOR_NOTIF_FAIL")};const s=this.task.isFavorite?e:t;return{sectionCode:pt,title:s.title,icon:s.icon,onClick:async()=>{const t=await ot.taskService.setFavorite(this.taskId,!this.task.isFavorite);V.Notifier.notifyViaBrowserProvider({id:"task-notify-favorite",text:t?s.successNotification:s.failNotification})}}},getWatchItem(){const t={title:this.loc("TASKS_V2_TASK_FULL_CARD_BECOME_AUDITOR_ACTION"),icon:tt.Outline.OBSERVER,successNotification:this.loc("TASKS_V2_TASK_FULL_CARD_BECOME_AUDITOR_NOTIF_SUCC"),failNotification:this.loc("TASKS_V2_TASK_FULL_CARD_BECOME_AUDITOR_NOTIF_FAIL"),auditorsIds:[...this.task.auditorsIds,this.currentUserId],endpoint:"Task.Audit.watch"};const e={title:this.loc("TASKS_V2_TASK_FULL_CARD_STOP_BEING_AUDITOR_ACTION"),icon:tt.Outline.CROSSED_EYE,successNotification:this.loc("TASKS_V2_TASK_FULL_CARD_STOP_BEING_AUDITOR_NOTIF_SUCC"),failNotification:this.loc("TASKS_V2_TASK_FULL_CARD_STOP_BEING_AUDITOR_NOTIF_FAIL"),auditorsIds:this.task.auditorsIds.filter((t=>t!==this.currentUserId)),endpoint:"Task.Audit.unwatch"};const s=this.task.auditorsIds.includes(this.currentUserId)?e:t;return{sectionCode:pt,title:s.title,icon:s.icon,isLocked:this.isStakeholderLocked,onClick:async()=>{var t;if(this.isStakeholderLocked){void nt.showLimit({featureId:X.Core.getParams().restrictions.stakeholder.featureId,bindElement:this.$el});return}const e=await ot.taskService.update(this.taskId,{auditorsIds:s.auditorsIds});const i=!((t=e[s.endpoint])!=null&&t.length);V.Notifier.notifyViaBrowserProvider({id:"task-notify-watch",text:i?s.successNotification:s.failNotification})}}},getMuteItem(){const t={title:this.loc("TASKS_V2_TASK_FULL_CARD_MUTE_ACTION"),icon:tt.Outline.SOUND_OFF,successNotificationTitle:this.loc("TASKS_V2_TASK_FULL_CARD_MUTE_NOTIF_SUCC_TITLE"),successNotification:this.loc("TASKS_V2_TASK_FULL_CARD_MUTE_NOTIF_SUCC_DESCR"),failNotification:this.loc("TASKS_V2_TASK_FULL_CARD_MUTE_NOTIF_FAIL")};const e={title:this.loc("TASKS_V2_TASK_FULL_CARD_UNMUTE_ACTION"),icon:tt.Outline.SOUND_ON,successNotificationTitle:this.loc("TASKS_V2_TASK_FULL_CARD_UNMUTE_NOTIF_SUCC_TITLE"),successNotification:this.loc("TASKS_V2_TASK_FULL_CARD_UNMUTE_NOTIF_SUCC_DESCR"),failNotification:this.loc("TASKS_V2_TASK_FULL_CARD_UNMUTE_NOTIF_FAIL")};const s=this.task.isMuted?e:t;return{sectionCode:pt,title:s.title,icon:s.icon,onClick:async()=>{const t=await ot.taskService.setMute(this.taskId,!this.task.isMuted);V.Notifier.notifyViaBrowserProvider({id:"task-notify-mute",title:s.successNotificationTitle,text:t?s.successNotification:s.failNotification})}}},getCreateNewTaskItem(){return{sectionCode:mt,title:this.loc("TASKS_V2_TASK_FULL_CARD_CREATE_STANDALONE_TASK"),icon:tt.Outline.TASK,onClick:()=>st.TaskCard.showCompactCard({groupId:this.task.groupId,analytics:this.getAnalytics()})}},getCreateSubtaskItem(){return{sectionCode:mt,title:this.loc("TASKS_V2_TASK_FULL_CARD_CREATE_SUBTASK"),icon:tt.Outline.RELATED_TASKS,onClick:()=>st.TaskCard.showCompactCard({groupId:this.task.groupId,parentId:this.taskId,analytics:this.getAnalytics(it.Analytics.Element.ContextMenuSubtask)})}},getCreateTaskCopyItem(){return{sectionCode:mt,title:this.loc("TASKS_V2_TASK_FULL_CARD_CREATE_TASK_COPY"),icon:tt.Outline.DUPLICATE,onClick:()=>st.TaskCard.showFullCard({copiedFromId:this.taskId,analytics:this.getAnalytics()})}},getCreateNewTaskWithTemplateItem(){return{sectionCode:mt,title:this.loc("TASKS_V2_TASK_FULL_CARD_CREATE_STANDALONE_TASK_WITH_TEMPLATE"),icon:tt.Outline.CHEVRON_RIGHT_L,onClick:()=>{BX.SidePanel.Instance.open(`/company/personal/user/${this.currentUserId}/tasks/templates/`,{newWindowLabel:false,copyLinkLabel:false})}}},getCreateTemplateFromTaskItem(){return{sectionCode:mt,title:this.loc("TASKS_V2_TASK_FULL_CARD_CREATE_TEMPLATE_FROM_TASK"),icon:tt.Outline.TEMPLATE_TASK,onClick:()=>st.TaskCard.showCompactCard({groupId:this.task.groupId,analytics:this.getAnalytics()})}},getCopyTaskIdItem(){return{sectionCode:kt,title:this.loc("TASKS_V2_TASK_FULL_CARD_COPY_TASK_ID_ACTION"),icon:tt.Outline.COPY,onClick:()=>{const t=BX.clipboard.copy(this.taskId);if(t){V.Notifier.notifyViaBrowserProvider({id:"task-notify-copy",text:this.loc("TASKS_V2_TASK_FULL_CARD_COPY_TASK_ID_NOTIF")})}}}},getGoToBitrixMarketItem(){return{sectionCode:Tt,uiButtonOptions:{icon:tt.Outline.MARKET,text:this.loc("TASKS_V2_TASK_FULL_CARD_GO_TO_BITRIX_MARKET"),size:ht.ButtonSize.SMALL,useAirDesign:true,style:ht.AirButtonStyle.OUTLINE,wide:true,disabled:false,onclick:()=>BX.rest.Marketplace.open({PLACEMENT:"TASK_LIST_CONTEXT_MENU"})}}},getGoToRobotsItem(){const t=!X.Core.getParams().restrictions.robots.available;return{sectionCode:Tt,uiButtonOptions:{icon:t?tt.Outline.LOCK_L:tt.Outline.ROBOT,text:this.loc("TASKS_V2_TASK_FULL_CARD_GO_TO_ROBOTS"),size:ht.ButtonSize.SMALL,useAirDesign:true,style:ht.AirButtonStyle.OUTLINE,wide:true,disabled:false,onclick:()=>{if(t){this.isMenuShown=false;void nt.showLimit({featureId:X.Core.getParams().restrictions.robots.featureId,bindElement:this.$refs.container});return}BX.SidePanel.Instance.open(`/bitrix/components/bitrix/tasks.automation/slider.php?site_id=${this.loc("SITE_ID")}&project_id=${this.task.groupId}&task_id=${this.taskId}`,{cacheable:false,customLeftBoundary:0,loader:"bizproc:automation-loader"})}}}},getAnalytics(t=it.Analytics.Element.ContextMenu){var e,s;return{element:t,context:(e=(s=this.analytics)==null?void 0:s.context)!=null?e:it.Analytics.Section.Tasks,additionalContext:it.Analytics.SubSection.TaskCard}}},template:`\n\t\t<div\n\t\t\tclass="tasks-full-card-header-burger"\n\t\t\tref="container"\n\t\t\t@click="isMenuShown = true"\n\t\t>\n\t\t\t<BIcon :name="Outline.MORE_L" hoverable/>\n\t\t</div>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions()" @close="isMenuShown = false"/>\n\t`};const vt={name:"TaskFullCardHeader",components:{TitleField:D.Title,Importance:K.Importance,BurgerMenu:St},inject:{isEdit:{},isTemplate:{}},template:`\n\t\t<div class="tasks-full-card-header">\n\t\t\t<TitleField/>\n\t\t\t<Importance/>\n\t\t\t<BurgerMenu v-if="!isTemplate && isEdit"/>\n\t\t</div>\n\t`};const gt={name:"TasksTaskSettingsHint",components:{Hint:W.Hint},props:{isShown:{type:Boolean,required:true},bindElement:{type:HTMLElement,default:()=>null}},computed:{},created(){void N.highlighter.highlight(this.bindElement)},template:`\n\t\t<Hint\n\t\t\tv-if="isShown"\n\t\t\t:bindElement\n\t\t\t:options="{\n\t\t\t\tmaxWidth: 460,\n\t\t\t\tcloseIcon: true,\n\t\t\t\toffsetLeft: 14,\n\t\t\t}"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<div class="tasks-task-settings-hint">\n\t\t\t\t<div class="tasks-task-settings-hint-image">\n\t\t\t\t\t<div class="tasks-task-settings-hint-icon"/>\n\t\t\t\t</div>\n\t\t\t\t<div class="tasks-task-settings-hint-content">\n\t\t\t\t\t<div class="tasks-task-settings-hint-title">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_FULL_CARD_AHA_TASK_SETTINGS_HINT_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tasks-task-settings-hint-text">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_FULL_CARD_AHA_TASK_SETTINGS_HINT_TEXT') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Hint>\n\t`};const ft=t=>{var e,s,i,a;return e=babelHelpers.classPrivateFieldLooseKey("shouldShowAddResult"),s=babelHelpers.classPrivateFieldLooseKey("shouldShowRemoveResult"),i=babelHelpers.classPrivateFieldLooseKey("getMessageResultId"),a=babelHelpers.classPrivateFieldLooseKey("getTask"),class extends t{constructor(...t){super(...t);Object.defineProperty(this,a,{value:r});Object.defineProperty(this,i,{value:o});Object.defineProperty(this,s,{value:l});Object.defineProperty(this,e,{value:n})}getAddResultItem(){if(this.isDeletedMessage()||!this.isOwnMessage()||!babelHelpers.classPrivateFieldLooseBase(this,e)[e]()){return null}return{title:ct.Loc.getMessage("TASKS_V2_TASK_FULL_CARD_MESSAGE_ADD_RESULT"),icon:tt.Outline.FLAG,onClick:()=>{Z.EventEmitter.emit(it.EventName.AddResultFromChat,{taskId:this.getTaskId(),messageId:this.context.id,text:this.context.text,authorId:this.context.authorId});this.close()}}}getRemoveResultItem(){if(this.isDeletedMessage()||!this.isOwnMessage()||!babelHelpers.classPrivateFieldLooseBase(this,s)[s]()){return null}return{title:ct.Loc.getMessage("TASKS_V2_TASK_FULL_CARD_MESSAGE_DELETE_RESULT"),icon:tt.Outline.FLAG_WITH_CROSS,onClick:()=>{Z.EventEmitter.emit(it.EventName.DeleteResultFromChat,{taskId:this.getTaskId(),resultId:babelHelpers.classPrivateFieldLooseBase(this,i)[i]()});this.close()}}}getTaskId(){return 0}};function n(){const t=babelHelpers.classPrivateFieldLooseBase(this,a)[a]();if(!t){return false}return!babelHelpers.classPrivateFieldLooseBase(this,i)[i]()}function l(){const t=babelHelpers.classPrivateFieldLooseBase(this,a)[a]();if(!t){return false}return babelHelpers.classPrivateFieldLooseBase(this,i)[i]()>0}function o(){const t=babelHelpers.classPrivateFieldLooseBase(this,a)[a]();if(!t){return 0}const e=(t==null?void 0:t.resultsMessageMap)||{};const s=this.context.id;for(const[t,i]of Object.entries(e)){if(i!==null&&Number(i)===Number(s)){return Number(t)}}return 0}function r(){return ot.taskService.getStoreTask(this.getTaskId())}};const Ct={components:{UiButton:ht.Button,Hint:W.Hint,TextMd:z.TextMd,HeadlineSm:z.HeadlineSm},props:{isShown:{type:Boolean,required:true},bindElement:{type:HTMLElement,default:()=>null}},emits:["close"],setup(){return{Outline:tt.Outline,AirButtonStyle:ht.AirButtonStyle,ButtonSize:ht.ButtonSize}},created(){void N.highlighter.highlight(this.bindElement,1e3)},template:`\n\t\t<Hint\n\t\t\tv-if="isShown"\n\t\t\t:bindElement\n\t\t\t:options="{\n\t\t\t\tcloseIcon: true,\n\t\t\t\tminWidth: 500,\n\t\t\t\tmaxWidth: 500,\n\t\t\t\tpadding: 0,\n\t\t\t\toffsetLeft: 22,\n\t\t\t}"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<div class="tasks-chat-aha-container">\n\t\t\t\t<div class="tasks-chat-aha-icon"/>\n\t\t\t\t<div class="tasks-chat-aha-info">\n\t\t\t\t\t<HeadlineSm class="tasks-chat-aha-info-text">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_FULL_CARD_CHAT_AHA_TITLE') }}\n\t\t\t\t\t</HeadlineSm>\n\t\t\t\t\t<TextMd class="tasks-chat-aha-info-text">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_FULL_CARD_CHAT_AHA_DESC') }}\n\t\t\t\t\t</TextMd>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Hint>\n\t`};const Ft={components:{UiButton:ht.Button,Hint:W.Hint,TextMd:z.TextMd,HeadlineSm:z.HeadlineSm},props:{isShown:{type:Boolean,required:true},bindElement:{type:HTMLElement,default:()=>null}},emits:["close"],setup(){return{Outline:tt.Outline,AirButtonStyle:ht.AirButtonStyle,ButtonSize:ht.ButtonSize}},created(){void N.highlighter.highlight(this.bindElement,2e3)},template:`\n\t\t<Hint\n\t\t\tv-if="isShown"\n\t\t\t:bindElement\n\t\t\t:options="{\n\t\t\t\tcloseIcon: true,\n\t\t\t\tminWidth: 500,\n\t\t\t\tmaxWidth: 500,\n\t\t\t\tpadding: 0,\n\t\t\t\toffsetLeft: bindElement.offsetWidth / 4,\n\t\t\t\tangle: {\n\t\t\t\t\toffset: bindElement.offsetWidth / 4,\n\t\t\t\t}\n\t\t\t}"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<div class="tasks-important-messages-aha-container">\n\t\t\t\t<div class="tasks-important-messages-aha-icon"/>\n\t\t\t\t<div class="tasks-important-messages-aha-info">\n\t\t\t\t\t<HeadlineSm class="tasks-important-messages-aha-info-text">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_FULL_CARD_IMPORTANT_MESSAGES_TITLE') }}\n\t\t\t\t\t</HeadlineSm>\n\t\t\t\t\t<TextMd class="tasks-important-messages-aha-info-text">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_FULL_CARD_IMPORTANT_MESSAGES_DESC') }}\n\t\t\t\t\t</TextMd>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Hint>\n\t`};const It={name:"TaskFullCardChat",components:{ChatAha:Ct,ImportantMessagesAha:Ft},inject:{task:{},taskId:{},isEdit:{}},setup(){return{messageMenuManager:null}},data(){return{isTaskChatAhaShown:false,isTaskImportantMessagesAhaShown:false}},computed:{taskChatAhaBindElement(){if(this.$refs.chat){return this.$refs.chat.querySelector(".bx-im-chat-header__left")}return null},taskImportantMessagesAhaBindElement(){if(this.$refs.chat){return this.$refs.chat.querySelector(".bx-im-send-panel__container")}return null}},watch:{async taskId(){await this.openChat();void this.registerMessageMenu()}},created(){if(this.isEdit){this.registerMessageMenu()}},mounted(){void this.openChat()},unmounted(){var t;this.unregisterMessageMenu();(t=this.app)==null?void 0:t.bitrixVue.unmount()},methods:{async openChat(){var t,e;if(!X.Core.getParams().features.im){return}(t=this.app)==null?void 0:t.bitrixVue.unmount();const{Messenger:s}=await ct.Runtime.loadExtension("im.public");(e=this.app)!=null?e:this.app=await s.initApplication("task");if(this.isEdit){await this.app.mount({rootContainer:this.$refs.chat,chatId:this.task.chatId,taskId:this.taskId,type:X.Core.getParams().chatType});this.tryShowAha()}else{await this.app.mountPlaceholder({rootContainer:this.$refs.chat,taskId:`'${this.taskId}'`});Z.EventEmitter.emit("tasks:card:onMembersCountChange",{taskId:this.taskId,userCounter:1})}},async registerMessageMenu(){if(!X.Core.getParams().features.im){return}const{TaskCommentsMessageMenu:t,MessageMenuManager:e}=await ct.Runtime.loadExtension("im.v2.lib.menu");this.messageMenuManager=e;const s=this.taskId;const i=class extends(ft(t)){getTaskId(){return s}};this.messageMenuManager.getInstance().registerMenuByCallback(this.isCurrentChat,i)},unregisterMessageMenu(){var t;(t=this.messageMenuManager)==null?void 0:t.getInstance().unregisterMenuByCallback(this.isCurrentChat)},isCurrentChat(t){return t.chatId===this.task.chatId},tryShowAha(){if(this.taskChatAhaBindElement&&q.ahaMoments.shouldShow(it.Option.AhaTaskChatPopup)){q.ahaMoments.setActive(it.Option.AhaTaskChatPopup);setTimeout(this.showTaskChatAha,3e3);return}if(this.taskImportantMessagesAhaBindElement&&q.ahaMoments.shouldShow(it.Option.AhaTaskImportantMessagesPopup)){q.ahaMoments.setActive(it.Option.AhaTaskImportantMessagesPopup);setTimeout(this.showTaskImportantMessagesAha,3e3)}},showTaskChatAha(){this.isTaskChatAhaShown=true;q.ahaMoments.setShown(it.Option.AhaTaskChatPopup)},showTaskImportantMessagesAha(){this.isTaskImportantMessagesAhaShown=true;q.ahaMoments.setShown(it.Option.AhaTaskImportantMessagesPopup)},handleCloseChatAha(){this.isTaskChatAhaShown=false;q.ahaMoments.setInactive(it.Option.AhaTaskChatPopup);if(q.ahaMoments.shouldShow(it.Option.AhaTaskImportantMessagesPopup)){setTimeout(this.showTaskImportantMessagesAha,2e3)}},handleCloseImportantMessagesAha(){this.isTaskImportantMessagesAhaShown=false;q.ahaMoments.setInactive(it.Option.AhaTaskImportantMessagesPopup)}},template:`\n\t\t<div class="tasks-full-card-chat" ref="chat">\n\t\t\t<div style="color: #f00">module 'im' is not installed</div>\n\t\t</div>\n\t\t<ChatAha\n\t\t\tv-if="isTaskChatAhaShown"\n\t\t\t:isShown="isTaskChatAhaShown"\n\t\t\t:bindElement="taskChatAhaBindElement"\n\t\t\t@close="handleCloseChatAha"\n\t\t/>\n\t\t<ImportantMessagesAha\n\t\t\tv-if="isTaskImportantMessagesAhaShown"\n\t\t\t:isShown="isTaskImportantMessagesAhaShown"\n\t\t\t:bindElement="taskImportantMessagesAhaBindElement"\n\t\t\t@close="handleCloseImportantMessagesAha"\n\t\t/>\n\t`};const At=50;const _t={components:{Chip:x.Chip},props:{chips:{type:Array,required:true}},setup(){return{Outline:tt.Outline,ChipDesign:x.ChipDesign}},data(){return{chipsCollapsed:true}},computed:{preparedChips(){return this.chips.filter((({isEnabled:t})=>t!=null?t:true)).map(((t,e)=>({...t,collapsed:e>=At})))},hasCollapsedChips(){return this.preparedChips.some((({collapsed:t})=>t))}},template:`\n\t\t<div class="tasks-full-card-chips">\n\t\t\t<template v-for="(chip, key) of preparedChips" :key>\n\t\t\t\t<component\n\t\t\t\t\tv-if="!chip.collapsed || !chipsCollapsed"\n\t\t\t\t\t:is="chip.component"\n\t\t\t\t\tv-bind="chip.props ?? {}"\n\t\t\t\t\tv-on="chip.events ?? {}"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<Chip\n\t\t\t\tv-if="hasCollapsedChips"\n\t\t\t\t:design="ChipDesign.ShadowNoAccent"\n\t\t\t\t:icon="chipsCollapsed ? Outline.APPS : Outline.CHEVRON_TOP_L"\n\t\t\t\t:text="chipsCollapsed ? loc('TASKS_V2_TASK_FULL_CARD_MORE') : ''"\n\t\t\t\t@click="chipsCollapsed = !chipsCollapsed"\n\t\t\t/>\n\t\t</div>\n\t`};const bt={components:{UiButton:ht.Button,AddTaskButton:G.AddTaskButton,TemplatesButton:$.BitrixVue.defineAsyncComponent("tasks.v2.component.templates-button","TemplatesButton",{delay:0,loadingComponent:{components:{BLine:j.BLine},template:'<BLine :width="131" :height="22"/>'}}),TemplatePermissionsButton:$.BitrixVue.defineAsyncComponent("tasks.v2.component.template-permissions-button","TemplatePermissionsButton",{delay:0,loadingComponent:{components:{BLine:j.BLine},template:'<BLine :width="131" :height="22"/>'}})},inject:{isTemplate:{}},props:{creationError:{type:Boolean,required:true}},emits:["addTask","copyTask","fromTemplate","template","update:creationError","close"],setup(){return{AirButtonStyle:ht.AirButtonStyle,ButtonSize:ht.ButtonSize}},computed:{hasError:{get(){return this.creationError},set(t){this.$emit("update:creationError",t)}},isTemplateEnabled(){return X.Core.getParams().features.isTemplateEnabled}},template:`\n\t\t<div class="tasks-full-card-footer">\n\t\t\t<div class="tasks-full-card-footer-create">\n\t\t\t\t<div class="tasks-full-card-footer-main-buttons">\n\t\t\t\t\t<AddTaskButton\n\t\t\t\t\t\tv-model:hasError="hasError"\n\t\t\t\t\t\t@addTask="$emit('addTask')"\n\t\t\t\t\t\t@copyTask="$emit('copyTask', $event)"\n\t\t\t\t\t\t@fromTemplate="$emit('fromTemplate', $event)"\n\t\t\t\t\t/>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:text="loc('TASKS_V2_TASK_FULL_CARD_CANCEL')"\n\t\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t\t\t:dataset="{ taskButtonId: 'cancel' }"\n\t\t\t\t\t\t@click="$emit('close')"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<TemplatesButton v-if="!isTemplate && isTemplateEnabled" @template="$emit('template', $event)"/>\n\t\t\t\t<TemplatePermissionsButton v-if="isTemplate"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Bt=Object.freeze({Start:"start",Take:"take",Pause:"pause",Complete:"complete",Renew:"renew",Review:"review",Approve:"approve"});const Lt={name:"TaskFullCardMoreActionsStatus",components:{UiButton:ht.Button,BMenu:Q.BMenu},inject:{task:{},taskId:{},isTemplate:{},settings:{},analytics:{}},props:{selectedButtons:{type:Array,default:()=>[]}},setup(){return{Outline:tt.Outline,AirButtonStyle:ht.AirButtonStyle,ButtonSize:ht.ButtonSize}},data(){return{isMenuShown:false,loading:false}},computed:{...J.mapGetters({currentUserId:`${it.Model.Interface}/currentUserId`}),group(){return this.$store.getters[`${it.Model.Groups}/getById`](this.task.groupId)},isScrum(){var t;return((t=this.group)==null?void 0:t.type)===it.GroupType.Scrum},isCreator(){return this.currentUserId===this.task.creatorId},isResponsible(){var t;return this.task.responsibleIds.includes(this.currentUserId)||((t=this.task.accomplicesIds)==null?void 0:t.includes(this.currentUserId))},menuOptions(){return()=>({id:"tasks-full-card-footer-more-menu",bindElement:this.$refs.button,items:this.menuItems})},menuItems(){if(this.isTemplate){return[this.getCreateSubtaskForTemplate(),this.getDeleteTemplate()].filter((t=>t!==null))}const t={[it.TaskStatus.Pending]:[this.getCompleteItem(),this.getDefferItem(),this.getDelegateItem(),this.getDeleteItem(),this.getStartItem()],[it.TaskStatus.InProgress]:[this.getPauseItem(),this.getDefferItem(),this.getDelegateItem(),this.getDeleteItem()],[it.TaskStatus.Deferred]:[this.getDelegateItem(),this.getDeleteItem(),this.getCompleteItem()],[it.TaskStatus.SupposedlyCompleted]:[this.getFixItem(),this.getDelegateItem(),this.getDeleteItem()],[it.TaskStatus.Completed]:[this.getRenewItem(),this.getDeleteItem()]};const e=t[this.task.status]||[];return e.filter((t=>t!==null))},selectedButtonIds(){return new Set(this.selectedButtons.map((t=>t==null?void 0:t.id)))},isDelegateLocked(){return!this.settings.restrictions.delegating.available}},methods:{handleClick(){this.isMenuShown=true},getStartItem(){if(!this.task.rights.start){return null}if(this.selectedButtonIds.has(Bt.Start)||this.selectedButtonIds.has(Bt.Take)){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_START"),icon:tt.Outline.PLAY_L,onClick:()=>this.waitStatus(dt.statusService.start(this.taskId))}},getDefferItem(){if(!this.task.rights.defer){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_DEFER"),icon:tt.Outline.PAUSE_L,onClick:()=>this.waitStatus(dt.statusService.defer(this.taskId))}},getPauseItem(){if(!this.task.rights.pause){return null}if(this.selectedButtonIds.has(Bt.Pause)){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_PAUSE"),icon:tt.Outline.HOURGLASS,onClick:()=>this.waitStatus(dt.statusService.pause(this.taskId))}},getRenewItem(){if(!this.task.rights.renew){return null}if(this.selectedButtonIds.has(Bt.Renew)){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_RENEW"),icon:tt.Outline.UNDO,onClick:()=>this.waitStatus(dt.statusService.renew(this.taskId))}},getFixItem(){if(!this.task.rights.renew&&!this.task.rights.disapprove){return null}const t=this.isCreator&&!this.isResponsible?this.loc("TASKS_V2_TASK_FULL_CARD_DISAPPROVE"):this.loc("TASKS_V2_TASK_FULL_CARD_FIX");const e=this.task.rights.renew?()=>this.waitStatus(dt.statusService.renew(this.taskId)):()=>this.waitStatus(dt.statusService.disapprove(this.taskId));return{title:t,onClick:e,icon:tt.Outline.UNDO}},getCompleteItem(){if(!this.task.rights.complete){return null}if(this.selectedButtonIds.has(Bt.Complete)){return null}return{title:this.loc("TASKS_V2_TASK_FULL_CARD_COMPLETE"),icon:tt.Outline.SENDED,onClick:()=>{var t,e,s,i;return this.waitStatus(dt.statusService.complete(this.taskId,{context:(t=(e=this.analytics)==null?void 0:e.context)!=null?t:it.Analytics.Section.Tasks,additionalContext:(s=(i=this.analytics)==null?void 0:i.additionalContext)!=null?s:it.Analytics.SubSection.TaskCard,element:it.Analytics.Element.ContextMenu}))}}},getDelegateItem(){if(!this.task.rights.delegate){return null}return{icon:tt.Outline.DELEGATE,title:this.loc("TASKS_V2_TASK_FULL_CARD_DELEGATE"),isLocked:this.isDelegateLocked,onClick:()=>this.handleDelegateSelect()}},handleClose(t){if(t.length===1){void ot.taskService.update(this.taskId,{responsibleIds:t})}},async handleDelegateSelect(){if(this.isDelegateLocked){void nt.showLimit({featureId:this.settings.restrictions.delegating.featureId});return}void at.usersDialog.show({targetNode:this.$refs.button,ids:this.task.responsibleIds,isMultiple:false,onClose:this.handleClose})},getDeleteItem(){if(!this.task.rights.remove){return null}return{design:Q.MenuItemDesign.Alert,title:this.loc("TASKS_V2_TASK_FULL_CARD_DELETE"),icon:tt.Outline.TRASHCAN,onClick:()=>{void ot.taskService.delete(this.taskId);Z.EventEmitter.emit(it.EventName.CloseFullCard,{taskId:this.taskId})}}},async waitStatus(t){this.loading=true;await t;this.loading=false},getCreateSubtaskForTemplate(){if(!this.settings.rights.templates.create){return null}const t=!this.settings.restrictions.templatesSubtasks.available;return{isLocked:t,title:this.loc("TASKS_V2_TASK_TEMPLATE_CREATE_SUBTASK"),icon:tt.Outline.RELATED_TASKS,onClick:()=>{if(t){void nt.showLimit({featureId:this.settings.restrictions.templatesSubtasks.featureId});return}st.TaskCard.showCompactCard({taskId:"template0",groupId:this.task.groupId,parentId:this.taskId})}}},getCopyTemplate(){if(!this.settings.rights.templates.create){return null}return{title:this.loc("TASKS_V2_TASK_TEMPLATE_COPY"),icon:tt.Outline.COPY,onClick:()=>st.TaskCard.showFullCard({taskId:"template0",copiedFromId:lt.idUtils.unbox(this.taskId)})}},getDeleteTemplate(){if(!this.task.rights.remove){return null}return{design:Q.MenuItemDesign.Alert,title:this.loc("TASKS_V2_TASK_TEMPLATE_DELETE"),icon:tt.Outline.TRASHCAN,onClick:async()=>{await rt.templateService.delete(this.taskId);Z.EventEmitter.emit(it.EventName.CloseFullCard,{taskId:this.taskId})}}}},template:`\n\t\t<div ref="button">\n\t\t\t<UiButton\n\t\t\t\tv-if="menuItems.length > 0"\n\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t:leftIcon="Outline.MORE_L"\n\t\t\t\t:loading\n\t\t\t\t:dataset="{ taskButtonId: 'more' }"\n\t\t\t\tref="button"\n\t\t\t\t@click="handleClick"\n\t\t\t/>\n\t\t</div>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions()" @close="isMenuShown = false"/>\n\t`};const yt={components:{Hint:W.Hint,UiButton:ht.Button,BIcon:tt.BIcon,More:Lt,TextMd:z.TextMd,TextXs:z.TextXs,MarkTaskButton:Y.MarkTaskButton,TemplatePermissionsButton:$.BitrixVue.defineAsyncComponent("tasks.v2.component.template-permissions-button","TemplatePermissionsButton",{delay:0,loadingComponent:{components:{BLine:j.BLine},template:'<BLine :width="131" :height="22"/>'}})},inject:{task:{},taskId:{},isTemplate:{},settings:{},analytics:{}},setup(){return{AirButtonStyle:ht.AirButtonStyle,ButtonSize:ht.ButtonSize,ButtonIcon:ht.ButtonIcon,Outline:tt.Outline,TaskStatus:it.TaskStatus}},data(){return{loading:false,showStartTimeTrackingHint:false,computedSecondaryButton:null}},computed:{...J.mapGetters({currentUserId:`${it.Model.Interface}/currentUserId`}),timer(){var t;return(t=this.task.timers)==null?void 0:t.find((t=>t.userId===this.currentUserId))},group(){return this.$store.getters[`${it.Model.Groups}/getById`](this.task.groupId)},isScrum(){var t;return((t=this.group)==null?void 0:t.type)===it.GroupType.Scrum},isCreator(){return this.currentUserId===this.task.creatorId},primaryButton(){const t=this.task.rights.timeTracking?[this.getStartTimerButton(),this.getPauseButton(ht.AirButtonStyle.OUTLINE)]:[this.getCompleteButton()];const e={[it.TaskStatus.Pending]:[this.getTakeButton(),this.getStartTimerButton(),this.getPauseButton(ht.AirButtonStyle.OUTLINE),this.getStartButton(),this.getCompleteButton()],[it.TaskStatus.InProgress]:t,[it.TaskStatus.Deferred]:this.getRenewButton(),[it.TaskStatus.SupposedlyCompleted]:[this.getApproveButton(),this.getReviewButton()],[it.TaskStatus.Completed]:this.getRenewButton(ht.AirButtonStyle.PLAIN)};if(ct.Type.isArray(e[this.task.status])){return e[this.task.status].find((t=>t!==null))}return e[this.task.status]||null},secondaryButton(){return this.computedSecondaryButton},selectedButtons(){return[this.primaryButton,this.secondaryButton]},shouldShowStartTimeTrackingHint(){var t;return this.showStartTimeTrackingHint&&((t=this.primaryButton)==null?void 0:t.id)===Bt.Start},shouldShowMarkTaskButton(){return this.task.rights.mark||this.task.mark!==it.Mark.None},showFooter(){if(this.isTemplate){return this.settings.rights.tasks.createFromTemplate||this.task.rights.edit}return Boolean(this.primaryButton||this.secondaryButton||this.shouldShowMarkTaskButton)}},watch:{primaryButton:{handler:"updateSecondaryButton",immediate:true},"task.status":{handler:"updateSecondaryButton"}},mounted(){this.$bitrix.eventEmitter.subscribe(it.EventName.TimeTrackingChange,this.handleTimeTrackingActivating)},methods:{getStartButton(){if(!this.task.rights.start||this.timer){return null}return{id:Bt.Start,text:this.loc("TASKS_V2_TASK_FULL_CARD_START"),onClick:()=>this.waitStatus(dt.statusService.start(this.taskId))}},getTakeButton(){if(!this.task.rights.take||this.task.status!==it.TaskStatus.Pending){return null}return{id:Bt.Take,text:this.loc("TASKS_V2_TASK_FULL_CARD_TAKE"),onClick:()=>this.waitStatus(dt.statusService.take(this.taskId))}},getStartTimerButton(){if(!this.task.rights.timeTracking||this.timer){return null}return{id:Bt.Start,text:this.loc("TASKS_V2_TASK_FULL_CARD_START"),onClick:()=>this.waitStatus(dt.statusService.startTimer(this.taskId)),icon:ht.ButtonIcon.START}},getCompleteButton(t){if(!this.task.rights.complete){return null}return{id:Bt.Complete,text:this.loc("TASKS_V2_TASK_FULL_CARD_COMPLETE"),style:t,onClick:()=>{var t,e,s,i;return this.waitStatus(dt.statusService.complete(this.taskId,{context:(t=(e=this.analytics)==null?void 0:e.context)!=null?t:it.Analytics.Section.Tasks,additionalContext:(s=(i=this.analytics)==null?void 0:i.additionalContext)!=null?s:it.Analytics.SubSection.TaskCard,element:it.Analytics.Element.ContextMenu}))}}},getPauseButton(t){if(!this.task.rights.timeTracking||!this.timer){return null}return{id:Bt.Pause,text:this.loc("TASKS_V2_TASK_FULL_CARD_PAUSE_TIMER"),style:t,onClick:()=>this.waitStatus(dt.statusService.pauseTimer(this.taskId))}},getRenewButton(t){if(!this.task.rights.renew){return null}return{id:Bt.Renew,text:this.loc("TASKS_V2_TASK_FULL_CARD_RENEW"),style:t,onClick:()=>this.waitStatus(dt.statusService.renew(this.taskId))}},getReviewButton(){return{id:Bt.Review,text:this.loc("TASKS_V2_TASK_FULL_CARD_ON_REVIEW_MSGVER_1"),disabled:true}},getApproveButton(){if(!this.task.rights.approve){return null}return{id:Bt.Approve,text:this.loc("TASKS_V2_TASK_FULL_CARD_APPROVE"),onClick:()=>this.waitStatus(dt.statusService.approve(this.taskId))}},updateSecondaryButton(){void this.$nextTick((()=>{const t=this.task.rights.timeTracking?this.getCompleteButton(this.timer?"":ht.AirButtonStyle.OUTLINE):null;const e={[it.TaskStatus.Pending]:this.getCompleteButton(ht.AirButtonStyle.OUTLINE),[it.TaskStatus.InProgress]:t};let s=e[this.task.status]||null;if(s&&this.primaryButton&&s.id===this.primaryButton.id){s=null}this.computedSecondaryButton=s}))},handleOverPrimaryButton(){var t;if(this.task.rights.timeTracking&&((t=this.primaryButton)==null?void 0:t.id)===Bt.Start&&q.ahaMoments.shouldShow(it.Option.AhaStartTimeTracking)){q.ahaMoments.setActive(it.Option.AhaStartTimeTracking);this.showStartTimeTrackingHint=true}},handleTimeTrackingActivating(){void this.waitStatus(new Promise((t=>{const e=this.$watch((()=>this.task.rights.timeTracking),(async()=>{await this.$nextTick();t()}),{immediate:false});setTimeout((()=>{e();t()}),5e3)})))},hideStartTimeTrackingHint(){this.showStartTimeTrackingHint=false},hidePermanentStartTimeTrackingHint(){this.hideStartTimeTrackingHint();q.ahaMoments.setInactive(it.Option.AhaStartTimeTracking);q.ahaMoments.setShown(it.Option.AhaStartTimeTracking)},async waitStatus(t){this.loading=true;await t;this.loading=false},createTaskFromTemplate(){st.TaskCard.showFullCard({templateId:lt.idUtils.unbox(this.taskId),analytics:{context:it.Analytics.Section.Templates,additionalContext:it.Analytics.SubSection.TemplatesCard,element:it.Analytics.Element.CreateButton}})}},template:`\n\t\t<div v-if="showFooter" class="tasks-full-card-footer">\n\t\t\t<div class="tasks-full-card-footer-edit">\n\t\t\t\t<UiButton\n\t\t\t\t\tv-if="isTemplate && settings.rights.tasks.createFromTemplate"\n\t\t\t\t\t:text="loc('TASKS_V2_TASK_TEMPLATE_CREATE_TASK')"\n\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t:dataset="{ taskButtonId: 'createFromTemplate' }"\n\t\t\t\t\t:leftIcon="Outline.PLUS_L"\n\t\t\t\t\t@click="createTaskFromTemplate"\n\t\t\t\t/>\n\t\t\t\t<template v-if="!isTemplate">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="primaryButton"\n\t\t\t\t\t\tref="primaryButton"\n\t\t\t\t\t\t@mouseover="handleOverPrimaryButton"\n\t\t\t\t\t>\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text="primaryButton.text"\n\t\t\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t\t\t:style="primaryButton.style ?? AirButtonStyle.FILLED"\n\t\t\t\t\t\t\t:disabled="Boolean(primaryButton.disabled)"\n\t\t\t\t\t\t\t:loading\n\t\t\t\t\t\t\t:leftIcon="primaryButton.icon"\n\t\t\t\t\t\t\t:dataset="{ taskButtonId: 'status' }"\n\t\t\t\t\t\t\t@click="primaryButton.onClick"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\tv-if="secondaryButton && !loading"\n\t\t\t\t\t\t:text="secondaryButton.text"\n\t\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t\t:style="secondaryButton.style ?? AirButtonStyle.FILLED"\n\t\t\t\t\t\t:disabled="secondaryButton.disabled ?? false"\n\t\t\t\t\t\t:dataset="{ taskButtonId: 'secondary' }"\n\t\t\t\t\t\t@click="secondaryButton.onClick"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<More :selectedButtons/>\n\t\t\t\t<div class="tasks-full-card-footer-edit-grow"/>\n\t\t\t\t<MarkTaskButton v-if="!isTemplate && shouldShowMarkTaskButton"/>\n\t\t\t\t<TemplatePermissionsButton v-if="isTemplate && task.rights.edit"/>\n\t\t\t</div>\n\t\t\t<Hint\n\t\t\t\tv-if="shouldShowStartTimeTrackingHint"\n\t\t\t\t:bindElement="$refs.primaryButton"\n\t\t\t\t:options="{\n\t\t\t\t\tcloseIcon: true,\n\t\t\t\t\toffsetLeft: 24,\n\t\t\t\t\tminWidth: 344,\n\t\t\t\t\tmaxWidth: 344,\n\t\t\t\t}"\n\t\t\t\t@close="hideStartTimeTrackingHint"\n\t\t\t>\n\t\t\t\t<div class="tasks-full-card-start-time-tracking-hint">\n\t\t\t\t\t<TextMd class="tasks-full-card-start-time-tracking-hint-info-text">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_FULL_CARD_AHA_START_TIME_TRACKING_HINT_TEXT') }}\n\t\t\t\t\t</TextMd>\n\t\t\t\t\t<TextXs\n\t\t\t\t\t\tclass="tasks-full-card-start-time-tracking-hint-info-link"\n\t\t\t\t\t\t@click.stop="hidePermanentStartTimeTrackingHint"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_FULL_CARD_AHA_START_TIME_TRACKING_HINT_MORE') }}\n\t\t\t\t\t</TextXs>\n\t\t\t\t</div>\n\t\t\t</Hint>\n\t\t</div>\n\t`};const wt={components:{UiButton:ht.Button},props:{imgSrc:{type:String,default:""},head:{type:String,default:""},descr:{type:String,default:""},action:{type:Object,default:null}},setup(){return{ButtonSize:ht.ButtonSize,AirButtonStyle:ht.AirButtonStyle}},data(){return{}},computed:{},methods:{},template:`\n\t\t<div class="tasks-full-card-placeholder">\n\t\t\t<div class="tasks-full-card-placeholder__content">\n\t\t\t\t<div v-if="imgSrc" class="tasks-full-card-placeholder__img-container">\n\t\t\t\t\t<img :src="imgSrc" alt="noAccess" class="tasks-full-card-placeholder__img"/>\n\t\t\t\t</div>\n\t\t\t\t<h3 v-if="head" class="tasks-full-card-placeholder__head">{{ head }}</h3>\n\t\t\t\t<p v-if="descr" class="tasks-full-card-placeholder__descr">{{ descr }}</p>\n\t\t\t\t<div class="tasks-full-card-placeholder__action-container">\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\tv-if="action"\n\t\t\t\t\t\tclass="tasks-full-card-placeholder__action"\n\t\t\t\t\t\t:text="action.text"\n\t\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t\t:style="AirButtonStyle.FILLED"\n\t\t\t\t\t\t:disabled="action.disabled"\n\t\t\t\t\t\t:loading="action.isLoading"\n\t\t\t\t\t\t@click="action.click"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Et=ct.Reflection.namespace("BX.userOptions");const Pt={name:"TaskFullCard",components:{TaskHeader:vt,DescriptionField:h.DescriptionField,Files:k.Files,CheckList:T.CheckList,DatePlan:I.DatePlan,SubTasks:_.SubTasks,ParentTask:b.ParentTask,RelatedTasks:B.RelatedTasks,Gantt:L.Gantt,Results:y.Results,Placements:R.Placements,Reminders:w.Reminders,Replication:E.Replication,FieldList:n.FieldList,Chat:It,FooterCreate:bt,FooterEdit:yt,Placeholder:wt,DropZone:o.DropZone,Chips:_t,ContentResizer:l.ContentResizer,TaskSettingsHint:gt,Email:P.Email,EmailFrom:P.EmailFrom,EmailDate:P.EmailDate,UserFields:M.UserFields,CreatedDate:O.CreatedDate},provide(){return{analytics:this.analytics,cardType:it.CardType.Full,settings:X.Core.getParams(),task:$.computed((()=>ot.taskService.getStoreTask(this.taskId))),taskId:$.computed((()=>this.taskId)),isEdit:$.computed((()=>lt.idUtils.isReal(this.taskId))),isTemplate:$.computed((()=>lt.idUtils.isTemplate(this.taskId)))}},props:{id:{type:[Number,String],required:true},initialTask:{type:Object,required:true},analytics:{type:Object,default:()=>({})}},setup(){return{EntityTextTypes:r.EntityTextTypes,EntityTypes:H.EntityTypes,TaskField:it.TaskField}},data(){return{taskId:this.id,isFilesSheetShown:false,isDescriptionSheetShown:false,isCheckListSheetShown:false,isDatePlanSheetShown:false,isTimeTrackingSheetShown:false,isTimeTrackingChipSheetShown:false,isResultListSheetShown:false,isResultEditorSheetShown:false,isResultChipSheetShown:false,isReminderSheetShown:false,isRemindersSheetShown:false,isReplicationSheetShown:false,isReplicationHistorySheetShown:false,isPrimaryFieldsHovered:false,isSettingsPopupShown:false,isTaskSettingsHintShown:false,checkListId:0,files:H.fileService.get(this.id).getFiles(),isLoading:true,creationError:false,taskInitial:null,placeholderImgUrl:null}},computed:{...J.mapGetters({defaultDeadlineTs:`${it.Model.Interface}/defaultDeadlineTs`,fullCardWidth:`${it.Model.Interface}/fullCardWidth`,stateFlags:`${it.Model.Interface}/stateFlags`,taskUserFieldScheme:`${it.Model.Interface}/taskUserFieldScheme`,templateUserFieldScheme:`${it.Model.Interface}/templateUserFieldScheme`}),task(){return ot.taskService.getStoreTask(this.taskId)},group(){return this.$store.getters[`${it.Model.Groups}/getById`](this.task.groupId)},checklist(){if(!this.task.checklist){return[]}return this.$store.getters[`${it.Model.CheckList}/getByIds`](this.task.checklist)},isEdit(){return lt.idUtils.isReal(this.taskId)},isTemplate(){return lt.idUtils.isTemplate(this.taskId)},isCreator(){return this.currentUserId===this.task.creatorId},isAdmin(){return X.Core.getParams().rights.user.admin},isFlowFilledOnAdd(){return this.task.flowId>0&&!this.isEdit},canChangeDeadline(){if(!this.isEdit){return true}return this.task.rights.deadline&&!this.isFlowFilledOnAdd},canChangeDeadlineWithoutLimitation(){return!this.isEdit||this.isCreator||this.task.rights.edit||this.isAdmin},isPartiallyLoaded(){return this.$store.getters[`${it.Model.Tasks}/isPartiallyLoaded`](this.taskId)},userFieldScheme(){return this.isTemplate?this.templateUserFieldScheme:this.taskUserFieldScheme},defaultRequireResult(){var t;return this.isTemplate?false:(t=this.stateFlags.defaultRequireResult)!=null?t:false},fields(){return[{title:c.creatorMeta.title,component:c.Creator},{title:u.responsibleMeta.getTitle(!this.task.isForNewUser&&this.task.responsibleIds.length>1),component:u.Responsible,props:{taskId:this.taskId}},{title:p.deadlineMeta.title,component:p.Deadline,props:{taskId:this.taskId,isTemplate:this.isTemplate,isHovered:this.isPrimaryFieldsHovered||this.isTaskSettingsHintShown},events:{isSettingsPopupShown:t=>{this.isSettingsPopupShown=t}}},{title:A.timeTrackingMeta.title,component:A.TimeTracking,props:{isSheetShown:this.isTimeTrackingSheetShown,sheetBindProps:this.sheetBindProps},events:{"update:isSheetShown":t=>{this.isTimeTrackingSheetShown=t}}},!this.isTemplate&&{title:m.statusMeta.title,component:m.Status,withSeparator:true},!this.isTemplate&&{title:O.createdDateMeta.title,component:O.CreatedDate},{title:P.emailMeta.title,component:P.Email,chip:{component:P.EmailChip,isEnabled:this.wasFilled(it.TaskField.Email)}},{title:P.emailMeta.fromTitle,component:P.EmailFrom,withSeparator:true},{title:P.emailMeta.dateTitle,component:P.EmailDate},!this.isTemplate&&{chip:{component:y.ResultsChip,props:{isSheetShown:this.isResultChipSheetShown,sheetBindProps:this.sheetBindProps},events:{"update:isSheetShown":t=>{this.isResultChipSheetShown=t}}}},X.Core.getParams().features.disk&&{chip:{component:k.FilesChip,props:{taskId:this.taskId},isEnabled:this.wasFilled(it.TaskField.Files)||this.files.length>0||this.task.rights.attachFile||this.task.rights.edit}},{chip:{component:$.BitrixVue.defineAsyncComponent("tasks.v2.component.fields.comment-files","CommentFilesChip",{delay:0,loadingComponent:{components:{BLine:j.BLine},template:'<BLine :width="212" :height="32"/>'}}),isEnabled:this.task.containsCommentFiles===true}},{chip:{component:T.CheckListChip,events:{showCheckList:this.openCheckList},isEnabled:this.task.rights.checklistSave}},X.Core.getParams().features.isProjectsEnabled&&{title:S.groupMeta.getTitle(this.task.groupId),component:S.Group,chip:{component:S.GroupChip,isEnabled:this.wasFilled(it.TaskField.Group)||this.task.rights.edit}},{title:g.accomplicesMeta.title,component:g.Accomplices,chip:{component:g.AccomplicesChip,isEnabled:this.wasFilled(it.TaskField.Accomplices)||this.task.rights.changeAccomplices}},{title:f.auditorsMeta.title,component:f.Auditors,chip:{component:f.AuditorsChip,isEnabled:this.wasFilled(it.TaskField.Auditors)||this.task.rights.addAuditors},withSeparator:this.wasFilled(it.TaskField.Accomplices)},!this.isTemplate&&{chip:{component:R.PlacementsChip,isEnabled:this.isEdit&&this.wasFilled(it.TaskField.Placements)}},!this.isTemplate&&X.Core.getParams().features.isFlowEnabled&&{title:v.flowMeta.title,component:v.Flow,chip:{component:v.FlowChip,isEnabled:this.wasFilled(it.TaskField.Flow)||this.task.rights.edit},withSeparator:true},X.Core.getParams().features.isProjectsEnabled&&{title:S.groupMeta.stageTitle,component:S.Stage},X.Core.getParams().features.isProjectsEnabled&&{title:S.groupMeta.epicTitle,component:S.Epic},X.Core.getParams().features.isProjectsEnabled&&{title:S.groupMeta.storyPointsTitle,component:S.StoryPoints},{title:C.tagsMeta.title,component:C.Tags,chip:{component:C.TagsChip,isEnabled:this.wasFilled(it.TaskField.Tags)||this.task.rights.edit}},!this.isTemplate&&{chip:{component:w.RemindersChip,props:{isSheetShown:this.isReminderSheetShown,sheetBindProps:this.sheetBindProps},events:{"update:isSheetShown":t=>{this.isReminderSheetShown=t}},isEnabled:this.wasFilled(it.TaskField.Reminders)||this.task.rights.reminder}},X.Core.getParams().features.crm&&{title:F.crmMeta.title,component:F.Crm,chip:{component:F.CrmChip,collapsed:true,isEnabled:this.wasFilled(it.TaskField.Crm)||this.task.rights.edit},withSeparator:this.wasFilled(it.TaskField.Group)||this.wasFilled(it.TaskField.Flow)},{chip:{component:b.ParentTaskChip,collapsed:true,isEnabled:this.wasFilled(it.TaskField.Parent)||this.task.rights.edit}},{chip:{component:_.SubTasksChip,collapsed:true,isEnabled:this.wasFilled(it.TaskField.SubTasks)||this.task.rights.createSubtask||!this.isEdit}},{chip:{component:B.RelatedTasksChip,collapsed:true,isEnabled:this.wasFilled(it.TaskField.RelatedTasks)||this.task.rights.edit}},!this.isTemplate&&{chip:{component:L.GanttChip,collapsed:true,isEnabled:this.wasFilled(it.TaskField.Gantt)||this.task.rights[L.ganttMeta.right]}},{chip:{component:I.DatePlanChip,collapsed:true,isEnabled:this.wasFilled(it.TaskField.DatePlan)||this.task.rights.edit,props:{isSheetShown:this.isDatePlanSheetShown,sheetBindProps:this.sheetBindProps},events:{"update:isSheetShown":t=>{this.isDatePlanSheetShown=t}}}},this.isTemplate&&{chip:{component:E.ReplicationChip,props:{isSheetShown:this.isReplicationSheetShown,sheetBindProps:this.sheetBindProps},isEnabled:this.wasFilled(it.TaskField.Replication)||this.task.rights.edit,events:{"update:isSheetShown":t=>{this.isReplicationSheetShown=t}}}},{chip:{component:A.TimeTrackingChip,collapsed:true,isEnabled:this.task.rights.edit||this.task.rights.elapsedTime,props:{isSheetShown:this.isTimeTrackingChipSheetShown,sheetBindProps:this.sheetBindProps},events:{"update:isSheetShown":t=>{this.isTimeTrackingChipSheetShown=t}}}},{chip:{component:M.UserFieldsChip,collapsed:true,isEnabled:this.shouldShowUserFieldsChip,events:{open:this.openUserFieldsHandler}}}].filter((t=>t))},sheetBindProps(){return{getBindElement:()=>this.$refs.title,getTargetContainer:()=>this.$refs.main}},primaryFields(){return this.getFields(new WeakMap([[c.Creator,true],[u.Responsible,true],[p.Deadline,true],[A.TimeTracking,this.task.allowsTimeTracking||this.task.rights.elapsedTime&&this.task.numberOfElapsedTimes],[m.Status,this.isEdit],[O.CreatedDate,this.isEdit]]))},projectFields(){var t,e;const s=((t=this.group)==null?void 0:t.type)===it.GroupType.Scrum;return this.getFields(new WeakMap([[S.Group,this.wasFilled(it.TaskField.Group)],[v.Flow,this.wasFilled(it.TaskField.Flow)],[S.Stage,!this.isTemplate&&this.isEdit&&((e=this.group)==null?void 0:e.id)>0&&(this.task.stageId!==0||!s)],[S.Epic,!this.isTemplate&&s],[S.StoryPoints,!this.isTemplate&&s],[F.Crm,this.wasFilled(it.TaskField.Crm)]]))},participantsFields(){return this.getFields(new WeakMap([[g.Accomplices,this.wasFilled(it.TaskField.Accomplices)],[f.Auditors,this.wasFilled(it.TaskField.Auditors)]]))},tagsFields(){return this.getFields(new WeakMap([[C.Tags,this.wasFilled(it.TaskField.Tags)]]))},emailFields(){return this.getFields(new WeakMap([[P.Email,this.wasFilled(it.TaskField.Email)],[P.EmailFrom,this.wasFilled(it.TaskField.Email)&&this.task.email.from],[P.EmailDate,this.wasFilled(it.TaskField.Email)&&this.task.email.dateTs]]))},chips(){return this.fields.filter((({chip:t})=>t&&t.isEnabled!==false)).map((({chip:t})=>t))},isBottomSheetShown(){return this.isDescriptionSheetShown||this.isFilesSheetShown||this.isCheckListSheetShown||this.isDatePlanSheetShown||this.isTimeTrackingSheetShown||this.isTimeTrackingChipSheetShown||this.isResultListSheetShown||this.isResultEditorSheetShown||this.isResultChipSheetShown||this.isReminderSheetShown||this.isRemindersSheetShown||this.isReplicationSheetShown||this.isReplicationHistorySheetShown},isDiskModuleInstalled(){return X.Core.getParams().features.disk},taskSettingsBindElement(){if(this.isPrimaryFieldsHovered){return this.$refs.main.querySelector("[data-settings-label]")}return null},isCopyMode(){var t,e;return((t=this.initialTask)==null?void 0:t.copiedFromId)&&!lt.idUtils.isReal((e=this.task)==null?void 0:e.id)},placeholderOptions(){return{imgSrc:this.iconUrl,head:ct.Loc.getMessage("TASKS_V2_TASK_FULL_CARD_PLACEHOLDER_TITLE_NO_RIGHTS")}},isReplicateTemplate(){var t;return this.isTemplate&&((t=this.task)==null?void 0:t.replicate)===true},hasFilledUserFields(){var t;return M.userFieldsManager.hasFilledUserFields(((t=this.task)==null?void 0:t.userFields)||[],this.userFieldScheme)},hasRequiredUserFields(){return M.userFieldsManager.hasMandatoryUserFields(this.userFieldScheme)},shouldShowUserFields(){return this.isEdit?this.hasFilledUserFields:this.hasRequiredUserFields||this.hasFilledUserFields},shouldShowUserFieldsChip(){if(this.isAdmin){return true}return this.task.rights.edit&&this.userFieldScheme.length>0||this.hasFilledUserFields}},watch:{async isLoading(){await this.$nextTick();this.renderSkeleton()},async isPrimaryFieldsHovered(t){if(t&&q.ahaMoments.shouldShow(it.Option.AhaTaskSettingsMessagePopup)){setTimeout(this.showTaskSettingsHint,500)}},"task.templateId":function(t,e){if(this.taskInitial&&!this.isEdit&&t&&t!==e){void this.handleTemplate(t)}}},async created(){var t,e,s;if(!this.isEdit&&!this.task){var i,n,l;await ot.taskService.insertStoreTask({...this.initialTask,id:this.taskId,creatorId:X.Core.getParams().currentUser.id,responsibleIds:[X.Core.getParams().currentUser.id],deadlineTs:(i=this.initialTask.deadlineTs)!=null?i:this.defaultDeadlineTs,needsControl:(n=this.stateFlags.needsControl)!=null?n:null,matchesWorkTime:(l=this.stateFlags.matchesWorkTime)!=null?l:null,requireResult:X.Core.getParams().restrictions.requiredResult.available&&this.defaultRequireResult});if(this.initialTask.copiedFromId){await ot.taskService.getCopy(this.initialTask.copiedFromId,this.taskId)}if(this.initialTask.templateId){await rt.templateService.getTask(this.initialTask.templateId,this.taskId)}if(this.analytics.context){var o,d,h,c,u,p,m;a.analytics.sendClickCreate(this.analytics,{collabId:((o=this.group)==null?void 0:o.type)===it.GroupType.Collab?this.group.id:null,cardType:it.CardType.Full,viewersCount:(d=(h=this.initialTask)==null?void 0:(c=h.auditorsIds)==null?void 0:c.length)!=null?d:0,coexecutorsCount:(u=(p=this.initialTask)==null?void 0:(m=p.accomplicesIds)==null?void 0:m.length)!=null?u:0})}}await this.$store.dispatch(`${it.Model.Tasks}/clearFieldsFilled`,this.taskId);if(this.isEdit&&(!this.task||this.isPartiallyLoaded)){await ot.taskService.get(this.taskId)}if(((t=this.task)==null?void 0:(e=t.fileIds)==null?void 0:e.length)>0){await H.fileService.get(this.taskId).list(this.task.fileIds)}this.isLoading=false;if(!this.task){return}if(!this.isTemplate&&!this.canChangeDeadlineWithoutLimitation&&this.task.maxDeadlineChanges){void U.deadlineService.updateDeadlineChangeCount(this.task.id)}r.entityTextEditor.get(this.taskId,r.EntityTextTypes.Task,{content:(s=this.task)==null?void 0:s.description});this.taskInitial=this.task;if(this.isEdit&&this.analytics.context){var k,T,S,v,g,f;a.analytics.sendTaskView(this.analytics,{viewersCount:(k=(T=this.task)==null?void 0:(S=T.auditorsIds)==null?void 0:S.length)!=null?k:0,coexecutorsCount:(v=(g=this.task)==null?void 0:(f=g.accomplicesIds)==null?void 0:f.length)!=null?v:0})}await ct.Runtime.loadExtension(X.Core.getParams().externalExtensions);Z.EventEmitter.emit(it.EventName.FullCardInit,{task:this.task})},async mounted(){Z.EventEmitter.subscribe(it.EventName.FullCardHasChanges,this.handleHasChanges);this.renderSkeleton();this.iconUrl=(await Promise.resolve().then((function(){return ke}))).default},unmounted(){Z.EventEmitter.unsubscribe(it.EventName.FullCardHasChanges,this.handleHasChanges);if(!this.isEdit){void this.$store.dispatch(`${it.Model.Tasks}/delete`,this.taskId);H.fileService.delete(this.taskId);r.entityTextEditor.delete(this.taskId)}},methods:{...J.mapActions(it.Model.Interface,["updateFullCardWidth"]),getFields(t){return this.fields.filter((({component:e})=>t.get(e)))},wasFilled(t){return Boolean(this.task.filledFields[t])},async addTask(){const t=this.checklist;const[e,s]=await ot.taskService.add(this.task);if(!e){this.handleCreationError(s);return}this.taskId=e;H.fileService.replace(this.id,e);r.entityTextEditor.replace(this.id,e);const i=Boolean(e);this.sendAddTaskAnalytics(i,t);this.notifyGrid()},async copyTask(t){const{withSubTasks:e}=t;const[s,i]=await ot.taskService.copy(this.task,e);if(!s){this.handleCreationError(i);return}this.taskId=s;H.fileService.delete(this.id);await H.fileService.get(this.taskId).sync(this.task.fileIds);r.entityTextEditor.replace(this.id,s);this.notifyGrid()},async createFromTemplate(t){const{withSubTasks:e}=t;const[s,i]=await rt.templateService.addTask(this.task.templateId,this.task,e);if(!s){this.handleCreationError(i);this.sendAddTaskFromTemplateAnalytics(false);return}this.taskId=s;this.sendAddTaskFromTemplateAnalytics(true);H.fileService.delete(this.id);await H.fileService.get(this.taskId).sync(this.task.fileIds);r.entityTextEditor.replace(this.id,s);this.notifyGrid()},handleCreationError(t){this.creationError=true;V.Notifier.notifyViaBrowserProvider({id:"task-notify-add-error",text:t==null?void 0:t.message})},notifyGrid(){Z.EventEmitter.emit(it.EventName.NotifyGrid,new Z.BaseEvent({data:this.taskId,compatData:["ADD",{task:this.task,options:{}}]}))},openCheckList(t){this.checkListId=t;this.isCheckListSheetShown=true},closeCheckList(t){this.checkListId=t;this.isCheckListSheetShown=false},openUserFieldsHandler(){var t,e;void d.userFieldsSlider.open({taskId:this.taskId,isTemplate:this.isTemplate,templateId:this.isEdit?null:(t=this.task)==null?void 0:t.templateId,copiedFromId:this.isEdit?null:(e=this.task)==null?void 0:e.copiedFromId})},handleCloseTaskSettingsHint(){this.isTaskSettingsHintShown=false;q.ahaMoments.setInactive(it.Option.AhaTaskSettingsMessagePopup);if(q.ahaMoments.shouldShow(it.Option.AhaTaskSettingsMessagePopup)){q.ahaMoments.setShown(it.Option.AhaTaskSettingsMessagePopup)}},handleEndResize(t){const e=this.validateCardWidth(t);void this.updateFullCardWidth(e);Et.delay=100;Et.save("tasks","fullCard","cardWidth",e)},validateCardWidth(t){return Number.isNaN(parseInt(t,10))?null:parseInt(t,10)},handleHasChanges(t){const e={taskId:this.taskId};if(this.isEdit||t.getData().taskId!==this.taskId){e.hasChanges=false;return e}e.hasChanges=JSON.stringify(this.task)!==JSON.stringify(this.taskInitial);return e},tryClose(){Z.EventEmitter.emit(it.EventName.TryCloseFullCard,{taskId:this.taskId})},showTaskSettingsHint(){if(this.isSettingsPopupShown===false&&this.taskSettingsBindElement){q.ahaMoments.setActive(it.Option.AhaTaskSettingsMessagePopup);this.isTaskSettingsHintShown=true}},async handleTemplate(t){var e,s;this.isLoading=true;await rt.templateService.getTask(t,this.taskId);if(((e=this.task)==null?void 0:(s=e.fileIds)==null?void 0:s.length)>0){var i;await H.fileService.get(this.taskId).list((i=this.task)==null?void 0:i.fileIds)}await this.$store.dispatch(`${it.Model.Tasks}/clearFieldsFilled`,this.taskId);this.isLoading=false},renderSkeleton(){if(this.$refs.skeleton){const t="/bitrix/js/tasks/v2/application/task-card/src/skeleton-full.html?v=1";const e="/bitrix/js/tasks/v2/application/task-card/src/skeleton-template.html?v=1";void i.renderSkeleton(this.isTemplate?e:t,this.$refs.skeleton)}},sendAddTaskAnalytics(t,e){var s;const i=((s=this.group)==null?void 0:s.type)===it.GroupType.Collab?this.group.id:null;const n=this.task.auditorsIds.length;const l=this.task.accomplicesIds.length;if(this.task.templateId){this.sendAddTaskFromTemplateAnalytics(t)}else if(this.task.parentId){a.analytics.sendAddTask(this.analytics,{isSuccess:t,collabId:i,viewersCount:n,coexecutorsCount:l,event:it.Analytics.Event.SubTaskAdd,cardType:it.CardType.Full,taskId:this.taskId})}else if(e.length>0){const s=e.filter((({parentId:t})=>t===0)).length;const l=e.filter((({parentId:t})=>t!==0)).length;a.analytics.sendAddTaskWithCheckList(this.analytics,{isSuccess:t,collabId:i,viewersCount:n,checklistCount:s,checklistItemsCount:l,cardType:it.CardType.Full,taskId:this.taskId})}else{a.analytics.sendAddTask(this.analytics,{isSuccess:t,collabId:i,viewersCount:n,coexecutorsCount:l,event:it.Analytics.Event.TaskCreate,cardType:it.CardType.Full,taskId:this.taskId})}},sendAddTaskFromTemplateAnalytics(t){var e;const s=((e=this.group)==null?void 0:e.type)===it.GroupType.Collab?this.group.id:null;const i=this.task.auditorsIds.length;const n=this.task.accomplicesIds.length;a.analytics.sendAddTask(this.analytics,{isSuccess:t,collabId:s,viewersCount:i,coexecutorsCount:n,event:it.Analytics.Event.PatternTaskCreate,cardType:it.CardType.Full,taskId:this.taskId})}},template:`\n\t\t<div class="tasks-full-card" :class="{ '--blur': isDescriptionSheetShown }" :data-task-id="taskId" data-task-full>\n\t\t\t<template v-if="task && !isPartiallyLoaded && !isLoading">\n\t\t\t\t<div\n\t\t\t\t\tref="main"\n\t\t\t\t\tclass="tasks-full-card-main"\n\t\t\t\t\t:class="{ '--overlay': isBottomSheetShown }"\n\t\t\t\t\t:style="{ width: (isTemplate ? '100%' : fullCardWidth + 'px') }"\n\t\t\t\t>\n\t\t\t\t\t<div class="tasks-full-card-content" :data-task-card-scroll="taskId" ref="scrollContent">\n\t\t\t\t\t\t<div ref="title">\n\t\t\t\t\t\t\t<TaskHeader/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<CheckList\n\t\t\t\t\t\t\t:checkListId\n\t\t\t\t\t\t\t:isShown="isCheckListSheetShown"\n\t\t\t\t\t\t\t:sheetBindProps\n\t\t\t\t\t\t\t@close="closeCheckList"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<DescriptionField\n\t\t\t\t\t\t\tv-model:isSheetShown="isDescriptionSheetShown"\n\t\t\t\t\t\t\t:taskId\n\t\t\t\t\t\t\t:sheetBindProps\n\t\t\t\t\t\t\tref="description"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div class="tasks-full-card-fields">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container"\n\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t@mouseover="isPrimaryFieldsHovered = true"\n\t\t\t\t\t\t\t\t@mouseleave="isPrimaryFieldsHovered = false"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<FieldList :fields="primaryFields"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-full-card-chips-fields">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="emailFields.length > 0"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<FieldList :fields="emailFields"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="!isTemplate && (task.requireResult || wasFilled(TaskField.Results))"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Results\n\t\t\t\t\t\t\t\t\t\tv-model:isSheetShown="isResultEditorSheetShown"\n\t\t\t\t\t\t\t\t\t\tv-model:isListSheetShown="isResultListSheetShown"\n\t\t\t\t\t\t\t\t\t\t:sheetBindProps\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="isDiskModuleInstalled && (files.length > 0 || wasFilled(TaskField.Files))"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --small-vertical-padding"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Files v-model:isSheetShown="isFilesSheetShown" :taskId :sheetBindProps/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="wasFilled(TaskField.CheckList)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<CheckList\n\t\t\t\t\t\t\t\t\t\tisPreview\n\t\t\t\t\t\t\t\t\t\t:isComponentShown="!isCheckListSheetShown"\n\t\t\t\t\t\t\t\t\t\t:checkListId\n\t\t\t\t\t\t\t\t\t\t@open="openCheckList"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="projectFields.length > 0"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<FieldList :fields="projectFields"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="participantsFields.length > 0"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<FieldList\n\t\t\t\t\t\t\t\t\t\t:fields="participantsFields"\n\t\t\t\t\t\t\t\t\t\t:useSeparator="participantsFields.length > 1"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="!isTemplate && isEdit && wasFilled(TaskField.Placements)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Placements/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="!isTemplate && wasFilled(TaskField.Reminders)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Reminders\n\t\t\t\t\t\t\t\t\t\tv-model:isSheetShown="isReminderSheetShown"\n\t\t\t\t\t\t\t\t\t\tv-model:isListSheetShown="isRemindersSheetShown"\n\t\t\t\t\t\t\t\t\t\t:sheetBindProps\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="tagsFields.length > 0"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<FieldList :fields="tagsFields"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="wasFilled(TaskField.Parent)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<ParentTask/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="wasFilled(TaskField.SubTasks) && !isCopyMode"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom --task-list"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<SubTasks/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="wasFilled(TaskField.RelatedTasks)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom --task-list"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<RelatedTasks/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="!isTemplate && wasFilled(TaskField.Gantt)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom --task-list"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Gantt/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="wasFilled(TaskField.DatePlan)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<DatePlan v-model:isSheetShown="isDatePlanSheetShown" :sheetBindProps/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="isTemplate && wasFilled(TaskField.Replication)"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom tasks-full-card-field-container-replication"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Replication\n\t\t\t\t\t\t\t\t\t\tv-model:isSheetShown="isReplicationSheetShown"\n\t\t\t\t\t\t\t\t\t\tv-model:isHistorySheetShown="isReplicationHistorySheetShown"\n\t\t\t\t\t\t\t\t\t\t:sheetBindProps\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tv-if="shouldShowUserFields"\n\t\t\t\t\t\t\t\t\tclass="tasks-full-card-field-container --custom"\n\t\t\t\t\t\t\t\t\tdata-field-container\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<UserFields @open="openUserFieldsHandler"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Chips :chips/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<TaskSettingsHint\n\t\t\t\t\t\t\t\tv-if="isTaskSettingsHintShown"\n\t\t\t\t\t\t\t\t:isShown="isTaskSettingsHintShown"\n\t\t\t\t\t\t\t\t:bindElement="taskSettingsBindElement"\n\t\t\t\t\t\t\t\t@close="handleCloseTaskSettingsHint"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<FooterEdit v-if="isEdit"/>\n\t\t\t\t\t<FooterCreate\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\tv-model:creationError="creationError"\n\t\t\t\t\t\t@addTask="addTask"\n\t\t\t\t\t\t@copyTask="copyTask"\n\t\t\t\t\t\t@fromTemplate="createFromTemplate"\n\t\t\t\t\t\t@close="tryClose"\n\t\t\t\t\t\t@template="handleTemplate"\n\t\t\t\t\t/>\n\t\t\t\t\t<ContentResizer v-if="!isTemplate" @endResize="handleEndResize"/>\n\t\t\t\t\t<DropZone\n\t\t\t\t\t\tv-if="isDiskModuleInstalled && !isBottomSheetShown && task.rights.edit"\n\t\t\t\t\t\t:container="$refs.main || {}"\n\t\t\t\t\t\t:entityId="taskId"\n\t\t\t\t\t\t:entityType="EntityTypes.Task"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<Chat v-if="!isTemplate"/>\n\t\t\t</template>\n\t\t\t<template v-else-if="isLoading">\n\t\t\t\t<div ref="skeleton" style="width: 100%;"/>\n\t\t\t</template>\n\t\t\t<Placeholder\n\t\t\t\tv-else\n\t\t\t\t:imgSrc="placeholderOptions.imgSrc"\n\t\t\t\t:head="placeholderOptions.head"\n\t\t\t\t:descr="placeholderOptions.descr"\n\t\t\t\t:action="placeholderOptions.action"\n\t\t\t/>\n\t\t</div>\n\t`};class Mt{show(t){ut.MessageBox.show({useAirDesign:true,title:ct.Loc.getMessage("TASKS_V2_TASK_FULL_CARD_CLOSE_POPUP_TITLE_MSGVER_1"),message:ct.Loc.getMessage("TASKS_V2_TASK_FULL_CARD_CLOSE_POPUP_MESSAGE"),buttons:ut.MessageBoxButtons.OK_CANCEL,okCaption:ct.Loc.getMessage("TASKS_V2_TASK_FULL_CARD_CLOSE_POPUP_OK_CAPTION"),onOk:t,popupOptions:{closeIcon:false}})}}const Rt=new Set;var Ot=babelHelpers.classPrivateFieldLooseKey("params");var Ht=babelHelpers.classPrivateFieldLooseKey("slider");var Ut=babelHelpers.classPrivateFieldLooseKey("application");var Dt=babelHelpers.classPrivateFieldLooseKey("handlers");var Kt=babelHelpers.classPrivateFieldLooseKey("needToReloadGrid");var Vt=babelHelpers.classPrivateFieldLooseKey("isCloseConfirmed");var Nt=babelHelpers.classPrivateFieldLooseKey("shouldCloseComplete");var xt=babelHelpers.classPrivateFieldLooseKey("mountApplication");var Xt=babelHelpers.classPrivateFieldLooseKey("unmountApplication");var Gt=babelHelpers.classPrivateFieldLooseKey("subscribe");var $t=babelHelpers.classPrivateFieldLooseKey("unsubscribe");var jt=babelHelpers.classPrivateFieldLooseKey("handleTaskUpdate");var zt=babelHelpers.classPrivateFieldLooseKey("handleTaskCardInit");var Wt=babelHelpers.classPrivateFieldLooseKey("handleTaskAdd");var qt=babelHelpers.classPrivateFieldLooseKey("handleTemplateAdd");var Yt=babelHelpers.classPrivateFieldLooseKey("handleTemplateUpdate");var Zt=babelHelpers.classPrivateFieldLooseKey("updateSliderUrl");var Jt=babelHelpers.classPrivateFieldLooseKey("updateSliderTitle");var Qt=babelHelpers.classPrivateFieldLooseKey("onTryClose");var te=babelHelpers.classPrivateFieldLooseKey("onClose");var ee=babelHelpers.classPrivateFieldLooseKey("openViewSliderCard");var se=babelHelpers.classPrivateFieldLooseKey("openHistory");var ie=babelHelpers.classPrivateFieldLooseKey("openCompactCard");var ae=babelHelpers.classPrivateFieldLooseKey("openGrid");var ne=babelHelpers.classPrivateFieldLooseKey("openTemplateHistory");var le=babelHelpers.classPrivateFieldLooseKey("handlePopupShow");class oe{constructor(t={}){var s;Object.defineProperty(this,Jt,{value:pe});Object.defineProperty(this,Zt,{value:ue});Object.defineProperty(this,$t,{value:ce});Object.defineProperty(this,Gt,{value:he});Object.defineProperty(this,Xt,{value:de});Object.defineProperty(this,xt,{value:re});Object.defineProperty(this,Ot,{writable:true,value:void 0});Object.defineProperty(this,Ht,{writable:true,value:void 0});Object.defineProperty(this,Ut,{writable:true,value:void 0});Object.defineProperty(this,Dt,{writable:true,value:void 0});Object.defineProperty(this,Kt,{writable:true,value:false});Object.defineProperty(this,Vt,{writable:true,value:false});Object.defineProperty(this,Nt,{writable:true,value:true});Object.defineProperty(this,jt,{writable:true,value:t=>{const e=t.getData().task;const s=e.id;const i=new Set([...e.subTaskIds,...e.relatedTaskIds,...e.ganttTaskIds]);const a=i.has(s);const n=Object.keys(t.getData().fields);const l=new Set(["deadlineTs","responsibleIds"]);const o=n.some((t=>l.has(t)));if(a||s===babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId&&o){babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt]=true}babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt](e.title)}});Object.defineProperty(this,zt,{writable:true,value:t=>{const e=t.getData().task;if(e.id===babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId){babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt](e.title)}}});Object.defineProperty(this,Wt,{writable:true,value:t=>{const e=t.getData().initialTask;if(e.id!==babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId){return}const s=t.getData().task;Rt.delete(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId);babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId=s.id;Rt.add(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId);babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=true;babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt](s.title);babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]()}});Object.defineProperty(this,qt,{writable:true,value:t=>{const e=t.getData().initialTemplate;if(e.id!==babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId){return}const s=t.getData().template;babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId=s.id;babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=true;babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt](s.title);babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]()}});Object.defineProperty(this,Yt,{writable:true,value:t=>{const e=t.getData().template;babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt](e.title)}});Object.defineProperty(this,Qt,{writable:true,value:t=>{if(t.getData().taskId===babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId){babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht].close()}}});Object.defineProperty(this,te,{writable:true,value:t=>{if(t.getData().taskId===babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId){babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=true;babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht].close()}}});Object.defineProperty(this,ee,{writable:true,value:t=>{const{taskId:s}=t.getData();babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]=false;e.SidePanel.Instance.open(new ct.Uri(st.TaskCard.getUrl(s)).setQueryParam("OLD_FORM","Y").toString(),{cacheable:false,requestMethod:"post",events:{onCloseComplete:()=>{if(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].closeCompleteUrl){location.href=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].closeCompleteUrl}}}});babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht].close(true)}});Object.defineProperty(this,se,{writable:true,value:async t=>{const{taskId:e}=t.getData();const{HistoryGrid:s}=await ct.Runtime.loadExtension("tasks.v2.application.history-grid");s.openHistoryGrid({taskId:e})}});Object.defineProperty(this,ie,{writable:true,value:async t=>{const e=t.getData();st.TaskCard.showCompactCard({...e,groupId:babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].groupId})}});Object.defineProperty(this,ae,{writable:true,value:t=>{const{taskId:s,type:i}=t.getData();const a=X.Core.getParams().currentUser.id;e.SidePanel.Instance.open(`/company/personal/user/${a}/tasks/?relationToId=${s}&relationType=${i}`,{newWindowLabel:false,copyLinkLabel:false})}});Object.defineProperty(this,ne,{writable:true,value:t=>{const e=t.getData();let s=null;BX.SidePanel.Instance.open("tasks-template-history-grid",{contentCallback:async t=>{const i=await ct.Runtime.loadExtension("tasks.v2.application.template-history-grid");s=new i.TemplateHistoryGrid(e);return s.mount(t)},events:{onClose:()=>{var t;return(t=s)==null?void 0:t.unmount()}},cacheable:false,width:1200})}});Object.defineProperty(this,le,{writable:true,value:t=>{const e=t.getCompatData()[0];if(e.getTargetContainer()!==document.body){return}const s=()=>e.adjustPosition();const i=()=>{e.unsubscribe("onClose",i);e.unsubscribe("onDestroy",i);ct.Event.unbind(document,"scroll",s,true)};e.subscribe("onClose",i);e.subscribe("onDestroy",i);ct.Event.bind(document,"scroll",s,true)}});babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]=Object.fromEntries(Object.entries(t).filter((([,t])=>!ct.Type.isUndefined(t))));(s=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]).taskId||(s.taskId=ct.Text.getRandom());if(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId==="template0"){babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId=lt.idUtils.boxTemplate(ct.Text.getRandom())}}static isOpened(t){return Rt.has(t)}async mount(t){var e,s,i,a;if(!t.isOpen()){return}const n=new ct.Uri((e=(s=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].link)==null?void 0:s.url)!=null?e:babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].url).getQueryParams();babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]={...ot.TaskMappers.mapSliderDataToModel({...n,...t.getRequestParams()}),...babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot],...["tasks_planning","tasks_kanban_sprint"].includes(n.SCOPE)?{deadlineTs:0}:{}};(i=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]).groupId||(i.groupId=((a=X.Core.getParams().defaultCollab)==null?void 0:a.id)||undefined);babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]=t;babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]();babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]();babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut]=await babelHelpers.classPrivateFieldLooseBase(this,xt)[xt](t.getContentContainer());Rt.add(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId)}unmount(){babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]();babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]();if(babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt]&&BX.Tasks.Util){const t=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId;BX.Tasks.Util.fireGlobalTaskEvent("UPDATE",{ID:t},{STAY_AT_PAGE:true},{id:t})}Rt.delete(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId)}onClose(t){var e;if(babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]){return}const s=Z.EventEmitter.emit(it.EventName.FullCardHasChanges,{taskId:babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId});const i=(e=s.find((t=>t.taskId===babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId)))==null?void 0:e.hasChanges;if(!i){return}t.denyAction();(new Mt).show((t=>{t.close();babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=true;babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht].close()}))}onCloseComplete(){this.unmount();if(babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]&&babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].closeCompleteUrl){location.href=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].closeCompleteUrl}}}async function re(t){await X.Core.init();const{taskId:e,analytics:i,url:a,link:n,closeCompleteUrl:l,...o}=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot];const r=$.BitrixVue.createApp(Pt,{id:e,initialTask:Object.fromEntries(Object.entries(o).filter((([,t])=>!ct.Type.isNil(t)))),analytics:i});r.mixin(s.locMixin);r.use(X.Core.getStore());r.mount(t);return r}function de(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut])==null?void 0:t.unmount();Z.EventEmitter.emit(it.EventName.FullCardClosed,babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot])}function he(){babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]={[it.EventName.FullCardInit]:babelHelpers.classPrivateFieldLooseBase(this,zt)[zt],[it.EventName.TaskAdded]:babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt],[it.EventName.TaskBeforeUpdate]:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt],[it.EventName.TemplateAdded]:babelHelpers.classPrivateFieldLooseBase(this,qt)[qt],[it.EventName.TemplateBeforeUpdate]:babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt],[it.EventName.CloseFullCard]:babelHelpers.classPrivateFieldLooseBase(this,te)[te],[it.EventName.TryCloseFullCard]:babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt],[it.EventName.OpenViewSliderCard]:babelHelpers.classPrivateFieldLooseBase(this,ee)[ee],[it.EventName.OpenCompactCard]:babelHelpers.classPrivateFieldLooseBase(this,ie)[ie],[it.EventName.OpenGrid]:babelHelpers.classPrivateFieldLooseBase(this,ae)[ae],[it.EventName.OpenTemplateHistory]:babelHelpers.classPrivateFieldLooseBase(this,ne)[ne],[it.EventName.OpenHistory]:babelHelpers.classPrivateFieldLooseBase(this,se)[se],"BX.Main.Popup:onShow":babelHelpers.classPrivateFieldLooseBase(this,le)[le]};Object.entries(babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]).forEach((([t,e])=>Z.EventEmitter.subscribe(t,e)))}function ce(){Object.entries(babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]).forEach((([t,e])=>Z.EventEmitter.unsubscribe(t,e)))}function ue(){const t=Number.isInteger(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId)?babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId:0;const s=st.TaskCard.getUrl(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId,babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].groupId);if(!lt.idUtils.isTemplate(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].taskId)){babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht].setMinimizeOptions({entityType:"tasks:task",entityName:ct.Loc.getMessage("INTRANET_BINDINGS_TASK"),url:s,entityId:t})}babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht].setUrl(s);e.SidePanel.Instance.resetBrowserHistory()}function pe(t){if(ct.Type.isStringFilled(t)){babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht].setTitle(t);e.SidePanel.Instance.updateBrowserTitle()}}var me="/bitrix/js/tasks/v2/application/task-full-card/dist/images/marshmallow_sad_pink_with_orange_lock.png";var ke=Object.freeze({default:me});t.TaskFullCard=oe})(this.BX.Tasks.V2.Application=this.BX.Tasks.V2.Application||{},BX.SidePanel,BX.Vue3.Mixins,BX.UI.System,BX.Tasks.V2.Lib,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component,BX.Tasks.V2.Component,BX.Tasks.V2.Component,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Component.Fields,BX.Tasks.V2.Component.Fields,BX.UI.NotificationManager,BX.Tasks.V2.Lib,BX.UI.System.Chip.Vue,BX.Tasks.V2,BX.Tasks.V2.Component,BX.Vue3,BX.UI.System.Skeleton.Vue,BX.UI.System.Typography.Vue,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Component,BX.Event,BX.Vue3.Vuex,BX.UI.System.Menu,BX.UI.IconSet,BX,BX.Tasks.V2.Application,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service,BX.Vue3.Components,BX,BX.UI.Dialogs);
//# sourceMappingURL=task-full-card.bundle.map.js