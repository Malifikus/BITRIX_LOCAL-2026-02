{"version":3,"file":"auditors.bundle.js","sources":["../src/auditors-meta.js","../src/auditors.js","../src/auditors-chip.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\n\nexport const auditorsMeta = Object.freeze({\n\tid: TaskField.Auditors,\n\ttitle: Loc.getMessage('TASKS_V2_AUDITORS_TITLE'),\n});\n","import { Type } from 'main.core';\nimport { Core } from 'tasks.v2.core';\nimport { Participants } from 'tasks.v2.component.elements.participants';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { auditorsMeta } from './auditors-meta';\n\n// @vue/component\nexport const Auditors = {\n\tname: 'TaskAuditors',\n\tcomponents: {\n\t\tParticipants,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t\tanalytics: {},\n\t\tcardType: {},\n\t},\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tauditorsMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\tdataset(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'data-task-id': this.taskId,\n\t\t\t\t'data-task-field-id': auditorsMeta.id,\n\t\t\t\t'data-task-field-value': this.task.auditorsIds.join(','),\n\t\t\t};\n\t\t},\n\t\tisLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.stakeholder.available;\n\t\t},\n\t\tfeatureId(): string\n\t\t{\n\t\t\treturn Core.getParams().restrictions.stakeholder.featureId;\n\t\t},\n\t\tauditorsCount(): number\n\t\t{\n\t\t\treturn this.task.auditorsIds?.length ?? 0;\n\t\t},\n\t},\n\tmethods: {\n\t\tupdate(auditorsIds: number[]): void\n\t\t{\n\t\t\tconst hasChanges = taskService.hasChanges(this.task, { auditorsIds })\n\t\t\t\t&& auditorsIds.length > 0\n\t\t\t\t&& auditorsIds.length >= this.auditorsCount\n\t\t\t;\n\n\t\t\tvoid taskService.update(this.taskId, { auditorsIds });\n\n\t\t\tif (hasChanges)\n\t\t\t{\n\t\t\t\tanalytics.sendAddViewer(this.analytics, {\n\t\t\t\t\tcardType: this.cardType,\n\t\t\t\t\ttaskId: Type.isNumber(this.taskId) ? this.taskId : 0,\n\t\t\t\t\tviewersCount: auditorsIds.length,\n\t\t\t\t\tcoexecutorsCount: this.task.accomplicesIds?.length ?? 0,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Participants\n\t\t\t:taskId\n\t\t\t:context=\"auditorsMeta.id\"\n\t\t\t:userIds=\"task.auditorsIds\"\n\t\t\t:canAdd=\"task.rights.addAuditors\"\n\t\t\t:canRemove=\"task.rights.edit\"\n\t\t\t:dataset\n\t\t\t:isLocked\n\t\t\t:featureId\n\t\t\tuseRemoveAll\n\t\t\t@update=\"update\"\n\t\t/>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { Chip, ChipDesign } from 'ui.system.chip.vue';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { showLimit } from 'tasks.v2.lib.show-limit';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { usersDialog } from 'tasks.v2.lib.user-selector-dialog';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { auditorsMeta } from './auditors-meta';\n\n// @vue/component\nexport const AuditorsChip = {\n\tcomponents: {\n\t\tChip,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t\tanalytics: {},\n\t\tcardType: {},\n\t},\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tauditorsMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\tdesign(): string\n\t\t{\n\t\t\treturn this.isSelected ? ChipDesign.ShadowAccent : ChipDesign.ShadowNoAccent;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\treturn this.task.filledFields[auditorsMeta.id];\n\t\t},\n\t\tisLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.stakeholder.available;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isSelected)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isLocked)\n\t\t\t{\n\t\t\t\tvoid showLimit({\n\t\t\t\t\tfeatureId: Core.getParams().restrictions.stakeholder.featureId,\n\t\t\t\t\tbindElement: this.$el,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid usersDialog.show({\n\t\t\t\ttargetNode: this.$el,\n\t\t\t\tids: this.task.auditorsIds,\n\t\t\t\tonClose: this.handleClose,\n\t\t\t});\n\t\t},\n\t\thandleClose(auditorsIds: number[]): void\n\t\t{\n\t\t\tif (!this.isSelected && auditorsIds.length > 0)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\tanalytics.sendAddViewer(this.analytics, {\n\t\t\t\t\tcardType: this.cardType,\n\t\t\t\t\ttaskId: Type.isNumber(this.taskId) ? this.taskId : 0,\n\t\t\t\t\tviewersCount: auditorsIds.length,\n\t\t\t\t\tcoexecutorsCount: this.task.accomplicesIds?.length ?? 0,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvoid taskService.update(this.taskId, { auditorsIds });\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(auditorsMeta.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\tv-if=\"isSelected || task.rights.addAuditors\"\n\t\t\t:design\n\t\t\t:icon=\"Outline.OBSERVER\"\n\t\t\t:lock=\"isLocked\"\n\t\t\t:text=\"loc('TASKS_V2_AUDITORS_TITLE_CHIP')\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"auditorsMeta.id\"\n\t\t\t:data-task-chip-value=\"task.auditorsIds.join(',')\"\n\t\t\t@click=\"handleClick\"\n\t\t/>\n\t`,\n};\n"],"names":["auditorsMeta","Object","freeze","id","TaskField","Auditors","title","Loc","getMessage","name","components","Participants","inject","task","taskId","analytics","cardType","setup","computed","dataset","auditorsIds","join","isLocked","Core","getParams","restrictions","stakeholder","available","featureId","auditorsCount","length","methods","update","hasChanges","taskService","sendAddViewer","Type","isNumber","viewersCount","coexecutorsCount","accomplicesIds","template","AuditorsChip","Chip","Outline","design","isSelected","ChipDesign","ShadowAccent","ShadowNoAccent","filledFields","handleClick","highlightField","showLimit","bindElement","$el","usersDialog","show","targetNode","ids","onClose","handleClose","fieldHighlighter","setContainer","$root","highlight"],"mappings":"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"}