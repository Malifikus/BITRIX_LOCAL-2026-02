this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Provider=this.BX.Tasks.V2.Provider||{};(function(s,e,t,a,i,r,o,n,l,d){"use strict";var c;const u=new(c=babelHelpers.classPrivateFieldLooseKey("updateStatus"),class{constructor(){Object.defineProperty(this,c,{value:k})}async start(s){await babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,a.Endpoint.TaskStatusStart,a.TaskStatus.InProgress)}async take(s){await babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,a.Endpoint.TaskStatusTake,a.TaskStatus.InProgress)}async startTimer(s){await babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,"Task.Tracking.Timer.start",a.TaskStatus.InProgress)}async disapprove(s){await babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,a.Endpoint.TaskStatusDisapprove,a.TaskStatus.Pending)}async defer(s){await babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,a.Endpoint.TaskStatusDefer,a.TaskStatus.Deferred)}async approve(s){await babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,a.Endpoint.TaskStatusApprove,a.TaskStatus.Completed)}async pause(s){await babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,a.Endpoint.TaskStatusPause,a.TaskStatus.Pending)}async pauseTimer(s){await babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,"Task.Tracking.Timer.stop",a.TaskStatus.Pending)}async complete(s,o={}){const n=l.taskService.getStoreTask(s);if(!n){return}const u=t.Core.getStore().getters[`${a.Model.Interface}/currentUserId`];if(n.requireResult&&!t.Core.getParams().rights.user.admin&&u!==n.creatorId&&!d.resultService.hasOpenedResults(s)){e.Event.EventEmitter.emit(a.EventName.RequiredResultsMissing,{taskId:s});return}const k=t.Core.getStore().getters[`${a.Model.Groups}/getById`](n.groupId);const p=new r.ScrumManager({taskId:n.id,parentId:n.parentId,groupId:n.groupId});let T=true;if(p.isScrum(k==null?void 0:k.type)){T=await p.handleDodDisplay()}if(!T){return}const S=n.needsControl?a.TaskStatus.SupposedlyCompleted:a.TaskStatus.Completed;await babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,a.Endpoint.TaskStatusComplete,S);if(p.isScrum(k==null?void 0:k.type)){void(p==null?void 0:p.handleParentState())}if(o.context){i.analytics.sendTaskComplete(o,{taskId:n.id})}void d.resultService.closeResults(s)}async renew(s){await babelHelpers.classPrivateFieldLooseBase(this,c)[c](s,a.Endpoint.TaskStatusRenew,a.TaskStatus.Pending)}});async function k(s,e,t){const a=l.taskService.getStoreTask(s);if(!n.idUtils.isReal(s)){l.taskService.updateStoreTask(s,{status:t});return}try{const a=await o.apiClient.post(e,{task:{id:s}});l.taskService.updateStoreTask(s,{status:t});l.taskService.extractTask(a)}catch(t){l.taskService.updateStoreTask(s,a);console.error(`StatusService: ${e} error`,t)}}s.statusService=u})(this.BX.Tasks.V2.Provider.Service=this.BX.Tasks.V2.Provider.Service||{},BX,BX.Tasks.V2,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=status-service.bundle.map.js