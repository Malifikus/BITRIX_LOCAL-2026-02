{"version":3,"file":"aha-moments.bundle.js","sources":["../src/aha-moments.js"],"sourcesContent":["import { Dom, Event } from 'main.core';\nimport 'spotlight';\n\nimport { Guide } from 'ui.tour';\n\nimport { Core } from 'tasks.v2.core';\nimport { Option } from 'tasks.v2.const';\nimport { optionService } from 'tasks.v2.provider.service.option-service';\n\ntype Options = $Values<typeof Option>;\n\ntype Params = {\n\tid: string,\n\tahaMoment: string,\n\ttitle: string,\n\ttext: string,\n\ttarget: HTMLElement,\n\tarticle?: {\n\t\tcode: string,\n\t\tanchorCode?: string,\n\t\ttitle?: string,\n\t},\n\ttargetContainer?: HTMLElement,\n\ttop?: boolean,\n\tisPulsarTransparent?: boolean,\n};\n\nclass AhaMoments\n{\n\t#ahaPopupWidth: number = 380;\n\t#shownPopups: { [name: string]: boolean } = {};\n\t#activeAhaMoment: ?Options = null;\n\n\tshow(params: Params): Promise<void>\n\t{\n\t\tif (params.ahaMoment && this.#wasShown(params.ahaMoment))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst guide = new Guide({\n\t\t\tid: params.id,\n\t\t\toverlay: false,\n\t\t\tsimpleMode: true,\n\t\t\tonEvents: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: params.target,\n\t\t\t\t\ttitle: params.title,\n\t\t\t\t\ttext: params.text,\n\t\t\t\t\tposition: params.top ? 'top' : 'bottom',\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: !params.top,\n\t\t\t\t\t\tbottom: Boolean(params.top),\n\t\t\t\t\t\tcolor: 'primary',\n\t\t\t\t\t},\n\t\t\t\t\tarticle: params.article?.code,\n\t\t\t\t\tarticleAnchor: params.article?.anchorCode,\n\t\t\t\t\tlinkTitle: params.article?.title,\n\t\t\t\t},\n\t\t\t],\n\t\t\ttargetContainer: params.targetContainer,\n\t\t});\n\n\t\t// default is 280\n\t\tif (this.#ahaPopupWidth)\n\t\t{\n\t\t\tguide.getPopup().setWidth(this.#ahaPopupWidth);\n\t\t}\n\n\t\tconst pulsar = new BX.SpotLight(\n\t\t\t{\n\t\t\t\ttargetElement: params.target,\n\t\t\t\ttargetVertex: 'middle-center',\n\t\t\t\tcolor: 'var(--ui-color-primary)',\n\t\t\t},\n\t\t);\n\n\t\t// eslint-disable-next-line consistent-return\n\t\treturn new Promise((resolve) => {\n\t\t\tconst guidePopup = guide.getPopup();\n\n\t\t\tguidePopup.setAutoHide(true);\n\t\t\tguidePopup.setAngle({ offset: params.target.offsetWidth / 2 });\n\n\t\t\tconst adjustPosition = () => {\n\t\t\t\tguidePopup.adjustPosition();\n\t\t\t};\n\n\t\t\tconst onClose = () => {\n\t\t\t\tpulsar.close();\n\t\t\t\tEvent.unbind(document, 'scroll', adjustPosition, true);\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\tguidePopup.subscribe('onClose', onClose);\n\t\t\tguidePopup.subscribe('onDestroy', onClose);\n\n\t\t\tpulsar.show();\n\t\t\tguide.start();\n\n\t\t\tguidePopup.adjustPosition({\n\t\t\t\tforceTop: !params.top,\n\t\t\t\tforceBindPosition: true,\n\t\t\t});\n\n\t\t\tif (params.isPulsarTransparent)\n\t\t\t{\n\t\t\t\tDom.style(pulsar.container, 'pointer-events', 'none');\n\t\t\t}\n\n\t\t\tEvent.bind(document, 'scroll', adjustPosition, true);\n\t\t});\n\t}\n\n\tshouldShow(ahaMoment: Options): boolean\n\t{\n\t\tif (this.#activeAhaMoment !== null && this.#activeAhaMoment !== ahaMoment)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.#wasNotShown(ahaMoment);\n\t}\n\n\tsetShown(ahaMoment: Options): void\n\t{\n\t\tthis.setPopupShown(ahaMoment);\n\n\t\tvoid optionService.setBool(ahaMoment, true);\n\t}\n\n\tsetPopupShown(ahaMoment: Options): void\n\t{\n\t\tthis.#shownPopups[ahaMoment] = true;\n\t}\n\n\tsetActive(ahaMoment: Options): void\n\t{\n\t\tthis.#activeAhaMoment = ahaMoment;\n\t}\n\n\tsetInactive(ahaMoment: Options): void\n\t{\n\t\tif (this.#activeAhaMoment === ahaMoment)\n\t\t{\n\t\t\tthis.#activeAhaMoment = null;\n\t\t}\n\t}\n\n\tisActive(ahaMoment: Options): boolean\n\t{\n\t\treturn this.#activeAhaMoment === ahaMoment;\n\t}\n\n\t#wasNotShown(ahaMoment: Options): boolean\n\t{\n\t\treturn !this.#wasShown(ahaMoment);\n\t}\n\n\t#wasShown(ahaMoment: Options): boolean\n\t{\n\t\tconst { ahaMoments } = Core.getParams();\n\n\t\treturn !ahaMoments[ahaMoment] || this.#shownPopups[ahaMoment];\n\t}\n}\n\nexport const ahaMoments = new AhaMoments();\n"],"names":["AhaMoments","show","params","ahaMoment","guide","Guide","id","overlay","simpleMode","onEvents","steps","target","title","text","position","top","condition","bottom","Boolean","color","article","code","articleAnchor","anchorCode","linkTitle","targetContainer","getPopup","setWidth","pulsar","BX","SpotLight","targetElement","targetVertex","Promise","resolve","guidePopup","setAutoHide","setAngle","offset","offsetWidth","adjustPosition","onClose","close","Event","unbind","document","subscribe","start","forceTop","forceBindPosition","isPulsarTransparent","Dom","style","container","bind","shouldShow","setShown","setPopupShown","optionService","setBool","setActive","setInactive","isActive","ahaMoments","Core","getParams"],"mappings":"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"}