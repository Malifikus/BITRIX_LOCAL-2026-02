this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,n,a,r,l,o,c,d,h,p,u,m,v,I,f,b,L,g,k,C,P,F,S,B,w,M,y,T,E){"use strict";const H=Object.freeze({id:M.TaskField.CheckList,title:k.Loc.getMessage("TASKS_V2_CHECK_LIST_TITLE")});const A={name:"CheckListStub",components:{UiButton:s.Button},emits:["click"],setup(){return{ButtonSize:s.ButtonSize,Outline:S.Outline}},template:`\n\t\t<div class="check-list-stub">\n\t\t\t<div class="check-list-stub-icon"/>\n\t\t\t<div class="check-list-stub-title">\n\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_STUB_TITLE') }}\n\t\t\t</div>\n\t\t\t<div class="check-list-stub-btn">\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="loc('TASKS_V2_CHECK_LIST_STUB_BTN')"\n\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t:leftIcon="Outline.PLUS_L"\n\t\t\t\t\t@click="$emit('click')"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const _={name:"TaskCheckListPopup",components:{Popup:i.Popup},inject:{taskId:{}},inheritAttrs:false,emits:["show","close","resize"],setup(){return{resizeObserver:null}},computed:{popupId(){return`tasks-check-list-popup-${this.taskId}`},options(){return{className:"tasks-check-list-popup",width:580,height:500,borderRadius:"18px",offsetTop:0,padding:0,autoHide:true,closeByEsc:true,animation:{showClassName:"tasks-check-list-popup-show",closeClassName:"tasks-check-list-popup-close",closeAnimationType:"animation"},events:{onClose:this.handleClose}}},...c.mapGetters({titleFieldOffsetHeight:`${M.Model.Interface}/titleFieldOffsetHeight`})},watch:{async titleFieldOffsetHeight(){if(!this.$refs.childComponent){return}await this.$nextTick();this.resize()}},created(){this.resizeObserver=new ResizeObserver((t=>{for(const e of t){if(e.target===this.$refs.wrapper){this.resize()}}}))},mounted(){k.Event.bind(window,"resize",this.resize);k.Event.bind(document,"keydown",this.handleKeyDown,{capture:true})},beforeUnmount(){k.Event.unbind(window,"resize",this.resize);k.Event.unbind(document,"keydown",this.handleKeyDown,{capture:true})},methods:{resize(){var t;const e=(t=this.$refs.childComponent)==null?void 0:t.getPopupInstance();if(e){this.$emit("resize");e.adjustPosition()}},handleShow(){var t;this.$emit("show",{popupInstance:this.$refs.childComponent.getPopupInstance()});(t=this.$refs.childComponent)==null?void 0:t.getPopupInstance().adjustPosition();setTimeout((()=>this.resizeObserver.observe(this.$parent.$refs.wrapper)),300)},handleClose(){this.resizeObserver.disconnect();this.$bitrix.eventEmitter.emit(M.EventName.CloseCheckList);this.$emit("close")},handleKeyDown(t){if(t.key==="Escape"){this.$emit("close");t.stopPropagation()}}},template:`\n\t\t<Popup :options ref="childComponent">\n\t\t\t<slot :handleShow="handleShow" :handleClose="handleClose"/>\n\t\t</Popup>\n\t`};const O={name:"TaskCheckListSheet",components:{BottomSheet:n.BottomSheet},props:{isEmpty:{type:Boolean,default:false},isShown:{type:Boolean,required:true},sheetBindProps:{type:Object,required:true}},emits:["show","close","isShown","addFastCheckList","resize"],watch:{async isShown(t){await this.$nextTick();if(t===true){k.Event.bind(document,"keydown",this.handleKeyDown,{capture:true})}else{k.Event.unbind(document,"keydown",this.handleKeyDown,{capture:true})}this.$emit("isShown",t)}},methods:{handleClose(){this.$emit("close")},handleKeyDown(t){if(t.key==="Escape"){this.handleClose();t.stopPropagation()}}},template:`\n\t\t<BottomSheet\n\t\t\tv-if="isShown"\n\t\t\t:sheetBindProps\n\t\t\t:padding="0"\n\t\t\t:popupPadding="0"\n\t\t\t@close="handleClose"\n\t\t>\n\t\t\t<slot :handleShow="$emit('show')" :handleClose="handleClose"/>\n\t\t</BottomSheet>\n\t`};var $=babelHelpers.classPrivateFieldLooseKey("params");var x=babelHelpers.classPrivateFieldLooseKey("getDraggedChildren");var D=babelHelpers.classPrivateFieldLooseKey("processCompletedFilter");var K=babelHelpers.classPrivateFieldLooseKey("processUserFilter");var U=babelHelpers.classPrivateFieldLooseKey("applyVisibilityChanges");var R=babelHelpers.classPrivateFieldLooseKey("splitIdsByAction");var N=babelHelpers.classPrivateFieldLooseKey("createVisibilityUpdates");var V=babelHelpers.classPrivateFieldLooseKey("setItemsVisibility");var z=babelHelpers.classPrivateFieldLooseKey("findNestedChildren");var G=babelHelpers.classPrivateFieldLooseKey("getRootParent");var j=babelHelpers.classPrivateFieldLooseKey("getCheckLists");class W{constructor(t){Object.defineProperty(this,j,{value:it});Object.defineProperty(this,G,{value:st});Object.defineProperty(this,z,{value:et});Object.defineProperty(this,V,{value:tt});Object.defineProperty(this,N,{value:Q});Object.defineProperty(this,R,{value:J});Object.defineProperty(this,U,{value:Z});Object.defineProperty(this,K,{value:Y});Object.defineProperty(this,D,{value:q});Object.defineProperty(this,x,{value:X});Object.defineProperty(this,$,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,$)[$]=t}getItem(t){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]().find((e=>e.id===this.prepareItemId(t)))}getItems(t){const e=new Set(t);return babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((t=>e.has(t.id)))}getItemsOnLevel(t){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((e=>e.parentId===t)).sort(((t,e)=>t.sortIndex-e.sortIndex))}getItemLevel(t){let e=0;let s=t;const i=new Set;const n=t=>babelHelpers.classPrivateFieldLooseBase(this,j)[j]().find((e=>e.id===t));while(s.parentId!==0){if(i.has(s.id)){break}i.add(s.id);s=n(s.parentId);if(!s){break}e++}return e}isParentItem(t){const e=this.getItem(t);return e&&e.parentId===0}isItemDescendant(t,e){if((e==null?void 0:e.parentId)===(t==null?void 0:t.id)){return true}if((e==null?void 0:e.parentId)===0){return false}const s=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().find((t=>t.id===(e==null?void 0:e.parentId)));if(!s){return false}return this.isItemDescendant(t,s)}showItems(t,e){const s=[];t.forEach((t=>babelHelpers.classPrivateFieldLooseBase(this,V)[V](t,false,s)));if(s.length>0){e(s)}}hideItems(t,e){const s=[];t.forEach((t=>babelHelpers.classPrivateFieldLooseBase(this,V)[V](t,true,s)));if(s.length>0){e(s)}}syncParentCompletionState(t,e,s){var i;const n=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().find((e=>e.id===t));if((!n||!n.parentId)&&!s){return}const a=s||n.parentId;const r=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().find((t=>t.id===a));if(!r){return}const l=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((t=>t.parentId===r.id));const o=l.length===0;const c=l.every((t=>{var e;return(e=t.localCompleteState)!=null?e:t.isComplete}));const d=!c;const h=(i=r.localCompleteState)!=null?i:r.isComplete;const p=o||c&&!h||d&&h;if(!p){return}e(r.id,{isComplete:c&&!o});if(r.parentId){this.syncParentCompletionState(r.id,e)}}getAllGroupModeItems(){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((t=>{var e;return((e=t.groupMode)==null?void 0:e.active)===true}))}getAllSelectedItems(){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((t=>{var e;return t.parentId!==0&&((e=t.groupMode)==null?void 0:e.selected)===true}))}getAllSelectedItemsWithChildren(){const t=new Map;const e=this.getAllSelectedItems();const s=babelHelpers.classPrivateFieldLooseBase(this,j)[j]();e.forEach((e=>t.set(e.id,e)));const i=e=>{const n=s.filter((s=>e.includes(s.parentId)&&!t.has(s.id)));n.forEach((e=>t.set(e.id,e)));if(n.length>0){i(n.map((t=>t.id)))}};i(e.map((t=>t.id)));return[...t.values()]}getAllChildren(t){const e=new Set;const s=[];const i=t=>{if(e.has(t)){return}e.add(t);const n=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((e=>e.parentId===t)).sort(((t,e)=>t.sortIndex-e.sortIndex));n.forEach((t=>{if(!e.has(t.id)){s.push(t);i(t.id)}}))};i(t);return s}getAllCompletedChildren(t){return this.getAllChildren(t).filter((t=>{var e;return((e=t.localCompleteState)!=null?e:t.isComplete)===true}))}getChildren(t){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((e=>e.parentId===t))}getSiblings(t,e){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((s=>s.parentId===e&&s.id!==t)).sort(((t,e)=>t.sortIndex-e.sortIndex))}resortItemsOnLevel(t,e){const s=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((e=>e.parentId===t));const i=[...s].sort(((t,e)=>t.sortIndex-e.sortIndex));const n=i.map(((t,e)=>({...t,sortIndex:e})));if(n.length>0){e(n)}}resortItemsBeforeIndex(t,e,s){const i=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((e=>e.parentId===t));const n=i.filter((t=>t.sortIndex<=e)).sort(((t,e)=>t.sortIndex-e.sortIndex));const a=n.map(((t,e)=>({...t,sortIndex:e})));s(a)}resortItemsAfterIndex(t,e,s){const i=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((e=>e.parentId===t));const n=i.filter((t=>t.sortIndex>=e)).sort(((t,e)=>t.sortIndex-e.sortIndex));const a=n.map(((t,s)=>({...t,sortIndex:e+1+s})));s(a)}moveRight(t,e){if(t.parentId===0||this.getItemLevel(t)>5){return}const s=this.getItemsOnLevel(t.parentId);const i=s.findIndex((e=>e.id===t.id));if(i<=0){return}let n=null;for(let e=i-1;e>=0;e--){const i=s[e];if(!this.isItemDescendant(i,t)){n=i;break}}if(!n){return}const a=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((t=>t.parentId===n.id)).sort(((t,e)=>t.sortIndex-e.sortIndex));const r=s.filter(((t,e)=>e>i)).map((t=>({...t,sortIndex:t.sortIndex-1})));r.push({...t,parentId:n.id,parentNodeId:n.nodeId,sortIndex:a.length>0?a[a.length-1].sortIndex+1:0});e(r)}moveLeft(t,e){if(t.parentId===0||this.getItemLevel(t)<=1){return}const s=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().find((e=>e.id===t.parentId));if(!s){return}const i=this.getItemsOnLevel(s.parentId);const n=i.findIndex((t=>t.id===s.id));const a=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((e=>e.parentId===t.parentId&&e.sortIndex>t.sortIndex)).map((t=>({...t,sortIndex:t.sortIndex-1})));let r=0;if(n===-1||n===i.length-1){r=i.length>0?i[i.length-1].sortIndex+1:0}else{r=i[n].sortIndex+1;const t=i.filter((t=>t.sortIndex>=r)).map((t=>({...t,sortIndex:t.sortIndex+1})));a.push(...t)}const l={...t,parentId:s.parentId,parentNodeId:s.parentNodeId||null,sortIndex:r};e([...a,l])}findNearestItem(t,e,s=[]){if(!t){return null}const i=babelHelpers.classPrivateFieldLooseBase(this,G)[G](t);if(!i){return null}const n=t.sortIndex;const a=new Set(s.map((t=>t.id)));const r=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().sort(((t,e)=>t.sortIndex-e.sortIndex)).filter((s=>{var n,r;const l=a.has(s.parentId);return s.id!==t.id&&s.parentId!==0&&((n=s.groupMode)==null?void 0:n.selected)===e&&((r=babelHelpers.classPrivateFieldLooseBase(this,G)[G](s))==null?void 0:r.id)===i.id&&!l}));if(r.length===0){return null}return r.reduce(((t,e)=>e.sortIndex>n&&(e.sortIndex<t.sortIndex||t.sortIndex<=n)?e:t))}getFirstVisibleChild(t){const e=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((e=>e.parentId===t&&!e.hidden)).sort(((t,e)=>t.sortIndex-e.sortIndex));return e[0]||null}getEmptiesItem(){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((t=>t.title===""))}hasEmptyItemWithFiles(t){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]().some((e=>e.title===""&&t(e)))}hasEmptyParentItem(){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]().some((t=>t.parentId===0&&t.title===""))}getFirstEmptyItem(){const t=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((t=>t.title==="")).sort(((t,e)=>t.sortIndex-e.sortIndex));return t[0]||null}getChildWithEmptyTitle(t){const e=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().filter((e=>e.parentId===t)).sort(((t,e)=>e.sortIndex-t.sortIndex)).find((t=>t.title===""));return e||null}isItemCollapsed(t,e,s){if(!k.Type.isNull(t.localCollapsedState)&&!k.Type.isUndefined(t.localCollapsedState)){return t.localCollapsedState}if(!e){return false}if(t.collapsed&&!t.expanded){return true}if(t.expanded){return false}return s!==0}getRootParentByChildId(t){var e;const s=this.getItem(t);if(!s){return null}if(s.parentId===0){return s}let i=s;const n=new Set;while(i&&i.parentId!==0){if(n.has(i.id)){break}n.add(i.id);const t=this.getItem(i.parentId);if(!t){break}i=t}return((e=i)==null?void 0:e.parentId)===0?i:null}expandIdsWithChildren(t){const e=new Set(t);if(t.size===0||babelHelpers.classPrivateFieldLooseBase(this,j)[j]().length===0){return e}const s=new Map(babelHelpers.classPrivateFieldLooseBase(this,j)[j]().map((t=>[t.id,t])));const i=new Set;t.forEach((t=>{if(!i.has(t)){babelHelpers.classPrivateFieldLooseBase(this,z)[z](t,s,e,i)}}));return e}findItemIdsWithUser(t,e){const s=this.getAllChildren(t);const i=this.getItem(t);if(i){s.unshift(i)}const n=new Set;s.forEach((t=>{var s,i;const a=((s=t.accomplices)==null?void 0:s.some((t=>t.id===e)))||((i=t.auditors)==null?void 0:i.some((t=>t.id===e)));if(a&&t.parentId!==0){n.add(t.id)}}));return n}prepareItemId(t){const e=parseInt(t,10);const s=!Number.isNaN(e)&&e.toString()===t;return s?parseInt(t,10):t}isFirstItemHigherLevelThan(t,e){const s=this.getItemLevel(t);const i=this.getItemLevel(e);return s<i}hasItemChildren(t){return babelHelpers.classPrivateFieldLooseBase(this,j)[j]().some((e=>e.parentId===t.id))}isItemCompleted(t){var e;return(e=t.localCompleteState)!=null?e:t.isComplete}scrollToCheckList(t,e,s="instant"){let i=t.closest("[data-task-card-scroll]");if(!i){i=t.querySelector("[data-task-card-scroll]")}const n=t.querySelector([`[data-id="${e}"]`]);if(i&&n){const t=k.Dom.getPosition(n);const e=k.Dom.getPosition(i);const a=t.top-e.top+i.scrollTop;i.scrollTo({top:a-200,behavior:s})}}handleTargetParentFilter(t,e,s){const i=new Map;const n=this.getRootParentByChildId(t.id);const a=babelHelpers.classPrivateFieldLooseBase(this,x)[x](t);babelHelpers.classPrivateFieldLooseBase(this,D)[D](t,n,i);a.forEach((t=>{babelHelpers.classPrivateFieldLooseBase(this,D)[D](t,n,i)}));const r=this.findItemIdsWithUser(n.id,e);babelHelpers.classPrivateFieldLooseBase(this,K)[K](t,n,r,i);a.forEach((t=>{babelHelpers.classPrivateFieldLooseBase(this,K)[K](t,n,r,i)}));babelHelpers.classPrivateFieldLooseBase(this,U)[U](i,s);return true}}function X(t){return this.getAllChildren(t.id)}function q(t,e,s){if(e.areCompletedCollapsed&&this.isItemCompleted(t)){s.set(t.id,"hide")}if(!e.areCompletedCollapsed&&this.isItemCompleted(t)){s.set(t.id,"show")}}function Y(t,e,s,i){if(e.myFilterActive&&!s.has(t.id)){i.set(t.id,"hide")}if(!e.myFilterActive&&s.has(t.id)&&!i.has(t.id)){i.set(t.id,"show")}}function Z(t,e){const{hideIds:s,showIds:i}=babelHelpers.classPrivateFieldLooseBase(this,R)[R](t);const n=babelHelpers.classPrivateFieldLooseBase(this,N)[N](s,i);if(n.length>0){e(n)}}function J(t){const e=[];const s=[];for(const[i,n]of t){if(n==="hide"){e.push(i)}else if(n==="show"){s.push(i)}}return{hideIds:e,showIds:s}}function Q(t,e){const s=[];this.getItems(e).forEach((t=>{s.push({...t,hidden:false})}));this.getItems(t).forEach((t=>{s.push({...t,hidden:true})}));return s}function tt(t,e,s){const i=this.getItem(t);if(!i||i.hidden===e){return}const n={...i,hidden:e};s.push(n);const a=this.getChildren(t);a.forEach((t=>{babelHelpers.classPrivateFieldLooseBase(this,V)[V](t.id,e,s)}))}function et(t,e,s,i){if(i.has(t)){return}i.add(t);e.forEach((n=>{if(n.parentId===t&&!s.has(n.id)){s.add(n.id);babelHelpers.classPrivateFieldLooseBase(this,z)[z](n.id,e,s,i)}}))}function st(t){if(!t||t.parentId===0){return t||null}const e=babelHelpers.classPrivateFieldLooseBase(this,j)[j]().find((e=>e.id===t.parentId));if(!e){return null}return babelHelpers.classPrivateFieldLooseBase(this,G)[G](e)}function it(){var t,e,s;return(t=(e=babelHelpers.classPrivateFieldLooseBase(this,$)[$])==null?void 0:(s=e.computed)==null?void 0:s.checkLists())!=null?t:[]}const nt={name:"TaskCheckListList",components:{BIcon:S.BIcon},directives:{hint:f.hint},inject:{task:{},taskId:{},isEdit:{}},props:{isEmpty:{type:Boolean,default:false}},emits:["open","addFastCheckList"],setup(){return{Animated:S.Animated,Outline:S.Outline,checkListMeta:H}},data(){return{isLoading:null}},computed:{...c.mapGetters({deletingCheckListIds:`${M.Model.Interface}/deletingCheckListIds`,disableCheckListAnimations:`${M.Model.Interface}/disableCheckListAnimations`}),checkLists(){return this.$store.getters[`${M.Model.CheckList}/getByIds`](this.task.checklist)},isFilledEmpty(){return this.checkListLength===0&&this.task.filledFields[H.id]},checkListLength(){const t=Object.values(this.deletingCheckListIds);const e=new Set;t.forEach((t=>{e.add(t);this.checkListManager.getAllChildren(t).forEach((t=>{e.add(t.id)}))}));return this.checkLists.filter((({id:t})=>!e.has(t))).length},containsChecklist(){return this.task.containsChecklist},loading(){return this.isLoading===true},canCheckListAdd(){if(!this.isEdit){return true}return this.task.rights.checklistAdd},addTooltip(){return()=>L.tooltip({text:this.loc("TASKS_V2_CHECK_LIST_STUB_BTN"),popupOptions:{offsetLeft:this.$refs.stubAddIcon.$el.offsetWidth/2}})}},async created(){this.checkListManager=new W({computed:{checkLists:()=>this.checkLists}});if(this.containsChecklist&&this.checkLists.length===0){this.isLoading=true;await this.loadData();this.isLoading=false}},methods:{async loadData(){await P.checkListService.load(this.taskId)}},template:`\n\t\t<div\n\t\t\tclass="tasks-check-list-list"\n\t\t\t:class="{ '--default': loading || isFilledEmpty }"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="tasks-check-list-list-content"\n\t\t\t\t:class="{ '--default': loading || isFilledEmpty }"\n\t\t\t>\n\t\t\t\t<div v-if="loading" class="tasks-check-list-list-transition-content">\n\t\t\t\t\t<div class="tasks-check-list-list-content-row">\n\t\t\t\t\t\t<BIcon :name="Animated.LOADER_WAIT"/>\n\t\t\t\t\t\t<div class="tasks-check-list-list-content-text">\n\t\t\t\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_LOADING') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<Transition name="check-list-fade" mode="in-out" :css="!disableCheckListAnimations">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="!loading && isFilledEmpty"\n\t\t\t\t\t\tkey="empty"\n\t\t\t\t\t\tclass="tasks-check-list-list-transition-content"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="tasks-check-list-list-content-row --stub"\n\t\t\t\t\t\t\t@click="() => canCheckListAdd && $emit('addFastCheckList')"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<div class="tasks-check-list-list-content-row-main">\n\t\t\t\t\t\t\t\t<BIcon :name="Outline.CHECK_LIST"/>\n\t\t\t\t\t\t\t\t<div class="tasks-check-list-list-content-text">\n\t\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_CHIP_TITLE') }}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="tasks-check-list-list-content-row-icon">\n\t\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\t\tv-if="canCheckListAdd"\n\t\t\t\t\t\t\t\t\tclass="tasks-check-list-list-add"\n\t\t\t\t\t\t\t\t\tv-hint="addTooltip"\n\t\t\t\t\t\t\t\t\t:name="Outline.PLUS_L"\n\t\t\t\t\t\t\t\t\thoverable\n\t\t\t\t\t\t\t\t\tref="stubAddIcon"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</Transition>\n\t\t\t\t<div\n\t\t\t\t\tv-if="!loading && !isFilledEmpty"\n\t\t\t\t\tkey="content"\n\t\t\t\t\tclass="tasks-check-list-list-transition-content"\n\t\t\t\t>\n\t\t\t\t\t<slot/>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="canCheckListAdd"\n\t\t\t\t\t\tclass="tasks-check-list-list-content-row --footer"\n\t\t\t\t\t\t@click="$emit('addFastCheckList')"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="tasks-check-list-list-content-btn"\n\t\t\t\t\t\t\t:class="{ '--empty': isEmpty }"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon :name="Outline.PLUS_L"/>\n\t\t\t\t\t\t\t<div class="tasks-check-list-list-content-btn-text">\n\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_CHECK_LIST_ADD_LABEL') }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const at=Object.freeze({Sheet:"sheet",Popup:"popup",Preview:"preview"});var rt=babelHelpers.classPrivateFieldLooseKey("store");var lt=babelHelpers.classPrivateFieldLooseKey("checkListManager");var ot=babelHelpers.classPrivateFieldLooseKey("stubItemId");var ct=babelHelpers.classPrivateFieldLooseKey("calculateAfterSortIndex");var dt=babelHelpers.classPrivateFieldLooseKey("calculateBeforeSortIndex");class ht extends C.EventEmitter{constructor(t){super();Object.defineProperty(this,dt,{value:ut});Object.defineProperty(this,ct,{value:pt});Object.defineProperty(this,rt,{writable:true,value:void 0});Object.defineProperty(this,lt,{writable:true,value:void 0});Object.defineProperty(this,ot,{writable:true,value:void 0});this.setEventNamespace("Tasks.V2.CheckList.CheckListDragManager");babelHelpers.classPrivateFieldLooseBase(this,rt)[rt]=t.store;babelHelpers.classPrivateFieldLooseBase(this,lt)[lt]=t.checkListManager;babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=t.stubItemId}moveDropPreview(t,e,s,i){let n=s?babelHelpers.classPrivateFieldLooseBase(this,ct)[ct](e)-.5:babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](e)+.5;if(!i){const s=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].isFirstItemHigherLevelThan(t,e);const i=e.id===babelHelpers.classPrivateFieldLooseBase(this,ot)[ot];if(!s&&!i){n=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](e)+.5;void babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].dispatch(`${M.Model.CheckList}/update`,{id:e.id,fields:{sortIndex:n+1}})}}void babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].dispatch(`${M.Model.CheckList}/update`,{id:t.id,fields:{sortIndex:n,parentId:e.parentId}})}resortLevelDependingOnPosition(t,e,s,i){let n=s?babelHelpers.classPrivateFieldLooseBase(this,ct)[ct](e):babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](e);let a=false;if(!i){const s=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].isFirstItemHigherLevelThan(t,e);if(!s){n=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](e);a=true}}if(a){this.resortLevel(e.parentId);return}const r=[{...t,sortIndex:n,parentId:e.parentId}];if(s){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].resortItemsAfterIndex(e.parentId,n,(t=>{babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].dispatch(`${M.Model.CheckList}/upsertMany`,[...r,...t])}))}else{babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].resortItemsBeforeIndex(e.parentId,n,(t=>{babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].dispatch(`${M.Model.CheckList}/upsertMany`,[...r,...t])}))}}resortLevel(t){babelHelpers.classPrivateFieldLooseBase(this,lt)[lt].resortItemsOnLevel(t,(t=>{babelHelpers.classPrivateFieldLooseBase(this,rt)[rt].dispatch(`${M.Model.CheckList}/upsertMany`,t)}))}}function pt(t){return t.sortIndex+1}function ut(t){return t.sortIndex-1}var mt=babelHelpers.classPrivateFieldLooseKey("store");var vt=babelHelpers.classPrivateFieldLooseKey("checkListManager");var It=babelHelpers.classPrivateFieldLooseKey("draggable");var ft=babelHelpers.classPrivateFieldLooseKey("draggedItem");var bt=babelHelpers.classPrivateFieldLooseKey("canAddItem");var Lt=babelHelpers.classPrivateFieldLooseKey("stubItemId");var gt=babelHelpers.classPrivateFieldLooseKey("currentUserId");var kt=babelHelpers.classPrivateFieldLooseKey("isSameLevelMove");var Ct=babelHelpers.classPrivateFieldLooseKey("handleBeforeDragStart");var Pt=babelHelpers.classPrivateFieldLooseKey("handleDragStart");var Ft=babelHelpers.classPrivateFieldLooseKey("handleDragOver");var St=babelHelpers.classPrivateFieldLooseKey("handleDragEnd");var Bt=babelHelpers.classPrivateFieldLooseKey("handleDropEnd");var wt=babelHelpers.classPrivateFieldLooseKey("handleDropZoneEnter");var Mt=babelHelpers.classPrivateFieldLooseKey("handleDropZoneOut");var yt=babelHelpers.classPrivateFieldLooseKey("handleDrop");var Tt=babelHelpers.classPrivateFieldLooseKey("handleItemMovingOnSameLevel");var Et=babelHelpers.classPrivateFieldLooseKey("handleItemMovingOnBetweenLevel");var Ht=babelHelpers.classPrivateFieldLooseKey("getItemByNode");class At extends ht{constructor(t){super(t);Object.defineProperty(this,Ht,{value:zt});Object.defineProperty(this,Et,{value:Vt});Object.defineProperty(this,Tt,{value:Nt});Object.defineProperty(this,yt,{value:Rt});Object.defineProperty(this,Mt,{value:Ut});Object.defineProperty(this,wt,{value:Kt});Object.defineProperty(this,Bt,{value:Dt});Object.defineProperty(this,St,{value:xt});Object.defineProperty(this,Ft,{value:$t});Object.defineProperty(this,Pt,{value:Ot});Object.defineProperty(this,Ct,{value:_t});Object.defineProperty(this,mt,{writable:true,value:void 0});Object.defineProperty(this,vt,{writable:true,value:void 0});Object.defineProperty(this,It,{writable:true,value:void 0});Object.defineProperty(this,ft,{writable:true,value:{item:null,childrenIds:[],enterDropzone:false}});Object.defineProperty(this,bt,{writable:true,value:void 0});Object.defineProperty(this,Lt,{writable:true,value:void 0});Object.defineProperty(this,gt,{writable:true,value:void 0});Object.defineProperty(this,kt,{writable:true,value:false});babelHelpers.classPrivateFieldLooseBase(this,mt)[mt]=t.store;babelHelpers.classPrivateFieldLooseBase(this,vt)[vt]=t.checkListManager;babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]=t.canAddItem;babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]=t.stubItemId;babelHelpers.classPrivateFieldLooseBase(this,gt)[gt]=t.currentUserId}init(t,e=0,s=[]){babelHelpers.classPrivateFieldLooseBase(this,It)[It]=new a.Draggable({container:t,draggable:".check-list-draggable-item",dragElement:".check-list-drag-item",delay:0,type:a.Draggable.MOVE,offset:{x:e},dropzone:s});babelHelpers.classPrivateFieldLooseBase(this,It)[It].subscribe("beforeStart",babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct].bind(this));babelHelpers.classPrivateFieldLooseBase(this,It)[It].subscribe("start",babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt].bind(this));babelHelpers.classPrivateFieldLooseBase(this,It)[It].subscribe("over",babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft].bind(this));babelHelpers.classPrivateFieldLooseBase(this,It)[It].subscribe("end",babelHelpers.classPrivateFieldLooseBase(this,St)[St].bind(this));babelHelpers.classPrivateFieldLooseBase(this,It)[It].subscribe("drop",babelHelpers.classPrivateFieldLooseBase(this,Bt)[Bt].bind(this));babelHelpers.classPrivateFieldLooseBase(this,It)[It].subscribe("dropzone:enter",babelHelpers.classPrivateFieldLooseBase(this,wt)[wt].bind(this));babelHelpers.classPrivateFieldLooseBase(this,It)[It].subscribe("dropzone:out",babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt].bind(this))}destroy(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,It)[It])==null?void 0:t.destroy()}}function _t(t){const e=t.getData();const s=e==null?void 0:e.source;const i=s==null?void 0:s.dataset;if(!i){t.preventDefault();return}const n=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].prepareItemId(i.id);const a=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getItem(n);if(!a){t.preventDefault();return}babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].dispatch(`${M.Model.Interface}/setDisableCheckListAnimations`,true);babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].dispatch(`${M.Model.Interface}/setDraggedCheckListId`,a.id);babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]={item:a,childrenIds:[],enterDropzone:false};if(babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].hasItemChildren(a)){k.Dom.addClass(s,"--multiple-drag")}}function Ot(){const t=babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].item;if(babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].hasItemChildren(t)){const e=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getAllChildren(t.id);babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].childrenIds=e.map((t=>t.id));babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].hideItems(babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].childrenIds,(t=>{babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].dispatch(`${M.Model.CheckList}/upsertMany`,t)}))}}function $t(t){const{source:{dataset:e},over:s,clientY:i}=t.getData();const n=babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht](s);if(n){const a=n.id===babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt];const r=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].prepareItemId(e.id);const l=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getItem(r);babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].item=l;const o=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getRootParentByChildId(n.id);const c=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getRootParentByChildId(l.id);const d=a?n.parentId:o.id;if(!babelHelpers.classPrivateFieldLooseBase(this,bt)[bt]&&d!==c.id){t.preventDefault();return}const h=babelHelpers.classPrivateFieldLooseBase(this,It)[It].getElementMiddlePoint(s);const p=i>h.y?1:-1;let u=p===1;if(a){u=false}babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=l.parentId===n.parentId;if(babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]){void babelHelpers.classPrivateFieldLooseBase(this,Tt)[Tt](l,n,u)}else{babelHelpers.classPrivateFieldLooseBase(this,Et)[Et](l,n,u)}}}function xt(t){const{source:e,source:{dataset:s}}=t.getData();const i=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].prepareItemId(s.id);const n=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getItem(i);k.Dom.removeClass(e,"--multiple-drag");if(babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].enterDropzone){return}this.resortLevel(n.parentId);babelHelpers.classPrivateFieldLooseBase(this,yt)[yt](n)}function Dt(t){const{dropzone:e,source:{dataset:s}}=t.getData();const i=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].prepareItemId(s.id);const n=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getItem(i);const a=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].prepareItemId(e.dataset.id);if(n.parentId!==a){this.resortLevel(n.parentId)}void babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].dispatch(`${M.Model.CheckList}/update`,{id:n.id,fields:{sortIndex:babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getChildren(a).length+1,parentId:a,hidden:false}});this.resortLevel(a);babelHelpers.classPrivateFieldLooseBase(this,yt)[yt](n);k.Dom.removeClass(e,"--dropzone")}function Kt(t){const{dropzone:e,source:{dataset:s}}=t.getData();const i=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].prepareItemId(s.id);const n=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getItem(i);if(!n){t.preventDefault();return}babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].enterDropzone=true;babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].hideItems([i],(t=>{babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].dispatch(`${M.Model.CheckList}/upsertMany`,t)}));k.Dom.addClass(e,"--dropzone")}function Ut(t){const{dropzone:e,source:{dataset:s}}=t.getData();const i=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].prepareItemId(s.id);const n=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getItem(i);if(!n){t.preventDefault();return}babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].enterDropzone=false;babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].showItems([i],(t=>{babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].dispatch(`${M.Model.CheckList}/upsertMany`,t)}));k.Dom.removeClass(e,"--dropzone")}function Rt(t){const e=t.parentId!==babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].item.parentId||t.sortIndex!==babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].item.sortIndex;if(e){this.emit("update",t.id)}if(babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].childrenIds.length>0){babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].showItems(babelHelpers.classPrivateFieldLooseBase(this,ft)[ft].childrenIds,(t=>{babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].dispatch(`${M.Model.CheckList}/upsertMany`,t)}))}babelHelpers.classPrivateFieldLooseBase(this,ft)[ft]={item:null,childrenIds:[],enterDropzone:false};babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].dispatch(`${M.Model.Interface}/setDraggedCheckListId`,null);babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].dispatch(`${M.Model.Interface}/setDisableCheckListAnimations`,false);if(!babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]){babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].handleTargetParentFilter(t,babelHelpers.classPrivateFieldLooseBase(this,gt)[gt],(t=>{setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,mt)[mt].dispatch(`${M.Model.CheckList}/upsertMany`,t)}),1e3)}))}this.emit("end",t.id)}async function Nt(t,e,s){const i=e.sortIndex===0;const n=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getChildren(e.parentId).length;const a=e.sortIndex===n-1&&!babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].hasItemChildren(e);const r=Math.abs(t.sortIndex-e.sortIndex)===1&&!i&&!a;if(r){return}this.moveDropPreview(t,e,s,true);this.resortLevelDependingOnPosition(t,e,s,true)}async function Vt(t,e,s){const i=t.parentId;this.moveDropPreview(t,e,s,false);this.resortLevelDependingOnPosition(t,e,s,false);this.resortLevel(i)}function zt(t){const e=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].prepareItemId(t.dataset.id);const s=e===babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt];if(s){const e=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].prepareItemId(t.dataset.parentId);const s=babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getChildren(e).length;return{id:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt],parentId:e,sortIndex:s}}return babelHelpers.classPrivateFieldLooseBase(this,vt)[vt].getItem(e)}var Gt=babelHelpers.classPrivateFieldLooseKey("store");var jt=babelHelpers.classPrivateFieldLooseKey("checkListManager");var Wt=babelHelpers.classPrivateFieldLooseKey("draggable");var Xt=babelHelpers.classPrivateFieldLooseKey("draggedItem");var qt=babelHelpers.classPrivateFieldLooseKey("container");var Yt=babelHelpers.classPrivateFieldLooseKey("handleBeforeDragStart");var Zt=babelHelpers.classPrivateFieldLooseKey("handleDragStart");var Jt=babelHelpers.classPrivateFieldLooseKey("handleDragOver");var Qt=babelHelpers.classPrivateFieldLooseKey("handleDragEnd");var te=babelHelpers.classPrivateFieldLooseKey("handleItemMoving");var ee=babelHelpers.classPrivateFieldLooseKey("setYOffset");class se extends ht{constructor(t){super(t);Object.defineProperty(this,ee,{value:oe});Object.defineProperty(this,te,{value:le});Object.defineProperty(this,Qt,{value:re});Object.defineProperty(this,Jt,{value:ae});Object.defineProperty(this,Zt,{value:ne});Object.defineProperty(this,Yt,{value:ie});Object.defineProperty(this,Gt,{writable:true,value:void 0});Object.defineProperty(this,jt,{writable:true,value:void 0});Object.defineProperty(this,Wt,{writable:true,value:void 0});Object.defineProperty(this,Xt,{writable:true,value:null});Object.defineProperty(this,qt,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]=t.store;babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]=t.checkListManager}init(t,e=0){babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]=t;babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]=new a.Draggable({container:babelHelpers.classPrivateFieldLooseBase(this,qt)[qt],draggable:".check-list-draggable-list",dragElement:".check-list-drag-list",delay:0,type:a.Draggable.MOVE,offset:{x:e}});babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].subscribe("beforeStart",babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt].bind(this));babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].subscribe("start",babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt].bind(this));babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].subscribe("over",babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt].bind(this));babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].subscribe("end",babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt].bind(this))}destroy(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt])==null?void 0:t.destroy()}}function ie(t){const e=t.getData();const s=e==null?void 0:e.source;const i=s==null?void 0:s.dataset;if(!i){t.preventDefault();return}const n=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].prepareItemId(i.id);const a=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].getItem(n);if(!a){t.preventDefault();return}babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]=a;babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](s)}function ne(t){babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].dispatch(`${M.Model.Interface}/setDisableCheckListAnimations`,true);babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].dispatch(`${M.Model.Interface}/setDraggedCheckListId`,babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].id)}function ae(t){const{over:e,clientY:s}=t.getData();const i=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].prepareItemId(e.dataset.id);const n=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].getItem(i);if(n){const t=babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].getElementMiddlePoint(e);const i=s>t.y?1:-1;const a=i===1;void babelHelpers.classPrivateFieldLooseBase(this,te)[te](babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt],n,a)}}function re(t){const{source:{dataset:e}}=t.getData();const s=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].prepareItemId(e.id);const i=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].getItem(s);this.resortLevel(i.parentId);const n=i.sortIndex!==babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt].sortIndex;if(n){this.emit("update",i.id)}babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].dispatch(`${M.Model.Interface}/setDraggedCheckListId`,null);babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt].dispatch(`${M.Model.Interface}/setDisableCheckListAnimations`,false);babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]=null;this.emit("end",i.id)}function le(t,e,s){const i=e.sortIndex===0;const n=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].getChildren(e.parentId).length;const a=e.sortIndex===n-1;const r=Math.abs(t.sortIndex-e.sortIndex)===1&&!i&&!a;if(r){return}this.moveDropPreview(t,e,s,true);this.resortLevelDependingOnPosition(t,e,s,true)}function oe(t){const e=k.Dom.getRelativePosition(t,babelHelpers.classPrivateFieldLooseBase(this,qt)[qt]);const s=e.top;const i=s<=0;const n=i?s:0;const a=babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].getOptions();a.offset.y=-n;babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt].setOptions(a)}const ce={inject:{task:{},taskId:{},isEdit:{}},props:{id:{type:[Number,String],required:true},isPreview:{type:Boolean,default:false}},emits:["update","addItem","removeItem","focus","blur","emptyBlur","show","hide"],setup(){},data(){return{isHovered:false,scrollContainer:null,isDragEnabled:false}},computed:{...c.mapGetters({currentUserId:`${M.Model.Interface}/currentUserId`,draggedCheckListId:`${M.Model.Interface}/draggedCheckListId`}),checkLists(){return this.$store.getters[`${M.Model.CheckList}/getByIds`](this.task.checklist)},item(){return this.$store.getters[`${M.Model.CheckList}/getById`](this.id)},canAdd(){if(!this.isEdit){return true}return this.task.rights.checklistAdd},canEdit(){var t,e;if(!this.isEdit){return true}const s=this.checkListManager.getRootParentByChildId((t=this.item)==null?void 0:t.id);return this.task.rights.checklistEdit||(s==null?void 0:(e=s.creator)==null?void 0:e.id)===this.currentUserId},canModify(){var t;return((t=this.item)==null?void 0:t.actions.modify)===true},canRemove(){var t;return((t=this.item)==null?void 0:t.actions.remove)===true},canToggle(){var t;return((t=this.item)==null?void 0:t.actions.toggle)===true},hasAttachments(){return this.hasUsers},hasUsers(){return this.hasAccomplices||this.hasAuditors},hasAccomplices(){var t;return((t=this.accomplices)==null?void 0:t.length)>0},hasAuditors(){var t;return((t=this.auditors)==null?void 0:t.length)>0},accomplices(){return this.item.accomplices},auditors(){return this.item.auditors},files(){return this.item.attachments},textColor(){return this.completed?"var(--ui-color-base-4)":"var(--ui-color-base-1)"},linkColor(){return this.completed?"var(--ui-color-base-4)":"var(--ui-color-accent-main-link)"},groupMode(){var t;return((t=this.item.groupMode)==null?void 0:t.active)===true},groupModeSelected(){var t;return((t=this.item.groupMode)==null?void 0:t.selected)===true},completed(){return this.checkListManager.isItemCompleted(this.item)},canDragItem(){if(!this.isDragEnabled){return false}return this.isHovered&&this.canModify&&!this.readOnly&&!this.groupMode},readOnly(){return this.isPreview},textReadOnly(){return this.groupMode||this.isPreview||!this.canModify}},created(){this.checkListManager=new W({computed:{checkLists:()=>this.checkLists}})},mounted(){setTimeout((()=>{this.isDragEnabled=true}),1e3)},methods:{...c.mapActions(M.Model.Interface,["addCheckListCompletionCallback"]),handleFocus(){this.$emit("focus",this.id)},handleBlur(){this.$emit("blur",this.id)},handleEmptyBlur(){this.$emit("emptyBlur",this.id)},handleLinkClick(t){t.stopPropagation()},updateCheckList(t,e){this.$emit("update",this.id);return this.$store.dispatch(`${M.Model.CheckList}/update`,{id:t,fields:e})},upsertCheckLists(t){this.$emit("update",this.id);return this.$store.dispatch(`${M.Model.CheckList}/upsertMany`,t)},updateTitle(t=""){this.$store.dispatch(`${M.Model.CheckList}/update`,{id:this.id,fields:{title:t}});this.$emit("update",this.id)},addItem(t){if(!this.canAdd){return}this.$emit("addItem",{id:this.id,sort:k.Type.isNumber(t)?t:null})},removeItem(){this.$emit("removeItem",this.id)},async complete(t){if(this.canToggle===false){return}await this.updateCheckList(this.id,{localCompleteState:t});const e=new Map;this.checkListManager.syncParentCompletionState(this.id,((t,s)=>{e.set(t,s);this.updateCheckList(t,{localCompleteState:s.isComplete})}));this.$emit("update",this.id);const s=()=>{this.updateCheckList(this.id,{isComplete:t});e.forEach(((t,e)=>{this.updateCheckList(e,t);if(this.isPreview&&this.isEdit){this.saveCompleteState(e,t.isComplete)}}))};this.addCheckListCompletionCallback({id:this.id,callback:s});if(this.isPreview&&this.isEdit){this.saveCompleteState(this.id,t)}},saveCompleteState(t,e){if(e){void P.checkListService.complete(this.taskId,t)}else{void P.checkListService.renew(this.taskId,t)}},async scrollToItem(){var t;await new Promise((t=>{setTimeout((()=>t()),300)}));const e=this.$refs.item;const s=(t=this.$parent.$el)==null?void 0:t.closest("[data-list]");const i=k.Dom.getPosition(e);const n=k.Dom.getPosition(s);const a=i.top-n.top+s.scrollTop;s.scrollTo({top:a-200,behavior:"smooth"})}}};const de={name:"CheckListParentItem",components:{BIcon:S.BIcon,BMenu:r.BMenu,GrowingTextArea:h.GrowingTextArea,UserAvatarList:p.UserAvatarList,UserCheckbox:l.UserCheckbox,ProgressBar:o.ProgressBar},directives:{hint:f.hint},mixins:[ce],inject:["setItemsRef"],props:{positionIndex:{type:Number,required:true}},emits:["startGroupMode","openCheckList"],setup(){return{Actions:S.Actions,Outline:S.Outline}},data(){return{isSticky:false,isMenuShown:false,menuRemoveSectionCode:"removeSection"}},computed:{menuOptions(){return{id:`check-list-parent-item-action-menu-${k.Text.getRandom()}`,bindElement:this.$refs.more.$el,minWidth:250,offsetLeft:-100,sections:[{code:this.menuRemoveSectionCode}],items:this.menuItems,targetContainer:document.body,closeByEsc:true}},menuItems(){const t={title:this.item.areCompletedCollapsed?this.loc("TASKS_V2_CHECK_LIST_ITEM_MENU_SHOW"):this.loc("TASKS_V2_CHECK_LIST_ITEM_MENU_HIDE"),icon:this.item.areCompletedCollapsed?S.Outline.OBSERVER:S.Outline.CROSSED_EYE,dataset:{id:`MenuProfileHide-${this.id}`},onClick:()=>{const t=!this.item.areCompletedCollapsed;void this.updateCheckList(this.id,{areCompletedCollapsed:t});this.toggleCompleted(this.id,t)}};const e={title:this.loc("TASKS_V2_CHECK_LIST_ITEM_MENU_GROUP"),icon:S.Outline.MULTICHOICE_ON,dataset:{id:`MenuProfileGroup-${this.id}`},onClick:()=>{if(this.collapsed){this.toggleCollapse()}this.$emit("startGroupMode",this.id)}};const s={sectionCode:this.menuRemoveSectionCode,title:this.loc("TASKS_V2_CHECK_LIST_ITEM_MENU_EDIT"),icon:S.Outline.EDIT_L,dataset:{id:`MenuProfileEdit-${this.id}`},onClick:()=>{if(this.canModify){this.$emit("openCheckList",this.id)}}};const i={sectionCode:this.menuRemoveSectionCode,design:"alert",title:this.loc("TASKS_V2_CHECK_LIST_ITEM_MENU_REMOVE"),icon:S.Outline.TRASHCAN,dataset:{id:`MenuProfileRemove-${this.id}`},onClick:this.removeItem.bind(this)};if(this.isPreview){return[t,this.canModify?s:null,this.canRemove?i:null]}return[t,this.canModify?e:null,this.canRemove?i:null]},itemIcon(){return this.completed?S.Outline.CHECK_L:S.Outline.CHECK_LIST},checkListStatus(){const t=this.loc("TASKS_V2_CHECK_LIST_STATUS_LABEL_NEW");return t.replace("#completed#",this.completedCount).replace("#total#",this.totalCount)},completedCount(){return this.checkLists.filter((t=>{var e;if(t.parentId!==this.id){return false}return(e=t.localCompleteState)!=null?e:t.isComplete})).length},totalCount(){return this.checkLists.filter((t=>t.parentId===this.id)).length},currentUserResponsible(){return this.task.responsibleIds.includes(this.currentUserId)},currentUser(){return this.$store.getters[`${M.Model.Users}/getById`](this.currentUserId)},numberMyItems(){return this.checkListManager.findItemIdsWithUser(this.id,this.currentUserId).size},myFilterTooltip(){return()=>L.tooltip({text:this.myFilterActive?this.loc("TASKS_V2_CHECK_LIST_MY_FILTER_HINT_ALL"):this.loc("TASKS_V2_CHECK_LIST_MY_FILTER_HINT_MY"),popupOptions:{offsetLeft:this.$refs.myFilter.offsetWidth/2}})},myFilterActive(){return this.item.myFilterActive},fontSize(){return this.isPreview?15:17},collapsed(){if(this.checkListManager.isParentItem(this.draggedCheckListId)){return true}return this.checkListManager.isItemCollapsed(this.item,this.isPreview,this.positionIndex)}},watch:{myFilterActive(t){this.handleMyFilter(t)},totalCount(){this.handleCompleteState();if(!this.numberMyItems&&this.myFilterActive){this.handleMyFilter(false)}}},mounted(){var t;this.scrollContainer=(t=this.$parent.$el)==null?void 0:t.closest("[data-list]");if(this.setItemsRef){this.setItemsRef(this.id,this)}if(this.scrollContainer){k.Event.bind(this.scrollContainer,"scroll",this.handleScroll);void this.$nextTick(this.checkSticky);this.mutationObserver=new MutationObserver((()=>{this.checkSticky()}));this.mutationObserver.observe(this.scrollContainer,{childList:true,subtree:true})}if(!this.isPreview){this.handleCompleteState()}},beforeUnmount(){if(this.scrollContainer){k.Event.unbind(this.scrollContainer,"scroll",this.handleScroll)}if(this.mutationObserver){this.mutationObserver.disconnect()}if(this.setItemsRef){this.setItemsRef(this.id,null)}},methods:{handleScroll(){this.checkSticky()},handleTextClick(){if(this.isPreview&&this.canModify){this.$emit("openCheckList",this.id)}},handleMyFilter(t){const e=this.checkListManager.findItemIdsWithUser(this.id,this.currentUserId);this.$store.dispatch(`${M.Model.CheckList}/update`,{id:this.id,fields:{myFilterActive:t}});if(t===true){const t=this.checkListManager.getAllChildren(this.id).filter((t=>!e.has(t.id))).map((t=>t.id));this.checkListManager.hideItems(t,(t=>this.upsertCheckLists(t)))}else{const t=this.checkListManager.getAllChildren(this.id).filter((t=>{var e;const s=(e=t.localCompleteState)!=null?e:t.isComplete;return!this.item.areCompletedCollapsed||!s})).map((t=>t.id));this.checkListManager.showItems(t,(t=>this.upsertCheckLists(t)))}},handleCompleteState(){if(this.totalCount>0){this.complete(this.totalCount===this.completedCount)}else if(this.completed){this.complete(false)}},checkSticky(){if(!this.scrollContainer||!this.$refs.item){return}const t=this.$refs.item.getBoundingClientRect();const e=this.scrollContainer.getBoundingClientRect();this.isSticky=t.top<=e.top+t.height/2},showMenu(){this.isMenuShown=true},toggleCollapse(){const t=!this.collapsed;if(this.isPreview&&this.isEdit){if(t===true){void P.checkListService.collapse(this.taskId,this.id)}else{void P.checkListService.expand(this.taskId,this.id)}}this.$store.dispatch(`${M.Model.CheckList}/update`,{id:this.id,fields:{localCollapsedState:t}})},collapse(){this.$store.dispatch(`${M.Model.CheckList}/update`,{id:this.id,fields:{localCollapsedState:true}})},toggleCompleted(t,e){const s=this.checkListManager.findItemIdsWithUser(this.id,this.currentUserId);this.checkListManager.getAllCompletedChildren(t).filter((t=>!this.myFilterActive||s.has(t.id))).forEach((t=>{if(e===false){this.checkListManager.showItems([t.id],(t=>this.upsertCheckLists(t)))}else{this.checkListManager.hideItems([t.id],(t=>this.upsertCheckLists(t)))}}))}},template:`\n\t\t<div\n\t\t\tref="item"\n\t\t\tclass="check-list-widget-parent-item"\n\t\t\t:class="{\n\t\t\t\t'--complete': completed,\n\t\t\t\t'--collapsed': collapsed,\n\t\t\t\t'--preview': isPreview,\n\t\t\t\t'--editable': canModify,\n\t\t\t}"\n\t\t\t:data-id="id"\n\t\t\t:data-parent="id"\n\t\t\t@mouseover="isHovered = true"\n\t\t\t@mouseleave="isHovered = false"\n\t\t>\n\t\t\t<div class="check-list-widget-parent-item-label-container">\n\t\t\t\t<div\n\t\t\t\t\tv-if="!readOnly"\n\t\t\t\t\tclass="check-list-widget-item-drag"\n\t\t\t\t\t:class="{\n\t\t\t\t\t\t'check-list-drag-list': canDragItem,\n\t\t\t\t\t}"\n\t\t\t\t>\n\t\t\t\t\t<BIcon v-if="canDragItem" :name="Outline.DRAG_L"/>\n\t\t\t\t</div>\n\t\t\t\t<div class="check-list-widget-item-icon">\n\t\t\t\t\t<BIcon :name="itemIcon"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="check-list-widget-parent-item-title-container">\n\t\t\t\t<GrowingTextArea\n\t\t\t\t\tref="growingTextArea"\n\t\t\t\t\tclass="check-list-widget-parent-item-title"\n\t\t\t\t\t:data-check-list-id="'check-list-parent-item-title-' + id"\n\t\t\t\t\t:modelValue="item.title"\n\t\t\t\t\t:placeholder="loc('TASKS_V2_CHECK_LIST_LIST_PLACEHOLDER')"\n\t\t\t\t\t:readonly="textReadOnly"\n\t\t\t\t\t:fontColor="textColor"\n\t\t\t\t\t:linkColor\n\t\t\t\t\t:fontSize\n\t\t\t\t\t:lineHeight="20"\n\t\t\t\t\t:fontWeight="500"\n\t\t\t\t\t@click="handleTextClick"\n\t\t\t\t\t@linkClick="handleLinkClick"\n\t\t\t\t\t@update:modelValue="updateTitle"\n\t\t\t\t\t@input="updateTitle"\n\t\t\t\t\t@focus="handleFocus"\n\t\t\t\t\t@emptyFocus="scrollToItem"\n\t\t\t\t\t@blur="handleBlur"\n\t\t\t\t\t@emptyBlur="handleEmptyBlur"\n\t\t\t\t/>\n\t\t\t\t<template v-if="hasAttachments">\n\t\t\t\t\t<div class="check-list-widget-item-attach --parent">\n\t\t\t\t\t\t<div v-if="hasUsers" class="check-list-widget-item-attach-users">\n\t\t\t\t\t\t\t<div v-if="hasAccomplices" class="check-list-widget-item-attach-users-list">\n\t\t\t\t\t\t\t\t<BIcon :name="Outline.GROUP"/>\n\t\t\t\t\t\t\t\t<UserAvatarList :users="accomplices"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-if="hasAuditors" class="check-list-widget-item-attach-users-list">\n\t\t\t\t\t\t\t\t<BIcon :name="Outline.OBSERVER"/>\n\t\t\t\t\t\t\t\t<UserAvatarList :users="auditors"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<div class="check-list-widget-parent-item-title-status">\n\t\t\t\t\t<div class="check-list-widget-parent-item-title-status-label">\n\t\t\t\t\t\t{{ checkListStatus }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<ProgressBar\n\t\t\t\t\t\t:totalValue="totalCount"\n\t\t\t\t\t\t:completedValue="completedCount"\n\t\t\t\t\t\t:width="56"\n\t\t\t\t\t\t:height="5"\n\t\t\t\t\t\tcolor="var(--ui-color-accent-main-primary-alt)"\n\t\t\t\t\t\tbgColor="var(--ui-color-base-7)"\n\t\t\t\t\t\t:borderRadius="30"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="check-list-widget-parent-item-action">\n\t\t\t\t<div class="check-list-widget-parent-item-main-action">\n\t\t\t\t\t<div\n\t\t\t\t\t\tref="myFilter"\n\t\t\t\t\t\tclass="check-list-widget-parent-item-main-action-filter"\n\t\t\t\t\t\tv-hint="myFilterTooltip"\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserCheckbox\n\t\t\t\t\t\t\tv-if="!currentUserResponsible && numberMyItems > 0"\n\t\t\t\t\t\t\t:init-user="currentUser"\n\t\t\t\t\t\t\t:number="numberMyItems"\n\t\t\t\t\t\t\tv-model:checked="item.myFilterActive"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="check-list-widget-parent-item-main-action-actions">\n\t\t\t\t\t\t<BIcon ref="more" :name="Outline.MORE_L" @click="showMenu"/>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t:name="collapsed ? Outline.CHEVRON_DOWN_L : Outline.CHEVRON_TOP_L"\n\t\t\t\t\t\t\t@click="toggleCollapse()"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="isSticky && !isPreview" class="check-list-widget-parent-item-empty"/>\n\t\t\t</div>\n\t\t\t<BMenu v-if="isMenuShown" :options="menuOptions" @close="isMenuShown = false"/>\n\t\t</div>\n\t`};const he={name:"CheckListCheckbox",components:{UiCheckbox:v.Checkbox},props:{important:{type:Boolean,default:false},disabled:{type:Boolean,default:false},checked:{type:Boolean,default:false},highlight:{type:Boolean,default:false}},emits:["click"],template:`\n\t\t<UiCheckbox\n\t\t\t:checked\n\t\t\t:important\n\t\t\t:disabled\n\t\t\t:highlight\n\t\t\tclass="check-list-widget-checkbox"\n\t\t\t@click="$emit('click', $event)"\n\t\t/>\n\t`};const pe={name:"CheckListChildItem",components:{BIcon:S.BIcon,BLine:d.BLine,GrowingTextArea:h.GrowingTextArea,UserAvatarList:p.UserAvatarList,CheckListCheckbox:he,UserFieldWidgetComponent:m.DiskUserFieldWidgetComponent},mixins:[ce],inject:["setItemsRef"],props:{itemOffset:{type:String,default:"0"},checkListId:{type:[Number,String],default:0}},emits:["toggleGroupModeSelected","openCheckList"],setup(t){const e=T.fileService.get(t.id,T.EntityTypes.CheckListItem,{parentEntityId:t.taskId});return{Outline:S.Outline,fileService:e,uploaderAdapter:e.getAdapter()}},data(){return{uploadingFiles:this.fileService.getFiles(),filesLoading:false}},computed:{widgetOptions(){return{isEmbedded:true,withControlPanel:false,canCreateDocuments:false,tileWidgetOptions:{compact:true,hideDropArea:true,enableDropzone:false,readonly:this.isPreview,autoCollapse:false,removeFromServer:!this.isEdit}}},hasAttachments(){return this.hasUsers||this.hasFilesAttach},hasFilesAttach(){return this.hasFiles||this.fileService.isUploading()||this.fileService.hasUploadingError()},hasFiles(){return this.filesNumber>0},filesNumber(){if(!this.files){return 0}return this.files.length},hasTrashcanIcon(){return this.isHovered&&this.canModify&&!this.item.panelIsShown&&!this.groupMode&&!this.readOnly},toggleable(){if(this.isPreview){return this.canModify}return this.canToggle}},created(){if(this.hasFilesAttach){void this.loadFiles()}},mounted(){if(this.setItemsRef){this.setItemsRef(this.id,this)}if(this.checkListId===this.id){setTimeout((()=>{var t;(t=this.$refs.growingTextArea)==null?void 0:t.focusTextarea()}),500)}this.subscribeToEvents()},beforeUnmount(){if(this.setItemsRef){this.setItemsRef(this.id,null)}this.unsubscribeToEvents()},methods:{subscribeToEvents(){C.EventEmitter.subscribe(M.EventName.HighlightCheckListItem+this.id,this.handleHighlightItemEvent)},unsubscribeToEvents(){C.EventEmitter.unsubscribe(M.EventName.HighlightCheckListItem+this.id,this.handleHighlightItemEvent)},toggleGroupModeSelected(){this.$store.dispatch(`${M.Model.CheckList}/update`,{id:this.id,fields:{groupMode:{active:true,selected:!this.groupModeSelected}}});this.$emit("toggleGroupModeSelected",this.id)},async loadFiles(){var t;this.filesLoading=true;const e=(t=this.files)==null?void 0:t.map((t=>{var e;return(e=t==null?void 0:t.id)!=null?e:t}));await this.fileService.list(e!=null?e:[]);this.filesLoading=false},handleEnter(){if(!this.item){return}this.addItem(this.item.sortIndex+1)},handleClick(t){const e=this.$refs["files-widget"];if(this.isClickInsideFilesWidget(e==null?void 0:e.$el,t.target)){return}if(this.groupMode){this.toggleGroupModeSelected()}if(this.isPreview&&this.canModify){this.$emit("openCheckList",this.id)}},isClickInsideFilesWidget(t,e){if(!t||!e){return false}const s=["ui-tile-uploader-items"];const i=t.contains(e);if(!i){return false}const n=s.some((t=>k.Dom.hasClass(e,t)));return!n},handleHighlightItemEvent(){void u.highlighter.highlight(this.$el)}},template:`\n\t\t<div\n\t\t\tref="item"\n\t\t\tclass="check-list-widget-child-item"\n\t\t\t:class="{\n\t\t\t\t'--complete': completed,\n\t\t\t\t'--group-mode': groupMode,\n\t\t\t\t'--group-mode-selected': groupModeSelected,\n\t\t\t\t'--preview': isPreview,\n\t\t\t\t'--toggleable': toggleable,\n\t\t\t}"\n\t\t\t:style="{ marginLeft: itemOffset }"\n\t\t\t@mouseover="isHovered = true"\n\t\t\t@mouseleave="isHovered = false"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<div class="check-list-widget-child-item-base">\n\t\t\t\t<div\n\t\t\t\t\tv-if="!readOnly"\n\t\t\t\t\tclass="check-list-widget-item-drag"\n\t\t\t\t\t:class="{\n\t\t\t\t\t\t'check-list-drag-item': canDragItem,\n\t\t\t\t\t}"\n\t\t\t\t>\n\t\t\t\t\t<BIcon v-if="canDragItem" :name="Outline.DRAG_L"/>\n\t\t\t\t</div>\n\t\t\t\t<CheckListCheckbox\n\t\t\t\t\t:important="!item.isImportant"\n\t\t\t\t\t:disabled="!canToggle || groupMode"\n\t\t\t\t\t:checked="completed"\n\t\t\t\t\t@click="complete(!completed)"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="item.isImportant"\n\t\t\t\t\tclass="check-list-widget-child-item-important"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name="Outline.FIRE_SOLID"/>\n\t\t\t\t</div>\n\t\t\t\t<GrowingTextArea\n\t\t\t\t\tref="growingTextArea"\n\t\t\t\t\tclass="check-list-widget-child-item-title"\n\t\t\t\t\t:data-check-list-id="'check-list-child-item-title-' + item.id"\n\t\t\t\t\t:modelValue="item.title"\n\t\t\t\t\t:placeholder="loc('TASKS_V2_CHECK_LIST_ITEM_PLACEHOLDER')"\n\t\t\t\t\t:readonly="textReadOnly"\n\t\t\t\t\t:fontColor="textColor"\n\t\t\t\t\t:linkColor\n\t\t\t\t\t:fontSize="15"\n\t\t\t\t\t:lineHeight="20"\n\t\t\t\t\t@update:modelValue="updateTitle"\n\t\t\t\t\t@linkClick="handleLinkClick"\n\t\t\t\t\t@input="updateTitle"\n\t\t\t\t\t@focus="handleFocus"\n\t\t\t\t\t@blur="handleBlur"\n\t\t\t\t\t@emptyBlur="handleEmptyBlur"\n\t\t\t\t\t@emptyFocus="scrollToItem"\n\t\t\t\t\t@enterBlur="handleEnter"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tv-if="hasTrashcanIcon"\n\t\t\t\t\tclass="check-list-widget-child-item-action"\n\t\t\t\t\t@click="removeItem"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name="Outline.TRASHCAN"/>\n\t\t\t\t</div>\n\t\t\t\t<template v-else-if="groupMode">\n\t\t\t\t\t<CheckListCheckbox :checked="groupModeSelected" highlight @click="toggleGroupModeSelected"/>\n\t\t\t\t</template>\n\t\t\t\t<div v-else class="check-list-widget-child-item-action-stub"/>\n\t\t\t</div>\n\t\t\t<template v-if="hasAttachments">\n\t\t\t\t<div class="check-list-widget-item-attach">\n\t\t\t\t\t<div v-if="hasUsers" class="check-list-widget-item-attach-users">\n\t\t\t\t\t\t<div v-if="hasAccomplices" class="check-list-widget-item-attach-users-list">\n\t\t\t\t\t\t\t<BIcon :name="Outline.GROUP"/>\n\t\t\t\t\t\t\t<UserAvatarList :users="accomplices"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div v-if="hasAuditors" class="check-list-widget-item-attach-users-list">\n\t\t\t\t\t\t\t<BIcon :name="Outline.OBSERVER"/>\n\t\t\t\t\t\t\t<UserAvatarList :users="auditors"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="hasFilesAttach" class="check-list-widget-item-attach-files">\n\t\t\t\t\t\t<div class="check-list-widget-item-attach-files-list">\n\t\t\t\t\t\t\t<template v-if="filesLoading">\n\t\t\t\t\t\t\t\t<div class="check-list-widget-item-attach-files-list-skeleton">\n\t\t\t\t\t\t\t\t\t<BLine v-for="key in filesNumber" :key :height="90"/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<UserFieldWidgetComponent :uploaderAdapter :widgetOptions ref="files-widget"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const ue={name:"CheckListAddItem",components:{BIcon:S.BIcon},props:{isPreview:{type:Boolean,default:false}},emits:["addItem"],setup(){return{Outline:S.Outline}},template:`\n\t\t<div\n\t\t\tclass="check-list-widget-add-item"\n\t\t\t:class="{'--preview': isPreview}"\n\t\t\t@mousedown="$emit('addItem')"\n\t\t>\n\t\t\t<div class="check-list-widget-add-item-icon">\n\t\t\t\t<BIcon :name="Outline.PLUS_L"/>\n\t\t\t</div>\n\t\t\t<div class="check-list-widget-add-item-title">{{ loc('TASKS_V2_CHECK_LIST_ITEM_ADD_BTN') }}</div>\n\t\t</div>\n\t`};const me={name:"CheckListDropList",template:`\n\t\t<div class="check-list-widget-drop-list"/>\n\t`};const ve={name:"CheckListDropItem",props:{dropOffset:{type:String,default:"0"}},template:`\n\t\t<div class="check-list-widget-drop-item" :style="{ marginLeft: dropOffset }"/>\n\t`};const Ie={name:"CheckListGroupCompletedList",components:{BIcon:S.BIcon},props:{totalCompletedParents:{type:Number,required:true}},setup(){return{Actions:S.Actions,Outline:S.Outline}},computed:{completedParentsLabel(){return this.loc("TASKS_V2_CHECK_LIST_PREVIEW_COMPLETED",{"#number#":this.totalCompletedParents})}},template:`\n\t\t<div class="check-list-widget-group-completed-list">\n\t\t\t<div class="check-list-widget-group-completed-list-icon">\n\t\t\t\t<BIcon :name="Outline.CHECK_L"/>\n\t\t\t</div>\n\t\t\t<div class="check-list-widget-group-completed-list-title">\n\t\t\t\t{{ completedParentsLabel }}\n\t\t\t</div>\n\t\t\t<div class="check-list-widget-group-completed-list-action">\n\t\t\t\t<BIcon :name="Actions.CHEVRON_RIGHT"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const fe={name:"CheckListWidget",components:{CheckListParentItem:de,CheckListChildItem:pe,CheckListAddItem:ue,CheckListDropList:me,CheckListDropItem:ve,CheckListGroupCompletedList:Ie},inject:{task:{},taskId:{}},props:{context:{type:String,required:true},checkListId:{type:[Number,String],default:0},parentId:{type:[Number,String],default:0},isPreview:{type:Boolean,default:false}},emits:["show","update","addItem","addItemFromBtn","removeItem","focus","blur","emptyBlur","startGroupMode","toggleGroupModeSelected","openCheckList"],setup(){},data(){return{scrollContainer:null}},computed:{...c.mapGetters({currentUserId:`${M.Model.Interface}/currentUserId`,disableCheckListAnimations:`${M.Model.Interface}/disableCheckListAnimations`,draggedCheckListId:`${M.Model.Interface}/draggedCheckListId`}),checkLists(){return this.$store.getters[`${M.Model.CheckList}/getByIds`](this.task.checklist)},parentCheckLists(){return this.checkLists.filter((t=>{if(t.parentId!==0||t.hidden){return false}return!(this.isPreview&&t.isComplete)})).sort(((t,e)=>{if(t.isComplete===e.isComplete){return t.sortIndex-e.sortIndex}return t.isComplete?1:-1}))},totalCompletedParents(){return this.checkLists.filter((t=>t.parentId===0&&t.isComplete)).length},siblings(){return this.checkLists.filter((t=>t.parentId===this.parentId)).sort(((t,e)=>t.sortIndex-e.sortIndex))},canAddItem(){return this.task.rights.checklistAdd},parentItemDragged(){return this.checkListManager.isParentItem(this.draggedCheckListId)}},created(){this.checkListManager=new W({computed:{checkLists:()=>this.checkLists}});if(!this.isPreview){this.listDragManager=new se({store:this.$store,checkListManager:this.checkListManager});this.listDragManager.subscribe("update",(t=>{const e=t.getData();this.$emit("update",e)}));this.listDragManager.subscribe("end",(t=>{const e=t.getData();setTimeout((()=>{this.scrollToTarget(e,0,false);this.handleDropException()}),100)}));this.itemDragManager=new At({store:this.$store,checkListManager:this.checkListManager,canAddItem:this.canAddItem,stubItemId:"add-item",currentUserId:this.currentUserId});this.itemDragManager.subscribe("update",(t=>{const e=t.getData();this.$emit("update",e)}));this.itemDragManager.subscribe("end",(()=>{setTimeout((()=>{this.handleDropException()}),100)}))}},mounted(){this.scrollContainer=this.$el.parentElement;this.subscribeToEvents();if(!this.isPreview){this.initDragManager()}this.focusTo(this.checkListId);this.$emit("show")},beforeUnmount(){var t;(t=this.itemDragManager)==null?void 0:t.destroy();this.unsubscribeFromEvents()},methods:{subscribeToEvents(){C.EventEmitter.subscribe(M.EventName.ShowCheckList,this.handleShowCheckListEvent);C.EventEmitter.subscribe(M.EventName.ShowCheckListItems,this.handleShowCheckListItemsEvent)},unsubscribeFromEvents(){C.EventEmitter.unsubscribe(M.EventName.ShowCheckList,this.handleShowCheckListEvent);C.EventEmitter.unsubscribe(M.EventName.ShowCheckListItems,this.handleShowCheckListItemsEvent)},focusTo(t){const e=this.checkListManager.getItem(t);if(!e){return}const{targetId:s,offset:i,shouldHighlight:n}=this.calculateFocusTarget(e);this.scrollToTarget(s,i,n)},calculateFocusTarget(t){var e;const s=t.parentId===0;if(!s){return{targetId:t.id,offset:140,shouldHighlight:false}}const i=this.checkListManager.getChildWithEmptyTitle(t.id);return{targetId:(e=i==null?void 0:i.id)!=null?e:t.id,offset:i?140:0,shouldHighlight:true}},scrollToTarget(t,e,s){setTimeout((()=>{const i=this.scrollContainer.querySelector(`[data-id="${t}"]`);if(!i){return}if(s){this.highlightParentContainer(t)}this.scrollContainer.scrollTop=i.offsetTop-e}),0)},highlightParentContainer(t){const e=this.scrollContainer.querySelector(`[data-parent-container="${t}"]`);if(e){void u.highlighter.highlight(e)}},getItemOffset(t){if(t.parentId===0){return"0"}const e=this.checkListManager.getItemLevel(t);if(e===1){return"0"}return`${(e-1)*28}px`},handleDropException(){const t=this.$el.closest("[data-list]");const e=t.querySelectorAll(".check-list-widget-item.--dragged_item");e.forEach((t=>t.remove()))},getChildren(t){return this.checkListManager.getAllChildren(t.id).filter((t=>!t.hidden))},isCollapsed(t,e){if(this.checkListManager.isParentItem(this.draggedCheckListId)){return true}return this.checkListManager.isItemCollapsed(t,this.isPreview,e)},getFirstCompletedCheckList(){const t=this.checkLists.filter((t=>t.parentId===0&&t.isComplete===true)).sort(((t,e)=>t.sortIndex-e.sortIndex));return t[0]},handleShowCheckListEvent(t){const{checkListId:e}=t.getData();if(!e){return}this.$emit("openCheckList",e);this.focusTo(e)},async handleShowCheckListItemsEvent(t){const{checkListItemIds:e}=t.getData();if(!k.Type.isArrayFilled(e)){return}const s=e[0];this.focusTo(s);this.$emit("openCheckList",s);await this.$nextTick();e.forEach((t=>{C.EventEmitter.emit(M.EventName.HighlightCheckListItem+t)}))},showFirstCompletedCheckList(){const t=this.getFirstCompletedCheckList();this.$emit("openCheckList",t.id)},initDragManager(){var t;let e=0;if(this.context!==at.Popup&&k.Type.isElementNode(this.$root.$el)){const t=k.Dom.getPosition(this.$el);const s=k.Dom.getRelativePosition(this.$el,this.$root.$el);e=s.left-t.left}this.listDragManager.init(this.scrollContainer,e);const s=this.canAddItem?(t=this.$refs.parentComponents)==null?void 0:t.map((t=>t.$el)):[];this.itemDragManager.init(this.scrollContainer,e,s)}},template:`\n\t\t<div class="check-list-widget-container">\n\t\t\t<TransitionGroup\n\t\t\t\t:css="!disableCheckListAnimations"\n\t\t\t\tname="check-list"\n\t\t\t\ttag="ul"\n\t\t\t\tclass="check-list-widget --parent"\n\t\t\t\t:class="{\n\t\t\t\t\t'--preview': isPreview,\n\t\t\t\t\t'--dragged': parentItemDragged,\n\t\t\t\t}"\n\t\t\t>\n\t\t\t\t<li\n\t\t\t\t\tv-for="(parentItem, parentItemIndex) in parentCheckLists"\n\t\t\t\t\t:key="'parent-' + parentItem.id + parentItemIndex"\n\t\t\t\t\tclass="check-list-widget-item --parent check-list-draggable-list"\n\t\t\t\t\t:class="{\n\t\t\t\t\t\t'--preview': isPreview,\n\t\t\t\t\t\t'--collapsed': isCollapsed(parentItem, parentItemIndex),\n\t\t\t\t\t\t'--hidden': parentItem.hidden,\n\t\t\t\t\t\t'--dragged_item': parentItem.id === draggedCheckListId,\n\t\t\t\t\t}"\n\t\t\t\t\t:data-id="parentItem.id"\n\t\t\t\t\t:data-parent-container="parentItem.id"\n\t\t\t\t>\n\t\t\t\t\t<template v-if="parentItem.id === draggedCheckListId">\n\t\t\t\t\t\t<CheckListDropList/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<CheckListParentItem\n\t\t\t\t\t\t\tref="parentComponents"\n\t\t\t\t\t\t\t:id="parentItem.id"\n\t\t\t\t\t\t\t:isPreview\n\t\t\t\t\t\t\t:positionIndex="parentItemIndex"\n\t\t\t\t\t\t\t@update="(id) => $emit('update', id)"\n\t\t\t\t\t\t\t@removeItem="(id) => $emit('removeItem', id)"\n\t\t\t\t\t\t\t@focus="(id) => $emit('focus', id)"\n\t\t\t\t\t\t\t@blur="(id) => $emit('blur', id)"\n\t\t\t\t\t\t\t@emptyBlur="(id) => $emit('emptyBlur', id)"\n\t\t\t\t\t\t\t@startGroupMode="(id) => $emit('startGroupMode', id)"\n\t\t\t\t\t\t\t@openCheckList="(id) => $emit('openCheckList', id)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<TransitionGroup\n\t\t\t\t\t\tv-if="parentItem.id !== draggedCheckListId"\n\t\t\t\t\t\t:css="!disableCheckListAnimations"\n\t\t\t\t\t\tname="check-list"\n\t\t\t\t\t\ttag="ul"\n\t\t\t\t\t\tclass="check-list-widget"\n\t\t\t\t\t>\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-if="!isCollapsed(parentItem, parentItemIndex)"\n\t\t\t\t\t\t\tv-for="(childItem, childIndex) in getChildren(parentItem)"\n\t\t\t\t\t\t\t:key="'child-' + parentItem.id + childItem.id + childIndex"\n\t\t\t\t\t\t\t:data-id="childItem.id"\n\t\t\t\t\t\t\tclass="check-list-widget-item check-list-draggable-item"\n\t\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t\t'--dragged_item': childItem.id === draggedCheckListId,\n\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template v-if="childItem.id === draggedCheckListId">\n\t\t\t\t\t\t\t\t<CheckListDropItem :dropOffset="getItemOffset(childItem)"/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t\t\t<CheckListChildItem\n\t\t\t\t\t\t\t\t\t:id="childItem.id"\n\t\t\t\t\t\t\t\t\t:itemOffset="getItemOffset(childItem)"\n\t\t\t\t\t\t\t\t\t:isPreview\n\t\t\t\t\t\t\t\t\t:checkListId\n\t\t\t\t\t\t\t\t\t@update="(id) => $emit('update', id)"\n\t\t\t\t\t\t\t\t\t@addItem="(data) => $emit('addItem', data)"\n\t\t\t\t\t\t\t\t\t@removeItem="(id) => $emit('removeItem', id)"\n\t\t\t\t\t\t\t\t\t@focus="(id) => $emit('focus', id)"\n\t\t\t\t\t\t\t\t\t@blur="(id) => $emit('blur', id)"\n\t\t\t\t\t\t\t\t\t@emptyBlur="(id) => $emit('emptyBlur', id)"\n\t\t\t\t\t\t\t\t\t@toggleGroupModeSelected="(id) => $emit('toggleGroupModeSelected', id)"\n\t\t\t\t\t\t\t\t\t@openCheckList="(id) => $emit('openCheckList', id)"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li\n\t\t\t\t\t\t\tv-if="!isCollapsed(parentItem, parentItemIndex)"\n\t\t\t\t\t\t\t:key="'add-' + parentItem.id + parentItemIndex"\n\t\t\t\t\t\t\tdata-id="add-item"\n\t\t\t\t\t\t\t:data-parent-id="parentItem.id"\n\t\t\t\t\t\t\tclass="check-list-widget-item check-list-draggable-item"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CheckListAddItem\n\t\t\t\t\t\t\t\tv-if="canAddItem"\n\t\t\t\t\t\t\t\t:isPreview\n\t\t\t\t\t\t\t\t@addItem="$emit('addItemFromBtn', parentItem.id)"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</TransitionGroup>\n\t\t\t\t</li>\n\t\t\t\t<li\n\t\t\t\t\tv-if="isPreview && totalCompletedParents > 0"\n\t\t\t\t\tkey="completed-list"\n\t\t\t\t\tclass="check-list-widget-item --completed-list"\n\t\t\t\t>\n\t\t\t\t\t<CheckListGroupCompletedList :totalCompletedParents @click="showFirstCompletedCheckList"/>\n\t\t\t\t</li>\n\t\t\t</TransitionGroup>\n\t\t</div>\n\t`};const be=Object.freeze({Important:"important",Attachments:"attachments",Movement:"movement",Accomplice:"accomplice",Auditor:"auditor",Forward:"forward",Delete:"delete",Cancel:"cancel"});const Le=Object.freeze({SetImportant:"setImportant",AttachFile:"attachFile",MoveRight:"moveRight",MoveLeft:"moveLeft",AssignAccomplice:"assignAccomplice",AssignAuditor:"assignAuditor",Forward:"forward",Delete:"delete",Cancel:"cancel"});const ge=Object.freeze({defaultSections:[{name:be.Important,items:[{icon:S.Outline.FIRE,activeIcon:S.Outline.FIRE_SOLID,action:Le.SetImportant,hint:"TASKS_V2_CHECK_LIST_ITEM_IMPORTANT_HINT",className:"--important",hoverable:false}]},{name:be.Attachments,items:[{icon:S.Outline.ATTACH,action:Le.AttachFile,hint:"TASKS_V2_CHECK_LIST_ITEM_ATTACH_HINT"}]},{name:be.Movement,items:[{icon:S.Outline.POINT_RIGHT,action:Le.MoveRight,hint:"TASKS_V2_CHECK_LIST_ITEM_MOVE_RIGHT_HINT"},{icon:S.Outline.POINT_LEFT,action:Le.MoveLeft,hint:"TASKS_V2_CHECK_LIST_ITEM_MOVE_LEFT_HINT"}]},{name:be.Accomplice,items:[{icon:S.Outline.PERSON,action:Le.AssignAccomplice,hint:"TASKS_V2_CHECK_LIST_ITEM_ACCOMPLICE_HINT"}]},{name:be.Auditor,items:[{icon:S.Outline.OBSERVER,action:Le.AssignAuditor,hint:"TASKS_V2_CHECK_LIST_ITEM_AUDITOR_HINT"}]},{name:be.Forward,items:[{icon:S.Outline.FORWARD,action:Le.Forward,hint:"TASKS_V2_CHECK_LIST_ITEM_FORWARD_HINT"}]},{name:be.Delete,items:[{icon:S.Outline.TRASHCAN,action:Le.Delete,hint:"TASKS_V2_CHECK_LIST_ITEM_REMOVE_HINT"}]},{name:be.Cancel,items:[{icon:S.Outline.CROSS_L,action:Le.Cancel,hint:"TASKS_V2_CHECK_LIST_ITEM_CANCEL_HINT"}]}].filter(Boolean)});const ke={name:"CheckListItemPanel",components:{BIcon:S.BIcon},directives:{hint:f.hint},inject:{task:{},taskId:{},isEdit:{}},props:{currentItem:{type:Object,default:()=>null}},emits:["action"],setup(){},data(){return{currentHintElement:null,currentHintText:""}},computed:{checkLists(){return this.$store.getters[`${M.Model.CheckList}/getByIds`](this.task.checklist)},isStakeholdersRestricted(){return!b.Core.getParams().restrictions.stakeholder.available},sections(){return ge.defaultSections.filter((t=>this.visibleSections.includes(t.name)&&this.canShowPanelSection(t.name))).map((t=>({...t,items:t.items.filter((t=>this.visibleActions.includes(t.action))).map((t=>{var e;return{...t,disabled:this.isItemDisabled(t),active:this.isItemActive(t),hoverable:(e=t.hoverable)!=null?e:true}}))}))).filter((t=>t.items.length>0))},tooltip(){return()=>{var t,e;return{text:this.currentHintText,timeout:500,popupOptions:{className:"tasks-hint",background:"var(--ui-color-bg-content-inapp)",darkMode:false,offsetLeft:-((t=(e=this.currentHintElement)==null?void 0:e.offsetWidth)!=null?t:0),padding:6,bindOptions:{forceBindPosition:true,forceTop:true,position:"top"},targetContainer:document.body}}}},visibleSections(){return ge.defaultSections.map((t=>t.name))},visibleActions(){if(!this.currentItem){return[]}let t=[Le.SetImportant,Le.MoveRight,Le.MoveLeft,Le.AssignAccomplice,Le.AssignAuditor,Le.Forward,Le.Delete];if(this.itemGroupModeSelected){t.push(Le.Cancel)}else{t.push(Le.AttachFile)}if(this.currentItem.parentId===0){t=[Le.AssignAccomplice,Le.AssignAuditor]}const e=new Set([Le.AssignAccomplice,Le.AssignAuditor]);return t.filter((t=>{const s=e.has(t)&&this.isStakeholdersRestricted;return!s}))},disabledActions(){if(!this.currentItem){return[]}const t=[];const e=this.checkListManager.getItemLevel(this.currentItem);const s=this.currentItem.actions.modify===true;const i=this.currentItem.actions.remove===true;const n={[Le.SetImportant]:()=>s===false,[Le.AttachFile]:()=>s===false,[Le.MoveLeft]:()=>e===1||s===false,[Le.MoveRight]:()=>e===5||this.currentItem.sortIndex===0||s===false,[Le.AssignAccomplice]:()=>s===false||this.canChangeAccomplices===false,[Le.AssignAuditor]:()=>s===false||this.canAuditorsAdd===false,[Le.Forward]:()=>s===false||this.currentItem.title===""||!this.canCheckListAdd,[Le.Delete]:()=>i===false};Object.entries(n).forEach((([e,s])=>{if(s()){t.push(e)}}));return t},activeActions(){if(!this.currentItem){return[]}const t=[];if(this.currentItem.isImportant){t.push(Le.SetImportant)}return t},itemGroupModeSelected(){var t;if(!this.currentItem){return false}return((t=this.currentItem.groupMode)==null?void 0:t.selected)===true},canCheckListAdd(){if(!this.isEdit){return true}return this.task.rights.checklistAdd},canAuditorsAdd(){if(!this.isEdit){return true}return this.task.rights.addAuditors},canChangeAccomplices(){if(!this.isEdit){return true}return this.task.rights.changeAccomplices}},created(){this.checkListManager=new W({computed:{checkLists:()=>this.checkLists}})},methods:{isItemDisabled(t){var e;return(e=t.disabled)!=null?e:this.disabledActions.includes(t.action)},isItemActive(t){var e;return(e=t.active)!=null?e:this.activeActions.includes(t.action)},getItemIcon(t){return t.active&&t.activeIcon?t.activeIcon:t.icon},handleItemClick(t,e){if(!e.disabled){this.$emit("action",{action:e.action,node:t.currentTarget})}},handleItemMouseEnter(t,e){this.currentHintElement=t.currentTarget;this.currentHintText=e.hint?this.loc(e.hint):null},canShowPanelSection(t){return!(t===be.Attachments&&!b.Core.getParams().features.disk)}},template:`\n\t\t<div v-if="sections.length > 0" class="check-list-widget-item-panel" @mousedown.prevent>\n\t\t\t<template v-for="section in sections" :key="section.name">\n\t\t\t\t<div class="check-list-widget-item-panel-section" :class="'--' + section.name">\n\t\t\t\t\t<template v-for="item in section.items" :key="item.action" >\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-hint="tooltip"\n\t\t\t\t\t\t\tclass="check-list-widget-item-panel-section-item"\n\t\t\t\t\t\t\t:class="{\n\t\t\t\t\t\t\t\t'--disabled': item.disabled,\n\t\t\t\t\t\t\t\t'--active': item.active,\n\t\t\t\t\t\t\t\t[item.className]: Boolean(item.className),\n\t\t\t\t\t\t\t}"\n\t\t\t\t\t\t\t@click="handleItemClick($event, item)"\n\t\t\t\t\t\t\t@mouseenter="handleItemMouseEnter($event, item)"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon :name="getItemIcon(item)" :hoverable="item.hoverable"/>\n\t\t\t\t\t\t\t<span v-if="item.label">{{ loc(item.label) }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};var Ce=babelHelpers.classPrivateFieldLooseKey("interval");var Pe=babelHelpers.classPrivateFieldLooseKey("timerValue");var Fe=babelHelpers.classPrivateFieldLooseKey("counter");var Se=babelHelpers.classPrivateFieldLooseKey("content");var Be=babelHelpers.classPrivateFieldLooseKey("balloonWithTimer");var we=babelHelpers.classPrivateFieldLooseKey("startTimer");var Me=babelHelpers.classPrivateFieldLooseKey("handleCancelClick");var ye=babelHelpers.classPrivateFieldLooseKey("handleClosingBalloon");var Te=babelHelpers.classPrivateFieldLooseKey("getBalloonContent");class Ee extends C.EventEmitter{constructor(t){super();Object.defineProperty(this,Te,{value:Oe});Object.defineProperty(this,ye,{value:_e});Object.defineProperty(this,Me,{value:Ae});Object.defineProperty(this,we,{value:He});Object.defineProperty(this,Ce,{writable:true,value:null});Object.defineProperty(this,Pe,{writable:true,value:5});Object.defineProperty(this,Fe,{writable:true,value:5});Object.defineProperty(this,Se,{writable:true,value:""});Object.defineProperty(this,Be,{writable:true,value:void 0});this.setEventNamespace("Tasks.V2.CheckList.CheckListNotifier");babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]=t.content;babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=k.Type.isUndefined(t.timerValue)?babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]:t.timerValue}showBalloonWithTimer(){babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe];const t=`check-list-balloon-${k.Text.getRandom()}`;babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]=g.UI.Notification.Center.notify({id:t,content:babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](),actions:[{title:k.Loc.getMessage("TASKS_V2_CHECK_LIST_BALLOON_CANCEL"),events:{mouseup:babelHelpers.classPrivateFieldLooseBase(this,Me)[Me].bind(this)}}]});const e=s=>{const i=s.getTarget();if(i.getId()===t){babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]();C.EventEmitter.unsubscribe("UI.Notification.Balloon:onClose",e)}};C.EventEmitter.subscribe("UI.Notification.Balloon:onClose",e);babelHelpers.classPrivateFieldLooseBase(this,we)[we]()}stopTimer(){babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].close()}}function He(){babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]=setInterval((()=>{babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]--;babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].update({content:babelHelpers.classPrivateFieldLooseBase(this,Te)[Te]()});if(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]<=0){this.stopTimer()}}),1e3)}function Ae(){this.emit("complete",false);babelHelpers.classPrivateFieldLooseBase(this,Be)[Be].close()}function _e(){clearInterval(babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]);this.emit("complete",true)}function Oe(){return babelHelpers.classPrivateFieldLooseBase(this,Se)[Se].replace("#countdown#",babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe])}const $e={name:"TaskCheckList",components:{CheckListWidget:fe,CheckListItemPanel:ke,CheckListStub:A,UiButton:s.Button,BIcon:S.BIcon,BMenu:r.BMenu},provide(){return{setItemsRef:this.setItemsRef,getItemsRef:this.getItemsRef}},inject:{task:{},taskId:{},isEdit:{}},props:{isAutonomous:{type:Boolean,default:false},isPreview:{type:Boolean,default:false},isComponentShown:{type:Boolean,default:true},checkListId:{type:[Number,String],default:0},isShown:{type:Boolean,default:false},sheetBindProps:{type:Object,default:null}},emits:["show","close","resize","open"],setup(){return{resizeObserver:null,AirButtonStyle:s.AirButtonStyle,ButtonSize:s.ButtonSize,ButtonIcon:s.ButtonIcon,Outline:S.Outline,checkListMeta:H}},data(){return{itemPanelIsShown:false,checkListWasUpdated:false,lastUpdatedCheckListId:0,itemId:null,itemPanelStyles:{top:"0",display:"flex"},isItemPanelFreeze:false,itemPanelTopOffset:this.isAutonomous?5:2,itemPanelTopLimit:this.isAutonomous?450:700,itemsRefs:{},isForwardMenuShown:false,forwardMenuSectionCode:"createSection",forwardBindElement:null,shownPopups:new Set,notifiers:new Map,isFreeze:false,closing:false}},computed:{...c.mapGetters({currentUserId:`${M.Model.Interface}/currentUserId`,deletingCheckListIds:`${M.Model.Interface}/deletingCheckListIds`,checkListCompletionCallback:`${M.Model.Interface}/checkListCompletionCallback`,draggedCheckListId:`${M.Model.Interface}/draggedCheckListId`}),componentName(){return{[at.Sheet]:O,[at.Popup]:_,[at.Preview]:nt}[this.context]},context(){return{[true]:at.Sheet,[this.isAutonomous]:at.Popup,[this.isPreview]:at.Preview}.true},contextClass(){return`--${this.context}`},componentShown(){if(this.isPreview){return this.isComponentShown}return true},checkLists(){if(!this.task){return[]}return this.$store.getters[`${M.Model.CheckList}/getByIds`](this.task.checklist)},parentCheckLists(){return this.checkLists.filter((t=>t.parentId===0))},hasFewParentCheckLists(){return this.parentCheckLists.length>1},currentItem(){return this.$store.getters[`${M.Model.CheckList}/getById`](this.itemId)},itemGroupModeSelected(){var t;if(!this.currentItem){return false}return((t=this.currentItem.groupMode)==null?void 0:t.selected)===true},forwardMenuOptions(){return{id:`check-list-item-forward-menu-${this.currentItem.id}`,bindElement:this.forwardBindElement,maxWidth:400,maxHeight:300,offsetLeft:-110,sections:[{code:this.forwardMenuSectionCode}],items:this.forwardMenuItems,targetContainer:document.body}},forwardMenuItems(){const t=this.parentCheckLists.filter((t=>t.id!==this.currentItem.parentId)).map((t=>({title:t.title,dataset:{id:`ForwardMenuCheckList-${t.id}`},onClick:()=>{this.hideItemPanel();if(this.itemGroupModeSelected){void this.forwardGroupItemsToChecklist(this.currentItem.id,t.id)}else{this.forwardToChecklist(this.currentItem.id,t.id)}}})));return[...t,{sectionCode:this.forwardMenuSectionCode,title:this.loc("TASKS_V2_CHECK_LIST_ITEM_FORWARD_MENU_CREATE"),dataset:{id:`ForwardMenuCreateNew-${this.currentItem.id}`},onClick:this.forwardToNewChecklist.bind(this,this.currentItem.id)}]},stub(){return this.checkLists.length===0||this.emptyList===true},emptyList(){const t=this.parentCheckLists.filter((t=>!this.deletingCheckListIds[t.id]));return t.length===0},parentItemDragged(){return this.checkListManager.isParentItem(this.draggedCheckListId)},canCheckListAdd(){if(!this.isEdit){return true}return this.task.rights.checklistAdd}},watch:{async titleFieldOffsetHeight(){if(!this.$refs.popupComponent){return}await this.$nextTick();this.resize()},componentShown(t){if(!this.isPreview){return}this.executeCheckListCompletionCallbacks();void this.$nextTick((()=>{if(t){this.subscribeToEvents();if(this.checkListId&&this.checkListManager.getItem(this.checkListId)&&this.$refs.list){this.scrollToCheckList(this.checkListId)}}else{this.unsubscribeFromEvents()}}))},checkListWasUpdated(t){if(!this.currentItem){return}if(t===true){const t=this.checkListManager.getRootParentByChildId(this.currentItem.id);this.lastUpdatedCheckListId=t?t.id:0}},checkListId(t){const e=k.Type.isString(t);if(e){this.checkListWasUpdated=true}}},created(){this.checkListManager=new W({computed:{checkLists:()=>this.checkLists}})},mounted(){if(this.isAutonomous||this.isPreview){this.subscribeToEvents()}},async beforeUnmount(){if(this.isAutonomous||this.isPreview){this.unsubscribeFromEvents()}if(this.isPreview){this.executeCheckListCompletionCallbacks();if(this.isEdit){await P.checkListService.forceSavePending(this.taskId)}}},methods:{...c.mapActions(M.Model.Interface,["addCheckListItemToDeleting","removeCheckListItemFromDeleting","executeCheckListCompletionCallbacks"]),subscribeToEvents(){k.Event.bind(this.$refs.list,"scroll",this.handleScroll);C.EventEmitter.subscribe("BX.Main.Popup:onShow",this.handleShowPopup);C.EventEmitter.subscribe("BX.Main.Popup:onClose",this.handleClosePopup);C.EventEmitter.subscribe("BX.Main.Popup:onDestroy",this.handleClosePopup)},unsubscribeFromEvents(){k.Event.unbind(this.$refs.list,"scroll",this.handleScroll);C.EventEmitter.unsubscribe("BX.Main.Popup:onShow",this.handleShowPopup);C.EventEmitter.unsubscribe("BX.Main.Popup:onClose",this.handleClosePopup);C.EventEmitter.unsubscribe("BX.Main.Popup:onDestroy",this.handleClosePopup)},scrollToCheckList(t){this.checkListManager.scrollToCheckList(this.$refs.list,t)},handleUpdate(t){this.itemId=t;this.handleUpdatingFreezeState();this.checkListWasUpdated=true},handleUpdatingFreezeState(){if(!this.isFreeze&&(this.hasEmptyItem()||this.getItemIdWithUploadingFiles())){this.freeze()}if(this.isFreeze){this.unfreeze()}},handleRemove(t){this.itemId=t;this.freeze();this.addItemToDelete(t);this.checkListManager.hideItems([t],(t=>this.upsertCheckLists(t)));const e=this.currentItem.parentId===0?"TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_PARENT":"TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILD";const s=new Ee({content:this.loc(e)});s.subscribeOnce("complete",(e=>{const s=e.getData();if(s){this.removeItem(t)}else{this.checkListManager.showItems([t],(t=>this.upsertCheckLists(t)))}this.removeItemFromDelete(t);this.unfreeze();this.notifiers.delete(t)}));this.notifiers.set(t,s);s.showBalloonWithTimer();if(this.isCurrentItemEmpty()){s.stopTimer()}},handleScroll(){this.isForwardMenuShown=false;this.updatePanelPosition()},handleShow(t){this.$emit("show",t)},async handleClose(){if(this.closing){return}this.closing=true;this.cleanNotifiers();this.cancelGroupMode();this.cleanCollapsedState();this.executeCheckListCompletionCallbacks();if(this.hasEmptyItem()){const t=this.checkListManager.getFirstEmptyItem();this.focusToItem(t.id,true);this.closing=false;return}const t=this.getItemIdWithUploadingFiles();if(t){this.focusToItem(t,true);this.closing=false;return}this.cleanEmptyItems();const e=this.lastUpdatedCheckListId===0?this.checkListId:this.lastUpdatedCheckListId;this.$emit("close",this.deletingCheckListIds[e]?0:e);await this.saveCheckList();this.closing=false},handleIsShown(t){if(t){this.subscribeToEvents()}else{this.unsubscribeFromEvents()}},handleShowPopup(t){const[e]=t.getCompatData();const s=e.getId().startsWith("bx-vue-hint-");if(s){return}this.shownPopups.add(e);this.freeze()},handleClosePopup(t){const[e]=t.getCompatData();const s=e.getId().startsWith("bx-vue-hint-");if(s){return}this.shownPopups.delete(e);this.unfreeze()},async handleGroupRemove(t){this.itemId=t;this.freeze();this.addItemToDelete(t);this.hideItemPanel(t);const e=this.checkListManager.getAllSelectedItems();const s=this.checkListManager.findNearestItem(this.currentItem,false);if(s){await this.updateCheckList(s.id,{groupMode:{active:true,selected:true}});setTimeout((()=>{this.showItemPanel(s.id)}),0)}const i=e.map((t=>t.id));this.checkListManager.hideItems(i,(t=>this.upsertCheckLists(t)));const n=e.length>1?"TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILDREN":"TASKS_V2_CHECK_LIST_ITEM_REMOVE_BALLOON_CHILD";const a=new Ee({content:this.loc(n)});a.subscribeOnce("complete",(i=>{const n=i.getData();const a=[];e.forEach((t=>{if(n){this.removeItem(t.id)}else{a.push(t.id)}this.removeItemFromDelete(t.id)}));this.checkListManager.showItems(a,(t=>this.upsertCheckLists(t)));if(n){if(s&&!this.deletingCheckListIds[s.id]){this.showItemPanel(s.id)}else{this.cancelGroupMode()}}else{this.showItemPanel(this.currentItem.id)}this.unfreeze();this.notifiers.delete(t)}));this.notifiers.set(t,a);a.showBalloonWithTimer()},handleFocus(t){this.isItemPanelFreeze=false;this.showItemPanel(t)},handleBlur(t){this.itemId=t;if(this.isCurrentItemEmpty()&&this.hasItemFiles(this.currentItem)){return}if(this.isItemPanelFreeze===false){this.hideItemPanel(t)}},handleEmptyBlur(t){this.itemId=t;if(this.currentItem.parentId===0){this.setDefaultCheckListTitle(t);return}if(this.hasItemFiles(this.currentItem)){return}if(this.isItemPanelFreeze===false){this.removeItem(t)}},handleGroupMode(t){this.itemId=t;this.cancelGroupMode();const e=this.checkListManager.getFirstVisibleChild(t);if(!e){return}this.activateGroupMode(t);this.showItemPanel(e.id)},handleGroupModeSelect(t){this.itemId=t;if(this.itemGroupModeSelected){this.showItemPanel(t)}else{this.showItemPanelOnNearestSelectedItem(t)}},handlePanelAction({action:t,node:e}){var s;const i={[Le.SetImportant]:t=>this.setImportant(t),[Le.AttachFile]:t=>this.attachFile(t),[Le.MoveRight]:t=>this.moveGroupToRight(t),[Le.MoveLeft]:t=>this.moveGroupToLeft(t),[Le.AssignAccomplice]:t=>{if(!this.isItemPanelFreeze){this.showParticipantDialog(t,"accomplices")}},[Le.AssignAuditor]:t=>{if(!this.isItemPanelFreeze){this.showParticipantDialog(t,"auditors")}},[Le.Forward]:t=>this.forward(t),[Le.Delete]:t=>this.delete(t),[Le.Cancel]:t=>this.cancelGroupMode(t)};(s=i[t])==null?void 0:s.call(i,e)},handleOpenCheckList(t){this.cleanNotifiers();this.cleanCollapsedState();this.$emit("open",t)},updateCheckList(t,e){return this.$store.dispatch(`${M.Model.CheckList}/update`,{id:t,fields:e})},async updateTask(t){return E.taskService.updateStoreTask(this.taskId,t)},upsertCheckLists(t){return this.$store.dispatch(`${M.Model.CheckList}/upsertMany`,t)},insertCheckList(t){return this.$store.dispatch(`${M.Model.CheckList}/insert`,t)},insertManyCheckLists(t){return this.$store.dispatch(`${M.Model.CheckList}/insertMany`,t)},deleteCheckList(t){return this.$store.dispatch(`${M.Model.CheckList}/delete`,t)},async saveCheckList(){if(!this.isDemoCheckListModified()){this.removeChecklists();this.checkListWasUpdated=false}if(this.checkListWasUpdated&&this.isEdit){const t=new Set(Object.values(this.deletingCheckListIds));const e=this.checkListManager.expandIdsWithChildren(t);const s=this.checkLists.filter((t=>!e.has(t.id)));await P.checkListService.save(this.taskId,s)}this.checkListWasUpdated=false},isDemoCheckListModified(){if(this.getCheckListsNumber()>1){return true}const[t]=this.checkLists;if(!t){return true}const e=this.loc("TASKS_V2_CHECK_LIST_TITLE_NUMBER",{"#number#":1});return t.title!==e||this.checkListManager.getChildren(t.id).length>0||this.hasItemUsers(t)||this.hasItemFiles(t)},removeChecklists(){this.checkLists.filter((t=>t.parentId===0)).forEach((t=>{this.removeItem(t.id)}))},async addCheckList(t=false){const e=k.Text.getRandom();const s=k.Text.getRandom();const i=[...this.task.checklist,e];const n=[this.getDataForNewCheckList(e)];if(!t){n.push({id:s,nodeId:s,parentId:e,parentNodeId:e,sortIndex:0});i.push(s)}await this.insertManyCheckLists(n);void this.updateTask({checklist:i});this.checkListWasUpdated=true;return e},async addFastCheckList(){const t=await this.addCheckList();this.handleOpenCheckList(t)},showForwardMenu(t){this.forwardBindElement=t;this.isForwardMenuShown=true},getCheckListsNumber(){return this.checkLists.filter((t=>t.parentId===0&&!this.deletingCheckListIds[t.id])).length},getDataForNewCheckList(t){return{id:t,nodeId:t,parentId:0,title:this.loc("TASKS_V2_CHECK_LIST_TITLE_NUMBER",{"#number#":this.getCountForNewCheckList()}),sortIndex:this.getSortForNewCheckList()}},getSortForNewCheckList(){return this.getCheckListsNumber()},getCountForNewCheckList(){return this.getCheckListsNumber()+1},setItemsRef(t,e){this.itemsRefs[t]=e},getItemsRef(t){return this.itemsRefs[t]},focusToItem(t,e=false){void this.$nextTick((()=>{var s;const i=this.getItemsRef(t);i==null?void 0:(s=i.$refs.growingTextArea)==null?void 0:s.focusTextarea();if(e){void u.highlighter.highlight(i==null?void 0:i.$refs.item)}}))},addItem({id:t,sort:e}){if(this.hasActiveGroupMode()){return}this.itemId=t;const s=k.Text.getRandom();const i=this.currentItem.parentId;this.resortItemsAfterIndex(i,e);this.insertItem(i,s,e)},addItemFromBtn(t){if(this.hasActiveGroupMode()){return}if(this.isPreview){this.handleOpenCheckList(t)}const e=k.Text.getRandom();const s=this.checkListManager.getChildren(t).length;this.insertItem(t,e,s)},insertItem(t,e,s){const i=t?this.checkListManager.getItem(t):null;void this.insertCheckList({id:e,nodeId:e,parentId:t,parentNodeId:i?i.nodeId:null,sortIndex:s});void this.updateTask({checklist:[...this.task.checklist,e]})},removeItem(t,e=true){if(!this.task){return}const s=this.checkListManager.getItem(t);if(!s){return}const i=this.checkListManager.getChildren(s.id);if(s!=null&&s.title||s.parentId===0){this.checkListWasUpdated=true}if(i.length>0){i.forEach((t=>{this.removeItem(t.id,false)}))}const n=this.task.checklist.filter((t=>t!==s.id));void this.updateTask({containsChecklist:n.length>0,checklist:n});void this.deleteCheckList(s.id);if(e){this.resortItemsOnLevel(s.parentId)}T.fileService.delete(s.id,T.EntityTypes.CheckListItem)},addItemToDelete(t){this.addCheckListItemToDeleting(t)},removeItemFromDelete(t){this.removeCheckListItemFromDeleting(t);if(this.isPreview&&this.isEdit&&k.Type.isNumber(t)){void P.checkListService.delete(this.taskId,t)}},resortItemsAfterIndex(t,e){this.checkListManager.resortItemsAfterIndex(t,e,(t=>{if(t.length>0){void this.upsertCheckLists(t)}}))},resortItemsOnLevel(t){this.checkListManager.resortItemsOnLevel(t,(t=>this.upsertCheckLists(t)))},showItemPanel(t){if(this.isPreview){return}this.itemId=t;this.itemPanelIsShown=true;void this.updateCheckList(t,{panelIsShown:true});void this.$nextTick((()=>this.updatePanelPosition()))},hideItemPanel(t){if(this.isPreview){return}this.itemPanelIsShown=false;if(this.hasActiveGroupMode()&&this.checkListManager.getAllSelectedItems().length===0){this.deactivateGroupMode()}const e=this.checkListManager.getItem(t);if(e){void this.updateCheckList(t,{panelIsShown:false})}this.isItemPanelFreeze=false},showItemPanelOnNearestSelectedItem(t){const e=this.checkListManager.findNearestItem(this.currentItem,true);if(e){this.showItemPanel(e.id)}else{this.hideItemPanel(t)}},updatePanelPosition(){if(this.itemPanelIsShown===false){return}const t=this.$refs.list.querySelector([`[data-id="${this.currentItem.id}"]`]);const e=k.Dom.getPosition(this.$refs.panel.$el);const s=k.Dom.getPosition(this.$refs.list);const i=k.Dom.getRelativePosition(t,this.$refs.list);const n=this.currentItem.parentId===0;const a=18;const r=e.width===0?304:e.width;const l=i.top-28;const o=n?-30:40;const c=l>o&&l<this.itemPanelTopLimit;const d=n?0:70;const h=l>d&&l<this.itemPanelTopLimit;if(!h){this.shownPopups.forEach((t=>{t.close()}))}const p=c?"flex":"none";if(n){const t=s.width-r-a*2-80;this.itemPanelStyles={top:`${l}px`,left:`${t}px`,display:p}}else{const t=s.width-r-a;this.itemPanelStyles={top:`${l}px`,left:`${t}px`,display:p}}},setImportant(){if(this.itemGroupModeSelected){const t=this.checkListManager.getAllSelectedItems().map((t=>({...t,isImportant:!t.isImportant})));void this.upsertCheckLists(t)}else{void this.updateCheckList(this.currentItem.id,{isImportant:!this.currentItem.isImportant})}this.checkListWasUpdated=true},attachFile(t){var e;(e=this.fileServiceInstances)!=null?e:this.fileServiceInstances=new Map;const s=this.getCurrentFileService();this.fileServiceInstances.set(this.currentItem.id,s);const i=t=>{if(t){this.freeze()}else{this.unfreeze()}};i(true);s.browse({bindElement:t,onShowCallback:()=>{this.isItemPanelFreeze=true},onHideCallback:()=>{this.isItemPanelFreeze=false}});s.subscribe("onFileAdd",(()=>{i(true)}));s.subscribe("onFileComplete",(()=>{this.isItemPanelFreeze=s.isUploading();i(this.isItemPanelFreeze||this.hasEmptyItem());this.focusToItem(this.currentItem.id);this.checkListWasUpdated=true}))},getCurrentFileService(){if(!this.currentItem){return null}return T.fileService.get(this.currentItem.id,T.EntityTypes.CheckListItem,{parentEntityId:this.taskId})},hasItemFiles(t){if(!t){return false}const e=this.getCurrentFileService();const s=t.attachments;return s.length>0||(e==null?void 0:e.isUploading())||(e==null?void 0:e.hasUploadingError())},hasItemUsers(t){return t.accomplices.length>0||t.auditors.length>0},getItemIdWithUploadingFiles(){var t;if(!this.fileServiceInstances){return null}return(t=[...this.fileServiceInstances.values()].find((t=>t.isUploading())))==null?void 0:t.getEntityId()},isCurrentItemEmpty(){if(!this.currentItem){return true}return this.currentItem.title===""},moveGroupToRight(){if(this.itemGroupModeSelected){this.checkListManager.getAllSelectedItems().sort(((t,e)=>t.sortIndex-e.sortIndex)).forEach((t=>{this.moveRight(t)}))}else{this.moveRight(this.currentItem)}},moveRight(t){this.checkListManager.moveRight(t,(e=>{var s;void this.upsertCheckLists(e);this.checkListWasUpdated=true;if(!((s=t.groupMode)!=null&&s.active)){this.focusToItem(t.id)}}))},moveGroupToLeft(){if(this.itemGroupModeSelected){this.checkListManager.getAllSelectedItems().sort(((t,e)=>e.sortIndex-t.sortIndex)).forEach((t=>{this.moveLeft(t)}))}else{this.moveLeft(this.currentItem)}},moveLeft(t){this.checkListManager.moveLeft(t,(e=>{var s;void this.upsertCheckLists(e);this.checkListWasUpdated=true;if(!((s=t.groupMode)!=null&&s.active)){this.focusToItem(t.id)}}))},async forward(t){if(this.hasFewParentCheckLists){this.showForwardMenu(t)}else{this.hideItemPanel();void this.forwardToNewChecklist(this.currentItem.id)}this.checkListWasUpdated=true},async forwardToNewChecklist(t){const e=await this.addCheckList(true);if(this.itemGroupModeSelected){void this.forwardGroupItemsToChecklist(t,e)}else{this.forwardToChecklist(t,e)}},forwardToChecklist(t,e){const s=this.checkListManager.getChildren(e).length;const i=this.checkListManager.getItem(t);void this.updateCheckList(i.id,{parentId:e,sortIndex:s});this.resortItemsOnLevel(e);this.resortItemsOnLevel(i.parentId);this.handleTargetParentFilter(i)},async forwardGroupItemsToChecklist(t,e){const s=this.checkListManager.getChildren(e).length;const i=this.checkListManager.getItem(t);const n=new Set;const a=this.checkListManager.getAllSelectedItems();const r=this.checkListManager.findNearestItem(i,false,a);if(r){this.showItemPanel(r.id)}else{this.cancelGroupMode()}const l=this.checkListManager.getAllSelectedItemsWithChildren();const o=new Set(a.map((t=>t.id)));const c=[];a.forEach((t=>{const i=!o.has(t.parentId);n.add(t.parentId);c.push({...t,parentId:i?e:t.parentId,groupMode:{active:false,selected:false},sortIndex:i?s:t.sortIndex})}));l.forEach((t=>{if(!o.has(t.id)){c.push({...t,groupMode:{active:false,selected:false}})}}));await this.upsertCheckLists(c);if(r){void this.updateCheckList(r.id,{groupMode:{active:true,selected:true}})}this.resortItemsOnLevel(e);n.forEach((t=>{this.resortItemsOnLevel(t)}));l.forEach((t=>{this.handleTargetParentFilter(t)}))},handleTargetParentFilter(t){this.checkListManager.handleTargetParentFilter(t,this.currentUserId,(t=>{setTimeout((()=>{void this.upsertCheckLists(t)}),1e3)}))},delete(){if(this.itemGroupModeSelected){void this.handleGroupRemove(this.currentItem.id)}else{this.hideItemPanel();this.handleRemove(this.currentItem.id)}},cancelGroupMode(){this.deactivateGroupMode();this.hideItemPanel()},cleanCollapsedState(){const t=this.parentCheckLists.map((t=>({...t,localCollapsedState:null})));void this.upsertCheckLists(t)},cleanEmptyItems(){this.checkListManager.getEmptiesItem().forEach((t=>{this.removeItem(t.id)}))},showParticipantDialog(t,s){const i=this.currentItem[s].map((t=>t.id));const n=this.currentItem.id;const a=t=>{this.saveParticipants(n,s,t);this.isItemPanelFreeze=false;if(!this.itemGroupModeSelected&&this.currentItem.id===n){this.focusToItem(n)}this.updatePanelPosition()};void e.usersDialog.show({targetNode:t,ids:i,withAngle:true,onClose:a});this.isItemPanelFreeze=true},async saveParticipants(t,e,s){const i=this.$store.getters[`${M.Model.Users}/getByIds`](s);if(this.itemGroupModeSelected){const t=this.checkListManager.getAllSelectedItems().map((t=>({...t,[e]:i})));void this.upsertCheckLists(t)}else{void this.updateCheckList(t,{[e]:i})}const n=E.taskService.getStoreTask(this.taskId);const a=n[`${e}Ids`];const r=[...new Set([...a,...s])];const l={[`${e}Ids`]:r};void this.updateTask(l);this.checkListWasUpdated=true},activateGroupMode(t){this.itemId=t;const e=this.checkListManager.getAllChildren(t).filter((t=>!t.hidden));const s=e.map(((t,e)=>({...t,groupMode:{active:true,selected:e===0}})));s.push({...this.currentItem,groupMode:{active:true,selected:false}});void this.upsertCheckLists(s)},deactivateGroupMode(){const t=this.checkListManager.getAllGroupModeItems().map((t=>({...t,groupMode:{active:false,selected:false}})));void this.upsertCheckLists(t)},hasActiveGroupMode(){return this.checkListManager.getAllGroupModeItems().length>0},freeze(){var t,e,s;this.isFreeze=true;(t=this.$refs.childComponent)==null?void 0:(e=t.$refs)==null?void 0:(s=e.childComponent)==null?void 0:s.freeze()},unfreeze(){var t,e,s;if(this.hasEmptyItem()||this.getItemIdWithUploadingFiles()){return}this.isFreeze=false;(t=this.$refs.childComponent)==null?void 0:(e=t.$refs)==null?void 0:(s=e.childComponent)==null?void 0:s.unfreeze()},hasEmptyItem(){return this.checkListManager.hasEmptyItemWithFiles(this.hasItemFiles)||this.checkListManager.hasEmptyParentItem()},setDefaultCheckListTitle(t){void this.updateCheckList(t,{title:this.loc("TASKS_V2_CHECK_LIST_TITLE_NUMBER",{"#number#":this.getCheckListsNumber()})})},cleanNotifiers(){this.notifiers.forEach((t=>t.stopTimer()));this.notifiers.clear()}},template:`\n\t\t<component\n\t\t\tv-if="componentShown"\n\t\t\tref="childComponent"\n\t\t\t:is="componentName"\n\t\t\t:isShown\n\t\t\t:sheetBindProps\n\t\t\t:isEmpty="emptyList"\n\t\t\t@show="handleShow"\n\t\t\t@close="handleClose"\n\t\t\t@isShown="handleIsShown"\n\t\t\t@addFastCheckList="addFastCheckList"\n\t\t\t@resize="$emit('resize')"\n\t\t>\n\t\t\t<template v-slot:default="{ handleShow, handleClose }">\n\t\t\t\t<div\n\t\t\t\t\tref="wrapper"\n\t\t\t\t\tclass="tasks-check-list-wrapper"\n\t\t\t\t\t:class="contextClass"\n\t\t\t\t\tdata-field-container\n\t\t\t\t\t:data-task-field-id="checkListMeta.id"\n\t\t\t\t>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="!isPreview && !parentItemDragged"\n\t\t\t\t\t\tclass="tasks-check-list-close-icon"\n\t\t\t\t\t\t:class="contextClass"\n\t\t\t\t\t>\n\t\t\t\t\t\t<BIcon :name="Outline.CROSS_L" @click="$emit('close')"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div ref="list" data-list class="tasks-check-list-content" :class="contextClass">\n\t\t\t\t\t\t<CheckListWidget\n\t\t\t\t\t\t\tv-show="!stub"\n\t\t\t\t\t\t\t:context\n\t\t\t\t\t\t\t:checkListId\n\t\t\t\t\t\t\t:isPreview\n\t\t\t\t\t\t\t@update="handleUpdate"\n\t\t\t\t\t\t\t@show="handleShow"\n\t\t\t\t\t\t\t@addItem="addItem"\n\t\t\t\t\t\t\t@addItemFromBtn="addItemFromBtn"\n\t\t\t\t\t\t\t@removeItem="handleRemove"\n\t\t\t\t\t\t\t@focus="handleFocus"\n\t\t\t\t\t\t\t@blur="handleBlur"\n\t\t\t\t\t\t\t@emptyBlur="handleEmptyBlur"\n\t\t\t\t\t\t\t@startGroupMode="handleGroupMode"\n\t\t\t\t\t\t\t@toggleGroupModeSelected="handleGroupModeSelect"\n\t\t\t\t\t\t\t@openCheckList="handleOpenCheckList"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<CheckListStub v-if="stub && !isPreview" @click="addCheckList"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-show="!stub && !isPreview" class="tasks-check-list-footer" :class="contextClass">\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\tv-if="canCheckListAdd"\n\t\t\t\t\t\t\t:text="loc('TASKS_V2_CHECK_LIST_NEW_BTN')"\n\t\t\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t\t\t:leftIcon="ButtonIcon.ADD"\n\t\t\t\t\t\t\t:style="AirButtonStyle.PLAIN_NO_ACCENT"\n\t\t\t\t\t\t\t@click="addCheckList"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text="loc('TASKS_V2_CHECK_LIST_SAVE_BTN')"\n\t\t\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t\t\t@click="$emit('close')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<CheckListItemPanel\n\t\t\t\t\t\tv-if="itemPanelIsShown && !isPreview"\n\t\t\t\t\t\tref="panel"\n\t\t\t\t\t\t:currentItem\n\t\t\t\t\t\t:style="itemPanelStyles"\n\t\t\t\t\t\t@action="handlePanelAction"\n\t\t\t\t\t/>\n\t\t\t\t\t<BMenu\n\t\t\t\t\t\tv-if="isForwardMenuShown"\n\t\t\t\t\t\t:options="forwardMenuOptions"\n\t\t\t\t\t\t@close="isForwardMenuShown = false"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</component>\n\t`};const xe={components:{Chip:F.Chip},inject:{task:{},taskId:{},isEdit:{}},props:{isAutonomous:{type:Boolean,default:false}},emits:["showCheckList"],setup(){return{checkListMeta:H}},computed:{checkLists(){return this.$store.getters[`${M.Model.CheckList}/getByIds`](this.task.checklist)},isUploading(){var t;return(t=this.task.checklist)==null?void 0:t.some((t=>T.fileService.get(t,T.EntityTypes.CheckListItem,{parentEntityId:this.taskId}).isUploading()))},design(){return{[!this.isAutonomous&&!this.isSelected]:F.ChipDesign.ShadowNoAccent,[!this.isAutonomous&&this.isSelected]:F.ChipDesign.ShadowAccent,[this.isAutonomous&&!this.isSelected]:F.ChipDesign.OutlineNoAccent,[this.isAutonomous&&this.isSelected]:F.ChipDesign.OutlineAccent}.true},isSelected(){if(this.isAutonomous){return this.checkLists.length>0}return this.wasFilled||this.checkLists.length>0},wasFilled(){return this.task.filledFields[H.id]},checkListItemCount(){return this.checkLists.filter((t=>t.parentId!==0)).length},text(){if(this.isAutonomous&&this.checkListItemCount>0){const t=this.getCompletedCount();return this.loc("TASKS_V2_CHECK_LIST_COUNT_TITLE",{"#count#":t,"#total#":this.checkListItemCount})}return this.loc("TASKS_V2_CHECK_LIST_CHIP_TITLE")},icon(){if(this.isUploading&&!this.wasFilled){return S.Animated.LOADER_WAIT}return S.Outline.CHECK_LIST}},created(){this.checkListManager=new W({computed:{checkLists:()=>this.checkLists}})},mounted(){this.$bitrix.eventEmitter.subscribe(M.EventName.AiAddCheckList,this.handleAiAdd);this.$bitrix.eventEmitter.subscribe(M.EventName.CloseCheckList,this.handleFieldClose)},beforeUnmount(){this.$bitrix.eventEmitter.unsubscribe(M.EventName.AiAddCheckList,this.handleAiAdd);this.$bitrix.eventEmitter.unsubscribe(M.EventName.CloseCheckList,this.handleFieldClose)},methods:{handleClick(){if(this.isAutonomous){void this.showCheckList()}else{if(this.isSelected){void this.highlightField()}else{void this.showCheckList()}}},async handleAiAdd(t){const e=await this.buildAiCheckList(t.getData());await this.highlightField();this.checkListManager.scrollToCheckList(this.$root.$el,e,"smooth");if(this.isEdit){void P.checkListService.save(this.taskId,this.checkLists)}},handleFieldClose(){if(this.isAutonomous){this.$el.focus()}},async showCheckList(){if(!this.isSelected){await this.buildEmptyCheckList()}this.$emit("showCheckList")},async buildEmptyCheckList(){const t=k.Text.getRandom();const e=k.Text.getRandom();await this.$store.dispatch(`${M.Model.CheckList}/insertMany`,[{id:t,nodeId:t,title:this.loc("TASKS_V2_CHECK_LIST_TITLE_NUMBER",{"#number#":1})},{id:e,nodeId:e,parentId:t}]);await E.taskService.updateStoreTask(this.taskId,{checklist:[t,e]})},async buildAiCheckList(t){if(!k.Type.isString(t)||t===""){return""}const e=t.split(/\r\n|\r|\n/g).map((t=>t.trim())).filter((t=>t!==""));if(e.length===0){return""}const s=[];const i=k.Text.getRandom();const n=this.getCheckListsNumber();const a=[...this.task.checklist,i];s.push({id:i,nodeId:i,parentId:0,title:this.loc("TASKS_V2_CHECK_LIST_TITLE_NUMBER",{"#number#":n+1}),sortIndex:n});e.forEach(((t,e)=>{const n=k.Text.getRandom();s.push({id:n,nodeId:n,parentId:i,title:t,sortIndex:e});a.push(n)}));await this.$store.dispatch(`${M.Model.CheckList}/insertMany`,s);await E.taskService.updateStoreTask(this.taskId,{checklist:a});return i},highlightField(){return y.fieldHighlighter.setContainer(this.$root.$el).highlight(H.id)},getCheckListsNumber(){return this.checkLists.filter((t=>t.parentId===0)).length},getCompletedCount(){return this.checkLists.filter((t=>t.isComplete&&t.parentId!==0)).length}},template:`\n\t\t<Chip\n\t\t\t:design\n\t\t\t:icon\n\t\t\t:text\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="checkListMeta.id"\n\t\t\t@click="handleClick"\n\t\t/>\n\t`};t.CheckList=$e;t.CheckListChip=xe;t.CheckListList=nt;t.checkListMeta=H})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.Tasks.V2.Lib,BX.Vue3.Components,BX.UI.Vue3.Components,BX.Tasks.V2.Component.Elements,BX.UI.DragAndDrop,BX.UI.Vue3.Components,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Vue3.Vuex,BX.UI.System.Skeleton.Vue,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX,BX.Vue3.Directives,BX.Tasks.V2,BX.Tasks.V2.Component.Elements,BX,BX,BX.Event,BX.Tasks.V2.Provider.Service,BX.UI.System.Chip.Vue,BX.UI.IconSet,BX,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=check-list.bundle.map.js