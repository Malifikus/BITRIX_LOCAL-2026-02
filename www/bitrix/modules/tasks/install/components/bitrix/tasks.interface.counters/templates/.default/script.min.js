this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};(function(e,t,r,n,i,s,o){"use strict";var a=function(){function e(t){babelHelpers.classCallCheck(this,e);this.filterId=t.filterId;this.filterManager=BX.Main.filterManager.getById(this.filterId);this.bindEvents();this.updateFields()}babelHelpers.createClass(e,[{key:"bindEvents",value:function e(){i.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this))}},{key:"onFilterApply",value:function e(){this.updateFields()}},{key:"updateFields",value:function e(){this.fields=this.filterManager.getFilterFieldsValues()}},{key:"isFilteredByField",value:function e(t){if(!Object.keys(this.fields).includes(t)){return false}if(n.Type.isArray(this.fields[t])){return this.fields[t].length>0}return this.fields[t]!==""}},{key:"isFilteredByFieldValue",value:function e(t,r){return this.isFilteredByField(t)&&this.fields[t]===r}},{key:"toggleByField",value:function e(t){var r=this;var n=t.filterField;var i=t.filterValue;if(!this.isFilteredByFieldValue(n,i)){this.filterManager.getApi().extendFilter(babelHelpers.defineProperty({},n,i),false,{COUNTER_TYPE:"TASKS_COUNTER_TYPE_"+i});return}this.filterManager.getFilterFields().forEach((function(e){if(e.getAttribute("data-name")===n){r.filterManager.getFields().deleteField(e)}}));this.filterManager.getSearch().apply()}},{key:"getFilter",value:function e(){return this.filterManager}}]);return e}();function l(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */l=function t(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function e(t,r,n){return t[r]=n}}function c(e,t,r,i){var s=t&&t.prototype instanceof d?t:d,o=Object.create(s.prototype),a=new k(i||[]);return n(o,"_invoke",{value:T(e,r,a)}),o}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var f={};function d(){}function p(){}function m(){}var v={};u(v,s,(function(){return this}));var y=Object.getPrototypeOf,_=y&&y(y(w([])));_&&_!==t&&r.call(_,s)&&(v=_);var b=m.prototype=d.prototype=Object.create(v);function g(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function i(n,s,o,a){var l=h(e[n],e,s);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==babelHelpers["typeof"](c)&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){i("next",e,o,a)}),(function(e){i("throw",e,o,a)})):t.resolve(c).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,a)}))}a(l.arg)}var s;n(this,"_invoke",{value:function e(r,n){function o(){return new t((function(e,t){i(r,n,e,t)}))}return s=s?s.then(o,o):o()}})}function T(e,t,r){var n="suspendedStart";return function(i,s){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw s;return S()}for(r.method=i,r.arg=s;;){var o=r.delegate;if(o){var a=C(o,r);if(a){if(a===f)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var l=h(e,t,r);if("normal"===l.type){if(n=r.done?"completed":"suspendedYield",l.arg===f)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n="completed",r.method="throw",r.arg=l.arg)}}}function C(e,t){var r=t.method,n=e.iterator[r];if(undefined===n)return t.delegate=null,"throw"===r&&e.iterator["return"]&&(t.method="return",t.arg=undefined,C(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var i=h(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,f;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,f):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function w(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=undefined,t.done=!0,t};return i.next=i}}return{next:S}}function S(){return{value:undefined,done:!0}}return p.prototype=m,n(b,"constructor",{value:m,configurable:!0}),n(m,"constructor",{value:p,configurable:!0}),p.displayName=u(m,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,a,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},g(E.prototype),u(E.prototype,o,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(t,r,n,i),s);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},g(b),u(b,a,"Generator"),u(b,s,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=w,k.prototype={constructor:k,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(L),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var n=this;function i(e,r){return a.type="throw",a.arg=t,n.next=e,r&&(n.method="next",n.arg=undefined),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function e(t,n){for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i];if(s.tryLoc<=this.prev&&r.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var o=s;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=n&&n<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=n,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function e(t,r){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&r&&(this.next=r),f},finish:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),L(n),f}},catch:function e(t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var s=i.arg;L(n)}return s}}throw new Error("illegal catch attempt")},delegateYield:function e(t,r,n){return this.delegate={iterator:w(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=undefined),f}},e}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){babelHelpers.defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t){d(e,t);t.add(e)}function f(e,t,r){d(e,t);t.set(e,r)}function d(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function p(e,t,r){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return r}var m=new WeakMap;var v=new WeakSet;var y=new WeakSet;var _=new WeakSet;var b=new WeakSet;var g=new WeakSet;var E=new WeakSet;var T=new WeakSet;var C=new WeakSet;var I=new WeakSet;var L=new WeakSet;var k=new WeakSet;var w=new WeakSet;var S=new WeakSet;var O=function(e){babelHelpers.inherits(r,e);babelHelpers.createClass(r,null,[{key:"counterTypes",get:function e(){return{my:["expired","my_expired","originator_expired","accomplices_expired","auditor_expired","new_comments","my_new_comments","originator_new_comments","accomplices_new_comments","auditor_new_comments","projects_total_expired","projects_total_comments","sonet_total_expired","sonet_total_comments","groups_total_expired","groups_total_comments","scrum_total_comments","flow_total_expired","flow_total_comments"],other:["project_expired","project_comments","projects_foreign_expired","projects_foreign_comments","groups_foreign_expired","groups_foreign_comments","sonet_foreign_expired","sonet_foreign_comments","scrum_foreign_comments"],additional:["muted_new_comments"],expired:["expired","my_expired","originator_expired","accomplices_expired","auditor_expired","project_expired","projects_total_expired","projects_foreign_expired","groups_total_expired","groups_foreign_expired","sonet_total_expired","sonet_foreign_expired","flow_total_expired"],comment:["new_comments","my_new_comments","originator_new_comments","accomplices_new_comments","auditor_new_comments","muted_new_comments","project_comments","projects_total_comments","projects_foreign_comments","groups_total_comments","groups_foreign_comments","sonet_total_comments","sonet_foreign_comments","scrum_total_comments","scrum_foreign_comments","flow_total_comments","new_comments_total"],project:["project_expired","projects_total_expired","projects_foreign_expired","groups_total_expired","groups_foreign_expired","sonet_total_expired","sonet_foreign_expired","project_comments","projects_total_comments","projects_foreign_comments","groups_total_comments","groups_foreign_comments","sonet_total_comments","sonet_foreign_comments"],scrum:["scrum_total_comments","scrum_foreign_comments"]}}}]);function r(e){var t;babelHelpers.classCallCheck(this,r);t=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(r).call(this,{target:e.renderTo,items:[],multiselect:true,title:n.Loc.getMessage("TASKS_COUNTER_MY")}));h(babelHelpers.assertThisInitialized(t),S);h(babelHelpers.assertThisInitialized(t),w);h(babelHelpers.assertThisInitialized(t),k);h(babelHelpers.assertThisInitialized(t),L);h(babelHelpers.assertThisInitialized(t),I);h(babelHelpers.assertThisInitialized(t),C);h(babelHelpers.assertThisInitialized(t),T);h(babelHelpers.assertThisInitialized(t),E);h(babelHelpers.assertThisInitialized(t),g);h(babelHelpers.assertThisInitialized(t),b);h(babelHelpers.assertThisInitialized(t),_);h(babelHelpers.assertThisInitialized(t),y);h(babelHelpers.assertThisInitialized(t),v);f(babelHelpers.assertThisInitialized(t),m,{writable:true,value:void 0});t.userId=e.userId;t.targetUserId=e.targetUserId;t.groupId=e.groupId;t.counters=e.counters;t.initialCounterTypes=e.counterTypes;t.role=e.role;t.signedParameters=e.signedParameters;babelHelpers.classPrivateFieldSet(babelHelpers.assertThisInitialized(t),m,e.filterId);t.tasksChatUri=e.tasksChatUri;t.viewState=e.viewState||"list";t.chatButton=null;t.setData(t.counters);t.initPull();t.elements=t.getCounterItems(t.counters);t.setItems(t.elements);return t}babelHelpers.createClass(r,[{key:"isMyTaskList",value:function e(){return this.userId===this.targetUserId}},{key:"isUserTaskList",value:function e(){return Object.keys(this.otherCounters).length===0}},{key:"isProjectsTaskList",value:function e(){return this.groupId>0}},{key:"isProjectList",value:function e(){return!this.isUserTaskList()&&!this.isProjectsTaskList()}},{key:"initPull",value:function e(){var t=this;BX.PULL.subscribe({moduleId:"tasks",callback:function e(r){return t.processPullEvent(r)}});this.extendWatch()}},{key:"extendWatch",value:function e(){var t=this;if(this.isProjectsTaskList()||this.isProjectList()){var r="TASKS_PROJECTS";if(this.isProjectsTaskList()){r="TASKS_PROJECTS_".concat(this.groupId)}BX.PULL.extendWatch(r,true);setTimeout((function(){return t.extendWatch()}),29*60*1e3)}}},{key:"processPullEvent",value:function e(t){var r={user_counter:this.onUserCounter.bind(this),project_counter:this.onProjectCounter.bind(this),comment_read_all:this.onCommentReadAll.bind(this)};var n=Object.prototype.hasOwnProperty;var i=t.command,s=t.params;if(n.call(r,i)){var o=r[i];if(o){o.apply(this,[s])}}}},{key:"bindEvents",value:function e(){var t=this;i.EventEmitter.subscribe("BX.UI.CounterPanel.Item:activate",p(this,_,x).bind(this));i.EventEmitter.subscribe("BX.UI.CounterPanel.Item:deactivate",p(this,g,P).bind(this));i.EventEmitter.subscribe("BX.UI.CounterPanel.Item:click",p(this,v,A).bind(this));i.EventEmitter.subscribe("BX.Main.Filter:apply",this.onFilterApply.bind(this));n.Event.bind(window,"resize",n.Runtime.throttle((function(){if(p(t,y,B).call(t)){var e;(e=t.getItemById(r.READ_ALL_ID))===null||e===void 0?void 0:e.expand()}else{var n;(n=t.getItemById(r.READ_ALL_ID))===null||n===void 0?void 0:n.collapse()}}),10,this))}},{key:"onFilterApply",value:function e(){var t=this;if(this.isRoleChanged()){this.getItems().forEach((function(e){return e.deactivate(false)}));this.updateRole();this.updateCountersData()}else{Object.values(this.elements).forEach((function(e){var r=t.getItemById(e.id);var n=t.filter.isFilteredByFieldValue(e.filterField,e.filterValue);if(!n){r.deactivate(false)}}));p(this,C,H).call(this)}}},{key:"updateCountersData",value:function e(){var t=this;if(r.updateTimeout){r.needUpdate=true;return}r.updateTimeout=true;r.needUpdate=false;n.ajax.runComponentAction("bitrix:tasks.interface.counters","getCounters",{mode:"class",data:{groupId:this.groupId,role:this.role,counters:this.initialCounterTypes},signedParameters:this.signedParameters}).then((function(e){return t.rerender(e.data)}),(function(e){return console.log(e)}));setTimeout((function(){r.updateTimeout=false;if(r.needUpdate){t.updateCountersData()}}),r.timeoutTTL)}},{key:"isRoleChanged",value:function e(){return this.role!==(this.filter.isFilteredByField("ROLEID")?this.filter.fields.ROLEID:"view_all")}},{key:"updateRole",value:function e(){this.role=this.filter.isFilteredByField("ROLEID")?this.filter.fields.ROLEID:"view_all"}},{key:"onCommentReadAll",value:function e(t){this.updateCountersData()}},{key:"onUserCounter",value:function e(t){var r=Object.prototype.hasOwnProperty;if(!this.isUserTaskList()||!this.isMyTaskList()||!r.call(t,this.groupId)||this.userId!==Number(t.userId)){this.updateCountersData();return}if(t.isSonetEnabled!==undefined&&t.isSonetEnabled===false){this.updateCountersData()}}},{key:"onProjectCounter",value:function e(t){if(this.isUserTaskList()){return}this.updateCountersData()}},{key:"getCounterItems",value:function e(t){var i=this;var s=[];var o=0;var a="tasks_more";var l=false;var u=new Set([].concat(babelHelpers.toConsumableArray(r.counterTypes.my),babelHelpers.toConsumableArray(r.counterTypes.other)));s=[];Object.entries(t).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],c=t[1];if(!u.has(n)){return}if(r.counterTypes.other.includes(n)){l=true;o+=Number(c.VALUE);s.push({id:n,title:i.getCounterNameByType(n),value:{value:Number(c.VALUE),order:-1},parentId:a,color:p(i,T,U).call(i,Number(c.VALUE),c.STYLE),filterField:c.FILTER_FIELD,filterValue:c.FILTER_VALUE})}else{s.push({id:n,title:i.getCounterNameByType(n),value:Number(c.VALUE),isRestricted:false,color:p(i,T,U).call(i,Number(c.VALUE),c.STYLE),filterField:c.FILTER_FIELD,filterValue:c.FILTER_VALUE})}}));if(!this.isUserTaskList()||this.isMyTaskList()){s.push({id:r.READ_ALL_ID,title:n.Loc.getMessage("TASKS_COUNTER_READ_ALL"),collapsedIcon:"chat-check",collapsed:!p(this,y,B).call(this),locked:false,dataAttributes:{role:"tasks-counters--item-head-read-all"}})}if(l){s.push({id:a,title:n.Loc.getMessage("TASKS_COUNTER_MORE"),value:{value:o,order:-1},isRestricted:false,color:r.COLOR_THEME})}return s}},{key:"getCounterNameByType",value:function e(t){if(r.counterTypes.expired.includes(t)){return n.Loc.getMessage("TASKS_COUNTER_EXPIRED")}if(r.counterTypes.comment.includes(t)){return n.Loc.getMessage("TASKS_COUNTER_NEW_COMMENTS")}return""}},{key:"setData",value:function e(t){var n=this;this.counters=t;this.myCounters={};this.otherCounters={};var i=new Set([].concat(babelHelpers.toConsumableArray(r.counterTypes.my),babelHelpers.toConsumableArray(r.counterTypes.other)));Object.entries(t).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),s=t[0],o=t[1];if(!i.has(s)){return}var a={id:s,title:n.getCounterNameByType(s),value:Number(o.VALUE),color:p(n,T,U).call(n,Number(o.VALUE),o.STYLE),filterField:o.FILTER_FIELD,filterValue:o.FILTER_VALUE};if(r.counterTypes.my.includes(s)){n.myCounters[s]=a}else if(r.counterTypes.other.includes(s)){n.otherCounters[s]=a}}))}},{key:"readAllByRole",value:function e(){(new s.Controller).userComments({groupId:this.groupId,userId:this.userId,role:this.role})}},{key:"readAllForProjects",value:function e(){var t=c(c({},this.myCounters),this.otherCounters);Object.entries(t).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],i=t[1];if(r.counterTypes.comment.includes(n)){i.updateCount(0)}}));(new s.Controller).projectComments({groupId:this.groupId})}},{key:"readAllForScrum",value:function e(){var t=c(c({},this.myCounters),this.otherCounters);Object.entries(t).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],i=t[1];if(r.counterTypes.comment.includes(n)){i.updateCount(0)}}));(new s.Controller).scrumComments({groupId:this.groupId})}},{key:"rerender",value:function e(t){var n=this;this.setData(t);this.initChatButtonCounter();var i=0;var s=null;var o=false;var a=new Set([].concat(babelHelpers.toConsumableArray(r.counterTypes.my),babelHelpers.toConsumableArray(r.counterTypes.other)));Object.entries(t).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),l=t[0],u=t[1];if(!a.has(l)){return}var c=n.getItemById(l);if(c.hasParentId()){s=c.parentId;i+=Number(u.VALUE)}c.updateValue(Number(u.VALUE));c.updateColor(p(n,T,U).call(n,Number(u.VALUE),u.STYLE));if(p(n,T,U).call(n,Number(u.VALUE),u.STYLE)===r.COLOR_SUCCESS){o=true}}));if(o&&(!this.isUserTaskList()||this.isMyTaskList())){p(this,I,R).call(this,o)}if(s){var l=this.getItemById(s);l.updateValue(i)}}},{key:"render",value:function e(){babelHelpers.get(babelHelpers.getPrototypeOf(r.prototype),"init",this).call(this);this.renderChatButton()}},{key:"renderChatButton",value:function e(){var r=this;var i=document.getElementById("tasks-chat-button");if(!i||!this.tasksChatUri){return}this.chatButton=new t.Button({text:n.Loc.getMessage("TASKS_COUNTERS_CHAT_BUTTON"),onclick:function e(){return r.handleChatButtonClick()},style:t.AirButtonStyle.OUTLINE,size:t.ButtonSize.SMALL,useAirDesign:true});this.initChatButtonCounter();this.chatButton.renderTo(i)}},{key:"handleChatButtonClick",value:function(){var e=babelHelpers.asyncToGenerator(l().mark((function e(){var t,r;return l().wrap((function e(n){while(1)switch(n.prev=n.next){case 0:n.next=2;return top.BX.Runtime.loadExtension("im.public");case 2:t=n.sent;r=t.Messenger;if(!(r!==null&&r!==void 0&&r.isEmbeddedMode()||r!==null&&r!==void 0&&r.isMessengerSliderOpened())){n.next=7;break}BX.SidePanel.Instance.emulateAnchorClick("/online/?IM_TASK");return n.abrupt("return");case 7:BX.SidePanel.Instance.emulateAnchorClick(this.tasksChatUri);o.sendData({tool:"tasks",category:"chat_operations",type:"task",event:"click_chat_tasks",c_section:"task",c_sub_section:this.viewState,c_element:"chat_tasks_button"});case 9:case"end":return n.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"initChatButtonCounter",value:function e(){if(this.counters.new_comments_total&&this.chatButton){var t=Number(this.counters.new_comments_total.VALUE);if(this.chatButton.getLeftCounter()){this.chatButton.getLeftCounter().setValue(t);this.chatButton.getLeftCounter().setColor(this.getChatButtonCounterColor(t));return}this.chatButton.setLeftCounter({value:t,color:this.getChatButtonCounterColor(t)})}}},{key:"getChatButtonCounterColor",value:function e(r){return r?t.ButtonCounterStyle.FILLED_SUCCESS:t.ButtonCounterStyle.OUTLINE_NO_ACCENT}},{key:"connectWithFilter",value:function e(){this.filter=new a({filterId:babelHelpers.classPrivateFieldGet(this,m)});this.bindEvents();p(this,C,H).call(this)}}]);return r}(r.CounterPanel);function A(e){var t=e.getData().item;if(t.getId()===O.READ_ALL_ID){if(this.isUserTaskList()||this.isProjectsTaskList()&&this.role!=="view_all"){this.readAllByRole()}else if(this.myCounters.scrum_total_comments||this.otherCounters.scrum_foreign_comments){this.readAllForScrum()}else{this.readAllForProjects()}t.lock()}}function B(){return window.innerWidth>1520}function x(e){var t=e.getData();var r=t.id;var n=null;Object.values(this.elements).forEach((function(e){if(e.id===r){n=e}}));p(this,b,j).call(this,t);this.filter.toggleByField(n);p(this,L,D).call(this,t);i.EventEmitter.emit("Tasks.Toolbar:onItem",{counter:n});i.EventEmitter.emit("BX.Tasks.Counters:active",n)}function j(e){var t=this.getItems();Object.values(t).forEach((function(t){if(t.id!==e.id){t.deactivate(false)}}));if(e.hasParentId()){this.getItemById(e.parentId).activate(false)}}function P(e){var t=this;var r=e.getData();var n=r.id;var s=null;if(r.parent){r.getItems().forEach((function(e){var r=t.getItemById(e);if(r.isActive){n=r.id}}))}Object.values(this.elements).forEach((function(e){if(e.id===n){s=e}}));p(this,E,F).call(this,r);this.filter.toggleByField(s);i.EventEmitter.emit("Tasks.Toolbar:onItem",{counter:s});i.EventEmitter.emit("BX.Tasks.Counters:unActive",s)}function F(e){var t=this;if(e.hasParentId()){var r=this.getItemById(e.parentId);r.deactivate(false);return}if(e.parent){e.getItems().forEach((function(e){var r=t.getItemById(e);if(r.isActive){r.deactivate(false)}}))}}function U(e,t){return Number(e)===0?O.COLOR_GRAY:t.toUpperCase()}function H(){var e=this;var t=null;var r=false;Object.values(this.elements).forEach((function(n){var i=e.getItemById(n.id);var s=e.filter.isFilteredByFieldValue(n.filterField,n.filterValue);if(i.color===O.COLOR_SUCCESS){r=true}if(s){if(i.hasParentId()){t=i.parentId}i.activate(false)}}));if(r&&(!this.isUserTaskList()||this.isMyTaskList())){p(this,I,R).call(this,r)}if(t){this.getItemById(t).activate(false)}}function R(e){var t=this.getItemById(O.READ_ALL_ID);if(e&&t.isLocked()){t.unLock()}if(!e&&!t.isLocked()){t.lock()}}function D(e){o.sendData({tool:"tasks",category:"task_operations",type:"task",event:p(this,k,N).call(this,e),c_section:p(this,w,M).call(this,e),c_element:p(this,S,V).call(this,e)})}function N(e){if(O.counterTypes.expired.includes(e.id)){return"overdue_counters_on"}return"comments_counters_on"}function M(e){if(O.counterTypes.scrum.includes(e.id)){return"scrum"}if(O.counterTypes.project.includes(e.id)){return"project"}return"tasks"}function V(e){if(O.counterTypes.expired.includes(e.id)){return"overdue_counters_filter"}return"comments_counters_filter"}babelHelpers.defineProperty(O,"READ_ALL_ID","read_all");babelHelpers.defineProperty(O,"COLOR_GRAY","GRAY");babelHelpers.defineProperty(O,"COLOR_THEME","THEME");babelHelpers.defineProperty(O,"COLOR_SUCCESS","SUCCESS");babelHelpers.defineProperty(O,"updateTimeout",false);babelHelpers.defineProperty(O,"needUpdate",false);babelHelpers.defineProperty(O,"timeoutTTL",5e3);e.Counters=O})(this.BX.Tasks.Counters=this.BX.Tasks.Counters||{},BX.UI,BX.UI,BX,BX.Event,BX.Tasks.Viewed,BX.UI.Analytics);
//# sourceMappingURL=script.map.js