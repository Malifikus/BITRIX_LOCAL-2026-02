{"version":3,"file":"script.js","sources":["src/counters-helper.js","src/entry.js"],"sourcesContent":["import { Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nclass Filter\n{\n\tconstructor(options)\n\t{\n\t\tthis.filterId = options.filterId;\n\t\tthis.filterManager = BX.Main.filterManager.getById(this.filterId);\n\n\t\tthis.bindEvents();\n\t\tthis.updateFields();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\t}\n\n\tonFilterApply()\n\t{\n\t\tthis.updateFields();\n\t}\n\n\tupdateFields()\n\t{\n\t\tthis.fields = this.filterManager.getFilterFieldsValues();\n\t}\n\n\tisFilteredByField(field)\n\t{\n\t\tif (!Object.keys(this.fields).includes(field))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Type.isArray(this.fields[field]))\n\t\t{\n\t\t\treturn this.fields[field].length > 0;\n\t\t}\n\n\t\treturn this.fields[field] !== '';\n\t}\n\n\tisFilteredByFieldValue(field, value)\n\t{\n\t\treturn this.isFilteredByField(field) && this.fields[field] === value;\n\t}\n\n\ttoggleByField(field)\n\t{\n\t\tconst name = field.filterField;\n\t\tconst value = field.filterValue;\n\n\t\tif (!this.isFilteredByFieldValue(name, value))\n\t\t{\n\t\t\tthis.filterManager.getApi().extendFilter(\n\t\t\t\t{[name]: value},\n\t\t\t\tfalse,\n\t\t\t\t{COUNTER_TYPE: 'TASKS_COUNTER_TYPE_' + value}\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.filterManager.getFilterFields().forEach((field) => {\n\t\t\tif (field.getAttribute('data-name') === name)\n\t\t\t{\n\t\t\t\tthis.filterManager.getFields().deleteField(field);\n\t\t\t}\n\t\t});\n\n\t\tthis.filterManager.getSearch().apply();\n\t}\n\n\tgetFilter()\n\t{\n\t\treturn this.filterManager;\n\t}\n}\n\nexport {\n\tFilter\n}\n","import { Loc, Runtime, Event, ajax as Ajax } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Button, AirButtonStyle, ButtonSize, ButtonCounterStyle } from 'ui.buttons';\nimport { CounterItem, CounterPanel } from 'ui.counterpanel';\nimport { Filter } from './counters-helper';\nimport { Controller as Viewed } from 'tasks.viewed';\nimport { sendData } from 'ui.analytics';\n\nexport class Counters extends CounterPanel\n{\n\tstatic READ_ALL_ID = 'read_all';\n\tstatic COLOR_GRAY = 'GRAY';\n\tstatic COLOR_THEME = 'THEME';\n\tstatic COLOR_SUCCESS = 'SUCCESS';\n\n\tstatic get counterTypes()\n\t{\n\t\treturn {\n\t\t\tmy: [\n\t\t\t\t'expired',\n\t\t\t\t'my_expired',\n\t\t\t\t'originator_expired',\n\t\t\t\t'accomplices_expired',\n\t\t\t\t'auditor_expired',\n\t\t\t\t'new_comments',\n\t\t\t\t'my_new_comments',\n\t\t\t\t'originator_new_comments',\n\t\t\t\t'accomplices_new_comments',\n\t\t\t\t'auditor_new_comments',\n\t\t\t\t'projects_total_expired',\n\t\t\t\t'projects_total_comments',\n\t\t\t\t'sonet_total_expired',\n\t\t\t\t'sonet_total_comments',\n\t\t\t\t'groups_total_expired',\n\t\t\t\t'groups_total_comments',\n\t\t\t\t'scrum_total_comments',\n\t\t\t\t'flow_total_expired',\n\t\t\t\t'flow_total_comments',\n\t\t\t],\n\t\t\tother: [\n\t\t\t\t'project_expired',\n\t\t\t\t'project_comments',\n\t\t\t\t'projects_foreign_expired',\n\t\t\t\t'projects_foreign_comments',\n\t\t\t\t'groups_foreign_expired',\n\t\t\t\t'groups_foreign_comments',\n\t\t\t\t'sonet_foreign_expired',\n\t\t\t\t'sonet_foreign_comments',\n\t\t\t\t'scrum_foreign_comments',\n\t\t\t],\n\t\t\tadditional: [\n\t\t\t\t'muted_new_comments',\n\t\t\t],\n\t\t\texpired: [\n\t\t\t\t'expired',\n\t\t\t\t'my_expired',\n\t\t\t\t'originator_expired',\n\t\t\t\t'accomplices_expired',\n\t\t\t\t'auditor_expired',\n\t\t\t\t'project_expired',\n\t\t\t\t'projects_total_expired',\n\t\t\t\t'projects_foreign_expired',\n\t\t\t\t'groups_total_expired',\n\t\t\t\t'groups_foreign_expired',\n\t\t\t\t'sonet_total_expired',\n\t\t\t\t'sonet_foreign_expired',\n\t\t\t\t'flow_total_expired',\n\t\t\t],\n\t\t\tcomment: [\n\t\t\t\t'new_comments',\n\t\t\t\t'my_new_comments',\n\t\t\t\t'originator_new_comments',\n\t\t\t\t'accomplices_new_comments',\n\t\t\t\t'auditor_new_comments',\n\t\t\t\t'muted_new_comments',\n\t\t\t\t'project_comments',\n\t\t\t\t'projects_total_comments',\n\t\t\t\t'projects_foreign_comments',\n\t\t\t\t'groups_total_comments',\n\t\t\t\t'groups_foreign_comments',\n\t\t\t\t'sonet_total_comments',\n\t\t\t\t'sonet_foreign_comments',\n\t\t\t\t'scrum_total_comments',\n\t\t\t\t'scrum_foreign_comments',\n\t\t\t\t'flow_total_comments',\n\t\t\t\t'new_comments_total',\n\t\t\t],\n\t\t\tproject: [\n\t\t\t\t'project_expired',\n\t\t\t\t'projects_total_expired',\n\t\t\t\t'projects_foreign_expired',\n\t\t\t\t'groups_total_expired',\n\t\t\t\t'groups_foreign_expired',\n\t\t\t\t'sonet_total_expired',\n\t\t\t\t'sonet_foreign_expired',\n\t\t\t\t'project_comments',\n\t\t\t\t'projects_total_comments',\n\t\t\t\t'projects_foreign_comments',\n\t\t\t\t'groups_total_comments',\n\t\t\t\t'groups_foreign_comments',\n\t\t\t\t'sonet_total_comments',\n\t\t\t\t'sonet_foreign_comments',\n\t\t\t],\n\t\t\tscrum: [\n\t\t\t\t'scrum_total_comments',\n\t\t\t\t'scrum_foreign_comments',\n\t\t\t],\n\t\t};\n\t}\n\n\tstatic updateTimeout = false;\n\tstatic needUpdate = false;\n\n\tstatic timeoutTTL = 5000;\n\t#filterId: string;\n\n\tconstructor(options)\n\t{\n\t\tsuper({\n\t\t\ttarget: options.renderTo,\n\t\t\titems: [],\n\t\t\tmultiselect: true,\n\t\t\ttitle: Loc.getMessage('TASKS_COUNTER_MY'),\n\t\t});\n\n\t\tthis.userId = options.userId;\n\t\tthis.targetUserId = options.targetUserId;\n\t\tthis.groupId = options.groupId;\n\t\tthis.counters = options.counters;\n\t\tthis.initialCounterTypes = options.counterTypes;\n\t\tthis.role = options.role;\n\t\tthis.signedParameters = options.signedParameters;\n\t\tthis.#filterId = options.filterId;\n\n\t\tthis.tasksChatUri = options.tasksChatUri;\n\t\tthis.viewState = options.viewState || 'list';\n\t\tthis.chatButton = null;\n\n\t\tthis.setData(this.counters);\n\t\tthis.initPull();\n\n\t\tthis.elements = this.getCounterItems(this.counters);\n\t\tthis.setItems(this.elements);\n\t}\n\n\tisMyTaskList()\n\t{\n\t\treturn this.userId === this.targetUserId;\n\t}\n\n\tisUserTaskList()\n\t{\n\t\treturn (Object.keys(this.otherCounters).length === 0);\n\t}\n\n\tisProjectsTaskList()\n\t{\n\t\treturn this.groupId > 0;\n\t}\n\n\tisProjectList()\n\t{\n\t\treturn !this.isUserTaskList() && !this.isProjectsTaskList();\n\t}\n\n\tinitPull()\n\t{\n\t\tBX.PULL.subscribe({\n\t\t\tmoduleId: 'tasks',\n\t\t\tcallback: data => this.processPullEvent(data),\n\t\t});\n\n\t\tthis.extendWatch();\n\t}\n\n\textendWatch()\n\t{\n\t\tif (this.isProjectsTaskList() || this.isProjectList())\n\t\t{\n\t\t\tlet tagId = 'TASKS_PROJECTS';\n\n\t\t\tif (this.isProjectsTaskList())\n\t\t\t{\n\t\t\t\ttagId = `TASKS_PROJECTS_${this.groupId}`;\n\t\t\t}\n\n\t\t\tBX.PULL.extendWatch(tagId, true);\n\t\t\tsetTimeout(() => this.extendWatch(), 29 * 60 * 1000);\n\t\t}\n\t}\n\n\tprocessPullEvent(data)\n\t{\n\t\tconst eventHandlers = {\n\t\t\tuser_counter: this.onUserCounter.bind(this),\n\t\t\tproject_counter: this.onProjectCounter.bind(this),\n\t\t\tcomment_read_all: this.onCommentReadAll.bind(this),\n\t\t};\n\t\tconst has = Object.prototype.hasOwnProperty;\n\t\tconst { command, params } = data;\n\t\tif (has.call(eventHandlers, command))\n\t\t{\n\t\t\tconst method = eventHandlers[command];\n\t\t\tif (method)\n\t\t\t{\n\t\t\t\tmethod.apply(this, [params]);\n\t\t\t}\n\t\t}\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:activate', this.#onActivateItem.bind(this));\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:deactivate', this.#onDeactivateItem.bind(this));\n\n\t\tEventEmitter.subscribe('BX.UI.CounterPanel.Item:click', this.#readAll.bind(this));\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\n\t\tEvent.bind(window, 'resize', Runtime.throttle(() => {\n\t\t\tif (this.#isBigScreen())\n\t\t\t{\n\t\t\t\tthis.getItemById(Counters.READ_ALL_ID)?.expand();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getItemById(Counters.READ_ALL_ID)?.collapse();\n\t\t\t}\n\t\t}, 10, this));\n\t}\n\n\t#readAll(event: BaseEvent)\n\t{\n\t\tconst item = event.getData().item;\n\n\t\tif (item.getId() === Counters.READ_ALL_ID)\n\t\t{\n\t\t\tif (\n\t\t\t\tthis.isUserTaskList()\n\t\t\t\t|| (this.isProjectsTaskList() && this.role !== 'view_all')\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.readAllByRole();\n\t\t\t}\n\t\t\telse if (\n\t\t\t\tthis.myCounters.scrum_total_comments\n\t\t\t\t|| this.otherCounters.scrum_foreign_comments\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.readAllForScrum();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.readAllForProjects();\n\t\t\t}\n\n\t\t\titem.lock();\n\t\t}\n\t}\n\n\t#isBigScreen(): Boolean\n\t{\n\t\treturn window.innerWidth > 1520;\n\t}\n\n\t#onActivateItem(event: BaseEvent)\n\t{\n\t\tconst item = event.getData();\n\t\tconst itemId = item.id;\n\t\tlet count = null;\n\n\t\tObject.values(this.elements).forEach((element) => {\n\t\t\tif (element.id === itemId)\n\t\t\t{\n\t\t\t\tcount = element;\n\t\t\t}\n\t\t});\n\n\t\tthis.#activateLinkedMenuItem(item);\n\t\tthis.filter.toggleByField(count);\n\t\tthis.#sendAnalyticsEvent(item);\n\n\t\tEventEmitter.emit('Tasks.Toolbar:onItem', {\n\t\t\tcounter: count,\n\t\t});\n\n\t\tEventEmitter.emit('BX.Tasks.Counters:active', count);\n\t}\n\n\t#activateLinkedMenuItem(item: CounterItem): void\n\t{\n\t\tconst items = this.getItems();\n\n\t\tObject.values(items).forEach((element) => {\n\t\t\tif (element.id !== item.id)\n\t\t\t{\n\t\t\t\telement.deactivate(false);\n\t\t\t}\n\t\t});\n\n\t\tif (item.hasParentId())\n\t\t{\n\t\t\tthis.getItemById(item.parentId).activate(false);\n\t\t}\n\t}\n\n\t#onDeactivateItem(event: BaseEvent)\n\t{\n\t\tconst item = event.getData();\n\t\tlet itemId = item.id;\n\t\tlet count = null;\n\n\t\tif (item.parent)\n\t\t{\n\t\t\titem.getItems().forEach(childItemId => {\n\t\t\t\tconst childItem = this.getItemById(childItemId);\n\n\t\t\t\tif (childItem.isActive)\n\t\t\t\t{\n\t\t\t\t\titemId = childItem.id;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tObject.values(this.elements).forEach((element) => {\n\t\t\tif (element.id === itemId)\n\t\t\t{\n\t\t\t\tcount = element;\n\t\t\t}\n\t\t});\n\n\t\tthis.#deactivateLinkedMenuItem(item);\n\t\tthis.filter.toggleByField(count);\n\n\t\tEventEmitter.emit('Tasks.Toolbar:onItem', {\n\t\t\tcounter: count,\n\t\t});\n\n\t\tEventEmitter.emit('BX.Tasks.Counters:unActive', count);\n\t}\n\n\t#deactivateLinkedMenuItem(item: CounterItem): void\n\t{\n\t\tif (item.hasParentId())\n\t\t{\n\t\t\tconst parentItem = this.getItemById(item.parentId);\n\t\t\tparentItem.deactivate(false);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (item.parent)\n\t\t{\n\t\t\titem.getItems().forEach(childItemId => {\n\t\t\t\tconst childItem = this.getItemById(childItemId);\n\n\t\t\t\tif (childItem.isActive)\n\t\t\t\t{\n\t\t\t\t\tchildItem.deactivate(false);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\t#getColorByValue(value: Number, color: String): String\n\t{\n\t\treturn Number(value) === 0 ? Counters.COLOR_GRAY : (color).toUpperCase();\n\t}\n\n\tonFilterApply()\n\t{\n\t\tif (this.isRoleChanged())\n\t\t{\n\t\t\tthis.getItems().forEach((item) => item.deactivate(false));\n\t\t\tthis.updateRole();\n\t\t\tthis.updateCountersData();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tObject.values(this.elements).forEach((element) => {\n\t\t\t\tconst item = this.getItemById(element.id);\n\t\t\t\tconst isFiltered = this.filter.isFilteredByFieldValue(element.filterField, element.filterValue);\n\n\t\t\t\tif (!isFiltered)\n\t\t\t\t{\n\t\t\t\t\titem.deactivate(false);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.#markCounters();\n\t\t}\n\t}\n\n\tupdateCountersData()\n\t{\n\t\tif (Counters.updateTimeout)\n\t\t{\n\t\t\tCounters.needUpdate = true;\n\t\t\treturn;\n\t\t}\n\n\t\tCounters.updateTimeout = true;\n\t\tCounters.needUpdate = false;\n\n\t\tAjax.runComponentAction('bitrix:tasks.interface.counters', 'getCounters', {\n\t\t\tmode: 'class',\n\t\t\tdata: {\n\t\t\t\tgroupId: this.groupId,\n\t\t\t\trole: this.role,\n\t\t\t\tcounters: this.initialCounterTypes,\n\t\t\t},\n\t\t\tsignedParameters: this.signedParameters,\n\t\t}).then(\n\t\t\t(response) => this.rerender(response.data),\n\t\t\t(response) => console.log(response),\n\t\t);\n\n\t\tsetTimeout(() => {\n\t\t\tCounters.updateTimeout = false;\n\t\t\tif (Counters.needUpdate)\n\t\t\t{\n\t\t\t\tthis.updateCountersData();\n\t\t\t}\n\t\t}, Counters.timeoutTTL);\n\t}\n\n\tisRoleChanged()\n\t{\n\t\treturn this.role !== (this.filter.isFilteredByField('ROLEID') ? this.filter.fields.ROLEID : 'view_all');\n\t}\n\n\tupdateRole()\n\t{\n\t\tthis.role = (this.filter.isFilteredByField('ROLEID') ? this.filter.fields.ROLEID : 'view_all');\n\t}\n\n\tonCommentReadAll(data)\n\t{\n\t\tthis.updateCountersData();\n\t}\n\n\tonUserCounter(data)\n\t{\n\t\tconst has = Object.prototype.hasOwnProperty;\n\t\tif (\n\t\t\t!this.isUserTaskList()\n\t\t\t|| !this.isMyTaskList()\n\t\t\t|| !has.call(data, this.groupId)\n\t\t\t|| this.userId !== Number(data.userId)\n\t\t)\n\t\t{\n\t\t\t// most likely project counters were updated, but due to 'isSonetEnable' flag only user counters are comming\n\t\t\tthis.updateCountersData();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (data.isSonetEnabled !== undefined && data.isSonetEnabled === false)\n\t\t{\n\t\t\tthis.updateCountersData();\n\t\t}\n\t}\n\n\tonProjectCounter(data)\n\t{\n\t\tif (this.isUserTaskList())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.updateCountersData();\n\t}\n\n\tgetCounterItems(counters): Array\n\t{\n\t\tlet items = [];\n\t\tlet parentTotal = 0;\n\t\tconst parentItemId = 'tasks_more';\n\t\tlet hasOther = false;\n\n\t\tconst availableTypes = new Set([\n\t\t\t...Counters.counterTypes.my,\n\t\t\t...Counters.counterTypes.other,\n\t\t]);\n\n\t\titems = [];\n\n\t\tObject.entries(counters).forEach(([type, data]) => {\n\t\t\tif (!availableTypes.has(type))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (Counters.counterTypes.other.includes(type))\n\t\t\t{\n\t\t\t\thasOther = true;\n\t\t\t\tparentTotal += Number(data.VALUE);\n\n\t\t\t\titems.push({\n\t\t\t\t\tid: type,\n\t\t\t\t\ttitle: this.getCounterNameByType(type),\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\tvalue: Number(data.VALUE),\n\t\t\t\t\t\torder: -1,\n\t\t\t\t\t},\n\t\t\t\t\tparentId: parentItemId,\n\t\t\t\t\tcolor: this.#getColorByValue(Number(data.VALUE), data.STYLE),\n\t\t\t\t\tfilterField: data.FILTER_FIELD,\n\t\t\t\t\tfilterValue: data.FILTER_VALUE,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\tid: type,\n\t\t\t\t\ttitle: this.getCounterNameByType(type),\n\t\t\t\t\tvalue: Number(data.VALUE),\n\t\t\t\t\tisRestricted: false,\n\t\t\t\t\tcolor: this.#getColorByValue(Number(data.VALUE), data.STYLE),\n\t\t\t\t\tfilterField: data.FILTER_FIELD,\n\t\t\t\t\tfilterValue: data.FILTER_VALUE,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tif (!this.isUserTaskList() || this.isMyTaskList())\n\t\t{\n\t\t\titems.push({\n\t\t\t\tid: Counters.READ_ALL_ID,\n\t\t\t\ttitle: Loc.getMessage('TASKS_COUNTER_READ_ALL'),\n\t\t\t\tcollapsedIcon: 'chat-check',\n\t\t\t\tcollapsed: !this.#isBigScreen(),\n\t\t\t\tlocked: false,\n\t\t\t\tdataAttributes: {\n\t\t\t\t\trole: 'tasks-counters--item-head-read-all',\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (hasOther)\n\t\t{\n\t\t\titems.push({\n\t\t\t\tid: parentItemId,\n\t\t\t\ttitle: Loc.getMessage('TASKS_COUNTER_MORE'),\n\t\t\t\tvalue: {\n\t\t\t\t\tvalue: parentTotal,\n\t\t\t\t\torder: -1,\n\t\t\t\t},\n\t\t\t\tisRestricted: false,\n\t\t\t\tcolor: Counters.COLOR_THEME,\n\t\t\t});\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tgetCounterNameByType(type: String): String\n\t{\n\t\tif (Counters.counterTypes.expired.includes(type))\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_COUNTER_EXPIRED');\n\t\t}\n\n\t\tif (Counters.counterTypes.comment.includes(type))\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_COUNTER_NEW_COMMENTS');\n\t\t}\n\n\t\treturn '';\n\t}\n\n\tsetData(counters)\n\t{\n\t\tthis.counters = counters;\n\t\tthis.myCounters = {};\n\t\tthis.otherCounters = {};\n\n\t\tconst availableTypes = new Set([\n\t\t\t...Counters.counterTypes.my,\n\t\t\t...Counters.counterTypes.other,\n\t\t]);\n\n\t\tObject.entries(counters).forEach(([type, data]) => {\n\t\t\tif (!availableTypes.has(type))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst counterItem = {\n\t\t\t\tid: type,\n\t\t\t\ttitle: this.getCounterNameByType(type),\n\t\t\t\tvalue: Number(data.VALUE),\n\t\t\t\tcolor: this.#getColorByValue(Number(data.VALUE), data.STYLE),\n\t\t\t\tfilterField: data.FILTER_FIELD,\n\t\t\t\tfilterValue: data.FILTER_VALUE,\n\t\t\t};\n\n\t\t\tif (Counters.counterTypes.my.includes(type))\n\t\t\t{\n\t\t\t\tthis.myCounters[type] = counterItem;\n\t\t\t}\n\t\t\telse if (Counters.counterTypes.other.includes(type))\n\t\t\t{\n\t\t\t\tthis.otherCounters[type] = counterItem;\n\t\t\t}\n\t\t});\n\t}\n\n\treadAllByRole()\n\t{\n\t\t(new Viewed()).userComments({\n\t\t\tgroupId: this.groupId,\n\t\t\tuserId: this.userId,\n\t\t\trole: this.role,\n\t\t});\n\t}\n\n\treadAllForProjects()\n\t{\n\t\tconst allCounters = { ...this.myCounters, ...this.otherCounters };\n\n\t\tObject.entries(allCounters).forEach(([type, counter]) => {\n\t\t\tif (Counters.counterTypes.comment.includes(type))\n\t\t\t{\n\t\t\t\tcounter.updateCount(0);\n\t\t\t}\n\t\t});\n\n\t\t(new Viewed()).projectComments({\n\t\t\tgroupId: this.groupId,\n\t\t});\n\t}\n\n\treadAllForScrum()\n\t{\n\t\tconst allCounters = { ...this.myCounters, ...this.otherCounters };\n\n\t\tObject.entries(allCounters).forEach(([type, counter]) => {\n\t\t\tif (Counters.counterTypes.comment.includes(type))\n\t\t\t{\n\t\t\t\tcounter.updateCount(0);\n\t\t\t}\n\t\t});\n\n\t\t(new Viewed()).scrumComments({\n\t\t\tgroupId: this.groupId,\n\t\t});\n\t}\n\n\trerender(counters)\n\t{\n\t\tthis.setData(counters);\n\t\tthis.initChatButtonCounter();\n\n\t\tlet isValueUpdated = false;\n\t\tlet parentTotal = 0;\n\t\tlet parentId = null;\n\t\tlet canResetReadAll = false;\n\n\t\tconst availableTypes = new Set([\n\t\t\t...Counters.counterTypes.my,\n\t\t\t...Counters.counterTypes.other,\n\t\t]);\n\n\t\tObject.entries(counters).forEach(([code, counter]) => {\n\t\t\tif (!availableTypes.has(code))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = this.getItemById(code);\n\t\t\tif (item.hasParentId())\n\t\t\t{\n\t\t\t\tparentId = item.parentId;\n\t\t\t\tparentTotal += Number(counter.VALUE);\n\t\t\t}\n\n\t\t\titem.updateValue(Number(counter.VALUE));\n\t\t\titem.updateColor(this.#getColorByValue(Number(counter.VALUE), counter.STYLE));\n\t\t\tisValueUpdated = isValueUpdated || true;\n\n\t\t\tif (this.#getColorByValue(Number(counter.VALUE), counter.STYLE) === Counters.COLOR_SUCCESS)\n\t\t\t{\n\t\t\t\tcanResetReadAll = true;\n\t\t\t}\n\t\t});\n\n\t\tif (canResetReadAll && (!this.isUserTaskList() || this.isMyTaskList()))\n\t\t{\n\t\t\tthis.#updateReadAllItem(canResetReadAll);\n\t\t}\n\n\t\tif (parentId)\n\t\t{\n\t\t\tconst item = this.getItemById(parentId);\n\t\t\titem.updateValue(parentTotal);\n\t\t}\n\t}\n\n\trender(): void\n\t{\n\t\tsuper.init();\n\n\t\tthis.renderChatButton();\n\t}\n\n\trenderChatButton(): void\n\t{\n\t\tconst container = document.getElementById('tasks-chat-button');\n\n\t\tif (!container || !this.tasksChatUri)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.chatButton = new Button({\n\t\t\ttext: Loc.getMessage('TASKS_COUNTERS_CHAT_BUTTON'),\n\t\t\tonclick: () => this.handleChatButtonClick(),\n\t\t\tstyle: AirButtonStyle.OUTLINE,\n\t\t\tsize: ButtonSize.SMALL,\n\t\t\tuseAirDesign: true,\n\t\t});\n\n\t\tthis.initChatButtonCounter();\n\n\t\tthis.chatButton.renderTo(container);\n\t}\n\n\tasync handleChatButtonClick(): void\n\t{\n\t\tconst { Messenger } = await top.BX.Runtime.loadExtension('im.public');\n\n\t\tif (Messenger?.isEmbeddedMode() || Messenger?.isMessengerSliderOpened())\n\t\t{\n\t\t\tBX.SidePanel.Instance.emulateAnchorClick('/online/?IM_TASK');\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.SidePanel.Instance.emulateAnchorClick(this.tasksChatUri);\n\n\t\tsendData({\n\t\t\ttool: 'tasks',\n\t\t\tcategory: 'chat_operations',\n\t\t\ttype: 'task',\n\t\t\tevent: 'click_chat_tasks',\n\t\t\tc_section: 'task',\n\t\t\tc_sub_section: this.viewState,\n\t\t\tc_element: 'chat_tasks_button',\n\t\t});\n\t}\n\n\tinitChatButtonCounter(): void\n\t{\n\t\tif (this.counters.new_comments_total && this.chatButton)\n\t\t{\n\t\t\tconst value = Number(this.counters.new_comments_total.VALUE);\n\n\t\t\tif (this.chatButton.getLeftCounter())\n\t\t\t{\n\t\t\t\tthis.chatButton.getLeftCounter().setValue(value);\n\t\t\t\tthis.chatButton.getLeftCounter().setColor(this.getChatButtonCounterColor(value));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.chatButton.setLeftCounter({\n\t\t\t\tvalue,\n\t\t\t\tcolor: this.getChatButtonCounterColor(value),\n\t\t\t});\n\t\t}\n\t}\n\n\tgetChatButtonCounterColor(value): String\n\t{\n\t\treturn value ? ButtonCounterStyle.FILLED_SUCCESS : ButtonCounterStyle.OUTLINE_NO_ACCENT;\n\t}\n\n\tconnectWithFilter(): void\n\t{\n\t\tthis.filter = new Filter({\n\t\t\tfilterId: this.#filterId,\n\t\t});\n\n\t\tthis.bindEvents();\n\n\t\tthis.#markCounters();\n\t}\n\n\t#markCounters(): void\n\t{\n\t\tlet parentId = null;\n\t\tlet canResetReadAll = false;\n\n\t\tObject.values(this.elements).forEach((element) => {\n\t\t\tconst item = this.getItemById(element.id);\n\t\t\tconst isFiltered = this.filter.isFilteredByFieldValue(element.filterField, element.filterValue);\n\n\t\t\tif (item.color === Counters.COLOR_SUCCESS)\n\t\t\t{\n\t\t\t\tcanResetReadAll = true;\n\t\t\t}\n\n\t\t\tif (isFiltered)\n\t\t\t{\n\t\t\t\tif (item.hasParentId())\n\t\t\t\t{\n\t\t\t\t\tparentId = item.parentId;\n\t\t\t\t}\n\n\t\t\t\titem.activate(false);\n\t\t\t}\n\t\t});\n\n\t\tif (canResetReadAll && (!this.isUserTaskList() || this.isMyTaskList()))\n\t\t{\n\t\t\tthis.#updateReadAllItem(canResetReadAll);\n\t\t}\n\n\t\tif (parentId)\n\t\t{\n\t\t\tthis.getItemById(parentId).activate(false);\n\t\t}\n\t}\n\n\t#updateReadAllItem(canResetReadAll: Boolean)\n\t{\n\t\tconst readAllItem = this.getItemById(Counters.READ_ALL_ID);\n\n\t\tif (canResetReadAll && readAllItem.isLocked())\n\t\t{\n\t\t\treadAllItem.unLock();\n\t\t}\n\n\t\tif (!canResetReadAll && !readAllItem.isLocked())\n\t\t{\n\t\t\treadAllItem.lock();\n\t\t}\n\t}\n\n\t#sendAnalyticsEvent(item: CounterItem): void\n\t{\n\t\tsendData({\n\t\t\ttool: 'tasks',\n\t\t\tcategory: 'task_operations',\n\t\t\ttype: 'task',\n\t\t\tevent: this.#getAnalyticsEvent(item),\n\t\t\tc_section: this.#getAnalyticsSection(item),\n\t\t\tc_element: this.#getAnalyticsElement(item),\n\t\t});\n\t}\n\n\t#getAnalyticsEvent(item: CounterItem)\n\t{\n\t\tif (Counters.counterTypes.expired.includes(item.id))\n\t\t{\n\t\t\treturn 'overdue_counters_on';\n\t\t}\n\n\t\treturn 'comments_counters_on';\n\t}\n\n\t#getAnalyticsSection(item: CounterItem)\n\t{\n\t\tif (Counters.counterTypes.scrum.includes(item.id))\n\t\t{\n\t\t\treturn 'scrum';\n\t\t}\n\n\t\tif (Counters.counterTypes.project.includes(item.id))\n\t\t{\n\t\t\treturn 'project';\n\t\t}\n\n\t\treturn 'tasks';\n\t}\n\n\t#getAnalyticsElement(item: CounterItem)\n\t{\n\t\tif (Counters.counterTypes.expired.includes(item.id))\n\t\t{\n\t\t\treturn 'overdue_counters_filter';\n\t\t}\n\n\t\treturn 'comments_counters_filter';\n\t}\n}\n"],"names":["Filter","options","filterId","filterManager","BX","Main","getById","bindEvents","updateFields","EventEmitter","subscribe","onFilterApply","bind","fields","getFilterFieldsValues","field","Object","keys","includes","Type","isArray","length","value","isFilteredByField","name","filterField","filterValue","isFilteredByFieldValue","getApi","extendFilter","COUNTER_TYPE","getFilterFields","forEach","getAttribute","getFields","deleteField","getSearch","apply","Counters","my","other","additional","expired","comment","project","scrum","target","renderTo","items","multiselect","title","Loc","getMessage","userId","targetUserId","groupId","counters","initialCounterTypes","counterTypes","role","signedParameters","tasksChatUri","viewState","chatButton","setData","initPull","elements","getCounterItems","setItems","otherCounters","isUserTaskList","isProjectsTaskList","PULL","moduleId","callback","data","processPullEvent","extendWatch","isProjectList","tagId","setTimeout","eventHandlers","user_counter","onUserCounter","project_counter","onProjectCounter","comment_read_all","onCommentReadAll","has","prototype","hasOwnProperty","command","params","call","method","Event","window","Runtime","throttle","getItemById","READ_ALL_ID","expand","collapse","isRoleChanged","getItems","item","deactivate","updateRole","updateCountersData","values","element","id","isFiltered","filter","updateTimeout","needUpdate","Ajax","runComponentAction","mode","then","response","rerender","console","log","timeoutTTL","ROLEID","isMyTaskList","Number","isSonetEnabled","undefined","parentTotal","parentItemId","hasOther","availableTypes","Set","entries","type","VALUE","push","getCounterNameByType","order","parentId","color","STYLE","FILTER_FIELD","FILTER_VALUE","isRestricted","collapsedIcon","collapsed","locked","dataAttributes","COLOR_THEME","myCounters","counterItem","Viewed","userComments","allCounters","counter","updateCount","projectComments","scrumComments","initChatButtonCounter","canResetReadAll","code","hasParentId","updateValue","updateColor","COLOR_SUCCESS","renderChatButton","container","document","getElementById","Button","text","onclick","handleChatButtonClick","style","AirButtonStyle","OUTLINE","size","ButtonSize","SMALL","useAirDesign","top","loadExtension","Messenger","isEmbeddedMode","isMessengerSliderOpened","SidePanel","Instance","emulateAnchorClick","sendData","tool","category","event","c_section","c_sub_section","c_element","new_comments_total","getLeftCounter","setValue","setColor","getChatButtonCounterColor","setLeftCounter","ButtonCounterStyle","FILLED_SUCCESS","OUTLINE_NO_ACCENT","CounterPanel","getData","getId","readAllByRole","scrum_total_comments","scrum_foreign_comments","readAllForScrum","readAllForProjects","lock","innerWidth","itemId","count","toggleByField","emit","activate","parent","childItemId","childItem","isActive","parentItem","COLOR_GRAY","toUpperCase","readAllItem","isLocked","unLock"],"mappings":"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"}