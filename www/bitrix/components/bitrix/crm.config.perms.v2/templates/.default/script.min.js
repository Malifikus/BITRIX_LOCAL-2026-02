(function(e,t,n,i,s){"use strict";function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){a(e,t);t.add(e)}function a(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function u(e,t,n){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return n}var l=t.Reflection.namespace("BX.Crm");var h=new WeakSet;var d=new WeakSet;var f=new WeakSet;var g=new WeakSet;var p=new WeakSet;var m=new WeakSet;var v=function(){function e(t){var n;babelHelpers.classCallCheck(this,e);c(this,m);c(this,p);c(this,g);c(this,f);c(this,d);c(this,h);this.AccessRightsOption=t.AccessRightsOption;this.AccessRights=t.AccessRights;this.hasLeftMenu=t.hasLeftMenu;this.menuId=t.menuId;this.useAirDesign=(n=t.useAirDesign)!==null&&n!==void 0?n:false}babelHelpers.createClass(e,[{key:"init",value:function e(){this.AccessRights.draw();u(this,f,y).call(this);if(this.hasLeftMenu){u(this,h,w).call(this);u(this,d,A).call(this)}}},{key:"openPermission",value:function e(t){if(this.menuId===t.menuId){return}if(!this.AccessRights.hasUnsavedChanges()){this.redrawAccessRight(t)}else{event.stopImmediatePropagation();u(this,p,S).call(this,t)}}},{key:"redrawAccessRight",value:function e(t){var n=this;var i=new BX.Loader({target:document.getElementById("bx-crm-perms-config-permissions")});var r=this.AccessRights.getSelectedMember();this.AccessRights.destroy();i.show();u(this,g,R).call(this,t).then((function(e){var i=e.accessRightsData,c=e.maxVisibleUserGroups,a=e.additionalSaveParams,u=e.userSortConfig,l=e.userSortConfigName;n.AccessRightsOption=o(o({},n.AccessRightsOption),{},{userGroups:i.userGroups,accessRights:i.accessRights,maxVisibleUserGroups:c,additionalSaveParams:a,userSortConfig:u,userSortConfigName:l,selectedMember:r});n.AccessRights=new s.App(n.AccessRightsOption);n.AccessRights.draw();scrollTo({top:0});n.menuId=t.menuId}))["catch"]((function(e){var t,i;console.warn("ui.accessrights.v2: error during redraw",e);u(n,m,O).call(n,(e===null||e===void 0?void 0:(t=e.errors)===null||t===void 0?void 0:(i=t[0])===null||i===void 0?void 0:i.message)||"Something went wrong")}))["finally"]((function(){i.hide()}))}}]);return e}();function w(){var e=document.getElementById("ui-page-slider-content");if(e){var t=document.createElement("div");t.className="crm-config-perms-v2-slider-content";e.parentNode.insertBefore(t,e);t.appendChild(e)}}function A(){var e=document.getElementById("left-panel");if(e){var t=document.createElement("div");t.className="crm-config-perms-v2-sidebar";e.parentNode.insertBefore(t,e);t.appendChild(e)}}function y(){var e=t.Reflection.getClass("top.BX.Helper");var n=new i.Button({size:i.ButtonSize.SMALL,text:t.Loc.getMessage("CRM_CONFIG_PERMS_HELP_MSGVER_1"),style:i.AirButtonStyle.OUTLINE_NO_ACCENT,useAirDesign:true,onclick:function t(){var n="23240636";e===null||e===void 0?void 0:e.show("redirect=detail&code=".concat(n))}});var s=document.querySelector(".crm-config-perms-v2-header");n.renderTo(s)}function R(e){return new Promise((function(n,i){t.ajax.runComponentAction("bitrix:crm.config.perms.v2","getData",{mode:"class",data:{controllerData:e}}).then((function(e){n(e.data)}))["catch"](i)}))}function S(e){var s=this;var r=n.MessageBox.create({message:t.Loc.getMessage("CRM_CONFIG_PERMS_SAVE_POPUP_TITLE"),modal:true,useAirDesign:true,buttons:[new i.SaveButton({size:i.ButtonSize.LARGE,style:i.AirButtonStyle.FILLED,useAirDesign:true,onclick:function t(n){n.setWaiting(true);s.AccessRights.sendActionRequest().then((function(){document.querySelector('[data-menu-id="'.concat(e.menuId,'"]')).click()}))["catch"]()["finally"]((function(){r.close()}))}}),new i.CancelButton({text:t.Loc.getMessage("CRM_CONFIG_PERMS_SAVE_POPUP_CANCEL"),size:i.ButtonSize.LARGE,style:i.AirButtonStyle.OUTLINE,useAirDesign:true,onclick:function e(){r.close()}})],popupOptions:{fixed:true}});r.show()}function O(e){BX.UI.Notification.Center.notify({content:e,position:"top-right",autoHideDelay:3e3})}l.ConfigPermsComponent=v})(this.window=this.window||{},BX,BX.UI.Dialogs,BX.UI,BX.UI.AccessRights.V2);
//# sourceMappingURL=script.map.js