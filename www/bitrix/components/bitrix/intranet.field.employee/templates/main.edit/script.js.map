{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Reflection, defer, fireEvent } from 'main.core';\nimport { TagSelector } from 'ui.entity-selector';\n\nconst namespace = Reflection.namespace('BX.Intranet.UserField');\n\ntype EmployeeEditorParams = {\n\tselectorName: string,\n\tisMultiple: boolean,\n\tfieldNameJs: string,\n\tselectedItems: Set<string, string>,\n}\n\nclass EmployeeEditor\n{\n\tselectorName: string;\n\tisMultiple: boolean;\n\tfieldNameJs: string;\n\tselectedItems: Set<string, string>;\n\n\tconstructor(params: EmployeeEditorParams)\n\t{\n\t\tthis.selectorName = params.selectorName || '';\n\t\tthis.isMultiple = params.isMultiple === true;\n\t\tthis.fieldNameJs = params.fieldNameJs || '';\n\t\tthis.selectedItems = new Set(params.selectedItems || []);\n\n\t\tthis.initTagSelector(params);\n\t}\n\n\tinitTagSelector()\n\t{\n\t\tconst container = document.getElementById(`cont_${this.selectorName}`);\n\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t(new TagSelector({\n\t\t\tmultiple: this.isMultiple,\n\t\t\tdialogOptions: {\n\t\t\t\tcontext: `entity_selector_${this.selectorName}`,\n\t\t\t\twidth: 450,\n\t\t\t\theight: 300,\n\t\t\t\tpreselectedItems: [...this.selectedItems],\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\temailUsers: false,\n\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\t\tinviteGuestLink: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t}, {\n\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tselectMode: 'usersOnly',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tonAfterTagAdd: (event) => this.onAfterTagUpdate(event),\n\t\t\t\tonAfterTagRemove: (event) => this.onAfterTagUpdate(event),\n\t\t\t},\n\t\t})).renderTo(container);\n\t}\n\n\tonAfterTagUpdate(event)\n\t{\n\t\tconst tags = event.getTarget().tags;\n\t\tconst ids = tags.map((tag) => tag.id);\n\n\t\tthis.setData(ids);\n\t}\n\n\tsetData(values)\n\t{\n\t\tconst valueContainer = document.getElementById(`value_${this.selectorName}`);\n\n\t\tif (!valueContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet html = '';\n\t\tif (values.length > 0)\n\t\t{\n\t\t\tif (this.isMultiple)\n\t\t\t{\n\t\t\t\tfor (const value of values)\n\t\t\t\t{\n\t\t\t\t\thtml += `<input type=\"hidden\" name=\"${this.fieldNameJs}\" value=\"${BX.util.htmlspecialchars(value)}\">`;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thtml += `<input type=\"hidden\" name=\"${this.fieldNameJs}\" value=\"${BX.util.htmlspecialchars(values[0])}\">`;\n\t\t\t}\n\t\t}\n\n\t\tif (html.length <= 0)\n\t\t{\n\t\t\thtml = `<input type=\"hidden\" name=\"${this.fieldNameJs}\" value=\"\">`;\n\t\t}\n\t\tvalueContainer.innerHTML = html;\n\n\t\tdefer(() => {\n\t\t\tfireEvent(valueContainer.firstChild, 'change');\n\t\t})();\n\t}\n}\n\nnamespace.EmployeeEditor = EmployeeEditor;\n"],"names":["namespace","Reflection","EmployeeEditor","params","selectorName","isMultiple","fieldNameJs","selectedItems","Set","initTagSelector","container","document","getElementById","TagSelector","multiple","dialogOptions","context","width","height","preselectedItems","entities","id","options","emailUsers","intranetUsersOnly","inviteEmployeeLink","inviteGuestLink","selectMode","events","onAfterTagAdd","event","onAfterTagUpdate","onAfterTagRemove","renderTo","tags","getTarget","ids","map","tag","setData","values","valueContainer","html","length","value","BX","util","htmlspecialchars","innerHTML","defer","fireEvent","firstChild"],"mappings":"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"}