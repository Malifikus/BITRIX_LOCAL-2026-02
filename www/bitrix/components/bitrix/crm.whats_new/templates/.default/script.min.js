(function(exports,crm_integration_ui_bannerDispatcher,main_core,main_core_events,main_popup,ui_buttons,ui_tour){"use strict";var _templateObject,_templateObject2,_templateObject3;function _regeneratorRuntime(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function t(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,r=Object.defineProperty||function(e,t,i){e[t]=i.value},n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function e(t,i,r){return t[i]=r}}function c(e,t,i,n){var a=t&&t.prototype instanceof h?t:h,s=Object.create(a.prototype),o=new H(n||[]);return r(s,"_invoke",{value:P(e,i,o)}),s}function u(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var p={};function h(){}function d(){}function v(){}var _={};l(_,a,(function(){return this}));var f=Object.getPrototypeOf,b=f&&f(f(M([])));b&&b!==t&&i.call(b,a)&&(_=b);var g=v.prototype=h.prototype=Object.create(_);function w(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function m(e,t){function n(r,a,s,o){var l=u(e[r],e,a);if("throw"!==l.type){var c=l.arg,p=c.value;return p&&"object"==babelHelpers["typeof"](p)&&i.call(p,"__await")?t.resolve(p.__await).then((function(e){n("next",e,s,o)}),(function(e){n("throw",e,s,o)})):t.resolve(p).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,o)}))}o(l.arg)}var a;r(this,"_invoke",{value:function e(i,r){function s(){return new t((function(e,t){n(i,r,e,t)}))}return a=a?a.then(s,s):s()}})}function P(e,t,i){var r="suspendedStart";return function(n,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===n)throw a;return F()}for(i.method=n,i.arg=a;;){var s=i.delegate;if(s){var o=y(s,i);if(o){if(o===p)continue;return o}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===r)throw r="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r="executing";var l=u(e,t,i);if("normal"===l.type){if(r=i.done?"completed":"suspendedYield",l.arg===p)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r="completed",i.method="throw",i.arg=l.arg)}}}function y(e,t){var i=t.method,r=e.iterator[i];if(undefined===r)return t.delegate=null,"throw"===i&&e.iterator["return"]&&(t.method="return",t.arg=undefined,y(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),p;var n=u(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,p;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,p):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function G(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function H(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function M(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(i.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=undefined,t.done=!0,t};return n.next=n}}return{next:F}}function F(){return{value:undefined,done:!0}}return d.prototype=v,r(g,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:d,configurable:!0}),d.displayName=l(v,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,l(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},w(m.prototype),l(m.prototype,s,(function(){return this})),e.AsyncIterator=m,e.async=function(t,i,r,n,a){void 0===a&&(a=Promise);var s=new m(c(t,i,r,n),a);return e.isGeneratorFunction(i)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},w(g),l(g,o,"Generator"),l(g,a,(function(){return this})),l(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=M,H.prototype={constructor:H,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(G),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var r=this;function n(e,i){return o.type="throw",o.arg=t,r.next=e,i&&(r.method="next",r.arg=undefined),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var l=i.call(s,"catchLoc"),c=i.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function e(t,r){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var s=a;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=r&&r<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=r,s?(this.method="next",this.next=s.finallyLoc,p):this.complete(o)},complete:function e(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),p},finish:function e(t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),G(r),p}},catch:function e(t){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;G(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function e(t,i,r){return this.delegate={iterator:M(t),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=undefined),p}},e}function ownKeys(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(i),!0).forEach((function(t){babelHelpers.defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function _classPrivateMethodInitSpec(e,t){_checkPrivateRedeclaration(e,t);t.add(e)}function _classPrivateFieldInitSpec(e,t,i){_checkPrivateRedeclaration(e,t);t.set(e,i)}function _checkPrivateRedeclaration(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function _classPrivateMethodGet(e,t,i){if(!t.has(e)){throw new TypeError("attempted to get private field on non-instance")}return i}var namespaceCrmWhatsNew=main_core.Reflection.namespace("BX.Crm.WhatsNew");var _slides=new WeakMap;var _steps=new WeakMap;var _options=new WeakMap;var _popup=new WeakMap;var _bannerDispatcher=new WeakMap;var _closeOptionName=new WeakMap;var _closeOptionCategory=new WeakMap;var _isViewHappened=new WeakMap;var _autoscroll=new WeakMap;var _prepareSlides=new WeakSet;var _getPreparedSlideHtml=new WeakSet;var _getBannerDispatcher=new WeakSet;var _getPrepareSlideButtons=new WeakSet;var _prepareSteps=new WeakSet;var _showStepByEvent=new WeakSet;var _runGuideWithBannerDispatcher=new WeakSet;var _onGuideFinish=new WeakSet;var _runGuide=new WeakSet;var _getAvailableTarget=new WeakSet;var _getDefaultStepEventName=new WeakSet;var _isMultipleViewsAllowed=new WeakSet;var _showHelpDesk=new WeakSet;var _executeWhatsNew=new WeakSet;var _executeGuide=new WeakSet;var _isAnyPopupShown=new WeakSet;var _showGuide=new WeakSet;var _onBeforeShow=new WeakSet;var _isVisibleTargetNode=new WeakSet;var _getTargetNodeScrollTop=new WeakSet;var _scrollToWithPromise=new WeakSet;var ActionViewMode=function(){function ActionViewMode(e){var t=e.slides,i=e.steps,r=e.options,n=e.closeOptionCategory,a=e.closeOptionName;babelHelpers.classCallCheck(this,ActionViewMode);_classPrivateMethodInitSpec(this,_scrollToWithPromise);_classPrivateMethodInitSpec(this,_getTargetNodeScrollTop);_classPrivateMethodInitSpec(this,_isVisibleTargetNode);_classPrivateMethodInitSpec(this,_onBeforeShow);_classPrivateMethodInitSpec(this,_showGuide);_classPrivateMethodInitSpec(this,_isAnyPopupShown);_classPrivateMethodInitSpec(this,_executeGuide);_classPrivateMethodInitSpec(this,_executeWhatsNew);_classPrivateMethodInitSpec(this,_showHelpDesk);_classPrivateMethodInitSpec(this,_isMultipleViewsAllowed);_classPrivateMethodInitSpec(this,_getDefaultStepEventName);_classPrivateMethodInitSpec(this,_getAvailableTarget);_classPrivateMethodInitSpec(this,_runGuide);_classPrivateMethodInitSpec(this,_onGuideFinish);_classPrivateMethodInitSpec(this,_runGuideWithBannerDispatcher);_classPrivateMethodInitSpec(this,_showStepByEvent);_classPrivateMethodInitSpec(this,_prepareSteps);_classPrivateMethodInitSpec(this,_getPrepareSlideButtons);_classPrivateMethodInitSpec(this,_getBannerDispatcher);_classPrivateMethodInitSpec(this,_getPreparedSlideHtml);_classPrivateMethodInitSpec(this,_prepareSlides);_classPrivateFieldInitSpec(this,_slides,{writable:true,value:void 0});_classPrivateFieldInitSpec(this,_steps,{writable:true,value:void 0});_classPrivateFieldInitSpec(this,_options,{writable:true,value:void 0});_classPrivateFieldInitSpec(this,_popup,{writable:true,value:void 0});_classPrivateFieldInitSpec(this,_bannerDispatcher,{writable:true,value:null});_classPrivateFieldInitSpec(this,_closeOptionName,{writable:true,value:void 0});_classPrivateFieldInitSpec(this,_closeOptionCategory,{writable:true,value:void 0});_classPrivateFieldInitSpec(this,_isViewHappened,{writable:true,value:false});_classPrivateFieldInitSpec(this,_autoscroll,{writable:true,value:null});babelHelpers.classPrivateFieldSet(this,_slides,[]);babelHelpers.classPrivateFieldSet(this,_steps,[]);babelHelpers.classPrivateFieldSet(this,_options,r);babelHelpers.classPrivateFieldSet(this,_popup,null);this.slideClassName="crm-whats-new-slides-wrapper";babelHelpers.classPrivateFieldSet(this,_closeOptionCategory,main_core.Type.isString(n)?n:"");babelHelpers.classPrivateFieldSet(this,_closeOptionName,main_core.Type.isString(a)?a:"");this.onClickClose=this.onClickCloseHandler.bind(this);this.whatNewPromise=null;this.tourPromise=null;_classPrivateMethodGet(this,_prepareSlides,_prepareSlides2).call(this,t);_classPrivateMethodGet(this,_prepareSteps,_prepareSteps2).call(this,i)}babelHelpers.createClass(ActionViewMode,[{key:"show",value:function e(){if(babelHelpers.classPrivateFieldGet(this,_options).isNumberOfViewsExceeded){console.warn("Number of views exceeded");return}if(babelHelpers.classPrivateFieldGet(this,_slides).length>0){_classPrivateMethodGet(this,_executeWhatsNew,_executeWhatsNew2).call(this)}else if(babelHelpers.classPrivateFieldGet(this,_steps).length>0){_classPrivateMethodGet(this,_executeGuide,_executeGuide2).call(this)}}},{key:"onClickCloseHandler",value:function e(){var t=babelHelpers.classPrivateFieldGet(this,_popup).getLastPosition();var i=babelHelpers.classPrivateFieldGet(this,_popup).getPositionBySlide(babelHelpers.classPrivateFieldGet(this,_popup).getCurrentSlide());if(i>=t){babelHelpers.classPrivateFieldGet(this,_popup).destroy()}else{babelHelpers.classPrivateFieldGet(this,_popup).selectNextSlide()}}},{key:"createGuideInstance",value:function createGuideInstance(Guide,steps,onEvents){var _babelHelpers$classPr,_this=this;var guide=new Guide({onEvents:onEvents,canShowWithoutTarget:(_babelHelpers$classPr=babelHelpers.classPrivateFieldGet(this,_options).canShowWithoutTarget)!==null&&_babelHelpers$classPr!==void 0?_babelHelpers$classPr:false,steps:steps.map((function(step){var _step$buttons;var highlighter=null;if(main_core.Type.isPlainObject(step.highlighter)){highlighter=step.highlighter;delete step.highlighter}if(main_core.Type.isPlainObject(step.autoscroll)){babelHelpers.classPrivateFieldSet(_this,_autoscroll,step.autoscroll);delete step.autoscroll}return _objectSpread(_objectSpread({},step),{},{buttons:(_step$buttons=step.buttons)===null||_step$buttons===void 0?void 0:_step$buttons.map((function(button){return{text:button.text,event:function event(){var _button$onclick,_button$onclick2;if(main_core.Type.isStringFilled((_button$onclick=button.onclick)===null||_button$onclick===void 0?void 0:_button$onclick.code)){eval(button.onclick.code)}if((_button$onclick2=button.onclick)!==null&&_button$onclick2!==void 0&&_button$onclick2.closeAfterClick){guide.close()}}}})),events:{onShow:function e(t){var i=t.data;if(!i){return}if(i.guide.steps.length===1){var r="crm-whats-new-slide-air";if(main_core.Type.isArrayFilled(i.guide.steps[0].buttons)){r+=" --with-buttons"}if(main_core.Type.isStringFilled(i.guide.steps[0].iconSrc)){r+=" --with-icon"}main_core.Dom.addClass(i.guide.getPopup().getPopupContainer(),r)}if(!highlighter){return}void BX.Runtime.loadExtension("ui.system.highlighter").then((function(){document.querySelectorAll(highlighter.target).forEach((function(e){var t=main_core.Tag.render(_templateObject||(_templateObject=babelHelpers.taggedTemplateLiteral(['<span class="ui-highlighter"></span>'])));if(main_core.Type.isNumber(highlighter.radius)){main_core.Dom.style(t,"--ui-highlighter-radius","".concat(highlighter.radius,"px"))}main_core.Dom.append(t,e)}))}))},onClose:function e(){if(!highlighter){return}document.querySelectorAll(highlighter.target).forEach((function(e){main_core.Dom.remove(e.querySelector(".ui-highlighter"))}))}}})})),events:{onFinish:function e(){if(babelHelpers.classPrivateFieldGet(_this,_slides).length===0){_this.save()}}}});return guide}},{key:"setStepPopupOptions",value:function e(t){var i;var r=babelHelpers.classPrivateFieldGet(this,_options),n=r.steps,a=r.hideTourOnMissClick,s=a===void 0?false:a;t.setAutoHide(s);if(n!==null&&n!==void 0&&(i=n.popup)!==null&&i!==void 0&&i.width){t.setWidth(n.popup.width)}}},{key:"save",value:function e(){var t,i,r=this;main_core.ajax.runAction("crm.settings.tour.updateOption",{json:{category:babelHelpers.classPrivateFieldGet(this,_closeOptionCategory),name:babelHelpers.classPrivateFieldGet(this,_closeOptionName),options:{isMultipleViewsAllowed:!babelHelpers.classPrivateFieldGet(this,_isViewHappened)&&_classPrivateMethodGet(this,_isMultipleViewsAllowed,_isMultipleViewsAllowed2).call(this),numberOfViewsLimit:(t=babelHelpers.classPrivateFieldGet(this,_options).numberOfViewsLimit)!==null&&t!==void 0?t:1,additionalTourIdsForDisable:(i=babelHelpers.classPrivateFieldGet(this,_options).additionalTourIdsForDisable)!==null&&i!==void 0?i:null}}}).then((function(e){var t=e.data;babelHelpers.classPrivateFieldGet(r,_options).isNumberOfViewsExceeded=t.isNumberOfViewsExceeded;babelHelpers.classPrivateFieldSet(r,_isViewHappened,true)}))["catch"]((function(e){console.error("Could not save tour settings",e)}))}}]);return ActionViewMode}();function _prepareSlides2(e){var t=this;if(e.length>0){this.whatNewPromise=main_core.Runtime.loadExtension("ui.dialogs.whats-new")}babelHelpers.classPrivateFieldSet(this,_slides,e.map((function(e){return{className:t.slideClassName,title:e.title,html:_classPrivateMethodGet(t,_getPreparedSlideHtml,_getPreparedSlideHtml2).call(t,e)}})))}function _getPreparedSlideHtml2(e){var t=main_core.Tag.render(_templateObject2||(_templateObject2=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-whats-new-slide">\n\t\t\t\t<img src="','" alt="">\n\t\t\t\t<div class="crm-whats-new-slide-inner-title"> '," </div>\n\t\t\t\t<p>","</p>\n\t\t\t</div>\n\t\t"])),e.innerImage,e.innerTitle,e.innerDescription);var i=_classPrivateMethodGet(this,_getPrepareSlideButtons,_getPrepareSlideButtons2).call(this,e);if(i.length>0){var r=main_core.Tag.render(_templateObject3||(_templateObject3=babelHelpers.taggedTemplateLiteral(['<div class="crm-whats-new-slide-buttons"></div>'])));main_core.Dom.append(r,t);i.forEach((function(e){main_core.Dom.append(e.getContainer(),r)}))}return t}function _getBannerDispatcher2(){return _getBannerDispatcher3.apply(this,arguments)}function _getBannerDispatcher3(){_getBannerDispatcher3=babelHelpers.asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,i;return _regeneratorRuntime().wrap((function e(r){while(1)switch(r.prev=r.next){case 0:if(!babelHelpers.classPrivateFieldGet(this,_bannerDispatcher)){r.next=2;break}return r.abrupt("return",babelHelpers.classPrivateFieldGet(this,_bannerDispatcher));case 2:r.next=4;return main_core.Runtime.loadExtension("crm.integration.ui.banner-dispatcher");case 4:t=r.sent;i=t.BannerDispatcher;babelHelpers.classPrivateFieldSet(this,_bannerDispatcher,new i);return r.abrupt("return",babelHelpers.classPrivateFieldGet(this,_bannerDispatcher));case 8:case"end":return r.stop()}}),e,this)})));return _getBannerDispatcher3.apply(this,arguments)}function _getPrepareSlideButtons2(e){var t=this;var i=[];if(e.buttons){var r="ui-btn ui-btn-primary ui-btn-hover ui-btn-round ";i=e.buttons.map((function(e){var i;var n={className:r+((i=e.className)!==null&&i!==void 0?i:""),text:e.text};if(e.onClickClose){n.onclick=function(){return t.onClickClose()}}else if(e.helpDeskCode){n.onclick=function(){return _classPrivateMethodGet(t,_showHelpDesk,_showHelpDesk2).call(t,e.helpDeskCode)}}return new ui_buttons.Button(n)}))}return i}function _prepareSteps2(e){var t=this;babelHelpers.classPrivateFieldSet(this,_steps,e.map((function(e){var i,r,n,a;var s={id:e.id,title:e.title,text:e.text,position:e.position,article:e.article,articleAnchor:(i=e.articleAnchor)!==null&&i!==void 0?i:null,infoHelperCode:e.infoHelperCode,buttons:e.buttons,highlighter:(r=e.highlighter)!==null&&r!==void 0?r:null,autoscroll:(n=e.autoscroll)!==null&&n!==void 0?n:null,iconSrc:(a=e.iconSrc)!==null&&a!==void 0?a:null};if(e.useDynamicTarget){var o;var l=(o=e.eventName)!==null&&o!==void 0?o:_classPrivateMethodGet(t,_getDefaultStepEventName,_getDefaultStepEventName2).call(t,s.id);main_core_events.EventEmitter.subscribeOnce(l,_classPrivateMethodGet(t,_showStepByEvent,_showStepByEvent2).bind(t))}else{var c=_classPrivateMethodGet(t,_getAvailableTarget,_getAvailableTarget2).call(t,e.target);if(c&&main_core.Dom.style(c,"display")!=="none"){s.target=e.target}else if(main_core.Type.isArrayFilled(e.reserveTargets)){var u=e.reserveTargets.some((function(e){var i=_classPrivateMethodGet(t,_getAvailableTarget,_getAvailableTarget2).call(t,e);if(i&&main_core.Dom.style(i,"display")!=="none"){s.target=e;return true}return false}));if(!u&&e.ignoreIfTargetNotFound){return null}}else if(e.ignoreIfTargetNotFound){return null}else{s.target=e.target}}return s})));babelHelpers.classPrivateFieldSet(this,_steps,babelHelpers.classPrivateFieldGet(this,_steps).filter((function(e){return e!==null})));if(babelHelpers.classPrivateFieldGet(this,_steps).length>0){this.tourPromise=main_core.Runtime.loadExtension("ui.tour")}}function _showStepByEvent2(e){var t=this;var i=babelHelpers.classPrivateFieldGet(this,_options),r=i.disableBannerDispatcher,n=r===void 0?false:r;void this.tourPromise.then((function(i){var r=e.data,a=r.stepId,s=r.target;var o=babelHelpers.classPrivateFieldGet(t,_steps).find((function(e){return e.id===a}));if(!o){console.error("step not found");return}o.target=s;var l=i.Guide;var c=t.createGuideInstance(l,[o],true);t.setStepPopupOptions(c.getPopup());if(n===false){_classPrivateMethodGet(t,_runGuideWithBannerDispatcher,_runGuideWithBannerDispatcher2).call(t,c)}else{_classPrivateMethodGet(t,_runGuide,_runGuide2).call(t,c)}}))}function _runGuideWithBannerDispatcher2(e){var t=this;void _classPrivateMethodGet(this,_getBannerDispatcher,_getBannerDispatcher2).call(this).then((function(i){i.toQueue((function(i){_classPrivateMethodGet(t,_runGuide,_runGuide2).call(t,e,i)}))}))}function _onGuideFinish2(e){var t=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;e.subscribe("UI.Tour.Guide:onFinish",(function(){t.save();if(i){i()}}))}function _runGuide2(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var i=!_classPrivateMethodGet(this,_isAnyPopupShown,_isAnyPopupShown2).call(this);var r=e.steps[0].target;if(i&&main_core.Type.isStringFilled(r)){i=_classPrivateMethodGet(this,_getAvailableTarget,_getAvailableTarget2).call(this,r)!==null}if(i){_classPrivateMethodGet(this,_onGuideFinish,_onGuideFinish2).call(this,e,t);void _classPrivateMethodGet(this,_onBeforeShow,_onBeforeShow2).call(this,e).then((function(){e.showNextStep()}))}else{t()}}function _getAvailableTarget2(e){if(!main_core.Type.isStringFilled(e)){return null}var t=document.querySelector(e);return main_core.Type.isDomNode(t)?t:null}function _getDefaultStepEventName2(e){return"Crm.WhatsNew::onTargetSetted::".concat(e)}function _isMultipleViewsAllowed2(){return babelHelpers.classPrivateFieldGet(this,_options).numberOfViewsLimit>1}function _showHelpDesk2(e){if(top.BX.Helper){top.BX.Helper.show("redirect=detail&code=".concat(e));event.preventDefault()}}function _executeWhatsNew2(){var e=this;var t=babelHelpers.classPrivateFieldGet(this,_options),i=t.disableBannerDispatcher,r=i===void 0?false:i;if(_classPrivateMethodGet(this,_isAnyPopupShown,_isAnyPopupShown2).call(this)){return}void this.whatNewPromise.then((function(t){var i=t.WhatsNew;babelHelpers.classPrivateFieldSet(e,_popup,new i({slides:babelHelpers.classPrivateFieldGet(e,_slides),popupOptions:{height:440},events:{onDestroy:function t(){e.save();_classPrivateMethodGet(e,_executeGuide,_executeGuide2).call(e,false)}}}));if(r===false){void _classPrivateMethodGet(e,_getBannerDispatcher,_getBannerDispatcher2).call(e).then((function(t){t.toQueue((function(t){babelHelpers.classPrivateFieldGet(e,_popup).subscribe("onDestroy",t);babelHelpers.classPrivateFieldGet(e,_popup).show()}))}))}else{babelHelpers.classPrivateFieldGet(e,_popup).show()}ActionViewMode.whatsNewInstances.push(babelHelpers.classPrivateFieldGet(e,_popup))}),this)}function _executeGuide2(){var e=this;var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var i=babelHelpers.classPrivateFieldGet(this,_options),r=i.disableBannerDispatcher,n=r===void 0?false:r;var a=main_core.clone(babelHelpers.classPrivateFieldGet(this,_steps));a=a.filter((function(e){return Boolean(e.target)}));if(a.length===0){return}void this.tourPromise.then((function(i){if(ActionViewMode.tourInstances.some((function(e){var t;return(t=e.getPopup())===null||t===void 0?void 0:t.isShown()}))){return}if(_classPrivateMethodGet(e,_isAnyPopupShown,_isAnyPopupShown2).call(e)){return}var r=i.Guide;var s=e.createGuideInstance(r,a,babelHelpers.classPrivateFieldGet(e,_steps).length<=1);ActionViewMode.tourInstances.push(s);e.setStepPopupOptions(s.getPopup());if(t){if(n===false){_classPrivateMethodGet(e,_runGuideWithBannerDispatcher,_runGuideWithBannerDispatcher2).call(e,s)}else{_classPrivateMethodGet(e,_runGuide,_runGuide2).call(e,s)}return}_classPrivateMethodGet(e,_showGuide,_showGuide2).call(e,s)}))}function _isAnyPopupShown2(){return main_popup.PopupManager===null||main_popup.PopupManager===void 0?void 0:main_popup.PopupManager.isAnyPopupShown()}function _showGuide2(e){if(e.steps.length>1||babelHelpers.classPrivateFieldGet(this,_options).showOverlayFromFirstStep){e.start()}else{e.showNextStep()}}function _onBeforeShow2(e){var t=this;if(!main_core.Type.isPlainObject(babelHelpers.classPrivateFieldGet(this,_autoscroll))){return Promise.resolve()}var i=e.steps[0];var r=_classPrivateMethodGet(this,_getAvailableTarget,_getAvailableTarget2).call(this,i.target);if(r===null||_classPrivateMethodGet(this,_isVisibleTargetNode,_isVisibleTargetNode2).call(this,r)){return Promise.resolve()}var n=window;var a=r.parentElement;while(a){var s=window.getComputedStyle(a);var o=s.overflowY;if((o==="auto"||o==="scroll")&&a.scrollHeight>=a.clientHeight){n=a;break}a=a.parentElement}return new Promise((function(i){var s=_classPrivateMethodGet(t,_getTargetNodeScrollTop,_getTargetNodeScrollTop2).call(t,r,n);if(babelHelpers.classPrivateFieldGet(t,_autoscroll).behavior==="smooth"&&"scrollTo"in n){void _classPrivateMethodGet(t,_scrollToWithPromise,_scrollToWithPromise2).call(t,n,{top:s,behavior:"smooth"}).then((function(){i()}))}else{a.scrollTop=s;e.getPopup().adjustPosition({forceBindPosition:true});i()}}))}function _isVisibleTargetNode2(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)-200&&t.right<=(window.innerWidth||document.documentElement.clientWidth)-200}function _getTargetNodeScrollTop2(e,t){var i;var r=e.offsetTop;var n=e.offsetHeight;var a=t.clientHeight;var s=(i=babelHelpers.classPrivateFieldGet(this,_autoscroll).position)!==null&&i!==void 0?i:"auto";var o=function e(i){return Math.max(0,Math.min(i,t.scrollHeight-a))};var l=t.scrollTop;if(s==="start"){return o(r)}if(s==="center"){return o(r+n/2-a/2)}if(s==="end"){return o(r+n-a)}var c=t.scrollTop;var u=c+a;if(r<c){l=r}else if(r+n>u){l=r+n-a}return o(l)}function _scrollToWithPromise2(e,t){return new Promise((function(i){var r,n,a;var s=(r=t.top)!==null&&r!==void 0?r:e.scrollTop;var o=(n=t.left)!==null&&n!==void 0?n:e.scrollLeft;var l=(a=t.behavior)!==null&&a!==void 0?a:"auto";var c=1;if(l==="auto"){e.scrollTo(t);i();return}var u=e.scrollTop;var p=e.scrollLeft;var h=0;var d=function e(t,i){return Math.abs(t-i)<=c};var v=function t(){var r=e.scrollTop;var n=e.scrollLeft;var a=d(r,s)&&d(n,o);var l=d(r,u)&&d(n,p);if(a&&l){h++;if(h>=2){i();return}}else{h=0}u=r;p=n;requestAnimationFrame(t)};e.scrollTo(t);requestAnimationFrame(v)}))}babelHelpers.defineProperty(ActionViewMode,"tourInstances",[]);babelHelpers.defineProperty(ActionViewMode,"whatsNewInstances",[]);namespaceCrmWhatsNew.ActionViewMode=ActionViewMode})(this.window=this.window||{},BX.Crm.Integration.UI,BX,BX.Event,BX.Main,BX.UI,BX.UI.Tour);
//# sourceMappingURL=script.map.js