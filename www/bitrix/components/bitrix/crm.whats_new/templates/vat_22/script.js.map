{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { bind, Loc, Reflection, Tag, ajax as Ajax } from 'main.core';\nimport { BannerDispatcher } from 'ui.banner-dispatcher';\nimport { AirButtonStyle, Button } from 'ui.buttons';\nimport { Dialog } from 'ui.system.dialog';\n\nconst namespaceCrmWhatsNew = Reflection.namespace('BX.Crm.WhatsNew');\n\nclass Vat22Popup\n{\n\t#dialog: Dialog;\n\t#isNeedToUpdateVat22: boolean;\n\n\tconstructor()\n\t{\n\t\tthis.#dialog = null;\n\t\tthis.#isNeedToUpdateVat22 = false;\n\t}\n\n\t#renderDialogContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-whats-new-vat-22_content-description\">\n\t\t\t\t<p>${Loc.getMessage('CRM_WHATS_NEW_VAT_22_CONTENT')}</p>\n\t\t\t\t<p>${Loc.getMessage('CRM_WHATS_NEW_VAT_22_MARKETPLACE')}</p>\n\t\t\t\t<p>${this.#renderHelpDescLink()}</p>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tshow(): void\n\t{\n\t\tif (!this.#dialog)\n\t\t{\n\t\t\tthis.#dialog = new Dialog({\n\t\t\t\ttitle: Loc.getMessage('CRM_WHATS_NEW_VAT_22_TITLE'),\n\t\t\t\tcontent: this.#renderDialogContent(),\n\t\t\t\tleftButtons: [this.#renderUpdateVat22Button(), this.#renderUpdateLaterButton()],\n\t\t\t\tcloseByClickOutside: false,\n\t\t\t\twidth: 555,\n\t\t\t\thasOverlay: true,\n\t\t\t});\n\n\t\t\tBannerDispatcher.high.toQueue((onDone) => {\n\t\t\t\tthis.#dialog.subscribe('onAfterHide', () => {\n\t\t\t\t\tonDone();\n\t\t\t\t\tif (this.#isNeedToUpdateVat22)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateVat22();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.updateLater();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.#dialog.show();\n\t\t\t});\n\t\t}\n\t}\n\n\tupdateLater()\n\t{\n\t\tAjax.runAction('crm.settings.tourvat22.updateLater')\n\t\t\t.catch((errors) => {\n\t\t\t\tconsole.error(errors);\n\t\t\t});\n\t}\n\n\tupdateVat22()\n\t{\n\t\tAjax.runAction('crm.settings.tourvat22.updateVat22')\n\t\t\t.catch((errors) => {\n\t\t\t\tconsole.error(errors);\n\t\t\t});\n\t}\n\n\t#renderHelpDescLink(): HTMLElement\n\t{\n\t\tconst Helper = Reflection.getClass('top.BX.Helper');\n\t\tconst link = Tag.render`<a>${Loc.getMessage('CRM_WHATS_NEW_VAT_22_HELP_DESC')}</a>`;\n\t\tbind(link, 'click', () => {\n\t\t\tHelper?.show('redirect=detail&code=27490382');\n\t\t});\n\n\t\treturn link;\n\t}\n\n\t#renderUpdateVat22Button(): Button\n\t{\n\t\treturn new Button({\n\t\t\tstyle: AirButtonStyle.FILLED,\n\t\t\ttext: Loc.getMessage('CRM_WHATS_NEW_VAT_22_UPDATE_AUTO'),\n\t\t\tround: true,\n\t\t\tuseAirDesign: true,\n\t\t\tonclick: () => {\n\t\t\t\tthis.#isNeedToUpdateVat22 = true;\n\t\t\t\tthis.#dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n\n\t#renderUpdateLaterButton(): Button\n\t{\n\t\treturn new Button({\n\t\t\tstyle: AirButtonStyle.OUTLINE,\n\t\t\ttext: Loc.getMessage('CRM_WHATS_NEW_VAT_22_UPDATE_LATER'),\n\t\t\tround: true,\n\t\t\tuseAirDesign: true,\n\t\t\tonclick: () => {\n\t\t\t\tthis.#dialog.hide();\n\t\t\t},\n\t\t});\n\t}\n}\n\nnamespaceCrmWhatsNew.Vat22Popup = Vat22Popup;\n"],"names":["namespaceCrmWhatsNew","Reflection","namespace","Vat22Popup","Dialog","title","Loc","getMessage","content","leftButtons","closeByClickOutside","width","hasOverlay","BannerDispatcher","high","toQueue","onDone","subscribe","updateVat22","updateLater","show","Ajax","runAction","errors","console","error","Tag","render","Helper","getClass","link","bind","Button","style","AirButtonStyle","FILLED","text","round","useAirDesign","onclick","hide","OUTLINE"],"mappings":"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"}