{"version":3,"file":"script.js","sources":["src/service/side.panel.js","src/utility/request.sender.js","src/service/filter.js","src/view/header/tabs.js","src/view/view.js","src/service/disk.manager.js","src/item/task/toggle.js","src/utility/tool.js","src/item/task/name.js","src/item/task/checklist.js","src/item/task/files.js","src/item/task/comments.js","src/item/task/epic.js","src/item/task/tags.js","src/item/task/responsible.js","src/utility/story.points.storage.js","src/item/task/story.points.js","src/item/task/sub.tasks.js","src/item/item.js","src/entity/list.items.js","src/utility/tag.searcher.js","src/utility/input.js","src/entity/entity.js","src/entity/backlog/header.js","src/entity/blank.js","src/entity/dropzone.js","src/entity/empty.search.stub.js","src/entity/backlog/backlog.js","src/utility/culture.js","src/entity/sprint/header/date.js","src/entity/sprint/stats/stats.calculator.js","src/entity/sprint/stats/stats.js","src/entity/sprint/stats/completed.stats.js","src/entity/sprint/stats/expired.stats.js","src/entity/sprint/stats/active.stats.js","src/entity/sprint/stats/stats.builder.js","src/entity/sprint/header/stats.js","src/entity/sprint/header/name.js","src/entity/sprint/header/info/chart.icon.js","src/entity/sprint/header/info/counters.js","src/entity/sprint/header/info/button.js","src/entity/sprint/header/info/info.js","src/entity/sprint/header/button.js","src/entity/sprint/header/tick.js","src/entity/sprint/header/header.js","src/entity/sprint/sprint.js","src/entity/entity.storage.js","src/utility/scroller.js","src/view/plan/completed.sprints.js","src/view/plan/plan.builder.js","src/entity/action.panel.js","src/entity/search.arrows.js","src/entity/search.items.js","src/entity/sprint/sprint.mover.js","src/entity/sprint/sprint.side.panel.js","src/counters/entity.counters.js","src/item/item.mover.js","src/item/item.designer.js","src/epic/epic.js","src/pull/pull.sprint.js","src/pull/pull.item.js","src/pull/pull.epic.js","src/pull/pull.counters.js","src/counters/task.counters.js","src/utility/filter.handler.js","src/utility/decomposition.js","src/pull/pull.tag.js","src/view/plan/plan.js","src/view/header/complete.sprint.button.js","src/view/header/robot.button.js","src/view/active.sprint.js","src/view/header/burn.down.button.js","src/view/completed.sprint.js","src/entry.js"],"sourcesContent":["import {EventEmitter, BaseEvent} from 'main.core.events';\n\nexport class SidePanel extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.SidePanel');\n\n\t\t/* eslint-disable */\n\t\tthis.sidePanelManager = BX.SidePanel.Instance;\n\t\t/* eslint-enable */\n\n\t\tthis.bindEvents();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('SidePanel.Slider:onLoad', (event: BaseEvent) => {\n\t\t\tconst [sliderEvent] = event.getCompatData();\n\t\t\tconst sidePanel = sliderEvent.getSlider();\n\t\t\tsidePanel.setCacheable(false);\n\t\t\tthis.emit('onLoadSidePanel', sidePanel);\n\t\t});\n\n\t\tEventEmitter.subscribe('SidePanel.Slider:onClose', (event: BaseEvent) => {\n\t\t\tconst [sliderEvent] = event.getCompatData();\n\t\t\tconst sidePanel = sliderEvent.getSlider();\n\t\t\tthis.emit('onCloseSidePanel', sidePanel);\n\t\t});\n\t}\n\n\tisPreviousSidePanelExist(currentSidePanel): Boolean\n\t{\n\t\treturn Boolean(this.sidePanelManager.getPreviousSlider(currentSidePanel));\n\t}\n\n\tgetTopSidePanel()\n\t{\n\t\tconst topSidePanel = this.sidePanelManager.getTopSlider();\n\n\t\treturn topSidePanel ? topSidePanel : null;\n\t}\n\n\treloadTopSidePanel()\n\t{\n\t\tif (this.sidePanelManager.getTopSlider())\n\t\t{\n\t\t\tthis.sidePanelManager.getTopSlider().reload();\n\t\t}\n\t}\n\n\tcloseTopSidePanel()\n\t{\n\t\tif (this.sidePanelManager.getTopSlider())\n\t\t{\n\t\t\tthis.sidePanelManager.getTopSlider().close();\n\t\t}\n\t}\n\n\treloadPreviousSidePanel(currentSidePanel)\n\t{\n\t\tconst previousSidePanel = this.sidePanelManager.getPreviousSlider(currentSidePanel);\n\n\t\tpreviousSidePanel.reload();\n\t}\n\n\topenSidePanelByUrl(url)\n\t{\n\t\tthis.sidePanelManager.open(url);\n\t}\n\n\topenSidePanel(id, options)\n\t{\n\t\tthis.sidePanelManager.open(id, options);\n\t}\n\n\tshowByExtension(name: string, params: Object): Promise\n\t{\n\t\tconst extensionName = 'tasks.scrum.' + name.toLowerCase();\n\n\t\treturn top.BX.Runtime.loadExtension(extensionName)\n\t\t\t.then((exports) => {\n\n\t\t\t\tname = name.replaceAll('-', '');\n\n\t\t\t\tif (exports && exports[name])\n\t\t\t\t{\n\t\t\t\t\tconst extension = new exports[name](params);\n\n\t\t\t\t\textension.show();\n\n\t\t\t\t\treturn extension;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n}","import {ajax, Loc, Type} from 'main.core';\nimport {MessageBox} from 'ui.dialogs.messagebox';\n\ntype ErrorResponse = {\n\tdata: string,\n\terrors: Array,\n\tstatus: string\n}\n\nexport class RequestSender\n{\n\tconstructor(options = {})\n\t{\n\t\tthis.signedParameters = (options.signedParameters ? options.signedParameters : '');\n\t\tthis.debugMode = options.debugMode;\n\t}\n\n\tgetSignedParameters(): string\n\t{\n\t\treturn this.signedParameters;\n\t}\n\n\tsendRequest(action: string, data = {}): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runAction(action, {\n\t\t\t\tsignedParameters: this.signedParameters,\n\t\t\t\tdata: data\n\t\t\t}).then(resolve, reject);\n\t\t});\n\t}\n\n\tsendRequestToComponent(data = {}, action, analytics = {}): Promise\n\t{\n\t\tdata.debugMode = this.debugMode;\n\t\tconst config = {\n\t\t\tmode: 'class',\n\t\t\tsignedParameters: this.signedParameters,\n\t\t\tdata: data,\n\t\t};\n\n\t\tif (analytics && analytics.event)\n\t\t{\n\t\t\tconfig.analytics = analytics;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction('bitrix:tasks.scrum', action, config).then(resolve, reject);\n\t\t});\n\t}\n\n\tremoveItems(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'removeItems');\n\t}\n\n\tupdateItemSort(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'updateItemSort');\n\t}\n\n\taddTag(data): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tajax.runComponentAction('bitrix:tasks.tag.list', 'addTag', {\n\t\t\t\tmode: 'class',\n\t\t\t\tdata: data,\n\t\t\t}).then(resolve, reject);\n\t\t});\n\t}\n\n\tupdateSprintSort(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'updateSprintSort');\n\t}\n\n\tcreateSprint(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'createSprint');\n\t}\n\n\tstartSprint(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'startSprint');\n\t}\n\n\tcompleteSprint(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'completeSprint');\n\t}\n\n\tcreateTask(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(\n\t\t\tdata,\n\t\t\t'createTask',\n\t\t\t{\n\t\t\t\ttool: 'tasks',\n\t\t\t\tcategory: 'task_operations',\n\t\t\t\tevent: 'task_create',\n\t\t\t\ttype: 'task',\n\t\t\t\tc_section: 'scrum',\n\t\t\t\tc_element: 'quick_button',\n\t\t\t},\n\t\t);\n\t}\n\n\tupdateItem(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'updateItem');\n\t}\n\n\tchangeTaskResponsible(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'changeTaskResponsible');\n\t}\n\n\tgetCurrentState(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'getCurrentState');\n\t}\n\n\thasTaskInFilter(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'hasTaskInFilter');\n\t}\n\n\tremoveSprint(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'removeSprint');\n\t}\n\n\tchangeSprintName(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'changeSprintName');\n\t}\n\n\tchangeSprintDeadline(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'changeSprintDeadline');\n\t}\n\n\tgetSprintCompletedItems(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'getSprintCompletedItems');\n\t}\n\n\tgetCompletedSprints(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'getCompletedSprints');\n\t}\n\n\tgetCompletedSprintsStats(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'getCompletedSprintsStats');\n\t}\n\n\tgetItems(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'getItems');\n\t}\n\n\tsaveShortView(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'saveShortView');\n\t}\n\n\tsaveDisplayPriority(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'saveDisplayPriority');\n\t}\n\n\tgetEntityCounters(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'getEntityCounters');\n\t}\n\n\tattachFilesToTask(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'attachFilesToTask');\n\t}\n\n\tupdateTaskTags(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'updateTaskTags');\n\t}\n\n\tremoveTaskTags(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'removeTaskTags');\n\t}\n\n\tupdateItemEpics(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'updateItemEpics');\n\t}\n\n\tupdateBorderColorToLinkedItems(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'updateBorderColorToLinkedItems');\n\t}\n\n\tapplyFilter(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'applyFilter');\n\t}\n\n\tshowLinkedTasks(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'showLinkedTasks');\n\t}\n\n\tgetAllUsedItemBorderColors(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'getAllUsedItemBorderColors');\n\t}\n\n\tgetSubTaskItems(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'getSubTaskItems');\n\t}\n\n\tcreateEpic(data): Promise\n\t{\n\t\treturn this.sendRequest('bitrix:tasks.scrum.epic.createEpic', data);\n\t}\n\n\tgetEpic(data): Promise\n\t{\n\t\treturn this.sendRequest('bitrix:tasks.scrum.epic.getEpic', data);\n\t}\n\n\tgetItemData(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'getItemData');\n\t}\n\n\tgetSprintData(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'getSprintData');\n\t}\n\n\tsaveSprintVisibility(data): Promise\n\t{\n\t\treturn this.sendRequestToComponent(data, 'saveSprintVisibility');\n\t}\n\n\tshowErrorAlert(response: ErrorResponse, alertTitle?: string)\n\t{\n\t\tif (Type.isUndefined(response.errors))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (response.errors.length)\n\t\t{\n\t\t\tconst firstError = response.errors.shift();\n\t\t\tif (firstError)\n\t\t\t{\n\t\t\t\tconst errorCode = (firstError.code ? firstError.code : '');\n\n\t\t\t\tconst message = firstError.message + ' ' + errorCode;\n\t\t\t\tconst title = (alertTitle ? alertTitle : Loc.getMessage('TASKS_SCRUM_ERROR_TITLE_POPUP'));\n\n\t\t\t\tMessageBox.alert(message, title);\n\t\t\t}\n\t\t}\n\t}\n}\n","import {Dom, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {RequestSender} from '../utility/request.sender';\n\ntype ListTypeItem = {\n\tNAME: string,\n\tVALUE: string\n}\n\ntype ValueTypeField = {\n\tname: string,\n\tvalue: string\n}\n\ntype Params = {\n\tfilterId: string,\n\trequestSender?: RequestSender\n}\n\nexport class Filter extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Filter');\n\n\t\tthis.filterId = params.filterId;\n\t\tthis.requestSender = params.requestSender;\n\n\t\tthis.searchFieldApplied = false;\n\n\t\tthis.initUiFilterManager();\n\t\tthis.bindHandlers();\n\t}\n\n\tinitUiFilterManager()\n\t{\n\t\t/* eslint-disable */\n\t\tthis.filterManager = BX.Main.filterManager.getById(this.filterId);\n\t\t/* eslint-enable */\n\t}\n\n\tbindHandlers()\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onApplyFilter.bind(this));\n\t}\n\n\tisSearchFieldApplied(): boolean\n\t{\n\t\treturn this.searchFieldApplied;\n\t}\n\n\tgetSearchContainer(): HTMLElement\n\t{\n\t\treturn this.filterManager.getSearch().getContainer();\n\t}\n\n\tgetFilterManager()\n\t{\n\t\treturn this.filterManager;\n\t}\n\n\tscrollToSearchContainer()\n\t{\n\t\tconst filterSearchContainer = this.getSearchContainer();\n\n\t\tif (!this.isNodeInViewport(filterSearchContainer))\n\t\t{\n\t\t\tfilterSearchContainer.scrollIntoView(true);\n\t\t}\n\t}\n\n\tonApplyFilter(event: BaseEvent)\n\t{\n\t\tconst [filterId, values, filterInstance, promise, params] = event.getCompatData();\n\n\t\tif (filterInstance.getSearch().getSearchString())\n\t\t{\n\t\t\tthis.searchFieldApplied = true;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.searchFieldApplied = false;\n\t\t}\n\n\t\tif (this.filterId !== filterId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tparams.autoResolve = true;\n\n\t\tthis.emit('applyFilter', {\n\t\t\tpromise: promise\n\t\t});\n\t}\n\n\taddItemToListTypeField(name: string, item: ListTypeItem)\n\t{\n\t\t//todo set item to list after epic crud actions\n\n\t\tconst fieldInstances = this.filterManager.getField(name);\n\t\tconst fieldOptions = this.filterManager.getFieldByName(name);\n\n\t\tif (!fieldInstances || !fieldOptions)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst found = fieldInstances.options.ITEMS.find((listItem) => listItem.NAME === item.NAME);\n\t\tif (!Type.isUndefined(found))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfieldInstances.options.ITEMS.push(item);\n\t\tfieldOptions.ITEMS.push(item);\n\n\t\tconst itemsNode = fieldInstances.node.querySelector('[data-name='+name+']');\n\n\t\tconst items = Dom.attr(itemsNode, 'data-items');\n\t\titems.push(item);\n\t\tDom.attr(itemsNode, 'data-items', items);\n\t}\n\n\tsetValueToField(value: ValueTypeField)\n\t{\n\t\tthis.filterManager.getApi().extendFilter({[value.name]: value.value});\n\t}\n\n\tsetValuesToField(values: ValueTypeField[])\n\t{\n\t\tthis.filterManager.getApi().extendFilter(\n\t\t\tvalues.reduce((res, value) => ({ ...res, [value.name]: value.value}), {})\n\t\t);\n\t}\n\n\tgetValueFromField(value: ValueTypeField): string\n\t{\n\t\tconst filterFieldsValues = this.filterManager.getFilterFieldsValues();\n\t\treturn filterFieldsValues[value.name];\n\t}\n\n\tresetFilter()\n\t{\n\t\tthis.filterManager.resetFilter();\n\t}\n\n\tapplyFilter()\n\t{\n\t\tthis.filterManager.applyFilter();\n\t}\n\n\tisNodeInViewport(element: HTMLElement): boolean\n\t{\n\t\tconst rect = element.getBoundingClientRect();\n\t\treturn (\n\t\t\trect.top >= 0 &&\n\t\t\trect.left >= 0 &&\n\t\t\trect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&\n\t\t\trect.right <= (window.innerWidth || document.documentElement.clientWidth)\n\t\t);\n\t}\n}","import { Type } from 'main.core';\n\nimport { SidePanel } from '../../service/side.panel';\nimport type { Views } from '../view';\nimport { NavigationPanel } from 'ui.navigationpanel';\n\ntype Params = {\n\tsidePanel: SidePanel,\n\tviews: Views,\n\ttarget: HTMLElement,\n}\n\nexport class Tabs extends NavigationPanel\n{\n\tconstructor(params: Params): void\n\t{\n\t\tparams.views.forEach((view) => {\n\t\t\tif (Type.isStringFilled(view.url))\n\t\t\t{\n\t\t\t\tview.events = {\n\t\t\t\t\tclick: () => this.openUrl(),\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\n\t\tsuper({\n\t\t\ttarget: params.target,\n\t\t\titems: params.views,\n\t\t});\n\n\t\tthis.sidePanel = params.sidePanel;\n\t}\n\n\topenUrl(): void\n\t{\n\t\tconst topSidePanel = this.sidePanel.getTopSidePanel();\n\n\t\tif (topSidePanel !== null)\n\t\t{\n\t\t\ttopSidePanel.showLoader();\n\t\t}\n\t}\n}\n","import {Dom, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {SidePanel} from '../service/side.panel';\nimport {Filter} from '../service/filter';\n\nimport {RequestSender} from '../utility/request.sender';\n\nimport { Tabs } from './header/tabs';\n\nimport '../css/base.css';\n\nexport type ViewInfo = {\n\tid: string,\n\ttitle: string,\n\tactive: boolean,\n\turl: string,\n\tlink: Array,\n\tevents?: { [eventName: string]: () => void },\n}\n\nexport type Views = ViewInfo[];\n\ntype Params = {\n\tsignedParameters: string,\n\tdebugMode: string,\n\tisOwnerCurrentUser: 'Y' | 'N',\n\tuserId: number,\n\tgroupId: number,\n\tfilterId: string,\n\tpathToTask: string,\n\ttarget: HTMLElement,\n}\n\nexport class View extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.View');\n\n\t\tthis.isOwnerCurrentUser = (params.isOwnerCurrentUser === 'Y');\n\t\tthis.target = params.target;\n\n\t\tthis.loadItemsRepeatCounter = new Map();\n\n\t\tthis.sidePanel = new SidePanel();\n\n\t\tthis.requestSender = new RequestSender({\n\t\t\tsignedParameters: params.signedParameters,\n\t\t\tdebugMode: params.debugMode\n\t\t});\n\n\t\tthis.filter = new Filter({\n\t\t\tfilterId: params.filterId,\n\t\t\tscrumManager: this,\n\t\t\trequestSender: this.requestSender\n\t\t});\n\t\tthis.filter.subscribe('applyFilter', this.onApplyFilter.bind(this));\n\n\t\tthis.userId = parseInt(params.userId, 10);\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\n\t\tthis.pathToTask = (Type.isString(params.pathToTask) ? params.pathToTask : '');\n\t}\n\n\tonApplyFilter(baseEvent: BaseEvent)\n\t{\n\t\tthis.loadItemsRepeatCounter.clear();\n\t}\n\n\trenderTo(container: HTMLElement)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\tthrow new Error('Scrum: HTMLElement for scrum not found');\n\t\t}\n\t}\n\n\trenderTabsTo(container: HTMLElement)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\tthrow new Error('Scrum: HTMLElement for tabs not found');\n\t\t}\n\n\t\tnew Tabs({\n\t\t\tsidePanel: this.sidePanel,\n\t\t\tviews: this.views,\n\t\t\ttarget: this.target,\n\t\t}).init();\n\t}\n\n\trenderSprintStatsTo(container: HTMLElement)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\tthrow new Error('Scrum: HTMLElement for Sprint stats not found');\n\t\t}\n\t}\n\n\trenderRightElementsTo(container: HTMLElement)\n\t{\n\t\tif (!Type.isDomNode(container))\n\t\t{\n\t\t\tthrow new Error('Scrum: HTMLElement for buttons not found');\n\t\t}\n\t}\n\n\tsetDisplayPriority(value: string)\n\t{\n\t\tconst availableValues = new Set([\n\t\t\t'backlog',\n\t\t\t'sprint',\n\t\t]);\n\n\t\tif (!availableValues.has(value))\n\t\t{\n\t\t\tthrow new Error('Invalid parameter to set display priority');\n\t\t}\n\t}\n\n\tchangeShortView(isShortView: 'Y' | 'N')\n\t{\n\t\tconst availableValues = new Set([\n\t\t\t'Y',\n\t\t\t'N',\n\t\t]);\n\n\t\tif (!availableValues.has(isShortView))\n\t\t{\n\t\t\tthrow new Error('Invalid parameter to set short view');\n\t\t}\n\t}\n\n\tgetCurrentUserId(): number\n\t{\n\t\treturn this.userId;\n\t}\n\n\tgetCurrentGroupId(): number\n\t{\n\t\treturn this.groupId;\n\t}\n\n\tgetPathToTask(): string\n\t{\n\t\treturn this.pathToTask;\n\t}\n}\n","import {Loc, Runtime, Tag, Text, Type} from 'main.core';\nimport {Popup} from 'main.popup';\nimport {EventEmitter} from 'main.core.events';\n\nimport '../css/disk.manager.css';\n\ntype Params = {\n\ttargetElement: HTMLElement\n}\n\nexport class DiskManager extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.DiskManager');\n\n\t\tthis.targetElement = params.targetElement;\n\n\t\tthis.diskUrls = {\n\t\t\turlSelect: '/bitrix/tools/disk/uf.php?action=selectFile&SITE_ID=' + Loc.getMessage('SITE_ID'),\n\t\t\turlRenameFile: '/bitrix/tools/disk/uf.php?action=renameFile',\n\t\t\turlDeleteFile: '/bitrix/tools/disk/uf.php?action=deleteFile',\n\t\t\turlUpload: '/bitrix/tools/disk/uf.php?action=uploadFile&ncc=1'\n\t\t};\n\n\t\tthis.onFinishDebounce = Runtime.debounce(\n\t\t\t(attachedIds) => {\n\t\t\t\tthis.attachedIds = [];\n\n\t\t\t\tthis.emit('onFinish', attachedIds);\n\t\t\t},\n\t\t\t500\n\t\t);\n\n\t\tthis.attachedIds = [];\n\n\t}\n\n\tshowAttachmentMenu(node)\n\t{\n\t\tconst controlId = Text.getRandom();\n\n\t\tthis.popup = new Popup(\n\t\t\t`disk-manager-attachment-menu-${Text.getRandom()}`,\n\t\t\tnode,\n\t\t\t{\n\t\t\t\tcontent: this.getAttachmentsLoaderContent(controlId),\n\t\t\t\tautoHide: false,\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tangle: false,\n\t\t\t\toffsetTop: 12,\n\t\t\t\toffsetLeft: -32\n\t\t\t}\n\t\t);\n\n\t\tthis.popup.subscribe('onShow', () => {\n\t\t\tBX.Disk.UF.add({\n\t\t\t\tUID: controlId,\n\t\t\t\tcontrolName: `[${controlId}][]`,\n\t\t\t\thideSelectDialog: false,\n\t\t\t\turlSelect: this.diskUrls.urlSelect,\n\t\t\t\turlRenameFile: this.diskUrls.urlRenameFile,\n\t\t\t\turlDeleteFile: this.diskUrls.urlDeleteFile,\n\t\t\t\turlUpload: this.diskUrls.urlUpload,\n\t\t\t});\n\n\t\t\tconst filesChooser = this.popup.contentContainer.querySelector('#files_chooser');\n\n\t\t\t/* eslint-disable */\n\t\t\tBX.onCustomEvent(filesChooser, 'DiskLoadFormController', ['show']);\n\t\t\t/* eslint-enable */\n\n\t\t\tif (BX.DiskFileDialog)\n\t\t\t{\n\t\t\t\tEventEmitter.subscribe(BX.DiskFileDialog, 'loadItemsDone', this.openDiskFileDialog.bind(this));\n\t\t\t}\n\t\t});\n\n\t\tEventEmitter.subscribe('onFinish', () => this.popup.close());\n\n\t\tthis.popup.show();\n\t}\n\n\tcloseAttachmentMenu()\n\t{\n\t\tif (this.popup)\n\t\t{\n\t\t\tthis.popup.close();\n\t\t}\n\t}\n\n\tisClickInside(node: HTMLElement): boolean\n\t{\n\t\tlet isClickInside = false;\n\n\t\tif (this.targetElement.contains(node))\n\t\t{\n\t\t\tisClickInside = true;\n\t\t}\n\n\t\tif (this.popup && this.popup.getPopupContainer().contains(node))\n\t\t{\n\t\t\tisClickInside = true;\n\t\t}\n\n\t\tif (\n\t\t\tBX.DiskFileDialog\n\t\t\t&& BX.DiskFileDialog.popupWindow !== null\n\t\t\t&& BX.DiskFileDialog.popupWindow.getPopupContainer().contains(node)\n\t\t)\n\t\t{\n\t\t\tisClickInside = true;\n\t\t}\n\n\t\treturn isClickInside;\n\t}\n\n\topenDiskFileDialog()\n\t{\n\t\tif (BX.DiskFileDialog.popupWindow !== null)\n\t\t{\n\t\t\tBX.DiskFileDialog.popupWindow.subscribe('onClose', () => this.popup.close());\n\t\t}\n\t}\n\n\tgetAttachmentsLoaderContent(controlId): HTMLElement\n\t{\n\t\tconst filesChooser = Tag.render`\n\t\t\t<div id=\"files_chooser\">\n\t\t\t<div id=\"diskuf-selectdialog-${controlId}\" class=\"diskuf-files-entity diskuf-selectdialog bx-disk\">\n\t\t\t\t<div class=\"diskuf-files-block\">\n\t\t\t\t\t<div class=\"diskuf-placeholder\">\n\t\t\t\t\t\t<table class=\"files-list\">\n\t\t\t\t\t\t\t<tbody class=\"diskuf-placeholder-tbody\"></tbody>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"diskuf-extended\" style=\"display: block\">\n\t\t\t\t\t<input type=\"hidden\" name=\"[${controlId}][]\" value=\"\"/>\n\t\t\t\t\t<div class=\"diskuf-extended-item\">\n\t\t\t\t\t\t<label for=\"file_loader_${controlId}\">\n\t\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_FILES_LOADER_POPUP_FROM_COMPUTER')}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tclass=\"diskuf-fileUploader\"\n\t\t\t\t\t\t\tid=\"file_loader_${controlId}\"\n\t\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\t\tmultiple=\"multiple\"\n\t\t\t\t\t\t\tsize=\"1\"\n\t\t\t\t\t\t\tstyle=\"display: none\"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"diskuf-extended-item\">\n\t\t\t\t\t\t<span class=\"diskuf-selector-link\">\n\t\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_FILES_LOADER_POPUP_FROM_B24')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"diskuf-extended-item\">\n\t\t\t\t\t\t<span class=\"diskuf-selector-link-cloud\" data-bx-doc-handler=\"gdrive\">\n\t\t\t\t\t\t\t<span>${Loc.getMessage('TASKS_SCRUM_FILES_LOADER_POPUP_FROM_CLOUD')}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\t/* eslint-disable */\n\t\tBX.addCustomEvent(filesChooser, 'OnFileUploadSuccess', this.onFileUploadSuccess.bind(this));\n\t\t/* eslint-enable */\n\n\t\treturn filesChooser;\n\t}\n\n\tonFileUploadSuccess(fileResult, uf, file, uploaderFile)\n\t{\n\t\tif (Type.isUndefined(file) || Type.isUndefined(uploaderFile))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.attachedIds.push(fileResult.element_id.toString());\n\n\t\tthis.onFinishDebounce(this.attachedIds);\n\t}\n}","import {Event, Tag} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\ntype Params = {\n\tvisible: boolean\n}\n\nexport class Toggle extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Item.Toggle');\n\n\t\tthis.visible = params.visible;\n\n\t\tthis.shown = false;\n\t\tthis.disabled = false;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__item--btn-toggle-tasks ${this.visible ? '--visible' : ''}\"></div>\n\t\t`;\n\n\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tonClick()\n\t{\n\t\tif (this.isDisabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.disable();\n\n\t\tif (this.isShown())\n\t\t{\n\t\t\tthis.emit('hide');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit('show');\n\t\t}\n\t}\n\n\tshow()\n\t{\n\t\tthis.shown = true;\n\n\t\tthis.unDisable();\n\t}\n\n\thide()\n\t{\n\t\tthis.shown = false;\n\n\t\tthis.unDisable();\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn this.shown;\n\t}\n\n\tisDisabled(): boolean\n\t{\n\t\treturn this.disabled;\n\t}\n\n\tdisable()\n\t{\n\t\tthis.disabled = true;\n\t}\n\n\tunDisable()\n\t{\n\t\tthis.disabled = false;\n\t}\n}","export class Tool\n{\n\tstatic escapeRegex(string: string): string\n\t{\n\t\treturn string.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n\t}\n}","import {Dom, Event, Loc, Tag, Text, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Tool} from '../../utility/tool';\n\ntype Params = {\n\tname: string,\n\tisCompleted: boolean,\n\tisImportant: boolean,\n\tpathToTask: string,\n\tsourceId: number,\n}\n\nexport class Name extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Item.Name');\n\n\t\tthis.value = ((Type.isString(params.name) && params.name) ? params.name.trim() : '');\n\t\tthis.important = params.isImportant;\n\t\tthis.completed = params.isCompleted;\n\t\tthis.sourceId = params.sourceId;\n\n\t\tthis.pathToTask = this.sourceId ? params.pathToTask.replace('#task_id#', this.sourceId) : null;\n\n\t\tif (!this.value)\n\t\t{\n\t\t\tthrow new Error(Loc.getMessage('TASKS_SCRUM_TASK_ADD_NAME_ERROR'));\n\t\t}\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tlet visualClasses = this.completed ? '--completed' : '';\n\t\tvisualClasses += this.important ? ' --important' : '';\n\n\t\tlet value = Text.encode(this.value);\n\t\tif (this.important)\n\t\t{\n\t\t\tconst words = this.value.split(' ');\n\t\t\tconst lastWord = words[words.length - 1];\n\t\t\tvalue = value.replace(new RegExp(Tool.escapeRegex(lastWord) + '$'), `<span>${lastWord}</span>`);\n\t\t}\n\n\t\tif (this.pathToTask)\n\t\t{\n\t\t\tconst uri = BX.Uri.addParam(this.pathToTask, {\n\t\t\t\tta_sec: 'scrum',\n\t\t\t\tta_sub: 'list',\n\t\t\t\tta_el: 'title_click',\n\t\t\t});\n\n\t\t\tthis.node = Tag.render`\n\t\t\t\t<a\n\t\t\t\t\thref=\"${Text.encode(uri)}\"\n\t\t\t\t\tclass=\"tasks-scrum__item--title ${visualClasses}\"\n\t\t\t\t>\n\t\t\t\t\t${value}\n\t\t\t\t</a>\n\t\t\t`;\n\n\t\t\tEvent.bind(this.node, 'click', () => {\n\t\t\t\tthis.emit('urlClick');\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.node = Tag.render`\n\t\t\t\t<div class=\"tasks-scrum__item--title ${visualClasses}\">\n\t\t\t\t\t${value}\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\t\t}\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.value;\n\t}\n\n\tsetCompleted(value: boolean)\n\t{\n\t\tthis.completed = value;\n\t}\n\n\tstrikeOut()\n\t{\n\t\tDom.addClass(this.node, '--completed');\n\t}\n\n\tunStrikeOut()\n\t{\n\t\tDom.removeClass(this.node, '--completed');\n\t}\n\n\tonClick()\n\t{\n\t\tthis.emit('click');\n\t}\n}\n","import {Event, Tag, Type} from 'main.core';\nimport {EventEmitter} from \"main.core.events\";\n\ntype Params = {\n\tcomplete: number,\n\tall: number\n}\n\nexport class Checklist extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Item.Checklist');\n\n\t\tthis.complete = (Type.isInteger(params.complete) ? parseInt(params.complete, 10) : 0);\n\t\tthis.all = (Type.isInteger(params.all) ? parseInt(params.all, 10) : 0);\n\n\t\tthis.value = `${this.complete}/${this.all}`;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst uiClasses = 'ui-label ui-label-sm ui-label-light';\n\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__item--entity-tasks ${this.all ? '--visible' : ''} ${uiClasses}\">\n\t\t\t\t${this.value}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.value;\n\t}\n\n\tgetComplete(): number\n\t{\n\t\treturn this.complete;\n\t}\n\n\tgetAll(): number\n\t{\n\t\treturn this.all;\n\t}\n\n\tonClick()\n\t{\n\t\tthis.emit('click');\n\t}\n}","import {Event, Tag, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nexport class Files extends EventEmitter\n{\n\tconstructor(count: number)\n\t{\n\t\tsuper(count);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Item.Files');\n\n\t\tthis.value = (Type.isInteger(count) ? parseInt(count, 10) : 0);\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst uiClasses = 'ui-label ui-label-sm ui-label-light';\n\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__item--attachment-counter ${this.value ? '--visible' : ''} ${uiClasses}\">\n\t\t\t\t${this.value}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetValue(): string\n\t{\n\t\treturn this.value;\n\t}\n\n\tonClick()\n\t{\n\t\tthis.emit('click');\n\t}\n}","import {Event, Tag, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nexport type TaskCounter = {\n\tcolor: string,\n\tvalue: number\n}\n\nexport class Comments extends EventEmitter\n{\n\tconstructor(taskCounter?: TaskCounter)\n\t{\n\t\tsuper(taskCounter);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Item.Comments');\n\n\t\tif (Type.isUndefined(taskCounter) || Type.isNull(taskCounter))\n\t\t{\n\t\t\ttaskCounter = {\n\t\t\t\tcolor: '',\n\t\t\t\tvalue: 0\n\t\t\t};\n\t\t}\n\n\t\tthis.taskCounter = taskCounter;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__item--comment-counter ${this.taskCounter.value ? '--visible' : ''}\">\n\t\t\t\t<div class='ui-counter ${this.taskCounter.color}'>\n\t\t\t\t\t<div class='ui-counter-inner'>${parseInt(this.taskCounter.value, 10)}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetValue(): TaskCounter\n\t{\n\t\treturn this.taskCounter;\n\t}\n\n\tonClick()\n\t{\n\t\tthis.emit('click');\n\t}\n}","import {Event, Tag, Type, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nexport type EpicType = {\n\tid: number,\n\tgroupId: number,\n\tname: string,\n\tdescription: string,\n\tcreatedBy: number,\n\tmodifiedBy: number,\n\tcolor: string\n}\n\nexport class Epic extends EventEmitter\n{\n\tconstructor(epic: EpicType)\n\t{\n\t\tsuper(epic);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Item.Epic');\n\n\t\tif (Type.isUndefined(epic) || Type.isArray(epic) || Type.isNull(epic))\n\t\t{\n\t\t\tepic = {\n\t\t\t\tid: 0,\n\t\t\t\tgroupId: 0,\n\t\t\t\tname: '',\n\t\t\t\tdescription: '',\n\t\t\t\tcreatedBy: 0,\n\t\t\t\tmodifiedBy: 0,\n\t\t\t\tcolor: ''\n\t\t\t};\n\t\t}\n\n\t\tthis.epic = epic;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__item--epic ${this.epic.id ? '--visible' : ''}\">\n\t\t\t\t<i\n\t\t\t\t\tclass=\"tasks-scrum__item--epic-point\"\n\t\t\t\t\tstyle=\"${`background-color: ${this.epic.color}`}\"\n\t\t\t\t></i>\n\t\t\t\t<span>${Text.encode(this.epic.name)}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\trenderFullView()\n\t{\n\t\tconst colorBorder = this.convertHexToRGBA(this.epic.color, 0.7);\n\t\tconst colorBackground = this.convertHexToRGBA(this.epic.color, 0.3);\n\n\t\tconst visibility = this.epic.id > 0 ? '--visible' : '';\n\n\t\tthis.node = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"tasks-scrum__item--epic-full-view ${visibility}\"\n\t\t\t\tstyle=\"background: ${colorBackground}; border-color: ${colorBorder};\"\n\t\t\t>${Text.encode(this.epic.name)}</div>\n\t\t`;\n\n\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetValue(): EpicType\n\t{\n\t\treturn this.epic;\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.epic.id;\n\t}\n\n\tonClick()\n\t{\n\t\tthis.emit('click');\n\t}\n\n\tconvertHexToRGBA(hexCode, opacity)\n\t{\n\t\tlet hex = hexCode.replace('#', '');\n\n\t\tif (hex.length === 3)\n\t\t{\n\t\t\thex = `${hex[0]}${hex[0]}${hex[1]}${hex[1]}${hex[2]}${hex[2]}`;\n\t\t}\n\n\t\tconst r = parseInt(hex.substring(0, 2), 16);\n\t\tconst g = parseInt(hex.substring(2, 4), 16);\n\t\tconst b = parseInt(hex.substring(4, 6), 16);\n\n\t\treturn `rgba(${r},${g},${b},${opacity})`;\n\t}\n}","import {Event, Tag, Text, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nexport class Tags extends EventEmitter\n{\n\tconstructor(tags?: Array<string>)\n\t{\n\t\tsuper(tags);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Item.Tags');\n\n\t\tthis.tags = (Type.isArray(tags) ? tags : []);\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement|Array<HTMLElement>\n\t{\n\t\tif (this.tags.length)\n\t\t{\n\t\t\tthis.node = Tag.render`\n\t\t\t\t${this.tags.map((tag) => {\n\t\t\t\t\treturn Tag.render`<div class=\"tasks-scrum__item--hashtag --visible\">#${Text.encode(tag)}</div>`;\n\t\t\t\t})}\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.node = Tag.render`<div class=\"tasks-scrum__item--hashtag\"></div>`\n\t\t}\n\n\t\tif (Type.isArray(this.node))\n\t\t{\n\t\t\tthis.node.forEach((node: HTMLElement) => {\n\t\t\t\tEvent.bind(node, 'click', this.onClick.bind(this));\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\t\t}\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement|?Array\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetValue(): Array<string>\n\t{\n\t\treturn this.tags;\n\t}\n\n\tonClick(event)\n\t{\n\t\tthis.emit('click', event.target.textContent.substring(1));\n\t}\n\n\tisEqualTags(tags: Tags): boolean\n\t{\n\t\treturn JSON.stringify(this.getValue()) === JSON.stringify(tags.getValue());\n\t}\n}","import { Tag, Type, Text, Event } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nexport type ResponsibleType = {\n\tid: number,\n\tname: string,\n\tpathToUser: string,\n\tphoto?: {\n\t\tsrc: string\n\t}\n}\n\nexport class Responsible extends EventEmitter\n{\n\tconstructor(responsible: ResponsibleType)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Item.Responsible');\n\n\t\tthis.responsible = (Type.isPlainObject(responsible) ? responsible : null);\n\t}\n\n\trender(): ?HTMLElement\n\t{\n\t\tif (this.responsible === null)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst uiClasses = 'ui-icon ui-icon-common-user';\n\n\t\tconst name = Text.encode(this.responsible.name);\n\n\t\tconst src = this.responsible.photo ? Text.encode(this.responsible.photo.src) : null;\n\t\tconst photoStyle = src ? `background-image: url('${encodeURI(src)}');` : '';\n\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__item--responsible\">\n\t\t\t\t<div class=\"tasks-scrum__item--responsible-photo ${uiClasses}\" title=\"${name}\">\n\t\t\t\t\t<i style=\"${photoStyle}\"></i>\n\t\t\t\t</div>\n\t\t\t\t<span>${name}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.node.querySelector('div'), 'click', this.onClick.bind(this));\n\t\tEvent.bind(this.node.querySelector('span'), 'click', this.onClick.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetValue(): ResponsibleType\n\t{\n\t\treturn this.responsible;\n\t}\n\n\tonClick()\n\t{\n\t\tthis.emit('click');\n\t}\n}\n","import {Type} from 'main.core';\n\nexport class StoryPointsStorage\n{\n\tconstructor()\n\t{\n\t\tthis.storyPoints = '';\n\t}\n\n\tsetPoints(storyPoints: string)\n\t{\n\t\tif (storyPoints === '')\n\t\t{\n\t\t\tthis.storyPoints = '';\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tType.isUndefined(storyPoints)\n\t\t\t|| (Type.isFloat(storyPoints) && isNaN(parseFloat(storyPoints)))\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isFloat(storyPoints))\n\t\t{\n\t\t\tstoryPoints = parseFloat(storyPoints).toFixed(1);\n\t\t}\n\n\t\tthis.storyPoints = String(storyPoints);\n\t}\n\n\tgetPoints(): string\n\t{\n\t\treturn this.storyPoints;\n\t}\n\n\tclearPoints()\n\t{\n\t\tthis.storyPoints = '';\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.storyPoints === '';\n\t}\n}","import {Event, Tag, Text, Dom, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {StoryPointsStorage} from '../../utility/story.points.storage';\n\nexport class StoryPoints  extends EventEmitter\n{\n\tconstructor(storyPoints: string)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Item.StoryPoints');\n\n\t\tthis.storyPointsStorage = new StoryPointsStorage();\n\n\t\tthis.storyPointsStorage.setPoints(storyPoints);\n\n\t\tthis.disableStatus = false;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst value = Text.encode(this.storyPointsStorage.getPoints());\n\n\t\tthis.node = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"tasks-scrum__item--story-points ${this.storyPointsStorage.isEmpty() ? '--empty' : ''}\"\n\t\t\t\ttitle=\"${Loc.getMessage('TASKS_SCRUM_SPRINT_HEADER_STORY_POINTS')}\"\n\t\t\t>\n\t\t\t\t<div class=\"tasks-scrum__item--story-points-content\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"tasks-scrum__item--story-points-element\" \n\t\t\t\t\t\ttitle=\"${this.storyPointsStorage.isEmpty() ? '' : value}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class=\"tasks-scrum__item--story-points-element-text\">\n\t\t\t\t\t\t\t${this.storyPointsStorage.isEmpty() ? '-' : value}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-scrum__item--story-points-input-container\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tclass=\"tasks-scrum__item--story-points-input\"\n\t\t\t\t\t\t\tvalue=\"${value}\"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(\n\t\t\tthis.node.querySelector('.tasks-scrum__item--story-points-element'),\n\t\t\t'click',\n\t\t\tthis.onClick.bind(this)\n\t\t);\n\n\t\tconst input = this.node.querySelector('.tasks-scrum__item--story-points-input');\n\n\t\tEvent.bind(input, 'blur', this.onBlur.bind(this));\n\t\tEvent.bind(input, 'keydown', this.onKeyDown.bind(input));\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetValue(): StoryPointsStorage\n\t{\n\t\treturn this.storyPointsStorage;\n\t}\n\n\tisDisable(): boolean\n\t{\n\t\treturn this.disableStatus;\n\t}\n\n\tdisable()\n\t{\n\t\tthis.disableStatus = true;\n\t}\n\n\tunDisable()\n\t{\n\t\tthis.disableStatus = false;\n\t}\n\n\tonClick()\n\t{\n\t\tif (this.isDisable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst inputContainer = this.node.querySelector('.tasks-scrum__item--story-points-input-container');\n\t\tconst input = inputContainer.firstElementChild;\n\t\tconst value = this.storyPointsStorage.getPoints();\n\n\t\tDom.addClass(inputContainer, '--active');\n\n\t\tinput.focus();\n\t\tinput.setSelectionRange(value.length, value.length);\n\t}\n\n\tonBlur()\n\t{\n\t\tconst inputContainer = this.node.querySelector('.tasks-scrum__item--story-points-input-container');\n\t\tconst input = inputContainer.firstElementChild;\n\n\t\tconst value = input.value.trim();\n\n\t\tconst currentValue = this.storyPointsStorage.getPoints();\n\n\t\tif (currentValue !== value)\n\t\t{\n\t\t\tthis.emit('setStoryPoints', value);\n\t\t}\n\n\t\tDom.removeClass(inputContainer, '--active');\n\t}\n\n\tonKeyDown(event)\n\t{\n\t\tif (event.isComposing || event.key === 'Escape' || event.key === 'Enter')\n\t\t{\n\t\t\tthis.blur();\n\t\t}\n\t}\n}\n","import {Dom, Event, Tag, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Loader} from 'main.loader';\n\nimport {Item} from '../item';\n\nexport class SubTasks extends EventEmitter\n{\n\tconstructor(parentItem: Item)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.SubTasks');\n\n\t\tthis.parentItem = parentItem;\n\n\t\tthis.list = new Map();\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.removeYourself();\n\n\t\tthis.node = Tag.render`<div class=\"tasks-scrum__item-sub-tasks\"></div>`;\n\n\t\tEvent.bind(this.node, 'transitionend', this.onTransitionEnd.bind(this, this.node));\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tremoveYourself()\n\t{\n\t\tif (Type.isNull(this.getNode()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.remove(this.node);\n\n\t\tthis.node = null;\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn this.list.size === 0;\n\t}\n\n\tgetParentItem(): Item\n\t{\n\t\treturn this.parentItem;\n\t}\n\n\taddTask(item: Item)\n\t{\n\t\tthis.list.set(item.getId(), item);\n\t}\n\n\tgetList(): Map<number, Item>\n\t{\n\t\treturn this.list;\n\t}\n\n\tcleanTasks()\n\t{\n\t\tthis.list.forEach((item: Item) => {\n\t\t\tDom.remove(item.getNode());\n\t\t});\n\n\t\tthis.list.clear();\n\t}\n\n\tshow(): Promise\n\t{\n\t\treturn new Promise(\n\t\t\t(resolve) => {\n\t\t\t\tthis.resolve = resolve;\n\n\t\t\t\tif (Type.isNull(this.getNode()))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.list.size)\n\t\t\t\t{\n\t\t\t\t\tthis.hideLoader();\n\n\t\t\t\t\tthis.renderSubTasks();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.showLoader();\n\t\t\t\t}\n\n\t\t\t\tDom.style(this.getNode(), 'height', `${ this.getNode().scrollHeight }px`);\n\t\t\t})\n\t\t;\n\t}\n\n\thide(): Promise\n\t{\n\t\treturn new Promise(\n\t\t\t(resolve) => {\n\t\t\t\tthis.resolve = resolve;\n\n\t\t\t\tif (Type.isNull(this.getNode()))\n\t\t\t\t{\n\t\t\t\t\tthis.resolve();\n\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tthis.hideLoader();\n\n\t\t\t\t/* eslint-disable */\n\t\t\t\tthis.getNode().style.height = `${ this.getNode().scrollHeight }px`;\n\t\t\t\tthis.getNode().clientHeight;\n\t\t\t\tthis.getNode().style.height = '0';\n\t\t\t\t/* eslint-enable */\n\t\t\t})\n\t\t;\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn !Type.isNull(this.node);\n\t}\n\n\trenderSubTasks()\n\t{\n\t\tthis.node.innerHTML = '';\n\n\t\tthis.list.forEach((item: Item) => {\n\t\t\tDom.append(item.render(), this.getNode());\n\t\t});\n\t}\n\n\tshowLoader()\n\t{\n\t\tif (this.loader)\n\t\t{\n\t\t\tthis.loader.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst listPosition = Dom.getPosition(this.getNode());\n\n\t\tthis.loader = new Loader({\n\t\t\ttarget: this.getNode(),\n\t\t\tsize: 60,\n\t\t\tmode: 'inline',\n\t\t\tcolor: 'rgba(82, 92, 105, 0.9)',\n\t\t\toffset: {\n\t\t\t\ttop: `12px`,\n\t\t\t\tleft: `${(listPosition.width / 2 - 30)}px`\n\t\t\t}\n\t\t});\n\n\t\tthis.loader.show();\n\t}\n\n\thideLoader()\n\t{\n\t\tif (this.loader)\n\t\t{\n\t\t\tthis.loader.hide();\n\t\t}\n\t}\n\n\tonTransitionEnd(node: HTMLElement)\n\t{\n\t\tconst isHide = (Dom.style(node, 'height') === '0px');\n\n\t\tif (isHide)\n\t\t{\n\t\t\tthis.removeYourself();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.style(node, 'height', 'auto');\n\t\t}\n\n\t\tthis.resolve();\n\t}\n}\n","import {Type, Dom, Event, Tag, Text} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Dialog} from 'ui.entity-selector';\nimport {Toggle} from './task/toggle';\nimport {Name} from './task/name';\nimport {Checklist} from './task/checklist';\nimport {Files} from './task/files';\nimport {Comments, TaskCounter} from './task/comments';\nimport {Epic, EpicType} from './task/epic';\nimport {Tags} from './task/tags';\nimport {Responsible, ResponsibleType} from './task/responsible';\nimport {StoryPoints} from './task/story.points';\nimport {SubTasks} from './task/sub.tasks';\n\nimport 'main.polyfill.intersectionobserver';\n\nimport '../css/item.css';\n\ntype AllowedActions = {\n\ttask_edit: boolean,\n\ttask_remove: boolean\n}\n\ntype ItemInfo = {\n\tcolor?: string,\n\tborderColor?: string\n}\ntype SubTaskInfo = {\n\tsourceId: number,\n\tcompleted: 'Y' | 'N',\n\tstoryPoints: string\n}\n\ntype SubTasksInfo = {\n\t[sourceId: number]: SubTaskInfo\n}\n\nexport type ItemParams = {\n\tid: number | string,\n\ttmpId: string,\n\tname: string,\n\tgroupId: number,\n\tcheckListComplete: number,\n\tcheckListAll: number,\n\tattachedFilesCount: number,\n\ttaskCounter: TaskCounter,\n\tepic?: EpicType,\n\ttags?: Array<string>,\n\tresponsible?: ResponsibleType,\n\tstoryPoints?: string,\n\tentityId?: number,\n\tentityType?: string,\n\tparentId?: number,\n\tsourceId?: number,\n\tcompleted?: 'Y' | 'N',\n\tsort?: number,\n\tallowedActions?: AllowedActions,\n\tinfo?: ItemInfo,\n\tisParentTask?: 'Y' | 'N',\n\tisLinkedTask?: 'Y' | 'N',\n\tparentTaskId?: number,\n\tisSubTask?: 'Y' | 'N',\n\tsubTasksInfo?: SubTasksInfo,\n\tisImportant?: 'Y' | 'N',\n\tpathToTask: string\n};\n\nexport class Item extends EventEmitter\n{\n\tconstructor(params: ItemParams)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Item');\n\n\t\tthis.groupMode = false;\n\t\tthis.decompositionMode = false;\n\n\t\tthis.node = null;\n\n\t\tthis.toggle = null;\n\t\tthis.name = null;\n\t\tthis.checklist = null;\n\t\tthis.files = null;\n\t\tthis.comments = null;\n\t\tthis.epic = null;\n\t\tthis.tags = null;\n\t\tthis.responsible = null;\n\t\tthis.storyPoints = null;\n\t\tthis.subTasks = null;\n\n\t\tthis.setItemParams(params);\n\n\t\tthis.shortView = 'Y';\n\t}\n\n\tsetItemParams(params: ItemParams)\n\t{\n\t\tthis.setId(params.id);\n\t\tthis.setGroupId(params.groupId);\n\t\tthis.setTmpId(params.tmpId);\n\t\tthis.setSort(params.sort);\n\t\tthis.setEntityId(params.entityId);\n\t\tthis.setEntityType(params.entityType);\n\t\tthis.setSourceId(params.sourceId);\n\t\tthis.setInfo(params.info);\n\n\t\tthis.setSubTasksInfo(params.subTasksInfo);\n\t\tthis.setParentTask(params.isParentTask);\n\t\tthis.setLinkedTask(params.isLinkedTask);\n\t\tthis.setParentTaskId(params.parentTaskId);\n\t\tthis.setSubTask(params.isSubTask);\n\t\tthis.setCompleted(params.completed);\n\t\tthis.setDisableStatus(false);\n\t\tthis.setAllowedActions(params.allowedActions);\n\t\tthis.setImportant(params.isImportant);\n\n\t\tthis.pathToTask = params.pathToTask;\n\t}\n\n\tstatic buildItem(params: ItemParams): Item\n\t{\n\t\tconst item = new Item(params);\n\n\t\titem.setToggle(item.isParentTask());\n\t\titem.setName(params.name);\n\t\titem.setChecklist(\n\t\t\tparams.checkListComplete,\n\t\t\tparams.checkListAll\n\t\t);\n\t\titem.setFiles(params.attachedFilesCount);\n\t\titem.setComments(params.taskCounter);\n\t\titem.setEpic(params.epic);\n\t\titem.setTags(params.tags);\n\t\titem.setResponsible(params.responsible);\n\n\t\tif (!item.isSubTask())\n\t\t{\n\t\t\titem.setStoryPoints(params.storyPoints);\n\t\t}\n\n\t\titem.setSubTasks();\n\n\t\treturn item;\n\t}\n\n\tsetToggle(visible: boolean)\n\t{\n\t\tconst toggle = new Toggle({ visible });\n\n\t\tif (this.toggle)\n\t\t{\n\t\t\tDom.replace(this.toggle.getNode(), toggle.render());\n\t\t}\n\n\t\tthis.toggle = toggle;\n\n\t\tthis.toggle.subscribe('show', this.onShowToggle.bind(this));\n\t\tthis.toggle.subscribe('hide', this.onHideToggle.bind(this));\n\t}\n\n\tgetToggle(): Toggle\n\t{\n\t\treturn this.toggle;\n\t}\n\n\tsetName(inputName: string)\n\t{\n\t\tconst name = new Name({\n\t\t\tname: inputName,\n\t\t\tisCompleted: this.isCompleted(),\n\t\t\tisImportant: this.isImportant(),\n\t\t\tpathToTask: this.pathToTask,\n\t\t\tsourceId: this.getSourceId(),\n\t\t});\n\n\t\tif (this.name)\n\t\t{\n\t\t\tDom.replace(this.name.getNode(), name.render());\n\t\t}\n\n\t\tthis.name = name;\n\n\t\tthis.name.subscribe('click', () => {\n\t\t\tthis.emit('showTask');\n\t\t});\n\t\tthis.name.subscribe('urlClick', () => {\n\t\t\tthis.emit('destroyActionPanel');\n\t\t});\n\t}\n\n\tgetName(): Name\n\t{\n\t\treturn this.name;\n\t}\n\n\tsetChecklist(complete: number, all: number)\n\t{\n\t\tconst checklist = new Checklist({ complete, all });\n\n\t\tif (this.checklist)\n\t\t{\n\t\t\tDom.replace(this.checklist.getNode(), checklist.render());\n\t\t}\n\n\t\tthis.checklist = checklist;\n\n\t\tthis.checklist.subscribe('click', () => this.emit('showTask'));\n\t}\n\n\tgetChecklist(): Checklist\n\t{\n\t\treturn this.checklist;\n\t}\n\n\tsetFiles(count: number)\n\t{\n\t\tconst files = new Files(count);\n\n\t\tif (this.files)\n\t\t{\n\t\t\tDom.replace(this.files.getNode(), files.render());\n\t\t}\n\n\t\tthis.files = files;\n\n\t\tthis.files.subscribe('click', () => this.emit('showTask'));\n\t}\n\n\tgetFiles(): Checklist\n\t{\n\t\treturn this.files;\n\t}\n\n\tsetComments(taskCounter: TaskCounter)\n\t{\n\t\tconst comments = new Comments(taskCounter);\n\n\t\tif (this.comments)\n\t\t{\n\t\t\tDom.replace(this.comments.getNode(), comments.render());\n\t\t}\n\n\t\tthis.comments = comments;\n\n\t\tthis.comments.subscribe('click', () => this.emit('showTask'));\n\t}\n\n\tgetComments(): Comments\n\t{\n\t\treturn this.comments;\n\t}\n\n\tsetEpic(inputEpic?: EpicType)\n\t{\n\t\tconst epic = new Epic(inputEpic);\n\n\t\tif (this.epic)\n\t\t{\n\t\t\tDom.replace(this.epic.getNode(), this.isShortView() ? epic.render() : epic.renderFullView());\n\t\t}\n\n\t\tthis.epic = epic;\n\n\t\tthis.updateTagsVisibility();\n\n\t\tthis.epic.subscribe('click', () => this.emit('filterByEpic', this.epic.getId()));\n\t}\n\n\tgetEpic(): Epic\n\t{\n\t\treturn this.epic;\n\t}\n\n\tsetTags(inputTags?: Array<string>)\n\t{\n\t\tconst tags = new Tags(inputTags);\n\n\t\tif (this.tags)\n\t\t{\n\t\t\tif (this.getNode()) //todo\n\t\t\t{\n\t\t\t\tthis.replaceTags(tags);\n\t\t\t}\n\t\t}\n\n\t\tthis.tags = tags;\n\n\t\tthis.updateTagsVisibility();\n\n\t\tthis.tags.subscribe('click', (baseEvent: BaseEvent) => this.emit('filterByTag', baseEvent.getData()));\n\t}\n\n\tgetTags(): Tags\n\t{\n\t\treturn this.tags;\n\t}\n\n\tsetShortView(value: string)\n\t{\n\t\tthis.shortView = (value === 'Y' ? 'Y' : 'N');\n\n\t\tif (this.getNode())\n\t\t{\n\t\t\tDom.replace(this.getNode(), this.render());\n\t\t}\n\t}\n\n\tgetShortView(): 'Y' | 'N'\n\t{\n\t\treturn this.shortView;\n\t}\n\n\tisShortView(): boolean\n\t{\n\t\treturn this.shortView === 'Y';\n\t}\n\n\tsetResponsible(inputResponsible: ResponsibleType)\n\t{\n\t\tconst responsible = new Responsible(inputResponsible);\n\n\t\tif (this.responsible)\n\t\t{\n\t\t\tDom.replace(this.responsible.getNode(), responsible.render());\n\t\t}\n\n\t\tthis.responsible = responsible;\n\n\t\tthis.responsible.subscribe('click', this.onResponsibleClick.bind(this));\n\t}\n\n\tgetResponsible(): Responsible\n\t{\n\t\treturn this.responsible;\n\t}\n\n\tsetStoryPoints(inputStoryPoints: string)\n\t{\n\t\tconst storyPoints = new StoryPoints(inputStoryPoints);\n\n\t\tif (this.storyPoints)\n\t\t{\n\t\t\tDom.replace(this.storyPoints.getNode(), storyPoints.render());\n\t\t}\n\n\t\tif (this.isDisabled())\n\t\t{\n\t\t\tstoryPoints.disable();\n\t\t}\n\n\t\tthis.storyPoints = storyPoints;\n\n\t\tthis.storyPoints.subscribe('setStoryPoints', this.onSetStoryPoints.bind(this));\n\t}\n\n\tgetStoryPoints(): StoryPoints\n\t{\n\t\treturn this.storyPoints;\n\t}\n\n\tsetSubTasks()\n\t{\n\t\tthis.subTasks = new SubTasks(this);\n\n\t\tthis.subTasks.subscribe('click', () => this.emit('showTask'));\n\t}\n\n\tgetSubTasks(): ?SubTasks\n\t{\n\t\treturn this.subTasks;\n\t}\n\n\tsetId(id: number | string)\n\t{\n\t\tthis.id = (\n\t\t\tType.isInteger(id) ? parseInt(id, 10) :\n\t\t\t\t(Type.isString(id) && id) ? id : Text.getRandom()\n\t\t);\n\n\t\tif (this.getNode())\n\t\t{\n\t\t\tthis.getNode().dataset.id = this.id;\n\t\t}\n\t}\n\n\tgetId(): number | string\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetGroupId(id: number)\n\t{\n\t\tthis.groupId = (Type.isInteger(id) ? parseInt(id, 10) : 0);\n\t}\n\n\tgetGroupId(): number\n\t{\n\t\treturn this.groupId;\n\t}\n\n\tsetTmpId(tmpId: string)\n\t{\n\t\tthis.tmpId = (Type.isString(tmpId) ? tmpId : '');\n\t}\n\n\tgetTmpId(): string\n\t{\n\t\treturn this.tmpId;\n\t}\n\n\tsetSort(sort: number)\n\t{\n\t\tthis.setPreviousSort(this.sort);\n\n\t\tthis.sort = (Type.isInteger(sort) ? parseInt(sort, 10) : 0);\n\n\t\tif (this.getNode())\n\t\t{\n\t\t\tDom.attr(this.getNode(), 'data-sort', this.sort);\n\t\t}\n\t}\n\n\tgetSort(): number\n\t{\n\t\treturn this.sort;\n\t}\n\n\tsetPreviousSort(sort: number)\n\t{\n\t\tthis.previousSort = (Type.isInteger(sort) ? parseInt(sort, 10) : 0);\n\t}\n\n\tgetPreviousSort(): number\n\t{\n\t\treturn this.previousSort;\n\t}\n\n\tsetEntityId(entityId: number)\n\t{\n\t\tthis.entityId = (Type.isInteger(entityId) ? parseInt(entityId, 10) : 0);\n\t}\n\n\tgetEntityId(): number\n\t{\n\t\treturn this.entityId;\n\t}\n\n\tsetEntityType(entityType: string)\n\t{\n\t\tthis.entityType = (new Set(['backlog', 'sprint']).has(entityType) ? entityType : 'backlog');\n\n\t\tthis.updateBorderColor();\n\t}\n\n\tgetEntityType(): string\n\t{\n\t\treturn this.entityType;\n\t}\n\n\tsetSourceId(sourceId: number)\n\t{\n\t\tthis.sourceId = (Type.isInteger(sourceId) ? parseInt(sourceId, 10) : 0);\n\t}\n\n\tgetSourceId(): number\n\t{\n\t\treturn this.sourceId;\n\t}\n\n\tsetCompleted(value: string)\n\t{\n\t\tconst completed = (value === 'Y');\n\n\t\tif (this.name)\n\t\t{\n\t\t\tthis.name.setCompleted(completed);\n\n\t\t\tif (completed)\n\t\t\t{\n\t\t\t\tthis.name.strikeOut();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.name.unStrikeOut();\n\t\t\t}\n\t\t}\n\n\t\tthis.completed = completed;\n\t}\n\n\tsetAllowedActions(allowedActions: AllowedActions)\n\t{\n\t\tthis.allowedActions = (Type.isPlainObject(allowedActions) ? allowedActions : {});\n\t}\n\n\tsetImportant(isImportant: 'Y' | 'N')\n\t{\n\t\tthis.important = (isImportant === 'Y');\n\t}\n\n\tisImportant(): boolean\n\t{\n\t\treturn this.important;\n\t}\n\n\tsetSubTasksInfo(subTasksInfo: ?SubTasksInfo)\n\t{\n\t\tthis.subTasksInfo = subTasksInfo;\n\t}\n\n\tgetSubTasksInfo(): ?SubTasksInfo\n\t{\n\t\treturn this.subTasksInfo;\n\t}\n\n\tgetSubTasksCount(): number\n\t{\n\t\tif (!this.getSubTasksInfo())\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn Object.keys(this.getSubTasksInfo()).length;\n\t}\n\n\tsetParentTask(value: string)\n\t{\n\t\tthis.parentTask = (value === 'Y');\n\n\t\tif (this.getNode())\n\t\t{\n\t\t\tthis.setToggle(this.isParentTask());\n\n\t\t\tif (this.isParentTask())\n\t\t\t{\n\t\t\t\tDom.addClass(this.getNode(), '--parent-tasks');\n\n\t\t\t\tif (this.getSubTasksCount() > 1)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.getNode(), '--many');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(this.getNode(), '--many');\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.getNode(), '--parent-tasks');\n\t\t\t}\n\t\t}\n\t}\n\n\tisParentTask(): boolean\n\t{\n\t\treturn this.parentTask;\n\t}\n\n\tsetLinkedTask(value: string)\n\t{\n\t\tthis.linkedTask = (value === 'Y');\n\n\t\tif (this.getNode())\n\t\t{\n\t\t\tif (this.isLinkedTask() && !this.isSubTask())\n\t\t\t{\n\t\t\t\tDom.addClass(this.getNode(), '--linked');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.getNode(), '--linked');\n\t\t\t}\n\t\t}\n\t}\n\n\tisLinkedTask(): boolean\n\t{\n\t\treturn this.linkedTask;\n\t}\n\n\tsetParentTaskId(id: number)\n\t{\n\t\tthis.parentTaskId = (Type.isInteger(id) ? parseInt(id, 10) : 0);\n\t}\n\n\tgetParentTaskId(): number\n\t{\n\t\treturn this.parentTaskId;\n\t}\n\n\tsetSubTask(value: string)\n\t{\n\t\tthis.subTask = (value === 'Y');\n\n\t\tif (this.getNode())\n\t\t{\n\t\t\tif (this.isSubTask())\n\t\t\t{\n\t\t\t\tDom.addClass(this.getNode(), '--subtasks');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.getNode(), '--subtasks');\n\t\t\t}\n\t\t}\n\t}\n\n\tisSubTask(): boolean\n\t{\n\t\treturn this.subTask;\n\t}\n\n\tsetInfo(info: ?ItemInfo)\n\t{\n\t\tif (Type.isUndefined(info))\n\t\t{\n\t\t\tthis.info = {\n\t\t\t\tcolor: '',\n\t\t\t\tborderColor: ''\n\t\t\t};\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.info = info;\n\t}\n\n\tgetInfo(): ?ItemInfo\n\t{\n\t\treturn this.info;\n\t}\n\n\tsetBorderColor(color: string)\n\t{\n\t\tthis.info.borderColor = (Type.isString(color) ? color : '');\n\n\t\tthis.updateBorderColor();\n\t}\n\n\tgetBorderColor(): string\n\t{\n\t\treturn (Type.isString(this.info.borderColor) ? this.info.borderColor : '');\n\t}\n\n\tupdateBorderColor()\n\t{\n\t\tif (this.isLinkedTask() && !this.isSubTask() && this.getNode() && this.getBorderColor() !== '')\n\t\t{\n\t\t\tconst colorNode = this.getNode().querySelector('.tasks-scrum__item--link');\n\n\t\t\tDom.style(colorNode, 'backgroundColor', this.getBorderColor());\n\n\t\t\tswitch (this.getEntityType())\n\t\t\t{\n\t\t\t\tcase 'backlog':\n\t\t\t\t\tDom.style(this.getNode().querySelector('.tasks-scrum__item--bg'), 'backgroundColor', this.getBorderColor());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'sprint':\n\t\t\t\t\tDom.style(this.getNode(), 'borderLeft', null);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tisCompleted(): boolean\n\t{\n\t\treturn this.completed;\n\t}\n\n\tisDisabled(): boolean\n\t{\n\t\treturn this.disableStatus;\n\t}\n\n\tsetMoveActivity(value: boolean)\n\t{\n\t\tthis.moveActivity = Boolean(value);\n\t}\n\n\tisMovable(): boolean\n\t{\n\t\treturn this.moveActivity;\n\t}\n\n\tsetDisableStatus(status: boolean)\n\t{\n\t\tthis.disableStatus = Boolean(status);\n\n\t\tif (this.storyPoints)\n\t\t{\n\t\t\tif (this.isDisabled())\n\t\t\t{\n\t\t\t\tthis.storyPoints.disable();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.storyPoints.unDisable();\n\t\t\t}\n\t\t}\n\t}\n\n\tactivateGroupMode()\n\t{\n\t\tDom.addClass(this.getNode(), '--checked');\n\t}\n\n\tdeactivateGroupMode()\n\t{\n\t\tDom.removeClass(this.getNode(), '--checked');\n\t}\n\n\tactivateLinkedMode()\n\t{\n\t\tDom.addClass(this.getNode(), '--linked-mode');\n\t}\n\n\tdeactivateLinkedMode()\n\t{\n\t\tDom.removeClass(this.getNode(), '--linked-mode');\n\t\tDom.removeClass(this.getNode(), '--linked-mode-current');\n\t}\n\n\tactivateCurrentLinkedMode()\n\t{\n\t\tDom.addClass(this.getNode(), '--linked-mode-current');\n\t}\n\n\tdeactivateCurrentLinkedMode()\n\t{\n\t\tDom.removeClass(this.getNode(), '--linked-mode-current');\n\t}\n\n\taddItemToGroupMode()\n\t{\n\t\tthis.groupMode = true;\n\n\t\tDom.addClass(this.getNode(), ['--group-mode']);\n\n\t\tthis.getNode().querySelector('.tasks-scrum__item--group-mode-input').checked = true;\n\t}\n\n\tremoveItemFromGroupMode()\n\t{\n\t\tthis.groupMode = false;\n\n\t\tDom.removeClass(this.getNode(), ['--group-mode']);\n\n\t\tthis.getNode().querySelector('.tasks-scrum__item--group-mode-input').checked = false;\n\t}\n\n\tisGroupMode(): boolean\n\t{\n\t\treturn this.groupMode;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tshowSubTasks()\n\t{\n\t\tDom.addClass(this.getNode(), '--open');\n\n\t\tthis.getSubTasks()\n\t\t\t.show()\n\t\t\t.then(() => {\n\t\t\t\tthis.toggle.show();\n\t\t\t})\n\t\t;\n\t}\n\n\thideSubTasks()\n\t{\n\t\tDom.removeClass(this.getNode(), '--open');\n\n\t\tthis.getSubTasks()\n\t\t\t.hide()\n\t\t\t.then(() => {\n\t\t\t\tthis.toggle.hide();\n\t\t\t})\n\t\t;\n\t}\n\n\tcleanSubTasks()\n\t{\n\t\tthis.getSubTasks().cleanTasks();\n\t}\n\n\tisShownSubTasks(): boolean\n\t{\n\t\treturn this.getSubTasks().isShown();\n\t}\n\n\tactivateDecompositionMode()\n\t{\n\t\tthis.decompositionMode = true;\n\t}\n\n\tdeactivateDecompositionMode()\n\t{\n\t\tthis.decompositionMode = false;\n\t}\n\n\tisDecompositionMode(): boolean\n\t{\n\t\treturn this.decompositionMode;\n\t}\n\n\tsetParentEntity(entityId: number, entityType: string)\n\t{\n\t\tthis.setEntityId(entityId);\n\t\tthis.setEntityType(entityType);\n\t}\n\n\tisEditAllowed(): boolean\n\t{\n\t\treturn Boolean(this.allowedActions['task_edit']);\n\t}\n\n\tisRemoveAllowed(): boolean\n\t{\n\t\treturn Boolean(this.allowedActions['task_remove']);\n\t}\n\n\tupdateYourself(tmpItem: Item)\n\t{\n\t\tthis.setToggle(tmpItem.isParentTask());\n\n\t\tif (this.getName().getValue() !== tmpItem.getName().getValue())\n\t\t{\n\t\t\tthis.setName(tmpItem.getName().getValue());\n\t\t}\n\t\tif (this.getChecklist().getValue() !== tmpItem.getChecklist().getValue())\n\t\t{\n\t\t\tthis.setChecklist(\n\t\t\t\ttmpItem.getChecklist().getComplete(),\n\t\t\t\ttmpItem.getChecklist().getAll()\n\t\t\t);\n\t\t}\n\t\tif (this.getFiles().getValue() !== tmpItem.getFiles().getValue())\n\t\t{\n\t\t\tthis.setFiles(tmpItem.getFiles().getValue());\n\t\t}\n\t\tif (this.getComments().getValue() !== tmpItem.getComments().getValue())\n\t\t{\n\t\t\tthis.setComments(tmpItem.getComments().getValue());\n\t\t}\n\t\tif (this.getEpic().getValue() !== tmpItem.getEpic().getValue())\n\t\t{\n\t\t\tthis.setEpic(tmpItem.getEpic().getValue());\n\t\t}\n\t\tif (!this.getTags().isEqualTags(tmpItem.getTags()))\n\t\t{\n\t\t\tthis.setTags(tmpItem.getTags().getValue());\n\t\t}\n\t\tif (this.getResponsible().getValue() !== tmpItem.getResponsible().getValue())\n\t\t{\n\t\t\tthis.setResponsible(tmpItem.getResponsible().getValue());\n\t\t}\n\t\tif (\n\t\t\t!this.isSubTask()\n\t\t\t&& this.getStoryPoints().getValue().getPoints() !== tmpItem.getStoryPoints().getValue().getPoints()\n\t\t)\n\t\t{\n\t\t\tthis.setStoryPoints(tmpItem.getStoryPoints().getValue().getPoints());\n\t\t}\n\t\tthis.setEntityId(tmpItem.getEntityId());\n\t\tif (this.isCompleted() !== tmpItem.isCompleted())\n\t\t{\n\t\t\tthis.setCompleted(tmpItem.isCompleted() ? 'Y' : 'N');\n\t\t}\n\t\tif (this.isImportant() !== tmpItem.isImportant())\n\t\t{\n\t\t\tthis.setImportant(tmpItem.isImportant() ? 'Y' : 'N');\n\t\t\tthis.setName(tmpItem.getName().getValue());\n\t\t}\n\n\t\tthis.setParentTask(tmpItem.isParentTask() ? 'Y' : 'N');\n\t\tthis.setLinkedTask(tmpItem.isLinkedTask() ? 'Y' : 'N');\n\t\tthis.setParentTaskId(tmpItem.getParentTaskId());\n\t\tthis.setSubTask(tmpItem.isSubTask() ? 'Y' : 'N');\n\t}\n\n\tremoveYourself()\n\t{\n\t\tDom.remove(this.node);\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.isShortView())\n\t\t{\n\t\t\treturn this.renderShortView();\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.renderFullView();\n\t\t}\n\t}\n\n\trenderShortView(): HTMLElement\n\t{\n\t\tconst typeClass = (this.isParentTask() ? ' --parent-tasks ' : ' ') + (this.isSubTask() ? ' --subtasks ' : '');\n\t\tconst subClass = this.getSubTasksCount() > 1 ? ' --many ' : '';\n\t\tconst linkedClass = this.isLinkedTask() && !this.isSubTask() ? ' --linked ' : '';\n\t\tconst entityClass = '--item-' + this.getEntityType();\n\n\t\tthis.node = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"tasks-scrum__item${typeClass}${subClass}${linkedClass}tasks-scrum__item--drag --short-view ${entityClass}\"\n\t\t\t\tdata-id=\"${Text.encode(this.getId())}\"\n\t\t\t\tdata-sort=\"${Text.encode(this.getSort())}\"\n\t\t\t>\n\t\t\t<div class=\"tasks-scrum__item--bg\"></div>\n\t\t\t\t<div class=\"tasks-scrum__item--link\"></div>\n\t\t\t\t<div class=\"tasks-scrum__item--info\">\n\t\t\t\t\t${this.toggle ? this.toggle.render() : ''}\n\t\t\t\t\t<div class=\"tasks-scrum__item--main-info\">\n\t\t\t\t\t\t${this.name ? this.name.render() : ''}\n\t\t\t\t\t\t<div class=\"tasks-scrum__item--tags\">\n\t\t\t\t\t\t\t${this.epic ? this.epic.render() : ''}\n\t\t\t\t\t\t\t${this.tags ? this.tags.render() : ''}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-scrum__item--entity-content\">\n\t\t\t\t\t\t${this.comments ? this.comments.render() : ''}\n\t\t\t\t\t\t<div class=\"tasks-scrum__item--counter-container\">\n\t\t\t\t\t\t\t${this.files ? this.files.render() : ''}\n\t\t\t\t\t\t\t${this.checklist ? this.checklist.render() : ''}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t${this.responsible ? this.responsible.render() : ''}\n\t\t\t\t${!this.isSubTask() && this.storyPoints ? this.storyPoints.render() : ''}\n\t\t\t\t<div class=\"tasks-scrum__item--group-mode\">\n\t\t\t\t\t<input type=\"checkbox\" class=\"tasks-scrum__item--group-mode-input\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__item--substrate\"></div>\n\t\t\t\t<div class=\"tasks-scrum__item--dragstrate\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.node, 'click', this.onItemClick.bind(this));\n\n\t\tthis.updateBorderColor();\n\n\t\treturn this.node;\n\t}\n\n\trenderFullView(): HTMLElement\n\t{\n\t\tconst typeClass = (this.isParentTask() ? ' --parent-tasks ' : ' ') + (this.isSubTask() ? ' --subtasks ' : '');\n\t\tconst subClass = this.getSubTasksCount() > 1 ? ' --many ' : '';\n\t\tconst linkedClass = this.isLinkedTask() && !this.isSubTask() ? ' --linked ' : '';\n\t\tconst entityClass = '--item-' + this.getEntityType();\n\n\t\tthis.node = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"tasks-scrum__item${typeClass}${subClass}${linkedClass}tasks-scrum__item--drag --full-view ${entityClass}\"\n\t\t\t\tdata-id=\"${Text.encode(this.getId())}\"\n\t\t\t\tdata-sort=\"${Text.encode(this.getSort())}\"\n\t\t\t>\n\t\t\t<div class=\"tasks-scrum__item--bg\"></div>\n\t\t\t<div class=\"tasks-scrum__item--info-task--basic\">\n\t\t\t\t<div class=\"tasks-scrum__item--link\"></div>\n\t\t\t\t<div class=\"tasks-scrum__item--info\">\n\t\t\t\t\t${this.toggle ? this.toggle.render() : ''}\n\t\t\t\t\t<div class=\"tasks-scrum__item--main-info\">\n\t\t\t\t\t\t${this.name ? this.name.render() : ''}\n\t\t\t\t\t\t<div class=\"tasks-scrum__item--tags\">\n\t\t\t\t\t\t\t${this.epic ? this.epic.renderFullView() : ''}\n\t\t\t\t\t\t\t${this.tags ? this.tags.render() : ''}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.comments ? this.comments.render() : ''}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-scrum__item--info-task--details\">\n\t\t\t\t${this.responsible ? this.responsible.render() : ''}\n\n\t\t\t\t\t<div class=\"tasks-scrum__item--counter-container\">\n\t\t\t\t\t\t${this.files ? this.files.render() : ''}\n\t\t\t\t\t\t${this.checklist ? this.checklist.render() : ''}\n\t\t\t\t\t</div>\n\n\t\t\t\t${!this.isSubTask() && this.storyPoints ? this.storyPoints.render() : ''}\n\t\t\t</div>\n\n\t\t\t\t<div class=\"tasks-scrum__item--group-mode\">\n\t\t\t\t\t<input type=\"checkbox\" class=\"tasks-scrum__item--group-mode-input\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__item--substrate\"></div>\n\t\t\t\t<div class=\"tasks-scrum__item--dragstrate\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.updateTagsVisibility();\n\n\t\tEvent.bind(this.node, 'click', this.onItemClick.bind(this));\n\n\t\tthis.updateBorderColor();\n\n\t\treturn this.node;\n\t}\n\n\tupdateTagsVisibility()\n\t{\n\t\tif (!this.getNode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.epic.getValue().id > 0 || this.tags.getValue().length > 0)\n\t\t{\n\t\t\tDom.addClass(this.getNode().querySelector('.tasks-scrum__item--tags'), '--visible');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.getNode().querySelector('.tasks-scrum__item--tags'), '--visible');\n\t\t}\n\t}\n\n\treplaceTags(tags: Tags)\n\t{\n\t\tconst tagsContainer = this.getNode().querySelector('.tasks-scrum__item--tags');\n\t\tconst tagsNode = tagsContainer.querySelectorAll('.tasks-scrum__item--hashtag');\n\n\t\ttagsNode.forEach((tagNode: HTMLElement) => Dom.remove(tagNode));\n\n\t\tconst tagList = tags.render();\n\n\t\tif (Type.isArray(tagList))\n\t\t{\n\t\t\ttagList.forEach((tagNode: HTMLElement) => Dom.append(tagNode, tagsContainer));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(tagList, tagsContainer);\n\t\t}\n\t}\n\n\tonItemClick(event)\n\t{\n\t\tconst target = event.target;\n\n\t\tif (Dom.hasClass(target, 'tasks-scrum__item--link'))\n\t\t{\n\t\t\tthis.emit('showLinked');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isDisabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.toggle && this.hasNode(this.toggle.getNode(), target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.name && this.hasNode(this.name.getNode(), target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.checklist && this.hasNode(this.checklist.getNode(), target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.files && this.hasNode(this.files.getNode(), target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.comments && this.hasNode(this.comments.getNode(), target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.epic && this.hasNode(this.epic.getNode(), target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.tags && this.hasNode(this.tags.getNode(), target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.responsible && this.hasNode(this.responsible.getNode(), target, true))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.isSubTask())\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this.storyPoints && this.hasNode(this.storyPoints.getNode(), target))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit('toggleActionPanel');\n\t}\n\n\tonResponsibleClick()\n\t{\n\t\tif (this.isGroupMode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isDisabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.responsibleDialog && this.responsibleDialog.isOpen())\n\t\t{\n\t\t\tthis.responsibleDialog.hide();\n\t\t\tthis.responsibleDialog = null;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst responsible = this.getResponsible().getValue();\n\t\tconst preselectedItems = responsible ? [['user' , responsible.id]] : [];\n\n\t\tthis.responsibleDialog = new Dialog({\n\t\t\ttargetNode: this.responsible.getNode(),\n\t\t\tenableSearch: true,\n\t\t\tcontext: 'TASKS',\n\t\t\tdropdownMode: true,\n\t\t\tpreselectedItems: preselectedItems,\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\tthis.responsibleDialog.hide();\n\t\t\t\t\tconst selectedItem = event.getData().item;\n\t\t\t\t\tthis.setResponsible({\n\t\t\t\t\t\tid: selectedItem.getId(),\n\t\t\t\t\t\tname: selectedItem.getTitle(),\n\t\t\t\t\t\tphoto: {\n\t\t\t\t\t\t\tsrc: selectedItem.getAvatar()\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.emit('changeTaskResponsible');\n\t\t\t\t},\n\t\t\t},\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'scrum-user',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tgroupId: this.getGroupId()\n\t\t\t\t\t},\n\t\t\t\t\tdynamicLoad: true\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'department'\n\t\t\t\t}\n\t\t\t]\n\t\t});\n\n\t\tthis.emit('onShowResponsibleDialog', this.responsibleDialog);\n\n\t\tthis.responsibleDialog.show();\n\t}\n\n\tonSetStoryPoints(baseEvent: BaseEvent)\n\t{\n\t\tif (this.isDisabled())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit('updateItem', {\n\t\t\titemId: this.getId(),\n\t\t\tentityId: this.getEntityId(),\n\t\t\tstoryPoints: baseEvent.getData()\n\t\t});\n\n\t\tthis.setStoryPoints(baseEvent.getData());\n\t}\n\n\tonShowToggle()\n\t{\n\t\tthis.emit('showSubTasks', this.getSubTasks());\n\t}\n\n\tonHideToggle()\n\t{\n\t\tthis.hideSubTasks();\n\t}\n\n\thasNode(parentNode: HTMLElement | Array<HTMLElement>, searchNode: HTMLElement, skipParent = false): boolean\n\t{\n\t\tif (Type.isArray(parentNode))\n\t\t{\n\t\t\tconst result = parentNode\n\t\t\t\t.map((node: HTMLElement) => this.hasNode(node, searchNode, skipParent))\n\t\t\t\t.find((result) => result === true)\n\t\t\t;\n\n\t\t\treturn !Type.isUndefined(result);\n\t\t}\n\n\t\tif (!skipParent && searchNode.isEqualNode(parentNode))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst nodes = parentNode.getElementsByTagName('*');\n\n\t\tfor (let k = 0; k < nodes.length; k++)\n\t\t{\n\t\t\tif (searchNode.isEqualNode(nodes[k]))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tactivateBlinking()\n\t{\n\t\tif (!this.getNode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isUndefined(IntersectionObserver))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst observer = new IntersectionObserver((entries) =>\n\t\t\t{\n\t\t\t\tif (entries[0].isIntersecting === true)\n\t\t\t\t{\n\t\t\t\t\tthis.blink();\n\n\t\t\t\t\tobserver.disconnect();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tthreshold: [0]\n\t\t\t}\n\t\t);\n\n\t\tobserver.observe(this.getNode());\n\t}\n\n\tblink()\n\t{\n\t\tif (!this.getNode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.getNode(), '--blink');\n\t\tsetTimeout(() => {\n\t\t\tDom.removeClass(this.getNode(), '--blink');\n\t\t}, 300);\n\t}\n}\n","import {Dom, Tag} from 'main.core';\n\nimport {Entity} from './entity';\nimport {Item} from '../item/item';\n\nexport class ListItems\n{\n\tconstructor(entity: Entity)\n\t{\n\t\tthis.entity = entity;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__content-items\" data-entity-id=\"${this.entity.getId()}\">\n\t\t\t\t${[...this.entity.getItems().values()].map((item: Item) => {\n\t\t\t\t\titem.setEntityType(this.entity.getEntityType());\n\t\t\t\t\treturn item.render();\n\t\t\t\t})}\n\t\t\t\t${this.renderLoader()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.node;\n\t}\n\n\trenderLoader(): ?HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"tasks-scrum-entity-items-loader\"></div>`;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetListNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tsetEntityId(entityId: number)\n\t{\n\t\tthis.node.dataset.entityId = parseInt(entityId, 10);\n\t}\n\n\taddScrollbar()\n\t{\n\t\tDom.addClass(this.getNode(), '--scrollbar');\n\t}\n\n\tremoveScrollbar()\n\t{\n\t\tDom.removeClass(this.getNode(), '--scrollbar');\n\t}\n}\n","import { Loc, Type, Text, Dom } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport {Dialog, ItemOptions} from 'ui.entity-selector';\n\nimport { Filter } from '../service/filter';\n\nimport { RequestSender } from './request.sender';\nimport { Input } from './input';\n\nimport type { EpicType } from '../item/task/epic';\n\nimport {MessageBox, MessageBoxButtons} from 'ui.dialogs.messagebox';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tfilter: Filter,\n\tgroupId: number,\n\ttagsAreConverting: number,\n}\n\nexport class TagSearcher extends EventEmitter\n{\n\tstatic tagRegExp = '#([^\\\\s,\\\\[\\\\]<>]+)';\n\tstatic epicRegExp = '@[^#@](?:[^#@]*[^\\s#@])?';\n\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.TagSearcher');\n\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.filterService = params.filter;\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\t\tthis.tagsAreConverting = params.tagsAreConverting;\n\n\t\tthis.messageViewed = false;\n\t}\n\n\taddEpicToSearcher(epic: EpicType, selected = false)\n\t{\n\t\tconst epicDialogItem = this.getEpicDialogItem(epic);\n\n\t\tif (selected)\n\t\t{\n\t\t\tepicDialogItem.selected = true;\n\t\t\tepicDialogItem.sort = 1;\n\t\t}\n\n\t\tif (this.epicDialog)\n\t\t{\n\t\t\tthis.epicDialog.addItem(epicDialogItem);\n\t\t}\n\n\t\tif (this.epicSearchDialog)\n\t\t{\n\t\t\tthis.epicSearchDialog.addItem(epicDialogItem);\n\t\t}\n\t}\n\n\tremoveEpicFromSearcher(epic: EpicType)\n\t{\n\t\tif (this.epicDialog)\n\t\t{\n\t\t\tthis.epicDialog.removeItem(this.getEpicDialogItem(epic));\n\t\t}\n\n\t\tif (this.epicSearchDialog)\n\t\t{\n\t\t\tthis.epicSearchDialog.removeItem(this.getEpicDialogItem(epic));\n\t\t}\n\t}\n\n\tgetEpicDialogItem(epic: EpicType): ItemOptions\n\t{\n\t\treturn {\n\t\t\tid: epic.id,\n\t\t\tentityId: 'epic-selector',\n\t\t\ttitle: epic.name,\n\t\t\ttabs: 'recents',\n\t\t\tavatarOptions: {\n\t\t\t\tbgColor: epic.color,\n\t\t\t\tbgImage: 'none'\n\t\t\t}\n\t\t};\n\t}\n\n\t// widget on scrum (ex task)\n\tshowTagsDialog(item: Item, targetNode: HTMLElement): Dialog\n\t{\n\t\tif (this.tagsAreConverting)\n\t\t{\n\t\t\tthis.showConvertingMessage();\n\t\t\treturn;\n\t\t}\n\t\tlet choiceWasMade = false;\n\t\tconst groupId = this.groupId;\n\t\tconst statusSuccess = { status: false };\n\t\tthis.tagDialog = new Dialog({\n\t\t\tid: item.getId().toString(),\n\t\t\ttargetNode: targetNode,\n\t\t\twidth: 400,\n\t\t\theight: 300,\n\t\t\tmultiple: true,\n\t\t\tdropdownMode: true,\n\t\t\tenableSearch: true,\n\t\t\tcompactView: true,\n\t\t\tsearchOptions: {\n\t\t\t\tallowCreateItem: false,\n\t\t\t},\n\t\t\tfooter: BX.Tasks.EntitySelector.Footer,\n\t\t\tfooterOptions: {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tgroupId: groupId,\n\t\t\t},\n\t\t\toffsetTop: 12,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'task-tag',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tgroupId: this.groupId,\n\t\t\t\t\t\ttaskId: item.getSourceId(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tclearUnavailableItems: true,\n\t\t\tevents: {\n\t\t\t\t'onLoad': (baseEvent: BaseEvent) => {\n\t\t\t\t\tDom.style(baseEvent.getTarget().getFooterContainer(), 'zIndex', 1);\n\t\t\t\t\tthis.onShowTaskEditCallback(baseEvent, statusSuccess, item);\n\t\t\t\t\tthis.hideDialogLabel(baseEvent.getTarget());\n\t\t\t\t},\n\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\tchoiceWasMade = true;\n\t\t\t\t\tconst selectedItem = event.getData().item;\n\t\t\t\t\tconst dialog = event.getTarget();\n\t\t\t\t\tselectedItem.setSort(1);\n\t\t\t\t\tdialog.getTab('all').getRootNode().addItem(selectedItem);\n\t\t\t\t\tconst tag = selectedItem.getTitle();\n\t\t\t\t\tthis.emit('attachTagToTask', tag);\n\t\t\t\t},\n\t\t\t\t'Item:onDeselect': (event) => {\n\t\t\t\t\tchoiceWasMade = true;\n\t\t\t\t\tconst deselectedItem = event.getData().item;\n\t\t\t\t\tconst tag = deselectedItem.getTitle();\n\t\t\t\t\tthis.emit('deAttachTagToTask', tag);\n\t\t\t\t},\n\t\t\t\t'onSearch': event => {\n\t\t\t\t\tthis.onSearchCallback(event);\n\t\t\t\t},\n\t\t\t},\n\t\t\ttagSelectorOptions: {\n\t\t\t\tevents: {\n\t\t\t\t\tonInput: (event) => {\n\t\t\t\t\t\tconst selector = event.getData().selector;\n\t\t\t\t\t\tif (selector)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst dialog = selector.getDialog();\n\t\t\t\t\t\t\tconst label = dialog.getContainer().querySelector('.ui-selector-footer-conjunction');\n\t\t\t\t\t\t\tlabel.textContent = Text.encode(selector.getTextBoxValue());\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis.tagDialog.subscribe('onHide', () => {\n\t\t\tif (choiceWasMade)\n\t\t\t{\n\t\t\t\tthis.emit('hideTagDialog');\n\t\t\t}\n\t\t\tthis.tagDialog = null;\n\t\t});\n\n\t\tthis.tagDialog.show();\n\t}\n\n\tshowEpicDialog(item: Item, targetNode: HTMLElement): Dialog\n\t{\n\t\tconst currentEpic = item.getEpic().getValue();\n\n\t\tconst preselectedItems = [];\n\t\tif (currentEpic)\n\t\t{\n\t\t\tpreselectedItems.push(['epic-selector' , currentEpic.id]);\n\t\t}\n\n\t\tlet choiceWasMade = false;\n\n\t\tthis.epicDialog = new Dialog({\n\t\t\tid: item.getId(),\n\t\t\ttargetNode: targetNode,\n\t\t\twidth: 400,\n\t\t\theight: 300,\n\t\t\tmultiple: false,\n\t\t\tdropdownMode: true,\n\t\t\tenableSearch: true,\n\t\t\toffsetTop: 12,\n\t\t\tcontext: 'epic-selector-' + this.groupId,\n\t\t\tpreselectedItems: preselectedItems,\n\t\t\tentities: [\n\t\t\t\t{\n\t\t\t\t\tid: 'epic-selector',\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tgroupId: this.groupId\n\t\t\t\t\t},\n\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\tdynamicSearch: true\n\t\t\t\t}\n\t\t\t],\n\t\t\tsearchOptions: {\n\t\t\t\tallowCreateItem: true,\n\t\t\t\tfooterOptions: {\n\t\t\t\t\tlabel: Loc.getMessage('TASKS_SCRUM_SEARCHER_ACTIONS_EPIC_ADD'),\n\t\t\t\t},\n\t\t\t},\n\t\t\thideOnSelect: false,\n\t\t\thideOnDeselect: false,\n\t\t\tevents: {\n\t\t\t\t'Search:onItemCreateAsync': (event) => {\n\t\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\t\tconst { searchQuery } = event.getData();\n\t\t\t\t\t\tconst epicName = searchQuery.getQuery();\n\t\t\t\t\t\tthis.createEpic(epicName)\n\t\t\t\t\t\t\t.then((epic: EpicType) => {\n\t\t\t\t\t\t\t\tthis.addEpicToSearcher(epic, true);\n\t\t\t\t\t\t\t\tthis.filterService.addItemToListTypeField('EPIC', {\n\t\t\t\t\t\t\t\t\tNAME: epic.name.trim(),\n\t\t\t\t\t\t\t\t\tVALUE: String(epic.id),\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tthis.emit('updateItemEpic', epic);\n\t\t\t\t\t\t\t\tchoiceWasMade = true;\n\t\t\t\t\t\t\t\tthis.epicDialog.hide();\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\tchoiceWasMade = true;\n\t\t\t\t\tconst selectedItem = event.getData().item;\n\t\t\t\t\tthis.getEpic(selectedItem.getId())\n\t\t\t\t\t\t.then((epic: EpicType) => {\n\t\t\t\t\t\t\tthis.emit('updateItemEpic', epic);\n\t\t\t\t\t\t\tthis.epicDialog.hide();\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t},\n\t\t\t\t'Item:onDeselect': () => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tchoiceWasMade = true;\n\t\t\t\t\t\tif (this.epicDialog.getSelectedItems().length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.emit('updateItemEpic', null);\n\t\t\t\t\t\t\tthis.epicDialog.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 50);\n\t\t\t\t},\n\t\t\t},\n\t\t\ttagSelectorOptions: {\n\t\t\t\ttextBoxWidth: 340,\n\t\t\t\tplaceholder: Loc.getMessage('TASKS_SCRUM_ITEM_EPIC_SEARCHER_PLACEHOLDER'),\n\t\t\t},\n\t\t});\n\n\t\tthis.epicDialog.subscribe('onHide', () => {\n\t\t\tif (choiceWasMade)\n\t\t\t{\n\t\t\t\tthis.emit('hideEpicDialog');\n\t\t\t}\n\t\t\tthis.epicDialog = null;\n\t\t});\n\n\t\tthis.epicDialog.show();\n\t}\n\n\tisEpicDialogShown(): boolean\n\t{\n\t\treturn this.epicDialog && this.epicDialog.isOpen();\n\t}\n\n\thasActionPanelDialog(): boolean\n\t{\n\t\treturn (this.epicDialog || this.tagDialog);\n\t}\n\n\tcloseActionPanelDialogs()\n\t{\n\t\tif (this.epicDialog)\n\t\t{\n\t\t\tthis.epicDialog.hide();\n\t\t}\n\n\t\tif (this.tagDialog)\n\t\t{\n\t\t\tthis.tagDialog.hide();\n\t\t}\n\t}\n\n\t//widget on scrum (new task)\n\tshowTagsSearchDialog(inputObject: Input, enteredQuery: string): Dialog\n\t{\n\t\tif (this.tagsAreConverting)\n\t\t{\n\t\t\tinputObject.setTagsSearchMode(false);\n\t\t\treturn;\n\t\t}\n\t\tconst input = inputObject.getInputNode();\n\n\t\tconst groupId = this.groupId;\n\n\t\tif (\n\t\t\tthis.tagSearchDialog\n\t\t\t&& this.tagSearchDialog.getId() !== inputObject.getNodeId()\n\t\t)\n\t\t{\n\t\t\tthis.tagSearchDialog = null;\n\t\t}\n\n\t\tif (!this.tagSearchDialog)\n\t\t{\n\t\t\tthis.tagSearchDialog = new Dialog({\n\t\t\t\tid: inputObject.getNodeId(),\n\t\t\t\ttargetNode: inputObject.getNode(),\n\t\t\t\twidth: inputObject.getNode().offsetWidth,\n\t\t\t\theight: 210,\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tcompactView: true,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'task-tag',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tgroupId: this.groupId,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\ttabOptions: {\n\t\t\t\t\tvisible: false,\n\t\t\t\t},\n\t\t\t\tsearchOptions: {\n\t\t\t\t\tallowCreateItem: false,\n\t\t\t\t},\n\t\t\t\tfooter: BX.Tasks.EntitySelector.Footer,\n\t\t\t\tfooterOptions: {\n\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\tgroupId: groupId,\n\t\t\t\t},\n\t\t\t\tclearUnavailableItems: true,\n\t\t\t\tevents: {\n\t\t\t\t\t'onLoad': (event) => {\n\t\t\t\t\t\tDom.style(event.getTarget().getFooterContainer(), 'zIndex', 1);\n\t\t\t\t\t\tthis.onLoadTaskQuickCreateCallback(event, inputObject);\n\t\t\t\t\t},\n\t\t\t\t\t'onSearch': event => {\n\t\t\t\t\t\tthis.onSearchCallback(event);\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\t\tlet newValue = '';\n\t\t\t\t\t\tconst regex = new RegExp('\\\\s|#$', 'm');\n\t\t\t\t\t\tconst currentPiece = input.value.split(regex).pop();\n\t\t\t\t\t\tinput.value.split(regex)\n\t\t\t\t\t\t\t.forEach((pieceOfValue: string) => {\n\t\t\t\t\t\t\t\tif (currentPiece !== pieceOfValue)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tnewValue = newValue + ' ' + pieceOfValue;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t\tconst selectedItem = event.getData().item;\n\t\t\t\t\t\tconst dialog = event.getTarget();\n\t\t\t\t\t\tselectedItem.setSort(1);\n\t\t\t\t\t\tdialog.getTab('all').getRootNode().addItem(selectedItem);\n\t\t\t\t\t\tnewValue = newValue + ' #' + selectedItem.getTitle();\n\t\t\t\t\t\tinput.value = newValue.trim();\n\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\tselectedItem.deselect();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.tagSearchDialog.subscribe('onHide', () => {\n\t\t\t\tinputObject.setTagsSearchMode(false);\n\n\t\t\t\tthis.tagSearchDialog = null;\n\t\t\t});\n\n\t\t\tinputObject.subscribe('onEnter', event => {\n\t\t\t\tif (Type.isNil(this.tagSearchDialog))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst searchTab = this.tagSearchDialog.getSearchTab();\n\t\t\t\tif (Type.isNil(searchTab))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (searchTab.isEmptyResult())\n\t\t\t\t{\n\t\t\t\t\tthis.tagSearchDialog.hide();\n\t\t\t\t\tinput.focus();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tinputObject.setTagsSearchMode(true);\n\t\tthis.tagSearchDialog.show();\n\t\tthis.tagSearchDialog.search(enteredQuery);\n\t}\n\n\tcloseTagsSearchDialog()\n\t{\n\t\tif (this.tagSearchDialog)\n\t\t{\n\t\t\tthis.tagSearchDialog.hide();\n\t\t}\n\t}\n\n\tshowEpicSearchDialog(inputObject: Input, enteredQuery: string): Dialog\n\t{\n\t\tconst input = inputObject.getInputNode();\n\n\t\tthis.epicEnteredQuery = enteredQuery;\n\n\t\tif (\n\t\t\tthis.epicSearchDialog\n\t\t\t&& this.epicSearchDialog.getId() !== inputObject.getNodeId()\n\t\t)\n\t\t{\n\t\t\tthis.epicSearchDialog = null;\n\t\t}\n\n\t\tif (!this.epicSearchDialog)\n\t\t{\n\t\t\tthis.epicSearchDialog = new Dialog({\n\t\t\t\tid: inputObject.getNodeId(),\n\t\t\t\ttargetNode: inputObject.getNode(),\n\t\t\t\twidth: inputObject.getNode().offsetWidth,\n\t\t\t\theight: 210,\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tsearchOptions: {\n\t\t\t\t\tallowCreateItem: true,\n\t\t\t\t\tfooterOptions: {\n\t\t\t\t\t\tlabel: Loc.getMessage('TASKS_SCRUM_SEARCHER_ACTIONS_EPIC_ADD'),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tcontext: 'epic-selector-' + this.groupId,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'epic-selector',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tgroupId: this.groupId\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: true\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Search:onItemCreateAsync': (event) => {\n\t\t\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\t\t\tconst { searchQuery } = event.getData();\n\t\t\t\t\t\t\tconst epicName = searchQuery.getQuery();\n\n\t\t\t\t\t\t\tinputObject.disable();\n\n\t\t\t\t\t\t\tinputObject.setSelectedEpicLength([...epicName].length);\n\t\t\t\t\t\t\tinput.focus();\n\n\t\t\t\t\t\t\tthis.createEpic(epicName)\n\t\t\t\t\t\t\t\t.then((epic: ?EpicType) => {\n\n\t\t\t\t\t\t\t\t\tthis.addEpicToSearcher(epic);\n\n\t\t\t\t\t\t\t\t\tthis.filterService.addItemToListTypeField('EPIC', {\n\t\t\t\t\t\t\t\t\t\tNAME: epic.name.trim(),\n\t\t\t\t\t\t\t\t\t\tVALUE: String(epic.id),\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tinputObject.unDisable();\n\t\t\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t\t\t\tinputObject.setEpic(epic);\n\n\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t;\n\n\t\t\t\t\t\t\tthis.epicSearchDialog.hide();\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\t'Item:onSelect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst selectedItem = event.getData().item;\n\n\t\t\t\t\t\tthis.getEpic(selectedItem.getId())\n\t\t\t\t\t\t\t.then((epic: EpicType) => {\n\t\t\t\t\t\t\t\tinputObject.setEpic(epic);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\n\t\t\t\t\t\tconst epicName = selectedItem.getTitle();\n\t\t\t\t\t\tinput.value = input.value.replace('@' + this.epicEnteredQuery, '').replace('@', '');\n\t\t\t\t\t\tinput.value = input.value + '@' + epicName;\n\t\t\t\t\t\tinputObject.setSelectedEpicLength([...epicName].length);\n\t\t\t\t\t\tinput.focus();\n\n\t\t\t\t\t\tselectedItem.deselect();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.epicSearchDialog.subscribe('onHide', () => {\n\t\t\t\tinputObject.setEpicSearchMode(false);\n\n\t\t\t\tthis.epicSearchDialog = null;\n\t\t\t});\n\n\t\t\tinputObject.subscribe('onMetaEnter', () => {\n\t\t\t\tif (Type.isNil(this.epicSearchDialog))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst searchTab = this.epicSearchDialog.getSearchTab();\n\t\t\t\tif (Type.isNil(searchTab))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst lastSearchQuery = searchTab.getLastSearchQuery();\n\t\t\t\tif (Type.isNil(lastSearchQuery))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst epicName = lastSearchQuery.getQuery();\n\n\t\t\t\tinputObject.disable();\n\n\t\t\t\tinputObject.setSelectedEpicLength([...epicName].length);\n\t\t\t\tinput.focus();\n\n\t\t\t\tthis.createEpic(epicName)\n\t\t\t\t\t.then((epic: ?EpicType) => {\n\n\t\t\t\t\t\tthis.addEpicToSearcher(epic);\n\n\t\t\t\t\t\tthis.filterService.addItemToListTypeField('EPIC', {\n\t\t\t\t\t\t\tNAME: epic.name.trim(),\n\t\t\t\t\t\t\tVALUE: String(epic.id),\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tinputObject.unDisable();\n\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\tinputObject.setEpic(epic);\n\t\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t\tthis.epicSearchDialog.hide();\n\t\t\t\tthis.epicSearchDialog = null;\n\t\t\t});\n\t\t}\n\n\t\tinputObject.setEpicSearchMode(true);\n\n\t\tthis.epicSearchDialog.show();\n\t\tthis.epicSearchDialog.search(this.epicEnteredQuery);\n\t}\n\n\tcloseEpicSearchDialog()\n\t{\n\t\tif (this.epicSearchDialog)\n\t\t{\n\t\t\tthis.epicSearchDialog.hide();\n\t\t}\n\t}\n\n\tcreateEpic(epicName: string): Promise\n\t{\n\t\treturn this.requestSender.createEpic(\n\t\t\t\t{\n\t\t\t\t\tgroupId: this.groupId,\n\t\t\t\t\tname: epicName,\n\t\t\t\t},\n\t\t\t)\n\t\t\t.then((response) => {\n\t\t\t\treturn response.data;\n\t\t\t})\n\t\t;\n\t}\n\n\tgetEpic(epicId: number): Promise\n\t{\n\t\treturn this.requestSender.getEpic(\n\t\t\t{\n\t\t\t\tgroupId: this.groupId,\n\t\t\t\tepicId: epicId\n\t\t\t},\n\t\t)\n\t\t\t.then((response) => {\n\t\t\t\treturn response.data;\n\t\t\t})\n\t\t;\n\t}\n\n\tstatic getHashTagNamesFromText(inputText: string): Array\n\t{\n\t\tconst regex = new RegExp(TagSearcher.tagRegExp, 'g');\n\n\t\tconst matches = [];\n\t\tlet match;\n\t\twhile (match = regex.exec(inputText))\n\t\t{\n\t\t\tmatches.push(match[0].substring(1));\n\t\t}\n\n\t\treturn matches;\n\t}\n\n\tstatic getHashEpicNamesFromText(inputText: string): Array\n\t{\n\t\tconst regex = new RegExp(TagSearcher.epicRegExp, 'g');\n\n\t\tconst matches = [];\n\t\tlet match;\n\t\twhile (match = regex.exec(inputText))\n\t\t{\n\t\t\tmatches.push(match[0].substring(1));\n\t\t}\n\n\t\treturn matches;\n\t}\n\n\thideDialogLabel(dialog: Dialog)\n\t{\n\t\t//todo tmp, remove after update selector\n\t\tdialog\n\t\t\t.getContainer()\n\t\t\t.querySelectorAll('.ui-selector-tab-label')\n\t\t\t.forEach((label: HTMLElement) => {\n\t\t\t\tDom.addClass(label, 'ui-selector-tab-label-hidden');\n\t\t\t})\n\t\t;\n\t}\n\n\tonSearchCallback(event)\n\t{\n\t\tconst dialog = event.getTarget();\n\t\tconst query = event.getData().query;\n\t\tif (query.trim() !== '')\n\t\t{\n\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-add-new').hidden = false;\n\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-conjunction').hidden = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-add-new').hidden = true;\n\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-conjunction').hidden = true;\n\t\t}\n\t}\n\n\tonLoadTaskQuickCreateCallback(event, inputObject)\n\t{\n\t\tconst dialog = event.getTarget();\n\t\tthis.hideDialogLabel(dialog);\n\t\tconst input = inputObject.getInputNode();\n\n\t\tinputObject.subscribe('onMetaEnter', (event) => {\n\t\t\tconst regex = new RegExp('\\\\s|#$', 'm');\n\t\t\tconst currentPiece = input.value.split(regex).pop();\n\t\t\tconst tagName = currentPiece.replace('#', '').trim();\n\t\t\tconst data = {\n\t\t\t\tnewTag: tagName,\n\t\t\t\tgroupId: this.groupId,\n\t\t\t\ttaskId: 0,\n\t\t\t\taction: 'add',\n\t\t\t};\n\t\t\tif (tagName === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.requestSender.addTag(data).then(response => {\n\t\t\t\tif (!response.data.success)\n\t\t\t\t{\n\t\t\t\t\tconst alertClass = 'tasks-scrum-tag-already-exists-alert';\n\t\t\t\t\tthis.showAlert(dialog.getId(), alertClass, response.data.error);\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tthis.removeAlert(dialog, alertClass);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t2000);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tdialog.search(tagName);\n\t\t\t});\n\t\t});\n\n\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-add-new')\n\t\t\t.addEventListener('click', event => {\n\t\t\t\tconst regex = new RegExp('\\\\s|#$', 'm');\n\t\t\t\tconst currentPiece = input.value.split(regex).pop();\n\t\t\t\tconst tagName = currentPiece.replace('#', '').trim();\n\t\t\t\tconst data = {\n\t\t\t\t\tnewTag: tagName,\n\t\t\t\t\tgroupId: this.groupId,\n\t\t\t\t\ttaskId: 0,\n\t\t\t\t\taction: 'add',\n\t\t\t\t};\n\t\t\t\tif (tagName === '')\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.requestSender.addTag(data).then(response => {\n\t\t\t\t\tif (!response.data.success)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst alertClass = 'tasks-scrum-tag-already-exists-alert';\n\t\t\t\t\t\tthis.showAlert(dialog.getId(), alertClass, response.data.error);\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tthis.removeAlert(dialog, alertClass);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t2000);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdialog.search(tagName);\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tonShowTaskEditCallback(event, statusSuccess, item)\n\t{\n\t\tconst dialog = event.getTarget();\n\t\tconst events = ['click', 'keydown'];\n\n\t\tconst handler = event => {\n\t\t\tif (event.type === 'keydown')\n\t\t\t{\n\t\t\t\tif (!((event.ctrlKey || event.metaKey) && event.keyCode === 13))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst tag = dialog.getTagSelectorQuery();\n\t\t\tif (tag.trim() === '')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst data = {\n\t\t\t\ttag: tag,\n\t\t\t\titemIds: [item.getId()],\n\t\t\t\tgroupId: this.groupId,\n\t\t\t\taction: 'add',\n\t\t\t};\n\t\t\tthis.requestSender.updateTaskTags(data).then(response => {\n\t\t\t\tif (response.data.success)\n\t\t\t\t{\n\t\t\t\t\tstatusSuccess.status = true;\n\t\t\t\t\tconst item = dialog.addItem({\n\t\t\t\t\t\tid: tag,\n\t\t\t\t\t\tentityId: 'task-tag',\n\t\t\t\t\t\ttitle: tag,\n\t\t\t\t\t\tsort: 1,\n\t\t\t\t\t\tbadges: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: response.data.group,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\n\t\t\t\t\tdialog.getTab('all').getRootNode().addItem(item);\n\t\t\t\t\titem.select();\n\t\t\t\t\tdialog.getTagSelector().clearTextBox();\n\t\t\t\t\tdialog.focusSearch();\n\t\t\t\t\tdialog.selectFirstTab();\n\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst alertClass = 'tasks-scrum-tag-already-exists-alert';\n\t\t\t\t\tthis.showAlert(dialog.getId(), alertClass, response.data.error);\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\tthis.removeAlert(dialog, alertClass);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t3000);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\tevents.forEach(function(ev) {\n\t\t\tif (ev === 'click')\n\t\t\t{\n\t\t\t\tdialog.getFooterContainer().querySelector('#tags-widget-custom-footer-add-new')\n\t\t\t\t\t.addEventListener(ev, handler);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tdialog.getContainer().addEventListener(ev, handler);\n\t\t\t}\n\t\t});\n\t}\n\n\tshowAlert(dialogId: string, className: string, error: string, messageType = 'ui-alert ui-alert-xs ui-alert-danger')\n\t{\n\t\tconst dialog = BX.UI.EntitySelector.Dialog.getById(dialogId);\n\n\t\tif (dialog.getContainer().querySelector(`div.${className}`))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst alert = document.createElement('div');\n\t\talert.className = className;\n\t\talert.innerHTML = `\n\t\t\t\t\t\t<div class='${messageType}'  \n\t\t\t\t\t\t\t<span class='ui-alert-message'>\n\t\t\t\t\t\t\t\t${error}\n\t\t\t\t\t\t\t</span> \n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;\n\t\tdialog.getFooterContainer().before(alert);\n\t};\n\n\tremoveAlert(dialog: Dialog, className: string)\n\t{\n\t\tconst notification = dialog.getContainer().querySelector(`div.${className}`);\n\t\tif (notification)\n\t\t{\n\t\t\tnotification.remove();\n\t\t}\n\t}\n\n\tshowConvertingMessage()\n\t{\n\t\tconst message = new MessageBox({\n\t\t\ttitle: Loc.getMessage('TASKS_SCRUM_TAG_SELECTOR_TAGS_ARE_CONVERTING_TITLE'),\n\t\t\tmessage: Loc.getMessage('TASKS_SCRUM_TAG_SELECTOR_TAGS_ARE_CONVERTING_TEXT'),\n\t\t\tbuttons: MessageBoxButtons.OK,\n\t\t\tokCaption: Loc.getMessage('TASKS_SCRUM_TAG_SELECTOR_TAGS_ARE_CONVERTING_COME_BACK_LATER'),\n\t\t\tonOk: function(){\n\t\t\t\tmessage.close();\n\t\t\t}\n\t\t});\n\t\tmessage.show();\n\t}\n}","import {Browser, Dom, Event, Loc, Tag, Text, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Entity} from '../entity/entity';\n\nimport {TagSearcher} from './tag.searcher';\n\nimport '../css/input.css';\n\nimport type {EpicType} from '../item/task/epic';\n\nexport class Input extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Input');\n\n\t\tthis.entity = null;\n\t\tthis.bindNode = null;\n\n\t\tthis.node = null;\n\n\t\tthis.value = '';\n\t\tthis.epic = null;\n\t\tthis.taskCreated = false;\n\n\t\tthis.selectedEpicLength = 0;\n\t}\n\n\tsetEntity(entity: Entity)\n\t{\n\t\tthis.entity = entity;\n\t}\n\n\tgetEntity(): ?Entity\n\t{\n\t\treturn this.entity;\n\t}\n\n\thasEntity(entity: Entity): boolean\n\t{\n\t\treturn this.entity && this.entity.getId() === entity.getId();\n\t}\n\n\tsetBindNode(node: HTMLElement)\n\t{\n\t\tthis.bindNode = node;\n\t}\n\n\tgetBindNode(): ?HTMLElement\n\t{\n\t\treturn this.bindNode;\n\t}\n\n\tcleanBindNode()\n\t{\n\t\tthis.bindNode = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.nodeId = Text.getRandom();\n\n\t\tthis.node = Tag.render`\n\t\t\t<div id=\"${Text.encode(this.nodeId)}\" class=\"tasks-scrum__input --add-block\">\n\t\t\t\t<textarea\n\t\t\t\t\tplaceholder=\"${Loc.getMessage('TASKS_SCRUM_TASK_ADD_INPUT_TASK_PLACEHOLDER')}\"\n\t\t\t\t\tclass=\"tasks-scrum__input--textarea\"\n\t\t\t\t>${Text.encode(this.value)}</textarea>\n\t\t\t\t<div class=\"tasks-scrum__input--textarea-help\">\n\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_TASK_ADD_INPUT_TASK_PLACEHOLDER_HELPER')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.getInputNode(), 'input', (event) => {\n\t\t\tthis.onTagSearch(event);\n\t\t\tthis.onEpicSearch(event);\n\t\t});\n\t\tEvent.bind(this.getInputNode(), 'keydown', this.onKeydown.bind(this));\n\t\tEvent.bind(this.getInputNode(), 'blur', this.onBlur.bind(this));\n\n\t\tthis.emit('render');\n\n\t\tthis.taskCreated = false;\n\n\t\treturn this.node;\n\t}\n\n\tonKeydown(event: KeyboardEvent)\n\t{\n\t\tif (event.key === 'Escape' || event.key === 'Enter')\n\t\t{\n\t\t\tif (!this.isTagsSearchMode() && !this.isEpicSearchMode())\n\t\t\t{\n\t\t\t\tthis.submit();\n\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tevent.key === 'Enter'\n\t\t\t\t&& !((Browser.isMac() && event.metaKey) || event.ctrlKey)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.emit('onEnter', { event });\n\t\t\t}\n\t\t\tif (\n\t\t\t\tevent.key === 'Enter'\n\t\t\t\t&& ((Browser.isMac() && event.metaKey) || event.ctrlKey)\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.emit('onMetaEnter', { event });\n\t\t\t}\n\t\t}\n\t}\n\n\tonBlur()\n\t{\n\t\tconst input = this.getInputNode();\n\n\t\tif (input.value === '')\n\t\t{\n\t\t\tthis.removeYourself();\n\t\t}\n\t}\n\n\tonTagSearch(event)\n\t{\n\t\tconst currentPieceOfName = event.target.value.split(' ').pop();\n\t\tconst enteredHashTags = TagSearcher.getHashTagNamesFromText(currentPieceOfName);\n\n\t\tconst query = enteredHashTags.length ? enteredHashTags.pop() : '';\n\n\t\tif (query || event.data === '#')\n\t\t{\n\t\t\tthis.setEpicSearchMode(false);\n\t\t\tthis.setTagsSearchMode(true);\n\n\t\t\tthis.emit('tagsSearchOpen', query);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit('tagsSearchClose');\n\t\t}\n\t}\n\n\tsubmit()\n\t{\n\t\tthis.disable();\n\n\t\tif (this.isEmpty())\n\t\t{\n\t\t\tthis.removeYourself();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.createTaskItem();\n\t\t}\n\t}\n\n\tonEpicSearch(event)\n\t{\n\t\tconst inputNode = event.target;\n\t\tconst enteredHashEpics = TagSearcher.getHashEpicNamesFromText(inputNode.value);\n\n\t\tconst query = enteredHashEpics.length ? enteredHashEpics.pop() : '';\n\n\t\tif (\n\t\t\tthis.selectedEpicLength > 0\n\t\t\t&& this.selectedEpicLength <= [...query].length\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.selectedEpicLength = 0;\n\n\t\tif (query || event.data === '@')\n\t\t{\n\t\t\tthis.setTagsSearchMode(false);\n\t\t\tthis.setEpicSearchMode(true);\n\n\t\t\tthis.emit('epicSearchOpen', query);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit('epicSearchClose');\n\t\t}\n\t}\n\n\tfocus()\n\t{\n\t\tconst input = this.getInputNode();\n\n\t\tconst length = input.value.length;\n\n\t\tinput.focus();\n\t\tinput.setSelectionRange(length, length);\n\t}\n\n\tdisable()\n\t{\n\t\tDom.addClass(this.node, '--disabled');\n\n\t\tthis.getInputNode().disabled = true;\n\t}\n\n\tunDisable()\n\t{\n\t\tDom.removeClass(this.node, '--disabled');\n\n\t\tthis.getInputNode().disabled = false;\n\n\t\tthis.emit('unDisable');\n\t}\n\n\tisExists(): boolean\n\t{\n\t\treturn !Type.isNull(this.node);\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\tif (!this.isExists())\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst input = this.getInputNode();\n\n\t\treturn input.value === '';\n\t}\n\n\tisTaskCreated(): boolean\n\t{\n\t\treturn this.taskCreated;\n\t}\n\n\tsetEpic(epic: ?EpicType)\n\t{\n\t\tthis.epic = epic;\n\t}\n\n\tgetNode(): HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetNodeId(): String\n\t{\n\t\treturn this.nodeId;\n\t}\n\n\tgetInputNode(): HTMLTextAreaElement\n\t{\n\t\treturn this.node.querySelector('textarea');\n\t}\n\n\tgetEpic(): ?EpicType\n\t{\n\t\treturn this.epic;\n\t}\n\n\tremoveYourself()\n\t{\n\t\tDom.remove(this.node);\n\n\t\tthis.node = null;\n\n\t\tthis.emit('remove');\n\t}\n\n\tsetTagsSearchMode(value: boolean)\n\t{\n\t\tDom.attr(this.getInputNode(), 'data-tag-disabled', value);\n\t}\n\n\tisTagsSearchMode(): boolean\n\t{\n\t\treturn Dom.attr(this.getInputNode(), 'data-tag-disabled');\n\t}\n\n\tsetEpicSearchMode(value: boolean)\n\t{\n\t\tDom.attr(this.getInputNode(), 'data-epic-disabled', value);\n\t}\n\n\tisEpicSearchMode(): boolean\n\t{\n\t\treturn Dom.attr(this.getInputNode(), 'data-epic-disabled');\n\t}\n\n\tsetSelectedEpicLength(length: number)\n\t{\n\t\tthis.selectedEpicLength = parseInt(length, 10);\n\t}\n\n\tcreateTaskItem()\n\t{\n\t\tconst input = this.getInputNode();\n\n\t\tif (input.value)\n\t\t{\n\t\t\tthis.emit('createTaskItem', input.value);\n\n\t\t\tthis.taskCreated = true;\n\n\t\t\tinput.value = '';\n\t\t}\n\t}\n}\n","import {Dom, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Loader} from 'main.loader';\n\nimport 'main.polyfill.intersectionobserver';\n\nimport {Item} from '../item/item';\nimport {ListItems} from './list.items';\n\nimport {Input} from '../utility/input';\nimport {StoryPointsStorage} from '../utility/story.points.storage';\n\nimport type {Views} from '../view/view';\n\ntype EntityParams = {\n\tid: number,\n\tviews?: Views,\n\tnumberTasks?: number,\n\tisExactSearchApplied: 'Y' | 'N',\n\tstoryPoints?: string,\n\tpageSize: number,\n\tpageNumberItems: number,\n\tisShortView: 'Y' | 'N',\n\tmandatoryExists: 'Y' | 'N'\n};\n\nexport class Entity extends EventEmitter\n{\n\tconstructor(params: EntityParams)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Entity');\n\n\t\tthis.storyPoints = new StoryPointsStorage();\n\n\t\tthis.items = new Map();\n\n\t\tthis.groupMode = false;\n\t\tthis.groupModeItems = new Map();\n\n\t\tthis.setEntityParams(params);\n\n\t\tthis.observerLoadItems = null;\n\n\t\tthis.node = null;\n\t\tthis.listItems = null;\n\n\t\tthis.listLoader = null;\n\t\tthis.itemLoader = null;\n\t\tthis.itemsLoaderNode = null;\n\n\t\tthis.blank = null;\n\t\tthis.dropzone = null;\n\t\tthis.emptySearchStub = null;\n\n\t\tthis.hideCont = false;\n\t}\n\n\tsetEntityParams(params: EntityParams)\n\t{\n\t\tthis.setId(params.id);\n\t\tthis.setViews(params.views);\n\t\tthis.setNumberTasks(params.numberTasks);\n\t\tthis.setStoryPoints(params.storyPoints);\n\t\tthis.setShortView(params.isShortView);\n\t\tthis.setMandatory(params.mandatoryExists);\n\t\tthis.setExactSearchApplied(params.isExactSearchApplied);\n\n\t\tthis.pageSize = parseInt(params.pageSize, 10);\n\t\tthis.setPageNumberItems(params.pageNumberItems);\n\t}\n\n\tsetListItems(entity: Entity)\n\t{\n\t\tthis.listItems = new ListItems(entity);\n\t}\n\n\tgetListItems(): ?ListItems\n\t{\n\t\treturn this.listItems;\n\t}\n\n\tsetShortView(value: string)\n\t{\n\t\tthis.shortView = (value === 'Y' ? 'Y' : 'N');\n\n\t\tthis.getItems()\n\t\t\t.forEach((item: Item) => {\n\t\t\t\tif (item.isParentTask() && item.isShownSubTasks())\n\t\t\t\t{\n\t\t\t\t\titem.hideSubTasks();\n\t\t\t\t}\n\t\t\t\titem.setShortView(this.shortView);\n\t\t\t})\n\t\t;\n\t}\n\n\tgetShortView(): 'Y' | 'N'\n\t{\n\t\treturn this.shortView;\n\t}\n\n\tisShortView(): boolean\n\t{\n\t\treturn this.shortView === 'Y';\n\t}\n\n\tsetMandatory(value: 'Y' | 'N')\n\t{\n\t\tthis.mandatoryExists = value === 'Y';\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tsetId(id: number)\n\t{\n\t\tthis.id = (Type.isInteger(id) ? parseInt(id, 10) : 0);\n\n\t\tif (this.listItems)\n\t\t{\n\t\t\tthis.listItems.setEntityId(this.id);\n\t\t}\n\t}\n\n\tgetId(): number\n\t{\n\t\treturn this.id;\n\t}\n\n\tsetViews(views)\n\t{\n\t\tthis.views = (Type.isPlainObject(views) ? views : {});\n\t}\n\n\tgetViews()\n\t{\n\t\treturn this.views;\n\t}\n\n\tgetEntityType()\n\t{\n\t\treturn 'entity';\n\t}\n\n\tisBacklog(): boolean\n\t{\n\t\treturn this.getEntityType() === 'backlog';\n\t}\n\n\tisHideContent(): boolean\n\t{\n\t\treturn this.hideCont;\n\t}\n\n\tisActive(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\tisCompleted(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\tgetListItemsNode(): ?HTMLElement\n\t{\n\t\treturn (this.listItems ? this.listItems.getListNode() : null);\n\t}\n\n\tisEmpty(): boolean\n\t{\n\t\treturn (this.items.size === 0);\n\t}\n\n\tgetNumberItems(): number\n\t{\n\t\treturn this.items.size;\n\t}\n\n\tgetItems(): Map\n\t{\n\t\treturn this.items;\n\t}\n\n\thasItem(item: Item): boolean\n\t{\n\t\treturn this.items.has(item.getId());\n\t}\n\n\tgetPageSize(): number\n\t{\n\t\treturn this.pageSize;\n\t}\n\n\tgetPageNumberItems(): number\n\t{\n\t\treturn this.pageNumberItems;\n\t}\n\n\tsetPageNumberItems(pageNumberItems: number)\n\t{\n\t\tif (Type.isInteger(pageNumberItems))\n\t\t{\n\t\t\tpageNumberItems = parseInt(pageNumberItems, 10);\n\t\t}\n\n\t\tthis.pageNumberItems = pageNumberItems ? pageNumberItems : 1;\n\t}\n\n\tincrementPageNumberItems()\n\t{\n\t\tthis.pageNumberItems++;\n\t}\n\n\tdecrementPageNumberItems()\n\t{\n\t\tthis.pageNumberItems--;\n\t}\n\n\trecalculateItemsSort()\n\t{\n\t\tconst listItemsNode = this.getListItemsNode();\n\t\tif (!listItemsNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet sort = 1;\n\t\tlistItemsNode.querySelectorAll('.tasks-scrum-item').forEach((node: HTMLElement) => {\n\t\t\tconst item = this.getItems().get(parseInt(node.dataset.id, 10));\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\titem.setSort(sort);\n\t\t\t\tsort++;\n\t\t\t}\n\t\t});\n\t}\n\n\tsetItem(newItem: Item)\n\t{\n\t\tthis.items.set(newItem.getId(), newItem);\n\n\t\tthis.subscribeToItem(newItem);\n\n\t\t[...this.items.values()].map((item) => {\n\t\t\tthis.setItemMoveActivity(item);\n\t\t});\n\n\t\tnewItem.setEntityType(this.getEntityType());\n\t\tnewItem.setShortView(this.getShortView());\n\n\t\tthis.hideBlank();\n\t\tthis.hideDropzone();\n\t\tthis.hideEmptySearchStub();\n\n\t\tthis.adjustListItemsWidth();\n\t}\n\n\tsetItemMoveActivity(item: Item)\n\t{\n\t\titem.setMoveActivity(this.items.size > 2);\n\t}\n\n\tremoveItem(item: Item)\n\t{\n\t\tif (this.items.has(item.getId()))\n\t\t{\n\t\t\tthis.items.delete(item.getId());\n\n\t\t\titem.unsubscribeAll();\n\n\t\t\t[...this.items.values()].map((item) => {\n\t\t\t\tthis.setItemMoveActivity(item);\n\t\t\t});\n\n\t\t\tif (item.isParentTask())\n\t\t\t{\n\t\t\t\titem.getSubTasks().getList().forEach((item: Item) => {\n\t\t\t\t\tthis.removeItem(item);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.pageNumberItems = 1;\n\n\t\t\tthis.adjustListItemsWidth();\n\t\t}\n\t}\n\n\tappendItemToList(item: Item)\n\t{\n\t\tDom.insertBefore(item.render(), this.getListItemsNode().lastElementChild);\n\n\t\tthis.adjustListItemsWidth();\n\t}\n\n\tisNodeCreated(): boolean\n\t{\n\t\treturn !Type.isNull(this.node);\n\t}\n\n\tsetNumberTasks(numberTasks: number)\n\t{\n\t\tthis.numberTasks = (Type.isInteger(numberTasks) ? parseInt(numberTasks, 10) : 0);\n\t}\n\n\tgetNumberTasks(): number\n\t{\n\t\treturn (this.numberTasks ? this.numberTasks : this.getItems().size);\n\t}\n\n\tsetExactSearchApplied(value: 'Y' | 'N')\n\t{\n\t\tthis.exactSearchApplied = value === 'Y';\n\t}\n\n\tisExactSearchApplied(): boolean\n\t{\n\t\treturn this.exactSearchApplied;\n\t}\n\n\tonAfterAppend()\n\t{\n\t\t[...this.items.values()].map((item) => {\n\t\t\tthis.subscribeToItem(item);\n\t\t\tthis.setItemMoveActivity(item);\n\t\t});\n\n\t\tthis.setStats();\n\n\t\tif (!this.isCompleted())\n\t\t{\n\t\t\tthis.itemsLoaderNode = this.getNode().querySelector('.tasks-scrum-entity-items-loader');\n\t\t\tif (this.getNumberItems() >= this.pageSize)\n\t\t\t{\n\t\t\t\tthis.bindItemsLoader();\n\t\t\t}\n\t\t}\n\n\t\tthis.adjustListItemsWidth();\n\t}\n\n\tsubscribeToItem(item: Item)\n\t{\n\t\tif (!this.getListItemsNode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titem.setEntityType(this.getEntityType());\n\n\t\titem.subscribe('updateItem', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('updateItem', baseEvent.getData());\n\t\t});\n\n\t\titem.subscribe('showTask', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('showTask', baseEvent.getTarget());\n\t\t});\n\n\t\titem.subscribe('destroyActionPanel', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('destroyActionPanel', baseEvent.getTarget());\n\t\t});\n\n\t\titem.subscribe('changeTaskResponsible', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('changeTaskResponsible', baseEvent.getTarget());\n\t\t});\n\n\t\titem.subscribe('onShowResponsibleDialog', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('onShowResponsibleDialog', baseEvent.getData());\n\t\t});\n\n\t\titem.subscribe('filterByEpic', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('filterByEpic', baseEvent.getData());\n\t\t});\n\n\t\titem.subscribe('filterByTag', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('filterByTag', baseEvent.getData());\n\t\t});\n\n\t\titem.subscribe('toggleActionPanel', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('toggleActionPanel', baseEvent.getTarget());\n\t\t});\n\n\t\titem.subscribe('showLinked', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('showLinked', baseEvent.getTarget());\n\t\t});\n\t}\n\n\tgetItemByItemId(itemId: number | string): ?Item\n\t{\n\t\treturn this.items.get((Type.isInteger(itemId) ? parseInt(itemId, 10) : itemId));\n\t}\n\n\tgetItemBySourceId(sourceId: number): ?Item\n\t{\n\t\treturn [...this.items.values()].find((item: Item) => item.getSourceId() === sourceId);\n\t}\n\n\tgetItemsByParentTaskId(parentTaskId: number): Map<number, Item>\n\t{\n\t\tconst items = new Map();\n\n\t\t[...this.items.values()].map((item: Item) => {\n\t\t\tif (item.getParentTaskId() === parentTaskId)\n\t\t\t{\n\t\t\t\titems.set(item.getId(), item);\n\t\t\t}\n\t\t});\n\n\t\treturn items;\n\t}\n\n\tsetStoryPoints(storyPoints: string)\n\t{\n\t\tthis.storyPoints.setPoints(storyPoints);\n\n\t\tthis.setStats();\n\t}\n\n\tgetStoryPoints(): StoryPointsStorage\n\t{\n\t\treturn this.storyPoints;\n\t}\n\n\tisFirstItem(item: Item): boolean\n\t{\n\t\tconst listItemsNode = this.getListItemsNode();\n\t\tconst itemNode = item.getNode();\n\t\tconst firstElementChild = listItemsNode.firstElementChild;\n\n\t\treturn firstElementChild.isEqualNode(itemNode);\n\t}\n\n\tisLastItem(item: Item): boolean\n\t{\n\t\tconst listItemsNode = this.getListItemsNode();\n\n\t\tconst itemNode = item.getNode();\n\t\tconst loaderNode = this.getLoaderNode();\n\n\t\tif (listItemsNode.lastElementChild.isEqualNode(loaderNode))\n\t\t{\n\t\t\treturn loaderNode.previousElementSibling.isEqualNode(itemNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn listItemsNode.lastElementChild.isEqualNode(itemNode);\n\t\t}\n\t}\n\n\tgetFirstItemNode(input?: Input): ?HTMLElement\n\t{\n\t\tconst listItemsNode = this.getListItemsNode();\n\n\t\tconst fistNode = listItemsNode.firstElementChild;\n\n\t\tif (input && fistNode.isEqualNode(input.getNode()))\n\t\t{\n\t\t\treturn fistNode.nextElementSibling;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn fistNode;\n\t\t}\n\t}\n\n\tgetLoaderNode(): ?HTMLElement\n\t{\n\t\treturn this.itemsLoaderNode ? this.itemsLoaderNode : null;\n\t}\n\n\tfadeOut()\n\t{\n\t\tDom.addClass(this.getListItemsNode(), 'tasks-scrum__entity-items-faded');\n\t}\n\n\tfadeIn()\n\t{\n\t\tDom.removeClass(this.getListItemsNode(), 'tasks-scrum__entity-items-faded');\n\t}\n\n\tactivateGroupMode()\n\t{\n\t\tthis.groupMode = true;\n\n\t\tthis.getItems().forEach((item: Item) => {\n\t\t\titem.activateGroupMode();\n\t\t});\n\t}\n\n\tdeactivateGroupMode()\n\t{\n\t\tthis.groupMode = false;\n\n\t\tthis.getItems().forEach((item: Item) => {\n\t\t\titem.deactivateGroupMode();\n\t\t});\n\n\t\tthis.groupModeItems.forEach((item: Item) => {\n\t\t\titem.removeItemFromGroupMode();\n\t\t});\n\t\tthis.groupModeItems.clear();\n\n\t\tthis.emit('deactivateGroupMode');\n\t}\n\n\tisGroupMode(): boolean\n\t{\n\t\treturn this.groupMode;\n\t}\n\n\taddItemToGroupMode(item: Item)\n\t{\n\t\tthis.groupModeItems.set(item.getId(), item);\n\n\t\titem.addItemToGroupMode();\n\t}\n\n\tremoveItemFromGroupMode(item: Item)\n\t{\n\t\tthis.groupModeItems.delete(item.getId());\n\n\t\titem.removeItemFromGroupMode();\n\t}\n\n\thasItemInGroupMode(item: Item): boolean\n\t{\n\t\treturn this.groupModeItems.has(item.getId());\n\t}\n\n\tgetGroupModeItems(): Map<number, Item>\n\t{\n\t\treturn this.groupModeItems;\n\t}\n\n\tbindItemsLoader()\n\t{\n\t\tif (!this.itemsLoaderNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.waitingLoadItems = true;\n\n\t\tDom.addClass(this.itemsLoaderNode, '--waiting');\n\n\t\tthis.showItemsLoader();\n\n\t\tif (Type.isUndefined(IntersectionObserver))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.observerLoadItems)\n\t\t{\n\t\t\tthis.observerLoadItems.disconnect();\n\t\t}\n\n\t\tthis.observerLoadItems = new IntersectionObserver((entries) =>\n\t\t\t{\n\t\t\t\tif (entries[0].isIntersecting === true)\n\t\t\t\t{\n\t\t\t\t\tif (!this.isActiveLoadItems())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.emit('loadItems');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tthreshold: [0]\n\t\t\t}\n\t\t);\n\n\t\tthis.observerLoadItems.observe(this.itemsLoaderNode);\n\t}\n\n\tunbindItemsLoader()\n\t{\n\t\tthis.waitingLoadItems = false;\n\n\t\tif (this.observerLoadItems)\n\t\t{\n\t\t\tthis.observerLoadItems.disconnect();\n\t\t}\n\n\t\tif (this.itemsLoaderNode)\n\t\t{\n\t\t\tthis.hideItemsLoader();\n\n\t\t\tDom.removeClass(this.itemsLoaderNode, '--waiting');\n\t\t}\n\t}\n\n\tisWaitingLoadItems(): boolean\n\t{\n\t\treturn this.waitingLoadItems;\n\t}\n\n\tsetActiveLoadItems(value: boolean)\n\t{\n\t\tthis.activeLoadItems = Boolean(value);\n\t}\n\n\tisActiveLoadItems(): boolean\n\t{\n\t\treturn this.activeLoadItems === true;\n\t}\n\n\tshowListLoader(): Loader\n\t{\n\t\tif (this.listLoader)\n\t\t{\n\t\t\tthis.listLoader.destroy();\n\t\t}\n\n\t\tconst targetNode = this.getNode();\n\n\t\tconst position = Dom.getPosition(targetNode);\n\n\t\tconst offset = this.isBacklog()\n\t\t\t? {\n\t\t\t\ttop: `${(position.top + (position.height / 2 - 55))}px`,\n\t\t\t\tleft: `${(position.left + (position.width / 2 - 55))}px`\n\t\t\t}\n\t\t\t: {\n\t\t\t\ttop: `${position.top}px`,\n\t\t\t\tleft: `${position.width / 2 - 55}px`,\n\t\t\t}\n\t\t;\n\n\t\tthis.listLoader = new Loader({\n\t\t\ttarget: targetNode,\n\t\t\tmode: 'custom',\n\t\t\toffset: offset\n\t\t});\n\n\t\tthis.listLoader.show();\n\n\t\treturn this.listLoader;\n\t}\n\n\thideListLoader(): void\n\t{\n\t\tif (this.listLoader)\n\t\t{\n\t\t\tthis.listLoader.hide();\n\t\t}\n\t}\n\n\tshowItemsLoader(): Loader\n\t{\n\t\tconst listPosition = Dom.getPosition(this.itemsLoaderNode);\n\n\t\tif (this.itemLoader)\n\t\t{\n\t\t\tthis.itemLoader.destroy();\n\t\t}\n\n\t\tthis.itemLoader = new Loader({\n\t\t\ttarget: this.itemsLoaderNode,\n\t\t\tsize: 60,\n\t\t\tmode: 'inline',\n\t\t\toffset: {\n\t\t\t\ttop: '7px',\n\t\t\t\tleft: `${((listPosition.width / 2) - 45)}px`\n\t\t\t}\n\t\t});\n\n\t\tif (this.getNumberItems() >= this.pageSize)\n\t\t{\n\t\t\tthis.itemLoader.show();\n\t\t}\n\n\t\treturn this.itemLoader;\n\t}\n\n\thideItemsLoader()\n\t{\n\t\tif (this.itemLoader)\n\t\t{\n\t\t\tthis.itemLoader.hide();\n\t\t}\n\t}\n\n\tsetStats() {}\n\n\tshowBlank()\n\t{\n\t\tif (this.blank)\n\t\t{\n\t\t\tDom.addClass(this.blank.getNode(), '--open');\n\t\t}\n\t}\n\n\thideBlank()\n\t{\n\t\tif (this.blank)\n\t\t{\n\t\t\tDom.removeClass(this.blank.getNode(), '--open');\n\t\t}\n\t}\n\n\tshowDropzone()\n\t{\n\t\tif (this.dropzone)\n\t\t{\n\t\t\tDom.addClass(this.dropzone.getNode(), '--open');\n\t\t}\n\t}\n\n\thideDropzone()\n\t{\n\t\tif (this.dropzone)\n\t\t{\n\t\t\tDom.removeClass(this.dropzone.getNode(), '--open');\n\t\t}\n\t}\n\n\tshowEmptySearchStub()\n\t{\n\t\tif (this.emptySearchStub)\n\t\t{\n\t\t\tDom.addClass(this.emptySearchStub.getNode(), '--open');\n\t\t}\n\t}\n\n\thideEmptySearchStub()\n\t{\n\t\tif (this.emptySearchStub)\n\t\t{\n\t\t\tDom.removeClass(this.emptySearchStub.getNode(), '--open');\n\t\t}\n\t}\n\n\tgetDropzone(): ?HTMLElement\n\t{\n\t\treturn this.dropzone ? this.dropzone.getNode() : null;\n\t}\n\n\tappendNodeAfterItem(newItemNode: HTMLElement, bindItemNode: HTMLElement)\n\t{\n\t\tif (bindItemNode.nextElementSibling)\n\t\t{\n\t\t\tDom.insertBefore(newItemNode, bindItemNode.nextElementSibling);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (this.getLoaderNode())\n\t\t\t{\n\t\t\t\tDom.append(newItemNode, this.getLoaderNode());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.append(newItemNode, this.getListItemsNode());\n\t\t\t}\n\t\t}\n\t}\n\n\tadjustListItemsWidth()\n\t{\n\t\tif (Type.isNull(this.getListItemsNode()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst hasListItemsScroll = this.getListItemsNode().scrollHeight > this.getListItemsNode().clientHeight;\n\n\t\tif (hasListItemsScroll)\n\t\t{\n\t\t\tthis.getListItems().addScrollbar();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.getListItems().removeScrollbar();\n\t\t}\n\t}\n}\n","import { Event, Loc, Tag, Dom } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Backlog } from './backlog';\nexport class Header extends EventEmitter\n{\n\tconstructor(backlog: Backlog)\n\t{\n\t\tsuper(backlog);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.BacklogHeader');\n\n\t\tthis.backlog = backlog;\n\n\t\tthis.epicButtonLocked = false;\n\t\tthis.taskButtonLocked = false;\n\n\t\tthis.node = null;\n\n\t\tthis.epicButton = null;\n\t\tthis.taskButton = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst uiEpicClasses = 'ui-btn ui-btn-sm ui-btn-light-border ui-btn-themes ui-btn-round ui-btn-no-caps';\n\t\tconst uiTaskClasses = 'ui-btn ui-btn-sm ui-btn-success ui-btn-round ui-btn-no-caps ';\n\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__content-header\">\n\n\t\t\t\t<div class=\"tasks-scrum__name-container\">\n\t\t\t\t\t<div class=\"tasks-scrum__title\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_BACKLOG_TITLE')}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.renderTaskCounterLabel(this.backlog.getNumberTasks())}\n\t\t\t\t</div>\n\n\t\t\t\t<button class=\"tasks-scrum__backlog-btn ${uiEpicClasses} ui-btn-icon-add\">\n\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_BACKLOG_HEADER_EPIC')}\n\t\t\t\t</button>\n\t\t\t\t<button class=\"tasks-scrum__backlog-btn ${uiTaskClasses} ui-btn-icon-add\">\n\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_BACKLOG_HEADER_TASK')}\n\t\t\t\t</button>\n\n\t\t\t</div>\n\t\t`;\n\n\t\tconst buttons = this.node.querySelectorAll('button');\n\n\t\tthis.epicButton = buttons.item(0);\n\t\tthis.taskButton = buttons.item(1);\n\n\t\tEvent.bind(buttons.item(0), 'click', this.onEpicClick.bind(this));\n\t\tEvent.bind(buttons.item(1), 'click', this.onTaskClick.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tupdateTaskCounter(value: string)\n\t{\n\t\tDom.replace(\n\t\t\tthis.node.querySelector('.tasks-scrum__backlog-tasks'),\n\t\t\tthis.renderTaskCounterLabel(value)\n\t\t);\n\t}\n\n\trenderTaskCounterLabel(value: string)\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"tasks-scrum__backlog-tasks\">\n\t\t\t\t${Loc.getMessage('TASKS_SCRUM_BACKLOG_HEADER_TASK_COUNTER').replace('#value#', value)}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tunLockEpicButton()\n\t{\n\t\tthis.epicButtonLocked = false;\n\n\t\tDom.removeClass(this.epicButton, 'ui-btn-wait');\n\t}\n\n\tlockEpicButton()\n\t{\n\t\tthis.epicButtonLocked = true;\n\n\t\tDom.addClass(this.epicButton, 'ui-btn-wait');\n\t}\n\n\tunLockTaskButton()\n\t{\n\t\tthis.taskButtonLocked = false;\n\n\t\tDom.removeClass(this.taskButton, 'ui-btn-wait');\n\t}\n\n\tlockTaskButton()\n\t{\n\t\tthis.taskButtonLocked = true;\n\n\t\tDom.addClass(this.taskButton, 'ui-btn-wait');\n\t}\n\n\tonEpicClick()\n\t{\n\t\tif (this.epicButtonLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.lockEpicButton();\n\n\t\tthis.emit('epicClick');\n\t}\n\n\tonTaskClick()\n\t{\n\t\tif (this.taskButtonLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.lockTaskButton();\n\n\t\tthis.emit('taskClick');\n\t}\n}\n","import {Dom, Tag, Loc} from 'main.core';\n\nimport {Entity} from './entity';\n\nexport class Blank\n{\n\tconstructor(entity: Entity)\n\t{\n\t\tthis.entity = entity;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.entity.isBacklog())\n\t\t{\n\t\t\treturn this.renderBacklog();\n\t\t}\n\t\telse if (this.entity.isCompleted())\n\t\t{\n\t\t\treturn this.renderCompletedSprint();\n\t\t}\n\t}\n\n\trenderBacklog(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__backlog-empty\">\n\t\t\t\t<div class=\"tasks-scrum__backlog-empty--icon\"></div>\n\t\t\t\t<div class=\"tasks-scrum__backlog-empty--title\">\n\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_BACKLOG_BLANK_1')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__backlog-empty--subtitle\">\n\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_BACKLOG_BLANK_2')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__backlog-empty--text\">\n\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_BACKLOG_BLANK_3')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__backlog-empty--text\">\n\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_BACKLOG_BLANK_4')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.node;\n\t}\n\n\trenderCompletedSprint(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__sprints--completed-empty\">\n\t\t\t\t${Loc.getMessage('TASKS_SCRUM_COMPLETED_SPRINT_EMPTY')}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tremoveNode()\n\t{\n\t\tDom.remove(this.node);\n\n\t\tthis.node = null;\n\t}\n}","import {Event, Dom, Tag, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Entity} from './entity';\n\nexport class Dropzone extends EventEmitter\n{\n\tconstructor(entity: Entity)\n\t{\n\t\tsuper(entity);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Dropzone');\n\n\t\tthis.entity = entity;\n\n\t\tthis.mandatoryExists = false;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.entity.isBacklog())\n\t\t{\n\t\t\treturn this.renderBacklog();\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn this.renderSprint();\n\t\t}\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tremoveNode()\n\t{\n\t\tDom.remove(this.node);\n\n\t\tthis.node = null;\n\t}\n\n\trenderBacklog(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__content-empty --empty-backlog\" data-entity-id=\"${this.entity.getId()}\">\n\t\t\t\t${Loc.getMessage('TASKS_SCRUM_BACKLOG_DROPZONE_1')}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(\n\t\t\tthis.node,\n\t\t\t'click',\n\t\t\t() => this.emit('createTask')\n\t\t);\n\n\t\treturn this.node;\n\t}\n\n\trenderSprint(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__content-empty\" data-entity-id=\"${this.entity.getId()}\">\n\t\t\t\t<div class=\"tasks-scrum__content-empty--title\">\n\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_SPRINT_BLANK_1')}\n\t\t\t\t</div>\n\t\t\t\t${this.renderSprintEmptyText()}\n\t\t\t</div>\n\t\t`;\n\n\t\tif (!this.mandatoryExists)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tthis.node.querySelector('.tasks-scrum__content-empty--btn-create'),\n\t\t\t\t'click',\n\t\t\t\t() => this.emit('createTask')\n\t\t\t);\n\t\t}\n\n\t\treturn this.node;\n\t}\n\n\trenderSprintEmptyText(): HTMLElement\n\t{\n\t\tif (this.mandatoryExists)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"tasks-scrum__content-empty--text\">\n\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_SPRINT_BLANK_4')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"tasks-scrum__content-empty--text\">\n\t\t\t\t\t<span class=\"tasks-scrum__content-empty--btn-create\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_SPRINT_BLANK_2')}\n\t\t\t\t\t</span> ${Loc.getMessage('TASKS_SCRUM_SPRINT_BLANK_3')}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\tsetMandatory()\n\t{\n\t\tthis.mandatoryExists = true;\n\t}\n}","import {Loc, Tag} from 'main.core';\nimport {Entity} from './entity';\n\nexport class EmptySearchStub\n{\n\tconstructor(entity: Entity)\n\t{\n\t\tthis.entity = entity;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__content-empty --no-results\">\n\t\t\t\t${this.getStubText()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetStubText(): string\n\t{\n\t\tif (this.entity.isBacklog())\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_SCRUM_EMPTY_SEARCH_STUB_BACKLOG');\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_SCRUM_EMPTY_SEARCH_STUB_SPRINT');\n\t\t}\n\t}\n}","import {Event, Dom, Tag} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\n\nimport {Header} from './header';\nimport {Blank} from '../blank';\nimport {Dropzone} from '../dropzone';\nimport {EmptySearchStub} from '../empty.search.stub';\n\nimport {Entity} from '../entity';\nimport {Item, ItemParams} from '../../item/item';\n\nimport '../../css/backlog.css';\n\nexport type BacklogParams = {\n\tid: number,\n\titems?: Array<ItemParams>\n};\n\nexport class Backlog extends Entity\n{\n\tconstructor(params: BacklogParams)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Backlog');\n\n\t\tthis.setBacklogParams(params);\n\n\t\tthis.header = null;\n\t}\n\n\tsetBacklogParams(params: BacklogParams)\n\t{\n\t\tparams.items.forEach((itemData) => {\n\t\t\tconst item = Item.buildItem(itemData);\n\t\t\titem.setShortView(this.getShortView());\n\t\t\tthis.items.set(item.getId(), item);\n\t\t});\n\t}\n\n\tstatic buildBacklog(backlogData: BacklogParams): Backlog\n\t{\n\t\tconst backlog = new Backlog(backlogData);\n\n\t\tbacklog.setHeader(backlog);\n\t\tbacklog.setBlank(backlog);\n\t\tbacklog.setDropzone(backlog);\n\t\tbacklog.setEmptySearchStub(backlog);\n\t\tbacklog.setListItems(backlog);\n\n\t\treturn backlog;\n\t}\n\n\tsetHeader(backlog: Backlog)\n\t{\n\t\tthis.header = new Header(backlog);\n\n\t\tthis.header.subscribe('epicClick', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('openAddEpicForm', baseEvent.getTarget())\n\t\t});\n\n\t\tthis.header.subscribe('taskClick', (baseEvent: BaseEvent) => {\n\t\t\tif (this.mandatoryExists)\n\t\t\t{\n\t\t\t\tthis.emit('openAddTaskForm', baseEvent.getTarget());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.emit('showInput', baseEvent.getTarget());\n\t\t\t}\n\t\t});\n\t}\n\n\tsetBlank(backlog: Backlog)\n\t{\n\t\tthis.blank = new Blank(backlog);\n\t}\n\n\tsetDropzone(backlog: Backlog)\n\t{\n\t\tthis.dropzone = new Dropzone(backlog);\n\n\t\tthis.dropzone.subscribe('createTask', () => {\n\t\t\tif (this.mandatoryExists)\n\t\t\t{\n\t\t\t\tthis.emit('openAddTaskForm');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.emit('showInput');\n\t\t\t}\n\t\t});\n\t}\n\n\tsetEmptySearchStub(backlog: Backlog)\n\t{\n\t\tthis.emptySearchStub = new EmptySearchStub(backlog);\n\t}\n\n\tsetNumberTasks(numberTasks: number)\n\t{\n\t\tsuper.setNumberTasks(numberTasks);\n\n\t\tif (this.header)\n\t\t{\n\t\t\tthis.header.updateTaskCounter(this.getNumberTasks());\n\t\t}\n\t}\n\n\tgetEntityType(): string\n\t{\n\t\treturn 'backlog';\n\t}\n\n\tisDisabled(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__backlog\">\n\t\t\t\t<div class=\"tasks-scrum__content --with-header --open\">\n\t\t\t\t\t${this.header ? this.header.render() : ''}\n\t\t\t\t\t${this.blank ? this.blank.render() : ''}\n\t\t\t\t\t${this.dropzone ? this.dropzone.render() : ''}\n\t\t\t\t\t${this.emptySearchStub ? this.emptySearchStub.render() : ''}\n\t\t\t\t\t${this.listItems ? this.listItems.render() : ''}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.node.querySelector('.tasks-scrum__content-items'), 'scroll', this.onItemsScroll.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tsetItem(newItem: Item)\n\t{\n\t\tsuper.setItem(newItem);\n\n\t\tif (newItem.getNode())\n\t\t{\n\t\t\tDom.addClass(newItem.getNode(), '--item-backlog');\n\t\t}\n\t}\n\n\tremoveItem(item: Item)\n\t{\n\t\tsuper.removeItem(item);\n\n\t\tif (this.isEmpty())\n\t\t{\n\t\t\tthis.emit('showBlank');\n\t\t}\n\t}\n\n\tonAfterAppend()\n\t{\n\t\tsuper.onAfterAppend();\n\n\t\tif (this.isEmpty())\n\t\t{\n\t\t\tthis.emit('showBlank');\n\t\t}\n\t}\n\n\tonItemsScroll()\n\t{\n\t\tthis.emit('itemsScroll');\n\t}\n}\n","export type CultureData = {\n\tdayMonthFormat: string,\n\tlongDateFormat: string,\n\tshortTimeFormat: string\n}\n\nexport class Culture\n{\n\tstatic #instance;\n\n\tstatic getInstance()\n\t{\n\t\tif (!Culture.#instance)\n\t\t{\n\t\t\tCulture.#instance = new Culture();\n\t\t}\n\n\t\treturn Culture.#instance;\n\t}\n\n\tsetData(data: CultureData)\n\t{\n\t\tthis.data = data;\n\t}\n\n\tgetDayMonthFormat(): string\n\t{\n\t\treturn this.data.dayMonthFormat;\n\t}\n\n\tgetLongDateFormat(): string\n\t{\n\t\treturn this.data.longDateFormat;\n\t}\n\n\tgetShortTimeFormat(): string\n\t{\n\t\treturn this.data.shortTimeFormat;\n\t}\n}","import {Event, Loc, Tag, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Sprint} from '../sprint';\nimport {Culture} from '../../../utility/culture';\n\nexport class Date extends EventEmitter\n{\n\tconstructor(sprint: Sprint)\n\t{\n\t\tsuper(sprint);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint.Header.Date');\n\n\t\tthis.sprint = sprint;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): ?HTMLElement\n\t{\n\t\tif (this.sprint.isActive() || this.sprint.isCompleted())\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__sprint--date-container\">\n\t\t\t\t<div class=\"tasks-scrum__sprint--date --start\">${Date.getFormattedDateStart(this.sprint)}</div>\n\t\t\t\t<div class=\"tasks-scrum__sprint--date-separator\"> - </div>\n\t\t\t\t<div class=\"tasks-scrum__sprint--date --end\">${Date.getFormattedDateEnd(this.sprint)}</div>\n\t\t\t\t<input type=\"hidden\" name=\"dateStart\" value=\"${Text.encode(this.sprint.getDateStartFormatted())})\">\n\t\t\t\t<input type=\"hidden\" name=\"dateEnd\" value=\"${Text.encode(this.sprint.getDateEndFormatted())}\">\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.bindEvents();\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tbindEvents()\n\t{\n\t\tif (this.sprint.isActive() || this.sprint.isCompleted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst parentPopup = this.node.closest('.popup-window');\n\n\t\tconst customBlur = () => {\n\t\t\tBX.calendar.get().popup.close();\n\t\t};\n\n\t\tconst showCalendar = (node, field) => {\n\t\t\t/* eslint-disable */\n\t\t\tBX.calendar({\n\t\t\t\tnode: node,\n\t\t\t\tfield: field,\n\t\t\t\tbTime: false,\n\t\t\t\tbSetFocus: false,\n\t\t\t\tbHideTime: false\n\t\t\t});\n\t\t\t/* eslint-enable */\n\t\t\tif (parentPopup)\n\t\t\t{\n\t\t\t\tEvent.bindOnce(parentPopup, 'click', customBlur);\n\t\t\t}\n\t\t};\n\n\t\tconst updateDateNode = (node, value) => {\n\t\t\t/* eslint-disable */\n\t\t\tnode.textContent = BX.date.format(\n\t\t\t\tCulture.getInstance().getDayMonthFormat(),\n\t\t\t\tMath.floor(BX.parseDate(value).getTime() / 1000)\n\t\t\t);\n\t\t\t/* eslint-enable */\n\t\t};\n\t\tconst sendRequest = (data) => {\n\t\t\tthis.emit('changeSprintDeadline', data);\n\t\t};\n\n\t\tconst dateStartNode = this.node.querySelector('.--start');\n\t\tconst dateEndNode = this.node.querySelector('.--end');\n\t\tconst dateStartInput = this.node.querySelector('input[name=\"dateStart\"]');\n\t\tconst dateEndInput = this.node.querySelector('input[name=\"dateEnd\"]');\n\n\t\tEvent.bind(this.node, 'click', (event) => {\n\t\t\tconst target = event.target;\n\t\t\tif (target.classList.contains('--start'))\n\t\t\t{\n\t\t\t\tshowCalendar(target, dateStartInput);\n\t\t\t}\n\t\t\telse if (target.classList.contains('--end'))\n\t\t\t{\n\t\t\t\tshowCalendar(target, dateEndInput);\n\t\t\t}\n\t\t\tevent.stopPropagation();\n\t\t});\n\t\tEvent.bind(dateStartInput, 'change', (event) => {\n\t\t\tconst value = event.target.value;\n\t\t\tupdateDateNode(dateStartNode, value);\n\t\t\tsendRequest({\n\t\t\t\tsprintId: this.sprint.getId(),\n\t\t\t\tdateStart: Math.floor(BX.parseDate(value).getTime() / 1000)\n\t\t\t});\n\t\t\tif (parentPopup)\n\t\t\t{\n\t\t\t\tEvent.unbind(parentPopup, 'click', customBlur);\n\t\t\t}\n\t\t});\n\t\tEvent.bind(dateEndInput, 'change', (event) => {\n\t\t\tconst value = event.target.value;\n\t\t\tupdateDateNode(dateEndNode, value);\n\t\t\tsendRequest({\n\t\t\t\tsprintId: this.sprint.getId(),\n\t\t\t\tdateEnd: Math.floor(BX.parseDate(value).getTime() / 1000)\n\t\t\t});\n\t\t\tif (parentPopup)\n\t\t\t{\n\t\t\t\tEvent.unbind(parentPopup, 'click', customBlur);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetWeeks()\n\t{\n\t\tconst weekCount = (parseInt(this.sprint.getDefaultSprintDuration(), 10) / 604800);\n\n\t\tif (weekCount > 5)\n\t\t{\n\t\t\treturn weekCount + ' ' + Loc.getMessage('TASKS_SCRUM_DATE_WEEK_NAME_3');\n\t\t}\n\t\telse if (weekCount === 1)\n\t\t{\n\t\t\treturn weekCount + ' ' + Loc.getMessage('TASKS_SCRUM_DATE_WEEK_NAME_1');\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn weekCount + ' ' + Loc.getMessage('TASKS_SCRUM_DATE_WEEK_NAME_2');\n\t\t}\n\t}\n\n\tstatic getFormattedTitleDatePeriod(sprint: Sprint): string\n\t{\n\t\treturn Date.getFormattedDateStart(sprint) + ' - ' + Date.getFormattedDateEnd(sprint);\n\t}\n\n\tstatic getFormattedDateStart(sprint: Sprint): string\n\t{\n\t\t/* eslint-disable */\n\t\treturn BX.date.format(Culture.getInstance().getDayMonthFormat(), sprint.getDateStart(), null, true);\n\t\t/* eslint-enable */\n\t}\n\n\tstatic getFormattedDateEnd(sprint: Sprint): string\n\t{\n\t\t/* eslint-disable */\n\t\treturn BX.date.format(Culture.getInstance().getDayMonthFormat(), sprint.getDateEnd(), null, true);\n\t\t/* eslint-enable */\n\t}\n}","export class StatsCalculator\n{\n\tcalculatePercentage(first: number, second: number): number\n\t{\n\t\tif (first === 0)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (first === '')\n\t\t{\n\t\t\treturn 100;\n\t\t}\n\n\t\tconst result = Math.round(second * 100 / first);\n\n\t\treturn (isNaN(result) ? 0 : result);\n\t}\n}","import {Dom, Tag, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {Sprint} from '../sprint';\n\nimport {StatsCalculator} from './stats.calculator';\n\nexport class Stats extends EventEmitter\n{\n\tconstructor(sprint: Sprint)\n\t{\n\t\tsuper(sprint);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint.Stats');\n\n\t\tthis.setSprintData(sprint);\n\n\t\tthis.statsCalculator = new StatsCalculator();\n\n\t\tthis.node = null;\n\n\t\tthis.kanbanMode = false;\n\t}\n\n\tsetKanbanStyle()\n\t{\n\t\tthis.kanbanMode = true;\n\t}\n\n\tisKanbanMode(): boolean\n\t{\n\t\treturn this.kanbanMode;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`<div></div>`;\n\n\t\treturn this.node;\n\t}\n\n\tsetSprintData(sprint: Sprint)\n\t{\n\t\tthis.sprint = sprint;\n\n\t\tthis.setStoryPoints(sprint.getStoryPoints().getPoints());\n\t\tthis.setCompletedStoryPoints(sprint.getCompletedStoryPoints().getPoints());\n\t\tthis.setUncompletedStoryPoints(sprint.getUncompletedStoryPoints().getPoints());\n\t\tthis.setEndDate(sprint.getDateEnd());\n\n\t\tthis.weekendDaysTime = sprint.getWeekendDaysTime();\n\n\t\tif (this.node)\n\t\t{\n\t\t\tDom.replace(this.node, this.render());\n\t\t}\n\t}\n\n\tsetStoryPoints(storyPoints)\n\t{\n\t\tif (Type.isUndefined(storyPoints) || isNaN(parseFloat(storyPoints)))\n\t\t{\n\t\t\tthis.storyPoints = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.storyPoints = parseFloat(storyPoints);\n\t\t}\n\t}\n\n\tgetStoryPoints(): number\n\t{\n\t\treturn this.storyPoints;\n\t}\n\n\tsetCompletedStoryPoints(storyPoints)\n\t{\n\t\tif (Type.isUndefined(storyPoints) || isNaN(parseFloat(storyPoints)))\n\t\t{\n\t\t\tthis.completedStoryPoints = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.completedStoryPoints = parseFloat(storyPoints);\n\t\t}\n\t}\n\n\tgetCompletedStoryPoints(): number\n\t{\n\t\treturn this.completedStoryPoints;\n\t}\n\n\tsetUncompletedStoryPoints(storyPoints)\n\t{\n\t\tif (Type.isUndefined(storyPoints) || isNaN(parseFloat(storyPoints)))\n\t\t{\n\t\t\tthis.uncompletedStoryPoints = 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.uncompletedStoryPoints = parseFloat(storyPoints);\n\t\t}\n\t}\n\n\tgetUncompletedStoryPoints(): number\n\t{\n\t\treturn this.completedStoryPoints;\n\t}\n\n\tsetEndDate(endDate)\n\t{\n\t\tif (Type.isUndefined(endDate) || isNaN(parseInt(endDate, 10)))\n\t\t{\n\t\t\tthis.endDate = (Date.now() / 1000);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.endDate = parseInt(endDate, 10);\n\t\t}\n\t}\n\n\tgetEndDate(): number\n\t{\n\t\treturn this.endDate;\n\t}\n}","import {Loc, Tag} from 'main.core';\n\nimport {Stats} from './stats';\nimport {Date as HeaderDate} from '../header/date';\nimport {Culture} from '../../../utility/culture';\n\nexport class CompletedStats extends Stats\n{\n\trender(): HTMLElement\n\t{\n\t\tconst percentage = this.statsCalculator.calculatePercentage(\n\t\t\tthis.getStoryPoints(),\n\t\t\tthis.getCompletedStoryPoints()\n\t\t);\n\n\t\tconst completedDate = this.getCompletedDate(this.getEndDate());\n\n\t\tconst label = Loc.getMessage('TASKS_SCRUM_SPRINT_STATS_COMPLETED_LABEL')\n\t\t\t.replace('#percent#', percentage)\n\t\t\t.replace('#date#', completedDate)\n\t\t;\n\n\t\tconst title = HeaderDate.getFormattedTitleDatePeriod(this.sprint);\n\n\t\tthis.node = Tag.render`\n\t\t\t<div title=\"${title}\">\n\t\t\t\t${label}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.node;\n\t}\n\n\tgetCompletedDate(endDate: number): string\n\t{\n\t\treturn BX.date.format(Culture.getInstance().getLongDateFormat(), endDate);\n\t};\n}\n","import {Loc, Tag} from 'main.core';\n\nimport {Stats} from './stats';\nimport {Date as HeaderDate} from '../header/date';\nimport {Culture} from '../../../utility/culture';\n\nexport class ExpiredStats extends Stats\n{\n\trender(): HTMLElement\n\t{\n\t\tconst percentage = this.statsCalculator.calculatePercentage(\n\t\t\tthis.getStoryPoints(),\n\t\t\tthis.getCompletedStoryPoints()\n\t\t);\n\t\tconst expiredDay = this.getExpiredDay(this.getEndDate());\n\n\t\tconst label = Loc.getMessage('TASKS_SCRUM_SPRINT_STATS_EXPIRED_LABEL')\n\t\t\t.replace('#percent#', percentage)\n\t\t\t.replace('#date#', expiredDay)\n\t\t;\n\n\t\tconst title = HeaderDate.getFormattedTitleDatePeriod(this.sprint);\n\n\t\tthis.node = Tag.render`\n\t\t\t<div title=\"${title}\">\n\t\t\t\t${label}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.node;\n\t}\n\n\tgetExpiredDay(endDate: number): string\n\t{\n\t\treturn BX.date.format(Culture.getInstance().getLongDateFormat(), endDate);\n\t};\n}\n","import {Loc, Tag, Type} from 'main.core';\n\nimport {Stats} from './stats';\nimport {Date as HeaderDate} from '../header/date';\n\nexport class ActiveStats extends Stats\n{\n\trender(): HTMLElement\n\t{\n\t\tconst remainingDays = this.getRemainingDays(this.getEndDate());\n\t\tconst percentage = this.statsCalculator.calculatePercentage(\n\t\t\tthis.getStoryPoints(),\n\t\t\tthis.getCompletedStoryPoints()\n\t\t);\n\n\t\tlet label = '';\n\t\tif (Type.isInteger(remainingDays) && remainingDays <= 1)\n\t\t{\n\t\t\tlabel = Loc.getMessage('TASKS_SCRUM_SPRINT_STATS_ACTIVE_LAST_LABEL')\n\t\t\t\t.replace('#percent#', percentage)\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlabel = Loc.getMessage('TASKS_SCRUM_SPRINT_STATS_ACTIVE_LABEL')\n\t\t\t\t.replace('#days#', remainingDays)\n\t\t\t\t.replace('#percent#', percentage)\n\t\t\t;\n\t\t}\n\n\t\tconst title = HeaderDate.getFormattedTitleDatePeriod(this.sprint);\n\n\t\tthis.node = Tag.render`\n\t\t\t<div title=\"${title}\">\n\t\t\t\t${label}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.node;\n\t}\n\n\tgetRemainingDays(endDate: number): string|number\n\t{\n\t\tconst dateWithWeekendOffset = new Date();\n\t\tdateWithWeekendOffset.setSeconds(dateWithWeekendOffset.getSeconds() + this.weekendDaysTime);\n\t\tdateWithWeekendOffset.setHours(0, 0, 0, 0);\n\n\t\tconst dateEnd = new Date(endDate * 1000);\n\n\t\tconst msPerMinute = 60 * 1000;\n\t\tconst msPerHour = msPerMinute * 60;\n\t\tconst msPerDay = msPerHour * 24;\n\n\t\tconst daysRemaining = Math.round((dateEnd - dateWithWeekendOffset) / msPerDay);\n\n\t\tif (daysRemaining <= 1)\n\t\t{\n\t\t\treturn daysRemaining;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn BX.date.format('ddiff', dateWithWeekendOffset, dateEnd);\n\t\t}\n\t};\n}\n","import {Sprint} from '../sprint';\n\nimport {Stats} from './stats';\nimport {CompletedStats} from './completed.stats';\nimport {ExpiredStats} from './expired.stats';\nimport {ActiveStats} from './active.stats';\n\nexport class StatsBuilder\n{\n\tstatic build(sprint: Sprint): Stats\n\t{\n\t\tif (sprint.isCompleted())\n\t\t{\n\t\t\treturn new CompletedStats(sprint);\n\t\t}\n\t\telse if (sprint.isExpired())\n\t\t{\n\t\t\treturn new ExpiredStats(sprint);\n\t\t}\n\t\telse if (sprint.isActive())\n\t\t{\n\t\t\treturn new ActiveStats(sprint);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn new Stats(sprint);\n\t\t}\n\t}\n}","import {Tag} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Sprint} from '../sprint';\nimport {StatsBuilder} from '../stats/stats.builder';\n\nexport class Stats extends EventEmitter\n{\n\tconstructor(sprint: Sprint)\n\t{\n\t\tsuper(sprint);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint.Header.Stats');\n\n\t\tthis.sprint = sprint;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst stats = StatsBuilder.build(this.sprint);\n\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__content--event-params\">\n\t\t\t\t${stats.render()}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n}","import {Dom, Event, Loc, Tag, Text} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\nimport {MessageBox} from 'ui.dialogs.messagebox';\n\nimport {Sprint} from '../sprint';\n\nimport {Date} from './date';\nimport {Stats} from './stats';\n\nexport class Name extends EventEmitter\n{\n\tconstructor(sprint: Sprint)\n\t{\n\t\tsuper(sprint);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint.Header.Name');\n\n\t\tthis.sprint = sprint;\n\n\t\tthis.date = null;\n\t\tthis.stats = null;\n\n\t\tthis.node = null;\n\t}\n\n\tsetDate(sprint: Sprint)\n\t{\n\t\tconst date = new Date(sprint);\n\n\t\tif (this.date)\n\t\t{\n\t\t\tDom.replace(this.date.getNode(), date.render());\n\t\t}\n\n\t\tthis.date = date;\n\n\t\tthis.date.subscribe('changeSprintDeadline', (baseEvent) => {\n\t\t\tthis.emit('changeSprintDeadline', baseEvent.getData());\n\t\t});\n\t}\n\n\tgetDate(): ?Date\n\t{\n\t\treturn this.date;\n\t}\n\n\tsetStats(sprint: Sprint)\n\t{\n\t\tconst stats = new Stats(sprint);\n\n\t\tif (this.stats)\n\t\t{\n\t\t\tDom.replace(this.stats.getNode(), stats.render());\n\t\t}\n\n\t\tthis.stats = stats;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__name-container\">\n\t\t\t\t${this.renderEditInput()}\n\t\t\t\t<div class=\"tasks-scrum__title\">\n\t\t\t\t\t${Text.encode(this.sprint.getName())}\n\t\t\t\t</div>\n\t\t\t\t${this.renderEdit()}\n\t\t\t\t${this.renderRemove()}\n\t\t\t\t${this.date ? this.date.render() : ''}\n\t\t\t\t${this.stats ? this.stats.render() : ''}\n\t\t`;\n\n\t\tconst titleNode = this.node.querySelector('.tasks-scrum__title');\n\t\tconst editNode = this.node.querySelector('.tasks-scrum__sprint--edit');\n\n\t\tEvent.bind(titleNode, 'click', () => {\n\t\t\tthis.emit('editClick', this.node.querySelector('.tasks-scrum__title-editing-input'))\n\t\t});\n\t\tEvent.bind(editNode, 'click', () => {\n\t\t\tthis.emit('editClick', this.node.querySelector('.tasks-scrum__title-editing-input'))\n\t\t});\n\n\t\tif (this.sprint.isPlanned())\n\t\t{\n\t\t\tconst removeNode = this.node.querySelector('.tasks-scrum__sprint--remove');\n\n\t\t\tEvent.bind(removeNode, 'click', () => {\n\t\t\t\tif (this.sprint.isEmpty())\n\t\t\t\t{\n\t\t\t\t\tthis.emit('removeSprint');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tMessageBox.confirm(\n\t\t\t\t\t\tLoc.getMessage('TASKS_SCRUM_CONFIRM_TEXT_REMOVE_SPRINT'),\n\t\t\t\t\t\t(messageBox) => {\n\t\t\t\t\t\t\tthis.emit('removeSprint');\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tLoc.getMessage('TASKS_SCRUM_BUTTON_TEXT_REMOVE'),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\trenderEditInput(): HTMLElement\n\t{\n\t\tconst uiClasses = 'ui-ctl ui-ctl-sm ui-ctl-textbox ui-ctl-underline ui-ctl-no-padding';\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"tasks-scrum__title-editing ${uiClasses}\">\n\t\t\t\t<input\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclass=\"tasks-scrum__title-editing-input ui-ctl-element\"\n\t\t\t\t\tvalue=\"${Text.encode(this.sprint.getName())}\"\n\t\t\t\t>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderEdit(): ?HTMLElement\n\t{\n\t\tif (!this.sprint.isCompleted())\n\t\t{\n\t\t\treturn Tag.render`<div class=\"tasks-scrum__sprint--edit\"></div>`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn '';\n\t\t}\n\t}\n\n\trenderRemove(): ?HTMLElement\n\t{\n\t\tif (this.sprint.isPlanned())\n\t\t{\n\t\t\treturn Tag.render`<div class=\"tasks-scrum__sprint--remove\"></div>`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn '';\n\t\t}\n\t}\n}\n","import {Event, Tag} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Sprint} from '../../sprint';\n\nexport class ChartIcon extends EventEmitter\n{\n\tconstructor(sprint: Sprint)\n\t{\n\t\tsuper(sprint);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint.Header.Info.ChartIcon');\n\n\t\tthis.sprint = sprint;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst uiChartStyles = 'ui-btn ui-btn-xs ui-btn-light ui-btn-round';\n\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__sprint--btn-burn-down-chart\">\n\t\t\t\t<div class=\"tasks-scrum__sprint--icon-burn-down-chart ${uiChartStyles}\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tonClick()\n\t{\n\t\tthis.emit('click');\n\t}\n}","import {Tag, Loc} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Sprint} from '../../sprint';\n\nimport 'ui.hint';\n\nexport class Counters extends EventEmitter\n{\n\tconstructor(sprint: Sprint)\n\t{\n\t\tsuper(sprint);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint.Header.Info.Counters');\n\n\t\tthis.sprint = sprint;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__sprint--event-content\">\n\t\t\t\t<div class=\"tasks-scrum__sprint--event-container\">\n\t\t\t\t\t<div class=\"tasks-scrum__sprint--subtitle\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_TASK_LABEL')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"tasks-scrum__sprint--point\"\n\t\t\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_TASK_LABEL')}\" data-hint-no-icon\n\t\t\t\t\t>\n\t\t\t\t\t\t${parseInt(this.sprint.getNumberTasks(), 10)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__sprint--event-container\">\n\t\t\t\t\t<div class=\"tasks-scrum__sprint--subtitle\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_SPRINT_HEADER_STORY_POINTS')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"tasks-scrum__sprint--point\"\n\t\t\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_SPRINT_HEADER_STORY_POINTS')}\" data-hint-no-icon\n\t\t\t\t\t>\n\t\t\t\t\t\t${this.sprint.getStoryPoints().isEmpty() ? '-' : this.sprint.getStoryPoints().getPoints()}\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.renderAverageNumberStoryPoints()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tBX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tanimation: null\n\t\t\t}\n\t\t}).init(this.node);\n\n\t\treturn this.node;\n\t}\n\n\trenderAverageNumberStoryPoints(): ?HTMLElement\n\t{\n\t\tif (\n\t\t\t!this.sprint.isPlanned()\n\t\t\t|| !this.sprint.getAverageNumberStoryPoints()\n\t\t)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div \n\t\t\t\tclass=\"tasks-scrum__sprint--point --completed\"\n\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_AVERAGE_NUMBER_STORY_POINTS')}\" data-hint-no-icon\n\t\t\t>\n\t\t\t\t${this.sprint.getAverageNumberStoryPoints()}\n\t\t\t</div>\n\t\t`;\n\t}\n}","import {Event, Tag} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Sprint} from '../../sprint';\n\nexport class Button extends EventEmitter\n{\n\tconstructor(sprint: Sprint)\n\t{\n\t\tsuper(sprint);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint.Header.Info.Button');\n\n\t\tthis.sprint = sprint;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst uiBtnStyles = 'ui-btn ui-btn-xs ui-btn-light ui-btn-round ui-btn-icon-add';\n\n\t\tthis.node = Tag.render`\n\t\t\t<button class=\"tasks-scrum__sprint--btn-add ${uiBtnStyles}\"></button>\n\t\t`;\n\n\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tonClick()\n\t{\n\t\tthis.emit('click');\n\t}\n}","import {Tag} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {Sprint} from '../../sprint';\n\nimport {ChartIcon} from './chart.icon';\nimport {Counters} from './counters';\nimport {Button} from './button';\n\nexport class Info extends EventEmitter\n{\n\tconstructor(sprint: Sprint)\n\t{\n\t\tsuper(sprint);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint.Header.Info');\n\n\t\tthis.sprint = sprint;\n\n\t\tthis.node = null;\n\n\t\tthis.chartIcon = new ChartIcon(sprint);\n\t\tthis.counters = new Counters(sprint);\n\t\tthis.button = new Button(sprint);\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__sprint--info\">\n\t\t\t\t${this.chartIcon.render()}\n\t\t\t\t${this.counters.render()}\n\t\t\t\t${this.button.render()}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.chartIcon.subscribe('click', () => this.emit('showBurnDownChart'));\n\t\tthis.button.subscribe(\n\t\t\t'click',\n\t\t\t(baseEvent: BaseEvent) => this.emit('showCreateMenu', baseEvent.getTarget())\n\t\t);\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tonClick()\n\t{\n\t\tthis.emit('click');\n\t}\n}","import {Event, Loc, Tag, Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Sprint} from '../sprint';\n\nexport class Button extends EventEmitter\n{\n\tconstructor(sprint: Sprint)\n\t{\n\t\tsuper(sprint);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint.Header.Button');\n\n\t\tthis.sprint = sprint;\n\n\t\tthis.disabled = false;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.sprint.isCompleted())\n\t\t{\n\t\t\treturn this.node;\n\t\t}\n\n\t\tconst disableUiClass = (this.isAccessDenied() ? 'ui-btn-disabled' : '');\n\n\t\tthis.node = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"tasks-scrum__sprint--btn-run ${this.getUiClasses()} ${disableUiClass}\"\n\t\t\t\ttitle=\"${this.getButtonText()}\"\n\t\t\t>\n\t\t\t\t<span class=\"tasks-scrum__sprint--btn-run-text\">${this.getButtonText()}</span>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tonClick()\n\t{\n\t\tif (this.disabled || this.isAccessDenied())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emit('click');\n\t}\n\n\tgetUiClasses(): string\n\t{\n\t\treturn 'ui-btn ui-btn-sm ui-btn-primary ui-btn-round ui-btn-no-caps';\n\t}\n\n\tgetButtonText(): string\n\t{\n\t\treturn Loc.getMessage('TASKS_SCRUM_SPRINT_HEADER_BUTTON_' + this.sprint.getStatus().toUpperCase());\n\t}\n\n\tdisable()\n\t{\n\t\tthis.disabled = true;\n\n\t\tif (this.node)\n\t\t{\n\t\t\tDom.addClass(this.node, 'ui-btn-disabled');\n\t\t}\n\t}\n\n\tunDisable()\n\t{\n\t\tthis.disabled = false;\n\n\t\tif (this.node && !this.isAccessDenied())\n\t\t{\n\t\t\tDom.removeClass(this.node, 'ui-btn-disabled');\n\t\t}\n\t}\n\n\tisAccessDenied(): boolean\n\t{\n\t\treturn (\n\t\t\tthis.sprint.isActive() && !this.sprint.canComplete()\n\t\t\t|| this.sprint.isPlanned() && !this.sprint.canStart()\n\t\t);\n\t}\n}\n","import {Dom, Event, Tag} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Sprint} from '../sprint';\n\nexport class Tick extends EventEmitter\n{\n\tconstructor(sprint: Sprint)\n\t{\n\t\tsuper(sprint);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint.Header.Tick');\n\n\t\tthis.sprint = sprint;\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__sprint--btn-dropdown ui-btn ui-btn-sm ui-btn-icon-angle-down --up\"></div>\n\t\t`;\n\n\t\tEvent.bind(this.node, 'click', this.onClick.bind(this));\n\n\t\tif (this.sprint.isHideContent())\n\t\t{\n\t\t\tDom.removeClass(this.node, '--up');\n\t\t}\n\n\t\treturn this.node;\n\t}\n\n\tonClick()\n\t{\n\t\tthis.emit('click');\n\t}\n\n\tupTick()\n\t{\n\t\tif (!this.node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.node, '--up');\n\t}\n\n\tdownTick()\n\t{\n\t\tif (!this.node)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(this.node, '--up');\n\t}\n}\n","import {Tag, Dom} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {Sprint} from '../sprint';\n\nimport {Name} from './name';\nimport {Stats} from './stats';\nimport {Info} from './info/info';\nimport {Button} from './button';\nimport {Tick} from './tick';\n\nexport class Header extends EventEmitter\n{\n\tconstructor(sprint: Sprint)\n\t{\n\t\tsuper(sprint);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint.Header');\n\n\t\tthis.sprint = sprint;\n\n\t\tthis.node = null;\n\n\t\tthis.name = null;\n\t\tthis.stats = null;\n\t\tthis.info = null;\n\t\tthis.button = null;\n\t\tthis.tick = null;\n\t}\n\n\tstatic buildHeader(sprint: Sprint): Header\n\t{\n\t\tconst header = new Header(sprint);\n\n\t\theader.setName(sprint);\n\n\t\tif (sprint.isCompleted())\n\t\t{\n\t\t\theader.setStats(sprint);\n\t\t}\n\t\telse\n\t\t{\n\t\t\theader.setInfo(sprint);\n\t\t\theader.setButton(sprint);\n\t\t}\n\n\t\theader.setTick(sprint);\n\n\t\treturn header;\n\t}\n\n\tsetName(sprint: Sprint)\n\t{\n\t\tconst name = new Name(sprint);\n\n\t\tif (sprint.isPlanned())\n\t\t{\n\t\t\tname.setDate(sprint);\n\t\t}\n\n\t\tif (sprint.isActive())\n\t\t{\n\t\t\tname.setStats(sprint);\n\t\t}\n\n\t\tif (this.name)\n\t\t{\n\t\t\tDom.replace(this.name.getNode(), name.render());\n\t\t}\n\n\t\tthis.name = name;\n\n\t\tthis.name.subscribe('editClick', (baseEvent) => {\n\t\t\tthis.emit('changeName', baseEvent.getData());\n\t\t});\n\t\tthis.name.subscribe('removeSprint', () => this.emit('removeSprint'));\n\t\tthis.name.subscribe('changeSprintDeadline', (baseEvent) => {\n\t\t\tthis.emit('changeSprintDeadline', baseEvent.getData());\n\t\t});\n\t}\n\n\tgetName(): Name\n\t{\n\t\treturn this.name;\n\t}\n\n\tsetStats(sprint: Sprint)\n\t{\n\t\tif (!sprint.isCompleted())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst stats = new Stats(sprint);\n\n\t\tif (this.stats)\n\t\t{\n\t\t\tDom.replace(this.stats.getNode(), stats.render());\n\t\t}\n\n\t\tthis.stats = stats;\n\t}\n\n\tsetInfo(sprint: Sprint)\n\t{\n\t\tconst info = new Info(sprint);\n\n\t\tif (this.info)\n\t\t{\n\t\t\tDom.replace(this.info.getNode(), info.render());\n\t\t}\n\n\t\tthis.info = info;\n\n\t\tthis.info.subscribe('showBurnDownChart', () => this.emit('showBurnDownChart'));\n\t\tthis.info.subscribe(\n\t\t\t'showCreateMenu',\n\t\t\t(baseEvent: BaseEvent) => this.emit('showCreateMenu', baseEvent.getData())\n\t\t);\n\t}\n\n\tsetButton(sprint: Sprint)\n\t{\n\t\tconst button = new Button(sprint);\n\n\t\tif (this.button)\n\t\t{\n\t\t\tDom.replace(this.button.getNode(), button.render());\n\t\t}\n\n\t\tthis.button = button;\n\n\t\tthis.button.subscribe('click', () => {\n\t\t\tif (this.sprint.isActive())\n\t\t\t{\n\t\t\t\tthis.emit('completeSprint');\n\t\t\t}\n\t\t\telse if (this.sprint.isPlanned())\n\t\t\t{\n\t\t\t\tthis.emit('startSprint');\n\t\t\t}\n\t\t});\n\t}\n\n\tsetTick(sprint: Sprint)\n\t{\n\t\tthis.tick = new Tick(sprint);\n\n\t\tthis.tick.subscribe('click', () => {\n\t\t\tthis.emit('toggleVisibilityContent');\n\t\t});\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__content-header ${this.getHeaderClass()}\">\n\t\t\t\t${this.name ? this.name.render() : ''}\n\t\t\t\t${this.stats ? this.stats.render() : ''}\n\t\t\t\t${this.info ? this.info.render() : ''}\n\t\t\t\t${this.button ? this.button.render() : ''}\n\t\t\t\t${this.tick ? this.tick.render(): ''}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.node;\n\t};\n\n\tgetNode(): ?HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetHeaderClass(): string\n\t{\n\t\treturn 'tasks-scrum__content-header --' + this.sprint.getStatus();\n\t}\n\n\tactivateEditMode()\n\t{\n\t\tDom.addClass(this.getNode(), '--editing');\n\t}\n\n\tdeactivateEditMode()\n\t{\n\t\tDom.removeClass(this.getNode(), '--editing');\n\t}\n\n\tupTick()\n\t{\n\t\tif (!this.tick)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.tick.upTick();\n\t}\n\n\tdownTick()\n\t{\n\t\tif (!this.tick)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.tick.downTick();\n\t}\n\n\tdisableButton()\n\t{\n\t\tif (this.button)\n\t\t{\n\t\t\tthis.button.disable();\n\t\t}\n\t}\n\n\tunDisableButton()\n\t{\n\t\tif (this.button)\n\t\t{\n\t\t\tthis.button.unDisable();\n\t\t}\n\t}\n}\n","import {Dom, Event, Tag, Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\n\nimport {Entity} from '../entity';\nimport {Blank} from '../blank';\nimport {Dropzone} from '../dropzone';\nimport {EmptySearchStub} from '../empty.search.stub';\n\nimport {Item, ItemParams} from '../../item/item';\nimport {SubTasks} from '../../item/task/sub.tasks';\n\nimport {Header} from './header/header';\n\nimport {StoryPointsStorage} from '../../utility/story.points.storage';\n\nimport type {Views} from '../../view/view';\n\nimport '../../css/sprint.css';\n\ntype SprintInfo = {\n\tsprintGoal?: string\n}\n\nexport type SprintParams = {\n\tid: number,\n\ttmpId: string,\n\tname: string,\n\tsort: number,\n\tdateStart?: number,\n\tdateEnd?: number,\n\tdateStartFormatted?: string,\n\tdateEndFormatted?: string,\n\tweekendDaysTime?: number,\n\tdefaultSprintDuration: number,\n\taverageNumberStoryPoints?: number,\n\tstoryPoints?: string,\n\tcompletedStoryPoints?: string,\n\tuncompletedStoryPoints?: string,\n\tcompletedTasks?: number,\n\tuncompletedTasks?: number,\n\tstatus?: string,\n\tnumberTasks?: number,\n\titems?: Array<ItemParams>,\n\tinfo?: SprintInfo,\n\tviews?: Views,\n\tallowedActions?: AllowedActions,\n\tisShownContent: 'Y' | 'N'\n};\n\ntype AllowedActions = {\n\tstart: boolean,\n\tcomplete: boolean\n}\n\nexport class Sprint extends Entity\n{\n\tconstructor(params: SprintParams)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Sprint');\n\n\t\tthis.completedStoryPoints = new StoryPointsStorage();\n\t\tthis.uncompletedStoryPoints = new StoryPointsStorage();\n\n\t\tthis.setSprintParams(params);\n\n\t\tthis.toggling = false;\n\t}\n\n\tsetSprintParams(params: SprintParams)\n\t{\n\t\tthis.setTmpId(params.tmpId);\n\t\tthis.setName(params.name);\n\t\tthis.setSort(params.sort);\n\t\tthis.setDateStart(params.dateStart);\n\t\tthis.setDateEnd(params.dateEnd);\n\t\tthis.setDateStartFormatted(params.dateStartFormatted);\n\t\tthis.setDateEndFormatted(params.dateEndFormatted);\n\t\tthis.setWeekendDaysTime(params.weekendDaysTime);\n\t\tthis.setDefaultSprintDuration(params.defaultSprintDuration);\n\t\tthis.setAverageNumberStoryPoints(params.averageNumberStoryPoints);\n\t\tthis.setStatus(params.status);\n\t\tthis.setCompletedStoryPoints(params.completedStoryPoints);\n\t\tthis.setUncompletedStoryPoints(params.uncompletedStoryPoints);\n\t\tthis.setCompletedTasks(params.completedTasks);\n\t\tthis.setUncompletedTasks(params.uncompletedTasks);\n\t\tthis.setItems(params.items);\n\t\tthis.setInfo(params.info);\n\t\tthis.setAllowedActions(params.allowedActions);\n\t\tthis.setContentVisibility(params.isShownContent);\n\t}\n\n\tstatic buildSprint(params: SprintParams): Sprint\n\t{\n\t\tconst sprint = new Sprint(params);\n\n\t\tsprint.setHeader(sprint);\n\t\tif (sprint.isCompleted())\n\t\t{\n\t\t\tsprint.setBlank(sprint);\n\t\t}\n\t\tsprint.setDropzone(sprint);\n\t\tsprint.setEmptySearchStub(sprint);\n\t\tsprint.setListItems(sprint);\n\n\t\treturn sprint;\n\t}\n\n\tsetHeader(sprint: Sprint)\n\t{\n\t\tconst header = Header.buildHeader(sprint);\n\n\t\tif (this.header)\n\t\t{\n\t\t\tDom.replace(this.header.getNode(), header.render());\n\t\t}\n\n\t\tthis.header = header;\n\n\t\tthis.header.subscribe('changeName', this.onChangeName.bind(this));\n\t\tthis.header.subscribe('removeSprint', () => this.emit('removeSprint'));\n\t\tthis.header.subscribe('completeSprint', () => this.emit('completeSprint'));\n\t\tthis.header.subscribe('startSprint', () => this.emit('startSprint'));\n\t\tthis.header.subscribe('changeSprintDeadline', this.onChangeSprintDeadline.bind(this));\n\t\tthis.header.subscribe('toggleVisibilityContent', () => {\n\t\t\tthis.toggleVisibilityContent(this.getContentContainer());\n\t\t});\n\t\tthis.header.subscribe('showBurnDownChart', () => this.emit('showSprintBurnDownChart'));\n\t\tthis.header.subscribe(\n\t\t\t'showCreateMenu',\n\t\t\t(baseEvent: BaseEvent) => {\n\t\t\t\tif (this.mandatoryExists)\n\t\t\t\t{\n\t\t\t\t\tthis.emit('createSprint');\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.emit('showSprintCreateMenu', baseEvent.getData());\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tsetBlank(sprint: Sprint)\n\t{\n\t\tthis.blank = new Blank(sprint);\n\t}\n\n\tsetDropzone(sprint: Sprint)\n\t{\n\t\tthis.dropzone = new Dropzone(sprint);\n\n\t\tif (this.mandatoryExists)\n\t\t{\n\t\t\tthis.dropzone.setMandatory();\n\t\t}\n\n\t\tthis.dropzone.subscribe('createTask', () => this.emit('showInput'));\n\t}\n\n\tsetEmptySearchStub(sprint: Sprint)\n\t{\n\t\tif (!this.isCompleted())\n\t\t{\n\t\t\tthis.emptySearchStub = new EmptySearchStub(sprint);\n\t\t}\n\t}\n\n\tisActive(): boolean\n\t{\n\t\treturn (this.getStatus() === 'active');\n\t}\n\n\tisPlanned(): boolean\n\t{\n\t\treturn (this.getStatus() === 'planned');\n\t}\n\n\tisCompleted(): boolean\n\t{\n\t\treturn (this.getStatus() === 'completed');\n\t}\n\n\tisDisabled(): boolean\n\t{\n\t\treturn (this.isCompleted());\n\t}\n\n\tisExpired(): boolean\n\t{\n\t\tconst sprintEnd = new Date(this.dateEnd * 1000);\n\t\treturn (this.isActive() && (sprintEnd.getTime() < (new Date()).getTime()));\n\t}\n\n\tgetEntityType(): string\n\t{\n\t\treturn 'sprint';\n\t}\n\n\tsetItem(newItem: Item)\n\t{\n\t\tsuper.setItem(newItem);\n\n\t\tnewItem.setDisableStatus(this.isDisabled());\n\n\t\tif (newItem.getNode())\n\t\t{\n\t\t\tDom.addClass(newItem.getNode(), '--item-sprint');\n\t\t}\n\t}\n\n\tremoveItem(item: Item)\n\t{\n\t\tsuper.removeItem(item);\n\n\t\tif (this.isEmpty())\n\t\t{\n\t\t\tthis.emit('showDropzone');\n\t\t}\n\t}\n\n\tsetName(name)\n\t{\n\t\tthis.name = (Type.isString(name) ? name : '');\n\n\t\tif (this.isNodeCreated())\n\t\t{\n\t\t\tthis.header.setName(this);\n\t\t}\n\t}\n\n\tgetName()\n\t{\n\t\treturn this.name;\n\t}\n\n\tsetTmpId(tmpId: string)\n\t{\n\t\tthis.tmpId = (Type.isString(tmpId) ? tmpId : '');\n\t}\n\n\tgetTmpId(): string\n\t{\n\t\treturn this.tmpId;\n\t}\n\n\tsetSort(sort)\n\t{\n\t\tthis.sort = (Type.isInteger(sort) ? parseInt(sort, 10) : 1);\n\n\t\tif (this.getNode())\n\t\t{\n\t\t\tthis.getNode().dataset.sprintSort = this.sort;\n\t\t}\n\t}\n\n\tgetSort()\n\t{\n\t\treturn this.sort;\n\t}\n\n\tsetDateStart(dateStart)\n\t{\n\t\tthis.dateStart = (Type.isInteger(dateStart) ? parseInt(dateStart, 10) : 0);\n\n\t\tif (this.isNodeCreated())\n\t\t{\n\t\t\tthis.header.setName(this);\n\t\t}\n\t}\n\n\tgetDateStart(): number\n\t{\n\t\treturn parseInt(this.dateStart, 10);\n\t}\n\n\tsetDateEnd(dateEnd)\n\t{\n\t\tthis.dateEnd = (Type.isInteger(dateEnd) ? parseInt(dateEnd, 10) : 0);\n\n\t\tif (this.isNodeCreated())\n\t\t{\n\t\t\tthis.header.setName(this);\n\t\t}\n\t}\n\n\tgetDateEnd(): number\n\t{\n\t\treturn parseInt(this.dateEnd, 10);\n\t}\n\n\tsetDateStartFormatted(dateStart)\n\t{\n\t\tthis.dateStartFormatted = (Type.isString(dateStart) ? dateStart : '');\n\t}\n\n\tgetDateStartFormatted(): string\n\t{\n\t\treturn this.dateStartFormatted;\n\t}\n\n\tsetDateEndFormatted(dateEnd)\n\t{\n\t\tthis.dateEndFormatted = (Type.isString(dateEnd) ? dateEnd : '');\n\t}\n\n\tgetDateEndFormatted(): string\n\t{\n\t\treturn this.dateEndFormatted;\n\t}\n\n\tsetWeekendDaysTime(weekendDaysTime)\n\t{\n\t\tthis.weekendDaysTime = (Type.isInteger(weekendDaysTime) ? parseInt(weekendDaysTime, 10) : 0);\n\t}\n\n\tgetWeekendDaysTime(): number\n\t{\n\t\treturn this.weekendDaysTime;\n\t}\n\n\tsetCompletedStoryPoints(completedStoryPoints)\n\t{\n\t\tthis.completedStoryPoints.setPoints(completedStoryPoints);\n\n\t\tthis.setStats();\n\t}\n\n\tgetCompletedStoryPoints(): StoryPointsStorage\n\t{\n\t\treturn this.completedStoryPoints;\n\t}\n\n\tsetUncompletedStoryPoints(uncompletedStoryPoints)\n\t{\n\t\tthis.uncompletedStoryPoints.setPoints(uncompletedStoryPoints);\n\n\t\tthis.setStats();\n\t}\n\n\tgetUncompletedStoryPoints(): StoryPointsStorage\n\t{\n\t\treturn this.uncompletedStoryPoints;\n\t}\n\n\tsetStats()\n\t{\n\t\tif (this.header)\n\t\t{\n\t\t\tthis.header.setStats(this);\n\t\t\tthis.header.setName(this);\n\t\t\tthis.header.setInfo(this);\n\t\t}\n\t}\n\n\tsetItems(items)\n\t{\n\t\tif (!Type.isArray(items))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\titems.forEach((itemParams: ItemParams) => {\n\t\t\tconst item = Item.buildItem(itemParams);\n\t\t\titem.setDisableStatus(this.isDisabled());\n\t\t\titem.setShortView(this.getShortView());\n\t\t\tthis.items.set(item.getId(), item);\n\t\t});\n\t}\n\n\tsetInfo(info: SprintInfo)\n\t{\n\t\tthis.info = (Type.isPlainObject(info) ? info : {sprintGoal: ''});\n\t}\n\n\tsetAllowedActions(allowedActions: AllowedActions)\n\t{\n\t\tthis.allowedActions = {\n\t\t\tstart: false,\n\t\t\tcomplete: false\n\t\t};\n\n\t\tif (Type.isPlainObject(allowedActions))\n\t\t{\n\t\t\tthis.allowedActions.start = allowedActions.start === true;\n\t\t\tthis.allowedActions.complete = allowedActions.complete === true;\n\t\t}\n\t}\n\n\tsetContentVisibility(isShown)\n\t{\n\t\tthis.hideCont = isShown !== 'Y';\n\t}\n\n\tcanStart(): boolean\n\t{\n\t\treturn this.allowedActions.start === true;\n\t}\n\n\tcanComplete(): boolean\n\t{\n\t\treturn this.allowedActions.complete === true;\n\t}\n\n\tsetNumberTasks(numberTasks: number)\n\t{\n\t\tsuper.setNumberTasks(numberTasks);\n\n\t\tif (this.header)\n\t\t{\n\t\t\tthis.header.setInfo(this);\n\t\t}\n\t}\n\n\tsetCompletedTasks(completedTasks)\n\t{\n\t\tthis.completedTasks = (Type.isInteger(completedTasks) ? parseInt(completedTasks, 10) : 0);\n\t}\n\n\tgetCompletedTasks(): number\n\t{\n\t\treturn this.completedTasks;\n\t}\n\n\tsetUncompletedTasks(uncompletedTasks)\n\t{\n\t\tthis.uncompletedTasks = (Type.isInteger(uncompletedTasks) ? parseInt(uncompletedTasks, 10) : 0);\n\t}\n\n\tgetUncompletedTasks(): number\n\t{\n\t\treturn this.uncompletedTasks;\n\t}\n\n\tsetDefaultSprintDuration(defaultSprintDuration: number)\n\t{\n\t\tthis.defaultSprintDuration = (Type.isInteger(defaultSprintDuration)\n\t\t\t? parseInt(defaultSprintDuration, 10)\n\t\t\t: 0\n\t\t);\n\t}\n\n\tgetDefaultSprintDuration(): number\n\t{\n\t\treturn this.defaultSprintDuration;\n\t}\n\n\tsetAverageNumberStoryPoints(averageNumberStoryPoints: number)\n\t{\n\t\tthis.averageNumberStoryPoints = (Type.isNumber(averageNumberStoryPoints)\n\t\t\t? parseFloat(averageNumberStoryPoints)\n\t\t\t: 0\n\t\t);\n\t}\n\n\tgetAverageNumberStoryPoints(): number\n\t{\n\t\treturn this.averageNumberStoryPoints;\n\t}\n\n\tgetInfo(): SprintInfo\n\t{\n\t\treturn this.info;\n\t}\n\n\tgetUncompletedItems(): Map<string, Item>\n\t{\n\t\tconst items = new Map();\n\n\t\tthis.items.forEach((item: Item) => {\n\t\t\tif (!item.isCompleted())\n\t\t\t{\n\t\t\t\titems.set(item.getId(), item);\n\t\t\t}\n\t\t});\n\n\t\treturn items;\n\t}\n\n\tsetStatus(status)\n\t{\n\t\tconst availableStatus = new Set([\n\t\t\t'planned',\n\t\t\t'active',\n\t\t\t'completed'\n\t\t]);\n\n\t\tthis.status = (availableStatus.has(status) ? status : 'planned');\n\n\t\tthis.setHeader(this);\n\n\t\tthis.items.forEach((item) => {\n\t\t\titem.setDisableStatus(this.isDisabled());\n\t\t});\n\n\t\tif (this.isDisabled())\n\t\t{\n\t\t\tif (this.input)\n\t\t\t{\n\t\t\t\tthis.input.removeYourself();\n\t\t\t}\n\t\t}\n\t}\n\n\tgetStatus(): string\n\t{\n\t\treturn this.status;\n\t}\n\n\tdisableHeaderButton()\n\t{\n\t\tif (this.header)\n\t\t{\n\t\t\tthis.header.disableButton();\n\t\t}\n\t}\n\n\tunDisableHeaderButton()\n\t{\n\t\tif (this.header)\n\t\t{\n\t\t\tthis.header.unDisableButton();\n\t\t}\n\t}\n\n\tupdateYourself(tmpSprint: Sprint)\n\t{\n\t\tif (tmpSprint.getName() !== this.getName())\n\t\t{\n\t\t\tthis.setName(tmpSprint.getName());\n\t\t}\n\t\tif (tmpSprint.getDateStart() !== this.getDateStart())\n\t\t{\n\t\t\tthis.setDateStart(tmpSprint.getDateStart());\n\t\t}\n\t\tif (tmpSprint.getDateEnd() !== this.getDateEnd())\n\t\t{\n\t\t\tthis.setDateEnd(tmpSprint.getDateEnd());\n\t\t}\n\n\t\tthis.setStoryPoints(tmpSprint.getStoryPoints().getPoints());\n\t\tthis.setCompletedStoryPoints(tmpSprint.getCompletedStoryPoints().getPoints());\n\t\tthis.setUncompletedStoryPoints(tmpSprint.getUncompletedStoryPoints().getPoints());\n\n\t\tif (tmpSprint.getStatus() !== this.getStatus())\n\t\t{\n\t\t\tthis.setStatus(tmpSprint.getStatus());\n\t\t}\n\n\t\tif (this.node && this.header)\n\t\t{\n\t\t\tthis.setHeader(this);\n\t\t}\n\t}\n\n\tremoveYourself()\n\t{\n\t\tEvent.bind(this.node, 'transitionend', this.removeNode.bind(this));\n\n\t\t/* eslint-disable */\n\t\tthis.node.style.height = `${ this.node.scrollHeight }px`;\n\t\tthis.node.clientHeight;\n\t\tthis.node.style.height = '0';\n\t\t/* eslint-enable */\n\t}\n\n\tremoveNode()\n\t{\n\t\tDom.remove(this.node);\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst openClass = this.isHideContent() ? '' : '--open';\n\t\tconst defaultContentStyle = this.isHideContent() ? 'height: 0;' : '';\n\n\t\tthis.node = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"tasks-scrum__content --with-header ${openClass}\"\n\t\t\t\tdata-sprint-sort=\"${this.sort}\"\n\t\t\t\tdata-sprint-id=\"${this.getId()}\"\n\t\t\t>\n\t\t\t\t${this.header ? this.header.render() : ''}\n\t\t\t\t<div class=\"tasks-scrum__content-container\" style=\"${defaultContentStyle}\">\n\t\t\t\t\t${this.blank ? this.blank.render() : ''}\n\t\t\t\t\t${this.dropzone ? this.dropzone.render() : ''}\n\t\t\t\t\t${this.emptySearchStub ? this.emptySearchStub.render() : ''}\n\t\t\t\t\t${this.listItems ? this.listItems.render() : ''}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(\n\t\t\tthis.getContentContainer(),\n\t\t\t'transitionend',\n\t\t\tthis.onTransitionEnd.bind(this, this.getContentContainer())\n\t\t);\n\n\t\treturn this.node;\n\t}\n\n\tonAfterAppend()\n\t{\n\t\tsuper.onAfterAppend();\n\n\t\tif (this.isEmpty() && !this.isCompleted())\n\t\t{\n\t\t\tif (this.getNumberTasks() > 0 && this.isExactSearchApplied())\n\t\t\t{\n\t\t\t\tthis.showEmptySearchStub();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showDropzone();\n\t\t\t}\n\t\t}\n\t}\n\n\tsubscribeToItem(item)\n\t{\n\t\tsuper.subscribeToItem(item);\n\n\t\titem.subscribe('showSubTasks', (baseEvent: BaseEvent) => {\n\t\t\tconst parentItem: Item = baseEvent.getTarget();\n\t\t\tconst subTasks: SubTasks = baseEvent.getData();\n\n\t\t\tif (this.isSubTaskLoadingActive())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (subTasks.isEmpty())\n\t\t\t{\n\t\t\t\tthis.subTaskLoadingActive = true;\n\n\t\t\t\tthis.emit('getSubTasks', subTasks);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.appendNodeAfterItem(subTasks.render(), parentItem.getNode());\n\n\t\t\t\tparentItem.showSubTasks();\n\t\t\t}\n\t\t});\n\n\t\titem.subscribe('updateCompletedStatus', (baseEvent: BaseEvent) => {\n\t\t\t[...this.getItems().values()].map((item: Item) => {\n\t\t\t\tif (item.isCompleted())\n\t\t\t\t{\n\t\t\t\t\tthis.setCompletedTasks(this.getCompletedTasks() + 1);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.setUncompletedTasks(this.getUncompletedTasks() - 1);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\titem.subscribe('toggleSubTasks', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('toggleSubTasks', baseEvent.getTarget());\n\t\t})\n\t}\n\n\tonChangeName(baseEvent: BaseEvent)\n\t{\n\t\tconst header: Header = baseEvent.getTarget();\n\t\tconst input: HTMLInputElement = baseEvent.getData();\n\n\t\theader.activateEditMode();\n\n\t\tconst length = input.value.length;\n\n\t\tinput.focus();\n\t\tinput.setSelectionRange(length, length);\n\n\t\tEvent.bind(input, 'keydown', (event: KeyboardEvent) => {\n\t\t\tif (event.isComposing || event.key === 'Escape' || event.key === 'Enter')\n\t\t\t{\n\t\t\t\tinput.blur();\n\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t}\n\t\t});\n\n\t\tEvent.bindOnce(input, 'blur', () => {\n\t\t\tif (this.getName() !== input.value)\n\t\t\t{\n\t\t\t\tthis.setName(input.value);\n\n\t\t\t\tthis.emit('changeSprintName', {\n\t\t\t\t\tsprintId: this.getId(),\n\t\t\t\t\tname: this.getName()\n\t\t\t\t});\n\t\t\t}\n\n\t\t\theader.deactivateEditMode();\n\t\t});\n\t}\n\n\tonChangeSprintDeadline(baseEvent)\n\t{\n\t\tconst requestData = baseEvent.getData();\n\n\t\tthis.emit('changeSprintDeadline', requestData);\n\n\t\tif (requestData.hasOwnProperty('dateStart'))\n\t\t{\n\t\t\tthis.dateStart = parseInt(requestData.dateStart, 10);\n\t\t}\n\t\telse if (requestData.hasOwnProperty('dateEnd'))\n\t\t{\n\t\t\tthis.dateEnd = parseInt(requestData.dateEnd, 10);\n\t\t}\n\t}\n\n\tonTransitionEnd(node: HTMLElement)\n\t{\n\t\tif (Dom.style(node, 'height') !== '0px')\n\t\t{\n\t\t\tDom.style(node, 'height', 'auto');\n\t\t}\n\n\t\tif (this.toggling)\n\t\t{\n\t\t\tthis.bindItemsLoader();\n\n\t\t\tthis.toggling = false;\n\n\t\t\tthis.emit('toggleVisibilityContent');\n\t\t}\n\n\t\tthis.emit('transitionEnd');\n\t}\n\n\ttoggleVisibilityContent(node: HTMLElement)\n\t{\n\t\tthis.toggling = true;\n\n\t\tthis.unbindItemsLoader();\n\n\t\tif (this.isHideContent())\n\t\t{\n\t\t\tthis.showContent(node);\n\n\t\t\tif (this.isCompleted())\n\t\t\t{\n\t\t\t\tif (this.getItems().size === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.emit('getSprintCompletedItems');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideContent(node);\n\t\t}\n\t}\n\n\tshowContent(node: HTMLElement): Promise\n\t{\n\t\tthis.hideCont = false;\n\n\t\tif (node)\n\t\t{\n\t\t\tDom.style(node, 'height', `${ node.scrollHeight }px`);\n\t\t}\n\n\t\tif (this.header)\n\t\t{\n\t\t\tthis.header.upTick();\n\t\t}\n\n\t\tDom.addClass(this.node, '--open');\n\n\t\treturn new Promise((resolve) => {\n\t\t\tEvent.bindOnce(this.getContentContainer(), 'transitionend', () => resolve());\n\t\t});\n\t}\n\n\thideContent(node?: HTMLElement): Promise\n\t{\n\t\tthis.hideCont = true;\n\n\t\tif (node)\n\t\t{\n\t\t\t/* eslint-disable */\n\t\t\tnode.style.height = `${ node.scrollHeight }px`;\n\t\t\tnode.clientHeight;\n\t\t\tnode.style.height = '0';\n\t\t\t/* eslint-enable */\n\t\t}\n\n\t\tif (this.header)\n\t\t{\n\t\t\tthis.header.downTick();\n\t\t}\n\n\t\tDom.removeClass(this.node, '--open');\n\n\t\treturn new Promise((resolve) => {\n\t\t\tEvent.bindOnce(this.getContentContainer(), 'transitionend', () => resolve());\n\t\t});\n\t}\n\n\tshowSprint()\n\t{\n\t\tif (this.node)\n\t\t{\n\t\t\tDom.style(this.node, 'display', 'block');\n\t\t}\n\t}\n\n\thideSprint()\n\t{\n\t\tif (this.node)\n\t\t{\n\t\t\tDom.style(this.node, 'display', 'none');\n\t\t}\n\t}\n\n\tgetContentContainer(): HTMLElement\n\t{\n\t\treturn this.node.querySelector('.tasks-scrum__content-container');\n\t}\n\n\tfadeOut()\n\t{\n\t\tif (!this.isCompleted())\n\t\t{\n\t\t\tsuper.fadeOut();\n\t\t}\n\t}\n\n\tfadeIn()\n\t{\n\t\tif (!this.isCompleted())\n\t\t{\n\t\t\tsuper.fadeIn();\n\t\t}\n\t}\n\n\tdeactivateSubTaskLoading(item: Item)\n\t{\n\t\tthis.subTaskLoadingActive = false;\n\n\t\titem.unDisableToggle();\n\t}\n\n\tisSubTaskLoadingActive(): boolean\n\t{\n\t\treturn this.subTaskLoadingActive === true;\n\t}\n}\n\n","import {Type} from 'main.core';\n\nimport {Entity} from './entity';\nimport {Backlog} from './backlog/backlog';\nimport {Sprint} from './sprint/sprint';\n\nexport class EntityStorage\n{\n\tconstructor()\n\t{\n\t\tthis.backlog = null;\n\t\tthis.sprints = new Map();\n\t\tthis.filteredCompletedSprints = new Map();\n\t}\n\n\taddBacklog(backlog: Backlog)\n\t{\n\t\tif (!(backlog instanceof Backlog))\n\t\t{\n\t\t\tthrow new Error('EntityStorage: Backlog is in wrong format');\n\t\t}\n\n\t\tthis.backlog = backlog;\n\t}\n\n\taddSprint(sprint: Sprint)\n\t{\n\t\tthis.sprints.set(sprint.getId(), sprint);\n\t}\n\n\taddFilteredCompletedSprint(sprint: Sprint)\n\t{\n\t\tthis.filteredCompletedSprints.set(sprint.getId(), sprint);\n\t}\n\n\tclearFilteredCompletedSprints()\n\t{\n\t\tthis.filteredCompletedSprints.clear();\n\t}\n\n\tremoveSprint(sprintId: number)\n\t{\n\t\tthis.sprints.delete(sprintId);\n\t}\n\n\tgetBacklog(): Backlog\n\t{\n\t\tif (this.backlog === null)\n\t\t{\n\t\t\tthrow new Error('EntityStorage: Backlog not found');\n\t\t}\n\n\t\treturn this.backlog;\n\t}\n\n\tgetSprints(): Map<number, Sprint>\n\t{\n\t\treturn this.sprints;\n\t}\n\n\tgetActiveSprint(): ?Sprint\n\t{\n\t\treturn [...this.sprints.values()].find((sprint: Sprint) => sprint.isActive());\n\t}\n\n\tgetPlannedSprints(): Set<Sprint>\n\t{\n\t\tconst sprints = new Set();\n\n\t\tthis.sprints.forEach((sprint: Sprint) => {\n\t\t\tif (sprint.isPlanned())\n\t\t\t{\n\t\t\t\tsprints.add(sprint);\n\t\t\t}\n\t\t});\n\n\t\treturn sprints;\n\t}\n\n\tgetFilteredCompletedSprints(): Set<Sprint>\n\t{\n\t\tconst sprints = new Set();\n\n\t\tthis.sprints.forEach((sprint: Sprint) => {\n\t\t\tif (sprint.isCompleted() && !sprint.isEmpty())\n\t\t\t{\n\t\t\t\tsprints.add(sprint);\n\t\t\t}\n\t\t});\n\n\t\treturn sprints;\n\t}\n\n\tgetSprintsAvailableForFilling(entityFrom: Entity): Set<Sprint>\n\t{\n\t\tconst sprints = new Set();\n\n\t\tthis.sprints.forEach((sprint: Sprint) => {\n\t\t\tif (!sprint.isCompleted() && entityFrom.getId() !== sprint.getId())\n\t\t\t{\n\t\t\t\tsprints.add(sprint);\n\t\t\t}\n\t\t});\n\n\t\treturn sprints;\n\t}\n\n\texistCompletedSprint(): boolean\n\t{\n\t\treturn !Type.isUndefined([...this.sprints.values()].find((sprint) => sprint.isCompleted()));\n\t}\n\n\tgetAllEntities(): Map<number, Entity>\n\t{\n\t\tconst entities = new Map();\n\n\t\tentities.set(this.backlog.getId(), this.backlog);\n\n\t\t[...this.sprints.values()].map((sprint) => entities.set(sprint.getId(), sprint));\n\n\t\treturn entities;\n\t}\n\n\tgetAllItems(): Map<number, Item>\n\t{\n\t\tlet items = new Map(this.backlog.getItems());\n\n\t\tconst activeSprint = this.getActiveSprint();\n\n\t\tif (activeSprint)\n\t\t{\n\t\t\titems = new Map([...items, ...activeSprint.getItems()]);\n\t\t}\n\n\t\t[...this.getPlannedSprints().values()].map((sprint) => items = new Map([...items, ...sprint.getItems()]));\n\n\t\treturn items;\n\t}\n\n\texistsAtLeastOneItem(): boolean\n\t{\n\t\tif (this.backlog.getNumberTasks() > 0)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst filledSprint = [...this.sprints.values()].find((sprint: Sprint) => sprint.getNumberTasks() > 0);\n\n\t\treturn !Type.isUndefined(filledSprint);\n\t}\n\n\trecalculateItemsSort()\n\t{\n\t\tthis.backlog.recalculateItemsSort();\n\t\tthis.sprints.forEach((sprint) => sprint.recalculateItemsSort());\n\t}\n\n\tfindEntityByEntityId(entityId: number): ?Entity\n\t{\n\t\tentityId = parseInt(entityId, 10);\n\n\t\tif (this.backlog.getId() === entityId)\n\t\t{\n\t\t\treturn this.backlog;\n\t\t}\n\n\t\treturn [...this.sprints.values()].find((sprint) => sprint.getId() === entityId);\n\t}\n\n\tfindItemByItemId(itemId: number): ?Item\n\t{\n\t\titemId = parseInt(itemId, 10);\n\n\t\tconst backlogItems = this.backlog.getItems();\n\t\tif (backlogItems.has(itemId))\n\t\t{\n\t\t\treturn backlogItems.get(itemId);\n\t\t}\n\n\t\tconst sprint = [...this.sprints.values()].find((sprint) => sprint.getItems().has(itemId));\n\t\tif (sprint)\n\t\t{\n\t\t\treturn sprint.getItems().get(itemId);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfindItemBySourceId(sourceId: number): ?Item\n\t{\n\t\tsourceId = parseInt(sourceId, 10);\n\n\t\tlet items = new Map(this.backlog.getItems());\n\n\t\t[...this.sprints.values()].map((sprint) => items = new Map([...items, ...sprint.getItems()]));\n\n\t\treturn [...items.values()].find((item: Item) => item.getSourceId() === sourceId);\n\t}\n\n\tfindItemBySourceInFilteredCompletedSprints(sourceId: number): ?Item\n\t{\n\t\tlet items = new Map();\n\n\t\t[...this.filteredCompletedSprints.values()].map((sprint) => items = new Map([...items, ...sprint.getItems()]));\n\n\t\treturn [...items.values()].find((item: Item) => item.getSourceId() === sourceId);\n\t}\n\n\tfindEntityByItemId(itemId: number): Entity\n\t{\n\t\titemId = parseInt(itemId, 10);\n\n\t\tconst backlogItems = this.backlog.getItems();\n\t\tif (backlogItems.has(itemId))\n\t\t{\n\t\t\treturn this.backlog;\n\t\t}\n\n\t\treturn [...this.sprints.values()].find((sprint) => sprint.getItems().has(itemId));\n\t}\n}","import {Dom} from 'main.core';\n\nimport {PlanBuilder} from '../view/plan/plan.builder';\n\nimport {EntityStorage} from '../entity/entity.storage';\n\nimport {Sprint} from '../entity/sprint/sprint';\nimport {Item} from '../item/item';\n\ntype Params = {\n\tplanBuilder: PlanBuilder,\n\tentityStorage: EntityStorage\n}\n\nexport class Scroller\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.planBuilder = params.planBuilder;\n\t\tthis.entityStorage = params.entityStorage;\n\t}\n\n\tscrollToItem(item: Item)\n\t{\n\t\tif (this.isItemInViewport(item))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst offset = 112;\n\n\t\tif (this.isBacklogItem(item))\n\t\t{\n\t\t\tconst scrollContainer = this.entityStorage.getBacklog().getListItemsNode();\n\n\t\t\tconst itemTopPosition = Dom.getRelativePosition(item.getNode(), scrollContainer).top;\n\n\t\t\tscrollContainer.scrollTo({\n\t\t\t\ttop: scrollContainer.scrollTop + itemTopPosition - offset,\n\t\t\t\tbehavior: 'smooth'\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst sprintsContainer = this.planBuilder.getSprintsContainer()\n\n\t\t\tconst itemTopPosition = Dom.getRelativePosition(item.getNode(), sprintsContainer).top;\n\n\t\t\tsprintsContainer.scrollTo({\n\t\t\t\ttop: sprintsContainer.scrollTop + itemTopPosition - offset,\n\t\t\t\tbehavior: 'smooth'\n\t\t\t});\n\t\t}\n\t}\n\n\tscrollToSprint(sprint: Sprint)\n\t{\n\t\twindow.scrollTo({ top: 240, behavior: 'smooth' });\n\n\t\t// todo dynamic focus to sprint node (loadItems)\n\n\t\tconst offset = 80;\n\n\t\tconst sprintsContainer = this.planBuilder.getSprintsContainer();\n\t\tconst position = Dom.getRelativePosition(sprint.getNode(), sprintsContainer).top;\n\n\t\tsprintsContainer.scrollTo({\n\t\t\ttop: sprintsContainer.scrollTop + position - offset,\n\t\t\tbehavior: 'smooth'\n\t\t});\n\t}\n\n\tisItemInViewport(item: Item): boolean\n\t{\n\t\tconst rect = item.getNode().getBoundingClientRect();\n\n\t\treturn (\n\t\t\trect.top >= 0\n\t\t\t&& rect.left >= 0\n\t\t\t&& rect.bottom <= (window.innerHeight || document.documentElement.clientHeight)\n\t\t\t&& rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n\t\t);\n\t}\n\n\tisBacklogItem(item: Item): boolean\n\t{\n\t\treturn this.entityStorage.getBacklog().hasItem(item);\n\t}\n}","import {Event, Loc, Tag, Type, Dom} from 'main.core';\nimport {Loader} from 'main.loader';\nimport {EventEmitter} from 'main.core.events';\n\nimport 'main.polyfill.intersectionobserver';\n\nimport {EntityStorage} from '../../entity/entity.storage';\nimport {Sprint, SprintParams} from '../../entity/sprint/sprint';\n\nimport {RequestSender} from '../../utility/request.sender';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tentityStorage: EntityStorage,\n\tpageNumber: number,\n\tisShortView: 'Y' | 'N'\n}\n\ntype Stats = {\n\tnumberSprints: number,\n\taverageNumberTasks: number,\n\taverageNumberStoryPoints: number,\n\taveragePercentageCompletion: number\n}\n\nimport '../../css/completed.sprints.css';\n\nexport class CompletedSprints extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.CompletedSprints');\n\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.entityStorage = params.entityStorage;\n\t\tthis.pageNumber = parseInt(params.pageNumber, 10);\n\t\tthis.isShortView = params.isShortView;\n\n\t\tthis.statsUploaded = false;\n\t\tthis.sprintsUploaded = false;\n\n\t\tthis.loader = null;\n\n\t\tthis.isActiveLoad = false;\n\n\t\tthis.node = null;\n\t\tthis.header = null;\n\t\tthis.filteredSprintsNode = null;\n\t\tthis.listNode = null;\n\t\tthis.emptySearchStub = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__content\">\n\t\t\t\t<div class=\"tasks-scrum__sprints--completed\">\n\t\t\t\t\t<div class=\"tasks-scrum__sprints--completed-title\">\n\t\t\t\t\t\t<span class=\"tasks-scrum__sprints--completed-title-text\">\n\t\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_COMPLETED_SPRINTS_TITLE')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-scrum__content-empty --no-results\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_EMPTY_SEARCH_STUB_COMPLETED')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-scrum__sprints--filtered-sprints\"></div>\n\t\t\t\t\t${this.renderHeader()}\n\t\t\t\t\t${this.renderList()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.filteredSprintsNode = this.node.querySelector('.tasks-scrum__sprints--filtered-sprints');\n\t\tthis.listNode = this.node.querySelector('.tasks-scrum__sprints--completed-list');\n\n\t\tthis.emptySearchStub = this.node.querySelector('.tasks-scrum__content-empty');\n\n\t\tEvent.bind(this.listNode, 'transitionend', this.onTransitionEnd.bind(this));\n\n\t\tconst observerTargetNode = this.listNode.querySelector('.tasks-scrum-completed-sprints-observer-target');\n\n\t\tthis.bindLoad(observerTargetNode);\n\n\t\treturn this.node;\n\t}\n\n\tshowEmptySearchStub(): void\n\t{\n\t\tDom.addClass(this.emptySearchStub, '--open');\n\n\t\tthis.hideFilteredHeader();\n\t}\n\n\thideEmptySearchStub(): void\n\t{\n\t\tDom.removeClass(this.emptySearchStub, '--open');\n\n\t\tthis.showHeader();\n\t}\n\n\trenderHeader(): HTMLElement\n\t{\n\t\tconst btnStyles = 'tasks-scrum__sprint--btn-dropdown ui-btn ui-btn-sm ui-btn-icon-angle-down';\n\n\t\tthis.header = Tag.render`\n\t\t\t<div class=\"tasks-scrum__sprints--completed-header\">\n\t\t\t\t<div class=\"tasks-scrum__sprints--completed-name\">\n\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_COMPLETED_SPRINTS_NAME')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__sprints--completed-stats\"></div>\n\t\t\t\t<div class=\"tasks-scrum__sprints--completed-btn ${btnStyles}\"></div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst btnNode = this.header.querySelector('.tasks-scrum__sprints--completed-btn');\n\t\tEvent.bind(btnNode, 'click', this.onBtnClick.bind(this));\n\n\t\treturn this.header;\n\t}\n\n\tonBtnClick(event)\n\t{\n\t\tconst node = event.currentTarget;\n\n\t\tconst isShown = Dom.hasClass(node, '--up');\n\n\t\tif (isShown)\n\t\t{\n\t\t\tDom.removeClass(node, '--up');\n\n\t\t\tthis.hideList();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(node, '--up');\n\n\t\t\tDom.addClass(this.listNode, '--visible');\n\n\t\t\tthis.showList();\n\n\t\t\tif (!this.isSprintsUploaded() && Type.isNull(this.loader))\n\t\t\t{\n\t\t\t\tthis.loader = this.showLoader();\n\t\t\t}\n\t\t}\n\n\t\tthis.onLoadStats();\n\t}\n\n\trenderList(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"tasks-scrum__sprints--completed-list\">\n\t\t\t\t${this.renderObserverTarget()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\trenderObserverTarget(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"tasks-scrum-completed-sprints-observer-target\"></div>`;\n\t}\n\n\trenderStats(stats: Stats): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t${Loc.getMessage('TASKS_SCRUM_COMPLETED_SPRINTS_STATS')\n\t\t\t\t\t.replace('#tasks#', parseInt(stats.averageNumberTasks, 10))\n\t\t\t\t\t.replace('#storypoints#', parseInt(stats.averageNumberStoryPoints, 10))\n\t\t\t\t\t.replace('#percent#', parseInt(stats.averagePercentageCompletion, 10))\n\t\t\t\t}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tisSprintsUploaded(): boolean\n\t{\n\t\treturn this.sprintsUploaded;\n\t}\n\n\tbindLoad(loader: HTMLElement)\n\t{\n\t\tif (Type.isUndefined(IntersectionObserver))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst observer = new IntersectionObserver((entries) =>\n\t\t\t{\n\t\t\t\tif(entries[0].isIntersecting === true)\n\t\t\t\t{\n\t\t\t\t\tif (!this.isActiveLoad)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onLoadCompletedSprints();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tthreshold: [0]\n\t\t\t}\n\t\t);\n\n\t\tobserver.observe(loader);\n\t}\n\n\tonLoadStats()\n\t{\n\t\tif (this.statsUploaded)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.statsUploaded = true;\n\n\t\tthis.requestSender.getCompletedSprintsStats()\n\t\t\t.then((response) => {\n\t\t\t\tthis.updateStats(response.data);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.statsUploaded = false;\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tonLoadCompletedSprints()\n\t{\n\t\tthis.isActiveLoad = true;\n\n\t\tif (this.isSprintsUploaded() && Type.isNull(this.loader))\n\t\t{\n\t\t\tthis.loader = this.showLoader();\n\t\t}\n\n\t\tconst requestData = {\n\t\t\tpageNumber: this.pageNumber\n\t\t};\n\n\t\tthis.requestSender.getCompletedSprints(requestData)\n\t\t\t.then((response) => {\n\t\t\t\tconst data = response.data;\n\t\t\t\tif (Type.isArray(data) && data.length)\n\t\t\t\t{\n\t\t\t\t\tthis.pageNumber++;\n\n\t\t\t\t\tthis.createSprints(data);\n\n\t\t\t\t\tthis.isActiveLoad = false;\n\n\t\t\t\t\tthis.showList();\n\t\t\t\t}\n\t\t\t\tthis.sprintsUploaded = true;\n\t\t\t\tif (this.loader)\n\t\t\t\t{\n\t\t\t\t\tthis.loader.hide();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tif (this.loader)\n\t\t\t\t{\n\t\t\t\t\tthis.loader.hide();\n\t\t\t\t}\n\t\t\t\tthis.isActiveLoad = false;\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tshowLoader(): Loader\n\t{\n\t\tconst listPosition = Dom.getPosition(this.listNode);\n\n\t\tconst loader = new Loader({\n\t\t\ttarget: this.listNode,\n\t\t\tsize: 60,\n\t\t\tmode: 'inline',\n\t\t\toffset: {\n\t\t\t\tleft: `${(listPosition.width / 2 - 30)}px`\n\t\t\t}\n\t\t});\n\n\t\tloader.show();\n\n\t\treturn loader;\n\t}\n\n\tupdateStats(stats: Stats)\n\t{\n\t\tconst nameNode = this.node.querySelector('.tasks-scrum__sprints--completed-name');\n\t\tconst statsHeaderNode = this.node.querySelector('.tasks-scrum__sprints--completed-stats');\n\n\t\tnameNode.textContent = nameNode.textContent + '- ' + parseInt(stats.numberSprints, 10);\n\n\t\tDom.append(this.renderStats(stats), statsHeaderNode);\n\t}\n\n\tcreateSprints(sprints: Array)\n\t{\n\t\tsprints.forEach((sprintData: SprintParams) => {\n\t\t\tsprintData.isShortView = 'Y';\n\t\t\tconst sprint = Sprint.buildSprint(sprintData);\n\n\t\t\tthis.entityStorage.addSprint(sprint);\n\n\t\t\tDom.insertBefore(\n\t\t\t\tsprint.render(),\n\t\t\t\tthis.listNode.querySelector('.tasks-scrum-completed-sprints-observer-target')\n\t\t\t);\n\t\t\tsprint.onAfterAppend();\n\n\t\t\tthis.emit('createSprint', sprint);\n\t\t});\n\t}\n\n\taddSprint(sprint: Sprint)\n\t{\n\t\tthis.entityStorage.addSprint(sprint);\n\n\t\tDom.insertBefore(sprint.render(), this.listNode.firstElementChild);\n\n\t\tsprint.onAfterAppend();\n\n\t\tthis.emit('createSprint', sprint);\n\t}\n\n\tshowFilteredSprints(completedSprints: Map<Sprint>)\n\t{\n\t\tif (Type.isNull(this.filteredSprintsNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.clean(this.filteredSprintsNode);\n\n\t\tcompletedSprints\n\t\t\t.forEach((sprint: Sprint) => {\n\t\t\t\tDom.append(sprint.render(), this.filteredSprintsNode);\n\t\t\t\tsprint.onAfterAppend();\n\t\t\t\tthis.emit('createSprint', sprint);\n\t\t\t\tthis.entityStorage.addFilteredCompletedSprint(sprint);\n\t\t\t\tsetTimeout(() => sprint.toggleVisibilityContent(sprint.getContentContainer()), 100);\n\t\t\t})\n\t\t;\n\n\t\tthis.hideFilteredHeader();\n\t}\n\n\thideFilteredSprints()\n\t{\n\t\tDom.clean(this.filteredSprintsNode);\n\n\t\tthis.entityStorage.clearFilteredCompletedSprints();\n\n\t\tthis.showHeader();\n\t}\n\n\thideFilteredHeader()\n\t{\n\t\tthis.hideHeader();\n\t\tthis.hideList();\n\n\t\tDom.removeClass(this.header.querySelector('.tasks-scrum__sprints--completed-btn'), '--up');\n\t}\n\n\tshowHeader()\n\t{\n\t\tif (Type.isNull(this.header))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(this.header, '--hide');\n\t}\n\n\thideHeader()\n\t{\n\t\tif (Type.isNull(this.header))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.addClass(this.header, '--hide');\n\t}\n\n\tshowList()\n\t{\n\t\tconst parentNode = this.node.querySelector('.tasks-scrum__sprints--completed');\n\n\t\tDom.addClass(parentNode, '--open');\n\n\t\tDom.style(this.listNode, 'height', `${ this.listNode.scrollHeight }px`);\n\n\t\tthis.emit('adjustWidth');\n\t}\n\n\thideList()\n\t{\n\t\tconst parentNode = this.node.querySelector('.tasks-scrum__sprints--completed');\n\n\t\tDom.removeClass(parentNode, '--open');\n\n\t\t/* eslint-disable */\n\t\tthis.listNode.style.height = `${ this.listNode.scrollHeight }px`;\n\t\tthis.listNode.clientHeight;\n\t\tthis.listNode.style.height = '0';\n\t\t/* eslint-enable */\n\t}\n\n\tonTransitionEnd()\n\t{\n\t\tconst isHide = (Dom.style(this.listNode, 'height') === '0px');\n\n\t\tif (isHide)\n\t\t{\n\t\t\tDom.removeClass(this.listNode, '--visible');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.style(this.listNode, 'height', 'auto');\n\t\t}\n\n\t\tthis.emit('adjustWidth');\n\t}\n}","import {Dom, Event, Loc, Tag, Text, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {EntityStorage} from '../../entity/entity.storage';\nimport {Entity} from '../../entity/entity';\nimport {Sprint, SprintParams} from '../../entity/sprint/sprint';\nimport {Item, ItemParams} from '../../item/item';\n\nimport {RequestSender} from '../../utility/request.sender';\nimport {Scroller} from '../../utility/scroller';\n\nimport {CompletedSprints} from './completed.sprints';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tentityStorage: EntityStorage,\n\tdefaultSprintDuration: number,\n\tpageNumberToCompletedSprints: number,\n\tdisplayPriority: string,\n\tisShortView: 'Y' | 'N',\n\tmandatoryExists: 'Y' | 'N',\n\tisExactSearchApplied: 'Y' | 'N',\n\tpageSize: number\n}\n\nexport class PlanBuilder extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.DomBuilder');\n\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.entityStorage = params.entityStorage;\n\t\tthis.defaultSprintDuration = params.defaultSprintDuration;\n\t\tthis.pageNumberToCompletedSprints = params.pageNumberToCompletedSprints;\n\t\tthis.displayPriority = params.displayPriority;\n\t\tthis.isShortView = params.isShortView;\n\t\tthis.mandatoryExists = params.mandatoryExists;\n\t\tthis.isExactSearchApplied = params.isExactSearchApplied === 'Y';\n\t\tthis.pageSize = parseInt(params.pageSize, 10);\n\n\t\tthis.scroller = new Scroller({\n\t\t\tplanBuilder: this,\n\t\t\tentityStorage: this.entityStorage\n\t\t});\n\n\t\tthis.loadItemsRepeatCounter = new Map();\n\t}\n\n\trenderTo(container: HTMLElement)\n\t{\n\t\tthis.scrumContainer = container;\n\n\t\tthis.setWidthPriority(this.displayPriority);\n\n\t\tDom.append(this.entityStorage.getBacklog().render(), this.scrumContainer);\n\t\tthis.entityStorage.getBacklog().onAfterAppend();\n\n\t\tDom.append(this.renderSprintsContainer(), this.scrumContainer);\n\t\tthis.entityStorage.getSprints().forEach((sprint: Sprint) => {\n\t\t\tif (!sprint.isCompleted())\n\t\t\t{\n\t\t\t\tsprint.onAfterAppend();\n\t\t\t}\n\t\t});\n\n\t\tthis.emit('setDraggable');\n\n\t\tthis.adjustSprintListWidth();\n\t}\n\n\trenderSprintsContainer(): HTMLElement\n\t{\n\t\tthis.completedSprints = new CompletedSprints({\n\t\t\trequestSender: this.requestSender,\n\t\t\tentityStorage: this.entityStorage,\n\t\t\tpageNumber: this.pageNumberToCompletedSprints,\n\t\t\tisShortView: this.isShortView\n\t\t});\n\t\tthis.completedSprints.subscribe('createSprint', (baseEvent: BaseEvent) => {\n\t\t\tthis.emit('createSprint', baseEvent.getData());\n\t\t});\n\t\tthis.completedSprints.subscribe('adjustWidth', () => this.adjustSprintListWidth());\n\n\t\tconst activeSprint = this.entityStorage.getActiveSprint();\n\t\tconst plannedSprints = this.entityStorage.getPlannedSprints();\n\n\t\tthis.sprintsNode = Tag.render`\n\t\t\t<div class=\"tasks-scrum__sprints --scrollbar\">\n\t\t\t\t<div class=\"tasks-scrum__sprints--active ${activeSprint ? '' : '--empty'}\">\n\t\t\t\t\t${activeSprint ? activeSprint.render() : ''}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__sprints--planned ${plannedSprints.size ? '' : '--empty'}\">\n\t\t\t\t\t${[...plannedSprints.values()].map((sprint) => sprint.render())}\n\t\t\t\t</div>\n\t\t\t\t${this.renderSprintDropzone()}\n\t\t\t\t${this.entityStorage.existCompletedSprint() ? this.completedSprints.render() : ''}\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.updatePlannedSprints(plannedSprints, !Type.isUndefined(activeSprint));\n\n\t\tif (this.isExactSearchApplied)\n\t\t{\n\t\t\tconst filteredCompletedSprints = this.entityStorage.getFilteredCompletedSprints();\n\t\t\tif (filteredCompletedSprints.size)\n\t\t\t{\n\t\t\t\tthis.showFilteredCompletedSprints(filteredCompletedSprints);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showEmptySearchStub();\n\t\t\t}\n\t\t}\n\n\t\tEvent.bind(this.sprintsNode, 'scroll', this.onSprintsScroll.bind(this));\n\n\t\treturn this.sprintsNode;\n\t}\n\n\trenderSprintDropzone(): HTMLElement\n\t{\n\t\tthis.sprintDropzone = Tag.render`\n\t\t\t<div class=\"tasks-scrum__content\">\n\t\t\t\t<div class=\"tasks-scrum__sprints--new-sprint\">\n\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_PLAN_SPRINT_DROPZONE')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.sprintDropzone, 'click', this.createSprint.bind(this));\n\n\t\treturn this.sprintDropzone;\n\t}\n\n\tsetWidthPriority(value: string)\n\t{\n\t\tif (value === 'backlog')\n\t\t{\n\t\t\tDom.addClass(this.scrumContainer, '--width-priority-backlog');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.scrumContainer, '--width-priority-backlog');\n\t\t}\n\t}\n\n\tsetShortView(value: 'Y' | 'N')\n\t{\n\t\tthis.isShortView = value;\n\t}\n\n\tgetSprintsContainer(): HTMLElement\n\t{\n\t\treturn this.sprintsNode;\n\t}\n\n\tgetSprintDropzone(): HTMLElement\n\t{\n\t\treturn this.sprintDropzone;\n\t}\n\n\tisSprintDropzone(container: HTMLElement): boolean\n\t{\n\t\tif (container.firstElementChild)\n\t\t{\n\t\t\treturn Dom.hasClass(container.firstElementChild, 'tasks-scrum__sprints--new-sprint');\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tcreateSprint(): Promise\n\t{\n\t\tconst dateStart = Math.floor(Date.now() / 1000);\n\t\tconst dateEnd = (Math.floor(Date.now() / 1000) + parseInt(this.defaultSprintDuration, 10));\n\t\tconst sort = this.entityStorage.getPlannedSprints().size + 1;\n\n\t\tconst requestData = {\n\t\t\ttmpId: Text.getRandom(),\n\t\t\tsort: sort + 1,\n\t\t\tdateStart: dateStart,\n\t\t\tdateEnd: dateEnd\n\t\t};\n\n\t\tthis.emit('beforeCreateSprint', requestData);\n\n\t\treturn this.requestSender.createSprint(requestData)\n\t\t\t.then((response) => {\n\t\t\t\tconst sprintParams: SprintParams = response.data;\n\t\t\t\tsprintParams.isShortView = this.isShortView;\n\t\t\t\tsprintParams.mandatoryExists = this.mandatoryExists;\n\t\t\t\tsprintParams.isExactSearchApplied = this.isExactSearchApplied ? 'Y' : 'N';\n\n\t\t\t\tconst sprint = Sprint.buildSprint(sprintParams);\n\n\t\t\t\tthis.entityStorage.addSprint(sprint);\n\n\t\t\t\tthis.appendToPlannedContainer(sprint);\n\n\t\t\t\tthis.updateVisibilitySprints(sprint).then(() => {\n\t\t\t\t\tthis.scroller.scrollToSprint(sprint);\n\n\t\t\t\t\tthis.emit('createSprint', sprint);\n\t\t\t\t});\n\n\t\t\t\treturn sprint;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tcreateSprintNode(sprint: Sprint)\n\t{\n\t\tsprint.setShortView(this.isShortView);\n\t\tsprint.setMandatory(this.mandatoryExists);\n\n\t\tthis.entityStorage.addSprint(sprint);\n\n\t\tthis.appendToPlannedContainer(sprint);\n\n\t\tthis.emit('createSprintNode', sprint);\n\t}\n\n\tappendToPlannedContainer(sprint: Sprint)\n\t{\n\t\tconst container = this.getSprintsContainer().querySelector('.tasks-scrum__sprints--planned');\n\n\t\tDom.append(sprint.render(), container);\n\n\t\tDom.removeClass(container, '--empty');\n\n\t\tsprint.onAfterAppend();\n\n\t\tthis.adjustSprintListWidth();\n\n\t\tthis.updatePlannedSprints(\n\t\t\tthis.entityStorage.getPlannedSprints(),\n\t\t\t!Type.isUndefined(this.entityStorage.getActiveSprint())\n\t\t);\n\t}\n\n\tmoveSprintToActiveListNode(sprint: Sprint)\n\t{\n\t\tconst container = this.getSprintsContainer().querySelector('.tasks-scrum__sprints--active');\n\n\t\tDom.append(sprint.getNode(), container);\n\n\t\tDom.removeClass(container, '--empty');\n\t}\n\n\tmoveSprintToCompletedListNode(sprint: Sprint)\n\t{\n\t\tsprint.removeNode();\n\n\t\tthis.entityStorage.removeSprint(sprint.getId());\n\n\t\tif (this.completedSprints.isSprintsUploaded())\n\t\t{\n\t\t\tthis.completedSprints.addSprint(sprint);\n\t\t}\n\n\t\tthis.adjustSprintListWidth();\n\t}\n\n\tappendItemAfterItem(newItemNode: HTMLElement, bindItemNode: HTMLElement)\n\t{\n\t\tif (bindItemNode.nextElementSibling)\n\t\t{\n\t\t\tDom.insertBefore(newItemNode, bindItemNode.nextElementSibling);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.append(newItemNode, bindItemNode.parentElement);\n\t\t}\n\t}\n\n\tonSprintsScroll()\n\t{\n\t\tthis.emit('sprintsScroll');\n\t}\n\n\tadjustSprintListWidth()\n\t{\n\t\tthis.updateSprintContainers();\n\n\t\tconst hasScroll = this.getSprintsContainer().scrollHeight > this.getSprintsContainer().clientHeight;\n\n\t\tif (hasScroll)\n\t\t{\n\t\t\tDom.addClass(this.getSprintsContainer(), '--scrollbar');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.getSprintsContainer(), '--scrollbar');\n\t\t}\n\t}\n\n\tupdateSprintContainers()\n\t{\n\t\tconst activeSprint = this.entityStorage.getActiveSprint();\n\t\tconst activeContainer = this.getSprintsContainer().querySelector('.tasks-scrum__sprints--active');\n\t\tif (activeSprint)\n\t\t{\n\t\t\tDom.removeClass(activeContainer, '--empty');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(activeContainer, '--empty');\n\t\t}\n\n\t\tconst plannedSprints = this.entityStorage.getPlannedSprints();\n\t\tconst plannedContainer = this.getSprintsContainer().querySelector('.tasks-scrum__sprints--planned');\n\t\tif (plannedSprints.size)\n\t\t{\n\t\t\tDom.removeClass(plannedContainer, '--empty');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(plannedContainer, '--empty');\n\t\t}\n\t}\n\n\tupdatePlannedSprints(plannedSprints: Set<Sprint>, existActiveSprint: boolean)\n\t{\n\t\tif (existActiveSprint)\n\t\t{\n\t\t\tplannedSprints.forEach((plannedSprint: Sprint) => {\n\t\t\t\tplannedSprint.disableHeaderButton();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tplannedSprints.forEach((plannedSprint: Sprint) => {\n\t\t\t\tplannedSprint.unDisableHeaderButton();\n\t\t\t});\n\t\t}\n\t}\n\n\tgetScrumContainer(): HTMLElement\n\t{\n\t\treturn this.scrumContainer;\n\t}\n\n\tblockScrumContainerSelect()\n\t{\n\t\tDom.addClass(this.scrumContainer, '--select-none');\n\t}\n\n\tunblockScrumContainerSelect()\n\t{\n\t\tsetTimeout(() => {\n\t\t\tDom.removeClass(this.scrumContainer, '--select-none');\n\t\t}, 500);\n\t}\n\n\tshowEmptySearchStub()\n\t{\n\t\tif (this.entityStorage.existCompletedSprint())\n\t\t{\n\t\t\tthis.completedSprints.showEmptySearchStub();\n\t\t}\n\t}\n\n\thideEmptySearchStub()\n\t{\n\t\tif (this.entityStorage.existCompletedSprint())\n\t\t{\n\t\t\tthis.completedSprints.hideEmptySearchStub();\n\t\t}\n\t}\n\n\tshowFilteredCompletedSprints(completedSprints: Map<Sprint>)\n\t{\n\t\tif (this.entityStorage.existCompletedSprint())\n\t\t{\n\t\t\tthis.completedSprints.showFilteredSprints(completedSprints);\n\t\t}\n\t}\n\n\thideFilteredCompletedSprints()\n\t{\n\t\tif (this.entityStorage.existCompletedSprint())\n\t\t{\n\t\t\tthis.completedSprints.hideFilteredSprints();\n\t\t}\n\t}\n\n\tloadItems(entity: Entity): Promise\n\t{\n\t\tif (!this.loadItemsRepeatCounter.has(entity.getId()))\n\t\t{\n\t\t\tthis.loadItemsRepeatCounter.set(entity.getId(), 0);\n\t\t}\n\n\t\tif (this.loadItemsRepeatCounter.get(entity.getId()) > 1)\n\t\t{\n\t\t\tentity.unbindItemsLoader();\n\n\t\t\treturn;\n\t\t}\n\n\t\tentity.setActiveLoadItems(true);\n\n\t\tif (entity.getNumberItems() >= this.pageSize)\n\t\t{\n\t\t\tentity.getListItems().addScrollbar();\n\t\t}\n\n\t\tconst requestData = {\n\t\t\tentityId: entity.getId(),\n\t\t\tpageNumber: entity.getPageNumberItems() + 1,\n\t\t\tpageSize: this.pageSize\n\t\t};\n\n\t\treturn this.requestSender.getItems(requestData)\n\t\t\t.then((response) => {\n\t\t\t\tconst items = response.data;\n\n\t\t\t\tentity.setActiveLoadItems(false);\n\n\t\t\t\tif (entity.isHideContent())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (Type.isArray(items) && items.length)\n\t\t\t\t{\n\t\t\t\t\tentity.incrementPageNumberItems();\n\n\t\t\t\t\tthis.createItemsInEntity(entity, items);\n\n\t\t\t\t\tif (entity.isGroupMode())\n\t\t\t\t\t{\n\t\t\t\t\t\tentity.activateGroupMode();\n\t\t\t\t\t}\n\n\t\t\t\t\tentity.bindItemsLoader();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tif (entity.getNumberTasks() !== entity.getNumberItems())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.loadItemsRepeatCounter.set(\n\t\t\t\t\t\t\tentity.getId(),\n\t\t\t\t\t\t\tthis.loadItemsRepeatCounter.get(entity.getId()) + 1\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tentity.decrementPageNumberItems();\n\n\t\t\t\t\t\treturn this.loadItems(entity);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tentity.unbindItemsLoader();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tentity.setActiveLoadItems(false);\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tclearLoadItemsRepeatCounter(): void\n\t{\n\t\tthis.loadItemsRepeatCounter.clear();\n\t}\n\n\tloadAllItems(entity: Entity): Promise\n\t{\n\t\tconst requestData = {\n\t\t\tentityId: entity.getId(),\n\t\t\twithoutNav: 'Y'\n\t\t};\n\n\t\treturn this.requestSender.getItems(requestData)\n\t\t\t.then((response) => {\n\t\t\t\tconst items = response.data;\n\n\t\t\t\tif (Type.isArray(items) && items.length)\n\t\t\t\t{\n\t\t\t\t\tthis.createItemsInEntity(entity, items);\n\t\t\t\t}\n\n\t\t\t\tentity.unbindItemsLoader();\n\n\t\t\t\treturn true;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tentity.setActiveLoadItems(false);\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tcreateItemsInEntity(entity: Entity, items: Array)\n\t{\n\t\titems.forEach((itemData: ItemParams) => {\n\t\t\tconst item = Item.buildItem(itemData);\n\t\t\titem.setEntityType(entity.getEntityType());\n\t\t\tif (!this.entityStorage.findItemByItemId(item.getId()))\n\t\t\t{\n\t\t\t\titem.setShortView(entity.getShortView());\n\t\t\t\tentity.appendItemToList(item);\n\t\t\t\tentity.setItem(item);\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateVisibilitySprints(sprint: Sprint): Promise\n\t{\n\t\tconst results = [];\n\n\t\tthis.entityStorage.getSprintsAvailableForFilling(sprint)\n\t\t\t.forEach((anotherSprint: Sprint) => {\n\t\t\t\tif (!anotherSprint.isHideContent() && anotherSprint.isWaitingLoadItems())\n\t\t\t\t{\n\t\t\t\t\tresults.push(anotherSprint.hideContent(anotherSprint.getContentContainer()));\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\tif (sprint.isHideContent())\n\t\t{\n\t\t\tresults.push(sprint.showContent(sprint.getContentContainer()));\n\t\t}\n\n\t\treturn Promise.all(results);\n\t}\n}\n","import {Dom, Event, Loc, Tag, Type} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Entity} from './entity';\nimport {Item} from '../item/item';\n\nimport 'ui.hint';\nimport 'main.polyfill.intersectionobserver';\n\nimport '../css/action-panel.css';\n\ntype Params = {\n\tentity: Entity,\n\titem: Item,\n\tbindElement: HTMLElement,\n\titemList: Object\n}\n\nexport class ActionPanel extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.ActionPanel');\n\n\t\tthis.entity = params.entity;\n\t\tthis.item = params.item;\n\n\t\tthis.bindElement = this.item.getNode();\n\n\t\tthis.itemList = {...{\n\t\t\ttask: {activity: false},\n\t\t\tattachment: {activity: false},\n\t\t\tdod: {activity: false},\n\t\t\tmove: {activity: false},\n\t\t\tsprint: {activity: false},\n\t\t\tbacklog: {activity: false},\n\t\t\ttags: {activity: false},\n\t\t\tepic: {activity: false},\n\t\t\tdecomposition: {activity: false},\n\t\t\tremove: {activity: false},\n\t\t}, ...params.itemList};\n\n\t\tthis.node = null;\n\n\t\tthis.isBlockBlur = false;\n\n\t\tthis.hintManager = null;\n\n\t\tthis.observeBindElement();\n\t}\n\n\tshow()\n\t{\n\t\tthis.node = this.calculatePanelPosition(this.createActionPanel());\n\t\tthis.bindItems();\n\n\t\tthis.hintManager = BX.UI.Hint.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tanimation: null\n\t\t\t}\n\t\t});\n\n\t\tthis.hintManager.init(this.node);\n\n\t\tDom.append(this.node, document.body);\n\t}\n\n\tdestroy()\n\t{\n\t\tDom.remove(this.node);\n\n\t\tthis.node = null;\n\n\t\tif (this.observer)\n\t\t{\n\t\t\tthis.observer.disconnect();\n\t\t}\n\n\t\tthis.hideHint();\n\n\t\tthis.emit('onDestroy');\n\t}\n\n\thideHint()\n\t{\n\t\tif (this.hintManager)\n\t\t{\n\t\t\tthis.hintManager.hide();\n\t\t}\n\t}\n\n\tgetNode(): HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tgetItem(): Item\n\t{\n\t\treturn this.item;\n\t}\n\n\tcreateActionPanel(): HTMLElement\n\t{\n\t\tlet task = '';\n\t\tlet attachment = '';\n\t\tlet dod = '';\n\t\tlet move = '';\n\t\tlet sprint = '';\n\t\tlet backlog = '';\n\t\tlet tags = '';\n\t\tlet epic = '';\n\t\tlet decomposition = '';\n\t\tlet remove = '';\n\n\t\tconst baseBtnClass = 'tasks-scrum__action-panel--btn';\n\t\tconst arrowClass = 'tasks-scrum__action-panel--btn-with-arrow';\n\n\t\tconst selected = Tag.render`\n\t\t\t<div class=\"tasks-scrum__action-panel--selected-btn tasks-scrum__action-panel--btn-selected\">\n\t\t\t\t<span class=\"tasks-scrum__action-panel--text\">\n\t\t\t\t\t${this.getSelectedText(this.entity.getGroupModeItems().size)}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"tasks-scrum__action-panel--icon\"></span>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-scrum__action-panel--separator\"></div>\n\t\t`;\n\n\t\tif (this.itemList.task.activity)\n\t\t{\n\t\t\tconst disableClass = this.itemList.task.disable === true ? '--disabled' : '';\n\n\t\t\ttask = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"${baseBtnClass} tasks-scrum__action-panel--btn-task ${disableClass}\"\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_TASK_HINT')}\" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class=\"tasks-scrum__action-panel--icon\"></span>\n\t\t\t\t\t<span class=\"tasks-scrum__action-panel--text\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_TASK')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__action-panel--separator\"></div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.itemList.attachment.activity)\n\t\t{\n\t\t\tconst disableClass = this.itemList.attachment.disable === true ? '--disabled' : '';\n\n\t\t\tattachment = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"${baseBtnClass} tasks-scrum__action-panel--btn-attachment ${disableClass}\"\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_FILE_HINT')}\" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class=\"tasks-scrum__action-panel--icon\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__action-panel--separator\"></div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.itemList.dod.activity)\n\t\t{\n\t\t\tconst disableClass = this.itemList.dod.disable === true ? '--disabled' : '';\n\n\t\t\tdod = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"${baseBtnClass} tasks-scrum__action-panel--btn-dod ${disableClass}\"\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_DOD_HINT_NEW')}\" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class=\"tasks-scrum__action-panel--text\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_DOD')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__action-panel--separator\"></div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.itemList.move.activity)\n\t\t{\n\t\t\tconst disableClass = this.itemList.move.disable === true ? '--disabled' : '';\n\n\t\t\tmove = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"${baseBtnClass} tasks-scrum__action-panel--btn-move ${arrowClass} ${disableClass}\"\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_MOVE_HINT')}\" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class=\"tasks-scrum__action-panel--text\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_MOVE')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__action-panel--separator\"></div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.itemList.sprint.activity)\n\t\t{\n\t\t\tconst disableClass = this.itemList.sprint.disable === true ? '--disabled' : '';\n\t\t\tconst sprintArrowClass = this.itemList.sprint.multiple === true ? arrowClass : '';\n\n\t\t\tsprint = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"${baseBtnClass} tasks-scrum__action-panel--btn-sprint ${sprintArrowClass} ${disableClass}\"\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_SPRINT_HINT')}\" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class=\"tasks-scrum__action-panel--text\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_SPRINT')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__action-panel--separator\"></div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.itemList.backlog.activity)\n\t\t{\n\t\t\tconst disableClass = this.itemList.backlog.disable === true ? '--disabled' : '';\n\n\t\t\tbacklog = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"${baseBtnClass} tasks-scrum__action-panel--btn-backlog ${disableClass}\"\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_BACKLOG_HINT')}\" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class=\"tasks-scrum__action-panel--text\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_BACKLOG')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__action-panel--separator\"></div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.itemList.tags.activity)\n\t\t{\n\t\t\tconst disableClass = this.itemList.tags.disable === true ? '--disabled' : '';\n\n\t\t\ttags = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"${baseBtnClass} tasks-scrum__action-panel--btn-tags ${arrowClass} ${disableClass}\"\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_TAG_HINT')}\" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class=\"tasks-scrum__action-panel--text\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_TAGS')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__action-panel--separator\"></div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.itemList.epic.activity)\n\t\t{\n\t\t\tconst disableClass = this.itemList.epic.disable === true ? '--disabled' : '';\n\n\t\t\tepic = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"${baseBtnClass} tasks-scrum__action-panel--btn-epics ${arrowClass} ${disableClass}\"\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_EPIC_HINT')}\" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class=\"tasks-scrum__action-panel--text\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_EPIC')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__action-panel--separator\"></div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.itemList.decomposition.activity)\n\t\t{\n\t\t\tconst disableClass = this.itemList.decomposition.disable === true ? '--disabled' : '';\n\t\t\tconst decClass = this.entity.isBacklog()\n\t\t\t\t? 'tasks-scrum__action-panel--btn-decomposition-backlog'\n\t\t\t\t: 'tasks-scrum__action-panel--btn-decomposition-sprint'\n\t\t\t;\n\t\t\tconst hintText = this.entity.isBacklog()\n\t\t\t\t? Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_DEC_BACKLOG_HINT')\n\t\t\t\t: Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_DEC_SPRINT_HINT')\n\t\t\t;\n\n\t\t\tdecomposition = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"${baseBtnClass} ${decClass} ${disableClass}\"\n\t\t\t\t\tdata-hint=\"${hintText}\" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class=\"tasks-scrum__action-panel--icon\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-scrum__action-panel--separator\"></div>\n\t\t\t`;\n\t\t}\n\n\t\tif (this.itemList.remove.activity)\n\t\t{\n\t\t\tconst disableClass = this.itemList.remove.disable === true ? '--disabled' : '';\n\n\t\t\tremove = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"${baseBtnClass} tasks-scrum__action-panel--btn-remove ${disableClass}\"\n\t\t\t\t\tdata-hint=\"${Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_REMOVE_HINT')}\" data-hint-no-icon\n\t\t\t\t>\n\t\t\t\t\t<span class=\"tasks-scrum__action-panel--icon\"></span>\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"tasks-scrum__action-panel--container tasks-scrum__action-panel--scope\" tabindex=\"1\">\n\t\t\t\t<div class=\"tasks-scrum__action-panel\">\n\t\t\t\t\t${selected}\n\t\t\t\t\t${task}\n\t\t\t\t\t${attachment}\n\t\t\t\t\t${dod}\n\t\t\t\t\t${move}\n\t\t\t\t\t${sprint}\n\t\t\t\t\t${backlog}\n\t\t\t\t\t${tags}\n\t\t\t\t\t${epic}\n\t\t\t\t\t${decomposition}\n\t\t\t\t\t${remove}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tbindItems()\n\t{\n\t\tconst selectedBtn = this.node.querySelector('.tasks-scrum__action-panel--btn-selected')\n\t\tEvent.bind(\n\t\t\tselectedBtn.querySelector('.tasks-scrum__action-panel--icon'),\n\t\t\t'click',\n\t\t\t() => this.emit('unSelect')\n\t\t);\n\n\t\tif (this.itemList.task.activity && this.itemList.task.disable !== true)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tthis.node.querySelector('.tasks-scrum__action-panel--btn-task'),\n\t\t\t\t'click',\n\t\t\t\tthis.itemList.task.callback\n\t\t\t);\n\t\t}\n\n\t\tif (this.itemList.attachment.activity && this.itemList.attachment.disable !== true)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tthis.node.querySelector('.tasks-scrum__action-panel--btn-attachment'),\n\t\t\t\t'click',\n\t\t\t\tthis.itemList.attachment.callback\n\t\t\t);\n\t\t}\n\n\t\tif (this.itemList.dod.activity && this.itemList.dod.disable !== true)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tthis.node.querySelector('.tasks-scrum__action-panel--btn-dod'),\n\t\t\t\t'click',\n\t\t\t\tthis.itemList.dod.callback\n\t\t\t);\n\t\t}\n\n\t\tif (this.itemList.move.activity && this.itemList.move.disable !== true)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tthis.node.querySelector('.tasks-scrum__action-panel--btn-move'),\n\t\t\t\t'click',\n\t\t\t\tthis.itemList.move.callback\n\t\t\t);\n\t\t}\n\n\t\tif (this.itemList.sprint.activity && this.itemList.sprint.disable !== true)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tthis.node.querySelector('.tasks-scrum__action-panel--btn-sprint'),\n\t\t\t\t'click',\n\t\t\t\tthis.itemList.sprint.callback\n\t\t\t);\n\t\t}\n\n\t\tif (this.itemList.backlog.activity && this.itemList.backlog.disable !== true)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tthis.node.querySelector('.tasks-scrum__action-panel--btn-backlog'),\n\t\t\t\t'click',\n\t\t\t\tthis.itemList.backlog.callback\n\t\t\t);\n\t\t}\n\n\t\tif (this.itemList.tags.activity && this.itemList.tags.disable !== true)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tthis.node.querySelector('.tasks-scrum__action-panel--btn-tags'),\n\t\t\t\t'click',\n\t\t\t\tthis.itemList.tags.callback\n\t\t\t);\n\t\t}\n\n\t\tif (this.itemList.epic.activity && this.itemList.epic.disable !== true)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tthis.node.querySelector('.tasks-scrum__action-panel--btn-epics'),\n\t\t\t\t'click',\n\t\t\t\tthis.itemList.epic.callback\n\t\t\t);\n\t\t}\n\n\t\tif (this.itemList.decomposition.activity && this.itemList.decomposition.disable !== true)\n\t\t{\n\t\t\tconst decClass = this.entity.isBacklog()\n\t\t\t\t? 'tasks-scrum__action-panel--btn-decomposition-backlog'\n\t\t\t\t: 'tasks-scrum__action-panel--btn-decomposition-sprint'\n\t\t\t;\n\n\t\t\tEvent.bind(\n\t\t\t\tthis.node.querySelector('.' + decClass),\n\t\t\t\t'click',\n\t\t\t\tthis.itemList.decomposition.callback\n\t\t\t);\n\t\t}\n\n\t\tif (this.itemList.remove.activity && this.itemList.remove.disable !== true)\n\t\t{\n\t\t\tEvent.bind(\n\t\t\t\tthis.node.querySelector('.tasks-scrum__action-panel--btn-remove'),\n\t\t\t\t'click',\n\t\t\t\tthis.itemList.remove.callback\n\t\t\t);\n\t\t}\n\t}\n\n\tgetSelectedText(number: number): string\n\t{\n\t\treturn Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_SELECTED') + parseInt(number, 10);\n\t}\n\n\tobserveBindElement()\n\t{\n\t\tif (Type.isUndefined(IntersectionObserver))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.observer = new IntersectionObserver((entries) =>\n\t\t\t{\n\t\t\t\tif (entries[0].isIntersecting === true)\n\t\t\t\t{\n\t\t\t\t\tthis.displayPanel();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.hidePanel();\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tthreshold: [0]\n\t\t\t}\n\t\t);\n\n\t\tthis.observer.observe(this.bindElement);\n\t}\n\n\tdisplayPanel()\n\t{\n\t\tif (!Dom.isShown(this.getNode()))\n\t\t{\n\t\t\tDom.style(this.getNode(), 'display', 'block');\n\t\t}\n\t}\n\n\thidePanel()\n\t{\n\t\tif (Dom.isShown(this.getNode()))\n\t\t{\n\t\t\tDom.style(this.getNode(), 'display', 'none');\n\t\t}\n\t}\n\n\tcalculatePanelPosition(panel: HTMLElement)\n\t{\n\t\tconst position = Dom.getPosition(this.bindElement);\n\n\t\tconst top = `${position.top}px`;\n\t\tlet left = `${position.left}px`;\n\n\t\tconst fakePanel = panel.cloneNode(true);\n\t\tDom.style(fakePanel, 'visibility', 'hidden');\n\t\tDom.style(fakePanel, 'top', `${position.top}px`);\n\t\tDom.style(fakePanel, 'left', `${position.left}px`);\n\n\t\tDom.append(fakePanel, document.body);\n\t\tif (this.isPanelWiderThanViewport(fakePanel))\n\t\t{\n\t\t\tconst fakePanelRect = fakePanel.getBoundingClientRect();\n\t\t\tconst windowWidth = (window.innerWidth || document.documentElement.clientWidth);\n\t\t\tleft = `${fakePanelRect.left - (fakePanelRect.right - windowWidth + 40)}px`;\n\t\t}\n\t\tDom.remove(fakePanel);\n\n\t\tDom.style(panel, 'top', top);\n\t\tDom.style(panel, 'left', left);\n\t\tDom.style(panel, 'zIndex', 1100);\n\n\t\tthis.removeLastSeparator(panel);\n\n\t\treturn panel;\n\t}\n\n\tisPanelWiderThanViewport(element: HTMLElement): boolean\n\t{\n\t\tconst rect = element.getBoundingClientRect();\n\t\tconst windowWidth = (window.innerWidth || document.documentElement.clientWidth);\n\n\t\treturn (rect.right > windowWidth);\n\t}\n\n\tcalculatePanelTopPosition()\n\t{\n\t\tif (!this.getNode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst position = Dom.getPosition(this.bindElement);\n\n\t\tDom.style(this.getNode(), 'top', `${position.top}px`);\n\t}\n\n\tremoveLastSeparator(panel: HTMLElement)\n\t{\n\t\tconst actionPanel =  panel.querySelector('.tasks-scrum__action-panel');\n\t\tif (Dom.hasClass(actionPanel.lastElementChild, 'tasks-scrum__action-panel--separator'))\n\t\t{\n\t\t\tDom.remove(actionPanel.lastElementChild);\n\t\t}\n\t}\n}","import {Dom, Tag, Event} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {Item} from '../item/item';\n\nimport '../css/search.arrows.css';\n\ntype Params = {\n\tcurrentPosition: number,\n\tlist: Set<Item>\n}\n\nexport class SearchArrows extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.SearchArrows');\n\n\t\tthis.list = params.list;\n\n\t\tthis.currentPosition = parseInt(params.currentPosition, 10);\n\n\t\tthis.node = null;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tthis.node = Tag.render`\n\t\t\t<div class=\"tasks-scrum__item--nav-linked tasks-scrum__scope\">\n\t\t\t\t<div class=\"tasks-scrum__item--nav-linked-close\"></div>\n\t\t\t\t<div class=\"tasks-scrum__item--nav-linked-block\">\n\t\t\t\t\t<div class=\"tasks-scrum__item--nav-linked-prev\"></div>\n\t\t\t\t\t<div class=\"tasks-scrum__item--nav-linked-num-container --visible\">\n\t\t\t\t\t<div class=\"tasks-scrum__item--nav-linked-num\">${this.currentPosition}/${this.list.size}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-scrum__item--nav-linked-next\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tconst closeBtn = this.node.querySelector('.tasks-scrum__item--nav-linked-close');\n\t\tconst prevBtn = this.node.querySelector('.tasks-scrum__item--nav-linked-prev');\n\t\tconst nextBtn = this.node.querySelector('.tasks-scrum__item--nav-linked-next');\n\n\t\tEvent.bind(closeBtn, 'click', this.onClose.bind(this));\n\t\tEvent.bind(prevBtn, 'click', this.onPrev.bind(this));\n\t\tEvent.bind(nextBtn, 'click', this.onNext.bind(this));\n\n\t\treturn this.node;\n\t}\n\n\tgetNode(): HTMLElement\n\t{\n\t\treturn this.node;\n\t}\n\n\tupdateCurrentPosition(value: number)\n\t{\n\t\tthis.currentPosition = parseInt(value, 10);\n\n\t\tif (this.node)\n\t\t{\n\t\t\tthis.node.querySelector('.tasks-scrum__item--nav-linked-num')\n\t\t\t\t.textContent = `${this.currentPosition}/${this.list.size}`\n\t\t\t;\n\t\t}\n\t}\n\n\tremove()\n\t{\n\t\tDom.remove(this.node);\n\n\t\tthis.node = null;\n\t}\n\n\tonClose()\n\t{\n\t\tthis.emit('close');\n\t}\n\n\tonPrev()\n\t{\n\t\tthis.emit('prev');\n\t}\n\n\tonNext()\n\t{\n\t\tthis.emit('next');\n\t}\n}\n","import {Dom} from 'main.core';\nimport {EventEmitter} from 'main.core.events';\n\nimport {PlanBuilder} from '../view/plan/plan.builder';\n\nimport {Sprint} from './sprint/sprint';\nimport {EntityStorage} from './entity.storage';\nimport {SearchArrows} from './search.arrows';\n\nimport {Item} from '../item/item';\n\nimport {Scroller} from '../utility/scroller';\n\ntype Params = {\n\tplanBuilder: PlanBuilder,\n\tentityStorage: EntityStorage\n}\n\nexport class SearchItems extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.SearchItems');\n\n\t\tthis.planBuilder = params.planBuilder;\n\t\tthis.entityStorage = params.entityStorage;\n\n\t\tthis.scroller = new Scroller({\n\t\t\tplanBuilder: this.planBuilder,\n\t\t\tentityStorage: this.entityStorage\n\t\t});\n\n\t\tthis.active = false;\n\n\t\tthis.list = new Set();\n\n\t\tthis.currentIndex = 0;\n\n\t\tthis.arrows = null;\n\t}\n\n\tstart(startItem: Item, linkedItemIds: Array<number>)\n\t{\n\t\tthis.active = true;\n\n\t\tthis.setList(linkedItemIds);\n\n\t\tthis.fadeOutAll();\n\n\t\tif (!this.isBacklogItem(startItem))\n\t\t{\n\t\t\tthis.scroller.scrollToItem(this.getCurrent());\n\t\t}\n\n\t\tif (!startItem.isDisabled())\n\t\t{\n\t\t\tthis.updateCurrentIndexByItem(startItem);\n\n\t\t\tthis.activateCurrent(startItem);\n\t\t}\n\n\t\tthis.list.forEach((item: Item) => {\n\t\t\titem.activateLinkedMode();\n\t\t});\n\n\t\tthis.showArrows();\n\t}\n\n\tstop()\n\t{\n\t\tthis.active = false;\n\n\t\tthis.currentIndex = 0;\n\n\t\tthis.fadeInAll();\n\n\t\tthis.cleanList();\n\t\tthis.removeArrows();\n\t}\n\n\tsetList(linkedItemIds: Array<number>)\n\t{\n\t\tthis.list = new Set();\n\n\t\tconst items = this.entityStorage.getAllItems();\n\n\t\tlinkedItemIds.forEach((itemId: number) => {\n\t\t\tif (items.has(itemId))\n\t\t\t{\n\t\t\t\tthis.list.add(items.get(itemId));\n\t\t\t}\n\t\t});\n\t}\n\n\tisActive(): boolean\n\t{\n\t\treturn this.active;\n\t}\n\n\tisBacklogItem(item: Item): boolean\n\t{\n\t\treturn this.entityStorage.getBacklog().hasItem(item);\n\t}\n\n\tgetCurrent(): Item\n\t{\n\t\treturn [...this.list.values()][this.currentIndex];\n\t}\n\n\tupdateCurrentIndexByItem(inputItem: Item)\n\t{\n\t\tthis.deactivateCurrent(this.getCurrent());\n\n\t\t[...this.list.values()].forEach((item: Item, index: number) => {\n\t\t\tif (inputItem.getId() === item.getId())\n\t\t\t{\n\t\t\t\tthis.currentIndex = index;\n\t\t\t}\n\t\t});\n\n\t\tthis.updateArrows();\n\t}\n\n\tmoveToPrev()\n\t{\n\t\tthis.deactivateCurrent(this.getCurrent());\n\n\t\tthis.currentIndex--;\n\n\t\tif (this.currentIndex < 0)\n\t\t{\n\t\t\tthis.currentIndex = (this.list.size - 1);\n\t\t}\n\n\t\tthis.updateArrows();\n\n\t\tconst currentItem = this.getCurrent();\n\n\t\tthis.scroller.scrollToItem(currentItem);\n\n\t\tthis.activateCurrent(currentItem);\n\t}\n\n\tmoveToNext()\n\t{\n\t\tthis.deactivateCurrent(this.getCurrent());\n\n\t\tthis.currentIndex++;\n\n\t\tif (this.currentIndex === this.list.size)\n\t\t{\n\t\t\tthis.currentIndex = 0;\n\t\t}\n\n\t\tthis.updateArrows();\n\n\t\tconst currentItem = this.getCurrent();\n\n\t\tthis.scroller.scrollToItem(currentItem);\n\n\t\tthis.activateCurrent(currentItem);\n\t}\n\n\tactivateCurrent(item: Item)\n\t{\n\t\titem.activateCurrentLinkedMode(item);\n\t}\n\n\tdeactivateCurrent()\n\t{\n\t\tthis.list.forEach((item: Item) => {\n\t\t\titem.deactivateCurrentLinkedMode();\n\t\t});\n\t}\n\n\tfadeOutAll()\n\t{\n\t\tthis.entityStorage.getBacklog().fadeOut();\n\n\t\tconst activeSprint = this.entityStorage.getActiveSprint();\n\t\tif (activeSprint)\n\t\t{\n\t\t\tactiveSprint.fadeOut();\n\n\t\t\tif (activeSprint.isHideContent())\n\t\t\t{\n\t\t\t\tactiveSprint.toggleVisibilityContent(activeSprint.getContentContainer());\n\t\t\t}\n\t\t}\n\n\t\tthis.entityStorage.getPlannedSprints()\n\t\t\t.forEach((sprint: Sprint) => {\n\t\t\t\tsprint.fadeOut();\n\t\t\t\tif (sprint.isHideContent())\n\t\t\t\t{\n\t\t\t\t\tsprint.toggleVisibilityContent(sprint.getContentContainer());\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\tfadeInAll()\n\t{\n\t\tthis.entityStorage.getBacklog().fadeIn();\n\n\t\tconst activeSprint = this.entityStorage.getActiveSprint();\n\t\tif (activeSprint)\n\t\t{\n\t\t\tactiveSprint.fadeIn();\n\t\t}\n\n\t\tthis.entityStorage.getPlannedSprints()\n\t\t\t.forEach((sprint: Sprint) => {\n\t\t\t\tsprint.fadeIn();\n\t\t\t})\n\t\t;\n\t}\n\n\tdeactivateGroupMode()\n\t{\n\t\tthis.entityStorage.getBacklog().deactivateGroupMode();\n\n\t\tconst activeSprint = this.entityStorage.getActiveSprint();\n\t\tif (activeSprint)\n\t\t{\n\t\t\tactiveSprint.deactivateGroupMode();\n\t\t}\n\n\t\tthis.entityStorage.getPlannedSprints()\n\t\t\t.forEach((sprint: Sprint) => {\n\t\t\t\tsprint.deactivateGroupMode();\n\t\t\t})\n\t\t;\n\t}\n\n\tshowArrows()\n\t{\n\t\tthis.arrows = new SearchArrows({\n\t\t\tcurrentPosition: this.currentIndex + 1,\n\t\t\tlist: this.list\n\t\t});\n\n\t\tthis.arrows.subscribe('close', this.stop.bind(this));\n\t\tthis.arrows.subscribe('prev', this.moveToPrev.bind(this));\n\t\tthis.arrows.subscribe('next', this.moveToNext.bind(this));\n\n\t\tDom.append(this.arrows.render(), document.body);\n\n\t\tthis.adjustArrowsPosition();\n\t}\n\n\tupdateArrows()\n\t{\n\t\tif (this.arrows)\n\t\t{\n\t\t\tthis.arrows.updateCurrentPosition(this.currentIndex + 1);\n\t\t}\n\t}\n\n\tadjustArrowsPosition()\n\t{\n\t\tconst arrowsRect = Dom.getPosition(this.arrows.getNode());\n\t\tconst backlogRect = Dom.getPosition(this.entityStorage.getBacklog().getNode());\n\n\t\tthis.arrows.getNode().style.top = `${(backlogRect.height / 2) + (backlogRect.top - arrowsRect.height)}px`;\n\t\tthis.arrows.getNode().style.left = `${backlogRect.left - ((arrowsRect.width / 2) + 16)}px`;\n\t}\n\n\tcleanList()\n\t{\n\t\tthis.list.forEach((item: Item) => item.deactivateLinkedMode());\n\n\t\tthis.list = new Set();\n\t}\n\n\tremoveArrows()\n\t{\n\t\tthis.arrows.remove();\n\t}\n\n\tisClickInside(node: HTMLElement): boolean\n\t{\n\t\tlet isClickInside = false;\n\n\t\tconst backlog = this.entityStorage.getBacklog();\n\n\t\tif (backlog.getNode().contains(node))\n\t\t{\n\t\t\tisClickInside = true;\n\t\t}\n\n\t\tconst activeSprint = this.entityStorage.getActiveSprint();\n\t\tif (activeSprint && activeSprint.getNode().contains(node))\n\t\t{\n\t\t\tisClickInside = true;\n\t\t}\n\n\t\tif (this.arrows && this.arrows.getNode().contains(node))\n\t\t{\n\t\t\tisClickInside = true;\n\t\t}\n\n\t\tthis.entityStorage.getPlannedSprints()\n\t\t\t.forEach((sprint: Sprint) => {\n\t\t\t\tif (sprint.getNode().contains(node))\n\t\t\t\t{\n\t\t\t\t\tisClickInside = true;\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\treturn isClickInside;\n\t}\n}","import {BaseEvent} from 'main.core.events';\n\nimport {PlanBuilder} from '../../view/plan/plan.builder';\n\nimport {EntityStorage} from '../entity.storage';\nimport {Sprint} from './sprint';\n\nimport {RequestSender} from '../../utility/request.sender';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tplanBuilder: PlanBuilder,\n\tentityStorage: EntityStorage\n}\n\nexport class SprintMover\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.planBuilder = params.planBuilder;\n\t\tthis.entityStorage = params.entityStorage;\n\n\t\tthis.bindHandlers();\n\t}\n\n\tbindHandlers()\n\t{\n\t\tthis.planBuilder.subscribe('setDraggable', this.onSetDraggable.bind(this));\n\n\t\t//this.planBuilder.subscribe('sprintMove', this.onSprintMove.bind(this))\n\t}\n\n\tonSetDraggable(baseEvent: BaseEvent)\n\t{\n\t\t// this.draggableSprints = new Draggable({\n\t\t// \tcontainer: this.sprintsNode.querySelector('.tasks-scrum__sprints--planned'),\n\t\t// \tdraggable: '.tasks-scrum-sprint',\n\t\t// \tdragElement: '.tasks-scrum-sprint-dragndrop',\n\t\t// \ttype: Draggable.DROP_PREVIEW,\n\t\t// });\n\t\t// this.draggableSprints.subscribe('end', (baseEvent) => {\n\t\t// \tconst dragEndEvent = baseEvent.getData();\n\t\t// \tthis.emit('sprintMove', dragEndEvent);\n\t\t// });\n\t}\n\n\tonSprintMove(baseEvent: BaseEvent)\n\t{\n\t\tconst dragEndEvent = baseEvent.getData();\n\t\tif (!dragEndEvent.endContainer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.requestSender.updateSprintSort({\n\t\t\tsortInfo: this.calculateSprintSort()\n\t\t}).catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tcalculateSprintSort(increment = 0)\n\t{\n\t\tconst listSortInfo = {};\n\n\t\tconst sprints = this.entityStorage.getPlannedSprints();\n\n\t\tlet sort = 1 + increment;\n\t\tsprints.forEach((sprint: Sprint) => {\n\t\t\tsprint.setSort(sort);\n\t\t\tlistSortInfo[sprint.getId()] = {\n\t\t\t\tsort: sort\n\t\t\t};\n\t\t\tsort++;\n\t\t});\n\n\t\treturn listSortInfo;\n\t}\n}","import { BaseEvent, EventEmitter } from 'main.core.events';\nimport { SidePanel } from '../../service/side.panel';\nimport { ViewInfo, Views } from '../../view/view';\nimport { Sprint } from './sprint';\n\ntype Params = {\n\tgroupId: number,\n\tsidePanel: SidePanel,\n\tviews: Views,\n\tpathToBurnDown: string\n};\n\nexport class SprintSidePanel extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.SprintSidePanel');\n\n\t\tthis.sidePanel = params.sidePanel;\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\t\tthis.views = params.views;\n\t\tthis.pathToBurnDown = params.pathToBurnDown ?? '';\n\t}\n\n\tshowStartForm(sprint: Sprint)\n\t{\n\t\tthis.sidePanel.showByExtension(\n\t\t\t'Sprint-Start-Form',\n\t\t\t{\n\t\t\t\tgroupId: this.groupId,\n\t\t\t\tsprintId: sprint.getId()\n\t\t\t}\n\t\t)\n\t\t\t.then((extension) => {\n\t\t\t\tif (extension)\n\t\t\t\t{\n\t\t\t\t\textension.subscribe('afterStart', (baseEvent: BaseEvent) => {\n\t\t\t\t\t\tlocation.href = this.views.find((view: ViewInfo) => view.id === 'activeSprint')?.url;\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\tshowCompletionForm()\n\t{\n\t\tthis.sidePanel.showByExtension(\n\t\t\t'Sprint-Completion-Form',\n\t\t\t{ groupId: this.groupId }\n\t\t)\n\t\t\t.then((extension) => {\n\t\t\t\tif (extension)\n\t\t\t\t{\n\t\t\t\t\textension.subscribe('afterComplete', (baseEvent: BaseEvent) => {\n\t\t\t\t\t\tlocation.href = this.views.find((view: ViewInfo) => view.id === 'plan')?.url;\n\t\t\t\t\t});\n\t\t\t\t\textension.subscribe('taskClick', (baseEvent: BaseEvent) => {\n\t\t\t\t\t\tthis.emit('showTask', baseEvent.getData());\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\tshowBurnDownChart(sprint: Sprint)\n\t{\n\t\tif (this.pathToBurnDown)\n\t\t{\n\t\t\tthis.sidePanel.openSidePanel(this.pathToBurnDown.replace('#sprint_id#', sprint.getId()));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new Error('Could not find a page to display the chart.');\n\t\t}\n\t}\n}\n","import {EntityStorage} from '../entity/entity.storage';\n\nimport {Backlog} from '../entity/backlog/backlog';\nimport {Sprint} from '../entity/sprint/sprint';\n\nimport {RequestSender} from '../utility/request.sender';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tentityStorage: EntityStorage\n}\n\nexport class EntityCounters\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.entityStorage = params.entityStorage;\n\t}\n\n\tupdateCounters(entities: Map<number, Backlog | Sprint>)\n\t{\n\t\tconst requestData = {\n\t\t\tentityIds: [...entities.keys()]\n\t\t};\n\n\t\tthis.requestSender.getEntityCounters(requestData)\n\t\t\t.then((response) => {\n\t\t\t\tObject.keys(response.data).forEach((entityId: number) => {\n\t\t\t\t\tentityId = parseInt(entityId, 10);\n\t\t\t\t\tconst entity = entities.get(entityId);\n\t\t\t\t\tconst counters = response.data[entityId];\n\t\t\t\t\tentity.setStoryPoints(counters.storyPoints);\n\t\t\t\t\tentity.setNumberTasks(counters.numberTasks);\n\t\t\t\t\tif (entity.isActive())\n\t\t\t\t\t{\n\t\t\t\t\t\tentity.setCompletedStoryPoints(counters.completedStoryPoints);\n\t\t\t\t\t\tentity.setUncompletedStoryPoints(counters.uncompletedStoryPoints);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n}","import {Loc, Type, Text, Dom} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\nimport {Menu} from 'main.popup';\nimport {MessageBox} from 'ui.dialogs.messagebox';\nimport {Draggable} from 'ui.draganddrop.draggable';\n\nimport {PlanBuilder} from '../view/plan/plan.builder';\n\nimport {EntityStorage} from '../entity/entity.storage';\nimport {Entity} from '../entity/entity';\nimport {Sprint} from '../entity/sprint/sprint';\n\nimport {Item} from './item';\n\nimport {EntityCounters} from '../counters/entity.counters';\n\nimport {RequestSender} from '../utility/request.sender';\nimport {Scroller} from \"../utility/scroller\";\n\nexport type ItemsSortInfo = {\n\t[id: number]: {\n\t\tsort: number,\n\t\tentityId?: number,\n\t\ttmpId?: string,\n\t\tupdatedItemId?: number\n\t}\n}\n\ntype Params = {\n\trequestSender: RequestSender,\n\tplanBuilder: PlanBuilder,\n\tentityStorage: EntityStorage,\n\tentityCounters: EntityCounters\n}\n\nexport class ItemMover extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.ItemMover');\n\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.planBuilder = params.planBuilder;\n\t\tthis.entityStorage = params.entityStorage;\n\t\tthis.entityCounters = params.entityCounters;\n\n\t\tthis.scroller = new Scroller({\n\t\t\tplanBuilder: this.planBuilder,\n\t\t\tentityStorage: this.entityStorage\n\t\t});\n\n\t\tthis.dragItems = new Set();\n\n\t\tthis.lastOutContainer = null;\n\n\t\tthis.bindHandlers();\n\t}\n\n\tbindHandlers()\n\t{\n\t\tthis.planBuilder.subscribe('setDraggable', this.onSetDraggable.bind(this));\n\t\tthis.planBuilder.subscribe('createSprintNode', (baseEvent: BaseEvent) => {\n\t\t\tconst sprint = baseEvent.getData();\n\t\t\tthis.draggableItems.addContainer(sprint.getListItemsNode());\n\t\t\tthis.draggableItems.addDropzone(sprint.getDropzone());\n\t\t});\n\t}\n\n\tonSetDraggable(baseEvent: BaseEvent)\n\t{\n\t\tconst backlog = this.entityStorage.getBacklog();\n\n\t\tconst containers = [\n\t\t\tbacklog.getListItemsNode()\n\t\t];\n\t\tconst dropZones = [\n\t\t\tbacklog.getDropzone(),\n\t\t\tthis.planBuilder.getSprintDropzone()\n\t\t];\n\n\t\tthis.entityStorage.getSprints().forEach((sprint) => {\n\t\t\tif (!sprint.isDisabled())\n\t\t\t{\n\t\t\t\tcontainers.push(sprint.getListItemsNode());\n\n\t\t\t\tif (sprint.getDropzone())\n\t\t\t\t{\n\t\t\t\t\tdropZones.push(sprint.getDropzone());\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.draggableItems = new Draggable({\n\t\t\tcontainer: containers,\n\t\t\tdropzone: dropZones,\n\t\t\tdraggable: '.tasks-scrum__item--drag',\n\t\t\tdragElement: '.tasks-scrum__item',\n\t\t\ttype: Draggable.CLONE,\n\t\t\tdelay: 200\n\t\t});\n\n\t\tthis.draggableItems.subscribe('beforeStart', this.onBeforeDragStart.bind(this));\n\t\tthis.draggableItems.subscribe('start', this.onDragStart.bind(this));\n\t\tthis.draggableItems.subscribe('end', this.onDragEnd.bind(this));\n\n\t\tthis.draggableItems.subscribe('drop', this.onDropEnd.bind(this));\n\t\tthis.draggableItems.subscribe('dropzone:enter', this.onDropZoneEnter.bind(this));\n\t\tthis.draggableItems.subscribe('dropzone:out', this.onDropZoneOut.bind(this));\n\t}\n\n\tonBeforeDragStart(baseEvent: BaseEvent)\n\t{\n\t\tconst dragBeforeStartEvent = baseEvent.getData();\n\n\t\tif (!dragBeforeStartEvent.source)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst itemId = parseInt(dragBeforeStartEvent.source.dataset.id, 10);\n\n\t\tconst item = this.entityStorage.findItemByItemId(itemId);\n\n\t\tif (!item || item.isSubTask() || item.isDisabled())\n\t\t{\n\t\t\tbaseEvent.preventDefault();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (item.isShownSubTasks())\n\t\t\t{\n\t\t\t\titem.hideSubTasks();\n\t\t\t}\n\n\t\t\tconst sourceContainer = dragBeforeStartEvent.sourceContainer;\n\t\t\tif (Type.isUndefined(sourceContainer))\n\t\t\t{\n\t\t\t\tbaseEvent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst sourceEntityId = parseInt(sourceContainer.dataset.entityId, 10);\n\t\t\tconst sourceEntity = this.entityStorage.findEntityByEntityId(sourceEntityId);\n\t\t\tif (!sourceEntity)\n\t\t\t{\n\t\t\t\tbaseEvent.preventDefault();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dragItems.clear();\n\n\t\t\tsourceEntity.getGroupModeItems()\n\t\t\t\t.forEach((selectedItem: Item) => {\n\t\t\t\t\tif (selectedItem.getId() !== item.getId())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dragItems.add(selectedItem);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\n\t\t\tconst isMultipleDrag = (this.dragItems.size > 0);\n\t\t\tif (isMultipleDrag)\n\t\t\t{\n\t\t\t\tthis.addMultipleMode(item, this.dragItems);\n\t\t\t}\n\n\t\t\tthis.entityStorage.getAllEntities()\n\t\t\t\t.forEach((entity: Entity) => {\n\t\t\t\t\tentity.deactivateGroupMode();\n\t\t\t\t\tentity.getItems()\n\t\t\t\t\t\t.forEach((entityItem: Item) => {\n\t\t\t\t\t\t\tif (entityItem.isShownSubTasks())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tentityItem.hideSubTasks();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t})\n\t\t\t;\n\n\t\t\tthis.emit('dragStart');\n\t\t}\n\t}\n\n\tonDragStart(baseEvent: BaseEvent)\n\t{\n\t\tthis.planBuilder.blockScrumContainerSelect();\n\n\t\tconst dragStartEvent = baseEvent.getData();\n\n\t\tconst sourceContainer = dragStartEvent.sourceContainer;\n\t\tconst sourceEntityId = parseInt(sourceContainer.dataset.entityId, 10);\n\n\t\tconst sourceEntity = this.entityStorage.findEntityByEntityId(sourceEntityId);\n\n\t\tthis.entityStorage\n\t\t\t.getAllEntities()\n\t\t\t.forEach((entity: Entity) => {\n\t\t\t\tif (!entity.isCompleted() && sourceEntity.getId() !== entity.getId())\n\t\t\t\t{\n\t\t\t\t\tif (entity.isEmpty())\n\t\t\t\t\t{\n\t\t\t\t\t\tentity.showDropzone();\n\t\t\t\t\t\tentity.hideEmptySearchStub();\n\t\t\t\t\t\tentity.hideBlank();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\tonDragEnd(baseEvent: BaseEvent)\n\t{\n\t\tconst dragEndEvent = baseEvent.getData();\n\n\t\tconst itemNode = dragEndEvent.source;\n\t\tconst itemId = parseInt(itemNode.dataset.id, 10);\n\n\t\tconst item = this.entityStorage.findItemByItemId(itemId);\n\n\t\tif (!item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isMultipleDrag = (this.dragItems.size > 0);\n\t\tif (isMultipleDrag)\n\t\t{\n\t\t\tthis.removeMultipleMode(item, this.dragItems);\n\t\t}\n\n\t\tthis.planBuilder.unblockScrumContainerSelect();\n\n\t\tconst sourceContainer = dragEndEvent.sourceContainer;\n\t\tlet endContainer = dragEndEvent.endContainer;\n\t\tif (!endContainer)\n\t\t{\n\t\t\tif (this.isDropToZone)\n\t\t\t{\n\t\t\t\tthis.isDropToZone = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tendContainer = this.lastOutContainer;\n\t\t\t}\n\t\t}\n\n\t\tthis.lastOutContainer = null;\n\n\t\tif (!endContainer)\n\t\t{\n\t\t\tbaseEvent.preventDefault();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst sourceEntityId = parseInt(sourceContainer.dataset.entityId, 10);\n\t\tconst endEntityId = parseInt(endContainer.dataset.entityId, 10);\n\n\t\tconst sourceEntity = this.entityStorage.findEntityByEntityId(sourceEntityId);\n\t\tconst endEntity = this.entityStorage.findEntityByEntityId(endEntityId);\n\n\t\tif (sourceEntity && endEntity)\n\t\t{\n\t\t\tthis.onItemMove(item, sourceEntity, endEntity)\n\t\t\t\t.then(() => {\n\t\t\t\t\tconst isMultipleDrag = (this.dragItems.size > 0);\n\t\t\t\t\tif (isMultipleDrag)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dragGroupItems(item, this.dragItems, sourceEntity, endEntity);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\n\t\t\tsourceEntity.adjustListItemsWidth();\n\t\t\tendEntity.adjustListItemsWidth();\n\t\t}\n\n\t\tif (sourceEntity)\n\t\t{\n\t\t\tthis.entityStorage\n\t\t\t\t.getAllEntities()\n\t\t\t\t.forEach((entity: Entity) => {\n\t\t\t\t\tif (!entity.isCompleted() && sourceEntity.getId() !== entity.getId())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (entity.isEmpty())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (entity.getNumberTasks() > 0 && entity.isExactSearchApplied())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tentity.showEmptySearchStub();\n\t\t\t\t\t\t\t\tentity.hideDropzone();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tentity.showDropzone();\n\t\t\t\t\t\t\t\tentity.hideEmptySearchStub();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\tthis.planBuilder.adjustSprintListWidth();\n\t}\n\n\tonDropEnd(baseEvent: BaseEvent)\n\t{\n\t\tconst dragDropEvent = baseEvent.getData();\n\n\t\tconst dropzone = dragDropEvent.dropzone;\n\n\t\tconst sourceContainer = dragDropEvent.sourceContainer;\n\n\t\tconst sourceEntityId = parseInt(sourceContainer.dataset.entityId, 10);\n\t\tconst endEntityId = parseInt(dropzone.dataset.entityId, 10);\n\n\t\tconst sourceEntity = this.entityStorage.findEntityByEntityId(sourceEntityId);\n\t\tconst endEntity = this.entityStorage.findEntityByEntityId(endEntityId);\n\n\t\tconst itemNode = dragDropEvent.source;\n\t\tconst itemId = parseInt(itemNode.dataset.id, 10);\n\n\t\tconst item = this.entityStorage.findItemByItemId(itemId);\n\n\t\tif (this.planBuilder.isSprintDropzone(dropzone))\n\t\t{\n\t\t\tthis.planBuilder.createSprint()\n\t\t\t\t.then((sprint: Sprint) => {\n\t\t\t\t\tthis.addSprintContainers(sprint);\n\t\t\t\t\tthis.moveTo(sourceEntity, sprint, item);\n\t\t\t\t\tconst isMultipleDrag = (this.dragItems.size > 0);\n\t\t\t\t\tif (isMultipleDrag)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dragGroupItems(item, this.dragItems, sourceEntity, sprint);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (sourceEntity && endEntity)\n\t\t\t{\n\t\t\t\tconst itemNode = dragDropEvent.source;\n\t\t\t\tconst itemId = parseInt(itemNode.dataset.id, 10);\n\n\t\t\t\tconst item = this.entityStorage.findItemByItemId(itemId);\n\t\t\t\tif (item)\n\t\t\t\t{\n\t\t\t\t\tthis.onItemMove(item, sourceEntity, endEntity, true)\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tconst isMultipleDrag = (this.dragItems.size > 0);\n\t\t\t\t\t\t\tif (isMultipleDrag)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.dragGroupItems(item, this.dragItems, sourceEntity, endEntity);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tsourceEntity.adjustListItemsWidth();\n\t\t\t\t\t\t\tendEntity.adjustListItemsWidth();\n\n\t\t\t\t\t\t\tthis.planBuilder.adjustSprintListWidth();\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.entityStorage\n\t\t\t.getAllEntities()\n\t\t\t.forEach((entity: Entity) => {\n\t\t\t\tif (!entity.isCompleted() && sourceEntity.getId() !== entity.getId())\n\t\t\t\t{\n\t\t\t\t\tif (entity.isEmpty())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (entity.getNumberTasks() > 0 && entity.isExactSearchApplied())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tentity.showEmptySearchStub();\n\t\t\t\t\t\t\tentity.hideDropzone();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tentity.showDropzone();\n\t\t\t\t\t\t\tentity.hideEmptySearchStub();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\tonDropZoneEnter()\n\t{\n\t\tthis.isDropToZone = true;\n\t}\n\n\tonDropZoneOut()\n\t{\n\t\tthis.isDropToZone = false;\n\t}\n\n\tonItemMove(item: Item, sourceEntity: Entity, endEntity: Entity, insertDom: false): Promise\n\t{\n\t\tif (sourceEntity.getId() === endEntity.getId())\n\t\t{\n\t\t\treturn this.moveInCurrentContainer(new Set([item.getId()]), sourceEntity);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst message = Loc.getMessage('TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE');\n\n\t\t\treturn this.onMoveConfirm(sourceEntity, message)\n\t\t\t\t.then(() => {\n\t\t\t\t\tif (insertDom)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.insertBefore(item.getNode(), endEntity.getLoaderNode());\n\t\t\t\t\t}\n\t\t\t\t\tthis.moveItemFromEntityToEntity(item, sourceEntity, endEntity);\n\t\t\t\t\tthis.moveInAnotherContainer(new Set([item.getId()]), sourceEntity, endEntity);\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tDom.insertBefore(\n\t\t\t\t\t\titem.getNode(),\n\t\t\t\t\t\tsourceEntity.getListItemsNode().children[item.getSort() - 1]\n\t\t\t\t\t);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t}\n\n\tonMoveItemUpdate(entityFrom: Entity, entityTo: Entity, item: Item)\n\t{\n\t\tthis.requestSender.updateItemSort({\n\t\t\tentityId: entityTo.getId(),\n\t\t\titemIds: [item.getId()],\n\t\t\tsortInfo: {\n\t\t\t\t...this.calculateSort(entityTo.getListItemsNode(), new Set([item.getId()]), true),\n\t\t\t\t...this.calculateSort(entityFrom.getListItemsNode(), new Set(), true)\n\t\t\t}\n\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.updateEntityCounters(entityFrom, entityTo);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tonMoveConfirm(entity: Entity, message: string): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (entity.isActive())\n\t\t\t{\n\t\t\t\tMessageBox.confirm(\n\t\t\t\t\tmessage,\n\t\t\t\t\t(messageBox) => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t},\n\t\t\t\t\tLoc.getMessage('TASKS_SCRUM_BUTTON_TEXT_MOVE'),\n\t\t\t\t\t(messageBox) => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\treject();\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\tdragGroupItems(dragItem: Item, dragItems: Set<Item>, entityFrom: Entity, entityTo: Entity)\n\t{\n\t\tconst isMoveInCurrentContainer = (entityFrom.getId() === entityTo.getId());\n\n\t\tconst sortedDragItems = [...dragItems.values()]\n\t\t\t.sort((first: Item, second: Item) => {\n\t\t\t\tif (first.getSort() < second.getSort()) return 1;\n\t\t\t\tif (first.getSort() > second.getSort()) return -1;\n\t\t\t})\n\t\t;\n\n\t\tconst dragItemIds = new Set();\n\t\tsortedDragItems\n\t\t\t.forEach((groupedItem: Item) => {\n\t\t\t\tdragItemIds.add(groupedItem.getId());\n\t\t\t\tentityTo.appendNodeAfterItem(groupedItem.getNode(), dragItem.getNode());\n\t\t\t\tif (!isMoveInCurrentContainer)\n\t\t\t\t{\n\t\t\t\t\tthis.moveItemFromEntityToEntity(groupedItem, entityFrom, entityTo);\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\tif (isMoveInCurrentContainer)\n\t\t{\n\t\t\tthis.moveInCurrentContainer(dragItemIds, entityFrom);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.moveInAnotherContainer(dragItemIds, entityFrom, entityTo);\n\t\t}\n\t}\n\n\taddMultipleMode(item: Item, dragItems: Set<Item>)\n\t{\n\n\t\tDom.addClass(item.getNode(), (dragItems.size > 1 ? '--multiple-drag-many' : '--multiple-drag'));\n\n\t\tdragItems\n\t\t\t.forEach((dragItem: Item) => {\n\t\t\t\tDom.addClass(dragItem.getNode(), '--multiple-drag-shadow');\n\t\t\t})\n\t\t;\n\t}\n\n\tremoveMultipleMode(item: Item, dragItems: Set<Item>)\n\t{\n\n\t\tDom.removeClass(item.getNode(), '--multiple-drag');\n\t\tDom.removeClass(item.getNode(), '--multiple-drag-many');\n\n\t\tdragItems\n\t\t\t.forEach((dragItem: Item) => {\n\t\t\t\tDom.removeClass(dragItem.getNode(), '--multiple-drag-shadow');\n\t\t\t})\n\t\t;\n\t}\n\n\taddSprintContainers(sprint: Sprint)\n\t{\n\t\tif (!sprint.isDisabled())\n\t\t{\n\t\t\tthis.draggableItems.addContainer(sprint.getListItemsNode());\n\t\t\tthis.draggableItems.addDropzone(sprint.getDropzone());\n\t\t}\n\t}\n\n\tmoveItem(item: Item, button)\n\t{\n\t\tconst entity = this.entityStorage.findEntityByItemId(item.getId());\n\n\t\tconst listToMove = [];\n\n\t\tif (!entity.isFirstItem(item))\n\t\t{\n\t\t\tlistToMove.push({\n\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_MOVE_UP'),\n\t\t\t\tonclick: (event, menuItem) => {\n\t\t\t\t\tconst groupModeItems = entity.getGroupModeItems();\n\n\t\t\t\t\tconst sortedItems = [...groupModeItems.values()].sort((first: Item, second: Item) => {\n\t\t\t\t\t\tif (first.getSort() < second.getSort()) return 1;\n\t\t\t\t\t\tif (first.getSort() > second.getSort()) return -1;\n\t\t\t\t\t});\n\t\t\t\t\tconst sortedItemsIds = new Set();\n\n\t\t\t\t\tsortedItems.forEach((groupModeItem: Item) => {\n\t\t\t\t\t\tsortedItemsIds.add(groupModeItem.getId());\n\t\t\t\t\t\tif (groupModeItem.isParentTask() && groupModeItem.isShownSubTasks())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tgroupModeItem.hideSubTasks();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.moveItemToUp(groupModeItem, entity.getListItemsNode(), false);\n\t\t\t\t\t\tgroupModeItem.activateBlinking();\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.scroller.scrollToItem(sortedItems.values().next().value);\n\n\t\t\t\t\tthis.requestSender.updateItemSort({\n\t\t\t\t\t\tsortInfo: this.calculateSort(entity.getListItemsNode(), sortedItemsIds)\n\t\t\t\t\t}).catch((response) => {\n\t\t\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t\t\t});\n\n\t\t\t\t\tentity.deactivateGroupMode();\n\n\t\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tif (!entity.isLastItem(item))\n\t\t{\n\t\t\tlistToMove.push({\n\t\t\t\ttext: Loc.getMessage('TASKS_SCRUM_ITEM_ACTIONS_MOVE_DOWN'),\n\t\t\t\tonclick: (event, menuItem) => {\n\t\t\t\t\tconst groupModeItems = entity.getGroupModeItems();\n\n\t\t\t\t\tconst sortedItems = [...groupModeItems.values()].sort((first: Item, second: Item) => {\n\t\t\t\t\t\tif (first.getSort() > second.getSort()) return 1;\n\t\t\t\t\t\tif (first.getSort() < second.getSort()) return -1;\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.fadeOutEntity(entity);\n\n\t\t\t\t\tmenuItem.getMenuWindow().close();\n\n\t\t\t\t\tthis.loadEntityList(entity, !entity.isWaitingLoadItems())\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tthis.fadeInEntity(entity);\n\n\t\t\t\t\t\t\tconst sortedItemsIds = new Set();\n\t\t\t\t\t\t\tsortedItems.forEach((groupModeItem: Item) => {\n\t\t\t\t\t\t\t\tsortedItemsIds.add(groupModeItem.getId());\n\t\t\t\t\t\t\t\tif (groupModeItem.isParentTask() && groupModeItem.isShownSubTasks())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tgroupModeItem.hideSubTasks();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tthis.moveItemToDown(groupModeItem, entity.getListItemsNode(), false);\n\t\t\t\t\t\t\t\tgroupModeItem.activateBlinking();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tthis.scroller.scrollToItem(sortedItems.values().next().value);\n\n\t\t\t\t\t\t\tconst containerPosition = Dom.getPosition(this.planBuilder.getScrumContainer());\n\t\t\t\t\t\t\twindow.scrollTo({ top: containerPosition.top, behavior: 'smooth' });\n\n\t\t\t\t\t\t\tthis.requestSender.updateItemSort({\n\t\t\t\t\t\t\t\tsortInfo: this.calculateSort(entity.getListItemsNode(), sortedItemsIds)\n\t\t\t\t\t\t\t}).catch((response) => {\n\t\t\t\t\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tentity.deactivateGroupMode();\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.showMoveItemMenu(item, button, listToMove);\n\t}\n\n\tmoveItemToUp(item: Item, listItemsNode, updateSort = true)\n\t{\n\t\tDom.insertBefore(item.getNode(), listItemsNode.firstElementChild);\n\n\t\tif (updateSort)\n\t\t{\n\t\t\tthis.updateItemsSort(item, listItemsNode);\n\t\t}\n\t}\n\n\tmoveItemToDown(item, listItemsNode, updateSort = true)\n\t{\n\t\tDom.insertBefore(item.getNode(), listItemsNode.lastElementChild);\n\n\t\tif (updateSort)\n\t\t{\n\t\t\tthis.updateItemsSort(item, listItemsNode);\n\t\t}\n\t}\n\n\tupdateItemsSort(item: Item, listItemsNode: HTMLElement)\n\t{\n\t\tthis.requestSender.updateItemSort({\n\t\t\titemIds: [item.getId()],\n\t\t\tsortInfo: {\n\t\t\t\t...this.calculateSort(listItemsNode, new Set([item.getId()]))\n\t\t\t}\n\t\t}).catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tmoveInCurrentContainer(itemIds: Set<Item>, entity: Entity)\n\t{\n\t\treturn this.requestSender.updateItemSort({\n\t\t\tsortInfo: this.calculateSort(entity.getListItemsNode(), itemIds)\n\t\t}).catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tmoveInAnotherContainer(itemIds: Set<Item>, sourceEntity: Entity, endEntity: Entity)\n\t{\n\t\tthis.requestSender.updateItemSort({\n\t\t\tentityId: endEntity.getId(),\n\t\t\titemIds: Array.from(itemIds),\n\t\t\tsortInfo: this.calculateSort(endEntity.getListItemsNode(), itemIds, true)\n\t\t})\n\t\t\t.then(() => this.updateEntityCounters(sourceEntity, endEntity))\n\t\t\t.catch((response) => this.requestSender.showErrorAlert(response))\n\t\t;\n\t}\n\n\tupdateEntityCounters(sourceEntity: Entity, endEntity?: Entity)\n\t{\n\t\tconst entities = new Map();\n\n\t\tentities.set(sourceEntity.getId(), sourceEntity);\n\t\tif (endEntity)\n\t\t{\n\t\t\tentities.set(endEntity.getId(), endEntity);\n\t\t}\n\n\t\tthis.entityCounters.updateCounters(entities);\n\t}\n\n\tcalculateSort(container, updatedItemsIds?: Set, moveToAnotherEntity = false): ItemsSortInfo\n\t{\n\t\tconst listSortInfo = {};\n\n\t\tconst items = [...container.querySelectorAll('[data-sort]')];\n\t\tlet sort = 1;\n\t\titems.forEach((itemNode) => {\n\t\t\tconst itemId = parseInt(itemNode.dataset.id, 10);\n\t\t\tconst item = this.entityStorage.findItemByItemId(itemId);\n\t\t\tif (item && !item.isSubTask())\n\t\t\t{\n\t\t\t\tconst tmpId = Text.getRandom();\n\t\t\t\tlet isSortUpdated = (sort !== item.getSort());\n\t\t\t\titem.setSort(sort);\n\t\t\t\tlistSortInfo[itemId] = {\n\t\t\t\t\tsort: sort\n\t\t\t\t};\n\t\t\t\tif (moveToAnotherEntity)\n\t\t\t\t{\n\t\t\t\t\tlistSortInfo[itemId].entityId = container.dataset.entityId;\n\t\t\t\t\tisSortUpdated = true;\n\t\t\t\t}\n\t\t\t\tif (isSortUpdated && updatedItemsIds && updatedItemsIds.has(itemId))\n\t\t\t\t{\n\t\t\t\t\tlistSortInfo[itemId].tmpId = tmpId;\n\t\t\t\t\tlistSortInfo[itemId].updatedItemId = itemId;\n\t\t\t\t}\n\t\t\t\titemNode.dataset.sort = sort;\n\n\t\t\t\tsort++;\n\t\t\t}\n\t\t});\n\n\t\tthis.emit('calculateSort', listSortInfo);\n\n\t\treturn listSortInfo;\n\t}\n\n\tresortItems(entity: Entity)\n\t{\n\t\tlet sort = 1;\n\t\t[...entity.getListItemsNode().querySelectorAll('[data-sort]')]\n\t\t\t.forEach((itemNode: HTMLElement) => {\n\t\t\t\tconst itemId = parseInt(itemNode.dataset.id, 10);\n\t\t\t\tconst item = this.entityStorage.findItemByItemId(itemId);\n\t\t\t\tif (item && !item.isSubTask())\n\t\t\t\t{\n\t\t\t\t\titem.setSort(sort);\n\t\t\t\t\tsort++;\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\tmoveToAnotherEntity(entityFrom: Entity, item: Item, targetEntity: ?Entity, bindButton?: HTMLElement)\n\t{\n\t\tconst isMoveToSprint = (Type.isNull(targetEntity));\n\n\t\tconst sprints = (isMoveToSprint ? this.entityStorage.getSprintsAvailableForFilling(entityFrom) : null);\n\n\t\tif (isMoveToSprint)\n\t\t{\n\t\t\tif (sprints.size > 1)\n\t\t\t{\n\t\t\t\tthis.showListSprintsToMove(entityFrom, item, bindButton);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (sprints.size === 0)\n\t\t\t\t{\n\t\t\t\t\tthis.planBuilder.createSprint().then((sprint: Sprint) => {\n\t\t\t\t\t\tthis.moveToWithGroupMode(entityFrom, sprint, item, true, false);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tsprints.forEach((sprint: Sprint) => {\n\t\t\t\t\t\tthis.moveToWithGroupMode(entityFrom, sprint, item, true, false);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst message = Loc.getMessage('TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASKS_FROM_ACTIVE');\n\n\t\t\tthis.onMoveConfirm(entityFrom, message)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.moveToWithGroupMode(entityFrom, targetEntity, item, false, false);\n\t\t\t\t})\n\t\t\t\t.catch(() => {})\n\t\t\t;\n\t\t}\n\t}\n\n\tmoveToWithGroupMode(entityFrom: Entity, entityTo: Entity, item?: Item, moveToEnd = true, update = true)\n\t{\n\t\tconst groupModeItems = entityFrom.getGroupModeItems();\n\n\t\tif (item && !groupModeItems.has(item.getId()))\n\t\t{\n\t\t\tgroupModeItems.set(item.getId(), item);\n\t\t}\n\n\t\tconst sortedItems = [...groupModeItems.values()].sort((first: Item, second: Item) => {\n\t\t\tif (moveToEnd)\n\t\t\t{\n\t\t\t\tif (first.getSort() > second.getSort()) return 1;\n\t\t\t\tif (first.getSort() < second.getSort()) return -1;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (first.getSort() < second.getSort()) return 1;\n\t\t\t\tif (first.getSort() > second.getSort()) return -1;\n\t\t\t}\n\t\t});\n\n\t\tconst updateVisibilitySprints = (\n\t\t\tentityTo.isBacklog()\n\t\t\t\t? Promise.resolve()\n\t\t\t\t: this.planBuilder.updateVisibilitySprints(entityTo)\n\t\t);\n\n\t\tupdateVisibilitySprints.then(() => {\n\n\t\t\tthis.fadeOutEntity(entityTo);\n\n\t\t\tconst immediately = (!moveToEnd || !entityTo.isWaitingLoadItems());\n\n\t\t\tthis.loadEntityList(entityTo, immediately)\n\t\t\t\t.then(() => {\n\t\t\t\t\tthis.fadeInEntity(entityTo);\n\n\t\t\t\t\tconst sortedItemsIds = new Set();\n\n\t\t\t\t\tsortedItems.forEach((groupModeItem: Item) => {\n\t\t\t\t\t\tthis.moveTo(entityFrom, entityTo, groupModeItem, moveToEnd, update);\n\t\t\t\t\t\tsortedItemsIds.add(groupModeItem.getId());\n\t\t\t\t\t\tgroupModeItem.activateBlinking();\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.scroller.scrollToItem(sortedItems.values().next().value);\n\n\t\t\t\t\tthis.requestSender.updateItemSort({\n\t\t\t\t\t\tentityId: entityTo.getId(),\n\t\t\t\t\t\titemIds: Array.from(sortedItemsIds),\n\t\t\t\t\t\tsortInfo: {\n\t\t\t\t\t\t\t...this.calculateSort(entityTo.getListItemsNode(), sortedItemsIds, true),\n\t\t\t\t\t\t\t...this.calculateSort(entityFrom.getListItemsNode(), new Set(), true)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tthis.updateEntityCounters(entityFrom, entityTo);\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\n\t\t\t\t\tentityFrom.deactivateGroupMode();\n\t\t\t\t\tentityTo.deactivateGroupMode();\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\tmoveTo(entityFrom: Entity, entityTo: Entity, item: Item, moveToEnd = true, update = true)\n\t{\n\t\tconst itemNode = item.getNode();\n\t\tconst entityListNode = entityTo.getListItemsNode();\n\n\t\tif (item.isParentTask() && item.isShownSubTasks())\n\t\t{\n\t\t\titem.hideSubTasks();\n\t\t}\n\n\t\tif (moveToEnd)\n\t\t{\n\t\t\tDom.insertBefore(itemNode, entityListNode.lastElementChild);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.insertBefore(itemNode, entityListNode.firstElementChild);\n\t\t}\n\n\t\tthis.moveItemFromEntityToEntity(item, entityFrom, entityTo);\n\n\t\tif (update)\n\t\t{\n\t\t\tthis.onMoveItemUpdate(entityFrom, entityTo, item);\n\t\t}\n\t}\n\n\tmoveToPosition(entityFrom: Entity, entityTo: Entity, item: Item)\n\t{\n\t\tconst isMoveFromAnotherEntity = (entityFrom.getId() !== entityTo.getId());\n\n\t\tconst itemNode = item.getNode() ? item.getNode() : item.render();\n\t\tconst itemSort = item.getSort();\n\t\tconst itemPreviousSortSort = item.getPreviousSort();\n\n\t\tconst entityListNode = entityTo.getListItemsNode();\n\t\tconst bindItemNode = entityListNode.children[itemSort - 1];\n\n\t\tif (Dom.hasClass(bindItemNode, 'tasks-scrum__item'))\n\t\t{\n\t\t\tconst bindItemSort = parseInt(bindItemNode.dataset.sort, 10);\n\n\t\t\tconst bindItem = this.entityStorage.findItemByItemId(parseInt(bindItemNode.dataset.id, 10));\n\t\t\tif (bindItem.isParentTask() && bindItem.isShownSubTasks())\n\t\t\t{\n\t\t\t\tbindItem.hideSubTasks();\n\t\t\t}\n\n\t\t\tif (itemPreviousSortSort > 0 && bindItemSort >= itemPreviousSortSort)\n\t\t\t{\n\t\t\t\tif (isMoveFromAnotherEntity)\n\t\t\t\t{\n\t\t\t\t\tDom.insertBefore(itemNode, bindItemNode);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.planBuilder.appendItemAfterItem(itemNode, bindItemNode);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.insertBefore(itemNode, bindItemNode);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (entityTo.isEmpty())\n\t\t\t{\n\t\t\t\tDom.insertBefore(itemNode, entityTo.getLoaderNode());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (entityTo.isBacklog())\n\t\t\t\t{\n\t\t\t\t\tDom.insertBefore(itemNode, entityTo.getFirstItemNode());\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tDom.insertBefore(itemNode, entityTo.getLoaderNode());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.moveItemFromEntityToEntity(item, entityFrom, entityTo);\n\n\t\tthis.updateEntityCounters(entityFrom, entityTo);\n\n\t\tif (isMoveFromAnotherEntity)\n\t\t{\n\t\t\tthis.resortItems(entityFrom);\n\t\t}\n\t\tthis.resortItems(entityTo);\n\t}\n\n\tmoveItemFromEntityToEntity(item: Item, entityFrom: Entity, entityTo: Entity)\n\t{\n\t\tentityFrom.removeItem(item);\n\n\t\titem.setParentEntity(entityTo.getId(), entityTo.getEntityType());\n\n\t\tentityTo.setItem(item);\n\t}\n\n\tshowListSprintsToMove(entityFrom: Entity, item: Item, button: HTMLElement)\n\t{\n\t\tconst id = `item-sprint-action-${entityFrom.getEntityType() + entityFrom.getId() + item.getId()}`;\n\n\t\tif (this.moveToSprintMenu)\n\t\t{\n\t\t\tthis.moveToSprintMenu.getPopupWindow().close();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.moveToSprintMenu = new Menu({\n\t\t\tid: id,\n\t\t\tbindElement: button,\n\t\t\toffsetTop: 12,\n\t\t\toffsetLeft: -32\n\t\t});\n\n\t\tthis.entityStorage.getSprints().forEach((sprint) => {\n\t\t\tif (!sprint.isCompleted() && !this.isSameSprint(entityFrom, sprint))\n\t\t\t{\n\t\t\t\tthis.moveToSprintMenu.addMenuItem({\n\t\t\t\t\ttext: sprint.getName(),\n\t\t\t\t\tonclick: (event, menuItem) => {\n\t\t\t\t\t\tlet message = Loc.getMessage('TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASK_FROM_ACTIVE');\n\t\t\t\t\t\tif (entityFrom.isGroupMode())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmessage = Loc.getMessage('TASKS_SCRUM_CONFIRM_TEXT_MOVE_TASKS_FROM_ACTIVE');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.onMoveConfirm(entityFrom, message)\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tthis.moveToWithGroupMode(entityFrom, sprint, item, true, false);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.catch(() => {})\n\t\t\t\t\t\t;\n\t\t\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.moveToSprintMenu.getPopupWindow().subscribe('onClose', () => {\n\t\t\tthis.moveToSprintMenu.destroy();\n\t\t\tthis.moveToSprintMenu = null;\n\t\t\tthis.emit('moveToSprintMenuClose');\n\t\t});\n\n\t\tthis.moveToSprintMenu.show();\n\t}\n\n\tisSameSprint(first: Sprint, second: Sprint): boolean\n\t{\n\t\treturn (first.getEntityType() === 'sprint' && first.getId() === second.getId());\n\t}\n\n\tshowMoveItemMenu(item, button, listToMove)\n\t{\n\t\tconst id = `item-move-${item.getId()}`;\n\n\t\tif (this.moveItemMenu)\n\t\t{\n\t\t\tthis.moveItemMenu.getPopupWindow().close();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.moveItemMenu = new Menu({\n\t\t\tid: id,\n\t\t\tbindElement: button,\n\t\t\toffsetTop: 12,\n\t\t\toffsetLeft: -28\n\t\t});\n\n\t\tlistToMove.forEach((item) => {\n\t\t\tthis.moveItemMenu.addMenuItem(item);\n\t\t});\n\n\t\tthis.moveItemMenu.getPopupWindow().subscribe('onClose', () => {\n\t\t\tthis.moveItemMenu.destroy();\n\t\t\tthis.moveItemMenu = null;\n\t\t\tthis.emit('moveMenuClose');\n\t\t});\n\n\t\tthis.moveItemMenu.show();\n\t}\n\n\thasActionPanelDialog(): boolean\n\t{\n\t\treturn (this.moveItemMenu || this.moveToSprintMenu)\n\t}\n\n\tcloseActionPanelDialogs()\n\t{\n\t\tif (this.moveItemMenu)\n\t\t{\n\t\t\tthis.moveItemMenu.getPopupWindow().close();\n\t\t}\n\n\t\tif (this.moveToSprintMenu)\n\t\t{\n\t\t\tthis.moveToSprintMenu.getPopupWindow().close();\n\t\t}\n\t}\n\n\tloadEntityList(entity: Entity, immediately: boolean = false): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif (immediately)\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.planBuilder.loadAllItems(entity).then(() => resolve());\n\t\t\t}\n\t\t});\n\t}\n\n\tfadeOutEntity(entity: Entity)\n\t{\n\t\tentity.fadeOut();\n\n\t\tentity.showListLoader();\n\t}\n\n\tfadeInEntity(entity: Entity)\n\t{\n\t\tentity.hideListLoader();\n\n\t\tentity.fadeIn();\n\t}\n}\n","import {Item} from './item';\n\nimport {Entity} from '../entity/entity';\nimport {EntityStorage} from '../entity/entity.storage';\n\nimport {RequestSender} from '../utility/request.sender';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tentityStorage: EntityStorage\n}\n\nexport class ItemDesigner\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.entityStorage = params.entityStorage;\n\n\t\tthis.listAllUsedColors = new Set();\n\n\t\tthis.randomColorCount = 0;\n\t\tthis.defaultColor = '#2ECEFF';\n\t}\n\n\tgetRandomColorForItemBorder(): Promise\n\t{\n\t\tthis.randomColorCount = 0;\n\n\t\treturn this.getAllUsedColors().then(() => {\n\t\t\treturn this.getRandomColor(this.getAllColors());\n\t\t});\n\t}\n\n\tgetAllColors(): Array\n\t{\n\t\treturn [\n\t\t\t'#2ECEFF', '#10E5FC', '#A5DE00', '#EEC202',\n\t\t\t'#AD8F47', '#FF5B55', '#EF3001', '#F968B6',\n\t\t\t'#6B52CC', '#07BAB1', '#5CD1DF', '#A1A6AC',\n\t\t\t'#949DA9', '#01A64C', '#B02FB0', '#EF008B',\n\t\t\t'#0202FF', '#555555', '#C4C4C4', '#AAAAAA',\n\t\t\t'#F89675', '#C5E099', '#7ECB9C', '#78CDCA',\n\t\t\t'#887FC0', '#BD8AC0', '#F6989C', '#F26A47',\n\t\t\t'#ABD46B', '#00BBB4', '#3FB2CD', '#5471B9',\n\t\t\t'#3E8BCD', '#A861AB', '#F26A7B', '#9E0402',\n\t\t\t'#A46200', '#578520', '#01736A', '#0175A6',\n\t\t\t'#033172', '#460763', '#630260', '#9F0137',\n\t\t\t'#B7EB81', '#FFA900', '#F7A700', '#333333',\n\t\t\t'#EDEEF0', '#E1F3F9'\n\t\t];\n\t}\n\n\tgetRandomColor(allColors: Array): string\n\t{\n\t\tthis.randomColorCount++;\n\n\t\tif (this.randomColorCount >= allColors.length)\n\t\t{\n\t\t\treturn this.defaultColor;\n\t\t}\n\n\t\tconst randomColor = allColors[Math.floor(Math.random() * allColors.length)];\n\n\t\tif (this.isThisBorderColorAlreadyUse(randomColor))\n\t\t{\n\t\t\treturn this.getRandomColor(allColors);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn randomColor;\n\t\t}\n\t}\n\n\tisThisBorderColorAlreadyUse(color: string): boolean\n\t{\n\t\tlet isAlreadyUse = false;\n\n\t\tthis.listAllUsedColors\n\t\t\t.forEach((usedColor: string) => {\n\t\t\t\tif (usedColor === color)\n\t\t\t\t{\n\t\t\t\t\tisAlreadyUse = true;\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\treturn isAlreadyUse;\n\t}\n\n\tgetAllUsedColors(): Promise\n\t{\n\t\tconst entityIds = new Set();\n\t\tthis.entityStorage.getAllEntities()\n\t\t\t.forEach((entity: Entity) => {\n\t\t\t\tif (!entity.isCompleted())\n\t\t\t\t{\n\t\t\t\t\tentityIds.add(entity.getId());\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\treturn this.requestSender.getAllUsedItemBorderColors({\n\t\t\tentityIds: [...entityIds.values()]\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tthis.listAllUsedColors = new Set(response.data);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tupdateBorderColor(items: Set<Item>)\n\t{\n\t\tconst itemIdsToUpdateColor = new Set();\n\n\t\titems.forEach((item: Item) => {\n\t\t\tif (item.isLinkedTask() && !item.getBorderColor())\n\t\t\t{\n\t\t\t\titemIdsToUpdateColor.add(item.getId());\n\t\t\t}\n\t\t});\n\n\t\tif (itemIdsToUpdateColor.size)\n\t\t{\n\t\t\tthis.getAllUsedColors().then(() => {\n\t\t\t\tconst items = new Map();\n\t\t\t\titemIdsToUpdateColor.forEach((itemId: number) => {\n\t\t\t\t\titems.set(itemId, this.getRandomColor(this.getAllColors()));\n\t\t\t\t});\n\n\t\t\t\tthis.requestSender.updateBorderColorToLinkedItems({\n\t\t\t\t\titems: Object.fromEntries(items)\n\t\t\t\t})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tconst updatedItems = response.data;\n\t\t\t\t\t\tObject.keys(updatedItems).forEach((itemId: number) => {\n\t\t\t\t\t\t\tconst borderColor = updatedItems[itemId];\n\t\t\t\t\t\t\tconst item = this.entityStorage.findItemByItemId(itemId);\n\t\t\t\t\t\t\titem.setBorderColor(borderColor);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t}\n\t}\n}","import {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {Filter} from '../service/filter';\nimport {SidePanel} from '../service/side.panel';\n\nimport {EntityStorage} from '../entity/entity.storage';\n\nimport {TagSearcher} from '../utility/tag.searcher';\n\nimport type {EpicType} from '../item/task/epic';\n\ntype Params = {\n\tgroupId: number,\n\tentityStorage: EntityStorage,\n\tsidePanel: SidePanel,\n\tfilter: Filter,\n\ttagSearcher: TagSearcher,\n}\n\nexport class Epic extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Epic.Helper');\n\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\n\t\tthis.entityStorage = params.entityStorage;\n\t\tthis.sidePanel = params.sidePanel;\n\t\tthis.filter = params.filter;\n\t\tthis.tagSearcher = params.tagSearcher;\n\n\t\tthis.subscribeToExtension();\n\t}\n\n\tsubscribeToExtension()\n\t{\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Tasks.Scrum.Epic:afterAdd',\n\t\t\t(baseEvent: BaseEvent) => {\n\t\t\t\tthis.onAfterAdd(baseEvent);\n\t\t\t})\n\t\t;\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Tasks.Scrum.Epic:afterEdit',\n\t\t\t(baseEvent: BaseEvent) => {\n\t\t\t\tthis.onAfterEdit(baseEvent);\n\t\t\t})\n\t\t;\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Tasks.Scrum.Epic:filterByTag',\n\t\t\t(baseEvent: BaseEvent) => {\n\t\t\t\tthis.emit('filterByTag', baseEvent.getData())\n\t\t\t})\n\t\t;\n\n\t\tEventEmitter.subscribe(\n\t\t\t'BX.Tasks.Scrum.Epic:afterRemove',\n\t\t\t(baseEvent: BaseEvent) => {\n\t\t\t\tthis.onAfterRemove(baseEvent);\n\t\t\t})\n\t\t;\n\t}\n\n\topenAddForm(): Promise\n\t{\n\t\treturn this.sidePanel.showByExtension(\n\t\t\t'Epic',\n\t\t\t{\n\t\t\t\tview: 'add',\n\t\t\t\tgroupId: this.groupId\n\t\t\t}\n\t\t);\n\t}\n\n\tonAfterAdd(baseEvent: BaseEvent)\n\t{\n\t\tconst epic: EpicType = baseEvent.getData();\n\n\t\tthis.tagSearcher.addEpicToSearcher(epic);\n\n\t\tthis.filter.addItemToListTypeField('EPIC', {\n\t\t\tNAME: epic.name.trim(),\n\t\t\tVALUE: String(epic.id)\n\t\t});\n\t}\n\n\tonAfterEdit(baseEvent: BaseEvent)\n\t{\n\t\tconst epic: EpicType = baseEvent.getData();\n\n\t\tthis.entityStorage.getAllItems().forEach((item) => {\n\t\t\tconst itemEpic = item.getEpic().getValue();\n\t\t\tif (itemEpic && itemEpic.id === epic.id)\n\t\t\t{\n\t\t\t\titem.setEpic(epic);\n\t\t\t}\n\t\t});\n\n\t\tthis.tagSearcher.removeEpicFromSearcher(epic);\n\t\tthis.tagSearcher.addEpicToSearcher(epic);\n\t}\n\n\tonAfterRemove(baseEvent: BaseEvent)\n\t{\n\t\tconst epic: EpicType = baseEvent.getData();\n\n\t\tthis.entityStorage.getAllItems().forEach((item) => {\n\t\t\tconst itemEpic = item.getEpic().getValue();\n\t\t\tif (itemEpic && itemEpic.id === epic.id)\n\t\t\t{\n\t\t\t\titem.setEpic();\n\t\t\t}\n\t\t});\n\n\t\tthis.tagSearcher.removeEpicFromSearcher(epic);\n\t}\n}","import {Type} from 'main.core';\n\nimport {PlanBuilder} from '../view/plan/plan.builder';\n\nimport {EntityStorage} from '../entity/entity.storage';\nimport {Sprint} from '../entity/sprint/sprint';\nimport {Item} from '../item/item';\n\nimport {RequestSender} from '../utility/request.sender';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tplanBuilder: PlanBuilder,\n\tentityStorage: EntityStorage,\n\tgroupId: number,\n\tcanStartSprint: boolean,\n\tcanCompleteSprint: boolean\n}\n\ntype PushParams = {\n\tid: number,\n\tgroupId: number,\n\ttmpId?: string\n}\n\nexport class PullSprint\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.planBuilder = params.planBuilder;\n\t\tthis.entityStorage = params.entityStorage;\n\t\tthis.groupId = params.groupId;\n\n\t\tthis.listIdsToSkipAdding = new Set();\n\t\tthis.listIdsToSkipUpdating = new Set();\n\t\tthis.listIdsToSkipRemoving = new Set();\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'tasks';\n\t}\n\n\tgetMap()\n\t{\n\t\treturn {\n\t\t\tsprintAdded: this.onSprintAdded.bind(this),\n\t\t\tsprintUpdated: this.onSprintUpdated.bind(this),\n\t\t\tsprintRemoved: this.onSprintRemoved.bind(this)\n\t\t};\n\t}\n\n\tonSprintAdded(params: PushParams)\n\t{\n\t\tif (this.groupId !== params.groupId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.needSkipAdd(params.tmpId))\n\t\t{\n\t\t\tthis.cleanSkipAdd(params.tmpId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.requestSender.getSprintData({\n\t\t\tsprintId: params.id\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tresponse.data.items = [];\n\t\t\t\tconst sprint = Sprint.buildSprint(response.data);\n\t\t\t\tthis.planBuilder.createSprintNode(sprint);\n\t\t\t})\n\t\t\t.catch((response) => {})\n\t\t;\n\t}\n\n\tonSprintUpdated(params: PushParams)\n\t{\n\t\tif (this.groupId !== params.groupId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.needSkipUpdate(params.id))\n\t\t{\n\t\t\tthis.cleanSkipUpdate(params.id);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.requestSender.getSprintData({\n\t\t\tsprintId: params.id\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tresponse.data.items = [];\n\t\t\t\tconst tmpSprint = Sprint.buildSprint(response.data);\n\t\t\t\tconst sprint: Sprint = this.entityStorage.findEntityByEntityId(tmpSprint.getId());\n\t\t\t\tif (sprint)\n\t\t\t\t{\n\t\t\t\t\tconst currentStatus = sprint.getStatus();\n\n\t\t\t\t\tsprint.updateYourself(tmpSprint);\n\n\t\t\t\t\tif (tmpSprint.getStatus() !== currentStatus)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tmpSprint.getStatus() === 'active')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.planBuilder.moveSprintToActiveListNode(sprint);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (tmpSprint.getStatus() === 'completed')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsprint.getItems()\n\t\t\t\t\t\t\t\t.forEach((item: Item) => {\n\t\t\t\t\t\t\t\t\tif (item.isShownSubTasks())\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\titem.hideSubTasks();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tsprint.removeItem(item);\n\t\t\t\t\t\t\t\t\titem.removeYourself();\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\tsprint.setBlank(sprint);\n\t\t\t\t\t\t\tsprint.hideContent();\n\n\t\t\t\t\t\t\tthis.planBuilder.moveSprintToCompletedListNode(sprint);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.planBuilder.updatePlannedSprints(\n\t\t\t\t\t\tthis.entityStorage.getPlannedSprints(),\n\t\t\t\t\t\t(!Type.isUndefined(this.entityStorage.getActiveSprint()))\n\t\t\t\t\t);\n\n\t\t\t\t\tthis.planBuilder.updateSprintContainers();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {})\n\t\t;\n\t}\n\n\tonSprintRemoved(params: PushParams)\n\t{\n\t\tif (this.groupId !== params.groupId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.needSkipRemove(params.id))\n\t\t{\n\t\t\tthis.cleanSkipRemove(params.id);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst sprint = this.entityStorage.findEntityByEntityId(params.id);\n\t\tif (sprint)\n\t\t{\n\t\t\tsprint.removeYourself();\n\n\t\t\tthis.entityStorage.removeSprint(sprint.getId());\n\t\t}\n\t}\n\n\taddTmpIdToSkipAdding(tmpId: string)\n\t{\n\t\tthis.listIdsToSkipAdding.add(tmpId);\n\t}\n\n\taddIdToSkipUpdating(sprintId: number)\n\t{\n\t\tthis.listIdsToSkipUpdating.add(sprintId);\n\t}\n\n\taddIdToSkipRemoving(sprintId: number)\n\t{\n\t\tthis.listIdsToSkipRemoving.add(sprintId);\n\t}\n\n\tneedSkipAdd(tmpId: string): boolean\n\t{\n\t\treturn this.listIdsToSkipAdding.has(tmpId);\n\t}\n\n\tcleanSkipAdd(tmpId: string)\n\t{\n\t\tthis.listIdsToSkipAdding.delete(tmpId);\n\t}\n\n\tneedSkipUpdate(sprintId: number): boolean\n\t{\n\t\treturn this.listIdsToSkipUpdating.has(sprintId);\n\t}\n\n\tcleanSkipUpdate(sprintId: number)\n\t{\n\t\tthis.listIdsToSkipUpdating.delete(sprintId);\n\t}\n\n\tneedSkipRemove(sprintId: number): boolean\n\t{\n\t\treturn this.listIdsToSkipRemoving.has(sprintId);\n\t}\n\n\tcleanSkipRemove(sprintId: number)\n\t{\n\t\tthis.listIdsToSkipRemoving.delete(sprintId);\n\t}\n}","import {Type} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\n\nimport {EntityStorage} from '../entity/entity.storage';\n\nimport {Item, ItemParams} from '../item/item';\nimport {ItemMover, ItemsSortInfo} from '../item/item.mover';\n\nimport {EntityCounters} from '../counters/entity.counters';\n\nimport {RequestSender} from '../utility/request.sender';\nimport {TagSearcher} from '../utility/tag.searcher';\n\nimport {Entity} from '../entity/entity';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tentityStorage: EntityStorage,\n\tentityCounters: EntityCounters,\n\ttagSearcher: TagSearcher,\n\titemMover: ItemMover,\n\tcurrentUserId: number,\n\tgroupId: number\n}\n\ntype PushParams = {\n\tid: number,\n\tgroupId: number,\n\ttmpId?: string\n}\n\nexport class PullItem\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.entityStorage = params.entityStorage;\n\t\tthis.entityCounters = params.entityCounters;\n\t\tthis.tagSearcher = params.tagSearcher;\n\t\tthis.itemMover = params.itemMover;\n\t\tthis.currentUserId = params.currentUserId;\n\t\tthis.groupId = params.groupId;\n\n\t\tthis.listToAddAfterUpdate = new Set();\n\n\t\tthis.listIdsToSkipAdding = new Set();\n\t\tthis.listIdsToSkipUpdating = new Set();\n\t\tthis.listIdsToSkipRemoving = new Set();\n\t\tthis.listIdsToSkipSorting = new Set();\n\n\t\tthis.itemMover.subscribe('calculateSort', this.onCalculateSort.bind(this));\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'tasks';\n\t}\n\n\tgetMap(): Object\n\t{\n\t\treturn {\n\t\t\titemAdded: this.onItemAdded.bind(this),\n\t\t\titemUpdated: this.onItemUpdated.bind(this),\n\t\t\titemRemoved: this.onItemRemoved.bind(this),\n\t\t\titemSortUpdated: this.onItemSortUpdated.bind(this),\n\t\t\tcomment_add: this.onCommentAdd.bind(this)\n\t\t};\n\t}\n\n\tonItemAdded(params: PushParams)\n\t{\n\t\tif (this.groupId !== params.groupId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setDelayedAdd(params.id);\n\n\t\tthis.externalAdd(params.id)\n\t\t\t.finally(() => this.cleanDelayedAdd(params.id))\n\t\t\t.then(() => {\n\t\t\t\tthis.requestSender.getItemData({\n\t\t\t\t\titemIds: [params.id]\n\t\t\t\t})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tconst itemData = response.data\n\t\t\t\t\t\t\t.find((itemData: ItemParams) => itemData.id === params.id)\n\t\t\t\t\t\t;\n\t\t\t\t\t\tconst item = Item.buildItem(itemData);\n\t\t\t\t\t\tthis.addItemToEntity(item);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {})\n\t\t\t\t;\n\t\t\t})\n\t\t\t.catch(() => {})\n\t\t;\n\t}\n\n\tonItemUpdated(params: PushParams)\n\t{\n\t\tif (this.groupId !== params.groupId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.requestSender.getItemData({\n\t\t\titemIds: [params.id]\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tconst itemData = response.data\n\t\t\t\t\t.find((itemData: ItemParams) => itemData.id === params.id)\n\t\t\t\t;\n\t\t\t\tconst item = Item.buildItem(itemData);\n\n\t\t\t\tif (this.isDelayedAdd(item.getId()))\n\t\t\t\t{\n\t\t\t\t\tthis.cleanDelayedAdd(item.getId());\n\n\t\t\t\t\tif (this.needSkipAdd(params.tmpId))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.cleanSkipAdd(params.tmpId);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.addItemToEntity(item);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.needSkipUpdate(item))\n\t\t\t\t{\n\t\t\t\t\tthis.cleanSkipUpdate(item);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.updateItem(item);\n\t\t\t})\n\t\t\t.catch((response) => {})\n\t\t;\n\t}\n\n\tonItemRemoved(params: PushParams)\n\t{\n\t\tif (this.groupId !== params.groupId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.needSkipRemove(params.id))\n\t\t{\n\t\t\tthis.cleanSkipRemove(params.id);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst item = this.entityStorage.findItemByItemId(params.id);\n\t\tif (item)\n\t\t{\n\t\t\tconst entity = this.entityStorage.findEntityByItemId(item.getId());\n\t\t\tentity.removeItem(item);\n\t\t\titem.removeYourself();\n\n\t\t\tthis.updateEntityCounters(entity);\n\t\t}\n\t}\n\n\tonItemSortUpdated(itemsSortInfo: ItemsSortInfo)\n\t{\n\t\tconst itemsInfoToSort = new Map();\n\n\t\tObject.entries(itemsSortInfo).forEach(([itemId, info]) => {\n\t\t\tif (!this.needSkipSort(info.tmpId))\n\t\t\t{\n\t\t\t\titemsInfoToSort.set(parseInt(itemId, 10), info);\n\t\t\t}\n\t\t\tthis.cleanSkipRemove(info.tmpId);\n\t\t});\n\n\t\tif (itemsInfoToSort.size === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.requestSender.getItemData({\n\t\t\titemIds: [...itemsInfoToSort.keys()]\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tconst itemsToSort = new Map();\n\t\t\t\tconst newItems = new Set();\n\t\t\t\tresponse.data\n\t\t\t\t\t.forEach((itemData: ItemParams) => {\n\t\t\t\t\t\tlet item = this.entityStorage.findItemByItemId(itemData.id);\n\t\t\t\t\t\tif (!item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem = Item.buildItem(itemData);\n\t\t\t\t\t\t\tnewItems.add(item.getId());\n\t\t\t\t\t\t}\n\t\t\t\t\t\titemsToSort.set(item.getId(), item);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t\titemsToSort.forEach((item: Item) => {\n\t\t\t\t\tconst itemInfoToSort = itemsInfoToSort.get(item.getId());\n\t\t\t\t\tif (item.isParentTask() && item.isShownSubTasks())\n\t\t\t\t\t{\n\t\t\t\t\t\titem.hideSubTasks();\n\t\t\t\t\t}\n\t\t\t\t\titem.setSort(itemInfoToSort.sort);\n\t\t\t\t\tif (newItems.has(item.getId()))\n\t\t\t\t\t{\n\t\t\t\t\t\titem.setPreviousSort(0);\n\t\t\t\t\t}\n\t\t\t\t\tconst sourceEntity = this.entityStorage.findEntityByEntityId(item.getEntityId());\n\t\t\t\t\tif (sourceEntity)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst targetEntityId = (\n\t\t\t\t\t\t\tType.isUndefined(itemInfoToSort.entityId)\n\t\t\t\t\t\t\t\t? item.getEntityId()\n\t\t\t\t\t\t\t\t: itemInfoToSort.entityId\n\t\t\t\t\t\t);\n\t\t\t\t\t\tlet targetEntity = this.entityStorage.findEntityByEntityId(targetEntityId);\n\t\t\t\t\t\tif (!targetEntity || sourceEntity.getId() === targetEntity.getId())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttargetEntity = sourceEntity;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.itemMover.moveToPosition(sourceEntity, targetEntity, item);\n\t\t\t\t\t\tthis.entityStorage.recalculateItemsSort();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((response) => {})\n\t\t;\n\t}\n\n\tonCommentAdd(params)\n\t{\n\t\tconst participants = Type.isArray(params.participants) ? params.participants : [];\n\n\t\tif (participants.includes(this.currentUserId.toString()))\n\t\t{\n\t\t\tconst xmlId = params.entityXmlId.split('_');\n\t\t\tif (xmlId)\n\t\t\t{\n\t\t\t\tconst entityType = xmlId[0];\n\t\t\t\tconst taskId = xmlId[1];\n\t\t\t\tconst item = this.entityStorage.findItemBySourceId(taskId);\n\t\t\t\tif (entityType === 'TASK' && item)\n\t\t\t\t{\n\t\t\t\t\tthis.requestSender.getCurrentState({\n\t\t\t\t\t\ttaskId: item.getSourceId()\n\t\t\t\t\t}).then((response) => {\n\t\t\t\t\t\tconst tmpItem = Item.buildItem(response.data.itemData);\n\t\t\t\t\t\tthis.updateItem(tmpItem, item);\n\t\t\t\t\t}).catch((response) => {\n\t\t\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\taddItemToEntity(item: Item)\n\t{\n\t\tif (item.isSubTask())\n\t\t{\n\t\t\tconst parentItem = this.entityStorage.findItemBySourceId(item.getParentTaskId());\n\n\t\t\tif (parentItem && !parentItem.isDecompositionMode())\n\t\t\t{\n\t\t\t\tparentItem.hideSubTasks();\n\t\t\t\tparentItem.cleanSubTasks();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.requestSender.hasTaskInFilter({\n\t\t\ttaskId: item.getSourceId()\n\t\t}).then((response) => {\n\t\t\tif (!response.data.has)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst entity = this.entityStorage.findEntityByEntityId(item.getEntityId());\n\t\t\tif (!entity)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst existingItem = this.entityStorage.findItemBySourceId(item.getSourceId());\n\t\t\tif (existingItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.itemMover.moveToPosition(entity, entity, item);\n\t\t\tthis.entityStorage.recalculateItemsSort();\n\t\t}).catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tupdateItem(tmpItem: Item, item?: Item)\n\t{\n\t\tif (!item)\n\t\t{\n\t\t\titem = this.entityStorage.findItemByItemId(tmpItem.getId());\n\t\t}\n\n\t\tif (item)\n\t\t{\n\t\t\tconst isParentChangeAction = tmpItem.isSubTask() !== item.isSubTask();\n\t\t\tif (isParentChangeAction)\n\t\t\t{\n\t\t\t\tif (tmpItem.isSubTask())\n\t\t\t\t{\n\t\t\t\t\tconst entity = this.entityStorage.findEntityByItemId(item.getId());\n\t\t\t\t\tentity.removeItem(item);\n\t\t\t\t\titem.removeYourself();\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst targetEntityId = tmpItem.getEntityId();\n\t\t\tconst sourceEntityId = item.getEntityId();\n\t\t\tconst targetEntity = this.entityStorage.findEntityByEntityId(targetEntityId);\n\t\t\tconst sourceEntity = this.entityStorage.findEntityByEntityId(sourceEntityId);\n\n\t\t\tif (tmpItem.getEntityId() !== item.getEntityId())\n\t\t\t{\n\t\t\t\tif (targetEntity && sourceEntity)\n\t\t\t\t{\n\t\t\t\t\tthis.itemMover.moveToPosition(sourceEntity, targetEntity, item);\n\t\t\t\t\tthis.entityStorage.recalculateItemsSort();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.updateEntityCounters(targetEntity);\n\t\t\t}\n\n\t\t\titem.updateYourself(tmpItem);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (tmpItem.isSubTask())\n\t\t\t{\n\t\t\t\tconst targetEntityId = tmpItem.getEntityId();\n\t\t\t\tconst targetEntity = this.entityStorage.findEntityByEntityId(targetEntityId);\n\n\t\t\t\tthis.updateEntityCounters(targetEntity);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.addItemToEntity(tmpItem);\n\t\t\t}\n\t\t}\n\t}\n\n\tupdateEntityCounters(sourceEntity: Entity, endEntity?: Entity)\n\t{\n\t\tconst entities = new Map();\n\n\t\tentities.set(sourceEntity.getId(), sourceEntity);\n\t\tif (endEntity)\n\t\t{\n\t\t\tentities.set(endEntity.getId(), endEntity);\n\t\t}\n\n\t\tthis.entityCounters.updateCounters(entities);\n\t}\n\n\tonCalculateSort(baseEvent: BaseEvent)\n\t{\n\t\tconst listSortInfo = baseEvent.getData();\n\n\t\tObject.entries(listSortInfo).forEach(([itemId, info]) => {\n\t\t\tif (Object.prototype.hasOwnProperty.call(info, 'tmpId'))\n\t\t\t{\n\t\t\t\tthis.addTmpIdToSkipSorting(info.tmpId);\n\t\t\t}\n\t\t});\n\t}\n\n\taddTmpIdToSkipAdding(tmpId: string)\n\t{\n\t\tthis.listIdsToSkipAdding.add(tmpId);\n\t}\n\n\taddIdToSkipUpdating(itemId: string)\n\t{\n\t\tthis.listIdsToSkipUpdating.add(itemId);\n\t}\n\n\taddIdToSkipRemoving(itemId: number)\n\t{\n\t\tthis.listIdsToSkipRemoving.add(itemId);\n\t}\n\n\taddTmpIdToSkipSorting(tmpId: string)\n\t{\n\t\tthis.listIdsToSkipSorting.add(tmpId);\n\t}\n\n\texternalAdd(itemId: number): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tsetTimeout(() => (this.isDelayedAdd(itemId) ? resolve() : reject()), 3000);\n\t\t});\n\t}\n\n\tisDelayedAdd(itemId: number): boolean\n\t{\n\t\treturn this.listToAddAfterUpdate.has(itemId);\n\t}\n\n\tsetDelayedAdd(itemId: number)\n\t{\n\t\tthis.listToAddAfterUpdate.add(itemId);\n\t}\n\n\tcleanDelayedAdd(itemId: number)\n\t{\n\t\tthis.listToAddAfterUpdate.delete(itemId);\n\t}\n\n\tneedSkipAdd(tmpId: string): boolean\n\t{\n\t\treturn this.listIdsToSkipAdding.has(tmpId);\n\t}\n\n\tcleanSkipAdd(tmpId: string)\n\t{\n\t\tthis.listIdsToSkipAdding.delete(tmpId);\n\t}\n\n\tneedSkipUpdate(item: Item): boolean\n\t{\n\t\treturn this.listIdsToSkipUpdating.has(item.getId());\n\t}\n\n\tcleanSkipUpdate(item: Item)\n\t{\n\t\tthis.listIdsToSkipUpdating.delete(item.getId());\n\t}\n\n\tneedSkipRemove(itemId: number): boolean\n\t{\n\t\treturn this.listIdsToSkipRemoving.has(itemId);\n\t}\n\n\tcleanSkipRemove(itemId: number)\n\t{\n\t\tthis.listIdsToSkipRemoving.delete(itemId);\n\t}\n\n\tneedSkipSort(tmpId: string): boolean\n\t{\n\t\treturn this.listIdsToSkipSorting.has(tmpId);\n\t}\n\n\tcleanSkipSort(tmpId: string)\n\t{\n\t\tthis.listIdsToSkipSorting.delete(tmpId);\n\t}\n}","import {EntityStorage} from '../entity/entity.storage';\n\nimport {BaseEvent} from 'main.core.events';\n\nimport {RequestSender} from '../utility/request.sender';\n\nimport {Epic} from '../epic/epic';\n\nimport type {EpicType} from '../item/task/epic';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tentityStorage: EntityStorage,\n\tepic: Epic\n}\n\nexport class PullEpic\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.entityStorage = params.entityStorage;\n\t\tthis.epic = params.epic;\n\n\t\tthis.listIdsToSkipAdding = new Set();\n\t\tthis.listIdsToSkipUpdating = new Set();\n\t\tthis.listIdsToSkipRemoving = new Set();\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'tasks';\n\t}\n\n\tgetMap()\n\t{\n\t\treturn {\n\t\t\tepicAdded: this.onEpicAdded.bind(this),\n\t\t\tepicUpdated: this.onEpicUpdated.bind(this),\n\t\t\tepicRemoved: this.onEpicRemoved.bind(this)\n\t\t};\n\t}\n\n\tonEpicAdded(epicData: EpicType)\n\t{\n\t\tthis.epic.onAfterAdd((new BaseEvent()).setData(epicData));\n\t}\n\n\tonEpicUpdated(epicData: EpicType)\n\t{\n\t\tthis.epic.onAfterEdit((new BaseEvent()).setData(epicData));\n\t}\n\n\tonEpicRemoved(epicData: EpicType)\n\t{\n\t\tthis.epic.onAfterRemove((new BaseEvent()).setData(epicData));\n\t}\n}","import { Filter } from '../service/filter';\nimport { EntityStorage } from '../entity/entity.storage';\nimport { Item } from '../item/item';\nimport { RequestSender } from '../utility/request.sender';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tentityStorage: EntityStorage,\n\tfilterService: Filter,\n\tuserId: number,\n\tgroupId: number\n}\n\nexport class PullCounters\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.entityStorage = params.entityStorage;\n\t\tthis.filterService = params.filterService;\n\t\tthis.userId = params.userId;\n\t\tthis.groupId = params.groupId;\n\t}\n\n\tgetModuleId(): string\n\t{\n\t\treturn 'tasks';\n\t}\n\n\tgetMap(): Object\n\t{\n\t\treturn {\n\t\t\tcomment_add: this.onCommentAdd.bind(this),\n\t\t\ttask_view: this.onTaskView.bind(this),\n\t\t\tscrum_read_all: this.onCommentsReadAll.bind(this),\n\t\t};\n\t}\n\n\tonCommentAdd(data): void\n\t{\n\t\tconst inputTaskId = parseInt(data.taskId, 10);\n\t\tconst ownerUserId = parseInt(data.ownerId, 10);\n\n\t\tif (ownerUserId === this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#updateCurrentState(this.#getItem(inputTaskId));\n\t}\n\n\tonTaskView(data)\n\t{\n\t\tconst inputTaskId = parseInt(data.TASK_ID, 10);\n\t\tconst inputUserId = parseInt(data.USER_ID, 10);\n\n\t\tif (inputUserId !== this.userId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#updateCurrentState(this.#getItem(inputTaskId));\n\t}\n\n\tonCommentsReadAll(data)\n\t{\n\t\tconst groupId = data.GROUP_ID;\n\n\t\tif (groupId && groupId === this.groupId)\n\t\t{\n\t\t\tthis.filterService.applyFilter();\n\t\t}\n\t}\n\n\t#getItem(inputTaskId: number): ?Item\n\t{\n\t\tlet item = this.entityStorage.findItemBySourceId(inputTaskId);\n\t\tif (!item)\n\t\t{\n\t\t\titem = this.entityStorage.findItemBySourceInFilteredCompletedSprints(inputTaskId);\n\t\t}\n\n\t\treturn item;\n\t}\n\n\t#updateCurrentState(item: ?Item): void\n\t{\n\t\tif (!item)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.requestSender.getCurrentState({\n\t\t\ttaskId: item.getSourceId(),\n\t\t}).then((response) => {\n\t\t\titem.updateYourself(Item.buildItem(response.data.itemData));\n\t\t}).catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n}\n","import {Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {PULL as Pull} from 'pull.client';\n\nimport {Filter} from '../service/filter';\n\nimport {EntityStorage} from '../entity/entity.storage';\n\nimport {RequestSender} from '../utility/request.sender';\n\nimport {PullCounters} from '../pull/pull.counters';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tentityStorage: EntityStorage,\n\tfilter: Filter,\n\tisOwnerCurrentUser: boolean,\n\tuserId: number,\n\tgroupId: number\n}\n\nexport class TaskCounters\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.entityStorage = params.entityStorage;\n\t\tthis.filterService = params.filter;\n\n\t\tthis.isOwnerCurrentUser = params.isOwnerCurrentUser;\n\n\t\tthis.userId = parseInt(params.userId, 10);\n\t\tthis.groupId = parseInt(params.groupId, 10);\n\n\t\tthis.filter = this.filterService.getFilterManager();\n\n\t\tthis.updateFields();\n\t\tthis.bindEvents();\n\t\tthis.subscribeToPull();\n\t}\n\n\tbindEvents()\n\t{\n\t\tEventEmitter.subscribe('BX.Main.Filter:apply', this.onFilterApply.bind(this));\n\t\tEventEmitter.subscribe('Tasks.Toolbar:onItem', this.onCounterClick.bind(this));\n\t}\n\n\tsubscribeToPull()\n\t{\n\t\tPull.subscribe(new PullCounters({\n\t\t\trequestSender: this.requestSender,\n\t\t\tentityStorage: this.entityStorage,\n\t\t\tfilterService: this.filterService,\n\t\t\tuserId: this.userId,\n\t\t\tgroupId: this.groupId\n\t\t}));\n\t}\n\n\tonFilterApply()\n\t{\n\t\tthis.updateFields();\n\t}\n\n\tupdateFields()\n\t{\n\t\tthis.fields = this.filter.getFilterFieldsValues();\n\t}\n\n\tonCounterClick(baseEvent: BaseEvent)\n\t{\n\t\tconst data = baseEvent.getData();\n\n\t\tif (data.counter && data.counter.filter)\n\t\t{\n\t\t\tthis.toggleByField({[data.counter.filterField]: data.counter.filterValue});\n\t\t}\n\t}\n\n\tisFilteredByField(field)\n\t{\n\t\tif (!Object.keys(this.fields).includes(field))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (Type.isArray(this.fields[field]))\n\t\t{\n\t\t\treturn this.fields[field].length > 0;\n\t\t}\n\n\t\treturn this.fields[field] !== '';\n\t}\n\n\tisFilteredByFieldValue(field, value)\n\t{\n\t\treturn this.isFilteredByField(field) && this.fields[field] === value;\n\t}\n\n\ttoggleByField(field)\n\t{\n\t\tconst name = Object.keys(field)[0];\n\t\tconst value = field[name];\n\n\t\tif (!this.isFilteredByFieldValue(name, value))\n\t\t{\n\t\t\tthis.filter.getApi().extendFilter({[name]: value});\n\t\t\treturn;\n\t\t}\n\n\t\tthis.filter.getFilterFields().forEach((field) => {\n\t\t\tif (field.getAttribute('data-name') === name)\n\t\t\t{\n\t\t\t\tthis.filter.getFields().deleteField(field);\n\t\t\t}\n\t\t});\n\n\t\tthis.filter.getSearch().apply();\n\t}\n}","import {Type, Dom} from 'main.core';\nimport {Loader} from 'main.loader';\nimport {BaseEvent} from 'main.core.events';\n\nimport {Filter} from '../service/filter';\n\nimport {PlanBuilder} from '../view/plan/plan.builder';\n\nimport {Entity} from '../entity/entity';\nimport {EntityStorage} from '../entity/entity.storage';\nimport {Sprint, SprintParams} from '../entity/sprint/sprint';\n\nimport {RequestSender} from './request.sender';\n\nimport {Item, ItemParams} from '../item/item';\n\ntype Params = {\n\tfilter: Filter,\n\trequestSender: RequestSender,\n\tentityStorage: EntityStorage,\n\tplanBuilder: PlanBuilder,\n\tpageSize: number\n}\n\ntype ApplyFilterResponse = {\n\tdata: {\n\t\tisExactSearchApplied: 'Y' | 'N',\n\t\tcompletedSprints: Array<SprintParams>,\n\t\titems: Array<ItemParams>\n\t}\n}\n\nexport class FilterHandler\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.filter = params.filter;\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.entityStorage = params.entityStorage;\n\t\tthis.planBuilder = params.planBuilder;\n\t\tthis.pageSize = params.pageSize;\n\n\t\tthis.filter.subscribe('applyFilter', this.onApplyFilter.bind(this));\n\t}\n\n\tonApplyFilter(baseEvent: BaseEvent)\n\t{\n\t\tthis.fadeOutAll();\n\n\t\tconst containerPosition = Dom.getPosition(this.planBuilder.getScrumContainer());\n\n\t\tconst loader = new Loader({\n\t\t\ttarget: this.planBuilder.getScrumContainer(),\n\t\t\toffset: {\n\t\t\t\ttop: `${containerPosition.top / 2}px`\n\t\t\t}\n\t\t});\n\n\t\tloader.show();\n\n\t\tthis.requestSender.applyFilter({\n\t\t\tpageSize: this.pageSize\n\t\t}).then((response: ApplyFilterResponse) => {\n\n\t\t\tconst filteredItemsData = response.data.items;\n\n\t\t\tthis.entityStorage.getAllItems().forEach((item: Item) => {\n\t\t\t\tconst entity = this.entityStorage.findEntityByEntityId(item.getEntityId());\n\t\t\t\tentity.removeItem(item);\n\t\t\t\tif (item.isShownSubTasks())\n\t\t\t\t{\n\t\t\t\t\titem.hideSubTasks();\n\t\t\t\t}\n\t\t\t\titem.removeYourself();\n\t\t\t});\n\n\t\t\tconst completedSprints = new Map();\n\n\t\t\tfilteredItemsData.forEach((itemParams: ItemParams) => {\n\t\t\t\tconst item = Item.buildItem(itemParams);\n\t\t\t\tconst entity = this.entityStorage.findEntityByEntityId(item.getEntityId());\n\t\t\t\tif (response.data.completedSprints.length)\n\t\t\t\t{\n\t\t\t\t\tresponse.data.completedSprints\n\t\t\t\t\t\t.forEach((sprintParams: SprintParams) => {\n\t\t\t\t\t\t\tif (item.getEntityId() === sprintParams.id)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (completedSprints.has(item.getEntityId()))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcompletedSprints.get(item.getEntityId()).setItem(item);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tconst completedSprint = Sprint.buildSprint(sprintParams);\n\t\t\t\t\t\t\t\t\tcompletedSprint.setItem(item);\n\t\t\t\t\t\t\t\t\tcompletedSprint.setShortView('Y');\n\n\t\t\t\t\t\t\t\t\tcompletedSprints.set(completedSprint.getId(), completedSprint);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t}\n\n\t\t\t\tif (entity && !entity.isCompleted())\n\t\t\t\t{\n\t\t\t\t\titem.setShortView(entity.getShortView());\n\n\t\t\t\t\tentity.appendItemToList(item);\n\t\t\t\t\tentity.setItem(item);\n\n\t\t\t\t\tthis.planBuilder.clearLoadItemsRepeatCounter();\n\n\t\t\t\t\tentity.setActiveLoadItems(false);\n\t\t\t\t\tentity.bindItemsLoader();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst isExactSearchApplied = response.data.isExactSearchApplied === 'Y';\n\n\t\t\tthis.entityStorage.getAllEntities()\n\t\t\t\t.forEach((entity: Entity) => {\n\t\t\t\t\tentity.setExactSearchApplied(response.data.isExactSearchApplied);\n\t\t\t\t\tif (!entity.isCompleted() && entity.isEmpty())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (entity.getNumberTasks() > 0 && entity.isExactSearchApplied())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tentity.showEmptySearchStub();\n\t\t\t\t\t\t\tentity.hideDropzone();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.entityStorage.existsAtLeastOneItem())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tentity.showDropzone();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tentity.hideEmptySearchStub();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!entity.isBacklog() && !entity.isCompleted())\n\t\t\t\t\t{\n\t\t\t\t\t\tentity.setPageNumberItems(Math.ceil((entity.getNumberItems() / entity.getPageSize())));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\n\t\t\tthis.planBuilder.hideEmptySearchStub();\n\n\t\t\tif (completedSprints.size)\n\t\t\t{\n\t\t\t\tthis.planBuilder.showFilteredCompletedSprints(completedSprints);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.planBuilder.hideFilteredCompletedSprints();\n\n\t\t\t\tif (isExactSearchApplied)\n\t\t\t\t{\n\t\t\t\t\tthis.planBuilder.showEmptySearchStub();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.fadeInAll();\n\n\t\t\tloader.hide();\n\t\t}).catch((response) => {\n\n\t\t\tthis.fadeInAll();\n\n\t\t\tloader.hide();\n\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tfadeOutAll()\n\t{\n\t\tthis.entityStorage.getBacklog().fadeOut();\n\n\t\tthis.entityStorage.getSprints().forEach((sprint: Sprint) => {\n\t\t\tif (!sprint.isCompleted())\n\t\t\t{\n\t\t\t\tsprint.fadeOut();\n\t\t\t}\n\t\t});\n\t}\n\n\tfadeInAll()\n\t{\n\t\tthis.entityStorage.getBacklog().fadeIn();\n\n\t\tthis.entityStorage.getSprints().forEach((sprint: Sprint) => {\n\t\t\tif (!sprint.isCompleted())\n\t\t\t{\n\t\t\t\tsprint.fadeIn();\n\t\t\t}\n\t\t});\n\t}\n}","import {Item} from '../item/item';\n\ntype Params = {\n\tparentItem: Item\n}\n\nexport class Decomposition\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.parentItem = params.parentItem;\n\n\t\tthis.count = 1;\n\t}\n\n\tgetParentItem(): Item\n\t{\n\t\treturn this.parentItem;\n\t}\n\n\taddNumberDecompositionsPerformed()\n\t{\n\t\tthis.count++;\n\t}\n\n\tgetNumberDecompositionsPerformed(): number\n\t{\n\t\treturn this.count;\n\t}\n}\n","import { Filter } from '../service/filter';\n\nimport { EntityStorage } from '../entity/entity.storage';\n\nimport { RequestSender } from '../utility/request.sender';\n\ntype Params = {\n\trequestSender: RequestSender,\n\tentityStorage: EntityStorage,\n\tgroupId: number\n}\n\ntype PushParams = {\n\toldTagName: string,\n\tnewTagName: string,\n\tgroupId: number,\n\toldTagsNames: Array,\n}\n\nexport class PullTag\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.requestSender = params.requestSender;\n\t\tthis.entityStorage = params.entityStorage;\n\t\tthis.groupId = params.groupId;\n\t}\n\n\tgetModuleId()\n\t{\n\t\treturn 'tasks';\n\t}\n\n\tgetMap()\n\t{\n\t\treturn {\n\t\t\ttag_changed: this.onTagChanged.bind(this),\n\t\t};\n\t}\n\n\tonTagChanged(params: PushParams)\n\t{\n\t\tlet tagDialogs = BX.UI.EntitySelector.Dialog.getInstances();\n\t\ttagDialogs.forEach(dialog => {\n\t\t\tdialog.hide();\n\t\t});\n\t\tif (parseInt(this.groupId, 10) !== params.groupId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.entityStorage.getBacklog().fadeOut();\n\n\t\tconst updatedTags = params.oldTagsNames;\n\t\tlet updatedTag = params.oldTagName;\n\t\tconst newTag = params.newTagName;\n\n\t\tconst items = this.entityStorage.getAllItems();\n\t\tconst itemsToUpdate = new Set();\n\t\titems.forEach((item: Item) => {\n\t\t\tconst tags = item.getTags().getValue();\n\t\t\tif (tags.find((tag: string) => tag === updatedTag))\n\t\t\t{\n\t\t\t\titemsToUpdate.add(item);\n\t\t\t}\n\t\t\tif (updatedTags)\n\t\t\t{\n\t\t\t\tupdatedTags.forEach(tag => {\n\t\t\t\t\tlet updatedTagFromArray = tag;\n\t\t\t\t\tif (tags.find((tag: string) => tag === updatedTagFromArray))\n\t\t\t\t\t{\n\t\t\t\t\t\titemsToUpdate.add(item);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t});\n\t\titemsToUpdate.forEach((item: Item) => {\n\t\t\tconst currentTags = item.getTags().getValue();\n\t\t\tcurrentTags.forEach((tag, index, array) => {\n\t\t\t\tif (updatedTags &&updatedTags.length !== 0 && updatedTags.find((tagInArr: string) => tag === tagInArr))\n\t\t\t\t{\n\t\t\t\t\tarray[index] = newTag;\n\t\t\t\t}\n\t\t\t\telse if (tag === updatedTag)\n\t\t\t\t{\n\t\t\t\t\tarray[index] = newTag;\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst newTags = [];\n\t\t\tcurrentTags.forEach(tag => {\n\t\t\t\tif (tag !== '')\n\t\t\t\t{\n\t\t\t\t\tnewTags.push(tag);\n\t\t\t\t}\n\t\t\t});\n\t\t\titem.setTags(newTags);\n\t\t});\n\t\tsetTimeout(() => {\n\t\t\tthis.entityStorage.getBacklog().fadeIn();\n\t\t}, 1000);\n\n\t}\n\n}","import {Type, Loc, Dom, ajax as Ajax} from 'main.core';\nimport {BaseEvent} from 'main.core.events';\nimport {Loader} from 'main.loader';\nimport {Menu} from 'main.popup';\n\nimport {MessageBox} from 'ui.dialogs.messagebox';\n\nimport {ShortView} from 'ui.short-view';\n\nimport {DiskManager} from '../../service/disk.manager';\n\nimport {View, Views} from '../view';\n\nimport {PlanBuilder} from './plan.builder';\n\nimport {Entity} from '../../entity/entity';\nimport {ActionPanel} from '../../entity/action.panel';\nimport {EntityStorage} from '../../entity/entity.storage';\nimport {SearchItems} from '../../entity/search.items';\nimport {Backlog, BacklogParams} from '../../entity/backlog/backlog';\nimport {Header as BacklogHeader} from '../../entity/backlog/header';\nimport {Sprint, SprintParams} from '../../entity/sprint/sprint';\nimport {SprintMover} from '../../entity/sprint/sprint.mover';\nimport {SprintSidePanel} from '../../entity/sprint/sprint.side.panel';\n\nimport {Item, ItemParams} from '../../item/item';\nimport {SubTasks} from '../../item/task/sub.tasks';\nimport {ItemMover} from '../../item/item.mover';\nimport {ItemDesigner} from '../../item/item.designer';\n\nimport {Epic} from '../../epic/epic';\n\nimport {PULL as Pull} from 'pull.client';\n\nimport {PullSprint} from '../../pull/pull.sprint';\nimport {PullItem} from '../../pull/pull.item';\nimport {PullEpic} from '../../pull/pull.epic';\n\nimport {TaskCounters} from '../../counters/task.counters';\nimport {EntityCounters} from '../../counters/entity.counters';\n\nimport {FilterHandler} from '../../utility/filter.handler';\nimport {Input} from '../../utility/input';\nimport {TagSearcher} from '../../utility/tag.searcher';\nimport {Decomposition} from '../../utility/decomposition';\nimport {Tool} from '../../utility/tool';\n\nimport type {EpicType} from '../../item/task/epic';\nimport type {ResponsibleType} from '../../item/task/responsible';\n\nimport type {ShowLinkedTasksResponse} from '../../response';\nimport { PullTag } from '../../pull/pull.tag';\n\ntype Params = {\n\tpathToTask: string,\n\tpathToTaskCreate: string,\n\tpathToBurnDown: string,\n\tdefaultSprintDuration: number,\n\tactiveSprintId: number,\n\tbacklog: BacklogParams,\n\tsprints: Array<SprintParams>,\n\tviews: Views,\n\tdefaultResponsible: ResponsibleType,\n\tpageSize: number,\n\tisShortView: 'Y' | 'N',\n\tdisplayPriority: string,\n\tmandatoryExists: 'Y' | 'N',\n\tisExactSearchApplied: 'Y' | 'N'\n}\n\nexport class Plan extends View\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.Plan');\n\n\t\tthis.pathToTask = params.pathToTask;\n\t\tthis.pathToTaskCreate = params.pathToTaskCreate;\n\t\tthis.pathToBurnDown = params.pathToBurnDown;\n\t\tthis.mandatoryExists = params.mandatoryExists === 'Y';\n\t\tthis.defaultResponsible = params.defaultResponsible;\n\t\tthis.pageSize = parseInt(params.pageSize, 10);\n\t\tthis.activeSprintId = parseInt(params.activeSprintId, 10);\n\t\tthis.views = params.views;\n\t\tthis.isShortView = params.isShortView;\n\t\tthis.displayPriority = params.displayPriority;\n\t\tthis.isExactSearchApplied = params.isExactSearchApplied;\n\n\t\tthis.entityStorage = new EntityStorage();\n\t\tthis.entityStorage.addBacklog(Backlog.buildBacklog(params.backlog));\n\t\tparams.sprints.forEach((sprintData) => {\n\t\t\tsprintData.defaultSprintDuration = params.defaultSprintDuration;\n\t\t\tsprintData.isShortView = params.isShortView;\n\t\t\tconst sprint = Sprint.buildSprint(sprintData);\n\t\t\tthis.entityStorage.addSprint(sprint);\n\t\t});\n\n\t\tthis.entityCounters = new EntityCounters({\n\t\t\trequestSender: this.requestSender,\n\t\t\tentityStorage: this.entityStorage\n\t\t});\n\n\t\tthis.taskCounters = new TaskCounters({\n\t\t\trequestSender: this.requestSender,\n\t\t\tentityStorage: this.entityStorage,\n\t\t\tfilter: this.filter,\n\t\t\tuserId: params.userId,\n\t\t\tgroupId: params.groupId,\n\t\t\tisOwnerCurrentUser: params.isOwnerCurrentUser\n\t\t});\n\n\t\tthis.tagSearcher = new TagSearcher({\n\t\t\trequestSender: this.requestSender,\n\t\t\tfilter: this.filter,\n\t\t\tgroupId: params.groupId,\n\t\t\ttagsAreConverting: params.tagsAreConverting,\n\t\t});\n\n\t\tthis.planBuilder = new PlanBuilder({\n\t\t\trequestSender: this.requestSender,\n\t\t\tentityStorage: this.entityStorage,\n\t\t\tdefaultSprintDuration: params.defaultSprintDuration,\n\t\t\tpageNumberToCompletedSprints: params.pageNumberToCompletedSprints,\n\t\t\tdisplayPriority: params.displayPriority,\n\t\t\tisShortView: params.isShortView,\n\t\t\tmandatoryExists: params.mandatoryExists,\n\t\t\tisExactSearchApplied: params.isExactSearchApplied,\n\t\t\tpageSize: this.pageSize\n\t\t});\n\t\tthis.planBuilder.subscribe('beforeCreateSprint', (baseEvent: BaseEvent) => {\n\t\t\tconst requestData = baseEvent.getData();\n\t\t\tthis.pullSprint.addTmpIdToSkipAdding(requestData.tmpId);\n\t\t});\n\t\tthis.planBuilder.subscribe(\n\t\t\t'createSprint',\n\t\t\t(baseEvent: BaseEvent) => {\n\t\t\t\tconst sprint: Sprint = baseEvent.getData();\n\t\t\t\tthis.subscribeToSprint(sprint);\n\t\t\t\tthis.itemMover.addSprintContainers(sprint);\n\t\t\t}\n\t\t);\n\t\tthis.planBuilder.subscribe(\n\t\t\t'createSprintNode',\n\t\t\t(baseEvent: BaseEvent) => {\n\t\t\t\tconst sprint: Sprint = baseEvent.getData();\n\t\t\t\tthis.subscribeToSprint(sprint);\n\t\t\t\tthis.itemMover.addSprintContainers(sprint);\n\t\t\t}\n\t\t);\n\t\tthis.planBuilder.subscribe('sprintsScroll', this.onActionPanelScroll.bind(this));\n\n\t\tthis.searchItems = new SearchItems({\n\t\t\tplanBuilder: this.planBuilder,\n\t\t\tentityStorage: this.entityStorage\n\t\t});\n\n\t\tthis.sprintMover = new SprintMover({\n\t\t\trequestSender: this.requestSender,\n\t\t\tplanBuilder: this.planBuilder,\n\t\t\tentityStorage: this.entityStorage\n\t\t});\n\n\t\tthis.itemMover = new ItemMover({\n\t\t\trequestSender: this.requestSender,\n\t\t\tplanBuilder: this.planBuilder,\n\t\t\tentityStorage: this.entityStorage,\n\t\t\tentityCounters: this.entityCounters\n\t\t});\n\n\t\tthis.itemDesigner = new ItemDesigner({\n\t\t\trequestSender: this.requestSender,\n\t\t\tentityStorage: this.entityStorage\n\t\t});\n\n\t\tthis.filterHandler = new FilterHandler({\n\t\t\tfilter: this.filter,\n\t\t\trequestSender: this.requestSender,\n\t\t\tentityStorage: this.entityStorage,\n\t\t\tplanBuilder: this.planBuilder,\n\t\t\tpageSize: this.pageSize\n\t\t});\n\n\t\tthis.epic = new Epic({\n\t\t\tgroupId: this.groupId,\n\t\t\tsidePanel: this.sidePanel,\n\t\t\tentityStorage: this.entityStorage,\n\t\t\tfilter: this.filter,\n\t\t\ttagSearcher: this.tagSearcher\n\t\t});\n\t\tthis.pullTag = new PullTag({\n\t\t\trequestSender: this.requestSender,\n\t\t\tentityStorage: this.entityStorage,\n\t\t\tgroupId: this.groupId\n\t\t});\n\t\tthis.pullSprint = new PullSprint({\n\t\t\trequestSender: this.requestSender,\n\t\t\tplanBuilder: this.planBuilder,\n\t\t\tentityStorage: this.entityStorage,\n\t\t\tgroupId: this.getCurrentGroupId()\n\t\t});\n\t\tthis.pullItem = new PullItem({\n\t\t\trequestSender: this.requestSender,\n\t\t\tentityStorage: this.entityStorage,\n\t\t\tentityCounters: this.entityCounters,\n\t\t\ttagSearcher: this.tagSearcher,\n\t\t\titemMover: this.itemMover,\n\t\t\tcurrentUserId: this.getCurrentUserId(),\n\t\t\tgroupId: this.getCurrentGroupId()\n\t\t});\n\t\tthis.pullEpic = new PullEpic({\n\t\t\trequestSender: this.requestSender,\n\t\t\tentityStorage: this.entityStorage,\n\t\t\tepic: this.epic,\n\t\t});\n\n\t\tthis.input = new Input();\n\t\tthis.input.subscribe('createTaskItem', this.onCreateTaskItem.bind(this));\n\t\tthis.input.subscribe('tagsSearchOpen', this.onTagsSearchOpen.bind(this));\n\t\tthis.input.subscribe('tagsSearchClose', this.onTagsSearchClose.bind(this));\n\t\tthis.input.subscribe('epicSearchOpen', this.onEpicSearchOpen.bind(this));\n\t\tthis.input.subscribe('epicSearchClose', this.onEpicSearchClose.bind(this));\n\t\tthis.input.subscribe('render', this.onRenderInput.bind(this));\n\t\tthis.input.subscribe('remove', this.onRemoveInput.bind(this));\n\n\t\tthis.actionPanel = null;\n\t\tthis.responsibleDialog = null;\n\n\t\tthis.bindHandlers();\n\n\t\tthis.subscribeToPull();\n\t}\n\n\trenderTo(container: HTMLElement)\n\t{\n\t\tsuper.renderTo(container);\n\n\t\tthis.planBuilder.renderTo(container);\n\t}\n\n\trenderRightElementsTo(container: HTMLElement)\n\t{\n\t\tsuper.renderRightElementsTo(container);\n\n\t\tconst shortView = new ShortView({\n\t\t\tisShortView: this.isShortView\n\t\t});\n\n\t\tshortView.renderTo(container);\n\t\tshortView.subscribe('change', this.onChangeShortView.bind(this));\n\t}\n\n\tsetDisplayPriority(value: string)\n\t{\n\t\tsuper.setDisplayPriority(value);\n\n\t\tthis.planBuilder.setWidthPriority(value);\n\n\t\tthis.requestSender.saveDisplayPriority({\n\t\t\tvalue: value\n\t\t})\n\t\t\t.then((response) => {})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tchangeShortView(isShortView: 'Y' | 'N')\n\t{\n\t\tsuper.changeShortView(isShortView);\n\n\t\tthis.planBuilder.setShortView(isShortView);\n\n\t\tthis.destroyActionPanel();\n\n\t\tconst entities = this.entityStorage.getAllEntities();\n\n\t\tentities\n\t\t\t.forEach((entity: Entity) => {\n\t\t\t\tif (!entity.isCompleted())\n\t\t\t\t{\n\t\t\t\t\tentity.deactivateGroupMode();\n\t\t\t\t\tentity.fadeOut();\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\n\t\tthis.requestSender.saveShortView({\n\t\t\tisShortView: isShortView,\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tentities\n\t\t\t\t\t.forEach((entity: Entity) => {\n\t\t\t\t\t\tif (!entity.isCompleted())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tentity.setShortView(isShortView);\n\t\t\t\t\t\t\tentity.adjustListItemsWidth();\n\t\t\t\t\t\t\tentity.fadeIn();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tentities\n\t\t\t\t\t.forEach((entity: Entity) => {\n\t\t\t\t\t\tif (!entity.isCompleted())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tentity.fadeIn();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t});\n\t}\n\n\tsubscribeToPull()\n\t{\n\t\tPull.subscribe(this.pullSprint);\n\t\tPull.subscribe(this.pullItem);\n\t\tPull.subscribe(this.pullEpic);\n\t\tPull.subscribe(this.pullTag);\n\t}\n\n\tbindHandlers()\n\t{\n\t\tthis.entityStorage.getBacklog().subscribe('showInput', this.onShowBacklogInput.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('openAddTaskForm', this.onOpenAddTaskForm.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('updateItem', this.onUpdateItem.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('showTask', this.onShowTask.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('destroyActionPanel', this.onDestroyActionPanel.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('changeTaskResponsible', this.onChangeTaskResponsible.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('onShowResponsibleDialog', this.onShowResponsibleDialog.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('openAddEpicForm', this.onOpenEpicForm.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('tagsSearchOpen', this.onTagsSearchOpen.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('tagsSearchClose', this.onTagsSearchClose.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('epicSearchOpen', this.onEpicSearchOpen.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('epicSearchClose', this.onEpicSearchClose.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('filterByEpic', this.onFilterByEpic.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('filterByTag', this.onFilterByTag.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('loadItems', (baseEvent: BaseEvent) => {\n\t\t\tconst entity: Entity = baseEvent.getTarget();\n\t\t\tthis.planBuilder.loadItems(entity);\n\t\t});\n\t\tthis.entityStorage.getBacklog().subscribe('toggleActionPanel', this.onToggleActionPanel.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('showLinked', this.onShowLinked.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('itemsScroll', this.onActionPanelScroll.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('showBlank', this.onShowBlank.bind(this));\n\t\tthis.entityStorage.getBacklog().subscribe('deactivateGroupMode', this.onDeactivateGroupMode.bind(this));\n\n\t\tthis.entityStorage.getSprints().forEach((sprint) => this.subscribeToSprint(sprint));\n\n\t\tthis.epic.subscribe('filterByTag', this.onFilterByTag.bind(this));\n\n\t\tthis.itemMover.subscribe('dragStart', () => {\n\t\t\tthis.destroyActionPanel();\n\t\t\tif (this.searchItems.isActive())\n\t\t\t{\n\t\t\t\tthis.searchItems.stop();\n\t\t\t}\n\t\t});\n\n\t\tdocument.onkeydown = this.onDocumentKeyDown.bind(this);\n\t\tdocument.onclick = this.onDocumentClick.bind(this);\n\t}\n\n\tsubscribeToSprint(sprint: Sprint)\n\t{\n\t\tsprint.subscribe('showInput', this.onShowSprintInput.bind(this));\n\t\tsprint.subscribe('createSprint', this.onCreateSprint.bind(this));\n\t\tsprint.subscribe('updateItem', this.onUpdateItem.bind(this));\n\t\tsprint.subscribe('getSubTasks', this.onGetSubTasks.bind(this));\n\t\tsprint.subscribe('showTask', this.onShowTask.bind(this));\n\t\tsprint.subscribe('destroyActionPanel', this.onDestroyActionPanel.bind(this));\n\t\tsprint.subscribe('startSprint', this.onStartSprint.bind(this));\n\t\tsprint.subscribe('completeSprint', this.onCompleteSprint.bind(this));\n\t\tsprint.subscribe('changeTaskResponsible', this.onChangeTaskResponsible.bind(this));\n\t\tsprint.subscribe('onShowResponsibleDialog', this.onShowResponsibleDialog.bind(this));\n\t\tsprint.subscribe('removeSprint', this.onRemoveSprint.bind(this));\n\t\tsprint.subscribe('changeSprintName', this.onChangeSprintName.bind(this));\n\t\tsprint.subscribe('changeSprintDeadline', this.onChangeSprintDeadline.bind(this));\n\t\tsprint.subscribe('tagsSearchOpen', this.onTagsSearchOpen.bind(this));\n\t\tsprint.subscribe('tagsSearchClose', this.onTagsSearchClose.bind(this));\n\t\tsprint.subscribe('epicSearchOpen', this.onEpicSearchOpen.bind(this));\n\t\tsprint.subscribe('epicSearchClose', this.onEpicSearchClose.bind(this));\n\t\tsprint.subscribe('filterByEpic', this.onFilterByEpic.bind(this));\n\t\tsprint.subscribe('filterByTag', this.onFilterByTag.bind(this));\n\t\tsprint.subscribe('getSprintCompletedItems', this.onGetSprintCompletedItems.bind(this));\n\t\tsprint.subscribe('showSprintBurnDownChart', this.onShowSprintBurnDownChart.bind(this));\n\t\tsprint.subscribe('showSprintCreateMenu', this.onOpenSprintAddMenu.bind(this));\n\t\tsprint.subscribe('loadItems', (baseEvent: BaseEvent) => {\n\t\t\tconst entity: Entity = baseEvent.getTarget();\n\t\t\tthis.planBuilder.loadItems(entity);\n\t\t});\n\t\tsprint.subscribe('toggleActionPanel', this.onToggleActionPanel.bind(this));\n\t\tsprint.subscribe('showLinked', this.onShowLinked.bind(this));\n\t\tsprint.subscribe('showDropzone', this.onShowDropZone.bind(this));\n\t\tsprint.subscribe('toggleVisibilityContent', this.onToggleVisibilityContent.bind(this));\n\t\tsprint.subscribe('deactivateGroupMode', this.onDeactivateGroupMode.bind(this));\n\t}\n\n\tshowErrorAlert(message: string)\n\t{\n\t\tMessageBox.alert(message, Loc.getMessage('TASKS_SCRUM_ERROR_TITLE_POPUP'));\n\t}\n\n\tonDocumentKeyDown(event)\n\t{\n\t\tevent = event || window.event;\n\n\t\tif (this.searchItems.isActive())\n\t\t{\n\t\t\tif (event.key === 'ArrowUp' || event.key === 'ArrowLeft')\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tthis.searchItems.moveToPrev();\n\t\t\t}\n\n\t\t\tif (event.key === 'ArrowDown' || event.key === 'ArrowRight')\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tthis.searchItems.moveToNext();\n\t\t\t}\n\t\t}\n\n\t\tif (event.key === 'Escape')\n\t\t{\n\t\t\tlet prevented = false;\n\n\t\t\tif (this.searchItems.isActive())\n\t\t\t{\n\t\t\t\tprevented = true;\n\n\t\t\t\tthis.searchItems.stop();\n\t\t\t}\n\n\t\t\tif (this.actionPanel)\n\t\t\t{\n\t\t\t\tprevented = true;\n\n\t\t\t\tthis.destroyActionPanel();\n\n\t\t\t\tthis.entityStorage.getAllEntities()\n\t\t\t\t\t.forEach((entity: Entity) => {\n\t\t\t\t\t\tentity.deactivateGroupMode();\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\n\t\t\tif (prevented)\n\t\t\t{\n\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t}\n\t\t}\n\t}\n\n\tonDocumentClick(event)\n\t{\n\t\tevent = event || window.event;\n\n\t\tif (this.searchItems.isActive() && !this.searchItems.isClickInside(event.target))\n\t\t{\n\t\t\tthis.searchItems.stop();\n\t\t}\n\n\t\tif (this.diskManager && !this.diskManager.isClickInside(event.target))\n\t\t{\n\t\t\tthis.diskManager.closeAttachmentMenu();\n\t\t\tthis.diskManager = null;\n\t\t}\n\t}\n\n\tonShowBacklogInput(baseEvent: BaseEvent)\n\t{\n\t\tconst backlog: Backlog = baseEvent.getTarget();\n\t\tconst header: ?BacklogHeader = baseEvent.getData();\n\n\t\tthis.showInput(backlog).then(() => {\n\t\t\tif (!Type.isPlainObject(header))\n\t\t\t{\n\t\t\t\theader.unLockTaskButton();\n\t\t\t}\n\t\t});\n\t}\n\n\tonShowSprintInput(baseEvent: BaseEvent)\n\t{\n\t\tconst sprint: Sprint = baseEvent.getTarget();\n\n\t\tif (sprint.isHideContent())\n\t\t{\n\t\t\tsprint.subscribeOnce('toggleVisibilityContent', this.showInput.bind(this, sprint));\n\t\t\tsprint.toggleVisibilityContent(sprint.getContentContainer());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showInput(sprint);\n\t\t}\n\t}\n\n\tonOpenAddTaskForm(baseEvent: BaseEvent)\n\t{\n\t\tconst header: ?BacklogHeader = baseEvent.getData();\n\n\t\tthis.sidePanel.subscribeOnce('onLoadSidePanel', () => {\n\t\t\tif (!Type.isPlainObject(header))\n\t\t\t{\n\t\t\t\theader.unLockTaskButton();\n\t\t\t}\n\t\t});\n\n\t\tconst path = BX.Uri.addParam(this.pathToTaskCreate.replace('#task_id#', 0), {\n\t\t\tta_sec: 'scrum',\n\t\t\tta_sub: 'list',\n\t\t\tta_el: 'create_button',\n\t\t});\n\n\t\tthis.sidePanel.openSidePanelByUrl(path);\n\t}\n\n\tonCreateSprint()\n\t{\n\t\tthis.planBuilder.createSprint();\n\t}\n\n\tonRenderInput(baseEvent: BaseEvent)\n\t{\n\t\tthis.deactivateDraggable();\n\n\t\tconst input: Input = baseEvent.getTarget();\n\n\t\tconst entity = input.getEntity();\n\n\t\tentity.hideBlank();\n\t\tentity.hideDropzone();\n\t\tentity.hideEmptySearchStub();\n\t}\n\n\tonRemoveInput(baseEvent: BaseEvent)\n\t{\n\t\tthis.activateDraggable();\n\n\t\tconst input: Input = baseEvent.getTarget();\n\n\t\tconst entity = input.getEntity();\n\n\t\tif (!input.isTaskCreated() && entity.isEmpty())\n\t\t{\n\t\t\tif (entity.isBacklog())\n\t\t\t{\n\t\t\t\tif (this.entityStorage.existsAtLeastOneItem())\n\t\t\t\t{\n\t\t\t\t\tif (entity.isExactSearchApplied())\n\t\t\t\t\t{\n\t\t\t\t\t\tentity.showEmptySearchStub();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tentity.showDropzone();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tentity.showBlank();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tif (entity.getNumberTasks() > 0 && entity.isExactSearchApplied())\n\t\t\t\t{\n\t\t\t\t\tentity.showEmptySearchStub();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tentity.showDropzone();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tif (this.decomposition)\n\t\t{\n\t\t\tthis.decomposition.getParentItem().deactivateDecompositionMode();\n\t\t\tthis.decomposition = null;\n\t\t}\n\n\t\tentity.adjustListItemsWidth();\n\t}\n\n\tonCreateTaskItem(baseEvent: BaseEvent)\n\t{\n\t\tconst input: Input = baseEvent.getTarget();\n\n\t\tconst entity = input.getEntity();\n\n\t\tlet newItem: Item = null;\n\n\t\ttry\n\t\t{\n\t\t\tnewItem = this.createItem(input);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tthis.showErrorAlert(error.message);\n\n\t\t\tinput.removeYourself();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.decomposition)\n\t\t{\n\t\t\tconst parentItem: Item = this.decomposition.getParentItem();\n\n\t\t\tthis.pullItem.addIdToSkipUpdating(parentItem.getId());\n\n\t\t\tnewItem.setParentEntity(entity.getId(), entity.getEntityType());\n\t\t\tnewItem.setParentTaskId(parentItem.getSourceId());\n\t\t\tnewItem.setEpic(parentItem.getEpic().getValue());\n\t\t\tnewItem.setTags(parentItem.getTags().getValue());\n\t\t\tnewItem.setResponsible(parentItem.getResponsible().getValue());\n\n\t\t\tif (entity.isBacklog())\n\t\t\t{\n\t\t\t\tparentItem.setLinkedTask('Y');\n\t\t\t\tparentItem.updateBorderColor();\n\n\t\t\t\tnewItem.setLinkedTask('Y');\n\t\t\t\tnewItem.setBorderColor(parentItem.getBorderColor());\n\t\t\t\tnewItem.setSort(parentItem.getSort() + this.decomposition.getNumberDecompositionsPerformed());\n\n\t\t\t\tDom.insertBefore(newItem.render(), input.getNode());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tnewItem.setSubTask('Y');\n\t\t\t\tnewItem.setSort(parentItem.getSort() + (parentItem.getSubTasksCount() + 1));\n\t\t\t\tnewItem.setParentTaskId(parentItem.getSourceId());\n\t\t\t\tnewItem.setParentTask('N');\n\t\t\t}\n\n\t\t\tthis.decomposition.addNumberDecompositionsPerformed();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tnewItem.setEpic(input.getEpic());\n\n\t\t\tinput.setEpic(null);\n\n\t\t\tnewItem.setParentEntity(entity.getId(), entity.getEntityType());\n\t\t\tnewItem.setSort(1);\n\t\t\tnewItem.setResponsible(this.defaultResponsible);\n\n\t\t\tif (entity.isEmpty())\n\t\t\t{\n\t\t\t\tDom.insertBefore(newItem.render(), entity.getLoaderNode());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.insertBefore(newItem.render(), entity.getFirstItemNode(this.input));\n\t\t\t}\n\t\t}\n\n\t\tthis.pullItem.addTmpIdToSkipAdding(newItem.getId());\n\t\tthis.pullItem.addTmpIdToSkipSorting(newItem.getId());\n\n\t\tthis.sendRequestToCreateTask(entity, newItem).then((response) => {\n\n\t\t\tthis.fillItemAfterCreation(newItem, response.data);\n\n\t\t\tentity.setItem(newItem);\n\n\t\t\tthis.updateEntityCounters(entity);\n\n\t\t\tif (this.decomposition)\n\t\t\t{\n\t\t\t\tconst parentItem: Item = this.decomposition.getParentItem();\n\n\t\t\t\tif (!entity.isBacklog())\n\t\t\t\t{\n\t\t\t\t\tconst subTasks = parentItem.getSubTasks();\n\n\t\t\t\t\tsubTasks.addTask(newItem);\n\n\t\t\t\t\tif (!subTasks.isShown())\n\t\t\t\t\t{\n\t\t\t\t\t\tentity.appendNodeAfterItem(subTasks.render(), parentItem.getNode());\n\t\t\t\t\t}\n\n\t\t\t\t\tconst subTaskInfo = {};\n\t\t\t\t\tsubTaskInfo[newItem.getSourceId()] = {\n\t\t\t\t\t\tsourceId: newItem.getSourceId(),\n\t\t\t\t\t\tcompleted: 'N',\n\t\t\t\t\t\tstoryPoints: ''\n\t\t\t\t\t};\n\n\t\t\t\t\tparentItem.setSubTasksInfo({...parentItem.getSubTasksInfo(), ...subTaskInfo})\n\t\t\t\t\tparentItem.setParentTask('Y');\n\n\t\t\t\t\tparentItem.showSubTasks();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tinput.unDisable();\n\t\t\tinput.focus();\n\n\t\t\tentity.adjustListItemsWidth();\n\t\t\tthis.planBuilder.adjustSprintListWidth();\n\t\t}).catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tonUpdateItem(baseEvent: BaseEvent)\n\t{\n\t\tconst entity = baseEvent.getTarget();\n\t\tconst updateData = baseEvent.getData();\n\n\t\tthis.pullItem.addIdToSkipUpdating(updateData.itemId);\n\n\t\tthis.requestSender.updateItem(baseEvent.getData())\n\t\t\t.then(() => {\n\t\t\t\tconst isStoryPointsUpdated = (!Type.isUndefined(updateData.storyPoints));\n\t\t\t\tif (isStoryPointsUpdated)\n\t\t\t\t{\n\t\t\t\t\tthis.updateEntityCounters(entity);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tonGetSubTasks(baseEvent: BaseEvent)\n\t{\n\t\tconst sprint: Sprint = baseEvent.getTarget();\n\t\tconst subTasks: SubTasks = baseEvent.getData();\n\n\t\tsprint.appendNodeAfterItem(subTasks.render(), subTasks.getParentItem().getNode());\n\n\t\tthis.requestSender.getSubTaskItems({\n\t\t\tentityId: sprint.getId(),\n\t\t\ttaskId: subTasks.getParentItem().getSourceId()\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tresponse.data.forEach((itemParams: ItemParams) => {\n\t\t\t\t\tconst subTaskItem = Item.buildItem(itemParams);\n\t\t\t\t\tsprint.setItem(subTaskItem);\n\t\t\t\t\tsubTasks.addTask(subTaskItem);\n\t\t\t\t});\n\t\t\t\tsubTasks.getParentItem().showSubTasks();\n\t\t\t\tsprint.deactivateSubTaskLoading(subTasks.getParentItem());\n\t\t\t\tthis.planBuilder.adjustSprintListWidth();\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tonChangeTaskResponsible(baseEvent: BaseEvent)\n\t{\n\t\tconst item: Item = baseEvent.getData();\n\n\t\tthis.pullItem.addIdToSkipUpdating(item.getId());\n\n\t\tthis.requestSender.changeTaskResponsible({\n\t\t\titemId: item.getId(),\n\t\t\tsourceId: item.getSourceId(),\n\t\t\tresponsible: item.getResponsible().getValue(),\n\t\t}).catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tonShowResponsibleDialog(baseEvent: BaseEvent)\n\t{\n\t\tthis.responsibleDialog = baseEvent.getData();\n\t}\n\n\tonOpenEpicForm(baseEvent: BaseEvent)\n\t{\n\t\tconst header: BacklogHeader = baseEvent.getData();\n\n\t\tthis.epic.openAddForm().then(() => {\n\t\t\theader.unLockEpicButton();\n\t\t});\n\t}\n\n\tonStartSprint(baseEvent: BaseEvent)\n\t{\n\t\tconst sprint = baseEvent.getTarget();\n\n\t\tconst sprintSidePanel = new SprintSidePanel({\n\t\t\tsidePanel: this.sidePanel,\n\t\t\tgroupId: this.groupId,\n\t\t\tviews: this.views\n\t\t});\n\n\t\tsprintSidePanel.showStartForm(sprint);\n\t}\n\n\tonCompleteSprint()\n\t{\n\t\tconst sprintSidePanel = new SprintSidePanel({\n\t\t\tsidePanel: this.sidePanel,\n\t\t\tgroupId: this.groupId,\n\t\t\tviews: this.views,\n\t\t});\n\n\t\tsprintSidePanel.showCompletionForm();\n\n\t\tsprintSidePanel.subscribe('showTask', (innerBaseEvent: BaseEvent) => {\n\t\t\tconst path = BX.Uri.addParam(this.getPathToTask().replace('#task_id#', innerBaseEvent.getData()), {\n\t\t\t\tta_sec: 'scrum',\n\t\t\t\tta_sub: 'list',\n\t\t\t\tta_el: 'title_click',\n\t\t\t});\n\n\t\t\tthis.sidePanel.openSidePanelByUrl(path);\n\t\t});\n\t}\n\n\tonRemoveSprint(baseEvent: BaseEvent)\n\t{\n\t\tconst sprint: Sprint = baseEvent.getTarget();\n\n\t\tthis.pullSprint.addIdToSkipRemoving(sprint.getId());\n\n\t\tthis.requestSender.removeSprint({\n\t\t\tsprintId: sprint.getId(),\n\t\t\tsortInfo: this.sprintMover.calculateSprintSort()\n\t\t})\n\t\t.then(() => {\n\n\t\t\tif (!sprint.isEmpty())\n\t\t\t{\n\t\t\t\t[...sprint.getItems().values()]\n\t\t\t\t\t.map((item: Item) => {\n\t\t\t\t\t\tsprint.addItemToGroupMode(item);\n\t\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t\tthis.itemMover.moveToWithGroupMode(sprint, this.entityStorage.getBacklog(), null, false, false);\n\t\t\t}\n\n\t\t\tthis.destroyActionPanel();\n\n\t\t\tsprint.removeYourself();\n\n\t\t\tthis.entityStorage.removeSprint(sprint.getId());\n\n\t\t\tthis.planBuilder.adjustSprintListWidth();\n\t\t})\n\t\t.catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tonChangeSprintName(baseEvent: BaseEvent)\n\t{\n\t\tconst requestData = baseEvent.getData();\n\t\tthis.pullSprint.addIdToSkipUpdating(requestData.sprintId);\n\t\tthis.requestSender.changeSprintName(requestData).catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tonChangeSprintDeadline(baseEvent: BaseEvent)\n\t{\n\t\tconst sprint: Sprint = baseEvent.getTarget();\n\t\tconst requestData = baseEvent.getData();\n\n\t\tthis.pullSprint.addIdToSkipUpdating(requestData.sprintId);\n\t\tthis.requestSender.changeSprintDeadline(requestData)\n\t\t\t.then((response) => {\n\t\t\t\tconst sprintData = response.data;\n\t\t\t\tsprint.setDateStartFormatted(sprintData.dateStartFormatted);\n\t\t\t\tsprint.setDateEndFormatted(sprintData.dateEndFormatted);\n\t\t\t\tsprint.setDateStart(sprintData.dateStart);\n\t\t\t\tsprint.setDateEnd(sprintData.dateEnd);\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tonGetSprintCompletedItems(baseEvent: BaseEvent)\n\t{\n\t\tconst sprint = baseEvent.getTarget();\n\t\tconst listItemsNode = sprint.getListItemsNode();\n\t\tconst listPosition = Dom.getPosition(listItemsNode);\n\n\t\tDom.style(sprint.getContentContainer(), 'height', 'auto');\n\n\t\tconst loader = new Loader({\n\t\t\tsize: 60,\n\t\t\tmode: 'inline',\n\t\t\tcolor: '#eaeaea',\n\t\t\toffset: {\n\t\t\t\tleft: `${(listPosition.width / 2 - 30)}px`\n\t\t\t}\n\t\t});\n\n\t\tloader.show(); // todo promise wtf\n\n\t\tthis.requestSender.getSprintCompletedItems({\n\t\t\tsprintId: sprint.getId()\n\t\t}).then((response) => {\n\t\t\tloader.hide();\n\t\t\tif (response.data.length > 0)\n\t\t\t{\n\t\t\t\tresponse.data.forEach((itemParams: ItemParams) => {\n\t\t\t\t\tconst item = Item.buildItem(itemParams);\n\t\t\t\t\tif (!sprint.getItems().has(item.getId()))\n\t\t\t\t\t{\n\t\t\t\t\t\titem.setDisableStatus(sprint.isDisabled());\n\t\t\t\t\t\tif (item.isParentTask())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem.setToggle(false);\n\t\t\t\t\t\t\titem.setParentTask(false);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsprint.appendItemToList(item);\n\t\t\t\t\t\tsprint.setItem(item);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsprint.showBlank();\n\t\t\t}\n\t\t\tsprint.showContent(sprint.getContentContainer());\n\t\t}).catch((response) => {\n\t\t\tloader.hide();\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tonShowSprintBurnDownChart(baseEvent: BaseEvent)\n\t{\n\t\tconst sprint = baseEvent.getTarget();\n\n\t\tconst sprintSidePanel = new SprintSidePanel({\n\t\t\tsidePanel: this.sidePanel,\n\t\t\tgroupId: this.groupId,\n\t\t\tviews: this.views,\n\t\t\tpathToBurnDown: this.pathToBurnDown\n\t\t});\n\n\t\tsprintSidePanel.showBurnDownChart(sprint);\n\t}\n\n\tonOpenSprintAddMenu(baseEvent: BaseEvent)\n\t{\n\t\tconst entity = baseEvent.getTarget();\n\t\tconst button = baseEvent.getData().getNode();\n\n\t\tif (this.sprintAddMenu)\n\t\t{\n\t\t\tthis.sprintAddMenu.getPopupWindow().destroy();\n\t\t\tthis.sprintAddMenu = null;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst buttonRect = button.getBoundingClientRect();\n\n\t\tthis.sprintAddMenu = new Menu({\n\t\t\tid: 'tasks-scrum-sprint-add-menu',\n\t\t\tbindElement: button,\n\t\t\tcloseByEsc : true,\n\t\t\tangle: {\n\t\t\t\tposition: 'top',\n\t\t\t\toffset: 78\n\t\t\t},\n\t\t\toffsetLeft: buttonRect.width - 67\n\t\t});\n\n\t\tthis.sprintAddMenu.addMenuItem({\n\t\t\ttext: Loc.getMessage('TASKS_SCRUM_BACKLOG_SPRINT_FIRST_ADD'),\n\t\t\tonclick: (event, menuItem) => {\n\t\t\t\tthis.onShowSprintInput((new BaseEvent()).setTarget(entity));\n\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t}\n\t\t});\n\t\tthis.sprintAddMenu.addMenuItem({\n\t\t\ttext: Loc.getMessage('TASKS_SCRUM_BACKLOG_SPRINT_SECOND_ADD'),\n\t\t\tonclick: (event, menuItem) => {\n\t\t\t\tthis.planBuilder.createSprint();\n\t\t\t\tmenuItem.getMenuWindow().close();\n\t\t\t}\n\t\t});\n\n\t\tthis.sprintAddMenu.getPopupWindow().subscribe('onClose', () => {\n\t\t\tthis.sprintAddMenu.getPopupWindow().destroy();\n\t\t\tthis.sprintAddMenu = null;\n\t\t});\n\t\tthis.sprintAddMenu.getPopupWindow().subscribe('onShow', () => {\n\t\t\tconst angle = this.sprintAddMenu.getMenuContainer().querySelector('.popup-window-angly');\n\t\t\tDom.style(angle, 'pointerEvents', 'none');\n\t\t});\n\n\t\tthis.sprintAddMenu.show();\n\t}\n\n\tonShowTask(baseEvent: BaseEvent, element = 'title_click')\n\t{\n\t\tconst item = baseEvent.getData();\n\n\t\tconst path = BX.Uri.addParam(this.getPathToTask().replace('#task_id#', item.getSourceId()), {\n\t\t\tta_sec: 'scrum',\n\t\t\tta_sub: 'list',\n\t\t\tta_el: element,\n\t\t});\n\n\t\tthis.sidePanel.openSidePanelByUrl(path);\n\t}\n\n\tonDestroyActionPanel(baseEvent: BaseEvent)\n\t{\n\t\tconst item = baseEvent.getData();\n\n\t\tthis.destroyActionPanel();\n\n\t\t(this.entityStorage.findEntityByItemId(item.getId())).deactivateGroupMode();\n\t}\n\n\tonTagsSearchOpen(baseEvent: BaseEvent)\n\t{\n\t\tthis.tagSearcher.showTagsSearchDialog(this.input, baseEvent.getData());\n\t}\n\n\tonTagsSearchClose()\n\t{\n\t\tthis.tagSearcher.closeTagsSearchDialog();\n\t}\n\n\tonFilterByTag(baseEvent: BaseEvent)\n\t{\n\t\tconst tag = baseEvent.getData();\n\t\tconst currentValue = this.filter.getValueFromField({name: 'TAG', value: ''});\n\t\tconst newValue = (String(tag) === String(currentValue) ? [] : [String(tag)]);\n\n\t\tthis.filter.setValuesToField([\n\t\t\t{\n\t\t\t\tname: 'TAG',\n\t\t\t\tvalue: newValue,\n\t\t\t},\n\t\t\t{\n\t\t\t\tname: 'TAG_label',\n\t\t\t\tvalue: newValue,\n\t\t\t},\n\t\t]);\n\t\tthis.filter.scrollToSearchContainer();\n\t}\n\n\tonEpicSearchOpen(baseEvent: BaseEvent)\n\t{\n\t\tthis.tagSearcher.showEpicSearchDialog(this.input, baseEvent.getData());\n\t}\n\n\tonEpicSearchClose()\n\t{\n\t\tthis.tagSearcher.closeEpicSearchDialog();\n\t}\n\n\tonFilterByEpic(baseEvent: BaseEvent)\n\t{\n\t\tconst epicId = baseEvent.getData();\n\t\tconst currentValue = this.filter.getValueFromField({name: 'EPIC', value: ''});\n\n\t\tif (String(epicId) === String(currentValue))\n\t\t{\n\t\t\tthis.filter.setValueToField({name: 'EPIC', value: ''});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.filter.setValueToField({name: 'EPIC', value: String(epicId)});\n\t\t}\n\n\t\tthis.filter.scrollToSearchContainer();\n\t}\n\n\tonChangeShortView(baseEvent: BaseEvent)\n\t{\n\t\tconst isShortView = baseEvent.getData();\n\n\t\tthis.changeShortView(isShortView);\n\t}\n\n\tonToggleActionPanel(baseEvent: BaseEvent)\n\t{\n\t\tconst item = baseEvent.getData();\n\t\tconst entity = baseEvent.getTarget();\n\n\t\tif (this.actionPanel)\n\t\t{\n\t\t\tconst repeatedClick = (this.actionPanel.getItem().getId() === item.getId());\n\n\t\t\tthis.destroyActionPanel();\n\n\t\t\tif (repeatedClick || entity.hasItemInGroupMode(item))\n\t\t\t{\n\t\t\t\tthis.deactivateGroupMode(entity, item);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.activateGroupMode(entity, item);\n\n\t\tthis.showActionPanel(entity, item);\n\n\t\tif (this.searchItems.isActive())\n\t\t{\n\t\t\tthis.searchItems.updateCurrentIndexByItem(item);\n\t\t}\n\t}\n\n\tonShowLinked(baseEvent: BaseEvent)\n\t{\n\t\tconst baseItem = baseEvent.getData();\n\n\t\tif (this.searchItems.isActive())\n\t\t{\n\t\t\tthis.searchItems.stop();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.destroyActionPanel();\n\n\t\tconst containerPosition = Dom.getPosition(this.planBuilder.getScrumContainer());\n\n\t\twindow.scrollTo({ top: containerPosition.top, behavior: 'smooth' });\n\n\t\tconst loader = new Loader({\n\t\t\ttarget: this.planBuilder.getScrumContainer(),\n\t\t\toffset: {\n\t\t\t\ttop: `${containerPosition.top / 2}px`\n\t\t\t}\n\t\t});\n\n\t\tloader.show();\n\n\t\tthis.searchItems.deactivateGroupMode();\n\t\tthis.searchItems.fadeOutAll();\n\n\t\tthis.requestSender.showLinkedTasks({\n\t\t\ttaskId: baseItem.getSourceId(),\n\t\t})\n\t\t\t.then((response: ShowLinkedTasksResponse) => {\n\t\t\t\tconst itemsData: Array<ItemParams> = response.data;\n\n\t\t\t\tconst items = new Set();\n\t\t\t\tconst itemIds = [];\n\t\t\t\titemsData.forEach((itemParams: ItemParams) => {\n\t\t\t\t\tconst item = Item.buildItem(itemParams);\n\t\t\t\t\tconst entity = this.entityStorage.findEntityByEntityId(item.getEntityId());\n\t\t\t\t\tif (entity)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!entity.isCompleted() && !entity.hasItem(item))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\titem.setShortView(entity.getShortView());\n\t\t\t\t\t\t\tentity.appendItemToList(item);\n\t\t\t\t\t\t\tentity.setItem(item);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\titems.add(item);\n\t\t\t\t\t\titemIds.push(item.getId());\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.itemDesigner.updateBorderColor(items);\n\n\t\t\t\tif (items.size > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.searchItems.start(baseItem, itemIds);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.searchItems.fadeInAll();\n\t\t\t\t}\n\n\t\t\t\tloader.hide();\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\n\t\t\t\tloader.hide();\n\t\t\t})\n\t\t;\n\t}\n\n\tonActionPanelScroll()\n\t{\n\t\tif (this.actionPanel)\n\t\t{\n\t\t\tthis.actionPanel.calculatePanelTopPosition();\n\t\t}\n\n\t\tif (this.diskManager)\n\t\t{\n\t\t\tthis.diskManager.closeAttachmentMenu();\n\t\t\tthis.diskManager = null;\n\t\t}\n\n\t\tif (this.itemMover.hasActionPanelDialog())\n\t\t{\n\t\t\tthis.itemMover.closeActionPanelDialogs();\n\t\t}\n\n\t\tif (this.tagSearcher.hasActionPanelDialog())\n\t\t{\n\t\t\tthis.tagSearcher.closeActionPanelDialogs();\n\t\t}\n\n\t\tif (this.responsibleDialog && this.responsibleDialog.isOpen())\n\t\t{\n\t\t\tthis.responsibleDialog.hide();\n\t\t}\n\t}\n\n\tonShowBlank(baseEvent: BaseEvent)\n\t{\n\t\tconst backlog: Backlog = baseEvent.getTarget();\n\n\t\tsetTimeout(() => {\n\t\t\tif (!backlog.isEmpty())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.entityStorage.existsAtLeastOneItem())\n\t\t\t{\n\t\t\t\tif (backlog.isExactSearchApplied())\n\t\t\t\t{\n\t\t\t\t\tbacklog.showEmptySearchStub();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tbacklog.showDropzone();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tbacklog.showBlank();\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\tonDeactivateGroupMode(baseEvent: BaseEvent)\n\t{\n\t\tthis.destroyActionPanel();\n\t}\n\n\tonShowDropZone(baseEvent: BaseEvent)\n\t{\n\t\tconst sprint: Sprint = baseEvent.getTarget();\n\n\t\tsetTimeout(() => {\n\t\t\tif (!sprint.isEmpty())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (sprint.getNumberTasks() > 0 && sprint.isExactSearchApplied())\n\t\t\t{\n\t\t\t\tsprint.showEmptySearchStub();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsprint.showDropzone();\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\tonToggleVisibilityContent(baseEvent: BaseEvent)\n\t{\n\t\tconst sprint: Sprint = baseEvent.getTarget();\n\n\t\tthis.planBuilder.adjustSprintListWidth();\n\n\t\tif (!sprint.isCompleted())\n\t\t{\n\t\t\tthis.requestSender.saveSprintVisibility({\n\t\t\t\tsprintId: sprint.getId(),\n\t\t\t\tisHidden: sprint.isHideContent() ? 'Y' : 'N'\n\t\t\t});\n\t\t}\n\t}\n\n\tshowInput(entity: Entity, bindNode: ?HTMLElement): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.input.isExists())\n\t\t\t{\n\t\t\t\tthis.input.submit();\n\n\t\t\t\tif (this.input.hasEntity(entity))\n\t\t\t\t{\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.input.subscribeOnce('unDisable', () => {\n\t\t\t\t\t\tthis.input.removeYourself();\n\n\t\t\t\t\t\tthis.renderInput(entity, bindNode);\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.renderInput(entity, bindNode);\n\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\trenderInput(entity: Entity, bindNode: ?HTMLElement)\n\t{\n\t\tthis.input.setEntity(entity);\n\n\t\tif (Type.isElementNode(bindNode))\n\t\t{\n\t\t\tthis.input.setBindNode(bindNode);\n\n\t\t\tDom.insertAfter(this.input.render(), bindNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.input.cleanBindNode();\n\n\t\t\tif (entity.isEmpty())\n\t\t\t{\n\t\t\t\tDom.insertBefore(this.input.render(), entity.getLoaderNode());\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.insertBefore(this.input.render(), entity.getFirstItemNode(this.input));\n\t\t\t}\n\t\t}\n\n\t\tentity.adjustListItemsWidth();\n\n\t\tthis.input.focus();\n\n\t\tthis.scrollToInput();\n\t}\n\n\tscrollToInput()\n\t{\n\t\tconst entity: Entity = this.input.getEntity();\n\n\t\tif (entity.isBacklog())\n\t\t{\n\t\t\tconst scrollContainer = entity.getListItemsNode();\n\n\t\t\tconst topPosition = Dom.getRelativePosition(this.input.getInputNode(), scrollContainer).top;\n\n\t\t\tscrollContainer.scrollTo({\n\t\t\t\ttop: scrollContainer.scrollTop + topPosition - 100,\n\t\t\t\tbehavior: 'smooth'\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst sprintsContainer = this.planBuilder.getSprintsContainer()\n\n\t\t\tconst topPosition = Dom.getRelativePosition(this.input.getInputNode(), sprintsContainer).top;\n\n\t\t\tsprintsContainer.scrollTo({\n\t\t\t\ttop: sprintsContainer.scrollTop + topPosition - 100,\n\t\t\t\tbehavior: 'smooth'\n\t\t\t});\n\t\t}\n\t}\n\n\tshowActionPanel(entity: Entity, item: Item)\n\t{\n\t\tconst stopSearch = () => {\n\t\t\tif (this.searchItems.isActive())\n\t\t\t{\n\t\t\t\tthis.searchItems.stop();\n\t\t\t}\n\t\t}\n\n\t\tconst isMultipleAction = (entity.getGroupModeItems().size > 1);\n\n\t\t//todo maybe will cool move list actions to item scope\n\t\tthis.actionPanel = new ActionPanel({\n\t\t\tentity,\n\t\t\titem,\n\t\t\titemList: {\n\t\t\t\ttask: {\n\t\t\t\t\tactivity: true,\n\t\t\t\t\tdisable: isMultipleAction,\n\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\tthis.onShowTask(\n\t\t\t\t\t\t\tnew BaseEvent({\n\t\t\t\t\t\t\t\tdata: item,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t'context_menu',\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.destroyActionPanel();\n\t\t\t\t\t\tentity.deactivateGroupMode();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tattachment: {\n\t\t\t\t\tactivity: true,\n\t\t\t\t\tdisable : !item.isEditAllowed(),\n\t\t\t\t\tcallback: (event) => {\n\t\t\t\t\t\tif (this.diskManager)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.diskManager.closeAttachmentMenu();\n\t\t\t\t\t\t\tthis.diskManager = null;\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst groupItems = entity.getGroupModeItems();\n\t\t\t\t\t\tthis.diskManager = new DiskManager({\n\t\t\t\t\t\t\ttargetElement: event.currentTarget\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.diskManager.subscribe('onFinish', (baseEvent) => {\n\t\t\t\t\t\t\tthis.attachFilesToTask(entity, groupItems, baseEvent.getData());\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.diskManager.showAttachmentMenu(event.currentTarget);\n\t\t\t\t\t\tthis.actionPanel.subscribe('onDestroy', () => {\n\t\t\t\t\t\t\tif (this.diskManager)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.diskManager.closeAttachmentMenu();\n\t\t\t\t\t\t\t\tthis.diskManager = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdod: {\n\t\t\t\t\tactivity: true,\n\t\t\t\t\tdisable : isMultipleAction,\n\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\tthis.showDod(item);\n\t\t\t\t\t\tthis.destroyActionPanel();\n\t\t\t\t\t\tentity.deactivateGroupMode();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tmove: {\n\t\t\t\t\tactivity: true,\n\t\t\t\t\tdisable : (!item.isMovable()),\n\t\t\t\t\tcallback: (event) => {\n\t\t\t\t\t\tthis.moveItem(item, event.currentTarget);\n\t\t\t\t\t\tstopSearch();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tsprint: {\n\t\t\t\t\tactivity: true,\n\t\t\t\t\tdisable : false,\n\t\t\t\t\tmultiple : (this.entityStorage.getSprintsAvailableForFilling(entity).size > 1),\n\t\t\t\t\tcallback: (event) => {\n\t\t\t\t\t\tthis.moveToSprint(entity, item, event.currentTarget);\n\t\t\t\t\t\tstopSearch();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tbacklog: {\n\t\t\t\t\tactivity: true,\n\t\t\t\t\tdisable : (item.getEntityType() !== 'sprint'),\n\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\tthis.moveToBacklog(entity, item);\n\t\t\t\t\t\tthis.destroyActionPanel();\n\t\t\t\t\t\tstopSearch();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\ttags: {\n\t\t\t\t\tactivity: true,\n\t\t\t\t\tdisable : !item.isEditAllowed(),\n\t\t\t\t\tcallback: (event) => {\n\t\t\t\t\t\tif (this.tagSearcher.hasActionPanelDialog())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.tagSearcher.closeActionPanelDialogs();\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.showTagSearcher(entity, item, event.currentTarget);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tepic: {\n\t\t\t\t\tactivity: true,\n\t\t\t\t\tdisable : !item.isEditAllowed(),\n\t\t\t\t\tcallback: (event) => {\n\t\t\t\t\t\tif (this.tagSearcher.hasActionPanelDialog())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.tagSearcher.closeActionPanelDialogs();\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.showEpicSearcher(entity, item, event.currentTarget);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tdecomposition: {\n\t\t\t\t\tactivity: true,\n\t\t\t\t\tdisable : (isMultipleAction),\n\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\tif (entity.isBacklog())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.startBacklogDecomposition(entity, item);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.startSprintDecomposition(entity, item);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.destroyActionPanel();\n\t\t\t\t\t\tentity.deactivateGroupMode();\n\t\t\t\t\t\tstopSearch();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tremove: {\n\t\t\t\t\tactivity: true,\n\t\t\t\t\tdisable : (!item.isRemoveAllowed()),\n\t\t\t\t\tcallback: () => {\n\t\t\t\t\t\tMessageBox.confirm(\n\t\t\t\t\t\t\tLoc.getMessage('TASKS_SCRUM_CONFIRM_TEXT_REMOVE_TASKS'),\n\t\t\t\t\t\t\t(messageBox) => {\n\t\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\t\tthis.removeGroupItems(entity).then(() => {\n\t\t\t\t\t\t\t\t\tentity.getGroupModeItems().forEach((groupModeItem: Item) => {\n\t\t\t\t\t\t\t\t\t\tentity.removeItem(groupModeItem);\n\t\t\t\t\t\t\t\t\t\tthis.deactivateGroupMode(entity, groupModeItem);\n\t\t\t\t\t\t\t\t\t\tgroupModeItem.removeYourself();\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tthis.updateEntityCounters(entity);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tLoc.getMessage('TASKS_SCRUM_BUTTON_TEXT_REMOVE'),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.destroyActionPanel();\n\t\t\t\t\t\tstopSearch();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}\n\t\t});\n\n\t\tthis.actionPanel.subscribe('unSelect', () => {\n\t\t\tthis.destroyActionPanel();\n\t\t\tentity.deactivateGroupMode();\n\t\t});\n\n\t\tthis.actionPanel.show();\n\t}\n\n\tactivateDraggable()\n\t{\n\t\tthis.entityStorage.getAllItems().forEach((item: Item) => item.setDisableStatus(false));\n\t}\n\n\tdeactivateDraggable()\n\t{\n\t\tthis.entityStorage.getAllItems().forEach((item: Item) => item.setDisableStatus(true));\n\t}\n\n\tactivateGroupMode(entity: Entity, item?: Item)\n\t{\n\t\tif (item)\n\t\t{\n\t\t\tentity.addItemToGroupMode(item);\n\t\t}\n\n\t\tif (entity.isGroupMode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tentity.activateGroupMode();\n\n\t\tif (entity.getId() !== this.entityStorage.getBacklog().getId())\n\t\t{\n\t\t\tthis.entityStorage.getBacklog().deactivateGroupMode();\n\t\t}\n\t\tthis.entityStorage.getSprints().forEach((sprint) => {\n\t\t\tif (entity.getId() !== sprint.getId())\n\t\t\t{\n\t\t\t\tsprint.deactivateGroupMode();\n\t\t\t}\n\t\t});\n\t}\n\n\tdeactivateGroupMode(entity: Entity, item?: Item)\n\t{\n\t\tif (item)\n\t\t{\n\t\t\tentity.removeItemFromGroupMode(item);\n\t\t}\n\n\t\tif (!entity.isGroupMode())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst groupModeItems = entity.getGroupModeItems();\n\t\tif (groupModeItems.size === 0)\n\t\t{\n\t\t\tentity.deactivateGroupMode();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showActionPanel(entity, Array.from(groupModeItems.values()).pop());\n\t\t}\n\t}\n\n\tcreateItem(input: Input): Item\n\t{\n\t\tconst epic = input.getEpic();\n\n\t\tconst value = input.getInputNode().value.trim();\n\n\t\tconst valueWithoutEpic =\n\t\t\tepic\n\t\t\t\t? value.replace(new RegExp('@' + Tool.escapeRegex(epic.name) + '$', 'g'), '')\n\t\t\t\t: value\n\t\t;\n\n\t\tconst item = Item.buildItem({\n\t\t\tid: '',\n\t\t\tname: valueWithoutEpic,\n\t\t\tgroupId: this.getCurrentGroupId(),\n\t\t\tpathToTask: this.pathToTask\n\t\t});\n\n\t\titem.setShortView(this.isShortView);\n\n\t\treturn item;\n\t}\n\n\tsendRequestToCreateTask(entity: Entity, item: Item): Promise\n\t{\n\t\tconst requestData = {\n\t\t\t'tmpId': item.getId(),\n\t\t\t'name': item.getName().getValue(),\n\t\t\t'entityId': item.getEntityId(),\n\t\t\t'entityType': entity.getEntityType(),\n\t\t\t'epicId': item.getEpic().getValue().id,\n\t\t\t'sort': item.getSort(),\n\t\t\t'storyPoints': item.getStoryPoints().getValue().getPoints(),\n\t\t\t'parentTaskId': item.getParentTaskId(),\n\t\t\t'responsible': item.getResponsible().getValue(),\n\t\t\t'info': item.getInfo(),\n\t\t\t'sortInfo': this.itemMover.calculateSort(entity.getListItemsNode())\n\t\t};\n\t\treturn this.requestSender.createTask(requestData);\n\t}\n\n\tfillItemAfterCreation(item: Item, responseData: Object): Item\n\t{\n\t\titem.setId(responseData.id);\n\t\titem.setEpic(responseData.epic);\n\t\titem.setTags(responseData.tags);\n\t\titem.setResponsible(responseData.responsible);\n\t\titem.setSourceId(responseData.sourceId);\n\t\titem.setAllowedActions(responseData.allowedActions);\n\n\t\titem.setName(item.getName().getValue());\n\t}\n\n\tupdateEntityCounters(sourceEntity: Entity, endEntity?: Entity)\n\t{\n\t\tconst entities = new Map();\n\n\t\tentities.set(sourceEntity.getId(), sourceEntity);\n\t\tif (endEntity)\n\t\t{\n\t\t\tentities.set(endEntity.getId(), endEntity);\n\t\t}\n\n\t\tthis.entityCounters.updateCounters(entities);\n\t}\n\n\tdestroyActionPanel()\n\t{\n\t\tif (this.actionPanel)\n\t\t{\n\t\t\tthis.actionPanel.destroy();\n\t\t}\n\n\t\tthis.actionPanel = null;\n\t}\n\n\tgetActionPanel(): ?ActionPanel\n\t{\n\t\treturn this.actionPanel;\n\t}\n\n\tattachFilesToTask(entity: Entity, groupItems: Map<number, Item>, attachedIds: Array<string>)\n\t{\n\t\tif (attachedIds.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst itemIds = [];\n\n\t\tgroupItems.forEach((item: Item) => {\n\t\t\tthis.pullItem.addIdToSkipUpdating(item.getId());\n\n\t\t\titemIds.push(item.getId());\n\t\t});\n\n\t\tthis.requestSender.attachFilesToTask({\n\t\t\titemIds: itemIds,\n\t\t\tattachedIds: attachedIds,\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tgroupItems.forEach((item: Item) => {\n\t\t\t\t\titem.setFiles(response.data.attachedFilesCount[item.getId()]);\n\t\t\t\t});\n\t\t\t\tthis.destroyActionPanel();\n\t\t\t\tentity.deactivateGroupMode();\n\t\t\t})\n\t\t\t.catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t})\n\t\t;\n\t}\n\n\tshowDod(item: Item)\n\t{\n\t\tthis.sidePanel.showByExtension('Dod', {\n\t\t\tview: 'list',\n\t\t\tgroupId: this.groupId,\n\t\t\ttaskId: item.getSourceId(),\n\t\t\tskipNotifications: true\n\t\t});\n\t}\n\n\tmoveItem(item: Item, bindButton: HTMLElement)\n\t{\n\t\tthis.itemMover.moveItem(item, bindButton);\n\t}\n\n\tmoveToSprint(entityFrom: Entity, item: Item, bindButton: HTMLElement)\n\t{\n\t\tthis.itemMover.moveToAnotherEntity(entityFrom, item, null, bindButton);\n\n\t\tif (this.entityStorage.getSprintsAvailableForFilling(entityFrom).size <= 1)\n\t\t{\n\t\t\tthis.destroyActionPanel();\n\t\t}\n\t}\n\n\tmoveToBacklog(sprint: Sprint, item: Item)\n\t{\n\t\tthis.itemMover.moveToAnotherEntity(sprint, item, this.entityStorage.getBacklog());\n\t}\n\n\tshowTagSearcher(entity: Entity, item: Item, bindButton: HTMLElement)\n\t{\n\t\tthis.tagSearcher.showTagsDialog(item, bindButton);\n\n\t\tthis.tagSearcher.unsubscribeAll('attachTagToTask');\n\t\tthis.tagSearcher.subscribe('attachTagToTask', (innerBaseEvent) => {\n\t\t\tconst tag = innerBaseEvent.getData();\n\n\t\t\tconst itemIds = [];\n\t\t\tentity.getGroupModeItems().forEach((groupModeItem: Item) => {\n\t\t\t\tthis.pullItem.addIdToSkipUpdating(groupModeItem.getId());\n\t\t\t\titemIds.push(groupModeItem.getId());\n\t\t\t});\n\t\t\tthis.requestSender.updateTaskTags({\n\t\t\t\titemIds: itemIds,\n\t\t\t\ttag: tag\n\t\t\t}).then((response) => {\n\t\t\t\tentity.getGroupModeItems().forEach((groupModeItem: Item) => {\n\t\t\t\t\tconst currentTags = groupModeItem.getTags().getValue();\n\t\t\t\t\tif (!currentTags.includes(tag))\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentTags.push(tag);\n\t\t\t\t\t}\n\t\t\t\t\tgroupModeItem.setTags(currentTags);\n\t\t\t\t});\n\t\t\t}).catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t});\n\n\t\t});\n\n\t\tthis.tagSearcher.unsubscribeAll('deAttachTagToTask');\n\t\tthis.tagSearcher.subscribe('deAttachTagToTask', (innerBaseEvent) => {\n\t\t\tconst tag = innerBaseEvent.getData();\n\n\t\t\tconst itemIds = [];\n\t\t\tentity.getGroupModeItems().forEach((groupModeItem: Item) => {\n\t\t\t\tthis.pullItem.addIdToSkipUpdating(groupModeItem.getId());\n\t\t\t\titemIds.push(groupModeItem.getId());\n\t\t\t});\n\t\t\tthis.requestSender.removeTaskTags({\n\t\t\t\titemIds: itemIds,\n\t\t\t\ttag: tag\n\t\t\t}).then((response) => {\n\t\t\t\tentity.getGroupModeItems().forEach((groupModeItem: Item) => {\n\t\t\t\t\tconst currentTags = groupModeItem.getTags().getValue();\n\t\t\t\t\tcurrentTags.splice(currentTags.indexOf(tag), 1);\n\t\t\t\t\tgroupModeItem.setTags(currentTags);\n\t\t\t\t});\n\t\t\t}).catch((response) => {\n\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t});\n\t\t});\n\n\t\tthis.tagSearcher.unsubscribeAll('hideTagDialog');\n\t\tthis.tagSearcher.subscribe('hideTagDialog', () => {\n\t\t\tif (!this.tagSearcher.isEpicDialogShown())\n\t\t\t{\n\t\t\t\tthis.destroyActionPanel();\n\t\t\t\tentity.deactivateGroupMode();\n\t\t\t}\n\t\t});\n\t}\n\n\tshowEpicSearcher(entity: Entity, item: Item, bindButton: HTMLElement)\n\t{\n\t\tthis.tagSearcher.showEpicDialog(item, bindButton);\n\n\t\tthis.tagSearcher.unsubscribeAll('updateItemEpic');\n\t\tthis.tagSearcher.subscribe('updateItemEpic', (innerBaseEvent: BaseEvent) => {\n\t\t\tconst itemIds = [];\n\t\t\tconst epic: ?EpicType = innerBaseEvent.getData();\n\n\t\t\tentity.getGroupModeItems()\n\t\t\t\t.forEach((groupModeItem: Item) => {\n\t\t\t\t\tgroupModeItem.setEpic(epic);\n\t\t\t\t\titemIds.push(groupModeItem.getId());\n\t\t\t\t\tthis.pullItem.addIdToSkipUpdating(groupModeItem.getId());\n\t\t\t\t})\n\t\t\t;\n\n\t\t\tthis.requestSender.updateItemEpics({\n\t\t\t\titemIds: itemIds,\n\t\t\t\tepicId: epic ? epic.id : 0,\n\t\t\t})\n\t\t\t\t.then((response) => {})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\n\t\tthis.tagSearcher.unsubscribeAll('hideEpicDialog');\n\t\tthis.tagSearcher.subscribe('hideEpicDialog', () => {\n\t\t\tthis.destroyActionPanel();\n\t\t\tentity.deactivateGroupMode();\n\t\t});\n\t}\n\n\tremoveGroupItems(entity: Entity): Promise\n\t{\n\t\tconst itemIds = [];\n\n\t\tentity.getGroupModeItems().forEach((groupModeItem: Item) => {\n\n\t\t\titemIds.push(groupModeItem.getId());\n\n\t\t\tthis.pullItem.addIdToSkipRemoving(groupModeItem.getId());\n\t\t});\n\n\t\treturn this.requestSender.removeItems({\n\t\t\titemIds: itemIds,\n\t\t\tsortInfo: this.itemMover.calculateSort(entity.getListItemsNode())\n\t\t}).catch((response) => {\n\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t});\n\t}\n\n\tstartBacklogDecomposition(entity: Entity, parentItem: Item)\n\t{\n\t\tthis.decomposition = new Decomposition({\n\t\t\tparentItem: parentItem\n\t\t});\n\n\t\tif (!parentItem.isLinkedTask())\n\t\t{\n\t\t\tthis.itemDesigner.getRandomColorForItemBorder()\n\t\t\t\t.then((randomColor: string) => {\n\t\t\t\t\tparentItem.setBorderColor(randomColor);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\n\t\tthis.showInput(entity, parentItem.getNode());\n\t}\n\n\tstartSprintDecomposition(entity: Entity, parentItem: Item)\n\t{\n\t\tthis.decomposition = new Decomposition({\n\t\t\tparentItem: parentItem\n\t\t});\n\n\t\tparentItem.activateDecompositionMode();\n\n\t\tconst renderInputAfterSubTasks = (subTasks: SubTasks) => {\n\t\t\tif (!subTasks.isShown())\n\t\t\t{\n\t\t\t\tentity.appendNodeAfterItem(subTasks.render(), parentItem.getNode());\n\t\t\t}\n\t\t\tparentItem.showSubTasks();\n\n\t\t\tthis.showInput(entity, subTasks.getNode());\n\t\t}\n\n\t\tif (parentItem.isParentTask())\n\t\t{\n\t\t\tconst subTasks = parentItem.getSubTasks();\n\n\t\t\tif (subTasks.isEmpty())\n\t\t\t{\n\t\t\t\tthis.requestSender.getSubTaskItems({\n\t\t\t\t\tentityId: entity.getId(),\n\t\t\t\t\ttaskId: parentItem.getSourceId()\n\t\t\t\t})\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tresponse.data.forEach((itemParams: ItemParams) => {\n\t\t\t\t\t\t\tconst subTaskItem = Item.buildItem(itemParams);\n\t\t\t\t\t\t\tentity.setItem(subTaskItem);\n\t\t\t\t\t\t\tsubTasks.addTask(subTaskItem);\n\t\t\t\t\t\t});\n\t\t\t\t\t\trenderInputAfterSubTasks(subTasks);\n\t\t\t\t\t})\n\t\t\t\t\t.catch((response) => {\n\t\t\t\t\t\tthis.requestSender.showErrorAlert(response);\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\trenderInputAfterSubTasks(subTasks);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showInput(entity, parentItem.getNode());\n\t\t}\n\t}\n}\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Button, ButtonState, ButtonColor, ButtonSize } from 'ui.buttons';\n\ntype Params = {\n\tcanCompleteSprint: boolean\n}\n\nexport class CompleteSprintButton extends EventEmitter\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper();\n\n\t\tthis.canCompleteSprint = params.canCompleteSprint;\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.ActiveSprintButton');\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst completeBtn = new Button({\n\t\t\ttext: Loc.getMessage('TASKS_SCRUM_ACTIONS_COMPLETE_SPRINT'),\n\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\tround: true,\n\t\t\tnoCaps: true,\n\t\t\tonclick: () => {\n\t\t\t\tthis.onCompleteSprintClick();\n\t\t\t},\n\t\t});\n\n\t\tif (!this.canCompleteSprint)\n\t\t{\n\t\t\tcompleteBtn.setStyle(ButtonState.DISABLED);\n\t\t}\n\n\t\treturn completeBtn.render();\n\t}\n\n\tonCompleteSprintClick()\n\t{\n\t\tif (this.canCompleteSprint)\n\t\t{\n\t\t\tthis.emit('completeSprint');\n\t\t}\n\t}\n}\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { SidePanel } from '../../service/side.panel';\nimport { Button, ButtonIcon, ButtonColor, ButtonSize } from 'ui.buttons';\n\ntype Params = {\n\tsidePanel: SidePanel,\n\tgroupId: number,\n\tisTaskLimitsExceeded: boolean,\n\tcanUseAutomation: boolean,\n\tisAutomationEnabled: boolean,\n}\n\nexport class RobotButton extends EventEmitter\n{\n\tnode: HTMLElement;\n\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.sidePanel = params.sidePanel;\n\t\tthis.isTaskLimitsExceeded = params.isTaskLimitsExceeded;\n\t\tthis.canUseAutomation = params.canUseAutomation;\n\t\tthis.isAutomationEnabled = params.isAutomationEnabled;\n\t\tthis.groupId = params.groupId;\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.RobotButton');\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst robotBtn = new Button({\n\t\t\ttext: Loc.getMessage('TASKS_SCRUM_ROBOTS_BUTTON'),\n\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\tnoCaps: true,\n\t\t\tround: true,\n\t\t\tdependOnTheme: true,\n\t\t\tonclick: () => {\n\t\t\t\tthis.onClick();\n\t\t\t},\n\t\t});\n\n\t\tif (this.isShowLimitSidePanel())\n\t\t{\n\t\t\trobotBtn.setIcon(ButtonIcon.LOCK);\n\t\t}\n\t\telse\n\t\t{\n\t\t\trobotBtn.setIcon(ButtonIcon.ROBOTS);\n\t\t}\n\n\t\treturn robotBtn.render();\n\t}\n\n\tonClick()\n\t{\n\t\tif (this.isShowLimitSidePanel())\n\t\t{\n\t\t\tconst sliderCode = this.isAutomationEnabled ? 'limit_tasks_robots' : 'limit_crm_rules_off';\n\n\t\t\tBX.Runtime.loadExtension('ui.info-helper').then(({ FeaturePromotersRegistry }) => {\n\t\t\t\tif (FeaturePromotersRegistry)\n\t\t\t\t{\n\t\t\t\t\tFeaturePromotersRegistry.getPromoter({ code: sliderCode, bindElement: this.node }).show();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tBX.UI.InfoHelper.show(sliderCode, {\n\t\t\t\t\t\tisLimit: true, limitAnalyticsLabels: {\n\t\t\t\t\t\t\tmodule: 'tasks',\n\t\t\t\t\t\t\tsource: 'scrumActiveSprint',\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst url = '/bitrix/components/bitrix/tasks.automation/slider.php?site_id='\n\t\t\t\t+ Loc.getMessage('SITE_ID') + '&project_id=' + this.groupId;\n\n\t\t\tthis.sidePanel.openSidePanel(url, {\n\t\t\t\tcustomLeftBoundary: 0,\n\t\t\t\tcacheable: false,\n\t\t\t\tloader: 'bizproc:automation-loader',\n\t\t\t});\n\t\t}\n\t}\n\n\tisShowLimitSidePanel(): boolean\n\t{\n\t\treturn !this.isAutomationEnabled || this.isTaskLimitsExceeded || !this.canUseAutomation;\n\t}\n}\n","import {Dom} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {SidePanel} from '../service/side.panel';\n\nimport {View, Views} from './view';\nimport { CompleteSprintButton } from './header/complete.sprint.button';\nimport {RobotButton} from './header/robot.button';\n\nimport {SprintSidePanel} from '../entity/sprint/sprint.side.panel';\n\nimport {StatsBuilder} from '../entity/sprint/stats/stats.builder';\n\ntype Params = {\n\tactiveSprintId: number,\n\tviews: Views,\n\ttaskLimitExceeded: 'Y' | 'N',\n\tcanUseAutomation: 'Y' | 'N',\n\tisAutomationEnabled: 'Y' | 'N',\n\tcanCompleteSprint: 'Y' | 'N'\n}\n\nexport class ActiveSprint extends View\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.ActiveSprint');\n\n\t\tthis.setParams(params);\n\n\t\tif (this.existActiveSprint())\n\t\t{\n\t\t\tthis.bindHandlers();\n\t\t}\n\n\t\tthis.sidePanel = new SidePanel();\n\t}\n\n\trenderSprintStatsTo(container: HTMLElement)\n\t{\n\t\tsuper.renderSprintStatsTo(container);\n\n\t\t// todo ger data for sprint from server\n\t\tif (this.sprint)\n\t\t{\n\t\t\tthis.stats = StatsBuilder.build(this.sprint);\n\t\t\tthis.stats.setKanbanStyle();\n\n\t\t\tDom.append(this.stats.render(), container);\n\t\t}\n\t}\n\n\trenderRightElementsTo(container: HTMLElement)\n\t{\n\t\tsuper.renderRightElementsTo(container);\n\n\t\tif (!this.existActiveSprint())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.canCompleteSprint) // todo change to can robot access\n\t\t{\n\t\t\tconst robotButton = new RobotButton({\n\t\t\t\tsidePanel: this.sidePanel,\n\t\t\t\tgroupId: this.getCurrentGroupId(),\n\t\t\t\tisTaskLimitsExceeded: this.isTaskLimitsExceeded(),\n\t\t\t\tcanUseAutomation: this.isCanUseAutomation(),\n\t\t\t\tisAutomationEnabled: this.checkIsAutomationEnabled(),\n\t\t\t});\n\n\t\t\tDom.append(robotButton.render(), container);\n\t\t}\n\n\t\tconst completeSprintButton = new CompleteSprintButton({\n\t\t\tcanCompleteSprint: this.canCompleteSprint\n\t\t});\n\t\tcompleteSprintButton.subscribe('completeSprint', this.onCompleteSprint.bind(this));\n\n\t\tDom.append(completeSprintButton.render(), container);\n\n\t}\n\n\tsetParams(params: Params)\n\t{\n\t\tthis.activeSprintId = parseInt(params.activeSprintId, 10);\n\n\t\tthis.setTaskLimitsExceeded(params.taskLimitExceeded);\n\t\tthis.setCanUseAutomation(params.canUseAutomation);\n\t\tthis.setIsAutomationEnabled(params.isAutomationEnabled);\n\n\t\tthis.views = params.views;\n\n\t\tthis.canCompleteSprint = (params.canCompleteSprint === 'Y');\n\t}\n\n\tsetTaskLimitsExceeded(limitExceeded: string)\n\t{\n\t\tthis.limitExceeded = (limitExceeded === 'Y');\n\t}\n\n\tisTaskLimitsExceeded(): boolean\n\t{\n\t\treturn this.limitExceeded;\n\t}\n\n\tsetCanUseAutomation(canUseAutomation: string)\n\t{\n\t\tthis.canUseAutomation = (canUseAutomation === 'Y');\n\t}\n\n\tisCanUseAutomation(): boolean\n\t{\n\t\treturn this.canUseAutomation;\n\t}\n\n\tsetIsAutomationEnabled(isAutomationEnabled: string)\n\t{\n\t\tthis.isAutomationEnabled = (isAutomationEnabled === 'Y');\n\t}\n\n\tcheckIsAutomationEnabled(): boolean\n\t{\n\t\treturn this.isAutomationEnabled;\n\t}\n\n\texistActiveSprint(): boolean\n\t{\n\t\treturn this.activeSprintId > 0;\n\t}\n\n\tbindHandlers()\n\t{\n\t\t// eslint-disable-next-line\n\t\tconst kanbanManager = BX.Tasks.Scrum.Kanban;\n\t\tif (kanbanManager)\n\t\t{\n\t\t\tthis.bindKanbanHandlers(kanbanManager.getKanban());\n\t\t\tkanbanManager.getKanbansGroupedByParentTasks().forEach((kanban) => {\n\t\t\t\tthis.bindKanbanHandlers(kanban);\n\t\t\t});\n\t\t}\n\t}\n\n\tbindKanbanHandlers(kanban)\n\t{\n\t\tEventEmitter.subscribe(kanban, 'Kanban.Grid:onItemMoved', (event: BaseEvent) => {\n\t\t\tconst [kanbanItem, targetColumn, beforeItem] = event.getCompatData();\n\t\t\tthis.onItemMoved(kanbanItem, targetColumn, beforeItem);\n\t\t});\n\t}\n\n\tonCompleteSprint(baseEvent: BaseEvent)\n\t{\n\t\tconst sprintSidePanel = new SprintSidePanel({\n\t\t\tgroupId: this.groupId,\n\t\t\tsidePanel: this.sidePanel,\n\t\t\tviews: this.views,\n\t\t});\n\t\tsprintSidePanel.showCompletionForm();\n\n\t\tsprintSidePanel.subscribe('showTask', (innerBaseEvent: BaseEvent) => {\n\t\t\tconst path = BX.Uri.addParam(this.getPathToTask().replace('#task_id#', innerBaseEvent.getData()), {\n\t\t\t\tta_sec: 'scrum',\n\t\t\t\tta_sub: 'kanban',\n\t\t\t\tta_el: 'title_click',\n\t\t\t});\n\n\t\t\tthis.sidePanel.openSidePanelByUrl(path);\n\t\t});\n\t}\n\n\t/**\n\t * Hook on item moved.\n\t * @param {BX.Tasks.Kanban.Item} kanbanItem\n\t * @param {BX.Tasks.Kanban.Column} targetColumn\n\t * @param {BX.Tasks.Kanban.Item} [beforeItem]\n\t * @returns {void}\n\t */\n\tonItemMoved(kanbanItem, targetColumn, beforeItem)\n\t{\n\t\t// todo update stats\n\t\t//this.stats.setSprintData(this.sprint);\n\t}\n}\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Button, ButtonColor, ButtonSize } from 'ui.buttons';\n\nexport class BurnDownButton extends EventEmitter\n{\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.BurnDownButton');\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst burnDownButton = new Button({\n\t\t\ttext: Loc.getMessage('TASKS_SCRUM_ACTIVE_SPRINT_BUTTON'),\n\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\tround: true,\n\t\t\tnoCaps: true,\n\t\t\tonclick: () => {\n\t\t\t\tthis.onClick();\n\t\t\t},\n\t\t});\n\n\t\treturn burnDownButton.render();\n\t}\n\n\tonClick()\n\t{\n\t\tthis.emit('click');\n\t}\n}\n","import {Dom, Type} from 'main.core';\nimport {BaseEvent, EventEmitter} from 'main.core.events';\n\nimport {SidePanel} from '../service/side.panel';\n\nimport {Sprint} from '../entity/sprint/sprint';\nimport {SprintSidePanel} from '../entity/sprint/sprint.side.panel';\n\nimport {View} from './view';\nimport {BurnDownButton} from './header/burn.down.button';\n\nimport type {Views} from './view';\nimport type {SprintParams} from '../entity/sprint/sprint';\n\ntype Params = {\n\tviews: Views,\n\tcompletedSprint: SprintParams,\n\tsprints: Array<SprintParams>,\n\tpathToBurnDown: string\n}\n\nexport class CompletedSprint extends View\n{\n\tconstructor(params: Params)\n\t{\n\t\tsuper(params);\n\n\t\tthis.setEventNamespace('BX.Tasks.Scrum.CompletedSprint');\n\n\t\tthis.setParams(params);\n\n\t\tthis.bindHandlers();\n\t}\n\n\trenderRightElementsTo(container: HTMLElement)\n\t{\n\t\tsuper.renderRightElementsTo(container);\n\n\t\tif (this.completedSprint === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst burnDownButton = new BurnDownButton();\n\t\tburnDownButton.subscribe('click', this.onShowSprintBurnDownChart.bind(this));\n\n\t\tDom.append(burnDownButton.render(), container);\n\t}\n\n\tsetParams(params: Params)\n\t{\n\t\tif (Type.isArray(params.completedSprint))\n\t\t{\n\t\t\tthis.completedSprint = null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.completedSprint = new Sprint(params.completedSprint);\n\t\t}\n\n\t\tthis.sidePanel = new SidePanel();\n\n\t\tthis.sprints = new Map();\n\t\tparams.sprints.forEach((sprintData) => {\n\t\t\tconst sprint = Sprint.buildSprint(sprintData);\n\t\t\tthis.sprints.set(sprint.getId(), sprint);\n\t\t});\n\t\tthis.views = params.views;\n\n\t\tthis.pathToBurnDown = params.pathToBurnDown;\n\t}\n\n\tbindHandlers()\n\t{\n\t\tEventEmitter.subscribe('onTasksGroupSelectorChange', this.onSprintSelectorChange.bind(this));\n\t}\n\n\tonSprintSelectorChange(event: BaseEvent)\n\t{\n\t\tconst [currentSprint] = event.getCompatData()\n\n\t\tthis.completedSprint = this.findSprintBySprintId(currentSprint.sprintId);\n\t}\n\n\tonShowSprintBurnDownChart(baseEvent: BaseEvent)\n\t{\n\t\tconst sprintSidePanel = new SprintSidePanel({\n\t\t\tgroupId: this.groupId,\n\t\t\tsidePanel: this.sidePanel,\n\t\t\tviews: this.views,\n\t\t\tpathToBurnDown: this.pathToBurnDown\n\t\t});\n\t\tsprintSidePanel.showBurnDownChart(this.completedSprint);\n\t}\n\n\tfindSprintBySprintId(sprintId: number): Sprint\n\t{\n\t\treturn [...this.sprints.values()].find((sprint) => sprint.getId() === parseInt(sprintId, 10));\n\t}\n}\n","import {Dom} from 'main.core';\n\nimport {View} from './view/view';\nimport {Plan} from './view/plan/plan';\nimport {ActiveSprint} from './view/active.sprint';\nimport {CompletedSprint} from './view/completed.sprint';\n\nimport {Culture, CultureData} from './utility/culture';\n\ntype Params = {\n\tviewName: string,\n\tculture: CultureData\n}\n\nexport class Entry\n{\n\tconstructor(params: Params)\n\t{\n\t\tthis.setParams(params);\n\n\t\tthis.buildView(params);\n\t}\n\n\tsetParams(params: Params)\n\t{\n\t\tthis.setViewName(params.viewName);\n\n\t\tCulture.getInstance().setData(params.culture);\n\t}\n\n\tsetViewName(viewName: string)\n\t{\n\t\tconst availableViews = new Set([\n\t\t\t'plan',\n\t\t\t'activeSprint',\n\t\t\t'completedSprint'\n\t\t]);\n\n\t\tif (!availableViews.has(viewName))\n\t\t{\n\t\t\tthrow Error('Invalid value to activeView parameter');\n\t\t}\n\n\t\tthis.viewName = viewName;\n\t}\n\n\tgetViewName(): string\n\t{\n\t\treturn this.viewName;\n\t}\n\n\tsetView(view: View)\n\t{\n\t\tif (view instanceof View)\n\t\t{\n\t\t\tthis.view = view;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.view = null;\n\t\t}\n\t}\n\n\tgetView(): View\n\t{\n\t\treturn this.view;\n\t}\n\n\tbuildView(params: Params)\n\t{\n\t\tconst viewName = this.getViewName();\n\n\t\tif (viewName === 'plan')\n\t\t{\n\t\t\tthis.setView(new Plan(params));\n\t\t}\n\t\telse if (viewName === 'activeSprint')\n\t\t{\n\t\t\tthis.setView(new ActiveSprint(params));\n\t\t}\n\t\telse if (viewName === 'completedSprint')\n\t\t{\n\t\t\tthis.setView(new CompletedSprint(params));\n\t\t}\n\t}\n\n\trenderTo(container: HTMLElement)\n\t{\n\t\tconst view = this.getView();\n\t\tif (view instanceof View)\n\t\t{\n\t\t\tthis.getView().renderTo(container);\n\t\t}\n\t}\n\n\trenderTabsTo(container: HTMLElement)\n\t{\n\t\tconst view = this.getView();\n\t\tif (view instanceof View)\n\t\t{\n\t\t\tthis.getView().renderTabsTo(container);\n\t\t}\n\t}\n\n\trenderSprintStatsTo(container: HTMLElement)\n\t{\n\t\tconst view = this.getView();\n\t\tif (view instanceof View)\n\t\t{\n\t\t\tthis.getView().renderSprintStatsTo(container);\n\t\t}\n\t}\n\n\trenderRightElementsTo(container: HTMLElement)\n\t{\n\t\tconst view = this.getView();\n\t\tif (view instanceof View)\n\t\t{\n\t\t\tthis.getView().renderRightElementsTo(container);\n\t\t}\n\t}\n\n\tsetDisplayPriority(menuItem: HTMLElement, value: string)\n\t{\n\t\tif (!Dom.hasClass(menuItem, 'menu-popup-item-accept'))\n\t\t{\n\t\t\tthis.refreshIcons(menuItem);\n\n\t\t\tconst view = this.getView();\n\t\t\tif (view instanceof View)\n\t\t\t{\n\t\t\t\tthis.getView().setDisplayPriority(value);\n\t\t\t}\n\t\t}\n\t}\n\n\trefreshIcons(item: HTMLElement)\n\t{\n\t\titem.parentElement.childNodes.forEach((element) => {\n\t\t\tDom.removeClass(element, 'menu-popup-item-accept');\n\t\t});\n\n\t\tDom.addClass(item, 'menu-popup-item-accept');\n\t}\n\n\tchangeShortView(isShortView: 'Y' | 'N')\n\t{\n\t\tconst view = this.getView();\n\t\tif (view instanceof View)\n\t\t{\n\t\t\tthis.getView().changeShortView(isShortView);\n\t\t}\n\t}\n}\n"],"names":["SidePanel","setEventNamespace","sidePanelManager","BX","Instance","bindEvents","EventEmitter","subscribe","event","getCompatData","sliderEvent","sidePanel","getSlider","setCacheable","emit","currentSidePanel","Boolean","getPreviousSlider","topSidePanel","getTopSlider","reload","close","previousSidePanel","url","open","id","options","name","params","extensionName","toLowerCase","top","Runtime","loadExtension","then","exports","replaceAll","extension","show","RequestSender","signedParameters","debugMode","action","data","Promise","resolve","reject","ajax","runAction","analytics","config","mode","runComponentAction","sendRequestToComponent","tool","category","type","c_section","c_element","sendRequest","response","alertTitle","Type","isUndefined","errors","length","firstError","shift","errorCode","code","message","title","Loc","getMessage","MessageBox","alert","Filter","filterId","requestSender","searchFieldApplied","initUiFilterManager","bindHandlers","filterManager","Main","getById","onApplyFilter","bind","getSearch","getContainer","filterSearchContainer","getSearchContainer","isNodeInViewport","scrollIntoView","values","filterInstance","promise","getSearchString","autoResolve","item","fieldInstances","getField","fieldOptions","getFieldByName","found","ITEMS","find","listItem","NAME","push","itemsNode","node","querySelector","items","Dom","attr","value","getApi","extendFilter","reduce","res","filterFieldsValues","getFilterFieldsValues","resetFilter","applyFilter","element","rect","getBoundingClientRect","left","bottom","window","innerHeight","document","documentElement","clientHeight","right","innerWidth","clientWidth","Tabs","views","forEach","view","isStringFilled","events","click","openUrl","target","getTopSidePanel","showLoader","NavigationPanel","View","isOwnerCurrentUser","loadItemsRepeatCounter","Map","filter","scrumManager","userId","parseInt","groupId","pathToTask","isString","baseEvent","clear","container","isDomNode","Error","init","availableValues","Set","has","isShortView","DiskManager","targetElement","diskUrls","urlSelect","urlRenameFile","urlDeleteFile","urlUpload","onFinishDebounce","debounce","attachedIds","controlId","Text","getRandom","popup","Popup","content","getAttachmentsLoaderContent","autoHide","closeByEsc","angle","offsetTop","offsetLeft","Disk","UF","add","UID","controlName","hideSelectDialog","filesChooser","contentContainer","onCustomEvent","DiskFileDialog","openDiskFileDialog","isClickInside","contains","getPopupContainer","popupWindow","Tag","render","addCustomEvent","onFileUploadSuccess","fileResult","uf","file","uploaderFile","element_id","toString","Toggle","visible","shown","disabled","Event","onClick","isDisabled","disable","isShown","unDisable","Tool","string","replace","Name","trim","important","isImportant","completed","isCompleted","sourceId","visualClasses","encode","words","split","lastWord","RegExp","escapeRegex","uri","Uri","addParam","ta_sec","ta_sub","ta_el","addClass","removeClass","Checklist","complete","isInteger","all","uiClasses","Files","count","Comments","taskCounter","isNull","color","Epic","epic","isArray","description","createdBy","modifiedBy","colorBorder","convertHexToRGBA","colorBackground","visibility","hexCode","opacity","hex","r","substring","g","b","Tags","tags","map","tag","textContent","JSON","stringify","getValue","Responsible","responsible","isPlainObject","src","photo","photoStyle","encodeURI","StoryPointsStorage","storyPoints","isFloat","isNaN","parseFloat","toFixed","String","StoryPoints","storyPointsStorage","setPoints","disableStatus","getPoints","isEmpty","input","onBlur","onKeyDown","isDisable","inputContainer","firstElementChild","focus","setSelectionRange","currentValue","isComposing","key","blur","SubTasks","parentItem","list","removeYourself","onTransitionEnd","getNode","remove","size","set","getId","hideLoader","renderSubTasks","style","scrollHeight","height","innerHTML","append","loader","listPosition","getPosition","Loader","offset","width","hide","isHide","Item","groupMode","decompositionMode","toggle","checklist","files","comments","subTasks","setItemParams","shortView","setId","setGroupId","setTmpId","tmpId","setSort","sort","setEntityId","entityId","setEntityType","entityType","setSourceId","setInfo","info","setSubTasksInfo","subTasksInfo","setParentTask","isParentTask","setLinkedTask","isLinkedTask","setParentTaskId","parentTaskId","setSubTask","isSubTask","setCompleted","setDisableStatus","setAllowedActions","allowedActions","setImportant","onShowToggle","onHideToggle","inputName","getSourceId","inputEpic","renderFullView","updateTagsVisibility","inputTags","replaceTags","getData","inputResponsible","onResponsibleClick","inputStoryPoints","onSetStoryPoints","dataset","setPreviousSort","previousSort","updateBorderColor","strikeOut","unStrikeOut","getSubTasksInfo","Object","keys","parentTask","setToggle","getSubTasksCount","linkedTask","subTask","borderColor","getBorderColor","colorNode","getEntityType","moveActivity","status","checked","getSubTasks","cleanTasks","tmpItem","getName","setName","getChecklist","setChecklist","getComplete","getAll","getFiles","setFiles","getComments","setComments","getEpic","setEpic","getTags","isEqualTags","setTags","getResponsible","setResponsible","getStoryPoints","setStoryPoints","getEntityId","getParentTaskId","renderShortView","typeClass","subClass","linkedClass","entityClass","getSort","onItemClick","tagsContainer","tagsNode","querySelectorAll","tagNode","tagList","hasClass","hasNode","isGroupMode","responsibleDialog","isOpen","preselectedItems","Dialog","targetNode","enableSearch","context","dropdownMode","selectedItem","getTitle","getAvatar","entities","getGroupId","dynamicLoad","itemId","hideSubTasks","parentNode","searchNode","skipParent","result","isEqualNode","nodes","getElementsByTagName","k","IntersectionObserver","observer","entries","isIntersecting","blink","disconnect","threshold","observe","setTimeout","checkListComplete","checkListAll","attachedFilesCount","setSubTasks","ListItems","entity","getItems","renderLoader","TagSearcher","filterService","tagsAreConverting","messageViewed","selected","epicDialogItem","getEpicDialogItem","epicDialog","addItem","epicSearchDialog","removeItem","tabs","avatarOptions","bgColor","bgImage","showConvertingMessage","choiceWasMade","statusSuccess","tagDialog","multiple","compactView","searchOptions","allowCreateItem","footer","Tasks","EntitySelector","Footer","footerOptions","taskId","clearUnavailableItems","getTarget","getFooterContainer","onShowTaskEditCallback","hideDialogLabel","dialog","getTab","getRootNode","deselectedItem","onSearchCallback","tagSelectorOptions","onInput","selector","getDialog","label","getTextBoxValue","currentEpic","dynamicSearch","hideOnSelect","hideOnDeselect","searchQuery","epicName","getQuery","createEpic","addEpicToSearcher","addItemToListTypeField","VALUE","getSelectedItems","textBoxWidth","placeholder","inputObject","enteredQuery","setTagsSearchMode","getInputNode","tagSearchDialog","getNodeId","offsetWidth","tabOptions","onLoadTaskQuickCreateCallback","newValue","regex","currentPiece","pop","pieceOfValue","deselect","isNil","searchTab","getSearchTab","isEmptyResult","search","epicEnteredQuery","setSelectedEpicLength","setEpicSearchMode","lastSearchQuery","getLastSearchQuery","epicId","query","hidden","tagName","newTag","addTag","success","alertClass","showAlert","error","removeAlert","addEventListener","handler","ctrlKey","metaKey","keyCode","getTagSelectorQuery","itemIds","updateTaskTags","badges","group","select","getTagSelector","clearTextBox","focusSearch","selectFirstTab","ev","dialogId","className","messageType","UI","createElement","before","notification","buttons","MessageBoxButtons","OK","okCaption","onOk","inputText","tagRegExp","matches","match","exec","epicRegExp","Input","bindNode","taskCreated","selectedEpicLength","nodeId","onTagSearch","onEpicSearch","onKeydown","isTagsSearchMode","isEpicSearchMode","submit","stopImmediatePropagation","Browser","isMac","currentPieceOfName","enteredHashTags","getHashTagNamesFromText","createTaskItem","inputNode","enteredHashEpics","getHashEpicNamesFromText","isExists","Entity","groupModeItems","setEntityParams","observerLoadItems","listItems","listLoader","itemLoader","itemsLoaderNode","blank","dropzone","emptySearchStub","hideCont","setViews","setNumberTasks","numberTasks","setShortView","setMandatory","mandatoryExists","setExactSearchApplied","isExactSearchApplied","pageSize","setPageNumberItems","pageNumberItems","isShownSubTasks","getListNode","listItemsNode","getListItemsNode","get","newItem","subscribeToItem","setItemMoveActivity","getShortView","hideBlank","hideDropzone","hideEmptySearchStub","adjustListItemsWidth","setMoveActivity","unsubscribeAll","getList","insertBefore","lastElementChild","exactSearchApplied","setStats","getNumberItems","bindItemsLoader","itemNode","loaderNode","getLoaderNode","previousElementSibling","fistNode","nextElementSibling","activateGroupMode","deactivateGroupMode","removeItemFromGroupMode","addItemToGroupMode","waitingLoadItems","showItemsLoader","isActiveLoadItems","hideItemsLoader","activeLoadItems","destroy","position","isBacklog","newItemNode","bindItemNode","hasListItemsScroll","getListItems","addScrollbar","removeScrollbar","Header","backlog","epicButtonLocked","taskButtonLocked","epicButton","taskButton","uiEpicClasses","uiTaskClasses","renderTaskCounterLabel","getNumberTasks","onEpicClick","onTaskClick","lockEpicButton","lockTaskButton","Blank","renderBacklog","renderCompletedSprint","Dropzone","renderSprint","renderSprintEmptyText","EmptySearchStub","getStubText","Backlog","setBacklogParams","header","itemData","buildItem","updateTaskCounter","onItemsScroll","backlogData","setHeader","setBlank","setDropzone","setEmptySearchStub","setListItems","Culture","dayMonthFormat","longDateFormat","shortTimeFormat","Date","sprint","isActive","getFormattedDateStart","getFormattedDateEnd","getDateStartFormatted","getDateEndFormatted","parentPopup","closest","customBlur","calendar","showCalendar","field","bTime","bSetFocus","bHideTime","bindOnce","updateDateNode","date","format","getInstance","getDayMonthFormat","Math","floor","parseDate","getTime","dateStartNode","dateEndNode","dateStartInput","dateEndInput","classList","stopPropagation","sprintId","dateStart","unbind","dateEnd","weekCount","getDefaultSprintDuration","getDateStart","getDateEnd","StatsCalculator","first","second","round","Stats","setSprintData","statsCalculator","kanbanMode","setCompletedStoryPoints","getCompletedStoryPoints","setUncompletedStoryPoints","getUncompletedStoryPoints","setEndDate","weekendDaysTime","getWeekendDaysTime","completedStoryPoints","uncompletedStoryPoints","endDate","now","CompletedStats","percentage","calculatePercentage","completedDate","getCompletedDate","getEndDate","HeaderDate","getFormattedTitleDatePeriod","getLongDateFormat","ExpiredStats","expiredDay","getExpiredDay","ActiveStats","remainingDays","getRemainingDays","dateWithWeekendOffset","setSeconds","getSeconds","setHours","msPerMinute","msPerHour","msPerDay","daysRemaining","StatsBuilder","isExpired","stats","build","renderEditInput","renderEdit","renderRemove","titleNode","editNode","isPlanned","removeNode","confirm","messageBox","ChartIcon","uiChartStyles","Counters","renderAverageNumberStoryPoints","Hint","createInstance","popupParameters","animation","getAverageNumberStoryPoints","Button","uiBtnStyles","Info","chartIcon","counters","button","disableUiClass","isAccessDenied","getUiClasses","getButtonText","getStatus","toUpperCase","canComplete","canStart","Tick","isHideContent","tick","setDate","getHeaderClass","upTick","downTick","setButton","setTick","Sprint","setSprintParams","toggling","setDateStart","setDateEnd","setDateStartFormatted","dateStartFormatted","setDateEndFormatted","dateEndFormatted","setWeekendDaysTime","setDefaultSprintDuration","defaultSprintDuration","setAverageNumberStoryPoints","averageNumberStoryPoints","setStatus","setCompletedTasks","completedTasks","setUncompletedTasks","uncompletedTasks","setItems","setContentVisibility","isShownContent","buildHeader","onChangeName","onChangeSprintDeadline","toggleVisibilityContent","getContentContainer","sprintEnd","isNodeCreated","sprintSort","itemParams","sprintGoal","start","isNumber","availableStatus","disableButton","unDisableButton","tmpSprint","openClass","defaultContentStyle","showEmptySearchStub","showDropzone","isSubTaskLoadingActive","subTaskLoadingActive","appendNodeAfterItem","showSubTasks","getCompletedTasks","getUncompletedTasks","activateEditMode","deactivateEditMode","requestData","hasOwnProperty","unbindItemsLoader","showContent","hideContent","unDisableToggle","EntityStorage","sprints","filteredCompletedSprints","entityFrom","activeSprint","getActiveSprint","getPlannedSprints","filledSprint","recalculateItemsSort","backlogItems","Scroller","planBuilder","entityStorage","isItemInViewport","isBacklogItem","scrollContainer","getBacklog","itemTopPosition","getRelativePosition","scrollTo","scrollTop","behavior","sprintsContainer","getSprintsContainer","hasItem","CompletedSprints","pageNumber","statsUploaded","sprintsUploaded","isActiveLoad","filteredSprintsNode","listNode","renderHeader","renderList","observerTargetNode","bindLoad","hideFilteredHeader","showHeader","btnStyles","btnNode","onBtnClick","currentTarget","hideList","showList","isSprintsUploaded","onLoadStats","renderObserverTarget","averageNumberTasks","averagePercentageCompletion","onLoadCompletedSprints","getCompletedSprintsStats","updateStats","showErrorAlert","getCompletedSprints","createSprints","nameNode","statsHeaderNode","numberSprints","renderStats","sprintData","buildSprint","addSprint","onAfterAppend","completedSprints","clean","addFilteredCompletedSprint","clearFilteredCompletedSprints","hideHeader","PlanBuilder","pageNumberToCompletedSprints","displayPriority","scroller","scrumContainer","setWidthPriority","renderSprintsContainer","getSprints","adjustSprintListWidth","plannedSprints","sprintsNode","renderSprintDropzone","existCompletedSprint","updatePlannedSprints","getFilteredCompletedSprints","showFilteredCompletedSprints","onSprintsScroll","sprintDropzone","createSprint","sprintParams","appendToPlannedContainer","updateVisibilitySprints","scrollToSprint","removeSprint","parentElement","updateSprintContainers","hasScroll","activeContainer","plannedContainer","existActiveSprint","plannedSprint","disableHeaderButton","unDisableHeaderButton","showFilteredSprints","hideFilteredSprints","setActiveLoadItems","getPageNumberItems","incrementPageNumberItems","createItemsInEntity","decrementPageNumberItems","loadItems","withoutNav","findItemByItemId","appendItemToList","setItem","results","getSprintsAvailableForFilling","anotherSprint","isWaitingLoadItems","ActionPanel","bindElement","itemList","task","activity","attachment","dod","move","decomposition","isBlockBlur","hintManager","observeBindElement","calculatePanelPosition","createActionPanel","bindItems","body","hideHint","baseBtnClass","arrowClass","getSelectedText","getGroupModeItems","disableClass","sprintArrowClass","decClass","hintText","selectedBtn","callback","number","displayPanel","hidePanel","panel","fakePanel","cloneNode","isPanelWiderThanViewport","fakePanelRect","windowWidth","removeLastSeparator","actionPanel","SearchArrows","currentPosition","closeBtn","prevBtn","nextBtn","onClose","onPrev","onNext","SearchItems","active","currentIndex","arrows","startItem","linkedItemIds","setList","fadeOutAll","scrollToItem","getCurrent","updateCurrentIndexByItem","activateCurrent","activateLinkedMode","showArrows","fadeInAll","cleanList","removeArrows","getAllItems","inputItem","deactivateCurrent","index","updateArrows","currentItem","activateCurrentLinkedMode","deactivateCurrentLinkedMode","fadeOut","fadeIn","stop","moveToPrev","moveToNext","adjustArrowsPosition","updateCurrentPosition","arrowsRect","backlogRect","deactivateLinkedMode","SprintMover","onSetDraggable","dragEndEvent","endContainer","updateSprintSort","sortInfo","calculateSprintSort","increment","listSortInfo","SprintSidePanel","pathToBurnDown","showByExtension","location","href","openSidePanel","EntityCounters","entityIds","getEntityCounters","ItemMover","entityCounters","dragItems","lastOutContainer","draggableItems","addContainer","addDropzone","getDropzone","containers","dropZones","getSprintDropzone","Draggable","draggable","dragElement","CLONE","delay","onBeforeDragStart","onDragStart","onDragEnd","onDropEnd","onDropZoneEnter","onDropZoneOut","dragBeforeStartEvent","source","preventDefault","sourceContainer","sourceEntityId","sourceEntity","findEntityByEntityId","isMultipleDrag","addMultipleMode","getAllEntities","entityItem","blockScrumContainerSelect","dragStartEvent","removeMultipleMode","unblockScrumContainerSelect","isDropToZone","endEntityId","endEntity","onItemMove","dragGroupItems","dragDropEvent","isSprintDropzone","addSprintContainers","moveTo","insertDom","moveInCurrentContainer","onMoveConfirm","moveItemFromEntityToEntity","moveInAnotherContainer","children","entityTo","updateItemSort","calculateSort","updateEntityCounters","dragItem","isMoveInCurrentContainer","sortedDragItems","dragItemIds","groupedItem","findEntityByItemId","listToMove","isFirstItem","text","onclick","menuItem","sortedItems","sortedItemsIds","groupModeItem","moveItemToUp","activateBlinking","next","getMenuWindow","isLastItem","fadeOutEntity","loadEntityList","fadeInEntity","moveItemToDown","containerPosition","getScrumContainer","showMoveItemMenu","updateSort","updateItemsSort","Array","from","updateCounters","updatedItemsIds","moveToAnotherEntity","isSortUpdated","updatedItemId","targetEntity","bindButton","isMoveToSprint","showListSprintsToMove","moveToWithGroupMode","moveToEnd","update","immediately","entityListNode","onMoveItemUpdate","isMoveFromAnotherEntity","itemSort","itemPreviousSortSort","getPreviousSort","bindItemSort","bindItem","appendItemAfterItem","getFirstItemNode","resortItems","setParentEntity","moveToSprintMenu","getPopupWindow","Menu","isSameSprint","addMenuItem","moveItemMenu","loadAllItems","showListLoader","hideListLoader","ItemDesigner","listAllUsedColors","randomColorCount","defaultColor","getAllUsedColors","getRandomColor","getAllColors","allColors","randomColor","random","isThisBorderColorAlreadyUse","isAlreadyUse","usedColor","getAllUsedItemBorderColors","itemIdsToUpdateColor","updateBorderColorToLinkedItems","fromEntries","updatedItems","setBorderColor","tagSearcher","subscribeToExtension","onAfterAdd","onAfterEdit","onAfterRemove","itemEpic","removeEpicFromSearcher","PullSprint","listIdsToSkipAdding","listIdsToSkipUpdating","listIdsToSkipRemoving","sprintAdded","onSprintAdded","sprintUpdated","onSprintUpdated","sprintRemoved","onSprintRemoved","needSkipAdd","cleanSkipAdd","getSprintData","createSprintNode","needSkipUpdate","cleanSkipUpdate","currentStatus","updateYourself","moveSprintToActiveListNode","moveSprintToCompletedListNode","needSkipRemove","cleanSkipRemove","PullItem","itemMover","currentUserId","listToAddAfterUpdate","listIdsToSkipSorting","onCalculateSort","itemAdded","onItemAdded","itemUpdated","onItemUpdated","itemRemoved","onItemRemoved","itemSortUpdated","onItemSortUpdated","comment_add","onCommentAdd","setDelayedAdd","externalAdd","cleanDelayedAdd","getItemData","addItemToEntity","isDelayedAdd","updateItem","itemsSortInfo","itemsInfoToSort","needSkipSort","itemsToSort","newItems","itemInfoToSort","targetEntityId","moveToPosition","participants","includes","xmlId","entityXmlId","findItemBySourceId","getCurrentState","isDecompositionMode","cleanSubTasks","hasTaskInFilter","existingItem","isParentChangeAction","prototype","call","addTmpIdToSkipSorting","PullEpic","epicAdded","onEpicAdded","epicUpdated","onEpicUpdated","epicRemoved","onEpicRemoved","epicData","BaseEvent","setData","PullCounters","task_view","onTaskView","scrum_read_all","onCommentsReadAll","inputTaskId","ownerUserId","ownerId","TASK_ID","inputUserId","USER_ID","GROUP_ID","findItemBySourceInFilteredCompletedSprints","TaskCounters","getFilterManager","updateFields","subscribeToPull","onFilterApply","onCounterClick","Pull","fields","counter","toggleByField","filterField","filterValue","isFilteredByField","isFilteredByFieldValue","getFilterFields","getAttribute","getFields","deleteField","apply","FilterHandler","filteredItemsData","completedSprint","clearLoadItemsRepeatCounter","existsAtLeastOneItem","ceil","getPageSize","hideFilteredCompletedSprints","Decomposition","PullTag","tag_changed","onTagChanged","tagDialogs","getInstances","updatedTags","oldTagsNames","updatedTag","oldTagName","newTagName","itemsToUpdate","updatedTagFromArray","currentTags","array","tagInArr","newTags","Plan","pathToTaskCreate","defaultResponsible","activeSprintId","addBacklog","buildBacklog","taskCounters","pullSprint","addTmpIdToSkipAdding","subscribeToSprint","onActionPanelScroll","searchItems","sprintMover","itemDesigner","filterHandler","pullTag","getCurrentGroupId","pullItem","getCurrentUserId","pullEpic","onCreateTaskItem","onTagsSearchOpen","onTagsSearchClose","onEpicSearchOpen","onEpicSearchClose","onRenderInput","onRemoveInput","renderTo","ShortView","onChangeShortView","saveDisplayPriority","destroyActionPanel","saveShortView","onShowBacklogInput","onOpenAddTaskForm","onUpdateItem","onShowTask","onDestroyActionPanel","onChangeTaskResponsible","onShowResponsibleDialog","onOpenEpicForm","onFilterByEpic","onFilterByTag","onToggleActionPanel","onShowLinked","onShowBlank","onDeactivateGroupMode","onkeydown","onDocumentKeyDown","onDocumentClick","onShowSprintInput","onCreateSprint","onGetSubTasks","onStartSprint","onCompleteSprint","onRemoveSprint","onChangeSprintName","onGetSprintCompletedItems","onShowSprintBurnDownChart","onOpenSprintAddMenu","onShowDropZone","onToggleVisibilityContent","prevented","diskManager","closeAttachmentMenu","showInput","unLockTaskButton","subscribeOnce","path","openSidePanelByUrl","deactivateDraggable","getEntity","activateDraggable","isTaskCreated","showBlank","getParentItem","deactivateDecompositionMode","createItem","addIdToSkipUpdating","getNumberDecompositionsPerformed","addNumberDecompositionsPerformed","sendRequestToCreateTask","fillItemAfterCreation","addTask","subTaskInfo","updateData","isStoryPointsUpdated","getSubTaskItems","subTaskItem","deactivateSubTaskLoading","changeTaskResponsible","openAddForm","unLockEpicButton","sprintSidePanel","showStartForm","showCompletionForm","innerBaseEvent","getPathToTask","addIdToSkipRemoving","changeSprintName","changeSprintDeadline","getSprintCompletedItems","showBurnDownChart","sprintAddMenu","buttonRect","setTarget","getMenuContainer","showTagsSearchDialog","closeTagsSearchDialog","getValueFromField","setValuesToField","scrollToSearchContainer","showEpicSearchDialog","closeEpicSearchDialog","setValueToField","changeShortView","repeatedClick","getItem","hasItemInGroupMode","showActionPanel","baseItem","showLinkedTasks","itemsData","calculatePanelTopPosition","hasActionPanelDialog","closeActionPanelDialogs","saveSprintVisibility","isHidden","hasEntity","renderInput","setEntity","isElementNode","setBindNode","insertAfter","cleanBindNode","scrollToInput","topPosition","stopSearch","isMultipleAction","isEditAllowed","groupItems","attachFilesToTask","showAttachmentMenu","showDod","isMovable","moveItem","moveToSprint","moveToBacklog","showTagSearcher","showEpicSearcher","startBacklogDecomposition","startSprintDecomposition","isRemoveAllowed","removeGroupItems","valueWithoutEpic","getInfo","createTask","responseData","skipNotifications","showTagsDialog","removeTaskTags","splice","indexOf","isEpicDialogShown","showEpicDialog","updateItemEpics","removeItems","getRandomColorForItemBorder","activateDecompositionMode","renderInputAfterSubTasks","CompleteSprintButton","canCompleteSprint","completeBtn","ButtonColor","PRIMARY","ButtonSize","EXTRA_SMALL","noCaps","onCompleteSprintClick","setStyle","ButtonState","DISABLED","RobotButton","isTaskLimitsExceeded","canUseAutomation","isAutomationEnabled","robotBtn","LIGHT_BORDER","dependOnTheme","isShowLimitSidePanel","setIcon","ButtonIcon","LOCK","ROBOTS","sliderCode","FeaturePromotersRegistry","getPromoter","InfoHelper","isLimit","limitAnalyticsLabels","module","customLeftBoundary","cacheable","ActiveSprint","setParams","setKanbanStyle","robotButton","isCanUseAutomation","checkIsAutomationEnabled","completeSprintButton","setTaskLimitsExceeded","taskLimitExceeded","setCanUseAutomation","setIsAutomationEnabled","limitExceeded","kanbanManager","Scrum","Kanban","bindKanbanHandlers","getKanban","getKanbansGroupedByParentTasks","kanban","kanbanItem","targetColumn","beforeItem","onItemMoved","BurnDownButton","burnDownButton","CompletedSprint","onSprintSelectorChange","currentSprint","findSprintBySprintId","Entry","buildView","setViewName","viewName","culture","availableViews","getViewName","setView","getView","renderTabsTo","renderSprintStatsTo","renderRightElementsTo","refreshIcons","setDisplayPriority","childNodes"],"mappings":"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"}