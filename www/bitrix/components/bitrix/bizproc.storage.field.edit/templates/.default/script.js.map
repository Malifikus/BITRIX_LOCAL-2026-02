{"version":3,"file":"script.js","sources":["src/storage-field-edit.js"],"sourcesContent":["import { Type, Dom, Event, Loc, Reflection, ajax, Runtime } from 'main.core';\nimport { Button, ButtonManager } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport { Loader } from 'main.loader';\n\nimport './style.css';\n\nexport class StorageFieldEdit\n{\n\tstatic instance: ?StorageFieldEdit = null;\n\tformNode: ?Element = null;\n\ttabContainer: Element;\n\terrorsContainer: ?Element = null;\n\ttabs: Map<string, Element> = new Map();\n\tcontainer: Element = null;\n\tinputs: Map = new Map();\n\tsettingsTable: ?Element = null;\n\tsaveButton: ?Button = null;\n\tdeleteButton: ?Button = null;\n\tskipSave: boolean = false;\n\n\tconstructor(options: {\n\t\tformName: string,\n\t\ttabContainer: ?Element,\n\t\tskipSave: boolean,\n\t})\n\t{\n\t\tthis.inputs = new Map();\n\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tif (options.formName)\n\t\t\t{\n\t\t\t\tthis.formNode = document.querySelector(`form[data-role=\"${options.formName}\"]`);\n\t\t\t\tconst saveButtonNode = this.formNode.querySelector('#ui-button-panel-save');\n\t\t\t\tif (saveButtonNode)\n\t\t\t\t{\n\t\t\t\t\tthis.saveButton = ButtonManager.createFromNode(saveButtonNode);\n\t\t\t\t}\n\t\t\t\tconst deleteButtonNode = this.formNode.querySelector('#ui-button-panel-remove');\n\t\t\t\tif (deleteButtonNode)\n\t\t\t\t{\n\t\t\t\t\tthis.deleteButton = ButtonManager.createFromNode(deleteButtonNode);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (Type.isElementNode(options.tabContainer))\n\t\t\t{\n\t\t\t\tthis.tabContainer = options.tabContainer;\n\t\t\t}\n\n\t\t\tif (Type.isDomNode(options.errorsContainer))\n\t\t\t{\n\t\t\t\tthis.errorsContainer = options.errorsContainer;\n\t\t\t}\n\n\t\t\tif (options.skipSave)\n\t\t\t{\n\t\t\t\tthis.skipSave = options.skipSave;\n\t\t\t}\n\t\t}\n\n\t\tthis.init();\n\t\tStorageFieldEdit.instance = this;\n\t}\n\n\tinit(): void\n\t{\n\t\tif (!this.formNode)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst userTypeIdSelector = this.getInput('type');\n\t\tif (userTypeIdSelector)\n\t\t{\n\t\t\tEvent.bind(userTypeIdSelector, 'change', this.handleUserTypeChange.bind(this));\n\t\t}\n\n\t\tEvent.bind(this.formNode, 'submit', (event: Event) => {\n\t\t\tevent.preventDefault();\n\t\t\tconst eventName = event.submitter?.name;\n\t\t\tthis.onHandleSubmitForm(eventName);\n\t\t});\n\n\t\tthis.fillTabs();\n\t}\n\n\tfillTabs(): void\n\t{\n\t\tif (this.tabContainer)\n\t\t{\n\t\t\tconst tabs = this.tabContainer.querySelectorAll('.bizproc-storage-field-edit-tab');\n\t\t\ttabs.forEach((tabNode: HTMLDivElement) => {\n\t\t\t\tif (tabNode.dataset.tab)\n\t\t\t\t{\n\t\t\t\t\tthis.tabs.set(tabNode.dataset.tab, tabNode);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tresetSaveButton(): void\n\t{\n\t\tif (this.saveButton)\n\t\t{\n\t\t\tDom.removeClass(this.saveButton.getContainer(), 'ui-btn-wait');\n\t\t}\n\t}\n\n\tresetRemoveButton(): void\n\t{\n\t\tif (this.deleteButton)\n\t\t{\n\t\t\tDom.removeClass(this.deleteButton.getContainer(), 'ui-btn-wait');\n\t\t}\n\t}\n\n\tonHandleSubmitForm(eventName: string): void\n\t{\n\t\tconst fields = this.#collectFormFields();\n\t\tconst isUpdate = fields.id > 0;\n\t\tconst isRemove = eventName === 'remove';\n\n\t\tif (isRemove)\n\t\t{\n\t\t\tMessageBox.confirm(\n\t\t\t\tLoc.getMessage('BIZPROC_STORAGE_FIELD_EDIT_CONFIRM_MESSAGE') ?? '',\n\t\t\t\t(messageBox) => {\n\t\t\t\t\tthis.sendForm(\n\t\t\t\t\t\t'bizproc.storage.deleteField',\n\t\t\t\t\t\t{ id: fields.id },\n\t\t\t\t\t\t'BIZPROC_STORAGE_FIELD_EDIT_DELETE_MESSAGE',\n\t\t\t\t\t\tmessageBox,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tLoc.getMessage('BIZPROC_STORAGE_FIELD_EDIT_CONFIRM_MESSAGE_OK') ?? '',\n\t\t\t\t(messageBox) => {\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t\tthis.resetRemoveButton();\n\t\t\t\t},\n\t\t\t);\n\n\t\t\treturn;\n\t\t}\n\n\t\tlet action = isUpdate ? 'bizproc.storage.updateField' : 'bizproc.storage.addField';\n\t\tlet successMessageCode = 'BIZPROC_STORAGE_FIELD_EDIT_SAVE_MESSAGE';\n\t\tconst data = { field: fields };\n\t\tif (this.skipSave)\n\t\t{\n\t\t\taction = 'bizproc.storage.getPreparedForm';\n\t\t\tsuccessMessageCode = 'BIZPROC_STORAGE_FIELD_EDIT_ADD_MESSAGE'\n\t\t}\n\n\t\tdata.format = true;\n\n\t\tthis.sendForm(\n\t\t\taction,\n\t\t\tdata,\n\t\t\tsuccessMessageCode,\n\t\t);\n\t}\n\n\t#collectFormFields(): Record<string, any>\n\t{\n\t\tconst disabledElements = this.formNode.querySelectorAll('[disabled]');\n\t\tdisabledElements.forEach((el) => {\n\t\t\tel.removeAttribute('disabled');\n\t\t});\n\n\t\tconst formData = new FormData(this.formNode);\n\t\tconst fields: Record<string, any> = {};\n\n\t\tconst checkboxes = this.formNode.querySelectorAll('input[type=\"checkbox\"]');\n\t\tcheckboxes.forEach((checkbox) => {\n\t\t\tif (!checkbox.checked)\n\t\t\t{\n\t\t\t\tformData.set(checkbox.name, 'N');\n\t\t\t}\n\t\t});\n\n\t\tfor (const [key, value] of formData.entries())\n\t\t{\n\t\t\tthis.#setNestedValue(fields, key, value);\n\t\t}\n\n\t\tdisabledElements.forEach((el) => {\n\t\t\tel.setAttribute('disabled', 'disabled');\n\t\t});\n\n\t\treturn fields;\n\t}\n\n\t#setNestedValue(obj: Object, key: string, value): void\n\t{\n\t\tconst keys = key.match(/[^[\\]]+/g);\n\t\tif (!keys)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet current = obj;\n\t\tfor (let i = 0; i < keys.length - 1; i++)\n\t\t{\n\t\t\tconst part = keys[i];\n\t\t\tif (!current[part] || !Type.isObject(current[part]))\n\t\t\t{\n\t\t\t\tcurrent[part] = {};\n\t\t\t}\n\t\t\tcurrent = current[part];\n\t\t}\n\n\t\tcurrent[keys[keys.length - 1]] = value;\n\t}\n\n\tsendForm(action: string, data: Object, successMessageCode: string, messageBox?: any): void\n\t{\n\t\tajax.runAction(action, { data })\n\t\t\t.then((response) => {\n\t\t\t\tif (response.data)\n\t\t\t\t{\n\t\t\t\t\ttop.BX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: Loc.getMessage(successMessageCode) ?? '',\n\t\t\t\t\t});\n\n\t\t\t\t\tconst idNode = this.formNode.querySelector('input[name=\"id\"]');\n\t\t\t\t\tif (idNode && response.data.id)\n\t\t\t\t\t{\n\t\t\t\t\t\tidNode.value = response.data.id;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (messageBox)\n\t\t\t\t\t{\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.reloadListSlider();\n\n\t\t\t\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\t\t\t\tif (slider)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst dictionary: BX.SidePanel.Dictionary = slider.getData();\n\t\t\t\t\t\tconst fieldData = (action === 'bizproc.storage.deleteField')\n\t\t\t\t\t\t\t? { id: data?.id || null, action: action }\n\t\t\t\t\t\t\t: response.data\n\t\t\t\t\t\t;\n\t\t\t\t\t\tdictionary.set(\n\t\t\t\t\t\t\t'data',\n\t\t\t\t\t\t\tfieldData,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tslider.close();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.resetSaveButton();\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconst message = error.errors?.[0]?.message || 'Unknown error';\n\t\t\t\tMessageBox.alert(message);\n\t\t\t\tthis.resetSaveButton();\n\t\t\t});\n\t}\n\n\treloadListSlider(): void\n\t{\n\t\tconst slider = this.getSlider();\n\t\tif (slider)\n\t\t{\n\t\t\tBX.SidePanel.Instance.postMessage(slider, 'storage-field-list-update');\n\t\t}\n\t}\n\n\tgetSlider(): ?BX.SidePanel.Slider\n\t{\n\t\tif (Reflection.getClass('BX.SidePanel'))\n\t\t{\n\t\t\treturn BX.SidePanel.Instance.getSliderByWindow(window);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tshowTab(tabNameToShow: string)\n\t{\n\t\t[...this.tabs.keys()].forEach((tabName: string) => {\n\t\t\tif (tabName === tabNameToShow)\n\t\t\t{\n\t\t\t\tDom.addClass(this.tabs.get(tabName), 'bizproc-storage-field-edit-tab-current');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.tabs.get(tabName), 'bizproc-storage-field-edit-tab-current');\n\t\t\t}\n\t\t});\n\t}\n\n\thandleUserTypeChange(): void\n\t{\n\t\tconst userTypeId = this.getSelectedUserTypeId();\n\t\tif (!userTypeId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// TODO render default value\n\t}\n\n\tgetSettingsContainer(): ?Element\n\t{\n\t\tthis.container = this.formNode;\n\t\tif (this.container && !this.settingsContainer)\n\t\t{\n\t\t\tthis.settingsContainer = this.container.querySelector(\n\t\t\t\t'[data-role=\"bizproc-storage-field-settings-container\"]'\n\t\t\t);\n\t\t}\n\n\t\treturn this.settingsContainer;\n\t}\n\n\tgetSelectedUserTypeId(): ?string\n\t{\n\t\tconst option = this.getSelectedOption('type');\n\t\tif (option)\n\t\t{\n\t\t\treturn option.value;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetSelectedOption(inputName: string): ?HTMLOptionElement\n\t{\n\t\tconst input = this.getInput(inputName);\n\t\tif (input)\n\t\t{\n\t\t\tconst options = [...input.querySelectorAll('option')];\n\t\t\tconst index = input.selectedIndex;\n\n\t\t\treturn options[index];\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tadjustVisibility(): void\n\t{\n\t\tconst settingsTable = this.getSettingsTable();\n\t\tconst settingsTab = document.querySelector('[data-role=\"tab-settings\"]');\n\n\t\tif (!settingsTable || !settingsTab)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (settingsTable.childElementCount <= 0)\n\t\t{\n\t\t\tDom.hide(settingsTab);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.show(settingsTab);\n\t\t}\n\t\tconst userTypeId = this.getSelectedUserTypeId();\n\t\tif (userTypeId === 'boolean')\n\t\t{\n\t\t\tthis.changeInputVisibility('multiple', 'none');\n\t\t\tthis.changeInputVisibility('mandatory', 'none');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.changeInputVisibility('multiple', 'block');\n\t\t\tthis.changeInputVisibility('mandatory', 'block');\n\t\t}\n\t}\n\n\tchangeInputVisibility(inputName: string, display: string): void\n\t{\n\t\tconst input = this.getInput(inputName);\n\t\tif (input && input.parentElement && input.parentElement.parentElement)\n\t\t{\n\t\t\tif (display === 'block')\n\t\t\t{\n\t\t\t\tDom.show(input.parentElement.parentElement);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.hide(input.parentElement.parentElement);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetInput(name: string): ?Element\n\t{\n\t\tif (this.formNode)\n\t\t{\n\t\t\tconst input = this.formNode.querySelector(`[name=\"${name}\"]`);\n\t\t\tif (input)\n\t\t\t{\n\t\t\t\tthis.inputs.set(name, input);\n\t\t\t}\n\t\t}\n\n\t\treturn this.inputs.get(name);\n\t}\n\n\tshowErrors(errors: string[]): void\n\t{\n\t\tlet text = '';\n\t\terrors.forEach((message) => {\n\t\t\ttext += message;\n\t\t});\n\t\tif (Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = text;\n\t\t\tDom.show(this.errorsContainer.parentElement);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.error(text);\n\t\t}\n\t}\n\n\tgetLoader(): Loader\n\t{\n\t\tif (!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({ size: 150 });\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tstartProgress()\n\t{\n\t\tthis.isProgress = true;\n\t\tif (!this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().show(this.container);\n\t\t}\n\t\tthis.hideErrors();\n\t}\n\n\tstopProgress()\n\t{\n\t\tthis.isProgress = false;\n\t\tthis.getLoader().hide();\n\t\tsetTimeout(() => {\n\t\t\tthis.saveButton.setWaiting(false);\n\t\t\tthis.resetSaveButton();\n\t\t\tif (this.deleteButton)\n\t\t\t{\n\t\t\t\tthis.deleteButton.setWaiting(false);\n\t\t\t\tthis.resetRemoveButton();\n\t\t\t}\n\t\t}, 200);\n\t}\n\n\thideErrors()\n\t{\n\t\tif (Type.isDomNode(this.errorsContainer))\n\t\t{\n\t\t\tthis.errorsContainer.innerText = '';\n\t\t\tDom.hide(this.errorsContainer.parentElement);\n\t\t}\n\t}\n\n\tstatic handleLeftMenuClick(tabName: string): void\n\t{\n\t\tif (this.instance)\n\t\t{\n\t\t\tthis.instance.showTab(tabName);\n\t\t}\n\t}\n}\n"],"names":["StorageFieldEdit","constructor","options","formNode","errorsContainer","tabs","Map","container","inputs","settingsTable","saveButton","deleteButton","skipSave","Type","isPlainObject","formName","document","querySelector","saveButtonNode","ButtonManager","createFromNode","deleteButtonNode","isElementNode","tabContainer","isDomNode","init","instance","userTypeIdSelector","getInput","Event","bind","handleUserTypeChange","event","preventDefault","eventName","submitter","name","onHandleSubmitForm","fillTabs","querySelectorAll","forEach","tabNode","dataset","tab","set","resetSaveButton","Dom","removeClass","getContainer","resetRemoveButton","fields","isUpdate","id","isRemove","MessageBox","confirm","Loc","getMessage","messageBox","sendForm","close","action","successMessageCode","data","field","format","ajax","runAction","then","response","top","BX","UI","Notification","Center","notify","content","idNode","value","reloadListSlider","slider","SidePanel","Instance","getTopSlider","dictionary","getData","fieldData","catch","error","message","errors","alert","getSlider","postMessage","Reflection","getClass","getSliderByWindow","window","showTab","tabNameToShow","keys","tabName","addClass","get","userTypeId","getSelectedUserTypeId","getSettingsContainer","settingsContainer","option","getSelectedOption","inputName","input","index","selectedIndex","adjustVisibility","getSettingsTable","settingsTab","childElementCount","hide","show","changeInputVisibility","display","parentElement","showErrors","text","innerText","console","getLoader","loader","Loader","size","startProgress","isProgress","isShown","hideErrors","stopProgress","setTimeout","setWaiting","handleLeftMenuClick","disabledElements","el","removeAttribute","formData","FormData","checkboxes","checkbox","checked","key","entries","setAttribute","obj","match","current","i","length","part","isObject"],"mappings":"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"}