this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,s,a,l,t,i){"use strict";let r=e=>e,o;var d=babelHelpers.classPrivateFieldLooseKey("getCreateNewStorageHandler");class b extends i.DefaultFooter{constructor(e,s){super(e,s);Object.defineProperty(this,d,{value:c})}getContent(){return this.cache.remember("write-data-storage-activity",(()=>t.Tag.render(o||(o=r`
				<span onclick="${0}" class="ui-selector-footer-link ui-selector-footer-link-add">
					${0}
				</span>
			`),babelHelpers.classPrivateFieldLooseBase(this,d)[d](),t.Loc.getMessage("BIZPROC_WRITE_DATA_ACTIVITY_CREATE_NEW_STORAGE"))))}}function c(){const e=this.getOption("onCreateNewStorageHandler");if(t.Type.isNil(e)||!t.Type.isFunction(e)){throw Error('The "onCreateNewStorageHandler" option must be a function.')}return e}var n=babelHelpers.classPrivateFieldLooseKey("entityId");var v=babelHelpers.classPrivateFieldLooseKey("tabId");var p=babelHelpers.classPrivateFieldLooseKey("storageIdField");var P=babelHelpers.classPrivateFieldLooseKey("storageItems");var u=babelHelpers.classPrivateFieldLooseKey("eventHandlers");var h=babelHelpers.classPrivateFieldLooseKey("currentValue");var F=babelHelpers.classPrivateFieldLooseKey("createStorageItems");var L=babelHelpers.classPrivateFieldLooseKey("createTagSelector");var H=babelHelpers.classPrivateFieldLooseKey("createItemOptions");var B=babelHelpers.classPrivateFieldLooseKey("setSelectedStorage");class f{constructor(e,s,a){Object.defineProperty(this,B,{value:I});Object.defineProperty(this,H,{value:O});Object.defineProperty(this,L,{value:m});Object.defineProperty(this,F,{value:g});Object.defineProperty(this,h,{value:y});Object.defineProperty(this,n,{writable:true,value:"bizproc-storage"});Object.defineProperty(this,v,{writable:true,value:"storage-tab"});Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=s;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=a}getTagSelector(e){l.Router.init();const s=babelHelpers.classPrivateFieldLooseBase(this,F)[F]();return babelHelpers.classPrivateFieldLooseBase(this,L)[L](s)}}function y(){const e=parseInt(babelHelpers.classPrivateFieldLooseBase(this,p)[p].value);return Number.isNaN(e)?null:e}function g(){const e=babelHelpers.classPrivateFieldLooseBase(this,h)[h]();return babelHelpers.classPrivateFieldLooseBase(this,P)[P].map((s=>babelHelpers.classPrivateFieldLooseBase(this,H)[H](s,e!==null&&s.id===e)))}function m(e){return new i.TagSelector({dialogOptions:{items:e,tabs:[{id:babelHelpers.classPrivateFieldLooseBase(this,v)[v],title:t.Loc.getMessage("BIZPROC_WRITE_DATA_ACTIVITY_STORAGE_TAB_TITLE")}],width:400,height:300,enableSearch:true,compactView:true,dropdownMode:true,showAvatars:false,events:{"Item:onSelect":e=>{const{item:s}=e.getData();babelHelpers.classPrivateFieldLooseBase(this,p)[p].value=s.getId();babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatchEvent(new Event("change"))},"Item:onDeselect":e=>{babelHelpers.classPrivateFieldLooseBase(this,p)[p].value="";babelHelpers.classPrivateFieldLooseBase(this,p)[p].dispatchEvent(new Event("change"))}},footer:b,footerOptions:{onCreateNewStorageHandler:babelHelpers.classPrivateFieldLooseBase(this,u)[u].onCreateNewStorageHandler}},multiple:false,tagMaxWidth:500,textBoxWidth:100,events:{onAfterTagAdd:e=>{const s=e.getTarget();const{tag:a}=e.getData();const l=babelHelpers.classPrivateFieldLooseBase(this,H)[H]({id:a.id,title:a.title.text},true);s.dialog.addItem(l);babelHelpers.classPrivateFieldLooseBase(this,B)[B](a.id,a.title.text)}}})}function O(e,s=false){return{id:e.id,title:e.title,entityId:babelHelpers.classPrivateFieldLooseBase(this,n)[n],tabs:babelHelpers.classPrivateFieldLooseBase(this,v)[v],selected:s,linkTitle:t.Loc.getMessage("BIZPROC_WRITE_DATA_ACTIVITY_OPEN_STORAGE_LIST"),link:`/bitrix/components/bitrix/bizproc.storage.item.list/?storageId=${e.id}`}}function I(e,s){const a=babelHelpers.classPrivateFieldLooseBase(this,p)[p];let l=[...a.options].find((s=>s.value==e));if(!l){l=new Option(t.Text.encode(s!=null?s:""),t.Text.encode(e));a.add(l)}a.value=e;a.dispatchEvent(new Event("change"))}let S=e=>e,T,w,j,K;const E=t.Reflection.namespace("BX.Bizproc.Activity");var C=babelHelpers.classPrivateFieldLooseKey("fieldsContainer");var D=babelHelpers.classPrivateFieldLooseKey("storageSelectorContainer");var A=babelHelpers.classPrivateFieldLooseKey("storageIdField");var R=babelHelpers.classPrivateFieldLooseKey("storageCodeField");var _=babelHelpers.classPrivateFieldLooseKey("modeField");var N=babelHelpers.classPrivateFieldLooseKey("addFieldButton");var x=babelHelpers.classPrivateFieldLooseKey("documentType");var M=babelHelpers.classPrivateFieldLooseKey("storageFields");var z=babelHelpers.classPrivateFieldLooseKey("currentValues");var k=babelHelpers.classPrivateFieldLooseKey("fieldsMap");var V=babelHelpers.classPrivateFieldLooseKey("systemFields");var X=babelHelpers.classPrivateFieldLooseKey("storageItems");var W=babelHelpers.classPrivateFieldLooseKey("fieldMenu");var $=babelHelpers.classPrivateFieldLooseKey("dynamicStorage");var q=babelHelpers.classPrivateFieldLooseKey("fieldIndex");var G=babelHelpers.classPrivateFieldLooseKey("storageSelectorInstance");var Y=babelHelpers.classPrivateFieldLooseKey("fieldsCache");var Z=babelHelpers.classPrivateFieldLooseKey("onAfterFieldRendererHandler");var U=babelHelpers.classPrivateFieldLooseKey("onStorageRemoveHandler");var J=babelHelpers.classPrivateFieldLooseKey("bindEvents");var Q=babelHelpers.classPrivateFieldLooseKey("onStorageRemove");var ee=babelHelpers.classPrivateFieldLooseKey("onAfterFieldRenderer");var se=babelHelpers.classPrivateFieldLooseKey("configureStorageCodeField");var ae=babelHelpers.classPrivateFieldLooseKey("initializeFields");var le=babelHelpers.classPrivateFieldLooseKey("initializeDynamicStorageFields");var te=babelHelpers.classPrivateFieldLooseKey("initializeStaticStorageFields");var ie=babelHelpers.classPrivateFieldLooseKey("restoreSavedFieldValues");var re=babelHelpers.classPrivateFieldLooseKey("createNewStorage");var oe=babelHelpers.classPrivateFieldLooseKey("resetFieldContainer");var de=babelHelpers.classPrivateFieldLooseKey("onChangeStorageId");var be=babelHelpers.classPrivateFieldLooseKey("clearFields");var ce=babelHelpers.classPrivateFieldLooseKey("onChangeStorageCode");var ne=babelHelpers.classPrivateFieldLooseKey("onChangeMode");var ve=babelHelpers.classPrivateFieldLooseKey("openStorageEdit");var pe=babelHelpers.classPrivateFieldLooseKey("selectNewStorage");var Pe=babelHelpers.classPrivateFieldLooseKey("getStorageId");var ue=babelHelpers.classPrivateFieldLooseKey("getFields");var he=babelHelpers.classPrivateFieldLooseKey("onAddButtonClick");var Fe=babelHelpers.classPrivateFieldLooseKey("showDynamicFieldSelectionMenu");var Le=babelHelpers.classPrivateFieldLooseKey("buildDynamicMenuItems");var He=babelHelpers.classPrivateFieldLooseKey("showFieldSelectionMenu");var Be=babelHelpers.classPrivateFieldLooseKey("getAddedFieldIds");var fe=babelHelpers.classPrivateFieldLooseKey("buildMenuItems");var ye=babelHelpers.classPrivateFieldLooseKey("createFieldMenu");var ge=babelHelpers.classPrivateFieldLooseKey("createDynamicKeyField");var me=babelHelpers.classPrivateFieldLooseKey("createDynamicValueField");var Oe=babelHelpers.classPrivateFieldLooseKey("renderDynamicFieldRow");var Ie=babelHelpers.classPrivateFieldLooseKey("renderSystemFieldRow");var Se=babelHelpers.classPrivateFieldLooseKey("cleanupExistingMenu");var Te=babelHelpers.classPrivateFieldLooseKey("addDynamicStorageField");var we=babelHelpers.classPrivateFieldLooseKey("openFieldEdit");var je=babelHelpers.classPrivateFieldLooseKey("addStorageField");var Ke=babelHelpers.classPrivateFieldLooseKey("addField");var Ee=babelHelpers.classPrivateFieldLooseKey("editStorageField");var Ce=babelHelpers.classPrivateFieldLooseKey("editField");var De=babelHelpers.classPrivateFieldLooseKey("renderFieldRow");var Ae=babelHelpers.classPrivateFieldLooseKey("getSelectField");var Re=babelHelpers.classPrivateFieldLooseKey("getEqualSign");var _e=babelHelpers.classPrivateFieldLooseKey("getField");var Ne=babelHelpers.classPrivateFieldLooseKey("getDeleteButton");var xe=babelHelpers.classPrivateFieldLooseKey("getEditButton");var Me=babelHelpers.classPrivateFieldLooseKey("deleteFieldRow");var ze=babelHelpers.classPrivateFieldLooseKey("renderStorageSelector");var ke=babelHelpers.classPrivateFieldLooseKey("unbindEvents");class Ve{constructor(e){Object.defineProperty(this,ke,{value:Ds});Object.defineProperty(this,ze,{value:Cs});Object.defineProperty(this,Me,{value:Es});Object.defineProperty(this,xe,{value:Ks});Object.defineProperty(this,Ne,{value:js});Object.defineProperty(this,_e,{value:ws});Object.defineProperty(this,Re,{value:Ts});Object.defineProperty(this,Ae,{value:Ss});Object.defineProperty(this,De,{value:Is});Object.defineProperty(this,Ce,{value:Os});Object.defineProperty(this,Ee,{value:ms});Object.defineProperty(this,Ke,{value:gs});Object.defineProperty(this,je,{value:ys});Object.defineProperty(this,we,{value:fs});Object.defineProperty(this,Te,{value:Bs});Object.defineProperty(this,Se,{value:Hs});Object.defineProperty(this,Ie,{value:Ls});Object.defineProperty(this,Oe,{value:Fs});Object.defineProperty(this,me,{value:hs});Object.defineProperty(this,ge,{value:us});Object.defineProperty(this,ye,{value:Ps});Object.defineProperty(this,fe,{value:ps});Object.defineProperty(this,Be,{value:vs});Object.defineProperty(this,He,{value:ns});Object.defineProperty(this,Le,{value:cs});Object.defineProperty(this,Fe,{value:bs});Object.defineProperty(this,he,{value:ds});Object.defineProperty(this,ue,{value:os});Object.defineProperty(this,Pe,{value:rs});Object.defineProperty(this,pe,{value:is});Object.defineProperty(this,ve,{value:ts});Object.defineProperty(this,ne,{value:ls});Object.defineProperty(this,ce,{value:as});Object.defineProperty(this,be,{value:ss});Object.defineProperty(this,de,{value:es});Object.defineProperty(this,oe,{value:Qe});Object.defineProperty(this,re,{value:Je});Object.defineProperty(this,ie,{value:Ue});Object.defineProperty(this,te,{value:Ze});Object.defineProperty(this,le,{value:Ye});Object.defineProperty(this,ae,{value:Ge});Object.defineProperty(this,se,{value:qe});Object.defineProperty(this,ee,{value:$e});Object.defineProperty(this,Q,{value:We});Object.defineProperty(this,J,{value:Xe});Object.defineProperty(this,C,{writable:true,value:void 0});Object.defineProperty(this,D,{writable:true,value:void 0});Object.defineProperty(this,A,{writable:true,value:void 0});Object.defineProperty(this,R,{writable:true,value:void 0});Object.defineProperty(this,_,{writable:true,value:void 0});Object.defineProperty(this,N,{writable:true,value:void 0});Object.defineProperty(this,x,{writable:true,value:void 0});Object.defineProperty(this,M,{writable:true,value:void 0});Object.defineProperty(this,z,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,V,{writable:true,value:void 0});Object.defineProperty(this,X,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:void 0});Object.defineProperty(this,$,{writable:true,value:void 0});Object.defineProperty(this,q,{writable:true,value:void 0});Object.defineProperty(this,G,{writable:true,value:void 0});Object.defineProperty(this,Y,{writable:true,value:new Map});Object.defineProperty(this,Z,{writable:true,value:void 0});Object.defineProperty(this,U,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e.fieldsContainer;babelHelpers.classPrivateFieldLooseBase(this,D)[D]=e.storageSelectorContainer;babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e.storageIdField;babelHelpers.classPrivateFieldLooseBase(this,R)[R]=e.storageCodeField;babelHelpers.classPrivateFieldLooseBase(this,_)[_]=e.modeField;babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e.addFieldButton;babelHelpers.classPrivateFieldLooseBase(this,x)[x]=e.documentType;babelHelpers.classPrivateFieldLooseBase(this,M)[M]=[];babelHelpers.classPrivateFieldLooseBase(this,z)[z]=e.currentValues;babelHelpers.classPrivateFieldLooseBase(this,V)[V]=e.systemFields;babelHelpers.classPrivateFieldLooseBase(this,X)[X]=t.Type.isArray(e.storageItems)?e.storageItems:[];babelHelpers.classPrivateFieldLooseBase(this,q)[q]=0;babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee].bind(this);babelHelpers.classPrivateFieldLooseBase(this,U)[U]=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q].bind(this);babelHelpers.classPrivateFieldLooseBase(this,J)[J]();babelHelpers.classPrivateFieldLooseBase(this,se)[se]();babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](e);babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]()}destroy(){babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]()}}function Xe(){t.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,A)[A],"change",babelHelpers.classPrivateFieldLooseBase(this,de)[de].bind(this));t.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,R)[R],"change",babelHelpers.classPrivateFieldLooseBase(this,ce)[ce].bind(this));t.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,_)[_],"change",babelHelpers.classPrivateFieldLooseBase(this,ne)[ne].bind(this));t.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,N)[N],"click",babelHelpers.classPrivateFieldLooseBase(this,he)[he].bind(this));s.EventEmitter.subscribe("BX.Bizproc.FieldType.onDesignerRenderControlFinished",babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]);s.EventEmitter.subscribe("BX.Bizproc.Component.StorageItemList:onStorageRemove",babelHelpers.classPrivateFieldLooseBase(this,U)[U])}function We(e){const s=Number(e.getData().storageId);if(s<=0){return}babelHelpers.classPrivateFieldLooseBase(this,X)[X]=babelHelpers.classPrivateFieldLooseBase(this,X)[X].filter((e=>e.id!==s));babelHelpers.classPrivateFieldLooseBase(this,be)[be]();babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]()}function $e(e){const s=e.data.node;const a=s.querySelector('textarea[name="field_values[]"], textarea[name="field_keys[]"]');if(!a)return;const l=a.name==="field_values[]";const t=Math.random().toString(36).substr(2,9);const i="field_"+(l?"values":"keys")+"_"+t;a.id=i;const r=s.querySelector('[data-role="bp-selector-button"]');if(!r)return;const o=r.getAttribute("onclick");if(o){const e=o.replace(/BPAShowSelector\('([^']+)'(\s*,\s*[^)]+)\)/,"BPAShowSelector('"+i+"'$2)");r.setAttribute("onclick",e)}}function qe(){const e=babelHelpers.classPrivateFieldLooseBase(this,R)[R].closest('[data-cid="StorageCode"]')}function Ge(e){const s=babelHelpers.classPrivateFieldLooseBase(this,R)[R].value;if(t.Type.isStringFilled(s)){babelHelpers.classPrivateFieldLooseBase(this,le)[le]()}else{babelHelpers.classPrivateFieldLooseBase(this,te)[te](e.fields)}const a=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();if(a<=0&&!t.Type.isStringFilled(s)){t.Dom.hide(babelHelpers.classPrivateFieldLooseBase(this,N)[N])}}function Ye(){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=true;for(const[e,s]of Object.entries(babelHelpers.classPrivateFieldLooseBase(this,z)[z])){if(s){babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](e,s)}}}function Ze(e){babelHelpers.classPrivateFieldLooseBase(this,$)[$]=false;if(!t.Type.isArrayFilled(e)&&!t.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,V)[V])){return}babelHelpers.classPrivateFieldLooseBase(this,M)[M]=[...babelHelpers.classPrivateFieldLooseBase(this,V)[V],...e];babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]()}function Ue(){for(const[e,s]of Object.entries(babelHelpers.classPrivateFieldLooseBase(this,z)[z])){if(s&&(!t.Type.isArray(s)||s.length>0)){const a=babelHelpers.classPrivateFieldLooseBase(this,M)[M].find((s=>s.FieldName===e));if(a){a.Value=s;babelHelpers.classPrivateFieldLooseBase(this,Ke)[Ke](a)}}}}async function Je(){var e;const s=await babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]();if(t.Type.isNil(s)){return}const a=s.storageId;const l=(e=s.storageTitle)!=null?e:"";babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](a,l);await babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](a)}async function Qe(e){const s=await babelHelpers.classPrivateFieldLooseBase(this,ue)[ue](e);babelHelpers.classPrivateFieldLooseBase(this,M)[M]=[...babelHelpers.classPrivateFieldLooseBase(this,V)[V],...s];t.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,C)[C]);t.Dom.show(babelHelpers.classPrivateFieldLooseBase(this,N)[N])}async function es(e){if(babelHelpers.classPrivateFieldLooseBase(this,$)[$]){babelHelpers.classPrivateFieldLooseBase(this,R)[R].value=""}babelHelpers.classPrivateFieldLooseBase(this,$)[$]=false;const s=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();if(s<=0){babelHelpers.classPrivateFieldLooseBase(this,be)[be]();return}await babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](s)}function ss(){t.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,C)[C]);t.Dom.hide(babelHelpers.classPrivateFieldLooseBase(this,N)[N])}function as(e){const s=e.currentTarget.value.trim();if(!t.Type.isStringFilled(s)){babelHelpers.classPrivateFieldLooseBase(this,be)[be]();return}if(!babelHelpers.classPrivateFieldLooseBase(this,$)[$]){t.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,C)[C])}if(babelHelpers.classPrivateFieldLooseBase(this,G)[G]){babelHelpers.classPrivateFieldLooseBase(this,G)[G].removeTags()}babelHelpers.classPrivateFieldLooseBase(this,$)[$]=true;t.Dom.show(babelHelpers.classPrivateFieldLooseBase(this,N)[N])}function ls(e){const s=e.currentTarget.value;const a=document.querySelector('[data-cid="ItemId"]');if(!a){return}if(s===Ve.Mode.MERGE||s===Ve.Mode.REWRITE){t.Dom.show(a)}else{t.Dom.hide(a)}}function ts(){return new Promise((e=>{t.Runtime.loadExtension("bizproc.router").then((({Router:s})=>{s.openStorageEdit({events:{onCloseComplete:s=>{const a=s.getSlider();const l=a?a.getData():null;let t=null;if(l&&l.has("data")){t={storageId:l.get("data").storageId||null,storageTitle:l.get("data").storageTitle||""}}e(t)}}})})).catch((s=>{console.error(s);e(null)}))}))}function is(e,s){const a=babelHelpers.classPrivateFieldLooseBase(this,G)[G].addTag({id:e,title:s,entityId:"bizproc-storage",link:`/bitrix/components/bitrix/bizproc.storage.item.list/?storageId=${e}`})}function rs(){return babelHelpers.classPrivateFieldLooseBase(this,A)[A].value?Number(babelHelpers.classPrivateFieldLooseBase(this,A)[A].value):null}async function os(e){if(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].has(e)){return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].get(e)}const s=await t.ajax.runAction(Ve.Action.GET_FIELDS,{data:{storageId:e,format:true}});if(s.status==="success"){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].set(e,s.data);return s.data}return[]}function ds(e){e.preventDefault();if(!babelHelpers.classPrivateFieldLooseBase(this,$)[$]){babelHelpers.classPrivateFieldLooseBase(this,He)[He]()}else{babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]()}}function bs(){const e=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]();const s=babelHelpers.classPrivateFieldLooseBase(this,Le)[Le](e);babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]();babelHelpers.classPrivateFieldLooseBase(this,W)[W]=babelHelpers.classPrivateFieldLooseBase(this,ye)[ye](s);babelHelpers.classPrivateFieldLooseBase(this,W)[W].show()}function cs(e){var s;const a=this;const l=[];for(const s of babelHelpers.classPrivateFieldLooseBase(this,V)[V]){if(!e.has(s.FieldName)&&t.Type.isStringFilled(s.Name)){l.push({text:t.Text.encode(s.Name),onclick(){this.popupWindow.close();babelHelpers.classPrivateFieldLooseBase(a,Te)[Te](t.Text.encode(s.FieldName))}})}}l.push({text:(s=t.Loc.getMessage("BIZPROC_WRITE_DATA_ACTIVITY_ANOTHER_FIELD"))!=null?s:"",async onclick(){this.popupWindow.close();babelHelpers.classPrivateFieldLooseBase(a,Te)[Te]()}});return l}function ns(){const e=babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]();const s=babelHelpers.classPrivateFieldLooseBase(this,fe)[fe](e);babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]();babelHelpers.classPrivateFieldLooseBase(this,W)[W]=babelHelpers.classPrivateFieldLooseBase(this,ye)[ye](s);babelHelpers.classPrivateFieldLooseBase(this,W)[W].show()}function vs(){const e=Array.from(babelHelpers.classPrivateFieldLooseBase(this,C)[C].querySelectorAll("tr[data-id]"));return new Set(e.map((e=>e.dataset.id)))}function ps(e){var s;const a=this;const l=[{text:(s=t.Loc.getMessage("BIZPROC_WRITE_DATA_ACTIVITY_CREATE_NEW_FIELD"))!=null?s:"",async onclick(){this.popupWindow.close();const e=await babelHelpers.classPrivateFieldLooseBase(a,we)[we]();if(e){babelHelpers.classPrivateFieldLooseBase(a,je)[je](e);babelHelpers.classPrivateFieldLooseBase(a,Ke)[Ke](e)}}}];for(const s of babelHelpers.classPrivateFieldLooseBase(this,M)[M]){const i=String(s.Id);if(!e.has(i)&&t.Type.isStringFilled(s.Name)){l.push({text:t.Text.encode(s.Name),onclick(){this.popupWindow.close();babelHelpers.classPrivateFieldLooseBase(a,Ke)[Ke](s)}})}}return l}function Ps(e){return a.PopupMenu.create({id:`bp_wsa_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,bindElement:babelHelpers.classPrivateFieldLooseBase(this,N)[N],autoHide:true,items:e,events:{onPopupClose:()=>{babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]()}}})}function us(e=""){const s=babelHelpers.classPrivateFieldLooseBase(this,q)[q];babelHelpers.classPrivateFieldLooseBase(this,q)[q]++;return{Id:e?e:`dynamic_${s}`,Name:"",FieldName:`field_keys[]`,Type:"string",Required:false,AllowSelection:true,Value:e}}function hs(e=""){const s=babelHelpers.classPrivateFieldLooseBase(this,q)[q];babelHelpers.classPrivateFieldLooseBase(this,q)[q]++;return{Id:e?e:`dynamic_${s}`,Name:"",FieldName:`field_values[]`,Type:"string",Required:false,AllowSelection:true,Value:e}}function Fs(e,s,a){const l=e.insertCell(-1);t.Dom.addClass(l,"dynamic-field");t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,_e)[_e](s,s.Value),l);t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Re)[Re](),e.insertCell(-1));t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,_e)[_e](a,a.Value),e.insertCell(-1));t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne](e),e.insertCell(-1))}function Ls(e,s,a){const l=e.insertCell(-1);t.Dom.addClass(l,"locked-field");t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,_e)[_e](s,s.Value),l);t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Re)[Re](),e.insertCell(-1));t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,_e)[_e](a,a.Value),e.insertCell(-1));t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne](e),e.insertCell(-1))}function Hs(){if(babelHelpers.classPrivateFieldLooseBase(this,W)[W]&&babelHelpers.classPrivateFieldLooseBase(this,W)[W].getId()){a.PopupMenu.destroy(babelHelpers.classPrivateFieldLooseBase(this,W)[W].getId());babelHelpers.classPrivateFieldLooseBase(this,W)[W]=null}}function Bs(e,s){const a=babelHelpers.classPrivateFieldLooseBase(this,ge)[ge](e);const l=babelHelpers.classPrivateFieldLooseBase(this,me)[me](s);const t=babelHelpers.classPrivateFieldLooseBase(this,C)[C].insertRow(-1);t.dataset.id=a.Id;const i=babelHelpers.classPrivateFieldLooseBase(this,V)[V].findIndex((s=>s.Id===e));if(i!==-1){babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie](t,a,l)}else{babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe](t,a,l)}}function fs(e=null){return new Promise((s=>{t.Runtime.loadExtension("bizproc.router").then((({Router:a})=>{a.openStorageFieldEdit({events:{onCloseComplete:e=>{const a=e.getSlider();const l=a?a.getData():null;let t=null;if(l&&l.has("data")){t=l.get("data")}s(t)}},requestMethod:"get",requestParams:{storageId:babelHelpers.classPrivateFieldLooseBase(this,A)[A].value,fieldId:e}})})).catch((e=>{console.error(e);s(null)}))}))}function ys(e){babelHelpers.classPrivateFieldLooseBase(this,M)[M].push(e)}function gs(e){const s=babelHelpers.classPrivateFieldLooseBase(this,C)[C].insertRow(-1);s.dataset.id=e.Id;babelHelpers.classPrivateFieldLooseBase(this,De)[De](s,e)}function ms(e){const s=babelHelpers.classPrivateFieldLooseBase(this,M)[M].findIndex((s=>s.Id===e.Id));if(s!==-1){babelHelpers.classPrivateFieldLooseBase(this,M)[M][s]=e}}function Os(e){const s=babelHelpers.classPrivateFieldLooseBase(this,C)[C].querySelector(`tr[data-id="${e.Id}"]`);if(s){t.Dom.clean(s);babelHelpers.classPrivateFieldLooseBase(this,De)[De](s,e)}}function Is(e,s){const a=e.insertCell(-1);t.Dom.addClass(a,"static-field");t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Ae)[Ae](s.Name),a);t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Re)[Re](),e.insertCell(-1));t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,_e)[_e](s),e.insertCell(-1));const l=babelHelpers.classPrivateFieldLooseBase(this,xe)[xe](e,s.Id);if(l){t.Dom.append(l,e.insertCell(-1))}else{e.insertCell(-1)}t.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne](e),e.insertCell(-1))}function Ss(e){return t.Tag.render(T||(T=S`<span>${0}</span>`),t.Text.encode(e))}function Ts(){return t.Tag.render(w||(w=S`<span>=</span>`))}function ws(e,s=null){var a;let l=(a=babelHelpers.classPrivateFieldLooseBase(this,z)[z][e.FieldName])!=null?a:null;if(s){l=s}return BX.Bizproc.FieldType.renderControl(babelHelpers.classPrivateFieldLooseBase(this,x)[x],e,e.FieldName,l,"designer")}function js(e){const s=t.Tag.render(j||(j=S`<a href="#"><div class="ui-icon-set --cross-m"></div></a>`));t.Event.bind(s,"click",(s=>{s.preventDefault();t.Dom.remove(e)}));return s}function Ks(e,s){const a=t.Tag.render(K||(K=S`<a href="#"><div class="ui-icon-set --edit-m"></div></a>`));const l=babelHelpers.classPrivateFieldLooseBase(this,V)[V].map((e=>e.Id));if(l.includes(s)){return null}t.Event.bind(a,"click",(async e=>{e.preventDefault();const a=await babelHelpers.classPrivateFieldLooseBase(this,we)[we](s);if(!a){return}const l=a.action==="bizproc.storage.deleteField"&&a.id;if(l){babelHelpers.classPrivateFieldLooseBase(this,Me)[Me](Number(a.id));babelHelpers.classPrivateFieldLooseBase(this,M)[M]=babelHelpers.classPrivateFieldLooseBase(this,M)[M].filter((e=>e.Id!==Number(a.id)))}else{babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee](a);babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce](a)}}));return a}function Es(e){const s=babelHelpers.classPrivateFieldLooseBase(this,C)[C].querySelector(`[data-id="${e}"]`);if(s){t.Dom.remove(s)}}function Cs(){var e;babelHelpers.classPrivateFieldLooseBase(this,D)[D].innerHTML="";babelHelpers.classPrivateFieldLooseBase(this,G)[G]=new f(babelHelpers.classPrivateFieldLooseBase(this,A)[A],(e=babelHelpers.classPrivateFieldLooseBase(this,X)[X])!=null?e:[],{onCreateNewStorageHandler:babelHelpers.classPrivateFieldLooseBase(this,re)[re].bind(this)}).getTagSelector();babelHelpers.classPrivateFieldLooseBase(this,G)[G].renderTo(babelHelpers.classPrivateFieldLooseBase(this,D)[D])}function Ds(){t.Event.unbindAll(babelHelpers.classPrivateFieldLooseBase(this,A)[A]);t.Event.unbindAll(babelHelpers.classPrivateFieldLooseBase(this,R)[R]);t.Event.unbindAll(babelHelpers.classPrivateFieldLooseBase(this,_)[_]);t.Event.unbindAll(babelHelpers.classPrivateFieldLooseBase(this,N)[N]);babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].clear();if(babelHelpers.classPrivateFieldLooseBase(this,G)[G]){babelHelpers.classPrivateFieldLooseBase(this,G)[G].destroy()}s.EventEmitter.unsubscribe("BX.Bizproc.FieldType.onDesignerRenderControlFinished",babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]);s.EventEmitter.unsubscribe("BX.Bizproc.Component.StorageItemList:onStorageRemove",babelHelpers.classPrivateFieldLooseBase(this,U)[U])}Ve.Mode={MERGE:"mergeFields",REWRITE:"rewriteFields"};Ve.Action={GET_FIELDS:"bizproc.storage.getFieldsByStorageId"};E.WriteDataStorageActivity=Ve})(this.BX.Bizproc.Activity=this.BX.Bizproc.Activity||{},BX.Event,BX.Main,BX.Bizproc,BX,BX.UI.EntitySelector);
//# sourceMappingURL=script.map.js