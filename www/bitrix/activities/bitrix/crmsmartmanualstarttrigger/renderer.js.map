{"version":3,"file":"renderer.js","sources":["src/index.js"],"sourcesContent":["import { Tag, Dom, Event, Type } from 'main.core';\n\nexport class CrmSmartManualStartTriggerRenderer\n{\n\tgetControlRenderers(): Promise\n\t{\n\t\treturn {\n\t\t\t// eslint-disable-next-line sonarjs/cognitive-complexity\n\t\t\t'crm-smart-category-select': (field) => {\n\t\t\t\tconst categoriesBySmart = Type.isPlainObject(field?.property?.Settings?.categoriesBySmartType)\n\t\t\t\t\t? field.property.Settings.categoriesBySmartType\n\t\t\t\t\t: {};\n\n\t\t\t\tconst select = Tag.render`\n\t\t\t\t\t<select class=\"ui-ctl-element\" id=\"id_${field.controlId}\" name=\"${field.fieldName}\"></select>\n\t\t\t\t`;\n\n\t\t\t\tconst wrapper = Tag.render`\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t\t\t\t${select}\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\n\t\t\t\tconst smartField = 'id_smartTypeId';\n\t\t\t\tlet isBound = false;\n\n\t\t\t\tconst fillOptions = () => {\n\t\t\t\t\tconst smartValue = document.getElementById(smartField)?.value || '';\n\t\t\t\t\tconst optionsMap = Type.isPlainObject(categoriesBySmart[smartValue]) ? categoriesBySmart[smartValue] : {};\n\n\t\t\t\t\tconst prev = select.value;\n\t\t\t\t\tDom.clean(select);\n\n\t\t\t\t\tconst keys = Object.keys(optionsMap);\n\t\t\t\t\tkeys.forEach((id) => {\n\t\t\t\t\t\tconst opt = Tag.render`<option value=\"${id}\">${optionsMap[id]}</option>`;\n\t\t\t\t\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-native-dom-methods\n\t\t\t\t\t\tselect.appendChild(opt);\n\t\t\t\t\t});\n\n\t\t\t\t\tlet chosen = '';\n\t\t\t\t\tif (prev && optionsMap[prev])\n\t\t\t\t\t{\n\t\t\t\t\t\tchosen = prev;\n\t\t\t\t\t}\n\t\t\t\t\telse if (field?.value && optionsMap[field.value])\n\t\t\t\t\t{\n\t\t\t\t\t\tchosen = field.value;\n\t\t\t\t\t}\n\t\t\t\t\telse if (keys.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tchosen = keys[0];\n\t\t\t\t\t}\n\n\t\t\t\t\tselect.value = chosen;\n\n\t\t\t\t\tif (keys.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tselect.removeAttribute('disabled');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tselect.setAttribute('disabled', 'disabled');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (chosen && chosen !== prev)\n\t\t\t\t\t{\n\t\t\t\t\t\tEvent.fire(select, 'change');\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tconst tryBind = () => {\n\t\t\t\t\tconst smartSelect = document.getElementById(smartField);\n\t\t\t\t\tif (!smartSelect || isBound)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn isBound;\n\t\t\t\t\t}\n\t\t\t\t\tEvent.bind(smartSelect, 'change', fillOptions);\n\t\t\t\t\tfillOptions();\n\t\t\t\t\tisBound = true;\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\n\t\t\t\tif (!tryBind())\n\t\t\t\t{\n\t\t\t\t\tconst onReady = () => {\n\t\t\t\t\t\tif (tryBind())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tEvent.unbind(document, 'DOMContentLoaded', onReady);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tif (document.readyState === 'loading')\n\t\t\t\t\t{\n\t\t\t\t\t\tEvent.bind(document, 'DOMContentLoaded', onReady);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst observer = new MutationObserver(() => {\n\t\t\t\t\t\tif (tryBind())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tobserver.disconnect();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tobserver.observe(document.documentElement, { childList: true, subtree: true });\n\t\t\t\t}\n\n\t\t\t\treturn wrapper;\n\t\t\t},\n\t\t};\n\t}\n}\n"],"names":["CrmSmartManualStartTriggerRenderer","getControlRenderers","field","categoriesBySmart","Type","isPlainObject","property","Settings","categoriesBySmartType","select","Tag","render","controlId","fieldName","wrapper","smartField","isBound","fillOptions","smartValue","document","getElementById","value","optionsMap","prev","Dom","clean","keys","Object","forEach","id","opt","appendChild","chosen","length","removeAttribute","setAttribute","Event","fire","tryBind","smartSelect","bind","onReady","unbind","readyState","observer","MutationObserver","disconnect","observe","documentElement","childList","subtree"],"mappings":"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"}