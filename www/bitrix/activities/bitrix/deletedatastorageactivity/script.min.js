(function(e,t,i){"use strict";var o=t.Reflection.namespace("BX.Bizproc.Activity");var n=function(){function e(o){babelHelpers.classCallCheck(this,e);if(t.Type.isPlainObject(o)){this.documentType=o.documentType;var n=document.forms[o.formName];if(!t.Type.isNil(n)){var r,d,l;this.storageIdSelect=n.storage_id;this.storageCodeInput=n.storage_code;this.currentStorageId=Number(((r=this.storageIdSelect)===null||r===void 0?void 0:r.value)||0);this.currentStorageCode=(d=this.storageCodeInput)===null||d===void 0?void 0:d.value;this.deleteModeElement=document.querySelector('[data-role="bpa-sda-delete-mode-dependent"]');this.deleteModeSelect=n.delete_mode;this.currentDeleteMode=((l=this.deleteModeSelect)===null||l===void 0?void 0:l.value)||""}this.document=new i.Document({rawDocumentType:this.documentType,documentFields:o.documentFields,title:o.documentName});this.initAutomationContext();this.initFilterFields(o);this.render()}}babelHelpers.createClass(e,[{key:"initFilterFields",value:function e(t){this.conditionIdPrefix="id_bpa_sra_field_";this.filterFieldsContainer=document.querySelector('[data-role="bpa-sda-filter-fields-container"]');this.filteringFieldsPrefix=t.filteringFieldsPrefix;this.filterFieldsMap=new Map(Object.entries(t.filterFieldsMap).map((function(e){var t=babelHelpers.slicedToArray(e,2),i=t[0],o=t[1];return[Number(i),o]})));this.conditionGroup=new i.ConditionGroup(t.conditions)}},{key:"initAutomationContext",value:function e(){try{i.getGlobalContext()}catch(e){i.setGlobalContext(new i.Context({document:this.document}))}}},{key:"init",value:function e(){if(this.storageIdSelect){t.Event.bind(this.storageIdSelect,"change",this.onStorageIdChange.bind(this))}if(this.storageCodeInput){t.Event.bind(this.storageCodeInput,"change",this.onStorageCodeChange.bind(this))}if(this.deleteModeSelect){t.Event.bind(this.deleteModeSelect,"change",this.onDeleteModeChange.bind(this))}}},{key:"onStorageIdChange",value:function e(){this.storageCodeInput.value="";this.currentStorageId=Number(this.storageIdSelect.value);this.conditionGroup=new i.ConditionGroup;this.render()}},{key:"onStorageCodeChange",value:function e(){var t;this.storageIdSelect.value="";this.currentStorageCode=(t=this.storageCodeInput)===null||t===void 0?void 0:t.value;this.conditionGroup=new i.ConditionGroup;this.render()}},{key:"onDeleteModeChange",value:function e(){this.currentDeleteMode=this.deleteModeSelect.value;this.conditionGroup=new i.ConditionGroup;this.render()}},{key:"render",value:function e(){if((this.currentStorageId>0||this.currentStorageCode)&&this.currentDeleteMode==="multiple"){t.Dom.show(this.deleteModeElement);this.renderFilterFields()}else{t.Dom.hide(this.deleteModeElement)}}},{key:"showFieldSelector",value:function e(t){BPAShowSelector(t,"string","")}},{key:"renderFilterFields",value:function e(){if(!t.Type.isNil(this.conditionGroup)){var o=new i.ConditionGroupSelector(this.conditionGroup,{fields:Object.values(this.filterFieldsMap.get(this.currentStorageId)||{}),fieldPrefix:this.filteringFieldsPrefix,customSelector:t.Type.isFunction(BPAShowSelector)?this.showFieldSelector:null,caption:{head:t.Loc.getMessage("BIZPROC_SDA_FILTER_FIELDS_PROPERTY"),collapsed:t.Loc.getMessage("BIZPROC_SDA_FILTER_FIELDS_COLLAPSED_TEXT")}});if(o.modern&&this.filterFieldsContainer&&this.filterFieldsContainer.parentNode){var n=this.filterFieldsContainer.parentNode.firstElementChild===this.filterFieldsContainer?this.filterFieldsContainer.parentNode.parentNode.firstElementChild:this.filterFieldsContainer.parentNode.firstElementChild;t.Dom.clean(n)}t.Dom.clean(this.filterFieldsContainer);t.Dom.append(o.createNode(),this.filterFieldsContainer)}}}]);return e}();o.DeleteDataStorageActivity=n})(this.window=this.window||{},BX,BX.Bizproc.Automation);
//# sourceMappingURL=script.map.js