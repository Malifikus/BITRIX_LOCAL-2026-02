{"version":3,"file":"script.js","sources":["script.es6.js"],"sourcesContent":["import { Reflection, Type, Event, Dom, Loc } from 'main.core';\nimport {\n\tContext,\n\tConditionGroup,\n\tConditionGroupSelector,\n\tDocument,\n\tgetGlobalContext,\n\tsetGlobalContext,\n\tInlineSelector,\n\tDesigner,\n} from 'bizproc.automation';\n\nconst namespace = Reflection.namespace('BX.Bizproc.Activity');\n\nclass DeleteDataStorageActivity\n{\n\tdocumentType: Array<string>;\n\tdocument: Document;\n\n\tstorageIdSelect: HTMLSelectElement;\n\tstorageCodeInput: HTMLInputElement;\n\tdeleteModeElement: HTMLElement;\n\n\tfilterFieldsContainer: HTMLDivElement | null;\n\tfilteringFieldsPrefix: string;\n\tfilterFieldsMap: Map<number, object>;\n\tconditionGroup: ConditionGroup | undefined;\n\n\tcurrentStorageId: number;\n\tcurrentStorageCode: ?string;\n\n\tdeleteModeSelect: HTMLSelectElement;\n\tcurrentDeleteMode: string;\n\n\tconstructor(options)\n\t{\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.documentType = options.documentType;\n\t\t\tconst form = document.forms[options.formName];\n\n\t\t\tif (!Type.isNil(form))\n\t\t\t{\n\t\t\t\tthis.storageIdSelect = form.storage_id;\n\t\t\t\tthis.storageCodeInput = form.storage_code;\n\t\t\t\tthis.currentStorageId = Number(this.storageIdSelect?.value || 0);\n\t\t\t\tthis.currentStorageCode = this.storageCodeInput?.value;\n\t\t\t\tthis.deleteModeElement = document.querySelector(\n\t\t\t\t\t'[data-role=\"bpa-sda-delete-mode-dependent\"]',\n\t\t\t\t);\n\n\t\t\t\tthis.deleteModeSelect = form.delete_mode;\n\t\t\t\tthis.currentDeleteMode = this.deleteModeSelect?.value || '';\n\t\t\t}\n\n\t\t\tthis.document = new Document({\n\t\t\t\trawDocumentType: this.documentType,\n\t\t\t\tdocumentFields: options.documentFields,\n\t\t\t\ttitle: options.documentName,\n\t\t\t});\n\n\t\t\tthis.initAutomationContext();\n\t\t\tthis.initFilterFields(options);\n\n\t\t\tthis.render();\n\t\t}\n\t}\n\n\tinitFilterFields(options)\n\t{\n\t\tthis.conditionIdPrefix = 'id_bpa_sra_field_';\n\t\tthis.filterFieldsContainer = document.querySelector('[data-role=\"bpa-sda-filter-fields-container\"]');\n\t\tthis.filteringFieldsPrefix = options.filteringFieldsPrefix;\n\t\tthis.filterFieldsMap = new Map(\n\t\t\tObject.entries(options.filterFieldsMap)\n\t\t\t\t.map(([storageId, fieldsMap]) => [Number(storageId), fieldsMap]),\n\t\t);\n\n\t\tthis.conditionGroup = new ConditionGroup(options.conditions);\n\t}\n\n\tinitAutomationContext()\n\t{\n\t\ttry\n\t\t{\n\t\t\tgetGlobalContext();\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tsetGlobalContext(new Context({ document: this.document }));\n\t\t}\n\t}\n\n\tinit(): void\n\t{\n\t\tif (this.storageIdSelect)\n\t\t{\n\t\t\tEvent.bind(this.storageIdSelect, 'change', this.onStorageIdChange.bind(this));\n\t\t}\n\t\tif (this.storageCodeInput)\n\t\t{\n\t\t\tEvent.bind(this.storageCodeInput, 'change', this.onStorageCodeChange.bind(this));\n\t\t}\n\t\tif (this.deleteModeSelect)\n\t\t{\n\t\t\tEvent.bind(this.deleteModeSelect, 'change', this.onDeleteModeChange.bind(this));\n\t\t}\n\t}\n\n\tonStorageIdChange(): void\n\t{\n\t\tthis.storageCodeInput.value = '';\n\t\tthis.currentStorageId = Number(this.storageIdSelect.value);\n\t\tthis.conditionGroup = new ConditionGroup();\n\t\tthis.render();\n\t}\n\n\tonStorageCodeChange(): void\n\t{\n\t\tthis.storageIdSelect.value = '';\n\t\tthis.currentStorageCode = this.storageCodeInput?.value;\n\t\tthis.conditionGroup = new ConditionGroup();\n\t\tthis.render();\n\t}\n\n\tonDeleteModeChange(): void\n\t{\n\t\tthis.currentDeleteMode = this.deleteModeSelect.value;\n\t\tthis.conditionGroup = new ConditionGroup();\n\t\tthis.render();\n\t}\n\n\trender(): void\n\t{\n\t\tif ((this.currentStorageId > 0 || this.currentStorageCode) && this.currentDeleteMode === 'multiple')\n\t\t{\n\t\t\tDom.show(this.deleteModeElement);\n\t\t\tthis.renderFilterFields();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.hide(this.deleteModeElement);\n\t\t}\n\t}\n\n\tshowFieldSelector(targetInputId)\n\t{\n\t\tBPAShowSelector(targetInputId, 'string', '');\n\t}\n\n\trenderFilterFields(): void\n\t{\n\t\tif (!Type.isNil(this.conditionGroup))\n\t\t{\n\t\t\tconst selector = new ConditionGroupSelector(this.conditionGroup, {\n\t\t\t\tfields: Object.values(this.filterFieldsMap.get(this.currentStorageId) || {}),\n\t\t\t\tfieldPrefix: this.filteringFieldsPrefix,\n\t\t\t\tcustomSelector: Type.isFunction(BPAShowSelector) ? this.showFieldSelector : null,\n\t\t\t\tcaption: {\n\t\t\t\t\thead: Loc.getMessage('BIZPROC_SDA_FILTER_FIELDS_PROPERTY'),\n\t\t\t\t\tcollapsed: Loc.getMessage('BIZPROC_SDA_FILTER_FIELDS_COLLAPSED_TEXT'),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tif (selector.modern && this.filterFieldsContainer && this.filterFieldsContainer.parentNode)\n\t\t\t{\n\t\t\t\tconst element = (\n\t\t\t\t\tthis.filterFieldsContainer.parentNode.firstElementChild === this.filterFieldsContainer\n\t\t\t\t\t\t? this.filterFieldsContainer.parentNode.parentNode.firstElementChild\n\t\t\t\t\t\t: this.filterFieldsContainer.parentNode.firstElementChild\n\t\t\t\t);\n\n\t\t\t\tDom.clean(element);\n\t\t\t}\n\n\t\t\tDom.clean(this.filterFieldsContainer);\n\t\t\tDom.append(selector.createNode(), this.filterFieldsContainer);\n\t\t}\n\t}\n}\n\nnamespace.DeleteDataStorageActivity = DeleteDataStorageActivity;\n"],"names":["namespace","Reflection","DeleteDataStorageActivity","options","Type","isPlainObject","documentType","form","document","forms","formName","isNil","storageIdSelect","storage_id","storageCodeInput","storage_code","currentStorageId","Number","value","currentStorageCode","deleteModeElement","querySelector","deleteModeSelect","delete_mode","currentDeleteMode","Document","rawDocumentType","documentFields","title","documentName","initAutomationContext","initFilterFields","render","conditionIdPrefix","filterFieldsContainer","filteringFieldsPrefix","filterFieldsMap","Map","Object","entries","map","storageId","fieldsMap","conditionGroup","ConditionGroup","conditions","getGlobalContext","setGlobalContext","Context","Event","bind","onStorageIdChange","onStorageCodeChange","onDeleteModeChange","Dom","show","renderFilterFields","hide","targetInputId","BPAShowSelector","selector","ConditionGroupSelector","fields","values","get","fieldPrefix","customSelector","isFunction","showFieldSelector","caption","head","Loc","getMessage","collapsed","modern","parentNode","element","firstElementChild","clean","append","createNode"],"mappings":"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"}