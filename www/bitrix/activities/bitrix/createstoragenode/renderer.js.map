{"version":3,"file":"renderer.js","sources":["src/index.js"],"sourcesContent":["import { Tag, Event, Runtime, Dom, Text, Type } from 'main.core';\nimport { Menu, PopupMenu } from 'main.popup';\n\ntype StorageField = {\n\tid: number;\n\tstorageId: number;\n\tcode: string;\n\tsort: number;\n\tname: string;\n\tdescription: string;\n\ttype: string;\n\tmultiple: boolean;\n\tmandatory: boolean;\n\tsettings: Object | null;\n};\n\nexport class CreateStorageNodeRenderer\n{\n\t#storageFieldsWrapper: HTMLElement;\n\n\tgetControlRenderers(): Object\n\t{\n\t\treturn {\n\t\t\t'storage-fields': (field: Object) => {\n\t\t\t\tconst element = Tag.render`\n\t\t\t\t\t<div class=\"storage-fields\">\n\t\t\t\t\t\t<a ref=\"addField\" class=\"custom-fields__add-button\" href=\"#\" id=\"add_field\">${Text.encode(field.property.Name)}</a>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\tthis.#storageFieldsWrapper = element.root;\n\n\t\t\t\tEvent.bind(element.addField, 'click', this.handleAddFieldClick.bind(this));\n\t\t\t\tif (Type.isArrayFilled(field.value))\n\t\t\t\t{\n\t\t\t\t\tfield.value.forEach((field) => {\n\t\t\t\t\t\tDom.append(this.#getField(field), this.#storageFieldsWrapper);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn element.root;\n\t\t\t},\n\t\t};\n\t}\n\n\thandleAddFieldClick(event: Event): void\n\t{\n\t\tevent.preventDefault();\n\t\tRuntime\n\t\t\t.loadExtension('bizproc.router')\n\t\t\t.then(({ Router }) => {\n\t\t\t\tRouter.openStorageFieldEdit({\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonCloseComplete: (event: BX.SidePanel.Event) => {\n\t\t\t\t\t\t\tconst slider = event.getSlider();\n\t\t\t\t\t\t\tconst dictionary: ?BX.SidePanel.Dictionary = slider ? slider.getData() : null;\n\t\t\t\t\t\t\tlet data = null;\n\t\t\t\t\t\t\tif (dictionary && dictionary.has('data'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdata = dictionary.get('data');\n\t\t\t\t\t\t\t\tDom.append(this.#getField(data), this.#storageFieldsWrapper);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\trequestMethod: 'get',\n\t\t\t\t\trequestParams: { storageId: 0, fieldId: null, skipSave: true},\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tconsole.error(e);\n\t\t\t});\n\t}\n\n\t#getField(field: StorageField): HTMLElement\n\t{\n\t\tconst jsonValue = JSON.stringify(field);\n\t\tconst fieldItem = Tag.render`\n\t\t\t<div class=\"storage-fields__item\">\n\t\t\t\t<input type=\"hidden\" name=\"SelectedFields[]\" value=\"${Text.encode(jsonValue)}\">\n\t\t\t\t<div class=\"storage-fields__item-content\">\n\t\t\t\t\t<span class=\"storage-fields__item-name\">\n\t\t\t\t\t\t${Text.encode(field.name)}:${Text.encode(field.code)}\n\t\t\t\t\t</span>\n\t\t\t\t\t<a ref=\"deleteField\" class=\"storage-fields__delete-button\" href=\"#\">\n\t\t\t\t\t\t<div class=\"ui-icon-set --cross-m\"></div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(\n\t\t\tfieldItem.deleteField,\n\t\t\t'click',\n\t\t\t(event) => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tDom.remove(fieldItem.root);\n\t\t\t},\n\t\t);\n\n\t\treturn fieldItem.root;\n\t}\n}\n"],"names":["CreateStorageNodeRenderer","getControlRenderers","field","element","Tag","render","Text","encode","property","Name","root","Event","bind","addField","handleAddFieldClick","Type","isArrayFilled","value","forEach","Dom","append","event","preventDefault","Runtime","loadExtension","then","Router","openStorageFieldEdit","events","onCloseComplete","slider","getSlider","dictionary","getData","data","has","get","requestMethod","requestParams","storageId","fieldId","skipSave","catch","e","console","error","jsonValue","JSON","stringify","fieldItem","name","code","deleteField","remove"],"mappings":";;;;;;;AAAA,CAC6C;CAAA;AAe7C,CAAO,MAAMA,yBAAyB,CACtC;GAAA;KAAA;OAAA;;KAAA;OAAA;OAAA;;;GAGCC,mBAAmB,GACnB;KACC,OAAO;OACN,gBAAgB,EAAGC,KAAa,IAAK;SACpC,MAAMC,OAAO,GAAGC,aAAG,CAACC,MAAM,cAAC;;oFAEmD,CAAmC;;KAEjH,GAFgFC,cAAI,CAACC,MAAM,CAACL,KAAK,CAACM,QAAQ,CAACC,IAAI,CAAC,CAE/G;SACD,4CAAI,kDAAyBN,OAAO,CAACO,IAAI;SAEzCC,eAAK,CAACC,IAAI,CAACT,OAAO,CAACU,QAAQ,EAAE,OAAO,EAAE,IAAI,CAACC,mBAAmB,CAACF,IAAI,CAAC,IAAI,CAAC,CAAC;SAC1E,IAAIG,cAAI,CAACC,aAAa,CAACd,KAAK,CAACe,KAAK,CAAC,EACnC;WACCf,KAAK,CAACe,KAAK,CAACC,OAAO,CAAEhB,KAAK,IAAK;aAC9BiB,aAAG,CAACC,MAAM,yCAAC,IAAI,wBAAWlB,KAAK,2CAAG,IAAI,gDAAuB;YAC7D,CAAC;;SAGH,OAAOC,OAAO,CAACO,IAAI;;MAEpB;;GAGFI,mBAAmB,CAACO,KAAY,EAChC;KACCA,KAAK,CAACC,cAAc,EAAE;KACtBC,iBAAO,CACLC,aAAa,CAAC,gBAAgB,CAAC,CAC/BC,IAAI,CAAC,CAAC;OAAEC;MAAQ,KAAK;OACrBA,MAAM,CAACC,oBAAoB,CAAC;SAC3BC,MAAM,EAAE;WACPC,eAAe,EAAGR,KAAyB,IAAK;aAC/C,MAAMS,MAAM,GAAGT,KAAK,CAACU,SAAS,EAAE;aAChC,MAAMC,UAAoC,GAAGF,MAAM,GAAGA,MAAM,CAACG,OAAO,EAAE,GAAG,IAAI;aAC7E,IAAIC,IAAI,GAAG,IAAI;aACf,IAAIF,UAAU,IAAIA,UAAU,CAACG,GAAG,CAAC,MAAM,CAAC,EACxC;eACCD,IAAI,GAAGF,UAAU,CAACI,GAAG,CAAC,MAAM,CAAC;eAC7BjB,aAAG,CAACC,MAAM,yCAAC,IAAI,wBAAWc,IAAI,2CAAG,IAAI,gDAAuB;;;UAG9D;SACDG,aAAa,EAAE,KAAK;SACpBC,aAAa,EAAE;WAAEC,SAAS,EAAE,CAAC;WAAEC,OAAO,EAAE,IAAI;WAAEC,QAAQ,EAAE;;QACxD,CAAC;MACF,CAAC,CACDC,KAAK,CAAEC,CAAC,IAAK;OACbC,OAAO,CAACC,KAAK,CAACF,CAAC,CAAC;MAChB,CAAC;;CA+BL;CAAC,oBA5BUzC,KAAmB,EAC7B;GACC,MAAM4C,SAAS,GAAGC,IAAI,CAACC,SAAS,CAAC9C,KAAK,CAAC;GACvC,MAAM+C,SAAS,GAAG7C,aAAG,CAACC,MAAM,gBAAC;;0DAEyB,CAAyB;;;QAG3E,CAA0B,IAAC,CAA0B;;;;;;;GAOzD,GAVwDC,cAAI,CAACC,MAAM,CAACuC,SAAS,CAAC,EAGxExC,cAAI,CAACC,MAAM,CAACL,KAAK,CAACgD,IAAI,CAAC,EAAI5C,cAAI,CAACC,MAAM,CAACL,KAAK,CAACiD,IAAI,CAAC,CAOvD;GAEDxC,eAAK,CAACC,IAAI,CACTqC,SAAS,CAACG,WAAW,EACrB,OAAO,EACN/B,KAAK,IAAK;KACVA,KAAK,CAACC,cAAc,EAAE;KACtBH,aAAG,CAACkC,MAAM,CAACJ,SAAS,CAACvC,IAAI,CAAC;IAC1B,CACD;GAED,OAAOuC,SAAS,CAACvC,IAAI;CACtB;;;;;;;;"}