{"version":3,"file":"promo-boost.bundle.js","sources":["../src/settings.js","../src/checker.js","../src/widget.js","../src/button/button.js","../src/factory.js"],"sourcesContent":["import { Extension } from 'main.core';\n\nexport class Settings\n{\n\tstatic getSessionBoostServiceCode(): string\n\t{\n\t\treturn this.getExtensionParam('sessionBoostServiceCode');\n\t}\n\n\tstatic getAvailableServices(): Array<string>\n\t{\n\t\treturn this.getExtensionParam('availableServices');\n\t}\n\n\tstatic canDisplay(): boolean\n\t{\n\t\treturn this.getExtensionParam('canDisplay');\n\t}\n\n\tstatic getExtensionParam(parameterName: string): any\n\t{\n\t\treturn Extension.getSettings('disk.promo-boost').get(parameterName);\n\t}\n}\n","import { DocumentEditSessionLimit } from 'disk.onlyoffice-session-restrictions';\nimport { Settings } from './settings';\n\nexport class Checker\n{\n\tstatic isServiceAvailable(code: string): boolean\n\t{\n\t\treturn Settings.getAvailableServices().includes(code);\n\t}\n\n\t/**\n\t * @returns {boolean}\n\t */\n\tstatic isSessionBoostAvailable(): boolean\n\t{\n\t\treturn Settings.canDisplay() && this.isServiceAvailable(Settings.getSessionBoostServiceCode());\n\t}\n\n\t/**\n\t * @deprecated\n\t * @returns {false|boolean|*}\n\t */\n\tstatic shouldShowPromoSessionBoost(): boolean\n\t{\n\t\treturn this.isSessionBoostAvailable() && DocumentEditSessionLimit.getInstance().isExceeded();\n\t}\n}\n","import { loadExt } from 'main.core';\n\nexport class Widget\n{\n\tstatic #instance: ?Widget = null;\n\t#service: string = '';\n\t#widgetInstance = null;\n\n\tconstructor(service: string): void\n\t{\n\t\tthis.#service = service;\n\t}\n\n\tstatic getInstance(service: code): Widget\n\t{\n\t\tif (this.#instance === null)\n\t\t{\n\t\t\tthis.#instance = new Widget(service);\n\t\t}\n\n\t\treturn this.#instance;\n\t}\n\n\t/**\n\t * @returns {Promise<ServiceWidget>} -- ServiceWidget from baas.store extension\n\t */\n\t#getBaasWidget(): Promise<any>\n\t{\n\t\tif (this.#widgetInstance !== null)\n\t\t{\n\t\t\treturn Promise.resolve(this.#widgetInstance);\n\t\t}\n\n\t\treturn loadExt('baas.store')\n\t\t\t.then((exports) => {\n\t\t\t\tthis.#widgetInstance = exports.ServiceWidget.getInstanceByCode(this.#service);\n\n\t\t\t\treturn this.#widgetInstance;\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconst errorMessage = `Baas extension not loaded! Original error: ${err.message}`;\n\t\t\t\tthrow new Error(errorMessage);\n\t\t\t})\n\t\t;\n\t}\n\n\tbindTo(node: HTMLElement): Widget\n\t{\n\t\tthis.#getBaasWidget()\n\t\t\t.then((widget): void => {\n\t\t\t\twidget.bind(node);\n\t\t\t})\n\t\t\t.catch(this.#errToConsole)\n\t\t;\n\n\t\treturn this;\n\t}\n\n\tshow(): Widget\n\t{\n\t\tthis.#getBaasWidget()\n\t\t\t.then((widget): void => {\n\t\t\t\tif (widget.getPopup().isShown())\n\t\t\t\t{\n\t\t\t\t\tconst showWidget = () => {\n\t\t\t\t\t\twidget.show();\n\t\t\t\t\t\twidget.getPopup().unsubscribe('onAfterClose', showWidget);\n\t\t\t\t\t};\n\t\t\t\t\twidget.getPopup().subscribe('onAfterClose', showWidget);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\twidget.show();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(this.#errToConsole)\n\t\t;\n\n\t\treturn this;\n\t}\n\n\ttoggle(): Widget\n\t{\n\t\tthis.#getBaasWidget()\n\t\t\t.then((widget): void => {\n\t\t\t\twidget.toggle();\n\t\t\t})\n\t\t\t.catch(this.#errToConsole)\n\t\t;\n\n\t\treturn this;\n\t}\n\n\tsetOverlay(): Widget\n\t{\n\t\tthis.#getBaasWidget()\n\t\t\t.then((widget): void => {\n\t\t\t\twidget.getPopup().setOverlay({ opacity: 0 });\n\t\t\t})\n\t\t\t.catch(this.#errToConsole)\n\t\t;\n\n\t\treturn this;\n\t}\n\n\t#errToConsole(error: Error): void\n\t{\n\t\tconsole.error(error.message);\n\t}\n}\n","import { Dom, Tag, Type, Event, Loc } from 'main.core';\nimport 'ui.design-tokens';\nimport './style.css';\nimport { Checker } from '../checker';\nimport { Widget } from '../widget';\n\nexport type ButtonOptions = {\n\tservice: string,\n\tcontainerId: string,\n\twidget: Widget,\n};\n\nexport class Button\n{\n\t#service: string = null;\n\t#container: ?HTMLElement = null;\n\t#uninitialized: boolean = true;\n\t#button: ?HTMLElement = null;\n\t#widget: Widget;\n\n\tconstructor(options: ButtonOptions = {})\n\t{\n\t\tthis.#service = options.service ?? '';\n\t\tthis.#container = document.getElementById(options.containerId);\n\t\tthis.#widget = options.widget;\n\t}\n\n\tinit(): void\n\t{\n\t\tif (this.#uninitialized && this.#checkServiceAvailability())\n\t\t{\n\t\t\tthis.#uninitialized = false;\n\t\t\tif (this.#renderTo())\n\t\t\t{\n\t\t\t\tthis.#bindEvent();\n\t\t\t}\n\t\t}\n\t}\n\n\tshowWidget(): void\n\t{\n\t\tthis.#widget.bindTo(this.#getButton());\n\t\tthis.#widget.show();\n\t}\n\n\tsetOverlayToWidget(): void\n\t{\n\t\tthis.#widget.setOverlay();\n\t}\n\n\t#checkServiceAvailability(): boolean\n\t{\n\t\treturn Checker.isServiceAvailable(this.#service);\n\t}\n\n\t#renderTo(): boolean\n\t{\n\t\tif (!Type.isElementNode(this.#container))\n\t\t{\n\t\t\tconsole.error('Disk: BoostButton: Container for service does not exist!');\n\t\t}\n\n\t\tDom.append(this.#getButton(), this.#container);\n\n\t\treturn true;\n\t}\n\n\t#bindEvent(): void\n\t{\n\t\tEvent.bind(this.#getButton(), 'click', this.#click.bind(this));\n\t}\n\n\t#click(): void\n\t{\n\t\tthis.#widget.bindTo(this.#getButton());\n\t\tthis.#widget.show();\n\t}\n\n\t#getButton(): HTMLElement\n\t{\n\t\tif (!this.#button)\n\t\t{\n\t\t\t// noinspection JSAnnotator\n\t\t\tconst text: string = Loc.getMessage('DISK_PROMO_BOOST_BUTTON_TEXT');\n\t\t\tthis.#button = Tag.render`<button class=\"bx-disk-promo-boost-button\"><span>${text}</span></button>`;\n\t\t}\n\n\t\treturn this.#button;\n\t}\n}\n","import { Button } from './button/button';\nimport { Widget } from './widget';\nimport { Settings } from './settings';\n\nexport class Factory\n{\n\tstatic getSessionBoostButton(containerId: string): Button\n\t{\n\t\treturn new Button({\n\t\t\tcontainerId,\n\t\t\tservice: Settings.getSessionBoostServiceCode(),\n\t\t\twidget: this.getSessionBoostWidget(),\n\t\t});\n\t}\n\n\tstatic getSessionBoostWidget(): Widget\n\t{\n\t\treturn Widget.getInstance(Settings.getSessionBoostServiceCode());\n\t}\n}\n"],"names":["Settings","[object Object]","this","getExtensionParam","parameterName","Extension","getSettings","get","Checker","code","getAvailableServices","includes","canDisplay","isServiceAvailable","getSessionBoostServiceCode","isSessionBoostAvailable","DocumentEditSessionLimit","getInstance","isExceeded","Widget","constructor","service","Object","value","writable","babelHelpers","bindTo","node","then","widget","bind","catch","show","getPopup","isShown","showWidget","unsubscribe","subscribe","toggle","setOverlay","opacity","Promise","resolve","loadExt","exports","ServiceWidget","getInstanceByCode","err","errorMessage","message","Error","error","console","Button","options","document","getElementById","containerId","init","setOverlayToWidget","Type","isElementNode","Dom","append","Event","text","Loc","getMessage","Tag","render","getSessionBoostWidget"],"mappings":"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"}