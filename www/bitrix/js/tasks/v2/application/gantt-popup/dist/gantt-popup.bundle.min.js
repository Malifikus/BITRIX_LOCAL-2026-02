this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};(function(t,e,s,i,n,o,l,a,r,p,c,d,u,h,T,S,_){"use strict";const b="help";const B={components:{BMenu:h.BMenu},props:{type:{type:String,required:true},bindElement:{type:HTMLElement,required:true}},emits:["update:type","close"],computed:{menuOptions(){return{bindElement:this.bindElement,sections:[{code:b}],closeOnItemClick:false,items:[...Object.keys(this.types).map((t=>({title:this.types[t].title,subtitle:this.types[t].description,isSelected:t===this.type,onClick:()=>{this.$emit("update:type",t);this.$emit("close")}}))),{sectionCode:b,design:h.MenuItemDesign.Accent2,title:this.loc("TASKS_V2_GANTT_TYPE_HELP"),icon:T.Outline.QUESTION,onClick:()=>this.showHelpDesk()}],offsetTop:4,targetContainer:this.bindElement.closest("body")}},types(){return{finish_start:{title:this.loc("TASKS_V2_GANTT_FINISH_START"),description:this.loc("TASKS_V2_GANTT_FINISH_START_DESCRIPTION")},start_start:{title:this.loc("TASKS_V2_GANTT_START_START"),description:this.loc("TASKS_V2_GANTT_START_START_DESCRIPTION")},start_finish:{title:this.loc("TASKS_V2_GANTT_START_FINISH"),description:this.loc("TASKS_V2_GANTT_START_FINISH_DESCRIPTION")},finish_finish:{title:this.loc("TASKS_V2_GANTT_FINISH_FINISH"),description:this.loc("TASKS_V2_GANTT_FINISH_FINISH_DESCRIPTION")}}}},methods:{showHelpDesk(){top.BX.Helper.show("redirect=detail&code=18100344")}},template:`\n\t\t<BMenu :options="menuOptions" @close="$emit('close')"/>\n\t`};const A={components:{RichLoc:o.RichLoc,UiButton:l.Button,BIcon:T.BIcon,BInput:a.BInput,HeadlineMd:r.HeadlineMd,TextMd:r.TextMd,TextXs:r.TextXs,GanttMenu:B},inject:{analytics:{}},props:{taskId:{type:[Number,String],required:true},close:{type:Function,required:true},freeze:{type:Function,required:true},unfreeze:{type:Function,required:true},updated:{type:Function,default:null}},setup(){return{AirButtonStyle:l.AirButtonStyle,ButtonSize:l.ButtonSize,Outline:T.Outline}},data(){return{task:null,type:"finish_start",isMenuShown:false,error:null}},computed:{typeTitle(){return{finish_start:this.loc("TASKS_V2_GANTT_FINISH_START"),start_start:this.loc("TASKS_V2_GANTT_START_START"),start_finish:this.loc("TASKS_V2_GANTT_START_FINISH"),finish_finish:this.loc("TASKS_V2_GANTT_FINISH_FINISH")}[this.type]}},methods:{showDialog(){this.freeze();this.handleClose=this.handleDialogClose;d.ganttDialog.show({targetNode:this.$refs.task.$refs.inputContainer,targetContainer:this.$refs.task.$el.closest("body"),taskId:this.taskId,ids:this.task?[this.task.id]:[],analytics:this.analytics,onClose:t=>{var e;return(e=this.handleClose)==null?void 0:e.call(this,t[0])}})},clearTask(){this.handleClose=null;this.task=null;this.error=null},handleDialogClose(t){this.unfreeze();if(this.task&&t&&this.task.id===t.getId()){return}this.task=t?{id:t.getId(),title:t.getTitle()}:null;this.error=null;if(this.task){void this.checkDependence(this.task.id)}},showMenu(){this.isMenuShown=true;this.freeze()},hideMenu(){this.isMenuShown=false;this.unfreeze()},showHelpDesk(){top.BX.Helper.show("redirect=detail&code=18127718")},async checkDependence(t){this.error=await u.ganttService.checkDependence({taskId:this.taskId,dependentId:t})},async handleAdd(){var t;this.close();const e=await u.ganttService.addDependence({taskId:this.taskId,dependentId:this.task.id,type:this.type});if(e){void c.relationError.setTaskId(this.taskId).showError(e,p.TaskField.Gantt);return}(t=this.updated)==null?void 0:t.call(this)}},template:`\n\t\t<div class="tasks-field-gantt-popup">\n\t\t\t<div class="tasks-field-gantt-popup-header">\n\t\t\t\t<HeadlineMd>{{ loc('TASKS_V2_GANTT_POPUP_TITLE') }}</HeadlineMd>\n\t\t\t\t<BIcon :name="Outline.CROSS_L" hoverable @click="close"/>\n\t\t\t</div>\n\t\t\t<TextMd className="tasks-field-gantt-popup-description">\n\t\t\t\t<RichLoc :text="loc('TASKS_V2_GANTT_POPUP_DESCRIPTION')" placeholder="[helpdesk]">\n\t\t\t\t\t<template #helpdesk="{ text }">\n\t\t\t\t\t\t<span class="tasks-field-gantt-popup-description-help" @click="showHelpDesk">\n\t\t\t\t\t\t\t<BIcon :name="Outline.KNOWLEDGE_BASE"/>\n\t\t\t\t\t\t\t<TextXs>{{ text }}</TextXs>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</template>\n\t\t\t\t</RichLoc>\n\t\t\t</TextMd>\n\t\t\t<BInput\n\t\t\t\t:modelValue="task?.title ?? ''"\n\t\t\t\t:label="loc('TASKS_V2_GANTT_POPUP_TASK')"\n\t\t\t\tdropdown\n\t\t\t\t:withClear="Boolean(task)"\n\t\t\t\tclickable\n\t\t\t\t:error\n\t\t\t\tref="task"\n\t\t\t\t@click="showDialog"\n\t\t\t\t@clear="clearTask"\n\t\t\t/>\n\t\t\t<BInput\n\t\t\t\t:modelValue="typeTitle"\n\t\t\t\t:label="loc('TASKS_V2_GANTT_POPUP_TYPE')"\n\t\t\t\tdropdown\n\t\t\t\tclickable\n\t\t\t\t:active="isMenuShown"\n\t\t\t\tref="type"\n\t\t\t\t@click="showMenu"\n\t\t\t/>\n\t\t\t<div class="tasks-field-gantt-popup-buttons">\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="loc('TASKS_V2_GANTT_POPUP_ADD')"\n\t\t\t\t\t:style="AirButtonStyle.PRIMARY"\n\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t:disabled="Boolean(!task || error)"\n\t\t\t\t\t@click="handleAdd"\n\t\t\t\t/>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="loc('TASKS_V2_GANTT_POPUP_CANCEL')"\n\t\t\t\t\t:style="AirButtonStyle.OUTLINE"\n\t\t\t\t\t:size="ButtonSize.LARGE"\n\t\t\t\t\t@click="close"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t\t<GanttMenu v-if="isMenuShown" v-model:type="type" :bindElement="$refs.type.$refs.inputContainer" @close="hideMenu"/>\n\t`};const I="tasks-gantt-popup";var k=babelHelpers.classPrivateFieldLooseKey("params");var P=babelHelpers.classPrivateFieldLooseKey("popup");var y=babelHelpers.classPrivateFieldLooseKey("application");var f=babelHelpers.classPrivateFieldLooseKey("onUpdate");var m=babelHelpers.classPrivateFieldLooseKey("mountApplication");var v=babelHelpers.classPrivateFieldLooseKey("unmountApplication");class H{constructor(t={}){Object.defineProperty(this,v,{value:F});Object.defineProperty(this,m,{value:N});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,k)[k]=t}onUpdate(t){babelHelpers.classPrivateFieldLooseBase(this,f)[f]=t}async showTo(t,s){if(e.PopupManager.getPopupById(I)){return}const i=document.createElement("div");await babelHelpers.classPrivateFieldLooseBase(this,m)[m](i);babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new e.Popup({id:I,content:i,bindElement:t,targetContainer:s,padding:14,width:470,offsetTop:4,cacheable:false,autoHide:true,closeByEsc:true,animation:"fading",bindOptions:{forceBindPosition:true},events:{onAfterClose:()=>babelHelpers.classPrivateFieldLooseBase(this,v)[v]()}});babelHelpers.classPrivateFieldLooseBase(this,P)[P].show()}destroy(){var t;(t=e.PopupManager.getPopupById(I))==null?void 0:t.destroy()}}async function N(t){await n.Core.init();const e=s.BitrixVue.createApp(A,{...babelHelpers.classPrivateFieldLooseBase(this,k)[k],close:()=>babelHelpers.classPrivateFieldLooseBase(this,P)[P].close(),freeze:()=>{babelHelpers.classPrivateFieldLooseBase(this,P)[P].setAutoHide(false);babelHelpers.classPrivateFieldLooseBase(this,P)[P].setClosingByEsc(false)},unfreeze:()=>{babelHelpers.classPrivateFieldLooseBase(this,P)[P].setAutoHide(true);babelHelpers.classPrivateFieldLooseBase(this,P)[P].setClosingByEsc(true)},updated:babelHelpers.classPrivateFieldLooseBase(this,f)[f]});e.mixin(i.locMixin);e.mount(t);babelHelpers.classPrivateFieldLooseBase(this,y)[y]=e}function F(){babelHelpers.classPrivateFieldLooseBase(this,y)[y].unmount()}const V={name:"TaskGanttPopup",components:{Popup:_.Popup,GanttPopupContent:A},inject:{taskId:{}},props:{bindElement:{type:HTMLElement,required:true}},emits:["close"],computed:{options(){return{className:"tasks-field-gantt-popup-container",bindElement:this.bindElement,padding:14,width:470,targetContainer:document.body}}},template:`\n\t\t<Popup\n\t\t\tv-slot="{ freeze, unfreeze }"\n\t\t\t:options\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<GanttPopupContent\n\t\t\t\t:taskId\n\t\t\t\t:close="() => $emit('close')"\n\t\t\t\t:freeze\n\t\t\t\t:unfreeze\n\t\t\t/>\n\t\t</Popup>\n\t`};t.GanttPopupApi=H;t.GanttPopup=V;t.GanttMenu=B})(this.BX.Tasks.V2.Application=this.BX.Tasks.V2.Application||{},BX.Main,BX.Vue3,BX.Vue3.Mixins,BX.Tasks.V2,BX.UI.Vue3.Components,BX.Vue3.Components,BX.UI.System.Input.Vue,BX.UI.System.Typography.Vue,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.UI.System.Menu,BX.UI.IconSet,BX,BX.UI.Vue3.Components);
//# sourceMappingURL=gantt-popup.bundle.map.js