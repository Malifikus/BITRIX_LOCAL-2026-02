{"version":3,"file":"template-service.bundle.js","sources":["../src/mappers/permission-builder.js","../src/mappers.js","../src/template-service.js","../src/index.js"],"sourcesContent":["import { Core } from 'tasks.v2.core';\nimport { EntitySelectorEntity, Model, PermissionType } from 'tasks.v2.const';\nimport { idUtils } from 'tasks.v2.lib.id-utils';\nimport type { Item, ItemId } from 'tasks.v2.lib.entity-selector-dialog';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nimport type { TemplatePermission } from '../types';\n\nexport const permissionBuilder = new class\n{\n\tgetPermissions(task: TaskModel): TemplatePermission[]\n\t{\n\t\tconst currentUserId = Core.getParams().currentUser.id;\n\t\tconst permissions = (task.permissions ?? []).map((p) => ({ ...p }));\n\n\t\tthis.#grantUser(currentUserId, permissions);\n\n\t\tif (!idUtils.isReal(task.id) && task.creatorId !== currentUserId)\n\t\t{\n\t\t\tthis.#grantUser(task.creatorId, permissions);\n\t\t}\n\n\t\treturn permissions;\n\t}\n\n\tbuildFromItem(item: Item): TemplatePermission\n\t{\n\t\tconst entityId = item.getId();\n\t\tlet entityType = item.getEntityId();\n\t\tif ([EntitySelectorEntity.Group, EntitySelectorEntity.Project].includes(entityType))\n\t\t{\n\t\t\tentityType = EntitySelectorEntity.Group;\n\t\t}\n\n\t\treturn {\n\t\t\tid: this.buildId(entityType, entityId),\n\t\t\tentityType,\n\t\t\tentityId,\n\t\t\ttitle: item.getTitle(),\n\t\t\timage: item.getAvatar(),\n\t\t\tpermission: PermissionType.Full,\n\t\t};\n\t}\n\n\tbuildItemId(permission: TemplatePermission): ItemId\n\t{\n\t\tconst mainDepartmentId = Core.getParams().mainDepartmentUfId;\n\n\t\tlet type = permission.entityType;\n\t\tlet id = permission.entityId;\n\n\t\tif (type === EntitySelectorEntity.Group)\n\t\t{\n\t\t\ttype = EntitySelectorEntity.Project;\n\t\t}\n\n\t\tif (type === EntitySelectorEntity.Department && permission.entityId === mainDepartmentId)\n\t\t{\n\t\t\ttype = EntitySelectorEntity.MetaUser;\n\t\t\tid = EntitySelectorEntity.AllUser;\n\t\t}\n\n\t\treturn [type, id];\n\t}\n\n\tbuildId(entityType: string, entityId: number): string\n\t{\n\t\treturn `${entityType}:${entityId}`;\n\t}\n\n\t#grantUser(userId: number, permissions: TemplatePermission[]): TemplatePermission[]\n\t{\n\t\tif (!this.#userGranted(userId, permissions))\n\t\t{\n\t\t\tpermissions.push(this.#buildUser(userId));\n\t\t}\n\n\t\treturn permissions;\n\t}\n\n\t#userGranted(userId: number, permissions: TemplatePermission[]): boolean\n\t{\n\t\treturn permissions.find((it) => it.entityType === EntitySelectorEntity.User && it.entityId === userId);\n\t}\n\n\t#buildUser(userId: number): TemplatePermission\n\t{\n\t\tconst user: UserModel = Core.getStore().getters[`${Model.Users}/getById`](userId);\n\n\t\treturn {\n\t\t\tid: this.buildId(EntitySelectorEntity.User, user.id),\n\t\t\tentityType: EntitySelectorEntity.User,\n\t\t\tentityId: user.id,\n\t\t\ttitle: user.name,\n\t\t\timage: user.image,\n\t\t\tpermission: PermissionType.Full,\n\t\t};\n\t}\n}();\n","import { Type } from 'main.core';\nimport type { TaskRights } from 'tasks.v2.model.tasks';\nimport type { TaskDto, TemplatePermissionDto } from 'tasks.v2.provider.service.task-service';\n\nimport { permissionBuilder } from './mappers/permission-builder';\nimport type { TemplatePermission } from './types';\n\nexport const mapPermissionDtoToModel = (dto: TemplatePermissionDto): TemplatePermission => ({\n\tid: permissionBuilder.buildId(dto.accessEntity.type, dto.accessEntity.id),\n\tentityId: dto.accessEntity.id,\n\tentityType: dto.accessEntity.type,\n\ttitle: dto.accessEntity.name,\n\timage: dto.accessEntity?.image?.src,\n\tpermission: dto.permissionId,\n});\n\nexport const mapPermissionModelToDto = (permission: TemplatePermission): TemplatePermissionDto => ({\n\taccessEntity: {\n\t\tid: permission.entityId,\n\t\ttype: permission.entityType,\n\t},\n\tpermissionId: permission.permission,\n});\n\nexport const mapRights = ({ read, edit, remove, create }: TaskRights): TaskRights => ({\n\tread,\n\tedit,\n\tremove,\n\tcreate,\n\tcomplete: edit,\n\tapprove: edit,\n\tdisapprove: edit,\n\tstart: edit,\n\ttake: edit,\n\tdelegate: edit,\n\tdefer: edit,\n\trenew: edit,\n\tdeadline: edit,\n\tdatePlan: edit,\n\tchangeDirector: edit,\n\tchangeResponsible: edit,\n\tchangeAccomplices: edit,\n\tpause: edit,\n\ttimeTracking: edit,\n\trate: edit,\n\tchangeStatus: edit,\n\treminder: edit,\n\taddAuditors: edit,\n\telapsedTime: edit,\n\tfavorite: edit,\n\tchecklistAdd: edit,\n\tchecklistEdit: edit,\n\tchecklistSave: edit,\n\tchecklistToggle: edit,\n\tautomate: edit,\n\tresultEdit: edit,\n\tcompleteResult: edit,\n\tremoveResult: edit,\n\tresultRead: edit,\n\tadmin: edit,\n\twatch: edit,\n\tmute: edit,\n\tcreateSubtask: edit,\n\tcopy: edit,\n\tcreateFromTemplate: edit,\n\tsaveAsTemplate: edit,\n\tattachFile: edit,\n\tdetachFile: edit,\n\tdetachParent: edit,\n\tdetachRelated: edit,\n\tchangeDependence: edit,\n\tcreateGanttDependence: edit,\n\tsort: edit,\n});\n\nexport const mapDtoToTaskDto = (templateDto: TaskDto): TaskDto => ({\n\ttitle: templateDto.title,\n\tresponsibleCollection: templateDto.responsibleCollection,\n\tdeadlineTs: mapValue(templateDto.deadlineAfter, ceilTs(Date.now() + templateDto.deadlineAfter * 1000) / 1000),\n});\n\nconst step = 60 * 1000;\nconst ceilTs = (timestamp: number): number => Math.ceil(timestamp / step) * step;\n\nconst mapValue = (value: any, mapped: any): any => (Type.isNil(value) ? value : mapped);\n","import { Event, Runtime, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport type { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'tasks.v2.core';\nimport { EventName, Model, Endpoint } from 'tasks.v2.const';\nimport { apiClient } from 'tasks.v2.lib.api-client';\nimport { taskService, TaskMappers } from 'tasks.v2.provider.service.task-service';\nimport { idUtils, type TaskId } from 'tasks.v2.lib.id-utils';\nimport { checkListService } from 'tasks.v2.provider.service.check-list-service';\nimport { subTasksService } from 'tasks.v2.provider.service.relation-service';\nimport { userFieldsManager } from 'tasks.v2.component.fields.user-fields';\nimport type { TagDto, TaskDto } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { mapRights } from './mappers';\nimport { permissionBuilder } from './mappers/permission-builder';\n\nexport const templateService = new class\n{\n\tconstructor()\n\t{\n\t\tEvent.bind(window, 'beforeunload', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst pendingIds = Object.keys(this.#updatePromises);\n\t\t\t\tpendingIds.forEach((id) => this.#requestUpdate(id));\n\t\t\t});\n\t\t});\n\t}\n\n\tasync get(id: number): Promise<TaskModel>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst data = await apiClient.post(Endpoint.TemplateGet, { templateId: idUtils.unbox(id) });\n\n\t\t\tdata.id = id;\n\n\t\t\ttaskService.extractTask({ ...data, rights: mapRights(data.rights) }, false);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(Endpoint.TemplateGet, error);\n\t\t}\n\n\t\treturn taskService.getStoreTask(id);\n\t}\n\n\tasync getCopy(id: number, tmpId: string): Promise<void>\n\t{\n\t\tconst template = await this.get(id);\n\n\t\tif (template.checklist?.length > 0)\n\t\t{\n\t\t\tawait checkListService.load(id, tmpId);\n\t\t}\n\n\t\tconst fields = {\n\t\t\ttitle: template.title,\n\t\t\tdescription: template.description,\n\t\t\tcreatorId: template.creatorId,\n\t\t\tresponsibleIds: template.isForNewUser ? [0] : template.responsibleIds,\n\t\t\tdeadlineAfter: template.deadlineAfter,\n\t\t\tneedsControl: template.needsControl,\n\t\t\tstartDatePlanAfter: template.startDatePlanAfter,\n\t\t\tendDatePlanAfter: template.endDatePlanAfter,\n\t\t\tfileIds: template.fileIds,\n\t\t\tgroupId: template.groupId,\n\t\t\tisImportant: template.isImportant,\n\t\t\taccomplicesIds: template.accomplicesIds,\n\t\t\tauditorsIds: template.auditorsIds,\n\t\t\tparentId: template.parentId,\n\t\t\tallowsChangeDeadline: template.allowsChangeDeadline,\n\t\t\tmatchesWorkTime: template.matchesWorkTime,\n\t\t\ttags: template.tags,\n\t\t\tcrmItemIds: template.crmItemIds,\n\t\t\tcontainsRelatedTasks: template.containsRelatedTasks,\n\t\t\trelatedTaskIds: template.relatedTaskIds,\n\t\t\tallowsTimeTracking: template.allowsTimeTracking,\n\t\t\testimatedTime: template.estimatedTime,\n\t\t\tpermissions: [],\n\t\t\tuserFields: template.userFields,\n\t\t\tisForNewUser: template.isForNewUser,\n\t\t\treplicate: template.replicate,\n\t\t\treplicateParams: template.replicateParams,\n\t\t};\n\n\t\tfields.permissions = permissionBuilder.getPermissions(fields);\n\n\t\tif (Type.isArrayFilled(fields.userFields))\n\t\t{\n\t\t\tfields.userFields = userFieldsManager.prepareUserFieldsForTaskFromTemplate(\n\t\t\t\tfields.userFields,\n\t\t\t\tCore.getParams().templateUserFieldScheme,\n\t\t\t);\n\t\t}\n\n\t\ttaskService.updateStoreTask(tmpId, fields);\n\t}\n\n\tasync add(template: TaskModel): Promise<[number, ?Error]>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst data = await apiClient.post(Endpoint.TemplateAdd, {\n\t\t\t\ttemplate: TaskMappers.mapModelToDto(template),\n\t\t\t});\n\n\t\t\tdata.id = idUtils.boxTemplate(data.id);\n\n\t\t\ttaskService.updateStoreTask(template.id, { id: data.id });\n\n\t\t\ttaskService.extractTask({ ...data, rights: mapRights(data.rights) });\n\n\t\t\tEventEmitter.emit(EventName.TemplateAdded, {\n\t\t\t\ttemplate: taskService.getStoreTask(data.id),\n\t\t\t\tinitialTemplate: template,\n\t\t\t});\n\n\t\t\tif (template.parentId)\n\t\t\t{\n\t\t\t\tsubTasksService.addStore(template.parentId, [data.id]);\n\t\t\t}\n\n\t\t\tif (template.checklist?.length > 0)\n\t\t\t{\n\t\t\t\tvoid checkListService.save(\n\t\t\t\t\tdata.id,\n\t\t\t\t\tthis.$store.getters[`${Model.CheckList}/getByIds`](template.checklist),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn [data.id, null];\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(Endpoint.TemplateAdd, error);\n\n\t\t\treturn [0, new Error(error.errors?.[0]?.message)];\n\t\t}\n\t}\n\n\tasync copy(template: TaskModel): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst data = await apiClient.post(Endpoint.TemplateCopy, {\n\t\t\t\ttemplate: TaskMappers.mapModelToDto({ ...template, id: template.copiedFromId }),\n\t\t\t});\n\n\t\t\tdata.id = idUtils.boxTemplate(data.id);\n\n\t\t\ttaskService.updateStoreTask(template.id, { id: data.id });\n\n\t\t\ttaskService.extractTask({ ...data, rights: mapRights(data.rights) });\n\n\t\t\tEventEmitter.emit(EventName.TemplateAdded, {\n\t\t\t\ttemplate: taskService.getStoreTask(data.id),\n\t\t\t\tinitialTemplate: template,\n\t\t\t});\n\n\t\t\tif (template.checklist?.length > 0)\n\t\t\t{\n\t\t\t\tvoid checkListService.save(\n\t\t\t\t\tdata.id,\n\t\t\t\t\tthis.$store.getters[`${Model.CheckList}/getByIds`](template.checklist),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn [data.id, null];\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(Endpoint.TemplateCopy, error);\n\n\t\t\treturn [0, new Error(error.errors?.[0]?.message)];\n\t\t}\n\t}\n\n\tasync getTask(templateId: number, taskId: TaskId): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst data: TaskDto = await apiClient.post(Endpoint.TaskFromTemplateGet, { templateId });\n\n\t\t\tdata.id = taskId;\n\t\t\tdata.templateId = templateId;\n\n\t\t\tconst isAdmin = Core.getParams().rights.user.admin;\n\n\t\t\tif (\n\t\t\t\t!isAdmin\n\t\t\t\t&& (\n\t\t\t\t\tdata.responsible?.id !== Core.getParams().currentUser.id\n\t\t\t\t\t|| Type.isArrayFilled(data.multiResponsibles)\n\t\t\t\t)\n\t\t\t)\n\t\t\t{\n\t\t\t\tdata.creator = Core.getParams().currentUser;\n\t\t\t}\n\n\t\t\tdata.group ??= { id: 0 };\n\t\t\tdata.stage ??= { id: 0 };\n\n\t\t\tconst tmpTask = taskService.getStoreTask(taskId);\n\t\t\tif (tmpTask.flowId)\n\t\t\t{\n\t\t\t\tdata.creator = Core.getParams().currentUser;\n\t\t\t\tdata.responsible = Core.getParams().currentUser;\n\t\t\t\tdata.description = tmpTask.description + data.description;\n\t\t\t\tdelete data.multiResponsibles;\n\t\t\t\tdelete data.deadlineTs;\n\t\t\t\tdelete data.group;\n\t\t\t}\n\n\t\t\tif (Type.isArrayFilled(tmpTask.crmItemIds))\n\t\t\t{\n\t\t\t\tconst uniqueCrmItemIds: Set<number> = new Set(\n\t\t\t\t\t[...(tmpTask.crmItemIds || []), ...(data.crmItemIds || [])],\n\t\t\t\t);\n\t\t\t\tdata.crmItemIds = [...uniqueCrmItemIds];\n\n\t\t\t\tconst uniqueTags: Set<string> = new Set();\n\t\t\t\t[...(tmpTask.tags || []), ...(data.tags || [])].forEach((tag: TagDto | string): void => {\n\t\t\t\t\tif (Type.isString(tag))\n\t\t\t\t\t{\n\t\t\t\t\t\tuniqueTags.add(tag);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tuniqueTags.add(tag.name);\n\t\t\t\t});\n\n\t\t\t\tdata.tags = [...uniqueTags].map((tag: string): TagDto => ({ name: tag }));\n\t\t\t}\n\n\t\t\tif (Type.isArrayFilled(data.userFields))\n\t\t\t{\n\t\t\t\tdata.userFields = userFieldsManager.prepareUserFieldsForTaskFromTemplate(\n\t\t\t\t\tdata.userFields,\n\t\t\t\t\tCore.getParams().taskUserFieldScheme,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\ttaskService.extractTask(data, false);\n\n\t\t\tif (data.checklist?.length > 0)\n\t\t\t{\n\t\t\t\tawait checkListService.load(taskId);\n\t\t\t}\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(Endpoint.TaskFromTemplateGet, error);\n\t\t}\n\t}\n\n\tasync addTask(templateId: number, task: TaskModel, withSubTasks: boolean): Promise<[number, ?Error]>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst data = await apiClient.post(Endpoint.TaskFromTemplateAdd, {\n\t\t\t\ttemplate: { id: templateId },\n\t\t\t\ttask: TaskMappers.mapModelToDto(task),\n\t\t\t\twithSubTasks,\n\t\t\t});\n\n\t\t\tdata.templateId = 0;\n\n\t\t\tawait taskService.onAfterTaskAdded(task, data);\n\n\t\t\treturn [data.id, null];\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(Endpoint.TaskFromTemplateAdd, error);\n\n\t\t\treturn [0, new Error(error.errors?.[0]?.message)];\n\t\t}\n\t}\n\n\tasync update(id: string, fields: TaskModel): Promise<void>\n\t{\n\t\tconst templateBefore = taskService.getStoreTask(id);\n\n\t\tif (!taskService.hasChanges(templateBefore, fields))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttaskService.updateStoreTask(id, fields);\n\n\t\tif (!idUtils.isReal(id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(EventName.TemplateBeforeUpdate, {\n\t\t\ttemplate: taskService.getStoreTask(id),\n\t\t\tfields: { id, ...fields },\n\t\t});\n\n\t\tawait this.#updateDebounced(id, fields, templateBefore);\n\t}\n\n\tasync delete(id: string): Promise<void>\n\t{\n\t\tconst templateBeforeDelete = taskService.getStoreTask(id);\n\n\t\tawait taskService.deleteStore(id);\n\n\t\tif (!idUtils.isReal(id))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst templateId = idUtils.unbox(id);\n\n\t\ttry\n\t\t{\n\t\t\tawait apiClient.post(Endpoint.TemplateDelete, { templateId });\n\n\t\t\tEventEmitter.emit(EventName.TemplateDeleted, { id: templateId });\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tawait taskService.insertStoreTask(templateBeforeDelete);\n\n\t\t\tconsole.error(Endpoint.TemplateDelete, error);\n\t\t}\n\t}\n\n\tasync insertStoreTask(task: TaskModel): Promise<void>\n\t{\n\t\tawait this.$store.dispatch(`${Model.Tasks}/insert`, {\n\t\t\t...task,\n\t\t\tpermissions: [],\n\t\t});\n\t}\n\n\t#updateFields: { [id: string]: TaskModel } = {};\n\t#updateTaskBefore: { [id: string]: TaskModel } = {};\n\t#updatePromises: { [id: string]: Resolvable } = {};\n\t#updateServerTaskDebounced: { [id: string]: Function } = {};\n\n\t#updateDebounced(id: string, fields: TaskModel, templateBefore: TaskModel): Promise<void>\n\t{\n\t\tthis.#updateFields[id] = { ...this.#updateFields[id], ...fields };\n\t\tthis.#updateTaskBefore[id] ??= templateBefore;\n\t\tthis.#updatePromises[id] ??= new Resolvable();\n\t\tthis.#updateServerTaskDebounced[id] ??= Runtime.debounce(this.#requestUpdate, 500, this);\n\t\tthis.#updateServerTaskDebounced[id](id);\n\n\t\treturn this.#updatePromises[id];\n\t}\n\n\tasync #requestUpdate(id: string): Promise<void>\n\t{\n\t\tconst fields = this.#updateFields[id];\n\t\tdelete this.#updateFields[id];\n\n\t\tconst templateBefore = this.#updateTaskBefore[id];\n\t\tdelete this.#updateTaskBefore[id];\n\n\t\tconst promise = this.#updatePromises[id];\n\t\tdelete this.#updatePromises[id];\n\n\t\tconst templateId = idUtils.unbox(id);\n\n\t\ttry\n\t\t{\n\t\t\tawait apiClient.post(\n\t\t\t\tEndpoint.TemplateUpdate,\n\t\t\t\t{ template: TaskMappers.mapModelToDto({ id: templateId, ...fields }) },\n\t\t\t);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\ttaskService.updateStoreTask(id, templateBefore);\n\n\t\t\tconsole.error(Endpoint.TemplateUpdate, error);\n\t\t}\n\n\t\tpromise.resolve();\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}();\n\nfunction Resolvable(): Promise\n{\n\tconst promise = new Promise((resolve) => {\n\t\tthis.resolve = resolve;\n\t});\n\n\tpromise.resolve = this.resolve;\n\n\treturn promise;\n}\n","import { mapPermissionDtoToModel, mapPermissionModelToDto, mapDtoToTaskDto, mapRights } from './mappers';\n\nexport { templateService } from './template-service';\nexport const TemplateMappers = { mapPermissionDtoToModel, mapPermissionModelToDto, mapDtoToTaskDto, mapRights };\n\nexport { permissionBuilder } from './mappers/permission-builder';\nexport type { TemplatePermission } from './types';\n"],"names":["permissionBuilder","getPermissions","task","currentUserId","Core","getParams","currentUser","id","permissions","map","p","idUtils","isReal","creatorId","buildFromItem","item","entityId","getId","entityType","getEntityId","EntitySelectorEntity","Group","Project","includes","buildId","title","getTitle","image","getAvatar","permission","PermissionType","Full","buildItemId","mainDepartmentId","mainDepartmentUfId","type","Department","MetaUser","AllUser","userId","push","find","it","User","user","getStore","getters","Model","Users","name","mapPermissionDtoToModel","dto","accessEntity","src","permissionId","mapPermissionModelToDto","mapRights","read","edit","remove","create","complete","approve","disapprove","start","take","delegate","defer","renew","deadline","datePlan","changeDirector","changeResponsible","changeAccomplices","pause","timeTracking","rate","changeStatus","reminder","addAuditors","elapsedTime","favorite","checklistAdd","checklistEdit","checklistSave","checklistToggle","automate","resultEdit","completeResult","removeResult","resultRead","admin","watch","mute","createSubtask","copy","createFromTemplate","saveAsTemplate","attachFile","detachFile","detachParent","detachRelated","changeDependence","createGanttDependence","sort","mapDtoToTaskDto","templateDto","responsibleCollection","deadlineTs","mapValue","deadlineAfter","ceilTs","Date","now","step","timestamp","Math","ceil","value","mapped","Type","isNil","templateService","constructor","Event","bind","window","setTimeout","pendingIds","Object","keys","forEach","get","data","apiClient","post","Endpoint","TemplateGet","templateId","unbox","taskService","extractTask","rights","error","console","getStoreTask","getCopy","tmpId","template","checklist","length","checkListService","load","fields","description","responsibleIds","isForNewUser","needsControl","startDatePlanAfter","endDatePlanAfter","fileIds","groupId","isImportant","accomplicesIds","auditorsIds","parentId","allowsChangeDeadline","matchesWorkTime","tags","crmItemIds","containsRelatedTasks","relatedTaskIds","allowsTimeTracking","estimatedTime","userFields","replicate","replicateParams","isArrayFilled","userFieldsManager","prepareUserFieldsForTaskFromTemplate","templateUserFieldScheme","updateStoreTask","add","TemplateAdd","TaskMappers","mapModelToDto","boxTemplate","EventEmitter","emit","EventName","TemplateAdded","initialTemplate","subTasksService","addStore","save","$store","CheckList","Error","errors","message","TemplateCopy","copiedFromId","getTask","taskId","TaskFromTemplateGet","isAdmin","responsible","multiResponsibles","creator","group","stage","tmpTask","flowId","uniqueCrmItemIds","Set","uniqueTags","tag","isString","taskUserFieldScheme","addTask","withSubTasks","TaskFromTemplateAdd","onAfterTaskAdded","update","templateBefore","hasChanges","TemplateBeforeUpdate","delete","templateBeforeDelete","deleteStore","TemplateDelete","TemplateDeleted","insertStoreTask","dispatch","Tasks","Resolvable","Runtime","debounce","promise","TemplateUpdate","resolve","Promise","TemplateMappers"],"mappings":"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"}