{"version":3,"file":"file-service.bundle.js","sources":["../src/mappers.js","../src/util.js","../src/file-service.js"],"sourcesContent":["import type { UploaderFileInfo } from 'ui.uploader.core';\nimport type { FileDto } from './types';\n\nexport function mapDtoToModel(fileDto: FileDto): UploaderFileInfo\n{\n\treturn {\n\t\tserverFileId: fileDto.id,\n\t\tserverId: fileDto.serverId,\n\t\ttype: fileDto.type,\n\t\tname: fileDto.name,\n\t\tsize: fileDto.size,\n\t\twidth: fileDto.width,\n\t\theight: fileDto.height,\n\t\tisImage: fileDto.isImage,\n\t\tisVideo: fileDto.isVideo,\n\t\ttreatImageAsFile: fileDto.treatImageAsFile,\n\t\tdownloadUrl: fileDto.downloadUrl,\n\t\tpreviewUrl: fileDto.serverPreviewUrl,\n\t\tserverPreviewUrl: fileDto.serverPreviewUrl,\n\t\tserverPreviewWidth: fileDto.serverPreviewWidth,\n\t\tserverPreviewHeight: fileDto.serverPreviewHeight,\n\t\tcustomData: fileDto.customData,\n\t\tviewerAttrs: fileDto.viewerAttrs,\n\t};\n}\n","import { Type } from 'main.core';\n\nexport const processCheckListFileIds = (fileIds) => {\n\tif (!Array.isArray(fileIds))\n\t{\n\t\treturn [];\n\t}\n\n\treturn fileIds.reduce((result, item) => {\n\t\tif (Type.isObjectLike(item) && 'id' in item && 'fileId' in item)\n\t\t{\n\t\t\tresult.push({\n\t\t\t\tid: item.id,\n\t\t\t\tfileId: item.fileId,\n\t\t\t});\n\t\t}\n\t\telse if (Type.isString(item) && item.startsWith('n'))\n\t\t{\n\t\t\tresult.push({\n\t\t\t\tid: item,\n\t\t\t\tfileId: item,\n\t\t\t});\n\t\t}\n\n\t\treturn result;\n\t}, []);\n};\n","import { Runtime, Type, Loc, Text, Event } from 'main.core';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\n\nimport { FileStatus, type UploaderFileInfo } from 'ui.uploader.core';\nimport { VueUploaderAdapter } from 'ui.uploader.vue';\nimport { VueRefValue } from 'ui.vue3';\nimport { Notifier } from 'ui.notification-manager';\nimport type { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'tasks.v2.core';\nimport { Model, Endpoint } from 'tasks.v2.const';\nimport { apiClient } from 'tasks.v2.lib.api-client';\nimport { idUtils } from 'tasks.v2.lib.id-utils';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\n\nimport { mapDtoToModel } from './mappers';\nimport { processCheckListFileIds } from './util';\nimport type { FileId, FileDto } from './types';\n\nexport type BrowseParams = {\n\tbindElement: HTMLElement,\n\tonShowCallback?: Function,\n\tonHideCallback?: Function,\n\tcompact: boolean,\n};\n\nexport const EntityTypes = Object.freeze({\n\tTask: 'task',\n\tCheckListItem: 'checkListItem',\n\tResult: 'result',\n});\n\nexport type EntityType = $Values<typeof EntityTypes>;\n\nexport class FileService extends EventEmitter\n{\n\t#entityId: number | string;\n\t#entityType: EntityType;\n\t#loadedIds: Set<FileId> = new Set();\n\t#objectsIds: { [id: FileId]: number } = {};\n\t#promises: Promise[] = [];\n\t#adapter: VueUploaderAdapter | null = null;\n\t#fileBrowserClosed: boolean = false;\n\t#filesToAttach: UploaderFileInfo[] = [];\n\t#filesToDetach: UploaderFileInfo[] = [];\n\t#isDetachedErrorMode: boolean = false;\n\t#browseElement: HTMLElement;\n\t#saveAttachedFilesDebounced: Function;\n\t#saveDetachedFilesDebounced: Function;\n\n\tconstructor(entityId: number | string, entityType: EntityType = EntityTypes.Task)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('Tasks.V2.Provider.Service.FileService');\n\t\tthis.setEntityId(entityId, entityType);\n\t\tthis.initAdapter(entityId, entityType);\n\t\tthis.#bindEvents();\n\n\t\tthis.#saveAttachedFilesDebounced = Runtime.debounce(this.#saveAttachedFiles, 3000, this);\n\t\tthis.#saveDetachedFilesDebounced = Runtime.debounce(this.#saveDetachedFiles, 3000, this);\n\t}\n\n\tinitAdapter(entityId: number | string, entityType: EntityType): void\n\t{\n\t\tthis.#adapter = new VueUploaderAdapter({\n\t\t\tid: getKey(entityId, entityType),\n\t\t\tcontroller: Core.getParams().features.disk ? 'disk.uf.integration.diskUploaderController' : null,\n\t\t\timagePreviewHeight: 1200,\n\t\t\timagePreviewWidth: 1200,\n\t\t\timagePreviewQuality: 0.85,\n\t\t\tignoreUnknownImageTypes: true,\n\t\t\ttreatOversizeImageAsFile: true,\n\t\t\tmultiple: true,\n\t\t\tmaxFileSize: null,\n\t\t});\n\n\t\tthis.#adapter.subscribeFromOptions({\n\t\t\t'Item:onAdd': (event: BaseEvent) => {\n\t\t\t\tconst { item: file } = event.getData();\n\n\t\t\t\tthis.#addLoadedIds([file.serverFileId]);\n\n\t\t\t\tthis.emit('onFileAdd');\n\t\t\t},\n\t\t\t'Item:onComplete': (event: BaseEvent) => {\n\t\t\t\tconst { item: file } = event.getData();\n\n\t\t\t\tthis.#addLoadedObjectsIds([file]);\n\n\t\t\t\tconst fileIds = new Set(this.#entityFileIds);\n\t\t\t\tif (!this.#getIdsByObjectId(file.customData.objectId).some((id: FileId) => fileIds.has(id)))\n\t\t\t\t{\n\t\t\t\t\tthis.#attachFiles([...fileIds, file.serverFileId], file);\n\t\t\t\t}\n\n\t\t\t\tthis.emit('onFileComplete', file);\n\t\t\t},\n\t\t\t'Item:onRemove': (event: BaseEvent) => {\n\t\t\t\tconst { item: file } = event.getData();\n\n\t\t\t\tconst idsToRemove = new Set(this.#getIdsByObjectId(file.customData.objectId));\n\t\t\t\tthis.#removeLoadedObjectsIds(idsToRemove);\n\n\t\t\t\tthis.#detachFiles(this.#getEntityFileIds(idsToRemove), file);\n\n\t\t\t\tthis.emit('onFileRemove', { file });\n\t\t\t},\n\t\t});\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tif (this.#entityType === EntityTypes.Task)\n\t\t{\n\t\t\tEvent.bind(window, 'beforeunload', this.handleSave);\n\t\t}\n\t}\n\n\t#unbindEvents(): void\n\t{\n\t\tif (this.#entityType === EntityTypes.Task)\n\t\t{\n\t\t\tEvent.unbind(window, 'beforeunload', this.handleSave);\n\t\t}\n\t}\n\n\thandleSave = async (): Promise<void> => {\n\t\tawait this.#saveAttachedFiles();\n\t\tawait this.#saveDetachedFiles();\n\t};\n\n\tsetEntityId(entityId: number | string, entityType: EntityType = EntityTypes.Task): void\n\t{\n\t\tthis.#entityId = entityId;\n\t\tthis.#entityType = entityType;\n\t}\n\n\tgetEntityId(): string\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\tgetAdapter(): VueUploaderAdapter\n\t{\n\t\treturn this.#adapter;\n\t}\n\n\tgetFiles(): VueRefValue<UploaderFileInfo>\n\t{\n\t\treturn this.#adapter.getReactiveItems();\n\t}\n\n\tgetFileItems(): UploaderFileInfo[]\n\t{\n\t\treturn this.#adapter.getItems();\n\t}\n\n\tisUploading(): boolean\n\t{\n\t\treturn this.getFileItems().some(({ status }) => [\n\t\t\tFileStatus.UPLOADING,\n\t\t\tFileStatus.LOADING,\n\t\t].includes(status));\n\t}\n\n\thasUploadingError(): boolean\n\t{\n\t\treturn this.getFileItems().some(({ status }) => [\n\t\t\tFileStatus.UPLOAD_FAILED,\n\t\t\tFileStatus.LOAD_FAILED,\n\t\t].includes(status));\n\t}\n\n\tbrowse(params: BrowseParams): void\n\t{\n\t\tRuntime.loadExtension('disk.uploader.user-field-widget')\n\t\t\t.then(({ UserFieldMenu }) => {\n\t\t\t\tconst menu = new UserFieldMenu({\n\t\t\t\t\tdialogId: 'task-card',\n\t\t\t\t\tuploader: this.#adapter.getUploader(),\n\t\t\t\t\tcompact: params.compact || false,\n\t\t\t\t\tmenuOptions: {\n\t\t\t\t\t\tminWidth: 220,\n\t\t\t\t\t\tanimation: 'fading',\n\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonPopupClose: () => {\n\t\t\t\t\t\t\t\tparams.onHideCallback?.();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tonPopupShow: () => {\n\t\t\t\t\t\t\t\tparams.onShowCallback?.();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tmenu.show(params.bindElement);\n\t\t\t})\n\t\t\t.catch((error) => console.error(error))\n\t\t;\n\t}\n\n\tbrowseFiles(): void\n\t{\n\t\tif (!this.#browseElement)\n\t\t{\n\t\t\tthis.#browseElement = document.createElement('div');\n\t\t\tthis.#adapter.getUploader().assignBrowse(this.#browseElement);\n\t\t}\n\n\t\tthis.#browseElement.click();\n\t}\n\n\tbrowseMyDrive(): void\n\t{\n\t\tRuntime.loadExtension('disk.uploader.user-field-widget')\n\t\t\t.then(({ openDiskFileDialog }) => {\n\t\t\t\topenDiskFileDialog({\n\t\t\t\t\tdialogId: 'task-card',\n\t\t\t\t\tuploader: this.#adapter.getUploader(),\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((error) => console.error(error))\n\t\t;\n\t}\n\n\tsetFileBrowserClosed(value: boolean): void\n\t{\n\t\tthis.#fileBrowserClosed = value;\n\t}\n\n\tisFileBrowserClosed(): boolean\n\t{\n\t\treturn this.#fileBrowserClosed;\n\t}\n\n\tresetFileBrowserClosedState(): void\n\t{\n\t\tthis.#fileBrowserClosed = false;\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#adapter.unsubscribeAll('Item:onAdd');\n\t\tthis.#adapter.unsubscribeAll('Item:onComplete');\n\t\tthis.#adapter.unsubscribeAll('Item:onRemove');\n\t\tthis.#adapter.getUploader().destroy();\n\n\t\tthis.#unbindEvents();\n\t}\n\n\tasync sync(ids: FileId[] | null): Promise<void>\n\t{\n\t\tif (!Type.isArrayFilled(ids))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.list(ids);\n\t}\n\n\tasync list(ids: FileId[]): Promise<UploaderFileInfo[]>\n\t{\n\t\tconst unloadedIds = ids.filter((id) => !this.#loadedIds.has(id));\n\t\tif (unloadedIds.length === 0)\n\t\t{\n\t\t\tawait Promise.all(this.#promises);\n\n\t\t\treturn this.getFileItems();\n\t\t}\n\n\t\tconst promise = new Resolvable();\n\t\tthis.#promises.push(promise);\n\t\tthis.#addLoadedIds(unloadedIds);\n\n\t\ttry\n\t\t{\n\t\t\tconst data = await apiClient.post(Endpoint.FileListObjects, {\n\t\t\t\tids: unloadedIds,\n\t\t\t});\n\n\t\t\tthis.#handleLoadedFiles(data);\n\n\t\t\tpromise.resolve();\n\n\t\t\tawait Promise.all(this.#promises);\n\n\t\t\treturn this.getFileItems();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error(Endpoint.FileListObjects, error);\n\n\t\t\treturn [];\n\t\t}\n\t}\n\n\tloadFilesFromData(data: FileDto[]): void\n\t{\n\t\tconst ids = data.map((fileDto: FileDto) => fileDto.id);\n\n\t\tthis.#addLoadedIds(ids);\n\n\t\tthis.#handleLoadedFiles(data);\n\t}\n\n\thasPendingRequests(): boolean\n\t{\n\t\treturn this.#filesToAttach.length > 0 || this.#filesToDetach.length > 0;\n\t}\n\n\t#handleLoadedFiles(data: FileDto[]): void\n\t{\n\t\tconst files = data.map((fileDto: FileDto) => mapDtoToModel(fileDto));\n\n\t\tconst objectsIds = new Set(Object.values(this.#objectsIds));\n\t\tconst newFiles = files.filter(({ customData }) => !objectsIds.has(customData.objectId));\n\t\tthis.#adapter.getUploader().addFiles(newFiles);\n\t\tthis.#addLoadedObjectsIds(files);\n\t}\n\n\t#addLoadedIds(ids: FileId[]): void\n\t{\n\t\tids.forEach((id: FileId): void => this.#loadedIds.add(id));\n\t}\n\n\t#addLoadedObjectsIds(files: UploaderFileInfo[]): void\n\t{\n\t\tfiles.forEach((file: UploaderFileInfo) => {\n\t\t\tthis.#objectsIds[file.serverFileId] = file.customData.objectId;\n\t\t});\n\t}\n\n\t#removeLoadedObjectsIds(ids: FileId[]): void\n\t{\n\t\tids.forEach((id: FileId) => {\n\t\t\tdelete this.#objectsIds[id];\n\t\t});\n\t}\n\n\t#getIdsByObjectId(objectIdToFind: number): FileId[]\n\t{\n\t\treturn Object.entries(this.#objectsIds)\n\t\t\t.filter(([, objectId]): boolean => objectId === objectIdToFind)\n\t\t\t.map(([id]): FileId => (this.#isObjectId(id) ? id : Number(id)))\n\t\t;\n\t}\n\n\t#attachFiles(fileIds: FileId[], attachedFile: UploaderFileInfo): void\n\t{\n\t\tswitch (this.#entityType)\n\t\t{\n\t\t\tcase EntityTypes.Task:\n\t\t\t{\n\t\t\t\tconst id = this.#entityId;\n\n\t\t\t\tvoid taskService.updateStoreTask(id, { fileIds });\n\n\t\t\t\tif (this.#isDetachedErrorMode)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (idUtils.isReal(id) && this.#isObjectId(attachedFile.serverFileId))\n\t\t\t\t{\n\t\t\t\t\tthis.#filesToAttach.push(attachedFile);\n\t\t\t\t\tthis.#saveAttachedFilesDebounced();\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase EntityTypes.CheckListItem:\n\t\t\t{\n\t\t\t\tthis.#processCheckListFileIds(fileIds);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase EntityTypes.Result:\n\t\t\t{\n\t\t\t\tvoid this.$store.dispatch(`${Model.Results}/update`, {\n\t\t\t\t\tid: this.#entityId,\n\t\t\t\t\tfields: { fileIds },\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t#detachFiles(fileIds: FileId[], detachedFile: UploaderFileInfo): void\n\t{\n\t\tswitch (this.#entityType)\n\t\t{\n\t\t\tcase EntityTypes.Task:\n\t\t\t{\n\t\t\t\tconst id = this.#entityId;\n\n\t\t\t\tvoid taskService.updateStoreTask(id, { fileIds });\n\n\t\t\t\tif (idUtils.isReal(id))\n\t\t\t\t{\n\t\t\t\t\tconst detachedId = detachedFile.serverFileId;\n\t\t\t\t\tconst attachedIndex = this.#filesToAttach.findIndex((file) => file.serverFileId === detachedId);\n\t\t\t\t\tif (attachedIndex === -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#filesToDetach.push(detachedFile);\n\t\t\t\t\t\tthis.#saveDetachedFilesDebounced();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#filesToAttach.splice(attachedIndex, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase EntityTypes.CheckListItem:\n\t\t\t{\n\t\t\t\tthis.#processCheckListFileIds(fileIds);\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase EntityTypes.Result:\n\t\t\t{\n\t\t\t\tvoid this.$store.dispatch(`${Model.Results}/update`, {\n\t\t\t\t\tid: this.#entityId,\n\t\t\t\t\tfields: { fileIds },\n\t\t\t\t});\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t#getEntityFileIds(excludedIds: Set<FileId> = new Set()): []\n\t{\n\t\tif (this.#entityType === EntityTypes.Task || this.#entityType === EntityTypes.Result)\n\t\t{\n\t\t\treturn this.#entityFileIds.filter((id: FileId) => !excludedIds.has(id));\n\t\t}\n\n\t\tif (this.#entityType === EntityTypes.CheckListItem)\n\t\t{\n\t\t\treturn this.#entityFileIds.filter((attach) => !excludedIds.has(attach.id));\n\t\t}\n\n\t\treturn [];\n\t}\n\n\t#processCheckListFileIds(fileIds: FileId[]): void\n\t{\n\t\tconst attachments = processCheckListFileIds(fileIds);\n\n\t\tvoid this.$store.dispatch(`${Model.CheckList}/update`, {\n\t\t\tid: this.#entityId,\n\t\t\tfields: { attachments },\n\t\t});\n\t}\n\n\t#isObjectId(id: number | string): boolean\n\t{\n\t\treturn String(id).startsWith('n');\n\t}\n\n\tasync #saveAttachedFiles(): void\n\t{\n\t\tif (Type.isArrayFilled(this.#filesToAttach))\n\t\t{\n\t\t\tconst id = idUtils.unbox(this.#entityId);\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst ids = this.#filesToAttach.map((file) => file.serverFileId);\n\t\t\t\tthis.#filesToAttach = [];\n\n\t\t\t\tif (idUtils.isTemplate(this.#entityId))\n\t\t\t\t{\n\t\t\t\t\tawait apiClient.post(Endpoint.TemplateUpdate, { template: { id, fileIds: this.#entityFileIds } });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tawait apiClient.post(Endpoint.FileAttach, { task: { id }, ids });\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error('FileService: saveAttachedFiles error', error);\n\n\t\t\t\tthis.notifyError(Loc.getMessage('TASKS_V2_NOTIFY_FILE_ATTACH_ERROR'));\n\t\t\t}\n\t\t}\n\t}\n\n\tasync #saveDetachedFiles(): void\n\t{\n\t\tif (Type.isArrayFilled(this.#filesToDetach))\n\t\t{\n\t\t\tconst id = idUtils.unbox(this.#entityId);\n\t\t\tconst filesBeforeDetach = this.#filesToDetach;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tconst ids = this.#filesToDetach.map((file) => file.serverFileId);\n\t\t\t\tthis.#filesToDetach = [];\n\n\t\t\t\tif (idUtils.isTemplate(this.#entityId))\n\t\t\t\t{\n\t\t\t\t\tawait apiClient.post(Endpoint.TemplateUpdate, { template: { id, fileIds: this.#entityFileIds } });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tawait apiClient.post(Endpoint.FileDetach, { task: { id }, ids });\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error('FileService: saveDetachedFiles error', error);\n\n\t\t\t\tthis.#isDetachedErrorMode = true;\n\n\t\t\t\tthis.#adapter.getUploader().addFiles(filesBeforeDetach);\n\n\t\t\t\tthis.#isDetachedErrorMode = false;\n\n\t\t\t\tthis.notifyError(Loc.getMessage('TASKS_V2_NOTIFY_FILE_DETACH_ERROR'));\n\t\t\t}\n\t\t}\n\t}\n\n\tnotifyError(text: string): void\n\t{\n\t\tNotifier.notifyViaBrowserProvider({\n\t\t\tid: `file-service-error-${Text.getRandom()}`,\n\t\t\ttext,\n\t\t});\n\t}\n\n\tget #entityFileIds(): []\n\t{\n\t\tif (this.#entityType === EntityTypes.Task)\n\t\t{\n\t\t\treturn taskService.getStoreTask(this.#entityId).fileIds;\n\t\t}\n\n\t\tif (this.#entityType === EntityTypes.Result)\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Results}/getById`](this.#entityId).fileIds;\n\t\t}\n\n\t\treturn this.$store.getters[`${Model.CheckList}/getById`](this.#entityId).attachments;\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n\nconst services: { [key: string]: FileService } = {};\n\nconst getKey = (entityId: number, entityType: EntityType): string => `${entityType}:${entityId}`;\n\nexport const fileService = {\n\tget(entityId: number, entityType: EntityType = EntityTypes.Task): FileService\n\t{\n\t\tconst key = getKey(entityId, entityType);\n\t\tservices[key] ??= new FileService(entityId, entityType);\n\n\t\treturn services[key];\n\t},\n\treplace(tempId: number, entityId: number, entityType: EntityType = EntityTypes.Task): void\n\t{\n\t\tconst oldKey = getKey(tempId, entityType);\n\t\tconst newKey = getKey(entityId, entityType);\n\n\t\tservices[newKey] = services[oldKey];\n\t\tservices[newKey].setEntityId(entityId, entityType);\n\n\t\tdelete services[oldKey];\n\t},\n\tdelete(entityId: number, entityType: EntityType = EntityTypes.Task): void\n\t{\n\t\tconst key = getKey(entityId, entityType);\n\n\t\tservices[key]?.destroy();\n\n\t\tdelete services[key];\n\t},\n};\n\nfunction Resolvable(): Promise\n{\n\tconst promise = new Promise((resolve) => {\n\t\tthis.resolve = resolve;\n\t});\n\n\tpromise.resolve = this.resolve;\n\n\treturn promise;\n}\n"],"names":["mapDtoToModel","fileDto","serverFileId","id","serverId","type","name","size","width","height","isImage","isVideo","treatImageAsFile","downloadUrl","previewUrl","serverPreviewUrl","serverPreviewWidth","serverPreviewHeight","customData","viewerAttrs","processCheckListFileIds","fileIds","Array","isArray","reduce","result","item","Type","isObjectLike","push","fileId","isString","startsWith","EntityTypes","Object","freeze","Task","CheckListItem","Result","FileService","EventEmitter","constructor","entityId","entityType","Set","handleSave","setEventNamespace","setEntityId","initAdapter","Runtime","debounce","VueUploaderAdapter","getKey","controller","Core","getParams","features","disk","imagePreviewHeight","imagePreviewWidth","imagePreviewQuality","ignoreUnknownImageTypes","treatOversizeImageAsFile","multiple","maxFileSize","subscribeFromOptions","event","file","getData","emit","objectId","some","has","idsToRemove","getEntityId","getAdapter","getFiles","getReactiveItems","getFileItems","getItems","isUploading","status","FileStatus","UPLOADING","LOADING","includes","hasUploadingError","UPLOAD_FAILED","LOAD_FAILED","browse","params","loadExtension","then","UserFieldMenu","menu","dialogId","uploader","getUploader","compact","menuOptions","minWidth","animation","closeByEsc","bindOptions","forceBindPosition","events","onPopupClose","onHideCallback","onPopupShow","onShowCallback","show","bindElement","catch","error","console","browseFiles","document","createElement","assignBrowse","click","browseMyDrive","openDiskFileDialog","setFileBrowserClosed","value","isFileBrowserClosed","resetFileBrowserClosedState","destroy","unsubscribeAll","sync","ids","isArrayFilled","list","unloadedIds","filter","length","Promise","all","promise","Resolvable","data","apiClient","post","Endpoint","FileListObjects","resolve","loadFilesFromData","map","hasPendingRequests","notifyError","text","Notifier","notifyViaBrowserProvider","Text","getRandom","$store","getStore","Event","bind","window","unbind","files","objectsIds","values","newFiles","addFiles","forEach","add","objectIdToFind","entries","Number","attachedFile","taskService","updateStoreTask","idUtils","isReal","dispatch","Model","Results","fields","detachedFile","detachedId","attachedIndex","findIndex","splice","excludedIds","attach","attachments","CheckList","String","unbox","isTemplate","TemplateUpdate","template","FileAttach","task","Loc","getMessage","filesBeforeDetach","FileDetach","getStoreTask","getters","services","fileService","get","key","replace","tempId","oldKey","newKey","delete"],"mappings":";;;;;;;;CAGO,SAASA,aAAa,CAACC,OAAgB,EAC9C;GACC,OAAO;KACNC,YAAY,EAAED,OAAO,CAACE,EAAE;KACxBC,QAAQ,EAAEH,OAAO,CAACG,QAAQ;KAC1BC,IAAI,EAAEJ,OAAO,CAACI,IAAI;KAClBC,IAAI,EAAEL,OAAO,CAACK,IAAI;KAClBC,IAAI,EAAEN,OAAO,CAACM,IAAI;KAClBC,KAAK,EAAEP,OAAO,CAACO,KAAK;KACpBC,MAAM,EAAER,OAAO,CAACQ,MAAM;KACtBC,OAAO,EAAET,OAAO,CAACS,OAAO;KACxBC,OAAO,EAAEV,OAAO,CAACU,OAAO;KACxBC,gBAAgB,EAAEX,OAAO,CAACW,gBAAgB;KAC1CC,WAAW,EAAEZ,OAAO,CAACY,WAAW;KAChCC,UAAU,EAAEb,OAAO,CAACc,gBAAgB;KACpCA,gBAAgB,EAAEd,OAAO,CAACc,gBAAgB;KAC1CC,kBAAkB,EAAEf,OAAO,CAACe,kBAAkB;KAC9CC,mBAAmB,EAAEhB,OAAO,CAACgB,mBAAmB;KAChDC,UAAU,EAAEjB,OAAO,CAACiB,UAAU;KAC9BC,WAAW,EAAElB,OAAO,CAACkB;IACrB;CACF;;CCtBO,MAAMC,uBAAuB,GAAIC,OAAO,IAAK;GACnD,IAAI,CAACC,KAAK,CAACC,OAAO,CAACF,OAAO,CAAC,EAC3B;KACC,OAAO,EAAE;;GAGV,OAAOA,OAAO,CAACG,MAAM,CAAC,CAACC,MAAM,EAAEC,IAAI,KAAK;KACvC,IAAIC,cAAI,CAACC,YAAY,CAACF,IAAI,CAAC,IAAI,IAAI,IAAIA,IAAI,IAAI,QAAQ,IAAIA,IAAI,EAC/D;OACCD,MAAM,CAACI,IAAI,CAAC;SACX1B,EAAE,EAAEuB,IAAI,CAACvB,EAAE;SACX2B,MAAM,EAAEJ,IAAI,CAACI;QACb,CAAC;MACF,MACI,IAAIH,cAAI,CAACI,QAAQ,CAACL,IAAI,CAAC,IAAIA,IAAI,CAACM,UAAU,CAAC,GAAG,CAAC,EACpD;OACCP,MAAM,CAACI,IAAI,CAAC;SACX1B,EAAE,EAAEuB,IAAI;SACRI,MAAM,EAAEJ;QACR,CAAC;;KAGH,OAAOD,MAAM;IACb,EAAE,EAAE,CAAC;CACP,CAAC;;OCAYQ,WAAW,GAAGC,MAAM,CAACC,MAAM,CAAC;GACxCC,IAAI,EAAE,MAAM;GACZC,aAAa,EAAE,eAAe;GAC9BC,MAAM,EAAE;CACT,CAAC,CAAC;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAIH,CAAO,MAAMC,WAAW,SAASC,6BAAY,CAC7C;GAeCC,WAAW,CAACC,QAAyB,EAAEC,UAAsB,GAAGV,WAAW,CAACG,IAAI,EAChF;KACC,KAAK,EAAE;KAAC;OAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAdiB,IAAIQ,GAAG;;KAAE;OAAA;OAAA,OACK;;KAAE;OAAA;OAAA,OACnB;;KAAE;OAAA;OAAA,OACa;;KAAI;OAAA;OAAA,OACZ;;KAAK;OAAA;OAAA,OACE;;KAAE;OAAA;OAAA,OACF;;KAAE;OAAA;OAAA,OACP;;KAAK;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA,KAkFrCC,UAAU,GAAG,YAA2B;OACvC,8CAAM,IAAI,2CAAqB;OAC/B,8CAAM,IAAI,2CAAqB;MAC/B;KA5EA,IAAI,CAACC,iBAAiB,CAAC,uCAAuC,CAAC;KAC/D,IAAI,CAACC,WAAW,CAACL,QAAQ,EAAEC,UAAU,CAAC;KACtC,IAAI,CAACK,WAAW,CAACN,QAAQ,EAAEC,UAAU,CAAC;KACtC,4CAAI;KAEJ,4CAAI,8DAA+BM,iBAAO,CAACC,QAAQ,yCAAC,IAAI,2CAAqB,IAAI,EAAE,IAAI,CAAC;KACxF,4CAAI,8DAA+BD,iBAAO,CAACC,QAAQ,yCAAC,IAAI,2CAAqB,IAAI,EAAE,IAAI,CAAC;;GAGzFF,WAAW,CAACN,QAAyB,EAAEC,UAAsB,EAC7D;KACC,4CAAI,wBAAY,IAAIQ,kCAAkB,CAAC;OACtChD,EAAE,EAAEiD,MAAM,CAACV,QAAQ,EAAEC,UAAU,CAAC;OAChCU,UAAU,EAAEC,kBAAI,CAACC,SAAS,EAAE,CAACC,QAAQ,CAACC,IAAI,GAAG,4CAA4C,GAAG,IAAI;OAChGC,kBAAkB,EAAE,IAAI;OACxBC,iBAAiB,EAAE,IAAI;OACvBC,mBAAmB,EAAE,IAAI;OACzBC,uBAAuB,EAAE,IAAI;OAC7BC,wBAAwB,EAAE,IAAI;OAC9BC,QAAQ,EAAE,IAAI;OACdC,WAAW,EAAE;MACb,CAAC;KAEF,4CAAI,sBAAUC,oBAAoB,CAAC;OAClC,YAAY,EAAGC,KAAgB,IAAK;SACnC,MAAM;WAAExC,IAAI,EAAEyC;UAAM,GAAGD,KAAK,CAACE,OAAO,EAAE;SAEtC,4CAAI,gCAAe,CAACD,IAAI,CAACjE,YAAY,CAAC;SAEtC,IAAI,CAACmE,IAAI,CAAC,WAAW,CAAC;QACtB;OACD,iBAAiB,EAAGH,KAAgB,IAAK;SACxC,MAAM;WAAExC,IAAI,EAAEyC;UAAM,GAAGD,KAAK,CAACE,OAAO,EAAE;SAEtC,4CAAI,8CAAsB,CAACD,IAAI,CAAC;SAEhC,MAAM9C,OAAO,GAAG,IAAIuB,GAAG,yCAAC,IAAI,kCAAgB;SAC5C,IAAI,CAAC,4CAAI,wCAAmBuB,IAAI,CAACjD,UAAU,CAACoD,QAAQ,EAAEC,IAAI,CAAEpE,EAAU,IAAKkB,OAAO,CAACmD,GAAG,CAACrE,EAAE,CAAC,CAAC,EAC3F;WACC,4CAAI,8BAAc,CAAC,GAAGkB,OAAO,EAAE8C,IAAI,CAACjE,YAAY,CAAC,EAAEiE,IAAI;;SAGxD,IAAI,CAACE,IAAI,CAAC,gBAAgB,EAAEF,IAAI,CAAC;QACjC;OACD,eAAe,EAAGD,KAAgB,IAAK;SACtC,MAAM;WAAExC,IAAI,EAAEyC;UAAM,GAAGD,KAAK,CAACE,OAAO,EAAE;SAEtC,MAAMK,WAAW,GAAG,IAAI7B,GAAG,yCAAC,IAAI,wCAAmBuB,IAAI,CAACjD,UAAU,CAACoD,QAAQ,EAAE;SAC7E,4CAAI,oDAAyBG,WAAW;SAExC,4CAAI,sEAAc,IAAI,wCAAmBA,WAAW,GAAGN,IAAI;SAE3D,IAAI,CAACE,IAAI,CAAC,cAAc,EAAE;WAAEF;UAAM,CAAC;;MAEpC,CAAC;;GAwBHpB,WAAW,CAACL,QAAyB,EAAEC,UAAsB,GAAGV,WAAW,CAACG,IAAI,EAChF;KACC,4CAAI,0BAAaM,QAAQ;KACzB,4CAAI,8BAAeC,UAAU;;GAG9B+B,WAAW,GACX;KACC,+CAAO,IAAI;;GAGZC,UAAU,GACV;KACC,+CAAO,IAAI;;GAGZC,QAAQ,GACR;KACC,OAAO,4CAAI,sBAAUC,gBAAgB,EAAE;;GAGxCC,YAAY,GACZ;KACC,OAAO,4CAAI,sBAAUC,QAAQ,EAAE;;GAGhCC,WAAW,GACX;KACC,OAAO,IAAI,CAACF,YAAY,EAAE,CAACP,IAAI,CAAC,CAAC;OAAEU;MAAQ,KAAK,CAC/CC,2BAAU,CAACC,SAAS,EACpBD,2BAAU,CAACE,OAAO,CAClB,CAACC,QAAQ,CAACJ,MAAM,CAAC,CAAC;;GAGpBK,iBAAiB,GACjB;KACC,OAAO,IAAI,CAACR,YAAY,EAAE,CAACP,IAAI,CAAC,CAAC;OAAEU;MAAQ,KAAK,CAC/CC,2BAAU,CAACK,aAAa,EACxBL,2BAAU,CAACM,WAAW,CACtB,CAACH,QAAQ,CAACJ,MAAM,CAAC,CAAC;;GAGpBQ,MAAM,CAACC,MAAoB,EAC3B;KACCzC,iBAAO,CAAC0C,aAAa,CAAC,iCAAiC,CAAC,CACtDC,IAAI,CAAC,CAAC;OAAEC;MAAe,KAAK;OAC5B,MAAMC,IAAI,GAAG,IAAID,aAAa,CAAC;SAC9BE,QAAQ,EAAE,WAAW;SACrBC,QAAQ,EAAE,4CAAI,sBAAUC,WAAW,EAAE;SACrCC,OAAO,EAAER,MAAM,CAACQ,OAAO,IAAI,KAAK;SAChCC,WAAW,EAAE;WACZC,QAAQ,EAAE,GAAG;WACbC,SAAS,EAAE,QAAQ;WACnBC,UAAU,EAAE,IAAI;WAChBC,WAAW,EAAE;aACZC,iBAAiB,EAAE;YACnB;WACDC,MAAM,EAAE;aACPC,YAAY,EAAE,MAAM;eACnBhB,MAAM,CAACiB,cAAc,oBAArBjB,MAAM,CAACiB,cAAc,EAAI;cACzB;aACDC,WAAW,EAAE,MAAM;eAClBlB,MAAM,CAACmB,cAAc,oBAArBnB,MAAM,CAACmB,cAAc,EAAI;;;;QAI5B,CAAC;OAEFf,IAAI,CAACgB,IAAI,CAACpB,MAAM,CAACqB,WAAW,CAAC;MAC7B,CAAC,CACDC,KAAK,CAAEC,KAAK,IAAKC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC,CAAC;;GAIzCE,WAAW,GACX;KACC,IAAI,yCAAC,IAAI,iCAAe,EACxB;OACC,4CAAI,oCAAkBC,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;OACnD,4CAAI,sBAAUpB,WAAW,EAAE,CAACqB,YAAY,yCAAC,IAAI,kCAAgB;;KAG9D,4CAAI,kCAAgBC,KAAK,EAAE;;GAG5BC,aAAa,GACb;KACCvE,iBAAO,CAAC0C,aAAa,CAAC,iCAAiC,CAAC,CACtDC,IAAI,CAAC,CAAC;OAAE6B;MAAoB,KAAK;OACjCA,kBAAkB,CAAC;SAClB1B,QAAQ,EAAE,WAAW;SACrBC,QAAQ,EAAE,4CAAI,sBAAUC,WAAW;QACnC,CAAC;MACF,CAAC,CACDe,KAAK,CAAEC,KAAK,IAAKC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC,CAAC;;GAIzCS,oBAAoB,CAACC,KAAc,EACnC;KACC,4CAAI,4CAAsBA,KAAK;;GAGhCC,mBAAmB,GACnB;KACC,+CAAO,IAAI;;GAGZC,2BAA2B,GAC3B;KACC,4CAAI,4CAAsB,KAAK;;GAGhCC,OAAO,GACP;KACC,4CAAI,sBAAUC,cAAc,CAAC,YAAY,CAAC;KAC1C,4CAAI,sBAAUA,cAAc,CAAC,iBAAiB,CAAC;KAC/C,4CAAI,sBAAUA,cAAc,CAAC,eAAe,CAAC;KAC7C,4CAAI,sBAAU9B,WAAW,EAAE,CAAC6B,OAAO,EAAE;KAErC,4CAAI;;GAGL,MAAME,IAAI,CAACC,GAAoB,EAC/B;KACC,IAAI,CAACtG,cAAI,CAACuG,aAAa,CAACD,GAAG,CAAC,EAC5B;OACC;;KAGD,MAAM,IAAI,CAACE,IAAI,CAACF,GAAG,CAAC;;GAGrB,MAAME,IAAI,CAACF,GAAa,EACxB;KACC,MAAMG,WAAW,GAAGH,GAAG,CAACI,MAAM,CAAElI,EAAE,IAAK,CAAC,4CAAI,0BAAYqE,GAAG,CAACrE,EAAE,CAAC,CAAC;KAChE,IAAIiI,WAAW,CAACE,MAAM,KAAK,CAAC,EAC5B;OACC,MAAMC,OAAO,CAACC,GAAG,yCAAC,IAAI,wBAAW;OAEjC,OAAO,IAAI,CAAC1D,YAAY,EAAE;;KAG3B,MAAM2D,OAAO,GAAG,IAAIC,UAAU,EAAE;KAChC,4CAAI,wBAAW7G,IAAI,CAAC4G,OAAO,CAAC;KAC5B,4CAAI,gCAAeL,WAAW;KAE9B,IACA;OACC,MAAMO,IAAI,GAAG,MAAMC,gCAAS,CAACC,IAAI,CAACC,uBAAQ,CAACC,eAAe,EAAE;SAC3Dd,GAAG,EAAEG;QACL,CAAC;OAEF,4CAAI,0CAAoBO,IAAI;OAE5BF,OAAO,CAACO,OAAO,EAAE;OAEjB,MAAMT,OAAO,CAACC,GAAG,yCAAC,IAAI,wBAAW;OAEjC,OAAO,IAAI,CAAC1D,YAAY,EAAE;MAC1B,CACD,OAAOmC,KAAK,EACZ;OACCC,OAAO,CAACD,KAAK,CAAC6B,uBAAQ,CAACC,eAAe,EAAE9B,KAAK,CAAC;OAE9C,OAAO,EAAE;;;GAIXgC,iBAAiB,CAACN,IAAe,EACjC;KACC,MAAMV,GAAG,GAAGU,IAAI,CAACO,GAAG,CAAEjJ,OAAgB,IAAKA,OAAO,CAACE,EAAE,CAAC;KAEtD,4CAAI,gCAAe8H,GAAG;KAEtB,4CAAI,0CAAoBU,IAAI;;GAG7BQ,kBAAkB,GAClB;KACC,OAAO,4CAAI,kCAAgBb,MAAM,GAAG,CAAC,IAAI,4CAAI,kCAAgBA,MAAM,GAAG,CAAC;;GAuOxEc,WAAW,CAACC,IAAY,EACxB;KACCC,+BAAQ,CAACC,wBAAwB,CAAC;OACjCpJ,EAAE,EAAG,sBAAqBqJ,cAAI,CAACC,SAAS,EAAG,EAAC;OAC5CJ;MACA,CAAC;;GAkBH,IAAIK,MAAM,GACV;KACC,OAAOpG,kBAAI,CAACqG,QAAQ,EAAE;;CAExB;CAAC,wBA1cA;GACC,IAAI,4CAAI,gCAAiB1H,WAAW,CAACG,IAAI,EACzC;KACCwH,eAAK,CAACC,IAAI,CAACC,MAAM,EAAE,cAAc,EAAE,IAAI,CAACjH,UAAU,CAAC;;CAErD;CAAC,0BAGD;GACC,IAAI,4CAAI,gCAAiBZ,WAAW,CAACG,IAAI,EACzC;KACCwH,eAAK,CAACG,MAAM,CAACD,MAAM,EAAE,cAAc,EAAE,IAAI,CAACjH,UAAU,CAAC;;CAEvD;CAAC,6BA8LkB8F,IAAe,EAClC;GACC,MAAMqB,KAAK,GAAGrB,IAAI,CAACO,GAAG,CAAEjJ,OAAgB,IAAKD,aAAa,CAACC,OAAO,CAAC,CAAC;GAEpE,MAAMgK,UAAU,GAAG,IAAIrH,GAAG,CAACV,MAAM,CAACgI,MAAM,yCAAC,IAAI,4BAAa,CAAC;GAC3D,MAAMC,QAAQ,GAAGH,KAAK,CAAC3B,MAAM,CAAC,CAAC;KAAEnH;IAAY,KAAK,CAAC+I,UAAU,CAACzF,GAAG,CAACtD,UAAU,CAACoD,QAAQ,CAAC,CAAC;GACvF,4CAAI,sBAAU2B,WAAW,EAAE,CAACmE,QAAQ,CAACD,QAAQ,CAAC;GAC9C,4CAAI,8CAAsBH,KAAK;CAChC;CAAC,wBAEa/B,GAAa,EAC3B;GACCA,GAAG,CAACoC,OAAO,CAAElK,EAAU,IAAW,4CAAI,0BAAYmK,GAAG,CAACnK,EAAE,CAAC,CAAC;CAC3D;CAAC,+BAEoB6J,KAAyB,EAC9C;GACCA,KAAK,CAACK,OAAO,CAAElG,IAAsB,IAAK;KACzC,4CAAI,4BAAaA,IAAI,CAACjE,YAAY,CAAC,GAAGiE,IAAI,CAACjD,UAAU,CAACoD,QAAQ;IAC9D,CAAC;CACH;CAAC,kCAEuB2D,GAAa,EACrC;GACCA,GAAG,CAACoC,OAAO,CAAElK,EAAU,IAAK;KAC3B,OAAO,4CAAI,4BAAaA,EAAE,CAAC;IAC3B,CAAC;CACH;CAAC,4BAEiBoK,cAAsB,EACxC;GACC,OAAOrI,MAAM,CAACsI,OAAO,yCAAC,IAAI,4BAAa,CACrCnC,MAAM,CAAC,CAAC,GAAG/D,QAAQ,CAAC,KAAcA,QAAQ,KAAKiG,cAAc,CAAC,CAC9DrB,GAAG,CAAC,CAAC,CAAC/I,EAAE,CAAC,KAAc,4CAAI,4BAAaA,EAAE,IAAIA,EAAE,GAAGsK,MAAM,CAACtK,EAAE,CAAE,CAAC;CAElE;CAAC,uBAEYkB,OAAiB,EAAEqJ,YAA8B,EAC9D;GACC,gDAAQ,IAAI;KAEX,KAAKzI,WAAW,CAACG,IAAI;OACrB;SACC,MAAMjC,EAAE,2CAAG,IAAI,uBAAU;SAEzB,KAAKwK,iDAAW,CAACC,eAAe,CAACzK,EAAE,EAAE;WAAEkB;UAAS,CAAC;SAEjD,4CAAI,IAAI,+CACR;WACC;;SAGD,IAAIwJ,4BAAO,CAACC,MAAM,CAAC3K,EAAE,CAAC,4CAAI,IAAI,4BAAauK,YAAY,CAACxK,YAAY,CAAC,EACrE;WACC,4CAAI,kCAAgB2B,IAAI,CAAC6I,YAAY,CAAC;WACtC,4CAAI;;SAGL;;KAGD,KAAKzI,WAAW,CAACI,aAAa;OAC9B;SACC,4CAAI,sDAA0BhB,OAAO;SAErC;;KAGD,KAAKY,WAAW,CAACK,MAAM;OACvB;SACC,KAAK,IAAI,CAACoH,MAAM,CAACqB,QAAQ,CAAE,GAAEC,oBAAK,CAACC,OAAQ,SAAQ,EAAE;WACpD9K,EAAE,0CAAE,IAAI,uBAAU;WAClB+K,MAAM,EAAE;aAAE7J;;UACV,CAAC;SAEF;;KAGD;OACC;;CAEH;CAAC,uBAEYA,OAAiB,EAAE8J,YAA8B,EAC9D;GACC,gDAAQ,IAAI;KAEX,KAAKlJ,WAAW,CAACG,IAAI;OACrB;SACC,MAAMjC,EAAE,2CAAG,IAAI,uBAAU;SAEzB,KAAKwK,iDAAW,CAACC,eAAe,CAACzK,EAAE,EAAE;WAAEkB;UAAS,CAAC;SAEjD,IAAIwJ,4BAAO,CAACC,MAAM,CAAC3K,EAAE,CAAC,EACtB;WACC,MAAMiL,UAAU,GAAGD,YAAY,CAACjL,YAAY;WAC5C,MAAMmL,aAAa,GAAG,4CAAI,kCAAgBC,SAAS,CAAEnH,IAAI,IAAKA,IAAI,CAACjE,YAAY,KAAKkL,UAAU,CAAC;WAC/F,IAAIC,aAAa,KAAK,CAAC,CAAC,EACxB;aACC,4CAAI,kCAAgBxJ,IAAI,CAACsJ,YAAY,CAAC;aACtC,4CAAI;YACJ,MAED;aACC,4CAAI,kCAAgBI,MAAM,CAACF,aAAa,EAAE,CAAC,CAAC;;;SAI9C;;KAGD,KAAKpJ,WAAW,CAACI,aAAa;OAC9B;SACC,4CAAI,sDAA0BhB,OAAO;SAErC;;KAGD,KAAKY,WAAW,CAACK,MAAM;OACvB;SACC,KAAK,IAAI,CAACoH,MAAM,CAACqB,QAAQ,CAAE,GAAEC,oBAAK,CAACC,OAAQ,SAAQ,EAAE;WACpD9K,EAAE,0CAAE,IAAI,uBAAU;WAClB+K,MAAM,EAAE;aAAE7J;;UACV,CAAC;SAEF;;KAGD;OACC;;CAEH;CAAC,4BAEiBmK,WAAwB,GAAG,IAAI5I,GAAG,EAAE,EACtD;GACC,IAAI,4CAAI,gCAAiBX,WAAW,CAACG,IAAI,IAAI,4CAAI,gCAAiBH,WAAW,CAACK,MAAM,EACpF;KACC,OAAO,4CAAI,kCAAgB+F,MAAM,CAAElI,EAAU,IAAK,CAACqL,WAAW,CAAChH,GAAG,CAACrE,EAAE,CAAC,CAAC;;GAGxE,IAAI,4CAAI,gCAAiB8B,WAAW,CAACI,aAAa,EAClD;KACC,OAAO,4CAAI,kCAAgBgG,MAAM,CAAEoD,MAAM,IAAK,CAACD,WAAW,CAAChH,GAAG,CAACiH,MAAM,CAACtL,EAAE,CAAC,CAAC;;GAG3E,OAAO,EAAE;CACV;CAAC,mCAEwBkB,OAAiB,EAC1C;GACC,MAAMqK,WAAW,GAAGtK,uBAAuB,CAACC,OAAO,CAAC;GAEpD,KAAK,IAAI,CAACqI,MAAM,CAACqB,QAAQ,CAAE,GAAEC,oBAAK,CAACW,SAAU,SAAQ,EAAE;KACtDxL,EAAE,0CAAE,IAAI,uBAAU;KAClB+K,MAAM,EAAE;OAAEQ;;IACV,CAAC;CACH;CAAC,sBAEWvL,EAAmB,EAC/B;GACC,OAAOyL,MAAM,CAACzL,EAAE,CAAC,CAAC6B,UAAU,CAAC,GAAG,CAAC;CAClC;CAAC,qCAGD;GACC,IAAIL,cAAI,CAACuG,aAAa,yCAAC,IAAI,kCAAgB,EAC3C;KACC,MAAM/H,EAAE,GAAG0K,4BAAO,CAACgB,KAAK,yCAAC,IAAI,wBAAW;KAExC,IACA;OACC,MAAM5D,GAAG,GAAG,4CAAI,kCAAgBiB,GAAG,CAAE/E,IAAI,IAAKA,IAAI,CAACjE,YAAY,CAAC;OAChE,4CAAI,oCAAkB,EAAE;OAExB,IAAI2K,4BAAO,CAACiB,UAAU,yCAAC,IAAI,wBAAW,EACtC;SACC,MAAMlD,gCAAS,CAACC,IAAI,CAACC,uBAAQ,CAACiD,cAAc,EAAE;WAAEC,QAAQ,EAAE;aAAE7L,EAAE;aAAEkB,OAAO,0CAAE,IAAI;;UAAmB,CAAC;QACjG,MAED;SACC,MAAMuH,gCAAS,CAACC,IAAI,CAACC,uBAAQ,CAACmD,UAAU,EAAE;WAAEC,IAAI,EAAE;aAAE/L;YAAI;WAAE8H;UAAK,CAAC;;MAEjE,CACD,OAAOhB,KAAK,EACZ;OACCC,OAAO,CAACD,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;OAE5D,IAAI,CAACmC,WAAW,CAAC+C,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,CAAC;;;CAGxE;CAAC,qCAGD;GACC,IAAIzK,cAAI,CAACuG,aAAa,yCAAC,IAAI,kCAAgB,EAC3C;KACC,MAAM/H,EAAE,GAAG0K,4BAAO,CAACgB,KAAK,yCAAC,IAAI,wBAAW;KACxC,MAAMQ,iBAAiB,2CAAG,IAAI,iCAAe;KAE7C,IACA;OACC,MAAMpE,GAAG,GAAG,4CAAI,kCAAgBiB,GAAG,CAAE/E,IAAI,IAAKA,IAAI,CAACjE,YAAY,CAAC;OAChE,4CAAI,oCAAkB,EAAE;OAExB,IAAI2K,4BAAO,CAACiB,UAAU,yCAAC,IAAI,wBAAW,EACtC;SACC,MAAMlD,gCAAS,CAACC,IAAI,CAACC,uBAAQ,CAACiD,cAAc,EAAE;WAAEC,QAAQ,EAAE;aAAE7L,EAAE;aAAEkB,OAAO,0CAAE,IAAI;;UAAmB,CAAC;QACjG,MAED;SACC,MAAMuH,gCAAS,CAACC,IAAI,CAACC,uBAAQ,CAACwD,UAAU,EAAE;WAAEJ,IAAI,EAAE;aAAE/L;YAAI;WAAE8H;UAAK,CAAC;;MAEjE,CACD,OAAOhB,KAAK,EACZ;OACCC,OAAO,CAACD,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;OAE5D,4CAAI,gDAAwB,IAAI;OAEhC,4CAAI,sBAAUhB,WAAW,EAAE,CAACmE,QAAQ,CAACiC,iBAAiB,CAAC;OAEvD,4CAAI,gDAAwB,KAAK;OAEjC,IAAI,CAACjD,WAAW,CAAC+C,aAAG,CAACC,UAAU,CAAC,mCAAmC,CAAC,CAAC;;;CAGxE;CAAC,8BAWD;GACC,IAAI,4CAAI,gCAAiBnK,WAAW,CAACG,IAAI,EACzC;KACC,OAAOuI,iDAAW,CAAC4B,YAAY,yCAAC,IAAI,wBAAW,CAAClL,OAAO;;GAGxD,IAAI,4CAAI,gCAAiBY,WAAW,CAACK,MAAM,EAC3C;KACC,OAAO,IAAI,CAACoH,MAAM,CAAC8C,OAAO,CAAE,GAAExB,oBAAK,CAACC,OAAQ,UAAS,CAAC,yCAAC,IAAI,wBAAW,CAAC5J,OAAO;;GAG/E,OAAO,IAAI,CAACqI,MAAM,CAAC8C,OAAO,CAAE,GAAExB,oBAAK,CAACW,SAAU,UAAS,CAAC,yCAAC,IAAI,wBAAW,CAACD,WAAW;CACrF;CAQD,MAAMe,QAAwC,GAAG,EAAE;CAEnD,MAAMrJ,MAAM,GAAG,CAACV,QAAgB,EAAEC,UAAsB,KAAc,GAAEA,UAAW,IAAGD,QAAS,EAAC;AAEhG,OAAagK,WAAW,GAAG;GAC1BC,GAAG,CAACjK,QAAgB,EAAEC,UAAsB,GAAGV,WAAW,CAACG,IAAI,EAC/D;KAAA;KACC,MAAMwK,GAAG,GAAGxJ,MAAM,CAACV,QAAQ,EAAEC,UAAU,CAAC;KACxC,iBAAA8J,QAAQ,CAACG,GAAG,CAAC,4BAAbH,QAAQ,CAACG,GAAG,CAAC,GAAK,IAAIrK,WAAW,CAACG,QAAQ,EAAEC,UAAU,CAAC;KAEvD,OAAO8J,QAAQ,CAACG,GAAG,CAAC;IACpB;GACDC,OAAO,CAACC,MAAc,EAAEpK,QAAgB,EAAEC,UAAsB,GAAGV,WAAW,CAACG,IAAI,EACnF;KACC,MAAM2K,MAAM,GAAG3J,MAAM,CAAC0J,MAAM,EAAEnK,UAAU,CAAC;KACzC,MAAMqK,MAAM,GAAG5J,MAAM,CAACV,QAAQ,EAAEC,UAAU,CAAC;KAE3C8J,QAAQ,CAACO,MAAM,CAAC,GAAGP,QAAQ,CAACM,MAAM,CAAC;KACnCN,QAAQ,CAACO,MAAM,CAAC,CAACjK,WAAW,CAACL,QAAQ,EAAEC,UAAU,CAAC;KAElD,OAAO8J,QAAQ,CAACM,MAAM,CAAC;IACvB;GACDE,MAAM,CAACvK,QAAgB,EAAEC,UAAsB,GAAGV,WAAW,CAACG,IAAI,EAClE;KAAA;KACC,MAAMwK,GAAG,GAAGxJ,MAAM,CAACV,QAAQ,EAAEC,UAAU,CAAC;KAExC,kBAAA8J,QAAQ,CAACG,GAAG,CAAC,qBAAb,eAAe9E,OAAO,EAAE;KAExB,OAAO2E,QAAQ,CAACG,GAAG,CAAC;;CAEtB,CAAC;CAED,SAASlE,UAAU,GACnB;GACC,MAAMD,OAAO,GAAG,IAAIF,OAAO,CAAES,OAAO,IAAK;KACxC,IAAI,CAACA,OAAO,GAAGA,OAAO;IACtB,CAAC;GAEFP,OAAO,CAACO,OAAO,GAAG,IAAI,CAACA,OAAO;GAE9B,OAAOP,OAAO;CACf;;;;;;;;;"}