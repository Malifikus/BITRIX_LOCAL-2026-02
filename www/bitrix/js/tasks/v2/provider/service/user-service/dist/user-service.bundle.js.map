{"version":3,"file":"user-service.bundle.js","sources":["../src/mappers.js","../src/user-service.js","../src/index.js"],"sourcesContent":["import type { UserModel } from 'tasks.v2.model.users';\nimport type { UserDto } from './types';\n\nexport function mapDtoToModel(userDto: UserDto): UserModel\n{\n\treturn {\n\t\tid: userDto.id,\n\t\tname: userDto.name,\n\t\timage: userDto.image?.src,\n\t\ttype: userDto.type,\n\t};\n}\n\nexport function mapModelToDto(user: UserModel): UserDto\n{\n\treturn {\n\t\tid: user.id,\n\t\tname: user.name,\n\t\timage: { src: user.image },\n\t\ttype: user.type,\n\t};\n}\n","import { Extension } from 'main.core';\n\nimport type { Store } from 'ui.vue3.vuex';\n\nimport { Endpoint, Model } from 'tasks.v2.const';\nimport { Core } from 'tasks.v2.core';\nimport { apiClient } from 'tasks.v2.lib.api-client';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nimport { mapDtoToModel } from './mappers';\nimport type { UserDto } from './types';\n\nclass UserService\n{\n\tgetUrl(id: number): string\n\t{\n\t\tconst settings = Extension.getSettings('tasks.v2.application.task-card');\n\t\tconst urlTemplate = settings.userDetailUrlTemplate;\n\n\t\tif (!urlTemplate)\n\t\t{\n\t\t\treturn `/company/personal/user/${id}/`;\n\t\t}\n\n\t\treturn urlTemplate.replace('#USER_ID#', String(id));\n\t}\n\n\tasync list(ids: number[]): Promise<void>\n\t{\n\t\tconst unloadedIds = this.#getUnloadedIds(ids);\n\t\tif (unloadedIds.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst data = await apiClient.post(Endpoint.UserList, { ids: unloadedIds });\n\n\t\t\tconst users = data.map((user: UserDto) => mapDtoToModel(user));\n\n\t\t\tawait this.$store.dispatch(`${Model.Users}/upsertMany`, users);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('UserService: list error', error);\n\t\t}\n\t}\n\n\thasUsers(ids: number[]): boolean\n\t{\n\t\treturn this.#getUnloadedIds(ids).length === 0;\n\t}\n\n\t#getUnloadedIds(ids: number[]): number[]\n\t{\n\t\tconst loadedUsers: UserModel[] = this.$store.getters[`${Model.Users}/getByIds`](ids);\n\t\tconst loadedIds = new Set(loadedUsers.map(({ id }) => id));\n\n\t\treturn ids.filter((id: number) => !loadedIds.has(id));\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n\nexport const userService = new UserService();\n","import { mapDtoToModel, mapModelToDto } from './mappers';\n\nexport { userService } from './user-service';\nexport type { UserDto } from './types';\n\nexport const UserMappers = {\n\tmapDtoToModel,\n\tmapModelToDto,\n};\n"],"names":["mapDtoToModel","userDto","id","name","image","src","type","mapModelToDto","user","UserService","getUrl","settings","Extension","getSettings","urlTemplate","userDetailUrlTemplate","replace","String","list","ids","unloadedIds","length","data","apiClient","post","Endpoint","UserList","users","map","$store","dispatch","Model","Users","error","console","hasUsers","Core","getStore","loadedUsers","getters","loadedIds","Set","filter","has","userService","UserMappers"],"mappings":";;;;;;;;CAGO,SAASA,aAAa,CAACC,OAAgB,EAC9C;GAAA;GACC,OAAO;KACNC,EAAE,EAAED,OAAO,CAACC,EAAE;KACdC,IAAI,EAAEF,OAAO,CAACE,IAAI;KAClBC,KAAK,oBAAEH,OAAO,CAACG,KAAK,qBAAb,eAAeC,GAAG;KACzBC,IAAI,EAAEL,OAAO,CAACK;IACd;CACF;AAEA,CAAO,SAASC,aAAa,CAACC,IAAe,EAC7C;GACC,OAAO;KACNN,EAAE,EAAEM,IAAI,CAACN,EAAE;KACXC,IAAI,EAAEK,IAAI,CAACL,IAAI;KACfC,KAAK,EAAE;OAAEC,GAAG,EAAEG,IAAI,CAACJ;MAAO;KAC1BE,IAAI,EAAEE,IAAI,CAACF;IACX;CACF;;CCZ0C;CAG1C,MAAMG,WAAW,CACjB;GAAA;KAAA;OAAA;;;GACCC,MAAM,CAACR,EAAU,EACjB;KACC,MAAMS,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,gCAAgC,CAAC;KACxE,MAAMC,WAAW,GAAGH,QAAQ,CAACI,qBAAqB;KAElD,IAAI,CAACD,WAAW,EAChB;OACC,OAAQ,0BAAyBZ,EAAG,GAAE;;KAGvC,OAAOY,WAAW,CAACE,OAAO,CAAC,WAAW,EAAEC,MAAM,CAACf,EAAE,CAAC,CAAC;;GAGpD,MAAMgB,IAAI,CAACC,GAAa,EACxB;KACC,MAAMC,WAAW,2CAAG,IAAI,oCAAiBD,GAAG,CAAC;KAC7C,IAAIC,WAAW,CAACC,MAAM,KAAK,CAAC,EAC5B;OACC;;KAGD,IACA;OACC,MAAMC,IAAI,GAAG,MAAMC,gCAAS,CAACC,IAAI,CAACC,uBAAQ,CAACC,QAAQ,EAAE;SAAEP,GAAG,EAAEC;QAAa,CAAC;OAE1E,MAAMO,KAAK,GAAGL,IAAI,CAACM,GAAG,CAAEpB,IAAa,IAAKR,aAAa,CAACQ,IAAI,CAAC,CAAC;OAE9D,MAAM,IAAI,CAACqB,MAAM,CAACC,QAAQ,CAAE,GAAEC,oBAAK,CAACC,KAAM,aAAY,EAAEL,KAAK,CAAC;MAC9D,CACD,OAAOM,KAAK,EACZ;OACCC,OAAO,CAACD,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;;;GAIjDE,QAAQ,CAAChB,GAAa,EACtB;KACC,OAAO,4CAAI,oCAAiBA,GAAG,EAAEE,MAAM,KAAK,CAAC;;GAW9C,IAAIQ,MAAM,GACV;KACC,OAAOO,kBAAI,CAACC,QAAQ,EAAE;;CAExB;CAAC,0BAZgBlB,GAAa,EAC7B;GACC,MAAMmB,WAAwB,GAAG,IAAI,CAACT,MAAM,CAACU,OAAO,CAAE,GAAER,oBAAK,CAACC,KAAM,WAAU,CAAC,CAACb,GAAG,CAAC;GACpF,MAAMqB,SAAS,GAAG,IAAIC,GAAG,CAACH,WAAW,CAACV,GAAG,CAAC,CAAC;KAAE1B;IAAI,KAAKA,EAAE,CAAC,CAAC;GAE1D,OAAOiB,GAAG,CAACuB,MAAM,CAAExC,EAAU,IAAK,CAACsC,SAAS,CAACG,GAAG,CAACzC,EAAE,CAAC,CAAC;CACtD;AAQD,OAAa0C,WAAW,GAAG,IAAInC,WAAW,EAAE;;OC/D/BoC,WAAW,GAAG;GAC1B7C,aAAa;GACbO;CACD,CAAC;;;;;;;;;"}