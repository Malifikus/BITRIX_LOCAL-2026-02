{"version":3,"file":"mark-task-button.bundle.js","sources":["../src/mark-task-button.js"],"sourcesContent":["import { MenuItemDesign } from 'ui.system.menu';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { BMenu, type MenuOptions, type MenuItemOptions, type MenuSectionOptions } from 'ui.system.menu.vue';\n\nimport { Core } from 'tasks.v2.core';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { Mark } from 'tasks.v2.const';\nimport { HoverPill } from 'tasks.v2.component.elements.hover-pill';\nimport { showLimit } from 'tasks.v2.lib.show-limit';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport './mark-task-button.css';\n\nconst sectionMark = 'sectionMark';\n\n// @vue/component\nexport const MarkTaskButton = {\n\tname: 'MarkTaskButton',\n\tcomponents: {\n\t\tBMenu,\n\t\tBIcon,\n\t\tHoverPill,\n\t},\n\tinject: {\n\t\ttask: {},\n\t},\n\tsetup(): { task: TaskModel } {},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisMenuShown: false,\n\t\t\tactiveMenuItemId: this.task.mark,\n\t\t};\n\t},\n\tcomputed: {\n\t\tisAllowed(): boolean\n\t\t{\n\t\t\treturn this.task.rights.mark;\n\t\t},\n\t\tmenuOptions(): Function\n\t\t{\n\t\t\treturn (): MenuOptions => ({\n\t\t\t\tid: 'tasks-full-card-mark-task-menu',\n\t\t\t\tbindElement: this.$refs.container,\n\t\t\t\tsections: this.menuSections,\n\t\t\t\titems: this.menuItems,\n\t\t\t});\n\t\t},\n\t\tmenuSections(): MenuSectionOptions[]\n\t\t{\n\t\t\treturn [{\n\t\t\t\tcode: sectionMark,\n\t\t\t\ttitle: this.loc('TASKS_V2_MARK_TASK_MARK_SECTION_TITLE'),\n\t\t\t}];\n\t\t},\n\t\tmenuItems(): MenuItemOptions[]\n\t\t{\n\t\t\treturn [\n\t\t\t\tthis.getNoMarkItem(),\n\t\t\t\tthis.getPositiveMarkItem(),\n\t\t\t\tthis.getNegativeMarkItem(),\n\t\t\t];\n\t\t},\n\t\tformattedText(): string\n\t\t{\n\t\t\tif (this.activeMenuItemId === Mark.None || this.isLocked)\n\t\t\t{\n\t\t\t\treturn this.loc('TASKS_V2_MARK_TASK_BUTTON_NONE');\n\t\t\t}\n\n\t\t\treturn this.loc('TASKS_V2_MARK_TASK_BUTTON_SET');\n\t\t},\n\t\tformattedIcon(): ?string\n\t\t{\n\t\t\tif (this.isLocked)\n\t\t\t{\n\t\t\t\treturn Outline.LOCK_M;\n\t\t\t}\n\n\t\t\tif (this.activeMenuItemId === Mark.Positive)\n\t\t\t{\n\t\t\t\treturn Outline.LIKE;\n\t\t\t}\n\n\t\t\tif (this.activeMenuItemId === Mark.Negative)\n\t\t\t{\n\t\t\t\treturn Outline.DISLIKE;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\tisLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.mark.available;\n\t\t},\n\t},\n\twatch: {\n\t\t'task.mark': {\n\t\t\thandler: 'updateMark',\n\t\t},\n\t},\n\tmethods: {\n\t\tgetNoMarkItem(): MenuItemOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: Mark.None,\n\t\t\t\ttitle: this.loc('TASKS_V2_MARK_TASK_MARK_NONE'),\n\t\t\t\ticon: Outline.TEXT_FORMAT_CANCEL,\n\t\t\t\t...this.getMenuItemOptions(Mark.None),\n\t\t\t};\n\t\t},\n\t\tgetPositiveMarkItem(): MenuItemOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: Mark.Positive,\n\t\t\t\ttitle: this.loc('TASKS_V2_MARK_TASK_MARK_POSITIVE'),\n\t\t\t\ticon: Outline.LIKE,\n\t\t\t\t...this.getMenuItemOptions(Mark.Positive),\n\t\t\t};\n\t\t},\n\t\tgetNegativeMarkItem(): MenuItemOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: Mark.Negative,\n\t\t\t\ttitle: this.loc('TASKS_V2_MARK_TASK_MARK_NEGATIVE'),\n\t\t\t\ticon: Outline.DISLIKE,\n\t\t\t\t...this.getMenuItemOptions(Mark.Negative),\n\t\t\t};\n\t\t},\n\t\tisSelected(menuItemId: string): boolean\n\t\t{\n\t\t\treturn menuItemId === this.activeMenuItemId;\n\t\t},\n\t\tgetMenuItemOptions(menuItemId: string): MenuItemOptions\n\t\t{\n\t\t\tconst commonOptions = {\n\t\t\t\tonClick: async (): Promise<void> => {\n\t\t\t\t\tif (this.activeMenuItemId === menuItemId)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.activeMenuItemId = menuItemId;\n\t\t\t\t\tvoid taskService.setMark(this.task.id, menuItemId);\n\t\t\t\t},\n\t\t\t\tsectionCode: sectionMark,\n\t\t\t};\n\n\t\t\tif (menuItemId === this.activeMenuItemId)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\t...commonOptions,\n\t\t\t\t\tisSelected: true,\n\t\t\t\t\tdesign: MenuItemDesign.Accent1,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...commonOptions,\n\t\t\t\tisSelected: false,\n\t\t\t\tdesign: MenuItemDesign.Default,\n\t\t\t};\n\t\t},\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isLocked)\n\t\t\t{\n\t\t\t\tvoid showLimit({\n\t\t\t\t\tfeatureId: Core.getParams().restrictions.mark.featureId,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.isAllowed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isMenuShown = true;\n\t\t},\n\t\tupdateMark(): void\n\t\t{\n\t\t\tthis.activeMenuItemId = this.task.mark;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-full-card-mark-task-button-container\"\n\t\t\tref=\"container\"\n\t\t>\n\t\t\t<HoverPill\n\t\t\t\t:readonly=\"!isAllowed\"\n\t\t\t\t@click=\"handleClick\"\n\t\t\t>\n\t\t\t\t<div class=\"tasks-full-card-mark-task-mark-container\">\n\t\t\t\t\t<div class=\"tasks-full-card-mark-task-mark-text\">{{ formattedText }}</div>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tv-if=\"formattedIcon\"\n\t\t\t\t\t\tclass=\"tasks-full-card-mark-task-mark-icon\"\n\t\t\t\t\t\t:name=\"formattedIcon\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</HoverPill>\n\t\t</div>\n\t\t<BMenu\n\t\t\tv-if=\"isMenuShown\"\n\t\t\t@close=\"isMenuShown = false\"\n\t\t\t:options=\"menuOptions()\"\n\t\t/>\n\t`,\n};\n"],"names":["sectionMark","MarkTaskButton","name","components","BMenu","BIcon","HoverPill","inject","task","setup","data","isMenuShown","activeMenuItemId","mark","computed","isAllowed","rights","menuOptions","id","bindElement","$refs","container","sections","menuSections","items","menuItems","code","title","loc","getNoMarkItem","getPositiveMarkItem","getNegativeMarkItem","formattedText","Mark","None","isLocked","formattedIcon","Outline","LOCK_M","Positive","LIKE","Negative","DISLIKE","Core","getParams","restrictions","available","watch","handler","methods","icon","TEXT_FORMAT_CANCEL","getMenuItemOptions","isSelected","menuItemId","commonOptions","onClick","taskService","setMark","sectionCode","design","MenuItemDesign","Accent1","Default","handleClick","showLimit","featureId","updateMark","template"],"mappings":"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"}