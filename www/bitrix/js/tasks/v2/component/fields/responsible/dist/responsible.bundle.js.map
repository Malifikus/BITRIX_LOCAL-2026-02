{"version":3,"file":"responsible.bundle.js","sources":["../src/responsible-meta.js","../src/for-new-user-switcher/for-new-user-switcher.js","../src/new-user-label/new-user-label.js","../src/responsible.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\n\nexport const responsibleMeta = Object.freeze({\n\tid: TaskField.Responsible,\n\tgetTitle: (isMany: boolean): string => {\n\t\tif (isMany)\n\t\t{\n\t\t\treturn Loc.getMessage('TASKS_V2_RESPONSIBLE_TITLE_MANY');\n\t\t}\n\n\t\treturn Loc.getMessage('TASKS_V2_RESPONSIBLE_TITLE');\n\t},\n});\n","import { TextSm } from 'ui.system.typography.vue';\nimport { SwitcherSize, type SwitcherOptions } from 'ui.switcher';\nimport { Switcher } from 'ui.vue3.components.switcher';\n\nimport { QuestionMark } from 'tasks.v2.component.elements.question-mark';\n\nimport './for-new-user-switcher.css';\n\n// @vue/component\nexport const ForNewUserSwitcher = {\n\tname: 'ForNewUserSwitcher',\n\tcomponents: {\n\t\tSwitcher,\n\t\tTextSm,\n\t\tQuestionMark,\n\t},\n\tprops: {\n\t\tmodelValue: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:modelValue'],\n\tcomputed: {\n\t\tswitcherOptions(): SwitcherOptions\n\t\t{\n\t\t\treturn Object.freeze({\n\t\t\t\tsize: SwitcherSize.extraSmall,\n\t\t\t\tuseAirDesign: true,\n\t\t\t});\n\t\t},\n\t\thint(): string\n\t\t{\n\t\t\treturn this.loc('TASKS_V2_RESPONSIBLE_FOR_NEW_USER_HINT');\n\t\t},\n\t},\n\tmethods: {\n\t\ttoggleChecked(checked: boolean)\n\t\t{\n\t\t\tthis.$emit('update:modelValue', checked);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-field-responsible-for-new-user-switcher\" @click=\"toggleChecked(!this.modelValue)\">\n\t\t\t<Switcher :isChecked=\"modelValue\" :options=\"switcherOptions\"/>\n\t\t\t<TextSm className=\"tasks-field-responsible-for-new-user-switcher-label\">\n\t\t\t\t{{ loc('TASKS_V2_RESPONSIBLE_FOR_NEW_USER') }}\n\t\t\t</TextSm>\n\t\t\t<QuestionMark v-if=\"hint\" :hintText=\"hint\" :hintMaxWidth=\"320\" @click.stop/>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { h, type BitrixVueComponentProps } from 'ui.vue3';\nimport { UserAvatarListUsers } from 'tasks.v2.component.elements.user-avatar-list';\n\nexport const NewUserLabel: BitrixVueComponentProps = h(UserAvatarListUsers, {\n\tusers: [{\n\t\tname: Loc.getMessage('TASKS_V2_RESPONSIBLE_NEW_USER'),\n\t\ttype: 'employee',\n\t}],\n\treadonly: true,\n});\n","import { Type } from 'main.core';\n\nimport { TextXs } from 'ui.system.typography.vue';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { Option } from 'tasks.v2.const';\nimport { Participants } from 'tasks.v2.component.elements.participants';\nimport { Hint } from 'tasks.v2.component.elements.hint';\nimport { ahaMoments } from 'tasks.v2.lib.aha-moments';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { idUtils } from 'tasks.v2.lib.id-utils';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { responsibleMeta } from './responsible-meta';\nimport { ForNewUserSwitcher } from './for-new-user-switcher/for-new-user-switcher';\nimport { NewUserLabel } from './new-user-label/new-user-label';\nimport './responsible.css';\n\n// @vue/component\nexport const Responsible = {\n\tname: 'TaskResponsible',\n\tcomponents: {\n\t\tParticipants,\n\t\tBIcon,\n\t\tForNewUserSwitcher,\n\t\tNewUserLabel,\n\t\tHint,\n\t\tTextXs,\n\t},\n\tinject: {\n\t\tanalytics: {},\n\t\tcardType: {},\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tisSingle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tavatarOnly: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(): { Outline: typeof Outline }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tresponsibleMeta,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisManyAhaShown: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tforNewUser: {\n\t\t\tget(): boolean\n\t\t\t{\n\t\t\t\treturn this.task.isForNewUser;\n\t\t\t},\n\t\t\tset(isForNewUser: boolean)\n\t\t\t{\n\t\t\t\tvoid taskService.update(this.taskId, { isForNewUser });\n\t\t\t},\n\t\t},\n\t\tcurrentUserId(): number\n\t\t{\n\t\t\treturn Core.getParams().currentUser.id;\n\t\t},\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn taskService.getStoreTask(this.taskId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn idUtils.isReal(this.taskId);\n\t\t},\n\t\tisTemplate(): boolean\n\t\t{\n\t\t\treturn idUtils.isTemplate(this.taskId);\n\t\t},\n\t\tisFlowFilledOnAdd(): boolean\n\t\t{\n\t\t\treturn this.task.flowId > 0 && !this.isEdit;\n\t\t},\n\t\tsingle(): boolean\n\t\t{\n\t\t\treturn this.isSingle || (!this.isTemplate && this.isEdit);\n\t\t},\n\t\tdataset(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'data-task-id': this.taskId,\n\t\t\t\t'data-task-field-id': responsibleMeta.id,\n\t\t\t\t'data-task-field-value': this.task.responsibleIds[0],\n\t\t\t};\n\t\t},\n\t\tisAdmin(): boolean\n\t\t{\n\t\t\treturn Core.getParams().rights.user.admin;\n\t\t},\n\t},\n\tmethods: {\n\t\tupdateTask(responsibleIds: number[]): void\n\t\t{\n\t\t\tif (responsibleIds.length === 0)\n\t\t\t{\n\t\t\t\tresponsibleIds.push(this.task.responsibleIds[0]);\n\t\t\t}\n\n\t\t\tconst currentIds = new Set(this.task.responsibleIds);\n\n\t\t\tvoid taskService.update(this.taskId, { responsibleIds });\n\n\t\t\tif (responsibleIds.some((id) => !currentIds.has(id)))\n\t\t\t{\n\t\t\t\tanalytics.sendAssigneeChange(this.analytics, {\n\t\t\t\t\tcardType: this.cardType,\n\t\t\t\t\ttaskId: Type.isNumber(this.taskId) ? this.taskId : 0,\n\t\t\t\t\tviewersCount: this.task.auditorsIds?.length ?? 0,\n\t\t\t\t\tcoexecutorsCount: this.task.accomplicesIds?.length ?? 0,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (responsibleIds.length > 1)\n\t\t\t{\n\t\t\t\tthis.showManyAha();\n\t\t\t}\n\t\t},\n\t\thandleHintClick(): void\n\t\t{\n\t\t\tvoid taskService.update(this.taskId, { creatorId: this.currentUserId });\n\t\t},\n\t\tshowManyAha(): void\n\t\t{\n\t\t\tif (ahaMoments.shouldShow(Option.AhaResponsibleMany))\n\t\t\t{\n\t\t\t\tahaMoments.setActive(Option.AhaResponsibleMany);\n\t\t\t\tthis.isManyAhaShown = true;\n\t\t\t\tahaMoments.setPopupShown(Option.AhaResponsibleMany);\n\t\t\t\tvoid fieldHighlighter.highlight(responsibleMeta.id);\n\t\t\t}\n\t\t},\n\t\tstopManyAha(): void\n\t\t{\n\t\t\tahaMoments.setShown(Option.AhaResponsibleMany);\n\t\t\tthis.closeManyAha();\n\t\t},\n\t\tcloseManyAha(): void\n\t\t{\n\t\t\tthis.isManyAhaShown = false;\n\t\t\tahaMoments.setInactive(Option.AhaResponsibleMany);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div ref=\"container\">\n\t\t\t<div v-if=\"isFlowFilledOnAdd\" class=\"tasks-field-responsible-auto\">\n\t\t\t\t<BIcon :name=\"Outline.BOTTLENECK\"/>\n\t\t\t\t<div v-if=\"!avatarOnly\">{{ loc('TASKS_V2_RESPONSIBLE_AUTO') }}</div>\n\t\t\t</div>\n\t\t\t<NewUserLabel v-else-if=\"forNewUser\"/>\n\t\t\t<Participants\n\t\t\t\tv-else\n\t\t\t\t:taskId\n\t\t\t\t:context=\"responsibleMeta.id\"\n\t\t\t\t:userIds=\"task.responsibleIds\"\n\t\t\t\t:canAdd=\"task.rights.delegate || task.rights.changeResponsible\"\n\t\t\t\t:canRemove=\"task.rights.delegate || task.rights.changeResponsible\"\n\t\t\t\t:withHint=\"!isAdmin && !isEdit && task.creatorId !== currentUserId\"\n\t\t\t\t:hintText=\"loc('TASKS_V2_RESPONSIBLE_CANT_CHANGE')\"\n\t\t\t\t:single\n\t\t\t\t:multipleOnPlus=\"!single && task.responsibleIds.length === 1\"\n\t\t\t\t:inline=\"avatarOnly || single\"\n\t\t\t\t:avatarOnly\n\t\t\t\t:dataset\n\t\t\t\t:showMenu=\"false\"\n\t\t\t\t@hintClick=\"handleHintClick\"\n\t\t\t\t@update=\"updateTask\"\n\t\t\t/>\n\t\t\t<ForNewUserSwitcher v-if=\"!isEdit && isTemplate && !avatarOnly\" v-model=\"forNewUser\"/>\n\t\t</div>\n\t\t<Hint v-if=\"isManyAhaShown\" :bindElement=\"$refs.container\" @close=\"isManyAhaShown = false\">\n\t\t\t<div class=\"tasks-field-responsible-many-aha\">\n\t\t\t\t<div>{{ loc('TASKS_V2_RESPONSIBLE_MANY_AHA') }}</div>\n\t\t\t\t<TextXs @click=\"stopManyAha\">{{ loc('TASKS_V2_RESPONSIBLE_MANY_AHA_STOP') }}</TextXs>\n\t\t\t</div>\n\t\t</Hint>\n\t`,\n};\n"],"names":["responsibleMeta","Object","freeze","id","TaskField","Responsible","getTitle","isMany","Loc","getMessage","ForNewUserSwitcher","name","components","Switcher","TextSm","QuestionMark","props","modelValue","type","Boolean","required","emits","computed","switcherOptions","size","SwitcherSize","extraSmall","useAirDesign","hint","loc","methods","toggleChecked","checked","$emit","template","NewUserLabel","h","UserAvatarListUsers","users","readonly","Participants","BIcon","Hint","TextXs","inject","analytics","cardType","taskId","Number","String","isSingle","default","avatarOnly","setup","Outline","data","isManyAhaShown","forNewUser","get","task","isForNewUser","set","taskService","update","currentUserId","Core","getParams","currentUser","getStoreTask","isEdit","idUtils","isReal","isTemplate","isFlowFilledOnAdd","flowId","single","dataset","responsibleIds","isAdmin","rights","user","admin","updateTask","length","push","currentIds","Set","some","has","sendAssigneeChange","Type","isNumber","viewersCount","auditorsIds","coexecutorsCount","accomplicesIds","showManyAha","handleHintClick","creatorId","ahaMoments","shouldShow","Option","AhaResponsibleMany","setActive","setPopupShown","fieldHighlighter","highlight","stopManyAha","setShown","closeManyAha","setInactive"],"mappings":"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"}