this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,a,l,n,o,r,d,c,h,g,u,p){"use strict";const k=Object.freeze({id:o.TaskField.Tags,title:i.Loc.getMessage("TASKS_V2_TAGS_TITLE")});var v,b,m,I,T;const f={};const B=new(v=babelHelpers.classPrivateFieldLooseKey("onClose"),b=babelHelpers.classPrivateFieldLooseKey("getDialog"),m=babelHelpers.classPrivateFieldLooseKey("fillDialog"),I=babelHelpers.classPrivateFieldLooseKey("getTagItem"),T=babelHelpers.classPrivateFieldLooseKey("getEntityId"),class{constructor(){Object.defineProperty(this,T,{value:F});Object.defineProperty(this,I,{value:y});Object.defineProperty(this,m,{value:C});Object.defineProperty(this,b,{value:S});Object.defineProperty(this,v,{writable:true,value:void 0});a.EventEmitter.subscribe(o.EventName.TagDeleted,(t=>{const{tagName:e,groupId:s}=t.getData();Object.entries(f).forEach((([t,i])=>{if(Number(t.split("-")[1])===s){const t=i.getItems().find((t=>t.getTitle()===e)).getId();i.removeItem([o.EntitySelectorEntity.Tag,t])}}))}))}show(t){babelHelpers.classPrivateFieldLooseBase(this,v)[v]=t.onClose;babelHelpers.classPrivateFieldLooseBase(this,m)[m](t.taskId);babelHelpers.classPrivateFieldLooseBase(this,b)[b](t.taskId).showTo(t.targetNode)}});function S(t){var e,s;const i=n.Core.getParams().currentUser.id;const a=(e=c.taskService.getStoreTask(t).groupId)!=null?e:0;const d=`${t}-${a}`;const h=babelHelpers.classPrivateFieldLooseBase(this,T)[T](t);(s=f[d])!=null?s:f[d]=new r.EntitySelectorDialog({enableSearch:true,dropdownMode:true,entities:[{id:h,options:{taskId:t,groupId:a}}],searchOptions:{allowCreateItem:true},footer:h===o.EntitySelectorEntity.Tag?l.Footer:false,footerOptions:{userId:i,groupId:a},clearUnavailableItems:true,events:{onLoad:()=>babelHelpers.classPrivateFieldLooseBase(this,m)[m](t),"Search:onItemCreateAsync":e=>{const s=e.getData().searchQuery.getQuery();if(!c.taskService.getStoreTask(t).tags.includes(s)){f[d].addItem(babelHelpers.classPrivateFieldLooseBase(this,I)[I](h,s))}}},popupOptions:{events:{onClose:()=>{var e,s;const i=babelHelpers.classPrivateFieldLooseBase(this,b)[b](t).getSelectedItems().map((t=>t.getTitle()));void c.taskService.update(t,{tags:i});(e=(s=babelHelpers.classPrivateFieldLooseBase(this,v))[v])==null?void 0:e.call(s,i)}}}});return f[d]}function C(t){const e=babelHelpers.classPrivateFieldLooseBase(this,b)[b](t);const s=babelHelpers.classPrivateFieldLooseBase(this,T)[T](t);const i=new Set(c.taskService.getStoreTask(t).tags);const a=new Map([...i].map((t=>[t,[s,t]])));e.getItems().forEach((t=>{if(i.has(t.getTitle())){a.set(t.getTitle(),[s,t.getId()])}}));a.entries().forEach((([t,i])=>{if(!e.getItem(i)){e.addItem(babelHelpers.classPrivateFieldLooseBase(this,I)[I](s,t))}}));e.selectItemsByIds([...a.values()])}function y(t,e){return{id:e||"empty",entityId:t,title:e,tabs:"all",selected:true}}function F(t){return d.idUtils.isTemplate(t)?o.EntitySelectorEntity.TemplateTag:o.EntitySelectorEntity.Tag}const L={components:{BIcon:g.BIcon,AddButton:e.AddButton,FieldAdd:s.FieldAdd},inject:{task:{},taskId:{}},setup(){return{Outline:g.Outline,tagsMeta:k}},data(){return{isDialogShown:false,tagsIndexes:{},isHovered:false}},computed:{tags(){return[...this.task.tags].sort(((t,e)=>this.tagsIndexes[t]-this.tagsIndexes[e]))},isFilled(){return this.tags.length>0},readonly(){return!this.task.rights.edit},isAddActive(){return!this.readonly&&this.isFilled},isAddVisible(){return this.isDialogShown||this.isHovered}},created(){this.rememberTagsIndexes(this.tags)},methods:{handleClick(){if(this.readonly){return}B.show({targetNode:this.$refs.anchor,taskId:this.taskId,onClose:this.handleDialogClose});this.isDialogShown=true},handleDialogClose(t){this.isDialogShown=false;this.rememberTagsIndexes(t)},handleCrossClick(t){const e=this.tags.filter((e=>e!==t));void c.taskService.update(this.taskId,{tags:e})},rememberTagsIndexes(t){this.tagsIndexes=t.reduce(((t,e,s)=>{t[e]=s;return t}),{})}},template:`\n\t\t<div\n\t\t\tclass="tasks-field-tags"\n\t\t\t:class="{ '--empty': !isFilled }"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="tagsMeta.id"\n\t\t\t:data-task-field-value="task.tags.join(',')"\n\t\t\t@mouseenter="isHovered = true"\n\t\t\t@mouseleave="isHovered = false"\n\t\t>\n\t\t\t<AddButton v-if="isAddActive" :isVisible="isAddVisible" @click="handleClick"/>\n\t\t\t<template v-for="tag in tags" :key="tag">\n\t\t\t\t<div class="tasks-field-tag">\n\t\t\t\t\t<span>{{ tag }}</span>\n\t\t\t\t\t<div v-if="!readonly" class="tasks-field-tag-cross" @click.capture.stop="handleCrossClick(tag)">\n\t\t\t\t\t\t<BIcon :name="Outline.CROSS_L" hoverable/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<FieldAdd v-if="!isFilled" :icon="Outline.TAG" @click="handleClick"/>\n\t\t\t<div class="tasks-field-tags-anchor" ref="anchor"/>\n\t\t</div>\n\t`};const P={components:{Chip:h.Chip},inject:{task:{},taskId:{}},setup(){return{Outline:g.Outline,tagsMeta:k}},computed:{design(){return this.isSelected?h.ChipDesign.ShadowAccent:h.ChipDesign.ShadowNoAccent},isSelected(){return this.task.filledFields[k.id]}},methods:{handleClick(){if(this.isSelected){this.highlightField();return}B.show({targetNode:this.$el,taskId:this.taskId,onClose:this.highlightField})},highlightField(){void p.fieldHighlighter.setContainer(this.$root.$el).highlight(k.id)}},template:`\n\t\t<Chip\n\t\t\t:design\n\t\t\t:icon="Outline.TAG"\n\t\t\t:text="loc('TASKS_V2_TAGS_TITLE_CHIP')"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="tagsMeta.id"\n\t\t\t:data-task-chip-value="task.tags.join(',')"\n\t\t\t@click="handleClick"\n\t\t/>\n\t`};t.Tags=L;t.TagsChip=P;t.tagsMeta=k})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX,BX.Event,BX.Tasks.EntitySelector,BX.Tasks.V2,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.UI.System.Chip.Vue,BX.UI.IconSet,BX,BX.Tasks.V2.Lib);
//# sourceMappingURL=tags.bundle.map.js