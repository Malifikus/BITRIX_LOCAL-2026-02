this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(e,t,s,i,l,o,a,n,r,d,c,h,u,p,v,f){"use strict";const w=Object.freeze({id:u.TaskField.Flow,title:o.Loc.getMessage("TASKS_V2_FLOW_TITLE")});var g=babelHelpers.classPrivateFieldLooseKey("dialog");var k=babelHelpers.classPrivateFieldLooseKey("taskId");var b=babelHelpers.classPrivateFieldLooseKey("onClose");var F=babelHelpers.classPrivateFieldLooseKey("createDialog");var I=babelHelpers.classPrivateFieldLooseKey("fillStore");var m=babelHelpers.classPrivateFieldLooseKey("items");class B{constructor(){Object.defineProperty(this,m,{get:C,set:void 0});Object.defineProperty(this,F,{value:S});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,k,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,I,{writable:true,value:async()=>{const e=babelHelpers.classPrivateFieldLooseBase(this,g)[g].getSelectedItems()[0];if(!e){return null}const t={id:e.getId(),name:e.getTitle(),groupId:e.getCustomData().get("groupId"),templateId:e.getCustomData().get("templateId")};if(!a.Core.getStore().getters[`${u.Model.Groups}/getById`](t.groupId)){await r.groupService.getGroup(t.groupId)}await a.Core.getStore().dispatch(`${u.Model.Flows}/insert`,t);return t}})}show(e){var t,s;babelHelpers.classPrivateFieldLooseBase(this,k)[k]=e.taskId;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e.onClose;(s=(t=babelHelpers.classPrivateFieldLooseBase(this,g))[g])!=null?s:t[g]=babelHelpers.classPrivateFieldLooseBase(this,F)[F]();babelHelpers.classPrivateFieldLooseBase(this,g)[g].selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,m)[m]);babelHelpers.classPrivateFieldLooseBase(this,g)[g].showTo(e.targetNode)}}function S(){const e=new n.EntitySelectorDialog({context:"tasks-card",width:380,height:370,multiple:false,hideOnDeselect:true,enableSearch:true,entities:[{id:u.EntitySelectorEntity.Flow,options:{onlyActive:true}}],preselectedItems:babelHelpers.classPrivateFieldLooseBase(this,m)[m],events:{onLoad:babelHelpers.classPrivateFieldLooseBase(this,I)[I]},popupOptions:{events:{onClose:async()=>{var e,t;const s=await babelHelpers.classPrivateFieldLooseBase(this,I)[I]();if(s){const{id:e,templateId:t,groupId:i}=s;r.groupService.setHasScrumInfo(babelHelpers.classPrivateFieldLooseBase(this,k)[k]);void f.taskService.update(babelHelpers.classPrivateFieldLooseBase(this,k)[k],{flowId:e,templateId:t,groupId:i,stageId:0})}(e=(t=babelHelpers.classPrivateFieldLooseBase(this,b))[b])==null?void 0:e.call(t)}}}});if(a.Core.getParams().rights.flow.create){const t=o.Extension.getSettings("tasks.v2.component.fields.flow").get("isFeatureTriable");void o.Runtime.loadExtension("tasks.flow.entity-selector").then((({EmptyStub:s,Footer:i})=>{e.setFooter(new i(e,{isFeatureTriable:t}).render());e.getRecentTab().getStub().hide();e.getRecentTab().setStub(s,{showArrow:false});e.getRecentTab().render()}))}return e}function C(){return[[u.EntitySelectorEntity.Flow,f.taskService.getStoreTask(babelHelpers.classPrivateFieldLooseBase(this,k)[k]).flowId]]}const T=new B;const P={name:"TaskFlow",components:{BIcon:c.BIcon,BMenu:s.BMenu,HoverPill:i.HoverPill,FieldAdd:l.FieldAdd},inject:{task:{},taskId:{},isEdit:{}},setup(){return{flowMeta:w,Outline:c.Outline}},data(){return{isMenuShown:false}},computed:{flow(){return this.$store.getters[`${u.Model.Flows}/getById`](this.task.flowId)},menuOptions(){return{id:"tasks-field-flow-menu",bindElement:this.$refs.container,offsetTop:8,items:[{title:this.loc("TASKS_V2_FLOW_ABOUT"),icon:c.Outline.BOTTLENECK,onClick:this.openFlow},{title:this.loc("TASKS_V2_FLOW_CHANGE"),icon:c.Outline.EDIT_L,onClick:this.showDialog},{design:s.MenuItemDesign.Alert,title:this.loc("TASKS_V2_FLOW_DETACH"),icon:c.Outline.CROSS_L,onClick:this.clearField}],targetContainer:document.body}},readonly(){return!this.task.rights.edit}},methods:{handleClick(){if(this.flow&&this.readonly){this.openFlow();return}if(this.isEdit&&this.flow){this.isMenuShown=true}else{this.showDialog()}},openFlow(){const e=v.flowService.getUrl(this.flow.id,a.Core.getParams().currentUser.id);t.SidePanel.Instance.open(e)},clearField(){void f.taskService.update(this.taskId,{flowId:0,groupId:0,stageId:0})},showDialog(){T.show({targetNode:this.$refs.container,taskId:this.taskId})}},template:`\n\t\t<div\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="flowMeta.id"\n\t\t\t:data-task-field-value="task.flowId"\n\t\t\tref="container"\n\t\t>\n\t\t\t<HoverPill\n\t\t\t\tv-if="flow"\n\t\t\t\t:withClear="!readonly && !isEdit"\n\t\t\t\t:active="isMenuShown"\n\t\t\t\t@click="handleClick"\n\t\t\t\t@clear="clearField"\n\t\t\t>\n\t\t\t\t<div class="tasks-field-flow">\n\t\t\t\t\t<BIcon :name="Outline.BOTTLENECK"/>\n\t\t\t\t\t<div class="tasks-field-flow-title">{{ flow.name }}</div>\n\t\t\t\t</div>\n\t\t\t</HoverPill>\n\t\t\t<FieldAdd v-else :icon="Outline.BOTTLENECK" @click="handleClick"/>\n\t\t</div>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions" @close="isMenuShown = false"/>\n\t`};const L={components:{Chip:d.Chip},inject:{task:{},taskId:{}},props:{isAutonomous:{type:Boolean,default:false}},setup(){return{Outline:c.Outline,flowMeta:w}},computed:{flow(){return this.$store.getters[`${u.Model.Flows}/getById`](this.task.flowId)},design(){return{[!this.isAutonomous&&!this.isSelected]:d.ChipDesign.ShadowNoAccent,[!this.isAutonomous&&this.isSelected]:d.ChipDesign.ShadowAccent,[this.isAutonomous&&!this.isSelected]:d.ChipDesign.OutlineNoAccent,[this.isAutonomous&&this.isSelected]:d.ChipDesign.OutlineAccent}.true},isSelected(){if(this.isAutonomous){return this.task.flowId>0}return this.task.filledFields[w.id]},isFilled(){return this.isAutonomous&&this.task.flowId>0},text(){if(this.isFilled){return this.flow.name}return this.loc("TASKS_V2_FLOW_TITLE_CHIP")}},created(){if(this.task.flowId&&!this.flow){void v.flowService.getFlow(this.task.flowId)}},methods:{handleClick(){if(!this.isAutonomous&&this.isSelected){this.highlightField();return}T.show({targetNode:this.$el,taskId:this.taskId,onClose:this.highlightField})},highlightField(){void p.fieldHighlighter.setContainer(this.$root.$el).highlight(w.id)},handleClear(){void f.taskService.update(this.taskId,{flowId:0,groupId:0})}},template:`\n\t\t<Chip\n\t\t\t:design\n\t\t\t:icon="Outline.BOTTLENECK"\n\t\t\t:text\n\t\t\t:withClear="isFilled"\n\t\t\t:trimmable="isFilled"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="flowMeta.id"\n\t\t\t:data-task-chip-value="task.flowId"\n\t\t\t@click="handleClick"\n\t\t\t@clear="handleClear"\n\t\t\t:title="flow?.name ?? ''"\n\t\t/>\n\t`};e.Flow=P;e.FlowChip=L;e.flowMeta=w})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.SidePanel,BX.UI.System.Menu,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX,BX.Tasks.V2,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.UI.System.Chip.Vue,BX.UI.IconSet,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=flow.bundle.map.js