this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,a,n,l,r,o,d,c,h,p,T,k,v){"use strict";const b=Object.freeze({id:l.TaskField.Parent});var u,P,I,S,B,m;const f={};const L=new(u=babelHelpers.classPrivateFieldLooseKey("taskId"),P=babelHelpers.classPrivateFieldLooseKey("onUpdate"),I=babelHelpers.classPrivateFieldLooseKey("dialog"),S=babelHelpers.classPrivateFieldLooseKey("createDialog"),B=babelHelpers.classPrivateFieldLooseKey("onItemChange"),m=babelHelpers.classPrivateFieldLooseKey("items"),class{constructor(){Object.defineProperty(this,m,{get:F,set:void 0});Object.defineProperty(this,B,{value:E});Object.defineProperty(this,S,{value:y});Object.defineProperty(this,I,{get:g,set:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,P,{writable:true,value:void 0})}show(t){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=t.taskId;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=t.onClose;babelHelpers.classPrivateFieldLooseBase(this,I)[I].selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,m)[m]);babelHelpers.classPrivateFieldLooseBase(this,I)[I].showTo(t.targetNode)}});function g(){var t;const e=v.idUtils.isTemplate(babelHelpers.classPrivateFieldLooseBase(this,u)[u]);(t=f[e])!=null?t:f[e]=babelHelpers.classPrivateFieldLooseBase(this,S)[S](e);return f[e]}function y(t){const e=n.Runtime.debounce(babelHelpers.classPrivateFieldLooseBase(this,B)[B],10,this);return new r.EntitySelectorDialog({context:"tasks-card",multiple:false,hideOnDeselect:true,enableSearch:true,width:500,entities:[{id:l.EntitySelectorEntity.Task,options:{withTab:true}},t&&{id:l.EntitySelectorEntity.Template,options:{withTab:true,withFooter:false}}].filter((t=>t)),preselectedItems:babelHelpers.classPrivateFieldLooseBase(this,m)[m],events:{"Item:onSelect":e,"Item:onDeselect":e}})}async function E(){var t,e,s;const i=babelHelpers.classPrivateFieldLooseBase(this,I)[I].getSelectedItems()[0];const a=(i==null?void 0:i.getEntityId())===l.EntitySelectorEntity.Template;const n=a?v.idUtils.boxTemplate(i.getId()):(t=i==null?void 0:i.getId())!=null?t:0;const r=await d.subTasksService.setParent(babelHelpers.classPrivateFieldLooseBase(this,u)[u],n);if(r){void o.relationError.setTaskId(babelHelpers.classPrivateFieldLooseBase(this,u)[u]).showError(r,l.TaskField.Parent);return}(e=(s=babelHelpers.classPrivateFieldLooseBase(this,P))[P])==null?void 0:e.call(s)}function F(){const t=c.taskService.getStoreTask(babelHelpers.classPrivateFieldLooseBase(this,u)[u]).parentId;const e=v.idUtils.unbox(t);const s=v.idUtils.isTemplate(t);const i=s?[l.EntitySelectorEntity.Template,e]:[l.EntitySelectorEntity.Task,t];return t?[i]:[]}const X={name:"TaskParentTask",components:{BIcon:p.BIcon,TaskList:i.TaskList,TextMd:s.TextMd},directives:{hint:e.hint},inject:{task:{},taskId:{}},setup(){return{Outline:p.Outline,parentTaskMeta:b,subTasksService:d.subTasksService}},computed:{parentId(){return this.task.parentId},hasParent(){return v.idUtils.isReal(this.parentId)},title(){if(v.idUtils.isTemplate(this.parentId)){return this.loc("TASKS_V2_PARENT_TEMPLATE_TITLE")}return this.loc("TASKS_V2_PARENT_TASK_TITLE")},tooltip(){return()=>a.tooltip({text:this.loc("TASKS_V2_PARENT_TASK_SELECT"),popupOptions:{offsetLeft:this.$refs.add.$el.offsetWidth/2}})}},watch:{parentId:{immediate:true,handler(){if(this.hasParent){void d.subTasksService.getParent(this.taskId,this.parentId)}}}},methods:{handleEditClick(){L.show({targetNode:this.$refs.add.$el,taskId:this.taskId})},async handleRemoveParentTask(){await d.subTasksService.setParent(this.taskId,0)}},template:`\n\t\t<div class="tasks-field-parent-task" :data-task-id="taskId" :data-task-field-id="parentTaskMeta.id">\n\t\t\t<div class="tasks-field-parent-task-title">\n\t\t\t\t<div class="tasks-field-parent-task-main" :class="{ '--readonly': true }">\n\t\t\t\t\t<BIcon :name="Outline.SUBTASK"/>\n\t\t\t\t\t<TextMd accent>{{ title }}</TextMd>\n\t\t\t\t</div>\n\t\t\t\t<div v-if="task.rights.edit" v-hint="tooltip" class="tasks-field-parent-task-edit-container">\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tclass="tasks-field-parent-task-icon"\n\t\t\t\t\t\t:name="Outline.PLUS_L"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\t:data-task-relation-add="parentTaskMeta.id"\n\t\t\t\t\t\tref="add"\n\t\t\t\t\t\t@click="handleEditClick"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<TaskList\n\t\t\t\tv-if="hasParent"\n\t\t\t\t:ids="hasParent ? [parentId] : []"\n\t\t\t\t:loadingIds="!subTasksService.hasStoreTask(parentId) ? [parentId] : []"\n\t\t\t\t@removeTask="handleRemoveParentTask"\n\t\t\t/>\n\t\t</div>\n\t`};const C={components:{Chip:h.Chip},inject:{task:{},taskId:{}},setup(){return{parentTaskMeta:b,Outline:p.Outline}},computed:{text(){if(v.idUtils.isTemplate(this.task.parentId)){return this.loc("TASKS_V2_PARENT_TEMPLATE_TITLE_CHIP")}return this.loc("TASKS_V2_PARENT_TASK_TITLE_CHIP")},design(){return this.isSelected?h.ChipDesign.ShadowAccent:h.ChipDesign.ShadowNoAccent},isSelected(){return this.task.filledFields[b.id]}},methods:{handleClick(){if(this.isSelected){this.highlightField();return}L.show({targetNode:this.$el,taskId:this.taskId,onUpdate:this.highlightField})},highlightField(){void k.fieldHighlighter.setContainer(this.$root.$el).highlight(b.id)}},template:`\n\t\t<Chip\n\t\t\tv-if="task.rights.edit || isSelected"\n\t\t\t:design\n\t\t\t:text\n\t\t\t:icon="Outline.SUBTASK"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="parentTaskMeta.id"\n\t\t\tref="chip"\n\t\t\t@click="handleClick"\n\t\t/>\n\t`};t.ParentTask=X;t.ParentTaskChip=C;t.parentTaskMeta=b})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.Vue3.Directives,BX.UI.System.Typography.Vue,BX.Tasks.V2.Component,BX.Tasks.V2.Component.Elements,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service,BX.UI.System.Chip.Vue,BX.UI.IconSet,BX,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib);
//# sourceMappingURL=parent-task.bundle.map.js