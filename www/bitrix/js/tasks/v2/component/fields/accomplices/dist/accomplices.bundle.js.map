{"version":3,"file":"accomplices.bundle.js","sources":["../src/accomplices-meta.js","../src/accomplices.js","../src/accomplices-chip.js"],"sourcesContent":["import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\n\nexport const accomplicesMeta = Object.freeze({\n\tid: TaskField.Accomplices,\n\ttitle: Loc.getMessage('TASKS_V2_ACCOMPLICES_TITLE'),\n});\n","import { Type } from 'main.core';\nimport { Core } from 'tasks.v2.core';\nimport { Participants } from 'tasks.v2.component.elements.participants';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { accomplicesMeta } from './accomplices-meta';\n\n// @vue/component\nexport const Accomplices = {\n\tname: 'TaskAccomplices',\n\tcomponents: {\n\t\tParticipants,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t\tanalytics: {},\n\t\tcardType: {},\n\t},\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\taccomplicesMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\tdataset(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'data-task-id': this.taskId,\n\t\t\t\t'data-task-field-id': accomplicesMeta.id,\n\t\t\t\t'data-task-field-value': this.task.accomplicesIds.join(','),\n\t\t\t};\n\t\t},\n\t\tisLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.stakeholder.available;\n\t\t},\n\t\tfeatureId(): string\n\t\t{\n\t\t\treturn Core.getParams().restrictions.stakeholder.featureId;\n\t\t},\n\t\taccomplicesCount(): number\n\t\t{\n\t\t\treturn this.task.accomplicesIds?.length ?? 0;\n\t\t},\n\t},\n\tmethods: {\n\t\tupdate(accomplicesIds: number[]): void\n\t\t{\n\t\t\tconst hasChanges = taskService.hasChanges(this.task, { accomplicesIds })\n\t\t\t\t&& accomplicesIds.length > 0\n\t\t\t\t&& accomplicesIds.length >= this.accomplicesCount\n\t\t\t;\n\n\t\t\tvoid taskService.update(this.taskId, { accomplicesIds });\n\n\t\t\tif (hasChanges)\n\t\t\t{\n\t\t\t\tanalytics.sendAddCoexecutor(this.analytics, {\n\t\t\t\t\tcardType: this.cardType,\n\t\t\t\t\ttaskId: Type.isNumber(this.taskId) ? this.taskId : 0,\n\t\t\t\t\tviewersCount: this.task.auditorsIds?.length ?? 0,\n\t\t\t\t\tcoexecutorsCount: accomplicesIds.length,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Participants\n\t\t\t:taskId\n\t\t\t:context=\"accomplicesMeta.id\"\n\t\t\t:userIds=\"task.accomplicesIds\"\n\t\t\t:canAdd=\"task.rights.changeAccomplices\"\n\t\t\t:canRemove=\"task.rights.changeAccomplices\"\n\t\t\t:dataset\n\t\t\t:isLocked\n\t\t\t:featureId\n\t\t\t@update=\"update\"\n\t\t/>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { Chip, ChipDesign } from 'ui.system.chip.vue';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport { analytics } from 'tasks.v2.lib.analytics';\nimport { showLimit } from 'tasks.v2.lib.show-limit';\nimport { usersDialog } from 'tasks.v2.lib.user-selector-dialog';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { accomplicesMeta } from './accomplices-meta';\n\n// @vue/component\nexport const AccomplicesChip = {\n\tcomponents: {\n\t\tChip,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t\tanalytics: {},\n\t\tcardType: {},\n\t},\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\taccomplicesMeta,\n\t\t};\n\t},\n\tcomputed: {\n\t\tdesign(): string\n\t\t{\n\t\t\treturn this.isSelected ? ChipDesign.ShadowAccent : ChipDesign.ShadowNoAccent;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\treturn this.task.filledFields[accomplicesMeta.id];\n\t\t},\n\t\tisLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.stakeholder.available;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isSelected)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isLocked)\n\t\t\t{\n\t\t\t\tvoid showLimit({\n\t\t\t\t\tfeatureId: Core.getParams().restrictions.stakeholder.featureId,\n\t\t\t\t\tbindElement: this.$el,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid usersDialog.show({\n\t\t\t\ttargetNode: this.$el,\n\t\t\t\tids: this.task.accomplicesIds,\n\t\t\t\tonClose: this.handleClose,\n\t\t\t});\n\t\t},\n\t\thandleClose(accomplicesIds: number[]): void\n\t\t{\n\t\t\tif (!this.isSelected && accomplicesIds.length > 0)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\tanalytics.sendAddCoexecutor(this.analytics, {\n\t\t\t\t\tcardType: this.cardType,\n\t\t\t\t\ttaskId: Type.isNumber(this.taskId) ? this.taskId : 0,\n\t\t\t\t\tviewersCount: this.task.auditorsIds?.length ?? 0,\n\t\t\t\t\tcoexecutorsCount: accomplicesIds.length,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tvoid taskService.update(this.taskId, { accomplicesIds });\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(accomplicesMeta.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\tv-if=\"isSelected || task.rights.changeAccomplices\"\n\t\t\t:design\n\t\t\t:icon=\"Outline.PERSON\"\n\t\t\t:lock=\"isLocked\"\n\t\t\t:text=\"loc('TASKS_V2_ACCOMPLICES_TITLE_CHIP')\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"accomplicesMeta.id\"\n\t\t\t:data-task-chip-value=\"task.accomplicesIds.join(',')\"\n\t\t\t@click=\"handleClick\"\n\t\t/>\n\t`,\n};\n"],"names":["accomplicesMeta","Object","freeze","id","TaskField","Accomplices","title","Loc","getMessage","name","components","Participants","inject","task","taskId","analytics","cardType","setup","computed","dataset","accomplicesIds","join","isLocked","Core","getParams","restrictions","stakeholder","available","featureId","accomplicesCount","length","methods","update","hasChanges","taskService","sendAddCoexecutor","Type","isNumber","viewersCount","auditorsIds","coexecutorsCount","template","AccomplicesChip","Chip","Outline","design","isSelected","ChipDesign","ShadowAccent","ShadowNoAccent","filledFields","handleClick","highlightField","showLimit","bindElement","$el","usersDialog","show","targetNode","ids","onClose","handleClose","fieldHighlighter","setContainer","$root","highlight"],"mappings":"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"}