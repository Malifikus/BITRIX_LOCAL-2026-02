{"version":3,"file":"time-tracking.bundle.js","sources":["../src/popup/time-tracking-popup.js","../src/hint/time-tracking-invoice-hint.js","../src/list/time-tracking-list-empty.js","../src/list/time-tracking-list-header.js","../src/list/item/time-tracking-list-item-edit.js","../src/lib/time-tracking-util.js","../src/list/item/time-tracking-list-item-view.js","../src/list/time-tracking-list-item.js","../src/list/time-tracking-list-item-skeleton.js","../src/list/time-tracking-list.js","../src/sheet/time-tracking-paticipants-popup.js","../src/timer/time-tracking-timer.js","../src/sheet/time-tracking-sheet.js","../src/time-tracking-meta.js","../src/time-tracking.js","../src/time-tracking-chip.js"],"sourcesContent":["import { Type } from 'main.core';\nimport type { PopupOptions } from 'main.popup';\nimport { EventName, Model } from 'tasks.v2.const';\n\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { TextMd, TextSm, TextXs, Text2Xl } from 'ui.system.typography.vue';\nimport { BInput, InputDesign } from 'ui.system.input.vue';\nimport { SwitcherSize, type SwitcherOptions } from 'ui.switcher';\nimport { Switcher } from 'ui.vue3.components.switcher';\nimport 'ui.icon-set.outline';\nimport { Popup } from 'ui.vue3.components.popup';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\n\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { statusService } from 'tasks.v2.provider.service.status-service';\nimport type { TaskModel, TimerModel } from 'tasks.v2.model.tasks';\n\nimport './time-tracking-popup.css';\n\n// @vue/component\nexport const TaskTrackingPopup = {\n\tname: 'TasksTaskTrackingPopup',\n\tcomponents: {\n\t\tBIcon,\n\t\tBInput,\n\t\tPopup,\n\t\tSwitcher,\n\t\tTextMd,\n\t\tTextSm,\n\t\tTextXs,\n\t\tText2Xl,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t},\n\tprops: {\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\tdefault: null,\n\t\t},\n\t\ttimeSpent: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['close'],\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tInputDesign,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tlocalAllowsTimeTracking: true,\n\t\t\tlocalEstimatedTime: 0,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t}),\n\t\toptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: `tasks-time-tracking-popup-${this.taskId}`,\n\t\t\t\tclassName: 'tasks-time-tracking-popup',\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\twidth: 540,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t};\n\t\t},\n\t\tswitcherOptions(): SwitcherOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tsize: SwitcherSize.small,\n\t\t\t\tuseAirDesign: true,\n\t\t\t};\n\t\t},\n\t\ttimer(): ?TimerModel\n\t\t{\n\t\t\treturn this.task.timers?.find((timer: TimerModel) => timer.userId === this.currentUserId);\n\t\t},\n\t\thours: {\n\t\t\tget(): string\n\t\t\t{\n\t\t\t\tconst hour = Math.floor(this.localEstimatedTime / 3600);\n\n\t\t\t\tif (hour === 0)\n\t\t\t\t{\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\treturn String(hour) || '';\n\t\t\t},\n\t\t\tset(value: number): void\n\t\t\t{\n\t\t\t\tlet hours = value === '' ? 0 : parseInt(value, 10);\n\t\t\t\tif (!Type.isNumber(hours))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\thours = Math.abs(hours);\n\n\t\t\t\tconst minutes = this.minutes;\n\t\t\t\tthis.localEstimatedTime = (hours * 3600) + (minutes * 60);\n\n\t\t\t\tthis.save();\n\t\t\t},\n\t\t},\n\t\tminutes: {\n\t\t\tget(): string\n\t\t\t{\n\t\t\t\tconst minutes = Math.floor((this.localEstimatedTime % 3600) / 60);\n\n\t\t\t\tif (minutes === 0)\n\t\t\t\t{\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\treturn String(minutes) || '';\n\t\t\t},\n\t\t\tset(value: number): void\n\t\t\t{\n\t\t\t\tlet minutes = value === '' ? 0 : parseInt(value, 10);\n\t\t\t\tif (!Type.isNumber(minutes))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tminutes = Math.abs(minutes);\n\n\t\t\t\tconst hours = this.hours;\n\t\t\t\tthis.localEstimatedTime = (hours * 3600) + (minutes * 60);\n\n\t\t\t\tthis.save();\n\t\t\t},\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tthis.localEstimatedTime = this.task.estimatedTime ?? 0;\n\n\t\tthis.save();\n\t},\n\tmethods: {\n\t\thandleClose(): void\n\t\t{\n\t\t\tthis.save();\n\n\t\t\tthis.$emit('close');\n\t\t},\n\t\ttoggleAllows(): void\n\t\t{\n\t\t\tif (!this.task.rights.edit)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst localAllowsTimeTracking = !this.localAllowsTimeTracking;\n\n\t\t\tif (\n\t\t\t\tthis.task.allowsTimeTracking === true\n\t\t\t\t&& this.timeSpent\n\t\t\t\t&& localAllowsTimeTracking === false\n\t\t\t)\n\t\t\t{\n\t\t\t\tthis.freeze();\n\n\t\t\t\tconst messageBox = MessageBox.create({\n\t\t\t\t\tmessage: this.loc('TASKS_V2_TIME_TRACKING_CONFIRM_POPUP_TEXT'),\n\t\t\t\t\ttitle: this.loc('TASKS_V2_TIME_TRACKING_CONFIRM_POPUP_TITLE'),\n\t\t\t\t\tokCaption: this.loc('TASKS_V2_TIME_TRACKING_CONFIRM_POPUP_OK'),\n\t\t\t\t\tcancelCaption: this.loc('TASKS_V2_TIME_TRACKING_CONFIRM_POPUP_CANCEL'),\n\t\t\t\t\tuseAirDesign: true,\n\t\t\t\t\tpopupOptions: {\n\t\t\t\t\t\theight: 186,\n\t\t\t\t\t\tcloseIcon: false,\n\t\t\t\t\t},\n\t\t\t\t\tonOk: () => {\n\t\t\t\t\t\tthis.localAllowsTimeTracking = localAllowsTimeTracking;\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\tthis.unfreeze();\n\t\t\t\t\t\tthis.handleClose();\n\t\t\t\t\t},\n\t\t\t\t\tonCancel: () => {\n\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\tthis.unfreeze();\n\t\t\t\t\t\tthis.handleClose();\n\t\t\t\t\t},\n\t\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\t});\n\t\t\t\tmessageBox.show();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.localAllowsTimeTracking = localAllowsTimeTracking;\n\t\t},\n\t\tsave(): void\n\t\t{\n\t\t\tif (this.task.allowsTimeTracking !== this.localAllowsTimeTracking)\n\t\t\t{\n\t\t\t\tthis.$bitrix.eventEmitter.emit(EventName.TimeTrackingChange);\n\t\t\t}\n\n\t\t\tvoid taskService.update(this.taskId, {\n\t\t\t\tallowsTimeTracking: this.localAllowsTimeTracking,\n\t\t\t\testimatedTime: this.localEstimatedTime,\n\t\t\t});\n\n\t\t\tif (!this.localAllowsTimeTracking && this.timer)\n\t\t\t{\n\t\t\t\tvoid statusService.pauseTimer(this.taskId);\n\t\t\t}\n\t\t},\n\t\topenHelpDesk(): void\n\t\t{\n\t\t\ttop.BX.Helper.show('redirect=detail&code=27145920');\n\t\t},\n\t\tfreeze(): void\n\t\t{\n\t\t\tthis.$refs.popup?.freeze();\n\t\t},\n\t\tunfreeze(): void\n\t\t{\n\t\t\tthis.$refs.popup?.unfreeze();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Popup ref=\"popup\" :options @close=\"handleClose\">\n\t\t\t<div\n\t\t\t\tclass=\"tasks-time-tracking-popup-header\"\n\t\t\t\t:class=\"{'--disable': !localAllowsTimeTracking}\"\n\t\t\t>\n\t\t\t\t<div class=\"tasks-time-tracking-popup-content\">\n\t\t\t\t\t<div class=\"tasks-time-tracking-popup-content-info\">\n\t\t\t\t\t\t<div class=\"tasks-time-tracking-popup-content-switcher\">\n\t\t\t\t\t\t\t<Switcher\n\t\t\t\t\t\t\t\t:isChecked=\"localAllowsTimeTracking\"\n\t\t\t\t\t\t\t\t:options=\"switcherOptions\"\n\t\t\t\t\t\t\t\t@click=\"toggleAllows\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<Text2Xl\n\t\t\t\t\t\t\t\tclass=\"tasks-task-setting-switcher-label\"\n\t\t\t\t\t\t\t\t@click=\"toggleAllows\"\n\t\t\t\t\t\t\t>{{ loc('TASKS_V2_TIME_TRACKING_POPUP_LABEL') }}</Text2Xl>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<TextMd class=\"tasks-time-tracking-popup-content-text\">\n\t\t\t\t\t\t\t{{ loc('TASKS_V2_TIME_TRACKING_POPUP_TEXT') }}\n\t\t\t\t\t\t</TextMd>\n\t\t\t\t\t\t<div class=\"tasks-time-tracking-popup-content-more\" @click=\"openHelpDesk\">\n\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\t:name=\"Outline.KNOWLEDGE_BASE\"\n\t\t\t\t\t\t\t\tclass=\"tasks-time-tracking-popup-content-more-icon\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<TextSm class=\"tasks-time-tracking-popup-content-more-text\">\n\t\t\t\t\t\t\t\t{{ loc('TASKS_V2_TIME_TRACKING_POPUP_MORE') }}\n\t\t\t\t\t\t\t</TextSm>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-time-tracking-popup-content-icon\"/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"localAllowsTimeTracking\" class=\"tasks-time-tracking-popup-form\">\n\t\t\t\t<TextMd class=\"tasks-time-tracking-popup-form-title\">\n\t\t\t\t\t{{ loc('TASKS_V2_TIME_TRACKING_POPUP_FORM_TITLE') }}\n\t\t\t\t</TextMd>\n\t\t\t\t<TextXs class=\"tasks-time-tracking-popup-form-label\">\n\t\t\t\t\t{{ loc('TASKS_V2_TIME_TRACKING_POPUP_FORM_LABEL') }}\n\t\t\t\t</TextXs>\n\t\t\t\t<div class=\"tasks-time-tracking-popup-form-fields\">\n\t\t\t\t\t<BInput\n\t\t\t\t\t\tv-model=\"hours\"\n\t\t\t\t\t\tclass=\"tasks-time-tracking-popup-form-field\"\n\t\t\t\t\t\t:design=\"InputDesign.LightGrey\"\n\t\t\t\t\t\t:label=\"loc('TASKS_V2_TIME_TRACKING_POPUP_FORM_HOUR')\"\n\t\t\t\t\t\tlabelInline\n\t\t\t\t\t/>\n\t\t\t\t\t<BInput\n\t\t\t\t\t\tv-model=\"minutes\"\n\t\t\t\t\t\tclass=\"tasks-time-tracking-popup-form-field\"\n\t\t\t\t\t\t:design=\"InputDesign.LightGrey\"\n\t\t\t\t\t\t:label=\"loc('TASKS_V2_TIME_TRACKING_POPUP_FORM_MINUTES')\"\n\t\t\t\t\t\tlabelInline\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Popup>\n\t`,\n};\n","import { Hint } from 'tasks.v2.component.elements.hint';\n\nimport './time-tracking-hint.css';\n\n// @vue/component\nexport const TimeTrackingInvoiceHint = {\n\tname: 'TasksTimeTrackingInvoiceHint',\n\tcomponents: {\n\t\tHint,\n\t},\n\tprops: {\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Hint\n\t\t\t:bindElement\n\t\t\t:options=\"{\n\t\t\t\tmaxWidth: 430,\n\t\t\t\tcloseIcon: true,\n\t\t\t\toffsetLeft: bindElement ? bindElement.offsetWidth / 2 : 0,\n\t\t\t}\"\n\t\t\t@close=\"$emit('close')\"\n\t\t>\n\t\t\t<div class=\"tasks-time-tracking-hint\">\n\t\t\t\t<div class=\"tasks-time-tracking-hint-image\">\n\t\t\t\t\t<div class=\"tasks-time-tracking-invoice-hint-icon\"/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-time-tracking-hint-content\">\n\t\t\t\t\t<div class=\"tasks-time-tracking-hint-title\">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TIME_TRACKING_HINT_TITLE_INVOICE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-time-tracking-hint-text\">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TIME_TRACKING_HINT_TEXT_INVOICE') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Hint>\n\t`,\n};\n","import { Button as UiButton, AirButtonStyle, ButtonSize } from 'ui.vue3.components.button';\nimport { HeadlineXs } from 'ui.system.typography.vue';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport './time-tracking-list-empty.css';\n\n// @vue/component\nexport const TimeTrackingListEmpty = {\n\tname: 'TasksTimeTrackingListEmpty',\n\tcomponents: {\n\t\tHeadlineXs,\n\t\tUiButton,\n\t},\n\temits: ['add'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t\tOutline,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-time-tracking-list-empty\">\n\t\t\t<div class=\"tasks-time-tracking-list-empty-icon\"/>\n\t\t\t<div class=\"tasks-time-tracking-list-empty-text\">\n\t\t\t\t<HeadlineXs>{{ loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_EMPTY_INFO') }}</HeadlineXs>\n\t\t\t\t<HeadlineXs>{{ loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_EMPTY_ADD') }}</HeadlineXs>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-time-tracking-list-empty-button\" @click=\"$emit('add')\">\n\t\t\t\t<UiButton\n\t\t\t\t\t:leftIcon=\"Outline.PLUS_L\"\n\t\t\t\t\t:text=\"loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_EMPTY_ADD_BTN')\"\n\t\t\t\t\t:style=\"AirButtonStyle.FILLED\"\n\t\t\t\t\t:size=\"ButtonSize.MEDIUM\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Button as UiButton, AirButtonStyle, ButtonSize } from 'ui.vue3.components.button';\nimport { Text2Xs } from 'ui.system.typography.vue';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport './time-tracking-list-header.css';\n\n// @vue/component\nexport const TimeTrackingListHeader = {\n\tname: 'TasksTimeTrackingListHeader',\n\tcomponents: {\n\t\tUiButton,\n\t\tText2Xs,\n\t},\n\tprops: {\n\t\tempty: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\taddBtnDisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['add'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t\tOutline,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-time-tracking-list-row --header\">\n\t\t\t<div class=\"tasks-time-tracking-list-column --header --date\">\n\t\t\t\t<Text2Xs>{{ loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_COLUMN_DATE') }}</Text2Xs>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-time-tracking-list-column --header --time\">\n\t\t\t\t<Text2Xs>{{ loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_COLUMN_TIME') }}</Text2Xs>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-time-tracking-list-column --header --author\">\n\t\t\t\t<Text2Xs>{{ loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_COLUMN_AUTHOR') }}</Text2Xs>\n\t\t\t\t<UiButton\n\t\t\t\t\tv-if=\"!empty\"\n\t\t\t\t\t:leftIcon=\"Outline.PLUS_L\"\n\t\t\t\t\t:text=\"loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_COLUMN_BTN')\"\n\t\t\t\t\t:style=\"AirButtonStyle.OUTLINE_ACCENT_2\"\n\t\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t\t:disabled=\"addBtnDisabled\"\n\t\t\t\t\t@click=\"$emit('add')\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Text, Type } from 'main.core';\nimport type { BaseEvent } from 'main.core.events';\nimport { DateTimeFormat } from 'main.date';\n\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { BInput, InputDesign } from 'ui.system.input.vue';\nimport { Button as UiButton, AirButtonStyle, ButtonColor, ButtonIcon, ButtonSize } from 'ui.vue3.components.button';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { DatePicker, DatePickerEvent } from 'ui.date-picker';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { calendar } from 'tasks.v2.lib.calendar';\nimport { timezone } from 'tasks.v2.lib.timezone';\n\nimport './time-tracking-list-item-edit.css';\n\n// @vue/component\nexport const TimeTrackingListItemEdit = {\n\tname: 'TasksTimeTrackingListItemEdit',\n\tcomponents: {\n\t\tBIcon,\n\t\tBInput,\n\t\tUiButton,\n\t},\n\tinject: {\n\t\ttaskId: {},\n\t},\n\tprops: {\n\t\telapsedTimeCreatedAtTs: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t},\n\t\telapsedTimeSeconds: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t},\n\t\telapsedTimeText: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['save', 'cancel'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t\tButtonIcon,\n\t\t\tButtonColor,\n\t\t\tInputDesign,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisCalendarShown: false,\n\t\t\tlocalCreatedAt: null,\n\t\t\tlocalSeconds: 0,\n\t\t\tlocalText: '',\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t}),\n\t\thours: {\n\t\t\tget(): string\n\t\t\t{\n\t\t\t\tconst hour = Math.floor(this.localSeconds / 3600);\n\t\t\t\tif (hour === 0)\n\t\t\t\t{\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\treturn String(hour) || '';\n\t\t\t},\n\t\t\tset(value: number): void\n\t\t\t{\n\t\t\t\tlet hours = value === '' ? 0 : parseInt(value, 10);\n\t\t\t\tif (!Type.isNumber(hours))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\thours = Math.abs(hours);\n\n\t\t\t\tconst minutes = this.minutes;\n\t\t\t\tthis.localSeconds = (hours * 3600) + (minutes * 60);\n\t\t\t},\n\t\t},\n\t\tminutes: {\n\t\t\tget(): string\n\t\t\t{\n\t\t\t\tconst minutes = Math.floor((this.localSeconds % 3600) / 60);\n\t\t\t\tif (minutes === 0)\n\t\t\t\t{\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\treturn String(minutes) || '';\n\t\t\t},\n\t\t\tset(value: number): void\n\t\t\t{\n\t\t\t\tlet minutes = value === '' ? 0 : parseInt(value, 10);\n\t\t\t\tif (!Type.isNumber(minutes))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tminutes = Math.abs(minutes);\n\n\t\t\t\tconst hours = this.hours;\n\t\t\t\tthis.localSeconds = (hours * 3600) + (minutes * 60);\n\t\t\t},\n\t\t},\n\t\ttext: {\n\t\t\tget(): string\n\t\t\t{\n\t\t\t\treturn this.localText;\n\t\t\t},\n\t\t\tset(value: string): void\n\t\t\t{\n\t\t\t\tthis.localText = value;\n\t\t\t},\n\t\t},\n\t},\n\twatch: {\n\t\tisCalendarShown(value: boolean): void\n\t\t{\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\tthis.datePicker.show();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.datePicker.hide();\n\t\t\t}\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tconst createdDate = this.getCreatedDate();\n\t\tthis.localCreatedAt = new Date(createdDate.getTime() + timezone.getOffset(createdDate.getTime()));\n\n\t\tthis.localSeconds = this.elapsedTimeSeconds;\n\t\tthis.localText = this.elapsedTimeText;\n\t},\n\tmounted(): void\n\t{\n\t\tthis.datePicker = this.createDatePicker();\n\t},\n\tunmounted(): void\n\t{\n\t\tthis.datePicker?.destroy();\n\t},\n\tmethods: {\n\t\tcreateDatePicker(): DatePicker\n\t\t{\n\t\t\tconst selectedDateTs = this.localCreatedAt ? this.localCreatedAt.getTime() : null;\n\n\t\t\treturn new DatePicker({\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tid: `tasks-time-tracking-list-popup-${Text.getRandom()}`,\n\t\t\t\t\tbindElement: this.$refs.calendarInput.$el,\n\t\t\t\t\tbindOptions: { forceBindPosition: true },\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: (): void => {\n\t\t\t\t\t\t\tthis.isCalendarShown = false;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tselectedDates: [selectedDateTs],\n\t\t\t\tenableTime: true,\n\t\t\t\tevents: {\n\t\t\t\t\t[DatePickerEvent.SELECT]: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { date } = event.getData();\n\t\t\t\t\t\tthis.localCreatedAt = calendar.createDateFromUtc(date);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tgetCreatedDate(): ?Date\n\t\t{\n\t\t\tif (!this.elapsedTimeCreatedAtTs)\n\t\t\t{\n\t\t\t\treturn new Date();\n\t\t\t}\n\n\t\t\treturn new Date(this.elapsedTimeCreatedAtTs * 1000);\n\t\t},\n\t\tformatDate(date: ?Date): ?string\n\t\t{\n\t\t\tif (!date)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst format = this.loc('TASKS_V2_DATE_TIME_FORMAT', {\n\t\t\t\t'#DATE#': DateTimeFormat.getFormat('FORMAT_DATE'),\n\t\t\t\t'#TIME#': DateTimeFormat.getFormat('SHORT_TIME_FORMAT'),\n\t\t\t});\n\n\t\t\treturn DateTimeFormat.format(format, date);\n\t\t},\n\t\tsave(): void\n\t\t{\n\t\t\tconst offset = timezone.getOffset(this.localCreatedAt.getTime());\n\t\t\tconst localCreatedAt = new Date(this.localCreatedAt.getTime() - offset);\n\n\t\t\tthis.$emit('save', {\n\t\t\t\ttaskId: this.taskId,\n\t\t\t\tcreatedAtTs: Math.floor(localCreatedAt.getTime() / 1000),\n\t\t\t\tseconds: this.localSeconds,\n\t\t\t\ttext: this.localText,\n\t\t\t\tsource: 'manual',\n\t\t\t\trights: {\n\t\t\t\t\tedit: true,\n\t\t\t\t\tremove: true,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-time-tracking-list-row\">\n\t\t\t<div class=\"tasks-time-tracking-list-item-edit\">\n\t\t\t\t<div class=\"tasks-time-tracking-list-item-edit-time\">\n\t\t\t\t\t<BInput\n\t\t\t\t\t\tref=\"calendarInput\"\n\t\t\t\t\t\tclass=\"tasks-time-tracking-list-item-edit-time-calendar\"\n\t\t\t\t\t\t:modelValue=\"formatDate(localCreatedAt)\"\n\t\t\t\t\t\t:design=\"InputDesign.LightGrey\"\n\t\t\t\t\t\tclickable\n\t\t\t\t\t\t:label=\"loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_COLUMN_DATE')\"\n\t\t\t\t\t\t@click=\"isCalendarShown = !isCalendarShown\"\n\t\t\t\t\t/>\n\t\t\t\t\t<BInput\n\t\t\t\t\t\tv-model=\"hours\"\n\t\t\t\t\t\tclass=\"tasks-time-tracking-list-item-edit-time-field\"\n\t\t\t\t\t\t:design=\"InputDesign.LightGrey\"\n\t\t\t\t\t\t:label=\"loc('TASKS_V2_TIME_TRACKING_POPUP_FORM_HOUR')\"\n\t\t\t\t\t\t:placeholder=\"loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_ITEM_EDIT_INPUT_H')\"\n\t\t\t\t\t/>\n\t\t\t\t\t<BInput\n\t\t\t\t\t\tv-model=\"minutes\"\n\t\t\t\t\t\tclass=\"tasks-time-tracking-list-item-edit-time-field\"\n\t\t\t\t\t\t:design=\"InputDesign.LightGrey\"\n\t\t\t\t\t\t:label=\"loc('TASKS_V2_TIME_TRACKING_POPUP_FORM_MINUTES')\"\n\t\t\t\t\t\t:placeholder=\"loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_ITEM_EDIT_INPUT_M')\"\n\t\t\t\t\t/>\n\t\t\t\t\t<UiButton\n\t\t\t\t\t\t:leftIcon=\"Outline.CHECK_L\"\n\t\t\t\t\t\t:style=\"AirButtonStyle.FILLED\"\n\t\t\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t\t\t@click=\"save\"\n\t\t\t\t\t/>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name=\"Outline.CROSS_L\"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\tclass=\"tasks-time-tracking-list-item-edit-close-icon\"\n\t\t\t\t\t\t@click=\"$emit('cancel')\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-time-tracking-list-item-edit-text\">\n\t\t\t\t\t<BInput\n\t\t\t\t\t\tv-model=\"text\"\n\t\t\t\t\t\t:placeholder=\"loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_ITEM_EDIT_TEXT')\"\n\t\t\t\t\t\t:rowsQuantity=\"3\"\n\t\t\t\t\t\tactive\n\t\t\t\t\t\tresize=\"none\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","export const formatTime = (seconds) => {\n\tif (!seconds && seconds !== 0)\n\t{\n\t\treturn '00:00:00';\n\t}\n\n\tconst hours = Math.floor(seconds / 3600);\n\tconst minutes = Math.floor((seconds % 3600) / 60);\n\tconst secs = seconds % 60;\n\n\treturn [\n\t\thours.toString().padStart(2, '0'),\n\t\tminutes.toString().padStart(2, '0'),\n\t\tsecs.toString().padStart(2, '0'),\n\t].join(':');\n};\n","import { Type } from 'main.core';\nimport { DateTimeFormat } from 'main.date';\n\nimport { TextSm } from 'ui.system.typography.vue';\nimport { hint, type HintParams } from 'ui.vue3.directives.hint';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { UserLabel } from 'tasks.v2.component.elements.user-label';\nimport { tooltip } from 'tasks.v2.component.elements.hint';\nimport { timezone } from 'tasks.v2.lib.timezone';\nimport type { ElapsedTimeModel } from 'tasks.v2.model.elapsed-times';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport type { UserModel } from 'tasks.v2.model.users';\n\nimport { formatTime } from '../../lib/time-tracking-util';\n\nimport './time-tracking-list-item-view.css';\n\n// @vue/component\nexport const TimeTrackingListItemView = {\n\tname: 'TasksTimeTrackingListItemView',\n\tcomponents: {\n\t\tBIcon,\n\t\tTextSm,\n\t\tUserLabel,\n\t},\n\tdirectives: { hint },\n\tinject: {\n\t\ttask: {},\n\t},\n\tprops: {\n\t\telapsedId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['edit', 'remove'],\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisItemHovered: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\telapsedTime(): ElapsedTimeModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.ElapsedTimes}/getById`](this.elapsedId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.elapsedTime?.id);\n\t\t},\n\t\telapsedTimeDate(): string\n\t\t{\n\t\t\tconst format = this.loc('TASKS_V2_DATE_TIME_FORMAT', {\n\t\t\t\t'#DATE#': DateTimeFormat.getFormat('FORMAT_DATE'),\n\t\t\t\t'#TIME#': DateTimeFormat.getFormat('SHORT_TIME_FORMAT'),\n\t\t\t});\n\n\t\t\tconst createdAtMs = this.elapsedTime.createdAtTs * 1000;\n\t\t\tconst createdAt = new Date(createdAtMs + timezone.getOffset(createdAtMs));\n\n\t\t\treturn DateTimeFormat.format(format, createdAt);\n\t\t},\n\t\telapsedTimeTime(): string\n\t\t{\n\t\t\treturn formatTime(this.elapsedTime.seconds);\n\t\t},\n\t\tauthor(): ?UserModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.Users}/getById`](this.elapsedTime.userId);\n\t\t},\n\t\teditTooltip(): Function\n\t\t{\n\t\t\treturn (): HintParams => tooltip({\n\t\t\t\ttext: this.loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_ACTION_EDIT'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\toffsetLeft: this.$refs.edit.offsetWidth / 2,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tremoveTooltip(): Function\n\t\t{\n\t\t\treturn (): HintParams => tooltip({\n\t\t\t\ttext: this.loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_ACTION_REMOVE'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\toffsetLeft: this.$refs.remove.offsetWidth / 2,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"tasks-time-tracking-list-row --item\"\n\t\t\t@mouseover=\"isItemHovered = true\"\n\t\t\t@mouseleave=\"isItemHovered = false\"\n\t\t>\n\t\t\t<div class=\"tasks-time-tracking-list-item-view\">\n\t\t\t\t<div class=\"tasks-time-tracking-list-item-view-time\">\n\t\t\t\t\t<div class=\"tasks-time-tracking-list-column --date\">\n\t\t\t\t\t\t<TextSm>{{ elapsedTimeDate }}</TextSm>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-time-tracking-list-column --time\">\n\t\t\t\t\t\t<TextSm>{{ elapsedTimeTime }}</TextSm>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"tasks-time-tracking-list-column --author\">\n\t\t\t\t\t\t<UserLabel :user=\"author\"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"tasks-time-tracking-list-column --action\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"isItemHovered && elapsedTime.rights.edit && isEdit\"\n\t\t\t\t\t\t\tref=\"edit\" @click=\"$emit('edit')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon v-hint=\"editTooltip\" :name=\"Outline.EDIT_L\" hoverable/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"isItemHovered && elapsedTime.rights.remove && isEdit\"\n\t\t\t\t\t\t\tref=\"remove\" @click=\"$emit('remove')\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon v-hint=\"removeTooltip\" :name=\"Outline.TRASHCAN\" hoverable/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"this.elapsedTime.text\" class=\"tasks-time-tracking-list-item-view-text\">\n\t\t\t\t\t<TextSm>{{ this.elapsedTime.text }}</TextSm>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\n\nimport { Core } from 'tasks.v2.core';\nimport { Model } from 'tasks.v2.const';\nimport { highlighter } from 'tasks.v2.lib.highlighter';\nimport type { ElapsedTimeModel } from 'tasks.v2.model.elapsed-times';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { timeTrackingService } from 'tasks.v2.provider.service.time-tracking-service';\n\nimport { TimeTrackingListItemEdit } from './item/time-tracking-list-item-edit';\nimport { TimeTrackingListItemView } from './item/time-tracking-list-item-view';\n\n// @vue/component\nexport const TimeTrackingListItem = {\n\tname: 'TasksTimeTrackingListItem',\n\tcomponents: {\n\t\tTimeTrackingListItemEdit,\n\t\tTimeTrackingListItemView,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t},\n\tprops: {\n\t\telapsedId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\teditMode: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['save', 'edit', 'cancel'],\n\tsetup(): { task: TaskModel } {},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tlocalElapsedId: this.elapsedId,\n\t\t\tlocalEditMode: this.editMode,\n\t\t};\n\t},\n\tcomputed: {\n\t\telapsedTime(): ?ElapsedTimeModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.ElapsedTimes}/getById`](this.localElapsedId);\n\t\t},\n\t\tisEdit(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.elapsedTime?.id);\n\t\t},\n\t\tisTimeTrackingLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.timeTracking.available;\n\t\t},\n\t},\n\twatch: {\n\t\telapsedId(elapsedId: number | string): void\n\t\t{\n\t\t\tthis.localElapsedId = elapsedId;\n\t\t},\n\t\teditMode(value: boolean): void\n\t\t{\n\t\t\tthis.localEditMode = value;\n\t\t},\n\t},\n\tmethods: {\n\t\tasync handleSave(localElapsedTime: ElapsedTimeModel): Promise<void>\n\t\t{\n\t\t\tthis.localEditMode = false;\n\n\t\t\tthis.$emit('save');\n\n\t\t\tif (this.isEdit)\n\t\t\t{\n\t\t\t\tvoid highlighter.highlight(this.$refs.item);\n\n\t\t\t\tawait timeTrackingService.update(this.taskId, {\n\t\t\t\t\t...this.elapsedTime,\n\t\t\t\t\t...localElapsedTime,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.localElapsedId = await timeTrackingService.add(this.taskId, {\n\t\t\t\t\tid: this.elapsedId,\n\t\t\t\t\t...localElapsedTime,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\thandleEdit(): void\n\t\t{\n\t\t\tthis.$emit('edit', this.localElapsedId);\n\n\t\t\tthis.localEditMode = true;\n\t\t},\n\t\thandleCancel(): void\n\t\t{\n\t\t\tthis.localEditMode = false;\n\n\t\t\tthis.$emit('cancel');\n\t\t},\n\t\tremoveItem(): void\n\t\t{\n\t\t\tconst messageBox = MessageBox.create({\n\t\t\t\tmessage: this.loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_ACTION_REMOVE_CONFIRM'),\n\t\t\t\tokCaption: this.loc('TASKS_V2_TIME_TRACKING_SHEET_LIST_ACTION_REMOVE_CONFIRM_OK'),\n\t\t\t\tuseAirDesign: true,\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tcloseIcon: false,\n\t\t\t\t},\n\t\t\t\tonOk: () => {\n\t\t\t\t\tvoid timeTrackingService.delete(this.taskId, this.elapsedTime);\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t},\n\t\t\t\tonCancel: () => {\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t},\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t});\n\t\t\tmessageBox.show();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div ref=\"item\" class=\"tasks-time-tracking-list-item\">\n\t\t\t<template v-if=\"localEditMode\">\n\t\t\t\t<TimeTrackingListItemEdit\n\t\t\t\t\t:elapsedTimeCreatedAtTs=\"elapsedTime?.createdAtTs\"\n\t\t\t\t\t:elapsedTimeSeconds=\"elapsedTime?.seconds\"\n\t\t\t\t\t:elapsedTimeText=\"elapsedTime?.text\"\n\t\t\t\t\t@save=\"handleSave\"\n\t\t\t\t\t@cancel=\"handleCancel\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<TimeTrackingListItemView\n\t\t\t\t\t:elapsedId=\"localElapsedId\"\n\t\t\t\t\t@edit=\"handleEdit\"\n\t\t\t\t\t@remove=\"removeItem\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { BLine } from 'ui.system.skeleton.vue';\n\n// @vue/component\nexport const TimeTrackingListItemSkeleton = {\n\tcomponents: {\n\t\tBLine,\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-time-tracking-list-row --item tasks-time-tracking-list-item\">\n\t\t\t<div class=\"tasks-time-tracking-list-column --date\">\n\t\t\t\t<BLine :width=\"120\" :height=\"20\"/>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-time-tracking-list-column --time\">\n\t\t\t\t<BLine :width=\"60\" :height=\"20\"/>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-time-tracking-list-column --author\">\n\t\t\t\t<BLine :width=\"200\" :height=\"20\"/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\n\nimport { Model } from 'tasks.v2.const';\nimport { timeTrackingService } from 'tasks.v2.provider.service.time-tracking-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { TimeTrackingListEmpty } from './time-tracking-list-empty';\nimport { TimeTrackingListHeader } from './time-tracking-list-header';\nimport { TimeTrackingListItem } from './time-tracking-list-item';\nimport { TimeTrackingListItemSkeleton } from './time-tracking-list-item-skeleton';\n\nimport './time-tracking-list.css';\n\n// @vue/component\nexport const TimeTrackingList = {\n\tname: 'TasksTimeTrackingList',\n\tcomponents: {\n\t\tTimeTrackingListEmpty,\n\t\tTimeTrackingListHeader,\n\t\tTimeTrackingListItem,\n\t\tTimeTrackingListItemSkeleton,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t},\n\tprops: {\n\t\tnumbers: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tloading: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tsheetBindProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup(): { task: TaskModel } {},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tio: null,\n\t\t\tpageLoading: false,\n\t\t\tadding: false,\n\t\t\teditingElapsedId: null,\n\t\t};\n\t},\n\tcomputed: {\n\t\telapsedIds(): number[]\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.ElapsedTimes}/getIds`](this.taskId);\n\t\t},\n\t\taddBtnDisabled(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.loading\n\t\t\t\t|| this.adding\n\t\t\t\t|| Boolean(this.editingElapsedId)\n\t\t\t\t|| !this.task.rights.elapsedTime\n\t\t\t);\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-io-without-polyfill\n\t\tthis.io = new IntersectionObserver((entries) => {\n\t\t\tentries.forEach((entry) => {\n\t\t\t\tif (entry.isIntersecting && this.numbers > 19)\n\t\t\t\t{\n\t\t\t\t\tvoid timeTrackingService.list(this.taskId);\n\t\t\t\t\tthis.pageLoading = timeTrackingService.isLoading(this.taskId);\n\t\t\t\t}\n\t\t\t});\n\t\t}, { root: null, rootMargin: '0px', threshold: 0.1 });\n\n\t\tif (this.$refs && this.$refs.sentinel)\n\t\t{\n\t\t\tthis.io.observe(this.$refs.sentinel);\n\t\t}\n\t},\n\tbeforeUnmount()\n\t{\n\t\tif (this.io)\n\t\t{\n\t\t\tthis.io.disconnect();\n\t\t\tthis.io = null;\n\t\t}\n\t},\n\tmethods: {\n\t\thandleAdd(): void\n\t\t{\n\t\t\tthis.adding = true;\n\n\t\t\tthis.cancelEditing();\n\t\t},\n\t\thandleEdit(elapsedId: number): void\n\t\t{\n\t\t\tthis.adding = false;\n\n\t\t\tthis.editingElapsedId = elapsedId;\n\t\t},\n\t\tgenerateNewId(): string\n\t\t{\n\t\t\treturn Text.getRandom();\n\t\t},\n\t\tcancelAdding(): void\n\t\t{\n\t\t\tthis.adding = false;\n\n\t\t\tthis.cancelEditing();\n\t\t},\n\t\tcancelEditing(): void\n\t\t{\n\t\t\tthis.editingElapsedId = null;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-time-tracking-list\">\n\t\t\t<div class=\"tasks-time-tracking-list-header\">\n\t\t\t\t<TimeTrackingListHeader :empty=\"numbers === 0\" :addBtnDisabled @add=\"handleAdd\"/>\n\t\t\t</div>\n\t\t\t<div class=\"tasks-time-tracking-list-content\">\n\t\t\t\t<template v-if=\"numbers === 0 && !adding\">\n\t\t\t\t\t<TimeTrackingListEmpty @add=\"handleAdd\"/>\n\t\t\t\t</template>\n\t\t\t\t<template v-if=\"loading\">\n\t\t\t\t\t<TimeTrackingListItemSkeleton v-for=\"index in numbers\" :key=\"index\"/>\n\t\t\t\t</template>\n\t\t\t\t<template v-if=\"adding\">\n\t\t\t\t\t<TimeTrackingListItem\n\t\t\t\t\t\t:elapsedId=\"generateNewId()\"\n\t\t\t\t\t\teditMode\n\t\t\t\t\t\t@save=\"cancelAdding\"\n\t\t\t\t\t\t@edit=\"handleEdit\"\n\t\t\t\t\t\t@cancel=\"cancelAdding\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<template v-if=\"!loading\" v-for=\"elapsedId in elapsedIds\" :key=\"elapsedId\">\n\t\t\t\t\t<TimeTrackingListItem\n\t\t\t\t\t\t:elapsedId\n\t\t\t\t\t\t:editMode=\"editingElapsedId === elapsedId\"\n\t\t\t\t\t\t@edit=\"handleEdit\"\n\t\t\t\t\t\t@cancel=\"cancelEditing\"\n\t\t\t\t\t\t@save=\"cancelEditing\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<TimeTrackingListItemSkeleton v-if=\"pageLoading\"/>\n\t\t\t\t<div v-show=\"!loading && numbers > 19\" ref=\"sentinel\" style=\"height: 1px; width: 100%\"/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import type { PopupOptions } from 'main.popup';\n\nimport { Popup } from 'ui.vue3.components.popup';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.tooltip';\nimport 'ui.icon-set.outline';\n\nimport { UserAvatar } from 'tasks.v2.component.elements.user-avatar';\n\nimport { formatTime } from '../lib/time-tracking-util';\nimport './time-tracking-participants-popup.css';\n\n// @vue/component\nexport const TimeTrackingParticipantsPopup = {\n\tname: 'TasksTimeTrackingParticipantsPopup',\n\tcomponents: {\n\t\tBIcon,\n\t\tUserAvatar,\n\t\tPopup,\n\t},\n\tprops: {\n\t\tisShown: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: HTMLElement,\n\t\t\tdefault: () => null,\n\t\t},\n\t\tusers: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tcontribution: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['close'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tformatTime,\n\t\t};\n\t},\n\tcomputed: {\n\t\toptions(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tid: 'ui-user-avatar-list-more-popup',\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\tpadding: 18,\n\t\t\t\tmaxWidth: 320,\n\t\t\t\tmaxHeight: 240,\n\t\t\t\toffsetTop: 8,\n\t\t\t\toffsetLeft: -18,\n\t\t\t\ttargetContainer: document.body,\n\t\t\t};\n\t\t},\n\t},\n\tmethods: {\n\t\tclose(): void\n\t\t{\n\t\t\tthis.$emit('close');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Popup v-if=\"isShown\" :options @close=\"close\">\n\t\t\t<div class=\"tasks-time-tracking-list-users --popup\">\n\t\t\t\t<template v-for=\"user of users\" :key=\"user.id\">\n\t\t\t\t\t<div class=\"tasks-time-tracking-list-user-container\">\n\t\t\t\t\t\t<div class=\"tasks-time-tracking-list-user-inner\">\n\t\t\t\t\t\t\t<div :bx-tooltip-user-id=\"user.id\" bx-tooltip-context=\"b24\">\n\t\t\t\t\t\t\t\t<span class=\"tasks-time-tracking-list-user-image\">\n\t\t\t\t\t\t\t\t\t<UserAvatar :src=\"user.image\" :type=\"user.type\"/>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class=\"tasks-time-tracking-list-user-title\">{{ user.name }}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<span class=\"tasks-time-tracking-list-user-time\">\n\t\t\t\t\t\t\t\t\t{{ formatTime(contribution[user.id]) }}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<BIcon class=\"tasks-time-tracking-list-user-icon\" :name=\"Outline.TIMER\"/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</Popup>\n\t`,\n};\n","import { Type } from 'main.core';\n\nimport { formatTime } from '../lib/time-tracking-util';\n\nimport './time-tracking-timer.css';\n\n// @vue/component\nexport const TimeTrackingTimer = {\n\tname: 'TasksTimeTrackingTimer',\n\tprops: {\n\t\ttimeSpent: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0,\n\t\t\tvalidator: (value) => value >= 0,\n\t\t},\n\t\ttotalTime: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t},\n\t\tisRunning: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['update'],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tinternalCurrentTime: 0,\n\t\t\ttimer: null,\n\t\t\tinternalIsRunning: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\thasTotalTime(): boolean\n\t\t{\n\t\t\treturn !Type.isNil(this.totalTime) && this.totalTime > 0;\n\t\t},\n\t\tisTotalTimeExceeded(): boolean\n\t\t{\n\t\t\treturn this.hasTotalTime && this.internalCurrentTime > this.totalTime;\n\t\t},\n\t\tformattedCurrentTime(): string\n\t\t{\n\t\t\treturn formatTime(this.internalCurrentTime);\n\t\t},\n\t\tformattedTotalTime(): string\n\t\t{\n\t\t\treturn formatTime(this.totalTime);\n\t\t},\n\t\tcurrentTimeClass(): string\n\t\t{\n\t\t\tif (!this.internalIsRunning)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn '--running';\n\t\t},\n\t\ttotalTimeClass(): string\n\t\t{\n\t\t\tif (this.isTotalTimeExceeded)\n\t\t\t{\n\t\t\t\treturn '--exceeded';\n\t\t\t}\n\n\t\t\treturn '';\n\t\t},\n\t},\n\twatch: {\n\t\ttimeSpent: {\n\t\t\timmediate: true,\n\t\t\thandler(newVal): void\n\t\t\t{\n\t\t\t\tthis.internalCurrentTime = newVal;\n\t\t\t},\n\t\t},\n\t\tisRunning: {\n\t\t\timmediate: true,\n\t\t\thandler(newVal): void\n\t\t\t{\n\t\t\t\tif (newVal)\n\t\t\t\t{\n\t\t\t\t\tthis.startTimer();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.stopTimer();\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.stopTimer();\n\t},\n\tmethods: {\n\t\tstartTimer(): void\n\t\t{\n\t\t\tthis.stopTimer();\n\n\t\t\tthis.internalIsRunning = true;\n\n\t\t\tthis.timer = setInterval(() => {\n\t\t\t\tthis.internalCurrentTime++;\n\t\t\t\tthis.$emit('update', this.internalCurrentTime);\n\t\t\t}, 1000);\n\t\t},\n\t\tstopTimer(): void\n\t\t{\n\t\t\tthis.internalIsRunning = false;\n\n\t\t\tif (this.timer)\n\t\t\t{\n\t\t\t\tclearInterval(this.timer);\n\t\t\t\tthis.timer = null;\n\t\t\t}\n\t\t},\n\t\tsetTime(seconds): void\n\t\t{\n\t\t\tthis.internalCurrentTime = Math.max(0, Math.min(seconds, this.totalTime));\n\t\t\tthis.$emit('update', this.internalCurrentTime);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-task-time-tracking-timer\">\n\t\t\t<div class=\"tasks-task-time-tracking-timer-current\" :class=\"currentTimeClass\">\n\t\t\t\t{{ formattedCurrentTime }}\n\t\t\t</div>\n\t\t\t<div v-if=\"hasTotalTime\" class=\"tasks-task-time-tracking-timer-separator\"> / </div>\n\t\t\t<div v-if=\"hasTotalTime\" class=\"tasks-task-time-tracking-timer-total\" :class=\"totalTimeClass\">\n\t\t\t\t{{ formattedTotalTime }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { BLine } from 'ui.system.skeleton.vue';\nimport { Button as UiButton, AirButtonStyle, ButtonColor, ButtonIcon, ButtonSize } from 'ui.vue3.components.button';\nimport { HeadlineSm } from 'ui.system.typography.vue';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { BottomSheet } from 'tasks.v2.component.elements.bottom-sheet';\nimport { UserAvatarList } from 'tasks.v2.component.elements.user-avatar-list';\nimport { timeTrackingService } from 'tasks.v2.provider.service.time-tracking-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { TimeTrackingInvoiceHint } from '../hint/time-tracking-invoice-hint';\nimport { TimeTrackingList } from '../list/time-tracking-list';\nimport { TimeTrackingParticipantsPopup } from './time-tracking-paticipants-popup';\nimport { TaskTrackingPopup } from '../popup/time-tracking-popup';\nimport { TimeTrackingTimer } from '../timer/time-tracking-timer';\n\nimport './time-tracking-sheet.css';\n\n// @vue/component\nexport const TimeTrackingSheet = {\n\tname: 'TasksTimeTrackingSheet',\n\tcomponents: {\n\t\tBIcon,\n\t\tBLine,\n\t\tBottomSheet,\n\t\tHeadlineSm,\n\t\tUiButton,\n\t\tUserAvatarList,\n\t\tTimeTrackingInvoiceHint,\n\t\tTimeTrackingList,\n\t\tTimeTrackingParticipantsPopup,\n\t\tTaskTrackingPopup,\n\t\tTimeTrackingTimer,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t},\n\tprops: {\n\t\tsheetBindProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\ttimeSpent: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tisTimerRunning: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t},\n\temits: ['close'],\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tAirButtonStyle,\n\t\t\tButtonSize,\n\t\t\tButtonIcon,\n\t\t\tButtonColor,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tloading: true,\n\t\t\tisParticipantsLoading: true,\n\t\t\tisSettingsPopupShown: false,\n\t\t\tisParticipantsPopupShown: false,\n\t\t\tisSheetShown: false,\n\t\t\tisInvoiceHintShown: false,\n\t\t\tparticipants: [],\n\t\t\tcontribution: [],\n\t\t};\n\t},\n\tcomputed: {\n\t\tisTimeTrackingLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.timeTracking.available;\n\t\t},\n\t},\n\tasync mounted(): Promise<void>\n\t{\n\t\tif (this.task.numberOfElapsedTimes > 0)\n\t\t{\n\t\t\tvoid this.loadParticipants();\n\n\t\t\tawait timeTrackingService.list(this.taskId, { reset: true });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.isParticipantsLoading = false;\n\t\t}\n\n\t\tthis.loading = false;\n\t},\n\tmethods: {\n\t\thandleClosePopup(): void\n\t\t{\n\t\t\tthis.isSettingsPopupShown = false;\n\n\t\t\tif (!this.task.allowsTimeTracking)\n\t\t\t{\n\t\t\t\tthis.$emit('close');\n\t\t\t}\n\t\t},\n\t\thandleAvatarListClick(): void\n\t\t{\n\t\t\tif (this.participants.length > 1)\n\t\t\t{\n\t\t\t\tthis.isParticipantsPopupShown = true;\n\t\t\t}\n\t\t},\n\t\tasync loadParticipants(): Promise<void>\n\t\t{\n\t\t\tconst [participants, contribution] = await timeTrackingService.listParticipants(this.taskId);\n\n\t\t\tthis.participants = participants;\n\t\t\tthis.contribution = contribution;\n\n\t\t\tthis.isParticipantsLoading = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BottomSheet\n\t\t\tcustomClass=\"tasks-task-time-tracking-sheet\"\n\t\t\t:sheetBindProps\n\t\t\t@close=\"$emit('close')\"\n\t\t>\n\t\t\t<div class=\"tasks-task-time-tracking-sheet-container\">\n\t\t\t\t<div class=\"tasks-task-time-tracking-sheet-header\">\n\t\t\t\t\t<HeadlineSm>{{ loc('TASKS_V2_TIME_TRACKING_TITLE_SHEET') }}</HeadlineSm>\n\t\t\t\t\t<div class=\"tasks-task-time-tracking-sheet-header-icons\">\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tref=\"filterIcon\"\n\t\t\t\t\t\t\tv-if=\"task.rights.edit && !isTimeTrackingLocked\"\n\t\t\t\t\t\t\tclass=\"tasks-task-time-tracking-sheet-filter\"\n\t\t\t\t\t\t\t:name=\"Outline.FILTER_2_LINES\"\n\t\t\t\t\t\t\thoverable\n\t\t\t\t\t\t\t@click=\"isSettingsPopupShown = true\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\tclass=\"tasks-task-time-tracking-sheet-close\"\n\t\t\t\t\t\t\t:name=\"Outline.CROSS_L\"\n\t\t\t\t\t\t\thoverable\n\t\t\t\t\t\t\t@click=\"$emit('close')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-task-time-tracking-sheet-content\">\n\t\t\t\t\t<TimeTrackingList\n\t\t\t\t\t\t:numbers=\"Math.min(20, task.numberOfElapsedTimes)\"\n\t\t\t\t\t\t:loading\n\t\t\t\t\t\t:sheetBindProps\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"tasks-task-time-tracking-sheet-footer\">\n\t\t\t\t\t<div class=\"tasks-task-time-tracking-sheet-timer\">\n\t\t\t\t\t\t<div class=\"tasks-task-time-tracking-sheet-timer-label\">\n\t\t\t\t\t\t\t{{ loc('TASKS_V2_TIME_TRACKING_SHEET_TIMER_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<TimeTrackingTimer\n\t\t\t\t\t\t\t:timeSpent\n\t\t\t\t\t\t\t:totalTime=\"task.estimatedTime\"\n\t\t\t\t\t\t\t:isRunning=\"isTimerRunning\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"isParticipantsLoading\">\n\t\t\t\t\t\t<BLine :width=\"120\" :height=\"20\"/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-else-if=\"task.numberOfElapsedTimes > 0\"\n\t\t\t\t\t\tref=\"participants\"\n\t\t\t\t\t\tclass=\"tasks-task-time-tracking-sheet-users\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<UserAvatarList\n\t\t\t\t\t\t\t:users=\"participants\"\n\t\t\t\t\t\t\t:visibleAmount=\"5\"\n\t\t\t\t\t\t\t:withPopup=\"false\"\n\t\t\t\t\t\t\t@click=\"handleAvatarListClick\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<TimeTrackingParticipantsPopup\n\t\t\t\t\t\t\t:isShown=\"isParticipantsPopupShown\"\n\t\t\t\t\t\t\t:bindElement=\"$refs.participants\"\n\t\t\t\t\t\t\t:users=\"participants\"\n\t\t\t\t\t\t\t:contribution\n\t\t\t\t\t\t\t@close=\"isParticipantsPopupShown = false\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tref=\"invoiceBtn\"\n\t\t\t\t\t\tclass=\"tasks-task-time-tracking-sheet-invoice\"\n\t\t\t\t\t\t@mouseover=\"isInvoiceHintShown = true\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<UiButton\n\t\t\t\t\t\t\t:text=\"loc('TASKS_V2_TIME_TRACKING_SHEET_TIMER_BTN_INVOICE')\"\n\t\t\t\t\t\t\t:style=\"AirButtonStyle.OUTLINE_ACCENT_2\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.SMALL\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<TaskTrackingPopup\n\t\t\t\tv-if=\"isSettingsPopupShown\"\n\t\t\t\t:bindElement=\"$refs.filterIcon.$el\"\n\t\t\t\t:timeSpent\n\t\t\t\t@close=\"handleClosePopup\"\n\t\t\t/>\n\t\t\t<TimeTrackingInvoiceHint\n\t\t\t\tv-if=\"isInvoiceHintShown\"\n\t\t\t\t:bindElement=\"$refs.invoiceBtn\"\n\t\t\t\t@close=\"isInvoiceHintShown = false\"\n\t\t\t/>\n\t\t</BottomSheet>\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { TaskField } from 'tasks.v2.const';\n\nexport const timeTrackingMeta = Object.freeze({\n\tid: TaskField.TimeTracking,\n\ttitle: Loc.getMessage('TASKS_V2_TIME_TRACKING_TITLE'),\n});\n","import { Type } from 'main.core';\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { TextMd } from 'ui.system.typography.vue';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Model } from 'tasks.v2.const';\nimport { Core } from 'tasks.v2.core';\nimport { HoverPill } from 'tasks.v2.component.elements.hover-pill';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport type { TaskModel, TimerModel } from 'tasks.v2.model.tasks';\nimport { showLimit } from 'tasks.v2.lib.show-limit';\n\nimport { TaskTrackingPopup } from './popup/time-tracking-popup';\nimport { TimeTrackingSheet } from './sheet/time-tracking-sheet';\nimport { TimeTrackingTimer } from './timer/time-tracking-timer';\nimport { timeTrackingMeta } from './time-tracking-meta';\n\nimport './time-tracking.css';\n\n// @vue/component\nexport const TimeTracking = {\n\tname: 'TasksTimeTracking',\n\tcomponents: {\n\t\tBIcon,\n\t\tHoverPill,\n\t\tTextMd,\n\t\tTaskTrackingPopup,\n\t\tTimeTrackingSheet,\n\t\tTimeTrackingTimer,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\tisEdit: {},\n\t\tisTemplate: {},\n\t},\n\tprops: {\n\t\tisSheetShown: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tsheetBindProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:isSheetShown'],\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\ttimeTrackingMeta,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisPopupShown: false,\n\t\t\tlocalTimeSpent: 0,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t}),\n\t\ttimer(): ?TimerModel\n\t\t{\n\t\t\treturn this.task.timers?.find((timer: TimerModel) => timer.userId === this.currentUserId);\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn this.isTemplate || !this.isEdit;\n\t\t},\n\t\ttimeSpent(): number\n\t\t{\n\t\t\tconst currentTs = Math.floor(Date.now() / 1000);\n\t\t\tconst timerStartedTs = this.timer?.startedAtTs ?? 0;\n\n\t\t\tconst timeSpent = (\n\t\t\t\ttimerStartedTs === 0\n\t\t\t\t\t? this.task.timeSpent\n\t\t\t\t\t: this.task.timeSpent + currentTs - timerStartedTs\n\t\t\t);\n\n\t\t\treturn Type.isNumber(timeSpent) ? timeSpent : 0;\n\t\t},\n\t\tisLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.timeElapsed.available;\n\t\t},\n\t\tisTimeTrackingLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.timeTracking.available;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isLocked)\n\t\t\t{\n\t\t\t\tvoid showLimit({ featureId: Core.getParams().restrictions.timeElapsed.featureId });\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.readonly)\n\t\t\t{\n\t\t\t\tthis.setSheetShown(true);\n\t\t\t}\n\t\t},\n\t\thandleClosePopup(): void\n\t\t{\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tthis.highlightField();\n\t\t},\n\t\thandleTimerUpdate(currentTime: number): void\n\t\t{\n\t\t\tthis.localTimeSpent = currentTime;\n\t\t},\n\t\tsetSheetShown(isShown: boolean): void\n\t\t{\n\t\t\tthis.$emit('update:isSheetShown', isShown);\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(timeTrackingMeta.id);\n\t\t},\n\t\thandleSettingsClick(): void\n\t\t{\n\t\t\tif (this.isTimeTrackingLocked)\n\t\t\t{\n\t\t\t\tvoid showLimit({ featureId: Core.getParams().restrictions.timeTracking.featureId });\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isPopupShown = true;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-task-time-tracking\" :data-task-field-id=\"timeTrackingMeta.id\">\n\t\t\t<HoverPill\n\t\t\t\tref=\"timer\"\n\t\t\t\t:withSettings=\"task.rights.edit && !isTimeTrackingLocked\"\n\t\t\t\t:readonly\n\t\t\t\t@click=\"handleClick\"\n\t\t\t\t@settings=\"handleSettingsClick\"\n\t\t\t>\n\t\t\t\t<BIcon class=\"tasks-task-time-tracking-icon\" :name=\"Outline.TIMER\"/>\n\t\t\t\t<TimeTrackingTimer\n\t\t\t\t\t:timeSpent\n\t\t\t\t\t:totalTime=\"task.estimatedTime\"\n\t\t\t\t\t:isRunning=\"Boolean(timer)\"\n\t\t\t\t\t@update=\"handleTimerUpdate\"\n\t\t\t\t/>\n\t\t\t</HoverPill>\n\t\t</div>\n\t\t<TaskTrackingPopup\n\t\t\tv-if=\"isPopupShown\"\n\t\t\t:bindElement=\"$refs.timer.$el\"\n\t\t\t:timeSpent\n\t\t\t@close=\"handleClosePopup\"\n\t\t/>\n\t\t<TimeTrackingSheet\n\t\t\tv-if=\"isSheetShown\"\n\t\t\t:sheetBindProps\n\t\t\t:timeSpent\n\t\t\t:isTimerRunning=\"Boolean(timer)\"\n\t\t\t@close=\"setSheetShown(false)\"\n\t\t/>\n\t`,\n};\n","import { Type } from 'main.core';\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { Chip, ChipDesign } from 'ui.system.chip.vue';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Core } from 'tasks.v2.core';\nimport { Model } from 'tasks.v2.const';\nimport { fieldHighlighter } from 'tasks.v2.lib.field-highlighter';\nimport type { TaskModel, TimerModel } from 'tasks.v2.model.tasks';\nimport { showLimit } from 'tasks.v2.lib.show-limit';\n\nimport { TaskTrackingPopup } from './popup/time-tracking-popup';\nimport { TimeTrackingSheet } from './sheet/time-tracking-sheet';\nimport { timeTrackingMeta } from './time-tracking-meta';\n\n// @vue/component\nexport const TimeTrackingChip = {\n\tcomponents: {\n\t\tChip,\n\t\tTaskTrackingPopup,\n\t\tTimeTrackingSheet,\n\t},\n\tinject: {\n\t\ttask: {},\n\t\ttaskId: {},\n\t\tisEdit: {},\n\t\tisTemplate: {},\n\t},\n\tprops: {\n\t\tisSheetShown: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tsheetBindProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['update:isSheetShown'],\n\tsetup(): { task: TaskModel }\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\ttimeTrackingMeta,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisPopupShown: false,\n\t\t\tlocalTimeSpent: 0,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\tcurrentUserId: `${Model.Interface}/currentUserId`,\n\t\t}),\n\t\ttimer(): ?TimerModel\n\t\t{\n\t\t\treturn this.task.timers?.find((timer: TimerModel) => timer.userId === this.currentUserId);\n\t\t},\n\t\tdesign(): string\n\t\t{\n\t\t\treturn this.isSelected ? ChipDesign.ShadowAccent : ChipDesign.ShadowNoAccent;\n\t\t},\n\t\tisSelected(): boolean\n\t\t{\n\t\t\treturn this.task.allowsTimeTracking || this.task.numberOfElapsedTimes;\n\t\t},\n\t\treadonly(): boolean\n\t\t{\n\t\t\treturn this.isTemplate || !this.isEdit;\n\t\t},\n\t\tisLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.timeElapsed.available;\n\t\t},\n\t\tisTimeTrackingLocked(): boolean\n\t\t{\n\t\t\treturn !Core.getParams().restrictions.timeTracking.available;\n\t\t},\n\t},\n\tcreated(): void\n\t{\n\t\tconst currentTs = Math.floor(Date.now() / 1000);\n\t\tconst timerStartedTs = this.timer?.startedAtTs ?? 0;\n\n\t\tconst localTimeSpent = (\n\t\t\ttimerStartedTs === 0\n\t\t\t\t? this.task.timeSpent\n\t\t\t\t: this.task.timeSpent + currentTs - timerStartedTs\n\t\t);\n\n\t\tthis.localTimeSpent = Type.isNumber(localTimeSpent) ? localTimeSpent : 0;\n\t},\n\tmethods: {\n\t\thandleClick(): void\n\t\t{\n\t\t\tif (this.isLocked)\n\t\t\t{\n\t\t\t\tvoid showLimit({\n\t\t\t\t\tfeatureId: Core.getParams().restrictions.timeElapsed.featureId,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.canOnlyAddFirstElapsedTime())\n\t\t\t{\n\t\t\t\tthis.setSheetShown(true);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isSelected)\n\t\t\t{\n\t\t\t\tthis.highlightField();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isTimeTrackingLocked)\n\t\t\t{\n\t\t\t\tvoid showLimit({\n\t\t\t\t\tfeatureId: Core.getParams().restrictions.timeTracking.featureId,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isPopupShown = true;\n\t\t},\n\t\thandleClosePopup(): void\n\t\t{\n\t\t\tthis.isPopupShown = false;\n\n\t\t\tthis.highlightField();\n\t\t},\n\t\tsetSheetShown(isShown: boolean): void\n\t\t{\n\t\t\tthis.$emit('update:isSheetShown', isShown);\n\t\t},\n\t\thighlightField(): void\n\t\t{\n\t\t\tvoid fieldHighlighter.setContainer(this.$root.$el).highlight(timeTrackingMeta.id);\n\t\t},\n\t\tcanOnlyAddFirstElapsedTime(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\t(!this.task.rights.edit || this.isTimeTrackingLocked)\n\t\t\t\t&& this.task.rights.elapsedTime\n\t\t\t\t&& !this.task.numberOfElapsedTimes\n\t\t\t\t&& !this.readonly\n\t\t\t);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\tv-if=\"isSelected || task.rights.elapsedTime\"\n\t\t\tref=\"chip\"\n\t\t\t:design\n\t\t\t:icon=\"Outline.TIMER\"\n\t\t\t:text=\"loc('TASKS_V2_TIME_TRACKING_CHIP_TITLE')\"\n\t\t\t:lock=\"isLocked\"\n\t\t\t:data-task-id=\"taskId\"\n\t\t\t:data-task-chip-id=\"timeTrackingMeta.id\"\n\t\t\t@click=\"handleClick\"\n\t\t/>\n\t\t<TaskTrackingPopup\n\t\t\tv-if=\"isPopupShown\"\n\t\t\t:bindElement=\"$refs.chip.$el\"\n\t\t\t:timeSpent=\"localTimeSpent\"\n\t\t\t@close=\"handleClosePopup\"\n\t\t/>\n\t\t<TimeTrackingSheet\n\t\t\tv-if=\"isSheetShown\"\n\t\t\t:sheetBindProps\n\t\t\t:timeSpent=\"localTimeSpent\"\n\t\t\t:isTimerRunning=\"Boolean(timer)\"\n\t\t\t@close=\"setSheetShown(false)\"\n\t\t/>\n\t`,\n};\n"],"names":["TaskTrackingPopup","name","components","BIcon","BInput","Popup","Switcher","TextMd","TextSm","TextXs","Text2Xl","inject","task","taskId","props","bindElement","type","HTMLElement","default","timeSpent","Number","required","emits","setup","InputDesign","Outline","data","localAllowsTimeTracking","localEstimatedTime","computed","mapGetters","currentUserId","Model","Interface","options","id","className","width","targetContainer","document","body","switcherOptions","size","SwitcherSize","small","useAirDesign","timer","timers","find","userId","hours","get","hour","Math","floor","String","set","value","parseInt","Type","isNumber","abs","minutes","save","created","estimatedTime","methods","handleClose","$emit","toggleAllows","rights","edit","allowsTimeTracking","freeze","messageBox","MessageBox","create","message","loc","title","okCaption","cancelCaption","popupOptions","height","closeIcon","onOk","close","unfreeze","onCancel","buttons","MessageBoxButtons","OK_CANCEL","show","$bitrix","eventEmitter","emit","EventName","TimeTrackingChange","taskService","update","statusService","pauseTimer","openHelpDesk","top","BX","Helper","$refs","popup","template","TimeTrackingInvoiceHint","Hint","TimeTrackingListEmpty","HeadlineXs","UiButton","AirButtonStyle","ButtonSize","TimeTrackingListHeader","Text2Xs","empty","Boolean","addBtnDisabled","TimeTrackingListItemEdit","elapsedTimeCreatedAtTs","elapsedTimeSeconds","elapsedTimeText","ButtonIcon","ButtonColor","isCalendarShown","localCreatedAt","localSeconds","localText","text","watch","datePicker","hide","createdDate","getCreatedDate","Date","getTime","timezone","getOffset","mounted","createDatePicker","unmounted","destroy","selectedDateTs","DatePicker","Text","getRandom","calendarInput","$el","bindOptions","forceBindPosition","events","onClose","selectedDates","enableTime","DatePickerEvent","SELECT","event","date","getData","calendar","createDateFromUtc","formatDate","format","DateTimeFormat","getFormat","offset","createdAtTs","seconds","source","remove","formatTime","secs","toString","padStart","join","TimeTrackingListItemView","UserLabel","directives","hint","elapsedId","isItemHovered","elapsedTime","$store","getters","ElapsedTimes","isEdit","elapsedTimeDate","createdAtMs","createdAt","elapsedTimeTime","author","Users","editTooltip","tooltip","offsetLeft","offsetWidth","removeTooltip","TimeTrackingListItem","editMode","localElapsedId","localEditMode","isTimeTrackingLocked","Core","getParams","restrictions","timeTracking","available","handleSave","localElapsedTime","highlighter","highlight","item","timeTrackingService","add","handleEdit","handleCancel","removeItem","delete","TimeTrackingListItemSkeleton","BLine","TimeTrackingList","numbers","loading","sheetBindProps","Object","io","pageLoading","adding","editingElapsedId","elapsedIds","IntersectionObserver","entries","forEach","entry","isIntersecting","list","isLoading","root","rootMargin","threshold","sentinel","observe","beforeUnmount","disconnect","handleAdd","cancelEditing","generateNewId","cancelAdding","TimeTrackingParticipantsPopup","UserAvatar","isShown","users","Array","contribution","padding","maxWidth","maxHeight","offsetTop","TimeTrackingTimer","validator","totalTime","isRunning","internalCurrentTime","internalIsRunning","hasTotalTime","isNil","isTotalTimeExceeded","formattedCurrentTime","formattedTotalTime","currentTimeClass","totalTimeClass","immediate","handler","newVal","startTimer","stopTimer","setInterval","clearInterval","setTime","max","min","TimeTrackingSheet","BottomSheet","HeadlineSm","UserAvatarList","isTimerRunning","isParticipantsLoading","isSettingsPopupShown","isParticipantsPopupShown","isSheetShown","isInvoiceHintShown","participants","numberOfElapsedTimes","loadParticipants","reset","handleClosePopup","handleAvatarListClick","length","listParticipants","timeTrackingMeta","TaskField","TimeTracking","Loc","getMessage","HoverPill","isTemplate","isPopupShown","localTimeSpent","readonly","currentTs","now","timerStartedTs","startedAtTs","isLocked","timeElapsed","handleClick","showLimit","featureId","setSheetShown","highlightField","handleTimerUpdate","currentTime","fieldHighlighter","setContainer","$root","handleSettingsClick","TimeTrackingChip","Chip","design","isSelected","ChipDesign","ShadowAccent","ShadowNoAccent","canOnlyAddFirstElapsedTime"],"mappings":"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"}