this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,a,n,d,o,l,h,r,c,k){"use strict";const m={name:"TaskRelationTasks",components:{BIcon:i.BIcon,TaskList:o.TaskList,TextMd:s.TextMd},directives:{hint:e.hint},inject:{task:{},taskId:{},isEdit:{},isTemplate:{}},props:{meta:{type:Object,required:true},fields:{type:Set,default:undefined},isLocked:{type:Boolean,default:false},featureId:{type:String,default:""}},emits:["add"],setup(){return{Outline:i.Outline}},data(){return{idsLoaded:false}},computed:{ids(){return this.meta.service.getSortedIds(this.task[this.meta.idsField])},loadingIds(){return this.ids.filter((t=>!this.meta.service.hasStoreTask(t)))},text(){if(this.ids.length>0){return this.loc(this.meta.getCountLoc(this.isTemplate),{"#COUNT#":this.ids.length})}return this.meta.getTitle(this.isTemplate)},canOpenMore(){return this.isEdit&&(this.readonly||this.task[this.meta.containsField])},readonly(){return!this.task.rights[this.meta.right]},tooltip(){return()=>l.tooltip({text:this.meta.getHint(this.isTemplate),popupOptions:{offsetLeft:this.$refs.add.offsetWidth/2}})}},watch:{ids(t,e){if([...t||[]].sort().join(",")===[...e||[]].sort().join(",")){return}if(this.meta.service.hasUnloadedIds(this.taskId)){void this.meta.service.list(this.taskId)}}},async created(){this.idsLoaded=this.meta.service.areIdsLoaded(this.taskId);if(!this.idsLoaded||this.meta.service.hasUnloadedIds(this.taskId)){await this.meta.service.list(this.taskId,true)}this.idsLoaded=true},methods:{openMore(){if(!this.canOpenMore){return}if(this.isLocked){this.showLimit();return}const t=n.Core.getParams().currentUser.id;const e=h.idUtils.isTemplate(this.taskId);const s={[this.meta.id===d.TaskField.SubTasks]:"subTasks",[this.meta.id===d.TaskField.RelatedTasks]:"relatedTasks",[this.meta.id===d.TaskField.RelatedTasks&&e]:"relatedTemplateTasks",[this.meta.id===d.TaskField.Gantt]:"gantt"}.true;const i={[this.meta.id===d.TaskField.SubTasks&&e]:"subTemplates"}.true;const a={[Boolean(s)]:`/company/personal/user/${t}/tasks/`,[Boolean(i)]:`/company/personal/user/${t}/tasks/templates/`}.true;const o=s!=null?s:i;const l=h.idUtils.unbox(this.taskId);const r=new URLSearchParams({relationToId:l,relationType:o});BX.SidePanel.Instance.open(`${a}?${r}`,{newWindowLabel:false,copyLinkLabel:false})},showLimit(){void c.showLimit({featureId:this.featureId})},async handleRemove(t){await this.meta.service.delete(this.taskId,[t])}},template:`\n\t\t<div\n\t\t\tclass="tasks-field-relation-tasks"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="meta.id"\n\t\t>\n\t\t\t<div class="tasks-field-relation-tasks-title">\n\t\t\t\t<div\n\t\t\t\t\tclass="tasks-field-relation-tasks-main"\n\t\t\t\t\t:class="{ '--readonly': !canOpenMore }"\n\t\t\t\t\tdata-task-relation-open\n\t\t\t\t\t@click="openMore"\n\t\t\t\t>\n\t\t\t\t\t<BIcon :name="meta.icon"/>\n\t\t\t\t\t<TextMd accent>{{ text }}</TextMd>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tv-if="!readonly && idsLoaded && !isLocked" \n\t\t\t\t\tv-hint="tooltip" \n\t\t\t\t\tclass="tasks-field-relation-tasks-icon --add" \n\t\t\t\t\tref="add"\n\t\t\t\t>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="Outline.PLUS_L"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\t:data-task-relation-add="meta.id"\n\t\t\t\t\t\t@click="$emit('add', $refs.add)"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tv-else-if="isLocked"\n\t\t\t\t\tclass="tasks-field-relation-tasks-icon --lock"\n\t\t\t\t>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="Outline.LOCK_L"\n\t\t\t\t\t\thoverable\n\t\t\t\t\t\t:data-task-relation-locked="meta.id"\n\t\t\t\t\t\t@click="showLimit"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<TaskList\n\t\t\t\tv-if="task[meta.containsField]"\n\t\t\t\t:ids\n\t\t\t\t:loadingIds\n\t\t\t\t:fields\n\t\t\t\t:canOpenMore\n\t\t\t\t@openMore="openMore"\n\t\t\t\t@removeTask="handleRemove"\n\t\t\t/>\n\t\t</div>\n\t`};const p={components:{Chip:r.Chip},inject:{task:{},taskId:{},isTemplate:{}},props:{meta:{type:Object,required:true},disabled:{type:Boolean,default:false},isLocked:{type:Boolean,default:false},featureId:{type:String,default:""}},emits:["add"],setup(){},computed:{count(){return this.task[this.meta.idsField].length},design(){if(this.disabled){return r.ChipDesign.ShadowDisabled}return this.isSelected?r.ChipDesign.ShadowAccent:r.ChipDesign.ShadowNoAccent},isSelected(){return this.task.filledFields[this.meta.id]}},methods:{handleClick(){if(this.disabled){return}if(this.isSelected){this.highlightField();return}if(this.isLocked){void c.showLimit({featureId:this.featureId});return}this.$emit("add",this.$el)},highlightField(){void k.fieldHighlighter.setContainer(this.$root.$el).highlight(this.meta.id)}},template:`\n\t\t<Chip\n\t\t\t:design\n\t\t\t:text="meta.getChipTitle(isTemplate)"\n\t\t\t:icon="meta.icon"\n\t\t\t:lock="isLocked"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="meta.id"\n\t\t\t@click="handleClick"\n\t\t/>\n\t`};t.RelationTasks=m;t.RelationTasksChip=p})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.Vue3.Directives,BX.UI.System.Typography.Vue,BX.UI.IconSet,BX,BX.Tasks.V2,BX.Tasks.V2.Const,BX.Tasks.V2.Component,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.UI.System.Chip.Vue,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib);
//# sourceMappingURL=relation-tasks.bundle.map.js