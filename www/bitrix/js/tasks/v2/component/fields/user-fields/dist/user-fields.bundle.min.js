this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,n,a,r,l,d,o,u,c){"use strict";const h={components:{TextMd:s.TextMd,TextXs:s.TextXs},props:{title:{type:String,required:true},value:{type:[String,Array],default:""},mandatory:{type:Boolean,default:false},isLast:{type:Boolean,default:false}},computed:{values(){if(a.Type.isArrayFilled(this.value)){return this.value.map((t=>String(t)))}return[String(this.value)]}},template:`\n\t\t<div\n\t\t\tclass="tasks-user-field --string"\n\t\t\t:class="{ '--last': isLast }"\n\t\t>\n\t\t\t<TextXs\n\t\t\t\tclass="tasks-user-field-title"\n\t\t\t\t:class="{ '--mandatory': mandatory }"\n\t\t\t>\n\t\t\t\t{{ title }}\n\t\t\t</TextXs>\n\t\t\t<div v-for="(item, index) in values" :key="index" class="tasks-user-field-value">\n\t\t\t\t<TextMd>{{ item }}</TextMd>\n\t\t\t</div>\n\t\t</div>\n\t`};const f={components:{TextMd:s.TextMd,TextXs:s.TextXs},props:{title:{type:String,required:true},value:{type:[Number,String,Array],default:0},mandatory:{type:Boolean,default:false},isLast:{type:Boolean,default:false}},computed:{values(){if(a.Type.isArrayFilled(this.value)){return this.value.map((t=>this.prepareValue(t)))}return[this.prepareValue(this.value)]}},methods:{prepareValue(t){const e=parseInt(String(t),10);if(Number.isNaN(e)){return"0"}return String(e)}},template:`\n\t\t<div\n\t\t\tclass="tasks-user-field --double"\n\t\t\t:class="{ '--last': isLast }"\n\t\t>\n\t\t\t<TextXs\n\t\t\t\tclass="tasks-user-field-title"\n\t\t\t\t:class="{ '--mandatory': mandatory }"\n\t\t\t>\n\t\t\t\t{{ title }}\n\t\t\t</TextXs>\n\t\t\t<div v-for="(item, index) in values" :key="index" class="tasks-user-field-value">\n\t\t\t\t<TextMd>{{ item }}</TextMd>\n\t\t\t</div>\n\t\t</div>\n\t`};const p={components:{TextMd:s.TextMd,TextXs:s.TextXs,Checkbox:e.Checkbox},props:{title:{type:String,required:true},value:{type:[Boolean,String],default:false},mandatory:{type:Boolean,default:false},isLast:{type:Boolean,default:false}},computed:{preparedValue(){if(a.Type.isString(this.value)){return this.value==="1"}return this.value===true},mandatoryClass(){return this.mandatory?"tasks-user-field-value-mandatory":""}},template:`\n\t\t<div\n\t\t\tclass="tasks-user-field --boolean"\n\t\t\t:class="{ '--last': isLast }"\n\t\t>\n\t\t\t<div class="tasks-user-field-boolean-row">\n\t\t\t\t<Checkbox :checked="preparedValue" disabled/>\n\t\t\t\t<TextMd :className="mandatoryClass">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</TextMd>\n\t\t\t</div>\n\t\t</div>\n\t`};var m=babelHelpers.classPrivateFieldLooseKey("convertDatetimeValue");var T=babelHelpers.classPrivateFieldLooseKey("formatDatetime");var F=babelHelpers.classPrivateFieldLooseKey("isValidDate");class y{constructor(){Object.defineProperty(this,F,{value:S});Object.defineProperty(this,T,{value:k});Object.defineProperty(this,m,{value:v})}getPreparedUserFields(t,e){const s=[];for(const i of t){if(i.value===null){continue}const t=e.find((t=>t.fieldName===i.key));if(t){if(!this.validateField(i.value,t.userTypeId)){continue}s.push({value:i.value,title:t.editFormLabel,type:t.userTypeId,mandatory:t.mandatory})}}return s}validateField(t,e){if(t===null||t===""){return false}if(a.Type.isArray(t)&&t.length===0){return false}if(a.Type.isArray(t)&&t.every((t=>t===""))){return false}return!(e!==u.UserFieldType.Boolean&&t===false)}hasFilledUserFields(t,e){return this.getPreparedUserFields(t,e).length>0}hasUnfilledFields(t,e){for(const s of e){const e=t.find((t=>t.key===s.fieldName));if(!e||e.value===null){return true}}return false}hasUnfilledMandatoryFields(t,e){for(const s of e){if(!s.mandatory){continue}const e=t.find((t=>t.key===s.fieldName));if(!e||e.value===null){return true}}return false}hasMandatoryUserFields(t){for(const e of t){if(e.mandatory){return true}}return false}prepareUserFieldsForTaskFromTemplate(t,e){const s=[];for(const i of t){const t=e.find((t=>t.fieldName===i.key));if(!t){s.push(i);continue}if(t.userTypeId===u.UserFieldType.Datetime){const t={key:i.key,value:babelHelpers.classPrivateFieldLooseBase(this,m)[m](i.value)};s.push(t)}else{s.push(i)}}return s}correctDatetimeStringWithT(t,e){const s=t.match(/([+-]\d{2}):(\d{2})$/);const i=s?parseInt(s[1],10)*60+(parseInt(s[1],10)<0?-1:1)*parseInt(s[2],10):0;const n=i+e.getTimezoneOffset();e.setTime(e.getTime()+n*6e4);return e}}function v(t){if(t===null||t===""){return t}if(a.Type.isArray(t)){return t.map((t=>babelHelpers.classPrivateFieldLooseBase(this,T)[T](t)))}return babelHelpers.classPrivateFieldLooseBase(this,T)[T](t)}function k(t){if(!a.Type.isStringFilled(t)){return t}if(!t.includes("T")){return t}const e=new Date(t);if(!babelHelpers.classPrivateFieldLooseBase(this,F)[F](e)){return t}const s=this.correctDatetimeStringWithT(t,e);const i=n.DateTimeFormat.getFormat("FORMAT_DATETIME");const r=s.getTime()/1e3;return n.DateTimeFormat.format(i,r)}function S(t){return a.Type.isDate(t)&&!Number.isNaN(t.getTime())}const M=new y;const g={components:{TextMd:s.TextMd,TextXs:s.TextXs,BIcon:d.BIcon},props:{title:{type:String,required:true},value:{type:[String,Array],default:""},mandatory:{type:Boolean,default:false},isLast:{type:Boolean,default:false}},session:undefined,setup(){return{Outline:d.Outline}},computed:{values(){if(a.Type.isArrayFilled(this.value)){return this.value.map((t=>this.formatDate(t)))}return[this.formatDate(this.value)]}},methods:{formatDate(t){const e=this.tryParseDate(t);if(!e){return t}return i.calendar.formatDateTime(e.getTime(),{removeOffset:true})},tryParseDate(t){if(t.includes("T")){const e=new Date(t);if(!this.isDate(e)){return null}return M.correctDatetimeStringWithT(t,e)}const e=n.DateTimeFormat.parse(t);if(this.isDate(e)){return e}return null},isDate(t){return a.Type.isDate(t)&&!Number.isNaN(t.getTime())}},template:`\n\t\t<div\n\t\t\tclass="tasks-user-field --date"\n\t\t\t:class="{ '--last': isLast }"\n\t\t>\n\t\t\t<TextXs\n\t\t\t\tclass="tasks-user-field-title"\n\t\t\t\t:class="{ '--mandatory': mandatory }"\n\t\t\t>\n\t\t\t\t{{ title }}\n\t\t\t</TextXs>\n\t\t\t<template v-for="(item, index) in values" :key="index">\n\t\t\t\t<div class="tasks-user-field-date-row">\n\t\t\t\t\t<BIcon :name="Outline.CALENDAR_WITH_SLOTS"/>\n\t\t\t\t\t<TextMd>{{ item }}</TextMd>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const U=Object.freeze({id:u.TaskField.UserFields,title:a.Loc.getMessage("TASKS_V2_USER_FIELDS_TITLE")});const x={components:{BIcon:d.BIcon,TextMd:s.TextMd,TextXs:s.TextXs},inject:{task:{},taskId:{},isTemplate:{}},emits:["open"],setup(){return{Outline:d.Outline,userFieldsMeta:U}},data(){return{isMouseDown:false,selectionMade:false}},computed:{...r.mapGetters({taskUserFieldScheme:`${u.Model.Interface}/taskUserFieldScheme`,templateUserFieldScheme:`${u.Model.Interface}/templateUserFieldScheme`}),userFields(){return this.task.userFields||[]},readonly(){return!this.task.rights.edit},userFieldScheme(){return this.isTemplate?this.templateUserFieldScheme:this.taskUserFieldScheme},preparedUserFields(){return M.getPreparedUserFields(this.userFields,this.userFieldScheme)},preparedUserFieldsLength(){return this.preparedUserFields.length},hasUnfilledFields(){return M.hasUnfilledFields(this.userFields,this.userFieldScheme)},hasUnfilledMandatoryFields(){return M.hasUnfilledMandatoryFields(this.userFields,this.userFieldScheme)},footerText(){return this.hasUnfilledMandatoryFields?this.loc("TASKS_V2_USER_FIELDS_NOT_FILLED_MANDATORY_FIELDS"):this.loc("TASKS_V2_USER_FIELDS_NOT_FILLED_FIELDS")}},methods:{handleOpenSlider(){if(this.readonly){return}this.$emit("open")},getComponentName(t){return{[u.UserFieldType.String]:h,[u.UserFieldType.Double]:f,[u.UserFieldType.Boolean]:p,[u.UserFieldType.Datetime]:g}[t]},onMouseDown(t){if(t.button===0){this.isMouseDown=true;this.selectionMade=false}},onMouseMove(){if(this.selectionMade||this.opened){return}if(this.isMouseDown){const t=window.getSelection();if(t.toString().length>0){this.selectionMade=true}}},onMouseUp(t){this.isMouseDown=false;if(!this.selectionMade){const e=t.target;const s=e.tagName==="A"||e.closest("a");if(!s){this.handleOpenSlider()}}}},template:`\n\t\t<div\n\t\t\tclass="tasks-field-user-fields"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-field-id="userFieldsMeta.id"\n\t\t\t@mousedown="onMouseDown"\n\t\t\t@mousemove="onMouseMove"\n\t\t\t@mouseup="onMouseUp"\n\t\t>\n\t\t\t<div\n\t\t\t\tclass="tasks-field-user-fields-title"\n\t\t\t\t:class="{\n\t\t\t\t\t'--readonly': readonly,\n\t\t\t\t\t'--border-radius': preparedUserFieldsLength === 0,\n\t\t\t\t}"\n\t\t\t>\n\t\t\t\t<BIcon\n\t\t\t\t\tclass="tasks-field-user-fields-title-icon"\n\t\t\t\t\t:name="Outline.TOPIC"\n\t\t\t\t/>\n\t\t\t\t<TextMd accent>{{ userFieldsMeta.title }}</TextMd>\n\t\t\t</div>\n\t\t\t<template\n\t\t\t\tv-for="(field, index) in preparedUserFields"\n\t\t\t\t:key="index"\n\t\t\t>\n\t\t\t\t<component\n\t\t\t\t\t:is="getComponentName(field.type)"\n\t\t\t\t\t:title="field.title"\n\t\t\t\t\t:value="field.value"\n\t\t\t\t\t:mandatory="field.mandatory"\n\t\t\t\t\t:isLast="index === preparedUserFieldsLength - 1"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<div\n\t\t\t\tv-if="!readonly && hasUnfilledFields"\n\t\t\t\tclass="tasks-field-user-fields-footer"\n\t\t\t>\n\t\t\t\t<TextXs className="tasks-field-user-fields-footer-text">\n\t\t\t\t\t{{ footerText }}\n\t\t\t\t</TextXs>\n\t\t\t\t<div class="tasks-field-user-fields-footer-fill">\n\t\t\t\t\t<TextXs className="tasks-field-user-fields-footer-fill-text">\n\t\t\t\t\t\t{{ loc('TASKS_V2_USER_FIELDS_FILL') }}\n\t\t\t\t\t</TextXs>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\tclass="tasks-field-user-fields-footer-fill-icon"\n\t\t\t\t\t\t:name="Outline.CHEVRON_RIGHT_L"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const D={components:{Chip:l.Chip},inject:{task:{},taskId:{},isEdit:{},isTemplate:{}},emits:["open"],setup(){return{Outline:d.Outline,userFieldsMeta:U}},computed:{...r.mapGetters({currentUserId:`${u.Model.Interface}/currentUserId`,taskUserFieldScheme:`${u.Model.Interface}/taskUserFieldScheme`,templateUserFieldScheme:`${u.Model.Interface}/templateUserFieldScheme`}),design(){return this.isSelected?l.ChipDesign.ShadowAccent:l.ChipDesign.ShadowNoAccent},userFieldScheme(){return this.isTemplate?this.templateUserFieldScheme:this.taskUserFieldScheme},userFields(){return this.task.userFields||[]},hasFilledUserFields(){var t;return M.hasFilledUserFields(((t=this.task)==null?void 0:t.userFields)||[],this.userFieldScheme)},hasRequiredUserFields(){return M.hasMandatoryUserFields(this.userFieldScheme)},isSelected(){return this.isEdit?this.hasFilledUserFields:this.hasRequiredUserFields||this.hasFilledUserFields},readonly(){return!this.task.rights.edit}},methods:{handleClick(){if(this.isSelected){this.highlightField()}else{this.$emit("open")}},highlightField(){void c.fieldHighlighter.setContainer(this.$root.$el).highlight(U.id)}},template:`\n\t\t<Chip\n\t\t\t:design\n\t\t\t:text="userFieldsMeta.title"\n\t\t\t:icon="Outline.TOPIC"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="userFieldsMeta.id"\n\t\t\t@click="handleClick"\n\t\t/>\n\t`};t.UserFields=x;t.UserFieldsChip=D;t.userFieldsMeta=U;t.userFieldsManager=M})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.Tasks.V2.Component.Elements,BX.UI.System.Typography.Vue,BX.Tasks.V2.Lib,BX.Main,BX,BX.Vue3.Vuex,BX.UI.System.Chip.Vue,BX.UI.IconSet,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Lib);
//# sourceMappingURL=user-fields.bundle.map.js