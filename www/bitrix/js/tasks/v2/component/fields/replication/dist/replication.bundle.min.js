this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,a,i,s,n,l,r,o,p,c,d,u,m,h,y,T,v,S,R,k,I,D,g,f,b,P,_,N,L,E,M,A,B,w,O,H){"use strict";const C=Object.freeze({id:b.TaskField.Replication});function F(t){if(t===b.ReplicationWeekDayIndex.Sunday){return""}if(t===b.ReplicationWeekDayIndex.Monday||t===b.ReplicationWeekDayIndex.Tuesday||t===b.ReplicationWeekDayIndex.Thursday){return"_M"}return"_F"}var x=babelHelpers.classPrivateFieldLooseKey("replicateParams");class V{constructor(t){Object.defineProperty(this,x,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,x)[x]=t}generate(){const t=babelHelpers.classPrivateFieldLooseBase(this,x)[x].dailyMonthInterval;const e=babelHelpers.classPrivateFieldLooseBase(this,x)[x].everyDay||1;if(t>0){return D.Loc.getMessage("TASKS_V2_REPLICATION_MONTHLY_2",{"#DAY_NUMBER#":N.DateTimeFormat.format("ddiff",0,e*60*60*24,true),"#WEEKDAY_NAME#":"","#NUMBER#":` ${t+1}`})}return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_DAILY",e,{"#NUMBER#":e>1?` ${e}`:""})}}var W=babelHelpers.classPrivateFieldLooseKey("replicateParams");var $=babelHelpers.classPrivateFieldLooseKey("weekDays");class K{constructor(t){Object.defineProperty(this,$,{get:U,set:void 0});Object.defineProperty(this,W,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,W)[W]=t}generate(){const t=babelHelpers.classPrivateFieldLooseBase(this,W)[W].everyWeek||1;const e=babelHelpers.classPrivateFieldLooseBase(this,$)[$].length===7?D.Loc.getMessage("TASKS_V2_REPLICATION_WEEKLY_EVERYDAY"):babelHelpers.classPrivateFieldLooseBase(this,$)[$].map((t=>D.Loc.getMessage(`TASKS_V2_REPLICATION_WD_${t}`))).join(", ");return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_WEEKLY",t,{"#NUMBER#":t>1?` ${t}`:"","#WEEKDAYS#":` (${e})`})}}function U(){const t=babelHelpers.classPrivateFieldLooseBase(this,W)[W].weekDays;return[...(t==null?void 0:t.length)>0?t:[1]].sort()}var Y=babelHelpers.classPrivateFieldLooseKey("replicateParams");var X=babelHelpers.classPrivateFieldLooseKey("generateAbsolute");var G=babelHelpers.classPrivateFieldLooseKey("generateRelative");var j=babelHelpers.classPrivateFieldLooseKey("getLocaleMonthlyOfDayType2Alt");class z{constructor(t){Object.defineProperty(this,j,{value:J});Object.defineProperty(this,G,{value:Q});Object.defineProperty(this,X,{value:q});Object.defineProperty(this,Y,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=t}generate(){return babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].monthlyType===b.ReplicationMonthlyType.Absolute?babelHelpers.classPrivateFieldLooseBase(this,X)[X]():babelHelpers.classPrivateFieldLooseBase(this,G)[G]()}}function q(){const t=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].monthlyMonthNum1||1;return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_MONTHLY_1",t,{"#NUMBER#":t>1?` ${t}`:"","#DAY_NUMBER#":babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].monthlyDayNum})}function Q(){const t=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].monthlyWeekDay;const e=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].monthlyWeekDayNum;const a=F(t);const i=D.Loc.getMessage(`TASKS_V2_REPLICATION_NUMBER_${e}${a}`);const s=D.Loc.getMessage(`TASKS_V2_REPLICATION_WD_ALT_${t+1}`);const n=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].monthlyMonthNum2||1;return D.Loc.getMessage(`TASKS_V2_REPLICATION_MONTHLY_2${babelHelpers.classPrivateFieldLooseBase(this,j)[j]()}`,{"#DAY_NUMBER#":i,"#WEEKDAY_NAME#":s,"#NUMBER#":n>1?` ${n}`:""})}function J(){const t=babelHelpers.classPrivateFieldLooseBase(this,Y)[Y].monthlyWeekDay;if(t===b.ReplicationWeekDayIndex.Sunday){return"_ALT_1"}if(t===b.ReplicationWeekDayIndex.Wednesday||t===b.ReplicationWeekDayIndex.Friday||t===b.ReplicationWeekDayIndex.Saturday){return"_ALT_0"}return""}var Z=babelHelpers.classPrivateFieldLooseKey("replicateParams");var tt=babelHelpers.classPrivateFieldLooseKey("generateAbsolute");var et=babelHelpers.classPrivateFieldLooseKey("generateRelative");var at=babelHelpers.classPrivateFieldLooseKey("getLocaleType2Alt");class it{constructor(t){Object.defineProperty(this,at,{value:lt});Object.defineProperty(this,et,{value:nt});Object.defineProperty(this,tt,{value:st});Object.defineProperty(this,Z,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]=t}generate(){return babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].yearlyType===b.ReplicationYearlyType.Absolute?babelHelpers.classPrivateFieldLooseBase(this,tt)[tt]():babelHelpers.classPrivateFieldLooseBase(this,et)[et]()}}function st(){const t=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].yearlyDayNum||1;const e=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].yearlyMonth1||1;return D.Loc.getMessage("TASKS_V2_REPLICATION_YEARLY_1",{"#NUMBER#":` ${t}`,"#MONTH#":N.DateTimeFormat.format("F",(new Date).setMonth(e-1)/1e3)})}function nt(){const t=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].yearlyWeekDayNum||0;const e=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].yearlyWeekDay||0;const a=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].yearlyMonth2||1;const i=D.Loc.getMessage(`TASKS_V2_REPLICATION_NUMBER_${t}${F(e-1)}`);return D.Loc.getMessage(`TASKS_V2_REPLICATION_YEARLY_2${babelHelpers.classPrivateFieldLooseBase(this,at)[at]()}`,{"#DAY_NUMBER#":i,"#WEEK_DAY#":D.Loc.getMessage(`TASKS_V2_REPLICATION_WD_ALT_${e}`),"#MONTH#":N.DateTimeFormat.format("F",(new Date).setMonth(a-1)/1e3)})}function lt(){const t=babelHelpers.classPrivateFieldLooseBase(this,Z)[Z].yearlyWeekDay;if(t===b.ReplicationYearlyWeekDayIndex.Sunday){return"_ALT_1"}if(t===b.ReplicationYearlyWeekDayIndex.Wednesday||t===b.ReplicationYearlyWeekDayIndex.Saturday||t===b.ReplicationYearlyWeekDayIndex.Friday){return"_ALT_0"}return""}class rt{static format(t){return N.DateTimeFormat.format(N.DateTimeFormat.getFormat("SHORT_TIME_FORMAT"),(t+L.timezone.getOffset(t))/1e3)}static parseServerTime(t){return D.Type.isStringFilled(t)?t:m.calendar.dayStartTime}static applyTimeToDate(t,e){const[a,i]=e.split(":");t.setHours(parseInt(a,10),parseInt(i,10),0,0);return t}static convertTsToServerTimeString(t){const e=N.Timezone.BrowserTime.toServer(t/1e3);return N.DateTimeFormat.format("H:i",e)}}var ot=babelHelpers.classPrivateFieldLooseKey("replicateParams");var pt=babelHelpers.classPrivateFieldLooseKey("periodRuleGenerator");var ct=babelHelpers.classPrivateFieldLooseKey("setPeriodRuleGenerator");var dt=babelHelpers.classPrivateFieldLooseKey("getStartTimeRule");var ut=babelHelpers.classPrivateFieldLooseKey("getEndRule");class mt{constructor(t){Object.defineProperty(this,ut,{value:Tt});Object.defineProperty(this,dt,{value:yt});Object.defineProperty(this,ct,{value:ht});Object.defineProperty(this,ot,{writable:true,value:void 0});Object.defineProperty(this,pt,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=t;babelHelpers.classPrivateFieldLooseBase(this,ct)[ct](t.period)}generate(){return[babelHelpers.classPrivateFieldLooseBase(this,pt)[pt].generate(),babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](),babelHelpers.classPrivateFieldLooseBase(this,ut)[ut]()].join(" ")}}function ht(t){switch(t){case b.ReplicationPeriod.Weekly:{babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=new K(babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]);break}case b.ReplicationPeriod.Monthly:{babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=new z(babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]);break}case b.ReplicationPeriod.Yearly:{babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=new it(babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]);break}default:{babelHelpers.classPrivateFieldLooseBase(this,pt)[pt]=new V(babelHelpers.classPrivateFieldLooseBase(this,ot)[ot])}}}function yt(){const t=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].startTs;return D.Loc.getMessage("TASKS_V2_REPLICATION_START_TIME",{"#TIME#":rt.format(t)})}function Tt(){const t=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].repeatTill;if(t===b.ReplicationRepeatTill.Times){const t=babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].times;return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_END_AFTER_REPETITIONS",t,{"#COUNT#":t})}if(t===b.ReplicationRepeatTill.Date&&babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].endTs){return D.Loc.getMessage("TASKS_V2_REPLICATION_END_DATE",{"#DATE#":N.DateTimeFormat.format("d.m.Y",new Date(babelHelpers.classPrivateFieldLooseBase(this,ot)[ot].endTs))})}return""}const vt={name:"ReplicationContentState",components:{HoverPill:v.HoverPill,TextMd:I.TextMd},inject:{task:{},taskId:{},isTemplate:{}},setup(){},computed:{readonly(){return!this.isTemplate||!this.task.rights.edit},ruleFormatted(){return new mt(this.task.replicateParams).generate()}},methods:{dontReplicate(){void R.taskService.update(this.taskId,{replicate:false,replicateParams:this.task.replicateParams})}},template:`\n\t\t<HoverPill :readonly withClear textOnly noOffset style="width: auto" @clear="dontReplicate">\n\t\t\t<TextMd>{{ ruleFormatted }}</TextMd>\n\t\t</HoverPill>\n\t`};const St={name:"ReplicationContent",components:{ReplicationContentState:vt,TextSm:I.TextSm,FieldAdd:a.FieldAdd},inject:{task:{}},setup(){return{Outline:A.Outline}},template:`\n\t\t<div class="tasks-field-replication-wrapper">\n\t\t\t<div class="tasks-field-replication-title">\n\t\t\t\t<TextSm style="color: var(--ui-color-base-3)">{{ loc('TASKS_V2_REPLICATION_TITLE') }}</TextSm>\n\t\t\t</div>\n\t\t\t<div class="tasks-field-replication-content">\n\t\t\t\t<ReplicationContentState v-if="task.replicate"/>\n\t\t\t\t<FieldAdd v-else :icon="Outline.REPEAT"/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Rt={name:"ReplicationInterval",components:{RichLoc:y.RichLoc,BInput:c.BInput,TextXs:I.TextXs,UiCheckbox:s.Checkbox},props:{interval:{type:Number,required:true},useInterval:{type:Boolean,default:false},period:{type:String,default:b.ReplicationPeriod.Daily,validator:t=>[b.ReplicationPeriod.Daily,b.ReplicationPeriod.Weekly,b.ReplicationPeriod.Monthly].includes(t)}},emits:["update:interval","update:useInterval"],setup(){return{InputDesign:c.InputDesign,InputSize:c.InputSize}},data(){return{prevInterval:this.interval}},computed:{useIntervalValue:{get(){return this.useInterval},set(t){this.$emit("update:useInterval",t)}},intervalValue:{get(){var t;return((t=this.interval)==null?void 0:t.toString())||""},set(t=""){var e;let a=(e=parseInt(t.replaceAll(/\D/g,""),10))!=null?e:0;if(!D.Type.isInteger(a)||a<1){a=this.prevInterval}this.prevInterval=a;this.$emit("update:interval",a)}},intervalPeriod(){const t=t=>{switch(t){case b.ReplicationPeriod.Weekly:return"TASKS_V2_REPLICATION_SETTINGS_WEEK";case b.ReplicationPeriod.Monthly:return"TASKS_V2_REPLICATION_SETTINGS_MONTH";default:return"TASKS_V2_REPLICATION_SETTINGS_DAY"}};return D.Loc.getMessagePlural(t(this.period),this.interval)}},template:`\n\t\t<div class="tasks-replication-sheet-action-row" :class="{'--active': useInterval}">\n\t\t\t<UiCheckbox :checked="useIntervalValue" @click="useIntervalValue = !useInterval"/>\n\t\t\t<RichLoc\n\t\t\t\tclass="tasks-field-replication-row --text"\n\t\t\t\t:text="loc('TASKS_V2_REPLICATION_SETTINGS_INTERVAL')"\n\t\t\t\tplaceholder="[interval/]"\n\t\t\t>\n\t\t\t\t<template #interval>\n\t\t\t\t\t<RichLoc class="tasks-field-replication-row" :text="intervalPeriod" placeholder="[value/]">\n\t\t\t\t\t\t<template #value>\n\t\t\t\t\t\t\t<BInput\n\t\t\t\t\t\t\t\tv-model="intervalValue"\n\t\t\t\t\t\t\t\t:size="InputSize.Sm"\n\t\t\t\t\t\t\t\t:design="useInterval ? InputDesign.Grey : InputDesign.Disabled"\n\t\t\t\t\t\t\t\t:disabled="!useInterval"\n\t\t\t\t\t\t\t\tstyle="width: 5em; padding-bottom: 0;"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</RichLoc>\n\t\t\t\t</template>\n\t\t\t</RichLoc>\n\t\t\t<div class="tasks-field-replication-row-grow"></div>\n\t\t\t<slot name="hint"/>\n\t\t</div>\n\t`};const kt={name:"ReplicationSettingsDay",components:{QuestionMark:l.QuestionMark,ReplicationInterval:Rt},inject:{replicateParams:{}},emits:["update"],computed:{period(){return n.markRaw(b.ReplicationPeriod.Daily)},useInterval:{get(){return this.replicateParams.everyDay>0},set(t){this.$emit("update",{everyDay:t?1:null})}},interval:{get(){return this.replicateParams.everyDay||1},set(t){this.$emit("update",{everyDay:t})}},hintText(){return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_SETTINGS_DAY_HINT",this.interval,{"#COUNT#":this.interval})},monthPeriod(){return n.markRaw(b.ReplicationPeriod.Monthly)},useMonthInterval:{get(){return this.replicateParams.dailyMonthInterval>0},set(t){this.$emit("update",{dailyMonthInterval:t?1:null})}},monthInterval:{get(){return this.replicateParams.dailyMonthInterval||1},set(t){this.$emit("update",{dailyMonthInterval:t})}},monthHintText(){return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_SETTINGS_MONTH_HINT",this.monthInterval,{"#COUNT#":this.monthInterval})}},template:`\n\t\t<div class="tasks-replication-sheet-replication-settings-day tasks-field-replication-sheet__stack">\n\t\t\t<ReplicationInterval\n\t\t\t\tv-model:useInterval="useInterval"\n\t\t\t\tv-model:interval="interval"\n\t\t\t\t:period\n\t\t\t>\n\t\t\t\t<template #hint>\n\t\t\t\t\t<QuestionMark\n\t\t\t\t\t\tclass="tasks-replication-sheet-action-row__hint"\n\t\t\t\t\t\t:hintText\n\t\t\t\t\t\t:hintMaxWidth="260"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</ReplicationInterval>\n\t\t\t<ReplicationInterval\n\t\t\t\tv-model:useInterval="useMonthInterval"\n\t\t\t\tv-model:interval="monthInterval"\n\t\t\t\t:period="monthPeriod"\n\t\t\t>\n\t\t\t\t<template #hint>\n\t\t\t\t\t<QuestionMark\n\t\t\t\t\t\tclass="tasks-replication-sheet-action-row__hint"\n\t\t\t\t\t\t:hintText="monthHintText"\n\t\t\t\t\t\t:hintMaxWidth="260"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</ReplicationInterval>\n\t\t</div>\n\t`};const It=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];const Dt={Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6,Sun:7};const gt={name:"ReplicationSettingsWeekDaysList",components:{UiCheckbox:s.Checkbox,TextXs:I.TextXs},props:{selectedDays:{type:Array,required:true}},emits:["update:selectedDays"],computed:{weekDays(){const t={SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6};const e=t[m.calendar.weekStart];return[It.slice(e),It.slice(0,e)].flat(1)},dayLabelMap(){const t="D";const e=(new Date).getDay();return this.weekDays.map((a=>{const i=new Date;const s=(It.indexOf(a)-e)%7;i.setDate(i.getDate()+s);return{label:N.DateTimeFormat.format(t,i),value:Dt[a]}}))}},methods:{changeDay(t){if(this.selectedDays.includes(t)){this.$emit("update:selectedDays",this.selectedDays.filter((e=>e!==t)))}else{this.$emit("update:selectedDays",[...this.selectedDays,t])}}},template:`\n\t\t<div class="tasks-replication-sheet-action-row --weekdays">\n\t\t\t<label\n\t\t\t\tv-for="day in dayLabelMap"\n\t\t\t\t:key="day.value"\n\t\t\t\tclass="tasks-field-replication-weekday"\n\t\t\t\t:data-id="'tasks-replication-week-day-' + day.value"\n\t\t\t>\n\t\t\t\t<UiCheckbox tag="span" :checked="selectedDays.includes(day.value)" @click="changeDay(day.value)"/>\n\t\t\t\t<TextXs :className="['tasks-field-replication-weekday-text', {\n\t\t\t\t\t'--checked': selectedDays.includes(day.value),\n\t\t\t\t}]">\n\t\t\t\t\t{{ day.label }}\n\t\t\t\t</TextXs>\n\t\t\t</label>\n\t\t</div>\n\t`};const ft={name:"ReplicationSettingsWeek",components:{QuestionMark:l.QuestionMark,ReplicationInterval:Rt,ReplicationSettingsWeekDaysList:gt},inject:{replicateParams:{}},emits:["update"],computed:{period(){return n.markRaw(b.ReplicationPeriod.Weekly)},useInterval:{get(){return this.replicateParams.everyWeek>0},set(t){this.$emit("update",{everyWeek:t?1:null})}},interval:{get(){return this.replicateParams.everyWeek||1},set(t){this.$emit("update",{everyWeek:t})}},weekDays:{get(){return this.replicateParams.weekDays},set(t){this.$emit("update",{weekDays:t})}},hintText(){return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_SETTINGS_WEEK_HINT",this.interval,{"#COUNT#":this.interval})}},template:`\n\t\t<div class="tasks-replication-sheet-replication-settings-week tasks-field-replication-sheet__stack">\n\t\t\t<ReplicationSettingsWeekDaysList v-model:selectedDays="weekDays"/>\n\t\t\t<ReplicationInterval\n\t\t\t\tv-model:useInterval="useInterval"\n\t\t\t\tv-model:interval="interval"\n\t\t\t\t:period\n\t\t\t>\n\t\t\t\t<template #hint>\n\t\t\t\t\t<QuestionMark\n\t\t\t\t\t\t:hintText\n\t\t\t\t\t\t:hintMaxWidth="260"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</ReplicationInterval>\n\t\t</div>\n\t`};const bt={name:"ReplicationSettingsMonthlyByDayOfMonth",components:{RichLoc:y.RichLoc,BInput:c.BInput,TextXs:I.TextXs,UiRadio:d.UiRadio},props:{monthlyType:{type:Number,required:true},dayNumber:{type:Number,required:true}},emits:["update:monthlyType","update:dayNumber"],setup(){return{InputDesign:c.InputDesign,InputSize:c.InputSize,ReplicationMonthlyType:b.ReplicationMonthlyType}},data(){return{prevDayNumber:0}},computed:{disabled(){return this.monthlyType!==b.ReplicationMonthlyType.Absolute}},mounted(){this.prevDayNumber=this.dayNumber},methods:{updateDayNumber(t=""){var e;let a=(e=parseInt(t.replaceAll(/\D/g,""),10))!=null?e:0;if(!Number.isInteger(a)||a<1||a>31){a=this.prevDayNumber}this.prevDayNumber=a;this.$emit("update:dayNumber",a)}},template:`\n\t\t<div\n\t\t\tclass="tasks-replication-sheet-action-row --selectable"\n\t\t\t@click.self="$emit('update:monthlyType', ReplicationMonthlyType.Absolute)"\n\t\t>\n\t\t\t<UiRadio\n\t\t\t\t:modelValue="monthlyType"\n\t\t\t\t:value="ReplicationMonthlyType.Absolute"\n\t\t\t\tinputName="tasks-replication-sheet-monthly-type"\n\t\t\t\t@update:modelValue="$emit('update:monthlyType', $event)"\n\t\t\t/>\n\t\t\t<RichLoc class="tasks-field-replication-row" :text="loc('TASKS_V2_REPLICATION_NTH_DAY')" placeholder="[day/]">\n\t\t\t\t<template #day>\n\t\t\t\t\t<BInput\n\t\t\t\t\t\t:modelValue="String(dayNumber)"\n\t\t\t\t\t\t:size="InputSize.Sm"\n\t\t\t\t\t\t:design="!disabled ? InputDesign.Grey : InputDesign.Disabled"\n\t\t\t\t\t\t:disabled\n\t\t\t\t\t\tstretched\n\t\t\t\t\t\tstyle="max-width: 4em; padding-bottom: 0;"\n\t\t\t\t\t\t@update:modelValue="updateDayNumber"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</RichLoc>\n\t\t</div>\n\t`};const Pt={name:"SerialNumberSelect",components:{UiSelect:r.UiSelect},props:{modelValue:{type:Number,default:0},disabled:{type:Boolean,default:false},weekDay:{type:Number,default:null}},emits:["update:modelValue"],computed:{itemLocaleAlt(){if(this.weekDay===b.ReplicationWeekDayIndex.Sunday){return"_ALT_1"}if(this.weekDay===b.ReplicationWeekDayIndex.Wednesday||this.weekDay===b.ReplicationWeekDayIndex.Friday||this.weekDay===b.ReplicationWeekDayIndex.Saturday){return"_ALT_0"}return""},items(){return[{id:0,title:this.loc(`TASKS_V2_REPLICATION_SETTINGS_WEEK_DAY_NUMBER_FIRST${this.itemLocaleAlt}`)},{id:1,title:this.loc(`TASKS_V2_REPLICATION_SETTINGS_WEEK_DAY_NUMBER_SECOND${this.itemLocaleAlt}`)},{id:2,title:this.loc(`TASKS_V2_REPLICATION_SETTINGS_WEEK_DAY_NUMBER_THIRD${this.itemLocaleAlt}`)},{id:3,title:this.loc(`TASKS_V2_REPLICATION_SETTINGS_WEEK_DAY_NUMBER_FOURTH${this.itemLocaleAlt}`)},{id:4,title:this.loc(`TASKS_V2_REPLICATION_SETTINGS_WEEK_DAY_NUMBER_LAST${this.itemLocaleAlt}`)}]},item(){return this.items.find((({id:t})=>t===this.modelValue))}},template:`\n\t\t<UiSelect\n\t\t\t:item\n\t\t\t:items\n\t\t\t:disabled\n\t\t\t@update:item="$emit('update:modelValue', $event.id)"\n\t\t/>\n\t`};const _t=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];const Nt={Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6};const Lt={name:"WeekDaySelect",components:{UiSelect:r.UiSelect},props:{modelValue:{type:Number,default:b.ReplicationWeekDayIndex.Monday},disabled:{type:Boolean,default:false}},emits:["update:modelValue"],computed:{items(){const t={SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6};const e=t[m.calendar.weekStart];const a="l";const i=(new Date).getDay();return[_t.slice(e),_t.slice(0,e)].flat(1).map((t=>{const e=new Date;const s=(_t.indexOf(t)-i)%7;e.setDate(e.getDate()+s);return{id:Nt[t],title:N.DateTimeFormat.format(a,e)}}))},item(){return this.items.find((({id:t})=>t===this.modelValue))}},template:`\n\t\t<UiSelect\n\t\t\t:item\n\t\t\t:items\n\t\t\t:disabled\n\t\t\t@update:item="$emit('update:modelValue', $event.id)"\n\t\t/>\n\t`};const Et={name:"ReplicationSettingsMonthlyByDayOfWeek",components:{SerialNumberSelect:Pt,UiRadio:d.UiRadio,UiSelect:r.UiSelect,WeekDaySelect:Lt},props:{monthlyType:{type:Number,required:true},weekDay:{type:Number,required:true},weekDayNumber:{type:Number,required:true}},emits:["update:monthlyType","update:weekDayNumber","update:weekDay"],setup(){return{ReplicationMonthlyType:b.ReplicationMonthlyType}},computed:{disabled(){return this.monthlyType!==b.ReplicationMonthlyType.Relative}},template:`\n\t\t<div\n\t\t\tclass="tasks-replication-sheet-action-row --selectable"\n\t\t\t@click.self="$emit('update:monthlyType', ReplicationMonthlyType.Relative)"\n\t\t>\n\t\t\t<UiRadio\n\t\t\t\t:modelValue="monthlyType"\n\t\t\t\t:value="ReplicationMonthlyType.Relative"\n\t\t\t\tinputName="tasks-replication-sheet-monthly-type"\n\t\t\t\t@update:modelValue="$emit('update:monthlyType', $event)"\n\t\t\t/>\n\t\t\t<SerialNumberSelect\n\t\t\t\t:modelValue="weekDayNumber"\n\t\t\t\t:weekDay\n\t\t\t\t:disabled\n\t\t\t\t@update:modelValue="$emit('update:weekDayNumber', $event)"\n\t\t\t/>\n\t\t\t<WeekDaySelect\n\t\t\t\t:modelValue="weekDay"\n\t\t\t\t:disabled\n\t\t\t\t@update:modelValue="$emit('update:weekDay', $event)"\n\t\t\t/>\n\t\t</div>\n\t`};const Mt={name:"ReplicationSettingsMonth",components:{BInput:c.BInput,ReplicationInterval:Rt,ReplicationSettingsMonthlyByDayOfMonth:bt,ReplicationSettingsMonthlyByDayOfWeek:Et,QuestionMark:l.QuestionMark,UiRadio:d.UiRadio},inject:{replicateParams:{}},emits:["update"],setup(){return{InputDesign:c.InputDesign,InputSize:c.InputSize}},data(){return{dayNumber:1,day:"mon"}},computed:{period(){return n.markRaw(b.ReplicationPeriod.Monthly)},monthlyMonthNum(){return this.monthlyType===b.ReplicationMonthlyType.Absolute?this.replicateParams.monthlyMonthNum1:this.replicateParams.monthlyMonthNum2},useInterval:{get(){return this.monthlyMonthNum>0},set(t){this.updateMonthlyMonthNum(t?1:null)}},interval:{get(){return this.monthlyMonthNum||1},set(t){this.updateMonthlyMonthNum(t)}},monthlyType:{get(){return this.replicateParams.monthlyType},set(t){const e=this.monthlyType;this.update({monthlyType:t});if(e!==t){this.updateFieldsByMonthlyType(t)}}},monthlyDayNum:{get(){return this.replicateParams.monthlyDayNum||1},set(t){this.update({monthlyDayNum:t})}},monthlyWeekDay:{get(){var t;return(t=this.replicateParams.monthlyWeekDay)!=null?t:b.ReplicationWeekDayIndex.Monday},set(t){this.update({monthlyWeekDay:t})}},monthlyWeekDayNum:{get(){var t;return(t=this.replicateParams.monthlyWeekDayNum)!=null?t:0},set(t){this.update({monthlyWeekDayNum:t})}},hintText(){return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_SETTINGS_MONTH_HINT",this.interval,{"#COUNT#":this.interval})}},methods:{update(t){this.$emit("update",t)},updateMonthlyMonthNum(t){if(this.monthlyType===b.ReplicationMonthlyType.Absolute){this.update({monthlyMonthNum1:t})}else{this.update({monthlyMonthNum2:t})}},updateFieldsByMonthlyType(t){const e={};if(t===b.ReplicationMonthlyType.Absolute){e.monthlyWeekDay=null;e.monthlyWeekDayNum=null;e.monthlyMonthNum1=this.replicateParams.monthlyMonthNum2;e.monthlyMonthNum2=null}else{e.monthlyDayNum=null;e.monthlyMonthNum2=this.replicateParams.monthlyMonthNum1;e.monthlyMonthNum1=null;e.monthlyWeekDay=b.ReplicationWeekDayIndex.Monday;e.monthlyWeekDayNum=b.ReplicationWeekDayNum.First}this.update(e)}},template:`\n\t\t<div class="tasks-field-replication-sheet__stack">\n\t\t\t<ReplicationSettingsMonthlyByDayOfMonth\n\t\t\t\tv-model:monthlyType="monthlyType"\n\t\t\t\tv-model:dayNumber="monthlyDayNum"\n\t\t\t/>\n\t\t\t<ReplicationSettingsMonthlyByDayOfWeek\n\t\t\t\tv-model:monthlyType="monthlyType"\n\t\t\t\tv-model:weekDay="monthlyWeekDay"\n\t\t\t\tv-model:weekDayNumber="monthlyWeekDayNum"\n\t\t\t/>\n\t\t\t<ReplicationInterval\n\t\t\t\tv-model:useInterval="useInterval"\n\t\t\t\tv-model:interval="interval"\n\t\t\t\t:period\n\t\t\t>\n\t\t\t\t<template #hint>\n\t\t\t\t\t<QuestionMark\n\t\t\t\t\t\tclass="tasks-replication-sheet-action-row__hint"\n\t\t\t\t\t\t:hintText\n\t\t\t\t\t\t:hintMaxWidth="260"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</ReplicationInterval>\n\t\t</div>\n\t`};const At={name:"MonthSelect",components:{UiSelect:r.UiSelect},props:{modelValue:{type:Number,default:1},disabled:{type:Boolean,default:false}},emits:["update:modelValue"],computed:{items(){return Array.from({length:12},((t,e)=>({id:e+1,title:D.Text.capitalize(N.DateTimeFormat.format("F",(new Date).setMonth(e)/1e3))})))},item(){return this.items.find((({id:t})=>t===this.modelValue))},menuOptions(){return{height:254}}},template:`\n\t\t<UiSelect\n\t\t\t:item\n\t\t\t:items\n\t\t\t:disabled\n\t\t\t:menuOptions\n\t\t\t@update:item="$emit('update:modelValue', $event.id)"\n\t\t/>\n\t`};const Bt={name:"ReplicationSettingsYearAbsoluteDate",components:{BInput:c.BInput,UiRadio:d.UiRadio,MonthSelect:At},props:{yearlyType:{type:Number,required:true},yearlyDayNumber:{type:Number,required:true},yearlyMonth:{type:Number,required:true}},emits:["update:yearlyType","update:yearlyDayNumber","update:yearlyMonth"],setup(){return{InputDesign:c.InputDesign,InputSize:c.InputSize,ReplicationYearlyType:b.ReplicationYearlyType}},data(){return{prevDayNumber:0}},computed:{disabled(){return this.yearlyType!==b.ReplicationYearlyType.Absolute},dayNumber:{get(){return this.yearlyDayNumber},set(t){this.$emit("update:yearlyDayNumber",t)}},month:{get(){return this.yearlyMonth},set(t){this.$emit("update:yearlyMonth",t)}}},mounted(){this.prevDayNumber=this.dayNumber},methods:{updateDayNumber(t=""){var e;let a=(e=parseInt(t.replaceAll(/\D/g,""),10))!=null?e:0;if(!D.Type.isInteger(a)||a<1||a>31){a=this.prevDayNumber}this.dayNumber=a}},template:`\n\t\t<div\n\t\t\tclass="tasks-replication-sheet-action-row --selectable"\n\t\t\t@click.self="$emit('update:yearlyType', ReplicationYearlyType.Absolute)"\n\t\t>\n\t\t\t<UiRadio\n\t\t\t\ttag="label"\n\t\t\t\t:modelValue="yearlyType"\n\t\t\t\t:value="ReplicationYearlyType.Absolute"\n\t\t\t\tinputName="tasks-replication-sheet-yearly-type"\n\t\t\t\t@update:modelValue="$emit('update:yearlyType', $event)"\n\t\t\t/>\n\t\t\t<BInput\n\t\t\t\t:modelValue="dayNumber.toString()"\n\t\t\t\t:size="InputSize.Sm"\n\t\t\t\t:design="disabled ? InputDesign.Disabled : InputDesign.Grey"\n\t\t\t\t:disabled\n\t\t\t\tstretched\n\t\t\t\tstyle="max-width: 4em;"\n\t\t\t\t@update:modelValue="updateDayNumber"\n\t\t\t/>\n\t\t\t<MonthSelect v-model="month" :disabled/>\n\t\t</div>\n\t`};const wt={name:"ReplicationSettingsYearRelativeDate",components:{MonthSelect:At,SerialNumberSelect:Pt,UiRadio:d.UiRadio,WeekDaySelect:Lt},props:{yearlyType:{type:Number,required:true},yearlyWeekDay:{type:Number,required:true},yearlyWeekDayNum:{type:Number,required:true},yearlyMonth:{type:Number,required:true}},emits:["update:yearlyType","update:yearlyWeekDay","update:yearlyWeekDayNum","update:yearlyMonth"],setup(){return{ReplicationYearlyType:b.ReplicationYearlyType}},computed:{disabled(){return this.yearlyType!==b.ReplicationYearlyType.Relative},weekDay:{get(){return this.yearlyWeekDay},set(t){this.$emit("update:yearlyWeekDay",t)}},weekDayNum:{get(){return this.yearlyWeekDayNum},set(t){this.$emit("update:yearlyWeekDayNum",t)}},month:{get(){return this.yearlyMonth},set(t){this.$emit("update:yearlyMonth",t)}}},template:`\n\t\t<div\n\t\t\tclass="tasks-replication-sheet-action-row --selectable"\n\t\t\t@click.self="$emit('update:yearlyType', ReplicationYearlyType.Relative)"\n\t\t>\n\t\t\t<UiRadio\n\t\t\t\ttag="label"\n\t\t\t\t:modelValue="yearlyType"\n\t\t\t\t:value="ReplicationYearlyType.Relative"\n\t\t\t\tinputName="tasks-replication-sheet-yearly-type"\n\t\t\t\t@update:modelValue="$emit('update:yearlyType', $event)"\n\t\t\t/>\n\t\t\t<SerialNumberSelect\n\t\t\t\tv-model="weekDayNum"\n\t\t\t\t:weekDay\n\t\t\t\t:disabled\n\t\t\t\tstyle="max-width: 9em"\n\t\t\t/>\n\t\t\t<WeekDaySelect v-model="weekDay" :disabled style="max-width: 11em"/>\n\t\t\t<MonthSelect v-model="month" :disabled style="max-width: 11em"/>\n\t\t</div>\n\t`};const Ot={name:"ReplicationSettingsYear",components:{ReplicationSettingsYearAbsoluteDate:Bt,ReplicationSettingsYearRelativeDate:wt},inject:{replicateParams:{}},emits:["update"],computed:{yearlyType:{get(){return this.replicateParams.yearlyType},set(t){const e=this.yearlyType;this.update({yearlyType:t});if(e!==this.yearlyType){this.updateByYearlyType(t)}}},yearlyWeekDay:{get(){return(this.replicateParams.yearlyWeekDay||b.ReplicationYearlyWeekDayIndex.Monday)-1},set(t){this.update({yearlyWeekDay:D.Type.isInteger(t)?t+1:t})}}},methods:{update(t){this.$emit("update",t)},updateByYearlyType(t){if(t===b.ReplicationYearlyType.Absolute){this.update({yearlyWeekDay:null,yearlyWeekDayNum:null,yearlyMonth2:null,yearlyDayNum:1,yearlyMonth1:1})}else{this.update({yearlyWeekDay:b.ReplicationYearlyWeekDayIndex.Monday,yearlyWeekDayNum:b.ReplicationWeekDayNum.First,yearlyMonth2:1,yearlyDayNum:null,yearlyMonth1:null})}}},template:`\n\t\t<div class="tasks-field-replication-sheet__stack">\n\t\t\t<ReplicationSettingsYearAbsoluteDate\n\t\t\t\tv-model:yearlyType="yearlyType"\n\t\t\t\t:yearlyDayNumber="replicateParams.yearlyDayNum || 1"\n\t\t\t\t:yearlyMonth="replicateParams.yearlyMonth1 || 1"\n\t\t\t\t@update:yearlyDayNumber="update({ yearlyDayNum: $event })"\n\t\t\t\t@update:yearlyMonth="update({ yearlyMonth1: $event })"\n\t\t\t/>\n\t\t\t<ReplicationSettingsYearRelativeDate\n\t\t\t\tv-model:yearlyType="yearlyType"\n\t\t\t\tv-model:yearlyWeekDay="yearlyWeekDay"\n\t\t\t\t:yearlyWeekDayNum="replicateParams.yearlyWeekDayNum || 0"\n\t\t\t\t:yearlyMonth="replicateParams.yearlyMonth2 || 1"\n\t\t\t\t@update:yearlyWeekDayNum="update({ yearlyWeekDayNum: $event })"\n\t\t\t\t@update:yearlyMonth="update({ yearlyMonth2: $event })"\n\t\t\t/>\n\t\t</div>\n\t`};const Ht={name:"ReplicationSettings",components:{TextMd:I.TextMd,UiTabs:i.UiTabs,ReplicationSettingsDay:kt,ReplicationSettingsWeek:ft,ReplicationSettingsMonth:Mt,ReplicationSettingsYear:Ot},inject:{replicateParams:{}},emits:["update"],computed:{period:{get(){return this.replicateParams.period},set(t){this.$emit("update",{period:t,...this.getEmptyPrevTabData(this.replicateParams.period),...this.getDefaultTabData(t)})}},title(){return this.period===b.ReplicationPeriod.Weekly?this.loc("TASKS_V2_REPLICATION_SETTINGS_TITLE_ALT"):this.loc("TASKS_V2_REPLICATION_SETTINGS_TITLE")},tabs(){return[{id:b.ReplicationPeriod.Daily,title:this.loc("TASKS_V2_REPLICATION_SETTINGS_TAB_DAY"),component:kt},{id:b.ReplicationPeriod.Weekly,title:this.loc("TASKS_V2_REPLICATION_SETTINGS_TAB_WEEK"),component:ft},{id:b.ReplicationPeriod.Monthly,title:this.loc("TASKS_V2_REPLICATION_SETTINGS_TAB_MONTH"),component:Mt},{id:b.ReplicationPeriod.Yearly,title:this.loc("TASKS_V2_REPLICATION_SETTINGS_TAB_YEAR"),component:Ot}]}},methods:{getEmptyPrevTabData(t){switch(t){case b.ReplicationPeriod.Daily:return R.ReplicateCreator.createReplicateParamsDaily();case b.ReplicationPeriod.Weekly:return R.ReplicateCreator.createReplicateParamsWeekly();case b.ReplicationPeriod.Monthly:return R.ReplicateCreator.createReplicateParamsMonthly();case b.ReplicationPeriod.Yearly:return R.ReplicateCreator.createReplicateParamsYearly();default:return{}}},getDefaultTabData(t){switch(t){case b.ReplicationPeriod.Daily:return R.ReplicateCreator.createDefaultReplicationParamsDaily();case b.ReplicationPeriod.Weekly:return R.ReplicateCreator.createDefaultReplicationParamsWeekly();case b.ReplicationPeriod.Monthly:return R.ReplicateCreator.createDefaultReplicationParamsMonthly();case b.ReplicationPeriod.Yearly:return R.ReplicateCreator.createDefaultReplicationParamsYearly();default:return{}}}},template:`\n\t\t<div class="tasks-field-replication-section">\n\t\t\t<TextMd tag="div" className="tasks-field-replication-row">\n\t\t\t\t<span class="tasks-field-replication-secondary">{{ title }}</span>\n\t\t\t</TextMd>\n\t\t\t<div class="tasks-field-replication-sheet-replication-settings-content">\n\t\t\t\t<UiTabs\n\t\t\t\t\tv-model="period"\n\t\t\t\t\t:tabs\n\t\t\t\t>\n\t\t\t\t\t<template v-slot="{ activeTab }">\n\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t:is="activeTab.component"\n\t\t\t\t\t\t\t@update="$emit('update', $event)"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</UiTabs>\n\t\t\t</div>\n\t\t</div>\n\t`};class Ct{static format(t){const e=L.timezone.getOffset(t);const a=new Date(Date.now()+e);const i=new Date(t+e);const s=a.getFullYear()===i.getFullYear()&&a.getMonth()===i.getMonth()&&a.getDate()===i.getDate();if(s){return D.Text.capitalize(N.DateTimeFormat.format("today"))}return m.calendar.formatDate(t)}static parseServerDate(t){if(D.Type.isStringFilled(t)){return N.DateTimeFormat.parse(t)}const e=new Date;e.setHours(0,0,0,0);return e}static convertServerDateToTs(t,e=null){if(D.Type.isStringFilled(e)){o.TimeStringConverter.applyTimeToDate(t,e)}return N.Timezone.ServerTime.toBrowser(t)*1e3}static convertTsToServerDateString(t){const e=new Date(t);const a=N.Timezone.BrowserTime.toServerDate(e);const i=a.setHours(0,0,0,0)/1e3;return N.DateTimeFormat.format(N.DateTimeFormat.getFormat("FORMAT_DATETIME"),i)}}const Ft={name:"ReplicationDatepicker",components:{Popup:p.Popup},inject:{taskId:{}},props:{dateTs:{type:Number,required:true},bindElement:{type:HTMLElement,required:true}},emits:["update:dateTs","close"],data(){return{dateTsModel:null}},created(){this.datePicker=this.createDatePicker();const t=new Date(this.dateTs+L.timezone.getOffset(this.dateTs));this.dateTsModel=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()},mounted(){this.datePicker.show()},unmounted(){var t;(t=this.datePicker)==null?void 0:t.destroy()},methods:{createDatePicker(){const t=L.timezone.getOffset(this.dateTs);const e=new u.DatePicker({popupOptions:{id:`tasks-replication-date-picker-${this.taskId}-${D.Text.getRandom()}`,bindElement:this.bindElement,offsetTop:5,offsetLeft:-40,targetContainer:document.body,events:{onClose:()=>this.$emit("close")}},selectedDates:[this.dateTs+t],events:{[u.DatePickerEvent.SELECT]:t=>{const{date:e}=t.getData();const a=m.calendar.createDateFromUtc(e).getTime();this.$emit("update:dateTs",a-L.timezone.getOffset(a))}}});e.getPicker("day").subscribe("onSelect",(t=>{const{year:e,month:a,day:i}=t.getData();const s=new Date(e,a,i).getTime();this.$emit("close");this.dateTsModel=s}));return e}},template:'<div ref="picker"/>'};const xt={name:"ReplicationStart",components:{RichLoc:y.RichLoc,TextMd:I.TextMd,HoverPill:v.HoverPill,ReplicationDatepicker:Ft,UiButton:S.Button},inject:{replicateParams:{}},emits:["update"],setup(){return{AirButtonStyle:S.AirButtonStyle,ButtonSize:S.ButtonSize}},data(){return{isDatepickerOpened:false}},computed:{startTs:{get(){return this.replicateParams.startTs},set(t){this.$emit("update",{startTs:t})}},startLabel(){return Ct.format(this.startTs)}},beforeMount(){if(!this.replicateParams.startTs){const t=m.calendar.workdayStart;const e=(new Date).setHours(t.H,t.M,0,0);this.startTs=e-L.timezone.getOffset(e)}},template:`\n\t\t<TextMd tag="div" className="tasks-field-replication-section">\n\t\t\t<RichLoc\n\t\t\t\tclass="tasks-field-replication-row tasks-field-replication-secondary"\n\t\t\t\t:text="loc('TASKS_V2_REPLICATION_START')"\n\t\t\t\tplaceholder="[date/]"\n\t\t\t>\n\t\t\t\t<template #date>\n\t\t\t\t\t<HoverPill textOnly noOffset ref="datepickerStartOpener">\n\t\t\t\t\t\t<span class="tasks-field-replication-link" @click="isDatepickerOpened = true">\n\t\t\t\t\t\t\t{{ startLabel }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</HoverPill>\n\t\t\t\t\t<ReplicationDatepicker\n\t\t\t\t\t\tv-if="isDatepickerOpened"\n\t\t\t\t\t\tv-model:dateTs="startTs"\n\t\t\t\t\t\t:bindElement="$refs.datepickerStartOpener.$el"\n\t\t\t\t\t\t@close="isDatepickerOpened = false"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t</RichLoc>\n\t\t</TextMd>\n\t`};const Vt={name:"ReplicationFinish",components:{HoverPill:v.HoverPill,ReplicationDatepicker:Ft,TextMd:I.TextMd,TextSm:I.TextSm,TextXs:I.TextXs,UiButton:S.Button,BInput:c.BInput,UiRadio:d.UiRadio,RichLoc:y.RichLoc},inject:{replicateParams:{}},emits:["update"],setup(){return{AirButtonStyle:S.AirButtonStyle,ButtonSize:S.ButtonSize,InputDesign:c.InputDesign,InputSize:c.InputSize,ReplicationRepeatTill:b.ReplicationRepeatTill}},data(){return{isDatepickerOpened:false,prevTimes:this.replicateParams.times||1}},computed:{repeatTill:{get(){return this.replicateParams.repeatTill},set(t){const e=this.repeatTill;this.update({repeatTill:t});if(e!==t){this.updateFieldsByRepeatTill(t)}}},endDateTs(){return D.Type.isNil(this.replicateParams.endTs)?Date.now()+5*24*60*60*1e3:this.replicateParams.endTs},endDateLabel(){return this.endDateTs?m.calendar.formatDate(this.endDateTs):this.loc("TASKS_V2_REPLICATION_FINISH_DATE_UNSET")}},methods:{update(t){this.$emit("update",t)},updateTimes(t){var e;let a=(e=parseInt(t.replaceAll(/\D/g,""),10))!=null?e:0;if(!D.Type.isInteger(a)||a<1){a=this.prevTimes}this.prevTimes=a;this.update({times:a})},updateEndDate(t){this.update({endTs:t})},updateFieldsByRepeatTill(t){if(t===b.ReplicationRepeatTill.Endless){this.update({times:null,endless:null})}if(t===b.ReplicationRepeatTill.Times){this.prevTimes=1;this.update({times:1,endDate:null})}if(t===b.ReplicationRepeatTill.Date){this.update({times:null,endDate:N.DateTimeFormat.format("m-d-Y",(Date.now()+5*24*60*60*1e3)/1e3)})}},togglePopup(){this.isDatepickerOpened=!this.isDatepickerOpened},isRowActive(t){return t===this.repeatTill},handleClickDatepickerFinishOpener(t){if(!this.isRowActive(b.ReplicationRepeatTill.Date)){return}const e=t.currentTarget;const a=e.getAttribute("disabled");if(!(a==="true")){this.togglePopup()}}},template:`\n\t\t<div class="tasks-field-replication-section">\n\t\t\t<TextMd tag="div" className="tasks-field-replication-row">\n\t\t\t\t<span class="tasks-field-replication-secondary">\n\t\t\t\t\t{{ loc('TASKS_V2_REPLICATION_FINISH') }}\n\t\t\t\t</span>\n\t\t\t</TextMd>\n\t\t\t<div>\n\t\t\t\t<div class="tasks-field-replication-sheet__stack">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-replication-sheet-action-row --selectable"\n\t\t\t\t\t\t:class="{'--active': isRowActive(ReplicationRepeatTill.Endless)}"\n\t\t\t\t\t\t@click.self="repeatTill = ReplicationRepeatTill.Endless"\n\t\t\t\t\t>\n\t\t\t\t\t\t<UiRadio\n\t\t\t\t\t\t\ttag="label"\n\t\t\t\t\t\t\tv-model="repeatTill"\n\t\t\t\t\t\t\t:value="ReplicationRepeatTill.Endless"\n\t\t\t\t\t\t\tinputName="tasks-replication-sheet-finish-type"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<TextXs className="tasks-replication-sheet-action-row__text">\n\t\t\t\t\t\t\t{{ loc('TASKS_V2_REPLICATION_FINISH_HAND') }}\n\t\t\t\t\t\t</TextXs>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-replication-sheet-action-row --selectable"\n\t\t\t\t\t\t:class="{'--active': isRowActive(ReplicationRepeatTill.Times)}"\n\t\t\t\t\t\t@click.self="repeatTill = ReplicationRepeatTill.Times"\n\t\t\t\t\t>\n\t\t\t\t\t\t<UiRadio\n\t\t\t\t\t\t\ttag="label"\n\t\t\t\t\t\t\tv-model="repeatTill"\n\t\t\t\t\t\t\t:value="ReplicationRepeatTill.Times"\n\t\t\t\t\t\t\tinputName="tasks-replication-sheet-finish-type"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<RichLoc\n\t\t\t\t\t\t\tclass="tasks-field-replication-row"\n\t\t\t\t\t\t\t:text="loc('TASKS_V2_REPLICATION_AFTER_COUNT_REPETITIONS')"\n\t\t\t\t\t\t\tplaceholder="[count/]"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<template #count>\n\t\t\t\t\t\t\t\t<BInput\n\t\t\t\t\t\t\t\t\t:modelValue="String(replicateParams.times ?? '')"\n\t\t\t\t\t\t\t\t\t:size="InputSize.Sm"\n\t\t\t\t\t\t\t\t\t:design="isRowActive(ReplicationRepeatTill.Times) ? InputDesign.Grey : InputDesign.Disabled"\n\t\t\t\t\t\t\t\t\t:disabled="!isRowActive(ReplicationRepeatTill.Times)"\n\t\t\t\t\t\t\t\t\tstyle="max-width: 4em; padding-bottom: 0;"\n\t\t\t\t\t\t\t\t\t@blur="updateTimes($event.target.value)"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</RichLoc>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="tasks-replication-sheet-action-row --selectable"\n\t\t\t\t\t\t:class="{'--active': isRowActive(ReplicationRepeatTill.Date)}"\n\t\t\t\t\t\t@click.self="repeatTill = ReplicationRepeatTill.Date"\n\t\t\t\t\t>\n\t\t\t\t\t\t<UiRadio\n\t\t\t\t\t\t\ttag="label"\n\t\t\t\t\t\t\tv-model="repeatTill"\n\t\t\t\t\t\t\t:value="ReplicationRepeatTill.Date"\n\t\t\t\t\t\t\tinputName="tasks-replication-sheet-finish-type"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<TextXs className="tasks-replication-sheet-action-row__text">\n\t\t\t\t\t\t\t{{ loc('TASKS_V2_REPLICATION_FINISH_DATE') }}\n\t\t\t\t\t\t</TextXs>\n\t\t\t\t\t\t<HoverPill\n\t\t\t\t\t\t\t:readonly="!isRowActive(ReplicationRepeatTill.Date)"\n\t\t\t\t\t\t\ttextOnly\n\t\t\t\t\t\t\tnoOffset\n\t\t\t\t\t\t\tref="datepickerFinishOpener"\n\t\t\t\t\t\t\t@click="handleClickDatepickerFinishOpener"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span class="tasks-field-replication-link">{{ endDateLabel }}</span>\n\t\t\t\t\t\t</HoverPill>\n\t\t\t\t\t\t<ReplicationDatepicker\n\t\t\t\t\t\t\tv-if="isDatepickerOpened"\n\t\t\t\t\t\t\t:dateTs="endDateTs"\n\t\t\t\t\t\t\t:bindElement="$refs.datepickerFinishOpener.$el"\n\t\t\t\t\t\t\t@update:dateTs="updateEndDate"\n\t\t\t\t\t\t\t@close="isDatepickerOpened = false"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Wt={name:"ReplicationStartTime",components:{RichLoc:y.RichLoc,TextMd:I.TextMd,HoverPill:v.HoverPill},inject:{replicateParams:{}},emits:["update"],computed:{startTs:{get(){return this.replicateParams.startTs},set(t){this.$emit("update",{startTs:t})}},startTimeFormatted(){return rt.format(this.startTs)}},methods:{showPicker(){var t;(t=this.datePicker)!=null?t:this.datePicker=new u.DatePicker({selectedDates:[this.startTs+L.timezone.getOffset(this.startTs)],type:"time",events:{[u.DatePickerEvent.SELECT]:t=>{const{date:e}=t.getData();const a=m.calendar.createDateFromUtc(e).getTime();this.startTs=a-L.timezone.getOffset(a)}},popupOptions:{targetContainer:document.body}});this.datePicker.setTargetNode(this.$refs.time.$el);this.datePicker.show()}},template:`\n\t\t<TextMd tag="div" className="tasks-field-replication-section">\n\t\t\t<RichLoc\n\t\t\t\tclass="tasks-field-replication-row tasks-field-replication-secondary"\n\t\t\t\t:text="loc('TASKS_V2_REPLICATION_CREATE_AT')"\n\t\t\t\tplaceholder="[time/]"\n\t\t\t>\n\t\t\t\t<template #time>\n\t\t\t\t\t<HoverPill textOnly noOffset ref="time" @click="showPicker">\n\t\t\t\t\t\t<span class="tasks-field-replication-link">{{ startTimeFormatted }}</span>\n\t\t\t\t\t</HoverPill>\n\t\t\t\t</template>\n\t\t\t</RichLoc>\n\t\t</TextMd>\n\t`};const $t={name:"ReplicationDeadline",components:{TextMd:I.TextMd,DeadlineAfterPopup:h.DeadlineAfterPopup,HoverPill:v.HoverPill},inject:{replicateParams:{},taskId:{}},emits:["update"],data(){return{isDeadlinePopupShown:false}},computed:{deadlineLabel(){let t=this.replicateParams.deadlineOffset||null;if(!t){return this.loc("TASKS_V2_REPLICATION_DEADLINE_NOT_SET")}t*=1e3;if(this.isMinutes(t)){const e=t/(60*1e3);return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_DEADLINE_IN_MINUTES",e,{"#TASK_DEADLINE#":e})}if(this.isHours(t)){const e=t/(60*60*1e3);return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_DEADLINE_IN_HOURS",e,{"#TASK_DEADLINE#":e})}if(this.isWeeks(t)){const e=t/(7*24*60*60*1e3);return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_DEADLINE_IN_WEEKS",e,{"#TASK_DEADLINE#":e})}const e=t/(24*60*60*1e3);return D.Loc.getMessagePlural("TASKS_V2_REPLICATION_DEADLINE_IN_DAYS",e,{"#TASK_DEADLINE#":e})},today(){const t=new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())}},methods:{update(t){this.$emit("update",{deadlineOffset:t})},updateDeadlineAfter(t){this.update(D.Type.isNumber(t)?t/1e3:t)},isMinutes(t){const e=60*60*1e3;return t<e||t%e!==0},isHours(t){const e=24*60*60*1e3;return t<e||t%e!==0},isWeeks(t){const e=7*24*60*60*1e3;return t%e===0}},template:`\n\t\t<div class="tasks-field-replication-section">\n\t\t\t<TextMd tag="div" className="tasks-field-replication-row">\n\t\t\t\t<span class="tasks-field-replication-secondary">\n\t\t\t\t\t{{ loc('TASKS_V2_REPLICATION_DEADLINE') }}\n\t\t\t\t</span>\n\t\t\t\t<HoverPill textOnly noOffset ref="deadline">\n\t\t\t\t\t<span class="tasks-field-replication-link" @click="isDeadlinePopupShown = true">\n\t\t\t\t\t\t{{ deadlineLabel }}\n\t\t\t\t\t</span>\n\t\t\t\t</HoverPill>\n\t\t\t\t<DeadlineAfterPopup\n\t\t\t\t\tv-if="isDeadlinePopupShown"\n\t\t\t\t\t:deadlineAfter="replicateParams.deadlineAfter"\n\t\t\t\t\t:taskId\n\t\t\t\t\t:bindElement="$refs.deadline.$el"\n\t\t\t\t\t@update:deadlineAfter="updateDeadlineAfter"\n\t\t\t\t\t@close="isDeadlinePopupShown = false"\n\t\t\t\t/>\n\t\t\t</TextMd>\n\t\t</div>\n\t`};const Kt={name:"ReplicationWeekend",components:{RichLoc:y.RichLoc,TextMd:I.TextMd,BMenu:T.BMenu,HoverPill:v.HoverPill},inject:{replicateParams:{}},emits:["update"],data(){return{isMenuShown:false}},computed:{workdayOnly:{get(){return this.replicateParams.workdayOnly},set(t){this.update({workdayOnly:t})}},item(){return this.weekendAttitudeItems.find((t=>t.id===this.workdayOnly))},weekendAttitudeItems(){const t=[{id:"N",value:this.loc("TASKS_V2_REPLICATION_WEEKEND_CREATE")},{id:"Y",value:this.loc("TASKS_V2_REPLICATION_WEEKEND_NOT_CREATE")}];return t.map((t=>({id:t.id,title:t.value,isSelected:t.id===this.workdayOnly,onClick:()=>{this.workdayOnly=t.id}})))},options(){return{id:"weekend-attitude-replicant-popup",bindElement:this.$refs.skipWeekends.$el,items:this.weekendAttitudeItems,offsetTop:5,targetContainer:document.body}}},beforeMount(){if(!this.replicateParams.workdayOnly){this.workdayOnly="N"}},methods:{update({workdayOnly:t}){this.$emit("update",{workdayOnly:t})}},template:`\n\t\t<TextMd tag="div" className="tasks-field-replication-section">\n\t\t\t<RichLoc\n\t\t\t\tclass="tasks-field-replication-row tasks-field-replication-secondary"\n\t\t\t\t:text="loc('TASKS_V2_REPLICATION_ON_WEEKEND_DO')"\n\t\t\t\tplaceholder="[do/]"\n\t\t\t>\n\t\t\t\t<template #do>\n\t\t\t\t\t<HoverPill textOnly noOffset ref="skipWeekends" @click="isMenuShown = true">\n\t\t\t\t\t\t<span class="tasks-field-replication-link">{{ item?.title || '' }}</span>\n\t\t\t\t\t</HoverPill>\n\t\t\t\t\t<BMenu v-if="isMenuShown" :options @close="isMenuShown = false"/>\n\t\t\t\t</template>\n\t\t\t</RichLoc>\n\t\t</TextMd>\n\t`};const Ut={name:"ReplicationSheetFooter",components:{UiButton:S.Button},inject:{task:{},taskId:{},isTemplate:{}},props:{replicateParams:{type:Object,required:true}},emits:["close"],setup(){return{AirButtonStyle:S.AirButtonStyle,ButtonColor:S.ButtonColor,ButtonSize:S.ButtonSize}},computed:{wasFilled(){return this.task.filledFields[C.id]}},created(){this.wasEmpty=!this.wasFilled||!this.task.replicateParams},methods:{async save(){this.$emit("close");if(this.wasEmpty){void O.fieldHighlighter.setContainer(this.$root.$el).highlight(C.id)}await R.taskService.update(this.taskId,{replicate:true,replicateParams:this.replicateParams});D.Event.EventEmitter.emit(b.EventName.UpdateReplicateParams)}},template:`\n\t\t<div class="tasks-field-replication-sheet-footer">\n\t\t\t<UiButton\n\t\t\t\t:text="loc('TASKS_V2_REPLICATION_CANCEL')"\n\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t:color="ButtonColor.LIGHT"\n\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t@click="$emit('close')"\n\t\t\t/>\n\t\t\t<UiButton\n\t\t\t\t:text="loc('TASKS_V2_REPLICATION_SAVE')"\n\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t:color="ButtonColor.PRIMARY"\n\t\t\t\t@click="save"\n\t\t\t/>\n\t\t</div>\n\t`};const Yt={name:"ReplicationSheetContent",components:{BIcon:A.BIcon,HeadlineMd:I.HeadlineMd,HoverPill:v.HoverPill,ReplicationSettings:Ht,ReplicationStart:xt,ReplicationStartTime:Wt,ReplicationDatepicker:Ft,ReplicationFinish:Vt,ReplicationDeadline:$t,ReplicationWeekend:Kt,ReplicationSheetFooter:Ut,RichLoc:y.RichLoc,TextMd:I.TextMd},inject:{task:{},taskId:{},isTemplate:{}},provide(){return{replicateParams:n.computed((()=>this.replicateParams))}},emits:["close"],setup(){return{Outline:A.Outline}},data(){return{replicateParams:R.ReplicateCreator.createEmptyReplicateParams()}},computed:{isDailyPeriod(){return this.replicateParams.period===b.ReplicationPeriod.Daily}},created(){this.initReplicateParams()},methods:{initReplicateParams(){var t;if(!D.Type.isObject(((t=this.task)==null?void 0:t.replicateParams)||null)){return}this.replicateParams={...this.replicateParams,...this.task.replicateParams,weekDays:[...this.task.replicateParams.weekDays||[]]}},updateReplicateParams(t={}){this.replicateParams={...this.replicateParams,...t}},showHelpDesk(){top.BX.Helper.show("redirect=detail&code=18127718")},close(){this.$emit("close")}},template:`\n\t\t<div class="tasks-field-replication-sheet">\n\t\t\t<div class="tasks-field-replication-sheet-header">\n\t\t\t\t<HeadlineMd>{{ loc('TASKS_V2_REPLICATION_TITLE_SHEET') }}</HeadlineMd>\n\t\t\t\t<BIcon\n\t\t\t\t\tclass="tasks-field-replication-sheet-close"\n\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\thoverable\n\t\t\t\t\t@click="close"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="tasks-field-replication-sheet-body">\n\t\t\t\t<div v-if="!isTemplate" class="tasks-field-replication-sheet-description">\n\t\t\t\t\t<span class="tasks-field-replication-sheet-description-text">\n\t\t\t\t\t\t<RichLoc :text="loc('TASKS_V2_REPLICATION_SHEET_DESCRIPTION')" placeholder="[helpdesk]">\n\t\t\t\t\t\t\t<template #helpdesk="{ text }">\n\t\t\t\t\t\t\t\t<a class="tasks-field-replication-helpdesk" @click="showHelpDesk">{{ text }}</a>\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</RichLoc>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<ReplicationSettings @update="updateReplicateParams"/>\n\t\t\t\t<ReplicationStart @update="updateReplicateParams"/>\n\t\t\t\t<ReplicationFinish @update="updateReplicateParams"/>\n\t\t\t\t<ReplicationStartTime @update="updateReplicateParams"/>\n\t\t\t\t<ReplicationDeadline v-if="!isTemplate" @update="updateReplicateParams"/>\n\t\t\t\t<ReplicationWeekend v-if="isDailyPeriod" @update="updateReplicateParams"/>\n\t\t\t</div>\n\t\t\t<ReplicationSheetFooter :replicateParams @close="close"/>\n\t\t</div>\n\t`};const Xt={name:"ReplicationSheet",components:{BIcon:A.BIcon,BottomSheet:k.BottomSheet,ReplicationSheetContent:Yt},inject:{task:{}},props:{sheetBindProps:{type:Object,required:true}},emits:["close"],setup(){return{Outline:A.Outline}},template:`\n\t\t<BottomSheet\n\t\t\t:sheetBindProps\n\t\t\tcustomClass="tasks-bottom-sheet-replicate-content"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<ReplicationSheetContent @close="$emit('close')"/>\n\t\t</BottomSheet>\n\t`};const Gt={name:"ReplicationSheetHeader",components:{HeadlineMd:I.HeadlineMd,BIcon:A.BIcon},emits:["close"],setup(){return{Outline:A.Outline}},template:`\n\t\t<div class="tasks-field-replication-sheet-header">\n\t\t\t<HeadlineMd>{{ loc('TASKS_V2_REPLICATION_HISTORY_SHEET') }}</HeadlineMd>\n\t\t\t<BIcon\n\t\t\t\tclass="tasks-field-replication-sheet-close"\n\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\thoverable\n\t\t\t\t@click="$emit('close')"\n\t\t\t/>\n\t\t</div>\n\t`};const jt={props:{getGrid:{type:Function,required:true}},data(){return{systemLogTimeRef:[],systemLogTime:[]}},methods:{async update(){const t=this.getGrid().querySelectorAll("[data-system-log-time]");this.systemLogTime=[...t].map((t=>this.getSystemLogTime(t)));await this.$nextTick();t.forEach((t=>{const e=this.getSystemLogTime(t);t.append(this.systemLogTimeRef[e.rowId])}))},getSystemLogTime(t){const e=Number(t.closest("[data-id]").dataset.id);const a=this.getOffsetTimestamp(t.dataset.systemLogTime);return{rowId:e,offsetTimestamp:a}},getOffsetTimestamp(t){const e=Number(t)*1e3;const a=L.timezone.getOffset(e);const i=(e+a)/1e3;return N.DateTimeFormat.format(N.DateTimeFormat.getFormat("FORMAT_DATETIME"),i)},setRef(t,e){var a;(a=this.systemLogTimeRef)!=null?a:this.systemLogTimeRef={};this.systemLogTimeRef[e]=t}},template:`\n\t\t<template v-for="(time, id) in systemLogTime" :key="id">\n\t\t\t<div :ref="(el) => setRef(el, time.rowId)">{{ time.offsetTimestamp }}</div>\n\t\t</template>\n\t`};const zt={props:{errorMessage:{type:String,default:""},errorLink:{type:String,default:null}},template:`\n\t\t<div class="tasks-field-replication-hint">\n\t\t\t<div>{{ errorMessage.replace('#LINK#', '') }}</div>\n\t\t\t<a v-if="errorLink" :href="errorLink">\n\t\t\t\t{{ loc('TASKS_V2_REPLICATION_NO_ACCESS_MORE') }}\n\t\t\t</a>\n\t\t</div>\n\t`};const qt=/\(#(\d+)\)(?![\S\s]*\(#\d+\))/;const Qt={components:{BIcon:A.BIcon,Hint:E.Hint,ErrorHint:zt},props:{message:{type:Object,required:true},activeHintRowId:{type:Number,default:null}},emits:["hintOpen","hintClose"],setup(){return{Outline:A.Outline}},data(){return{showHint:false}},computed:{formattedMessage(){var t;return(t=this.message.message)==null?void 0:t.replace(qt,"").trim()},linkText(){var t,e;return(t=(e=this.message.message)==null?void 0:e.match(qt)[0])!=null?t:null},errorMessage(){return this.message.errors[0].MESSAGE},errorLink(){return this.message.errors[0].LINK},popupOptions(){return{offsetLeft:this.$refs.error.$el.offsetWidth/2,maxWidth:494,width:494}}},methods:{openHint(){if(this.activeHintRowId!==null&&this.activeHintRowId!==this.message.rowId){return}if(!this.showHint){this.showHint=true;this.$emit("hintOpen",this.message.rowId)}},closeHint(){if(this.showHint){this.showHint=false;this.$emit("hintClose",this.message.rowId)}}},template:`\n\t\t<div class="tasks-field-replication-message">\n\t\t\t<div v-if="message.link">{{ formattedMessage }} <a :href="message.link">{{ linkText }}</a></div>\n\t\t\t<span v-else>{{ message.message }}</span>\n\t\t\t<BIcon\n\t\t\t\tv-if="message.errors?.length > 0"\n\t\t\t\tclass="tasks-field-replication-error-icon"\n\t\t\t\t:name="Outline.ALERT"\n\t\t\t\tref="error"\n\t\t\t\t@mouseenter="openHint"\n\t\t\t/>\n\t\t\t<Hint v-if="showHint" :bindElement="$refs.error.$el" :options="popupOptions" @close="closeHint">\n\t\t\t\t<ErrorHint :errorMessage :errorLink/>\n\t\t\t</Hint>\n\t\t</div>\n\t`};const Jt={components:{MessageField:Qt},props:{getGrid:{type:Function,required:true}},data(){return{systemLogMessageRef:[],systemLogMessage:[],activeHintRowId:null}},methods:{async update(){const t=this.getGrid().querySelectorAll("[data-system-log-message]");this.systemLogMessage=[...t].map((t=>this.getSystemLogMessage(t)));await this.$nextTick();t.forEach((t=>{const e=this.getSystemLogMessage(t);t.append(this.systemLogMessageRef[e.rowId])}))},getSystemLogMessage(t){const e=Number(t.closest("[data-id]").dataset.id);const a=JSON.parse(t.dataset.systemLogMessage);return{rowId:e,message:a.message,link:a.link,errors:a.errors}},setRef(t,e){var a;(a=this.systemLogMessageRef)!=null?a:this.systemLogMessageRef={};this.systemLogMessageRef[e]=t},onHintOpen(t){this.activeHintRowId=t},onHintClose(t){if(this.activeHintRowId===t){this.activeHintRowId=null}}},template:`\n\t\t<template v-for="(message, id) in systemLogMessage" :key="id">\n\t\t\t<MessageField\n\t\t\t\t:ref="(el) => setRef(el?.$el, message.rowId)"\n\t\t\t\t:message="message"\n\t\t\t\t:activeHintRowId\n\t\t\t\t@hintOpen="onHintOpen"\n\t\t\t\t@hintClose="onHintClose"\n\t\t\t/>\n\t\t</template>\n\t`};const Zt={template:`\n\t\t<div class="tasks-template-history-grid-loader-spinner-container">\n\t\t\t<div class="tasks-template-history-grid-loader-spinner"/>\n\t\t</div>\n\t`};const te="tasks-template-history-grid";const ee={components:{TimeFields:jt,MessageFields:Jt,GridLoader:Zt},inject:{taskId:{}},setup(){},computed:{templateId(){return _.idUtils.unbox(this.taskId)}},mounted(){g.EventEmitter.subscribe("Grid::beforeRequest",this.handleBeforeGridRequest);g.EventEmitter.subscribe("Grid::updated",this.update);void this.getData()},beforeUnmount(){var t,e,a;g.EventEmitter.unsubscribe("Grid::beforeRequest",this.handleBeforeGridRequest);g.EventEmitter.unsubscribe("Grid::updated",this.update);(t=BX.Main)==null?void 0:(e=t.gridManager)==null?void 0:e.destroy(te);(a=f.PopupManager.getPopupById(`${te}-grid-settings-window`))==null?void 0:a.destroy()},methods:{async getData(){const{html:t}=await P.apiClient.post(b.Endpoint.TemplateHistoryGetGrid,{templateId:this.templateId});await D.Runtime.html(this.$refs.grid,t);this.update()},handleBeforeGridRequest(t){const[,e]=t.getData();if(e.url){var a;this.nav=new D.Uri((a=e.url)!=null?a:"").getQueryParams().nav}e.url=`/bitrix/services/main/ajax.php?action=tasks.V2.Template.History.getGridData&nav=${this.nav}`;e.method="POST";e.data={templateId:this.templateId}},update(){void this.$refs.timeFields.update();void this.$refs.messageFields.update()}},template:`\n\t\t<div class="tasks-field-replication-sheet__history-grid-container">\n\t\t\t<div ref="grid" class="tasks-field-replication-sheet__history-grid-main-content"><GridLoader/></div>\n\t\t\t<TimeFields ref="timeFields" :getGrid="() => this.$refs.grid"/>\n\t\t\t<MessageFields ref="messageFields" :getGrid="() => this.$refs.grid"/>\n\t\t</div>\n\t`};const ae={name:"ReplicationHistorySheets",components:{BottomSheet:k.BottomSheet,ReplicationSheetHeader:Gt,ReplicationHistorySheetContent:ee},props:{sheetBindProps:{type:Object,required:true}},emits:["close","update"],methods:{update(t){this.$emit("update",t)}},template:`\n\t\t<BottomSheet :sheetBindProps @close="$emit('close')">\n\t\t\t<div class="tasks-field-replication-sheet">\n\t\t\t\t<ReplicationSheetHeader\n\t\t\t\t\t:head="loc('TASKS_V2_REPLICATION_HISTORY_SHEET')"\n\t\t\t\t\t@close="$emit('close')"\n\t\t\t\t/>\n\t\t\t\t<ReplicationHistorySheetContent/>\n\t\t\t</div>\n\t\t</BottomSheet>\n\t`};const ie={name:"TaskReplication",components:{BLine:e.BLine,BIcon:A.BIcon,TextXs:I.TextXs,ReplicationContent:St,ReplicationSheet:Xt,ReplicationHistorySheets:ae},inject:{task:{},taskId:{},isEdit:{},isTemplate:{}},props:{isSheetShown:{type:Boolean,required:true},isHistorySheetShown:{type:Boolean,required:true},sheetBindProps:{type:Object,required:true}},emits:["update:isSheetShown","update:isHistorySheetShown"],setup(){return{Outline:A.Outline,replicationMeta:C}},data(){return{logCount:null,isLoading:true}},computed:{historyTitle(){return this.loc("TASKS_V2_REPLICATION_HISTORY",{"#COUNT#":this.logCount})},readonly(){return!this.isTemplate||!this.task.rights.edit}},created(){void this.getLogCount();g.EventEmitter.subscribe(b.EventName.UpdateReplicateParams,this.getLogCount)},unmounted(){g.EventEmitter.unsubscribe(b.EventName.UpdateReplicateParams,this.getLogCount)},methods:{async getLogCount(){if(!this.isEdit||!this.isTemplate){return}this.isLoading=true;const t=_.idUtils.unbox(this.taskId);const{count:e}=await P.apiClient.post(b.Endpoint.TemplateHistoryGetCount,{templateId:t});this.logCount=e!=null?e:0;this.isLoading=false},handleClick(){if(!this.readonly){this.setSheetShown(true)}},setSheetShown(t){this.$emit("update:isSheetShown",t)},setHistorySheetShown(t){this.$emit("update:isHistorySheetShown",t)}},template:`\n\t\t<div\n\t\t\tclass="tasks-full-card-field-container tasks-field-replication"\n\t\t\t:data-task-id="task.id"\n\t\t\t:data-task-field-id="replicationMeta.id"\n\t\t\tdata-field-container\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<ReplicationContent/>\n\t\t</div>\n\t\t<template v-if="isEdit && isTemplate && task.replicate">\n\t\t\t<div v-if="isLoading" class="tasks-field-replication-history">\n\t\t\t\t<BLine :width="120"/>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-else-if="logCount > 0"\n\t\t\t\tclass="tasks-field-replication-history"\n\t\t\t\t@click="setHistorySheetShown(true)"\n\t\t\t>\n\t\t\t\t<TextXs className="tasks-field-replication-history-title">{{ historyTitle }}</TextXs>\n\t\t\t\t<BIcon :name="Outline.CHEVRON_RIGHT_M" color="var(--ui-color-base-4)"/>\n\t\t\t</div>\n\t\t</template>\n\t\t<ReplicationSheet v-if="isSheetShown" :sheetBindProps @close="setSheetShown(false)"/>\n\t\t<ReplicationHistorySheets v-if="isHistorySheetShown" :sheetBindProps @close="setHistorySheetShown(false)"/>\n\t`};const se={name:"ReplicationChip",components:{Chip:M.Chip,ReplicationSheet:Xt},inject:{task:{},taskId:{}},props:{isSheetShown:{type:Boolean,required:true},sheetBindProps:{type:Object,required:true}},emits:["update:isSheetShown"],setup(){return{replicationMeta:C,Outline:A.Outline}},computed:{design(){return this.isSelected?M.ChipDesign.ShadowAccent:M.ChipDesign.ShadowNoAccent},isSelected(){return this.task.filledFields[C.id]},isLocked(){return!w.Core.getParams().restrictions.recurrentTask.available}},methods:{handleClick(){if(this.isLocked){void H.showLimit({featureId:w.Core.getParams().restrictions.recurrentTask.featureId,bindElement:this.$el});return}if(this.isSelected){this.highlightField();return}this.setSheetShown(true)},highlightField(){void O.fieldHighlighter.setContainer(this.$root.$el).highlight(C.id)},setSheetShown(t){this.$emit("update:isSheetShown",t)}},template:`\n\t\t<Chip\n\t\t\t:design\n\t\t\t:icon="Outline.REPEAT"\n\t\t\t:text="loc('TASKS_V2_REPLICATION_TITLE_CHIP')"\n\t\t\t:lock="isLocked"\n\t\t\t:data-task-id="taskId"\n\t\t\t:data-task-chip-id="replicationMeta.id"\n\t\t\t@click="handleClick"\n\t\t/>\n\t\t<ReplicationSheet\n\t\t\tv-if="isSheetShown"\n\t\t\t:sheetBindProps\n\t\t\t@close="setSheetShown(false)"\n\t\t/>\n\t`};t.Replication=ie;t.ReplicationChip=se;t.ReplicationSheet=Xt;t.replicationMeta=C;t.DateStringConverter=Ct;t.TimeStringConverter=rt})(this.BX.Tasks.V2.Component.Fields=this.BX.Tasks.V2.Component.Fields||{},BX.UI.System.Skeleton.Vue,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Vue3,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Fields,BX.UI.Vue3.Components,BX.UI.System.Input.Vue,BX.Tasks.V2.Component.Elements,BX.UI.DatePicker,BX.Tasks.V2.Lib,BX.Tasks.V2.Component.Fields,BX.UI.Vue3.Components,BX.UI.System.Menu,BX.Tasks.V2.Component.Elements,BX.Vue3.Components,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Component.Elements,BX.UI.System.Typography.Vue,BX,BX.Event,BX.Main,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Main,BX.Tasks.V2.Lib,BX.Tasks.V2.Component.Elements,BX.UI.System.Chip.Vue,BX.UI.IconSet,BX,BX.Tasks.V2,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib);
//# sourceMappingURL=replication.bundle.map.js