this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};(function(t,e,s,i,a,n,l,o,h,r){"use strict";const d={name:"AddTaskButton",components:{UiButton:i.Button,Hint:n.Hint},inject:{task:{},taskId:{},isTemplate:{}},props:{size:{type:String,default:i.ButtonSize.LARGE},hasError:{type:Boolean,default:false}},emits:["addTask","copyTask","fromTemplate","update:hasError"],setup(){},data(){return{fieldContainer:null,isPopupShown:false,isLoading:false,errorReason:null}},computed:{...s.mapGetters({taskUserFieldScheme:`${l.Model.Interface}/taskUserFieldScheme`,templateUserFieldScheme:`${l.Model.Interface}/templateUserFieldScheme`}),isUploading(){return h.fileService.get(this.taskId).isUploading()},isCheckListUploading(){var t;return(t=this.task.checklist)==null?void 0:t.some((t=>h.fileService.get(t,h.EntityTypes.CheckListItem).isUploading()))},userFieldScheme(){return this.isTemplate?this.templateUserFieldScheme:this.taskUserFieldScheme},hasUnfilledMandatoryUserFields(){return r.userFieldsManager.hasUnfilledMandatoryFields(this.task.userFields,this.userFieldScheme)},isDisabled(){return this.task.title.trim()===""||this.isUploading||this.isCheckListUploading||this.hasUnfilledMandatoryUserFields||this.isLoading}},watch:{hasError(t){if(t===true){this.isLoading=false}}},methods:{async handleClick(){if(this.isDisabled){this.handleDisabledClick();return}this.isLoading=true;this.$emit("update:hasError",false);if(this.task.copiedFromId){const t=await this.handleCopyTask();if(!t){this.isLoading=false}return}if(this.task.templateId){const t=await this.handleCreateTaskFromTemplate();if(!t){this.isLoading=false}return}this.$emit("addTask")},async handleCopyTask(){let t=false;if(this.task.containsSubTasks){const s={title:this.loc("TASKS_V2_COPY_POPUP_TITLE"),message:this.loc("TASKS_V2_COPY_POPUP_MESSAGE"),yesCaption:this.loc("TASKS_V2_COPY_POPUP_YES"),noCaption:this.loc("TASKS_V2_COPY_POPUP_NO")};t=await this.askPopup(s);if(e.Type.isNull(t)){return false}}this.$emit("copyTask",{withSubTasks:t});return true},async handleCreateTaskFromTemplate(){let t=false;if(this.task.containsSubTasks){const s={title:this.loc("TASKS_V2_CREATE_SUBTASKS_POPUP_TITLE"),message:this.loc("TASKS_V2_CREATE_SUBTASKS_POPUP_MESSAGE"),yesCaption:this.loc("TASKS_V2_CREATE_SUBTASKS_POPUP_YES"),noCaption:this.loc("TASKS_V2_CREATE_SUBTASKS_POPUP_NO")};t=await this.askPopup(s);if(e.Type.isNull(t)){return false}}this.$emit("fromTemplate",{withSubTasks:t});return true},handleDisabledClick(){if(this.task.title.trim()===""){setTimeout((()=>this.highlightTitle()))}else if(this.isUploading){setTimeout((()=>this.highlightFiles()))}else if(this.isCheckListUploading){setTimeout((()=>this.highlightChecklist()))}else if(this.hasUnfilledMandatoryUserFields){setTimeout((()=>this.highlightUserFields()))}},highlightTitle(){this.errorReason=this.loc(this.isTemplate?"TASKS_V2_TEMPLATE_TITLE_IS_EMPTY":"TASKS_V2_TITLE_IS_EMPTY");this.fieldContainer=o.fieldHighlighter.setContainer(this.$root.$el).addHighlight(l.TaskField.Title).getFieldContainer(l.TaskField.Title);this.fieldContainer.querySelector("textarea").focus();this.showPopup()},highlightFiles(){this.errorReason=this.loc("TASKS_V2_FILE_IS_UPLOADING");this.fieldContainer=o.fieldHighlighter.setContainer(this.$root.$el).addChipHighlight(l.TaskField.Files).getChipContainer(l.TaskField.Files);this.showPopup()},highlightChecklist(){this.errorReason=this.loc("TASKS_V2_FILE_IS_UPLOADING");this.fieldContainer=o.fieldHighlighter.setContainer(this.$root.$el).addChipHighlight(l.TaskField.CheckList).getChipContainer(l.TaskField.CheckList);this.showPopup()},highlightUserFields(){this.errorReason=this.loc("TASKS_V2_NOT_FILLED_MANDATORY_USER_FIELDS");this.fieldContainer=o.fieldHighlighter.setContainer(this.$root.$el).addHighlight(l.TaskField.UserFields).scrollToField(l.TaskField.UserFields).getFieldContainer(l.TaskField.UserFields);this.showPopup()},showPopup(){const t=()=>{this.isPopupShown=false;e.Event.unbind(window,"keydown",t)};e.Event.bind(window,"keydown",t);this.isPopupShown=true},askPopup(t){return new Promise((e=>{let s=null;a.MessageBox.show({...t,useAirDesign:true,buttons:a.MessageBoxButtons.YES_NO,onYes:t=>{s=true;t.close()},onNo:t=>{s=false;t.close()},popupOptions:{events:{onClose:()=>{e(s)}}}})}))}},template:`\n\t\t<div\n\t\t\tclass="tasks-add-task-button-container"\n\t\t\t:data-task-id="taskId"\n\t\t\tdata-task-button-id="create"\n\t\t\t@click="handleClick"\n\t\t>\n\t\t\t<UiButton\n\t\t\t\tclass="tasks-add-task-button"\n\t\t\t\t:text="loc('TASKS_V2_ADD_TASK')"\n\t\t\t\t:size\n\t\t\t\t:loading="isLoading && !hasError"\n\t\t\t/>\n\t\t</div>\n\t\t<Hint\n\t\t\tv-if="isPopupShown"\n\t\t\t:bindElement="fieldContainer"\n\t\t\t@close="isPopupShown = false"\n\t\t>\n\t\t\t{{ errorReason }}\n\t\t</Hint>\n\t`};t.AddTaskButton=d})(this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{},BX,BX.Vue3.Vuex,BX.Vue3.Components,BX.UI.Dialogs,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Const,BX.Tasks.V2.Lib,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Component.Fields);
//# sourceMappingURL=add-task-button.bundle.map.js