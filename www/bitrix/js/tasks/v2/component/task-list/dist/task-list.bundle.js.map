{"version":3,"file":"task-list.bundle.js","sources":["../src/field/gantt.js","../src/task-line.js","../src/task-line-skeleton.js","../src/task-list.js"],"sourcesContent":["import { Model } from 'tasks.v2.const';\nimport { HoverPill } from 'tasks.v2.component.elements.hover-pill';\nimport { GanttMenu } from 'tasks.v2.application.gantt-popup';\nimport { ganttService } from 'tasks.v2.provider.service.relation-service';\nimport type { GanttLinkModel } from 'tasks.v2.model.gantt-links';\n\n// @vue/component\nexport const Gantt = {\n\tcomponents: {\n\t\tHoverPill,\n\t\tGanttMenu,\n\t},\n\tinject: {\n\t\tparentTaskId: 'taskId',\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisMenuShown: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tganttLink(): GanttLinkModel\n\t\t{\n\t\t\treturn this.$store.getters[`${Model.GanttLinks}/getLink`]({\n\t\t\t\ttaskId: this.parentTaskId,\n\t\t\t\tdependentId: this.taskId,\n\t\t\t});\n\t\t},\n\t\ttype: {\n\t\t\tget(): string\n\t\t\t{\n\t\t\t\treturn this.ganttLink?.type;\n\t\t\t},\n\t\t\tset(type: string): void\n\t\t\t{\n\t\t\t\tvoid ganttService.updateDependence({\n\t\t\t\t\ttaskId: this.parentTaskId,\n\t\t\t\t\tdependentId: this.taskId,\n\t\t\t\t\ttype,\n\t\t\t\t});\n\t\t\t},\n\t\t},\n\t\ttypeTitle(): string\n\t\t{\n\t\t\treturn this.loc({\n\t\t\t\tfinish_start: 'TASKS_V2_GANTT_FINISH_START',\n\t\t\t\tstart_start: 'TASKS_V2_GANTT_START_START',\n\t\t\t\tstart_finish: 'TASKS_V2_GANTT_START_FINISH',\n\t\t\t\tfinish_finish: 'TASKS_V2_GANTT_FINISH_FINISH',\n\t\t\t}[this.type]);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<HoverPill textOnly noOffset ref=\"type\" @click=\"isMenuShown = true\">\n\t\t\t{{ typeTitle }}\n\t\t</HoverPill>\n\t\t<GanttMenu v-if=\"isMenuShown\" v-model:type=\"type\" :bindElement=\"$refs.type.$el\" @close=\"isMenuShown = false\"/>\n\t`,\n};\n","import { TextMd } from 'ui.system.typography.vue';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { TaskCard } from 'tasks.v2.application.task-card';\nimport { TaskStatus } from 'tasks.v2.const';\nimport { Deadline } from 'tasks.v2.component.fields.deadline';\nimport { Responsible } from 'tasks.v2.component.fields.responsible';\nimport { idUtils } from 'tasks.v2.lib.id-utils';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport { Gantt } from './field/gantt';\nimport './task-line.css';\n\n// @vue/component\nexport const TaskLine = {\n\tcomponents: {\n\t\tTextMd,\n\t\tBIcon,\n\t\tResponsible,\n\t\tDeadline,\n\t\tGantt,\n\t},\n\tprops: {\n\t\ttaskId: {\n\t\t\ttype: [Number, String],\n\t\t\trequired: true,\n\t\t},\n\t\tfields: {\n\t\t\ttype: Set,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['remove'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t};\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisHovered: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\ttask(): TaskModel\n\t\t{\n\t\t\treturn taskService.getStoreTask(this.taskId);\n\t\t},\n\t\tisTemplate(): boolean\n\t\t{\n\t\t\treturn idUtils.isTemplate(this.taskId);\n\t\t},\n\t\tcompleted(): boolean\n\t\t{\n\t\t\treturn this.task.status === TaskStatus.Completed;\n\t\t},\n\t\thref(): string\n\t\t{\n\t\t\tif (String(this.taskId).startsWith('tmp.'))\n\t\t\t{\n\t\t\t\treturn TaskCard.getUrl(idUtils.boxTemplate(this.taskId.replace('tmp.', '')));\n\t\t\t}\n\n\t\t\treturn TaskCard.getUrl(this.taskId);\n\t\t},\n\t\tdetachReadonly(): boolean\n\t\t{\n\t\t\tconst { detachParent, detachRelated, changeDependence } = this.task.rights;\n\t\t\tconst canDetach = detachParent || detachRelated || changeDependence;\n\n\t\t\treturn !canDetach;\n\t\t},\n\t},\n\tmethods: {\n\t\thandleRemove(): void\n\t\t{\n\t\t\tif (!this.detachReadonly)\n\t\t\t{\n\t\t\t\tthis.$emit('remove');\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"tasks-task-line-cross-background\" @mouseover=\"isHovered = true\" @mouseleave=\"isHovered = false\"/>\n\t\t<div class=\"tasks-task-line-title-container\" @mouseover=\"isHovered = true\" @mouseleave=\"isHovered = false\">\n\t\t\t<TextMd class=\"tasks-task-line-title\" :class=\"{ '--completed': completed }\" :title=\"task.title\">\n\t\t\t\t<a :href>{{ task.title }}</a>\n\t\t\t</TextMd>\n\t\t</div>\n\t\t<div v-if=\"fields.has('responsible')\" class=\"tasks-task-line-field\">\n\t\t\t<Responsible :taskId avatarOnly/>\n\t\t</div>\n\t\t<div v-if=\"fields.has('deadline')\" class=\"tasks-task-line-field\">\n\t\t\t<Deadline :taskId :isTemplate compact/>\n\t\t</div>\n\t\t<div v-if=\"fields.has('gantt')\" class=\"tasks-task-line-field\">\n\t\t\t<Gantt :taskId/>\n\t\t</div>\n\t\t<div\n\t\t\tclass=\"tasks-task-line-cross\"\n\t\t\t:class=\"{ '--readonly': detachReadonly, '--hover': isHovered }\"\n\t\t\t@click=\"handleRemove\"\n\t\t\t@mouseover=\"isHovered = true\"\n\t\t\t@mouseleave=\"isHovered = false\"\n\t\t>\n\t\t\t<BIcon :name=\"Outline.CROSS_L\" hoverable/>\n\t\t</div>\n\t`,\n};\n","import { BLine, BCircle } from 'ui.system.skeleton.vue';\nimport './task-line.css';\n\n// @vue/component\nexport const TaskLineSkeleton = {\n\tcomponents: {\n\t\tBLine,\n\t\tBCircle,\n\t},\n\tprops: {\n\t\tfields: {\n\t\t\ttype: Set,\n\t\t\trequired: true,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BLine :width=\"200\" :height=\"10\"/>\n\t\t<BCircle v-if=\"fields.size === 2\" :size=\"25\"/>\n\t\t<BLine :width=\"70\" :height=\"10\" style=\"margin: 0 10px\"/>\n\t\t<div style=\"width: 20px\"/>\n\t`,\n};\n","import { Loc } from 'main.core';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.outline';\n\nimport { Limit } from 'tasks.v2.const';\n\nimport { TaskLine } from './task-line';\nimport { TaskLineSkeleton } from './task-line-skeleton';\nimport './task-list.css';\n\nconst limit = Limit.RelationList;\n\n// @vue/component\nexport const TaskList = {\n\tcomponents: {\n\t\tBIcon,\n\t\tTaskLine,\n\t\tTaskLineSkeleton,\n\t},\n\tprops: {\n\t\tids: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tloadingIds: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tcanOpenMore: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tfields: {\n\t\t\ttype: Set,\n\t\t\tdefault: new Set(['responsible', 'deadline']),\n\t\t},\n\t},\n\temits: ['openMore', 'removeTask'],\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tlimit,\n\t\t};\n\t},\n\tcomputed: {\n\t\tlimitedTasks(): number[]\n\t\t{\n\t\t\treturn this.ids.slice(0, limit);\n\t\t},\n\t\tmoreText(): string\n\t\t{\n\t\t\tconst count = this.ids.length - limit;\n\n\t\t\treturn Loc.getMessagePlural('TASKS_V2_TASK_LIST_MORE', count, {\n\t\t\t\t'#COUNT#': count,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div>\n\t\t\t<div class=\"tasks-task-list\" :style=\"{ '--fields-count': fields.size }\">\n\t\t\t\t<template v-if=\"ids.length === 0\">\n\t\t\t\t\t<div class=\"tasks-task-line-separator\"/>\n\t\t\t\t\t<TaskLineSkeleton :fields/>\n\t\t\t\t</template>\n\t\t\t\t<template v-for=\"taskId in limitedTasks\" :key=\"taskId\">\n\t\t\t\t\t<div class=\"tasks-task-line-separator\"/>\n\t\t\t\t\t<TaskLineSkeleton v-if=\"loadingIds.includes(taskId)\" :fields/>\n\t\t\t\t\t<TaskLine v-else :taskId :fields @remove=\"$emit('removeTask', taskId)\"/>\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"ids.length > limit\"\n\t\t\t\tclass=\"tasks-task-list-more\"\n\t\t\t\t:class=\"{ '--readonly': !canOpenMore }\"\n\t\t\t\t@click=\"$emit('openMore')\"\n\t\t\t>\n\t\t\t\t<div class=\"tasks-task-list-more-text\">{{ moreText }}</div>\n\t\t\t\t<BIcon\n\t\t\t\t\tv-if=\"canOpenMore\"\n\t\t\t\t\tclass=\"tasks-task-list-icon\"\n\t\t\t\t\t:name=\"Outline.CHEVRON_RIGHT_L\"\n\t\t\t\t\thoverable\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n"],"names":["Gantt","components","HoverPill","GanttMenu","inject","parentTaskId","props","taskId","type","Number","String","required","data","isMenuShown","computed","ganttLink","$store","getters","Model","GanttLinks","dependentId","get","set","ganttService","updateDependence","typeTitle","loc","finish_start","start_start","start_finish","finish_finish","template","TaskLine","TextMd","BIcon","Responsible","Deadline","fields","Set","emits","setup","Outline","isHovered","task","taskService","getStoreTask","isTemplate","idUtils","completed","status","TaskStatus","Completed","href","startsWith","TaskCard","getUrl","boxTemplate","replace","detachReadonly","detachParent","detachRelated","changeDependence","rights","canDetach","methods","handleRemove","$emit","TaskLineSkeleton","BLine","BCircle","limit","Limit","RelationList","TaskList","ids","Array","loadingIds","canOpenMore","Boolean","default","limitedTasks","slice","moreText","count","length","Loc","getMessagePlural"],"mappings":";;;;;;;CAMA;AACA,CAAO,MAAMA,KAAK,GAAG;GACpBC,UAAU,EAAE;gBACXC,+CAAS;gBACTC;IACA;GACDC,MAAM,EAAE;KACPC,YAAY,EAAE;IACd;GACDC,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;;IAEX;GACDC,IAAI,GACJ;KACC,OAAO;OACNC,WAAW,EAAE;MACb;IACD;GACDC,QAAQ,EAAE;KACTC,SAAS,GACT;OACC,OAAO,IAAI,CAACC,MAAM,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACC,UAAW,UAAS,CAAC,CAAC;SACzDZ,MAAM,EAAE,IAAI,CAACF,YAAY;SACzBe,WAAW,EAAE,IAAI,CAACb;QAClB,CAAC;MACF;KACDC,IAAI,EAAE;OACLa,GAAG,GACH;SAAA;SACC,0BAAO,IAAI,CAACN,SAAS,qBAAd,gBAAgBP,IAAI;QAC3B;OACDc,GAAG,CAACd,IAAY,EAChB;SACC,KAAKe,sDAAY,CAACC,gBAAgB,CAAC;WAClCjB,MAAM,EAAE,IAAI,CAACF,YAAY;WACzBe,WAAW,EAAE,IAAI,CAACb,MAAM;WACxBC;UACA,CAAC;;MAEH;KACDiB,SAAS,GACT;OACC,OAAO,IAAI,CAACC,GAAG,CAAC;SACfC,YAAY,EAAE,6BAA6B;SAC3CC,WAAW,EAAE,4BAA4B;SACzCC,YAAY,EAAE,6BAA6B;SAC3CC,aAAa,EAAE;QACf,CAAC,IAAI,CAACtB,IAAI,CAAC,CAAC;;IAEd;GACDuB,QAAQ,EAAG;;;;;;CAMZ,CAAC;;CClDD;AACA,CAAO,MAAMC,QAAQ,GAAG;GACvB/B,UAAU,EAAE;aACXgC,+BAAM;YACNC,wBAAK;kBACLC,iDAAW;eACXC,2CAAQ;KACRpC;IACA;GACDM,KAAK,EAAE;KACNC,MAAM,EAAE;OACPC,IAAI,EAAE,CAACC,MAAM,EAAEC,MAAM,CAAC;OACtBC,QAAQ,EAAE;MACV;KACD0B,MAAM,EAAE;OACP7B,IAAI,EAAE8B,GAAG;OACT3B,QAAQ,EAAE;;IAEX;GACD4B,KAAK,EAAE,CAAC,QAAQ,CAAC;GACjBC,KAAK,GACL;KACC,OAAO;gBACNC;MACA;IACD;GACD7B,IAAI,GACJ;KACC,OAAO;OACN8B,SAAS,EAAE;MACX;IACD;GACD5B,QAAQ,EAAE;KACT6B,IAAI,GACJ;OACC,OAAOC,iDAAW,CAACC,YAAY,CAAC,IAAI,CAACtC,MAAM,CAAC;MAC5C;KACDuC,UAAU,GACV;OACC,OAAOC,4BAAO,CAACD,UAAU,CAAC,IAAI,CAACvC,MAAM,CAAC;MACtC;KACDyC,SAAS,GACT;OACC,OAAO,IAAI,CAACL,IAAI,CAACM,MAAM,KAAKC,yBAAU,CAACC,SAAS;MAChD;KACDC,IAAI,GACJ;OACC,IAAI1C,MAAM,CAAC,IAAI,CAACH,MAAM,CAAC,CAAC8C,UAAU,CAAC,MAAM,CAAC,EAC1C;SACC,OAAOC,sCAAQ,CAACC,MAAM,CAACR,4BAAO,CAACS,WAAW,CAAC,IAAI,CAACjD,MAAM,CAACkD,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,CAAC;;OAG7E,OAAOH,sCAAQ,CAACC,MAAM,CAAC,IAAI,CAAChD,MAAM,CAAC;MACnC;KACDmD,cAAc,GACd;OACC,MAAM;SAAEC,YAAY;SAAEC,aAAa;SAAEC;QAAkB,GAAG,IAAI,CAAClB,IAAI,CAACmB,MAAM;OAC1E,MAAMC,SAAS,GAAGJ,YAAY,IAAIC,aAAa,IAAIC,gBAAgB;OAEnE,OAAO,CAACE,SAAS;;IAElB;GACDC,OAAO,EAAE;KACRC,YAAY,GACZ;OACC,IAAI,CAAC,IAAI,CAACP,cAAc,EACxB;SACC,IAAI,CAACQ,KAAK,CAAC,QAAQ,CAAC;;;IAGtB;GACDnC,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;CA0BZ,CAAC;;CC7GD;AACA,CAAO,MAAMoC,gBAAgB,GAAG;GAC/BlE,UAAU,EAAE;YACXmE,4BAAK;cACLC;IACA;GACD/D,KAAK,EAAE;KACN+B,MAAM,EAAE;OACP7B,IAAI,EAAE8B,GAAG;OACT3B,QAAQ,EAAE;;IAEX;GACDoB,QAAQ,EAAG;;;;;;CAMZ,CAAC;;CCXD,MAAMuC,KAAK,GAAGC,oBAAK,CAACC,YAAY;;CAEhC;AACA,OAAaC,QAAQ,GAAG;GACvBxE,UAAU,EAAE;YACXiC,wBAAK;KACLF,QAAQ;KACRmC;IACA;GACD7D,KAAK,EAAE;KACNoE,GAAG,EAAE;OACJlE,IAAI,EAAEmE,KAAK;OACXhE,QAAQ,EAAE;MACV;KACDiE,UAAU,EAAE;OACXpE,IAAI,EAAEmE,KAAK;OACXhE,QAAQ,EAAE;MACV;KACDkE,WAAW,EAAE;OACZrE,IAAI,EAAEsE,OAAO;OACbC,OAAO,EAAE;MACT;KACD1C,MAAM,EAAE;OACP7B,IAAI,EAAE8B,GAAG;OACTyC,OAAO,EAAE,IAAIzC,GAAG,CAAC,CAAC,aAAa,EAAE,UAAU,CAAC;;IAE7C;GACDC,KAAK,EAAE,CAAC,UAAU,EAAE,YAAY,CAAC;GACjCC,KAAK,GACL;KACC,OAAO;gBACNC,0BAAO;OACP6B;MACA;IACD;GACDxD,QAAQ,EAAE;KACTkE,YAAY,GACZ;OACC,OAAO,IAAI,CAACN,GAAG,CAACO,KAAK,CAAC,CAAC,EAAEX,KAAK,CAAC;MAC/B;KACDY,QAAQ,GACR;OACC,MAAMC,KAAK,GAAG,IAAI,CAACT,GAAG,CAACU,MAAM,GAAGd,KAAK;OAErC,OAAOe,aAAG,CAACC,gBAAgB,CAAC,yBAAyB,EAAEH,KAAK,EAAE;SAC7D,SAAS,EAAEA;QACX,CAAC;;IAEH;GACDpD,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA6BZ,CAAC;;;;;;;;"}