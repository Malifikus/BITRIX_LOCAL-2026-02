this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};(function(t,e,a,n,i,s,l,o,d,r,c,u,h,D,p,m,g,S,T,k,U,O,_){"use strict";const f={name:"TasksTaskSetting",components:{Switcher:d.Switcher,TextSm:S.TextSm,QuestionMark:c.QuestionMark,BIcon:k.BIcon},props:{modelValue:{type:Boolean,required:true},label:{type:String,default:""},questionMarkHint:{type:String,default:""},lock:{type:Boolean,default:false},featureId:{type:String,default:""}},emits:["update:modelValue"],setup(){return{Outline:k.Outline}},computed:{switcherOptions(){return{size:o.SwitcherSize.small,useAirDesign:true}},hasLabelSlot(){return Boolean(this.$slots.label)}},methods:{handleContainerClick(){if(this.lock){this.handleLockClick();return}this.$emit("update:modelValue",!this.modelValue)},handleLockClick(){if(!this.featureId){return}void r.showLimit({featureId:this.featureId})}},template:`\n\t\t<div class="tasks-task-setting">\n\t\t\t<div class="tasks-task-setting-switcher">\n\t\t\t\t<Switcher\n\t\t\t\t\t:isChecked="modelValue"\n\t\t\t\t\t:options="switcherOptions"\n\t\t\t\t\t@click="handleContainerClick"\n\t\t\t\t/>\n\t\t\t\t<slot v-if="hasLabelSlot" name="label"/>\n\t\t\t\t<TextSm\n\t\t\t\t\tv-else\n\t\t\t\t\tclass="tasks-task-setting-switcher-label"\n\t\t\t\t\t@click="handleContainerClick"\n\t\t\t\t>{{ label }}</TextSm>\n\t\t\t\t<QuestionMark v-if="questionMarkHint" :hintText="questionMarkHint"/>\n\t\t\t\t<BIcon \n\t\t\t\t\tv-if="lock"\n\t\t\t\t\t:name="Outline.LOCK_M"\n\t\t\t\t\tclass="tasks-task-setting-switcher-lock"\n\t\t\t\t\t@click="handleLockClick"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-if="modelValue && $slots.default" class="tasks-task-setting-content">\n\t\t\t\t<slot/>\n\t\t\t</div>\n\t\t</div>\n\t`};const C={name:"TasksTaskDeadlineDefaultSetting",props:{modelValue:{type:Number,required:true,default:0}},emits:["update:modelValue","updateDeadlineUserOption"],data(){return{periodOptions:[{value:O.DurationUnit.Hours,label:this.loc("TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_PERIOD_HOUR")},{value:O.DurationUnit.Days,label:this.loc("TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_PERIOD_DAY")},{value:O.DurationUnit.Weeks,label:this.loc("TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_PERIOD_WEEK")},{value:O.DurationUnit.Months,label:this.loc("TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_PERIOD_MONTH")}],selectedPeriod:O.DurationUnit.Days,localValue:""}},watch:{modelValue:{immediate:true,handler(t){if(t<=0){this.localValue="";return}const e=this.findBestPeriod(t);this.selectedPeriod=e.period;const a=this.getPeriodInSeconds(e.period);const n=t/a;this.localValue=this.formatValue(n,e.period)}}},methods:{handleBlur(){this.updateModelValue()},findBestPeriod(t){const e=[{period:O.DurationUnit.Months,duration:this.getPeriodInSeconds(O.DurationUnit.Months)},{period:O.DurationUnit.Weeks,duration:this.getPeriodInSeconds(O.DurationUnit.Weeks)},{period:O.DurationUnit.Days,duration:this.getPeriodInSeconds(O.DurationUnit.Days)},{period:O.DurationUnit.Hours,duration:this.getPeriodInSeconds(O.DurationUnit.Hours)}].sort(((t,e)=>e.duration-t.duration));for(const{period:a,duration:n}of e){const e=t/n;if(Number.isInteger(e)&&e>=1){return{period:a,value:e}}}for(const{period:a,duration:n}of e){const e=t/n;if(e>=1&&e<1e3){return{period:a,value:e}}}return{period:O.DurationUnit.Hours,value:t/this.getPeriodInSeconds(O.DurationUnit.Hours)}},formatValue(t,e){if(e===O.DurationUnit.Hours&&t>=24){const e=t/24;if(e===Math.floor(e)){return e.toString()}}if(t%1!==0){return t.toFixed(2).replace(/\.?0+$/,"")}return t.toString()},updateSelectedPeriod(t){this.selectedPeriod=t.target.value;this.updateModelValue()},updateModelValue(){if(!this.localValue||Number.isNaN(parseFloat(this.localValue))){this.$emit("update:modelValue",0);return}const t=parseFloat(this.localValue);if(t<=0){this.$emit("update:modelValue",0);return}this.emitDeadlineUserOptionUpdate(this.selectedPeriod);const e=this.getPeriodInSeconds(this.selectedPeriod);const a=t*e;this.$emit("update:modelValue",Math.round(a))},getPeriodInSeconds(t){const e=D.DurationFormat.getUnitDurations();switch(t){case O.DurationUnit.Hours:return e.H/1e3;case O.DurationUnit.Days:return e.d/1e3;case O.DurationUnit.Weeks:return e.d*7/1e3;case O.DurationUnit.Months:return e.d*30/1e3;default:return e.H/1e3}},emitDeadlineUserOptionUpdate(t){this.$emit("updateDeadlineUserOption",{isExactDeadlineTime:t===O.DurationUnit.Hours})}},template:`\n\t\t<div class="tasks-task-deadline-setting">\n\t\t\t<div class="ui-ctl ui-ctl-textbox">\n\t\t\t\t<input\n\t\t\t\t\ttype="number"\n\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\tv-model.trim="localValue"\n\t\t\t\t\tdata-id="tasks-task-deadline-setting-value"\n\t\t\t\t\t@blur="handleBlur"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="ui-ctl ui-ctl-after-icon ui-ctl-dropdown">\n\t\t\t\t<div class="ui-ctl-after ui-ctl-icon-angle"/>\n\t\t\t\t<select class="ui-ctl-element" :value="selectedPeriod" @change="updateSelectedPeriod">\n\t\t\t\t\t<option\n\t\t\t\t\t\tv-for="option in periodOptions"\n\t\t\t\t\t\t:key="option.value"\n\t\t\t\t\t\t:value="option.value"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ option.label }}\n\t\t\t\t\t</option>\n\t\t\t\t</select>\n\t\t\t</div>\n\t\t</div>\n\t`};const I=Object.freeze({date:"date",count:"count"});const P={name:"TasksTaskDeadlineSettings",components:{BInput:T.BInput,TaskSetting:f,TextSm:S.TextSm,RichLoc:g.RichLoc},inject:{task:{},taskId:{},isEdit:{}},emits:["updateDeadlineUserOption","freeze","unfreeze"],setup(){return{InputDesign:T.InputDesign,Outline:k.Outline}},data(){return{limitDeadline:false,limitType:I.date,isCalendarShown:false,localDeadlineUserOption:{requireDeadlineChangeReason:false,maxDeadlineChangeDate:this.formatDate(this.getDefaultDate()),maxDeadlineChanges:1}}},computed:{...p.mapGetters({deadlineUserOption:`${O.Model.Interface}/deadlineUserOption`}),requireDeadlineChangeReason:{get(){return this.localDeadlineUserOption.requireDeadlineChangeReason===true},set(t){this.localDeadlineUserOption.requireDeadlineChangeReason=t;this.emitDeadlineUserOptionUpdate()}},localMaxDeadlineChangeDate:{get(){return D.DateTimeFormat.parse(this.localDeadlineUserOption.maxDeadlineChangeDate)},set(t){this.localDeadlineUserOption.maxDeadlineChangeDate=this.formatDate(t);this.emitDeadlineUserOptionUpdate()}},localMaxDeadlineChanges:{get(){var t;return String((t=this.localDeadlineUserOption.maxDeadlineChanges)!=null?t:"")},set(t){this.localDeadlineUserOption.maxDeadlineChanges=t===""?1:t;this.emitDeadlineUserOptionUpdate()}},limitByDate(){return this.limitType===I.date},limitByCount(){return this.limitType===I.count}},watch:{isCalendarShown(t){if(t){this.datePicker.show()}else{this.datePicker.hide()}this.$emit(t?"freeze":"unfreeze")}},created(){if(this.isEdit){this.localDeadlineUserOption.requireDeadlineChangeReason=this.task.requireDeadlineChangeReason;this.localDeadlineUserOption.maxDeadlineChangeDate=this.task.maxDeadlineChangeDate;this.localDeadlineUserOption.maxDeadlineChanges=this.task.maxDeadlineChanges}else{this.localDeadlineUserOption.requireDeadlineChangeReason=this.deadlineUserOption.requireDeadlineChangeReason;this.localDeadlineUserOption.maxDeadlineChangeDate=this.deadlineUserOption.maxDeadlineChangeDate;this.localDeadlineUserOption.maxDeadlineChanges=this.deadlineUserOption.maxDeadlineChanges}if(this.localDeadlineUserOption.maxDeadlineChangeDate){void this.switchToDateLimit()}if(this.localDeadlineUserOption.maxDeadlineChanges){this.switchToCountLimit()}this.limitDeadline=Boolean(this.localMaxDeadlineChangeDate||this.localMaxDeadlineChanges)},unmounted(){var t;(t=this.datePicker)==null?void 0:t.destroy()},methods:{createDatePicker(){const t=this.localMaxDeadlineChangeDate?this.localMaxDeadlineChangeDate.getTime():null;return new m.DatePicker({popupOptions:{id:`tasks-deadline-settings-calendar-popup-${h.Text.getRandom()}`,bindElement:this.$refs.calendarInput.$el,offsetTop:-8,bindOptions:{forceBindPosition:true,forceTop:true,position:"top"}},selectedDates:t?[t]:null,enableTime:false,events:{[m.DatePickerEvent.SELECT]:t=>{const{date:e}=t.getData();this.localMaxDeadlineChangeDate=_.calendar.createDateFromUtc(e);this.isCalendarShown=false}}})},emitDeadlineUserOptionUpdate(){const t=this.limitByDate?this.localDeadlineUserOption.maxDeadlineChangeDate:null;const e=this.limitByDate?null:this.localDeadlineUserOption.maxDeadlineChanges;this.$emit("updateDeadlineUserOption",{requireDeadlineChangeReason:this.localDeadlineUserOption.requireDeadlineChangeReason,maxDeadlineChangeDate:this.limitDeadline?t:null,maxDeadlineChanges:this.limitDeadline?e:null})},toggleLimit(){this.limitDeadline=!this.limitDeadline;if(this.limitDeadline&&!this.localDeadlineUserOption.maxDeadlineChangeDate&&!this.localDeadlineUserOption.maxDeadlineChanges){void this.switchToDateLimit()}this.emitDeadlineUserOptionUpdate()},async switchToDateLimit(){if(!this.limitDeadline){this.limitDeadline=true}if(!this.localDeadlineUserOption.maxDeadlineChangeDate){this.localMaxDeadlineChangeDate=this.getDefaultDate()}this.limitType=I.date;await this.$nextTick();this.datePicker=this.createDatePicker();this.emitDeadlineUserOptionUpdate()},switchToCountLimit(){if(!this.limitDeadline){this.limitDeadline=true}if(!this.localDeadlineUserOption.maxDeadlineChanges){this.localMaxDeadlineChanges=1}this.limitType=I.count;this.emitDeadlineUserOptionUpdate()},getDefaultDate(){const t=new Date;return new Date(t.getFullYear(),t.getMonth()+1,t.getDate())},formatDate(t){if(!t){return null}return D.DateTimeFormat.format(D.DateTimeFormat.getFormat("SHORT_DATE_FORMAT"),t)}},template:`\n\t\t<div class="tasks-task-deadline-settings">\n\t\t\t<div class="tasks-task-deadline-settings-line"/>\n\t\t\t<TaskSetting\n\t\t\t\tv-model="requireDeadlineChangeReason"\n\t\t\t\t:label="loc('TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_REASON_LABEL')"\n\t\t\t\t:questionMarkHint="loc('TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_REASON_HINT')"\n\t\t\t/>\n\t\t\t<TaskSetting :modelValue="limitDeadline" @update:modelValue="toggleLimit">\n\t\t\t\t<template #label>\n\t\t\t\t\t<TextSm class="tasks-task-deadline-settings-label">\n\t\t\t\t\t\t<div class="tasks-task-deadline-settings-label-text" @click="toggleLimit">\n\t\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_LIMIT_LABEL') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tasks-task-deadline-settings-label-filter">\n\t\t\t\t\t\t\t<span :class="{'--active': limitByDate}" @click="switchToDateLimit">\n\t\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_LIMIT_BY_DATE') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span :class="{'--active': limitByCount}" @click="switchToCountLimit">\n\t\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_LIMIT_BY_COUNT') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</TextSm>\n\t\t\t\t</template>\n\t\t\t\t<RichLoc\n\t\t\t\t\tv-if="limitByDate"\n\t\t\t\t\tclass="tasks-task-deadline-settings-content --date"\n\t\t\t\t\t:text="loc('TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_BEFORE')"\n\t\t\t\t\tplaceholder="[date/]"\n\t\t\t\t>\n\t\t\t\t\t<template #date>\n\t\t\t\t\t\t<BInput\n\t\t\t\t\t\t\tref="calendarInput"\n\t\t\t\t\t\t\t:modelValue="formatDate(localMaxDeadlineChangeDate)"\n\t\t\t\t\t\t\t:design="InputDesign.LightGrey"\n\t\t\t\t\t\t\t:icon="Outline.CALENDAR_WITH_SLOTS"\n\t\t\t\t\t\t\thoverable\n\t\t\t\t\t\t\tdata-id="tasks-task-deadline-settings-max-date"\n\t\t\t\t\t\t\t@click="isCalendarShown = !isCalendarShown"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</RichLoc>\n\t\t\t\t<RichLoc\n\t\t\t\t\tv-else\n\t\t\t\t\tclass="tasks-task-deadline-settings-content --count"\n\t\t\t\t\t:text="loc('TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_NOT_GREATER_THAN')"\n\t\t\t\t\tplaceholder="[count/]"\n\t\t\t\t>\n\t\t\t\t\t<template #count>\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t\t\tmin="1"\n\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\tv-model.trim="localMaxDeadlineChanges"\n\t\t\t\t\t\t\t\tdata-id="tasks-task-deadline-settings-max-changes"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</RichLoc>\n\t\t\t</TaskSetting>\n\t\t</div>\n\t`};const v={name:"TasksTaskSettings",components:{TaskSetting:f,TaskDeadlineDefaultSetting:C,TaskDeadlineSettings:P},inject:{task:{},taskId:{},isEdit:{}},emits:["updateFlags","updateDeadlineUserOption","freeze","unfreeze"],setup(){},data(){return{localFlags:{needsControl:false,matchesWorkTime:false},localDeadlineUserOption:{defaultDeadlineInSeconds:0,canChangeDeadline:false,maxDeadlineChangeDate:null,maxDeadlineChanges:null},localAutocompleteSubTasks:false}},computed:{...p.mapGetters({stateFlags:`${O.Model.Interface}/stateFlags`,deadlineUserOption:`${O.Model.Interface}/deadlineUserOption`}),isDefaultDeadlineActive:{get(){return this.localDeadlineUserOption.defaultDeadlineInSeconds>0},set(t){this.localDeadlineUserOption.defaultDeadlineInSeconds=t?this.defaultDeadlineSeconds:0;this.emitDeadlineUserOptionUpdate({defaultDeadlineInSeconds:this.localDeadlineUserOption.defaultDeadlineInSeconds})}},defaultDeadlineSeconds:{get(){if(!this.localDeadlineUserOption.defaultDeadlineInSeconds){const t=D.DurationFormat.getUnitDurations();return t.d*5/1e3}return this.localDeadlineUserOption.defaultDeadlineInSeconds},set(t){this.localDeadlineUserOption.defaultDeadlineInSeconds=t;this.emitDeadlineUserOptionUpdate({defaultDeadlineInSeconds:this.localDeadlineUserOption.defaultDeadlineInSeconds})}},autocompleteSubTasks:{get(){return this.localAutocompleteSubTasks===true},set(t){this.localAutocompleteSubTasks=t;this.emitFlagsUpdate({autocompleteSubTasks:t})}},taskControl:{get(){return this.localFlags.needsControl===true},set(t){this.localFlags.needsControl=t;this.emitFlagsUpdate({needsControl:t})}},canChangeDeadline:{get(){return this.localDeadlineUserOption.canChangeDeadline===true},set(t){this.localDeadlineUserOption.canChangeDeadline=t;if(!t){this.localDeadlineUserOption.maxDeadlineChangeDate=null;this.localDeadlineUserOption.maxDeadlineChanges=null}this.emitDeadlineUserOptionUpdate({allowsChangeDeadline:t,canChangeDeadline:t,maxDeadlineChangeDate:null,maxDeadlineChanges:null})}},matchesWorkTime:{get(){return this.localFlags.matchesWorkTime===true},set(t){this.localFlags.matchesWorkTime=t;this.emitFlagsUpdate({matchesWorkTime:t})}},isMatchesWorkTimeLocked(){return!l.Core.getParams().restrictions.skipWeekends.available},matchesWorkTimeFeatureId(){return l.Core.getParams().restrictions.skipWeekends.featureId},isTaskControlLocked(){return!l.Core.getParams().restrictions.control.available},taskControlFeatureId(){return l.Core.getParams().restrictions.control.featureId},isAutocompleteSubTasksLocked(){return!l.Core.getParams().restrictions.relatedSubtaskDeadlines.available},autocompleteSubTasksFeatureId(){return l.Core.getParams().restrictions.relatedSubtaskDeadlines.featureId}},created(){this.localDeadlineUserOption.defaultDeadlineInSeconds=this.deadlineUserOption.defaultDeadlineInSeconds;if(this.isEdit){this.localFlags.needsControl=this.isTaskControlLocked?false:this.task.needsControl;this.localFlags.matchesWorkTime=this.isMatchesWorkTimeLocked?false:this.task.matchesWorkTime;this.localDeadlineUserOption.canChangeDeadline=this.task.allowsChangeDeadline;this.localDeadlineUserOption.maxDeadlineChangeDate=this.task.maxDeadlineChangeDate;this.localDeadlineUserOption.maxDeadlineChanges=this.task.maxDeadlineChanges}else{this.localFlags.needsControl=this.stateFlags.needsControl;this.localFlags.matchesWorkTime=this.stateFlags.matchesWorkTime;this.localDeadlineUserOption.canChangeDeadline=this.deadlineUserOption.canChangeDeadline;this.localDeadlineUserOption.maxDeadlineChangeDate=this.deadlineUserOption.maxDeadlineChangeDate;this.localDeadlineUserOption.maxDeadlineChanges=this.deadlineUserOption.maxDeadlineChanges}this.localAutocompleteSubTasks=this.task.autocompleteSubTasks},methods:{emitFlagsUpdate(t){this.$emit("updateFlags",t)},emitDeadlineUserOptionUpdate(t){this.$emit("updateDeadlineUserOption",t)}},template:`\n\t\t<div class="tasks-task-settings">\n\t\t\t<TaskSetting\n\t\t\t\tv-model="taskControl"\n\t\t\t\t:label="loc('TASKS_V2_TASK_SETTINGS_POPUP_CONTROL_LABEL')"\n\t\t\t\t:questionMarkHint="loc('TASKS_V2_TASK_SETTINGS_POPUP_CONTROL_HINT')"\n\t\t\t\t:lock="isTaskControlLocked"\n\t\t\t\t:featureId="taskControlFeatureId"\n\t\t\t/>\n\t\t\t<TaskSetting\n\t\t\t\tv-model="isDefaultDeadlineActive"\n\t\t\t\t:label="loc('TASKS_V2_TASK_SETTINGS_POPUP_DEADLINE_LABEL')"\n\t\t\t>\n\t\t\t\t<TaskDeadlineDefaultSetting\n\t\t\t\t\tv-if="isDefaultDeadlineActive"\n\t\t\t\t\tv-model="defaultDeadlineSeconds"\n\t\t\t\t\t@updateDeadlineUserOption="(data) => $emit('updateDeadlineUserOption', data)"\n\t\t\t\t/>\n\t\t\t</TaskSetting>\n\t\t\t<TaskSetting\n\t\t\t\tv-model="canChangeDeadline"\n\t\t\t\t:label="loc('TASKS_V2_TASK_SETTINGS_POPUP_DEADLINES_LABEL')"\n\t\t\t>\n\t\t\t\t<TaskDeadlineSettings\n\t\t\t\t\tv-if="canChangeDeadline"\n\t\t\t\t\t@updateDeadlineUserOption="(data) => $emit('updateDeadlineUserOption', data)"\n\t\t\t\t\t@freeze="$emit('freeze')"\n\t\t\t\t\t@unfreeze="$emit('unfreeze')"\n\t\t\t\t/>\n\t\t\t</TaskSetting>\n\t\t\t<TaskSetting\n\t\t\t\tv-model="matchesWorkTime"\n\t\t\t\t:label="loc('TASKS_V2_TASK_SETTINGS_POPUP_WORK_TIME_LABEL')"\n\t\t\t\t:questionMarkHint="loc('TASKS_V2_TASK_SETTINGS_POPUP_WORK_TIME_HINT')"\n\t\t\t\t:lock="isMatchesWorkTimeLocked"\n\t\t\t\t:featureId="matchesWorkTimeFeatureId"\n\t\t\t/>\n\t\t\t<TaskSetting\n\t\t\t\tv-model="autocompleteSubTasks"\n\t\t\t\t:label="loc('TASKS_V2_TASK_SETTINGS_POPUP_AUTO_COMPLETE_SUBTASKS_LABEL')"\n\t\t\t\t:lock="isAutocompleteSubTasksLocked"\n\t\t\t\t:featureId="autocompleteSubTasksFeatureId"\n\t\t\t/>\n\t\t</div>\n\t`};const E={name:"TaskSettingsPopup",components:{BIcon:k.BIcon,UiButton:e.Button,QuestionMark:c.QuestionMark,Popup:a.Popup,TaskSettings:v},inject:{task:{},taskId:{},isEdit:{}},props:{bindElement:{type:HTMLElement,default:null}},emits:["close"],setup(){return{AirButtonStyle:e.AirButtonStyle,ButtonSize:e.ButtonSize,Outline:k.Outline}},data(){return{pendingFlagsData:{},pendingDeadlineUserOption:{},saving:false}},computed:{...p.mapGetters({stateFlags:`${O.Model.Interface}/stateFlags`,deadlineUserOption:`${O.Model.Interface}/deadlineUserOption`}),options(){return{id:`tasks-settings-popup-${this.taskId}`,className:"tasks-task-settings-popup",bindElement:this.bindElement,width:530,targetContainer:document.body}}},methods:{handleClose(){this.$emit("close")},async handleSave(){this.saving=true;const t=this.pendingDeadlineUserOption.maxDeadlineChanges&&this.task.maxDeadlineChanges!==this.pendingDeadlineUserOption.maxDeadlineChanges;if(this.isEdit&&t){void n.deadlineService.cleanChangeLog(this.task.id)}if(this.isEdit){if(!h.Type.isNil(this.pendingDeadlineUserOption.defaultDeadlineInSeconds)){await this.$store.dispatch(`${O.Model.Interface}/updateDeadlineUserOption`,{defaultDeadlineInSeconds:this.pendingDeadlineUserOption.defaultDeadlineInSeconds});void s.stateService.set({defaultDeadline:this.deadlineUserOption})}}else{await this.$store.dispatch(`${O.Model.Interface}/updateStateFlags`,this.pendingFlagsData);await this.$store.dispatch(`${O.Model.Interface}/updateDeadlineUserOption`,this.pendingDeadlineUserOption);void s.stateService.set({needsControl:this.stateFlags.needsControl,matchesWorkTime:this.stateFlags.matchesWorkTime,defaultRequireResult:this.stateFlags.defaultRequireResult,defaultDeadline:this.deadlineUserOption})}await i.taskService.update(this.taskId,{...this.pendingFlagsData,...this.pendingDeadlineUserOption});this.$emit("close");this.saving=false},handleFlagsUpdate(t){this.pendingFlagsData={...this.pendingFlagsData,...t}},handleDeadlineUserOptionUpdate(t){this.pendingDeadlineUserOption={...this.pendingDeadlineUserOption,...t}},freeze(){var t;(t=this.$refs.popup)==null?void 0:t.freeze()},unfreeze(){var t;(t=this.$refs.popup)==null?void 0:t.unfreeze()}},template:`\n\t\t<Popup ref="popup" :options @close="handleClose">\n\t\t\t<div class="tasks-task-settings-popup-header">\n\t\t\t\t<div class="tasks-task-settings-popup-title-container">\n\t\t\t\t\t<div class="tasks-task-settings-popup-title">\n\t\t\t\t\t\t{{ loc('TASKS_V2_TASK_SETTINGS_POPUP_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<QuestionMark :hintText="loc('TASKS_V2_TASK_SETTINGS_POPUP_TITLE_HINT')"/>\n\t\t\t\t</div>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="Outline.CROSS_L"\n\t\t\t\t\thoverable\n\t\t\t\t\tclass="tasks-task-settings-popup-close-icon"\n\t\t\t\t\t@click="handleClose"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="tasks-task-settings-popup-content">\n\t\t\t\t<TaskSettings\n\t\t\t\t\t@updateFlags="handleFlagsUpdate"\n\t\t\t\t\t@updateDeadlineUserOption="handleDeadlineUserOptionUpdate"\n\t\t\t\t\t@freeze="freeze"\n\t\t\t\t\t@unfreeze="unfreeze"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class="tasks-task-settings-popup-footer">\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="loc('TASKS_V2_TASK_SETTINGS_POPUP_BTN_CANCEL')"\n\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t:style="AirButtonStyle.PLAIN"\n\t\t\t\t\t:dataset="{\n\t\t\t\t\t\ttaskSettingsButtonId: 'cancel',\n\t\t\t\t\t}"\n\t\t\t\t\t@click="handleClose"\n\t\t\t\t/>\n\t\t\t\t<UiButton\n\t\t\t\t\t:text="loc('TASKS_V2_TASK_SETTINGS_POPUP_BTN_SAVE')"\n\t\t\t\t\t:size="ButtonSize.MEDIUM"\n\t\t\t\t\t:style="AirButtonStyle.FILLED"\n\t\t\t\t\t:dataset="{\n\t\t\t\t\t\ttaskSettingsButtonId: 'save',\n\t\t\t\t\t}"\n\t\t\t\t\t:loading="saving"\n\t\t\t\t\t@click="handleSave"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</Popup>\n\t`};t.TaskSettingsPopup=E})(this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{},BX.Vue3.Components,BX.UI.Vue3.Components,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service,BX.Tasks.V2.Provider.Service,BX.Tasks.V2,BX.UI,BX.UI.Vue3.Components,BX.Tasks.V2.Lib,BX.Tasks.V2.Component.Elements,BX,BX,BX.Main,BX.Vue3.Vuex,BX.UI.DatePicker,BX.UI.Vue3.Components,BX.UI.System.Typography.Vue,BX.UI.System.Input.Vue,BX.UI.IconSet,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Lib);
//# sourceMappingURL=task-settings-popup.bundle.map.js