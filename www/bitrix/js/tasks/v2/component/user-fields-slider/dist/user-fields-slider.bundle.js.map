{"version":3,"file":"user-fields-slider.bundle.js","sources":["../src/user-fields-slider.js"],"sourcesContent":["import { Text, Loc, Type, Dom } from 'main.core';\n\nimport { Notifier } from 'ui.notification-manager';\nimport type { Store } from 'ui.vue3.vuex';\n\nimport { idUtils } from 'tasks.v2.lib.id-utils';\nimport { Model, Endpoint } from 'tasks.v2.const';\nimport { Core } from 'tasks.v2.core';\nimport { apiClient } from 'tasks.v2.lib.api-client';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport { templateService } from 'tasks.v2.provider.service.template-service';\nimport { userFieldsMeta } from 'tasks.v2.component.fields.user-fields';\n\nimport './user-fields-slider.css';\n\nexport type UserFieldsSliderOpenParams = {\n\ttaskId: number | string,\n\tisTemplate: boolean,\n\ttemplateId: number | null,\n\tcopiedFromId: number | string | null,\n};\n\nclass UserFieldsSlider\n{\n\t#cacheContent: Map<number, HTMLElement>;\n\t#cacheRequest: Map<number, string>;\n\t#currentParams: UserFieldsSliderOpenParams;\n\n\tconstructor()\n\t{\n\t\tthis.#cacheContent = new Map();\n\t\tthis.#cacheRequest = new Map();\n\t\tthis.#currentParams = {};\n\t}\n\n\tasync open(params: UserFieldsSliderOpenParams): void\n\t{\n\t\tthis.#currentParams = params;\n\n\t\tif (this.#cacheContent.has(this.#currentTaskId))\n\t\t{\n\t\t\tconst userFieldsElement = this.#cacheContent.get(this.#currentTaskId);\n\t\t\tif (userFieldsElement)\n\t\t\t{\n\t\t\t\tthis.#openSlider(userFieldsElement);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst content = await this.#getContent();\n\n\t\tconst userFieldsElement = document.createElement('div');\n\t\tBX.Runtime.html(userFieldsElement, content, { useAdjacentHTML: true });\n\n\t\tthis.#cacheContent.set(this.#currentTaskId, userFieldsElement);\n\t\tthis.#openSlider(userFieldsElement);\n\t}\n\n\tasync #getContent(): Promise<string>\n\t{\n\t\tif (this.#cacheRequest.has(this.#currentTaskId))\n\t\t{\n\t\t\treturn this.#cacheRequest.get(this.#currentTaskId);\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tlet html = '';\n\t\t\tif (this.#currentCopiedFromId)\n\t\t\t{\n\t\t\t\tif (this.#currentIsTemplate)\n\t\t\t\t{\n\t\t\t\t\tconst id = idUtils.unbox(this.#currentCopiedFromId);\n\n\t\t\t\t\thtml = await this.#getTemplateContent(id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst id = Type.isNumber(this.#currentCopiedFromId) ? this.#currentCopiedFromId : 0;\n\n\t\t\t\t\thtml = await this.#getTasksContent(id);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.#currentIsTemplate)\n\t\t\t{\n\t\t\t\tconst id = idUtils.unbox(this.#currentTaskId);\n\n\t\t\t\thtml = await this.#getTemplateContent(id);\n\t\t\t}\n\t\t\telse if (this.#currentTemplateId)\n\t\t\t{\n\t\t\t\tconst id = this.#currentTemplateId ?? 0;\n\n\t\t\t\thtml = await this.#getTemplateContent(id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst id = Type.isNumber(this.#currentTaskId) ? this.#currentTaskId : 0;\n\n\t\t\t\thtml = await this.#getTasksContent(id);\n\t\t\t}\n\n\t\t\tconst content = this.#render(html);\n\n\t\t\tthis.#cacheRequest.set(this.#currentTaskId, content);\n\n\t\t\treturn content;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('UserFieldsSlider.#getContent error', error);\n\n\t\t\treturn '';\n\t\t}\n\t}\n\n\tasync #getTasksContent(id): Promise<string>\n\t{\n\t\tconst data = await apiClient.post(Endpoint.LegacyUserFieldGetTask, { task: { id } });\n\n\t\treturn data?.html ?? '';\n\t}\n\n\tasync #getTemplateContent(id): Promise<string>\n\t{\n\t\tconst data = await apiClient.post(Endpoint.LegacyUserFieldGetTemplate, { template: { id } });\n\n\t\treturn data?.html ?? '';\n\t}\n\n\t#openSlider(content: HTMLElement): void\n\t{\n\t\tconst sidePanelId = `tasks-task-legacy-user-fields-${Text.getRandom()}`;\n\t\tconst maxWidth = 800;\n\n\t\tBX.SidePanel.Instance.open(sidePanelId, {\n\t\t\tcustomLeftBoundary: 0,\n\t\t\twidth: maxWidth,\n\t\t\tcacheable: false,\n\t\t\tcustomRightBoundary: 0,\n\t\t\tcontentCallback: () => content,\n\t\t\tevents: {\n\t\t\t\tonCloseComplete: () => this.#handleSliderClose(),\n\t\t\t},\n\t\t});\n\t}\n\n\t#handleSliderClose(): void\n\t{\n\t\t// Hacks for BX.calendar\n\t\tconst calendar = BX.calendar?.get();\n\n\t\tif (!calendar)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (calendar.popup)\n\t\t{\n\t\t\tcalendar.popup.destroy();\n\t\t\tcalendar.popup = null;\n\t\t\t// eslint-disable-next-line no-underscore-dangle,@bitrix24/bitrix24-rules/no-pseudo-private\n\t\t\tcalendar._layers = {};\n\t\t\t// eslint-disable-next-line no-underscore-dangle,@bitrix24/bitrix24-rules/no-pseudo-private\n\t\t\tcalendar._current_layer = null;\n\t\t}\n\n\t\tif (calendar.popup_month)\n\t\t{\n\t\t\tcalendar.popup_month.destroy();\n\t\t\tcalendar.popup_month = null;\n\t\t}\n\n\t\tif (calendar.popup_year)\n\t\t{\n\t\t\tcalendar.popup_year.destroy();\n\t\t\tcalendar.popup_year = null;\n\t\t}\n\t}\n\n\t#render(html): string\n\t{\n\t\treturn `\n\t\t\t<div class=\"tasks-task-full-card-user-fields\">\n\t\t\t\t${this.#renderTitle()}\n\t\t\t\t${this.#renderContent(html)}\n\t\t\t\t${this.#renderFooter()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderContent(html): string\n\t{\n\t\treturn `\n\t\t\t<div class=\"tasks-task-full-card-user-fields-content\" id=\"user-fields-slider-content\">\n\t\t\t\t${html}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderTitle(): string\n\t{\n\t\treturn `\n\t\t\t<div class=\"tasks-task-full-card-user-fields-title\">\n\t\t\t\t${userFieldsMeta.title}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderFooter(): string\n\t{\n\t\treturn `\n\t\t\t<div class=\"tasks-task-full-card-user-fields-footer\">\n\t\t\t\t${this.#renderConfirmButton()}\n\t\t\t\t${this.#renderCancelButton()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderConfirmButton(): string\n\t{\n\t\treturn `\n\t\t\t<button class=\"ui-btn --air ui-btn-lg --style-filled ui-btn-no-caps\" onclick=\"top.BX.Tasks.V2.Component.userFieldsSlider.handleConfirm();\">\n\t\t\t\t<span class=\"ui-btn-text\">\n\t\t\t\t\t<span class=\"ui-btn-text-inner\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_V2_USER_FIELDS_SLIDER_CONFIRM')}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t`;\n\t}\n\n\t#renderCancelButton(): string\n\t{\n\t\treturn `\n\t\t\t<button class=\"ui-btn --air ui-btn-lg --style-plain ui-btn-no-caps\" onclick=\"top.BX.SidePanel.Instance.close();\">\n\t\t\t\t<span class=\"ui-btn-text\">\n\t\t\t\t\t<span class=\"ui-btn-text-inner\">\n\t\t\t\t\t\t${Loc.getMessage('TASKS_V2_USER_FIELDS_SLIDER_CANCEL')}\n\t\t\t\t\t</span>\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t`;\n\t}\n\n\tasync handleConfirm(): void\n\t{\n\t\tconst container = document.getElementById('user-fields-slider-content');\n\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { userFields, scheme } = this.#collectUserFieldsData(container);\n\n\t\tif (this.#currentIsTemplate)\n\t\t{\n\t\t\tawait this.$store.dispatch(`${Model.Interface}/updateTemplateUserFieldScheme`, scheme);\n\n\t\t\tvoid this.updateTemplateUserFields(userFields);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tawait this.$store.dispatch(`${Model.Interface}/updateTaskUserFieldScheme`, scheme);\n\n\t\t\tvoid this.updateTaskUserFields(userFields);\n\t\t}\n\n\t\tBX.SidePanel.Instance.close();\n\t}\n\n\tasync updateTaskUserFields(userFields: Array): void\n\t{\n\t\tconst result = await taskService.update(this.#currentTaskId, { userFields });\n\n\t\tif (result[Endpoint.TaskUpdate]?.length)\n\t\t{\n\t\t\tconst error = result[Endpoint.TaskUpdate][0];\n\n\t\t\tthis.#showError(error);\n\t\t}\n\t}\n\n\tasync updateTemplateUserFields(userFields: Array): void\n\t{\n\t\tconst result = await templateService.update(this.#currentTaskId, { userFields });\n\n\t\tif (result[Endpoint.TemplateUpdate]?.length)\n\t\t{\n\t\t\tconst error = result[Endpoint.TemplateUpdate][0];\n\n\t\t\tthis.#showError(error);\n\t\t}\n\t}\n\n\t#convertToArray(userFields: Object): Array\n\t{\n\t\treturn Object.keys(userFields).map((key) => {\n\t\t\treturn {\n\t\t\t\tkey,\n\t\t\t\tvalue: this.#prepareValue(userFields[key]),\n\t\t\t};\n\t\t});\n\t}\n\n\t#collectUserFieldsData(container: HTMLElement): Object\n\t{\n\t\tconst result = {};\n\t\tconst scheme = [];\n\n\t\tconst inputs = container.querySelectorAll(\n\t\t\t'input[name^=\"USER_FIELDS[\"], select[name^=\"USER_FIELDS[\"], textarea[name^=\"USER_FIELDS[\"]',\n\t\t);\n\n\t\tinputs.forEach((input) => {\n\t\t\tconst name = input.getAttribute('name');\n\t\t\tif (!name)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst match = name.match(/USER_FIELDS\\[([^\\]]+)](\\[])?/);\n\t\t\tif (!match)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst fieldKey = match[1];\n\t\t\tconst isMultiple = Boolean(match[2]);\n\n\t\t\tconst fieldContainer = input.closest('.js-id-item-set-item');\n\n\t\t\tif (fieldContainer && !scheme.some((item) => item.fieldName === fieldKey))\n\t\t\t{\n\t\t\t\tscheme.push(this.#buildSchemeEntry(fieldContainer, fieldKey));\n\t\t\t}\n\n\t\t\tlet value = null;\n\t\t\tif (input.type === 'checkbox')\n\t\t\t{\n\t\t\t\tif (input.checked)\n\t\t\t\t{\n\t\t\t\t\tvalue = input.value;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvalue = input.value;\n\t\t\t}\n\n\t\t\tif (isMultiple)\n\t\t\t{\n\t\t\t\tresult[fieldKey] ??= [];\n\t\t\t\tresult[fieldKey].push(value);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult[fieldKey] = value;\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tscheme,\n\t\t\tuserFields: this.#convertToArray(result),\n\t\t};\n\t}\n\n\t#buildSchemeEntry(fieldContainer: HTMLElement, fieldName: string): Object\n\t{\n\t\tconst id = Number(fieldContainer.getAttribute('data-item-value'));\n\t\tconst userTypeId = fieldContainer.getAttribute('data-type') || 'string';\n\t\tconst multiple = fieldContainer.getAttribute('data-multiple') === '1';\n\t\tconst mandatory = Dom.hasClass(fieldContainer, 'required');\n\t\tconst labelElement = fieldContainer.querySelector('.js-id-item-set-item-label');\n\t\tconst editFormLabel = labelElement ? labelElement.textContent.trim() : fieldName;\n\n\t\treturn {\n\t\t\tid,\n\t\t\tmandatory,\n\t\t\teditFormLabel,\n\t\t\tuserTypeId,\n\t\t\tmultiple,\n\t\t\tfieldName,\n\t\t\tentityId: this.#getEntityId(),\n\t\t};\n\t}\n\n\t#getEntityId(): string\n\t{\n\t\treturn this.#currentIsTemplate ? 'TASKS_TASK_TEMPLATE' : 'TASKS_TASK';\n\t}\n\n\t#prepareValue(value: any): ?any\n\t{\n\t\tif (value === '')\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (Type.isArray(value) && value.every((item) => item === ''))\n\t\t{\n\t\t\treturn [''];\n\t\t}\n\n\t\treturn value;\n\t}\n\n\t#showError(error): void\n\t{\n\t\tNotifier.notifyViaBrowserProvider({\n\t\t\tid: 'tasks-user-fields-update-error',\n\t\t\ttext: error?.message,\n\t\t});\n\t}\n\n\tget #currentTaskId(): number | string\n\t{\n\t\treturn this.#currentParams.taskId;\n\t}\n\n\tget #currentIsTemplate(): boolean\n\t{\n\t\treturn this.#currentParams.isTemplate;\n\t}\n\n\tget #currentTemplateId(): number | null\n\t{\n\t\treturn this.#currentParams.templateId;\n\t}\n\n\tget #currentCopiedFromId(): number | string | null\n\t{\n\t\treturn this.#currentParams.copiedFromId;\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n\nexport const userFieldsSlider = new UserFieldsSlider();\n"],"names":["UserFieldsSlider","constructor","Map","open","params","has","userFieldsElement","get","content","document","createElement","BX","Runtime","html","useAdjacentHTML","set","handleConfirm","container","getElementById","userFields","scheme","$store","dispatch","Model","Interface","updateTemplateUserFields","updateTaskUserFields","SidePanel","Instance","close","result","taskService","update","Endpoint","TaskUpdate","length","error","templateService","TemplateUpdate","Core","getStore","id","idUtils","unbox","Type","isNumber","console","data","apiClient","post","LegacyUserFieldGetTask","task","LegacyUserFieldGetTemplate","template","sidePanelId","Text","getRandom","maxWidth","customLeftBoundary","width","cacheable","customRightBoundary","contentCallback","events","onCloseComplete","calendar","popup","destroy","_layers","_current_layer","popup_month","popup_year","userFieldsMeta","title","Loc","getMessage","Object","keys","map","key","value","inputs","querySelectorAll","forEach","input","name","getAttribute","match","fieldKey","isMultiple","Boolean","fieldContainer","closest","some","item","fieldName","push","type","checked","Number","userTypeId","multiple","mandatory","Dom","hasClass","labelElement","querySelector","editFormLabel","textContent","trim","entityId","isArray","every","Notifier","notifyViaBrowserProvider","text","message","taskId","isTemplate","templateId","copiedFromId","userFieldsSlider"],"mappings":"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"}