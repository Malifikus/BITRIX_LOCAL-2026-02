this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,i){"use strict";const n=/((https?:\/\/(www\.)?)|(www\.))[\w#%+.:=@~-]{1,256}\.[\d()A-Za-z]{1,6}\b([\w#%&()+./:=?@[\]~-]*)(?<![%()+.:\]-])/;const s=/(([^\s"(),.:;<>@[\\\]]+(\.[^\s"(),.:;<>@[\\\]]+)*)|(".+"))@((\[(?:\d{1,3}\.){3}\d{1,3}])|(([\dA-Za-z-]+\.)+[A-Za-z]{2,}))/;const r=/[\s(),.;[\]]/;function l(t,e=t=>t){return i=>{const n=t.exec(i);if(n===null){return null}return{index:n.index,length:n[0].length,text:n[0],url:e(n[0])}}}const a=[l(n,(t=>t.startsWith("http")?t:`https://${t}`)),l(s,(t=>`mailto:${t}`))];const o={name:"GrowingTextArea",directives:{hint:i.hint},props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},fontColor:{type:String,default:"var(--ui-color-base-1)"},linkColor:{type:String,default:"var(--ui-color-accent-main-link)"},fontSize:{type:Number,default:21},fontWeight:{type:[Number,String],default:"inherit"},lineHeight:{type:Number,default:29},readonly:{type:Boolean,default:false}},emits:["update:modelValue","input","focus","blur","emptyFocus","emptyBlur","enterBlur","linkClick"],data(){return{focus:false,overflowing:false}},computed:{isEmpty(){return this.modelValue.trim()===""},isDisplay(){return!this.isEmpty&&!this.focus&&(this.overflowing||this.hasLinks)},linkMatches(){return this.findLinkMatches(this.modelValue)},hasLinks(){return this.linkMatches.length>0},displayHtml(){return this.getLinkifiedHtml(this.modelValue,this.linkMatches)},tooltip(){if(!this.overflowing){return null}return()=>({html:this.displayHtml,interactivity:true,popupOptions:{className:"b24-growing-text-area-popup",bindElement:this.$el,offsetLeft:40,maxWidth:440,maxHeight:360,angle:{offset:40},darkMode:false,targetContainer:document.body}})}},mounted(){requestAnimationFrame((()=>{if(this.isEmpty){this.focusToEnd()}this.overflowing=this.isOverflowing();void this.adjustTextareaHeight()}))},methods:{getLinkifiedHtml(t,i){if(!e.Type.isStringFilled(t)){return""}if(!Array.isArray(i)||i.length===0){return e.Text.encode(t)}let n="";let s=0;i.forEach((i=>{n+=e.Text.encode(t.slice(s,i.start));const r=e.Text.encode(i.href);const l=e.Text.encode(i.text);n+=`\n\t\t\t\t\t<a\n\t\t\t\t\t\tclass="b24-growing-text-area-link"\n\t\t\t\t\t\thref="${r}"\n\t\t\t\t\t\ttarget="_blank"\n\t\t\t\t\t\trel="noopener noreferrer"\n\t\t\t\t\t\tstyle="color: ${this.linkColor};"\n\t\t\t\t\t>${l}</a>\n\t\t\t\t`.trim();s=i.end}));n+=e.Text.encode(t.slice(s));return n},findLinkMatches(t){if(!e.Type.isStringFilled(t)){return[]}const i=[];let n=t;let s=0;let r=this.getFirstLinkMatch(n);while(r){const e=s+r.index;const l=e+r.length;if(this.isMatchBoundariesValid(t,e,l)){i.push({start:e,end:l,text:r.text,href:r.url})}const a=r.index+r.length;s+=a;n=n.slice(a);r=this.getFirstLinkMatch(n)}return i},getFirstLinkMatch(t){if(!e.Type.isStringFilled(t)){return null}for(const e of a){const i=e(t);if(i){return i}}return null},isMatchBoundariesValid(t,e,i){const n=e>0?t[e-1]:"";const s=i<t.length?t[i]:"";return this.isSeparator(n)&&this.isSeparator(s)},isSeparator(t){if(!e.Type.isStringFilled(t)){return true}return r.test(t)},isOverflowing(){const t=this.$refs.textarea;const e=this.$refs.display;if(t){const e=this.lineHeight*3;return t.scrollHeight>e}if(e){return e.offsetHeight>=60}return false},async adjustTextareaHeight(){const t=this.$refs.textarea;if(!t){return}e.Dom.style(t,"height","auto");const i=this.lineHeight*3;const n=Math.min(t.scrollHeight,i);this.overflowing=this.isOverflowing();e.Dom.style(t,"height",`${n}px`);e.Dom.style(t,"maxHeight",`${i}px`)},focusToEnd(){const t=this.$refs.textarea;if(!t){return}if(this.readonly){return}t.focus({preventScroll:true});t.setSelectionRange(t.value.length,t.value.length);this.scrollToBeginning();this.scrollToEnd()},focusTextarea(){if(this.readonly){return}if(this.focus){void this.handleFocus()}this.focus=true;void this.$nextTick((()=>{this.$refs.textarea.focus()}))},scrollToBeginning(){if(!this.$refs.textarea){return}this.$refs.textarea.scrollTop=0},scrollToEnd(){const t=this.$refs.textarea;t.scrollTo({top:t.scrollHeight,behavior:"smooth"})},handleDisplayClick(t){if(t&&t.target&&t.target.closest&&t.target.closest(".b24-growing-text-area-link")){this.$emit("linkClick",t)}else{this.focusTextarea()}},handleInput(t){this.$emit("input",t.target.value);void this.adjustTextareaHeight()},handleKeyDown(t){if(t.key==="Enter"&&(t.ctrlKey||t.metaKey)){t.stopPropagation();return}if(t.key==="Enter"){this.$emit("enterBlur",this.modelValue==="");t.target.blur();t.preventDefault()}if(t.key==="Escape"){t.target.blur();t.stopPropagation()}},async handleFocus(t){this.focus=true;await this.adjustTextareaHeight();this.focusToEnd();if(this.modelValue===""){this.$emit("emptyFocus")}this.$emit("focus",t)},async handleBlur(t){if(!this.$refs.textarea){return}if(!this.overflowing){await this.adjustTextareaHeight();this.scrollToBeginning()}const e=this.$refs.textarea.value.trim();if(e!==this.modelValue){this.$emit("update:modelValue",e)}this.$refs.textarea.value=e;if(e===""){this.$emit("emptyBlur")}this.$emit("blur",t);this.focus=false}},template:`\n\t\t<div class="b24-growing-text-area" :class="{ '--readonly': readonly }">\n\t\t\t<div\n\t\t\t\tref="display"\n\t\t\t\tv-if="isDisplay"\n\t\t\t\tv-hint="tooltip"\n\t\t\t\tclass="b24-growing-text-area-display"\n\t\t\t\t:style="{\n\t\t\t\t\tlineHeight: lineHeight + 'px',\n\t\t\t\t\tcolor: fontColor,\n\t\t\t\t\tfontSize: fontSize + 'px',\n\t\t\t\t\tfontWeight: fontWeight,\n\t\t\t\t}"\n\t\t\t\t@click="handleDisplayClick"\n\t\t\t>\n\t\t\t\t<span v-html="displayHtml"/>\n\t\t\t</div>\n\t\t\t<textarea\n\t\t\t\tv-else\n\t\t\t\tclass="b24-growing-text-area-edit"\n\t\t\t\trows="1"\n\t\t\t\t:value="modelValue"\n\t\t\t\t:placeholder\n\t\t\t\t:style="{\n\t\t\t\t\tlineHeight: lineHeight + 'px',\n\t\t\t\t\tcolor: fontColor,\n\t\t\t\t\tfontSize: fontSize + 'px',\n\t\t\t\t\tfontWeight: fontWeight,\n\t\t\t\t}"\n\t\t\t\t:readonly\n\t\t\t\tref="textarea"\n\t\t\t\t@input="handleInput"\n\t\t\t\t@keydown="handleKeyDown"\n\t\t\t\t@focus="handleFocus"\n\t\t\t\t@blur="handleBlur"\n\t\t\t/>\n\t\t</div>\n\t`};t.GrowingTextArea=o})(this.BX.Tasks.V2.Component.Elements=this.BX.Tasks.V2.Component.Elements||{},BX,BX.Vue3.Directives);
//# sourceMappingURL=growing-text-area.bundle.map.js