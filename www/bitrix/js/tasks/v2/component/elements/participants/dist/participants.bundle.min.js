this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};this.BX.Tasks.V2.Component=this.BX.Tasks.V2.Component||{};(function(t,e,s,i,n,r,o,l,a,d,u,h,m,c,p,f,v,I){"use strict";const k={components:{HoverPill:f.HoverPill,UserLabel:v.UserLabel,BMenu:h.BMenu},props:{taskId:{type:[Number,String],required:true},userId:{type:Number,required:true},canAdd:{type:Boolean,required:true},inline:{type:Boolean,required:true},withClear:{type:Boolean,required:true},withMenu:{type:Boolean,required:true}},emits:["edit","remove"],data(){return{isMenuShown:false}},computed:{user(){return this.$store.getters[`${p.Model.Users}/getById`](this.userId)},menuOptions(){const t=`${this.taskId}-${this.userId}`;return{id:"tasks-field-users-menu",bindElement:this.$refs.user.$el,offsetTop:8,targetContainer:document.body,items:[{title:this.loc("TASKS_V2_USERS_VIEW"),icon:m.Outline.PERSON,dataset:{id:`UserMenuProfile-${t}`},onClick:this.openProfile},...u.EventEmitter.emit(p.EventName.UserMenuExternalItems,{taskId:this.taskId,userId:this.userId}).flat(),this.inline&&{title:this.loc("TASKS_V2_USERS_EDIT"),icon:m.Outline.EDIT_L,onClick:this.edit},!this.inline&&{design:h.MenuItemDesign.Alert,title:this.loc("TASKS_V2_USERS_REMOVE"),icon:m.Outline.TRASHCAN,dataset:{id:`UserMenuRemove-${t}`},onClick:this.remove}]}}},methods:{handleClick(){if(this.withMenu){this.isMenuShown=true;return}if(this.canAdd){this.edit();return}this.openProfile()},edit(){this.$emit("edit")},remove(){this.$emit("remove")},openProfile(){BX.SidePanel.Instance.emulateAnchorClick(I.userService.getUrl(this.userId))}},template:`\n\t\t<HoverPill ref="user" :withClear @clear="remove" @click="handleClick">\n\t\t\t<UserLabel :user/>\n\t\t</HoverPill>\n\t\t<BMenu v-if="isMenuShown" :options="menuOptions" @close="isMenuShown = false"/>\n\t`};const S={components:{User:k},props:{taskId:{type:[Number,String],required:true},isEdit:{type:Boolean,default:false},userIds:{type:Array,required:true},canAdd:{type:Boolean,default:false},canRemove:{type:Boolean,default:false},removableUserId:{type:Number,default:0},single:{type:Boolean,default:false},inline:{type:Boolean,default:false},showMenu:{type:Boolean,default:true}},emits:["edit","remove"],computed:{isSafari(){return BX.browser.IsSafari()}},template:`\n\t\t<div class="tasks-field-users" :class="{ '--safari': isSafari }">\n\t\t\t<template v-for="userId in userIds">\n\t\t\t\t<User\n\t\t\t\t\t:taskId\n\t\t\t\t\t:userId\n\t\t\t\t\t:canAdd\n\t\t\t\t\t:inline\n\t\t\t\t\t:withClear="!single && !inline && (canRemove || userId === removableUserId)"\n\t\t\t\t\t:withMenu="showMenu && isEdit && (canRemove || removableUserId === userId)"\n\t\t\t\t\t@edit="$emit('edit')"\n\t\t\t\t\t@remove="$emit('remove', userId)"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</div>\n\t`};const B={props:{count:{type:Number,required:true},withRemove:{type:Boolean,default:false},inline:{type:Boolean,default:false}},emits:["showMore","removeAll"],computed:{moreFormatted(){return this.loc("TASKS_V2_USERS_MORE_COUNT",{"#COUNT#":this.count})}},template:`\n\t\t<div v-if="count || withRemove" :class="['tasks-field-users-footer', { '--inline': inline }]">\n\t\t\t<div v-if="count" class="tasks-field-users-more" @click="$emit('showMore')">\n\t\t\t\t{{ moreFormatted }}\n\t\t\t</div>\n\t\t\t<div v-if="withRemove" class="tasks-field-users-more --remove" @click="$emit('removeAll')">\n\t\t\t\t{{ loc('TASKS_V2_USERS_REMOVE_ALL') }}\n\t\t\t</div>\n\t\t</div>\n\t`};const w=4;const U={components:{RichLoc:i.RichLoc,Popup:s.Popup,HoverPill:f.HoverPill,FieldAdd:r.FieldAdd,AddButton:o.AddButton,Hint:l.Hint,UserLabel:v.UserLabel,Users:S,More:B},props:{taskId:{type:[Number,String],required:true},context:{type:String,required:true},userIds:{type:Array,required:true},canAdd:{type:Boolean,default:true},canRemove:{type:Boolean,default:true},withHint:{type:Boolean,default:false},hintText:{type:String,default:""},useRemoveAll:{type:Boolean,default:false},single:{type:Boolean,default:false},multipleOnPlus:{type:Boolean,default:false},inline:{type:Boolean,default:false},avatarOnly:{type:Boolean,default:false},dataset:{type:Object,required:true},isLocked:{type:Boolean,default:false},featureId:{type:String,default:""},showMenu:{type:Boolean,default:true}},emits:["update","hintClick"],setup(){return{Outline:m.Outline}},data(){return{isDialogShown:false,isMoreShown:false,isHintShown:false,isHovered:false}},computed:{isEdit(){return a.idUtils.isReal(this.taskId)},removableUserId(){if(this.multipleOnPlus){return 0}return this.canAdd?n.Core.getParams().currentUser.id:0},userCount(){return this.userIds.length},popupOptions(){return()=>({id:"tasks-field-users-more-popup",bindElement:this.$refs.anchor,padding:18,maxWidth:300,maxHeight:300,offsetTop:8,targetContainer:document.body})},bodyUserIds(){return this.userIds.slice(0,w)},moreUserIds(){return this.userIds.slice(w)},popupUserIds(){return this.inline&&!this.canAdd?this.userIds:this.moreUserIds},withRemove(){if(!this.canRemove){return false}if(!this.useRemoveAll||this.userCount<=w){return false}return this.isDialogShown||this.isHovered}},watch:{userCount(){if(this.popupUserIds.length===0){this.isMoreShown=false}}},mounted(){void I.userService.list(this.userIds)},methods:{getUser(t){return this.$store.getters[`${p.Model.Users}/getById`](t)},handleClick(){if(this.canAdd){void this.showDialog();return}if(this.userIds.length===1){BX.SidePanel.Instance.emulateAnchorClick(I.userService.getUrl(this.userIds[0]));return}this.isMoreShown=true},handleMore(){if((!this.isEdit||this.inline)&&this.canAdd){void this.showDialog();return}this.isMoreShown=true},async showDialog(t=false){if(this.isLocked){void e.showLimit({featureId:this.featureId,bindElement:this.$refs.anchor});return}if(this.withHint){this.isHintShown=true;this.hintPromise=new g;if(await this.hintPromise===false){return}}this.isDialogShown=true;void d.usersDialog.show({targetNode:this.$refs.anchor,ids:this.userIds,selectableIds:this.canRemove?null:new Set([this.removableUserId]),onClose:this.handleDialogClose,isMultiple:!this.single&&(!this.multipleOnPlus||t)})},handleDialogClose(t){this.isDialogShown=false;if(d.usersDialog.getDialog().isLoaded()){this.updateUsers(t)}},removeUser(t){this.updateUsers(this.userIds.filter((e=>e!==t)))},updateUsers(t){this.$emit("update",t)},handleHintClick(){this.$emit("hintClick");this.hintPromise.resolve(true);this.isHintShown=false},closeHint(){this.hintPromise.resolve(false);this.isHintShown=false}},template:`\n\t\t<div v-bind="dataset" @mouseenter="isHovered = true" @mouseleave="isHovered = false">\n\t\t\t<FieldAdd \n\t\t\t\tv-if="userCount === 0"\n\t\t\t\t:icon="Outline.PERSON"\n\t\t\t\t:isLocked\n\t\t\t\t@click="showDialog"\n\t\t\t/>\n\t\t\t<div v-else-if="inline && userCount > 1 || avatarOnly" class="tasks-field-users-inline">\n\t\t\t\t<HoverPill compact @click="handleClick">\n\t\t\t\t\t<template v-for="userId in bodyUserIds">\n\t\t\t\t\t\t<UserLabel class="tasks-field-user --inline" :user="getUser(userId)" avatarOnly/>\n\t\t\t\t\t</template>\n\t\t\t\t</HoverPill>\n\t\t\t\t<More\n\t\t\t\t\t:count="moreUserIds.length"\n\t\t\t\t\t:withRemove\n\t\t\t\t\tinline\n\t\t\t\t\t@showMore="handleMore"\n\t\t\t\t\t@removeAll="updateUsers([])"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-else>\n\t\t\t\t<AddButton \n\t\t\t\t\tv-if="canAdd && !inline" \n\t\t\t\t\t:isVisible="isDialogShown || isHovered" \n\t\t\t\t\t:isLocked\n\t\t\t\t\t@click="showDialog(true)"\n\t\t\t\t/>\n\t\t\t\t<Users\n\t\t\t\t\t:taskId\n\t\t\t\t\t:isEdit\n\t\t\t\t\t:userIds="bodyUserIds"\n\t\t\t\t\t:canAdd\n\t\t\t\t\t:canRemove="canRemove && !multipleOnPlus"\n\t\t\t\t\t:removableUserId\n\t\t\t\t\t:single\n\t\t\t\t\t:inline\n\t\t\t\t\t:showMenu\n\t\t\t\t\t@edit="showDialog"\n\t\t\t\t\t@remove="removeUser"\n\t\t\t\t/>\n\t\t\t\t<More\n\t\t\t\t\t:count="moreUserIds.length"\n\t\t\t\t\t:withRemove\n\t\t\t\t\t@showMore="handleMore"\n\t\t\t\t\t@removeAll="updateUsers([])"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div ref="anchor"/>\n\t\t</div>\n\t\t<Popup v-if="isMoreShown" :options="popupOptions()" @close="isMoreShown = false">\n\t\t\t<Users\n\t\t\t\t:taskId\n\t\t\t\t:isEdit\n\t\t\t\t:userIds="popupUserIds"\n\t\t\t\t:canAdd\n\t\t\t\t:canRemove\n\t\t\t\t:removableUserId\n\t\t\t\t:single\n\t\t\t\t:showMenu\n\t\t\t\t@edit="showDialog"\n\t\t\t\t@remove="removeUser"\n\t\t\t/>\n\t\t</Popup>\n\t\t<Hint v-if="isHintShown" :bindElement="$refs.anchor" @close="closeHint">\n\t\t\t<RichLoc class="tasks-field-users-hint" :text="hintText" placeholder="[action]">\n\t\t\t\t<template #action="{ text }">\n\t\t\t\t\t<span @click="handleHintClick">{{ text }}</span>\n\t\t\t\t</template>\n\t\t\t</RichLoc>\n\t\t</Hint>\n\t`};function g(){const t=new Promise((t=>{this.resolve=t}));t.resolve=this.resolve;return t}t.Participants=U})(this.BX.Tasks.V2.Component.Elements=this.BX.Tasks.V2.Component.Elements||{},BX.Tasks.V2.Lib,BX.UI.Vue3.Components,BX.UI.Vue3.Components,BX.Tasks.V2,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Lib,BX.Tasks.V2.Lib,BX.Event,BX.UI.System.Menu,BX.UI.IconSet,BX,BX.Tasks.V2.Const,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Component.Elements,BX.Tasks.V2.Provider.Service);
//# sourceMappingURL=participants.bundle.map.js