{"version":3,"file":"core.bundle.js","sources":["../src/core.js"],"sourcesContent":["import { Extension } from 'main.core';\nimport { Builder, BuilderModel, Store } from 'ui.vue3.vuex';\n\nimport { CheckList } from 'tasks.v2.model.check-list';\nimport { CrmItems } from 'tasks.v2.model.crm-items';\nimport { ElapsedTimes } from 'tasks.v2.model.elapsed-times';\nimport { Epics } from 'tasks.v2.model.epics';\nimport { Flows } from 'tasks.v2.model.flows';\nimport { GanttLinks } from 'tasks.v2.model.gantt-links';\nimport { Groups } from 'tasks.v2.model.groups';\nimport { Interface } from 'tasks.v2.model.interface';\nimport { Placements } from 'tasks.v2.model.placements';\nimport { Results } from 'tasks.v2.model.results';\nimport { Stages } from 'tasks.v2.model.stages';\nimport { Tasks } from 'tasks.v2.model.tasks';\nimport { Reminders } from 'tasks.v2.model.reminders';\nimport { Users } from 'tasks.v2.model.users';\n\nimport { PullManager } from 'tasks.v2.provider.pull.pull-manager';\n\nimport type { CoreParams, RightsParams } from './types';\nexport type { CoreParams, RightsParams };\n\nconst params = Extension.getSettings('tasks.v2.core');\n\nclass CoreApplication\n{\n\t#store: Store;\n\t#builder: Builder;\n\t#initPromise: Promise;\n\t#pullManager: ?PullManager = null;\n\n\tgetParams(): CoreParams\n\t{\n\t\treturn params;\n\t}\n\n\tgetStore(): Store\n\t{\n\t\treturn this.#store;\n\t}\n\n\tinit(): Promise<void>\n\t{\n\t\t// eslint-disable-next-line no-async-promise-executor\n\t\tthis.#initPromise ??= new Promise(async (resolve) => {\n\t\t\tthis.#store = await this.#initStore();\n\t\t\tthis.#initPull();\n\t\t\tresolve();\n\t\t});\n\n\t\treturn this.#initPromise;\n\t}\n\n\tasync addDynamicModel(vuexBuilderModel: BuilderModel): Promise<void>\n\t{\n\t\tif (!(this.#builder instanceof Builder))\n\t\t{\n\t\t\tthrow new TypeError('Builder has not been init');\n\t\t}\n\n\t\tif (this.#store.hasModule(vuexBuilderModel.getName()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.#builder.addDynamicModel(vuexBuilderModel);\n\t}\n\n\tremoveDynamicModel(vuexModelName: string): void\n\t{\n\t\tif (this.#builder instanceof Builder && this.#store.hasModule(vuexModelName))\n\t\t{\n\t\t\tthis.#builder.removeDynamicModel(vuexModelName);\n\t\t}\n\t}\n\n\tasync #initStore(): Promise<Store>\n\t{\n\t\tthis.#builder = Builder.init();\n\n\t\tthis.#builder\n\t\t\t.addModel(CheckList.create())\n\t\t\t.addModel(CrmItems.create())\n\t\t\t.addModel(ElapsedTimes.create())\n\t\t\t.addModel(Epics.create())\n\t\t\t.addModel(Flows.create())\n\t\t\t.addModel(GanttLinks.create())\n\t\t\t.addModel(Groups.createWithGroups([params.defaultCollab].filter((it) => it)))\n\t\t\t.addModel(Interface.createWithVariables(params))\n\t\t\t.addModel(Results.create())\n\t\t\t.addModel(Placements.create())\n\t\t\t.addModel(Stages.create())\n\t\t\t.addModel(Tasks.createWithVariables(params))\n\t\t\t.addModel(Reminders.create())\n\t\t\t.addModel(Users.createWithCurrentUser(params.currentUser))\n\t\t;\n\n\t\tconst builderResult = await this.#builder.build();\n\n\t\treturn builderResult.store;\n\t}\n\n\t#initPull(): void\n\t{\n\t\tthis.#pullManager = new PullManager({\n\t\t\tcurrentUserId: params.currentUser.id,\n\t\t});\n\n\t\tthis.#pullManager.initQueueManager();\n\t}\n}\n\nexport const Core = new CoreApplication();\n"],"names":["params","Extension","getSettings","CoreApplication","getParams","getStore","init","Promise","resolve","addDynamicModel","vuexBuilderModel","Builder","TypeError","hasModule","getName","removeDynamicModel","vuexModelName","addModel","CheckList","create","CrmItems","ElapsedTimes","Epics","Flows","GanttLinks","Groups","createWithGroups","defaultCollab","filter","it","Interface","createWithVariables","Results","Placements","Stages","Tasks","Reminders","Users","createWithCurrentUser","currentUser","builderResult","build","store","PullManager","currentUserId","id","initQueueManager","Core"],"mappings":";;;;;;CAuBA,MAAMA,MAAM,GAAGC,mBAAS,CAACC,WAAW,CAAC,eAAe,CAAC;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAEtD,MAAMC,eAAe,CACrB;GAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OAI8B;;;GAE7BC,SAAS,GACT;KACC,OAAOJ,MAAM;;GAGdK,QAAQ,GACR;KACC,+CAAO,IAAI;;GAGZC,IAAI,GACJ;KAAA;;KAEC,+FAAI,yGAAkB,IAAIC,OAAO,CAAC,MAAOC,OAAO,IAAK;OACpD,4CAAI,oBAAU,8CAAM,IAAI,2BAAa;OACrC,4CAAI;OACJA,OAAO,EAAE;MACT,CAAC;KAEF,+CAAO,IAAI;;GAGZ,MAAMC,eAAe,CAACC,gBAA8B,EACpD;KACC,IAAI,EAAE,4CAAI,iCAAqBC,oBAAO,CAAC,EACvC;OACC,MAAM,IAAIC,SAAS,CAAC,2BAA2B,CAAC;;KAGjD,IAAI,4CAAI,kBAAQC,SAAS,CAACH,gBAAgB,CAACI,OAAO,EAAE,CAAC,EACrD;OACC;;KAGD,MAAM,4CAAI,sBAAUL,eAAe,CAACC,gBAAgB,CAAC;;GAGtDK,kBAAkB,CAACC,aAAqB,EACxC;KACC,IAAI,4CAAI,iCAAqBL,oBAAO,IAAI,4CAAI,kBAAQE,SAAS,CAACG,aAAa,CAAC,EAC5E;OACC,4CAAI,sBAAUD,kBAAkB,CAACC,aAAa,CAAC;;;CAsClD;CAAC,6BAjCA;GACC,4CAAI,wBAAYL,oBAAO,CAACL,IAAI,EAAE;GAE9B,4CAAI,sBACFW,QAAQ,CAACC,kCAAS,CAACC,MAAM,EAAE,CAAC,CAC5BF,QAAQ,CAACG,gCAAQ,CAACD,MAAM,EAAE,CAAC,CAC3BF,QAAQ,CAACI,wCAAY,CAACF,MAAM,EAAE,CAAC,CAC/BF,QAAQ,CAACK,0BAAK,CAACH,MAAM,EAAE,CAAC,CACxBF,QAAQ,CAACM,0BAAK,CAACJ,MAAM,EAAE,CAAC,CACxBF,QAAQ,CAACO,oCAAU,CAACL,MAAM,EAAE,CAAC,CAC7BF,QAAQ,CAACQ,4BAAM,CAACC,gBAAgB,CAAC,CAAC1B,MAAM,CAAC2B,aAAa,CAAC,CAACC,MAAM,CAAEC,EAAE,IAAKA,EAAE,CAAC,CAAC,CAAC,CAC5EZ,QAAQ,CAACa,kCAAS,CAACC,mBAAmB,CAAC/B,MAAM,CAAC,CAAC,CAC/CiB,QAAQ,CAACe,8BAAO,CAACb,MAAM,EAAE,CAAC,CAC1BF,QAAQ,CAACgB,oCAAU,CAACd,MAAM,EAAE,CAAC,CAC7BF,QAAQ,CAACiB,4BAAM,CAACf,MAAM,EAAE,CAAC,CACzBF,QAAQ,CAACkB,0BAAK,CAACJ,mBAAmB,CAAC/B,MAAM,CAAC,CAAC,CAC3CiB,QAAQ,CAACmB,kCAAS,CAACjB,MAAM,EAAE,CAAC,CAC5BF,QAAQ,CAACoB,0BAAK,CAACC,qBAAqB,CAACtC,MAAM,CAACuC,WAAW,CAAC,CAAC;GAG3D,MAAMC,aAAa,GAAG,MAAM,4CAAI,sBAAUC,KAAK,EAAE;GAEjD,OAAOD,aAAa,CAACE,KAAK;CAC3B;CAAC,sBAGD;GACC,4CAAI,gCAAgB,IAAIC,8CAAW,CAAC;KACnCC,aAAa,EAAE5C,MAAM,CAACuC,WAAW,CAACM;IAClC,CAAC;GAEF,4CAAI,8BAAcC,gBAAgB,EAAE;CACrC;AAGD,OAAaC,IAAI,GAAG,IAAI5C,eAAe,EAAE;;;;;;;;"}