{"version":3,"file":"highlighter.bundle.js","sources":["../src/highlighter.js"],"sourcesContent":["import { Dom, Event, Type } from 'main.core';\n\nimport './highlighter.css';\n\nexport class Highlighter\n{\n\tstatic HIGHLIGHT_CLASS = 'element-highlight';\n\tstatic ANIMATE_CLASS = '--animate';\n\tstatic ANIMATION_DURATION = 1000;\n\n\t#activeHighlights = new WeakMap();\n\n\tasync highlight(element: HTMLElement, duration = Highlighter.ANIMATION_DURATION): Promise<void>\n\t{\n\t\tif (!Type.isElementNode(element))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.#nextTick();\n\n\t\tthis.#cleanup(element);\n\n\t\tthis.#activeHighlights.set(element, {\n\t\t\tanimationStart: null,\n\t\t\ttimeoutId: null,\n\t\t\thandler: null,\n\t\t});\n\n\t\tthis.#startAnimation(element);\n\n\t\tconst handler = () => this.#cleanup(element);\n\n\t\tEvent.bind(window, 'click', handler);\n\t\tEvent.bind(window, 'keydown', handler);\n\n\t\tconst state = this.#activeHighlights.get(element);\n\t\tstate.handler = handler;\n\t\tstate.timeoutId = setTimeout(\n\t\t\t() => this.#cleanup(element),\n\t\t\tHighlighter.ANIMATION_DURATION,\n\t\t);\n\t}\n\n\t#startAnimation(element: HTMLElement): void\n\t{\n\t\tDom.addClass(element, [Highlighter.HIGHLIGHT_CLASS, Highlighter.ANIMATE_CLASS]);\n\n\t\tconst state = this.#activeHighlights.get(element);\n\t\tif (state)\n\t\t{\n\t\t\tstate.animationStart = Date.now();\n\t\t}\n\t}\n\n\t#cleanup(element: HTMLElement): void\n\t{\n\t\tconst state = this.#activeHighlights.get(element);\n\t\tif (!state)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(element, [Highlighter.HIGHLIGHT_CLASS, Highlighter.ANIMATE_CLASS]);\n\n\t\tif (state.timeoutId)\n\t\t{\n\t\t\tclearTimeout(state.timeoutId);\n\t\t}\n\n\t\tif (state.handler)\n\t\t{\n\t\t\tEvent.unbind(window, 'click', state.handler);\n\t\t\tEvent.unbind(window, 'keydown', state.handler);\n\t\t}\n\n\t\tthis.#activeHighlights.delete(element);\n\t}\n\n\t#nextTick(): Promise<void>\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\t// eslint-disable-next-line no-promise-executor-return\n\t\t\treturn setTimeout(resolve, 0);\n\t\t});\n\t}\n}\n\nexport const highlighter = new Highlighter();\n"],"names":["Highlighter","WeakMap","highlight","element","duration","ANIMATION_DURATION","Type","isElementNode","set","animationStart","timeoutId","handler","Event","bind","window","state","get","setTimeout","Dom","addClass","HIGHLIGHT_CLASS","ANIMATE_CLASS","Date","now","removeClass","clearTimeout","unbind","delete","Promise","resolve","highlighter"],"mappings":";;;;;;;CAE2B;CAAA;CAAA;CAAA;AAE3B,CAAO,MAAMA,WAAW,CACxB;GAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA,OAKqB,IAAIC,OAAO;;;GAE/B,MAAMC,SAAS,CAACC,OAAoB,EAAEC,QAAQ,GAAGJ,WAAW,CAACK,kBAAkB,EAC/E;KACC,IAAI,CAACC,cAAI,CAACC,aAAa,CAACJ,OAAO,CAAC,EAChC;OACC;;KAGD,8CAAM,IAAI,yBAAY;KAEtB,4CAAI,sBAAUA,OAAO;KAErB,4CAAI,wCAAmBK,GAAG,CAACL,OAAO,EAAE;OACnCM,cAAc,EAAE,IAAI;OACpBC,SAAS,EAAE,IAAI;OACfC,OAAO,EAAE;MACT,CAAC;KAEF,4CAAI,oCAAiBR,OAAO;KAE5B,MAAMQ,OAAO,GAAG,8CAAM,IAAI,sBAAUR,OAAO,CAAC;KAE5CS,eAAK,CAACC,IAAI,CAACC,MAAM,EAAE,OAAO,EAAEH,OAAO,CAAC;KACpCC,eAAK,CAACC,IAAI,CAACC,MAAM,EAAE,SAAS,EAAEH,OAAO,CAAC;KAEtC,MAAMI,KAAK,GAAG,4CAAI,wCAAmBC,GAAG,CAACb,OAAO,CAAC;KACjDY,KAAK,CAACJ,OAAO,GAAGA,OAAO;KACvBI,KAAK,CAACL,SAAS,GAAGO,UAAU,CAC3B,8CAAM,IAAI,sBAAUd,OAAO,CAAC,EAC5BH,WAAW,CAACK,kBAAkB,CAC9B;;CA6CH;CAAC,0BA1CgBF,OAAoB,EACpC;GACCe,aAAG,CAACC,QAAQ,CAAChB,OAAO,EAAE,CAACH,WAAW,CAACoB,eAAe,EAAEpB,WAAW,CAACqB,aAAa,CAAC,CAAC;GAE/E,MAAMN,KAAK,GAAG,4CAAI,wCAAmBC,GAAG,CAACb,OAAO,CAAC;GACjD,IAAIY,KAAK,EACT;KACCA,KAAK,CAACN,cAAc,GAAGa,IAAI,CAACC,GAAG,EAAE;;CAEnC;CAAC,mBAEQpB,OAAoB,EAC7B;GACC,MAAMY,KAAK,GAAG,4CAAI,wCAAmBC,GAAG,CAACb,OAAO,CAAC;GACjD,IAAI,CAACY,KAAK,EACV;KACC;;GAGDG,aAAG,CAACM,WAAW,CAACrB,OAAO,EAAE,CAACH,WAAW,CAACoB,eAAe,EAAEpB,WAAW,CAACqB,aAAa,CAAC,CAAC;GAElF,IAAIN,KAAK,CAACL,SAAS,EACnB;KACCe,YAAY,CAACV,KAAK,CAACL,SAAS,CAAC;;GAG9B,IAAIK,KAAK,CAACJ,OAAO,EACjB;KACCC,eAAK,CAACc,MAAM,CAACZ,MAAM,EAAE,OAAO,EAAEC,KAAK,CAACJ,OAAO,CAAC;KAC5CC,eAAK,CAACc,MAAM,CAACZ,MAAM,EAAE,SAAS,EAAEC,KAAK,CAACJ,OAAO,CAAC;;GAG/C,4CAAI,wCAAmBgB,MAAM,CAACxB,OAAO,CAAC;CACvC;CAAC,sBAGD;GACC,OAAO,IAAIyB,OAAO,CAAEC,OAAO,IAAK;;KAE/B,OAAOZ,UAAU,CAACY,OAAO,EAAE,CAAC,CAAC;IAC7B,CAAC;CACH;CAjFY7B,WAAW,CAEhBoB,eAAe,GAAG,mBAAmB;CAFhCpB,WAAW,CAGhBqB,aAAa,GAAG,WAAW;CAHtBrB,WAAW,CAIhBK,kBAAkB,GAAG,IAAI;AAgFjC,OAAayB,WAAW,GAAG,IAAI9B,WAAW,EAAE;;;;;;;;;"}