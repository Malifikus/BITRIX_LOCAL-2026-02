{"version":3,"file":"chat-action-service.bundle.js","sources":["../src/action/base-action.js","../src/chat-action-dispatcher.js","../src/chat-link-parser.js","../src/chat-hint.js","../src/action/check-list/check-list-base-action.js","../src/action/check-list/show-check-list-action.js","../src/action/check-list/show-check-list-items-action.js","../src/action/change-deadline-action.js","../src/action/complete-task-action.js","../src/action/open-result-action.js","../src/chat-action-service.js"],"sourcesContent":["import { Type } from 'main.core';\n\nimport type { ActionPayload } from '../type/action-payload.js';\n\nexport class BaseAction\n{\n\texecute(payload: ActionPayload): Promise<void>\n\t{\n\t\tthrow new Error(`Method execute must be implemented in ${this.constructor.name}`);\n\t}\n\n\tgetName(): string\n\t{\n\t\tthrow new Error(`Method getName must be implemented in ${this.constructor.name}`);\n\t}\n\n\tisValid(payload: ActionPayload): boolean\n\t{\n\t\treturn this.#validatePayload(payload);\n\t}\n\n\thasPermission(payload: ActionPayload): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t#validatePayload(payload: ActionPayload): boolean\n\t{\n\t\tif (!Type.isPlainObject(payload))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn (\n\t\t\tType.isNumber(payload.taskId)\n\t\t\t&& payload.taskId > 0\n\t\t\t&& Type.isDomNode(payload.bindElement)\n\t\t);\n\t}\n}\n","import { Type } from 'main.core';\n\nimport { BaseAction } from './action/base-action.js';\nimport type { ActionPayload } from './type/action-payload.js';\n\nexport class ChatActionDispatcher\n{\n\t#actions: Map<string, BaseAction> = new Map();\n\n\tregister(action: BaseAction): void\n\t{\n\t\tconst actionName = action.getName();\n\t\tif (this.#actions.has(actionName))\n\t\t{\n\t\t\tthrow new Error(`ChatActionDispatcher: action '${actionName}' already registered`);\n\t\t}\n\n\t\tthis.#actions.set(actionName, action);\n\t}\n\n\tasync execute(actionName: string, payload: ActionPayload): Promise<void>\n\t{\n\t\tif (!Type.isString(actionName) || actionName.trim() === '')\n\t\t{\n\t\t\tthrow new Error('Invalid action name');\n\t\t}\n\n\t\tconst action = this.#actions.get(actionName.trim());\n\t\tif (!action)\n\t\t{\n\t\t\tthrow new Error(`Action '${actionName}' not found`);\n\t\t}\n\n\t\tawait action.execute(payload);\n\t}\n}\n","import { Type } from 'main.core';\n\nimport type { ParsedLink, Link } from './type/link.js';\nimport { ChatActionParam } from 'tasks.v2.const';\n\nexport class ChatLinkParser\n{\n\tparse(link: Link): ParsedLink | null\n\t{\n\t\tif (!this.#validateLink(link))\n\t\t{\n\t\t\tconsole.error('ChatLinkParser: Link is not valid');\n\n\t\t\treturn null;\n\t\t}\n\n\t\tconst {\n\t\t\ttaskId,\n\t\t\t[ChatActionParam.ChatAction]: chatAction,\n\t\t\t[ChatActionParam.EntityId]: entityId,\n\t\t} = link.matches.groups;\n\n\t\tconst parsedTaskId = this.#parseNumber(taskId);\n\n\t\tif (parsedTaskId <= 0)\n\t\t{\n\t\t\tconsole.error('ChatLinkParser: taskId must be positive number');\n\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!chatAction || chatAction.trim() === '')\n\t\t{\n\t\t\tconsole.error('ChatLinkParser: actionName is required');\n\n\t\t\treturn null;\n\t\t}\n\n\t\tconst urlParams = this.#parseUrlParams(link.url);\n\n\t\treturn {\n\t\t\tactionName: chatAction.trim(),\n\t\t\tpayload: {\n\t\t\t\ttaskId: parsedTaskId,\n\t\t\t\tentityId: entityId ? this.#parseNumber(entityId) : null,\n\t\t\t\tbindElement: link.anchor,\n\t\t\t\t...urlParams,\n\t\t\t},\n\t\t};\n\t}\n\n\t#validateLink(link: Link): boolean\n\t{\n\t\tif (!Type.isPlainObject(link))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isString(link.url) || link.url.trim() === '')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isArray(link.matches) || link.matches.length < 4)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Type.isDomNode(link.anchor);\n\t}\n\n\t#parseUrlParams(url: string): Object\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst urlParams = new URLSearchParams(url);\n\n\t\t\treturn {\n\t\t\t\t[ChatActionParam.ChildrenIds]: this.#parseArrayIds(urlParams, ChatActionParam.ChildrenIds),\n\t\t\t};\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\treturn {};\n\t\t}\n\t}\n\n\t#parseArrayIds(urlParams: URLSearchParams, paramName: string): Array\n\t{\n\t\tconst result = [];\n\t\turlParams.forEach((value: string, key: string) => {\n\t\t\tif (key.startsWith(paramName))\n\t\t\t{\n\t\t\t\tresult.push(this.#parseNumber(value));\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}\n\n\t#parseNumber(value: string): number\n\t{\n\t\tconst parsed = parseInt(value, 10);\n\n\t\treturn Number.isInteger(parsed) ? parsed : 0;\n\t}\n}\n","import type { PopupOptions } from 'main.popup';\n\nimport { Hint } from 'tasks.v2.lib.hint';\n\nimport type { ActionPayload } from './type/action-payload';\n\nclass ChatHint extends Hint\n{\n\t#popupId: string = 'tasks-chat-hint';\n\n\tasync show(text: string, payload: ActionPayload, popupOptions: PopupOptions): Promise<void>\n\t{\n\t\tconst options = {\n\t\t\tid: this.#popupId,\n\t\t\tbindElement: payload.bindElement,\n\t\t\tcontent: text,\n\t\t\toffsetLeft: 40,\n\t\t\tmaxWidth: 770,\n\t\t\tpadding: 12,\n\t\t\ttargetContainer: document.body,\n\t\t\t...popupOptions,\n\t\t};\n\n\t\tif (payload.coordinates?.x)\n\t\t{\n\t\t\tconst bindElementRect = payload.bindElement.getBoundingClientRect();\n\n\t\t\toptions.offsetLeft = payload.coordinates.x - bindElementRect.left;\n\t\t}\n\n\t\tawait super.showHint(options);\n\t}\n}\n\nexport const chatHint = new ChatHint();\n","import { Loc } from 'main.core';\nimport { BaseAction } from '../base-action';\nimport { chatHint } from '../../chat-hint';\n\nexport class CheckListBaseAction extends BaseAction\n{\n\tshowCheckListRemovedHint(bindElement: HTMLElement, coordinates: Object): void\n\t{\n\t\tvoid chatHint.show(\n\t\t\tLoc.getMessage('TASKS_V2_CHAT_ACTION_CHECK_LIST_REMOVED_HINT'),\n\t\t\t{ bindElement, coordinates },\n\t\t);\n\t}\n\n\tshowCheckListItemsRemovedHint(bindElement: HTMLElement, coordinates: Object): void\n\t{\n\t\tvoid chatHint.show(\n\t\t\tLoc.getMessage('TASKS_V2_CHAT_ACTION_CHECK_LIST_ITEMS_REMOVED_HINT'),\n\t\t\t{ bindElement, coordinates },\n\t\t);\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\n\nimport { EventName, ChatAction } from 'tasks.v2.const';\nimport { checkListService } from 'tasks.v2.provider.service.check-list-service';\n\nimport { CheckListBaseAction } from './check-list-base-action';\nimport type { ActionPayload } from '../../type/action-payload';\n\nclass ShowCheckListAction extends CheckListBaseAction\n{\n\tgetName(): string\n\t{\n\t\treturn ChatAction.ShowCheckList;\n\t}\n\n\tasync execute(payload: ActionPayload): Promise<void>\n\t{\n\t\tif (!this.isValid(payload))\n\t\t{\n\t\t\tthrow new Error('Invalid payload');\n\t\t}\n\n\t\tconst { entityId, bindElement, coordinates } = payload;\n\n\t\tif (!checkListService.isCheckListExists(entityId))\n\t\t{\n\t\t\tthis.showCheckListRemovedHint(bindElement, coordinates);\n\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(EventName.ShowCheckList, { checkListId: entityId });\n\t}\n}\n\nexport const showCheckListAction = new ShowCheckListAction();\n","import { EventEmitter } from 'main.core.events';\n\nimport { EventName, ChatAction } from 'tasks.v2.const';\nimport { checkListService } from 'tasks.v2.provider.service.check-list-service';\n\nimport { CheckListBaseAction } from './check-list-base-action';\nimport type { ActionPayload } from '../../type/action-payload';\n\nclass ShowCheckListItemsAction extends CheckListBaseAction\n{\n\tgetName(): string\n\t{\n\t\treturn ChatAction.ShowCheckListItems;\n\t}\n\n\tasync execute(payload: ActionPayload): Promise<void>\n\t{\n\t\tif (!this.isValid(payload))\n\t\t{\n\t\t\tthrow new Error('Invalid payload');\n\t\t}\n\n\t\tconst { entityId, childrenIds, bindElement, coordinates } = payload;\n\n\t\tif (!checkListService.isCheckListExists(entityId))\n\t\t{\n\t\t\tthis.showCheckListRemovedHint(bindElement, coordinates);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst filteredItems = checkListService.filterItemsBelongingToCheckList(entityId, childrenIds);\n\n\t\tif (filteredItems.length === 0)\n\t\t{\n\t\t\tthis.showCheckListItemsRemovedHint(bindElement, coordinates);\n\n\t\t\treturn;\n\t\t}\n\n\t\tEventEmitter.emit(EventName.ShowCheckListItems, { checkListItemIds: filteredItems.slice(0, 10) });\n\t}\n}\n\nexport const showCheckListItemsAction = new ShowCheckListItemsAction();\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { EventName, ChatAction, Model } from 'tasks.v2.const';\nimport { Core } from 'tasks.v2.core';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { TaskModel } from 'tasks.v2.model.tasks';\n\nimport type { ActionPayload } from '../type/action-payload.js';\nimport { BaseAction } from './base-action.js';\nimport { chatHint } from '../chat-hint';\n\nclass ChangeDeadlineAction extends BaseAction\n{\n\tgetName(): string\n\t{\n\t\treturn ChatAction.ChangeDeadline;\n\t}\n\n\tasync execute(payload: ActionPayload): Promise<void>\n\t{\n\t\tif (!this.isValid(payload))\n\t\t{\n\t\t\tthrow new Error('Invalid payload');\n\t\t}\n\n\t\tif (!this.hasPermission(payload))\n\t\t{\n\t\t\tthis.#showAccessDeniedHint(payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#emitOpenDeadlinePickerEvent(payload);\n\t}\n\n\thasPermission(payload: ActionPayload): boolean\n\t{\n\t\tconst task = taskService.getStoreTask(payload.taskId);\n\t\tif (!task)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.#canChangeDeadline(task);\n\t}\n\n\t#canChangeDeadline(task: TaskModel): boolean\n\t{\n\t\tconst isFlowFilledOnAdd = task.flowId > 0;\n\n\t\treturn (\n\t\t\ttask.rights.deadline\n\t\t\t&& !this.#exceededChangeCount(task)\n\t\t\t&& !isFlowFilledOnAdd\n\t\t);\n\t}\n\n\t#exceededChangeCount(task: TaskModel): boolean\n\t{\n\t\tconst currentUserId = Core.getStore().getters[`${Model.Interface}/currentUserId`];\n\t\tconst isCreator = currentUserId === task.creatorId;\n\t\tif (isCreator || !task.maxDeadlineChanges)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst deadlineChangeCount = Core.getStore().getters[`${Model.Interface}/deadlineChangeCount`];\n\n\t\treturn deadlineChangeCount >= task.maxDeadlineChanges;\n\t}\n\n\t#showAccessDeniedHint(payload: ActionPayload): void\n\t{\n\t\tconst task = taskService.getStoreTask(payload.taskId);\n\n\t\tconst exceededChangeCount = this.#exceededChangeCount(task);\n\n\t\tconst text = (\n\t\t\texceededChangeCount\n\t\t\t\t? Loc.getMessage('TASKS_V2_CHAT_ACTION_CHANGE_DEADLINE_EXCEEDED')\n\t\t\t\t: Loc.getMessage('TASKS_V2_CHAT_ACTION_CHANGE_DEADLINE_NO_PERMISSION')\n\t\t);\n\n\t\tconst width = (exceededChangeCount ? 330 : 280);\n\n\t\tvoid chatHint.show(\n\t\t\ttext,\n\t\t\tpayload,\n\t\t\t{ maxWidth: width },\n\t\t);\n\t}\n\n\t#emitOpenDeadlinePickerEvent(payload: ActionPayload): void\n\t{\n\t\tEventEmitter.emit(\n\t\t\tEventName.OpenDeadlinePicker,\n\t\t\t{\n\t\t\t\ttaskId: payload.taskId,\n\t\t\t\tbindElement: payload.bindElement,\n\t\t\t\tcoordinates: payload.coordinates,\n\t\t\t},\n\t\t);\n\t}\n}\n\nexport const changeDeadlineAction = new ChangeDeadlineAction();\n","import { Loc } from 'main.core';\n\nimport { ChatAction } from 'tasks.v2.const';\nimport { Core } from 'tasks.v2.core';\nimport { statusService } from 'tasks.v2.provider.service.status-service';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\nimport type { Store } from 'ui.vue3.vuex';\n\nimport type { ActionPayload } from '../type/action-payload.js';\nimport { BaseAction } from './base-action.js';\nimport { chatHint } from '../chat-hint';\n\nclass CompleteTaskAction extends BaseAction\n{\n\tgetName(): string\n\t{\n\t\treturn ChatAction.CompleteTask;\n\t}\n\n\tasync execute(payload: ActionPayload): Promise<void>\n\t{\n\t\tif (!this.isValid(payload))\n\t\t{\n\t\t\tthrow new Error('Invalid payload');\n\t\t}\n\n\t\tif (!this.hasPermission(payload))\n\t\t{\n\t\t\tthis.#showAccessDeniedHint(payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tawait statusService.complete(payload.taskId);\n\t}\n\n\thasPermission(payload: ActionPayload): boolean\n\t{\n\t\tconst task = taskService.getStoreTask(payload.taskId);\n\n\t\treturn task && task.rights?.complete === true;\n\t}\n\n\t#showAccessDeniedHint(payload: ActionPayload): void\n\t{\n\t\tvoid chatHint.show(Loc.getMessage('TASKS_V2_CHAT_ACTION_COMPLETE_TASK_NO_PERMISSION'), payload);\n\t}\n\n\tget $store(): Store\n\t{\n\t\treturn Core.getStore();\n\t}\n}\n\nexport const completeTaskAction = new CompleteTaskAction();\n","import { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { EventName, ChatAction } from 'tasks.v2.const';\nimport { taskService } from 'tasks.v2.provider.service.task-service';\n\nimport { chatHint } from '../chat-hint';\nimport { BaseAction } from './base-action';\nimport type { ActionPayload } from '../type/action-payload';\n\nclass OpenResultAction extends BaseAction\n{\n\tgetName(): string\n\t{\n\t\treturn ChatAction.OpenResult;\n\t}\n\n\tasync execute(payload: ActionPayload): Promise<void>\n\t{\n\t\tif (!this.isValid(payload))\n\t\t{\n\t\t\tthrow new Error('Invalid payload');\n\t\t}\n\n\t\tif (!this.#hasResult(payload))\n\t\t{\n\t\t\tthis.#showNoResultHint(payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#emitOpenResultEvent(payload);\n\t}\n\n\t#hasResult(payload: ActionPayload): boolean\n\t{\n\t\tconst { entityId, taskId } = payload;\n\n\t\tif (!entityId || !taskId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst task = taskService.getStoreTask(taskId);\n\n\t\treturn !(!task?.results || !task.results.includes(entityId));\n\t}\n\n\t#showNoResultHint(payload: ActionPayload): void\n\t{\n\t\tvoid chatHint.show(Loc.getMessage('TASKS_V2_CHAT_ACTION_RESULT_NOT_FOUND'), payload);\n\t}\n\n\t#emitOpenResultEvent(payload: ActionPayload): void\n\t{\n\t\tEventEmitter.emit(\n\t\t\tEventName.OpenResultFromChat,\n\t\t\t{\n\t\t\t\ttaskId: payload.taskId,\n\t\t\t\tresultId: payload.entityId,\n\t\t\t},\n\t\t);\n\t}\n}\n\nexport const openResultAction = new OpenResultAction();\n","import { ChatActionDispatcher } from './chat-action-dispatcher.js';\nimport { ChatLinkParser } from './chat-link-parser.js';\nimport { showCheckListAction } from './action/check-list/show-check-list-action';\nimport { showCheckListItemsAction } from './action/check-list/show-check-list-items-action';\nimport { changeDeadlineAction } from './action/change-deadline-action.js';\nimport { completeTaskAction } from './action/complete-task-action.js';\nimport { openResultAction } from './action/open-result-action';\nimport type { BaseAction } from './action/base-action';\nimport type { Coordinates } from './type/coordinates';\nimport type { Link } from './type/link.js';\n\ntype Dependencies = {\n\tactionDispatcher: ChatActionDispatcher,\n\tlinkParser: ChatLinkParser,\n};\n\ntype Options = {\n\tcoordinates?: Coordinates,\n};\n\nexport class ChatActionService\n{\n\t#defaultActions: Array<BaseAction> = [\n\t\tchangeDeadlineAction,\n\t\tcompleteTaskAction,\n\t\topenResultAction,\n\t\tshowCheckListAction,\n\t\tshowCheckListItemsAction,\n\t];\n\n\t#actionDispatcher: ChatActionDispatcher;\n\t#linkParser: ChatLinkParser;\n\n\tconstructor(dependencies: Dependencies)\n\t{\n\t\tthis.#actionDispatcher = dependencies.actionDispatcher;\n\t\tthis.#linkParser = dependencies.linkParser;\n\n\t\tthis.#registerDefaultActions();\n\t}\n\n\t#registerDefaultActions(): void\n\t{\n\t\tthis.#defaultActions.forEach((action: BaseAction): void => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.#actionDispatcher.register(action);\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error('ChatActionService: Failed to register action', action.getName(), error);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync process(link: Link, options: Options = {}): Promise<void>\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst parsedLink = this.#linkParser.parse(link);\n\t\t\tif (!parsedLink)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst payload = {\n\t\t\t\t...parsedLink.payload,\n\t\t\t\t...options,\n\t\t\t};\n\n\t\t\tawait this.#actionDispatcher.execute(parsedLink.actionName, payload);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('ChatActionService: Failed to process link', error);\n\t\t}\n\t}\n}\n\nexport const chatActionService = new ChatActionService({\n\tactionDispatcher: new ChatActionDispatcher(),\n\tlinkParser: new ChatLinkParser(),\n});\n"],"names":["BaseAction","execute","payload","Error","constructor","name","getName","isValid","hasPermission","Type","isPlainObject","isNumber","taskId","isDomNode","bindElement","ChatActionDispatcher","Map","register","action","actionName","has","set","isString","trim","get","ChatLinkParser","parse","link","console","error","ChatActionParam","ChatAction","chatAction","EntityId","entityId","matches","groups","parsedTaskId","urlParams","url","anchor","isArray","length","URLSearchParams","ChildrenIds","paramName","result","forEach","value","key","startsWith","push","parsed","parseInt","Number","isInteger","ChatHint","Hint","show","text","popupOptions","options","id","content","offsetLeft","maxWidth","padding","targetContainer","document","body","coordinates","x","bindElementRect","getBoundingClientRect","left","showHint","chatHint","CheckListBaseAction","showCheckListRemovedHint","Loc","getMessage","showCheckListItemsRemovedHint","ShowCheckListAction","ShowCheckList","checkListService","isCheckListExists","EventEmitter","emit","EventName","checkListId","showCheckListAction","ShowCheckListItemsAction","ShowCheckListItems","childrenIds","filteredItems","filterItemsBelongingToCheckList","checkListItemIds","slice","showCheckListItemsAction","ChangeDeadlineAction","ChangeDeadline","task","taskService","getStoreTask","isFlowFilledOnAdd","flowId","rights","deadline","currentUserId","Core","getStore","getters","Model","Interface","isCreator","creatorId","maxDeadlineChanges","deadlineChangeCount","exceededChangeCount","width","OpenDeadlinePicker","changeDeadlineAction","CompleteTaskAction","CompleteTask","statusService","complete","$store","completeTaskAction","OpenResultAction","OpenResult","results","includes","OpenResultFromChat","resultId","openResultAction","ChatActionService","dependencies","actionDispatcher","linkParser","process","parsedLink","chatActionService"],"mappings":";;;;;;;CAAiC;AAIjC,CAAO,MAAMA,UAAU,CACvB;GAAA;KAAA;OAAA;;;GACCC,OAAO,CAACC,OAAsB,EAC9B;KACC,MAAM,IAAIC,KAAK,CAAE,yCAAwC,IAAI,CAACC,WAAW,CAACC,IAAK,EAAC,CAAC;;GAGlFC,OAAO,GACP;KACC,MAAM,IAAIH,KAAK,CAAE,yCAAwC,IAAI,CAACC,WAAW,CAACC,IAAK,EAAC,CAAC;;GAGlFE,OAAO,CAACL,OAAsB,EAC9B;KACC,+CAAO,IAAI,sCAAkBA,OAAO;;GAGrCM,aAAa,CAACN,OAAsB,EACpC;KACC,OAAO,IAAI;;CAgBb;CAAC,2BAbiBA,OAAsB,EACvC;GACC,IAAI,CAACO,cAAI,CAACC,aAAa,CAACR,OAAO,CAAC,EAChC;KACC,OAAO,KAAK;;GAGb,OACCO,cAAI,CAACE,QAAQ,CAACT,OAAO,CAACU,MAAM,CAAC,IAC1BV,OAAO,CAACU,MAAM,GAAG,CAAC,IAClBH,cAAI,CAACI,SAAS,CAACX,OAAO,CAACY,WAAW,CAAC;CAExC;;CCpCoD;AAGrD,CAAO,MAAMC,oBAAoB,CACjC;GAAA;KAAA;OAAA;OAAA,OACqC,IAAIC,GAAG;;;GAE3CC,QAAQ,CAACC,MAAkB,EAC3B;KACC,MAAMC,UAAU,GAAGD,MAAM,CAACZ,OAAO,EAAE;KACnC,IAAI,4CAAI,sBAAUc,GAAG,CAACD,UAAU,CAAC,EACjC;OACC,MAAM,IAAIhB,KAAK,CAAE,iCAAgCgB,UAAW,sBAAqB,CAAC;;KAGnF,4CAAI,sBAAUE,GAAG,CAACF,UAAU,EAAED,MAAM,CAAC;;GAGtC,MAAMjB,OAAO,CAACkB,UAAkB,EAAEjB,OAAsB,EACxD;KACC,IAAI,CAACO,cAAI,CAACa,QAAQ,CAACH,UAAU,CAAC,IAAIA,UAAU,CAACI,IAAI,EAAE,KAAK,EAAE,EAC1D;OACC,MAAM,IAAIpB,KAAK,CAAC,qBAAqB,CAAC;;KAGvC,MAAMe,MAAM,GAAG,4CAAI,sBAAUM,GAAG,CAACL,UAAU,CAACI,IAAI,EAAE,CAAC;KACnD,IAAI,CAACL,MAAM,EACX;OACC,MAAM,IAAIf,KAAK,CAAE,WAAUgB,UAAW,aAAY,CAAC;;KAGpD,MAAMD,MAAM,CAACjB,OAAO,CAACC,OAAO,CAAC;;CAE/B;;CChCiD;CAAA;CAAA;CAAA;AAEjD,CAAO,MAAMuB,cAAc,CAC3B;GAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;;GACCC,KAAK,CAACC,IAAU,EAChB;KACC,IAAI,yCAAC,IAAI,gCAAeA,IAAI,CAAC,EAC7B;OACCC,OAAO,CAACC,KAAK,CAAC,mCAAmC,CAAC;OAElD,OAAO,IAAI;;KAGZ,MAAM;OACLjB,MAAM;OACN,CAACkB,8BAAe,CAACC,UAAU,GAAGC,UAAU;OACxC,CAACF,8BAAe,CAACG,QAAQ,GAAGC;MAC5B,GAAGP,IAAI,CAACQ,OAAO,CAACC,MAAM;KAEvB,MAAMC,YAAY,2CAAG,IAAI,8BAAczB,MAAM,CAAC;KAE9C,IAAIyB,YAAY,IAAI,CAAC,EACrB;OACCT,OAAO,CAACC,KAAK,CAAC,gDAAgD,CAAC;OAE/D,OAAO,IAAI;;KAGZ,IAAI,CAACG,UAAU,IAAIA,UAAU,CAACT,IAAI,EAAE,KAAK,EAAE,EAC3C;OACCK,OAAO,CAACC,KAAK,CAAC,wCAAwC,CAAC;OAEvD,OAAO,IAAI;;KAGZ,MAAMS,SAAS,2CAAG,IAAI,oCAAiBX,IAAI,CAACY,GAAG,CAAC;KAEhD,OAAO;OACNpB,UAAU,EAAEa,UAAU,CAACT,IAAI,EAAE;OAC7BrB,OAAO,EAAE;SACRU,MAAM,EAAEyB,YAAY;SACpBH,QAAQ,EAAEA,QAAQ,2CAAG,IAAI,8BAAcA,QAAQ,IAAI,IAAI;SACvDpB,WAAW,EAAEa,IAAI,CAACa,MAAM;SACxB,GAAGF;;MAEJ;;CA0DH;CAAC,wBAvDcX,IAAU,EACxB;GACC,IAAI,CAAClB,cAAI,CAACC,aAAa,CAACiB,IAAI,CAAC,EAC7B;KACC,OAAO,KAAK;;GAGb,IAAI,CAAClB,cAAI,CAACa,QAAQ,CAACK,IAAI,CAACY,GAAG,CAAC,IAAIZ,IAAI,CAACY,GAAG,CAAChB,IAAI,EAAE,KAAK,EAAE,EACtD;KACC,OAAO,KAAK;;GAGb,IAAI,CAACd,cAAI,CAACgC,OAAO,CAACd,IAAI,CAACQ,OAAO,CAAC,IAAIR,IAAI,CAACQ,OAAO,CAACO,MAAM,GAAG,CAAC,EAC1D;KACC,OAAO,KAAK;;GAGb,OAAOjC,cAAI,CAACI,SAAS,CAACc,IAAI,CAACa,MAAM,CAAC;CACnC;CAAC,0BAEeD,GAAW,EAC3B;GACC,IACA;KACC,MAAMD,SAAS,GAAG,IAAIK,eAAe,CAACJ,GAAG,CAAC;KAE1C,OAAO;OACN,CAACT,8BAAe,CAACc,WAAW,2CAAG,IAAI,kCAAgBN,SAAS,EAAER,8BAAe,CAACc,WAAW;MACzF;IACD,CACD,MACA;KACC,OAAO,EAAE;;CAEX;CAAC,yBAEcN,SAA0B,EAAEO,SAAiB,EAC5D;GACC,MAAMC,MAAM,GAAG,EAAE;GACjBR,SAAS,CAACS,OAAO,CAAC,CAACC,KAAa,EAAEC,GAAW,KAAK;KACjD,IAAIA,GAAG,CAACC,UAAU,CAACL,SAAS,CAAC,EAC7B;OACCC,MAAM,CAACK,IAAI,yCAAC,IAAI,8BAAcH,KAAK,EAAE;;IAEtC,CAAC;GAEF,OAAOF,MAAM;CACd;CAAC,uBAEYE,KAAa,EAC1B;GACC,MAAMI,MAAM,GAAGC,QAAQ,CAACL,KAAK,EAAE,EAAE,CAAC;GAElC,OAAOM,MAAM,CAACC,SAAS,CAACH,MAAM,CAAC,GAAGA,MAAM,GAAG,CAAC;CAC7C;;CCvGwC;CAIzC,MAAMI,QAAQ,SAASC,sBAAI,CAC3B;GAAA;KAAA;KAAA;OAAA;OAAA,OACoB;;;GAEnB,MAAMC,IAAI,CAACC,IAAY,EAAEzD,OAAsB,EAAE0D,YAA0B,EAC3E;KAAA;KACC,MAAMC,OAAO,GAAG;OACfC,EAAE,0CAAE,IAAI,qBAAS;OACjBhD,WAAW,EAAEZ,OAAO,CAACY,WAAW;OAChCiD,OAAO,EAAEJ,IAAI;OACbK,UAAU,EAAE,EAAE;OACdC,QAAQ,EAAE,GAAG;OACbC,OAAO,EAAE,EAAE;OACXC,eAAe,EAAEC,QAAQ,CAACC,IAAI;OAC9B,GAAGT;MACH;KAED,4BAAI1D,OAAO,CAACoE,WAAW,aAAnB,qBAAqBC,CAAC,EAC1B;OACC,MAAMC,eAAe,GAAGtE,OAAO,CAACY,WAAW,CAAC2D,qBAAqB,EAAE;OAEnEZ,OAAO,CAACG,UAAU,GAAG9D,OAAO,CAACoE,WAAW,CAACC,CAAC,GAAGC,eAAe,CAACE,IAAI;;KAGlE,MAAM,KAAK,CAACC,QAAQ,CAACd,OAAO,CAAC;;CAE/B;AAEA,CAAO,MAAMe,QAAQ,GAAG,IAAIpB,QAAQ,EAAE;;CC9B/B,MAAMqB,mBAAmB,SAAS7E,UAAU,CACnD;GACC8E,wBAAwB,CAAChE,WAAwB,EAAEwD,WAAmB,EACtE;KACC,KAAKM,QAAQ,CAAClB,IAAI,CACjBqB,aAAG,CAACC,UAAU,CAAC,8CAA8C,CAAC,EAC9D;OAAElE,WAAW;OAAEwD;MAAa,CAC5B;;GAGFW,6BAA6B,CAACnE,WAAwB,EAAEwD,WAAmB,EAC3E;KACC,KAAKM,QAAQ,CAAClB,IAAI,CACjBqB,aAAG,CAACC,UAAU,CAAC,oDAAoD,CAAC,EACpE;OAAElE,WAAW;OAAEwD;MAAa,CAC5B;;CAEH;;CCbA,MAAMY,mBAAmB,SAASL,mBAAmB,CACrD;GACCvE,OAAO,GACP;KACC,OAAOyB,yBAAU,CAACoD,aAAa;;GAGhC,MAAMlF,OAAO,CAACC,OAAsB,EACpC;KACC,IAAI,CAAC,IAAI,CAACK,OAAO,CAACL,OAAO,CAAC,EAC1B;OACC,MAAM,IAAIC,KAAK,CAAC,iBAAiB,CAAC;;KAGnC,MAAM;OAAE+B,QAAQ;OAAEpB,WAAW;OAAEwD;MAAa,GAAGpE,OAAO;KAEtD,IAAI,CAACkF,2DAAgB,CAACC,iBAAiB,CAACnD,QAAQ,CAAC,EACjD;OACC,IAAI,CAAC4C,wBAAwB,CAAChE,WAAW,EAAEwD,WAAW,CAAC;OAEvD;;KAGDgB,6BAAY,CAACC,IAAI,CAACC,wBAAS,CAACL,aAAa,EAAE;OAAEM,WAAW,EAAEvD;MAAU,CAAC;;CAEvE;AAEA,CAAO,MAAMwD,mBAAmB,GAAG,IAAIR,mBAAmB,EAAE;;CC3B5D,MAAMS,wBAAwB,SAASd,mBAAmB,CAC1D;GACCvE,OAAO,GACP;KACC,OAAOyB,yBAAU,CAAC6D,kBAAkB;;GAGrC,MAAM3F,OAAO,CAACC,OAAsB,EACpC;KACC,IAAI,CAAC,IAAI,CAACK,OAAO,CAACL,OAAO,CAAC,EAC1B;OACC,MAAM,IAAIC,KAAK,CAAC,iBAAiB,CAAC;;KAGnC,MAAM;OAAE+B,QAAQ;OAAE2D,WAAW;OAAE/E,WAAW;OAAEwD;MAAa,GAAGpE,OAAO;KAEnE,IAAI,CAACkF,2DAAgB,CAACC,iBAAiB,CAACnD,QAAQ,CAAC,EACjD;OACC,IAAI,CAAC4C,wBAAwB,CAAChE,WAAW,EAAEwD,WAAW,CAAC;OAEvD;;KAGD,MAAMwB,aAAa,GAAGV,2DAAgB,CAACW,+BAA+B,CAAC7D,QAAQ,EAAE2D,WAAW,CAAC;KAE7F,IAAIC,aAAa,CAACpD,MAAM,KAAK,CAAC,EAC9B;OACC,IAAI,CAACuC,6BAA6B,CAACnE,WAAW,EAAEwD,WAAW,CAAC;OAE5D;;KAGDgB,6BAAY,CAACC,IAAI,CAACC,wBAAS,CAACI,kBAAkB,EAAE;OAAEI,gBAAgB,EAAEF,aAAa,CAACG,KAAK,CAAC,CAAC,EAAE,EAAE;MAAG,CAAC;;CAEnG;AAEA,CAAO,MAAMC,wBAAwB,GAAG,IAAIP,wBAAwB,EAAE;;CClC9B;CAAA;CAAA;CAAA;CAExC,MAAMQ,oBAAoB,SAASnG,UAAU,CAC7C;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;;GACCM,OAAO,GACP;KACC,OAAOyB,yBAAU,CAACqE,cAAc;;GAGjC,MAAMnG,OAAO,CAACC,OAAsB,EACpC;KACC,IAAI,CAAC,IAAI,CAACK,OAAO,CAACL,OAAO,CAAC,EAC1B;OACC,MAAM,IAAIC,KAAK,CAAC,iBAAiB,CAAC;;KAGnC,IAAI,CAAC,IAAI,CAACK,aAAa,CAACN,OAAO,CAAC,EAChC;OACC,4CAAI,gDAAuBA,OAAO;OAElC;;KAGD,4CAAI,8DAA8BA,OAAO;;GAG1CM,aAAa,CAACN,OAAsB,EACpC;KACC,MAAMmG,IAAI,GAAGC,iDAAW,CAACC,YAAY,CAACrG,OAAO,CAACU,MAAM,CAAC;KACrD,IAAI,CAACyF,IAAI,EACT;OACC,OAAO,KAAK;;KAGb,+CAAO,IAAI,0CAAoBA,IAAI;;CA4DrC;CAAC,6BAzDmBA,IAAe,EAClC;GACC,MAAMG,iBAAiB,GAAGH,IAAI,CAACI,MAAM,GAAG,CAAC;GAEzC,OACCJ,IAAI,CAACK,MAAM,CAACC,QAAQ,IACjB,yCAAC,IAAI,8CAAsBN,IAAI,CAAC,IAChC,CAACG,iBAAiB;CAEvB;CAAC,+BAEoBH,IAAe,EACpC;GACC,MAAMO,aAAa,GAAGC,kBAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACC,SAAU,gBAAe,CAAC;GACjF,MAAMC,SAAS,GAAGN,aAAa,KAAKP,IAAI,CAACc,SAAS;GAClD,IAAID,SAAS,IAAI,CAACb,IAAI,CAACe,kBAAkB,EACzC;KACC,OAAO,KAAK;;GAGb,MAAMC,mBAAmB,GAAGR,kBAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAE,GAAEC,oBAAK,CAACC,SAAU,sBAAqB,CAAC;GAE7F,OAAOI,mBAAmB,IAAIhB,IAAI,CAACe,kBAAkB;CACtD;CAAC,gCAEqBlH,OAAsB,EAC5C;GACC,MAAMmG,IAAI,GAAGC,iDAAW,CAACC,YAAY,CAACrG,OAAO,CAACU,MAAM,CAAC;GAErD,MAAM0G,mBAAmB,2CAAG,IAAI,8CAAsBjB,IAAI,CAAC;GAE3D,MAAM1C,IAAI,GACT2D,mBAAmB,GAChBvC,aAAG,CAACC,UAAU,CAAC,+CAA+C,CAAC,GAC/DD,aAAG,CAACC,UAAU,CAAC,oDAAoD,CACtE;GAED,MAAMuC,KAAK,GAAID,mBAAmB,GAAG,GAAG,GAAG,GAAI;GAE/C,KAAK1C,QAAQ,CAAClB,IAAI,CACjBC,IAAI,EACJzD,OAAO,EACP;KAAE+D,QAAQ,EAAEsD;IAAO,CACnB;CACF;CAAC,uCAE4BrH,OAAsB,EACnD;GACCoF,6BAAY,CAACC,IAAI,CAChBC,wBAAS,CAACgC,kBAAkB,EAC5B;KACC5G,MAAM,EAAEV,OAAO,CAACU,MAAM;KACtBE,WAAW,EAAEZ,OAAO,CAACY,WAAW;KAChCwD,WAAW,EAAEpE,OAAO,CAACoE;IACrB,CACD;CACF;AAGD,CAAO,MAAMmD,oBAAoB,GAAG,IAAItB,oBAAoB,EAAE;;CChGtB;CAExC,MAAMuB,kBAAkB,SAAS1H,UAAU,CAC3C;GAAA;KAAA;KAAA;OAAA;;;GACCM,OAAO,GACP;KACC,OAAOyB,yBAAU,CAAC4F,YAAY;;GAG/B,MAAM1H,OAAO,CAACC,OAAsB,EACpC;KACC,IAAI,CAAC,IAAI,CAACK,OAAO,CAACL,OAAO,CAAC,EAC1B;OACC,MAAM,IAAIC,KAAK,CAAC,iBAAiB,CAAC;;KAGnC,IAAI,CAAC,IAAI,CAACK,aAAa,CAACN,OAAO,CAAC,EAChC;OACC,4CAAI,oDAAuBA,OAAO;OAElC;;KAGD,MAAM0H,qDAAa,CAACC,QAAQ,CAAC3H,OAAO,CAACU,MAAM,CAAC;;GAG7CJ,aAAa,CAACN,OAAsB,EACpC;KAAA;KACC,MAAMmG,IAAI,GAAGC,iDAAW,CAACC,YAAY,CAACrG,OAAO,CAACU,MAAM,CAAC;KAErD,OAAOyF,IAAI,IAAI,iBAAAA,IAAI,CAACK,MAAM,qBAAX,aAAamB,QAAQ,MAAK,IAAI;;GAQ9C,IAAIC,MAAM,GACV;KACC,OAAOjB,kBAAI,CAACC,QAAQ,EAAE;;CAExB;CAAC,kCATsB5G,OAAsB,EAC5C;GACC,KAAK0E,QAAQ,CAAClB,IAAI,CAACqB,aAAG,CAACC,UAAU,CAAC,kDAAkD,CAAC,EAAE9E,OAAO,CAAC;CAChG;AAQD,CAAO,MAAM6H,kBAAkB,GAAG,IAAIL,kBAAkB,EAAE;;CC/Cf;CAAA;CAAA;CAG3C,MAAMM,gBAAgB,SAAShI,UAAU,CACzC;GAAA;KAAA;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;;GACCM,OAAO,GACP;KACC,OAAOyB,yBAAU,CAACkG,UAAU;;GAG7B,MAAMhI,OAAO,CAACC,OAAsB,EACpC;KACC,IAAI,CAAC,IAAI,CAACK,OAAO,CAACL,OAAO,CAAC,EAC1B;OACC,MAAM,IAAIC,KAAK,CAAC,iBAAiB,CAAC;;KAGnC,IAAI,yCAAC,IAAI,0BAAYD,OAAO,CAAC,EAC7B;OACC,4CAAI,wCAAmBA,OAAO;OAE9B;;KAGD,4CAAI,8CAAsBA,OAAO;;CAgCnC;CAAC,qBA7BWA,OAAsB,EACjC;GACC,MAAM;KAAEgC,QAAQ;KAAEtB;IAAQ,GAAGV,OAAO;GAEpC,IAAI,CAACgC,QAAQ,IAAI,CAACtB,MAAM,EACxB;KACC,OAAO,KAAK;;GAGb,MAAMyF,IAAI,GAAGC,iDAAW,CAACC,YAAY,CAAC3F,MAAM,CAAC;GAE7C,OAAO,EAAE,EAACyF,IAAI,YAAJA,IAAI,CAAE6B,OAAO,KAAI,CAAC7B,IAAI,CAAC6B,OAAO,CAACC,QAAQ,CAACjG,QAAQ,CAAC,CAAC;CAC7D;CAAC,4BAEiBhC,OAAsB,EACxC;GACC,KAAK0E,QAAQ,CAAClB,IAAI,CAACqB,aAAG,CAACC,UAAU,CAAC,uCAAuC,CAAC,EAAE9E,OAAO,CAAC;CACrF;CAAC,+BAEoBA,OAAsB,EAC3C;GACCoF,6BAAY,CAACC,IAAI,CAChBC,wBAAS,CAAC4C,kBAAkB,EAC5B;KACCxH,MAAM,EAAEV,OAAO,CAACU,MAAM;KACtByH,QAAQ,EAAEnI,OAAO,CAACgC;IAClB,CACD;CACF;AAGD,CAAO,MAAMoG,gBAAgB,GAAG,IAAIN,gBAAgB,EAAE;;CC3DS;CAAA;CAAA;CAAA;AAc/D,CAAO,MAAMO,iBAAiB,CAC9B;GAYCnI,WAAW,CAACoI,YAA0B,EACtC;KAAA;OAAA;;KAAA;OAAA;OAAA,OAZqC,CACpCf,oBAAoB,EACpBM,kBAAkB,EAClBO,gBAAgB,EAChB5C,mBAAmB,EACnBQ,wBAAwB;;KACxB;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAOA,4CAAI,0CAAqBsC,YAAY,CAACC,gBAAgB;KACtD,4CAAI,8BAAeD,YAAY,CAACE,UAAU;KAE1C,4CAAI;;GAiBL,MAAMC,OAAO,CAAChH,IAAU,EAAEkC,OAAgB,GAAG,EAAE,EAC/C;KACC,IACA;OACC,MAAM+E,UAAU,GAAG,4CAAI,4BAAalH,KAAK,CAACC,IAAI,CAAC;OAC/C,IAAI,CAACiH,UAAU,EACf;SACC;;OAGD,MAAM1I,OAAO,GAAG;SACf,GAAG0I,UAAU,CAAC1I,OAAO;SACrB,GAAG2D;QACH;OAED,MAAM,4CAAI,wCAAmB5D,OAAO,CAAC2I,UAAU,CAACzH,UAAU,EAAEjB,OAAO,CAAC;MACpE,CACD,OAAO2B,KAAK,EACZ;OACCD,OAAO,CAACC,KAAK,CAAC,2CAA2C,EAAEA,KAAK,CAAC;;;CAGpE;CAAC,oCAnCA;GACC,4CAAI,oCAAiBkB,OAAO,CAAE7B,MAAkB,IAAW;KAC1D,IACA;OACC,4CAAI,wCAAmBD,QAAQ,CAACC,MAAM,CAAC;MACvC,CACD,OAAOW,KAAK,EACZ;OACCD,OAAO,CAACC,KAAK,CAAC,8CAA8C,EAAEX,MAAM,CAACZ,OAAO,EAAE,EAAEuB,KAAK,CAAC;;IAEvF,CAAC;CACH;AA0BD,OAAagH,iBAAiB,GAAG,IAAIN,iBAAiB,CAAC;GACtDE,gBAAgB,EAAE,IAAI1H,oBAAoB,EAAE;GAC5C2H,UAAU,EAAE,IAAIjH,cAAc;CAC/B,CAAC,CAAC;;;;;;;;;"}