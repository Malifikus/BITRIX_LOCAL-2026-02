{"version":3,"file":"calendar.bundle.js","sources":["../src/calendar.js"],"sourcesContent":["import { Extension, Loc } from 'main.core';\nimport { DateTimeFormat, DurationFormat } from 'main.date';\nimport { timezone } from 'tasks.v2.lib.timezone';\n\nconst settings = Extension.getSettings('tasks.v2.lib.calendar').calendarSettings;\nconst holidays = new Set(settings.HOLIDAYS.map(({ M, D }) => `${M}.${D}`));\nconst weekends = new Set(settings.WEEKEND.map((it) => ({ SU: 0, MO: 1, TU: 2, WE: 3, TH: 4, FR: 5, SA: 6 }[it])));\nconst { H: startH, M: startM } = settings.HOURS.START;\nconst { H: endH, M: endM } = settings.HOURS.END;\n\nconst unitDurations = DurationFormat.getUnitDurations();\nconst workdayDuration = ((endH * 60 + endM) - (startH * 60 + startM)) * 60000;\nconst workWeekDuration = workdayDuration * (7 - weekends.size);\n\nexport const calendar = new class\n{\n\tget weekStart(): string\n\t{\n\t\treturn settings.WEEK_START;\n\t}\n\n\tget workdayDuration(): void\n\t{\n\t\treturn workdayDuration;\n\t}\n\n\tget workdayStart(): { H: string, M: string }\n\t{\n\t\treturn settings.HOURS.START;\n\t}\n\n\tget dayStartTime(): string\n\t{\n\t\treturn `${String(startH).padStart(2, '0')}:${String(startM).padStart(2, '0')}`;\n\t}\n\n\tget dayEndTime(): string\n\t{\n\t\treturn `${String(endH).padStart(2, '0')}:${String(endM).padStart(2, '0')}`;\n\t}\n\n\tformatDateTime(timestamp: number, { forceYear, removeOffset }: { forceYear: boolean } = {}): string\n\t{\n\t\tif (!timestamp)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst showYear = forceYear || new Date(timestamp).getFullYear() !== new Date().getFullYear();\n\t\tconst format = Loc.getMessage('TASKS_V2_DATE_TIME_FORMAT', {\n\t\t\t'#DATE#': DateTimeFormat.getFormat(showYear ? 'LONG_DATE_FORMAT' : 'DAY_MONTH_FORMAT'),\n\t\t\t'#TIME#': DateTimeFormat.getFormat('SHORT_TIME_FORMAT'),\n\t\t});\n\t\tconst offset = removeOffset ? 0 : timezone.getOffset(timestamp);\n\n\t\treturn DateTimeFormat.format(format, (timestamp + offset) / 1000);\n\t}\n\n\tformatDate(timestamp: number, { forceYear }: { forceYear: boolean } = {}): string\n\t{\n\t\tif (!timestamp)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst showYear = forceYear || new Date(timestamp).getFullYear() !== new Date().getFullYear();\n\t\tconst format = DateTimeFormat.getFormat(showYear ? 'LONG_DATE_FORMAT' : 'DAY_MONTH_FORMAT');\n\t\tconst offset = timezone.getOffset(timestamp);\n\n\t\treturn DateTimeFormat.format(format, (timestamp + offset) / 1000);\n\t}\n\n\tformatDuration(durationTs: number, matchWorkTime: boolean): string\n\t{\n\t\tconst dayDuration = matchWorkTime ? this.workdayDuration : unitDurations.d;\n\t\tconst minutes = durationTs / unitDurations.i;\n\t\tconst hours = durationTs / unitDurations.H;\n\t\tconst days = durationTs / dayDuration;\n\n\t\tconst [duration, format] = {\n\t\t\t[true]: [Math.floor(minutes) * unitDurations.i, 'i'],\n\t\t\t[Number.isInteger(hours)]: [hours * unitDurations.H, 'H'],\n\t\t\t[Number.isInteger(days)]: [days * unitDurations.d, 'd'],\n\t\t}.true;\n\n\t\treturn new DurationFormat(duration).format({ format });\n\t}\n\n\tcalculateDuration(startTs: number, end: number): number\n\t{\n\t\tconst dayEnd = this.setHours(startTs, endH, endM);\n\t\tif (end < dayEnd)\n\t\t{\n\t\t\treturn end - startTs;\n\t\t}\n\n\t\tlet start = this.setHours(startTs + unitDurations.d, startH, startM);\n\t\tlet duration = dayEnd - startTs;\n\t\twhile (start < end)\n\t\t{\n\t\t\tif (this.isWorkDay(start))\n\t\t\t{\n\t\t\t\tduration += Math.min(start + workdayDuration, end) - start;\n\t\t\t}\n\n\t\t\tstart += unitDurations.d;\n\t\t}\n\n\t\treturn duration;\n\t}\n\n\tcalculateStartTs(startTs: number, endTs: number, duration: number): number\n\t{\n\t\treturn startTs ?? this.#calculateRangeTs(endTs, duration, true);\n\t}\n\n\tcalculateEndTs(startTs: number, endTs: number, durationTs: number): number\n\t{\n\t\tif (!startTs)\n\t\t{\n\t\t\treturn endTs;\n\t\t}\n\n\t\tlet duration = durationTs;\n\t\tlet start = startTs;\n\n\t\tconst daysUntilNextMonday = (1 + 7 - new Date(start - timezone.getOffset(start)).getDay()) % 7;\n\t\tconst nextMondayTs = this.setHours(start + unitDurations.d * daysUntilNextMonday, startH, startM);\n\t\tconst mondayDuration = this.calculateDuration(start, nextMondayTs);\n\t\tif (duration <= mondayDuration)\n\t\t{\n\t\t\treturn this.#calculateRangeTs(start, duration);\n\t\t}\n\n\t\tduration -= mondayDuration;\n\t\tstart = nextMondayTs;\n\n\t\tconst beforeSkip = new Date(start).setHours(0, 0, 0);\n\t\tconst weeks = Math.max(Math.floor(duration / workWeekDuration) - 1, 0);\n\t\tduration -= workWeekDuration * weeks;\n\t\tstart = this.setHours(start + unitDurations.d * weeks * 7, startH, startM);\n\t\tconst afterSkip = new Date(start).setHours(0, 0, 0) - unitDurations.d;\n\n\t\tconst fromYear = new Date(beforeSkip).getFullYear();\n\t\tconst toYear = new Date(afterSkip).getFullYear();\n\t\tconst missedHolidays = Array.from({ length: toYear - fromYear + 1 }, (_, i) => i + fromYear)\n\t\t\t.flatMap((year) => settings.HOLIDAYS.map(({ M, D }) => new Date(year, M - 1, D).getTime()))\n\t\t\t.filter((it) => beforeSkip <= it && it <= afterSkip && !weekends.has(new Date(it).getDay()))\n\t\t;\n\n\t\tif (missedHolidays.length > 0)\n\t\t{\n\t\t\treturn this.calculateEndTs(start, endTs, duration + workdayDuration * missedHolidays.length);\n\t\t}\n\n\t\treturn this.#calculateRangeTs(start, duration);\n\t}\n\n\t#calculateRangeTs(anchorTs: number, durationTs: number, backwards: boolean): number\n\t{\n\t\tconst direction = backwards ? -1 : 1;\n\t\tconst anchorHours = backwards ? settings.HOURS.END : settings.HOURS.START;\n\t\tconst oppositeHours = backwards ? settings.HOURS.START : settings.HOURS.END;\n\n\t\tlet anchor = anchorTs;\n\t\tlet duration = durationTs;\n\t\twhile (duration > 0)\n\t\t{\n\t\t\tif (this.isWorkDay(anchor))\n\t\t\t{\n\t\t\t\tconst dayLength = Math.abs(anchor - this.setHours(anchor, oppositeHours.H, oppositeHours.M));\n\t\t\t\tconst opposite = anchor + Math.min(dayLength, duration, workdayDuration) * direction;\n\t\t\t\tduration -= Math.abs(anchor - opposite);\n\t\t\t\tif (duration === 0)\n\t\t\t\t{\n\t\t\t\t\treturn opposite;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tanchor = this.setHours(anchor + unitDurations.d * direction, anchorHours.H, anchorHours.M);\n\t\t}\n\n\t\treturn anchorTs;\n\t}\n\n\tclampWorkDateTime(timestamp: ?number): ?number\n\t{\n\t\tif (!timestamp)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet workday = timestamp;\n\t\twhile (!this.isWorkDay(workday))\n\t\t{\n\t\t\tworkday = this.setHours(workday + unitDurations.d, startH, startM);\n\t\t}\n\n\t\tconst dayStart = this.setHours(workday, startH, startM);\n\t\tconst dayEnd = this.setHours(workday, endH, endM);\n\n\t\treturn Math.min(Math.max(workday, dayStart), dayEnd);\n\t}\n\n\tisWorkDay(timestamp: number): boolean\n\t{\n\t\tconst date = new Date(timestamp);\n\n\t\treturn !weekends.has(date.getUTCDay()) && !holidays.has(`${date.getUTCMonth() + 1}.${date.getUTCDate()}`);\n\t}\n\n\tsetHours(timestamp: number, hours: number, minutes: number): number\n\t{\n\t\treturn new Date(timestamp).setHours(hours, minutes, 0, 0) - timezone.getOffset(timestamp);\n\t}\n\n\tcreateDateFromUtc(date: Date): Date\n\t{\n\t\treturn new Date(\n\t\t\tdate.getUTCFullYear(),\n\t\t\tdate.getUTCMonth(),\n\t\t\tdate.getUTCDate(),\n\t\t\tdate.getUTCHours(),\n\t\t\tdate.getUTCMinutes(),\n\t\t);\n\t}\n}();\n"],"names":["settings","Extension","getSettings","calendarSettings","holidays","Set","HOLIDAYS","map","M","D","weekends","WEEKEND","it","SU","MO","TU","WE","TH","FR","SA","H","startH","startM","HOURS","START","endH","endM","END","unitDurations","DurationFormat","getUnitDurations","workdayDuration","workWeekDuration","size","calendar","weekStart","WEEK_START","workdayStart","dayStartTime","String","padStart","dayEndTime","formatDateTime","timestamp","forceYear","removeOffset","showYear","Date","getFullYear","format","Loc","getMessage","DateTimeFormat","getFormat","offset","timezone","getOffset","formatDate","formatDuration","durationTs","matchWorkTime","dayDuration","d","minutes","i","hours","days","duration","Math","floor","Number","isInteger","true","calculateDuration","startTs","end","dayEnd","setHours","start","isWorkDay","min","calculateStartTs","endTs","calculateEndTs","daysUntilNextMonday","getDay","nextMondayTs","mondayDuration","beforeSkip","weeks","max","afterSkip","fromYear","toYear","missedHolidays","Array","from","length","_","flatMap","year","getTime","filter","has","clampWorkDateTime","workday","dayStart","date","getUTCDay","getUTCMonth","getUTCDate","createDateFromUtc","getUTCFullYear","getUTCHours","getUTCMinutes","anchorTs","backwards","direction","anchorHours","oppositeHours","anchor","dayLength","abs","opposite"],"mappings":"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"}