this.BX=this.BX||{};this.BX.Tasks=this.BX.Tasks||{};this.BX.Tasks.V2=this.BX.Tasks.V2||{};(function(e,s,t,l,a){"use strict";var i,r,o,n,b,c,d,p,v,u,h,P;let L=null;const f=new(i=babelHelpers.classPrivateFieldLooseKey("ids"),r=babelHelpers.classPrivateFieldLooseKey("selectableIds"),o=babelHelpers.classPrivateFieldLooseKey("onClose"),n=babelHelpers.classPrivateFieldLooseKey("withAngle"),b=babelHelpers.classPrivateFieldLooseKey("isMultiple"),c=babelHelpers.classPrivateFieldLooseKey("hidePromise"),d=babelHelpers.classPrivateFieldLooseKey("createDialog"),p=babelHelpers.classPrivateFieldLooseKey("fillDialog"),v=babelHelpers.classPrivateFieldLooseKey("fillStore"),u=babelHelpers.classPrivateFieldLooseKey("setSelectableByIds"),h=babelHelpers.classPrivateFieldLooseKey("items"),P=babelHelpers.classPrivateFieldLooseKey("mapIdsToItemIds"),class{constructor(){Object.defineProperty(this,P,{value:m});Object.defineProperty(this,h,{get:H,set:void 0});Object.defineProperty(this,u,{value:F});Object.defineProperty(this,v,{value:B});Object.defineProperty(this,p,{value:g});Object.defineProperty(this,d,{value:y});Object.defineProperty(this,i,{writable:true,value:void 0});Object.defineProperty(this,r,{writable:true,value:void 0});Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:true});Object.defineProperty(this,c,{writable:true,value:void 0})}async show(e){var s,t,l;if((s=L)!=null&&s.isOpen()&&L.getTargetNode()!==e.targetNode){babelHelpers.classPrivateFieldLooseBase(this,c)[c]=new I;await babelHelpers.classPrivateFieldLooseBase(this,c)[c]}babelHelpers.classPrivateFieldLooseBase(this,i)[i]=e.ids;babelHelpers.classPrivateFieldLooseBase(this,r)[r]=e.selectableIds;babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e.onClose;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.withAngle;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=(t=e.isMultiple)!=null?t:true;(l=L)!=null?l:L=babelHelpers.classPrivateFieldLooseBase(this,d)[d]();babelHelpers.classPrivateFieldLooseBase(this,p)[p](babelHelpers.classPrivateFieldLooseBase(this,i)[i]);L.selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,h)[h]);babelHelpers.classPrivateFieldLooseBase(this,u)[u]();L.showTo(e.targetNode)}getDialog(){return L}});function y(){const e=t.Core.getParams().restrictions;return new a.EntitySelectorDialog({context:"tasks-card",enableSearch:true,entities:[{id:l.EntitySelectorEntity.User,options:{emailUsers:true,inviteGuestLink:true,analyticsSource:"tasks",lockGuestLink:!e.mailUserIntegration.available,lockGuestLinkFeatureId:e.mailUserIntegration.featureId}},{id:l.EntitySelectorEntity.Department}],preselectedItems:babelHelpers.classPrivateFieldLooseBase(this,h)[h],events:{"Item:onSelect":e=>{if(babelHelpers.classPrivateFieldLooseBase(this,b)[b]){return}const{item:s}=e.getData();L.selectItemsByIds(babelHelpers.classPrivateFieldLooseBase(this,P)[P]([s.getId()]));L.hide()},onLoad:()=>{babelHelpers.classPrivateFieldLooseBase(this,v)[v]();babelHelpers.classPrivateFieldLooseBase(this,u)[u]()},onHide:()=>{var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,c)[c])==null?void 0:e.resolve()}},popupOptions:{events:{onShow:e=>{const t=e.getTarget();if(!babelHelpers.classPrivateFieldLooseBase(this,n)[n]){t.setAngle(false);t.setOffset({offsetLeft:0});return}const l=t.getPopupContainer().offsetWidth;const a=10;const i=a-l/2;const r=s.Popup.getOption("angleLeftOffset")-s.Popup.getOption("angleMinTop");t.setAngle({offset:l/2-r});t.setOffset({offsetLeft:i+s.Popup.getOption("angleLeftOffset")})},onClose:()=>{var e,s;babelHelpers.classPrivateFieldLooseBase(this,v)[v]();const t=L.getSelectedItems().map((e=>e.getId()));(e=(s=babelHelpers.classPrivateFieldLooseBase(this,o))[o])==null?void 0:e.call(s,t)}}}})}function g(e){if(!L||!L.isLoaded()){return}const s=new Set(L.getItems().map((e=>e.getId())));e.filter((e=>!s.has(e))).forEach((e=>{const s=t.Core.getStore().getters[`${l.Model.Users}/getById`](e);L.addItem({id:e,entityId:l.EntitySelectorEntity.User,entityType:s.type,title:s.name,avatar:s.image,tabs:["recents"]})}))}function B(){const e=L.getSelectedItems().map((e=>({id:e.getId(),name:e.getTitle(),image:e.getAvatar(),type:e.getEntityType()})));void t.Core.getStore().dispatch(`${l.Model.Users}/upsertMany`,e)}function F(){const e=L.getItems().map((e=>e.getId()));const s=babelHelpers.classPrivateFieldLooseBase(this,i)[i].filter((e=>{var s;return babelHelpers.classPrivateFieldLooseBase(this,r)[r]&&!((s=babelHelpers.classPrivateFieldLooseBase(this,r)[r])!=null&&s.has(e))}));L.setSelectableByIds({selectable:babelHelpers.classPrivateFieldLooseBase(this,P)[P](e),unselectable:babelHelpers.classPrivateFieldLooseBase(this,P)[P](s)})}function H(){return babelHelpers.classPrivateFieldLooseBase(this,P)[P](babelHelpers.classPrivateFieldLooseBase(this,i)[i])}function m(e){return e.map((e=>[l.EntitySelectorEntity.User,e]))}function I(){let e=null;const s=new Promise((s=>{e=s}));s.resolve=e;return s}e.usersDialog=f})(this.BX.Tasks.V2.Lib=this.BX.Tasks.V2.Lib||{},BX.Main,BX.Tasks.V2,BX.Tasks.V2.Const,BX.Tasks.V2.Lib);
//# sourceMappingURL=user-selector-dialog.bundle.map.js