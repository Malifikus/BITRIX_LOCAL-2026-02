{"version":3,"file":"active-call.bundle.js","sources":["../src/active-call.js"],"sourcesContent":["import { Text } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { ConferenceChannel } from 'call.application.conference-channel';\nimport { CallManager } from 'call.lib.call-manager';\nimport { Analytics as CallAnalytics } from 'call.lib.analytics';\nimport { Messenger } from 'im.public';\nimport { ChatType, RecentCallStatus, EventType } from 'im.v2.const';\nimport { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { ChatButton, ButtonSize, ButtonColor, ButtonIcon, type CustomColorScheme } from 'im.v2.component.elements.button';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport './css/active-call.css';\n\nimport type { ImModelCallItem, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const ActiveCall = {\n\tname: 'ActiveCall',\n\tcomponents: { ChatAvatar, ChatTitle, ChatButton },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['click'],\n\tcomputed:\n\t\t{\n\t\t\tAvatarSize: () => AvatarSize,\n\t\t\tButtonSize: () => ButtonSize,\n\t\t\tButtonColor: () => ButtonColor,\n\t\t\tButtonIcon: () => ButtonIcon,\n\t\t\tactiveCall(): ImModelCallItem\n\t\t\t{\n\t\t\t\treturn this.item;\n\t\t\t},\n\t\t\tdialog(): ImModelChat\n\t\t\t{\n\t\t\t\treturn this.$store.getters['chats/get'](this.activeCall.dialogId, true);\n\t\t\t},\n\t\t\tisConference(): boolean\n\t\t\t{\n\t\t\t\treturn this.dialog.type === ChatType.videoconf;\n\t\t\t},\n\t\t\tpreparedName(): string\n\t\t\t{\n\t\t\t\treturn Text.decode(this.activeCall.name);\n\t\t\t},\n\t\t\tanotherDeviceColorScheme(): CustomColorScheme\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tbackgroundColor: 'transparent',\n\t\t\t\t\tborderColor: '#bbde4d',\n\t\t\t\t\ticonColor: '#525c69',\n\t\t\t\t\ttextColor: '#525c69',\n\t\t\t\t\thoverColor: 'transparent',\n\t\t\t\t};\n\t\t\t},\n\t\t\tisTabWithActiveCall(): boolean\n\t\t\t{\n\t\t\t\treturn (\n\t\t\t\t\tthis.$store.getters['recent/calls/hasActiveCall']()\n\t\t\t\t\t&& Boolean(this.getCallManager().hasCurrentCall())\n\t\t\t\t);\n\t\t\t},\n\t\t\thasJoined(): boolean\n\t\t\t{\n\t\t\t\treturn this.activeCall.state === RecentCallStatus.joined;\n\t\t\t},\n\t\t},\n\tmethods:\n\t\t{\n\t\t\tasync onJoinClick()\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.call.onJoinFromRecentItem);\n\n\t\t\t\tif (this.isConference)\n\t\t\t\t{\n\t\t\t\t\tCallAnalytics.getInstance().onJoinConferenceClick({\n\t\t\t\t\t\tcallId: this.activeCall.call.id,\n\t\t\t\t\t});\n\n\t\t\t\t\tconst hasThisActiveConference = await ConferenceChannel.getInstance().sendRequest(this.dialog.public.code);\n\t\t\t\t\tif (hasThisActiveConference.some(call => call))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tMessenger.openConference({ code: this.dialog.public.code });\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst hasThisActiveCall = await this.getCallManager().sendBroadcastRequest(this.activeCall.call.uuid);\n\t\t\t\tif (hasThisActiveCall.some(call => call))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.getCallManager().joinCall(this.activeCall.call.id, this.activeCall.call.uuid, this.activeCall.dialogId);\n\t\t\t},\n\t\t\tonBackToCallClick() {\n\t\t\t\tif (this.isConference)\n\t\t\t\t{\n\t\t\t\t\tConferenceChannel.getInstance().sendRequest(this.dialog.public.code);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.getCallManager().sendBroadcastRequest(this.activeCall.call.uuid);\n\t\t\t},\n\t\t\tonLeaveCallClick()\n\t\t\t{\n\t\t\t\tthis.getCallManager().leaveCurrentCall();\n\t\t\t},\n\t\t\tonClick(event)\n\t\t\t{\n\t\t\t\tconst recentItem = this.$store.getters['recent/get'](this.activeCall.dialogId);\n\t\t\t\tif (!recentItem)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.$emit('click', { item: recentItem, $event: event });\n\t\t\t},\n\t\t\treturnToCall()\n\t\t\t{\n\t\t\t\tif (this.activeCall.state !== RecentCallStatus.joined)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.getCallManager().unfoldCurrentCall();\n\t\t\t},\n\t\t\tgetCallManager(): CallManager\n\t\t\t{\n\t\t\t\treturn CallManager.getInstance();\n\t\t\t},\n\t\t\tloc(phraseCode: string): string\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t\t},\n\t\t},\n\ttemplate: `\n\t\t<div :data-id=\"activeCall.dialogId\" class=\"bx-im-list-recent-item__wrap bx-im-list-recent-active-call-item__wrap\">\n\t\t\t<div @click=\"onClick\" class=\"bx-im-list-recent-item__container bx-im-list-recent-active-call__container\">\n\t\t\t\t<div class=\"bx-im-list-recent-item__avatar_container\">\n\t\t\t\t\t<ChatAvatar \n\t\t\t\t\t\t:avatarDialogId=\"activeCall.dialogId\" \n\t\t\t\t\t\t:contextDialogId=\"activeCall.dialogId\" \n\t\t\t\t\t\t:size=\"AvatarSize.XL\" \n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-list-recent-item__content_container\">\n\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__title_container\">\n\t\t\t\t\t\t<ChatTitle :text=\"preparedName\" />\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__title_icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"!hasJoined\" class=\"bx-im-list-recent-active-call__actions_container\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__actions_item --join\">\n\t\t\t\t\t\t\t<ChatButton @click.stop=\"onJoinClick\" :size=\"ButtonSize.M\" :color=\"ButtonColor.Success\" :isRounded=\"true\" :text=\"loc('CALL_LIST_RECENT_ACTIVE_CALL_JOIN')\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else-if=\"hasJoined && isTabWithActiveCall\" class=\"bx-im-list-recent-active-call__actions_container\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__actions_item --return\">\n\t\t\t\t\t\t\t<ChatButton @click.stop=\"returnToCall\" :size=\"ButtonSize.M\" :color=\"ButtonColor.Success\" :isRounded=\"true\" :text=\"loc('CALL_LIST_RECENT_ACTIVE_CALL_RETURN')\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else-if=\"hasJoined && !isTabWithActiveCall\" class=\"bx-im-list-recent-active-call__actions_container\">\n\t\t\t\t\t\t<div class=\"bx-im-list-recent-active-call__actions_item --another-device\">\n\t\t\t\t\t\t\t<ChatButton :size=\"ButtonSize.M\" @click.stop=\"onBackToCallClick\" :customColorScheme=\"anotherDeviceColorScheme\" :isRounded=\"true\" :text=\"loc('CALL_LIST_RECENT_ACTIVE_CALL_ANOTHER_DEVICE')\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};"],"names":["ActiveCall","name","components","ChatAvatar","ChatTitle","ChatButton","props","item","type","Object","required","emits","computed","AvatarSize","ButtonSize","ButtonColor","ButtonIcon","activeCall","dialog","$store","getters","dialogId","isConference","ChatType","videoconf","preparedName","Text","decode","anotherDeviceColorScheme","backgroundColor","borderColor","iconColor","textColor","hoverColor","isTabWithActiveCall","Boolean","getCallManager","hasCurrentCall","hasJoined","state","RecentCallStatus","joined","methods","onJoinClick","EventEmitter","emit","EventType","call","onJoinFromRecentItem","CallAnalytics","getInstance","onJoinConferenceClick","callId","id","hasThisActiveConference","ConferenceChannel","sendRequest","public","code","some","Messenger","openConference","hasThisActiveCall","sendBroadcastRequest","uuid","joinCall","onBackToCallClick","onLeaveCallClick","leaveCurrentCall","onClick","event","recentItem","$emit","$event","returnToCall","unfoldCurrentCall","CallManager","loc","phraseCode","$Bitrix","Loc","getMessage","template"],"mappings":"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"}