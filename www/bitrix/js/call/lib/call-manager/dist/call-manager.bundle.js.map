{"version":3,"file":"call-manager.bundle.js","sources":["../src/functions/open-call-user-selector.js","../src/call-manager.js"],"sourcesContent":["import { Tag, Loc, Runtime } from 'main.core';\nimport 'ui.buttons';\nimport type { Item } from 'ui.entity-selector';\nimport { Core } from 'im.v2.application.core';\n\nexport const openCallUserSelector = async (params) => {\n\tconst handleAddCLick = () => {\n\t\tconst selectedItems = dialog.getSelectedItems();\n\n\t\tconst preparedItems = prepareUser(selectedItems);\n\n\t\tparams.onSelect({ users: preparedItems });\n\t};\n\n\tconst handleCancelCLick = () => {\n\t\tdialog.hide();\n\t};\n\n\tconst { Dialog } = await Runtime.loadExtension('ui.entity-selector');\n\n\tconst dialog = new Dialog({\n\t\ttargetNode: params.bindElement,\n\t\twidth: 400,\n\t\tenableSearch: true,\n\t\tdropdownMode: true,\n\t\tcontext: 'IM_CHAT_SEARCH',\n\t\tentities: [{\n\t\t\tid: 'user',\n\t\t\tdynamicLoad: true,\n\t\t\titemOptions: {\n\t\t\t\tdefault: {\n\t\t\t\t\tlinkTitle: '',\n\t\t\t\t\tlink: '',\n\t\t\t\t},\n\t\t\t},\n\t\t\toptions: {\n\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t'!userId': Core.getUserId(),\n\t\t\t},\n\t\t\tfilters: [\n\t\t\t\t{\n\t\t\t\t\tid: 'im.userDataFilter',\n\t\t\t\t},\n\t\t\t],\n\t\t}],\n\t\tfooter: getFooter(handleAddCLick, handleCancelCLick),\n\t});\n\tdialog.show();\n\n\treturn Promise.resolve({\n\t\tclose: () => {\n\t\t\tdialog.hide();\n\t\t},\n\t});\n};\n\nconst prepareUser = (users) => {\n\treturn users.map((user: Item) => {\n\t\treturn {\n\t\t\tid: user.id,\n\t\t\tname: user.title.text,\n\t\t\tavatar: user.avatar,\n\t\t\tavatar_hr: user.avatar,\n\t\t\tgender: user.customData.get('imUser').GENDER,\n\t\t};\n\t});\n};\n\nconst getFooter = (handleAddCLick, handleCancelCLick) => {\n\tconst addButtonTitle = Loc.getMessage('CALL_LIB_CALL_ADD_BUTTON');\n\tconst cancelButtonTitle = Loc.getMessage('CALL_LIB_CALL_CANCEL_BUTTON');\n\n\treturn Tag.render`\n\t\t<button class=\"ui-btn ui-btn-xs ui-btn-primary\" onclick=\"${handleAddCLick}\">${addButtonTitle}</button>\n\t\t<button class=\"ui-btn ui-btn-xs ui-btn-light-border\" onclick=\"${handleCancelCLick}\">${cancelButtonTitle}</button>\n\t`;\n};","import { EventEmitter, BaseEvent } from 'main.core.events';\nimport { Controller, State as CallState, EngineLegacy, Engine as CallEngine } from 'call.core';\nimport { Messenger } from 'im.public';\nimport { ChatService } from 'im.v2.provider.service.chat';\nimport { Core } from 'im.v2.application.core';\nimport { MessengerSlider } from 'im.v2.lib.slider';\nimport { ChatType, RecentCallStatus, Layout, EventType, UserType } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { PromoManager } from 'im.v2.lib.promo';\nimport { SoundNotificationManager } from 'im.v2.lib.sound-notification';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { RestClient } from 'rest.client';\nimport { CallSliderManager } from 'call.lib.call-slider-manager';\n\nimport type { JsonObject } from 'main.core';\nimport type { Call, CallAssociatedEntity, ImModelChat, ImModelUser } from 'im.v2.model';\nimport type { OnLayoutChangeEvent } from 'im.v2.const';\n\nimport 'im_call_compatible';\n\nimport { openCallUserSelector } from './functions/open-call-user-selector';\n\nexport class CallManager\n{\n\tstatic instance: CallManager;\n\tstatic viewContainerClass: string = 'bx-im-messenger__call_container';\n\n\t#controller: Controller;\n\t#restClient: RestClient;\n\n\t#openChatActionByChatType = {\n\t\t[ChatType.taskComments]: (dialogId: string) => {\n\t\t\tif (Messenger.isEmbeddedMode() || Messenger.isMessengerSliderOpened())\n\t\t\t{\n\t\t\t\treturn Messenger.openTaskComments(dialogId);\n\t\t\t}\n\t\t\treturn Promise.resolve();\n\t\t},\n\t};\n\n\t#onCallJoinHandler: Function;\n\t#onCallLeaveHandler: Function;\n\t#onCallDestroyHandler: Function;\n\n\tstatic getInstance(): CallManager\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tconstructor()\n\t{\n\t\tthis.#restClient = Core.getRestClient();\n\n\t\tthis.#controller = this.#getController();\n\n\t\tthis.#subscribeToEvents();\n\n\t\tthis.#onCallJoinHandler = this.#onCallJoin.bind(this);\n\t\tthis.#onCallLeaveHandler = this.#onCallLeave.bind(this);\n\t\tthis.#onCallDestroyHandler = this.#onCallDestroy.bind(this);\n\t}\n\n\tasync sendBroadcastRequest(callId): Promise<boolean[]> {\n\t\tif (!DesktopApi.isDesktop())\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\treturn await this.#controller.callMultiBroadcastClient.broadcastRequest(callId, { timeout: 100 });\n\t}\n\tstartCall(dialogId: string, withVideo: boolean = true, callToken: string = '')\n\t{\n\t\tLogger.warn('CallManager: startCall', dialogId, withVideo);\n\n\t\tCallSliderManager.getInstance().setTopSliderId();\n\t\tthis.#prepareCall(dialogId);\n\t\tthis.#getChatInfo(dialogId).then((chatInfo) => {\n\t\t\tthis.#controller.startCall(dialogId, withVideo, chatInfo);\n\t\t});\n\t}\n\n\tjoinCall(callId: string, callUuid: string, dialogId: string, withVideo: boolean = true)\n\t{\n\t\tLogger.warn('CallManager: joinCall', callId, callUuid, withVideo);\n\n\t\tCallSliderManager.getInstance().setTopSliderId();\n\t\tthis.#prepareCall(dialogId);\n\t\tthis.#getChatInfo(dialogId).then((chatInfo) => {\n\t\t\tthis.#controller.joinCall(callId, callUuid, withVideo, { chatInfo });\n\t\t});\n\t}\n\n\tleaveCurrentCall()\n\t{\n\t\tLogger.warn('CallManager: leaveCurrentCall');\n\t\tthis.#controller.leaveCurrentCall();\n\t\tCallSliderManager.getInstance().clearSliderId();\n\t}\n\n\tonAnswerButtonClick(mediaParams: JsonObject, callParams: JsonObject)\n\t{\n\t\tthis.#controller.onAnswerButtonClick(mediaParams, callParams);\n\t}\n\n\tonJoinFromRecentItem()\n\t{\n\t\tthis.#controller.closeCallNotification();\n\t}\n\n\tdeleteRecentCall(dialogId: string)\n\t{\n\t\tCore.getStore().dispatch('recent/calls/deleteActiveCall', {\n\t\t\tdialogId,\n\t\t});\n\t}\n\n\tfoldCurrentCall()\n\t{\n\t\tif (!this.#controller.hasActiveCall() || !this.#controller.hasVisibleCall())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#controller.fold();\n\t}\n\n\tunfoldCurrentCall()\n\t{\n\t\tif (!this.#controller.hasActiveCall())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#controller.unfold();\n\t}\n\n\tgetCurrentCallDialogId(): string\n\t{\n\t\tif (!this.#controller.hasActiveCall())\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn this.#controller?.currentCall?.associatedEntity.id;\n\t}\n\n\tgetCurrentCall(): boolean\n\t{\n\t\tif (!this.#controller.hasActiveCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.#controller.currentCall;\n\t}\n\n\tgetCurrentUser(): ImModelUser\n\t{\n\t\tconst currentUserId = Core.getUserId();\n\t\treturn Core.getStore().getters['users/get'](currentUserId);\n\t}\n\n\thasCurrentCall(): boolean\n\t{\n\t\treturn this.#controller.hasActiveCall();\n\t}\n\n\thasCurrentScreenSharing(): boolean\n\t{\n\t\tif (!this.#controller.hasActiveCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.#controller.currentCall.isScreenSharingStarted();\n\t}\n\n\thasVisibleCall(): boolean\n\t{\n\t\tif (!this.#controller.hasActiveCall())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.#controller.hasVisibleCall();\n\t}\n\n\tstartTest()\n\t{\n\t\tthis.#controller.test();\n\t}\n\n\ttoggleDebugFlag(debug)\n\t{\n\t\tif (!this.#controller)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#controller.debug = debug;\n\t}\n\n\tchatCanBeCalled(dialogId: string): boolean\n\t{\n\t\tconst callSupported = this.#checkCallSupport(dialogId);\n\t\tconst hasCurrentCall = Core.getStore().getters['recent/calls/hasActiveCall'](dialogId);\n\n\t\treturn callSupported && !hasCurrentCall;\n\t}\n\n\thasActiveCurrentCall(dialogId: string): boolean\n\t{\n\t\treturn Core.getStore().getters['recent/calls/hasActiveCall'](dialogId)\n\t\t\t&& this.getCurrentCallDialogId() === dialogId;\n\t}\n\n\thasActiveAnotherCall(dialogId: string): boolean\n\t{\n\t\treturn Core.getStore().getters['recent/calls/hasActiveCall']()\n\t\t\t&& !this.hasActiveCurrentCall(dialogId);\n\t}\n\n\tgetCallUserLimit(): number\n\t{\n\t\treturn BX.Call.Util.getUserLimit();\n\t}\n\n\tisChatUserLimitExceeded(dialogId: string): boolean\n\t{\n\t\treturn this.#getChatUserCounter(dialogId) > this.getCallUserLimit();\n\t}\n\n\tupdateRecentCallsList(activeCalls): void\n\t{\n\t\tconst recentCalls = Core.getStore().getters['recent/calls/get'];\n\n\t\tconst activeCallsMap = new Map(Object.values(activeCalls).map((call) => [call.ID, call]));\n\n\t\tactiveCallsMap.forEach((call) => {\n\t\t\tconst instantiatedCall = this.#controller.isLegacyCall(call.PROVIDER, call.SCHEME)\n\t\t\t\t? EngineLegacy.instantiateCall(call, call.USERS, call.LOG_TOKEN, call.CONNECTION_DATA, call.USER_DATA)\n\t\t\t\t: CallEngine.instantiateCall(call, call.CALL_TOKEN, call.LOG_TOKEN, call.USER_DATA);\n\t\t\tthis.#subscribeToCallEvents(instantiatedCall);\n\t\t});\n\n\t\trecentCalls\n\t\t\t.filter((oldCall) => !activeCallsMap.has(oldCall.call.id))\n\t\t\t.forEach((oldCall) => {\n\t\t\t\tCore.getStore().dispatch('recent/calls/deleteActiveCall', {\n\t\t\t\t\tdialogId: oldCall.dialogId,\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\t#getController(): Controller\n\t{\n\t\treturn new Controller({\n\t\t\tinit: true,\n\t\t\tlanguage: Core.getLanguageId(),\n\t\t\tmessengerFacade: {\n\t\t\t\tgetDefaultZIndex: () => MessengerSlider.getInstance().getZIndex(),\n\t\t\t\tisMessengerOpen: () => MessengerSlider.getInstance().isOpened(),\n\t\t\t\tisSliderFocused: () => MessengerSlider.getInstance().isFocused(),\n\t\t\t\tisThemeDark: () => false,\n\t\t\t\topenMessenger: (dialogId: string, force: boolean = false) => {\n\t\t\t\t\tconst dialog: ImModelChat = this.#getDialog(dialogId);\n\t\t\t\t\tif (!force && dialog && dialog.type in this.#openChatActionByChatType)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.#openChatActionByChatType[dialog.type](dialogId);\n\t\t\t\t\t}\n\t\t\t\t\treturn Messenger.openChat(dialogId);\n\t\t\t\t},\n\t\t\t\topenHistory: (dialogId) => {\n\t\t\t\t\treturn Messenger.openChat(dialogId);\n\t\t\t\t},\n\t\t\t\topenSettings: () => {\n\t\t\t\t\treturn Messenger.openSettings();\n\t\t\t\t},\n\t\t\t\topenHelpArticle: () => {}, // TODO\n\t\t\t\tgetMessageCount: () => Core.getStore().getters['counters/getTotalChatCounter'],\n\t\t\t\tgetCurrentDialogId: () => this.#getCurrentDialogId(),\n\t\t\t\tisPromoRequired: (promoCode: string) => {\n\t\t\t\t\treturn PromoManager.getInstance().needToShow(promoCode);\n\t\t\t\t},\n\t\t\t\trepeatSound: (soundType, timeout, force) => {\n\t\t\t\t\tSoundNotificationManager.getInstance().playLoop(soundType, timeout, force);\n\t\t\t\t},\n\t\t\t\tstopRepeatSound: (soundType) => {\n\t\t\t\t\tSoundNotificationManager.getInstance().stop(soundType);\n\t\t\t\t},\n\t\t\t\tshowUserSelector: openCallUserSelector,\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\t[Controller.Events.onPromoViewed]: (event) => {\n\t\t\t\t\tconst { code } = event.getData();\n\t\t\t\t\tPromoManager.getInstance().markAsWatched(code);\n\t\t\t\t},\n\t\t\t\t[Controller.Events.onOpenVideoConference]: (event) => {\n\t\t\t\t\tconst { dialogId: chatId } = event.getData();\n\t\t\t\t\tconst dialog: ImModelChat = Core.getStore().getters['chats/get'](`chat${chatId}`, true);\n\n\t\t\t\t\treturn Messenger.openConference({ code: dialog.public?.code });\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#getChatService(): ChatService\n\t{\n\t\tif (!this.chatService)\n\t\t{\n\t\t\tthis.chatService = new ChatService();\n\t\t}\n\n\t\treturn this.chatService;\n\t}\n\n\t// region call events\n\t#subscribeToEvents()\n\t{\n\t\tEventEmitter.subscribe(EventType.layout.onLayoutChange, this.#onOpenChat.bind(this));\n\t\tEventEmitter.subscribe(EventType.layout.onOpenNotifications, this.foldCurrentCall.bind(this));\n\t\tEventEmitter.subscribe(EventType.call.onJoinFromRecentItem, this.onJoinFromRecentItem.bind(this));\n\n\t\tEventEmitter.subscribe('CallEvents::callCreated', this.#onCallCreated.bind(this));\n\t}\n\n\t#subscribeToCallEvents(call: Call)\n\t{\n\t\tcall.addEventListener(BX.Call.Event.onJoin, this.#onCallJoinHandler);\n\t\tcall.addEventListener(BX.Call.Event.onLeave, this.#onCallLeaveHandler);\n\t\tcall.addEventListener(BX.Call.Event.onDestroy, this.#onCallDestroyHandler);\n\t}\n\n\t#unsubscribeFromCallEvents(call: Call)\n\t{\n\t\tcall.removeEventListener(BX.Call.Event.onJoin, this.#onCallJoinHandler);\n\t\tcall.removeEventListener(BX.Call.Event.onLeave, this.#onCallLeaveHandler);\n\t\tcall.removeEventListener(BX.Call.Event.onDestroy, this.#onCallDestroyHandler);\n\t}\n\n\t#onCallCreated(event)\n\t{\n\t\tconst { call } = event.getData()[0];\n\t\tconst currentCall = Core.getStore().getters['recent/calls/getCallByDialog'](call.associatedEntity.id);\n\t\tconst isNewCall = currentCall?.call.uuid !== call.uuid;\n\n\t\tconst state = (\n\t\t\tcall.state === CallState.Connected || call.state === CallState.Proceeding\n\t\t\t\t? RecentCallStatus.joined\n\t\t\t\t: RecentCallStatus.waiting\n\t\t);\n\n\t\tif (isNewCall)\n\t\t{\n\t\t\tif (currentCall)\n\t\t\t{\n\t\t\t\tthis.#unsubscribeFromCallEvents(currentCall.call);\n\t\t\t}\n\n\t\t\tthis.#subscribeToCallEvents(call);\n\t\t\tCore.getStore().dispatch('recent/calls/addActiveCall', {\n\t\t\t\tdialogId: call.associatedEntity.id,\n\t\t\t\tname: call.associatedEntity.name,\n\t\t\t\tcall,\n\t\t\t\tstate,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tCore.getStore().dispatch('recent/calls/updateActiveCall', {\n\t\t\tdialogId: call.associatedEntity.id,\n\t\t\tfields: {\n\t\t\t\tname: call.associatedEntity.name,\n\t\t\t\tstate,\n\t\t\t\tcall,\n\t\t\t},\n\t\t});\n\t}\n\n\t#onCallJoin(event)\n\t{\n\t\tCore.getStore().dispatch('recent/calls/updateActiveCall', {\n\t\t\tdialogId: event.call.associatedEntity.id,\n\t\t\tfields: {\n\t\t\t\tstate: RecentCallStatus.joined,\n\t\t\t},\n\t\t});\n\t}\n\n\t#onCallLeave(event)\n\t{\n\t\tCore.getStore().dispatch('recent/calls/updateActiveCall', {\n\t\t\tdialogId: event.call.associatedEntity.id,\n\t\t\tfields: {\n\t\t\t\tstate: RecentCallStatus.waiting,\n\t\t\t},\n\t\t});\n\t}\n\n\t#onCallDestroy(event)\n\t{\n\t\tconst dialogId = event.call.associatedEntity.id;\n\t\tconst currentCall = Core.getStore().getters['recent/calls/getCallByDialog'](dialogId);\n\n\t\tif (currentCall)\n\t\t{\n\t\t\tthis.#unsubscribeFromCallEvents(currentCall.call);\n\t\t}\n\n\t\tif (currentCall?.call.uuid === event.call.uuid)\n\t\t{\n\t\t\tCore.getStore().dispatch('recent/calls/deleteActiveCall', {\n\t\t\t\tdialogId,\n\t\t\t});\n\t\t}\n\t}\n\n\t#onOpenChat(event: BaseEvent<OnLayoutChangeEvent>)\n\t{\n\t\tconst callDialogId = this.getCurrentCallDialogId();\n\t\tconst openedChat = event.getData().to.entityId;\n\t\tif (callDialogId === openedChat)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.foldCurrentCall();\n\t}\n\n\tisConference(dialogId: string): boolean\n\t{\n\t\tconst dialog: ImModelChat = Core.getStore().getters['chats/get'](dialogId);\n\n\t\treturn dialog.type === ChatType.videoconf;\n\t}\n\n\t#checkCallSupport(dialogId: string): boolean\n\t{\n\t\tif (!this.#pushServerIsActive() || !BX.Call.Util.isWebRTCSupported())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst userId = Number(dialogId);\n\n\t\treturn userId > 0 ? this.#checkUserCallSupport(userId) : this.#checkChatCallSupport(dialogId);\n\t}\n\n\t#checkUserCallSupport(userId: number): boolean\n\t{\n\t\tconst user = Core.getStore().getters['users/get'](userId);\n\t\tconst isBot = user.type === UserType.bot;\n\n\t\treturn (\n\t\t\tuser\n\t\t\t&& user.status !== 'guest'\n\t\t\t&& !isBot\n\t\t\t&& !user.network\n\t\t\t&& user.id !== Core.getUserId()\n\t\t\t&& Boolean(user.lastActivityDate)\n\t\t);\n\t}\n\n\t#checkChatCallSupport(dialogId: string): boolean\n\t{\n\t\tconst userCounter = this.#getChatUserCounter(dialogId);\n\n\t\treturn (userCounter > 1 || this.isConference(dialogId)) && userCounter <= this.getCallUserLimit();\n\t}\n\n\t#pushServerIsActive(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t#getCurrentDialogId(): string\n\t{\n\t\tconst layout = Core.getStore().getters['application/getLayout'];\n\t\tif (layout.name !== Layout.chat && layout.name !== Layout.taskComments)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn layout.entityId;\n\t}\n\n\t#getDialog(dialogId: string): ImModelChat\n\t{\n\t\treturn Core.getStore().getters['chats/get'](dialogId);\n\t}\n\n\t#getChatId(dialogId: string): ?number\n\t{\n\t\treturn this.#getDialog(dialogId)?.chatId;\n\t}\n\n\t#isUser(dialogId: string): boolean\n\t{\n\t\tconst dialog: ImModelChat = this.#getDialog(dialogId);\n\n\t\treturn dialog?.type === ChatType.user;\n\t}\n\n\t#getChatInfo(dialogId: string): Promise<CallAssociatedEntity>\n\t{\n\t\tconst chatInfo = Core.getStore().getters['chats/get'](dialogId, true);\n\n\t\tif (chatInfo.chatId === 0)\n\t\t{\n\t\t\treturn this.#getChatService().loadChat(dialogId).then(() => {\n\t\t\t\tconst updatedChatInfo = Core.getStore().getters['chats/get'](dialogId, true);\n\n\t\t\t\treturn this.#prepareChatInfo(updatedChatInfo);\n\t\t\t}).catch((error) => {\n\t\t\t\tLogger.error('Open chat error', error);\n\n\t\t\t\treturn this.#prepareChatInfo(chatInfo);\n\t\t\t});\n\t\t}\n\n\t\treturn new Promise((resolve) => {\n\t\t\tresolve(this.#prepareChatInfo(chatInfo));\n\t\t});\n\t}\n\n\t#prepareChatInfo(chatInfo: CallAssociatedEntity): CallAssociatedEntity\n\t{\n\t\treturn {\n\t\t\tadvanced: {\n\t\t\t\tchatType: chatInfo.type,\n\t\t\t\tentityType: chatInfo.entityType,\n\t\t\t\tentityId: chatInfo.entityId,\n\t\t\t\tentityData1: chatInfo.entityData1,\n\t\t\t\tentityData2: chatInfo.entityData2,\n\t\t\t\tentityData3: chatInfo.entityData3,\n\t\t\t},\n\t\t\tid: chatInfo.dialogId,\n\t\t\tchatId: chatInfo.chatId,\n\t\t\tname: chatInfo.name,\n\t\t\tavatar: chatInfo.avatar || '/bitrix/js/im/images/blank.gif',\n\t\t\tavatarColor: chatInfo.color,\n\t\t\ttype: 'chat',\n\t\t\tuserCounter: chatInfo.userCounter,\n\t\t};\n\t}\n\n\t#prepareCall(dialogId: string)\n\t{\n\t\tconst currentUserId = Core.getUserId();\n\t\tconst currentUser: ImModelUser = Core.getStore().getters['users/get'](currentUserId);\n\n\t\tconst callData = {\n\t\t\tdialogId,\n\t\t\tuserData: {\n\t\t\t\t[currentUserId]: currentUser,\n\t\t\t},\n\t\t};\n\n\t\tif (this.#isUser(dialogId))\n\t\t{\n\t\t\tconst currentCompanion: ImModelUser = Core.getStore().getters['users/get'](dialogId);\n\t\t\tcallData['user'] = currentCompanion.id;\n\t\t\tcallData['userData'][currentCompanion.id] = currentCompanion;\n\t\t}\n\n\t\tthis.#controller.prepareCall(callData);\n\t}\n\n\t#getChatUserCounter(dialogId: string): number\n\t{\n\t\tconst { userCounter } = Core.getStore().getters['chats/get'](dialogId, true);\n\n\t\treturn userCounter;\n\t}\n\t// endregion call events\n}\n"],"names":["openCallUserSelector","params","handleAddCLick","selectedItems","dialog","getSelectedItems","preparedItems","prepareUser","onSelect","users","handleCancelCLick","hide","Dialog","Runtime","loadExtension","targetNode","bindElement","width","enableSearch","dropdownMode","context","entities","id","dynamicLoad","itemOptions","default","linkTitle","link","options","inviteEmployeeLink","Core","getUserId","filters","footer","getFooter","show","Promise","resolve","close","map","user","name","title","text","avatar","avatar_hr","gender","customData","get","GENDER","addButtonTitle","Loc","getMessage","cancelButtonTitle","Tag","render","CallManager","getInstance","instance","constructor","ChatType","taskComments","dialogId","Messenger","isEmbeddedMode","isMessengerSliderOpened","openTaskComments","getRestClient","bind","sendBroadcastRequest","callId","DesktopApi","isDesktop","callMultiBroadcastClient","broadcastRequest","timeout","startCall","withVideo","callToken","Logger","warn","CallSliderManager","setTopSliderId","then","chatInfo","joinCall","callUuid","leaveCurrentCall","clearSliderId","onAnswerButtonClick","mediaParams","callParams","onJoinFromRecentItem","closeCallNotification","deleteRecentCall","getStore","dispatch","foldCurrentCall","hasActiveCall","hasVisibleCall","fold","unfoldCurrentCall","unfold","getCurrentCallDialogId","currentCall","associatedEntity","getCurrentCall","getCurrentUser","currentUserId","getters","hasCurrentCall","hasCurrentScreenSharing","isScreenSharingStarted","startTest","test","toggleDebugFlag","debug","chatCanBeCalled","callSupported","hasActiveCurrentCall","hasActiveAnotherCall","getCallUserLimit","BX","Call","Util","getUserLimit","isChatUserLimitExceeded","updateRecentCallsList","activeCalls","recentCalls","activeCallsMap","Map","Object","values","call","ID","forEach","instantiatedCall","isLegacyCall","PROVIDER","SCHEME","EngineLegacy","instantiateCall","USERS","LOG_TOKEN","CONNECTION_DATA","USER_DATA","CallEngine","CALL_TOKEN","filter","oldCall","has","isConference","type","videoconf","Controller","init","language","getLanguageId","messengerFacade","getDefaultZIndex","MessengerSlider","getZIndex","isMessengerOpen","isOpened","isSliderFocused","isFocused","isThemeDark","openMessenger","force","openChat","openHistory","openSettings","openHelpArticle","getMessageCount","getCurrentDialogId","isPromoRequired","promoCode","PromoManager","needToShow","repeatSound","soundType","SoundNotificationManager","playLoop","stopRepeatSound","stop","showUserSelector","events","Events","onPromoViewed","event","code","getData","markAsWatched","onOpenVideoConference","chatId","openConference","public","chatService","ChatService","EventEmitter","subscribe","EventType","layout","onLayoutChange","onOpenNotifications","addEventListener","Event","onJoin","onLeave","onDestroy","removeEventListener","isNewCall","uuid","state","CallState","Connected","Proceeding","RecentCallStatus","joined","waiting","fields","callDialogId","openedChat","to","entityId","isWebRTCSupported","userId","Number","isBot","UserType","bot","status","network","Boolean","lastActivityDate","userCounter","Layout","chat","loadChat","updatedChatInfo","catch","error","advanced","chatType","entityType","entityData1","entityData2","entityData3","avatarColor","color","currentUser","callData","userData","currentCompanion","prepareCall","viewContainerClass"],"mappings":"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"}