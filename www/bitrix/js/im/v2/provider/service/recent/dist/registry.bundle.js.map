{"version":3,"file":"registry.bundle.js","sources":["../src/legacy/classes/recent-data-extractor.js","../src/legacy/legacy-recent.js","../src/base/base-recent.js","../src/legacy/classes/unread-recent.js"],"sourcesContent":["import { Type } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { ChatType, UserRole, MessageStatus, FakeMessagePrefix } from 'im.v2.const';\n\nimport type { ImModelMessage } from 'im.v2.model';\nimport type {\n\tRawUser,\n\tRawChat,\n\tRawLegacyRecentItem,\n\tRawMessage,\n\tRawCopilot,\n\tRawMessagesAutoDeleteConfig,\n} from 'im.v2.provider.service.types';\nimport type { RecentRestResult } from '../types/recent';\n\ntype RecentFile = {\n\tid: number,\n\tname: string,\n\ttype: string,\n};\n\ntype ExtractionResult = {\n\tusers: RawUser[],\n\tchats: RawChat[],\n\tmessages: RawMessage[],\n\tfiles: RecentFile[],\n\trecentItems: RawLegacyRecentItem[],\n\tcopilot?: RawCopilot,\n\tmessagesAutoDeleteConfigs: RawMessagesAutoDeleteConfig[],\n\tstickerMessages: RawLegacyRecentItem[],\n};\n\nexport class RecentDataExtractor\n{\n\t#restResult: RecentRestResult;\n\t#withBirthdays: boolean;\n\n\t#users: { [id: string]: RawUser } = {};\n\t#chats: { [id: string]: RawChat } = {};\n\t#messages: { [id: string]: RawMessage } = {};\n\t#files: { [id: string]: RecentFile } = {};\n\t#recentItems: { [id: string]: RawLegacyRecentItem } = {};\n\t#stickerMessages: { [id: string]: RawLegacyRecentItem } = {};\n\n\tconstructor(params: { rawData: RecentRestResult, withBirthdays?: boolean })\n\t{\n\t\tconst { rawData, withBirthdays = true } = params;\n\t\tthis.#withBirthdays = withBirthdays;\n\t\tthis.#restResult = rawData;\n\t}\n\n\tgetItems(): ExtractionResult\n\t{\n\t\tconst { items = [], copilot, messagesAutoDeleteConfigs } = this.#restResult;\n\t\titems.forEach((item: RawLegacyRecentItem) => {\n\t\t\tthis.#extractUser(item);\n\t\t\tthis.#extractChat(item);\n\t\t\tthis.#extractMessage(item);\n\t\t\tthis.#extractRecentItem(item);\n\t\t\tthis.#extractStickerMessage(item);\n\t\t});\n\n\t\tthis.#extractBirthdayItems();\n\n\t\treturn {\n\t\t\tusers: Object.values(this.#users),\n\t\t\tchats: Object.values(this.#chats),\n\t\t\tmessages: Object.values(this.#messages),\n\t\t\tfiles: Object.values(this.#files),\n\t\t\trecentItems: Object.values(this.#recentItems),\n\t\t\tcopilot,\n\t\t\tmessagesAutoDeleteConfigs,\n\t\t\tstickerMessages: Object.values(this.#stickerMessages),\n\t\t};\n\t}\n\n\t#extractUser(item: RawLegacyRecentItem)\n\t{\n\t\tif (item.user?.id && !this.#users[item.user.id])\n\t\t{\n\t\t\tthis.#users[item.user.id] = item.user;\n\t\t}\n\t}\n\n\t#extractChat(item: RawLegacyRecentItem)\n\t{\n\t\tif (item.type === ChatType.chat)\n\t\t{\n\t\t\tthis.#chats[item.id] = this.#prepareGroupChat(item);\n\n\t\t\tif (item.user.id && !this.#chats[item.user.id])\n\t\t\t{\n\t\t\t\tthis.#chats[item.user.id] = this.#prepareChatForAdditionalUser(item.user);\n\t\t\t}\n\t\t}\n\t\telse if (item.type === ChatType.user)\n\t\t{\n\t\t\tconst existingRecentItem = Core.getStore().getters['recent/get'](item.user.id);\n\t\t\t// we should not update real chat with \"default\" chat data\n\t\t\tif (!existingRecentItem || !item.options.default_user_record)\n\t\t\t{\n\t\t\t\tthis.#chats[item.user.id] = this.#prepareChatForUser(item);\n\t\t\t}\n\t\t}\n\t}\n\n\t#extractMessage(item: RawLegacyRecentItem): void\n\t{\n\t\tconst message = item.message;\n\t\tif (!message)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (message.id === 0)\n\t\t{\n\t\t\tmessage.id = `${FakeMessagePrefix}-${item.id}`;\n\t\t}\n\n\t\tlet viewedByOthers = false;\n\t\tif (message.status === MessageStatus.delivered)\n\t\t{\n\t\t\tviewedByOthers = true;\n\t\t}\n\n\t\tconst existingMessage: ImModelMessage = Core.getStore().getters['messages/getById'](message.id);\n\t\t// recent has shortened attach format, we should not rewrite attach if model has it\n\t\tif (Type.isArrayFilled(existingMessage?.attach))\n\t\t{\n\t\t\tdelete message.attach;\n\t\t}\n\n\t\tif (Type.isPlainObject(message.file))\n\t\t{\n\t\t\tconst file: RecentFile = message.file;\n\t\t\tif (existingMessage)\n\t\t\t{\n\t\t\t\t// recent doesn't know about several files in one message,\n\t\t\t\t// we should not rewrite message files, so we merge it.\n\t\t\t\tmessage.files = this.#mergeFileIds(existingMessage, file.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tmessage.files = [file.id];\n\t\t\t}\n\n\t\t\tconst existingFile = Core.getStore().getters['files/get'](file.id);\n\t\t\t// recent has shortened file format, we should not rewrite file if model has it\n\t\t\tif (!existingFile)\n\t\t\t{\n\t\t\t\tthis.#files[file.id] = file;\n\t\t\t}\n\t\t}\n\n\t\tthis.#messages[message.id] = { ...message, viewedByOthers };\n\t}\n\n\t#extractRecentItem(item: RawLegacyRecentItem): void\n\t{\n\t\tconst messageId = item.message?.id ?? 0;\n\t\tthis.#recentItems[item.id] = { ...item, messageId };\n\t}\n\n\t#extractBirthdayItems()\n\t{\n\t\tif (!this.#withBirthdays)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { birthdayList = [] } = this.#restResult;\n\t\tbirthdayList.forEach((item) => {\n\t\t\tif (Core.getUserId() === item.id)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.#users[item.id])\n\t\t\t{\n\t\t\t\tthis.#users[item.id] = item;\n\t\t\t}\n\n\t\t\tif (!this.#chats[item.id])\n\t\t\t{\n\t\t\t\tthis.#chats[item.id] = this.#prepareChatForAdditionalUser(item);\n\t\t\t}\n\n\t\t\tif (!this.#recentItems[item.id])\n\t\t\t{\n\t\t\t\tconst messageId = `${FakeMessagePrefix}-${item.id}`;\n\t\t\t\tthis.#recentItems[item.id] = { ...this.#getBirthdayPlaceholder(item), messageId };\n\t\t\t\tthis.#messages[messageId] = { id: messageId };\n\t\t\t}\n\t\t});\n\t}\n\n\t#extractStickerMessage(item: RawLegacyRecentItem)\n\t{\n\t\tconst messageId = item.message?.id;\n\t\tif (!messageId || !item.message.sticker)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#stickerMessages[messageId] = { ...item.message.sticker, messageId };\n\t}\n\n\t#prepareGroupChat(item: RawLegacyRecentItem): RawChat\n\t{\n\t\treturn {\n\t\t\t...item.chat,\n\t\t\tcounter: item.counter,\n\t\t\tdialogId: item.id,\n\t\t};\n\t}\n\n\t#prepareChatForUser(item: RawLegacyRecentItem): RawChat\n\t{\n\t\treturn {\n\t\t\tchatId: item.chat_id,\n\t\t\tavatar: item.user.avatar,\n\t\t\tcolor: item.user.color,\n\t\t\tdialogId: item.id,\n\t\t\tname: item.user.name,\n\t\t\ttype: ChatType.user,\n\t\t\tcounter: item.counter,\n\t\t\trole: UserRole.member,\n\t\t\tbackgroundId: item.chat.background_id,\n\t\t\ttextFieldEnabled: item.chat.text_field_enabled,\n\t\t\tmuteList: item.chat.mute_list,\n\t\t};\n\t}\n\n\t#prepareChatForAdditionalUser(user: RawUser): RawChat\n\t{\n\t\treturn {\n\t\t\tdialogId: user.id,\n\t\t\tavatar: user.avatar,\n\t\t\tcolor: user.color,\n\t\t\tname: user.name,\n\t\t\ttype: ChatType.user,\n\t\t\trole: UserRole.member,\n\t\t};\n\t}\n\n\t#getBirthdayPlaceholder(item: RawLegacyRecentItem): { id: string, isBirthdayPlaceholder: true }\n\t{\n\t\treturn {\n\t\t\tid: item.id,\n\t\t\tisBirthdayPlaceholder: true,\n\t\t};\n\t}\n\n\t#mergeFileIds(existingMessage: ImModelMessage, fileId: number): number[]\n\t{\n\t\tconst existingMessageFilesIds = existingMessage.files.map((id) => {\n\t\t\treturn Number.parseInt(id, 10);\n\t\t});\n\t\tconst setOfFileIds = new Set([...existingMessageFilesIds, fileId]);\n\n\t\treturn [...setOfFileIds];\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { Logger } from 'im.v2.lib.logger';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { LayoutManager } from 'im.v2.lib.layout';\n\nimport { RecentDataExtractor } from './classes/recent-data-extractor';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem } from 'im.v2.model';\n\nexport class LegacyRecentService\n{\n\tstatic instance = null;\n\n\tdataIsPreloaded: boolean = false;\n\tfirstPageIsLoaded: boolean = false;\n\titemsPerPage: number = 50;\n\tisLoading: boolean = false;\n\tpagesLoaded: number = 0;\n\thasMoreItemsToLoad: boolean = true;\n\tlastMessageDate: string = null;\n\n\tstatic getInstance(): LegacyRecentService\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\t// region public\n\tgetCollection(): ImModelRecentItem[]\n\t{\n\t\treturn Core.getStore().getters['recent/getRecentCollection'];\n\t}\n\n\tasync loadFirstPage({ ignorePreloadedItems = false } = {}): Promise\n\t{\n\t\tif (this.dataIsPreloaded && !ignorePreloadedItems)\n\t\t{\n\t\t\tLogger.warn('Im.RecentList: first page was preloaded');\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\t\tthis.isLoading = true;\n\n\t\tconst result = await this.requestItems({ firstPage: true });\n\t\tthis.firstPageIsLoaded = true;\n\n\t\treturn result;\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tif (this.isLoading || !this.hasMoreItemsToLoad)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.isLoading = true;\n\n\t\treturn this.requestItems();\n\t}\n\n\tsetPreloadedData(params)\n\t{\n\t\tLogger.warn('Im.RecentList: setting preloaded data', params);\n\t\tconst { items, hasMore } = params;\n\n\t\tthis.lastMessageDate = this.getLastMessageDate(items);\n\n\t\tif (!hasMore)\n\t\t{\n\t\t\tthis.hasMoreItemsToLoad = false;\n\t\t}\n\n\t\tthis.dataIsPreloaded = true;\n\n\t\tvoid this.updateModels(params);\n\t}\n\n\thideChat(dialogId: string): void\n\t{\n\t\tLogger.warn('Im.RecentList: hide chat', dialogId);\n\t\tconst recentItem = Core.getStore().getters['recent/get'](dialogId);\n\t\tif (!recentItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tvoid Core.getStore().dispatch('recent/hide', { id: dialogId });\n\n\t\tconst chatIsOpened = Core.getStore().getters['application/isChatOpen'](dialogId);\n\t\tif (chatIsOpened)\n\t\t{\n\t\t\tLayoutManager.getInstance().clearCurrentLayoutEntityId();\n\t\t\tvoid LayoutManager.getInstance().deleteLastOpenedElementById(dialogId);\n\t\t}\n\n\t\tCore.getRestClient().callMethod(RestMethod.imRecentHide, { DIALOG_ID: dialogId })\n\t\t\t.catch((result: RestResult) => {\n\t\t\t\tconsole.error('Im.RecentList: hide chat error', result.error());\n\t\t\t});\n\t}\n\t// endregion public\n\n\tasync requestItems({ firstPage = false } = {}): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams(firstPage);\n\n\t\tconst result: RestResult = await Core.getRestClient().callMethod(RestMethod.imRecentList, queryParams)\n\t\t\t.catch((errorResult: RestResult) => {\n\t\t\t\tconsole.error('Im.RecentList: page request error', errorResult.error());\n\t\t\t});\n\n\t\tthis.pagesLoaded++;\n\t\tLogger.warn(`Im.RecentList: ${firstPage ? 'First' : this.pagesLoaded} page request result`, result.data());\n\t\tconst { items, hasMore } = result.data();\n\t\tthis.lastMessageDate = this.getLastMessageDate(items);\n\t\tif (!hasMore)\n\t\t{\n\t\t\tthis.hasMoreItemsToLoad = false;\n\t\t}\n\n\t\tthis.isLoading = false;\n\n\t\treturn this.updateModels(result.data());\n\t}\n\n\tgetQueryParams(firstPage: boolean): JsonObject\n\t{\n\t\treturn {\n\t\t\tSKIP_OPENLINES: 'Y',\n\t\t\tLIMIT: this.itemsPerPage,\n\t\t\tLAST_MESSAGE_DATE: firstPage ? null : this.lastMessageDate,\n\t\t\tGET_ORIGINAL_TEXT: 'Y',\n\t\t\tPARSE_TEXT: 'Y',\n\t\t};\n\t}\n\n\tgetModelSaveMethod(): string\n\t{\n\t\treturn 'recent/setRecent';\n\t}\n\n\tupdateModels(rawData): Promise\n\t{\n\t\tconst extractor = new RecentDataExtractor({ rawData, ...this.getExtractorOptions() });\n\t\tconst extractedItems = extractor.getItems();\n\t\tconst {\n\t\t\tusers,\n\t\t\tchats,\n\t\t\tmessages,\n\t\t\tfiles,\n\t\t\trecentItems,\n\t\t\tcopilot,\n\t\t\tmessagesAutoDeleteConfigs,\n\t\t\tstickerMessages,\n\t\t} = extractedItems;\n\t\tLogger.warn('LegacyRecentService: prepared data for models', extractedItems);\n\n\t\tconst usersPromise = Core.getStore().dispatch('users/set', users);\n\t\tconst dialoguesPromise = Core.getStore().dispatch('chats/set', chats);\n\t\tconst autoDeletePromise = Core.getStore().dispatch('chats/autoDelete/set', messagesAutoDeleteConfigs);\n\t\tconst messagesPromise = Core.getStore().dispatch('messages/store', messages);\n\t\tconst filesPromise = Core.getStore().dispatch('files/set', files);\n\t\tconst recentPromise = Core.getStore().dispatch(this.getModelSaveMethod(), recentItems);\n\t\tconst stickersPromise = Core.getStore().dispatch('stickers/messages/set', stickerMessages);\n\t\tconst copilotManager = new CopilotManager();\n\t\tconst copilotPromise = copilotManager.handleRecentListResponse(copilot);\n\n\t\treturn Promise.all([\n\t\t\tusersPromise,\n\t\t\tdialoguesPromise,\n\t\t\tmessagesPromise,\n\t\t\tfilesPromise,\n\t\t\trecentPromise,\n\t\t\tcopilotPromise,\n\t\t\tautoDeletePromise,\n\t\t\tstickersPromise,\n\t\t]);\n\t}\n\n\tgetLastMessageDate(items: Array): string\n\t{\n\t\tif (items.length === 0)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn items.slice(-1)[0].message.date;\n\t}\n\n\tgetExtractorOptions(): { withBirthdays?: boolean }\n\t{\n\t\treturn {};\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { Logger } from 'im.v2.lib.logger';\nimport { runAction } from 'im.v2.lib.rest';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport type { RawChat, RawMessage, RawRecentItem } from 'im.v2.provider.service.types';\nimport type { BaseRecentQueryParams, RecentRestResult } from './types/base-recent-types';\n\nexport class BaseRecentService\n{\n\t#itemsPerPage: number = 50;\n\t#isLoading: boolean = false;\n\t#pagesLoaded: number = 0;\n\t#hasMoreItemsToLoad: boolean = true;\n\t#lastMessageDate: number = 0;\n\n\tloadFirstPage(): Promise\n\t{\n\t\tthis.#isLoading = true;\n\n\t\treturn this.#requestItems({ firstPage: true });\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tif (this.#isLoading || !this.#hasMoreItemsToLoad)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tthis.#isLoading = true;\n\n\t\treturn this.#requestItems();\n\t}\n\n\thasMoreItemsToLoad(): boolean\n\t{\n\t\treturn this.#hasMoreItemsToLoad;\n\t}\n\n\tgetItemsPerPage(): number\n\t{\n\t\treturn this.#itemsPerPage;\n\t}\n\n\tgetRestMethodName(): string\n\t{\n\t\tthrow new Error('BaseRecentList: you should implement \"getRestMethodName\" for child class');\n\t}\n\n\tgetRecentSaveActionName(): string\n\t{\n\t\tthrow new Error('BaseRecentList: you should implement \"getRecentSaveActionName\" for child class');\n\t}\n\n\tgetQueryParams(firstPage: boolean = false): BaseRecentQueryParams\n\t{\n\t\treturn {\n\t\t\tlimit: this.getItemsPerPage(),\n\t\t\tfilter: this.getRequestFilter(firstPage),\n\t\t};\n\t}\n\n\tgetRequestFilter(firstPage: boolean = false): Record\n\t{\n\t\treturn {\n\t\t\tlastMessageDate: firstPage ? null : this.#lastMessageDate,\n\t\t};\n\t}\n\n\thandlePaginationField(result: RecentRestResult): void\n\t{\n\t\tthis.#lastMessageDate = this.#getLastMessageDate(result);\n\t}\n\n\tonAfterRequest(firstPage: boolean): void\n\t{\n\t\t// The base class does nothing here\n\t}\n\n\tasync #requestItems({ firstPage = false } = {}): Promise\n\t{\n\t\tconst queryParams = {\n\t\t\tdata: this.getQueryParams(firstPage),\n\t\t};\n\n\t\tconst result: RecentRestResult = await runAction(this.getRestMethodName(), queryParams)\n\t\t\t.catch(([error]) => {\n\t\t\t\tconsole.error('BaseRecentList: page request error', error);\n\t\t\t});\n\n\t\tthis.#pagesLoaded++;\n\t\tLogger.warn(`BaseRecentList: ${firstPage ? 'First' : this.#pagesLoaded} page request result`, result);\n\t\tconst { hasNextPage } = result;\n\t\tthis.handlePaginationField(result);\n\t\tthis.#hasMoreItemsToLoad = hasNextPage;\n\n\t\tthis.#isLoading = false;\n\n\t\tthis.onAfterRequest(firstPage);\n\n\t\treturn this.#updateModels(result);\n\t}\n\n\t#updateModels(restResult: RecentRestResult): Promise\n\t{\n\t\tconst { users, chats, messages, files, recentItems, messagesAutoDeleteConfigs, copilot } = restResult;\n\t\tconst chatsWithCounters = this.#getChatsWithCounters(chats, recentItems);\n\n\t\t// private chats objects are empty, so we should handle chats before users to not overwrite real info\n\t\tconst chatsPromise = Core.getStore().dispatch('chats/set', chatsWithCounters);\n\t\tconst usersPromise = (new UserManager()).setUsersToModel(users);\n\t\tconst autoDeletePromise = Core.getStore().dispatch('chats/autoDelete/set', messagesAutoDeleteConfigs);\n\t\tconst messagesPromise = Core.getStore().dispatch('messages/store', messages);\n\t\tconst filesPromise = Core.getStore().dispatch('files/set', files);\n\t\tconst recentPromise = Core.getStore().dispatch(this.getRecentSaveActionName(), recentItems);\n\n\t\tconst copilotManager = new CopilotManager();\n\t\tconst copilotPromise = copilotManager.handleRecentListResponse(copilot);\n\n\t\treturn Promise.all([\n\t\t\tusersPromise,\n\t\t\tchatsPromise,\n\t\t\tmessagesPromise,\n\t\t\tfilesPromise,\n\t\t\trecentPromise,\n\t\t\tautoDeletePromise,\n\t\t\tcopilotPromise,\n\t\t]);\n\t}\n\n\t#getChatsWithCounters(chats: RawChat[], recentItems: RawRecentItem[]): RawChat[]\n\t{\n\t\tconst chatMap = {};\n\t\tchats.forEach((chat) => {\n\t\t\tchatMap[chat.id] = chat;\n\t\t});\n\t\trecentItems.forEach((recentItem) => {\n\t\t\tconst { counter, chatId } = recentItem;\n\t\t\tif (counter === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tchatMap[chatId] = { ...chatMap[chatId], counter };\n\t\t});\n\n\t\treturn Object.values(chatMap);\n\t}\n\n\t#getLastMessageDate(restResult: RecentRestResult): string\n\t{\n\t\tconst messages = this.#filterPinnedItemsMessages(restResult);\n\t\tif (messages.length === 0)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\t// comparing strings in atom format works correctly because the format is lexically sortable\n\t\tlet firstMessageDate = messages[0].date;\n\t\tmessages.forEach((message) => {\n\t\t\tif (message.date < firstMessageDate)\n\t\t\t{\n\t\t\t\tfirstMessageDate = message.date;\n\t\t\t}\n\t\t});\n\n\t\treturn firstMessageDate;\n\t}\n\n\t#filterPinnedItemsMessages(restResult: RecentRestResult): RawMessage[]\n\t{\n\t\tconst { messages, recentItems } = restResult;\n\n\t\treturn messages.filter((message) => {\n\t\t\tconst chatId = message.chat_id;\n\t\t\tconst recentItem: RawRecentItem = recentItems.find((item) => {\n\t\t\t\treturn item.chatId === chatId;\n\t\t\t});\n\n\t\t\treturn recentItem.pinned === false;\n\t\t});\n\t}\n}\n","import { Core } from 'im.v2.application.core';\n\nimport { LegacyRecentService } from '../legacy-recent';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelRecentItem } from 'im.v2.model';\n\nexport class UnreadRecentService extends LegacyRecentService\n{\n\tstatic instance = null;\n\n\tstatic getInstance(): UnreadRecentService\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tgetQueryParams(firstPage: boolean): JsonObject\n\t{\n\t\treturn {\n\t\t\t...super.getQueryParams(firstPage),\n\t\t\tUNREAD_ONLY: 'Y',\n\t\t};\n\t}\n\n\tgetModelSaveMethod(): string\n\t{\n\t\treturn 'recent/setUnread';\n\t}\n\n\tgetCollection(): ImModelRecentItem[]\n\t{\n\t\treturn Core.getStore().getters['recent/getUnreadCollection'];\n\t}\n}\n"],"names":["RecentDataExtractor","constructor","params","rawData","withBirthdays","getItems","items","copilot","messagesAutoDeleteConfigs","forEach","item","users","Object","values","chats","messages","files","recentItems","stickerMessages","user","id","type","ChatType","chat","existingRecentItem","Core","getStore","getters","options","default_user_record","message","FakeMessagePrefix","viewedByOthers","status","MessageStatus","delivered","existingMessage","Type","isArrayFilled","attach","isPlainObject","file","existingFile","messageId","birthdayList","getUserId","sticker","counter","dialogId","chatId","chat_id","avatar","color","name","role","UserRole","member","backgroundId","background_id","textFieldEnabled","text_field_enabled","muteList","mute_list","isBirthdayPlaceholder","fileId","existingMessageFilesIds","map","Number","parseInt","setOfFileIds","Set","LegacyRecentService","dataIsPreloaded","firstPageIsLoaded","itemsPerPage","isLoading","pagesLoaded","hasMoreItemsToLoad","lastMessageDate","getInstance","instance","getCollection","loadFirstPage","ignorePreloadedItems","Logger","warn","Promise","resolve","result","requestItems","firstPage","loadNextPage","setPreloadedData","hasMore","getLastMessageDate","updateModels","hideChat","recentItem","dispatch","chatIsOpened","LayoutManager","clearCurrentLayoutEntityId","deleteLastOpenedElementById","getRestClient","callMethod","RestMethod","imRecentHide","DIALOG_ID","catch","console","error","queryParams","getQueryParams","imRecentList","errorResult","data","SKIP_OPENLINES","LIMIT","LAST_MESSAGE_DATE","GET_ORIGINAL_TEXT","PARSE_TEXT","getModelSaveMethod","extractor","getExtractorOptions","extractedItems","usersPromise","dialoguesPromise","autoDeletePromise","messagesPromise","filesPromise","recentPromise","stickersPromise","copilotManager","CopilotManager","copilotPromise","handleRecentListResponse","all","length","slice","date","BaseRecentService","getItemsPerPage","getRestMethodName","Error","getRecentSaveActionName","limit","filter","getRequestFilter","handlePaginationField","onAfterRequest","runAction","hasNextPage","restResult","chatsWithCounters","chatsPromise","UserManager","setUsersToModel","chatMap","firstMessageDate","find","pinned","UnreadRecentService","UNREAD_ONLY"],"mappings":"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"}