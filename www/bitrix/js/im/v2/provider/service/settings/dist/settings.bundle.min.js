this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,s,i,o){"use strict";class n{changeSetting(e,n){i.Logger.warn("SettingsService: changeSetting",e,n);void t.Core.getStore().dispatch("application/settings/set",{[e]:n});const r={data:{userId:t.Core.getUserId(),name:e,value:n}};o.runAction(s.RestMethod.imV2SettingsGeneralUpdate,r).catch((([e])=>{console.error("SettingsService: changeSetting error",e)}))}changeStatus(e){if(!s.UserStatus[e]){return}i.Logger.warn(`SettingsService: changeStatus to ${e}`);void t.Core.getStore().dispatch("users/setStatus",{status:e});void t.Core.getStore().dispatch("application/settings/set",{status:e});const o={STATUS:e};t.Core.getRestClient().callMethod(s.RestMethod.imUserStatusSet,o).catch((e=>{console.error("SettingsService: changeStatus error",e.error())}))}async switchScheme(e){void t.Core.getStore().dispatch("application/settings/set",{[s.Settings.notification.mode]:e});const i=await o.runAction(s.RestMethod.imV2SettingsNotifySwitchScheme,{data:{userId:t.Core.getUserId(),scheme:e}}).catch((([e])=>{console.error("SettingsService: switchScheme error",e)}));void t.Core.getStore().dispatch("application/settings/set",{notifications:i})}async changeExpertOption(e){const{moduleId:i,optionName:n,type:r,value:a}=e;void t.Core.getStore().dispatch("application/settings/setNotificationOption",{moduleId:i,optionName:n,type:r,value:a});try{await o.runAction(s.RestMethod.imV2SettingsNotifyUpdate,{data:{userId:t.Core.getUserId(),moduleId:i,name:n,type:r,value:a}})}catch([e]){console.error("SettingsService: changeExpertOption error",e)}}async toggleSubscription(e){const{notifyModule:i,notifyEvent:o,shouldSubscribe:n,lastSubscribedTypes:r}=e;const a=t.Core.getStore().getters["application/settings/get"](s.Settings.notifications);const c=t.Core.getStore().getters["application/settings/get"](s.Settings.notification.mode);if(c===s.NotificationSettingsMode.simple){await this.switchScheme(s.NotificationSettingsMode.expert)}const g=a[i].items[o];const S=r.map((e=>this.changeExpertOption({moduleId:i,optionName:o,type:e,oldValue:g[e],value:n})));return Promise.all(S)}}e.SettingsService=n})(this.BX.Messenger.v2.Service=this.BX.Messenger.v2.Service||{},BX.Messenger.v2.Application,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=settings.bundle.map.js