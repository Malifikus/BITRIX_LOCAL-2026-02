{"version":3,"file":"sticker.bundle.js","sources":["../src/sticker.js"],"sourcesContent":["import { Type } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { runAction } from 'im.v2.lib.rest';\nimport { Logger } from 'im.v2.lib.logger';\nimport { Notifier } from 'im.v2.lib.notifier';\n\nimport type { ImModelStickerPackIdentifier, ImModelStickerIdentifier, ImModelStickerPack } from 'im.v2.model';\nimport type { RawSticker, RawStickerPack } from 'im.v2.provider.service.types';\n\ntype StickerPackLoadResponse = {\n\tpacks: RawStickerPack[],\n\tstickers: RawSticker[],\n\trecentStickers?: RawSticker[],\n\thasNextPage: boolean,\n};\n\ntype CreatePackResponse = {\n\tpack: RawStickerPack[],\n\tstickers: RawSticker[],\n\tuuids: Array<{\n\t\tid: number,\n\t\tpackId: number,\n\t\tpackType: string,\n\t\tuuid: string,\n\t}>,\n};\n\ntype AddStickersResponse = CreatePackResponse;\n\ntype LoadPackResponse = { pack: RawStickerPack, stickers: RawSticker[] };\n\nconst PACKS_REQUEST_LIMIT = 10;\n\nexport class StickerService\n{\n\tstatic instance: StickerService;\n\n\t#lastPackId: number | null = null;\n\t#lastPackType: string = '';\n\t#hasMore: boolean = true;\n\n\tstatic getInstance(): StickerService\n\t{\n\t\tif (!this.instance)\n\t\t{\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tasync initFirstPage(): Promise\n\t{\n\t\tif (this.#lastPackId)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn this.#requestItems();\n\t}\n\n\tasync loadNextPage(): Promise\n\t{\n\t\tif (!this.#hasMore)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn this.#requestItems();\n\t}\n\n\tasync loadPack({ id, type }: ImModelStickerPackIdentifier): Promise\n\t{\n\t\tconst hasPack = Core.getStore().getters['stickers/packs/hasPack']({ id, type });\n\t\tif (hasPack)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst rawData: LoadPackResponse = await runAction(RestMethod.imV2StickerPackGet, {\n\t\t\tdata: { id, type },\n\t\t}).catch((error) => {\n\t\t\tLogger.warn('StickerService: pack request error', error);\n\t\t});\n\n\t\tconst { pack, stickers } = rawData;\n\n\t\tconst packsPromise = Core.getStore().dispatch('stickers/packs/set', [pack]);\n\t\tconst stickersPromise = Core.getStore().dispatch('stickers/set', stickers);\n\n\t\treturn Promise.all([stickersPromise, packsPromise]);\n\t}\n\n\tasync linkPack({ id, type }: ImModelStickerPackIdentifier): Promise\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/packs/link', { id, type });\n\t\tawait runAction(RestMethod.imV2StickerPackLink, {\n\t\t\tdata: { id, type },\n\t\t}).catch((errors) => {\n\t\t\tconst [firstError] = errors;\n\t\t\tthis.#showNotifyForError(firstError.code);\n\t\t\tLogger.warn('StickerService: link pack error', errors);\n\t\t\tNotifier.sticker.handleLinkPackError();\n\t\t});\n\t}\n\n\tasync createPack({ uuids, type, name }: { uuids: string[], type: string, name: string }): Promise\n\t{\n\t\tconst rawData: CreatePackResponse = await runAction(RestMethod.imV2StickerPackAdd, {\n\t\t\tdata: { uuids, type, name },\n\t\t}).catch((errors) => {\n\t\t\tconst [firstError] = errors;\n\t\t\tthis.#showNotifyForError(firstError.code);\n\t\t\tLogger.warn('StickerService: pack creation error', errors);\n\t\t});\n\n\t\tconst { pack, stickers } = rawData;\n\t\tconst packsPromise = Core.getStore().dispatch('stickers/packs/addNew', pack);\n\t\tconst stickersPromise = Core.getStore().dispatch('stickers/set', stickers);\n\n\t\treturn Promise.all([packsPromise, stickersPromise]);\n\t}\n\n\tasync renamePack({ id, type, name }: ImModelStickerPackIdentifier & {name: string}): Promise\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/packs/rename', { id, type, name });\n\t\tawait runAction(RestMethod.imV2StickerPackRename, {\n\t\t\tdata: { id, type, name },\n\t\t}).catch((error) => {\n\t\t\tLogger.warn('StickerService: rename pack error', error);\n\t\t\tNotifier.sticker.handleLinkPackError();\n\t\t});\n\t}\n\n\tasync addStickers({ uuids, id, type }: { uuids: string[], id: number, type: string }): Promise\n\t{\n\t\tconst rawData: AddStickersResponse = await runAction(RestMethod.imV2StickerAdd, {\n\t\t\tdata: { uuids, packId: id, packType: type },\n\t\t}).catch((errors) => {\n\t\t\tconst [firstError] = errors;\n\t\t\tthis.#showNotifyForError(firstError.code);\n\t\t\tLogger.warn('StickerService: add stickers error', errors);\n\t\t\tthrow errors;\n\t\t});\n\n\t\tconst { pack, stickers } = rawData;\n\t\tconst packsPromise = Core.getStore().dispatch('stickers/packs/addNew', pack);\n\t\tconst stickersPromise = Core.getStore().dispatch('stickers/set', stickers);\n\n\t\treturn Promise.all([packsPromise, stickersPromise]);\n\t}\n\n\tasync updatePack({ uuids, id, type, name }: { uuids: string[], id: number, type: string, name: string }): Promise\n\t{\n\t\tconst promises = [];\n\t\tif (Type.isArrayFilled(uuids))\n\t\t{\n\t\t\tpromises.push(this.addStickers({ uuids, id, type }));\n\t\t}\n\n\t\tif (this.#wasPackRenamed({ id, type, name }))\n\t\t{\n\t\t\tpromises.push(this.renamePack({ uuids, id, type, name }));\n\t\t}\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tasync deletePack({ id, type }: ImModelStickerPackIdentifier): Promise\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/packs/delete', { id, type });\n\t\tvoid Core.getStore().dispatch('stickers/deleteByPack', { id, type });\n\t\tawait runAction(RestMethod.imV2StickerPackDelete, {\n\t\t\tdata: { id, type },\n\t\t}).catch((error) => {\n\t\t\tLogger.warn('StickerService: delete pack error', error);\n\t\t});\n\t}\n\n\tasync unlinkPack({ id, type }: ImModelStickerPackIdentifier): Promise\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/packs/unlink', { id, type });\n\n\t\tawait runAction(RestMethod.imV2StickerPackUnlink, {\n\t\t\tdata: { id, type },\n\t\t}).catch((error) => {\n\t\t\tLogger.warn('StickerService: unlink pack error', error);\n\t\t});\n\t}\n\n\tasync clearRecent(): Promise\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/recent/clear');\n\t\tawait runAction(RestMethod.imV2StickerRecentDeleteAll, { data: {} }).catch((error) => {\n\t\t\tLogger.warn('StickerService: clear recent error', error);\n\t\t});\n\t}\n\n\tasync removeFromRecent({ id, packType, packId }: ImModelStickerIdentifier): Promise\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/recent/delete', { id, packType, packId });\n\n\t\tawait runAction(RestMethod.imV2StickerRecentDelete, {\n\t\t\tdata: { id, packId, packType },\n\t\t}).catch((error) => {\n\t\t\tLogger.warn('StickerService: remove sticker from recent error', error);\n\t\t});\n\t}\n\n\tasync deleteStickerFromPack({ ids, packId, packType }: { ids: number[], packId: number, packType: string }): Promise\n\t{\n\t\tvoid Core.getStore().dispatch('stickers/delete', { ids, packType, packId });\n\t\tconst remainStickers = Core.getStore().getters['stickers/getByPack']({ id: packId, type: packType });\n\t\tif (!Type.isArrayFilled(remainStickers))\n\t\t{\n\t\t\tvoid Core.getStore().dispatch('stickers/packs/delete', { id: packId, type: packType });\n\t\t}\n\n\t\tawait runAction(RestMethod.imV2StickerDelete, {\n\t\t\tdata: { ids, packId, packType },\n\t\t}).catch((error) => {\n\t\t\tLogger.warn('StickerService: remove sticker from pack error', error);\n\t\t});\n\t}\n\n\t#getQueryParams(): { limit: number, id?: number, type?: string }\n\t{\n\t\tconst params = { limit: PACKS_REQUEST_LIMIT };\n\t\tconst isFirstPage = !this.#lastPackId && !this.#lastPackType;\n\t\tif (!isFirstPage)\n\t\t{\n\t\t\tparams.id = this.#lastPackId;\n\t\t\tparams.type = this.#lastPackType;\n\t\t}\n\n\t\treturn params;\n\t}\n\n\tasync #requestItems(): Promise<void>\n\t{\n\t\tconst query = { data: this.#getQueryParams() };\n\t\tconst isFirstPage = !this.#lastPackId && !this.#lastPackType;\n\t\tconst method = isFirstPage ? RestMethod.imV2StickerPackLoad : RestMethod.imV2StickerPackTail;\n\n\t\tconst rawData: StickerPackLoadResponse = await runAction(method, query).catch((error) => {\n\t\t\tLogger.warn('StickerService: page request error', error);\n\t\t});\n\t\tthis.#handlePagination(rawData);\n\t\tthis.#updateModels(rawData);\n\t}\n\n\t#handlePagination(response: StickerPackLoadResponse): void\n\t{\n\t\tthis.#hasMore = response.hasNextPage;\n\t\tconst lastPack = response.packs[response.packs.length - 1];\n\t\tif (lastPack)\n\t\t{\n\t\t\tthis.#lastPackId = lastPack.id;\n\t\t\tthis.#lastPackType = lastPack.type;\n\t\t}\n\t}\n\n\t#updateModels(response: StickerPackLoadResponse): void\n\t{\n\t\tconst { packs, stickers, recentStickers = [] } = response;\n\t\tconst packsPromise = Core.getStore().dispatch('stickers/packs/set', packs);\n\t\tconst stickersPromise = Core.getStore().dispatch('stickers/set', stickers);\n\t\tconst recentPromise = Core.getStore().dispatch('stickers/recent/set', recentStickers);\n\n\t\treturn Promise.all([stickersPromise, packsPromise, recentPromise]);\n\t}\n\n\t#wasPackRenamed({ id, type, name }: ImModelStickerPackIdentifier & {name: string}): boolean\n\t{\n\t\tconst pack: ?ImModelStickerPack = Core.getStore().getters['stickers/packs/getByIdentifier']({ id, type });\n\t\tif (!pack)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn pack.name !== name;\n\t}\n\n\t#showNotifyForError(errorCode: string): void\n\t{\n\t\tconst notifications = {\n\t\t\tMAX_STICKERS_ERROR: Notifier.sticker.handleAddStickersError,\n\t\t\tMAX_PACKS_ERROR: Notifier.sticker.handleAddPackError,\n\t\t};\n\n\t\tif (!notifications[errorCode])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnotifications[errorCode]();\n\t}\n}\n"],"names":["PACKS_REQUEST_LIMIT","StickerService","Promise","resolve","id","type","hasPack","Core","getStore","getters","runAction","RestMethod","imV2StickerPackGet","data","error","Logger","warn","rawData","pack","stickers","packsPromise","dispatch","stickersPromise","all","imV2StickerPackLink","errors","firstError","code","Notifier","sticker","handleLinkPackError","uuids","name","imV2StickerPackAdd","imV2StickerPackRename","imV2StickerAdd","packId","packType","promises","Type","isArrayFilled","push","addStickers","renamePack","imV2StickerPackDelete","imV2StickerPackUnlink","imV2StickerRecentDeleteAll","imV2StickerRecentDelete","ids","remainStickers","imV2StickerDelete","instance","params","limit","isFirstPage","query","method","imV2StickerPackLoad","imV2StickerPackTail","response","hasNextPage","lastPack","packs","length","recentStickers","recentPromise","errorCode","notifications","MAX_STICKERS_ERROR","handleAddStickersError","MAX_PACKS_ERROR","handleAddPackError"],"mappings":"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"}