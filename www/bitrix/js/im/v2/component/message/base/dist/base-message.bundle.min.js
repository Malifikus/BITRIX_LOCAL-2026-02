this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,s,n,i,o,a,r,g,l){"use strict";const h={name:"BaseMessage",components:{ContextMenu:o.ContextMenu,RetryButton:o.RetryButton,MessageKeyboard:o.MessageKeyboard,ReactionSelector:o.ReactionSelector},props:{item:{type:Object,required:true},dialogId:{type:String,required:true},withBackground:{type:Boolean,default:true},withContextMenu:{type:Boolean,default:true},withReactions:{type:Boolean,default:true},withRetryButton:{type:Boolean,default:true},afterMessageWidthLimit:{type:Boolean,default:true},withError:{type:Boolean,default:false}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},message(){return this.item},isSystemMessage(){return this.message.authorId===0},isSelfMessage(){return this.message.authorId===n.Core.getUserId()},isOpponentMessage(){return!this.isSystemMessage&&!this.isSelfMessage},isChannelPost(){return g.ChannelManager.isChannel(this.dialogId)},isBulkActionsMode(){return this.$store.getters["messages/select/isBulkActionsModeActive"](this.dialogId)},isMessageSelected(){return this.$store.getters["messages/select/isMessageSelected"](this.message.id,this.dialogId)},showMessageAngle(){const t=Boolean(this.$slots["after-message"]);return!this.withBackground||this.isChannelPost||t},containerClasses(){return{"--self":this.isSelfMessage,"--opponent":this.isOpponentMessage,"--has-error":this.hasError,"--has-after-content":Boolean(this.$slots["after-message"]),"--selected":this.isMessageSelected,"--is-bulk-actions-mode":this.isBulkActionsMode}},bodyClasses(){return{"--transparent":!this.withBackground,"--no-angle":this.showMessageAngle}},showRetryButton(){return this.withRetryButton&&this.isSelfMessage&&this.hasError},showContextMenu(){return this.withContextMenu&&!this.hasError&&this.canOpenContextMenu},canOpenContextMenu(){return r.PermissionManager.getInstance().canPerformActionByRole(a.ActionByRole.openMessageMenu,this.dialogId)},hasError(){return this.withError||this.message.error}},methods:{onContainerClick(t){i.Parser.executeClickEvent(t,{emitter:this.getEmitter()})},openContextMenu(t){const e=Boolean(t.target.closest(".bx-im-message-context-menu__container"));if(!this.withContextMenu||e||this.hasSelectedText()){return}const s=l.MessageMenuManager.getInstance();const n=s.shouldUseNativeContextMenu(t.target);if(n){s.destroyMenuInstance();return}t.preventDefault();this.getEmitter().emit(a.EventType.dialog.onClickMessageContextMenu,{message:this.message,dialogId:this.dialogId,event:t})},async onMessageMouseUp(t,e){await s.Utils.browser.waitForSelectionToUpdate();if(!this.hasSelectedText()){return}this.getEmitter().emit(a.EventType.dialog.showQuoteButton,{message:t,event:e})},hasSelectedText(){const t=window.getSelection().toString().trim();return e.Type.isStringFilled(t)},getEmitter(){return this.$Bitrix.eventEmitter}},template:`\n\t\t<div class="bx-im-message-base__wrap bx-im-message-base__scope" :class="containerClasses" :data-id="message.id">\n\t\t\t<div\n\t\t\t\tclass="bx-im-message-base__container" \n\t\t\t\t@click="onContainerClick"\n\t\t\t\t@contextmenu="openContextMenu"\n\t\t\t\t@mouseup="onMessageMouseUp(message, $event)"\n\t\t\t>\n\t\t\t\t\x3c!-- Before content --\x3e\n\t\t\t\t<slot name="before-message"></slot>\n\t\t\t\t\x3c!-- Content + retry + context menu --\x3e\n\t\t\t\t<div class="bx-im-message-base__content">\n\t\t\t\t\t<div class="bx-im-message-base__body" :class="bodyClasses">\n\t\t\t\t\t\t<slot></slot>\n\t\t\t\t\t\t<ReactionSelector v-if="withReactions" :messageId="message.id" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<RetryButton v-if="showRetryButton" :message="message" :dialogId="dialogId"/>\n\t\t\t\t\t<ContextMenu\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t:showContextMenu="showContextMenu"\n\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t:message="message" \n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- After content --\x3e\n\t\t\t\t<div\n\t\t\t\t\tv-if="$slots['after-message']"\n\t\t\t\t\tclass="bx-im-message-base__bottom"\n\t\t\t\t\t:class="{'--width-limit': afterMessageWidthLimit}"\n\t\t\t\t>\n\t\t\t\t\t<div class="bx-im-message-base__bottom-content">\n\t\t\t\t\t\t<slot name="after-message"></slot>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};t.BaseMessage=h})(this.BX.Messenger.v2.Component.Message=this.BX.Messenger.v2.Component.Message||{},BX,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Message,BX.Messenger.v2.Const,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib);
//# sourceMappingURL=base-message.bundle.map.js