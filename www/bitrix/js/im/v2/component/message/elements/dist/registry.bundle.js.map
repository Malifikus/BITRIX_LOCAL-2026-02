{"version":3,"file":"registry.bundle.js","sources":["../src/message-status/message-status.js","../src/attach/attach.js","../src/keyboard/keyboard.js","../src/reaction/components/user.js","../src/reaction/classes/user-service.js","../src/reaction/components/additional-users.js","../src/reaction/components/item.js","../src/reaction/classes/reaction-service.js","../src/reaction/list.js","../src/reaction/selector.js","../src/reply/reply.js","../src/author-title/author-title.js","../src/context-menu/context-menu.js","../src/retry-button/classes/retry-context-menu.js","../src/retry-button/retry-button.js","../src/message-header/message-header.js","../src/comments-panel/comments-panel.js","../src/message-footer/message-footer.js","../src/default-message-content/default-message-content.js","../src/comments-panel/compact-comments-panel.js"],"sourcesContent":["import { Core } from 'im.v2.application.core';\nimport { OwnMessageStatus as StatusType } from 'im.v2.const';\nimport { DateCode, DateFormatter } from 'im.v2.lib.date-formatter';\n\nimport './message-status.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const MessageStatus = {\n\tname: 'MessageStatus',\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tisOverlay: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed: {\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\treturn DateFormatter.formatByCode(this.message.date, DateCode.shortTimeFormat);\n\t\t},\n\t\tisSelfMessage(): boolean\n\t\t{\n\t\t\treturn this.message.authorId === Core.getUserId();\n\t\t},\n\t\tmessageStatus(): $Values<typeof StatusType>\n\t\t{\n\t\t\tif (this.message.error)\n\t\t\t{\n\t\t\t\treturn StatusType.error;\n\t\t\t}\n\n\t\t\tif (this.message.sending)\n\t\t\t{\n\t\t\t\treturn StatusType.sending;\n\t\t\t}\n\n\t\t\tif (this.message.viewedByOthers)\n\t\t\t{\n\t\t\t\treturn StatusType.viewed;\n\t\t\t}\n\n\t\t\treturn StatusType.sent;\n\t\t},\n\t},\n\tmethods: {\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-status__container\" :class=\"{'--overlay': isOverlay}\">\n\t\t\t<div v-if=\"message.isEdited && !message.isDeleted\" class=\"bx-im-message-status__edit-mark\">\n\t\t\t\t{{ loc('IM_MESSENGER_MESSAGE_EDITED') }}\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-message-status__date\" :class=\"{'--overlay': isOverlay}\">\n\t\t\t\t{{ formattedDate }}\n\t\t\t</div>\n\t\t\t<div v-if=\"isSelfMessage\" :class=\"'--' + messageStatus\" class=\"bx-im-message-status__icon\"></div>\n\t\t</div>\n\t`,\n};\n","import { provide } from 'ui.vue3';\n\nimport { Attach } from 'im.v2.component.elements.attach';\nimport { ChatType } from 'im.v2.const';\n\nimport './attach.css';\n\nimport type { ImModelChat, ImModelMessage, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const MessageAttach = {\n\tname: 'MessageAttach',\n\tcomponents: { Attach },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialogColor(): string\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user ? this.user.color : this.dialog.color;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tprovide('message', this.message);\n\t},\n\ttemplate: `\n\t\t<div v-for=\"config in message.attach\" :key=\"config.id\" class=\"bx-im-message-attach__container\">\n\t\t\t<Attach :baseColor=\"dialogColor\" :config=\"config\" />\n\t\t</div>\n\t`,\n};\n","import { Keyboard } from 'im.v2.component.elements.keyboard';\n\nimport './keyboard.css';\n\nimport type { ImModelChat, ImModelMessage, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const MessageKeyboard = {\n\tname: 'MessageKeyboard',\n\tcomponents: { Keyboard },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-keyboard__container\">\n\t\t\t<Keyboard :buttons=\"message.keyboard\" :dialogId=\"dialogId\" :messageId=\"message.id\" />\n\t\t</div>\n\t`,\n};\n","import { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport type { ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const ReactionUser = {\n\tname: 'ReactionUser',\n\tcomponents: { ChatAvatar },\n\tprops:\n\t{\n\t\tuserId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.userId);\n\t\t},\n\t\tavatarStyle(): Object\n\t\t{\n\t\t\tif (!this.user.avatar)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url('${this.user.avatar}')`,\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-reaction-list__user_avatar\">\n\t\t\t<ChatAvatar \n\t\t\t\t:avatarDialogId=\"userId\" \n\t\t\t\t:size=\"AvatarSize.XS\" \n\t\t\t\t:withAvatarLetters=\"false\"\n\t\t\t\t:withTooltip=\"false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { RestMethod } from 'im.v2.const';\nimport { BaseUserService } from 'im.v2.provider.service.user';\n\ntype ReactionItem = {\n\tid: number,\n\tmessageId: number,\n\tuserId: number,\n\treaction: string,\n\tdateReaction: string,\n}\n\nexport class UserService extends BaseUserService<{ reactions: ReactionItem[] }>\n{\n\t#reaction: string;\n\n\tconstructor(reaction: string)\n\t{\n\t\tsuper();\n\t\tthis.#reaction = reaction;\n\t}\n\n\tgetRequestFilter(firstPage = false): Record\n\t{\n\t\treturn {\n\t\t\t...super.getRequestFilter(firstPage),\n\t\t\treaction: this.#reaction,\n\t\t};\n\t}\n\n\tgetRestMethodName(): string\n\t{\n\t\treturn RestMethod.imV2ChatMessageReactionTail;\n\t}\n\n\tgetLastId(result): number\n\t{\n\t\tconst { reactions } = result;\n\n\t\tif (!reactions || reactions.length === 0)\n\t\t{\n\t\t\treturn 0;\n\t\t}\n\n\t\tconst sortedReactions = [...reactions].sort((a, b) => b.id - a.id);\n\n\t\treturn sortedReactions[sortedReactions.length - 1].id;\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { UserListPopup } from 'im.v2.component.elements.user-list-popup';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport { UserService } from '../classes/user-service';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const AdditionalUsers = {\n\tcomponents: { UserListPopup },\n\tprops: {\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t\treaction: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tshow: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tbindElement: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['close'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowPopup: false,\n\t\t\tloadingAdditionalUsers: false,\n\t\t\tadditionalUsers: [],\n\t\t};\n\t},\n\twatch:\n\t{\n\t\tshow(newValue, oldValue)\n\t\t{\n\t\t\tif (!oldValue && newValue)\n\t\t\t{\n\t\t\t\tthis.showPopup = true;\n\t\t\t\tthis.loadUsers();\n\t\t\t}\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tasync loadUsers()\n\t\t{\n\t\t\tthis.loadingAdditionalUsers = true;\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tthis.additionalUsers = await this.getUserService().loadFirstPage(this.messageId);\n\t\t\t\tthis.loadingAdditionalUsers = false;\n\t\t\t}\n\t\t\tcatch\n\t\t\t{\n\t\t\t\tthis.loadingAdditionalUsers = false;\n\t\t\t}\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tif (!Utils.dom.isOneScreenRemaining(event.target) || !this.getUserService().hasMoreItemsToLoad())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst userIds = await this.getUserService().loadNextPage(this.messageId);\n\n\t\t\tif (!userIds)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.additionalUsers = [...this.additionalUsers, ...userIds];\n\t\t},\n\t\tonPopupClose()\n\t\t{\n\t\t\tthis.showPopup = false;\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tprepareAdditionalUsers(userIds: number[]): number[]\n\t\t{\n\t\t\tconst firstViewerId = this.dialog.lastMessageViews.firstViewer.userId;\n\n\t\t\treturn userIds.filter((userId) => {\n\t\t\t\treturn userId !== Core.getUserId() && userId !== firstViewerId;\n\t\t\t});\n\t\t},\n\t\tgetUserService(): UserService\n\t\t{\n\t\t\tif (!this.userService)\n\t\t\t{\n\t\t\t\tthis.userService = new UserService(this.reaction);\n\t\t\t}\n\n\t\t\treturn this.userService;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<UserListPopup\n\t\t\tid=\"bx-im-message-reaction-users\"\n\t\t\t:showPopup=\"showPopup\"\n\t\t\t:loading=\"loadingAdditionalUsers\"\n\t\t\t:userIds=\"additionalUsers\"\n\t\t\t:bindElement=\"bindElement || {}\"\n\t\t\t:withAngle=\"false\"\n\t\t\t:offsetLeft=\"-112\"\n\t\t\t:forceTop=\"true\"\n\t\t\t@close=\"onPopupClose\"\n\t\t\t@scroll=\"onScroll\"\n\t\t/>\n\t`,\n};\n","import { Reaction } from 'ui.reaction.item.vue';\n\nimport { ReactionUser } from './user';\nimport { AdditionalUsers } from './additional-users';\n\nconst USERS_TO_SHOW = 5;\nconst REACTION_SIZE = 16;\nconst SHOW_USERS_DELAY = 500;\n\n// @vue/component\nexport const ReactionItem = {\n\tcomponents: { ReactionUser, AdditionalUsers, Reaction },\n\tprops:\n\t{\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tcounter: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tusers: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tselected: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tanimate: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tshowAvatars: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['click', 'animationFinish'],\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tshowAdditionalUsers: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tREACTION_SIZE: () => REACTION_SIZE,\n\t\tneedToShowUsers(): boolean\n\t\t{\n\t\t\tif (!this.showAvatars)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst userLimitIsNotReached = this.counter <= USERS_TO_SHOW;\n\t\t\t// after reaction removal we do not receive all users data to show avatar list properly\n\t\t\tconst weHaveUsersData = this.counter === this.users.length;\n\n\t\t\treturn userLimitIsNotReached && weHaveUsersData;\n\t\t},\n\t\tpreparedUsers(): number[]\n\t\t{\n\t\t\treturn [...this.users].sort((a, b) => b - a);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tstartShowUsersTimer()\n\t\t{\n\t\t\tthis.showUsersTimeout = setTimeout(() => {\n\t\t\t\tthis.showAdditionalUsers = true;\n\t\t\t}, SHOW_USERS_DELAY);\n\t\t},\n\t\tclearShowUsersTimer()\n\t\t{\n\t\t\tclearTimeout(this.showUsersTimeout);\n\t\t},\n\t\tonClick()\n\t\t{\n\t\t\tthis.clearShowUsersTimer();\n\t\t\tthis.$emit('click');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t@click=\"onClick\" \n\t\t\t@mouseenter=\"startShowUsersTimer\"\n\t\t\t@mouseleave=\"clearShowUsersTimer\"\n\t\t\tclass=\"bx-im-reaction-list__item\"\n\t\t\t:class=\"{'--selected': selected}\"\n\t\t>\n\t\t\t<div class=\"bx-im-reaction-list__item_icon\">\n\t\t\t\t<Reaction\n\t\t\t\t\t:size=\"REACTION_SIZE\"\n\t\t\t\t\t:name=\"type\"\n\t\t\t\t\t:animate=\"animate\"\n\t\t\t\t\t@animationFinish=\"$emit('animationFinish')\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-if=\"needToShowUsers\" class=\"bx-im-reaction-list__user_container\" ref=\"users\">\n\t\t\t\t<TransitionGroup name=\"bx-im-reaction-list__user_animation\">\n\t\t\t\t\t<ReactionUser \n\t\t\t\t\t\tv-for=\"user in preparedUsers\" \n\t\t\t\t\t\t:key=\"type + user\" \n\t\t\t\t\t\t:userId=\"user\"\n\t\t\t\t\t/>\n\t\t\t\t</TransitionGroup>\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-im-reaction-list__item_counter\" ref=\"counter\">{{ counter }}</div>\n\t\t\t<AdditionalUsers\n\t\t\t\t:show=\"showAdditionalUsers\"\n\t\t\t\t:bindElement=\"$refs['users'] || $refs['counter'] || {}\"\n\t\t\t\t:messageId=\"messageId\"\n\t\t\t\t:reaction=\"type\"\n\t\t\t\t@close=\"showAdditionalUsers = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { Feature, FeatureManager } from 'im.v2.lib.feature';\nimport { Logger } from 'im.v2.lib.logger';\nimport { runAction } from 'im.v2.lib.rest';\n\nexport class ReactionService\n{\n\tsetReaction(messageId: number, reaction: string): void\n\t{\n\t\tLogger.warn('ReactionService: setReaction', messageId, reaction);\n\t\tconst payload = {\n\t\t\tdata: {\n\t\t\t\tmessageId,\n\t\t\t\treaction,\n\t\t\t},\n\t\t};\n\n\t\tconst canSetMultipleReactions = FeatureManager.isFeatureAvailable(Feature.reactionsV2Available);\n\n\t\tvoid Core.getStore().dispatch('messages/reactions/setReaction', {\n\t\t\tmessageId,\n\t\t\treaction,\n\t\t\tuserId: Core.getUserId(),\n\t\t\twithReplace: !canSetMultipleReactions,\n\t\t});\n\n\t\trunAction(RestMethod.imV2ChatMessageReactionAdd, payload)\n\t\t\t.catch(([error]) => {\n\t\t\t\tconsole.error('ReactionService: error setting reaction', error);\n\t\t\t});\n\t}\n\n\tremoveReaction(messageId: number, reaction: string): void\n\t{\n\t\tLogger.warn('ReactionService: removeReaction', messageId, reaction);\n\t\tconst payload = {\n\t\t\tdata: {\n\t\t\t\tmessageId,\n\t\t\t\treaction,\n\t\t\t},\n\t\t};\n\t\tvoid Core.getStore().dispatch('messages/reactions/removeReaction', {\n\t\t\tmessageId,\n\t\t\treaction,\n\t\t\tuserId: Core.getUserId(),\n\t\t});\n\n\t\trunAction(RestMethod.imV2ChatMessageReactionDelete, payload)\n\t\t\t.catch(([error]) => {\n\t\t\t\tconsole.error('ReactionService: error removing reaction', error);\n\t\t\t});\n\t}\n}\n","import { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { ReactionName } from 'ui.reaction.item';\n\nimport { DialogScrollThreshold, EventType, ActionByRole } from 'im.v2.const';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { ChannelManager } from 'im.v2.lib.channel';\n\nimport { ReactionItem } from './components/item';\nimport { ReactionService } from './classes/reaction-service';\n\nimport './list.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelReactions, ImModelMessage, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const ReactionList = {\n\tname: 'ReactionList',\n\tcomponents: { ReactionItem },\n\tprops:\n\t{\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\treactionsToAnimate: new Set(),\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.messageId);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/getByChatId'](this.message.chatId);\n\t\t},\n\t\treactionsData(): ImModelReactions\n\t\t{\n\t\t\treturn this.$store.getters['messages/reactions/getByMessageId'](this.messageId);\n\t\t},\n\t\treactionCounters(): {[string]: number}\n\t\t{\n\t\t\treturn this.reactionsData?.reactionCounters ?? {};\n\t\t},\n\t\townReactions(): Set<string>\n\t\t{\n\t\t\treturn this.reactionsData?.ownReactions ?? new Set();\n\t\t},\n\t\treactionListToShow(): string[]\n\t\t{\n\t\t\treturn Object.keys(ReactionName)\n\t\t\t\t.filter((reaction) => {\n\t\t\t\t\treturn Boolean(this.reactionCounters[reaction]);\n\t\t\t\t});\n\t\t},\n\t\tneedToShowReactionsContainer(): boolean\n\t\t{\n\t\t\treturn Object.keys(this.reactionCounters).length > 0;\n\t\t},\n\t\tisChannel(): boolean\n\t\t{\n\t\t\treturn ChannelManager.isChannel(this.dialog.dialogId);\n\t\t},\n\t\tshowAvatars(): boolean\n\t\t{\n\t\t\treturn !this.isChannel;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\treactionCounters(newCounters: {[string]: number}, oldCounters: {[string]: number})\n\t\t{\n\t\t\tconst newReactions = Object.keys(newCounters);\n\t\t\tconst oldReactions = Object.keys(oldCounters);\n\n\t\t\tfor (const reaction of newReactions)\n\t\t\t{\n\t\t\t\tif (!oldReactions.includes(reaction))\n\t\t\t\t{\n\t\t\t\t\tthis.reactionsToAnimate.add(reaction);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tneedToShowReactionsContainer(newValue, oldValue)\n\t\t{\n\t\t\tif (!oldValue && newValue)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(EventType.dialog.scrollToBottom, {\n\t\t\t\t\tchatId: this.message.chatId,\n\t\t\t\t\tthreshold: DialogScrollThreshold.nearTheBottom,\n\t\t\t\t\tanimation: false,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tconst MAX_LISTENERS = 500;\n\t\tthis.getEmitter().setMaxListeners(EventType.reaction.onReactionSelected, MAX_LISTENERS);\n\t\tthis.getEmitter().subscribe(EventType.reaction.onReactionSelected, this.onPickerReactionSelected);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.getEmitter().unsubscribe(EventType.reaction.onReactionSelected, this.onPickerReactionSelected);\n\t},\n\tmethods:\n\t{\n\t\tonReactionClick(reaction: string)\n\t\t{\n\t\t\tconst permissionManager = PermissionManager.getInstance();\n\t\t\tif (!permissionManager.canPerformActionByRole(ActionByRole.setReaction, this.dialog.dialogId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.ownReactions.has(reaction))\n\t\t\t{\n\t\t\t\tthis.getReactionService().removeReaction(this.messageId, reaction);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.reactionsToAnimate.add(reaction);\n\t\t\tthis.getReactionService().setReaction(this.messageId, reaction);\n\t\t},\n\t\tasync onPickerReactionSelected(event: BaseEvent<{ messageId: number, reaction: string }>)\n\t\t{\n\t\t\tconst { messageId, reaction } = event.getData();\n\t\t\tif (this.messageId !== messageId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.onReactionClick(reaction);\n\t\t},\n\t\tgetReactionUsers(reaction: string): number[]\n\t\t{\n\t\t\tconst users = this.reactionsData.reactionUsers[reaction];\n\t\t\tif (!users)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn [...users];\n\t\t},\n\t\tgetReactionService(): ReactionService\n\t\t{\n\t\t\tif (!this.reactionService)\n\t\t\t{\n\t\t\t\tthis.reactionService = new ReactionService();\n\t\t\t}\n\n\t\t\treturn this.reactionService;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"needToShowReactionsContainer\" class=\"bx-im-reaction-list__container bx-im-reaction-list__scope\">\n\t\t\t<ReactionItem\n\t\t\t\tv-for=\"reactionType in reactionListToShow\"\n\t\t\t\t:key=\"reactionType + messageId\"\n\t\t\t\t:messageId=\"messageId\"\n\t\t\t\t:type=\"reactionType\"\n\t\t\t\t:counter=\"reactionCounters[reactionType]\"\n\t\t\t\t:users=\"getReactionUsers(reactionType)\"\n\t\t\t\t:selected=\"ownReactions.has(reactionType)\"\n\t\t\t\t:animate=\"reactionsToAnimate.has(reactionType)\"\n\t\t\t\t:showAvatars=\"showAvatars\"\n\t\t\t\t@click=\"onReactionClick(reactionType)\"\n\t\t\t\t@animationFinish=\"reactionsToAnimate.delete(reactionType)\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { ReactionsSelect } from 'ui.reactions-select';\nimport { ReactionPicker as ReactionsSelectV2 } from 'ui.reaction.picker';\nimport { ReactionName } from 'ui.reaction.item';\n\nimport { ActionByRole, UserType, EventType } from 'im.v2.const';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { FeatureManager, Feature } from 'im.v2.lib.feature';\n\nimport './selector.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat, ImModelMessage, ImModelReactions, ImModelUser, ImModelBot } from 'im.v2.model';\n\nconst SHOW_DELAY = 250;\nconst HIDE_DELAY = 500;\n\n// @vue/component\nexport const ReactionSelector = {\n\tname: 'ReactionSelector',\n\tprops:\n\t{\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.messageId);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/getByChatId'](this.message.chatId);\n\t\t},\n\t\treactionsData(): ?ImModelReactions\n\t\t{\n\t\t\treturn this.$store.getters['messages/reactions/getByMessageId'](this.messageId);\n\t\t},\n\t\townReactions(): Set<string>\n\t\t{\n\t\t\treturn this.reactionsData?.ownReactions ?? new Set();\n\t\t},\n\t\townPlainLikeSet(): boolean\n\t\t{\n\t\t\treturn this.ownReactions.has(ReactionName.like);\n\t\t},\n\t\tisChatWithBot(): boolean\n\t\t{\n\t\t\tconst user: ImModelUser = this.$store.getters['users/get'](this.dialog.dialogId);\n\n\t\t\treturn user?.type === UserType.bot;\n\t\t},\n\t\tareBotReactionsEnabled(): boolean\n\t\t{\n\t\t\tconst bot: ImModelBot = this.$store.getters['users/bots/getByUserId'](this.message.authorId);\n\t\t\tif (!bot)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn bot.reactionsEnabled;\n\t\t},\n\t\thasError(): boolean\n\t\t{\n\t\t\treturn this.message.error;\n\t\t},\n\t\tisRealMessage(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/isRealMessage'](this.messageId);\n\t\t},\n\t\tcanSetReactions(): boolean\n\t\t{\n\t\t\tif (!this.isRealMessage || !this.canSetReactionsByRole || this.hasError)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (this.isChatWithBot)\n\t\t\t{\n\t\t\t\treturn this.areBotReactionsEnabled;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tcanSetReactionsByRole(): boolean\n\t\t{\n\t\t\tconst permissionManager = PermissionManager.getInstance();\n\n\t\t\treturn permissionManager.canPerformActionByRole(ActionByRole.setReaction, this.dialog.dialogId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tstartShowTimer()\n\t\t{\n\t\t\tthis.clearHideTimer();\n\t\t\tif (this.selector?.isShown())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.showTimeout = setTimeout(() => {\n\t\t\t\tthis.showSelector();\n\t\t\t}, SHOW_DELAY);\n\t\t},\n\t\tclearShowTimer()\n\t\t{\n\t\t\tclearTimeout(this.showTimeout);\n\t\t\tthis.startHideTimer();\n\t\t},\n\t\tshowSelector()\n\t\t{\n\t\t\tif (FeatureManager.isFeatureAvailable(Feature.reactionsV2Available))\n\t\t\t{\n\t\t\t\tthis.selector = new ReactionsSelectV2({ target: this.$refs.selector });\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.selector = new ReactionsSelect({\n\t\t\t\t\tname: 'im-base-message-reaction-selector',\n\t\t\t\t\tposition: this.$refs.selector,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.subscribeToSelectorEvents();\n\t\t\tthis.selector.show();\n\t\t},\n\t\tsubscribeToSelectorEvents()\n\t\t{\n\t\t\tthis.selector.subscribe('select', (selectEvent) => {\n\t\t\t\tconst { reaction } = selectEvent.getData();\n\t\t\t\tthis.getEmitter().emit(EventType.reaction.onReactionSelected, {\n\t\t\t\t\tmessageId: this.messageId,\n\t\t\t\t\treaction,\n\t\t\t\t});\n\t\t\t\tthis.selector?.hide();\n\t\t\t});\n\n\t\t\tthis.selector.subscribe('mouseleave', this.startHideTimer);\n\n\t\t\tthis.selector.subscribe('mouseenter', () => {\n\t\t\t\tclearTimeout(this.hideTimeout);\n\t\t\t});\n\n\t\t\tthis.selector.subscribe('hide', () => {\n\t\t\t\tclearTimeout(this.hideTimeout);\n\t\t\t\tthis.selector = null;\n\t\t\t});\n\t\t},\n\t\tstartHideTimer()\n\t\t{\n\t\t\tthis.hideTimeout = setTimeout(() => {\n\t\t\t\tthis.selector?.hide();\n\t\t\t}, HIDE_DELAY);\n\t\t},\n\t\tclearHideTimer()\n\t\t{\n\t\t\tclearTimeout(this.hideTimeout);\n\t\t},\n\t\tonIconClick()\n\t\t{\n\t\t\tthis.clearShowTimer();\n\t\t\tthis.getEmitter().emit(EventType.reaction.onReactionSelected, {\n\t\t\t\tmessageId: this.messageId,\n\t\t\t\treaction: ReactionName.like,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"canSetReactions\" class=\"bx-im-reaction-selector__container\">\n\t\t\t<div\n\t\t\t\t@click=\"onIconClick\"\n\t\t\t\t@mouseenter=\"startShowTimer\"\n\t\t\t\t@mouseleave=\"clearShowTimer\"\n\t\t\t\tclass=\"bx-im-reaction-selector__selector\"\n\t\t\t\tref=\"selector\"\n\t\t\t>\n\t\t\t\t<div class=\"bx-im-reaction-selector__icon\" :class=\"{'--active': ownPlainLikeSet}\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\n\nimport { Parser } from 'im.v2.lib.parser';\n\nimport type { ImModelChat, ImModelMessage, ImModelUser } from 'im.v2.model';\n\nconst NO_CONTEXT_TAG = 'none';\n\n// @vue/component\nexport const Reply = {\n\tname: 'ReplyComponent',\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\treplyId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tisForward: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\treplyMessage(): ?ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.replyId);\n\t\t},\n\t\treplyMessageChat(): ?ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/getByChatId'](this.replyMessage?.chatId);\n\t\t},\n\t\treplyAuthor(): ?ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.replyMessage.authorId);\n\t\t},\n\t\treplyTitle(): string\n\t\t{\n\t\t\treturn this.replyAuthor ? this.replyAuthor.name : this.loc('IM_DIALOG_CHAT_QUOTE_DEFAULT_TITLE');\n\t\t},\n\t\treplyText(): string\n\t\t{\n\t\t\tlet text = Parser.prepareQuote(this.replyMessage);\n\t\t\ttext = Parser.decodeText(text);\n\n\t\t\treturn text;\n\t\t},\n\t\tisQuoteFromTheSameChat(): boolean\n\t\t{\n\t\t\treturn this.replyMessage?.chatId === this.dialog.chatId;\n\t\t},\n\t\treplyContext(): string\n\t\t{\n\t\t\tif (!this.isQuoteFromTheSameChat)\n\t\t\t{\n\t\t\t\treturn NO_CONTEXT_TAG;\n\t\t\t}\n\n\t\t\tif (!this.isForward)\n\t\t\t{\n\t\t\t\treturn `${this.dialogId}/${this.replyId}`;\n\t\t\t}\n\n\t\t\treturn `${this.replyMessageChat.dialogId}/${this.replyId}`;\n\t\t},\n\t\tcanShowReply(): boolean\n\t\t{\n\t\t\treturn !Type.isNil(this.replyMessage);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"canShowReply\" class=\"bx-im-message-quote\" :data-context=\"replyContext\">\n\t\t\t<div class=\"bx-im-message-quote__wrap\">\n\t\t\t\t<div class=\"bx-im-message-quote__name\">\n\t\t\t\t\t<div class=\"bx-im-message-quote__name-text\">{{ replyTitle }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-message-quote__text\" v-html=\"replyText\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\nimport { EventType, ChatType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport { MessageAuthorTitle } from 'im.v2.component.elements.chat-title';\n\nimport './author-title.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelMessage, ImModelUser, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const AuthorTitle = {\n\tname: 'AuthorTitle',\n\tcomponents: { MessageAuthorTitle },\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/getByChatId'](this.message.chatId);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.message.authorId, true);\n\t\t},\n\t\tisSystemMessage(): boolean\n\t\t{\n\t\t\treturn this.message.authorId === 0;\n\t\t},\n\t\tisSelfMessage(): boolean\n\t\t{\n\t\t\treturn this.message.authorId === Core.getUserId();\n\t\t},\n\t\tisUserChat(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user && !this.isBotWithFakeAuthorNames;\n\t\t},\n\t\tisBotWithFakeAuthorNames(): boolean\n\t\t{\n\t\t\treturn this.isSupportBot || this.isNetworkBot;\n\t\t},\n\t\tisNetworkBot(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['users/bots/isNetwork'](this.dialog.dialogId);\n\t\t},\n\t\tisSupportBot(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['users/bots/isSupport'](this.dialog.dialogId);\n\t\t},\n\t\tshowTitle(): boolean\n\t\t{\n\t\t\treturn !this.isSystemMessage && !this.isSelfMessage && !this.isUserChat;\n\t\t},\n\t\tauthorDialogId(): string\n\t\t{\n\t\t\tif (this.message.authorId)\n\t\t\t{\n\t\t\t\treturn this.message.authorId.toString();\n\t\t\t}\n\n\t\t\treturn this.dialogId;\n\t\t},\n\t\tisCopilot(): boolean\n\t\t{\n\t\t\tconst authorId = Number.parseInt(this.authorDialogId, 10);\n\n\t\t\treturn this.$store.getters['users/bots/isCopilot'](authorId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonAuthorNameClick()\n\t\t{\n\t\t\tconst authorId = Number.parseInt(this.authorDialogId, 10);\n\t\t\tif (\n\t\t\t\t!authorId\n\t\t\t\t|| authorId === Core.getUserId()\n\t\t\t\t|| this.isCopilot\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getEmitter().emit(EventType.textarea.insertMention, {\n\t\t\t\tmentionText: this.user.name,\n\t\t\t\tmentionReplacement: Utils.text.getMentionBbCode(this.user.id, this.user.name),\n\t\t\t\tdialogId: this.dialog.dialogId,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tv-if=\"showTitle\" \n\t\t\t@click=\"onAuthorNameClick\" \n\t\t\tclass=\"bx-im-message-author-title__container\" \n\t\t\t:class=\"{'--clickable': !isCopilot}\"\n\t\t>\n\t\t\t<MessageAuthorTitle\n\t\t\t\t:dialogId=\"authorDialogId\"\n\t\t\t\t:messageId=\"message.id\"\n\t\t\t\t:showItsYou=\"false\"\n\t\t\t\t:withColor=\"true\"\n\t\t\t\t:withLeftIcon=\"!isCopilot\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { EventType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport './context-menu.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const ContextMenu = {\n\tname: 'ContextMenu',\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tshowContextMenu: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmenuTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(\n\t\t\t\t'IM_MESSENGER_MESSAGE_MENU_TITLE',\n\t\t\t\t{ '#SHORTCUT#': Utils.platform.isMac() ? 'CMD' : 'CTRL' },\n\t\t\t);\n\t\t},\n\t\tmessageItem(): ImModelMessage\n\t\t{\n\t\t\treturn this.message;\n\t\t},\n\t\tmessageHasError(): boolean\n\t\t{\n\t\t\treturn this.messageItem.error;\n\t\t},\n\t\tcanShowContextMenu(): boolean\n\t\t{\n\t\t\treturn this.showContextMenu && !this.messageHasError;\n\t\t},\n\t\tisBulkActionsMode(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/select/isBulkActionsModeActive'](this.dialogId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonMenuClick(event: PointerEvent)\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.dialog.onClickMessageContextMenu, {\n\t\t\t\tmessage: this.message,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tbindElement: event.currentTarget,\n\t\t\t\tevent,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<template v-if=\"!isBulkActionsMode\">\n\t\t\t<div v-if=\"canShowContextMenu\" class=\"bx-im-message-context-menu__container bx-im-message-context-menu__scope\">\n\t\t\t\t<button\n\t\t\t\t\t:title=\"menuTitle\"\n\t\t\t\t\t@click=\"onMenuClick\"\n\t\t\t\t\t@contextmenu.prevent\n\t\t\t\t\tclass=\"bx-im-message-context-menu__button\"\n\t\t\t\t></button>\n\t\t\t</div>\n\t\t\t<div v-else class=\"bx-im-message-base__context-menu-placeholder\"></div>\n\t\t</template>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { BaseMenu } from 'im.v2.lib.menu';\nimport { SendingService } from 'im.v2.provider.service.sending';\nimport { MessageService } from 'im.v2.provider.service.message';\nimport { UploadingService } from 'im.v2.provider.service.uploading';\nimport { MenuItemDesign } from 'ui.system.menu';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\nimport type { ImModelMessage } from 'im.v2.model';\n\nexport class RetryContextMenu extends BaseMenu\n{\n\tcontext: ImModelMessage & {dialogId: string};\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'bx-im-message-retry-context-menu';\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\treturn [\n\t\t\tthis.getRetryItem(),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\t}\n\n\tgetRetryItem(): MenuItemOptions\n\t{\n\t\tif (!this.#isOwnMessage() || !this.#hasError())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_MESSENGER_MESSAGE_CONTEXT_MENU_RETRY'),\n\t\t\tonClick: () => {\n\t\t\t\tthis.#retrySend();\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetDeleteItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.#isOwnMessage() || !this.#hasError())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_MESSENGER_MESSAGE_CONTEXT_MENU_DELETE'),\n\t\t\tdesign: MenuItemDesign.Alert,\n\t\t\tonClick: () => {\n\t\t\t\tconst messageService = new MessageService({ chatId: this.context.chatId });\n\t\t\t\tmessageService.deleteMessages([this.context.id]);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\t#isOwnMessage(): boolean\n\t{\n\t\treturn this.context.authorId === Core.getUserId();\n\t}\n\n\t#hasError(): boolean\n\t{\n\t\treturn this.context.error;\n\t}\n\n\t#hasFiles(): boolean\n\t{\n\t\treturn this.context.files.length > 0;\n\t}\n\n\t#retrySend()\n\t{\n\t\tif (this.#hasFiles())\n\t\t{\n\t\t\tconst uploadingService: UploadingService = UploadingService.getInstance();\n\t\t\tconst uploaderId: string = uploadingService.getUploaderIdByFileId(this.context.files[0]);\n\n\t\t\tuploadingService.retry(uploaderId);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#retrySendMessage();\n\t}\n\n\t#retrySendMessage()\n\t{\n\t\tvoid (new SendingService()).retrySendMessage({\n\t\t\ttempMessageId: this.context.id,\n\t\t\tdialogId: this.context.dialogId,\n\t\t});\n\t}\n}\n","import { RetryContextMenu } from './classes/retry-context-menu';\n\nimport './retry-button.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const RetryButton = {\n\tname: 'RetryButton',\n\tprops:\n\t{\n\t\tmessage: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessageItem(): ImModelMessage\n\t\t{\n\t\t\treturn this.message;\n\t\t},\n\t\tmenuTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_MESSENGER_MESSAGE_CONTEXT_MENU_RETRY');\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new RetryContextMenu();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tconst context = { dialogId: this.dialogId, ...this.messageItem };\n\t\t\tthis.contextMenu.openMenu(context, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-retry-button__container bx-im-message-retry-button__scope\">\n\t\t\t<button\n\t\t\t\t:title=\"menuTitle\"\n\t\t\t\t@click=\"onClick\"\n\t\t\t\tclass=\"bx-im-message-retry-button__arrow\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import { BIcon, Outline as OutlineIcons } from 'ui.icon-set.api.vue';\nimport { Text, Loc } from 'main.core';\n\nimport { EventType, Color } from 'im.v2.const';\nimport { Parser } from 'im.v2.lib.parser';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { ChannelManager } from 'im.v2.lib.channel';\n\nimport { AuthorTitle } from '../author-title/author-title';\n\nimport './message-header.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelMessage } from 'im.v2.model';\n\nconst FORWARD_ICON_SIZE = 20;\n\n// @vue/component\nexport const MessageHeader = {\n\tname: 'MessageHeader',\n\tcomponents: { AuthorTitle, BIcon },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\twithTitle: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisOverlay: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed: {\n\t\tOutlineIcons: () => OutlineIcons,\n\t\tColor: () => Color,\n\t\tFORWARD_ICON_SIZE: () => FORWARD_ICON_SIZE,\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tforwardAuthorId(): number\n\t\t{\n\t\t\treturn this.message.forward.userId;\n\t\t},\n\t\tforwardContextId(): string\n\t\t{\n\t\t\treturn this.message.forward.id;\n\t\t},\n\t\tisForwarded(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/isForward'](this.message.id);\n\t\t},\n\t\tisChannelForward(): boolean\n\t\t{\n\t\t\treturn ChannelManager.channelTypes.has(this.message.forward.chatType);\n\t\t},\n\t\tforwardAuthorName(): string\n\t\t{\n\t\t\tconst copilotManager = new CopilotManager();\n\t\t\tif (copilotManager.isCopilotBot(this.forwardAuthorId))\n\t\t\t{\n\t\t\t\tconst forwardMessageId = this.forwardContextId.split('/')[1];\n\n\t\t\t\treturn copilotManager.getName({\n\t\t\t\t\tdialogId: this.forwardAuthorId,\n\t\t\t\t\tmessageId: forwardMessageId,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.$store.getters['users/get'](this.forwardAuthorId, true).name;\n\t\t},\n\t\tforwardChatName(): string\n\t\t{\n\t\t\treturn this.message.forward.chatTitle ?? this.loc('IM_MESSENGER_MESSAGE_HEADER_FORWARDED_CLOSED_CHANNEL');\n\t\t},\n\t\tisSystemMessage(): boolean\n\t\t{\n\t\t\treturn this.message.forward.userId === 0;\n\t\t},\n\t\tforwardAuthorTitle(): string\n\t\t{\n\t\t\treturn Loc.getMessage('IM_MESSENGER_MESSAGE_HEADER_FORWARDED_FROM_CHAT', {\n\t\t\t\t'[user_name]': '<span class=\"bx-im-message-header__author-name\">',\n\t\t\t\t'#USER_NAME#': Text.encode(this.forwardAuthorName),\n\t\t\t\t'[/user_name]': '</span>',\n\t\t\t});\n\t\t},\n\t\tforwardChannelTitle(): string\n\t\t{\n\t\t\treturn Loc.getMessage('IM_MESSENGER_MESSAGE_HEADER_FORWARDED_FROM_CHANNEL', {\n\t\t\t\t'[user_name]': '<span class=\"bx-im-message-header__author-name\">',\n\t\t\t\t'#USER_NAME#': Text.encode(this.forwardAuthorName),\n\t\t\t\t'[/user_name]': '</span>',\n\t\t\t\t'[channel_name]': '<span class=\"bx-im-message-header__author-name\">',\n\t\t\t\t'#CHANNEL_NAME#': Text.encode(this.forwardChatName),\n\t\t\t\t'[/channel_name]': '</span>',\n\t\t\t});\n\t\t},\n\t\ticonColor(): string\n\t\t{\n\t\t\treturn this.isOverlay ? Color.white : Color.blue60;\n\t\t},\n\t},\n\tmethods: {\n\t\tonForwardClick()\n\t\t{\n\t\t\tconst contextCode = Parser.getContextCodeFromForwardId(this.forwardContextId);\n\t\t\tif (contextCode.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst [dialogId, messageId] = contextCode.split('/');\n\n\t\t\tthis.getEmitter().emit(EventType.dialog.goToMessageContext, {\n\t\t\t\tmessageId: Number.parseInt(messageId, 10),\n\t\t\t\tdialogId: dialogId.toString(),\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tv-if=\"isForwarded\" \n\t\t\t:class=\"{'--overlay': isOverlay}\"\n\t\t\tclass=\"bx-im-message-header__container\" \n\t\t\t@click=\"onForwardClick\"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\t:name=\"OutlineIcons.FORWARD\"\n\t\t\t\t:color=\"iconColor\"\n\t\t\t\t:size=\"FORWARD_ICON_SIZE\"\n\t\t\t/>\n\t\t\t<span v-if=\"isSystemMessage\" class=\"--ellipsis\">\n\t\t\t\t{{ loc('IM_MESSENGER_MESSAGE_HEADER_FORWARDED_FROM_SYSTEM')}}\n\t\t\t</span>\n\t\t\t<span v-else-if=\"isChannelForward\" v-html=\"forwardChannelTitle\" class=\"--ellipsis\"></span>\n\t\t\t<span v-else v-html=\"forwardAuthorTitle\" class=\"--ellipsis\"></span>\n\t\t</div>\n\t\t<AuthorTitle v-else-if=\"withTitle\" :item=\"item\" />\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { EventType, ActionByRole } from 'im.v2.const';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { FadeAnimation } from 'im.v2.component.animation';\nimport { CommentsService } from 'im.v2.provider.service.comments';\n\nimport './css/comments-panel.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat, ImModelCommentInfo, ImModelMessage, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const CommentsPanel = {\n\tname: 'CommentsPanel',\n\tcomponents: { ChatAvatar, FadeAnimation },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tAvatarSize: () => AvatarSize,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId);\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tcommentInfo(): ImModelCommentInfo\n\t\t{\n\t\t\treturn this.$store.getters['messages/comments/getByMessageId'](this.message.id);\n\t\t},\n\t\tcommentsChatId(): number\n\t\t{\n\t\t\treturn this.commentInfo.chatId;\n\t\t},\n\t\tcommentsCount(): number\n\t\t{\n\t\t\t// remove first system message from count\n\t\t\tif (this.commentInfo.messageCount > 0)\n\t\t\t{\n\t\t\t\treturn this.commentInfo.messageCount - 1;\n\t\t\t}\n\n\t\t\treturn this.commentInfo.messageCount;\n\t\t},\n\t\tcommentsCountText(): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural('IM_MESSAGE_COMMENTS_PANEL_COMMENT_COUNT', this.commentsCount, {\n\t\t\t\t'#COUNT#': this.commentsCount,\n\t\t\t});\n\t\t},\n\t\tnoComments(): boolean\n\t\t{\n\t\t\treturn this.commentsCount === 0;\n\t\t},\n\t\tlastUsers(): ImModelUser[]\n\t\t{\n\t\t\treturn [...this.commentInfo.lastUserIds].map((userId) => {\n\t\t\t\treturn this.$store.getters['users/get'](userId);\n\t\t\t}).reverse();\n\t\t},\n\t\tunreadCount(): string\n\t\t{\n\t\t\tconst counter = this.$store.getters['counters/getSpecificCommentsCounter']({\n\t\t\t\tchannelId: this.dialog.chatId,\n\t\t\t\tcommentChatId: this.commentsChatId,\n\t\t\t});\n\n\t\t\tif (!counter)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn `+${counter}`;\n\t\t},\n\t\tisSubscribed(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/comments/isUserSubscribed'](this.message.id);\n\t\t},\n\t\tshowSubscribeIcon(): boolean\n\t\t{\n\t\t\tconst permissionManager = PermissionManager.getInstance();\n\n\t\t\treturn permissionManager.canPerformActionByRole(ActionByRole.subscribeToComments, this.dialogId);\n\t\t},\n\t\tsubscribeIconTitle(): string\n\t\t{\n\t\t\tif (this.isSubscribed)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_MESSAGE_COMMENTS_PANEL_ICON_UNSUBSCRIBE');\n\t\t\t}\n\n\t\t\treturn this.loc('IM_MESSAGE_COMMENTS_PANEL_ICON_SUBSCRIBE');\n\t\t},\n\t},\n\tmethods: {\n\t\tonCommentsClick()\n\t\t{\n\t\t\tconst permissionManager = PermissionManager.getInstance();\n\t\t\tif (!permissionManager.canPerformActionByRole(ActionByRole.openComments, this.dialogId))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getEmitter().emit(EventType.dialog.openComments, { messageId: this.message.id });\n\t\t},\n\t\tonSubscribeIconClick()\n\t\t{\n\t\t\tif (this.isSubscribed)\n\t\t\t{\n\t\t\t\tCommentsService.unsubscribe(this.message.id);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tCommentsService.subscribe(this.message.id);\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<slot :totalCount=\"commentsCount\" :unreadCount=\"unreadCount\" :onCommentsClick=\"onCommentsClick\">\n\t\t\t<div class=\"bx-im-message-comments-panel__container\" @click=\"onCommentsClick\">\n\t\t\t\t<div class=\"bx-im-message-comments-panel__left\">\n\t\t\t\t\t<div v-if=\"noComments\" class=\"bx-im-message-comments-panel__empty_container\">\n\t\t\t\t\t\t<div class=\"bx-im-message-comments-panel__empty_icon\"></div>\n\t\t\t\t\t\t<div class=\"bx-im-message-comments-panel__text\">{{ loc('IM_MESSAGE_COMMENTS_PANEL_EMPTY_TEXT') }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else class=\"bx-im-message-comments-panel__meta_container\">\n\t\t\t\t\t\t<div class=\"bx-im-message-comments-panel__user_container\">\n\t\t\t\t\t\t\t<TransitionGroup name=\"bx-im-message-comments-panel__user_animation\">\n\t\t\t\t\t\t\t\t<div v-for=\"(user, index) in lastUsers\" :key=\"user.id\" class=\"bx-im-message-comments-panel__user_avatar\" :class=\"'--image-' + (index + 1)\">\n\t\t\t\t\t\t\t\t\t<ChatAvatar\n\t\t\t\t\t\t\t\t\t\t:avatarDialogId=\"user.id\"\n\t\t\t\t\t\t\t\t\t\t:contextDialogId=\"dialogId\"\n\t\t\t\t\t\t\t\t\t\t:size=\"AvatarSize.S\"\n\t\t\t\t\t\t\t\t\t\t:withTooltip=\"false\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</TransitionGroup>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"bx-im-message-comments-panel__text\">{{ commentsCountText }}</div>\n\t\t\t\t\t\t<FadeAnimation :duration=\"200\">\n\t\t\t\t\t\t\t<div v-if=\"unreadCount\" class=\"bx-im-message-comments-panel__unread-counter\">{{ unreadCount }}</div>\n\t\t\t\t\t\t</FadeAnimation>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"showSubscribeIcon\" :title=\"subscribeIconTitle\" class=\"bx-im-message-comments-panel__right\">\n\t\t\t\t\t<div\n\t\t\t\t\t\t@click.stop=\"onSubscribeIconClick\"\n\t\t\t\t\t\tclass=\"bx-im-message-comments-panel__subscribe-icon\"\n\t\t\t\t\t\t:class=\"{'--active': isSubscribed}\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</slot>\n\t`,\n};\n","import { ChannelManager } from 'im.v2.lib.channel';\n\nimport { CommentsPanel } from '../comments-panel/comments-panel';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const MessageFooter = {\n\tname: 'MessageFooter',\n\tcomponents: { CommentsPanel },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {};\n\t},\n\tcomputed: {\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId);\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tisChannelPost(): boolean\n\t\t{\n\t\t\treturn ChannelManager.isChannel(this.dialogId);\n\t\t},\n\t\tisSystemMessage(): boolean\n\t\t{\n\t\t\treturn this.message.authorId === 0;\n\t\t},\n\t\tshowCommentsPanel(): boolean\n\t\t{\n\t\t\treturn this.isChannelPost && !this.isSystemMessage;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<CommentsPanel v-if=\"showCommentsPanel\" :dialogId=\"dialogId\" :item=\"item\" />\n\t`,\n};\n","import { Type } from 'main.core';\n\nimport { Parser } from 'im.v2.lib.parser';\n\nimport { Reply, MessageAttach, MessageStatus, ReactionList } from '../registry';\n\nimport './default-message-content.css';\n\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const DefaultMessageContent = {\n\tname: 'DefaultMessageContent',\n\tcomponents: {\n\t\tMessageStatus,\n\t\tMessageAttach,\n\t\tReactionList,\n\t\tReply,\n\t},\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\twithMessageStatus: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\twithText: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\twithAttach: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tisReply(): boolean\n\t\t{\n\t\t\treturn this.message.replyId !== 0;\n\t\t},\n\t\tformattedText(): string\n\t\t{\n\t\t\treturn Parser.decodeMessage(this.item);\n\t\t},\n\t\tcanSetReactions(): boolean\n\t\t{\n\t\t\treturn Type.isNumber(this.message.id);\n\t\t},\n\t\tisForward(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['messages/isForward'](this.message.id);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-default-content__container bx-im-message-default-content__scope\" :class=\"{'--no-text': !withText}\">\n\t\t\t<Reply v-if=\"isReply\" :dialogId=\"dialogId\" :replyId=\"message.replyId\" :isForward=\"isForward\" />\n\t\t\t<div v-if=\"withText\" class=\"bx-im-message-default-content__text\" v-html=\"formattedText\"></div>\n\t\t\t<div v-if=\"withAttach && message.attach.length > 0\" class=\"bx-im-message-default-content__attach\">\n\t\t\t\t<MessageAttach :item=\"message\" :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-message-default-content__bottom-panel\">\n\t\t\t\t<ReactionList \n\t\t\t\t\tv-if=\"canSetReactions\" \n\t\t\t\t\t:messageId=\"message.id\" \n\t\t\t\t\tclass=\"bx-im-message-default-content__reaction-list\" \n\t\t\t\t/>\n\t\t\t\t<div v-if=\"withMessageStatus\" class=\"bx-im-message-default-content__status-container\">\n\t\t\t\t\t<MessageStatus :item=\"message\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\n\nimport { ChannelManager } from 'im.v2.lib.channel';\n\nimport { CommentsPanel } from './comments-panel';\n\nimport './css/compact-comments-panel.css';\n\nimport type { ImModelChat, ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const CompactCommentsPanel = {\n\tname: 'CompactCommentsPanel',\n\tcomponents: { CommentsPanel },\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId);\n\t\t},\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tisChannelPost(): boolean\n\t\t{\n\t\t\treturn ChannelManager.isChannel(this.dialogId);\n\t\t},\n\t\tisSystemMessage(): boolean\n\t\t{\n\t\t\treturn this.message.authorId === 0;\n\t\t},\n\t\tshowCommentsPanel(): boolean\n\t\t{\n\t\t\treturn this.isChannelPost && !this.isSystemMessage;\n\t\t},\n\t},\n\tmethods: {\n\t\thasComments(totalCount: number): boolean\n\t\t{\n\t\t\treturn totalCount > 0;\n\t\t},\n\t\thasUnreadComments(unreadCount: string): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(unreadCount);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<CommentsPanel \n\t\t\tv-if=\"showCommentsPanel\"\n\t\t\tv-slot=\"{ onCommentsClick, totalCount, unreadCount }\"\n\t\t\t:item=\"item\"\n\t\t\t:dialogId=\"dialogId\"\n\t\t>\n\t\t\t<div \n\t\t\t\t:class=\"{'--has-comments': hasComments(totalCount)}\"\n\t\t\t\tclass=\"bx-im-message-compact-comments-panel__container\"\n\t\t\t\t@click=\"onCommentsClick\"\n\t\t\t>\n\t\t\t\t<div class=\"bx-im-message-compact-comments-panel__icon\"></div>\n\t\t\t\t<div v-if=\"hasComments(totalCount)\" class=\"bx-im-message-compact-comments-panel__counter-container\">\n\t\t\t\t\t<div class=\"bx-im-message-compact-comments-panel__total-counter\">\n\t\t\t\t\t\t{{ totalCount }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if=\"hasUnreadComments(unreadCount)\" class=\"bx-im-message-compact-comments-panel__unread-counter\">\n\t\t\t\t\t\t{{ unreadCount }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</CommentsPanel>\n\t`,\n};\n"],"names":["MessageStatus","name","props","item","type","Object","required","isOverlay","Boolean","default","computed","message","formattedDate","DateFormatter","formatByCode","date","DateCode","shortTimeFormat","isSelfMessage","authorId","Core","getUserId","messageStatus","error","StatusType","sending","viewedByOthers","viewed","sent","methods","loc","phraseCode","$Bitrix","Loc","getMessage","template","MessageAttach","components","Attach","dialogId","String","dialog","$store","getters","user","dialogColor","ChatType","color","created","provide","MessageKeyboard","Keyboard","ReactionUser","ChatAvatar","userId","Number","AvatarSize","avatarStyle","avatar","backgroundImage","UserService","BaseUserService","constructor","reaction","getRequestFilter","firstPage","getRestMethodName","RestMethod","imV2ChatMessageReactionTail","getLastId","result","reactions","length","sortedReactions","sort","a","b","id","AdditionalUsers","UserListPopup","messageId","show","bindElement","emits","data","showPopup","loadingAdditionalUsers","additionalUsers","watch","newValue","oldValue","loadUsers","getUserService","loadFirstPage","onScroll","event","Utils","dom","isOneScreenRemaining","target","hasMoreItemsToLoad","userIds","loadNextPage","onPopupClose","$emit","prepareAdditionalUsers","firstViewerId","lastMessageViews","firstViewer","filter","userService","USERS_TO_SHOW","REACTION_SIZE","SHOW_USERS_DELAY","ReactionItem","Reaction","counter","users","Array","selected","animate","showAvatars","showAdditionalUsers","needToShowUsers","userLimitIsNotReached","weHaveUsersData","preparedUsers","startShowUsersTimer","showUsersTimeout","setTimeout","clearShowUsersTimer","clearTimeout","onClick","ReactionService","setReaction","Logger","warn","payload","canSetMultipleReactions","FeatureManager","isFeatureAvailable","Feature","reactionsV2Available","getStore","dispatch","withReplace","runAction","imV2ChatMessageReactionAdd","catch","console","removeReaction","imV2ChatMessageReactionDelete","ReactionList","reactionsToAnimate","Set","chatId","reactionsData","reactionCounters","ownReactions","reactionListToShow","keys","ReactionName","needToShowReactionsContainer","isChannel","ChannelManager","newCounters","oldCounters","newReactions","oldReactions","includes","add","EventEmitter","emit","EventType","scrollToBottom","threshold","DialogScrollThreshold","nearTheBottom","animation","mounted","MAX_LISTENERS","getEmitter","setMaxListeners","onReactionSelected","subscribe","onPickerReactionSelected","beforeUnmount","unsubscribe","onReactionClick","permissionManager","PermissionManager","getInstance","canPerformActionByRole","ActionByRole","has","getReactionService","getData","getReactionUsers","reactionUsers","reactionService","eventEmitter","SHOW_DELAY","HIDE_DELAY","ReactionSelector","ownPlainLikeSet","like","isChatWithBot","UserType","bot","areBotReactionsEnabled","reactionsEnabled","hasError","isRealMessage","canSetReactions","canSetReactionsByRole","startShowTimer","clearHideTimer","selector","isShown","showTimeout","showSelector","clearShowTimer","startHideTimer","ReactionsSelectV2","$refs","ReactionsSelect","position","subscribeToSelectorEvents","selectEvent","hide","hideTimeout","onIconClick","NO_CONTEXT_TAG","Reply","replyId","isForward","replyMessage","replyMessageChat","replyAuthor","replyTitle","replyText","text","Parser","prepareQuote","decodeText","isQuoteFromTheSameChat","replyContext","canShowReply","Type","isNil","AuthorTitle","MessageAuthorTitle","isSystemMessage","isUserChat","isBotWithFakeAuthorNames","isSupportBot","isNetworkBot","showTitle","authorDialogId","toString","isCopilot","parseInt","onAuthorNameClick","textarea","insertMention","mentionText","mentionReplacement","getMentionBbCode","ContextMenu","showContextMenu","menuTitle","platform","isMac","messageItem","messageHasError","canShowContextMenu","isBulkActionsMode","onMenuClick","onClickMessageContextMenu","currentTarget","RetryContextMenu","BaseMenu","getMenuItems","getRetryItem","getDeleteItem","title","menuInstance","close","design","MenuItemDesign","Alert","messageService","MessageService","context","deleteMessages","files","uploadingService","UploadingService","uploaderId","getUploaderIdByFileId","retry","SendingService","retrySendMessage","tempMessageId","RetryButton","contextMenu","openMenu","FORWARD_ICON_SIZE","MessageHeader","BIcon","withTitle","OutlineIcons","Color","forwardAuthorId","forward","forwardContextId","isForwarded","isChannelForward","channelTypes","chatType","forwardAuthorName","copilotManager","CopilotManager","isCopilotBot","forwardMessageId","split","getName","forwardChatName","chatTitle","forwardAuthorTitle","Text","encode","forwardChannelTitle","iconColor","white","blue60","onForwardClick","contextCode","getContextCodeFromForwardId","goToMessageContext","CommentsPanel","FadeAnimation","commentInfo","commentsChatId","commentsCount","messageCount","commentsCountText","getMessagePlural","noComments","lastUsers","lastUserIds","map","reverse","unreadCount","channelId","commentChatId","isSubscribed","showSubscribeIcon","subscribeToComments","subscribeIconTitle","onCommentsClick","openComments","onSubscribeIconClick","CommentsService","MessageFooter","isChannelPost","showCommentsPanel","DefaultMessageContent","withMessageStatus","withText","withAttach","isReply","formattedText","decodeMessage","isNumber","CompactCommentsPanel","hasComments","totalCount","hasUnreadComments","isStringFilled"],"mappings":"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"}