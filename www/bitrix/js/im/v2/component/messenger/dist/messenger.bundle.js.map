{"version":3,"file":"messenger.bundle.js","sources":["../src/config/component-map.js","../src/components/desktop-overlay.js","../src/messenger.js"],"sourcesContent":["import { Layout } from 'im.v2.const';\nimport { ChatContent } from 'im.v2.component.content.chat';\nimport { CreateChatContent, UpdateChatContent } from 'im.v2.component.content.chat-forms.forms';\nimport { MarketContent } from 'im.v2.component.content.market';\nimport { NotificationContent } from 'im.v2.component.content.notification';\nimport { OpenlinesContent } from 'im.v2.component.content.openlines';\nimport { OpenlinesV2Content } from 'im.v2.component.content.openlinesV2';\nimport { SettingsContent } from 'im.v2.component.content.settings';\nimport { ChannelListContainer } from 'im.v2.component.list.container.channel';\nimport { CollabListContainer } from 'im.v2.component.list.container.collab';\nimport { CopilotListContainer } from 'im.v2.component.list.container.copilot';\nimport { OpenlineListContainer } from 'im.v2.component.list.container.openline';\nimport { RecentListContainer } from 'im.v2.component.list.container.recent';\nimport { TaskListContainer } from 'im.v2.component.list.container.task';\n\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport type { LayoutType } from 'im.v2.const';\n\ntype ComponentMap = Record<LayoutType, { list: BitrixVueComponentProps, content: BitrixVueComponentProps }>\n\nexport const LayoutComponentMap: ComponentMap = {\n\t[Layout.chat]: {\n\t\tlist: RecentListContainer,\n\t\tcontent: ChatContent,\n\t},\n\t[Layout.createChat]: {\n\t\tlist: RecentListContainer,\n\t\tcontent: CreateChatContent,\n\t},\n\t[Layout.updateChat]: {\n\t\tlist: RecentListContainer,\n\t\tcontent: UpdateChatContent,\n\t},\n\t[Layout.channel]: {\n\t\tlist: ChannelListContainer,\n\t\tcontent: ChatContent,\n\t},\n\t[Layout.notification]: {\n\t\tlist: RecentListContainer,\n\t\tcontent: NotificationContent,\n\t},\n\t[Layout.openlines]: {\n\t\tcontent: OpenlinesContent,\n\t},\n\t[Layout.openlinesV2]: {\n\t\tlist: OpenlineListContainer,\n\t\tcontent: OpenlinesV2Content,\n\t},\n\t[Layout.conference]: {\n\t\tlist: RecentListContainer,\n\t\tcontent: ChatContent,\n\t},\n\t[Layout.settings]: {\n\t\tcontent: SettingsContent,\n\t},\n\t[Layout.copilot]: {\n\t\tlist: CopilotListContainer,\n\t\tcontent: ChatContent,\n\t},\n\t[Layout.collab]: {\n\t\tlist: CollabListContainer,\n\t\tcontent: ChatContent,\n\t},\n\t[Layout.market]: {\n\t\tcontent: MarketContent,\n\t},\n\t[Layout.taskComments]: {\n\t\tlist: TaskListContainer,\n\t\tcontent: ChatContent,\n\t},\n};\n","import { DesktopModeSelectionBanner } from 'im.v2.component.desktop.mode-selection-banner';\nimport { PromoId } from 'im.v2.const';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\nimport { PromoManager } from 'im.v2.lib.promo';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const DesktopOverlay = {\n\tname: 'DesktopOverlay',\n\tcomponents: { DesktopModeSelectionBanner },\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisBannerVisible: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\tshouldShowBanner(): boolean\n\t\t{\n\t\t\tconst promoManager = PromoManager.getInstance();\n\t\t\tconst needToShow = promoManager.needToShow(PromoId.desktopModeSelection);\n\n\t\t\treturn needToShow && DesktopApi.isChatWindow();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.isBannerVisible = this.shouldShowBanner;\n\n\t\tif (this.isBannerVisible)\n\t\t{\n\t\t\tAnalytics.getInstance().desktopMode.onBannerShow();\n\t\t}\n\t},\n\tmethods: {\n\t\tonCloseBanner()\n\t\t{\n\t\t\tthis.isBannerVisible = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<DesktopModeSelectionBanner v-if=\"isBannerVisible\" @close=\"onCloseBanner\" />\n\t`,\n};\n","import 'planner';\nimport 'ui.fontawesome4';\nimport 'im.integration.viewer';\nimport 'ui.design-tokens';\nimport 'ui.fonts.opensans';\nimport 'im.v2.css.tokens';\nimport 'im.v2.css.icons';\nimport 'im.v2.css.classes';\n\nimport { OpenlinesContent } from 'im.v2.component.content.openlines';\nimport { BulkActionsManager } from 'im.v2.lib.bulk-actions';\nimport { CounterManager } from 'im.v2.lib.counter';\nimport { EscManager } from 'im.v2.lib.esc-manager';\nimport { Logger } from 'im.v2.lib.logger';\nimport { InitManager } from 'im.v2.lib.init';\nimport { Layout, type LayoutType } from 'im.v2.const';\nimport { ThemeManager } from 'im.v2.lib.theme';\nimport { DesktopManager } from 'im.v2.lib.desktop';\nimport { LayoutManager } from 'im.v2.lib.layout';\n\nimport { LayoutComponentMap } from './config/component-map';\nimport { DesktopOverlay } from './components/desktop-overlay';\n\nimport './css/messenger.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport type { ImModelLayout } from 'im.v2.model';\n\n// @vue/component\nexport const Messenger = {\n\tname: 'MessengerRoot',\n\tcomponents: { OpenlinesContent, DesktopOverlay },\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\topenlinesContentOpened: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tlayout(): ImModelLayout\n\t\t{\n\t\t\treturn this.$store.getters['application/getLayout'];\n\t\t},\n\t\tlayoutName(): LayoutType\n\t\t{\n\t\t\treturn this.layout.name;\n\t\t},\n\t\tentityId(): string\n\t\t{\n\t\t\treturn this.layout.entityId;\n\t\t},\n\t\thasListComponent(): boolean\n\t\t{\n\t\t\treturn Boolean(this.listComponent);\n\t\t},\n\t\tlistComponent(): ?BitrixVueComponentProps\n\t\t{\n\t\t\treturn LayoutComponentMap[this.layoutName].list;\n\t\t},\n\t\tcontentComponent(): BitrixVueComponentProps\n\t\t{\n\t\t\treturn LayoutComponentMap[this.layoutName].content;\n\t\t},\n\t\tisOpenline(): boolean\n\t\t{\n\t\t\treturn this.layout.name === Layout.openlines;\n\t\t},\n\t\tcontainerClasses(): string[]\n\t\t{\n\t\t\treturn {\n\t\t\t\t'--dark-theme': ThemeManager.isDarkTheme(),\n\t\t\t\t'--light-theme': ThemeManager.isLightTheme(),\n\t\t\t\t'--desktop': DesktopManager.isDesktop(),\n\t\t\t};\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tlayoutName:\n\t\t{\n\t\t\thandler(newLayoutName)\n\t\t\t{\n\t\t\t\tif (newLayoutName !== Layout.openlines)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.openlinesContentOpened = true;\n\t\t\t},\n\t\t\timmediate: true,\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tInitManager.init();\n\t\t// emit again because external code expects to receive it after the messenger is opened (not via quick-access).\n\t\tCounterManager.getInstance().emitCounters();\n\n\t\tLayoutManager.getInstance().bindEvents({ emitter: this.getEmitter() });\n\t\tBulkActionsManager.getInstance().bindEvents({ emitter: this.getEmitter() });\n\n\t\tLogger.warn('MessengerRoot created');\n\n\t\tvoid this.getLayoutManager().prepareInitialLayout();\n\t},\n\tmounted()\n\t{\n\t\tEscManager.getInstance().register({\n\t\t\tmessengerContainer: this.$refs.container,\n\t\t\tcontext: { emitter: this.getEmitter() },\n\t\t});\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.getLayoutManager().destroy();\n\t\tEscManager.getInstance().unregister();\n\t},\n\tmethods:\n\t{\n\t\tonEntitySelect({ layoutName, entityId })\n\t\t{\n\t\t\tvoid this.getLayoutManager().setLayout({ name: layoutName, entityId });\n\t\t},\n\t\tgetLayoutManager(): LayoutManager\n\t\t{\n\t\t\treturn LayoutManager.getInstance();\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-messenger__scope bx-im-messenger__container --ui-context-content-light\" :class=\"containerClasses\" ref=\"container\">\n\t\t\t<div class=\"bx-im-messenger__layout_container\">\n\t\t\t\t<div class=\"bx-im-messenger__layout_content\">\n\t\t\t\t\t<div v-if=\"hasListComponent\" class=\"bx-im-messenger__list_container\">\n\t\t\t\t\t\t<KeepAlive>\n\t\t\t\t\t\t\t<component :is=\"listComponent\" @selectEntity=\"onEntitySelect\" />\n\t\t\t\t\t\t</KeepAlive>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-messenger__content_container\" :class=\"{'--with-list': hasListComponent}\">\n\t\t\t\t\t\t<div v-if=\"openlinesContentOpened\" class=\"bx-im-messenger__openlines_container\" :class=\"{'--hidden': !isOpenline}\">\n\t\t\t\t\t\t\t<OpenlinesContent v-show=\"isOpenline\" :entityId=\"entityId\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<component v-if=\"!isOpenline\" :is=\"contentComponent\" :entityId=\"entityId\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<DesktopOverlay />\n\t`,\n};\n"],"names":["LayoutComponentMap","Layout","chat","list","RecentListContainer","content","ChatContent","createChat","CreateChatContent","updateChat","UpdateChatContent","channel","ChannelListContainer","notification","NotificationContent","openlines","OpenlinesContent","openlinesV2","OpenlineListContainer","OpenlinesV2Content","conference","settings","SettingsContent","copilot","CopilotListContainer","collab","CollabListContainer","market","MarketContent","taskComments","TaskListContainer","DesktopOverlay","name","components","DesktopModeSelectionBanner","data","isBannerVisible","computed","shouldShowBanner","promoManager","PromoManager","getInstance","needToShow","PromoId","desktopModeSelection","DesktopApi","isChatWindow","created","Analytics","desktopMode","onBannerShow","methods","onCloseBanner","template","Messenger","openlinesContentOpened","layout","$store","getters","layoutName","entityId","hasListComponent","Boolean","listComponent","contentComponent","isOpenline","containerClasses","ThemeManager","isDarkTheme","isLightTheme","DesktopManager","isDesktop","watch","handler","newLayoutName","immediate","InitManager","init","CounterManager","emitCounters","LayoutManager","bindEvents","emitter","getEmitter","BulkActionsManager","Logger","warn","getLayoutManager","prepareInitialLayout","mounted","EscManager","register","messengerContainer","$refs","container","context","beforeUnmount","destroy","unregister","onEntitySelect","setLayout","$Bitrix","eventEmitter"],"mappings":"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"}