this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(t,e,n,o,a,i,s,r,l,d,c,h,m,g,p,u,C,T,_,I,b,v,E,S,A,M,B,L,f,y,O,N,x,P,w,D,R,k,H,$,U,X,F,K,z,G,q){"use strict";const j={name:"CommentsButton",components:{FloatButton:U.FloatButton},props:{counter:{type:Number,required:true}},computed:{floatButtonProps(){return{icon:U.FloatButtonIcon.comment,color:U.FloatButtonColor.success,counter:this.counter}}},template:`\n\t\t<FloatButton v-bind="floatButtonProps" />\n\t`};const V={name:"ChannelDialog",components:{ChatDialog:U.ChatDialog,CommentsButton:j},props:{dialogId:{type:String,required:true}},data(){return{lastScrolledChatId:0}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},layout(){return this.$store.getters["application/getLayout"]},isGuest(){return this.dialog.role===K.UserRole.guest},isChatLayout(){return this.layout.name===K.Layout.chat},channelComments(){return this.$store.getters["counters/getChannelComments"](this.dialog.chatId)},totalChannelCommentsCounter(){let t=0;Object.values(this.channelComments).forEach((e=>{t+=e}));return t},showCommentsButton(){return this.isChatLayout&&this.totalChannelCommentsCounter>0}},beforeUnmount(){this.readAllChannelComments()},methods:{async onCommentsButtonClick(){const t=this.getNextChatIdToJump();this.lastScrolledChatId=t;const e=this.$store.getters["messages/comments/getMessageIdByChatId"](t);if(e){this.$refs.dialog.goToMessageContext(e,{position:U.ScrollManager.scrollPosition.messageBottom});return}await this.goToMessageContextByCommentsChatId(t)},async goToMessageContextByCommentsChatId(t){this.$refs.dialog.showLoadingBar();const e=await this.$refs.dialog.getMessageService().loadContextByChatId(t);this.$refs.dialog.hideLoadingBar();if(!e){console.error("ChannelDialog: no messageId after loading context")}await this.$nextTick();this.$refs.dialog.getScrollManager().scrollToMessage(e,{position:U.ScrollManager.scrollPosition.messageBottom});await this.$nextTick();this.$refs.dialog.highlightMessage(e)},getNextChatIdToJump(){const t=this.getCommentsChatIds();t.sort(((t,e)=>t-e));if(this.lastScrolledChatId===0){return t[0]}const e=t.filter((t=>t>this.lastScrolledChatId));if(e.length===0){return t[0]}return e[0]},getCommentsChatIds(){return Object.keys(this.channelComments).map((t=>Number(t)))},readAllChannelComments(){void k.CommentsService.readAllChannelComments(this.dialogId)}},template:`\n\t\t<ChatDialog ref="dialog" :dialogId="dialogId" :clearOnExit="isGuest">\n\t\t\t<template #additional-float-button>\n\t\t\t\t<CommentsButton\n\t\t\t\t\tv-if="showCommentsButton"\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t:counter="totalChannelCommentsCounter"\n\t\t\t\t\t@click="onCommentsButtonClick"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</ChatDialog>\n\t`};const W={components:{ChatButton:G.ChatButton},props:{dialogId:{type:String,required:true}},computed:{ButtonSize:()=>G.ButtonSize,ButtonColor:()=>G.ButtonColor},methods:{onButtonClick(){this.getChatService().joinChat(this.dialogId)},getChatService(){if(!this.chatService){this.chatService=new q.ChatService}return this.chatService},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-chat__textarea_placeholder">\n\t\t\t<ChatButton\n\t\t\t\t:size="ButtonSize.XL"\n\t\t\t\t:color="ButtonColor.Primary"\n\t\t\t\t:text="loc('IM_CONTENT_BLOCKED_TEXTAREA_JOIN_CHANNEL_V2')"\n\t\t\t\t:isRounded="true"\n\t\t\t\t@click="onButtonClick"\n\t\t\t/>\n\t\t</div>\n\t`};const J={name:"ChannelTextarea",components:{ChatTextarea:z.ChatTextarea},props:{dialogId:{type:String,default:""}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<ChatTextarea\n\t\t\t:dialogId="dialogId"\n\t\t\t:placeholder="this.loc('IM_CONTENT_CHANNEL_TEXTAREA_PLACEHOLDER')"\n\t\t\t:withMarket="false"\n\t\t\tclass="bx-im-channel-send-panel__container"\n\t\t/>\n\t`};const Y={name:"ChannelContent",components:{BaseChatContent:D.BaseChatContent,ChannelDialog:V,ChannelTextarea:J,JoinPanel:W},props:{dialogId:{type:String,required:true}},template:`\n\t\t<BaseChatContent :dialogId="dialogId">\n\t\t\t<template #dialog>\n\t\t\t\t<ChannelDialog :dialogId="dialogId" :key="dialogId" />\n\t\t\t</template>\n\t\t\t<template #join-panel>\n\t\t\t\t<JoinPanel :dialogId="dialogId" />\n\t\t\t</template>\n\t\t\t<template #textarea="{ onTextareaMount }">\n\t\t\t\t<ChannelTextarea :dialogId="dialogId" :key="dialogId" @mounted="onTextareaMount" />\n\t\t\t</template>\n\t\t</BaseChatContent>\n\t`};const Z={name:"CollabTitle",components:{ChatTitle:h.ChatTitle,LineLoader:l.LineLoader,FadeAnimation:d.FadeAnimation},inject:["currentSidebarPanel"],props:{dialogId:{type:String,required:true}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},collabInfo(){return this.$store.getters["chats/collabs/getByChatId"](this.dialog.chatId)},guestCounter(){return this.collabInfo.guestCount},userCounterText(){return O.Loc.getMessagePlural("IM_CONTENT_CHAT_HEADER_USER_COUNT",this.dialog.userCounter,{"#COUNT#":this.dialog.userCounter})},guestCounterText(){return O.Loc.getMessagePlural("IM_CONTENT_COLLAB_HEADER_GUEST_COUNT",this.guestCounter,{"#COUNT#":this.guestCounter})}},methods:{onMembersClick(){if(this.currentSidebarPanel===K.SidebarDetailBlock.members){this.getEmitter().emit(K.EventType.sidebar.close,{panel:K.SidebarDetailBlock.members});return}this.getEmitter().emit(K.EventType.sidebar.open,{panel:K.SidebarDetailBlock.members,dialogId:this.dialogId})},getEmitter(){return this.$Bitrix.eventEmitter},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-collab-header-title__container">\n\t\t\t<div class="bx-im-collab-header-title__title-container --ellipsis">\n\t\t\t\t<ChatTitle :dialogId="dialogId" :withAutoDelete="true" />\n\t\t\t</div>\n\t\t\t<LineLoader v-if="!dialog.inited" :width="50" :height="16" />\n\t\t\t<FadeAnimation :duration="100">\n\t\t\t\t<div v-if="dialog.inited" class="bx-im-collab-header-title__subtitle_container">\n\t\t\t\t\t<div @click="onMembersClick" class="bx-im-collab-header-title__subtitle_content --ellipsis">\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t:title="loc('IM_CONTENT_CHAT_HEADER_OPEN_MEMBERS')"\n\t\t\t\t\t\t\tclass="bx-im-collab-header-title__user-counter"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{{ userCounterText }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span v-if="guestCounter > 0" class="bx-im-collab-header-title__guest-counter">\n\t\t\t\t\t\t\t{{ guestCounterText }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</FadeAnimation>\n\t\t</div>\n\t`};const Q=Object.freeze({addToChat:"add-to-chat",collabEntities:"collab-entities"});let tt=t=>t,et;var nt=babelHelpers.classPrivateFieldLooseKey("title");var ot=babelHelpers.classPrivateFieldLooseKey("text");var at=babelHelpers.classPrivateFieldLooseKey("iconKey");class it{constructor(t){Object.defineProperty(this,nt,{writable:true,value:void 0});Object.defineProperty(this,ot,{writable:true,value:void 0});Object.defineProperty(this,at,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,nt)[nt]=t.title;babelHelpers.classPrivateFieldLooseBase(this,ot)[ot]=t.text;babelHelpers.classPrivateFieldLooseBase(this,at)[at]=t.iconKey}render(){return O.Tag.render(et||(et=tt`
			<div class="bx-im-collab-tooltip__scope bx-im-collab-tooltip__container">
				<div class="bx-im-collab-tooltip__icon --${0}"></div>
				<div class="bx-im-collab-tooltip__title-container">
					<div class="bx-im-collab-tooltip__title">
						${0}
					</div>
					<div class="bx-im-collab-tooltip__text">
						${0}
					</div>
				</div>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,at)[at],babelHelpers.classPrivateFieldLooseBase(this,nt)[nt],babelHelpers.classPrivateFieldLooseBase(this,ot)[ot])}}const st={name:"EntityCounter",props:{counter:{type:Number,required:true}},computed:{preparedCounter(){return this.counter>99?"99+":this.counter.toString()}},template:`\n\t\t<span class="bx-im-collab-header__link-counter">\n\t\t\t{{ preparedCounter }}\n\t\t</span>\n\t`};const rt={name:"EntityLink",components:{EntityCounter:st},props:{dialogId:{type:String,required:true},compactMode:{type:Boolean,required:true},type:{type:String,required:true},title:{type:String,required:true},url:{type:String,required:true},counter:{type:[Number,null],default:null}},computed:{showCounter(){return!O.Type.isNull(this.counter)&&this.counter>0}},methods:{onLinkClick(){x.Analytics.getInstance().collabEntities.onClick(this.dialogId,this.type);BX.SidePanel.Instance.open(this.url,{cacheable:false,customLeftBoundary:0})}},template:`\n\t\t<a :href="url" @click.prevent="onLinkClick" class="bx-im-collab-header__link" :class="'--' + type">\n\t\t\t<span v-if="compactMode" class="bx-im-collab-header__link-icon"></span>\n\t\t\t<span v-else class="bx-im-collab-header__link-text">{{ title }}</span>\n\t\t\t<EntityCounter v-if="showCounter" :counter="counter" />\n\t\t</a>\n\t`};const lt={name:"EntitiesPanel",components:{EntityLink:rt},props:{dialogId:{type:String,default:""},compactMode:{type:Boolean,required:true}},data(){return{highlightMode:false}},computed:{CollabEntityType:()=>K.CollabEntityType,dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},collabInfo(){return this.$store.getters["chats/collabs/getByChatId"](this.dialog.chatId)},tasksInfo(){return this.collabInfo.entities.tasks},tasksUrl(){return this.tasksInfo.url},tasksCounter(){return this.tasksInfo.counter},filesInfo(){return this.collabInfo.entities.files},filesUrl(){return this.filesInfo.url},calendarInfo(){return this.collabInfo.entities.calendar},calendarUrl(){return this.calendarInfo.url},calendarCounter(){return this.calendarInfo.counter}},mounted(){this.initPromo()},methods:{initPromo(){const t=S.PromoManager.getInstance();const e=K.PromoId.collabEntities;const n={chatId:this.dialog.chatId};if(t.needToShow(e,n)){void this.showCollabEntitiesPromo(e,n)}},async showCollabEntitiesPromo(t,e){const n=new c.Tooltip({bindElement:this.$refs["collab-entities"],content:this.renderTooltipContent(),minWidth:410,popupOptions:{offsetTop:11,offsetLeft:38,autoHide:true,closeIcon:true,closeIconSize:p.CloseIconSize.LARGE,events:{onPopupShow:()=>{this.highlightMode=true},onPopupClose:()=>{this.highlightMode=false}}}});n.show();void S.PromoManager.getInstance().markAsWatched(t,e)},renderTooltipContent(){const t=new it({title:this.loc("IM_CONTENT_COLLAB_ONBOARDING_ENTITIES_TITLE"),text:this.loc("IM_CONTENT_COLLAB_ONBOARDING_ENTITIES_TEXT"),iconKey:Q.collabEntities});return t.render()},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div\n\t\t\tclass="bx-im-collab-header__links-container"\n\t\t\t:class="{'--compact': compactMode, '--highlight': highlightMode}"\n\t\t\tref="collab-entities"\n\t\t>\n\t\t\t<EntityLink\n\t\t\t\t:dialogId="dialogId"\n\t\t\t\t:compactMode="compactMode"\n\t\t\t\t:url="tasksUrl"\n\t\t\t\t:type="CollabEntityType.tasks"\n\t\t\t\t:title="loc('IM_CONTENT_COLLAB_HEADER_LINK_TASKS')"\n\t\t\t\t:counter="tasksCounter"\n\t\t\t/>\n\t\t\t<EntityLink\n\t\t\t\t:dialogId="dialogId"\n\t\t\t\t:compactMode="compactMode"\n\t\t\t\t:url="filesUrl"\n\t\t\t\t:type="CollabEntityType.files"\n\t\t\t\t:title="loc('IM_CONTENT_COLLAB_HEADER_LINK_FILES')"\n\t\t\t/>\n\t\t\t<EntityLink\n\t\t\t\t:dialogId="dialogId"\n\t\t\t\t:compactMode="compactMode"\n\t\t\t\t:url="calendarUrl"\n\t\t\t\t:type="CollabEntityType.calendar"\n\t\t\t\t:title="loc('IM_CONTENT_COLLAB_HEADER_LINK_CALENDAR')"\n\t\t\t\t:counter="calendarCounter"\n\t\t\t/>\n\t\t</div>\n\t`};const dt={[K.PromoId.membersNotInvitedOneDayToCollab]:{title:"IM_CONTENT_COLLAB_ONBOARDING_INVITE_MEMBERS_ONE_DAY_TITLE",text:"IM_CONTENT_COLLAB_ONBOARDING_INVITE_MEMBERS_ONE_DAY_TEXT"},[K.PromoId.membersNotInvitedFourDayToCollab]:{title:"IM_CONTENT_COLLAB_ONBOARDING_INVITE_MEMBERS_FOUR_DAYS_TITLE",text:"IM_CONTENT_COLLAB_ONBOARDING_INVITE_MEMBERS_FOUR_DAYS_TEXT"}};const ct={name:"AddToChatButton",components:{AddToCollab:g.AddToCollab},props:{dialogId:{type:String,default:""},withAnimation:{type:Boolean,default:false}},emits:["close"],data(){return{showAddToChatPopup:false}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)}},mounted(){this.initPromo()},methods:{openAddToChatPopup(){x.Analytics.getInstance().userAdd.onChatHeaderClick(this.dialogId);this.showAddToChatPopup=true},closeAddToChatPopup(){this.$emit("close");this.showAddToChatPopup=false},initPromo(){const t=S.PromoManager.getInstance();Object.keys(dt).forEach((e=>{const n={chatId:this.dialog.chatId};if(t.needToShow(e,n)){void this.showMembersNotInvitedPromo(e,n)}}))},showMembersNotInvitedPromo(t,e){const n=new c.Tooltip({bindElement:this.$refs["add-members"],content:this.renderTooltipContent(t),minWidth:410,popupOptions:{offsetTop:8,offsetLeft:9,autoHide:true,closeIcon:true,closeIconSize:p.CloseIconSize.LARGE}});n.show();void S.PromoManager.getInstance().markAsWatched(t,e)},renderTooltipContent(t){const e=new it({title:this.loc(dt[t].title),text:this.loc(dt[t].text),iconKey:Q.addToChat});return e.render()},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div\n\t\t\t:title="loc('IM_CONTENT_CHAT_HEADER_OPEN_INVITE_POPUP_TITLE')"\n\t\t\t:class="{'--active': showAddToChatPopup}"\n\t\t\tclass="bx-im-collab-header__add-people-icon"\n\t\t\t@click="openAddToChatPopup"\n\t\t\tref="add-members"\n\t\t></div>\n\t\t<AddToCollab\n\t\t\tv-if="showAddToChatPopup"\n\t\t\t:bindElement="$refs['add-members'] ?? {}"\n\t\t\t:dialogId="dialogId"\n\t\t\t:popupConfig="{ offsetTop: 25, offsetLeft: -300 }"\n\t\t\t@close="closeAddToChatPopup"\n\t\t/>\n\t`};const ht={name:"CollabHeader",components:{ChatHeader:D.ChatHeader,CollabTitle:Z,EntitiesPanel:lt,AddToChatButton:ct,AddToChatPopup:g.AddToChat,PulseAnimation:r.PulseAnimation},props:{dialogId:{type:String,default:""}},data(){return{compactMode:false,showAddToChatPopupDelayed:false}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},isInited(){return this.dialog.inited}},watch:{async isInited(t){if(t&&this.showAddToChatPopupDelayed){await this.$nextTick();this.openAddToChatPopup()}}},created(){this.getEmitter().subscribe(K.EventType.header.openAddToChatPopup,this.onOpenAddToChatPopup)},beforeUnmount(){this.getEmitter().unsubscribe(K.EventType.header.openAddToChatPopup,this.onOpenAddToChatPopup)},methods:{onOpenAddToChatPopup(){if(!this.isInited){this.showAddToChatPopupDelayed=true;return}this.openAddToChatPopup()},openAddToChatPopup(){this.$refs["add-to-chat-button"].openAddToChatPopup()},onCompactModeChange(t){this.compactMode=t},getEmitter(){return this.$Bitrix.eventEmitter}},template:`\n\t\t<ChatHeader :dialogId="dialogId" @compactModeChange="onCompactModeChange" class="bx-im-collab-header__container">\n\t\t\t<template #title>\n\t\t\t\t<CollabTitle :dialogId="dialogId" />\n\t\t\t</template>\n\t\t\t<template #before-actions>\n\t\t\t\t<EntitiesPanel :dialogId="dialogId" :compactMode="compactMode" />\n\t\t\t</template>\n\t\t\t<template #add-to-chat-button>\n\t\t\t\t<PulseAnimation :showPulse="showAddToChatPopupDelayed" class="bx-im-collab-header__add-to-chat">\n\t\t\t\t\t<AddToChatButton \n\t\t\t\t\t\t:withAnimation="showAddToChatPopupDelayed" \n\t\t\t\t\t\t:dialogId="dialogId" \n\t\t\t\t\t\tref="add-to-chat-button" \n\t\t\t\t\t\t@close="showAddToChatPopupDelayed = false"\n\t\t\t\t\t/>\n\t\t\t\t</PulseAnimation>\n\t\t\t</template>\n\t\t</ChatHeader>\n\t`};const mt={name:"CollabContent",components:{BaseChatContent:D.BaseChatContent,CollabHeader:ht},props:{dialogId:{type:String,required:true}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},dialogInited(){return this.dialog.inited}},watch:{dialogInited(t,e){if(!t||e){return}this.initPromo()}},methods:{initPromo(){const t=S.PromoManager.getInstance();const e=K.PromoId.collaberNotAcceptInvitationOneDay;const n={chatId:this.dialog.chatId};if(t.needToShow(e,n)){this.showNotAcceptInvitationPromo(e,n)}},showNotAcceptInvitationPromo(t,e){s.Notifier.collab.onCollaberNotAcceptInvitation();void S.PromoManager.getInstance().markAsWatched(t,e)}},template:`\n\t\t<BaseChatContent :dialogId="dialogId">\n\t\t\t<template #header>\n\t\t\t\t<CollabHeader :dialogId="dialogId" :key="dialogId" />\n\t\t\t</template>\n\t\t</BaseChatContent>\n\t`};const gt={name:"MultidialogChatTitle",components:{EditableChatTitle:h.EditableChatTitle,ChatTitle:h.ChatTitle},props:{dialogId:{type:String,required:true}},emits:["newTitle"],computed:{isSupportBot(){return this.$store.getters["users/bots/isSupport"](this.dialogId)},subtitle(){return this.$Bitrix.Loc.getMessage("IM_CONTENT_CHAT_HEADER_SUPPORT_SUBTITLE")}},template:`\n\t\t<div class="bx-im-chat-header__info">\n\t\t\t<ChatTitle v-if="isSupportBot" :dialogId="dialogId" />\n\t\t\t<EditableChatTitle v-else :dialogId="dialogId" @newTitleSubmit="$emit('newTitle', $event)" />\n\t\t\t<div class="bx-im-chat-header__subtitle_container">\n\t\t\t\t<div class="bx-im-chat-header__subtitle_content">{{ subtitle }}</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const pt={name:"MultidialogHeader",components:{ChatHeader:D.ChatHeader,MultidialogChatTitle:gt},props:{dialogId:{type:String,default:""}},template:`\n\t\t<ChatHeader :dialogId="dialogId">\n\t\t\t<template #title="{ onNewTitleHandler }">\n\t\t\t\t<MultidialogChatTitle\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t@newTitle="onNewTitleHandler"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</ChatHeader>\n\t`};const ut={name:"MultidialogContent",components:{BaseChatContent:D.BaseChatContent,MultidialogHeader:pt},props:{dialogId:{type:String,required:true}},template:`\n\t\t<BaseChatContent :dialogId="dialogId">\n\t\t\t<template #header>\n\t\t\t\t<MultidialogHeader :dialogId="dialogId" :key="dialogId" />\n\t\t\t</template>\n\t\t</BaseChatContent>\n\t`};const Ct={name:"NotesContent",components:{BaseChatContent:D.BaseChatContent,ChatHeader:D.ChatHeader,ChatTitle:h.ChatTitle},props:{dialogId:{type:String,required:true}},computed:{titleType(){return Number.parseInt(this.dialogId,10)===N.Core.getUserId()?h.ChatTitleType.notes:""}},template:`\n\t\t<BaseChatContent :dialogId="dialogId">\n\t\t\t<template #header>\n\t\t\t\t<ChatHeader :dialogId="dialogId" :withCallButton="false" :withAddToChatButton="false">\n\t\t\t\t\t<template #title>\n\t\t\t\t\t\t<ChatTitle :dialogId="dialogId" :customType="titleType" :showItsYou="false"/>\n\t\t\t\t\t</template>\n\t\t\t\t</ChatHeader>\n\t\t\t</template>\n\t\t</BaseChatContent>\n\t`};const Tt="im-add-to-chat-hint-popup";const _t={name:"AddToChatHint",components:{MessengerPopup:u.MessengerPopup},props:{bindElement:{type:Object,required:true}},emits:["close","hide"],computed:{POPUP_ID:()=>Tt,config(){return{darkMode:true,bindElement:this.bindElement,angle:true,width:346,closeIcon:true,offsetLeft:8,className:"bx-im-copilot-add-to-chat-hint__scope",contentBorderRadius:0}}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<MessengerPopup\n\t\t\t:config="config"\n\t\t\t:id="POPUP_ID"\n\t\t\t@close="$emit('close')"\n\t\t>\n\t\t\t<div class="bx-im-copilot-add-to-chat-hint__title">\n\t\t\t\t{{ loc('IM_CONTENT_COPILOT_ADD_TO_CHAT_HINT_TITLE') }}\n\t\t\t</div>\n\t\t\t<br />\n\t\t\t<div class="bx-im-copilot-add-to-chat-hint__description">\n\t\t\t\t{{ loc('IM_CONTENT_COPILOT_ADD_TO_CHAT_HINT_DESCRIPTION') }}\n\t\t\t</div>\n\t\t\t<br />\n\t\t\t<button class="bx-im-copilot-add-to-chat-hint__hide" @click="$emit('hide')">\n\t\t\t\t{{ loc('IM_CONTENT_COPILOT_ADD_TO_CHAT_HINT_HIDE') }}\n\t\t\t</button>\n\t\t</MessengerPopup>\n\t`};const It={name:"AddToChatButton",components:{AddToChat:g.AddToChat,AddToChatHint:_t},props:{dialogId:{type:String,default:""}},data(){return{showInviteButton:false,showAddToChatPopup:false,showAddToChatHint:false}},mounted(){const t=S.PromoManager.getInstance().needToShow(K.PromoId.copilotInRecentTab);const e=S.PromoManager.getInstance().needToShow(K.PromoId.addUsersToCopilotChat);this.showAddToChatHint=!t&&e},methods:{openAddToChatPopup(){x.Analytics.getInstance().userAdd.onChatHeaderClick(this.dialogId);this.showAddToChatPopup=true},closeAddToChatPopup(){this.showAddToChatPopup=false},showHint(){this.showAddToChatHint=true},closeHint(){this.showAddToChatHint=false},onHintHide(){void S.PromoManager.getInstance().markAsWatched(K.PromoId.addUsersToCopilotChat);this.closeHint()},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div\n\t\t\t:title="loc('IM_CONTENT_CHAT_HEADER_OPEN_INVITE_POPUP_TITLE')"\n\t\t\t:class="{'--active': showAddToChatPopup}"\n\t\t\tclass="bx-im-chat-header__icon --add-people"\n\t\t\t@click="openAddToChatPopup"\n\t\t\tref="add-members"\n\t\t>\n\t\t\t<slot name="invite-hint" :inviteButtonRef="$refs['add-members']"></slot>\n\t\t</div>\n\t\t<AddToChat\n\t\t\tv-if="showAddToChatPopup"\n\t\t\t:bindElement="$refs['add-members'] ?? {}"\n\t\t\t:dialogId="dialogId"\n\t\t\t:popupConfig="{ offsetTop: 15, offsetLeft: -300 }"\n\t\t\t@close="closeAddToChatPopup"\n\t\t/>\n\t\t<AddToChatHint\n\t\t\tv-if="showAddToChatHint"\n\t\t\t:bindElement="$refs['add-members'] ?? {}"\n\t\t\t@close="closeHint"\n\t\t\t@hide="onHintHide"\n\t\t/>\n\t`};const bt={name:"CopilotChatHeader",components:{ChatHeader:D.ChatHeader,EditableChatTitle:h.EditableChatTitle,ChatAvatar:P.ChatAvatar,AddToChatButton:It},inject:["currentSidebarPanel"],props:{dialogId:{type:String,default:""}},data(){return{buttonPanelReady:false}},computed:{AvatarSize:()=>P.AvatarSize,dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},isInited(){return this.dialog.inited},isGroupCopilotChat(){return(new m.CopilotManager).isGroupCopilotChat(this.dialogId)},copilotRole(){var t;const e=this.$store.getters["copilot/chats/getRole"](this.dialogId);return(t=e==null?void 0:e.name)!=null?t:""},formattedUserCounter(){return O.Loc.getMessagePlural("IM_CONTENT_COPILOT_HEADER_USER_COUNT",this.dialog.userCounter,{"#COUNT#":this.dialog.userCounter})}},methods:{onNewTitleSubmit(t){void this.getChatService().renameChat(this.dialogId,t)},onMembersClick(){if(!this.isInited){return}if(this.currentSidebarPanel===K.SidebarDetailBlock.members){this.getEmitter().emit(K.EventType.sidebar.close,{panel:K.SidebarDetailBlock.members});return}this.getEmitter().emit(K.EventType.sidebar.open,{panel:K.SidebarDetailBlock.members,dialogId:this.dialogId})},onButtonPanelReady(){this.buttonPanelReady=true},getChatService(){if(!this.chatService){this.chatService=new q.ChatService}return this.chatService},getEmitter(){return this.$Bitrix.eventEmitter},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<ChatHeader\n\t\t\t:dialogId="dialogId"\n\t\t\t:withSearchButton="false"\n\t\t\tclass="bx-im-copilot-header__container"\n\t\t\t@buttonPanelReady="onButtonPanelReady"\n\t\t>\n\t\t\t<template #left>\n\t\t\t\t<div class="bx-im-copilot-header__avatar">\n\t\t\t\t\t<ChatAvatar\n\t\t\t\t\t\t:avatarDialogId="dialogId"\n\t\t\t\t\t\t:contextDialogId="dialogId"\n\t\t\t\t\t\t:withSpecialTypes="false"\n\t\t\t\t\t\t:size="AvatarSize.L"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-copilot-header__info">\n\t\t\t\t\t<EditableChatTitle :dialogId="dialogId" @newTitleSubmit="onNewTitleSubmit" />\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isGroupCopilotChat"\n\t\t\t\t\t\t:title="loc('IM_CONTENT_COPILOT_HEADER_OPEN_MEMBERS_TITLE')"\n\t\t\t\t\t\t@click="onMembersClick"\n\t\t\t\t\t\tclass="bx-im-copilot-header__subtitle --click"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ formattedUserCounter }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-else class="bx-im-copilot-header__subtitle">\n\t\t\t\t\t\t{{ copilotRole }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-if="buttonPanelReady" #add-to-chat-button>\n\t\t\t\t<AddToChatButton :dialogId="dialogId" />\n\t\t\t</template>\n\t\t</ChatHeader>\n\t`};const vt={name:"ReasoningButton",directives:{hint:C.hint},components:{Chip:_.Chip},props:{dialogId:{type:String,required:true}},computed:{OutlineIcons:()=>T.Outline,ChipDesign:()=>_.ChipDesign,ChipSize:()=>_.ChipSize,isActive(){return this.$store.getters["copilot/chats/isReasoningEnabled"](this.dialogId)},modelCode(){var t;return(t=this.$store.getters["copilot/chats/getAIModel"](this.dialogId))==null?void 0:t.code},isReasoningAvailable(){return B.FeatureManager.isFeatureAvailable(B.Feature.isCopilotReasoningAvailable)},isReasoningAvailableInModel(){return this.$store.getters["copilot/isReasoningAvailableInModel"](this.modelCode)},design(){if(!this.isReasoningAvailableInModel){return _.ChipDesign.Disabled}if(this.isActive){return _.ChipDesign.OutlineCopilot}return _.ChipDesign.Outline},hint(){if(this.isReasoningAvailableInModel){return null}return{text:this.loc("IM_CONTENT_COPILOT_TEXTAREA_REASONING_BUTTON_HINT_NOT_AVAILABLE")}}},methods:{toggle(){if(!this.isReasoningAvailableInModel){return}this.$store.dispatch("copilot/chats/toggleReasoning",this.dialogId);x.Analytics.getInstance().copilot.onToggleReasoning(this.dialogId)},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<Chip\n\t\t\tv-if="isReasoningAvailable"\n\t\t\tv-hint="hint"\n\t\t\t:text="loc('IM_CONTENT_COPILOT_TEXTAREA_REASONING_BUTTON')"\n\t\t\t:rounded="true"\n\t\t\t:size="ChipSize.Sm"\n\t\t\t:icon="OutlineIcons.AI_STARS"\n\t\t\t:design="design"\n\t\t\t@click="toggle"\n\t\t/>\n\t`};const Et={name:"CopilotTextarea",components:{ChatTextarea:z.ChatTextarea,ReasoningButton:vt},props:{dialogId:{type:String,required:true}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<ChatTextarea\n\t\t\t:dialogId="dialogId"\n\t\t\t:placeholder="loc('IM_CONTENT_COPILOT_TEXTAREA_PLACEHOLDER')"\n\t\t\t:withMarket="false"\n\t\t\t:withEdit="false"\n\t\t\t:withUploadMenu="false"\n\t\t\t:withSmileSelector="false"\n\t\t>\n\t\t\t<template #bottom-panel-buttons>\n\t\t\t\t<ReasoningButton :dialogId="dialogId" />\n\t\t\t</template>\n\t\t</ChatTextarea>\n\t`};const St={name:"CopilotContent",components:{BaseChatContent:D.BaseChatContent,CopilotChatHeader:bt,CopilotTextarea:Et},props:{dialogId:{type:String,default:""}},template:`\n\t\t<BaseChatContent :dialogId="dialogId" :withDropArea="false">\n\t\t\t<template #header>\n\t\t\t\t<CopilotChatHeader :dialogId="dialogId" :key="dialogId" />\n\t\t\t</template>\n\t\t\t<template #textarea="{ onTextareaMount }">\n\t\t\t\t<CopilotTextarea :dialogId="dialogId" :key="dialogId" @mounted="onTextareaMount" />\n\t\t\t</template>\n\t\t</BaseChatContent>\n\t`};const At=20;const Mt="marta_chat";const Bt={name:"McpIntegration",components:{Chip:_.Chip},data(){return{isSelectorOpened:false,mcpAuth:{id:null,name:null,icon:null}}},computed:{OutlineIcons:()=>T.Outline,ChipDesign:()=>_.ChipDesign,ChipSize:()=>_.ChipSize,hasSelectedMcpAuth(){return this.mcpAuth.id!==null},chipDesign(){if(this.hasSelectedMcpAuth){return _.ChipDesign.OutlineAccent2}return _.ChipDesign.Outline},isAvailable(){return B.FeatureManager.isFeatureAvailable(B.Feature.aiAssistantMcpSelectorAvailable)},defaultIcon(){if(this.mcpIcon){return null}return T.Outline.APPS},mcpIcon(){if(!this.mcpAuth.icon){return null}return{src:this.mcpAuth.icon,alt:""}},chipName(){if(!this.mcpAuth.name){return this.loc("IM_CONTENT_AI_ASSISTANT_MCP_INTEGRATIONS")}const t=this.mcpAuth.name.length>At;if(t){return`${this.mcpAuth.name.slice(0,At)}...`}return this.mcpAuth.name}},beforeUnmount(){var t;this.clear();(t=this.selector)==null?void 0:t.destroy()},methods:{toggle(){x.Analytics.getInstance().aiAssistant.onMcpIntegrationClick();if(this.isSelectorOpened){this.getSelector().hide();return}this.getSelector().show()},getSelector(){if(this.selector){return this.selector}this.selector=new I.McpSelector({context:Mt,targetNode:this.$refs.selector,dialogOptions:{popupOptions:{className:"mcp-selector-dialog"}},entityOptions:{agentMode:false},events:{onSelect:t=>{const{auth:e,mcp:n}=t.getData();if(!e){this.clear();return}this.setMcpAuth({id:e.id,name:e.name,icon:n.iconUrl})},onHide:()=>{this.isSelectorOpened=false},onShow:()=>{this.isSelectorOpened=true}}});return this.selector},setMcpAuth(t){this.mcpAuth=t;this.$store.dispatch("aiAssistant/setMcpAuthId",this.mcpAuth.id)},clear(){this.mcpAuth={id:null,name:null,icon:null};this.$store.dispatch("aiAssistant/setMcpAuthId",null)},onChipClearClick(){this.selector.clear();this.clear()},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<span v-if="isAvailable" ref="selector" class="bx-im-mcp-integration__container">\n\t\t\t<Chip\n\t\t\t\t:text="chipName"\n\t\t\t\t:rounded="true"\n\t\t\t\t:size="ChipSize.Sm"\n\t\t\t\t:dropdown="!hasSelectedMcpAuth"\n\t\t\t\t:icon="defaultIcon"\n\t\t\t\t:image="mcpIcon"\n\t\t\t\t:design="chipDesign"\n\t\t\t\t:withClear="hasSelectedMcpAuth"\n\t\t\t\t@click="toggle"\n\t\t\t\t@clear="onChipClearClick"\n\t\t\t/>\n\t\t</span>\n\t`};class Lt{getEndpoint(){const t=O.Loc.getMessage("LANGUAGE_ID");const{serviceHealthUrl:e}=N.Core.getApplicationData();const n=new URL(e);n.searchParams.set("userLang",t);return n.toString()}async getServiceHealthStatus(){const t=this.getEndpoint();return new Promise((e=>{O.ajax.get(t,(t=>{let n={};try{n=JSON.parse(t)}catch{e(null);return}if(n.result!=="error"){e(null);return}e(n)}))}))}}const ft=18;const yt={components:{BIcon:b.BIcon},data(){return{isShow:false,title:"",text:""}},computed:{Color:()=>K.Color,OutlineIcons:()=>b.Outline,ICON_SIZE:()=>ft,isServiceHealthPanelShown(){return v.HealthCheckManager.getInstance().getIsShown()},processedTitle(){return BX.util.strip_tags(this.title)},processedText(){return BX.util.strip_tags(this.text)}},async created(){if(this.isServiceHealthPanelShown){return}const t=await(new Lt).getServiceHealthStatus();if(!t){return}this.setData(t);this.show()},methods:{setData(t){const{statusTitle:e,statusInfo:n}=t;this.title=e;this.text=n},show(){this.isShow=true},hide(){this.isShow=false;v.HealthCheckManager.getInstance().setIsShown(true)}},template:`\n\t\t<div v-if="isShow" class="bx-im-content-chat__service-health-panel">\n\t\t\t<div class="bx-im-content-chat__service-health-panel_content">\n\t\t\t\t<div\n\t\t\t\t\tv-if="processedTitle"\n\t\t\t\t\t:title="processedTitle"\n\t\t\t\t\tclass="bx-im-content-chat__service-health-panel_title --ellipsis"\n\t\t\t\t>\n\t\t\t\t\t{{ processedTitle }}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tv-if="processedText"\n\t\t\t\t\t:title="processedText"\n\t\t\t\t\tclass="bx-im-content-chat__service-health-panel_text --line-clamp-4"\n\t\t\t\t>\n\t\t\t\t\t{{ processedText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tclass="bx-im-content-chat__service-health-panel_close-button"\n\t\t\t\t@click="hide"\n\t\t\t>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="OutlineIcons.CROSS_M"\n\t\t\t\t\t:color="Color.white"\n\t\t\t\t\t:size="ICON_SIZE"\n\t\t\t\t\t:hoverable="false"\n\t\t\t\t/>\n\t\t\t</button>\n\t\t</div>\n\t`};const Ot={name:"AiAssistantBotContent",components:{BaseChatContent:D.BaseChatContent,ChatTextarea:z.ChatTextarea,ServiceHealthPanel:yt,McpIntegration:Bt},props:{dialogId:{type:String,required:true},withSidebar:{type:Boolean,default:true}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<BaseChatContent :dialogId="dialogId" :withSidebar="withSidebar" :withDropArea="false">\n\t\t\t<template #header v-if="$slots['header']">\n\t\t\t\t<slot name="header"></slot>\n\t\t\t</template>\n\t\t\t<template #sub-header>\n\t\t\t\t<ServiceHealthPanel />\n\t\t\t</template>\n\t\t\t<template #textarea="{ onTextareaMount }">\n\t\t\t\t<ChatTextarea\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t:key="dialogId"\n\t\t\t\t\t:placeholder="loc('IM_CONTENT_AIASSISTANT_TEXTAREA_PLACEHOLDER_MSGVER_1')"\n\t\t\t\t\t:withMarket="false"\n\t\t\t\t\t:withEdit="false"\n\t\t\t\t\t:withUploadMenu="false"\n\t\t\t\t\t:withSmileSelector="false"\n\t\t\t\t\t@mounted="onTextareaMount"\n\t\t\t\t>\n\t\t\t\t\t<template #bottom-panel-buttons>\n\t\t\t\t\t\t<McpIntegration />\n\t\t\t\t\t</template>\n\t\t\t\t</ChatTextarea>\n\t\t\t</template>\n\t\t</BaseChatContent>\n\t`};const Nt={name:"TaskCommentsContent",components:{BaseChatContent:D.BaseChatContent},props:{dialogId:{type:String,required:true}},template:`\n\t\t<BaseChatContent :dialogId="dialogId" />\n\t`};const xt={name:"FeatureBlock",props:{name:{type:String,required:true},title:{type:String,required:true},subtitle:{type:String,required:true}},template:`\n\t\t<div class="bx-im-content-chat-start__block">\n\t\t\t<div class="bx-im-content-chat-start__block_icon" :class="'--' + name"></div>\n\t\t\t<div class="bx-im-content-chat-start__block_content">\n\t\t\t\t<div class="bx-im-content-chat-start__block_title">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-content-chat-start__block_subtitle">\n\t\t\t\t\t{{ subtitle }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const Pt={group:"--group",chat:"--chat",list:"--list"};const wt={audio:"audio",messages:"messages",chat:"chat",collaboration:"collaboration",business:"business",result:"result"};const Dt={components:{FeatureBlock:xt},props:{text:{type:String,default:""},subtext:{type:String,default:""},backgroundId:{type:[String,Number],default:""},listItems:{type:Array,default:()=>[]},iconClassName:{type:String,default:""}},computed:{items(){return this.listItems},iconClass(){if(this.iconClassName){return this.iconClassName}return this.isEmptyRecent?Pt.group:Pt.chat},preparedText(){if(this.text){return this.text}if(this.isEmptyRecent){return this.loc("IM_CONTENT_CHAT_NO_CHATS_START_MESSAGE")}return this.loc("IM_CONTENT_CHAT_START_MESSAGE_V2")},preparedSubtext(){if(this.subtext){return this.subtext}return""},isEmptyRecent(){return E.LegacyRecentService.getInstance().getCollection().length===0},backgroundStyle(){if(O.Type.isStringFilled(this.backgroundId)||O.Type.isNumber(this.backgroundId)){return f.ThemeManager.getBackgroundStyleById(this.backgroundId)}return f.ThemeManager.getCurrentBackgroundStyle()}},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="bx-im-content-chat-start__container" :style="backgroundStyle">\n\t\t\t<div class="bx-im-content-chat-start__content">\n\t\t\t\t<div class="bx-im-content-chat-start__icon" :class="iconClass"></div>\n\t\t\t\t<div class="bx-im-content-chat-start__title">\n\t\t\t\t\t{{ preparedText }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if="preparedSubtext" class="bx-im-content-chat-start__subtitle">\n\t\t\t\t\t{{ preparedSubtext }}\n\t\t\t\t</div>\n\t\t\t\t<div v-if="items.length > 0" class="bx-im-content-chat-start__blocks">\n\t\t\t\t\t<FeatureBlock\n\t\t\t\t\t\tv-for="item in items"\n\t\t\t\t\t\t:name="item.name"\n\t\t\t\t\t\t:title="item.title"\n\t\t\t\t\t\t:subtitle="item.subtitle"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<slot name="bottom-content"></slot>\n\t\t\t</div>\n\t\t</div>\n\t`};const Rt={name:"ChannelEmptyState",components:{BaseEmptyState:Dt},computed:{text(){return this.loc("IM_CONTENT_CHANNEL_START_MESSAGE_V3")},subtext(){return this.loc("IM_CONTENT_CHANNEL_START_MESSAGE_SUBTITLE")}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<BaseEmptyState :text="text" :subtext="subtext" />\n\t`};const kt=[O.Loc.getMessage("IM_CONTENT_EMBEDDED_CHAT_START_TOOL_CHATS"),O.Loc.getMessage("IM_CONTENT_EMBEDDED_CHAT_START_TOOL_CALLS"),O.Loc.getMessage("IM_CONTENT_EMBEDDED_CHAT_START_TOOL_CHANNELS"),O.Loc.getMessage("IM_CONTENT_EMBEDDED_CHAT_START_TOOL_DOCS"),O.Loc.getMessage("IM_CONTENT_EMBEDDED_CHAT_START_TOOL_TASKS"),O.Loc.getMessage("IM_CONTENT_EMBEDDED_CHAT_START_TOOL_CALENDAR"),O.Loc.getMessage("IM_CONTENT_EMBEDDED_CHAT_START_TOOL_FILES"),O.Loc.getMessage("IM_CONTENT_EMBEDDED_CHAT_START_TOOL_BOARDS")];const Ht={name:"EmbeddedChatPromoEmptyState",computed:{SHOWCASE_TOOLS_PHRASES:()=>kt,canInviteUsers(){return B.FeatureManager.isFeatureAvailable(B.Feature.intranetInviteAvailable)},preparedTitle(){return O.Loc.getMessage("IM_CONTENT_EMBEDDED_CHAT_START_TITLE",{"[color]":'<span class="--brand-accent-with-icon">',"[/color]":"</span>"})},preparedInviteText(){const t="BX.Messenger.v2.Lib.InviteManager.openInviteSlider()";return O.Loc.getMessage("IM_CONTENT_EMBEDDED_CHAT_START_FEATURE_INVITE_MSGVER_2",{"[action]":`<span class="bx-im-embedded-promo-start__invite-action" onclick="${t}">`,"[/action]":"</span>"})}},mounted(){void S.PromoManager.getInstance().markAsWatched(K.PromoId.embeddedChatEmptyState)},methods:{loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="bx-im-embedded-promo-start__container">\n\t\t\t<div class="bx-im-embedded-promo-start__title" v-html="preparedTitle"></div>\n\t\t\t<div class="bx-im-embedded-promo-start__tools">\n\t\t\t\t<div\n\t\t\t\t\tv-for="tool in SHOWCASE_TOOLS_PHRASES"\n\t\t\t\t\t:key="tool"\n\t\t\t\t\tclass="bx-im-embedded-promo-start__tools_item"\n\t\t\t\t>{{ tool }}</div>\n\t\t\t</div>\n\t\t\t<div class="bx-im-embedded-promo-start__content">\n\t\t\t\t<div class="bx-im-embedded-promo-start__features">\n\t\t\t\t\t<div class="bx-im-embedded-promo-start__features_content">\n\t\t\t\t\t\t<div class="bx-im-embedded-promo-start__feature_item">\n\t\t\t\t\t\t\t<div class="bx-im-embedded-promo-start__feature_icon --people"></div>\n\t\t\t\t\t\t\t<div class="bx-im-embedded-promo-start__feature_text">{{ loc('IM_CONTENT_EMBEDDED_CHAT_START_FEATURE_EASE') }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-im-embedded-promo-start__feature_item">\n\t\t\t\t\t\t\t<div class="bx-im-embedded-promo-start__feature_icon --shield"></div>\n\t\t\t\t\t\t\t<div class="bx-im-embedded-promo-start__feature_text">{{ loc('IM_CONTENT_EMBEDDED_CHAT_START_FEATURE_SAFETY') }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-im-embedded-promo-start__feature_item">\n\t\t\t\t\t\t\t<div class="bx-im-embedded-promo-start__feature_icon --ai"></div>\n\t\t\t\t\t\t\t<div class="bx-im-embedded-promo-start__feature_text">{{ loc('IM_CONTENT_EMBEDDED_CHAT_START_FEATURE_AI') }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div v-if="canInviteUsers" v-html="preparedInviteText" class="bx-im-embedded-promo-start__invite_item"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="bx-im-embedded-promo-start__image"></div>\n\t\t\t</div>\n\t\t</div>\n\t`};const $t={name:"EmbeddedChatEmptyState",computed:{canInviteUsers(){return B.FeatureManager.isFeatureAvailable(B.Feature.intranetInviteAvailable)}},methods:{onInviteActionClick(){const t=x.Analytics.getInstance().sliderInvite.getEmptyStateContext();A.InviteManager.openInviteSlider(t)},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="bx-im-embedded-chat-start__container">\n\t\t\t<div class="bx-im-embedded-chat-start__image"></div>\n\t\t\t<div class="bx-im-embedded-chat-start__title">\n\t\t\t\t{{ loc('IM_CONTENT_EMBEDDED_CHAT_START_FEATURE_SUBTITLE') }}\n\t\t\t</div>\n\t\t\t<template v-if="canInviteUsers">\n\t\t\t\t<div class="bx-im-embedded-chat-start__separator_text">\n\t\t\t\t\t{{ loc('IM_CONTENT_EMBEDDED_CHAT_START_SEPARATOR_TEXT') }}\n\t\t\t\t</div>\n\t\t\t\t<div @click="onInviteActionClick" class="bx-im-embedded-chat-start__invite">\n\t\t\t\t\t{{ loc('IM_CONTENT_EMBEDDED_CHAT_START_INVITE_ACTION') }}\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const Ut={name:"CollabEmptyState",components:{ChatButton:G.ChatButton,BaseEmptyState:Dt},computed:{ButtonSize:()=>G.ButtonSize,IconClass:()=>Pt,SpecialBackground:()=>f.SpecialBackground,canCreateCollab(){const t=B.FeatureManager.isFeatureAvailable(B.Feature.collabCreationAvailable);const e=w.PermissionManager.getInstance().canPerformActionByUserType(K.ActionByUserType.createCollab);return t&&e},createButtonColorScheme(){return{borderColor:K.Color.transparent,backgroundColor:K.Color.white,iconColor:K.Color.gray90,textColor:K.Color.gray90,hoverColor:K.Color.white,textHoverColor:K.Color.collab70}},collaberEmptyStateListItems(){return[{title:this.loc("IM_CONTENT_COLLAB_START_BLOCK_COLLABER_TITLE_1"),subtitle:this.loc("IM_CONTENT_COLLAB_START_BLOCK_SUBTITLE_1"),name:wt.collaboration},{title:this.loc("IM_CONTENT_COLLAB_START_BLOCK_COLLABER_TITLE_2"),subtitle:this.loc("IM_CONTENT_COLLAB_START_BLOCK_COLLABER_SUBTITLE_2"),name:wt.business},{title:this.loc("IM_CONTENT_COLLAB_START_BLOCK_TITLE_3"),subtitle:this.loc("IM_CONTENT_COLLAB_START_BLOCK_SUBTITLE_3"),name:wt.result}]},baseEmptyStateListItems(){return[{title:this.loc("IM_CONTENT_COLLAB_START_BLOCK_TITLE_1"),subtitle:this.loc("IM_CONTENT_COLLAB_START_BLOCK_SUBTITLE_1"),name:wt.collaboration},{title:this.loc("IM_CONTENT_COLLAB_START_BLOCK_TITLE_2"),subtitle:this.loc("IM_CONTENT_COLLAB_START_BLOCK_SUBTITLE_2"),name:wt.business},{title:this.loc("IM_CONTENT_COLLAB_START_BLOCK_TITLE_3"),subtitle:this.loc("IM_CONTENT_COLLAB_START_BLOCK_SUBTITLE_3"),name:wt.result}]},emptyStateListItems(){if(this.isCurrentUserCollaber){return this.collaberEmptyStateListItems}return this.baseEmptyStateListItems},isCurrentUserCollaber(){const t=this.$store.getters["users/get"](N.Core.getUserId(),true);return t.type===K.UserType.collaber}},methods:{onCreateClick(){x.Analytics.getInstance().chatCreate.onCollabEmptyStateCreateClick();L.Messenger.openChatCreation(M.CreatableChat.collab)},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<BaseEmptyState\n\t\t\t:text="loc('IM_CONTENT_COLLAB_START_TITLE_V2')"\n\t\t\t:backgroundId="SpecialBackground.collab"\n\t\t\t:listItems="emptyStateListItems"\n\t\t\t:iconClassName="IconClass.list"\n\t\t>\n\t\t\t<template #bottom-content>\n\t\t\t\t<ChatButton\n\t\t\t\t\tv-if="canCreateCollab"\n\t\t\t\t\t:size="ButtonSize.XXL"\n\t\t\t\t\t:customColorScheme="createButtonColorScheme"\n\t\t\t\t\t:text="loc('IM_CONTENT_COLLAB_START_CREATE_BUTTON')"\n\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t@click="onCreateClick"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t</BaseEmptyState>\n\t`};const Xt="#fff";const Ft="#eee";const Kt="rgba(82, 92, 105, 0.9)";const zt={name:"CopilotEmptyState",components:{ChatButton:G.ChatButton},data(){return{isCreatingChat:false}},computed:{ButtonSize:()=>G.ButtonSize,backgroundStyle(){return f.ThemeManager.getBackgroundStyleById(f.SpecialBackground.copilot)},preparedText(){return this.loc("IM_CONTENT_COPILOT_EMPTY_STATE_MESSAGE_MSGVER_1",{"#BR#":"\n"})},buttonColorScheme(){return{borderColor:K.Color.transparent,backgroundColor:Xt,iconColor:Kt,textColor:Kt,hoverColor:Ft}}},methods:{async createDefaultChat(){this.isCreatingChat=true;try{const t=await this.getCopilotService().createDefaultChat();this.isCreatingChat=false;void L.Messenger.openCopilot(t)}catch{this.isCreatingChat=false}},getCopilotService(){if(!this.copilotService){this.copilotService=new y.CopilotService}return this.copilotService},loc(t,e={}){return this.$Bitrix.Loc.getMessage(t,e)}},template:`\n\t\t<div class="bx-im-content-copilot-empty-state__container" :style="backgroundStyle">\n\t\t\t<div class="bx-im-content-copilot-empty-state__content">\n\t\t\t\t<div class="bx-im-content-copilot-empty-state__icon"></div>\n\t\t\t\t<div class="bx-im-content-copilot-empty-state__text">{{ preparedText }}</div>\n\t\t\t\t<ChatButton\n\t\t\t\t\tclass="--black-loader"\n\t\t\t\t\t:size="ButtonSize.XL"\n\t\t\t\t\t:customColorScheme="buttonColorScheme"\n\t\t\t\t\t:text="loc('IM_CONTENT_COPILOT_EMPTY_STATE_ASK_QUESTION')"\n\t\t\t\t\t:isRounded="true"\n\t\t\t\t\t:isLoading="isCreatingChat"\n\t\t\t\t\t@click="createDefaultChat"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const Gt={name:"TaskFeatureListEmptyState",components:{BaseEmptyState:Dt},computed:{IconClass:()=>Pt,emptyStateListItems(){return[{title:this.loc("IM_CONTENT_TASK_START_FEATURE_LIST_BLOCK_TITLE_1"),subtitle:this.loc("IM_CONTENT_TASK_START_FEATURE_LIST_BLOCK_SUBTITLE_1"),name:wt.audio},{title:this.loc("IM_CONTENT_TASK_START_FEATURE_LIST_BLOCK_TITLE_2"),subtitle:this.loc("IM_CONTENT_TASK_START_FEATURE_LIST_BLOCK_SUBTITLE_2"),name:wt.messages},{title:this.loc("IM_CONTENT_TASK_START_FEATURE_LIST_BLOCK_TITLE_3"),subtitle:this.loc("IM_CONTENT_TASK_START_FEATURE_LIST_BLOCK_SUBTITLE_3"),name:wt.chat}]}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<BaseEmptyState\n\t\t\t:text="loc('IM_CONTENT_TASK_START_FEATURE_LIST_TITLE')"\n\t\t\t:listItems="emptyStateListItems"\n\t\t\t:iconClassName="IconClass.list"\n\t\t/>\n\t`};var qt=babelHelpers.classPrivateFieldLooseKey("getUserActivityFromPull");var jt=babelHelpers.classPrivateFieldLooseKey("requestUserData");var Vt=babelHelpers.classPrivateFieldLooseKey("updateUserModel");var Wt=babelHelpers.classPrivateFieldLooseKey("isPullServerWithUserStatusSupport");class Jt{constructor(){Object.defineProperty(this,Wt,{value:te});Object.defineProperty(this,Vt,{value:Qt});Object.defineProperty(this,jt,{value:Zt});Object.defineProperty(this,qt,{value:Yt})}async updateLastActivityDate(t){if(babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]()){const e=await babelHelpers.classPrivateFieldLooseBase(this,qt)[qt](t);if(!e){return}babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt](t,{lastActivityDate:e});return}const e=await babelHelpers.classPrivateFieldLooseBase(this,jt)[jt](t);babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt](t,e)}}async function Yt(t){const e=await N.Core.getPullClient().getUsersLastSeen([t]).catch((t=>{console.error("UserService: error getting user activity from P&P",t);throw t}));if(!O.Type.isNumber(e[t])){return null}const n=e[t]*1e3;return new Date(Date.now()-n)}async function Zt(t){H.Logger.warn(`UserService: get actual user data for - ${t}`);const e=await N.Core.getRestClient().callMethod(K.RestMethod.imUserGet,{ID:t}).catch((t=>{console.error("UserService: error getting user data",t.error())}));return e.data()}async function Qt(t,e){H.Logger.warn("UserService: update user data",e);void N.Core.getStore().dispatch("users/update",{id:t,fields:e})}function te(){return N.Core.getPullClient().isJsonRpc()}const ee={name:"ChatOpener",props:{dialogId:{type:String,required:true}},emits:["close"],computed:{layout(){return this.$store.getters["application/getLayout"]},dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},isUser(){return this.dialog.type===K.ChatType.user},isChannel(){return i.ChannelManager.isChannel(this.dialogId)},isCollab(){return this.dialog.type===K.ChatType.collab},isMultidialog(){return this.$store.getters["sidebar/multidialog/isSupport"](this.dialogId)},isNotes(){return this.$store.getters["chats/isNotes"](this.dialogId)},isCopilot(){return this.dialog.type===K.ChatType.copilot},isAiAssistantBot(){return this.$store.getters["users/bots/isAiAssistant"](this.dialogId)},isTaskComments(){return this.dialog.type===K.ChatType.taskComments},isGuest(){return this.dialog.role===K.UserRole.guest},contentComponentConfig(){return[{condition:this.isChannel,component:Y},{condition:this.isCollab,component:mt},{condition:this.isMultidialog,component:ut},{condition:this.isNotes,component:Ct},{condition:this.isCopilot,component:St},{condition:this.isAiAssistantBot,component:Ot},{condition:this.isTaskComments,component:Nt}]},contentComponent(){const t=this.contentComponentConfig.find((t=>t.condition===true));return t?t.component:D.BaseChatContent},emptyStateComponent(){var t;const e={[K.Layout.channel]:Rt,[K.Layout.collab]:Ut,[K.Layout.copilot]:zt,[K.Layout.chat]:this.chatEmptyStateComponent,[K.Layout.taskComments]:Gt,default:Dt};return(t=e[this.layout.name])!=null?t:e.default},chatEmptyStateComponent(){const t=o.LayoutManager.getInstance().isEmbeddedMode();const e=S.PromoManager.getInstance().needToShow(K.PromoId.embeddedChatEmptyState);if(!t){return Dt}return e?Ht:$t}},watch:{dialogId(t,e){H.Logger.warn(`ChatContent: switching from ${e||"empty"} to ${t}`);this.onChatChange()}},created(){if(!this.dialogId){return}this.onChatChange()},methods:{async onChatChange(){if(this.dialogId===""){return}if(a.Utils.dialog.isExternalId(this.dialogId)){const t=await this.getChatService().prepareDialogId(this.dialogId);void o.LayoutManager.getInstance().setLayout({name:K.Layout.chat,entityId:t,contextId:this.layout.contextId});return}if(this.dialog.inited){H.Logger.warn(`ChatContent: chat ${this.dialogId} is already loaded`);if(this.isUser){const t=parseInt(this.dialog.dialogId,10);this.getUserService().updateLastActivityDate(t)}else if(this.isChannel&&!this.isGuest){H.Logger.warn(`ChatContent: channel ${this.dialogId} is loaded, loading comments metadata`);void this.getChatService().loadCommentInfo(this.dialogId)}x.Analytics.getInstance().onOpenChat(this.dialog);return}if(this.dialog.loading){H.Logger.warn(`ChatContent: chat ${this.dialogId} is loading`);return}if(this.layout.contextId){await this.loadChatWithContext();x.Analytics.getInstance().onOpenChat(this.dialog);return}await this.loadChat();x.Analytics.getInstance().onOpenChat(this.dialog)},async loadChatWithContext(){H.Logger.warn(`ChatContent: loading chat ${this.dialogId} with context - ${this.layout.contextId}`);await this.getChatService().loadChatWithContext(this.dialogId,this.layout.contextId).catch((t=>{this.sendAnalytics(t);L.Messenger.openChat()}));H.Logger.warn(`ChatContent: chat ${this.dialogId} is loaded with context of ${this.layout.contextId}`)},async loadChat(){H.Logger.warn(`ChatContent: loading chat ${this.dialogId}`);await this.getChatService().loadChatWithMessages(this.dialogId).catch((()=>{L.Messenger.openChat()}));H.Logger.warn(`ChatContent: chat ${this.dialogId} is loaded`)},sendAnalytics(t){if(t.code!==K.ErrorCode.message.notFound){return}x.Analytics.getInstance().messageDelete.onNotFoundNotification({dialogId:this.dialogId})},getChatService(){if(!this.chatService){this.chatService=new q.ChatService}return this.chatService},getUserService(){if(!this.userService){this.userService=new Jt}return this.userService},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-default-chat__container">\n\t\t\t<component :is="emptyStateComponent" v-if="!dialogId" />\n\t\t\t<component :is="contentComponent" v-else :dialogId="dialogId" />\n\t\t</div>\n\t`};const ne={name:"SubscribeToggle",components:{Toggle:R.Toggle},props:{dialogId:{type:String,required:true}},data(){return{}},computed:{ToggleSize:()=>R.ToggleSize,dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},postMessageId(){return this.$store.getters["messages/comments/getMessageIdByChatId"](this.dialog.chatId)},isSubscribed(){return this.$store.getters["messages/comments/isUserSubscribed"](this.postMessageId)}},methods:{onToggleClick(){if(this.isSubscribed){k.CommentsService.unsubscribe(this.postMessageId);return}k.CommentsService.subscribe(this.postMessageId)},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div @click="onToggleClick" class="bx-im-comments-header-follow__container">\n\t\t\t<div class="bx-im-comments-header-follow__text">{{ loc('IM_CONTENT_COMMENTS_FOLLOW_TOGGLE_TEXT') }}</div>\n\t\t\t<Toggle :size="ToggleSize.M" :isEnabled="isSubscribed" />\n\t\t</div>\n\t`};const oe={name:"CommentsHeader",components:{ChatHeader:D.ChatHeader,ChatAvatar:P.ChatAvatar,SubscribeToggle:ne},props:{dialogId:{type:String,default:""},channelId:{type:String,required:true}},computed:{AvatarSize:()=>P.AvatarSize,channel(){return this.$store.getters["chats/get"](this.channelId,true)},showSubscribeToggle(){return w.PermissionManager.getInstance().canPerformActionByRole(K.ActionByRole.subscribeToComments,this.dialogId)}},methods:{onBackClick(){this.getEmitter().emit(K.EventType.dialog.closeComments)},getEmitter(){return this.$Bitrix.eventEmitter},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<ChatHeader\n\t\t\t:dialogId="dialogId"\n\t\t\tclass="bx-im-comment-header__container"\n\t\t>\n\t\t\t<template #left>\n\t\t\t\t<div @click="onBackClick" class="bx-im-comment-header__back"></div>\n\t\t\t\t<div class="bx-im-comment-header__info">\n\t\t\t\t\t<div class="bx-im-comment-header__title">{{ loc('IM_CONTENT_COMMENTS_HEADER_TITLE') }}</div>\n\t\t\t\t\t<div class="bx-im-comment-header__subtitle">\n\t\t\t\t\t\t<div class="bx-im-comment-header__subtitle_avatar">\n\t\t\t\t\t\t\t<ChatAvatar :avatarDialogId="channelId" :size="AvatarSize.XS" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bx-im-comment-header__subtitle_text">{{ channel.name }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-if="showSubscribeToggle" #before-actions>\n\t\t\t\t<SubscribeToggle :dialogId="dialogId" />\n\t\t\t</template>\n\t\t</ChatHeader>\n\t`};const ae={name:"CommentsDialogLoader",data(){return{}},methods:{loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-comments-dialog-loader__container">\n\t\t\t<div class="bx-im-comments-dialog-loader__spinner"></div>\n\t\t</div>\n\t`};const ie={name:"CommentsMessageList",components:{MessageList:X.MessageList,CommentsDialogLoader:ae,AuthorGroup:X.AuthorGroup,...X.MessageComponents},props:{dialogId:{type:String,required:true}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},showPostMessage(){return this.dialog.inited&&!this.dialog.hasPrevPage},postMessageId(){return this.$store.getters["messages/comments/getMessageIdByChatId"](this.dialog.chatId)},postMessage(){return this.$store.getters["messages/getById"](this.postMessageId)},postAuthorGroup(){if(!this.dialog.inited){return null}const t=new X.CollectionManager(this.dialogId);return t.formatAuthorGroup(this.postMessage)}},methods:{getMessageComponentName(t){return new F.MessageComponentManager(t).getName()}},template:`\n\t\t<MessageList\n\t\t\t:dialogId="dialogId"\n\t\t\tref="messageList"\n\t\t>\n\t\t\t<template #loader>\n\t\t\t\t<CommentsDialogLoader />\n\t\t\t</template>\n\t\t\t<template v-if="showPostMessage" #before-messages>\n\t\t\t\t<div class="bx-im-comments-message-list__channel-post">\n\t\t\t\t\t<AuthorGroup :item="postAuthorGroup" :contextDialogId="dialogId" :withAvatarMenu="false">\n\t\t\t\t\t\t<template #message>\n\t\t\t\t\t\t\t<component\n\t\t\t\t\t\t\t\t:is="getMessageComponentName(postMessage)"\n\t\t\t\t\t\t\t\t:item="postMessage"\n\t\t\t\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t\t\t\t:key="postMessage.id"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</component>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</AuthorGroup>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</MessageList>\n\t`};const se={name:"CommentsDialog",components:{ChatDialog:U.ChatDialog,CommentsMessageList:ie,PinnedMessages:U.PinnedMessages},props:{dialogId:{type:String,required:true}},computed:{dialog(){return this.$store.getters["chats/get"](this.dialogId,true)},dialogInited(){return this.dialog.inited},postMessageId(){return this.$store.getters["messages/comments/getMessageIdByChatId"](this.dialog.chatId)},postMessage(){return this.$store.getters["messages/getById"](this.postMessageId)}},methods:{async goToPostMessageContext(){const t=this.$refs.dialog;const e=this.dialogInited&&!this.dialog.hasPrevPage;if(e){await t.getScrollManager().animatedScrollToMessage(this.postMessageId);t.highlightMessage(this.postMessageId);return}t.showLoadingBar();await t.getMessageService().loadFirstPage();await this.$nextTick();t.hideLoadingBar();t.getScrollManager().scrollToMessage(this.postMessageId);await this.$nextTick();t.highlightMessage(this.postMessageId)},onPinnedPostMessageClick(){this.goToPostMessageContext()}},template:`\n\t\t<ChatDialog ref="dialog" :dialogId="dialogId" :saveScrollOnExit="false" :clearOnExit="true">\n\t\t\t<template v-if="dialogInited" #pinned-panel>\n\t\t\t\t<PinnedMessages\n\t\t\t\t\t:dialogId="dialogId"\n\t\t\t\t\t:messages="[postMessage]"\n\t\t\t\t\t@messageClick="onPinnedPostMessageClick"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<template #message-list>\n\t\t\t\t<CommentsMessageList :dialogId="dialogId" />\n\t\t\t</template>\n\t\t</ChatDialog>\n\t`};const re={name:"CommentsTextarea",components:{ChatTextarea:z.ChatTextarea},props:{dialogId:{type:String,default:""}},template:`\n\t\t<ChatTextarea\n\t\t\t:dialogId="dialogId"\n\t\t\t:withMarket="false"\n\t\t\tclass="bx-im-comments-send-panel__container"\n\t\t/>\n\t`};const le={components:{ChatButton:G.ChatButton},props:{dialogId:{type:String,required:true}},computed:{ButtonSize:()=>G.ButtonSize,ButtonColor:()=>G.ButtonColor},methods:{onButtonClick(){this.getChatService().joinChat(this.dialogId)},getChatService(){if(!this.chatService){this.chatService=new q.ChatService}return this.chatService},loc(t){return this.$Bitrix.Loc.getMessage(t)}},template:`\n\t\t<div class="bx-im-content-chat__textarea_placeholder">\n\t\t\t<ChatButton\n\t\t\t\t:size="ButtonSize.XL"\n\t\t\t\t:color="ButtonColor.Primary"\n\t\t\t\t:text="loc('IM_CONTENT_BLOCKED_TEXTAREA_JOIN_CHANNEL_V2')"\n\t\t\t\t:isRounded="true"\n\t\t\t\t@click="onButtonClick"\n\t\t\t/>\n\t\t</div>\n\t`};const de={name:"CommentsContent",components:{BaseChatContent:D.BaseChatContent,CommentsHeader:oe,CommentsDialog:se,CommentsTextarea:re,JoinPanel:le},props:{dialogId:{type:String,required:true},channelId:{type:String,required:true}},template:`\n\t\t<BaseChatContent :dialogId="dialogId">\n\t\t\t<template #header>\n\t\t\t\t<CommentsHeader :dialogId="dialogId" :channelId="channelId" :key="dialogId" />\n\t\t\t</template>\n\t\t\t<template #dialog>\n\t\t\t\t<CommentsDialog :dialogId="dialogId" :key="dialogId" />\n\t\t\t</template>\n\t\t\t<template #join-panel>\n\t\t\t\t<JoinPanel :dialogId="dialogId" />\n\t\t\t</template>\n\t\t\t<template #textarea="{ onTextareaMount }">\n\t\t\t\t<CommentsTextarea :dialogId="dialogId" :key="dialogId" @mounted="onTextareaMount" />\n\t\t\t</template>\n\t\t</BaseChatContent>\n\t`};const ce={name:"CommentsOpener",components:{CommentsContent:de},props:{postId:{type:Number,required:true},channelId:{type:String,required:true}},emits:["close"],data(){return{}},computed:{dialog(){return this.$store.getters["chats/getByChatId"](this.commentsChatId)},commentInfo(){return this.$store.getters["messages/comments/getByMessageId"](this.postId)},commentsChatId(){return this.commentInfo.chatId},commentsDialogId(){if(!this.dialog){return""}return this.dialog.dialogId}},created(){this.onCreated()},methods:{async onCreated(){await this.loadChat();x.Analytics.getInstance().onOpenChat(this.dialog)},async loadChat(){H.Logger.warn(`CommentsContent: loading comments for post ${this.postId}`);await this.getChatService().loadComments(this.postId).catch((()=>{this.$emit("close")}));H.Logger.warn(`CommentsContent: comments for post ${this.postId} are loaded`)},getChatService(){if(!this.chatService){this.chatService=new q.ChatService}return this.chatService}},template:`\n\t\t<div class="bx-im-content-comments__container">\n\t\t\t<CommentsContent :dialogId="commentsDialogId" :channelId="channelId" />\n\t\t</div>\n\t`};const he={name:"ChatContent",components:{ChatOpener:ee,CommentsOpener:ce},props:{entityId:{type:String,default:""}},data(){return{commentsPostId:0,commentsAnimationFlag:false}},computed:{layout(){return this.$store.getters["application/getLayout"]},showComments(){return this.$store.getters["messages/comments/areOpened"]}},watch:{layout(){this.closeComments()}},created(){e.EventEmitter.subscribe(K.EventType.dialog.closeComments,this.onCloseComments);this.getEmitter().subscribe(K.EventType.dialog.openComments,this.onOpenComments);this.getEmitter().subscribe(K.EventType.dialog.closeComments,this.onCloseComments)},beforeUnmount(){e.EventEmitter.unsubscribe(K.EventType.dialog.closeComments,this.onCloseComments);this.getEmitter().unsubscribe(K.EventType.dialog.openComments,this.onOpenComments);this.getEmitter().unsubscribe(K.EventType.dialog.closeComments,this.onCloseComments)},methods:{onOpenComments(t){const{messageId:e}=t.getData();this.commentsPostId=e;this.commentsAnimationFlag=true;this.$store.dispatch("messages/comments/setOpened",{channelDialogId:this.entityId,commentsPostId:this.commentsPostId})},onCloseComments(){this.closeComments()},closeComments(){this.commentsPostId=0;this.$store.dispatch("messages/comments/setClosed")},onCommentsAnimationEnd(){this.commentsAnimationFlag=false},getEmitter(){return this.$Bitrix.eventEmitter}},template:`\n\t\t<ChatOpener :dialogId="entityId" :class="{'--comments-show-animation': commentsAnimationFlag}" />\n\t\t<Transition name="comments-content" @after-enter="onCommentsAnimationEnd">\n\t\t\t<CommentsOpener\n\t\t\t\tv-if="showComments"\n\t\t\t\t:postId="commentsPostId"\n\t\t\t\t:channelId="entityId"\n\t\t\t/>\n\t\t</Transition>\n\t`};t.ChatContent=he;t.AiAssistantBotContent=Ot})(this.BX.Messenger.v2.Component.Content=this.BX.Messenger.v2.Component.Content||{},BX.Event,BX,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Component.Animation,BX.UI.Dialogs,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.EntitySelector,BX.Main,BX.Messenger.v2.Component.Elements,BX.Vue3.Directives,BX.UI.IconSet,BX.UI.System.Chip.Vue,BX.AiAssistant,BX.UI.IconSet,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Content,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Lib,BX.Messenger.v2.Component.Content,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Model,BX.Messenger.v2.Component.Dialog,BX.Messenger.v2.Component,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Component,BX.Messenger.v2.Component.Elements,BX.Messenger.v2.Service);
//# sourceMappingURL=chat-content.bundle.map.js