{"version":3,"file":"sidebar.bundle.js","sources":["../src/classes/panels/helpers/get-chat-id.js","../src/classes/panels/helpers/get-last-element-id.js","../src/classes/panels/favorite.js","../src/classes/panels/link.js","../src/classes/panels/file.js","../src/classes/panels/task.js","../src/classes/panels/meeting.js","../src/classes/panels/members.js","../src/classes/panels/multidialog.js","../src/classes/panels/file-unsorted.js","../src/classes/panels/main.js","../src/classes/context-menu/main/main-menu.js","../src/components/panels/main/components/header.js","../src/components/elements/chat-links/chat-links.js","../src/components/elements/chat-favourites/chat-favourites.js","../src/components/elements/chat-description/chat-description.js","../src/components/elements/chat-shared/chat-shared.js","../src/components/panels/main/blocks/info.js","../src/components/panels/file/components/file-preview-item.js","../src/components/elements/detail-empty-state/detail-empty-state.js","../src/components/panels/main/blocks/file-list.js","../src/classes/context-menu/sidebar-base-menu.js","../src/classes/context-menu/task/task-manager.js","../src/classes/context-menu/task/task-menu.js","../src/components/panels/task/task-item.js","../src/components/panels/main/blocks/task-list.js","../src/components/elements/market-item/market-item.js","../src/components/panels/main/blocks/market-app-list.js","../src/classes/context-menu/meeting/meeting-manager.js","../src/classes/context-menu/meeting/meeting-menu.js","../src/components/panels/meeting/meeting-item.js","../src/components/panels/main/blocks/meeting-list.js","../src/components/panels/main/blocks/copilot-info.js","../src/components/elements/mute-chat/mute-chat.js","../src/components/elements/auto-delete/auto-delete.js","../src/components/elements/chat-members-avatars/chat-members-avatars.js","../src/components/panels/main/blocks/chat.js","../src/components/panels/main/blocks/post.js","../src/components/panels/main/blocks/user.js","../src/components/elements/copilot-role/classes/copilot-service.js","../src/components/elements/copilot-role/components/change-role-promo.js","../src/components/elements/copilot-role/copilot-role.js","../src/components/elements/ai-model/classes/copilot-ai-model-service.js","../src/components/elements/ai-model/ai-model-item.js","../src/components/elements/ai-model/ai-model-popup-content.js","../src/components/elements/ai-model/ai-model-popup.js","../src/components/elements/ai-model/ai-model.js","../src/components/panels/main/blocks/copilot.js","../src/components/panels/main/blocks/support.js","../src/components/panels/main/blocks/multidialog.js","../src/components/elements/tariff-limit/tariff-limit.js","../src/components/panels/main/blocks/tariff-limit.js","../src/components/panels/main/blocks/collab-helpdesk.js","../src/components/panels/main/blocks/notes.js","../src/components/panels/main/blocks/task.js","../src/components/panels/main/blocks/task-comments-history.js","../src/components/panels/main/config/component-map.js","../src/components/elements/skeleton/skeleton.js","../src/components/panels/main/main-panel.js","../src/classes/panels/helpers/concat-and-sort-search-result.js","../src/classes/panels/search/task-search.js","../src/components/elements/date-group/date-group.js","../src/components/elements/detail-header/detail-header.js","../src/components/elements/detail-empty-search-state/detail-empty-search-state.js","../src/classes/sidebar-collection-formatter.js","../src/components/panels/task/task-panel.js","../src/components/panels/file/components/detail-tabs.js","../src/classes/panels/search/file-search.js","../src/components/panels/file/components/media-detail-item.js","../src/classes/context-menu/file/file-manager.js","../src/classes/context-menu/file/file-menu.js","../src/components/panels/file/components/media-tab.js","../src/components/panels/file/components/audio-detail-item.js","../src/components/panels/file/components/audio-tab.js","../src/components/panels/file/components/brief-item.js","../src/components/panels/file/components/brief-tab.js","../src/components/panels/file/components/file-detail-item.js","../src/components/panels/file/components/file-tab.js","../src/components/panels/file/file-panel.js","../src/components/panels/file-unsorted/file-unsorted-panel.js","../src/components/panels/info/link-item.js","../src/classes/panels/search/link-search.js","../src/classes/context-menu/link/link-manager.js","../src/classes/context-menu/link/link-menu.js","../src/components/panels/info/link-panel.js","../src/components/panels/market/detail.js","../src/classes/panels/search/meeting-search.js","../src/components/panels/meeting/meeting-panel.js","../src/components/panels/members/detail-user.js","../src/classes/context-menu/main/members-menu.js","../src/components/panels/members/members-panel.js","../src/classes/context-menu/favorite/favorite-menu.js","../src/classes/panels/search/favorite-search.js","../src/components/panels/info/favorite-item.js","../src/components/panels/info/favorite-panel.js","../src/classes/panels/search/message-search.js","../src/components/panels/message-search/search-item.js","../src/components/panels/message-search/search-header.js","../src/components/panels/message-search/message-search-panel.js","../src/components/panels/chats-with-user/chat-item.js","../src/classes/panels/chats-with-user.js","../src/components/panels/chats-with-user/chats-with-user-panel.js","../src/components/panels/multidialog/multidialog-item.js","../src/components/panels/multidialog/multidialog-panel.js","../src/components/sidebar-panel.js","../src/sidebar.js"],"sourcesContent":["import { Core } from 'im.v2.application.core';\n\nexport function getChatId(dialogId: string): number\n{\n\tconst dialog = Core.getStore().getters['chats/get'](dialogId, true);\n\n\treturn dialog.chatId;\n}\n","import { Type } from 'main.core';\n\nexport function getLastElementId(collection: {id: number}[], sort: 'ASC' | 'DESC' = 'ASC'): ?number\n{\n\tif (collection.length === 0)\n\t{\n\t\treturn null;\n\t}\n\n\tcollection.sort((a, b) => {\n\t\tif (sort === 'ASC')\n\t\t{\n\t\t\treturn a.id - b.id;\n\t\t}\n\n\t\treturn b.id - a.id;\n\t});\n\n\tconst [lastCollectionItem] = collection;\n\n\tif (Type.isNumber(lastCollectionItem.id))\n\t{\n\t\treturn lastCollectionItem.id;\n\t}\n\n\treturn null;\n}\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport { getChatId } from './helpers/get-chat-id';\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\nexport class Favorite\n{\n\tstore: Store;\n\tdialogId: string;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imChatFavoriteCounterGet]: { chat_id: this.chatId },\n\t\t\t[RestMethod.imChatFavoriteGet]: { chat_id: this.chatId, limit: REQUEST_ITEMS_LIMIT },\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imChatFavoriteCounterGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\tconst favoriteCounterGetResponse = response[RestMethod.imChatFavoriteCounterGet];\n\t\t\tconst setCounterResult = this.store.dispatch('sidebar/favorites/setCounter', {\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tcounter: favoriteCounterGetResponse.counter,\n\t\t\t});\n\n\t\t\tconst setFavoriteResult = this.handleResponse(response[RestMethod.imChatFavoriteGet]);\n\n\t\t\treturn Promise.all([setCounterResult, setFavoriteResult]);\n\t\t};\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(): Object\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/favorites/getLastId'](this.chatId);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imChatFavoriteGet, queryParams).then((response) => {\n\t\t\treturn this.handleResponse(response.data());\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: Im.imChatFavoriteGet: page request error', error);\n\t\t});\n\t}\n\n\thandleResponse(response): Promise\n\t{\n\t\treturn this.updateModels(response);\n\t}\n\n\tupdateModels(resultData: {list: [], users: [], files: []}): Promise\n\t{\n\t\tconst { list = [], users = [], files = [], tariffRestrictions = {} } = resultData;\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\n\t\tconst rawMessages = list.map((favorite) => favorite.message);\n\t\tconst hasNextPage = list.length === REQUEST_ITEMS_LIMIT;\n\t\tconst lastId = getLastElementId(list);\n\n\t\tconst setFilesPromise = this.store.dispatch('files/set', files);\n\t\tconst storeMessagesPromise = this.store.dispatch('messages/store', rawMessages);\n\t\tconst setFavoritesPromise = this.store.dispatch('sidebar/favorites/set', {\n\t\t\tchatId: this.chatId,\n\t\t\tfavorites: list,\n\t\t\thasNextPage,\n\t\t\tlastId,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\n\t\treturn Promise.all([\n\t\t\tsetFilesPromise, storeMessagesPromise, setFavoritesPromise, addUsersPromise,\n\t\t]);\n\t}\n}\n","import { Type } from 'main.core';\n\nimport { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from './helpers/get-chat-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\ntype UrlGetQueryParams = {\n\tCHAT_ID: number,\n\tLIMIT: number,\n\tOFFSET?: number\n}\n\nexport class Link\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[string]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imChatUrlCounterGet]: { chat_id: this.chatId },\n\t\t\t[RestMethod.imChatUrlGet]: { chat_id: this.chatId, limit: REQUEST_ITEMS_LIMIT },\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imChatUrlCounterGet] || !response[RestMethod.imChatUrlGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\tconst urlGetResult = this.handleUrlGetResponse(response[RestMethod.imChatUrlGet]);\n\t\t\tconst counterGetResult = this.handleCounterGetResponse(response[RestMethod.imChatUrlCounterGet]);\n\n\t\t\treturn Promise.all([urlGetResult, counterGetResult]);\n\t\t};\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst linksCount = this.getLinksCountFromModel();\n\t\tif (linksCount === 0)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams(linksCount);\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(offset: number = 0): UrlGetQueryParams\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tif (Type.isNumber(offset) && offset > 0)\n\t\t{\n\t\t\tqueryParams.OFFSET = offset;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams: UrlGetQueryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imChatUrlGet, queryParams).then((response) => {\n\t\t\treturn this.handleUrlGetResponse(response.data());\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: Im.chatUrlList: page request error', error);\n\t\t});\n\t}\n\n\thandleUrlGetResponse(response: {list: [], users: []}): Promise\n\t{\n\t\tconst { list, users, tariffRestrictions = {} } = response;\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setLinksPromise = this.store.dispatch('sidebar/links/set', {\n\t\t\tchatId: this.chatId,\n\t\t\tlinks: list,\n\t\t\thasNextPage: list.length === REQUEST_ITEMS_LIMIT,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\n\t\treturn Promise.all([setLinksPromise, addUsersPromise]);\n\t}\n\n\thandleCounterGetResponse(response: {counter: number}): Promise\n\t{\n\t\tconst counter = response.counter;\n\n\t\treturn this.store.dispatch('sidebar/links/setCounter', {\n\t\t\tchatId: this.chatId,\n\t\t\tcounter,\n\t\t});\n\t}\n\n\tgetLinksCountFromModel(): number\n\t{\n\t\treturn this.store.getters['sidebar/links/getSize'](this.chatId);\n\t}\n}\n","import { Type } from 'main.core';\n\nimport { RestMethod, SidebarFileGroups } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from './helpers/get-chat-id';\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\n\ntype QueryParams = {\n\tCHAT_ID: number,\n\tGROUP: string,\n\tLIMIT: number,\n\tLAST_ID?: number,\n}\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\nexport class File\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imChatFileCollectionGet]: { chat_id: this.chatId, limit: REQUEST_ITEMS_LIMIT },\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imChatFileCollectionGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\treturn this.updateModels(response[RestMethod.imChatFileCollectionGet]);\n\t\t};\n\t}\n\n\tupdateModels(resultData, group: string = ''): Promise\n\t{\n\t\tconst { list, users, files, tariffRestrictions = {} } = resultData;\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\t\tconst historyLimitPromise = this.store.dispatch('sidebar/files/setHistoryLimitExceeded', {\n\t\t\tchatId: this.chatId,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\n\t\tif (group && !Type.isArrayFilled(list))\n\t\t{\n\t\t\treturn this.store.dispatch('sidebar/files/setHasNextPage', {\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tgroup,\n\t\t\t\thasNextPage: false,\n\t\t\t});\n\t\t}\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setFilesPromise = this.store.dispatch('files/set', files);\n\n\t\tconst sortedGroups = {};\n\t\tlist.forEach((file) => {\n\t\t\tconst fileGroup = file.group ?? SidebarFileGroups.fileUnsorted;\n\t\t\tif (!sortedGroups[fileGroup])\n\t\t\t{\n\t\t\t\tsortedGroups[fileGroup] = [];\n\t\t\t}\n\t\t\tsortedGroups[fileGroup].push(file);\n\t\t});\n\n\t\tconst setSidebarFilesPromises = [];\n\t\tObject.entries(sortedGroups).forEach(([groupName, listByGroup]) => {\n\t\t\tsetSidebarFilesPromises.push(\n\t\t\t\tthis.store.dispatch('sidebar/files/set', {\n\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\tfiles: listByGroup,\n\t\t\t\t\tgroup: groupName,\n\t\t\t\t}),\n\t\t\t\tthis.store.dispatch('sidebar/files/setHasNextPage', {\n\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\tgroup: groupName,\n\t\t\t\t\thasNextPage: listByGroup.length === REQUEST_ITEMS_LIMIT,\n\t\t\t\t}),\n\t\t\t\tthis.store.dispatch('sidebar/files/setLastId', {\n\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\tgroup: groupName,\n\t\t\t\t\tlastId: getLastElementId(listByGroup),\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\n\t\treturn Promise.all([\n\t\t\tsetFilesPromise, addUsersPromise, historyLimitPromise, ...setSidebarFilesPromises,\n\t\t]);\n\t}\n\n\tloadFirstPage(group: string): Promise\n\t{\n\t\treturn this.loadFirstPageByGroup(group);\n\t}\n\n\tloadNextPage(group: string): Promise\n\t{\n\t\treturn this.loadNextPageByGroup(group);\n\t}\n\n\tloadFirstPageByGroup(group: string): Promise\n\t{\n\t\tconst filesCount = this.getFilesCountFromModel(group);\n\t\tif (filesCount > REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams(group);\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tloadNextPageByGroup(group: string): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams(group);\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(group: string): QueryParams\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tGROUP: group,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/files/getLastId'](this.chatId, group);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams: QueryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imChatFileGet, queryParams).then((response) => {\n\t\t\treturn this.updateModels(response.data(), queryParams.GROUP);\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: imChatFileGet: page request error', error);\n\t\t});\n\t}\n\n\tgetFilesCountFromModel(group): number\n\t{\n\t\treturn this.store.getters['sidebar/files/getSize'](this.chatId, group);\n\t}\n}\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from './helpers/get-chat-id';\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\nexport class Task\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imChatTaskGet]: { chat_id: this.chatId, limit: REQUEST_ITEMS_LIMIT },\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imChatTaskGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\treturn this.updateModels(response[RestMethod.imChatTaskGet]);\n\t\t};\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\tconst tasksCount = this.getTasksCountFromModel();\n\t\tif (tasksCount > REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(): Object\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/tasks/getLastId'](this.chatId);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imChatTaskGet, queryParams).then((response) => {\n\t\t\treturn this.updateModels(response.data());\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: Im.imChatFavoriteGet: page request error', error);\n\t\t});\n\t}\n\n\tupdateModels(resultData): Promise\n\t{\n\t\tconst { list, users, tariffRestrictions = {} } = resultData;\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\t\tconst hasNextPage = list.length === REQUEST_ITEMS_LIMIT;\n\t\tconst lastId = getLastElementId(list);\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setTasksPromise = this.store.dispatch('sidebar/tasks/set', {\n\t\t\tchatId: this.chatId,\n\t\t\ttasks: list,\n\t\t\thasNextPage,\n\t\t\tlastId,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\n\t\treturn Promise.all([setTasksPromise, addUsersPromise]);\n\t}\n\n\tgetTasksCountFromModel(): number\n\t{\n\t\treturn this.store.getters['sidebar/tasks/getSize'](this.chatId);\n\t}\n}\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from './helpers/get-chat-id';\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\nexport class Meeting\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imChatCalendarGet]: {\n\t\t\t\tchat_id: this.chatId,\n\t\t\t\tlimit: REQUEST_ITEMS_LIMIT,\n\t\t\t},\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imChatCalendarGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\treturn this.updateModels(response[RestMethod.imChatCalendarGet]);\n\t\t};\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\tconst meetingsCount = this.getMeetingsCountFromState();\n\t\tif (meetingsCount > REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(): Object\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/meetings/getLastId'](this.chatId);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imChatCalendarGet, queryParams).then((response) => {\n\t\t\treturn this.updateModels(response.data());\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: Im.imChatCalendarGet: page request error', error);\n\t\t});\n\t}\n\n\tupdateModels(resultData): Promise\n\t{\n\t\tconst { list, users, tariffRestrictions = {} } = resultData;\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\n\t\tconst hasNextPage = list.length === REQUEST_ITEMS_LIMIT;\n\t\tconst lastId = getLastElementId(list);\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setMeetingsPromise = this.store.dispatch('sidebar/meetings/set', {\n\t\t\tchatId: this.chatId,\n\t\t\tmeetings: list,\n\t\t\thasNextPage,\n\t\t\tlastId,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\n\t\treturn Promise.all([setMeetingsPromise, addUsersPromise]);\n\t}\n\n\tgetMeetingsCountFromState(): number\n\t{\n\t\treturn this.store.getters['sidebar/meetings/getSize'](this.chatId);\n\t}\n}\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from './helpers/get-chat-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\nimport type { RawUser } from 'im.v2.provider.service';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\ntype QueryParams = {\n\tdialogId: string,\n\tlimit: number,\n\tcursor?: MembersPaginationCursor,\n};\n\ntype MembersRestResult = {\n\tusers: RawUser[],\n\tnextCursor: MembersPaginationCursor | null,\n};\n\ntype MembersPaginationCursor = JsonObject;\n\nexport class MembersService\n{\n\tstore: Store;\n\tdialogId: string;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imV2ChatMemberTail]: {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tlimit: REQUEST_ITEMS_LIMIT,\n\t\t\t},\n\t\t};\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\tconst membersCount = this.getMembersCountFromModel();\n\t\tif (membersCount > REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(): QueryParams\n\t{\n\t\tconst queryParams = {\n\t\t\tdialogId: this.dialogId,\n\t\t\tlimit: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst nextCursor = this.store.getters['sidebar/members/getNextCursor'](this.chatId);\n\t\tif (nextCursor)\n\t\t{\n\t\t\tqueryParams.cursor = nextCursor;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\tasync requestPage(queryParams: QueryParams): Promise\n\t{\n\t\tlet restResult: MembersRestResult = {};\n\n\t\ttry\n\t\t{\n\t\t\tconst response = await this.restClient.callMethod(RestMethod.imV2ChatMemberTail, queryParams);\n\t\t\trestResult = response.data();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('SidebarMain: Im.DialogUsersList: page request error', error);\n\t\t}\n\n\t\treturn this.updateModels(restResult);\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\treturn this.updateModels(response[RestMethod.imV2ChatMemberTail]);\n\t\t};\n\t}\n\n\tupdateModels(restResult: MembersRestResult): Promise\n\t{\n\t\tconst { users, nextCursor } = restResult;\n\n\t\tconst userIds = [];\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tusers.forEach((user) => {\n\t\t\tuserIds.push(user.id);\n\t\t});\n\n\t\tconst setMembersPromise = this.store.dispatch('sidebar/members/set', {\n\t\t\tchatId: this.chatId,\n\t\t\tusers: userIds,\n\t\t\thasNextPage: users.length === REQUEST_ITEMS_LIMIT,\n\t\t});\n\n\t\tlet cursorPromise = Promise.resolve();\n\t\tif (nextCursor)\n\t\t{\n\t\t\tcursorPromise = this.store.dispatch('sidebar/members/setNextCursor', {\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tnextCursor,\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.all([addUsersPromise, setMembersPromise, cursorPromise]);\n\t}\n\n\tgetMembersCountFromModel(): number\n\t{\n\t\treturn this.store.getters['sidebar/members/getSize'](this.chatId);\n\t}\n}\n","import { Type } from 'main.core';\n\nimport { RestMethod } from 'im.v2.const';\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { runAction } from 'im.v2.lib.rest';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { JsonObject } from 'main.core';\n\nconst REQUEST_ITEMS_LIMIT = 25;\n\ntype ChatsGetQueryParams = {\n\tlimit: number,\n\toffset?: number\n}\nexport class Multidialog\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\tif (this.isInitedMultidialogBlock())\n\t\t{\n\t\t\treturn {};\n\t\t}\n\n\t\treturn {\n\t\t\t[RestMethod.imBotNetworkChatCount]: {},\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (this.isInitedMultidialogBlock())\n\t\t\t{\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\tif (!response[RestMethod.imBotNetworkChatCount])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\tconst setInitedPromise = this.store.dispatch('sidebar/multidialog/setInited', true);\n\t\t\tconst updateModelsPromise = this.updateModels(response[RestMethod.imBotNetworkChatCount]);\n\n\t\t\treturn Promise.all([setInitedPromise, updateModelsPromise]);\n\t\t};\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst hasNextPage = this.store.getters['sidebar/multidialog/hasNextPage'];\n\t\tif (!hasNextPage)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst offset = this.store.getters['sidebar/multidialog/getNumberMultidialogs'];\n\t\tconst config = { data: this.getQueryParams({ offset }) };\n\n\t\treturn this.requestPage(config);\n\t}\n\n\tgetQueryParams(params: ChatsGetQueryParams): ChatsGetQueryParams\n\t{\n\t\tconst queryParams: ChatsGetQueryParams = {\n\t\t\toffset: 0,\n\t\t\tlimit: REQUEST_ITEMS_LIMIT,\n\t\t\t...params,\n\t\t};\n\n\t\tObject.keys(queryParams).forEach((key) => {\n\t\t\tconst value = queryParams[key];\n\t\t\tif (Type.isNumber(value) && value > 0)\n\t\t\t{\n\t\t\t\tqueryParams[key] = value;\n\t\t\t}\n\t\t});\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(config): Promise\n\t{\n\t\treturn runAction(RestMethod.imBotNetworkChatList, config).then((response) => {\n\t\t\treturn this.updateModels(response);\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: imBotNetworkChatList: page request error', error);\n\t\t});\n\t}\n\n\tcreateSupportChat(): Promise<string>\n\t{\n\t\tLogger.warn('SidebarInfo: imBotNetworkChatAdd');\n\n\t\treturn runAction(RestMethod.imBotNetworkChatAdd)\n\t\t\t.then((response) => {\n\t\t\t\tvoid this.updateModels({ chats: response });\n\t\t\t\tconst { dialogId } = response;\n\t\t\t\tLogger.warn('SidebarInfo: createSupportChat result', response);\n\n\t\t\t\treturn dialogId;\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error('SidebarInfo: createSupportChat error:', error);\n\t\t\t});\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\tconst isInitedDetail = this.store.getters['sidebar/multidialog/isInitedDetail'];\n\t\tif (isInitedDetail)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst numberMultidialogs = this.store.getters['sidebar/multidialog/getNumberMultidialogs'];\n\t\tconst limit = REQUEST_ITEMS_LIMIT < numberMultidialogs ? numberMultidialogs : REQUEST_ITEMS_LIMIT;\n\t\tconst config = { data: this.getQueryParams({ limit }) };\n\n\t\treturn this.requestPage(config)\n\t\t\t.then(() => {\n\t\t\t\treturn this.store.dispatch('sidebar/multidialog/setInitedDetail', true);\n\t\t\t});\n\t}\n\n\tupdateModels(resultData): Promise\n\t{\n\t\tconst { count, chatIdsWithCounters, multidialogs, chats, users, openSessionsLimit } = resultData;\n\n\t\tconst promises = [];\n\t\tif (chats)\n\t\t{\n\t\t\tconst setChatsPromise = this.store.dispatch('chats/set', chats);\n\t\t\tpromises.push(setChatsPromise);\n\t\t}\n\n\t\tif (users)\n\t\t{\n\t\t\tconst setUsersPromise = this.userManager.setUsersToModel(users);\n\t\t\tpromises.push(setUsersPromise);\n\t\t}\n\n\t\tconst setSupportTicketPromise = this.store.dispatch('sidebar/multidialog/set', {\n\t\t\tchatsCount: count,\n\t\t\tunreadChats: chatIdsWithCounters,\n\t\t\tmultidialogs,\n\t\t\topenSessionsLimit,\n\t\t});\n\t\tpromises.push(setSupportTicketPromise);\n\n\t\treturn Promise.all(promises);\n\t}\n\n\tisInitedMultidialogBlock(): boolean\n\t{\n\t\treturn this.store.getters['sidebar/multidialog/isInited'];\n\t}\n}\n","import { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod, SidebarDetailBlock } from 'im.v2.const';\n\nimport { getLastElementId } from './helpers/get-last-element-id';\n\nimport type { JsonObject } from 'main.core';\nimport type { RestClient } from 'rest.client';\nimport type { Store } from 'ui.vue3.vuex';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\nexport class FileUnsorted\n{\n\tstore: Store;\n\tdialogId: string;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = this.getChatId();\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tgetInitialQuery(): {[$Values<typeof RestMethod>]: JsonObject}\n\t{\n\t\treturn {\n\t\t\t[RestMethod.imDiskFolderListGet]: { chat_id: this.chatId, limit: REQUEST_ITEMS_LIMIT },\n\t\t};\n\t}\n\n\tgetResponseHandler(): Function\n\t{\n\t\treturn (response) => {\n\t\t\tif (!response[RestMethod.imDiskFolderListGet])\n\t\t\t{\n\t\t\t\treturn Promise.reject(new Error('SidebarInfo service error: no response'));\n\t\t\t}\n\n\t\t\treturn this.updateModels(response[RestMethod.imDiskFolderListGet]);\n\t\t};\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\tconst filesCount = this.getFilesCountFromModel(SidebarDetailBlock.fileUnsorted);\n\t\tif (filesCount > REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tloadNextPage(): Promise\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\n\t\treturn this.requestPage(queryParams);\n\t}\n\n\tgetQueryParams(): Object\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/files/getLastId'](this.chatId, SidebarDetailBlock.fileUnsorted);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\trequestPage(queryParams): Promise\n\t{\n\t\treturn this.restClient.callMethod(RestMethod.imDiskFolderListGet, queryParams).then((response) => {\n\t\t\treturn this.handleResponse(response.data());\n\t\t}).catch((error) => {\n\t\t\tconsole.error('SidebarInfo: Im.imDiskFolderListGet: page request error', error);\n\t\t});\n\t}\n\n\thandleResponse(response): Promise\n\t{\n\t\tconst diskFolderListGetResult = response;\n\t\tif (diskFolderListGetResult.files.length < REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\tthis.hasMoreItemsToLoad = false;\n\t\t}\n\n\t\tconst lastId = getLastElementId(diskFolderListGetResult.files);\n\t\tif (lastId)\n\t\t{\n\t\t\tthis.lastId = lastId;\n\t\t}\n\n\t\treturn this.updateModels(diskFolderListGetResult);\n\t}\n\n\tupdateModels(resultData): Promise\n\t{\n\t\tconst { users, files, tariffRestrictions = {} } = resultData;\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\t\tconst historyLimitPromise = this.store.dispatch('sidebar/files/setHistoryLimitExceeded', {\n\t\t\tchatId: this.chatId,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\n\t\tconst preparedFiles = files.map((file) => {\n\t\t\treturn { ...file, group: SidebarDetailBlock.fileUnsorted };\n\t\t});\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setFilesPromise = this.store.dispatch('files/set', preparedFiles);\n\t\tconst setSidebarFilesPromise = this.store.dispatch('sidebar/files/set', {\n\t\t\tchatId: this.chatId,\n\t\t\tfiles: preparedFiles,\n\t\t\tgroup: SidebarDetailBlock.fileUnsorted,\n\t\t});\n\n\t\tconst hasNextPagePromise = this.store.dispatch('sidebar/files/setHasNextPage', {\n\t\t\tchatId: this.chatId,\n\t\t\tgroup: SidebarDetailBlock.fileUnsorted,\n\t\t\thasNextPage: preparedFiles.length === REQUEST_ITEMS_LIMIT,\n\t\t});\n\n\t\tconst setLastIdPromise = this.store.dispatch('sidebar/files/setLastId', {\n\t\t\tchatId: this.chatId,\n\t\t\tgroup: SidebarDetailBlock.fileUnsorted,\n\t\t\tlastId: getLastElementId(preparedFiles),\n\t\t});\n\n\t\treturn Promise.all([\n\t\t\tsetFilesPromise,\n\t\t\tsetSidebarFilesPromise,\n\t\t\taddUsersPromise,\n\t\t\thasNextPagePromise,\n\t\t\tsetLastIdPromise,\n\t\t\thistoryLimitPromise,\n\t\t]);\n\t}\n\n\tgetFilesCountFromModel(group): number\n\t{\n\t\treturn this.store.getters['sidebar/files/getSize'](this.chatId, group);\n\t}\n\n\tgetChatId(): number\n\t{\n\t\tconst dialog = this.store.getters['chats/get'](this.dialogId, true);\n\n\t\treturn dialog.chatId;\n\t}\n}\n","import { Text } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { callBatch } from 'im.v2.lib.rest';\nimport { SidebarDetailBlock, SidebarMainPanelBlock } from 'im.v2.const';\nimport { SidebarManager } from 'im.v2.lib.sidebar';\n\nimport { Favorite } from './favorite';\nimport { getChatId } from './helpers/get-chat-id';\nimport { Link } from './link';\nimport { File } from './file';\nimport { Task } from './task';\nimport { Meeting } from './meeting';\nimport { MembersService as Members } from './members';\nimport { Multidialog } from './multidialog';\n\nimport { FileUnsorted } from './file-unsorted';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { RestClient } from 'rest.client';\n\nconst MainPanelServiceClasses = {\n\tMembers,\n\tFavorite,\n\tLink,\n\tTask,\n\tFile,\n\tMeeting,\n\tFileUnsorted,\n\tMultidialog,\n};\n\nconst BlockToServices = Object.freeze({\n\t[SidebarMainPanelBlock.chat]: [SidebarDetailBlock.members],\n\t[SidebarMainPanelBlock.copilot]: [SidebarDetailBlock.members],\n\t[SidebarMainPanelBlock.task]: [SidebarDetailBlock.members],\n\t[SidebarMainPanelBlock.copilotInfo]: [SidebarDetailBlock.favorite],\n\t[SidebarMainPanelBlock.info]: [SidebarDetailBlock.favorite, SidebarDetailBlock.link],\n\t[SidebarMainPanelBlock.fileList]: [SidebarDetailBlock.file],\n\t[SidebarMainPanelBlock.fileUnsortedList]: [SidebarDetailBlock.fileUnsorted],\n\t[SidebarMainPanelBlock.taskList]: [SidebarDetailBlock.task],\n\t[SidebarMainPanelBlock.meetingList]: [SidebarDetailBlock.meeting],\n\t[SidebarMainPanelBlock.multidialog]: [SidebarDetailBlock.multidialog],\n});\n\ntype BlockService = {\n\tinitialQuery: Object;\n\tresponseHandler: Function;\n};\n\nexport class Main\n{\n\tblockServices: BlockService[] = [];\n\tdialogId: string;\n\tstore: Store;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId })\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.buildBlocks();\n\t}\n\n\t// region public methods\n\tasync requestInitialData(): Promise\n\t{\n\t\tconst query = this.getInitialQuery();\n\t\tconst response = await callBatch(query);\n\n\t\treturn this.handleBatchRequestResult(response);\n\t}\n\t// endregion\n\n\tbuildBlocks(): BlockService[]\n\t{\n\t\tconst classNames = this.getServiceClassesForBlocks();\n\n\t\tthis.blockServices = classNames.map((ClassName: string): BlockService => {\n\t\t\tconst blockService = new MainPanelServiceClasses[ClassName]({\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\n\t\t\treturn {\n\t\t\t\tinitialQuery: blockService.getInitialQuery(),\n\t\t\t\tresponseHandler: blockService.getResponseHandler(),\n\t\t\t};\n\t\t});\n\t}\n\n\tgetServiceClassesForBlocks(): string[]\n\t{\n\t\tconst services = [];\n\t\tconst sidebarConfig = SidebarManager.getInstance().getConfig(this.dialogId);\n\t\tconst blockList = sidebarConfig.getBlocks(this.dialogId);\n\n\t\tblockList.forEach((block: string) => {\n\t\t\tconst blockServices = BlockToServices[block];\n\t\t\tif (blockServices)\n\t\t\t{\n\t\t\t\tservices.push(...blockServices);\n\t\t\t}\n\t\t});\n\n\t\treturn services.map((service) => Text.capitalize(service));\n\t}\n\n\tgetInitialQuery(): Object\n\t{\n\t\tlet query = {};\n\t\tthis.blockServices.forEach((block) => {\n\t\t\tquery = Object.assign(query, block.initialQuery);\n\t\t});\n\n\t\treturn query;\n\t}\n\n\thandleBatchRequestResult(response): Promise\n\t{\n\t\tconst responseHandlersResult = [];\n\t\tthis.blockServices.forEach((block) => {\n\t\t\tresponseHandlersResult.push(block.responseHandler(response));\n\t\t});\n\n\t\treturn Promise.all(responseHandlersResult)\n\t\t\t.then(() => {\n\t\t\t\treturn this.setInited();\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t});\n\t}\n\n\tsetInited(): Promise\n\t{\n\t\treturn this.store.dispatch('sidebar/setInited', getChatId(this.dialogId));\n\t}\n}\n","import { Loc } from 'main.core';\nimport { MenuItemDesign } from 'ui.system.menu';\n\nimport { ChatService } from 'im.v2.provider.service.chat';\nimport { Utils } from 'im.v2.lib.utils';\nimport { RecentMenu } from 'im.v2.lib.menu';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { ActionByRole, ActionByUserType, Layout } from 'im.v2.const';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { showDeleteChatConfirm } from 'im.v2.lib.confirm';\nimport { Notifier } from 'im.v2.lib.notifier';\nimport { ChatManager } from 'im.v2.lib.chat';\nimport { CopilotManager } from 'im.v2.lib.copilot';\n\nimport type { MenuItemOptions, MenuOptions } from 'ui.system.menu';\nimport type { ApplicationContext } from 'im.v2.const';\n\nexport class MainMenu extends RecentMenu\n{\n\tpermissionManager: PermissionManager;\n\n\tstatic events = {\n\t\tonAddToChatShow: 'onAddToChatShow',\n\t};\n\n\tconstructor(applicationContext: ApplicationContext)\n\t{\n\t\tsuper(applicationContext);\n\n\t\tthis.id = 'im-sidebar-context-menu';\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetMenuOptions(): MenuOptions\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t\tangle: false,\n\t\t};\n\t}\n\n\tgetMenuItems(): MenuItemOptions[]\n\t{\n\t\treturn [\n\t\t\tthis.getPinMessageItem(),\n\t\t\tthis.getEditItem(),\n\t\t\tthis.getAddMembersToChatItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t\tthis.getOpenUserCalendarItem(),\n\t\t\tthis.getChatsWithUserItem(),\n\t\t\tthis.getCopyInviteLinkItem(),\n\t\t\tthis.getHideItem(),\n\t\t\tthis.getLeaveItem(),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\t}\n\n\tgetCopyInviteLinkItem(): ?MenuItemOptions\n\t{\n\t\tif (!BX.clipboard.isCopySupported())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.isUser() || this.isCollabChat())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isGroupCopilotChat = (new CopilotManager()).isGroupCopilotChat(this.context.dialogId);\n\t\tconst isCopilotChat = (new CopilotManager()).isCopilotChat(this.context.dialogId);\n\t\tif (isCopilotChat && !isGroupCopilotChat)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_SIDEBAR_MENU_COPY_INVITE_LINK'),\n\t\t\tonClick: () => {\n\t\t\t\tconst chatLink = ChatManager.buildChatLink(this.context.dialogId);\n\t\t\t\tif (BX.clipboard.copy(chatLink))\n\t\t\t\t{\n\t\t\t\t\tNotifier.onCopyLinkComplete();\n\t\t\t\t}\n\n\t\t\t\tAnalytics.getInstance().chatInviteLink.onCopyContextMenu(this.context.dialogId);\n\t\t\t},\n\t\t};\n\t}\n\n\tgetEditItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.permissionManager.canPerformActionByRole(ActionByRole.update, this.context.dialogId))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_SIDEBAR_MENU_UPDATE_CHAT'),\n\t\t\tonClick: () => {\n\t\t\t\tAnalytics.getInstance().chatEdit.onOpenForm(this.context.dialogId);\n\n\t\t\t\tvoid LayoutManager.getInstance().setLayout({\n\t\t\t\t\tname: Layout.updateChat,\n\t\t\t\t\tentityId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\t}\n\n\tgetDeleteItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.permissionManager.canPerformActionByRole(ActionByRole.delete, this.context.dialogId))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_SIDEBAR_MENU_DELETE_CHAT'),\n\t\t\tdesign: MenuItemDesign.Alert,\n\t\t\tonClick: async () => {\n\t\t\t\tAnalytics.getInstance().chatDelete.onClick(this.context.dialogId);\n\t\t\t\tif (await this.#isDeletionCancelled())\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tAnalytics.getInstance().chatDelete.onConfirm(this.context.dialogId);\n\n\t\t\t\tif (this.isCollabChat())\n\t\t\t\t{\n\t\t\t\t\tthis.#deleteCollab();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#deleteChat();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenUserCalendarItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.isUser())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getCalendarLink(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_OPEN_CALENDAR_V2'),\n\t\t\tonClick: () => {\n\t\t\t\tBX.SidePanel.Instance.open(profileUri);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetAddMembersToChatItem(): ?MenuItemOptions\n\t{\n\t\tif (this.isBot() || this.isChatWithCurrentUser())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst hasCreateChatAccess = this.permissionManager.canPerformActionByUserType(ActionByUserType.createChat);\n\t\tif (this.isUser() && !hasCreateChatAccess)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst hasAccessByRole = this.permissionManager.canPerformActionByRole(ActionByRole.extend, this.context.dialogId);\n\t\tif (!hasAccessByRole)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst title = this.isChannel()\n\t\t\t? Loc.getMessage('IM_SIDEBAR_MENU_INVITE_SUBSCRIBERS')\n\t\t\t: Loc.getMessage('IM_SIDEBAR_MENU_INVITE_MEMBERS_V2');\n\n\t\treturn {\n\t\t\ttitle,\n\t\t\tonClick: () => {\n\t\t\t\tAnalytics.getInstance().userAdd.onChatSidebarClick(this.context.dialogId);\n\t\t\t\tthis.emit(MainMenu.events.onAddToChatShow);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tasync #deleteChat(): Promise<void>\n\t{\n\t\tawait (new ChatService()).deleteChat(this.context.dialogId);\n\t\tvoid LayoutManager.getInstance().clearCurrentLayoutEntityId();\n\t}\n\n\tasync #deleteCollab(): Promise<void>\n\t{\n\t\tNotifier.collab.onBeforeDelete();\n\t\tawait (new ChatService()).deleteCollab(this.context.dialogId);\n\t\tvoid LayoutManager.getInstance().clearCurrentLayoutEntityId();\n\t\tvoid LayoutManager.getInstance().deleteLastOpenedElementById(this.context.dialogId);\n\t}\n\n\tasync #isDeletionCancelled(): Promise<boolean>\n\t{\n\t\tconst confirmResult = await showDeleteChatConfirm(this.context.dialogId);\n\t\tif (!confirmResult)\n\t\t{\n\t\t\tAnalytics.getInstance().chatDelete.onCancel(this.context.dialogId);\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n","import { EventType, ChatType, ActionByRole } from 'im.v2.const';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { SidebarManager, SidebarConfig } from 'im.v2.lib.sidebar';\nimport { AddToChat, AddToCollab } from 'im.v2.component.entity-selector';\n\nimport { MainMenu } from '../../../../classes/context-menu/main/main-menu';\n\nimport '../css/header.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport type { ImModelRecentItem, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const MainHeader = {\n\tname: 'MainHeader',\n\tcomponents: { AddToChat, AddToCollab },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowAddToChatPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\trecentItem(): ?ImModelRecentItem\n\t\t{\n\t\t\treturn this.$store.getters['recent/get'](this.dialogId);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tsidebarConfig(): SidebarConfig\n\t\t{\n\t\t\treturn SidebarManager.getInstance().getConfig(this.dialogId);\n\t\t},\n\t\theaderTitle(): string\n\t\t{\n\t\t\treturn this.sidebarConfig.getHeaderTitle();\n\t\t},\n\t\tshowMenuIcon(): boolean\n\t\t{\n\t\t\treturn this.canOpenMenu && this.isMenuEnabled;\n\t\t},\n\t\tcanOpenMenu(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformActionByRole(ActionByRole.openSidebarMenu, this.dialogId);\n\t\t},\n\t\tisMenuEnabled(): boolean\n\t\t{\n\t\t\treturn this.sidebarConfig.isHeaderMenuEnabled();\n\t\t},\n\t\taddMembersPopupComponent(): BitrixVueComponentProps\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.collab ? AddToCollab : AddToChat;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new MainMenu({ emitter: this.getEmitter() });\n\t\tthis.contextMenu.subscribe(MainMenu.events.onAddToChatShow, this.onAddChatShow);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t\tthis.contextMenu.unsubscribe(MainMenu.events.onAddToChatShow, this.onAddChatShow);\n\t},\n\tmethods:\n\t{\n\t\tonAddChatShow()\n\t\t{\n\t\t\tthis.showAddToChatPopup = true;\n\t\t},\n\t\tonContextMenuClick(event: PointerEvent)\n\t\t{\n\t\t\tconst context = {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\trecentItem: this.recentItem,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(context, event.target);\n\t\t},\n\t\tonSidebarCloseClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close);\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-header__container bx-im-sidebar-header__scope\">\n\t\t\t<div class=\"bx-im-sidebar-header__title-container\">\n\t\t\t\t<button \n\t\t\t\t\tclass=\"bx-im-sidebar-header__cross-icon bx-im-messenger__cross-icon\" \n\t\t\t\t\t@click=\"onSidebarCloseClick\"\n\t\t\t\t></button>\n\t\t\t\t<div class=\"bx-im-sidebar-header__title\">{{ headerTitle }}</div>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tv-if=\"showMenuIcon\"\n\t\t\t\tclass=\"bx-im-sidebar-header__context-menu-icon bx-im-messenger__context-menu-icon\"\n\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t\tref=\"context-menu\"\n\t\t\t></button>\n\t\t\t<component\n\t\t\t\tv-if=\"showAddToChatPopup\"\n\t\t\t\t:is=\"addMembersPopupComponent\"\n\t\t\t\t:bindElement=\"$refs['context-menu'] || {}\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:popupConfig=\"{offsetTop: 0, offsetLeft: -420}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { hint } from 'ui.vue3.directives.hint';\n\nimport { SidebarDetailBlock, EventType } from 'im.v2.const';\n\nimport './chat-links.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const ChatLinks = {\n\tname: 'ChatLinks',\n\tdirectives: { hint },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\texpanded: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\turlCounter(): string\n\t\t{\n\t\t\tconst counter = this.$store.getters['sidebar/links/getCounter'](this.chatId);\n\n\t\t\treturn this.getCounterString(counter);\n\t\t},\n\t\tisLinksAvailable(): boolean\n\t\t{\n\t\t\treturn this.$store.state.sidebar.isLinksMigrated;\n\t\t},\n\t\thintDirectiveContent(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('IM_SIDEBAR_LINKS_NOT_AVAILABLE'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tangle: true,\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\toffsetLeft: 141,\n\t\t\t\t\toffsetTop: -10,\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tgetCounterString(counter: number): string\n\t\t{\n\t\t\tconst MAX_COUNTER = 100;\n\t\t\tif (counter >= MAX_COUNTER)\n\t\t\t{\n\t\t\t\treturn '99+';\n\t\t\t}\n\n\t\t\treturn counter.toString();\n\t\t},\n\t\tonLinkClick()\n\t\t{\n\t\t\tif (!this.isLinksAvailable)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getEmitter().emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.link,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-chat-links__container\" \n\t\t\t:class=\"[isLinksAvailable ? '' : '--links-not-active']\"\n\t\t\t@click=\"onLinkClick\"\n\t\t>\n\t\t\t<div \n\t\t\t\tv-if=\"!isLinksAvailable\" \n\t\t\t\tclass=\"bx-im-sidebar-chat-links__hint-not-active\" \n\t\t\t\tv-hint=\"hintDirectiveContent\"\n\t\t\t></div>\n\t\t\t<div class=\"bx-im-sidebar-chat-links__title-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-chat-links__icon\"></div>\n\t\t\t\t<div class=\"bx-im-sidebar-chat-links__title-text\">\n\t\t\t\t\t{{ loc('IM_SIDEBAR_LINK_DETAIL_TITLE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-chat-links__counter-container\">\n\t\t\t\t<span class=\"bx-im-sidebar-chat-links__counter\">{{urlCounter}}</span>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { SidebarDetailBlock, EventType } from 'im.v2.const';\n\nimport './css/chat-favourites.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const ChatFavourites = {\n\tname: 'ChatFavourites',\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tfavoriteCounter(): string\n\t\t{\n\t\t\tconst counter = this.$store.getters['sidebar/favorites/getCounter'](this.chatId);\n\n\t\t\treturn this.getCounterString(counter);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tgetCounterString(counter: number): string\n\t\t{\n\t\t\tconst MAX_COUNTER = 100;\n\t\t\tif (counter >= MAX_COUNTER)\n\t\t\t{\n\t\t\t\treturn '99+';\n\t\t\t}\n\n\t\t\treturn counter.toString();\n\t\t},\n\t\tonFavouriteClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.favorite,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-chat-favourites__container\" \n\t\t\t@click=\"onFavouriteClick\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-chat-favourites__title\">\n\t\t\t\t<div class=\"bx-im-sidebar-chat-favourites__icon\"></div>\n\t\t\t\t<div class=\"bx-im-sidebar-chat-favourites__title-text\">\n\t\t\t\t\t{{ loc('IM_SIDEBAR_FAVORITE_DETAIL_TITLE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-chat-favourites__counter-container\">\n\t\t\t\t<span class=\"bx-im-sidebar-chat-favourites__counter\">{{favoriteCounter}}</span>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { ChatType, UserType } from 'im.v2.const';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { SidebarManager } from 'im.v2.lib.sidebar';\n\nimport './chat-description.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelUser } from 'im.v2.model';\n\nconst MAX_DESCRIPTION_SYMBOLS = 50;\nconst VISIBLE_DESCRIPTION_LINES = 2;\nconst NEW_LINE_SYMBOL = '\\n';\n\nconst DescriptionByChatType = {\n\t[ChatType.user]: Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_USER'),\n\t[ChatType.channel]: Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_CHANNEL'),\n\t[ChatType.openChannel]: Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_CHANNEL'),\n\t[ChatType.generalChannel]: Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_CHANNEL'),\n\t[ChatType.comment]: Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_COMMENTS'),\n\tdefault: Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_GROUP_V2'),\n};\n\n// @vue/component\nexport const ChatDescription = {\n\tname: 'ChatDescription',\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\texpanded: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tisBot(): boolean\n\t\t{\n\t\t\tconst user: ImModelUser = this.$store.getters['users/get'](this.dialogId, true);\n\n\t\t\treturn user.type === UserType.bot;\n\t\t},\n\t\tisCollabChat(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.collab;\n\t\t},\n\t\tcustomDescription(): string\n\t\t{\n\t\t\tconst sidebarConfig = SidebarManager.getInstance().getConfig(this.dialogId);\n\n\t\t\treturn sidebarConfig.getCustomDescription();\n\t\t},\n\t\tisCopilotChat(): boolean\n\t\t{\n\t\t\treturn (new CopilotManager()).isCopilotChat(this.dialogId);\n\t\t},\n\t\tisLongDescription(): boolean\n\t\t{\n\t\t\tconst lineBreakCount = this.dialog.description.split(NEW_LINE_SYMBOL).length - 1;\n\t\t\tconst hasSeveralLines = lineBreakCount > VISIBLE_DESCRIPTION_LINES;\n\n\t\t\treturn (this.dialog.description.length > MAX_DESCRIPTION_SYMBOLS) || hasSeveralLines;\n\t\t},\n\t\tpreviewDescription(): string\n\t\t{\n\t\t\tif (this.dialog.description.length === 0)\n\t\t\t{\n\t\t\t\treturn this.chatTypeText;\n\t\t\t}\n\n\t\t\tif (this.isLongDescription)\n\t\t\t{\n\t\t\t\treturn `${this.dialog.description.slice(0, MAX_DESCRIPTION_SYMBOLS)}...`;\n\t\t\t}\n\n\t\t\treturn this.dialog.description;\n\t\t},\n\t\tdescriptionToShow(): string\n\t\t{\n\t\t\treturn this.expanded ? this.dialog.description : this.previewDescription;\n\t\t},\n\t\tchatTypeText(): string\n\t\t{\n\t\t\tif (this.customDescription.length > 0)\n\t\t\t{\n\t\t\t\treturn this.customDescription;\n\t\t\t}\n\n\t\t\tif (this.isCopilotChat)\n\t\t\t{\n\t\t\t\treturn (new CopilotManager()).getAIModelName(this.dialogId);\n\t\t\t}\n\n\t\t\tif (this.isBot)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_SIDEBAR_CHAT_TYPE_BOT');\n\t\t\t}\n\n\t\t\tif (this.isCollabChat)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_SIDEBAR_CHAT_TYPE_COLLAB');\n\t\t\t}\n\n\t\t\treturn DescriptionByChatType[this.dialog.type] ?? DescriptionByChatType.default;\n\t\t},\n\t\tshowExpandButton(): boolean\n\t\t{\n\t\t\tif (this.expanded)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.isLongDescription;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-chat-description__container\">\n\t\t\t<div class=\"bx-im-sidebar-chat-description__text-container\" :class=\"[expanded ? '--expanded' : '']\">\n\t\t\t\t<div class=\"bx-im-sidebar-chat-description__icon\"></div>\n\t\t\t\t<div\n\t\t\t\t\tclass=\"bx-im-sidebar-chat-description__text\"\n\t\t\t\t\t:class=\"{ '--long-description': isLongDescription }\"\n\t\t\t\t>\n\t\t\t\t\t{{ descriptionToShow }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tv-if=\"showExpandButton\"\n\t\t\t\tclass=\"bx-im-sidebar-chat-description__show-more-button\"\n\t\t\t\t@click=\"expanded = !expanded\"\n\t\t\t>\n\t\t\t\t{{ loc('IM_SIDEBAR_CHAT_DESCRIPTION_SHOW') }}\n\t\t\t</button>\n\t\t</div>\n\t`,\n};\n","import { SidebarDetailBlock, EventType } from 'im.v2.const';\n\nimport './chat-shared.css';\n\nimport type { EventEmitter } from 'main.core.events';\n\n// @vue/component\nexport const ChatShared = {\n\tname: 'ChatShared',\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tasync onLinkClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.chatsWithUser,\n\t\t\t\tstandalone: true,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-chat-shared__container\" \n\t\t\t@click=\"onLinkClick\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-chat-shared__title-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-chat-shared__icon\"></div>\n\t\t\t\t<div class=\"bx-im-sidebar-chat-shared__title-text\">\n\t\t\t\t\t{{ loc('IM_SIDEBAR_SHARED_CHATS_TITLE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-chat-shared__arrow\"></div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\nimport { ChatType, UserType } from 'im.v2.const';\nimport { SidebarManager } from 'im.v2.lib.sidebar';\n\nimport { ChatLinks } from '../../../elements/chat-links/chat-links';\nimport { ChatFavourites } from '../../../elements/chat-favourites/chat-favourites';\nimport { ChatDescription } from '../../../elements/chat-description/chat-description';\nimport { ChatShared } from '../../../elements/chat-shared/chat-shared';\n\nimport '../css/info.css';\n\nimport type { ImModelChat, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const InfoPreview = {\n\tname: 'InfoPreview',\n\tcomponents: { ChatDescription, ChatLinks, ChatFavourites, ChatShared },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tisSelfChat(): boolean\n\t\t{\n\t\t\treturn this.isUser && this.user.id === Core.getUserId();\n\t\t},\n\t\tisUserOrBot(): boolean\n\t\t{\n\t\t\treturn this.isUser && [UserType.bot, UserType.user].includes(this.user.type);\n\t\t},\n\t\tshowSharedChats(): boolean\n\t\t{\n\t\t\tconst sidebarConfig = SidebarManager.getInstance().getConfig(this.dialogId);\n\t\t\tconst isSharedChatsEnabled = sidebarConfig.areSharedChatsEnabled();\n\n\t\t\treturn isSharedChatsEnabled && this.isUserOrBot && !this.isSelfChat;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-info-preview__container\">\n\t\t\t<ChatDescription :dialogId=\"dialogId\" />\n\t\t\t<ChatFavourites :dialogId=\"dialogId\" />\n\t\t\t<ChatLinks :dialogId=\"dialogId\" />\n\t\t\t<ChatShared v-if=\"showSharedChats\" :dialogId=\"dialogId\" />\n\t\t</div>\n\t`,\n};\n","import 'ui.icons';\nimport 'ui.viewer';\nimport { lazyload } from 'ui.vue3.directives.lazyload';\n\nimport { FileViewerContext } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\n\nimport '../css/file-preview-item.css';\n\nimport type { ImModelFile, ImModelSidebarFileItem } from 'im.v2.model';\n\n// @vue/component\nexport const FilePreviewItem = {\n\tname: 'FilePreviewItem',\n\tdirectives: { lazyload },\n\tprops: {\n\t\tfileItem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tsidebarFileItem(): ImModelSidebarFileItem\n\t\t{\n\t\t\treturn this.fileItem;\n\t\t},\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.sidebarFileItem.fileId, true);\n\t\t},\n\t\tpreviewImageStyles(): Object\n\t\t{\n\t\t\tif (!this.hasPreview)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url('${this.file.urlPreview}')`,\n\t\t\t};\n\t\t},\n\t\thasPreview(): boolean\n\t\t{\n\t\t\treturn this.file.urlPreview !== '';\n\t\t},\n\t\tfileShortName(): string\n\t\t{\n\t\t\tconst NAME_MAX_LENGTH = 22;\n\n\t\t\treturn Utils.file.getShortFileName(this.file.name, NAME_MAX_LENGTH);\n\t\t},\n\t\tviewerAttributes(): Object\n\t\t{\n\t\t\treturn Utils.file.getViewerDataAttributes({\n\t\t\t\tviewerAttributes: this.file.viewerAttrs,\n\t\t\t\tpreviewImageSrc: this.imageSrc,\n\t\t\t\tcontext: FileViewerContext.sidebarMain,\n\t\t\t});\n\t\t},\n\t\tisImage(): boolean\n\t\t{\n\t\t\treturn this.file.type === 'image';\n\t\t},\n\t\tisVideo(): boolean\n\t\t{\n\t\t\treturn this.file.type === 'video';\n\t\t},\n\t\tisAudio(): boolean\n\t\t{\n\t\t\treturn this.file.type === 'audio';\n\t\t},\n\t\tfileIconClass(): string\n\t\t{\n\t\t\treturn `ui-icon ui-icon-file-${this.file.icon}`;\n\t\t},\n\t\tisViewerAvailable(): boolean\n\t\t{\n\t\t\treturn Object.keys(this.viewerAttributes).length > 0;\n\t\t},\n\t\timageSrc(): string\n\t\t{\n\t\t\tconst isAnimation = ['gif', 'webp'].includes(this.file.extension);\n\n\t\t\treturn isAnimation ? this.file.urlShow : this.file.urlPreview;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tdownload()\n\t\t{\n\t\t\tif (this.isViewerAvailable)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.open(this.file.urlDownload, '_blank');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"bx-im-sidebar-file-preview-item__container bx-im-sidebar-file-preview-item__scope\"\n\t\t\t@click=\"download\" \n\t\t\t:title=\"file.name\"\n\t\t>\n\t\t\t<img\n\t\t\t\tv-if=\"isImage\"\n\t\t\t\tv-bind=\"viewerAttributes\"\n\t\t\t\tv-lazyload\n\t\t\t\tdata-lazyload-dont-hide\n\t\t\t\t:data-lazyload-src=\"imageSrc\"\n\t\t\t\t:title=\"file.name\"\n\t\t\t\t:alt=\"file.name\"\n\t\t\t\tclass=\"bx-im-sidebar-file-preview-item__preview-box\"\n\t\t\t/>\n\t\t\t<div \n\t\t\t\tv-else-if=\"isVideo\"\n\t\t\t\tclass=\"bx-im-sidebar-file-preview-item__preview-box bx-im-sidebar-file-preview-item__preview-video-box\"\n\t\t\t\t:style=\"previewImageStyles\"\n\t\t\t\tv-bind=\"viewerAttributes\"\n\t\t\t>\n\t\t\t\t<video \n\t\t\t\t\tv-if=\"!hasPreview\" \n\t\t\t\t\t:src=\"file.urlDownload\"\n\t\t\t\t\tpreload=\"metadata\" \n\t\t\t\t\tclass=\"bx-im-sidebar-file-preview-item__preview-video\" \n\t\t\t\t></video>\n\t\t\t\t<div class=\"bx-im-sidebar-file-preview-item__preview-video-play-button\"></div>\n\t\t\t\t<div class=\"bx-im-sidebar-file-preview-item__preview-video-play-icon\"></div>\n\t\t\t</div>\n\t\t\t<div v-else-if=\"isAudio\" v-bind=\"viewerAttributes\" class=\"bx-im-sidebar-file-preview-item__preview-box\">\n\t\t\t\t<div class=\"bx-im-sidebar-file-preview-item__preview-audio-play-button\"></div>\n\t\t\t</div>\n\t\t\t<div v-else v-bind=\"viewerAttributes\" class=\"bx-im-sidebar-file-preview-item__preview-box\">\n\t\t\t\t<div :class=\"fileIconClass\"><i></i></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-file-preview-item__text\">{{ fileShortName }}</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\n\nimport './css/detail-empty-state.css';\n\n// @vue/component\nexport const DetailEmptyState = {\n\tname: 'DetailEmptyState',\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticonType: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t\t{\n\t\t\ticonClass(): string\n\t\t\t{\n\t\t\t\treturn `--${Text.toKebabCase(this.iconType)}`;\n\t\t\t},\n\t\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-detail-empty-state__container bx-im-sidebar-detail-empty-state__scope\">\n\t\t\t<span class=\"bx-im-sidebar-detail-empty-state__icon\" :class=\"[iconClass]\"></span>\n\t\t\t<span class=\"bx-im-sidebar-detail-empty-state__text\">{{ title }}</span>\n\t\t</div>\n\t`,\n};\n","import { SidebarDetailBlock, EventType } from 'im.v2.const';\n\nimport { FilePreviewItem } from '../../file/components/file-preview-item';\nimport { DetailEmptyState } from '../../../elements/detail-empty-state/detail-empty-state';\n\nimport '../css/file.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat, ImModelSidebarFileItem } from 'im.v2.model';\n\n// @vue/component\nexport const FileListPreview = {\n\tname: 'FileListPreview',\n\tcomponents: { DetailEmptyState, FilePreviewItem },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\tif (this.isMigrationFinished)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['sidebar/files/getLatest'](this.chatId);\n\t\t\t}\n\n\t\t\treturn this.$store.getters['sidebar/files/getLatestUnsorted'](this.chatId);\n\t\t},\n\t\thasFiles(): boolean\n\t\t{\n\t\t\treturn this.files.length > 0;\n\t\t},\n\t\tisMigrationFinished(): boolean\n\t\t{\n\t\t\treturn this.$store.state.sidebar.isFilesMigrated;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonOpenDetail()\n\t\t{\n\t\t\tif (!this.hasFiles)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst panel = this.isMigrationFinished ? SidebarDetailBlock.file : SidebarDetailBlock.fileUnsorted;\n\n\t\t\tthis.getEmitter().emit(EventType.sidebar.open, {\n\t\t\t\tpanel,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-preview__scope\">\n\t\t\t<div class=\"bx-im-sidebar-file-preview__container\">\n\t\t\t\t<div \n\t\t\t\t\tclass=\"bx-im-sidebar-file-preview__header_container\" \n\t\t\t\t\t:class=\"[hasFiles ? '--active': '']\" \n\t\t\t\t\t@click=\"onOpenDetail\"\n\t\t\t\t>\n\t\t\t\t\t<span class=\"bx-im-sidebar-file-preview__title-text\">\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_MEDIA_DETAIL_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div v-if=\"hasFiles\" class=\"bx-im-sidebar__forward-icon\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"hasFiles\" class=\"bx-im-sidebar-file-preview__files-container\">\n\t\t\t\t\t<FilePreviewItem v-for=\"file in files\" :fileItem=\"file\" />\n\t\t\t\t</div>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-else\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_MEDIA_AND_FILES_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.media\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { BaseMenu } from 'im.v2.lib.menu';\nimport { Notifier } from 'im.v2.lib.notifier';\nimport { EventType } from 'im.v2.const';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { MenuItemOptions, MenuOptions } from 'ui.system.menu';\nimport type { ApplicationContext } from 'im.v2.const';\n\nexport class SidebarMenu extends BaseMenu\n{\n\temitter: EventEmitter;\n\n\tconstructor(applicationContext: ApplicationContext)\n\t{\n\t\tsuper();\n\t\tthis.id = 'im-sidebar-context-menu';\n\n\t\tconst { emitter } = applicationContext;\n\t\tthis.emitter = emitter;\n\t}\n\n\tgetMenuOptions(): MenuOptions\n\t{\n\t\treturn {\n\t\t\t...super.getMenuOptions(),\n\t\t\tclassName: this.getMenuClassName(),\n\t\t};\n\t}\n\n\tgetOpenContextMessageItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.context.messageId || this.context.messageId === 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_SIDEBAR_MENU_GO_TO_CONTEXT_MESSAGE'),\n\t\t\tonClick: () => {\n\t\t\t\tthis.emitter.emit(EventType.dialog.goToMessageContext, {\n\t\t\t\t\tmessageId: this.context.messageId,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCopyLinkItem(title: string): ?MenuItemOptions\n\t{\n\t\tif (!BX.clipboard.isCopySupported())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle,\n\t\t\tonClick: () => {\n\t\t\t\tif (BX.clipboard.copy(this.context.source))\n\t\t\t\t{\n\t\t\t\t\tNotifier.onCopyLinkComplete();\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Store } from 'ui.vue3.vuex';\nimport { RestClient } from 'rest.client';\n\nimport { RestMethod } from 'im.v2.const';\nimport { Core } from 'im.v2.application.core';\n\nexport class TaskManager\n{\n\tstore: Store;\n\trestClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t}\n\n\tdelete({ id, chatId })\n\t{\n\t\tthis.store.dispatch('sidebar/tasks/delete', { chatId, id });\n\n\t\tconst queryParams = { LINK_ID: id };\n\t\tthis.restClient.callMethod(RestMethod.imChatTaskDelete, queryParams).catch((error) => {\n\t\t\tconsole.error('Im.Sidebar: error deleting task', error);\n\t\t});\n\t}\n}\n","import 'ui.notification';\nimport { Loc } from 'main.core';\n\nimport { SidebarMenu } from '../sidebar-base-menu';\nimport { TaskManager } from './task-manager';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\nimport type { ImModelSidebarTaskItem } from 'im.v2.model';\nimport type { ApplicationContext } from 'im.v2.const';\n\ntype TaskMenuContext = {\n\ttask: ImModelSidebarTaskItem,\n\tmessageId: number,\n\tdialogId: string,\n\tsource: string,\n}\n\nexport class TaskMenu extends SidebarMenu\n{\n\tcontext: TaskMenuContext;\n\n\tconstructor(applicationContext: ApplicationContext)\n\t{\n\t\tsuper(applicationContext);\n\n\t\tthis.id = 'im-sidebar-context-menu';\n\t\tthis.taskManager = new TaskManager();\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenContextMessageItem(),\n\t\t\tthis.getCopyLinkItem(Loc.getMessage('IM_SIDEBAR_MENU_COPY_TASK_LINK')),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\t}\n\n\tgetDeleteItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_SIDEBAR_MENU_DELETE_TASK_CONNECTION'),\n\t\t\tonClick: function() {\n\t\t\t\tthis.taskManager.delete(this.context.task);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n}\n","import { Type, Text } from 'main.core';\nimport { LabelColor } from 'ui.label';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\n\nimport './css/task-item.css';\n\nimport type { ImModelSidebarTaskItem } from 'im.v2.model';\n\n// @vue/component\nexport const TaskItem = {\n\tname: 'TaskItem',\n\tcomponents: { ChatAvatar, AvatarSize },\n\tprops: {\n\t\ttask: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata(): { showContextButton: boolean } {\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\ttaskItem(): ImModelSidebarTaskItem\n\t\t{\n\t\t\treturn this.task;\n\t\t},\n\t\ttaskTitle(): string\n\t\t{\n\t\t\tif (this.searchQuery.length === 0)\n\t\t\t{\n\t\t\t\treturn Text.encode(this.taskItem.task.title);\n\t\t\t}\n\n\t\t\treturn highlightText(Text.encode(this.taskItem.task.title), this.searchQuery);\n\t\t},\n\t\ttaskAuthorDialogId(): string\n\t\t{\n\t\t\treturn this.taskItem.task.creatorId.toString();\n\t\t},\n\t\ttaskResponsibleDialogId(): string\n\t\t{\n\t\t\treturn this.taskItem.task.responsibleId.toString();\n\t\t},\n\t\ttaskDeadlineText(): string\n\t\t{\n\t\t\tconst statusToShow = Type.isStringFilled(this.taskItem.task.state)\n\t\t\t\t? this.taskItem.task.state\n\t\t\t\t: this.taskItem.task.statusTitle\n\t\t\t;\n\n\t\t\treturn Utils.text.convertHtmlEntities(statusToShow);\n\t\t},\n\t\ttaskBackgroundColorClass(): string\n\t\t{\n\t\t\tif (this.taskItem.task.status === 5)\n\t\t\t{\n\t\t\t\treturn '--completed';\n\t\t\t}\n\n\t\t\treturn '';\n\t\t},\n\t\tstatusColorClass(): string\n\t\t{\n\t\t\tif (!this.taskItem.task.color || !LabelColor[this.taskItem.task.color.toUpperCase()])\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn `ui-label-${this.taskItem.task.color.toLowerCase()}`;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonTaskClick()\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(this.taskItem.task.source, { cacheable: false });\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\ttask: this.taskItem,\n\t\t\t\tsource: this.taskItem.task.source,\n\t\t\t\tmessageId: this.taskItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-task-item__container bx-im-sidebar-task-item__scope\" \n\t\t\t:class=\"taskBackgroundColorClass\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-task-item__content\" @click=\"onTaskClick\">\n\t\t\t\t<div class=\"bx-im-sidebar-task-item__header-text\" :title=\"taskTitle\" v-html=\"taskTitle\"></div>\n\t\t\t\t<div class=\"bx-im-sidebar-task-item__detail-container\">\n\t\t\t\t\t<ChatAvatar \n\t\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t\t\t:avatarDialogId=\"taskAuthorDialogId\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"bx-im-sidebar-task-item__forward-small-icon bx-im-sidebar__forward-small-icon\"></div>\n\t\t\t\t\t<ChatAvatar \n\t\t\t\t\t\t:avatarDialogId=\"taskResponsibleDialogId\"\n\t\t\t\t\t\t:size=\"AvatarSize.XS\" \n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"bx-im-sidebar-task-item__status-text\" :class=\"statusColorClass\">\n\t\t\t\t\t\t{{taskDeadlineText}}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button \n\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\tclass=\"bx-im-messenger__context-menu-icon\" \n\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import { Analytics } from 'im.v2.lib.analytics';\nimport { EntityCreator } from 'im.v2.lib.entity-creator';\nimport { EventType, SidebarDetailBlock, ActionByRole } from 'im.v2.const';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { ChatButton, ButtonColor, ButtonSize } from 'im.v2.component.elements.button';\n\nimport { TaskMenu } from '../../../../classes/context-menu/task/task-menu';\nimport { DetailEmptyState } from '../../../elements/detail-empty-state/detail-empty-state';\nimport { TaskItem } from '../../task/task-item';\n\nimport '../css/task-list.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelSidebarTaskItem, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const TaskListPreview = {\n\tname: 'TaskListPreview',\n\tcomponents: { DetailEmptyState, TaskItem, ChatButton },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tfirstTask(): ?ImModelSidebarTaskItem\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/tasks/get'](this.chatId)[0];\n\t\t},\n\t\tshowAddButton(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformActionByRole(ActionByRole.createTask, this.dialogId);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\taddButtonColor(): ButtonColor\n\t\t{\n\t\t\treturn this.ButtonColor.PrimaryLight;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new TaskMenu({ emitter: this.getEmitter() });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tgetEntityCreator(): EntityCreator\n\t\t{\n\t\t\treturn (new EntityCreator(this.chatId));\n\t\t},\n\t\tonAddClick()\n\t\t{\n\t\t\tAnalytics.getInstance().chatEntities.onCreateTaskFromSidebarClick(this.dialogId);\n\t\t\tvoid this.getEntityCreator().createTaskForChat();\n\t\t},\n\t\tonOpenDetail()\n\t\t{\n\t\t\tif (!this.firstTask)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getEmitter().emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.task,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-task-list-preview__scope\">\n\t\t\t<div class=\"bx-im-sidebar-task-list-preview__container\">\n\t\t\t\t<div \n\t\t\t\t\tclass=\"bx-im-sidebar-task-list-preview__header_container\"\n\t\t\t\t\t:class=\"[firstTask ? '--active': '']\"\n\t\t\t\t\t@click=\"onOpenDetail\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bx-im-sidebar-task-list-preview__title\">\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-task-list-preview__title-text\">\n\t\t\t\t\t\t\t{{ loc('IM_SIDEBAR_TASK_DETAIL_TITLE') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div v-if=\"firstTask\" class=\"bx-im-sidebar__forward-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<transition name=\"add-button\">\n\t\t\t\t\t\t<ChatButton\n\t\t\t\t\t\t\tv-if=\"showAddButton\"\n\t\t\t\t\t\t\t:text=\"loc('IM_SIDEBAR_ADD_BUTTON_TEXT')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.S\"\n\t\t\t\t\t\t\t:color=\"addButtonColor\"\n\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t@click=\"onAddClick\"\n\t\t\t\t\t\t\tclass=\"bx-im-sidebar-task-list-preview__title-button\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</transition>\n\t\t\t\t</div>\n\t\t\t\t<TaskItem \n\t\t\t\t\tv-if=\"firstTask\"\n\t\t\t\t\t:task=\"firstTask\"\n\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t/>\n\t\t\t\t<DetailEmptyState \n\t\t\t\t\tv-else \n\t\t\t\t\t:title=\"loc('IM_SIDEBAR_TASKS_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.task\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './market-item.css';\n\nimport type { ImModelMarketApplication } from 'im.v2.model';\n\n// @vue/component\nexport const MarketItem = {\n\tname: 'MarketItem',\n\tprops: {\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmarketItem(): ImModelMarketApplication\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\ticonClass(): string\n\t\t{\n\t\t\treturn `fa ${this.marketItem.options.iconName}`;\n\t\t},\n\t\ticonColor(): string\n\t\t{\n\t\t\treturn this.marketItem.options.color;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-market-preview-item__container bx-im-sidebar-market-preview-item__scope\">\n\t\t\t<div class=\"bx-im-sidebar-market-preview-item__icon-container\" :style=\"{backgroundColor: iconColor}\">\n\t\t\t\t<i :class=\"iconClass\" aria-hidden=\"true\"></i>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-market-preview-item__title-container\" :title=\"marketItem.title\">\n\t\t\t\t{{ marketItem.title }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { MarketManager } from 'im.v2.lib.market';\nimport { EventType, PlacementType, SidebarDetailBlock } from 'im.v2.const';\n\nimport { MarketItem } from '../../../elements/market-item/market-item';\n\nimport '../css/market.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelMarketApplication } from 'im.v2.model';\n\n// @vue/component\nexport const MarketAppListPreview = {\n\tname: 'MarketAppListPreview',\n\tcomponents: { MarketItem },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['openDetail'],\n\tcomputed:\n\t{\n\t\tmarketMenuItems(): ImModelMarketApplication[]\n\t\t{\n\t\t\treturn MarketManager.getInstance().getAvailablePlacementsByType(PlacementType.sidebar, this.dialogId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonMarketItemClick(entityId)\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.market,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tentityId,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-market-preview__scope bx-im-sidebar-market-preview__container\">\n\t\t\t<div class=\"bx-im-sidebar-market-preview__header_container\">\n\t\t\t\t<div class=\"bx-im-sidebar-market-preview__title\">\n\t\t\t\t\t<span class=\"bx-im-sidebar-market-preview__title-text\">\n\t\t\t\t\t\t{{ loc('IM_SIDEBAR_MARKET_DETAIL_TITLE') }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<MarketItem \n\t\t\t\tv-for=\"item in marketMenuItems\" \n\t\t\t\t:key=\"item.id\"\n\t\t\t\t:item=\"item\"\n\t\t\t\t@click=\"onMarketItemClick(item.id)\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { RestClient } from 'rest.client';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\n\nexport class MeetingManager\n{\n\tstore: Store;\n\trestClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t}\n\n\tdelete({ id, chatId })\n\t{\n\t\tthis.store.dispatch('sidebar/meetings/delete', { chatId, id });\n\n\t\tconst queryParams = { LINK_ID: id };\n\t\tthis.restClient.callMethod(RestMethod.imChatCalendarDelete, queryParams).catch((error) => {\n\t\t\tconsole.error('Im.Sidebar: error deleting meeting', error);\n\t\t});\n\t}\n}\n","import 'ui.notification';\nimport { Loc } from 'main.core';\n\nimport { SidebarMenu } from '../sidebar-base-menu';\nimport { MeetingManager } from './meeting-manager';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\nimport type { ImModelSidebarMeetingItem } from 'im.v2.model';\nimport type { ApplicationContext } from 'im.v2.const';\n\ntype MeetingMenuContext = {\n\tmeeting: ImModelSidebarMeetingItem,\n\tmessageId: number,\n\tdialogId: string,\n\tsource: string,\n}\n\nexport class MeetingMenu extends SidebarMenu\n{\n\tcontext: MeetingMenuContext;\n\n\tconstructor(applicationContext: ApplicationContext)\n\t{\n\t\tsuper(applicationContext);\n\n\t\tthis.id = 'im-sidebar-context-menu';\n\t\tthis.meetingManager = new MeetingManager();\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenContextMessageItem(),\n\t\t\tthis.getCopyLinkItem(Loc.getMessage('IM_SIDEBAR_MENU_COPY_MEETING_LINK')),\n\t\t\tthis.getDeleteItem(),\n\t\t];\n\t}\n\n\tgetDeleteItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_SIDEBAR_MENU_DELETE_MEETING_CONNECTION'),\n\t\t\tonClick: function() {\n\t\t\t\tthis.meetingManager.delete(this.context.meeting);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n}\n","import { DateTimeFormat } from 'main.date';\nimport { Text } from 'main.core';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\n\nimport './css/meeting-item.css';\n\nimport type { ImModelSidebarMeetingItem } from 'im.v2.model';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\n\n// @vue/component\nexport const MeetingItem = {\n\tname: 'MeetingItem',\n\tprops: {\n\t\tmeeting: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata(): { showContextButton: boolean } {\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tmeetingItem(): ImModelSidebarMeetingItem\n\t\t{\n\t\t\treturn this.meeting;\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\tif (this.searchQuery.length === 0)\n\t\t\t{\n\t\t\t\treturn Text.encode(this.meetingItem.meeting.title);\n\t\t\t}\n\n\t\t\treturn highlightText(Text.encode(this.meetingItem.meeting.title), this.searchQuery);\n\t\t},\n\t\tdate(): string\n\t\t{\n\t\t\tconst meetingDate = this.meetingItem.meeting.dateFrom;\n\n\t\t\treturn DateFormatter.formatByTemplate(meetingDate, DateTemplate.meeting);\n\t\t},\n\t\tday(): string\n\t\t{\n\t\t\treturn this.meetingItem.meeting.dateFrom.getDate().toString();\n\t\t},\n\t\tmonthShort(): string\n\t\t{\n\t\t\treturn DateTimeFormat.format('M', this.meetingItem.meeting.dateFrom);\n\t\t},\n\t\tisActive(): boolean\n\t\t{\n\t\t\treturn this.meetingItem.meeting.dateFrom.getTime() > Date.now();\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonMeetingClick()\n\t\t{\n\t\t\t// todo replace this call to something\n\t\t\tnew (window.top.BX || window.BX).Calendar.SliderLoader(this.meetingItem.meeting.id).show();\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tmeeting: this.meetingItem,\n\t\t\t\tsource: this.meetingItem.meeting.source,\n\t\t\t\tmessageId: this.meetingItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-meeting-item__container bx-im-sidebar-meeting-item__scope\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div \n\t\t\t\tclass=\"bx-im-sidebar-meeting-item__icon-container\"\n\t\t\t\t:class=\"[isActive ? '--active' : '--inactive']\"\n\t\t\t>\n\t\t\t\t<div class=\"bx-im-sidebar-meeting-item__day-text\">{{ day }}</div>\n\t\t\t\t<div class=\"bx-im-sidebar-meeting-item__month-text\">{{ monthShort }}</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-meeting-item__content-container\" @click=\"onMeetingClick\">\n\t\t\t\t<div class=\"bx-im-sidebar-meeting-item__content\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-meeting-item__title\" :title=\"title\" v-html=\"title\"></div>\n\t\t\t\t\t<div class=\"bx-im-sidebar-meeting-item__date\">{{ date }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button \n\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\tclass=\"bx-im-messenger__context-menu-icon\" \n\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import { Analytics } from 'im.v2.lib.analytics';\nimport { ImModelSidebarMeetingItem, ImModelChat } from 'im.v2.model';\nimport { ChatButton, ButtonColor, ButtonSize } from 'im.v2.component.elements.button';\nimport { EventType, SidebarDetailBlock, ActionByRole } from 'im.v2.const';\nimport { EntityCreator } from 'im.v2.lib.entity-creator';\nimport { PermissionManager } from 'im.v2.lib.permission';\n\nimport { MeetingMenu } from '../../../../classes/context-menu/meeting/meeting-menu';\nimport { DetailEmptyState } from '../../../elements/detail-empty-state/detail-empty-state';\nimport { MeetingItem } from '../../meeting/meeting-item';\n\nimport '../css/meeting.css';\n\nimport type { EventEmitter } from 'main.core.events';\n\n// @vue/component\nexport const MeetingListPreview = {\n\tname: 'MeetingListPreview',\n\tcomponents: { MeetingItem, DetailEmptyState, ChatButton },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tfirstMeeting(): ?ImModelSidebarMeetingItem\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/meetings/get'](this.chatId)[0];\n\t\t},\n\t\tshowAddButton(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformActionByRole(ActionByRole.createMeeting, this.dialogId);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\taddButtonColor(): ButtonColor\n\t\t{\n\t\t\treturn this.ButtonColor.PrimaryLight;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new MeetingMenu({ emitter: this.getEmitter() });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tgetEntityCreator(): EntityCreator\n\t\t{\n\t\t\treturn (new EntityCreator(this.chatId));\n\t\t},\n\t\tonAddClick()\n\t\t{\n\t\t\tAnalytics.getInstance().chatEntities.onCreateEventFromSidebarClick(this.dialogId);\n\n\t\t\tvoid this.getEntityCreator().createMeetingForChat();\n\t\t},\n\t\tonOpenDetail()\n\t\t{\n\t\t\tif (!this.firstMeeting)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.getEmitter().emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.meeting,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-meeting-preview__scope\">\n\t\t\t<div class=\"bx-im-sidebar-meeting-preview__container\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"bx-im-sidebar-meeting-preview__header_container\"\n\t\t\t\t\t:class=\"[firstMeeting ? '--active': '']\"\n\t\t\t\t\t@click=\"onOpenDetail\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bx-im-sidebar-meeting-preview__title\">\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-meeting-preview__title-text\">\n\t\t\t\t\t\t\t{{ loc('IM_SIDEBAR_MEETING_DETAIL_TITLE') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div v-if=\"firstMeeting\" class=\"bx-im-sidebar__forward-icon\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<transition name=\"add-button\">\n\t\t\t\t\t\t<ChatButton\n\t\t\t\t\t\t\tv-if=\"showAddButton\"\n\t\t\t\t\t\t\t:text=\"loc('IM_SIDEBAR_ADD_BUTTON_TEXT')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.S\"\n\t\t\t\t\t\t\t:color=\"addButtonColor\"\n\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t@click=\"onAddClick\"\n\t\t\t\t\t\t\tclass=\"bx-im-sidebar-meeting-preview__title-button\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</transition>\n\t\t\t\t</div>\n\t\t\t\t<MeetingItem v-if=\"firstMeeting\" :meeting=\"firstMeeting\" @contextMenuClick=\"onContextMenuClick\"/>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-else\n\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MEETINGS_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.meeting\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ChatLinks } from '../../../elements/chat-links/chat-links';\nimport { ChatFavourites } from '../../../elements/chat-favourites/chat-favourites';\nimport { ChatDescription } from '../../../elements/chat-description/chat-description';\n\nimport '../css/info.css';\n\n// @vue/component\nexport const CopilotInfoPreview = {\n\tname: 'CopilotInfoPreview',\n\tcomponents: { ChatDescription, ChatLinks, ChatFavourites },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-info-preview__container\">\n\t\t\t<ChatDescription :dialogId=\"dialogId\" />\n\t\t\t<ChatFavourites :dialogId=\"dialogId\" />\n\t\t</div>\n\t`,\n};\n","import { hint } from 'ui.vue3.directives.hint';\n\nimport { ActionByRole } from 'im.v2.const';\nimport { Core } from 'im.v2.application.core';\nimport { ChatService } from 'im.v2.provider.service.chat';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { Toggle, ToggleSize } from 'im.v2.component.elements.toggle';\n\nimport type { ImModelChat } from 'im.v2.model';\n\nimport './css/mute-chat.css';\n\n// @vue/component\nexport const MuteChat = {\n\tname: 'MuteChat',\n\tdirectives: { hint },\n\tcomponents: { Toggle },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tToggleSize: () => ToggleSize,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tcanBeMuted(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformActionByRole(ActionByRole.mute, this.dialogId);\n\t\t},\n\t\tisChatMuted(): boolean\n\t\t{\n\t\t\tconst isMuted = this.dialog.muteList.find((element) => {\n\t\t\t\treturn element === Core.getUserId();\n\t\t\t});\n\n\t\t\treturn Boolean(isMuted);\n\t\t},\n\t\thintMuteNotAvailable(): ?Object\n\t\t{\n\t\t\tif (this.canBeMuted)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('IM_SIDEBAR_MUTE_NOT_AVAILABLE'),\n\t\t\t\tpopupOptions: {\n\t\t\t\t\tangle: true,\n\t\t\t\t\ttargetContainer: document.body,\n\t\t\t\t\toffsetLeft: 141,\n\t\t\t\t\toffsetTop: -10,\n\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\tposition: 'top',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\tmuteActionHandler()\n\t\t{\n\t\t\tif (!this.canBeMuted)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isChatMuted)\n\t\t\t{\n\t\t\t\tthis.getChatService().unmuteChat(this.dialogId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.getChatService().muteChat(this.dialogId);\n\t\t\t}\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"bx-im-sidebar-mute-chat__container\"\n\t\t\t:class=\"{'--not-active': !canBeMuted}\"\n\t\t\tv-hint=\"hintMuteNotAvailable\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-mute-chat__title\">\n\t\t\t\t<div class=\"bx-im-sidebar-mute-chat__title-text bx-im-sidebar-mute-chat__icon\">\n\t\t\t\t\t{{ loc('IM_SIDEBAR_ENABLE_NOTIFICATION_TITLE_2') }}\n\t\t\t\t</div>\n\t\t\t\t<Toggle :size=\"ToggleSize.M\" :isEnabled=\"!isChatMuted\" @click=\"muteActionHandler\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ChannelManager } from 'im.v2.lib.channel';\nimport { Toggle, ToggleSize } from 'im.v2.component.elements.toggle';\nimport { AutoDeleteDropdown, AutoDeletePopup, AutoDeleteHint } from 'im.v2.component.elements.auto-delete';\nimport { Feature, FeatureManager } from 'im.v2.lib.feature';\nimport { ChatService } from 'im.v2.provider.service.chat';\nimport { ChatType, UserType, AutoDeleteDelay } from 'im.v2.const';\nimport { AutoDeleteManager } from 'im.v2.lib.auto-delete';\n\nimport './css/auto-delete.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const AutoDelete = {\n\tname: 'AutoDelete',\n\tcomponents: { Toggle, AutoDeleteHint, AutoDeleteDropdown, AutoDeletePopup },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowHint: false,\n\t\t\tshowPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tToggleSize: () => ToggleSize,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tautoDeleteDelayInHours(): number\n\t\t{\n\t\t\treturn this.$store.getters['chats/autoDelete/getDelay'](this.chatId);\n\t\t},\n\t\tisAutoDeleteFeatureEnabled(): boolean\n\t\t{\n\t\t\treturn FeatureManager.isFeatureAvailable(Feature.messagesAutoDeleteEnabled);\n\t\t},\n\t\tisAutoDeleteAllowed(): boolean\n\t\t{\n\t\t\treturn AutoDeleteManager.isAutoDeleteAllowed(this.dialogId);\n\t\t},\n\t\tisBot(): boolean\n\t\t{\n\t\t\tconst user: ImModelUser = this.$store.getters['users/get'](this.dialogId, true);\n\n\t\t\treturn user.type === UserType.bot;\n\t\t},\n\t\tisAutoDeleteAvailableByChatType(): boolean\n\t\t{\n\t\t\tconst NoAutoDeleteChatTypes = [\n\t\t\t\tChatType.copilot,\n\t\t\t\tChatType.lines,\n\t\t\t\tChatType.videoconf,\n\t\t\t\t...ChannelManager.getChannelTypes(),\n\t\t\t];\n\n\t\t\tif (NoAutoDeleteChatTypes.includes(this.dialog.type))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn !this.isBot;\n\t\t},\n\t\tisAutoDeleteActive(): boolean\n\t\t{\n\t\t\treturn this.autoDeleteDelayInHours > 0;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tgetChatService(): ChatService\n\t\t{\n\t\t\tif (!this.chatService)\n\t\t\t{\n\t\t\t\tthis.chatService = new ChatService();\n\t\t\t}\n\n\t\t\treturn this.chatService;\n\t\t},\n\t\tchangeAutoDeleteActionHandler(): void\n\t\t{\n\t\t\tif (!this.isAutoDeleteAllowed)\n\t\t\t{\n\t\t\t\tthis.showHint = true;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isAutoDeleteActive)\n\t\t\t{\n\t\t\t\tthis.updateAutoDeleteDelay(AutoDeleteDelay.Off);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.isAutoDeleteFeatureEnabled)\n\t\t\t{\n\t\t\t\tFeatureManager.messagesAutoDelete.openFeatureSlider();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showPopup = true;\n\t\t},\n\t\tupdateAutoDeleteDelay(delay: number): void\n\t\t{\n\t\t\tthis.getChatService().setMessagesAutoDeleteDelay(this.dialogId, delay);\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t\tonAutoDeleteDelayChange(delay: number): void\n\t\t{\n\t\t\tthis.updateAutoDeleteDelay(delay);\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tonDropDownClick(event: PointerEvent)\n\t\t{\n\t\t\tif (this.isAutoDeleteAllowed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.stopPropagation();\n\t\t\tthis.showHint = true;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"isAutoDeleteAvailableByChatType\"\n\t\t\tclass=\"bx-im-sidebar-auto-delete__container\"\n\t\t\tref=\"auto-delete\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-auto-delete__title\">\n\t\t\t\t<div class=\"bx-im-sidebar-auto-delete__title-text bx-im-sidebar-auto-delete__icon\">\n\t\t\t\t\t{{ loc('IM_SIDEBAR_ENABLE_AUTODELETE_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<Toggle\n\t\t\t\t\t:size=\"ToggleSize.M\"\n\t\t\t\t\t:isEnabled=\"isAutoDeleteActive\"\n\t\t\t\t\t:disabled=\"!isAutoDeleteAllowed\"\n\t\t\t\t\t@click=\"changeAutoDeleteActionHandler\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<AutoDeleteDropdown\n\t\t\t\t:currentDelay=\"autoDeleteDelayInHours\"\n\t\t\t\t@delayChange=\"updateAutoDeleteDelay\"\n\t\t\t\t@click.capture=\"onDropDownClick\"\n\t\t\t/>\n\t\t\t<AutoDeleteHint \n\t\t\t\tv-if=\"showHint\"\n\t\t\t\t:bindElement=\"$refs['auto-delete']\" \n\t\t\t\t@close=\"showHint = false\"\n\t\t\t/>\n\t\t\t<AutoDeletePopup\n\t\t\t\tv-if=\"showPopup\"\n\t\t\t\t:autoDeleteDelay=\"autoDeleteDelayInHours\"\n\t\t\t\t@close=\"showPopup = false\"\n\t\t\t\t@autoDeleteDelayChange=\"onAutoDeleteDelayChange\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Analytics } from 'im.v2.lib.analytics';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { AddToChat, AddToCollab } from 'im.v2.component.entity-selector';\nimport { ActionByRole, ChatType, EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { ChatButton, ButtonSize, ButtonColor } from 'im.v2.component.elements.button';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport './chat-members-avatars.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat } from 'im.v2.model';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\n\n// @vue/component\nexport const ChatMembersAvatars = {\n\tname: 'ChatMembersAvatars',\n\tcomponents: { ChatAvatar, ChatButton, AddToChat },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tshowMembers: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowAddToChatPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tdialogIds(): string[]\n\t\t{\n\t\t\tconst PREVIEW_USERS_COUNT = 4;\n\t\t\tconst userIds = this.$store.getters['sidebar/members/get'](this.chatId);\n\n\t\t\treturn userIds.map((id: number) => id.toString()).slice(0, PREVIEW_USERS_COUNT);\n\t\t},\n\t\tcanSeeMembers(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformActionByRole(ActionByRole.userList, this.dialogId);\n\t\t},\n\t\tcanInviteMembers(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformActionByRole(\n\t\t\t\tActionByRole.extend,\n\t\t\t\tthis.dialogId,\n\t\t\t);\n\t\t},\n\t\tusersInChatCount(): number\n\t\t{\n\t\t\treturn this.dialog.userCounter;\n\t\t},\n\t\tmoreUsersCount(): number\n\t\t{\n\t\t\treturn Math.max(this.usersInChatCount - this.dialogIds.length, 0);\n\t\t},\n\t\tisCollab(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.collab;\n\t\t},\n\t\taddUsersButtonColor(): ButtonColor\n\t\t{\n\t\t\tif (this.isCollab)\n\t\t\t{\n\t\t\t\treturn this.ButtonColor.Collab;\n\t\t\t}\n\n\t\t\treturn this.ButtonColor.PrimaryLight;\n\t\t},\n\t\taddMembersPopupComponent(): BitrixVueComponentProps\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.collab ? AddToCollab : AddToChat;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonOpenUsers()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.members,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tonOpenInvitePopup()\n\t\t{\n\t\t\tAnalytics.getInstance().userAdd.onChatSidebarClick(this.dialogId);\n\t\t\tthis.showAddToChatPopup = true;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-chat-members-avatars__container\">\n\t\t\t<div v-if=\"canSeeMembers && showMembers\" class=\"bx-im-sidebar-chat-members-avatars__members\" @click=\"onOpenUsers\">\n\t\t\t\t<div class=\"bx-im-sidebar-chat-members-avatars__avatars\" >\n\t\t\t\t\t<ChatAvatar\n\t\t\t\t\t\tv-for=\"id in dialogIds\"\n\t\t\t\t\t\t:size=\"AvatarSize.S\"\n\t\t\t\t\t\t:avatarDialogId=\"id\"\n\t\t\t\t\t\t:contextDialogId=\"dialogId\"\n\t\t\t\t\t\tclass=\"bx-im-sidebar-chat-members-avatars__avatar\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"moreUsersCount > 0\" class=\"bx-im-sidebar-chat-members-avatars__text\">\n\t\t\t\t\t+{{ moreUsersCount }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div ref=\"add-members\">\n\t\t\t\t<ChatButton\n\t\t\t\t\tv-if=\"canInviteMembers\"\n\t\t\t\t\t:text=\"loc('IM_SIDEBAR_ADD_BUTTON_TEXT')\"\n\t\t\t\t\t:size=\"ButtonSize.S\"\n\t\t\t\t\t:color=\"addUsersButtonColor\"\n\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t@click=\"onOpenInvitePopup\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<component\n\t\t\t\tv-if=\"showAddToChatPopup\"\n\t\t\t\t:is=\"addMembersPopupComponent\"\n\t\t\t\t:bindElement=\"$refs['add-members'] || {}\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:popupConfig=\"{offsetTop: -220, offsetLeft: -420}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { SidebarManager, type SidebarConfig } from 'im.v2.lib.sidebar';\n\nimport { MuteChat } from '../../../elements/mute-chat/mute-chat';\nimport { AutoDelete } from '../../../elements/auto-delete/auto-delete';\nimport { ChatMembersAvatars } from '../../../elements/chat-members-avatars/chat-members-avatars';\n\nimport '../css/chat-preview.css';\n\n// @vue/component\nexport const ChatPreview = {\n\tname: 'ChatPreview',\n\tcomponents: { ChatAvatar, ChatTitle, MuteChat, ChatMembersAvatars, AutoDelete },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tsidebarConfig(): SidebarConfig\n\t\t{\n\t\t\treturn SidebarManager.getInstance().getConfig(this.dialogId);\n\t\t},\n\t\tareChatMembersEnabled(): boolean\n\t\t{\n\t\t\treturn this.sidebarConfig.areChatMembersEnabled();\n\t\t},\n\t\tisAutoDeleteEnabled(): boolean\n\t\t{\n\t\t\treturn this.sidebarConfig.isAutoDeleteEnabled();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-main-preview__scope\">\n\t\t\t<div class=\"bx-im-sidebar-main-preview-group-chat__avatar-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-main-preview-group-chat__avatar\">\n\t\t\t\t\t<ChatAvatar \n\t\t\t\t\t\t:avatarDialogId=\"dialogId\" \n\t\t\t\t\t\t:size=\"AvatarSize.XXXL\" \n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<ChatTitle :dialogId=\"dialogId\" :twoLine=\"true\" class=\"bx-im-sidebar-main-preview-group-chat__title\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-main-preview-group-chat__chat-members\">\n\t\t\t\t<ChatMembersAvatars :showMembers=\"areChatMembersEnabled\" :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-main-preview-group-chat__settings\">\n\t\t\t\t<MuteChat :dialogId=\"dialogId\" />\n\t\t\t\t<AutoDelete v-if=\"isAutoDeleteEnabled\" :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport { MuteChat } from '../../../elements/mute-chat/mute-chat';\nimport { AutoDelete } from '../../../elements/auto-delete/auto-delete';\nimport { ChatMembersAvatars } from '../../../elements/chat-members-avatars/chat-members-avatars';\n\nimport '../css/post-preview.css';\n\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const PostPreview = {\n\tname: 'PostPreview',\n\tcomponents: { ChatAvatar, ChatTitle, MuteChat, ChatMembersAvatars, AutoDelete },\n\tprops:\n\t{\n\t\tdialogId:\n\t\t{\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tpostDialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/getByChatId'](this.dialog.parentChatId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-main-preview-post__scope\">\n\t\t\t<div class=\"bx-im-sidebar-main-preview-post__avatar-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-main-preview-post__avatar\">\n\t\t\t\t\t<ChatAvatar :avatarDialogId=\"postDialog.dialogId\" :size=\"AvatarSize.XXXL\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-sidebar-main-preview-post__title\">{{ loc('IM_SIDEBAR_COMMENTS_POST_PREVIEW_TITLE') }}</div>\n\t\t\t\t<div class=\"bx-im-sidebar-main-preview-post__subtitle\">{{ postDialog.name }}</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-main-preview-post__settings\">\n\t\t\t\t<!-- TODO: follow toggle -->\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Analytics } from 'im.v2.lib.analytics';\nimport { hint } from 'ui.vue3.directives.hint';\n\nimport { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { ChatButton, ButtonColor, ButtonSize } from 'im.v2.component.elements.button';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { ActionByRole, ActionByUserType, UserType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { AddToChat } from 'im.v2.component.entity-selector';\nimport { PermissionManager } from 'im.v2.lib.permission';\n\nimport { AutoDelete } from '../../../elements/auto-delete/auto-delete';\nimport { MuteChat } from '../../../elements/mute-chat/mute-chat';\n\nimport '../css/user-preview.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelChat, ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const UserPreview = {\n\tname: 'UserPreview',\n\tdirectives: { hint },\n\tcomponents: { ChatAvatar, ChatTitle, ChatButton, AddToChat, AutoDelete, MuteChat },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowAddToChatPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tuserPosition(): string\n\t\t{\n\t\t\treturn this.$store.getters['users/getPosition'](this.dialogId);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tcanInviteMembers(): boolean\n\t\t{\n\t\t\tconst canCreateChat = PermissionManager.getInstance().canPerformActionByUserType(ActionByUserType.createChat);\n\t\t\tconst canExtendChat = PermissionManager.getInstance().canPerformActionByRole(ActionByRole.extend, this.dialogId);\n\n\t\t\treturn canCreateChat && canExtendChat;\n\t\t},\n\t\tshowInviteButton(): boolean\n\t\t{\n\t\t\tif (this.isBot)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.canInviteMembers;\n\t\t},\n\t\tuserLink(): string\n\t\t{\n\t\t\treturn Utils.user.getProfileLink(this.dialogId);\n\t\t},\n\t\tisBot(): boolean\n\t\t{\n\t\t\treturn this.user.type === UserType.bot;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonAddClick()\n\t\t{\n\t\t\tAnalytics.getInstance().userAdd.onChatSidebarClick(this.dialogId);\n\t\t\tthis.showAddToChatPopup = true;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-main-preview__scope\">\n\t\t\t<div class=\"bx-im-sidebar-main-preview-personal-chat__avatar-container\">\n\t\t\t\t<ChatAvatar\n\t\t\t\t\t:avatarDialogId=\"dialogId\"\n\t\t\t\t\t:contextDialogId=\"dialogId\"\n\t\t\t\t\t:size=\"AvatarSize.XXXL\"\n\t\t\t\t\tclass=\"bx-im-sidebar-main-preview-personal-chat__avatar\"\n\t\t\t\t/>\n\t\t\t\t<a :href=\"userLink\" target=\"_blank\">\n\t\t\t\t\t<ChatTitle :dialogId=\"dialogId\" class=\"bx-im-sidebar-main-preview-personal-chat__user-name\" />\n\t\t\t\t</a>\n\t\t\t\t<div class=\"bx-im-sidebar-main-preview-personal-chat__user-position\" :title=\"userPosition\">\n\t\t\t\t\t{{ userPosition }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div \n\t\t\t\tv-if=\"showInviteButton\" \n\t\t\t\tclass=\"bx-im-sidebar-main-preview-personal-chat__invite-button-container\" \n\t\t\t\tref=\"add-members\"\n\t\t\t>\n\t\t\t\t<ChatButton\n\t\t\t\t\tv-if=\"canInviteMembers\"\n\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_CREATE_GROUP_CHAT')\"\n\t\t\t\t\t:size=\"ButtonSize.S\"\n\t\t\t\t\t:color=\"ButtonColor.PrimaryLight\"\n\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t@click=\"onAddClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-main-preview-personal-chat__auto-delete-container\">\n\t\t\t\t<MuteChat :dialogId=\"dialogId\" />\n\t\t\t\t<AutoDelete :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t\t<AddToChat\n\t\t\t\tv-if=\"showAddToChatPopup\"\n\t\t\t\t:bindElement=\"$refs['add-members'] || {}\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:popupConfig=\"{offsetTop: -220, offsetLeft: -320}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Store } from 'ui.vue3.vuex';\n\nimport { runAction } from 'im.v2.lib.rest';\nimport { Core } from 'im.v2.application.core';\nimport { Logger } from 'im.v2.lib.logger';\nimport { RestMethod } from 'im.v2.const';\n\nimport type { ImModelCopilotRole } from 'im.v2.model';\n\nexport type RawRole = {\n\tcode: string,\n\tname: string,\n\tdescription: string,\n\tindustryCode: string,\n\tisNew: boolean,\n\tisRecommended: boolean,\n\tisSystem: boolean,\n\tavatar: {\n\t\tsmall: string,\n\t\tmedium: string,\n\t\tlarge: string,\n\t},\n};\n\nexport class CopilotService\n{\n\t#store: Store;\n\n\tconstructor()\n\t{\n\t\tthis.#store = Core.getStore();\n\t}\n\n\tupdateRole({ dialogId, newRole }: { dialogId: string, newRole: RawRole }): Promise\n\t{\n\t\tLogger.warn('CopilotService: update role', dialogId);\n\t\tconst currentRole: ImModelCopilotRole = this.#store.getters['copilot/chats/getRole'](dialogId);\n\n\t\tif (currentRole.code === newRole.code)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tvoid this.#store.dispatch('copilot/chats/set', { dialogId, role: newRole.code });\n\t\tvoid this.#store.dispatch('copilot/roles/add', [newRole]);\n\n\t\treturn this.#sendRequest({ dialogId, newRoleCode: newRole.code });\n\t}\n\n\t#sendRequest({ dialogId, newRoleCode }: { dialogId: string, newRoleCode: string }): Promise\n\t{\n\t\tconst requestParams = { data: { dialogId, role: newRoleCode } };\n\n\t\treturn runAction(RestMethod.imV2ChatCopilotUpdateRole, requestParams);\n\t}\n}\n","import { PromoVideoPopup, PromoVideoPopupEvents } from 'ui.promo-video-popup';\nimport { Loc } from 'main.core';\n\nimport '../css/change-role-promo.css';\n\n// @vue/component\nexport const ChangeRolePromo = {\n\tname: 'ChangeRolePromo',\n\tprops:\n\t{\n\t\tbindElement: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['hide', 'accept'],\n\tcomputed:\n\t{\n\t\ttext(): string\n\t\t{\n\t\t\treturn Loc.getMessage('IM_SIDEBAR_COPILOT_CHANGE_ROLE_PROMO_TEXT', {\n\t\t\t\t'[copilot_color]': '<em class=\"bx-im-copilot-change-role-promo__copilot\">',\n\t\t\t\t'[/copilot_color]': '</em>',\n\t\t\t});\n\t\t},\n\t\tvideoSource(): string\n\t\t{\n\t\t\tconst basePath = '/bitrix/js/im/v2/component/sidebar/src/components/elements/copilot-role/css/videos/';\n\t\t\tconst sources = {\n\t\t\t\tru: 'copilot-roles-promo-ru.webm',\n\t\t\t\ten: 'copilot-roles-promo-en.webm',\n\t\t\t};\n\n\t\t\tconst language = Loc.getMessage('LANGUAGE_ID');\n\n\t\t\treturn language === 'ru' ? `${basePath}${sources.ru}` : `${basePath}${sources.en}`;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.promoPopup = new PromoVideoPopup({\n\t\t\tvideoSrc: this.videoSource,\n\t\t\ttitle: this.loc('IM_SIDEBAR_COPILOT_CHANGE_ROLE_PROMO_TITLE'),\n\t\t\ttext: this.text,\n\t\t\ttargetOptions: this.bindElement,\n\t\t\tangleOptions: {\n\t\t\t\tposition: BX.UI.AnglePosition.RIGHT,\n\t\t\t\toffset: 98,\n\t\t\t},\n\t\t\tcolors: {\n\t\t\t\ticonBackground: '#8e52ec',\n\t\t\t\ttitle: '#b095dc',\n\t\t\t},\n\t\t\ticon: BX.UI.IconSet.Main.COPILOT_AI,\n\t\t\toffset: {\n\t\t\t\ttop: -125,\n\t\t\t\tleft: -510,\n\t\t\t},\n\t\t});\n\n\t\tthis.promoPopup.subscribe(PromoVideoPopupEvents.ACCEPT, this.onAccept);\n\t\tthis.promoPopup.subscribe(PromoVideoPopupEvents.HIDE, this.onHide);\n\t},\n\tmounted()\n\t{\n\t\tthis.promoPopup.show();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tif (!this.promoPopup)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.promoPopup.hide();\n\n\t\tthis.promoPopup.unsubscribe(PromoVideoPopupEvents.ACCEPT, this.onAccept);\n\t\tthis.promoPopup.unsubscribe(PromoVideoPopupEvents.HIDE, this.onHide);\n\t},\n\tmethods:\n\t{\n\t\tonHide()\n\t\t{\n\t\t\tthis.$emit('hide');\n\t\t\tthis.promoPopup.hide();\n\t\t},\n\t\tonAccept()\n\t\t{\n\t\t\tthis.$emit('accept');\n\t\t\tthis.promoPopup.hide();\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<template></template>\n\t`,\n};\n","import { CopilotRolesDialog } from 'im.v2.component.elements.copilot-roles-dialog';\nimport { PromoManager } from 'im.v2.lib.promo';\nimport { PromoId } from 'im.v2.const';\n\nimport { CopilotService } from './classes/copilot-service';\nimport { ChangeRolePromo } from './components/change-role-promo';\n\nimport './css/copilot-role.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { RawRole } from './classes/copilot-service';\n\n// @vue/component\nexport const CopilotRole = {\n\tname: 'CopilotRole',\n\tcomponents: { ChangeRolePromo, CopilotRolesDialog },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshouldShowChangeRolePromo: false,\n\t\t\tshowRolesDialog: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tchatRole(): ImModelCopilotRole\n\t\t{\n\t\t\tconst chatRole = this.$store.getters['copilot/chats/getRole'](this.dialogId);\n\t\t\tif (!chatRole)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['copilot/roles/getDefault'];\n\t\t\t}\n\n\t\t\treturn chatRole;\n\t\t},\n\t\troleName(): string\n\t\t{\n\t\t\treturn this.chatRole.name;\n\t\t},\n\t\tcanShowChangeRolePromo(): boolean\n\t\t{\n\t\t\tconst needShowAddUsersToChatHint = PromoManager.getInstance().needToShow(PromoId.addUsersToCopilotChat);\n\t\t\tconst needToShowChangeRolePromo = PromoManager.getInstance().needToShow(PromoId.changeRoleCopilot);\n\n\t\t\treturn !needShowAddUsersToChatHint && needToShowChangeRolePromo;\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\t// Show promo after sidebar animation is over.\n\t\tsetTimeout(() => {\n\t\t\tthis.shouldShowChangeRolePromo = this.canShowChangeRolePromo;\n\t\t}, 300);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.showRolesDialog = false;\n\t\tthis.shouldShowChangeRolePromo = false;\n\t},\n\tmethods:\n\t{\n\t\thandleChangeRole()\n\t\t{\n\t\t\tthis.showRolesDialog = true;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t\tonChangeRolePromoAccept()\n\t\t{\n\t\t\tthis.shouldShowChangeRolePromo = false;\n\t\t\tvoid PromoManager.getInstance().markAsWatched(PromoId.changeRoleCopilot);\n\t\t},\n\t\tonCopilotDialogSelectRole(role: RawRole)\n\t\t{\n\t\t\tvoid (new CopilotService()).updateRole({\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnewRole: role,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-copilot-role__container\" @click=\"handleChangeRole\" ref=\"change-role\">\n\t\t\t<div class=\"bx-im-sidebar-copilot-role__title\">\n\t\t\t\t<div class=\"bx-im-sidebar-copilot-role__title-icon\"></div>\n\t\t\t\t<div class=\"bx-im-sidebar-copilot-role__title-text\">\n\t\t\t\t\t{{ roleName }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-copilot-role__arrow-icon\"></div>\n\t\t\t<ChangeRolePromo \n\t\t\t\tv-if=\"shouldShowChangeRolePromo\"\n\t\t\t\t:bindElement=\"$refs['change-role']\"\n\t\t\t\t@accept=\"onChangeRolePromoAccept\"\n\t\t\t\t@hide=\"shouldShowChangeRolePromo = false\"\n\t\t\t/>\n\t\t\t<CopilotRolesDialog\n\t\t\t\tv-if=\"showRolesDialog\"\n\t\t\t\t:title=\"loc('IM_SIDEBAR_COPILOT_CHANGE_ROLE_DIALOG_TITLE')\"\n\t\t\t\t@selectRole=\"onCopilotDialogSelectRole\"\n\t\t\t\t@close=\"showRolesDialog = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\nimport { runAction } from 'im.v2.lib.rest';\nimport { Logger } from 'im.v2.lib.logger';\nimport { RestMethod } from 'im.v2.const';\n\nexport class CopilotAiModelService\n{\n\tupdateAIModel({ dialogId, aiModelCode }: { dialogId: string, aiModelCode: string }): Promise\n\t{\n\t\tLogger.warn('CopilotService: update ai model', dialogId, aiModelCode);\n\t\tvoid Core.getStore().dispatch('copilot/chats/updateModel', { dialogId, aiModel: aiModelCode });\n\n\t\treturn this.#sendRequest({ dialogId, engineCode: aiModelCode });\n\t}\n\n\t#sendRequest({ dialogId, engineCode }: {dialogId: string, engineCode: string}): Promise\n\t{\n\t\tconst requestParams = { data: { dialogId, engineCode } };\n\n\t\treturn runAction(RestMethod.imV2ChatCopilotUpdateAiModel, requestParams);\n\t}\n}\n","// @vue/component\nexport const AiModelItem = {\n\tname: 'AiModelItem',\n\tprops:\n\t{\n\t\ttext: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tselected: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\ticonClass(): string[]\n\t\t{\n\t\t\treturn ['bx-im-ai-model-popup-content__item_icon', `--${this.icon}`];\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-ai-model-popup-content__item\">\n\t\t\t<template v-if=\"icon\">\n\t\t\t\t<div :class=\"iconClass\"></div>\n\t\t\t</template>\n\t\t\t<div class=\"--line-clamp-2\">{{ text }}</div>\n\t\t\t<template v-if=\"selected\">\n\t\t\t\t<div class=\"bx-im-ai-model-popup-content__item_icon --check\"></div>\n\t\t\t</template>\n\t\t</div>\n\t`,\n};\n","import { Extension } from 'main.core';\n\nimport { Core } from 'im.v2.application.core';\nimport { openHelpdeskArticle } from 'im.v2.lib.helpdesk';\n\nimport { CopilotAiModelService } from './classes/copilot-ai-model-service';\nimport { AiModelItem } from './ai-model-item';\n\nimport type { SettingsCollection } from 'main.core.collections';\nimport type { ImModelCopilotAIModel } from 'im.v2.model';\n\nconst MARKET_PAGE = '/market/collection/ai_provider_partner_crm/';\n\n// @vue/component\nexport const AIModelPopupContent = {\n\tname: 'AIModelPopupContent',\n\tcomponents: { AiModelItem },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['close'],\n\tcomputed:\n\t{\n\t\tisAdmin(): boolean\n\t\t{\n\t\t\treturn Core.getStore().getters['users/isCurrentUserAdmin'];\n\t\t},\n\t\tselectedAIModelCode(): string\n\t\t{\n\t\t\treturn this.$store.getters['copilot/chats/getAIModel'](this.dialogId).code;\n\t\t},\n\t\taiModelsItems(): ImModelCopilotAIModel[]\n\t\t{\n\t\t\treturn Core.getStore().getters['copilot/getAIModels'];\n\t\t},\n\t\tsettingsPageUrl(): string\n\t\t{\n\t\t\tconst settings: SettingsCollection = Extension.getSettings('im.v2.component.sidebar');\n\n\t\t\treturn settings.get('portalSettingsUrl');\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\topenAiSettings()\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(`${window.location.origin}${this.settingsPageUrl}?page=ai`);\n\t\t},\n\t\topenMarket()\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(`${window.location.origin}${MARKET_PAGE}`);\n\t\t},\n\t\topenHelpCenter()\n\t\t{\n\t\t\tconst ARTICLE_CODE = '20267044';\n\t\t\topenHelpdeskArticle(ARTICLE_CODE);\n\t\t},\n\t\tisSelectedAIModel(aiModelCode: string): boolean\n\t\t{\n\t\t\treturn this.selectedAIModelCode === aiModelCode;\n\t\t},\n\t\tasync selectAIModel(aiModelCode: string): void\n\t\t{\n\t\t\tconst service = new CopilotAiModelService();\n\t\t\tvoid service.updateAIModel({ dialogId: this.dialogId, aiModelCode });\n\t\t\tthis.$emit('close');\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-ai-model-popup-content__container\" ref=\"ai-model-content\">\n\t\t\t<AiModelItem\n\t\t\t\tv-for=\"model in aiModelsItems\"\n\t\t\t\t:key=\"model.name\"\n\t\t\t\t:text=\"model.name\"\n\t\t\t\t:selected=\"isSelectedAIModel(model.code)\"\n\t\t\t\t@click=\"selectAIModel(model.code)\"\n\t\t\t/>\n\t\t\t<template v-if=\"isAdmin\">\n\t\t\t\t<div class=\"bx-im-ai-model-popup-content__separator\"></div>\n\t\t\t\t<AiModelItem\n\t\t\t\t\t:text=\"loc('IM_SIDEBAR_AI_MODEL_POPUP_MARKET_MSGVER_1')\"\n\t\t\t\t\t@click=\"openMarket\"\n\t\t\t\t/>\n\t\t\t\t<AiModelItem\n\t\t\t\t\t:text=\"loc('IM_SIDEBAR_AI_MODEL_POPUP_SETTINGS')\"\n\t\t\t\t\t@click=\"openAiSettings\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<div class=\"bx-im-ai-model-popup-content__separator\"></div>\n\t\t\t<AiModelItem\n\t\t\t\t:text=\"loc('IM_SIDEBAR_AI_MODEL_POPUP_HELP')\"\n\t\t\t\ticon=\"info\"\n\t\t\t\tclass=\"bx-im-ai-model-popup-content__item_info\"\n\t\t\t\t@click=\"openHelpCenter\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { MessengerPopup } from 'im.v2.component.elements.popup';\n\nimport { AIModelPopupContent } from './ai-model-popup-content';\n\nimport type { PopupOptions } from 'main.popup';\n\nimport './css/ai-model-popup.css';\n\nconst POPUP_ID = 'im-ai-model-popup';\n\n// @vue/component\nexport const AIModelPopup = {\n\tname: 'AIModelPopup',\n\tcomponents: { MessengerPopup, AIModelPopupContent },\n\tprops:\n\t{\n\t\tbindElement: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['close'],\n\tcomputed:\n\t{\n\t\tPOPUP_ID: () => POPUP_ID,\n\t\tconfig(): PopupOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\twidth: 224,\n\t\t\t\tbindElement: this.bindElement,\n\t\t\t\toffsetTop: 2,\n\t\t\t\toffsetLeft: 0,\n\t\t\t\tfixed: true,\n\t\t\t\tbindOptions: {\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t},\n\t\t\t\tclassName: 'bx-im-ai-model-popup__scope',\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<MessengerPopup\n\t\t\t:config=\"config\"\n\t\t\t:id=\"POPUP_ID\"\n\t\t>\n\t\t\t<AIModelPopupContent\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t@close=\"$emit('close')\"\n\t\t\t/>\n\t\t</MessengerPopup>\n\t`,\n};\n","import { AIModelPopup } from './ai-model-popup';\n\nimport './css/ai-model.css';\n\nimport type { JsonObject } from 'main.core';\n\n// @vue/component\nexport const AIModel = {\n\tname: 'AIModel',\n\tcomponents: { AIModelPopup },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowAIModelPopup: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tcurrentAIModelName(): string\n\t\t{\n\t\t\treturn this.$store.getters['copilot/chats/getAIModel'](this.dialogId).name;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\ttoggleAIModelPopup(): void\n\t\t{\n\t\t\tthis.showAIModelPopup = !this.showAIModelPopup;\n\t\t},\n\t\tcloseAIModelPopup(): void\n\t\t{\n\t\t\tthis.showAIModelPopup = false;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-ai-model__container\" @click=\"toggleAIModelPopup\" ref=\"change-ai-model\">\n\t\t\t<div class=\"--line-clamp-2\">\n\t\t\t\t{{ currentAIModelName }}\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-ai-model__arrow-icon\"></div>\n\t\t</div>\n\t\t<AIModelPopup\n\t\t\tv-if=\"showAIModelPopup\"\n\t\t\t:dialogId=\"dialogId\"\n\t\t\t:bindElement=\"$refs['change-ai-model']\"\n\t\t\t@close=\"closeAIModelPopup\"\n\t\t/>\n\t`,\n};\n","import { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { Feature, FeatureManager } from 'im.v2.lib.feature';\n\nimport { CopilotRole } from '../../../elements/copilot-role/copilot-role';\nimport { AIModel } from '../../../elements/ai-model/ai-model';\nimport { MuteChat } from '../../../elements/mute-chat/mute-chat';\nimport { ChatMembersAvatars } from '../../../elements/chat-members-avatars/chat-members-avatars';\n\nimport '../css/copilot-preview.css';\n\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const CopilotPreview = {\n\tname: 'CopilotPreview',\n\tcomponents: { ChatAvatar, ChatTitle, MuteChat, ChatMembersAvatars, CopilotRole, AIModel },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tshowMembers(): boolean\n\t\t{\n\t\t\treturn (new CopilotManager()).isGroupCopilotChat(this.dialogId);\n\t\t},\n\t\tisAIModelChangeAllowed(): boolean\n\t\t{\n\t\t\treturn FeatureManager.isFeatureAvailable(Feature.isAIModelChangeAllowed);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-copilot-preview__scope\">\n\t\t\t<div class=\"bx-im-sidebar-copilot-preview-group-chat__avatar-container\">\n\t\t\t\t<ChatAvatar\n\t\t\t\t\t:avatarDialogId=\"dialogId\"\n\t\t\t\t\t:contextDialogId=\"dialogId\"\n\t\t\t\t\t:size=\"AvatarSize.XXXL\"\n\t\t\t\t\t:withSpecialTypes=\"false\"\n\t\t\t\t/>\n\t\t\t\t<ChatTitle :dialogId=\"dialogId\" :twoLine=\"true\" class=\"bx-im-sidebar-copilot-preview-group-chat__title\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-copilot-preview-group-chat__chat-members\">\n\t\t\t\t<ChatMembersAvatars :showMembers=\"showMembers\" :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-copilot-preview-group-chat__settings\">\n\t\t\t\t<CopilotRole :dialogId=\"dialogId\" />\n\t\t\t\t<AIModel v-if=\"isAIModelChangeAllowed\" :dialogId=\"dialogId\" />\n\t\t\t\t<MuteChat :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport { AutoDelete } from '../../../elements/auto-delete/auto-delete';\n\n// @vue/component\nexport const SupportPreview = {\n\tname: 'SupportPreview',\n\tcomponents: { ChatAvatar, ChatTitle, AutoDelete },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-main-preview__scope\">\n\t\t\t<div class=\"bx-im-sidebar-main-preview-group-chat__avatar-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-main-preview-group-chat__avatar\">\n\t\t\t\t\t<ChatAvatar :size=\"AvatarSize.XXXL\" :avatarDialogId=\"dialogId\" />\n\t\t\t\t</div>\n\t\t\t\t<ChatTitle :dialogId=\"dialogId\" :twoLine=\"true\" class=\"bx-im-sidebar-main-preview-group-chat__title\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-main-preview-group-chat__settings\">\n\t\t\t\t<AutoDelete :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventType, SidebarDetailBlock } from 'im.v2.const';\n\nimport '../css/multidialog.css';\n\nimport type { EventEmitter } from 'main.core.events';\n\n// @vue/component\nexport const MultidialogPreview = {\n\tname: 'MultidialogPreview',\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true).chatId;\n\t\t},\n\t\tnumberRequests(): number\n\t\t{\n\t\t\tconst chatsCount = this.$store.getters['sidebar/multidialog/getChatsCount'];\n\n\t\t\treturn chatsCount > 999 ? '999+' : chatsCount;\n\t\t},\n\t\ttotalChatCounter(): number\n\t\t{\n\t\t\tconst counter = this.$store.getters['sidebar/multidialog/getTotalChatCounter'];\n\n\t\t\treturn counter > 99 ? '99+' : counter;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonOpenDetail()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.open, {\n\t\t\t\tpanel: SidebarDetailBlock.multidialog,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tstandalone: true,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-multidialog-preview__scope\">\n\t\t\t<div class=\"bx-im-sidebar-multidialog-preview__container\" @click=\"onOpenDetail\">\n\t\t\t\t<div class=\"bx-im-sidebar-multidialog-preview__questions-container\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-multidialog-preview__questions-text\">\n\t\t\t\t\t\t{{ loc('IM_SIDEBAR_SUPPORT_TICKET_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-sidebar-multidialog-preview__questions-count\">\n\t\t\t\t\t\t{{ numberRequests }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-sidebar-multidialog-preview__new-message-container\">\n\t\t\t\t\t<div v-if=\"totalChatCounter\" class=\"bx-im-sidebar-multidialog-preview__new-message-counter\">\n\t\t\t\t\t\t{{ totalChatCounter }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-sidebar__forward-icon\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { FeatureManager } from 'im.v2.lib.feature';\nimport { Analytics } from 'im.v2.lib.analytics';\n\nimport './tariff-limit.css';\n\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const TariffLimit = {\n\tname: 'TariffLimit',\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tpanel: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\treturn FeatureManager.chatHistory.getLimitTitle();\n\t\t},\n\t\tpreparedDescription(): string\n\t\t{\n\t\t\treturn FeatureManager.chatHistory.getLimitSubtitle(true)\n\t\t\t\t.replace('[action_emphasis]', '<em class=\"bx-im-sidebar-elements-tariff-limit__description-accent\">')\n\t\t\t\t.replace('[/action_emphasis]', '</em>');\n\t\t},\n\t\ttooltipText(): string\n\t\t{\n\t\t\treturn FeatureManager.chatHistory.getTooltipText();\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tdialogId()\n\t\t{\n\t\t\tthis.sendAnalyticsOnCreate();\n\t\t},\n\t\tpanel()\n\t\t{\n\t\t\tthis.sendAnalyticsOnCreate();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.sendAnalyticsOnCreate();\n\t},\n\tmethods:\n\t{\n\t\tonDetailClick()\n\t\t{\n\t\t\tthis.sendAnalyticsOnClick();\n\t\t\tFeatureManager.chatHistory.openFeatureSlider();\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t\tsendAnalyticsOnClick()\n\t\t{\n\t\t\tAnalytics.getInstance().historyLimit.onSidebarBannerClick({\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tpanel: this.panel,\n\t\t\t});\n\t\t},\n\t\tsendAnalyticsOnCreate()\n\t\t{\n\t\t\tAnalytics.getInstance().historyLimit.onSidebarLimitExceeded({\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tpanel: this.panel,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"bx-im-sidebar-elements-tariff-limit__container\"\n\t\t\t:title=\"tooltipText\"\n\t\t\t@click=\"onDetailClick\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-elements-tariff-limit__header\">\n\t\t\t\t<div class=\"bx-im-sidebar-elements-tariff-limit__title-container\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-elements-tariff-limit__icon\"></div>\n\t\t\t\t\t<div class=\"bx-im-sidebar-elements-tariff-limit__title --line-clamp-2\">{{ title }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-sidebar-elements-tariff-limit__arrow bx-im-sidebar__forward-green-icon\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-elements-tariff-limit__delimiter\"></div>\n\t\t\t<div class=\"bx-im-sidebar-elements-tariff-limit__content\">\n\t\t\t\t<div class=\"bx-im-sidebar-elements-tariff-limit__description\" v-html=\"preparedDescription\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { SidebarDetailBlock } from 'im.v2.const';\n\nimport { TariffLimit } from '../../../elements/tariff-limit/tariff-limit';\n\n// @vue/component\nexport const TariffLimitPreview = {\n\tname: 'TariffLimitPreview',\n\tcomponents: { TariffLimit },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t},\n\ttemplate: `\n\t\t<TariffLimit :dialogId=\"dialogId\" :panel=\"SidebarDetailBlock.main\" />\n\t`,\n};\n","import { Manual } from 'ui.manual';\n\nimport { PromoId, UserType } from 'im.v2.const';\nimport { PromoManager } from 'im.v2.lib.promo';\nimport { Core } from 'im.v2.application.core';\n\nimport '../css/collab-helpdesk.css';\n\nimport type { JsonObject } from 'main.core';\n\nconst INTRANET_MANUAL_CODE = 'collab';\nconst COLLABER_MANUAL_CODE = 'collab_guest';\n\n// @vue/component\nexport const CollabHelpdeskPreview = {\n\tname: 'CollabHelpdeskPreview',\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tneedToShow: PromoManager.getInstance().needToShow(PromoId.collabHelpdeskSidebar),\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tisCurrentUserCollaber(): boolean\n\t\t{\n\t\t\tconst currentUser = this.$store.getters['users/get'](Core.getUserId(), true);\n\n\t\t\treturn currentUser.type === UserType.collaber;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tclose()\n\t\t{\n\t\t\tthis.needToShow = false;\n\t\t\tvoid PromoManager.getInstance().markAsWatched(PromoId.collabHelpdeskSidebar);\n\t\t},\n\t\topenHelpdesk()\n\t\t{\n\t\t\tconst manualCode = this.isCurrentUserCollaber ? COLLABER_MANUAL_CODE : INTRANET_MANUAL_CODE;\n\n\t\t\tconst urlParams = {\n\t\t\t\tutm_source: 'portal',\n\t\t\t\tutm_content: 'widget',\n\t\t\t};\n\n\t\t\tManual.show(manualCode, urlParams);\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div v-if=\"needToShow\" class=\"bx-im-sidebar-collab-helpdesk__container\" @click=\"openHelpdesk\">\n\t\t\t<div class=\"bx-im-sidebar-collab-helpdesk__icon\"></div>\n\t\t\t<div class=\"bx-im-sidebar-collab-helpdesk__content\">\n\t\t\t\t<div class=\"bx-im-sidebar-collab-helpdesk__title\">\n\t\t\t\t\t{{ loc('IM_SIDEBAR_COLLAB_HELPDESK_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-sidebar-collab-helpdesk__description --line-clamp-3\">\n\t\t\t\t\t{{ loc('IM_SIDEBAR_COLLAB_HELPDESK_DESCRIPTION') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-collab-helpdesk__close\" @click.stop=\"close\"></div>\n\t\t</div>\n\t`,\n};\n","import { ChatTitle, ChatTitleType } from 'im.v2.component.elements.chat-title';\nimport { ChatAvatar, AvatarSize, ChatAvatarType } from 'im.v2.component.elements.avatar';\n\nimport '../css/sidebar-notes-preview.css';\n\n// @vue/component\nexport const NotesPreview = {\n\tname: 'NotesPreview',\n\tcomponents: { ChatAvatar, ChatTitle },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tChatAvatarType: () => ChatAvatarType,\n\t\tAvatarSize: () => AvatarSize,\n\t\tChatTitleType: () => ChatTitleType,\n\t},\n\tmethods: {\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-notes-preview\">\n\t\t\t<div class=\"bx-im-sidebar-notes-preview__avatar\">\n\t\t\t\t<ChatAvatar \n\t\t\t\t\t:avatarDialogId=\"dialogId\"\n\t\t\t\t\t:size=\"AvatarSize.XXXL\"\n\t\t\t\t\t:customType=\"ChatAvatarType.notes\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-notes-preview__head\">\n\t\t\t\t<ChatTitle :dialogId=\"dialogId\" :customType=\"ChatTitleType.notes\" :showItsYou=\"false\"/>\n\t\t\t\t<span class=\"bx-im-sidebar-notes-preview__description\">\n\t\t\t\t\t{{ loc('IM_SIDEBAR_NOTES_PREVIEW_DESCRIPTION') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ChatTitle } from 'im.v2.component.elements.chat-title';\n\nimport { ChatMembersAvatars } from '../../../elements/chat-members-avatars/chat-members-avatars';\n\nimport '../css/task.css';\n\n// @vue/component\nexport const TaskPreview = {\n\tname: 'TaskPreview',\n\tcomponents: { ChatTitle, ChatMembersAvatars },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-task-preview__container\">\n\t\t\t<div class=\"bx-im-sidebar-task-preview__avatar-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-task-preview__avatar\"></div>\n\t\t\t\t<ChatTitle :dialogId=\"dialogId\" :twoLine=\"true\" class=\"bx-im-sidebar-task-preview__title\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-task-preview__chat-members\">\n\t\t\t\t<ChatMembersAvatars :dialogId=\"dialogId\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Runtime } from 'main.core';\n\nimport '../css/task-comments-history.css';\n\nimport type { ImModelChat } from 'im.v2.model';\n\ntype HistoryGridExtension = {\n\tHistoryGrid: {\n\t\topenHistoryGrid: ({ taskId: number }) => void,\n\t}\n};\n\n// @vue/component\nexport const TaskCommentsHistory = {\n\tname: 'TaskCommentsHistory',\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed: {\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId);\n\t\t},\n\t},\n\tmethods: {\n\t\tasync onClick()\n\t\t{\n\t\t\tconst { id: entityId } = this.dialog.entityLink;\n\t\t\tconst taskId = Number(entityId);\n\n\t\t\tconst { HistoryGrid } = (await Runtime.loadExtension('tasks.v2.application.history-grid'): HistoryGridExtension);\n\t\t\tHistoryGrid.openHistoryGrid({ taskId });\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-task-comments-history__container\" @click=\"onClick\">\n\t\t\t<div class=\"bx-im-sidebar-task-comments-history__title-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-task-comments-history__icon\"></div>\n\t\t\t\t<div class=\"bx-im-sidebar-task-comments-history__title\">\n\t\t\t\t\t{{ loc('IM_SIDEBAR_TASK_COMMENTS_HISTORY_TITLE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-task-comments-history__open-icon\"></div>\n\t\t</div>\n\t`,\n};\n","import { SidebarMainPanelBlock } from 'im.v2.const';\n\nimport { InfoPreview } from '../blocks/info';\nimport { FileListPreview } from '../blocks/file-list';\nimport { TaskListPreview } from '../blocks/task-list';\nimport { MarketAppListPreview } from '../blocks/market-app-list';\nimport { MeetingListPreview } from '../blocks/meeting-list';\nimport { CopilotInfoPreview } from '../blocks/copilot-info';\nimport { ChatPreview } from '../blocks/chat';\nimport { PostPreview } from '../blocks/post';\nimport { UserPreview } from '../blocks/user';\nimport { CopilotPreview } from '../blocks/copilot';\nimport { SupportPreview } from '../blocks/support';\nimport { FileUnsortedListPreview } from '../blocks/file-unsorted-list';\nimport { MultidialogPreview } from '../blocks/multidialog';\nimport { TariffLimitPreview } from '../blocks/tariff-limit';\nimport { CollabHelpdeskPreview } from '../blocks/collab-helpdesk';\nimport { NotesPreview } from '../blocks/notes';\nimport { TaskPreview } from '../blocks/task';\nimport { TaskCommentsHistory } from '../blocks/task-comments-history';\n\nexport const ComponentMap = {\n\t[SidebarMainPanelBlock.chat]: ChatPreview,\n\t[SidebarMainPanelBlock.notes]: NotesPreview,\n\t[SidebarMainPanelBlock.post]: PostPreview,\n\t[SidebarMainPanelBlock.user]: UserPreview,\n\t[SidebarMainPanelBlock.support]: SupportPreview,\n\t[SidebarMainPanelBlock.info]: InfoPreview,\n\t[SidebarMainPanelBlock.fileList]: FileListPreview,\n\t[SidebarMainPanelBlock.task]: TaskPreview,\n\t[SidebarMainPanelBlock.taskList]: TaskListPreview,\n\t[SidebarMainPanelBlock.taskCommentsHistory]: TaskCommentsHistory,\n\t[SidebarMainPanelBlock.meetingList]: MeetingListPreview,\n\t[SidebarMainPanelBlock.fileUnsortedList]: FileUnsortedListPreview,\n\t[SidebarMainPanelBlock.marketAppList]: MarketAppListPreview,\n\t[SidebarMainPanelBlock.multidialog]: MultidialogPreview,\n\t[SidebarMainPanelBlock.copilot]: CopilotPreview,\n\t[SidebarMainPanelBlock.copilotInfo]: CopilotInfoPreview,\n\t[SidebarMainPanelBlock.tariffLimit]: TariffLimitPreview,\n\t[SidebarMainPanelBlock.collabHelpdesk]: CollabHelpdeskPreview,\n};\n","import './css/skeleton.css';\n\n// @vue/component\nexport const SidebarSkeleton = {\n\tname: 'SidebarSkeleton',\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-skeleton__container\">\n\t\t\t<div class=\"bx-im-sidebar-skeleton__block\">\n\t\t\t\t<div class=\"bx-im-sidebar-skeleton__avatar\"></div>\n\t\t\t\t<div class=\"bx-im-sidebar-skeleton__invite-button\"></div>\n\t\t\t\t<div class=\"bx-im-sidebar-skeleton__settings\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-skeleton__block\">\n\t\t\t\t<div class=\"bx-im-sidebar-skeleton__info\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-skeleton__block\">\n\t\t\t\t<div class=\"bx-im-sidebar-skeleton__files\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-skeleton__block\">\n\t\t\t\t<div class=\"bx-im-sidebar-skeleton__tasks\"></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Logger } from 'im.v2.lib.logger';\nimport { SidebarManager } from 'im.v2.lib.sidebar';\n\nimport { Main } from '../../../classes/panels/main';\n\nimport { MainHeader } from './components/header';\nimport { ComponentMap } from './config/component-map';\nimport { SidebarSkeleton } from '../../elements/skeleton/skeleton';\n\nimport './css/main-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const MainPanel = {\n\tname: 'MainPanel',\n\tcomponents: {\n\t\tMainHeader,\n\t\tSidebarSkeleton,\n\t},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: true,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tblocks(): BitrixVueComponentProps[]\n\t\t{\n\t\t\tconst sidebarConfig = SidebarManager.getInstance().getConfig(this.dialogId);\n\t\t\tconst blocks = sidebarConfig.getBlocks(this.dialogId);\n\n\t\t\treturn blocks.map((block) => {\n\t\t\t\treturn ComponentMap[block];\n\t\t\t});\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tdialogInited(): boolean\n\t\t{\n\t\t\treturn this.dialog.inited;\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\thasInitialData(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/isInited'](this.chatId);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tdialogId()\n\t\t{\n\t\t\tthis.initializeSidebar();\n\t\t},\n\t\tdialogInited()\n\t\t{\n\t\t\tthis.initializeSidebar();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initializeSidebar();\n\t},\n\tmethods:\n\t{\n\t\tinitializeSidebar()\n\t\t{\n\t\t\tif (!this.dialogInited)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.hasInitialData)\n\t\t\t{\n\t\t\t\tthis.isLoading = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.sidebarService = new Main({ dialogId: this.dialogId });\n\n\t\t\tthis.isLoading = true;\n\t\t\tthis.sidebarService.requestInitialData().then(() => {\n\t\t\t\tthis.isLoading = false;\n\t\t\t}).catch((error) => {\n\t\t\t\tLogger.warn('Sidebar: request initial data error:', error);\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-main-panel__container\">\n\t\t\t<MainHeader :dialogId=\"dialogId\" />\n\t\t\t<SidebarSkeleton v-if=\"isLoading || !dialogInited\" />\n\t\t\t<div v-else class=\"bx-im-sidebar-main-panel__blocks\">\n\t\t\t\t<component\n\t\t\t\t\tv-for=\"block in blocks\"\n\t\t\t\t\t:key=\"block.name\"\n\t\t\t\t\t:is=\"block\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\tclass=\"bx-im-sidebar-main-panel__block\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","export function concatAndSortSearchResult(concatArrayFirst: number[], concatArraySecond: number[]): number[]\n{\n\treturn [...concatArrayFirst, ...concatArraySecond].sort((a, z) => z - a);\n}\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from '../helpers/get-chat-id';\nimport { getLastElementId } from '../helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\ntype RestResponse = {\n\tlist: [],\n\tusers: [],\n};\n\ntype UrlGetQueryParams = {\n\tCHAT_ID: number,\n\tLIMIT: number,\n\tLAST_ID?: number,\n\tSEARCH_TASK_NAME?: string,\n}\n\nexport class TaskSearch\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\thasMoreItemsToLoad: boolean = true;\n\t#query: string = '';\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tsearchOnServer(query: string): Promise<number[]>\n\t{\n\t\tif (this.#query !== query)\n\t\t{\n\t\t\tthis.#query = query;\n\t\t\tthis.hasMoreItemsToLoad = true;\n\t\t}\n\n\t\treturn this.request();\n\t}\n\n\tresetSearchState()\n\t{\n\t\tthis.#query = '';\n\t\tthis.hasMoreItemsToLoad = true;\n\t\tvoid this.store.dispatch('sidebar/tasks/clearSearch', {});\n\t}\n\n\tasync request(): Promise<number[]>\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\t\tlet responseData: RestResponse = {};\n\t\ttry\n\t\t{\n\t\t\tconst response = await this.restClient.callMethod(RestMethod.imChatTaskGet, queryParams);\n\t\t\tresponseData = response.data();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('SidebarSearch: Im.imChatTaskGet: page request error', error);\n\t\t}\n\n\t\treturn this.#processSearchResponse(responseData);\n\t}\n\n\t#processSearchResponse(response: RestResponse): Promise<number[]>\n\t{\n\t\treturn this.updateModels(response).then(() => {\n\t\t\treturn response.list.map((message) => message.messageId);\n\t\t});\n\t}\n\n\tgetQueryParams(): UrlGetQueryParams\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t\tSEARCH_TASK_NAME: this.#query,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/tasks/getSearchResultCollectionLastId'](this.chatId);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\tupdateModels(resultData: RestResponse): Promise\n\t{\n\t\tconst { list, users, tariffRestrictions = {} } = resultData;\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\t\tconst hasNextPage = list.length === REQUEST_ITEMS_LIMIT;\n\t\tconst lastId = getLastElementId(list);\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setTasksPromise = this.store.dispatch('sidebar/tasks/setSearch', {\n\t\t\tchatId: this.chatId,\n\t\t\ttasks: list,\n\t\t\thasNextPage,\n\t\t\tlastId,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\n\t\treturn Promise.all([setTasksPromise, addUsersPromise]);\n\t}\n}\n","import './date-group.css';\n\n// @vue/component\nexport const DateGroup = {\n\tname: 'DateGroup',\n\tprops: {\n\t\tdateText: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-date-group__container bx-im-sidebar-date-group__scope\">\n\t\t\t<div class=\"bx-im-sidebar-date-group__text\">\n\t\t\t\t{{ dateText }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { SearchInput } from 'im.v2.component.elements.search-input';\nimport { ChatButton, ButtonSize, ButtonColor } from 'im.v2.component.elements.button';\nimport { ChatType } from 'im.v2.const';\n\nimport './detail-header.css';\n\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const DetailHeader = {\n\tname: 'DetailHeader',\n\tcomponents: { ChatButton, SearchInput },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\twithAddButton: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\twithSearch: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisSearchHeaderOpened: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdelayForFocusOnStart: {\n\t\t\ttype: Number || null,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\temits: ['back', 'addClick', 'changeQuery', 'toggleSearchPanelOpened'],\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tisCollab(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.collab;\n\t\t},\n\t\taddButtonColor(): ButtonColor\n\t\t{\n\t\t\tif (this.isCollab)\n\t\t\t{\n\t\t\t\treturn this.ButtonColor.Collab;\n\t\t\t}\n\n\t\t\treturn this.ButtonColor.PrimaryLight;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-detail-header__container bx-im-sidebar-detail-header__scope\">\n\t\t\t<div class=\"bx-im-sidebar-detail-header__title-container\">\n\t\t\t\t<button\n\t\t\t\t\t:class=\"{'bx-im-messenger__cross-icon': !secondLevel, 'bx-im-sidebar__back-icon': secondLevel}\"\n\t\t\t\t\t@click=\"$emit('back')\"\n\t\t\t\t/>\n\t\t\t\t<div v-if=\"!isSearchHeaderOpened\" class=\"bx-im-sidebar-detail-header__title-text\">{{ title }}</div>\n\t\t\t\t<slot name=\"action\">\n\t\t\t\t\t<div v-if=\"withAddButton && !isSearchHeaderOpened\" class=\"bx-im-sidebar-detail-header__add-button\" ref=\"add-button\">\n\t\t\t\t\t\t<ChatButton\n\t\t\t\t\t\t\t:text=\"loc('IM_SIDEBAR_ADD_BUTTON_TEXT')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.S\"\n\t\t\t\t\t\t\t:color=\"addButtonColor\"\n\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t@click=\"$emit('addClick', {target: $refs['add-button']})\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</slot>\n\t\t\t\t<div v-if=\"withSearch\" class=\"bx-im-sidebar-detail-header__search\">\n\t\t\t\t\t<SearchInput\n\t\t\t\t\t\tv-if=\"isSearchHeaderOpened\"\n\t\t\t\t\t\t:placeholder=\"loc('IM_SIDEBAR_SEARCH_MESSAGE_PLACEHOLDER')\"\n\t\t\t\t\t\t:withIcon=\"false\"\n\t\t\t\t\t\t:delayForFocusOnStart=\"delayForFocusOnStart\"\n\t\t\t\t\t\t@queryChange=\"$emit('changeQuery', $event)\"\n\t\t\t\t\t\t@close=\"$emit('toggleSearchPanelOpened', $event)\"\n\t\t\t\t\t\t@closeByEsc=\"$emit('toggleSearchPanelOpened', $event)\"\n\t\t\t\t\t\tclass=\"bx-im-sidebar-search-header__input\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div v-else @click=\"$emit('toggleSearchPanelOpened', $event)\" class=\"bx-im-sidebar-detail-header__search__icon --search\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './css/detail-empty-search-state.css';\n\n// @vue/component\nexport const DetailEmptySearchState = {\n\tname: 'DetailEmptySearchState',\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsubTitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-detail-empty-search-state__container\">\n\t\t\t<div class=\"bx-im-detail-empty-search-state__icon\"></div>\n\t\t\t<div class=\"bx-im-detail-empty-search-state__title\">\n\t\t\t\t{{ title }}\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-detail-empty-search-state__subtitle\">\n\t\t\t\t{{ subTitle }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\n\ntype FormattableCollection = {\n\tdate: Date,\n};\n\ntype DateGroup = {\n\tid: number,\n\ttitle: string\n};\n\nexport class SidebarCollectionFormatter\n{\n\tcachedDateGroups: Object = {};\n\n\tformat(collection: FormattableCollection[]): Object[]\n\t{\n\t\tconst dateGroups = {};\n\n\t\tcollection.forEach((item) => {\n\t\t\tconst dateGroup = this.getDateGroup(item.date);\n\t\t\tif (!dateGroups[dateGroup.title])\n\t\t\t{\n\t\t\t\tdateGroups[dateGroup.title] = {\n\t\t\t\t\tdateGroupTitle: dateGroup.title,\n\t\t\t\t\titems: [],\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tdateGroups[dateGroup.title].items.push(item);\n\t\t});\n\n\t\treturn Object.values(dateGroups);\n\t}\n\n\tgetDateGroup(date: Date): DateGroup\n\t{\n\t\tconst INDEX_BETWEEN_DATE_AND_TIME = 10;\n\t\t// 2022-10-25T14:58:44.000Z => 2022-10-25\n\t\tconst shortDate = date.toJSON().slice(0, INDEX_BETWEEN_DATE_AND_TIME);\n\t\tif (this.cachedDateGroups[shortDate])\n\t\t{\n\t\t\treturn this.cachedDateGroups[shortDate];\n\t\t}\n\n\t\tthis.cachedDateGroups[shortDate] = {\n\t\t\tid: shortDate,\n\t\t\ttitle: DateFormatter.formatByTemplate(date, DateTemplate.dateGroup),\n\t\t};\n\n\t\treturn this.cachedDateGroups[shortDate];\n\t}\n\n\tdestroy()\n\t{\n\t\tthis.cachedDateGroups = {};\n\t}\n}\n","import { Runtime, Extension } from 'main.core';\n\nimport { Loader } from 'im.v2.component.elements.loader';\nimport { EntityCreator } from 'im.v2.lib.entity-creator';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { EventType, SidebarDetailBlock, ActionByRole } from 'im.v2.const';\n\nimport { concatAndSortSearchResult } from '../../../classes/panels/helpers/concat-and-sort-search-result';\nimport { TariffLimit } from '../../elements/tariff-limit/tariff-limit';\nimport { TaskItem } from './task-item';\nimport { Task } from '../../../classes/panels/task';\nimport { TaskSearch } from '../../../classes/panels/search/task-search';\nimport { DateGroup } from '../../elements/date-group/date-group';\nimport { DetailHeader } from '../../elements/detail-header/detail-header';\nimport { DetailEmptyState as StartState, DetailEmptyState } from '../../elements/detail-empty-state/detail-empty-state';\nimport { DetailEmptySearchState } from '../../elements/detail-empty-search-state/detail-empty-search-state';\nimport { TaskMenu } from '../../../classes/context-menu/task/task-menu';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\n\nimport './css/task-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat, ImModelSidebarTaskItem } from 'im.v2.model';\n\nconst DEFAULT_MIN_TOKEN_SIZE = 3;\n\n// @vue/component\nexport const TaskPanel = {\n\tname: 'TaskPanel',\n\tcomponents: {\n\t\tTaskItem,\n\t\tDateGroup,\n\t\tDetailHeader,\n\t\tDetailEmptyState,\n\t\tStartState,\n\t\tDetailEmptySearchState,\n\t\tLoader,\n\t\tTariffLimit,\n\t},\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tisSearchHeaderOpened: false,\n\t\t\tsearchQuery: '',\n\t\t\tsearchResult: [],\n\t\t\tcurrentServerQueries: 0,\n\t\t\tminTokenSize: DEFAULT_MIN_TOKEN_SIZE,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\ttasks(): ImModelSidebarTaskItem[]\n\t\t{\n\t\t\tif (this.isSearchHeaderOpened)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['sidebar/tasks/getSearchResultCollection'](this.chatId);\n\t\t\t}\n\n\t\t\treturn this.$store.getters['sidebar/tasks/get'](this.chatId);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.tasks);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tshowAddButton(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformActionByRole(ActionByRole.createTask, this.dialogId);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tpreparedQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t\tisSearchQueryMinimumSize(): boolean\n\t\t{\n\t\t\treturn this.preparedQuery.length < this.minTokenSize;\n\t\t},\n\t\thasHistoryLimit(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/tasks/isHistoryLimitExceeded'](this.chatId);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tpreparedQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.cleanSearchResult();\n\t\t\tthis.startSearch();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new TaskMenu({ emitter: this.getEmitter() });\n\t\tthis.service = new Task({ dialogId: this.dialogId });\n\t\tthis.serviceSearch = new TaskSearch({ dialogId: this.dialogId });\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 500, this);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.sidebar');\n\t\t\tthis.minTokenSize = settings.get('minSearchTokenSize', DEFAULT_MIN_TOKEN_SIZE);\n\t\t},\n\t\tsearchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tthis.serviceSearch.searchOnServer(query).then((messageIds: string[]) => {\n\t\t\t\tif (query !== this.preparedQuery)\n\t\t\t\t{\n\t\t\t\t\tthis.isLoading = false;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.searchResult = concatAndSortSearchResult(this.searchResult, messageIds);\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.currentServerQueries--;\n\t\t\t\tthis.stopLoader();\n\t\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t\t{\n\t\t\t\t\tthis.cleanSearchResult();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tstartSearch()\n\t\t{\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(this.preparedQuery);\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.serviceSearch.resetSearchState();\n\t\t\tthis.searchResult = [];\n\t\t},\n\t\tonChangeQuery(query: string)\n\t\t{\n\t\t\tthis.searchQuery = query;\n\t\t},\n\t\ttoggleSearchPanelOpened()\n\t\t{\n\t\t\tthis.isSearchHeaderOpened = !this.isSearchHeaderOpened;\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close, { panel: SidebarDetailBlock.task });\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst nameGetter = this.searchQuery.length > 0 ? 'sidebar/tasks/hasNextPageSearch' : 'sidebar/tasks/hasNextPage';\n\t\t\tconst hasNextPage = this.$store.getters[nameGetter](this.chatId);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event): Promise<void>\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tawait this.service.loadNextPage();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait this.serviceSearch.request();\n\t\t\t}\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tonAddClick()\n\t\t{\n\t\t\t(new EntityCreator(this.chatId)).createTaskForChat();\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-task-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"loc('IM_SIDEBAR_TASK_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t:withAddButton=\"showAddButton\"\n\t\t\t\t:isSearchHeaderOpened=\"isSearchHeaderOpened\"\n\t\t\t\t:delayForFocusOnStart=\"0\"\n\t\t\t\twithSearch\n\t\t\t\t@changeQuery=\"onChangeQuery\"\n\t\t\t\t@toggleSearchPanelOpened=\"toggleSearchPanelOpened\"\n\t\t\t\t@addClick=\"onAddClick\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-task-detail__container bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-task-detail__date-group_container\">\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<TaskItem\n\t\t\t\t\t\tv-for=\"task in dateGroup.items\"\n\t\t\t\t\t\t:task=\"task\"\n\t\t\t\t\t\t:searchQuery=\"searchQuery\"\n\t\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<TariffLimit\n\t\t\t\t\tv-if=\"hasHistoryLimit\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:panel=\"SidebarDetailBlock.task\"\n\t\t\t\t\tclass=\"bx-im-sidebar-task-detail__tariff-limit-container\"\n\t\t\t\t/>\n\t\t\t\t<template v-if=\"!isLoading\">\n\t\t\t\t\t<template v-if=\"isSearchHeaderOpened\">\n\t\t\t\t\t\t<StartState\n\t\t\t\t\t\t\tv-if=\"preparedQuery.length === 0\"\n\t\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_SEARCH_MESSAGE_START_TITLE')\"\n\t\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<DetailEmptySearchState\n\t\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_EXTENDED')\"\n\t\t\t\t\t\t\t:subTitle=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_DESCRIPTION_EXTENDED')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<DetailEmptyState\n\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_TASKS_EMPTY')\"\n\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.task\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Dom } from 'main.core';\n\nimport '../css/detail-tabs.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelSidebarFileTab } from 'im.v2.model';\n\nconst ARROW_CONTROL_SIZE = 50;\n\n// @vue/component\nexport const DetailTabs = {\n\tname: 'DetailTabs',\n\tprops:\n\t{\n\t\ttabs: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t},\n\temits: ['tabSelect'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\thasLeftControl: false,\n\t\t\thasRightControl: false,\n\t\t\tcurrentElementIndex: 0,\n\t\t\thighlightOffsetLeft: 0,\n\t\t\thighlightWidth: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\thighlightStyle(): JsonObject\n\t\t{\n\t\t\treturn {\n\t\t\t\tleft: `${this.highlightOffsetLeft}px`,\n\t\t\t\twidth: `${this.highlightWidth}px`,\n\t\t\t};\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tcurrentElementIndex(newIndex: number)\n\t\t{\n\t\t\tthis.updateHighlightPosition(newIndex);\n\t\t\tthis.$emit('tabSelect', this.tabs[newIndex]);\n\t\t\tthis.scrollToElement(newIndex);\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tif (this.$refs.tabs.scrollWidth > this.$refs.tabs.offsetWidth)\n\t\t{\n\t\t\tthis.hasRightControl = true;\n\t\t}\n\n\t\tthis.updateHighlightPosition(this.currentElementIndex);\n\t},\n\tmethods:\n\t{\n\t\tgetElementNodeByIndex(index: number): HTMLElement\n\t\t{\n\t\t\treturn [...this.$refs.tabs.children].filter((node) => {\n\t\t\t\treturn !Dom.hasClass(node, 'bx-sidebar-tabs-highlight');\n\t\t\t})[index];\n\t\t},\n\t\tupdateHighlightPosition(index: number)\n\t\t{\n\t\t\tconst element = this.getElementNodeByIndex(index);\n\t\t\tthis.highlightOffsetLeft = element.offsetLeft;\n\t\t\tthis.highlightWidth = element.offsetWidth;\n\t\t},\n\t\tscrollToElement(elementIndex: number)\n\t\t{\n\t\t\tconst element = this.getElementNodeByIndex(elementIndex);\n\t\t\tthis.$refs.tabs.scroll({ left: element.offsetLeft - ARROW_CONTROL_SIZE, behavior: 'smooth' });\n\t\t},\n\t\tonTabClick(event)\n\t\t{\n\t\t\tthis.currentElementIndex = event.index;\n\t\t},\n\t\tgetTabTitle(tab: ImModelSidebarFileTab): string\n\t\t{\n\t\t\tconst tabNameToUpperCase = tab.toUpperCase();\n\t\t\tlet langPhraseCode = `IM_SIDEBAR_FILES_${tabNameToUpperCase}_TAB`;\n\n\t\t\tif (tabNameToUpperCase === 'BRIEF')\n\t\t\t{\n\t\t\t\tlangPhraseCode += '_MSGVER_2';\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage(langPhraseCode);\n\t\t},\n\t\tisSelectedTab(index: number): boolean\n\t\t{\n\t\t\treturn index === this.currentElementIndex;\n\t\t},\n\t\tonLeftClick()\n\t\t{\n\t\t\tif (this.currentElementIndex <= 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentElementIndex--;\n\t\t},\n\t\tonRightClick()\n\t\t{\n\t\t\tif (this.currentElementIndex >= this.tabs.length - 1)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentElementIndex++;\n\t\t},\n\t\tupdateControlsVisibility()\n\t\t{\n\t\t\tthis.hasRightControl = this.$refs.tabs.scrollWidth > this.$refs.tabs.scrollLeft + this.$refs.tabs.clientWidth;\n\t\t\tthis.hasLeftControl = this.$refs.tabs.scrollLeft > 0;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-detail-tabs__container bx-im-sidebar-detail-tabs__scope\">\n\t\t\t<div v-if=\"hasLeftControl\" @click.stop=\"onLeftClick\" class=\"bx-im-sidebar-ears__control --left\">\n\t\t\t\t<div class=\"bx-im-sidebar__forward-icon\"></div>\n\t\t\t</div>\n\t\t\t<div v-if=\"hasRightControl\" @click.stop=\"onRightClick\" class=\"bx-im-sidebar-ears__control --right\">\n\t\t\t\t<div class=\"bx-im-sidebar__forward-icon\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-ears__elements\" ref=\"tabs\" @scroll.passive=\"updateControlsVisibility\">\n\t\t\t\t<div class=\"bx-sidebar-tabs-highlight\" :style=\"highlightStyle\"></div>\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"(tab, index) in tabs\"\n\t\t\t\t\t:key=\"tab\"\n\t\t\t\t\tclass=\"bx-im-sidebar-detail-tabs__item\"\n\t\t\t\t\t:class=\"[isSelectedTab(index) ? '--selected' : '']\"\n\t\t\t\t\t@click=\"onTabClick({index: index})\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"bx-im-sidebar-detail-tabs__item-title\">{{ getTabTitle(tab) }}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from '../helpers/get-chat-id';\nimport { getLastElementId } from '../helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\ntype RestResponse = {\n\tfiles: [],\n\tlist: [],\n\tusers: [],\n};\n\ntype UrlGetQueryParams = {\n\tCHAT_ID: number,\n\tLIMIT: number,\n\tGROUP: string,\n\tSEARCH_FILE_NAME?: string,\n\tLAST_ID?: number,\n};\n\nexport class FileSearch\n{\n\tstore: Store;\n\tdialogId: string;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\thasMoreItemsToLoad: boolean = true;\n\t#query: string = '';\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tsearchOnServer(query: string, group: string): Promise<number[]>\n\t{\n\t\tif (this.#query !== query)\n\t\t{\n\t\t\tthis.#query = query;\n\t\t\tthis.hasMoreItemsToLoad = true;\n\t\t}\n\n\t\treturn this.request(group);\n\t}\n\n\tresetSearchState()\n\t{\n\t\tthis.#query = '';\n\t\tthis.hasMoreItemsToLoad = true;\n\t\tvoid this.store.dispatch('sidebar/files/clearSearch', {});\n\t}\n\n\tasync request(group: string): Promise<number[]>\n\t{\n\t\tconst queryParams = this.getQueryParams(group);\n\t\tlet responseData: RestResponse = {};\n\t\ttry\n\t\t{\n\t\t\tconst response = await this.restClient.callMethod(RestMethod.imChatFileGet, queryParams);\n\t\t\tresponseData = response.data();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('SidebarSearch: Im.imChatFileGet: page request error', error);\n\t\t}\n\n\t\treturn this.#processSearchResponse(responseData);\n\t}\n\n\t#processSearchResponse(response: RestResponse): Promise<number[]>\n\t{\n\t\treturn this.updateModels(response).then(() => {\n\t\t\treturn response.files.map((file) => file.id);\n\t\t});\n\t}\n\n\tupdateModels(resultData: RestResponse): Promise\n\t{\n\t\tconst { list, users, files, tariffRestrictions = {} } = resultData;\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\t\tconst historyLimitPromise = this.store.dispatch('sidebar/files/setHistoryLimitExceeded', {\n\t\t\tchatId: this.chatId,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setFilesPromise = this.store.dispatch('files/set', files);\n\n\t\tconst sortedGroups = {};\n\t\tlist.forEach((file) => {\n\t\t\tif (!sortedGroups[file.group])\n\t\t\t{\n\t\t\t\tsortedGroups[file.group] = [];\n\t\t\t}\n\t\t\tsortedGroups[file.group].push(file);\n\t\t});\n\n\t\tconst setSidebarFilesPromises = [];\n\t\tObject.keys(sortedGroups).forEach((group) => {\n\t\t\tconst listByType = sortedGroups[group];\n\t\t\tsetSidebarFilesPromises.push(\n\t\t\t\tthis.store.dispatch('sidebar/files/setSearch', {\n\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\tfiles: listByType,\n\t\t\t\t\tgroup,\n\t\t\t\t}),\n\t\t\t\tthis.store.dispatch('sidebar/files/setHasNextPageSearch', {\n\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\tgroup,\n\t\t\t\t\thasNextPage: listByType.length === REQUEST_ITEMS_LIMIT,\n\t\t\t\t}),\n\t\t\t\tthis.store.dispatch('sidebar/files/setLastIdSearch', {\n\t\t\t\t\tchatId: this.chatId,\n\t\t\t\t\tgroup,\n\t\t\t\t\tlastId: getLastElementId(listByType),\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\n\t\treturn Promise.all([\n\t\t\tsetFilesPromise, addUsersPromise, historyLimitPromise, ...setSidebarFilesPromises,\n\t\t]);\n\t}\n\n\tloadNextPage(group: string, searchQuery: string): Promise\n\t{\n\t\tif (this.#query !== searchQuery)\n\t\t{\n\t\t\tthis.#query = searchQuery;\n\t\t}\n\n\t\treturn this.request(group);\n\t}\n\n\tgetQueryParams(group: string): UrlGetQueryParams\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tSEARCH_FILE_NAME: this.#query,\n\t\t\tGROUP: group.toUpperCase(),\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/files/getSearchResultCollectionLastId'](this.chatId, group);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n}\n","import 'ui.viewer';\nimport { Type } from 'main.core';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { FileViewerContext } from 'im.v2.const';\nimport { MessageAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport '../css/media-detail-item.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelSidebarFileItem, ImModelFile } from 'im.v2.model';\n\n// @vue/component\nexport const MediaDetailItem = {\n\tname: 'MediaDetailItem',\n\tcomponents: { MessageAvatar },\n\tprops: {\n\t\tfileItem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t\tvideoDuration: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tsidebarFileItem(): ImModelSidebarFileItem\n\t\t{\n\t\t\treturn this.fileItem;\n\t\t},\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.sidebarFileItem.fileId, true);\n\t\t},\n\t\tpreviewPicture(): Object\n\t\t{\n\t\t\tif (!this.hasPreview)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url('${this.imageSrc}')`,\n\t\t\t};\n\t\t},\n\t\thasPreview(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.file.urlPreview);\n\t\t},\n\t\tisImage(): boolean\n\t\t{\n\t\t\treturn this.file.type === 'image';\n\t\t},\n\t\tisVideo(): boolean\n\t\t{\n\t\t\treturn this.file.type === 'video';\n\t\t},\n\t\tviewerAttributes(): Object\n\t\t{\n\t\t\treturn Utils.file.getViewerDataAttributes({\n\t\t\t\tviewerAttributes: this.file.viewerAttrs,\n\t\t\t\tpreviewImageSrc: this.imageSrc,\n\t\t\t\tcontext: FileViewerContext.sidebarTabMedia,\n\t\t\t});\n\t\t},\n\t\tvideoDurationText(): string\n\t\t{\n\t\t\tif (this.videoDuration === 0)\n\t\t\t{\n\t\t\t\treturn '--:--';\n\t\t\t}\n\n\t\t\treturn this.formatTime(this.videoDuration);\n\t\t},\n\t\tcanBeOpenedWithViewer(): boolean\n\t\t{\n\t\t\treturn this.file.viewerAttrs && BX.UI?.Viewer;\n\t\t},\n\t\timageSrc(): string\n\t\t{\n\t\t\tconst isAnimation = ['gif', 'webp'].includes(this.file.extension);\n\n\t\t\treturn isAnimation ? this.file.urlShow : this.file.urlPreview;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tformatTime(rawSeconds: number): string\n\t\t{\n\t\t\trawSeconds = Math.floor(rawSeconds);\n\t\t\tconst durationHours = Math.floor(rawSeconds / 60 / 60);\n\t\t\tif (durationHours > 0)\n\t\t\t{\n\t\t\t\trawSeconds -= durationHours * 60 * 60;\n\t\t\t}\n\n\t\t\tconst durationMinutes = Math.floor(rawSeconds / 60);\n\t\t\tif (durationMinutes > 0)\n\t\t\t{\n\t\t\t\trawSeconds -= durationMinutes * 60;\n\t\t\t}\n\n\t\t\tconst hours = durationHours > 0 ? `${durationHours}:` : '';\n\t\t\tconst minutes = hours > 0 ? `${durationMinutes.toString().padStart(2, '0')}:` : `${durationMinutes}:`;\n\t\t\tconst seconds = rawSeconds.toString().padStart(2, '0');\n\n\t\t\treturn hours + minutes + seconds;\n\t\t},\n\t\thandleVideoEvent()\n\t\t{\n\t\t\tif (!this.$refs.video)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.videoDuration = this.$refs.video.duration;\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tsidebarFile: this.sidebarFileItem,\n\t\t\t\tfile: this.file,\n\t\t\t\tmessageId: this.sidebarFileItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t\tdownload()\n\t\t{\n\t\t\tif (this.file.progress !== 100 || this.canBeOpenedWithViewer)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.open(this.file.urlDownload, '_blank');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-file-media-detail-item__container bx-im-sidebar-file-media-detail-item__scope\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-file-media-detail-item__header-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-file-media-detail-item__avatar-container\">\n\t\t\t\t\t<MessageAvatar \n\t\t\t\t\t\t:messageId=\"sidebarFileItem.messageId\" \n\t\t\t\t\t\t:authorId=\"sidebarFileItem.authorId\"\n\t\t\t\t\t\t:size=\"AvatarSize.S\" \n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<button\n\t\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\t\tclass=\"bx-im-sidebar-file-media-detail-item__context-menu bx-im-messenger__context-menu-icon\"\n\t\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t\t></button>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"isImage\"\n\t\t\t\tclass=\"bx-im-sidebar-file-media-detail-item__content --image\" \n\t\t\t\t:style=\"previewPicture\"\n\t\t\t\tv-bind=\"viewerAttributes\"\n\t\t\t\t:title=\"file.name\"\n\t\t\t\t@click=\"download\"\n\t\t\t>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"isVideo\"\n\t\t\t\tclass=\"bx-im-sidebar-file-media-detail-item__content --video\"\n\t\t\t\t:style=\"previewPicture\"\n\t\t\t\tv-bind=\"viewerAttributes\"\n\t\t\t\t:title=\"file.name\"\n\t\t\t\t@click=\"download\"\n\t\t\t>\n\t\t\t\t<video\n\t\t\t\t\tv-show=\"!hasPreview\"\n\t\t\t\t\t:src=\"file.urlDownload\"\n\t\t\t\t\tref=\"video\"\n\t\t\t\t\tclass=\"bx-im-sidebar-file-media-detail-item__video\" \n\t\t\t\t\tpreload=\"metadata\" \n\t\t\t\t\t@durationchange=\"handleVideoEvent\"\n\t\t\t\t\t@loadeddata=\"handleVideoEvent\"\n\t\t\t\t\t@loadedmetadata=\"handleVideoEvent\"\n\t\t\t\t></video>\n\t\t\t</div>\n\t\t\t<div v-if=\"isVideo\" class=\"bx-im-sidebar-file-media-detail-item__video-controls\">\n\t\t\t\t<span class=\"bx-im-sidebar-file-media-detail-item__video-controls-icon\"></span>\n\t\t\t\t<span class=\"bx-im-sidebar-file-media-detail-item__video-controls-time\">{{ videoDurationText }}</span>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Store } from 'ui.vue3.vuex';\n\nimport { Core } from 'im.v2.application.core';\nimport { DiskService } from 'im.v2.provider.service.disk';\n\nimport type { ImModelSidebarFileItem } from 'im.v2.model';\n\nexport class FileManager\n{\n\tstore: Store;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.diskService = new DiskService();\n\t}\n\n\tdelete(sidebarFile: ImModelSidebarFileItem): void\n\t{\n\t\tvoid this.store.dispatch('sidebar/files/delete', {\n\t\t\tdialogId: sidebarFile.chatId,\n\t\t\tid: sidebarFile.id,\n\t\t});\n\n\t\tvoid this.diskService.delete({ chatId: sidebarFile.chatId, fileId: sidebarFile.fileId });\n\t}\n\n\tsaveOnDisk(fileIds: number[]): Promise\n\t{\n\t\treturn this.diskService.save(fileIds);\n\t}\n}\n","import 'ui.viewer';\n\nimport { Loc } from 'main.core';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { Notifier } from 'im.v2.lib.notifier';\n\nimport { SidebarMenu } from '../sidebar-base-menu';\nimport { FileManager } from './file-manager';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\nimport type { ApplicationContext } from 'im.v2.const';\nimport type { ImModelFile, ImModelSidebarFileItem } from 'im.v2.model';\n\ntype MediaMenuContext = {\n\tsidebarFile: ImModelSidebarFileItem,\n\tfile: ImModelFile,\n\tmessageId: number,\n\tdialogId: string,\n}\n\nexport class FileMenu extends SidebarMenu\n{\n\tcontext: MediaMenuContext;\n\n\tconstructor(applicationContext: ApplicationContext)\n\t{\n\t\tsuper(applicationContext);\n\n\t\tthis.id = 'im-sidebar-context-menu';\n\t\tthis.mediaManager = new FileManager();\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenContextMessageItem(),\n\t\t\tthis.getDownloadFileItem(),\n\t\t\tthis.getSaveFileOnDiskItem(),\n\t\t\tthis.getDeleteFileItem(),\n\t\t];\n\t}\n\n\tgetDownloadFileItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.context.file.urlDownload)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_SIDEBAR_MENU_DOWNLOAD_FILE'),\n\t\t\tonClick: function() {\n\t\t\t\tUtils.file.downloadFiles([this.context.file]);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\tgetSaveFileOnDiskItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.context.sidebarFile.fileId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_SIDEBAR_MENU_SAVE_FILE_ON_DISK_MSGVER_1'),\n\t\t\tonClick: async function() {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tawait this.mediaManager.saveOnDisk([this.context.sidebarFile.fileId]);\n\t\t\t\tNotifier.file.onDiskSaveComplete();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n\n\tgetDeleteFileItem(): ?MenuItemOptions\n\t{\n\t\tif (this.getCurrentUserId() !== this.context.sidebarFile.authorId)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_SIDEBAR_MENU_DELETE_FILE'),\n\t\t\tonClick: function() {\n\t\t\t\tthis.mediaManager.delete(this.context.sidebarFile);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n}\n","import { SidebarDetailBlock, SidebarFileGroups } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements.loader';\n\nimport { File } from '../../../../classes/panels/file';\nimport { FileSearch } from '../../../../classes/panels/search/file-search';\nimport { DateGroup } from '../../../elements/date-group/date-group';\nimport { MediaDetailItem } from './media-detail-item';\nimport { DetailEmptyState as StartState, DetailEmptyState } from '../../../elements/detail-empty-state/detail-empty-state';\nimport { DetailEmptySearchState } from '../../../elements/detail-empty-search-state/detail-empty-search-state';\nimport { FileMenu } from '../../../../classes/context-menu/file/file-menu';\nimport { SidebarCollectionFormatter } from '../../../../classes/sidebar-collection-formatter';\nimport { Extension } from 'main.core';\n\nimport '../css/media-tab.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelSidebarFileItem, ImModelChat } from 'im.v2.model';\n\nconst DEFAULT_MIN_TOKEN_SIZE = 3;\n\n// @vue/component\nexport const MediaTab = {\n\tname: 'MediaTab',\n\tcomponents: { DateGroup, MediaDetailItem, DetailEmptyState, StartState, DetailEmptySearchState, Loader },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchResult: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tisSearch: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tisLoadingSearch: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tminTokenSize: DEFAULT_MIN_TOKEN_SIZE,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\tif (this.isSearch)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['sidebar/files/getSearchResultCollection'](this.chatId, SidebarFileGroups.media);\n\t\t\t}\n\n\t\t\treturn this.$store.getters['sidebar/files/get'](this.chatId, SidebarFileGroups.media);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.files);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tisSearchQueryMinimumSize(): boolean\n\t\t{\n\t\t\treturn this.searchQuery.length < this.minTokenSize;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.service = new File({ dialogId: this.dialogId });\n\t\tthis.serviceSearch = new FileSearch({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FileMenu({ emitter: this.getEmitter() });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.sidebar');\n\t\t\tthis.minTokenSize = settings.get('minSearchTokenSize', DEFAULT_MIN_TOKEN_SIZE);\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst nameGetter = this.searchQuery.length > 0 ? 'sidebar/files/hasNextPageSearch' : 'sidebar/files/hasNextPage';\n\t\t\tconst hasNextPage = this.$store.getters[nameGetter](this.chatId, SidebarFileGroups.media);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tawait this.service.loadNextPage(SidebarFileGroups.media);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait this.serviceSearch.loadNextPage(SidebarFileGroups.media, this.searchQuery);\n\t\t\t}\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-media-detail__scope bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-file-media-detail__date-group_container\">\n\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t<div class=\"bx-im-sidebar-file-media-detail__items-group\">\n\t\t\t\t\t<MediaDetailItem\n\t\t\t\t\t\tv-for=\"file in dateGroup.items\"\n\t\t\t\t\t\t:fileItem=\"file\"\n\t\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<template v-if=\"!isLoading && !isLoadingSearch\">\n\t\t\t\t<template v-if=\"isSearch\">\n\t\t\t\t\t<StartState\n\t\t\t\t\t\tv-if=\"searchQuery.length === 0\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_SEARCH_RESULT_START_TITLE')\"\n\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t\t/>\n\t\t\t\t\t<DetailEmptySearchState\n\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_EXTENDED')\"\n\t\t\t\t\t\t:subTitle=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_DESCRIPTION_EXTENDED')\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MEDIA_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.media\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<Loader v-if=\"isLoading || isLoadingSearch\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t</div>\n\t`,\n};\n","import { ImModelSidebarFileItem, ImModelFile } from 'im.v2.model';\nimport { AudioPlayer } from 'im.v2.component.elements.player';\n\nimport '../css/audio-detail-item.css';\n\n// @vue/component\nexport const AudioDetailItem = {\n\tname: 'AudioDetailItem',\n\tcomponents: { AudioPlayer },\n\tprops: {\n\t\tid: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tfileItem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tcomputed:\n\t{\n\t\tsidebarFileItem(): ImModelSidebarFileItem\n\t\t{\n\t\t\treturn this.fileItem;\n\t\t},\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.sidebarFileItem.fileId, true);\n\t\t},\n\t\taudioUrl(): string\n\t\t{\n\t\t\treturn this.file.urlDownload;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tsidebarFile: this.sidebarFileItem,\n\t\t\t\tfile: this.file,\n\t\t\t\tmessageId: this.sidebarFileItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-audio-detail-item__container bx-im-sidebar-file-audio-detail-item__scope\">\n\t\t\t<AudioPlayer \n\t\t\t\t:id=\"id\"\n\t\t\t\t:src=\"audioUrl\" \n\t\t\t\t:file=\"file\" \n\t\t\t\t:messageId=\"sidebarFileItem.messageId\"\n\t\t\t\t:authorId=\"sidebarFileItem.authorId\"\n\t\t\t\t:withPlaybackRateControl=\"true\"\n\t\t\t\t:withTranscription=\"false\"\n\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Extension } from 'main.core';\n\nimport { SidebarDetailBlock, SidebarFileGroups } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements.loader';\n\nimport { File } from '../../../../classes/panels/file';\nimport { FileSearch } from '../../../../classes/panels/search/file-search';\nimport { DateGroup } from '../../../elements/date-group/date-group';\nimport { AudioDetailItem } from './audio-detail-item';\nimport { DetailEmptyState as StartState, DetailEmptyState } from '../../../elements/detail-empty-state/detail-empty-state';\nimport { DetailEmptySearchState } from '../../../elements/detail-empty-search-state/detail-empty-search-state';\nimport { FileMenu } from '../../../../classes/context-menu/file/file-menu';\nimport { SidebarCollectionFormatter } from '../../../../classes/sidebar-collection-formatter';\n\nimport '../css/audio-tab.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat, ImModelSidebarFileItem } from 'im.v2.model';\n\nconst DEFAULT_MIN_TOKEN_SIZE = 3;\n\n// @vue/component\nexport const AudioTab = {\n\tname: 'AudioTab',\n\tcomponents: { DetailEmptyState, AudioDetailItem, DateGroup, StartState, DetailEmptySearchState, Loader },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchResult: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tisSearch: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tisLoadingSearch: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tminTokenSize: DEFAULT_MIN_TOKEN_SIZE,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\tif (this.isSearch)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['sidebar/files/getSearchResultCollection'](this.chatId, SidebarFileGroups.audio);\n\t\t\t}\n\n\t\t\treturn this.$store.getters['sidebar/files/get'](this.chatId, SidebarFileGroups.audio);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.files);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tisSearchQueryMinimumSize(): boolean\n\t\t{\n\t\t\treturn this.searchQuery.length < this.minTokenSize;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.service = new File({ dialogId: this.dialogId });\n\t\tthis.serviceSearch = new FileSearch({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FileMenu({ emitter: this.getEmitter() });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.sidebar');\n\t\t\tthis.minTokenSize = settings.get('minSearchTokenSize', DEFAULT_MIN_TOKEN_SIZE);\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst nameGetter = this.searchQuery.length > 0 ? 'sidebar/files/hasNextPageSearch' : 'sidebar/files/hasNextPage';\n\t\t\tconst hasNextPage = this.$store.getters[nameGetter](this.chatId, SidebarFileGroups.audio);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tawait this.service.loadNextPage(SidebarFileGroups.audio);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait this.serviceSearch.loadNextPage(SidebarFileGroups.audio, this.searchQuery);\n\t\t\t}\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-audio-detail__scope bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-file-audio-detail__date-group_container\">\n\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t<AudioDetailItem\n\t\t\t\t\tv-for=\"file in dateGroup.items\"\n\t\t\t\t\t:id=\"file.id\"\n\t\t\t\t\t:fileItem=\"file\"\n\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<template v-if=\"!isLoading && !isLoadingSearch\">\n\t\t\t\t<template v-if=\"isSearch\">\n\t\t\t\t\t<StartState\n\t\t\t\t\t\tv-if=\"searchQuery.length === 0\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_SEARCH_RESULT_START_TITLE')\"\n\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t\t/>\n\t\t\t\t\t<DetailEmptySearchState\n\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_EXTENDED')\"\n\t\t\t\t\t\t:subTitle=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_DESCRIPTION_EXTENDED')\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t:title=\"loc('IM_SIDEBAR_AUDIO_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.audio\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<Loader v-if=\"isLoading || isLoadingSearch\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t</div>\n\t`,\n};\n","import 'ui.icons';\nimport { Text } from 'main.core';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { FileViewerContext } from 'im.v2.const';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\nimport { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { MessageAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport '../css/brief-item.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelSidebarFileItem, ImModelFile } from 'im.v2.model';\n\n// @vue/component\nexport const BriefItem = {\n\tname: 'BriefItem',\n\tcomponents: { MessageAvatar, ChatTitle },\n\tprops: {\n\t\tbrief: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t\trequired: false,\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tsidebarFileItem(): ImModelSidebarFileItem\n\t\t{\n\t\t\treturn this.brief;\n\t\t},\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.sidebarFileItem.fileId, true);\n\t\t},\n\t\tfileShortName(): string\n\t\t{\n\t\t\tconst NAME_MAX_LENGTH = 15;\n\t\t\tconst shortName = Utils.file.getShortFileName(this.file.name, NAME_MAX_LENGTH);\n\t\t\tif (this.searchQuery.length === 0)\n\t\t\t{\n\t\t\t\treturn Text.encode(shortName);\n\t\t\t}\n\n\t\t\treturn highlightText(Text.encode(shortName), this.searchQuery);\n\t\t},\n\t\tfileSize(): string\n\t\t{\n\t\t\treturn Utils.file.formatFileSize(this.file.size);\n\t\t},\n\t\tviewerAttributes(): Object\n\t\t{\n\t\t\treturn Utils.file.getViewerDataAttributes({\n\t\t\t\tviewerAttributes: this.file.viewerAttrs,\n\t\t\t\tpreviewImageSrc: this.file.urlPreview,\n\t\t\t\tcontext: FileViewerContext.sidebarTabBriefs,\n\t\t\t});\n\t\t},\n\t\tisViewerAvailable(): boolean\n\t\t{\n\t\t\treturn Object.keys(this.viewerAttributes).length > 0;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tdownload()\n\t\t{\n\t\t\tif (this.isViewerAvailable)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.open(this.file.urlDownload, '_blank');\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tsidebarFile: this.sidebarFileItem,\n\t\t\t\tfile: this.file,\n\t\t\t\tmessageId: this.sidebarFileItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-brief-item__container bx-im-sidebar-brief-item__scope\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-brief-item__icon-container\"></div>\n\t\t\t<div class=\"bx-im-sidebar-brief-item__content-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-brief-item__content\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-brief-item__title\" @click=\"download\" v-bind=\"viewerAttributes\">\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-brief-item__title-text\" :title=\"file.name\" v-html=\"fileShortName\"></span>\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-brief-item__size-text\">{{fileSize}}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-sidebar-brief-item__author-container\">\n\t\t\t\t\t\t<MessageAvatar \n\t\t\t\t\t\t\t:messageId=\"sidebarFileItem.messageId\"\n\t\t\t\t\t\t\t:authorId=\"sidebarFileItem.authorId\"\n\t\t\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t\t\t\tclass=\"bx-im-sidebar-brief-item__author-avatar\" \n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ChatTitle :dialogId=\"sidebarFileItem.authorId\" :showItsYou=\"false\" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\tclass=\"bx-im-messenger__context-menu-icon bx-im-sidebar-brief-item__context-menu-button\"\n\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import { Extension } from 'main.core';\n\nimport { SidebarFileGroups, SidebarDetailBlock } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements.loader';\n\nimport { File } from '../../../../classes/panels/file';\nimport { FileSearch } from '../../../../classes/panels/search/file-search';\nimport { BriefItem } from './brief-item';\nimport { DateGroup } from '../../../elements/date-group/date-group';\nimport { DetailEmptyState as StartState, DetailEmptyState } from '../../../elements/detail-empty-state/detail-empty-state';\nimport { DetailEmptySearchState } from '../../../elements/detail-empty-search-state/detail-empty-search-state';\nimport { FileMenu } from '../../../../classes/context-menu/file/file-menu';\nimport { SidebarCollectionFormatter } from '../../../../classes/sidebar-collection-formatter';\n\nimport '../css/brief-tab.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat, ImModelSidebarFileItem } from 'im.v2.model';\n\nconst DEFAULT_MIN_TOKEN_SIZE = 3;\n\n// @vue/component\nexport const BriefTab = {\n\tname: 'BriefTab',\n\tcomponents: { DateGroup, BriefItem, DetailEmptyState, StartState, DetailEmptySearchState, Loader },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchResult: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tisSearch: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tisLoadingSearch: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tminTokenSize: DEFAULT_MIN_TOKEN_SIZE,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\tif (this.isSearch)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['sidebar/files/getSearchResultCollection'](this.chatId, SidebarFileGroups.brief);\n\t\t\t}\n\n\t\t\treturn this.$store.getters['sidebar/files/get'](this.chatId, SidebarFileGroups.brief);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.files);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tisSearchQueryMinimumSize(): boolean\n\t\t{\n\t\t\treturn this.searchQuery.length < this.minTokenSize;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.service = new File({ dialogId: this.dialogId });\n\t\tthis.serviceSearch = new FileSearch({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FileMenu({ emitter: this.getEmitter() });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.sidebar');\n\t\t\tthis.minTokenSize = settings.get('minSearchTokenSize', DEFAULT_MIN_TOKEN_SIZE);\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst nameGetter = this.searchQuery.length > 0 ? 'sidebar/files/hasNextPageSearch' : 'sidebar/files/hasNextPage';\n\t\t\tconst hasNextPage = this.$store.getters[nameGetter](this.chatId, SidebarFileGroups.brief);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tawait this.service.loadNextPage(SidebarFileGroups.brief);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait this.serviceSearch.loadNextPage(SidebarFileGroups.brief, this.searchQuery);\n\t\t\t}\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-brief-detail__scope bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-brief-detail__date-group_container\">\n\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\"/>\n\t\t\t\t<BriefItem\n\t\t\t\t\tv-for=\"file in dateGroup.items\"\n\t\t\t\t\t:brief=\"file\"\n\t\t\t\t\t:searchQuery=\"searchQuery\"\n\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<template v-if=\"!isLoading && !isLoadingSearch\">\n\t\t\t\t<template v-if=\"isSearch\">\n\t\t\t\t\t<StartState\n\t\t\t\t\t\tv-if=\"searchQuery.length === 0\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_SEARCH_RESULT_START_TITLE')\"\n\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t\t/>\n\t\t\t\t\t<DetailEmptySearchState\n\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_EXTENDED')\"\n\t\t\t\t\t\t:subTitle=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_DESCRIPTION_EXTENDED')\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t:title=\"loc('IM_SIDEBAR_BRIEFS_EMPTY_MSGVER_2')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.document\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<Loader v-if=\"isLoading || isLoadingSearch\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t</div>\n\t`,\n};\n","import 'ui.icons';\nimport { Text } from 'main.core';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\nimport { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { MessageAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport '../css/file-detail-item.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { ImModelSidebarFileItem, ImModelFile } from 'im.v2.model';\n\n// @vue/component\nexport const FileDetailItem = {\n\tname: 'FileDetailItem',\n\tcomponents: { MessageAvatar, ChatTitle },\n\tprops: {\n\t\tfileItem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t\trequired: false,\n\t\t},\n\t\tviewerContext: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tsidebarFileItem(): ImModelSidebarFileItem\n\t\t{\n\t\t\treturn this.fileItem;\n\t\t},\n\t\tfile(): ImModelFile\n\t\t{\n\t\t\treturn this.$store.getters['files/get'](this.sidebarFileItem.fileId, true);\n\t\t},\n\t\tfileIconClass(): string\n\t\t{\n\t\t\treturn `ui-icon ui-icon-file-${this.file.icon}`;\n\t\t},\n\t\tfileShortName(): string\n\t\t{\n\t\t\tconst NAME_MAX_LENGTH = 15;\n\t\t\tconst shortName = Utils.file.getShortFileName(this.file.name, NAME_MAX_LENGTH);\n\n\t\t\tif (this.searchQuery.length === 0)\n\t\t\t{\n\t\t\t\treturn Text.encode(shortName);\n\t\t\t}\n\n\t\t\treturn highlightText(Text.encode(shortName), this.searchQuery);\n\t\t},\n\t\tfileSize(): string\n\t\t{\n\t\t\treturn Utils.file.formatFileSize(this.file.size);\n\t\t},\n\t\tviewerAttributes(): Object\n\t\t{\n\t\t\treturn Utils.file.getViewerDataAttributes({\n\t\t\t\tviewerAttributes: this.file.viewerAttrs,\n\t\t\t\tpreviewImageSrc: this.file.urlPreview,\n\t\t\t\tcontext: this.viewerContext,\n\t\t\t});\n\t\t},\n\t\tisViewerAvailable(): boolean\n\t\t{\n\t\t\treturn Object.keys(this.viewerAttributes).length > 0;\n\t\t},\n\t\tauthorId(): number\n\t\t{\n\t\t\treturn this.sidebarFileItem.authorId;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tdownload()\n\t\t{\n\t\t\tif (this.isViewerAvailable)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\twindow.open(this.file.urlDownload, '_blank');\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tsidebarFile: this.sidebarFileItem,\n\t\t\t\tfile: this.file,\n\t\t\t\tmessageId: this.sidebarFileItem.messageId,\n\t\t\t}, event.currentTarget);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-sidebar-file-detail-item__container bx-im-sidebar-file-detail-item__scope\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-file-detail-item__icon-container\">\n\t\t\t\t<div :class=\"fileIconClass\"><i></i></div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-file-detail-item__content-container\" v-bind=\"viewerAttributes\">\n\t\t\t\t<div class=\"bx-im-sidebar-file-detail-item__content\">\n\t\t\t\t\t<div class=\"bx-im-sidebar-file-detail-item__file-title\" @click=\"download\" :title=\"file.name\">\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-file-detail-item__file-title-text\" v-html=\"fileShortName\"></span>\n\t\t\t\t\t\t<span class=\"bx-im-sidebar-file-detail-item__file-size\">{{fileSize}}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"bx-im-sidebar-file-detail-item__author-container\">\n\t\t\t\t\t\t<template v-if=\"authorId > 0\">\n\t\t\t\t\t\t\t<MessageAvatar\n\t\t\t\t\t\t\t\t:messageId=\"sidebarFileItem.messageId\"\n\t\t\t\t\t\t\t\t:authorId=\"sidebarFileItem.authorId\"\n\t\t\t\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t\t\t\t\tclass=\"bx-im-sidebar-file-detail-item__author-avatar\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<ChatTitle :dialogId=\"authorId\" :showItsYou=\"false\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<span v-else class=\"bx-im-sidebar-file-detail-item__system-author-text\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_SYSTEM_USER') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<button\n\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\tclass=\"bx-im-messenger__context-menu-icon\" \n\t\t\t\t@click=\"onContextMenuClick\"\n\t\t\t></button>\n\t\t</div>\n\t`,\n};\n","import { Extension } from 'main.core';\n\nimport { Loader } from 'im.v2.component.elements.loader';\nimport { SidebarDetailBlock, SidebarFileGroups, FileViewerContext } from 'im.v2.const';\n\nimport { File } from '../../../../classes/panels/file';\nimport { FileDetailItem } from './file-detail-item';\nimport { DateGroup } from '../../../elements/date-group/date-group';\nimport { FileMenu } from '../../../../classes/context-menu/file/file-menu';\nimport { FileSearch } from '../../../../classes/panels/search/file-search';\nimport { SidebarCollectionFormatter } from '../../../../classes/sidebar-collection-formatter';\nimport { DetailEmptySearchState } from '../../../elements/detail-empty-search-state/detail-empty-search-state';\nimport { DetailEmptyState as StartState, DetailEmptyState } from '../../../elements/detail-empty-state/detail-empty-state';\n\nimport '../css/file-tab.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat, ImModelSidebarFileItem } from 'im.v2.model';\n\nconst DEFAULT_MIN_TOKEN_SIZE = 3;\n\n// @vue/component\nexport const FileTab = {\n\tname: 'FileTab',\n\tcomponents: { DateGroup, FileDetailItem, DetailEmptyState, StartState, DetailEmptySearchState, Loader },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchResult: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tisSearch: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tisLoadingSearch: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tminTokenSize: DEFAULT_MIN_TOKEN_SIZE,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tFileViewerContext: () => FileViewerContext,\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\tif (this.isSearch)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['sidebar/files/getSearchResultCollection'](this.chatId, SidebarFileGroups.file);\n\t\t\t}\n\n\t\t\treturn this.$store.getters['sidebar/files/get'](this.chatId, SidebarFileGroups.file);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.files);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tisSearchQueryMinimumSize(): boolean\n\t\t{\n\t\t\treturn this.searchQuery.length < this.minTokenSize;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.service = new File({ dialogId: this.dialogId });\n\t\tthis.serviceSearch = new FileSearch({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FileMenu({ emitter: this.getEmitter() });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.sidebar');\n\t\t\tthis.minTokenSize = settings.get('minSearchTokenSize', DEFAULT_MIN_TOKEN_SIZE);\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst nameGetter = this.searchQuery.length > 0 ? 'sidebar/files/hasNextPageSearch' : 'sidebar/files/hasNextPage';\n\t\t\tconst hasNextPage = this.$store.getters[nameGetter](this.chatId, SidebarFileGroups.file);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tawait this.service.loadNextPage(SidebarFileGroups.file);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait this.serviceSearch.loadNextPage(SidebarFileGroups.file, this.searchQuery);\n\t\t\t}\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-detail__scope bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-file-detail__date-group_container\">\n\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t<FileDetailItem\n\t\t\t\t\tv-for=\"file in dateGroup.items\"\n\t\t\t\t\t:fileItem=\"file\"\n\t\t\t\t\t:searchQuery=\"searchQuery\"\n\t\t\t\t\t:viewerContext=\"FileViewerContext.sidebarTabFiles\"\n\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<template v-if=\"!isLoading && !isLoadingSearch\">\n\t\t\t\t<template v-if=\"isSearch\">\n\t\t\t\t\t<StartState\n\t\t\t\t\t\tv-if=\"searchQuery.length === 0\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_SEARCH_RESULT_START_TITLE')\"\n\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t\t/>\n\t\t\t\t\t<DetailEmptySearchState\n\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_EXTENDED')\"\n\t\t\t\t\t\t:subTitle=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_DESCRIPTION_EXTENDED')\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t:title=\"loc('IM_SIDEBAR_FILES_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.document\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<Loader v-if=\"isLoading || isLoadingSearch\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t</div>\n\t`,\n};\n","import { Text, Runtime, Extension } from 'main.core';\n\nimport { Loader } from 'im.v2.component.elements.loader';\nimport { Feature, FeatureManager } from 'im.v2.lib.feature';\nimport { SidebarFileTabGroups, SidebarDetailBlock, EventType } from 'im.v2.const';\n\nimport { File } from '../../../classes/panels/file';\nimport { DetailTabs } from './components/detail-tabs';\nimport { MediaTab } from './components/media-tab';\nimport { AudioTab } from './components/audio-tab';\nimport { BriefTab } from './components/brief-tab';\nimport { FileTab } from './components/file-tab';\nimport { DetailHeader } from '../../elements/detail-header/detail-header';\nimport { TariffLimit } from '../../elements/tariff-limit/tariff-limit';\nimport { FileSearch } from '../../../classes/panels/search/file-search';\nimport { concatAndSortSearchResult } from '../../../classes/panels/helpers/concat-and-sort-search-result';\n\nimport './css/file-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat } from 'im.v2.model';\n\nconst DEFAULT_MIN_TOKEN_SIZE = 3;\n\n// @vue/component\nexport const FilePanel = {\n\tname: 'FilePanel',\n\tcomponents: { DetailHeader, DetailTabs, MediaTab, AudioTab, FileTab, BriefTab, Loader, TariffLimit },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\ttab: SidebarFileTabGroups.media,\n\t\t\tisSearchHeaderOpened: false,\n\t\t\tsearchQuery: '',\n\t\t\tsearchResult: [],\n\t\t\tcurrentServerQueries: 0,\n\t\t\tisLoading: false,\n\t\t\tminTokenSize: DEFAULT_MIN_TOKEN_SIZE,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\ttabComponentName(): string\n\t\t{\n\t\t\treturn `${Text.capitalize(this.tab)}Tab`;\n\t\t},\n\t\ttabs(): string[]\n\t\t{\n\t\t\tconst tabTypes = Object.values(SidebarFileTabGroups);\n\t\t\tconst canShowBriefs = FeatureManager.isFeatureAvailable(Feature.sidebarBriefs);\n\t\t\tif (!canShowBriefs)\n\t\t\t{\n\t\t\t\treturn tabTypes.filter((tab) => tab !== SidebarDetailBlock.brief);\n\t\t\t}\n\n\t\t\treturn tabTypes;\n\t\t},\n\t\tpreparedQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t\tisSearchQueryMinimumSize(): boolean\n\t\t{\n\t\t\treturn this.preparedQuery.length < this.minTokenSize;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\thasHistoryLimit(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/files/isHistoryLimitExceeded'](this.chatId);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tpreparedQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.cleanSearchResult();\n\t\t\tthis.startSearch();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.service = new File({ dialogId: this.dialogId, tab: this.tab });\n\t\tthis.serviceSearch = new FileSearch({ dialogId: this.dialogId, tab: this.tab });\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 500, this);\n\t},\n\tmethods:\n\t{\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.sidebar');\n\t\t\tthis.minTokenSize = settings.get('minSearchTokenSize', DEFAULT_MIN_TOKEN_SIZE);\n\t\t},\n\t\tsearchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tthis.serviceSearch.searchOnServer(query, this.tab).then((messageIds: string[]) => {\n\t\t\t\tif (query !== this.preparedQuery)\n\t\t\t\t{\n\t\t\t\t\tthis.isLoading = false;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.searchResult = concatAndSortSearchResult(this.searchResult, messageIds);\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.currentServerQueries--;\n\t\t\t\tthis.stopLoader();\n\t\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t\t{\n\t\t\t\t\tthis.cleanSearchResult();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tstartSearch()\n\t\t{\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(this.preparedQuery);\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.serviceSearch.resetSearchState();\n\t\t\tthis.searchResult = [];\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close, { panel: SidebarDetailBlock.file });\n\t\t},\n\t\tonTabSelect(tabName: $Keys<typeof SidebarFileTabGroups>)\n\t\t{\n\t\t\tthis.tab = tabName;\n\t\t\tif (!this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t\tthis.startSearch();\n\t\t\t}\n\t\t},\n\t\tonChangeQuery(query: string)\n\t\t{\n\t\t\tthis.searchQuery = query;\n\t\t},\n\t\ttoggleSearchPanelOpened()\n\t\t{\n\t\t\tthis.isSearchHeaderOpened = !this.isSearchHeaderOpened;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div>\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"loc('IM_SIDEBAR_MEDIA_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t:isSearchHeaderOpened=\"isSearchHeaderOpened\"\n\t\t\t\t:delayForFocusOnStart=\"0\"\n\t\t\t\t@changeQuery=\"onChangeQuery\"\n\t\t\t\t@toggleSearchPanelOpened=\"toggleSearchPanelOpened\"\n\t\t\t\twithSearch\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<TariffLimit\n\t\t\t\tv-if=\"hasHistoryLimit\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:panel=\"SidebarDetailBlock.file\"\n\t\t\t\tclass=\"bx-im-sidebar-file__tariff-limit-container\" \n\t\t\t/>\n\t\t\t<DetailTabs :tabs=\"tabs\" @tabSelect=\"onTabSelect\" />\n\t\t\t<KeepAlive>\n\t\t\t\t<component \n\t\t\t\t\t:is=\"tabComponentName\" \n\t\t\t\t\t:dialogId=\"dialogId\" \n\t\t\t\t\t:searchResult=\"searchResult\" \n\t\t\t\t\t:isSearch=\"isSearchHeaderOpened\" \n\t\t\t\t\t:searchQuery=\"searchQuery\" \n\t\t\t\t\t:isLoadingSearch=\"isLoading\"\n\t\t\t\t/>\n\t\t\t</KeepAlive>\n\t\t</div>\n\t`,\n};\n","import { Loader } from 'im.v2.component.elements.loader';\nimport { EventType, FileViewerContext, SidebarDetailBlock, SidebarFileGroups } from 'im.v2.const';\n\nimport { DateGroup } from '../../elements/date-group/date-group';\nimport { DetailHeader } from '../../elements/detail-header/detail-header';\nimport { FileUnsorted } from '../../../classes/panels/file-unsorted';\nimport { DetailEmptyState } from '../../elements/detail-empty-state/detail-empty-state';\nimport { FileMenu } from '../../../classes/context-menu/file/file-menu';\nimport { TariffLimit } from '../../elements/tariff-limit/tariff-limit';\nimport { FileDetailItem } from '../file/components/file-detail-item';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\n\nimport './detail.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelSidebarFileItem, ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const FileUnsortedPanel = {\n\tname: 'FileUnsortedPanel',\n\tcomponents: { DateGroup, FileDetailItem, DetailEmptyState, DetailHeader, Loader, TariffLimit },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tFileViewerContext: () => FileViewerContext,\n\t\tfiles(): ImModelSidebarFileItem[]\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/files/get'](this.chatId, SidebarFileGroups.fileUnsorted);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.files);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\thasHistoryLimit(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/files/isHistoryLimitExceeded'](this.chatId);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new FileUnsorted({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FileMenu({ emitter: this.getEmitter() });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/files/hasNextPage'](this.chatId, SidebarFileGroups.fileUnsorted);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close, { panel: SidebarDetailBlock.fileUnsorted });\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-file-unsorted-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_FILEUNSORTED_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-file-unsorted-detail__container bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-file-unsorted-detail__date-group_container\">\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<FileDetailItem\n\t\t\t\t\t\tv-for=\"file in dateGroup.items\"\n\t\t\t\t\t\t:fileItem=\"file\"\n\t\t\t\t\t\t:viewerContext=\"FileViewerContext.sidebarTabFileUnsorted\"\n\t\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<TariffLimit\n\t\t\t\t\tv-if=\"hasHistoryLimit\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:panel=\"SidebarDetailBlock.fileUnsorted\"\n\t\t\t\t\tclass=\"bx-im-sidebar-file-unsorted-detail__tariff-limit-container\"\n\t\t\t\t/>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t\t:title=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_FILES_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.document\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\n\nimport { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { MessageAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { Utils } from 'im.v2.lib.utils';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\n\nimport './css/link-item.css';\n\nimport type { ImModelSidebarLinkItem } from 'im.v2.model';\n\n// @vue/component\nexport const LinkItem = {\n\tname: 'LinkItem',\n\tcomponents: { MessageAvatar, ChatTitle },\n\tprops:\n\t{\n\t\tlink: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata(): { showContextButton: boolean } {\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tlinkItem(): ImModelSidebarLinkItem\n\t\t{\n\t\t\treturn this.link;\n\t\t},\n\t\tsource(): string\n\t\t{\n\t\t\treturn this.linkItem.source;\n\t\t},\n\t\tshortDescription(): string\n\t\t{\n\t\t\tlet hostName = '';\n\t\t\ttry\n\t\t\t{\n\t\t\t\thostName = new URL(this.source).hostname;\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\thostName = this.source;\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\n\t\t\treturn hostName;\n\t\t},\n\t\tdescription(): string\n\t\t{\n\t\t\tconst { name, description } = this.linkItem.richData;\n\t\t\tconst descriptionToShow = description || name || this.source;\n\n\t\t\tif (this.searchQuery.length === 0)\n\t\t\t{\n\t\t\t\tconst decodedDescription = Utils.text.convertHtmlEntities(descriptionToShow);\n\n\t\t\t\treturn Text.encode(decodedDescription);\n\t\t\t}\n\n\t\t\treturn highlightText(Text.encode(descriptionToShow), this.searchQuery);\n\t\t},\n\t\tauthorDialogId(): string\n\t\t{\n\t\t\treturn this.linkItem.authorId.toString();\n\t\t},\n\t\thasPreview(): boolean\n\t\t{\n\t\t\treturn Boolean(this.linkItem.richData?.previewUrl);\n\t\t},\n\t\tpreviewStyles(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tbackgroundImage: `url('${this.linkItem.richData?.previewUrl}')`,\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t\tbackgroundRepeat: 'no-repeat',\n\t\t\t};\n\t\t},\n\t\ticonTypeClass(): string\n\t\t{\n\t\t\tswitch (this.linkItem.richData?.type)\n\t\t\t{\n\t\t\t\tcase 'TASKS':\n\t\t\t\t\treturn '--task';\n\t\t\t\tcase 'LANDING':\n\t\t\t\t\treturn '--landing';\n\t\t\t\tcase 'POST':\n\t\t\t\t\treturn '--post';\n\t\t\t\tcase 'CALENDAR':\n\t\t\t\t\treturn '--calendar';\n\t\t\t\tdefault:\n\t\t\t\t\treturn '--common';\n\t\t\t}\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tid: this.linkItem.id,\n\t\t\t\tauthorId: this.linkItem.authorId,\n\t\t\t\tmessageId: this.linkItem.messageId,\n\t\t\t\tsource: this.source,\n\t\t\t\ttarget: event.currentTarget,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-link-item__container bx-im-link-item__scope\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<template v-if=\"hasPreview\">\n\t\t\t\t<div class=\"bx-im-link-item__icon-container\" :style=\"previewStyles\"></div>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div class=\"bx-im-link-item__icon-container\" :class=\"iconTypeClass\">\n\t\t\t\t\t<div class=\"bx-im-link-item__icon\" :class=\"iconTypeClass\" ></div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<div class=\"bx-im-link-item__content\">\n\t\t\t\t<div class=\"bx-im-link-item__short-description-text\">{{ shortDescription }}</div>\n\t\t\t\t<a :href=\"source\" :title=\"source\" target=\"_blank\" class=\"bx-im-link-item__description-text\" v-html=\"description\"></a>\n\t\t\t\t<div class=\"bx-im-link-item__author-container\">\n\t\t\t\t\t<MessageAvatar \n\t\t\t\t\t\t:messageId=\"linkItem.messageId\" \n\t\t\t\t\t\t:authorId=\"linkItem.authorId\"\n\t\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t\t\tclass=\"bx-im-link-item__author-avatar\" \n\t\t\t\t\t/>\n\t\t\t\t\t<ChatTitle :dialogId=\"authorDialogId\" :showItsYou=\"false\" class=\"bx-im-link-item__author-text\" />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"showContextButton\" class=\"bx-im-link-item__context-menu\">\n\t\t\t\t<button class=\"bx-im-messenger__context-menu-icon\" @click=\"onContextMenuClick\"></button>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\n\nimport { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from '../helpers/get-chat-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\ntype UrlGetQueryParams = {\n\tCHAT_ID: number,\n\tLIMIT: number,\n\tOFFSET?: number,\n\tSEARCH_URL?: string,\n}\n\ntype RestResponse = {\n\tlist: [],\n\tusers: [],\n};\n\nexport class LinkSearch\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\thasMoreItemsToLoad: boolean = true;\n\t#query: string = '';\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tsearchOnServer(query: string): Promise<number[]>\n\t{\n\t\tif (this.#query !== query)\n\t\t{\n\t\t\tthis.#query = query;\n\t\t\tthis.hasMoreItemsToLoad = true;\n\t\t}\n\n\t\treturn this.request();\n\t}\n\n\tresetSearchState()\n\t{\n\t\tthis.#query = '';\n\t\tthis.hasMoreItemsToLoad = true;\n\t\tvoid this.store.dispatch('sidebar/links/clearSearch', {});\n\t}\n\n\tasync request(): Promise<number[]>\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\t\tlet responseData: RestResponse = {};\n\t\ttry\n\t\t{\n\t\t\tconst response = await this.restClient.callMethod(RestMethod.imChatUrlGet, queryParams);\n\t\t\tresponseData = response.data();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('SidebarSearch: Im.imChatUrlGet: page request error', error);\n\t\t}\n\n\t\treturn this.#processSearchResponse(responseData);\n\t}\n\n\t#processSearchResponse(response: RestResponse): Promise<number[]>\n\t{\n\t\treturn this.#updateModels(response).then(() => {\n\t\t\treturn response.list.map((message) => message.messageId);\n\t\t});\n\t}\n\n\t#updateModels(resultData: RestResponse): Promise\n\t{\n\t\tconst { list, users, tariffRestrictions = {} } = resultData;\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setLinksPromise = this.store.dispatch('sidebar/links/setSearch', {\n\t\t\tchatId: this.chatId,\n\t\t\tlinks: list,\n\t\t\thasNextPage: list.length === REQUEST_ITEMS_LIMIT,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\n\t\treturn Promise.all([setLinksPromise, addUsersPromise]);\n\t}\n\n\tgetQueryParams(): UrlGetQueryParams\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t\tSEARCH_URL: this.#query,\n\t\t};\n\t\tconst linksCount = this.getLinksCountFromModel();\n\t\tif (Type.isNumber(linksCount) && linksCount > 0)\n\t\t{\n\t\t\tqueryParams.OFFSET = linksCount;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\tgetLinksCountFromModel(): number\n\t{\n\t\treturn this.store.getters['sidebar/links/getSearchResultCollectionSize'](this.chatId);\n\t}\n}\n","import { RestClient } from 'rest.client';\nimport { Store } from 'ui.vue3.vuex';\n\nimport { RestMethod } from 'im.v2.const';\nimport { Core } from 'im.v2.application.core';\n\nexport class LinkManager\n{\n\tstore: Store;\n\trestClient: RestClient;\n\n\tconstructor()\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t}\n\n\tdelete(link: Object)\n\t{\n\t\tthis.store.dispatch('sidebar/links/delete', { chatId: link.chatId, id: link.id });\n\n\t\tconst queryParams = { LINK_ID: link.id };\n\t\tthis.restClient.callMethod(RestMethod.imChatUrlDelete, queryParams).catch((error) => {\n\t\t\tconsole.error('Im.Sidebar: error deleting link', error);\n\t\t});\n\t}\n}\n","import 'ui.notification';\nimport { Loc } from 'main.core';\n\nimport { SidebarMenu } from '../sidebar-base-menu';\nimport { LinkManager } from './link-manager';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\nimport type { ApplicationContext } from 'im.v2.const';\n\nexport class LinkMenu extends SidebarMenu\n{\n\tconstructor(applicationContext: ApplicationContext)\n\t{\n\t\tsuper(applicationContext);\n\n\t\tthis.linkManager = new LinkManager();\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenContextMessageItem(),\n\t\t\tthis.getCopyLinkItem(Loc.getMessage('IM_SIDEBAR_MENU_COPY_LINK')),\n\t\t\tthis.getDeleteLinkItem(),\n\t\t];\n\t}\n\n\tgetDeleteLinkItem(): ?MenuItemOptions\n\t{\n\t\tif (this.context.authorId !== this.getCurrentUserId())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_SIDEBAR_MENU_DELETE_FROM_LINKS'),\n\t\t\tonClick: function() {\n\t\t\t\tthis.linkManager.delete(this.context);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n}\n","import { Runtime, Extension } from 'main.core';\n\nimport { Loader } from 'im.v2.component.elements.loader';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\n\nimport { concatAndSortSearchResult } from '../../../classes/panels/helpers/concat-and-sort-search-result';\nimport { TariffLimit } from '../../elements/tariff-limit/tariff-limit';\nimport { LinkItem } from './link-item';\nimport { Link } from '../../../classes/panels/link';\nimport { LinkSearch } from '../../../classes/panels/search/link-search';\nimport { DateGroup } from '../../elements/date-group/date-group';\nimport { DetailHeader } from '../../elements/detail-header/detail-header';\nimport { DetailEmptySearchState } from '../../elements/detail-empty-search-state/detail-empty-search-state';\nimport { DetailEmptyState as StartState, DetailEmptyState } from '../../elements/detail-empty-state/detail-empty-state';\nimport { LinkMenu } from '../../../classes/context-menu/link/link-menu';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\n\nimport './css/link-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat, ImModelSidebarLinkItem } from 'im.v2.model';\n\nconst DEFAULT_MIN_TOKEN_SIZE = 3;\n\n// @vue/component\nexport const LinkPanel = {\n\tname: 'LinkPanel',\n\tcomponents: {\n\t\tDetailHeader,\n\t\tLinkItem,\n\t\tDateGroup,\n\t\tDetailEmptyState,\n\t\tStartState,\n\t\tDetailEmptySearchState,\n\t\tLoader,\n\t\tTariffLimit,\n\t},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tisSearchHeaderOpened: false,\n\t\t\tsearchQuery: '',\n\t\t\tsearchResult: [],\n\t\t\tcurrentServerQueries: 0,\n\t\t\tminTokenSize: DEFAULT_MIN_TOKEN_SIZE,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tlinks(): ImModelSidebarLinkItem[]\n\t\t{\n\t\t\tif (this.isSearchHeaderOpened)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['sidebar/links/getSearchResultCollection'](this.chatId);\n\t\t\t}\n\n\t\t\treturn this.$store.getters['sidebar/links/get'](this.chatId);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.links);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tpreparedQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t\tisSearchQueryMinimumSize(): boolean\n\t\t{\n\t\t\treturn this.preparedQuery.length < this.minTokenSize;\n\t\t},\n\t\thasHistoryLimit(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/links/isHistoryLimitExceeded'](this.chatId);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tpreparedQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.cleanSearchResult();\n\t\t\tthis.startSearch();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new LinkMenu({ emitter: this.getEmitter() });\n\t\tthis.service = new Link({ dialogId: this.dialogId });\n\t\tthis.serviceSearch = new LinkSearch({ dialogId: this.dialogId });\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 500, this);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t\tthis.collectionFormatter.destroy();\n\t},\n\tmethods:\n\t{\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.sidebar');\n\t\t\tthis.minTokenSize = settings.get('minSearchTokenSize', DEFAULT_MIN_TOKEN_SIZE);\n\t\t},\n\t\tsearchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tthis.serviceSearch.searchOnServer(query).then((messageIds: string[]) => {\n\t\t\t\tif (query !== this.preparedQuery)\n\t\t\t\t{\n\t\t\t\t\tthis.isLoading = false;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.searchResult = concatAndSortSearchResult(this.searchResult, messageIds);\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.currentServerQueries--;\n\t\t\t\tthis.stopLoader();\n\t\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t\t{\n\t\t\t\t\tthis.cleanSearchResult();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tstartSearch()\n\t\t{\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(this.preparedQuery);\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.searchResult = [];\n\t\t\tthis.serviceSearch.resetSearchState();\n\t\t},\n\t\tonChangeQuery(query: string)\n\t\t{\n\t\t\tthis.searchQuery = query;\n\t\t},\n\t\ttoggleSearchPanelOpened()\n\t\t{\n\t\t\tthis.isSearchHeaderOpened = !this.isSearchHeaderOpened;\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\tid: event.id,\n\t\t\t\tmessageId: event.messageId,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tchatId: this.chatId,\n\t\t\t\tsource: event.source,\n\t\t\t\tauthorId: event.authorId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, event.target);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close, { panel: SidebarDetailBlock.link });\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst nameGetter = this.searchQuery.length > 0 ? 'sidebar/links/hasNextPageSearch' : 'sidebar/links/hasNextPage';\n\t\t\tconst hasNextPage = this.$store.getters[nameGetter](this.chatId);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event): Promise<void>\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tawait this.service.loadNextPage();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait this.serviceSearch.request();\n\t\t\t}\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-link-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"loc('IM_SIDEBAR_LINK_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t:isSearchHeaderOpened=\"isSearchHeaderOpened\"\n\t\t\t\t:delayForFocusOnStart=\"0\"\n\t\t\t\t@changeQuery=\"onChangeQuery\"\n\t\t\t\t@toggleSearchPanelOpened=\"toggleSearchPanelOpened\"\n\t\t\t\twithSearch\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-link-detail__date-group_container\">\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<template v-for=\"link in dateGroup.items\">\n\t\t\t\t\t\t<LinkItem\n\t\t\t\t\t\t\t:searchQuery=\"searchQuery\"\n\t\t\t\t\t\t\t:link=\"link\" \n\t\t\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t\t<TariffLimit\n\t\t\t\t\tv-if=\"hasHistoryLimit\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:panel=\"SidebarDetailBlock.link\"\n\t\t\t\t\tclass=\"bx-im-sidebar-link-detail__tariff-limit-container\"\n\t\t\t\t/>\n\t\t\t\t<template v-if=\"!isLoading\">\n\t\t\t\t\t<template v-if=\"isSearchHeaderOpened\">\n\t\t\t\t\t\t<StartState\n\t\t\t\t\t\t\tv-if=\"preparedQuery.length === 0\"\n\t\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_SEARCH_MESSAGE_START_TITLE')\"\n\t\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<DetailEmptySearchState\n\t\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_EXTENDED')\"\n\t\t\t\t\t\t\t:subTitle=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_DESCRIPTION_EXTENDED')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<DetailEmptyState\n\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_LINKS_EMPTY')\"\n\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.link\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Type, Runtime } from 'main.core';\n\nimport { MarketManager } from 'im.v2.lib.market';\nimport { Spinner, SpinnerSize } from 'im.v2.component.elements.loader';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\n\nimport { DetailHeader } from '../../elements/detail-header/detail-header';\n\nimport './detail.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelMarketApplication } from 'im.v2.model';\n\n// @vue/component\nexport const MarketPanel = {\n\tname: 'MarketPanel',\n\tcomponents: { Spinner, DetailHeader },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tentityId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: true,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSpinnerSize: () => SpinnerSize,\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tplacement(): ?ImModelMarketApplication\n\t\t{\n\t\t\tconst placementId = Number.parseInt(this.entityId, 10);\n\n\t\t\treturn this.$store.getters['market/getById'](placementId);\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\tif (this.placement && Type.isStringFilled(this.placement.title))\n\t\t\t{\n\t\t\t\treturn this.placement.title;\n\t\t\t}\n\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SIDEBAR_MARKET_DETAIL_TITLE');\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.marketManager = MarketManager.getInstance();\n\t},\n\tasync mounted()\n\t{\n\t\tconst context = { dialogId: this.dialogId };\n\t\tconst response = await this.marketManager.loadPlacement(this.entityId, context);\n\t\tthis.isLoading = false;\n\t\tRuntime.html(this.$refs['im-messenger-sidebar-placement'], response);\n\t},\n\tmethods:\n\t{\n\t\tonBackClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close, { panel: SidebarDetailBlock.market });\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-favorite-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"title\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-market-detail__container\">\n\t\t\t\t<div v-if=\"isLoading\" class=\"bx-im-sidebar-market-detail__loader-container\">\n\t\t\t\t\t<Spinner :size=\"SpinnerSize.S\" />\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"bx-im-sidebar-market-detail__placement-container\" \n\t\t\t\t\tref=\"im-messenger-sidebar-placement\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from '../helpers/get-chat-id';\nimport { getLastElementId } from '../helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\ntype RestResponse = {\n\tlist: [],\n\tusers: [],\n};\n\ntype UrlGetQueryParams = {\n\tCHAT_ID: number,\n\tLIMIT: number,\n\tLAST_ID?: number,\n\tSEARCH_TITLE?: string,\n}\n\nexport class MeetingSearch\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\thasMoreItemsToLoad: boolean = true;\n\t#query: string = '';\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tsearchOnServer(query: string): Promise<number[]>\n\t{\n\t\tif (this.#query !== query)\n\t\t{\n\t\t\tthis.#query = query;\n\t\t\tthis.hasMoreItemsToLoad = true;\n\t\t}\n\n\t\treturn this.request();\n\t}\n\n\tresetSearchState()\n\t{\n\t\tthis.#query = '';\n\t\tthis.hasMoreItemsToLoad = true;\n\t\tvoid this.store.dispatch('sidebar/meetings/clearSearch', {});\n\t}\n\n\tasync request(): Promise<number[]>\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\t\tlet responseData: RestResponse = {};\n\t\ttry\n\t\t{\n\t\t\tconst response = await this.restClient.callMethod(RestMethod.imChatCalendarGet, queryParams);\n\t\t\tresponseData = response.data();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('SidebarSearch: Im.imChatCalendarGet: page request error', error);\n\t\t}\n\n\t\treturn this.#processSearchResponse(responseData);\n\t}\n\n\t#processSearchResponse(response: RestResponse): Promise<number[]>\n\t{\n\t\treturn this.updateModels(response).then(() => {\n\t\t\treturn response.list.map((message) => message.messageId);\n\t\t});\n\t}\n\n\tgetQueryParams(): UrlGetQueryParams\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t\tSEARCH_TITLE: this.#query,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/meetings/getSearchResultCollectionLastId'](this.chatId);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\tupdateModels(resultData: RestResponse): Promise\n\t{\n\t\tconst { list, users, tariffRestrictions = {} } = resultData;\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\t\tconst hasNextPage = list.length === REQUEST_ITEMS_LIMIT;\n\t\tconst lastId = getLastElementId(list);\n\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\t\tconst setMeetingsPromise = this.store.dispatch('sidebar/meetings/setSearch', {\n\t\t\tchatId: this.chatId,\n\t\t\tmeetings: list,\n\t\t\thasNextPage,\n\t\t\tlastId,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\n\t\treturn Promise.all([setMeetingsPromise, addUsersPromise]);\n\t}\n}\n","import { Runtime, Extension } from 'main.core';\n\nimport { EventType, SidebarDetailBlock, ActionByRole } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements.loader';\nimport { EntityCreator } from 'im.v2.lib.entity-creator';\nimport { PermissionManager } from 'im.v2.lib.permission';\n\nimport { concatAndSortSearchResult } from '../../../classes/panels/helpers/concat-and-sort-search-result';\nimport { TariffLimit } from '../../elements/tariff-limit/tariff-limit';\nimport { MeetingItem } from './meeting-item';\nimport { DateGroup } from '../../elements/date-group/date-group';\nimport { DetailHeader } from '../../elements/detail-header/detail-header';\nimport { DetailEmptyState as StartState, DetailEmptyState } from '../../elements/detail-empty-state/detail-empty-state';\nimport { DetailEmptySearchState } from '../../elements/detail-empty-search-state/detail-empty-search-state';\nimport { MeetingMenu } from '../../../classes/context-menu/meeting/meeting-menu';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\nimport { Meeting } from '../../../classes/panels/meeting';\nimport { MeetingSearch } from '../../../classes/panels/search/meeting-search';\n\nimport './css/meeting-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelSidebarMeetingItem, ImModelChat } from 'im.v2.model';\n\nconst DEFAULT_MIN_TOKEN_SIZE = 3;\n\n// @vue/component\nexport const MeetingPanel = {\n\tname: 'MeetingPanel',\n\tcomponents: {\n\t\tMeetingItem,\n\t\tDateGroup,\n\t\tDetailEmptyState,\n\t\tStartState,\n\t\tDetailHeader,\n\t\tDetailEmptySearchState,\n\t\tLoader,\n\t\tTariffLimit,\n\t},\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tisSearchHeaderOpened: false,\n\t\t\tsearchQuery: '',\n\t\t\tsearchResult: [],\n\t\t\tcurrentServerQueries: 0,\n\t\t\tminTokenSize: DEFAULT_MIN_TOKEN_SIZE,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tmeetings(): ImModelSidebarMeetingItem[]\n\t\t{\n\t\t\tif (this.isSearchHeaderOpened)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['sidebar/meetings/getSearchResultCollection'](this.chatId);\n\t\t\t}\n\n\t\t\treturn this.$store.getters['sidebar/meetings/get'](this.chatId);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.meetings);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tshowAddButton(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformActionByRole(ActionByRole.createMeeting, this.dialogId);\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tpreparedQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t\tisSearchQueryMinimumSize(): boolean\n\t\t{\n\t\t\treturn this.preparedQuery.length < this.minTokenSize;\n\t\t},\n\t\thasHistoryLimit(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/meetings/isHistoryLimitExceeded'](this.chatId);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tpreparedQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.cleanSearchResult();\n\t\t\tthis.startSearch();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new MeetingMenu({ emitter: this.getEmitter() });\n\t\tthis.service = new Meeting({ dialogId: this.dialogId });\n\t\tthis.serviceSearch = new MeetingSearch({ dialogId: this.dialogId });\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 500, this);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.sidebar');\n\t\t\tthis.minTokenSize = settings.get('minSearchTokenSize', DEFAULT_MIN_TOKEN_SIZE);\n\t\t},\n\t\tsearchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tthis.serviceSearch.searchOnServer(query).then((messageIds: string[]) => {\n\t\t\t\tif (query !== this.preparedQuery)\n\t\t\t\t{\n\t\t\t\t\tthis.isLoading = false;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.searchResult = concatAndSortSearchResult(this.searchResult, messageIds);\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.currentServerQueries--;\n\t\t\t\tthis.stopLoader();\n\t\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t\t{\n\t\t\t\t\tthis.cleanSearchResult();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tstartSearch()\n\t\t{\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(this.preparedQuery);\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.serviceSearch.resetSearchState();\n\t\t\tthis.searchResult = [];\n\t\t},\n\t\tonChangeQuery(query: string)\n\t\t{\n\t\t\tthis.searchQuery = query;\n\t\t},\n\t\ttoggleSearchPanelOpened()\n\t\t{\n\t\t\tthis.isSearchHeaderOpened = !this.isSearchHeaderOpened;\n\t\t},\n\t\tonContextMenuClick(event, target)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\t...event,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, target);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close, { panel: SidebarDetailBlock.meeting });\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst nameGetter = this.searchQuery.length > 0 ? 'sidebar/meetings/hasNextPageSearch' : 'sidebar/meetings/hasNextPage';\n\t\t\tconst hasNextPage = this.$store.getters[nameGetter](this.chatId);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event): Promise<void>\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tawait this.service.loadNextPage();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait this.serviceSearch.request();\n\t\t\t}\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tonAddClick()\n\t\t{\n\t\t\t(new EntityCreator(this.chatId)).createMeetingForChat();\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-meeting-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"loc('IM_SIDEBAR_MEETING_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t:withAddButton=\"showAddButton\"\n\t\t\t\t:isSearchHeaderOpened=\"isSearchHeaderOpened\"\n\t\t\t\t:delayForFocusOnStart=\"0\"\n\t\t\t\twithSearch\n\t\t\t\t@changeQuery=\"onChangeQuery\"\n\t\t\t\t@toggleSearchPanelOpened=\"toggleSearchPanelOpened\"\n\t\t\t\t@addClick=\"onAddClick\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-meeting-detail__container bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-sidebar-meeting-detail__date-group_container\">\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<MeetingItem\n\t\t\t\t\t\tv-for=\"meeting in dateGroup.items\"\n\t\t\t\t\t\t:meeting=\"meeting\"\n\t\t\t\t\t\t:searchQuery=\"searchQuery\"\n\t\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<TariffLimit\n\t\t\t\t\tv-if=\"hasHistoryLimit\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:panel=\"SidebarDetailBlock.meeting\"\n\t\t\t\t\tclass=\"bx-im-sidebar-meeting-detail__tariff-limit-container\"\n\t\t\t\t/>\n\t\t\t\t<template v-if=\"!isLoading\">\n\t\t\t\t\t<template v-if=\"isSearchHeaderOpened\">\n\t\t\t\t\t\t<StartState\n\t\t\t\t\t\t\tv-if=\"preparedQuery.length === 0\"\n\t\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_SEARCH_MESSAGE_START_TITLE')\"\n\t\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<DetailEmptySearchState\n\t\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_EXTENDED')\"\n\t\t\t\t\t\t\t:subTitle=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_DESCRIPTION_EXTENDED')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<DetailEmptyState\n\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MEETINGS_EMPTY')\"\n\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.meeting\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { Utils } from 'im.v2.lib.utils';\nimport { CopilotManager } from 'im.v2.lib.copilot';\n\nimport type { ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const DetailUser = {\n\tname: 'DetailUser',\n\tcomponents: { ChatAvatar, ChatTitle },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tcontextDialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisOwner: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisManager: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): {showContextButton: boolean}\n\t{\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tposition(): string\n\t\t{\n\t\t\tif (this.isCopilot)\n\t\t\t{\n\t\t\t\treturn (new CopilotManager()).getAIModelName(this.contextDialogId);\n\t\t\t}\n\n\t\t\treturn this.$store.getters['users/getPosition'](this.dialogId);\n\t\t},\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.dialogId, true);\n\t\t},\n\t\tuserLink(): string\n\t\t{\n\t\t\treturn Utils.user.getProfileLink(this.dialogId);\n\t\t},\n\t\tneedContextMenu(): boolean\n\t\t{\n\t\t\treturn !this.isAiAssistant && !this.isCopilot;\n\t\t},\n\t\tisCopilot(): boolean\n\t\t{\n\t\t\tconst userId = Number.parseInt(this.dialogId, 10);\n\n\t\t\treturn this.$store.getters['users/bots/isCopilot'](userId);\n\t\t},\n\t\thasLink(): boolean\n\t\t{\n\t\t\treturn !this.isCopilot;\n\t\t},\n\t\tisAiAssistant(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['users/bots/isAiAssistant'](this.dialogId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonClickContextMenu(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tuserDialogId: this.dialogId,\n\t\t\t\ttarget: event.currentTarget,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"bx-im-sidebar-main-detail__user\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div class=\"bx-im-sidebar-main-detail__avatar-container\">\n\t\t\t\t<ChatAvatar \n\t\t\t\t\t:size=\"AvatarSize.L\"\n\t\t\t\t\t:avatarDialogId=\"dialogId\"\n\t\t\t\t\t:contextDialogId=\"contextDialogId\"\n\t\t\t\t/>\n\t\t\t\t<span v-if=\"isOwner\" class=\"bx-im-sidebar-main-detail__avatar-owner-icon\"></span>\n\t\t\t\t<span v-else-if=\"isManager\" class=\"bx-im-sidebar-main-detail__avatar-manager-icon\"></span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-sidebar-main-detail__user-info-container\">\n\t\t\t\t<div class=\"bx-im-sidebar-main-detail__user-title-container\">\n\t\t\t\t\t<a v-if=\"hasLink\" :href=\"userLink\" target=\"_blank\" class=\"bx-im-sidebar-main-detail__user-title-link\">\n\t\t\t\t\t\t<ChatTitle :dialogId=\"dialogId\" :withLeftIcon=\"!isCopilot\" />\n\t\t\t\t\t</a>\n\t\t\t\t\t<div v-else class=\"bx-im-sidebar-main-detail__user-title-link\">\n\t\t\t\t\t\t<ChatTitle :dialogId=\"dialogId\" :withLeftIcon=\"!isCopilot\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"needContextMenu && showContextButton\"\n\t\t\t\t\t\tclass=\"bx-im-sidebar-main-detail__context-menu-icon bx-im-messenger__context-menu-icon\"\n\t\t\t\t\t\t@click=\"onClickContextMenu\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-sidebar-main-detail__position-text\" :title=\"position\">\n\t\t\t\t\t{{ position }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\t\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { UserMenu } from 'im.v2.lib.menu';\nimport { Core } from 'im.v2.application.core';\nimport { Utils } from 'im.v2.lib.utils';\nimport { CallManager } from 'im.v2.lib.call';\nimport { ChatService } from 'im.v2.provider.service.chat';\nimport { ActionByRole, ActionByUserType, UserType } from 'im.v2.const';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { showLeaveChatConfirm } from 'im.v2.lib.confirm';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\nimport type { ImModelUser, ImModelChat } from 'im.v2.model';\nimport type { ApplicationContext } from 'im.v2.const';\n\ntype MembersMenuContext = {\n\tdialog: ImModelChat,\n\tuser: ImModelUser,\n};\n\nexport class MembersMenu extends UserMenu\n{\n\tcontext: MembersMenuContext;\n\tchatService: ChatService;\n\tcallManager: CallManager;\n\tpermissionManager: PermissionManager;\n\n\tconstructor(applicationContext: ApplicationContext)\n\t{\n\t\tsuper(applicationContext);\n\n\t\tthis.chatService = new ChatService();\n\t\tthis.callManager = CallManager.getInstance();\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\tif (this.context.user.id === Core.getUserId())\n\t\t{\n\t\t\treturn [\n\t\t\t\tthis.getProfileItem(),\n\t\t\t\tthis.getOpenUserCalendarItem(),\n\t\t\t\tthis.getLeaveItem(),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tthis.getMentionItem(),\n\t\t\tthis.getSendItem(),\n\t\t\tthis.getManagerItem(),\n\t\t\tthis.getCallItem(),\n\t\t\tthis.getProfileItem(),\n\t\t\tthis.getOpenUserCalendarItem(),\n\t\t\tthis.getKickItem(),\n\t\t];\n\t}\n\n\tgetManagerItem(): ?MenuItemOptions\n\t{\n\t\tconst isOwner = this.context.user.id === this.context.dialog.ownerId;\n\t\tconst canChangeManagers = PermissionManager.getInstance().canPerformActionByRole(\n\t\t\tActionByRole.changeManagers,\n\t\t\tthis.context.dialog.dialogId,\n\t\t);\n\n\t\tif (isOwner || !canChangeManagers)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isManager = this.context.dialog.managerList.includes(this.context.user.id);\n\n\t\treturn {\n\t\t\ttitle: isManager ? Loc.getMessage('IM_SIDEBAR_MENU_MANAGER_REMOVE') : Loc.getMessage('IM_SIDEBAR_MENU_MANAGER_ADD'),\n\t\t\tonClick: () => {\n\t\t\t\tif (isManager)\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.removeManager(this.context.dialog.dialogId, this.context.user.id);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.addManager(this.context.dialog.dialogId, this.context.user.id);\n\t\t\t\t}\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetCallItem(): ?MenuItemOptions\n\t{\n\t\tconst userDialogId = this.context.user.id.toString();\n\n\t\tconst chatCanBeCalled = this.callManager.chatCanBeCalled(userDialogId);\n\t\tconst chatIsAllowedToCall = this.permissionManager.canPerformActionByRole(ActionByRole.call, userDialogId);\n\t\tif (!chatCanBeCalled || !chatIsAllowedToCall)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_CALL_2'),\n\t\t\tonClick: () => {\n\t\t\t\tthis.callManager.startCall(userDialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenUserCalendarItem(): ?MenuItemOptions\n\t{\n\t\tif (this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getCalendarLink(this.context.user.id);\n\t\tconst isCurrentUser = this.context.user.id === Core.getUserId();\n\t\tconst phraseCode = isCurrentUser ? 'IM_LIB_MENU_OPEN_OWN_CALENDAR' : 'IM_LIB_MENU_OPEN_CALENDAR_V2';\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage(phraseCode),\n\t\t\tonClick: () => {\n\t\t\t\tBX.SidePanel.Instance.open(profileUri);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetLeaveItem(): ?MenuItemOptions\n\t{\n\t\tif (this.isCollabChat() && !this.canLeaveCollab())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst canLeaveChat = this.permissionManager.canPerformActionByRole(\n\t\t\tActionByRole.leave,\n\t\t\tthis.context.dialog.dialogId,\n\t\t);\n\t\tif (!canLeaveChat)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_LEAVE_MSGVER_1'),\n\t\t\tonClick: async () => {\n\t\t\t\tthis.menuInstance.close();\n\t\t\t\tconst userChoice = await showLeaveChatConfirm(this.context.dialog.dialogId);\n\t\t\t\tif (!userChoice)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.isCollabChat())\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.leaveCollab(this.context.dialog.dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.chatService.leaveChat(this.context.dialog.dialogId);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tisBot(): boolean\n\t{\n\t\treturn this.context.user.type === UserType.bot;\n\t}\n\n\tcanLeaveCollab(): boolean\n\t{\n\t\treturn this.permissionManager.canPerformActionByUserType(ActionByUserType.leaveCollab);\n\t}\n}\n","import { Analytics } from 'im.v2.lib.analytics';\nimport { ActionByRole, ChatType, EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { AddToChat, AddToCollab } from 'im.v2.component.entity-selector';\nimport { Loader } from 'im.v2.component.elements.loader';\nimport { ChatButton, ButtonColor, ButtonSize } from 'im.v2.component.elements.button';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { Notifier } from 'im.v2.lib.notifier';\nimport { ChatManager } from 'im.v2.lib.chat';\n\nimport { DetailUser } from './detail-user';\nimport { DetailHeader } from '../../elements/detail-header/detail-header';\nimport { MembersService } from '../../../classes/panels/members';\nimport { MembersMenu } from '../../../classes/context-menu/main/members-menu';\n\nimport './css/members-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { BitrixVueComponentProps } from 'ui.vue3';\nimport type { ImModelChat } from 'im.v2.model';\n\nconst MemberTitleByChatType = {\n\t[ChatType.channel]: 'IM_SIDEBAR_MEMBERS_CHANNEL_DETAIL_TITLE',\n\t[ChatType.openChannel]: 'IM_SIDEBAR_MEMBERS_CHANNEL_DETAIL_TITLE',\n\t[ChatType.generalChannel]: 'IM_SIDEBAR_MEMBERS_CHANNEL_DETAIL_TITLE',\n\tdefault: 'IM_SIDEBAR_MEMBERS_DETAIL_TITLE',\n};\n\n// @vue/component\nexport const MembersPanel = {\n\tname: 'MembersPanel',\n\tcomponents: { DetailUser, ChatButton, DetailHeader, Loader, AddToChat },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tshowAddToChatPopup: false,\n\t\t\tshowAddToChatTarget: null,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tuserDialogIds(): string[]\n\t\t{\n\t\t\tconst users = this.$store.getters['sidebar/members/get'](this.chatId);\n\n\t\t\treturn users.map((userId) => userId.toString());\n\t\t},\n\t\thasNextPage(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/members/hasNextPage'](this.chatId);\n\t\t},\n\t\tpanelInited(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/members/getInited'](this.chatId);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\tlet usersInChatCount = this.dialog.userCounter;\n\t\t\tif (usersInChatCount >= 1000)\n\t\t\t{\n\t\t\t\tusersInChatCount = `${Math.floor(usersInChatCount / 1000)}k`;\n\t\t\t}\n\n\t\t\tconst phrase = MemberTitleByChatType[this.dialog.type] ?? MemberTitleByChatType.default;\n\n\t\t\treturn this.loc(phrase, {\n\t\t\t\t'#NUMBER#': usersInChatCount,\n\t\t\t});\n\t\t},\n\t\tneedAddButton(): boolean\n\t\t{\n\t\t\treturn PermissionManager.getInstance().canPerformActionByRole(ActionByRole.extend, this.dialogId);\n\t\t},\n\t\tneedCopyLinkButton(): boolean\n\t\t{\n\t\t\tif (!BX.clipboard.isCopySupported())\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.dialog.type !== ChatType.collab;\n\t\t},\n\t\taddMembersPopupComponent(): BitrixVueComponentProps\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.collab ? AddToCollab : AddToChat;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tdialogId(dialogId: string)\n\t\t{\n\t\t\tthis.service = new MembersService({ dialogId });\n\t\t\tvoid this.loadFirstPage();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenu = new MembersMenu({ emitter: this.getEmitter() });\n\t\tthis.service = new MembersService({ dialogId: this.dialogId });\n\t\tvoid this.loadFirstPage();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t},\n\tmethods:\n\t{\n\t\tasync loadFirstPage()\n\t\t{\n\t\t\tif (this.panelInited || this.isLoading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tthis.chats = await this.service.loadFirstPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tisOwner(userDialogId: string): boolean\n\t\t{\n\t\t\tconst userId = Number.parseInt(userDialogId, 10);\n\n\t\t\treturn this.dialog.ownerId === userId;\n\t\t},\n\t\tisManager(userDialogId: string): boolean\n\t\t{\n\t\t\tconst userId = Number.parseInt(userDialogId, 10);\n\n\t\t\treturn this.dialog.managerList.includes(userId);\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tconst user = this.$store.getters['users/get'](event.userDialogId, true);\n\t\t\tconst item = {\n\t\t\t\tuser,\n\t\t\t\tdialog: this.dialog,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, event.target);\n\t\t},\n\t\tonCopyInviteClick()\n\t\t{\n\t\t\tconst chatLink = ChatManager.buildChatLink(this.dialogId);\n\t\t\tif (BX.clipboard.copy(chatLink))\n\t\t\t{\n\t\t\t\tNotifier.onCopyLinkComplete();\n\t\t\t}\n\n\t\t\tAnalytics.getInstance().chatInviteLink.onCopyMembersPanel(this.dialogId);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close, { panel: SidebarDetailBlock.members });\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\n\t\t\treturn isAtThreshold && this.hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tonAddClick(event)\n\t\t{\n\t\t\tAnalytics.getInstance().userAdd.onChatSidebarClick(this.dialogId);\n\t\t\tthis.showAddToChatPopup = true;\n\t\t\tthis.showAddToChatTarget = event.target;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-main-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"title\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t:withAddButton=\"needAddButton\"\n\t\t\t\t@addClick=\"onAddClick\"\n\t\t\t\t@back=\"onBackClick\" \n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-detail__container bx-im-sidebar-main-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div v-if=\"needCopyLinkButton\" class=\"bx-im-sidebar-main-detail__invitation-button-container\">\n\t\t\t\t\t<ChatButton\n\t\t\t\t\t\t:text=\"loc('IM_SIDEBAR_COPY_INVITE_LINK')\"\n\t\t\t\t\t\t:size=\"ButtonSize.M\"\n\t\t\t\t\t\t:color=\"ButtonColor.PrimaryBorder\"\n\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\ticon=\"link\"\n\t\t\t\t\t\t@click=\"onCopyInviteClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<DetailUser\n\t\t\t\t\tv-for=\"userDialogId in userDialogIds\"\n\t\t\t\t\t:dialogId=\"userDialogId\"\n\t\t\t\t\t:contextDialogId=\"dialogId\"\n\t\t\t\t\t:isOwner=\"isOwner(userDialogId)\"\n\t\t\t\t\t:isManager=\"isManager(userDialogId)\"\n\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t\t<component\n\t\t\t\tv-if=\"showAddToChatPopup\"\n\t\t\t\t:is=\"addMembersPopupComponent\"\n\t\t\t\t:bindElement=\"showAddToChatTarget || {}\"\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:popupConfig=\"{offsetTop: 0, offsetLeft: 0}\"\n\t\t\t\t@close=\"showAddToChatPopup = false\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { MessageService } from 'im.v2.provider.service.message';\n\nimport { SidebarMenu } from '../sidebar-base-menu';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\nimport type { ApplicationContext } from 'im.v2.const';\n\nexport class FavoriteMenu extends SidebarMenu\n{\n\tconstructor(applicationContext: ApplicationContext)\n\t{\n\t\tsuper(applicationContext);\n\n\t\tthis.id = 'im-sidebar-context-menu';\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenContextMessageItem(),\n\t\t\tthis.getDeleteFromFavoriteItem(),\n\t\t];\n\t}\n\n\tgetDeleteFromFavoriteItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_SIDEBAR_MENU_REMOVE_FROM_SAVED_V2'),\n\t\t\tonClick: function() {\n\t\t\t\tconst messageService = new MessageService({ chatId: this.context.chatId });\n\t\t\t\tmessageService.removeMessageFromFavorite(this.context.messageId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t}.bind(this),\n\t\t};\n\t}\n}\n","import { Core } from 'im.v2.application.core';\nimport { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\n\nimport { getChatId } from '../helpers/get-chat-id';\nimport { getLastElementId } from '../helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { RestClient } from 'rest.client';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\ntype RestResponse = {\n\tfiles: [],\n\tlist: [],\n\treactions: [],\n\treminders: [],\n\tusers: [],\n\tusersShort: []\n};\n\ntype UrlGetQueryParams = {\n\tCHAT_ID: number,\n\tLIMIT: number,\n\tSEARCH_MESSAGE?: string,\n\tLAST_ID?: number,\n};\n\nexport class FavoriteSearch\n{\n\tstore: Store;\n\tdialogId: string;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\thasMoreItemsToLoad: boolean = true;\n\t#query: string = '';\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tsearchOnServer(query: string): Promise<number[]>\n\t{\n\t\tif (this.#query !== query)\n\t\t{\n\t\t\tthis.#query = query;\n\t\t\tthis.hasMoreItemsToLoad = true;\n\t\t}\n\n\t\treturn this.request();\n\t}\n\n\tresetSearchState()\n\t{\n\t\tthis.#query = '';\n\t\tthis.hasMoreItemsToLoad = true;\n\t\tvoid this.store.dispatch('sidebar/favorites/clearSearch', {});\n\t}\n\n\tasync request(): Promise<number[]>\n\t{\n\t\tconst queryParams = this.getQueryParams();\n\t\tlet responseData: RestResponse = {};\n\t\ttry\n\t\t{\n\t\t\tconst response = await this.restClient.callMethod(RestMethod.imChatFavoriteGet, queryParams);\n\t\t\tresponseData = response.data();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('SidebarSearch: Im.imChatFavoriteGet: page request error', error);\n\t\t}\n\n\t\treturn this.#processSearchResponse(responseData);\n\t}\n\n\t#processSearchResponse(response: RestResponse): Promise<number[]>\n\t{\n\t\treturn this.updateModels(response).then(() => {\n\t\t\treturn response.list.map((message) => message.messageId);\n\t\t});\n\t}\n\n\tgetQueryParams(): UrlGetQueryParams\n\t{\n\t\tconst queryParams = {\n\t\t\tCHAT_ID: this.chatId,\n\t\t\tLIMIT: REQUEST_ITEMS_LIMIT,\n\t\t\tSEARCH_MESSAGE: this.#query,\n\t\t};\n\n\t\tconst lastId = this.store.getters['sidebar/favorites/getSearchResultCollectionLastId'](this.chatId);\n\t\tif (lastId > 0)\n\t\t{\n\t\t\tqueryParams.LAST_ID = lastId;\n\t\t}\n\n\t\treturn queryParams;\n\t}\n\n\tupdateModels(resultData: {list: [], users: [], files: []}): Promise\n\t{\n\t\tconst { list = [], users = [], files = [], tariffRestrictions = {} } = resultData;\n\t\tconst addUsersPromise = this.userManager.setUsersToModel(users);\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\n\t\tconst rawMessages = list.map((favorite) => favorite.message);\n\t\tconst hasNextPage = list.length === REQUEST_ITEMS_LIMIT;\n\t\tconst lastId = getLastElementId(list);\n\n\t\tconst setFilesPromise = this.store.dispatch('files/set', files);\n\t\tconst storeMessagesPromise = this.store.dispatch('messages/store', rawMessages);\n\t\tconst setFavoritesPromise = this.store.dispatch('sidebar/favorites/setSearch', {\n\t\t\tchatId: this.chatId,\n\t\t\tfavorites: list,\n\t\t\thasNextPage,\n\t\t\tlastId,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\n\t\treturn Promise.all([\n\t\t\tsetFilesPromise, storeMessagesPromise, setFavoritesPromise, addUsersPromise,\n\t\t]);\n\t}\n}\n","import { Text } from 'main.core';\n\nimport { EventType } from 'im.v2.const';\nimport { Parser } from 'im.v2.lib.parser';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\nimport { MessageAuthorTitle } from 'im.v2.component.elements.chat-title';\nimport { MessageAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport './css/favorite-item.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelSidebarFavoriteItem, ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const FavoriteItem = {\n\tname: 'FavoriteItem',\n\tcomponents: { MessageAvatar, MessageAuthorTitle },\n\tprops:\n\t{\n\t\tfavorite: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tchatId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsearchQuery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['contextMenuClick'],\n\tdata(): { showContextButton: boolean } {\n\t\treturn {\n\t\t\tshowContextButton: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tfavoriteItem(): ImModelSidebarFavoriteItem\n\t\t{\n\t\t\treturn this.favorite;\n\t\t},\n\t\tfavoriteMessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.favoriteItem.messageId);\n\t\t},\n\t\tauthorDialogId(): string\n\t\t{\n\t\t\treturn this.favoriteMessage.authorId.toString();\n\t\t},\n\t\tmessageText(): string\n\t\t{\n\t\t\tconst purifiedMessage = Parser.purifyMessage(this.favoriteMessage);\n\t\t\tconst textToShow = Text.encode(purifiedMessage);\n\n\t\t\tif (this.searchQuery.length === 0)\n\t\t\t{\n\t\t\t\treturn textToShow;\n\t\t\t}\n\n\t\t\treturn highlightText(textToShow, this.searchQuery);\n\t\t},\n\t\tisCopilot(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['users/bots/isCopilot'](this.favoriteMessage.authorId);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tthis.$emit('contextMenuClick', {\n\t\t\t\tid: this.favoriteItem.id,\n\t\t\t\tmessageId: this.favorite.messageId,\n\t\t\t\ttarget: event.currentTarget,\n\t\t\t});\n\t\t},\n\t\tonItemClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.dialog.goToMessageContext, {\n\t\t\t\tmessageId: this.favorite.messageId,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-favorite-item__container bx-im-favorite-item__scope\" \n\t\t\t@click.stop=\"onItemClick\"\n\t\t\t@mouseover=\"showContextButton = true\"\n\t\t\t@mouseleave=\"showContextButton = false\"\n\t\t>\n\t\t\t<div class=\"bx-im-favorite-item__header-container\">\n\t\t\t\t<div class=\"bx-im-favorite-item__author-container\">\n\t\t\t\t\t<MessageAvatar\n\t\t\t\t\t\t:messageId=\"favoriteItem.messageId\"\n\t\t\t\t\t\t:authorId=\"authorDialogId\"\n\t\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t\t\tclass=\"bx-im-favorite-item__author-avatar\"\n\t\t\t\t\t/>\n\t\t\t\t\t<MessageAuthorTitle \n\t\t\t\t\t\t:dialogId=\"authorDialogId\"\n\t\t\t\t\t\t:messageId=\"favoriteItem.messageId\"\n\t\t\t\t\t\t:withLeftIcon=\"!isCopilot\"\n\t\t\t\t\t\t:showItsYou=\"false\" \n\t\t\t\t\t\tclass=\"bx-im-favorite-item__author-text\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<button \n\t\t\t\t\tv-if=\"showContextButton\"\n\t\t\t\t\tclass=\"bx-im-messenger__context-menu-icon\"\n\t\t\t\t\t@click.stop=\"onContextMenuClick\"\n\t\t\t\t></button>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-favorite-item__message-text\" v-html=\"messageText\"></div>\n\t\t</div>\n\t`,\n};\n","import { Runtime, Extension } from 'main.core';\n\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements.loader';\n\nimport { FavoriteMenu } from '../../../classes/context-menu/favorite/favorite-menu';\nimport { Favorite } from '../../../classes/panels/favorite';\nimport { FavoriteSearch } from '../../../classes/panels/search/favorite-search';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\nimport { DetailHeader } from '../../elements/detail-header/detail-header';\nimport { TariffLimit } from '../../elements/tariff-limit/tariff-limit';\nimport { FavoriteItem } from './favorite-item';\nimport { DateGroup } from '../../elements/date-group/date-group';\nimport { DetailEmptySearchState } from '../../elements/detail-empty-search-state/detail-empty-search-state';\nimport { DetailEmptyState as StartState, DetailEmptyState } from '../../elements/detail-empty-state/detail-empty-state';\n\nimport './css/favorite-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelSidebarFavoriteItem, ImModelChat } from 'im.v2.model';\n\nconst DEFAULT_MIN_TOKEN_SIZE = 3;\n\n// @vue/component\nexport const FavoritePanel = {\n\tname: 'FavoritePanel',\n\tcomponents: {\n\t\tFavoriteItem,\n\t\tDateGroup,\n\t\tStartState,\n\t\tDetailEmptyState,\n\t\tDetailHeader,\n\t\tDetailEmptySearchState,\n\t\tLoader,\n\t\tTariffLimit,\n\t},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tisSearchHeaderOpened: false,\n\t\t\tsearchQuery: '',\n\t\t\tsearchResult: [],\n\t\t\tcurrentServerQueries: 0,\n\t\t\tminTokenSize: DEFAULT_MIN_TOKEN_SIZE,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tfavorites(): ImModelSidebarFavoriteItem[]\n\t\t{\n\t\t\tif (this.isSearchHeaderOpened)\n\t\t\t{\n\t\t\t\treturn this.$store.getters['sidebar/favorites/getSearchResultCollection'](this.chatId);\n\t\t\t}\n\n\t\t\treturn this.$store.getters['sidebar/favorites/get'](this.chatId);\n\t\t},\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\treturn this.collectionFormatter.format(this.favorites);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.formattedCollection.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\tpreparedQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t\tisSearchQueryMinimumSize(): boolean\n\t\t{\n\t\t\treturn this.preparedQuery.length < this.minTokenSize;\n\t\t},\n\t\thasHistoryLimit(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/favorites/isHistoryLimitExceeded'](this.chatId);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tpreparedQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.cleanSearchResult();\n\t\t\tthis.startSearch();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.initSettings();\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.contextMenu = new FavoriteMenu({ emitter: this.getEmitter() });\n\t\tthis.service = new Favorite({ dialogId: this.dialogId });\n\t\tthis.serviceSearch = new FavoriteSearch({ dialogId: this.dialogId });\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 500, this);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenu.destroy();\n\t\tthis.collectionFormatter.destroy();\n\t},\n\tmethods:\n\t{\n\t\tinitSettings()\n\t\t{\n\t\t\tconst settings = Extension.getSettings('im.v2.component.sidebar');\n\t\t\tthis.minTokenSize = settings.get('minSearchTokenSize', DEFAULT_MIN_TOKEN_SIZE);\n\t\t},\n\t\tsearchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tthis.serviceSearch.searchOnServer(query).then(() => {\n\t\t\t\tif (query !== this.preparedQuery)\n\t\t\t\t{\n\t\t\t\t\tthis.isLoading = false;\n\t\t\t\t}\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.currentServerQueries--;\n\t\t\t\tthis.stopLoader();\n\t\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t\t{\n\t\t\t\t\tthis.cleanSearchResult();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tstartSearch()\n\t\t{\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(this.preparedQuery);\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.searchResult = [];\n\t\t\tthis.serviceSearch.resetSearchState();\n\t\t},\n\t\tonChangeQuery(query: string)\n\t\t{\n\t\t\tthis.searchQuery = query;\n\t\t},\n\t\ttoggleSearchPanelOpened()\n\t\t{\n\t\t\tthis.isSearchHeaderOpened = !this.isSearchHeaderOpened;\n\t\t},\n\t\tonContextMenuClick(event)\n\t\t{\n\t\t\tconst item = {\n\t\t\t\tid: event.id,\n\t\t\t\tmessageId: event.messageId,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tchatId: this.chatId,\n\t\t\t};\n\n\t\t\tthis.contextMenu.openMenu(item, event.target);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close, { panel: SidebarDetailBlock.favorite });\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst nameGetter = this.searchQuery.length > 0 ? 'sidebar/favorites/hasNextPageSearch' : 'sidebar/favorites/hasNextPage';\n\t\t\tconst hasNextPage = this.$store.getters[nameGetter](this.chatId);\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tthis.contextMenu.destroy();\n\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tif (this.isSearchQueryMinimumSize)\n\t\t\t{\n\t\t\t\tawait this.service.loadNextPage();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait this.serviceSearch.request();\n\t\t\t}\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-favorite-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"loc('IM_SIDEBAR_FAVORITE_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t:isSearchHeaderOpened=\"isSearchHeaderOpened\"\n\t\t\t\t:delayForFocusOnStart=\"0\"\n\t\t\t\t@changeQuery=\"onChangeQuery\"\n\t\t\t\t@toggleSearchPanelOpened=\"toggleSearchPanelOpened\"\n\t\t\t\twithSearch\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div class=\"bx-im-sidebar-favorite-detail__container bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"dateGroup in formattedCollection\"\n\t\t\t\t\tclass=\"bx-im-sidebar-favorite-detail__date-group_container\"\n\t\t\t\t>\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<FavoriteItem\n\t\t\t\t\t\tv-for=\"favorite in dateGroup.items\"\n\t\t\t\t\t\t:favorite=\"favorite\"\n\t\t\t\t\t\t:chatId=\"chatId\"\n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t:searchQuery=\"searchQuery\"\n\t\t\t\t\t\t@contextMenuClick=\"onContextMenuClick\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<TariffLimit\n\t\t\t\t\tv-if=\"hasHistoryLimit\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:panel=\"SidebarDetailBlock.favorite\"\n\t\t\t\t\tclass=\"bx-im-sidebar-favorite-detail__tariff-limit-container\"\n\t\t\t\t/>\n\t\t\t\t<template v-if=\"!isLoading\">\n\t\t\t\t\t<template v-if=\"isSearchHeaderOpened\">\n\t\t\t\t\t\t<StartState\n\t\t\t\t\t\t\tv-if=\"preparedQuery.length === 0\"\n\t\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_SEARCH_MESSAGE_START_TITLE')\"\n\t\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<DetailEmptySearchState\n\t\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_EXTENDED')\"\n\t\t\t\t\t\t\t:subTitle=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_DESCRIPTION_EXTENDED')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<DetailEmptyState\n\t\t\t\t\t\tv-else-if=\"isEmptyState\"\n\t\t\t\t\t\t:title=\"loc('IM_SIDEBAR_FAVORITES_EMPTY')\"\n\t\t\t\t\t\t:iconType=\"SidebarDetailBlock.favorite\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport { getChatId } from '../helpers/get-chat-id';\nimport { getLastElementId } from '../helpers/get-last-element-id';\n\nimport type { Store } from 'ui.vue3.vuex';\nimport type { RestClient } from 'rest.client';\n\ntype RestResponse = {\n\tadditionalMessages: [],\n\tfiles: [],\n\tmessages: [],\n\treactions: [],\n\treminders: [],\n\tusers: [],\n\tusersShort: []\n};\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\nexport class MessageSearch\n{\n\tstore: Store;\n\tdialogId: string;\n\tchatId: number;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\t// eslint-disable-next-line no-unused-private-class-members\n\thasMoreItemsToLoad: boolean = true;\n\t#lastMessageId: number = 0;\n\t#query: string = '';\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.chatId = getChatId(dialogId);\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tsearchOnServer(query: string): Promise<string[]>\n\t{\n\t\tif (this.#query !== query)\n\t\t{\n\t\t\tthis.#query = query;\n\t\t\tthis.hasMoreItemsToLoad = true;\n\t\t\tthis.#lastMessageId = 0;\n\t\t}\n\n\t\treturn this.#request();\n\t}\n\n\tloadNextPage(): Promise<string[]>\n\t{\n\t\treturn this.#request();\n\t}\n\n\t#request(): Promise<string[]>\n\t{\n\t\tconst config = {\n\t\t\tSEARCH_MESSAGE: this.#query,\n\t\t\tCHAT_ID: this.chatId,\n\t\t};\n\n\t\tif (this.#lastMessageId > 0)\n\t\t{\n\t\t\tconfig.LAST_ID = this.#lastMessageId;\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.restClient.callMethod(RestMethod.imDialogMessagesSearch, config).then((response) => {\n\t\t\t\tconst responseData: RestResponse = response.data();\n\t\t\t\tresolve(this.#processSearchResponse(responseData));\n\t\t\t}).catch((error) => reject(error));\n\t\t});\n\t}\n\n\tloadFirstPage(): Promise\n\t{\n\t\treturn Promise.resolve();\n\t}\n\n\tresetSearchState()\n\t{\n\t\tthis.#lastMessageId = 0;\n\t\tthis.#query = '';\n\t\tthis.hasMoreItemsToLoad = true;\n\t}\n\n\t#processSearchResponse(response: RestResponse): Promise<string[]>\n\t{\n\t\tthis.#lastMessageId = getLastElementId(response.messages);\n\t\tif (response.messages.length < REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\tthis.hasMoreItemsToLoad = false;\n\t\t}\n\n\t\treturn this.#updateModels(response).then(() => {\n\t\t\treturn response.messages.map((message) => message.id);\n\t\t});\n\t}\n\n\t#updateModels(rawData: RestResponse): Promise\n\t{\n\t\tconst {\n\t\t\tfiles,\n\t\t\tusers,\n\t\t\tusersShort,\n\t\t\treactions,\n\t\t\tadditionalMessages,\n\t\t\tmessages,\n\t\t\ttariffRestrictions = {},\n\t\t} = rawData;\n\n\t\tconst isHistoryLimitExceeded = Boolean(tariffRestrictions.isHistoryLimitExceeded);\n\t\tconst historyLimitPromise = this.store.dispatch('sidebar/messageSearch/setHistoryLimitExceeded', {\n\t\t\tchatId: this.chatId,\n\t\t\tisHistoryLimitExceeded,\n\t\t});\n\t\tconst usersPromise = Promise.all([\n\t\t\tthis.userManager.setUsersToModel(users),\n\t\t\tthis.userManager.addUsersToModel(usersShort),\n\t\t]);\n\t\tconst filesPromise = this.store.dispatch('files/set', files);\n\t\tconst reactionsPromise = this.store.dispatch('messages/reactions/set', reactions);\n\t\tconst additionalMessagesPromise = this.store.dispatch('messages/store', additionalMessages);\n\t\tconst messagesPromise = this.store.dispatch('messages/store', messages);\n\n\t\treturn Promise.all([\n\t\t\tfilesPromise, usersPromise, reactionsPromise, additionalMessagesPromise, messagesPromise, historyLimitPromise,\n\t\t]);\n\t}\n}\n","import { Text } from 'main.core';\n\nimport { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { EventType } from 'im.v2.const';\nimport { Parser } from 'im.v2.lib.parser';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\n\nimport './css/search-item.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelMessage } from 'im.v2.model';\n\n// @vue/component\nexport const SearchItem = {\n\tname: 'SearchItem',\n\tcomponents: { ChatAvatar, ChatTitle },\n\tprops:\n\t{\n\t\tmessageId: {\n\t\t\ttype: [String, Number],\n\t\t\trequired: true,\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tmessage(): ImModelMessage\n\t\t{\n\t\t\treturn this.$store.getters['messages/getById'](this.messageId);\n\t\t},\n\t\tauthorDialogId(): string\n\t\t{\n\t\t\treturn this.message.authorId.toString();\n\t\t},\n\t\tisSystem(): boolean\n\t\t{\n\t\t\treturn this.message.authorId === 0;\n\t\t},\n\t\tmessageText(): string\n\t\t{\n\t\t\tconst purifiedMessage = Parser.purifyMessage(this.message);\n\n\t\t\treturn highlightText(Text.encode(purifiedMessage), this.query);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonItemClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.dialog.goToMessageContext, {\n\t\t\t\tmessageId: this.messageId,\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t});\n\t\t},\n\t\tonMessageBodyClick(event)\n\t\t{\n\t\t\tif (event.target.tagName === 'A')\n\t\t\t{\n\t\t\t\tevent.stopPropagation();\n\t\t\t}\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-message-search-item__container bx-im-message-search-item__scope\" \n\t\t\t@click.stop=\"onItemClick\"\n\t\t>\n\t\t\t<div class=\"bx-im-message-search-item__header-container\">\n\t\t\t\t<div class=\"bx-im-message-search-item__author-container\">\n\t\t\t\t\t<template v-if=\"!isSystem\">\n\t\t\t\t\t\t<ChatAvatar\n\t\t\t\t\t\t\t:size=\"AvatarSize.XS\"\n\t\t\t\t\t\t\t:avatarDialogId=\"authorDialogId\"\n\t\t\t\t\t\t\tclass=\"bx-im-message-search-item__author-avatar\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ChatTitle \n\t\t\t\t\t\t\t:dialogId=\"authorDialogId\" \n\t\t\t\t\t\t\t:showItsYou=\"false\" \n\t\t\t\t\t\t\tclass=\"bx-im-message-search-item__author-text\" \n\t\t\t\t\t\t/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<span class=\"bx-im-message-search-item__system-author\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('IM_SIDEBAR_SYSTEM_MESSAGE') }}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-message-search-item__message-text\" v-html=\"messageText\" @click=\"onMessageBodyClick\"></div>\n\t\t</div>\n\t`,\n};\n","import { SearchInput } from 'im.v2.component.elements.search-input';\n\nimport './css/search-header.css';\n\n// @vue/component\nexport const SearchHeader = {\n\tname: 'SearchHeader',\n\tcomponents: { SearchInput },\n\tprops:\n\t{\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['back', 'changeQuery'],\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-search-header__container bx-im-sidebar-search-header__scope\">\n\t\t\t<div class=\"bx-im-sidebar-search-header__title-container\">\n\t\t\t\t<button\n\t\t\t\t\t:class=\"{'bx-im-messenger__cross-icon': !secondLevel, 'bx-im-sidebar__back-icon': secondLevel}\"\n\t\t\t\t\t@click=\"$emit('back')\"\n\t\t\t\t></button>\n\t\t\t\t<SearchInput\n\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('IM_SIDEBAR_SEARCH_MESSAGE_PLACEHOLDER')\"\n\t\t\t\t\t:withIcon=\"false\"\n\t\t\t\t\t:delayForFocusOnStart=\"300\"\n\t\t\t\t\t@queryChange=\"$emit('changeQuery', $event)\"\n\t\t\t\t\t@closeByEsc=\"$emit('back')\"\n\t\t\t\t\tclass=\"bx-im-sidebar-search-header__input\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Runtime } from 'main.core';\n\nimport { Logger } from 'im.v2.lib.logger';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements.loader';\n\nimport { MessageSearch } from '../../../classes/panels/search/message-search';\nimport { SearchItem } from './search-item';\nimport { SearchHeader } from './search-header';\nimport { DateGroup } from '../../elements/date-group/date-group';\nimport { TariffLimit } from '../../elements/tariff-limit/tariff-limit';\nimport { DetailEmptyState as StartState } from '../../elements/detail-empty-state/detail-empty-state';\nimport { DetailEmptySearchState } from '../../elements/detail-empty-search-state/detail-empty-search-state';\nimport { SidebarCollectionFormatter } from '../../../classes/sidebar-collection-formatter';\n\nimport './css/message-search-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const MessageSearchPanel = {\n\tname: 'MessageSearchPanel',\n\tcomponents: { DateGroup, SearchItem, Loader, StartState, SearchHeader, DetailEmptySearchState, TariffLimit },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tsearchQuery: '',\n\t\t\tisLoading: false,\n\t\t\tsearchResult: [],\n\t\t\tcurrentServerQueries: 0,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tformattedCollection(): Array\n\t\t{\n\t\t\tconst messages = this.searchResult.map((messageId) => {\n\t\t\t\treturn this.$store.getters['messages/getById'](messageId);\n\t\t\t}).filter((item) => Boolean(item));\n\n\t\t\treturn this.collectionFormatter.format(messages);\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.preparedQuery.length > 0 && this.formattedCollection.length === 0;\n\t\t},\n\t\tpreparedQuery(): string\n\t\t{\n\t\t\treturn this.searchQuery.trim().toLowerCase();\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t\thasHistoryLimit(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/messageSearch/isHistoryLimitExceeded'](this.chatId);\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tpreparedQuery(newQuery: string, previousQuery: string)\n\t\t{\n\t\t\tif (newQuery === previousQuery)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.service.resetSearchState();\n\t\t\tthis.searchResult = [];\n\t\t\tthis.startSearch(newQuery);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new MessageSearch({ dialogId: this.dialogId });\n\t\tthis.collectionFormatter = new SidebarCollectionFormatter();\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 500, this);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.collectionFormatter.destroy();\n\t},\n\tmethods:\n\t{\n\t\tsearchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tthis.service.searchOnServer(query).then((messageIds: string[]) => {\n\t\t\t\tif (query !== this.preparedQuery)\n\t\t\t\t{\n\t\t\t\t\tthis.isLoading = false;\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.searchResult = this.mergeResult(messageIds);\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error(error);\n\t\t\t}).finally(() => {\n\t\t\t\tthis.currentServerQueries--;\n\t\t\t\tthis.stopLoader();\n\t\t\t});\n\t\t},\n\t\tstartSearch(query: string)\n\t\t{\n\t\t\tif (query.length < 3)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (query.length >= 3)\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(query);\n\t\t\t}\n\n\t\t\tif (query.length === 0)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.searchResult = [];\n\t\t},\n\t\tneedToLoadNextPage(event)\n\t\t{\n\t\t\tconst target = event.target;\n\n\t\t\treturn target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t},\n\t\tonScroll(event)\n\t\t{\n\t\t\tif (this.isLoading || this.preparedQuery.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.needToLoadNextPage(event) || !this.service.hasMoreItemsToLoad)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tthis.service.loadNextPage().then((messageIds) => {\n\t\t\t\tthis.searchResult = this.mergeResult(messageIds);\n\t\t\t\tthis.isLoading = false;\n\t\t\t}).catch((error) => {\n\t\t\t\tLogger.warn('Message Search: loadNextPage error', error);\n\t\t\t});\n\t\t},\n\t\tmergeResult(messageIds: string[]): string[]\n\t\t{\n\t\t\treturn [...this.searchResult, ...messageIds].sort((a, z) => z - a);\n\t\t},\n\t\tonChangeQuery(query: string)\n\t\t{\n\t\t\tthis.searchQuery = query;\n\t\t},\n\t\tonClickBack()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close, { panel: SidebarDetailBlock.messageSearch });\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-message-search-detail__scope\">\n\t\t\t<SearchHeader :secondLevel=\"secondLevel\" @changeQuery=\"onChangeQuery\" @back=\"onClickBack\" />\n\t\t\t<div class=\"bx-im-message-search-detail__container bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<StartState \n\t\t\t\t\tv-if=\"!isLoading && preparedQuery.length === 0\"\n\t\t\t\t\t:title=\"loc('IM_SIDEBAR_SEARCH_MESSAGE_START_TITLE')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t/>\n\t\t\t\t<DetailEmptySearchState\n\t\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t\t:title=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND')\"\n\t\t\t\t\t:subTitle=\"loc('IM_SIDEBAR_MESSAGE_SEARCH_NOT_FOUND_DESCRIPTION')\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading && isEmptyState\" class=\"bx-im-message-search-detail__loader\" />\n\t\t\t\t<div v-for=\"dateGroup in formattedCollection\" class=\"bx-im-message-search-detail__date-group_container\">\n\t\t\t\t\t<DateGroup :dateText=\"dateGroup.dateGroupTitle\" />\n\t\t\t\t\t<SearchItem\n\t\t\t\t\t\tv-for=\"item in dateGroup.items\"\n\t\t\t\t\t\t:messageId=\"item.id\"\n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t:query=\"preparedQuery\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<TariffLimit\n\t\t\t\t\tv-if=\"hasHistoryLimit\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:panel=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t\tclass=\"bx-im-message-search-detail__tariff-limit-container\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nimport { ChatType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\nimport { ChatTitle } from 'im.v2.component.elements.chat-title';\nimport { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\n\nimport './css/chat-item.css';\n\nimport type { ImModelChat } from 'im.v2.model';\n\nconst ItemTextByChatType = {\n\t[ChatType.channel]: Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_CHANNEL'),\n\t[ChatType.openChannel]: Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_CHANNEL'),\n\t[ChatType.generalChannel]: Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_CHANNEL'),\n\t[ChatType.collab]: Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_COLLAB'),\n\tdefault: Loc.getMessage('IM_SIDEBAR_CHAT_TYPE_GROUP_V2'),\n};\n\n// @vue/component\nexport const ChatItem = {\n\tname: 'ChatItem',\n\tcomponents: { ChatAvatar, ChatTitle },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdateMessage: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatItemText(): string\n\t\t{\n\t\t\treturn ItemTextByChatType[this.dialog.type] ?? ItemTextByChatType.default;\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\tif (!this.dateMessage)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tconst date = Utils.date.cast(this.dateMessage);\n\n\t\t\treturn this.formatDate(date);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tformatDate(date: Date): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\t@click=\"onClick\"\n\t\t\tclass=\"bx-im-chat-with-user-item__container bx-im-chat-with-user-item__scope\"\n\t\t>\n\t\t\t<div class=\"bx-im-chat-with-user-item__avatar-container\">\n\t\t\t\t<ChatAvatar :avatarDialogId=\"dialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-chat-with-user-item__content-container\">\n\t\t\t\t<div class=\"bx-im-chat-with-user-item__content_header\">\n\t\t\t\t\t<ChatTitle :dialogId=\"dialogId\" />\n\t\t\t\t\t<div v-if=\"formattedDate.length > 0\" class=\"bx-im-chat-with-user-item__date\">\n\t\t\t\t\t\t<span>{{ formattedDate }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"bx-im-chat-with-user-item__item-text\" :title=\"chatItemText\">\n\t\t\t\t\t{{ chatItemText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { RestMethod } from 'im.v2.const';\nimport { UserManager } from 'im.v2.lib.user';\nimport { Core } from 'im.v2.application.core';\n\nimport type { RestClient } from 'rest.client';\nimport type { Store } from 'ui.vue3.vuex';\n\nconst REQUEST_ITEMS_LIMIT = 50;\n\ntype RequestParams = {\n\tfilter: {\n\t\tuserId: number,\n\t},\n\tlimit: number,\n\toffset?: number,\n};\n\ntype RawChatItem = {\n\tavatar: string,\n\tcolor: string,\n\tdescription: string,\n\tdialogId: string,\n\tdiskFolderId: number,\n\tentityData1: string,\n\tentityData2: string,\n\tentityData3: string,\n\tentityId: string,\n\tentityType: string,\n\textranet: boolean,\n\tid: number,\n\tname: string,\n\towner: number,\n\tmessageType: string,\n\trole: string,\n\ttype: string,\n\tmanageUsers: string,\n\tmanageUi: string,\n\tmanageSettings: string,\n\tmanageMessages: string,\n\tdateMessage: string,\n}\n\ntype ChatItem = {\n\tdialogId: string,\n\tdateMessage: string,\n}\n\nexport class ChatsWithUser\n{\n\thasMoreItemsToLoad: boolean = true;\n\t#chatsCount: number = 0;\n\n\tstore: Store;\n\tdialogId: string;\n\tuserManager: UserManager;\n\trestClient: RestClient;\n\n\tconstructor({ dialogId }: {dialogId: string})\n\t{\n\t\tthis.store = Core.getStore();\n\t\tthis.restClient = Core.getRestClient();\n\t\tthis.dialogId = dialogId;\n\t\tthis.userManager = new UserManager();\n\t}\n\n\tloadFirstPage(): Promise<ChatItem[]>\n\t{\n\t\treturn this.#requestPage();\n\t}\n\n\tloadNextPage(): Promise<ChatItem[]>\n\t{\n\t\treturn this.#requestPage();\n\t}\n\n\t#getRequestParams(): RequestParams\n\t{\n\t\tconst userId = Number.parseInt(this.dialogId, 10);\n\n\t\tconst requestParams = {\n\t\t\tfilter: { userId },\n\t\t\tlimit: REQUEST_ITEMS_LIMIT,\n\t\t};\n\n\t\tif (this.#chatsCount > 0)\n\t\t{\n\t\t\trequestParams.offset = this.#chatsCount;\n\t\t}\n\n\t\treturn requestParams;\n\t}\n\n\tasync #requestPage(): Promise<ChatItem[]>\n\t{\n\t\tconst requestParams = this.#getRequestParams();\n\t\tconst response = await this.restClient.callMethod(RestMethod.imV2ChatListShared, requestParams);\n\n\t\treturn this.#handleResponse(response.data());\n\t}\n\n\tasync #handleResponse(response): Promise<ChatItem[]>\n\t{\n\t\tconst { chats }: { chats: RawChatItem[] } = response;\n\t\tthis.#chatsCount += chats.length;\n\t\tif (chats.length < REQUEST_ITEMS_LIMIT)\n\t\t{\n\t\t\tthis.hasMoreItemsToLoad = false;\n\t\t}\n\n\t\tawait this.#updateModels(chats);\n\n\t\treturn chats.map((chat: RawChatItem) => {\n\t\t\treturn {\n\t\t\t\tdialogId: chat.dialogId,\n\t\t\t\tdateMessage: chat.dateMessage,\n\t\t\t};\n\t\t});\n\t}\n\n\t#updateModels(chats: RawChatItem[]): Promise\n\t{\n\t\treturn this.#setDialoguesPromise(chats);\n\t}\n\n\t#setDialoguesPromise(chats: RawChatItem[]): Promise\n\t{\n\t\treturn this.store.dispatch('chats/set', chats);\n\t}\n}\n","import { Messenger } from 'im.public';\nimport { Loader } from 'im.v2.component.elements.loader';\nimport { EventType, SidebarDetailBlock } from 'im.v2.const';\n\nimport { ChatItem } from './chat-item';\nimport { DetailHeader } from '../../elements/detail-header/detail-header';\nimport { DetailEmptyState } from '../../elements/detail-empty-state/detail-empty-state';\nimport { ChatsWithUser } from '../../../classes/panels/chats-with-user';\n\nimport './css/chats-with-user-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelChat } from 'im.v2.model';\n\n// @vue/component\nexport const ChatsWithUserPanel = {\n\tname: 'ChatsWithUserPanel',\n\tcomponents: { DetailHeader, ChatItem, DetailEmptyState, Loader },\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tchats: [],\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn !this.isLoading && this.chats.length === 0;\n\t\t},\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tchatId(): number\n\t\t{\n\t\t\treturn this.dialog.chatId;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\tdialogId()\n\t\t{\n\t\t\tthis.chats = [];\n\t\t\tthis.service = new ChatsWithUser({ dialogId: this.dialogId });\n\t\t\tvoid this.loadFirstPage();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new ChatsWithUser({ dialogId: this.dialogId });\n\t\tvoid this.loadFirstPage();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tconst { dialogId } = event;\n\n\t\t\tvoid Messenger.openChat(dialogId);\n\t\t},\n\t\tasync loadFirstPage()\n\t\t{\n\t\t\tthis.isLoading = true;\n\t\t\tthis.chats = await this.service.loadFirstPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tneedToLoadNextPage(event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\n\t\t\treturn target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t},\n\t\tasync onScroll(event)\n\t\t{\n\t\t\tif (this.isLoading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.needToLoadNextPage(event) || !this.service.hasMoreItemsToLoad)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tconst nextPageChats = await this.service.loadNextPage();\n\t\t\tthis.chats = [...this.chats, ...nextPageChats];\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close, { panel: SidebarDetailBlock.chatsWithUser });\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(phrase: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phrase);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-chats-with-user-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"loc('IM_SIDEBAR_SHARED_CHAT_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t/>\n\t\t\t<div \n\t\t\t\tclass=\"bx-im-sidebar-chats-with-user-detail__container\" \n\t\t\t\t@scroll=\"onScroll\"\n\t\t\t>\n\t\t\t\t<ChatItem\n\t\t\t\t\tv-for=\"chat in chats\"\n\t\t\t\t\t:dialogId=\"chat.dialogId\"\n\t\t\t\t\t:dateMessage=\"chat.dateMessage\"\n\t\t\t\t\t@clickItem=\"onClick\"\n\t\t\t\t/>\n\t\t\t\t<DetailEmptyState\n\t\t\t\t\tv-if=\"!isLoading && isEmptyState\"\n\t\t\t\t\t:title=\"loc('IM_SIDEBAR_CHATS_WITH_USER_EMPTY')\"\n\t\t\t\t\t:iconType=\"SidebarDetailBlock.messageSearch\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-chats-with-user-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\n\nimport './css/multidialog-item.css';\n\nimport type { ImModelChat, ImModelSidebarMultidialogItem } from 'im.v2.model';\n\n// @vue/component\nexport const MultidialogItem = {\n\tname: 'MultidialogItem',\n\tprops:\n\t{\n\t\titem: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tmultidialogItem(): ImModelSidebarMultidialogItem\n\t\t{\n\t\t\treturn this.item;\n\t\t},\n\t\tdialogId(): string\n\t\t{\n\t\t\treturn this.multidialogItem.dialogId;\n\t\t},\n\t\tchatId(): string\n\t\t{\n\t\t\treturn this.multidialogItem.chatId;\n\t\t},\n\t\ttitle(): string\n\t\t{\n\t\t\tconst chat: ImModelChat = this.$store.getters['chats/get'](this.dialogId);\n\n\t\t\treturn chat.name;\n\t\t},\n\t\tstatus(): string\n\t\t{\n\t\t\treturn this.multidialogItem.status;\n\t\t},\n\t\ttransferredStatus(): string\n\t\t{\n\t\t\tconst code = `IM_SIDEBAR_SUPPORT_TICKET_STATUS_${this.status.toUpperCase()}`;\n\n\t\t\treturn this.loc(code);\n\t\t},\n\t\tcontainerClasses(): string[]\n\t\t{\n\t\t\tconst status = `--${this.status}`;\n\t\t\tconst chatIsOpened = this.$store.getters['application/isChatOpen'](this.dialogId);\n\n\t\t\treturn [status, { '--selected': chatIsOpened }];\n\t\t},\n\t\tcounter(): number\n\t\t{\n\t\t\tconst counter = this.$store.getters['counters/getChatCounterByChatId'](this.chatId) ?? 0;\n\n\t\t\treturn counter > 99 ? '99+' : counter;\n\t\t},\n\t\tformatDate(): string\n\t\t{\n\t\t\tconst date = this.multidialogItem.date;\n\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"bx-im-multidialog-item__container bx-im-sidebar-multidialog-preview__scope\"\n\t\t \t:class=\"containerClasses\"\n\t\t\t:title=\"title\"\n\t\t>\n\t\t\t<span class=\"bx-im-multidialog-item__title\">{{ title }}</span>\n\t\t\t<span class=\"bx-im-multidialog-item__date\">\n\t\t\t\t{{ formatDate }}\n\t\t\t</span>\n\t\t\t<div class=\"bx-im-multidialog-item__status\">\n\t\t\t\t{{ transferredStatus }}\n\t\t\t</div>\n\t\t\t<div v-show=\"counter\" class=\"bx-im-multidialog-item__count bx-im-sidebar-multidialog-preview__new-message-counter\">\n\t\t\t\t{{ counter }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Messenger } from 'im.public';\nimport { EventType, SidebarDetailBlock, MultidialogStatus } from 'im.v2.const';\nimport { Loader } from 'im.v2.component.elements.loader';\nimport { ChatButton, ButtonColor, ButtonSize } from 'im.v2.component.elements.button';\n\nimport { Multidialog } from '../../../classes/panels/multidialog';\nimport { DetailHeader } from '../../elements/detail-header/detail-header';\nimport { MultidialogItem } from './multidialog-item';\n\nimport './css/multidialog-panel.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelSidebarMultidialogItem } from 'im.v2.model';\n\n// @vue/component\nexport const MultidialogPanel = {\n\tname: 'MultidialogPanel',\n\tcomponents: {\n\t\tDetailHeader,\n\t\tMultidialogItem,\n\t\tChatButton,\n\t\tLoader,\n\t},\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\t\t\tisCreating: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tButtonSize: () => ButtonSize,\n\t\tButtonColor: () => ButtonColor,\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\tactiveMultidialogs(): ImModelSidebarMultidialogItem[]\n\t\t{\n\t\t\tconst multidialogs = this.$store.getters['sidebar/multidialog/getMultidialogsByStatus']([MultidialogStatus.new, MultidialogStatus.open]);\n\n\t\t\treturn multidialogs.sort((a, b) => b.date - a.date);\n\t\t},\n\t\tclosedMultidialogs(): ImModelSidebarMultidialogItem[]\n\t\t{\n\t\t\tconst multidialogs = this.$store.getters['sidebar/multidialog/getMultidialogsByStatus']([MultidialogStatus.close]);\n\n\t\t\treturn multidialogs.sort((a, b) => b.date - a.date);\n\t\t},\n\t\tlimitReached(): boolean\n\t\t{\n\t\t\tconst openMultidialogs = this.$store.getters['sidebar/multidialog/getMultidialogsByStatus']([MultidialogStatus.open]);\n\t\t\tconst openSessionsLimit = this.$store.getters['sidebar/multidialog/getOpenSessionsLimit'];\n\n\t\t\treturn openSessionsLimit <= openMultidialogs.length;\n\t\t},\n\t\tisInitedDetail(): boolean\n\t\t{\n\t\t\treturn this.$store.getters['sidebar/multidialog/isInitedDetail'];\n\t\t},\n\t\tisDisabledButtonCreate(): boolean\n\t\t{\n\t\t\treturn this.limitReached || !this.isInitedDetail;\n\t\t},\n\t\tbuttonCreateTitle(): boolean\n\t\t{\n\t\t\tif (!this.limitReached || !this.isInitedDetail)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.loc('IM_SIDEBAR_SUPPORT_TICKET_LIMIT');\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.service = new Multidialog();\n\t},\n\tmounted()\n\t{\n\t\tvoid this.loadFirstPage();\n\t},\n\tmethods:\n\t{\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t\tonBackClick()\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.sidebar.close, { panel: SidebarDetailBlock.multidialog });\n\t\t},\n\t\tneedToLoadNextPage(event: Event): boolean\n\t\t{\n\t\t\tconst target = event.target;\n\t\t\tconst isAtThreshold = target.scrollTop + target.clientHeight >= target.scrollHeight - target.clientHeight;\n\t\t\tconst hasNextPage = this.$store.getters['sidebar/multidialog/hasNextPage'];\n\n\t\t\treturn isAtThreshold && hasNextPage;\n\t\t},\n\t\tasync loadFirstPage()\n\t\t{\n\t\t\tif (this.isLoading)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadFirstPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tasync onScroll(event: Event)\n\t\t{\n\t\t\tif (this.isLoading || !this.needToLoadNextPage(event))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tawait this.service.loadNextPage();\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tasync onAddSupport()\n\t\t{\n\t\t\tif (this.isCreating)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isCreating = true;\n\t\t\tconst newDialogId = await this.service.createSupportChat();\n\t\t\tif (newDialogId)\n\t\t\t{\n\t\t\t\tthis.openChat(newDialogId);\n\t\t\t}\n\t\t\tthis.isCreating = false;\n\t\t},\n\t\topenChat(dialogId)\n\t\t{\n\t\t\tvoid Messenger.openChat(dialogId);\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-multidialog-detail__scope\">\n\t\t\t<DetailHeader\n\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t:title=\"loc('IM_SIDEBAR_SUPPORT_TICKET_DETAIL_TITLE')\"\n\t\t\t\t:secondLevel=\"true\"\n\t\t\t\t@back=\"onBackClick\"\n\t\t\t>\n\t\t\t\t<template #action>\n\t\t\t\t\t<div :title=\"buttonCreateTitle\" class=\"bx-im-sidebar-detail-header__add-button\">\n\t\t\t\t\t\t<ChatButton\n\t\t\t\t\t\t\t:text=\"loc('IM_SIDEBAR_SUPPORT_TICKET_ADD_BUTTON_TEXT')\"\n\t\t\t\t\t\t\t:size=\"ButtonSize.S\"\n\t\t\t\t\t\t\t:color=\"ButtonColor.PrimaryLight\"\n\t\t\t\t\t\t\t:isLoading=\"isCreating\"\n\t\t\t\t\t\t\t:isDisabled=\"isDisabledButtonCreate\"\n\t\t\t\t\t\t\t:isRounded=\"true\"\n\t\t\t\t\t\t\t:isUppercase=\"false\"\n\t\t\t\t\t\t\ticon=\"plus\"\n\t\t\t\t\t\t\t@click=\"onAddSupport\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</DetailHeader>\n\t\t\t<div class=\"bx-im-sidebar-multidialog-detail__container bx-im-sidebar-detail__container\" @scroll=\"onScroll\">\n\t\t\t\t<MultidialogItem\n\t\t\t\t\tv-for=\"multidialog in activeMultidialogs\"\n\t\t\t\t\t:key=\"multidialog.chatId\"\n\t\t\t\t\t:item=\"multidialog\"\n\t\t\t\t\t@click=\"openChat(multidialog.dialogId)\"\n\t\t\t\t/>\n\t\t\t\t<MultidialogItem\n\t\t\t\t\tv-for=\"multidialog in closedMultidialogs\"\n\t\t\t\t\t:key=\"multidialog.chatId\"\n\t\t\t\t\t:item=\"multidialog\"\n\t\t\t\t\t@click=\"openChat(multidialog.dialogId)\"\n\t\t\t\t/>\n\t\t\t\t<Loader v-if=\"isLoading\" class=\"bx-im-sidebar-detail__loader-container\" />\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Text } from 'main.core';\n\nimport { MainPanel } from './panels/main/main-panel';\nimport { TaskPanel } from './panels/task/task-panel';\nimport { FilePanel } from './panels/file/file-panel';\nimport { FileUnsortedPanel } from './panels/file-unsorted/file-unsorted-panel';\nimport { LinkPanel } from './panels/info/link-panel';\nimport { MarketPanel } from './panels/market/detail';\nimport { MeetingPanel } from './panels/meeting/meeting-panel';\nimport { MembersPanel } from './panels/members/members-panel';\nimport { FavoritePanel } from './panels/info/favorite-panel';\nimport { MessageSearchPanel } from './panels/message-search/message-search-panel';\nimport { ChatsWithUserPanel } from './panels/chats-with-user/chats-with-user-panel';\nimport { MultidialogPanel } from './panels/multidialog/multidialog-panel';\n\nimport '../css/sidebar-panel.css';\nimport '../css/detail.css';\n\n// @vue/component\nexport const SidebarPanel = {\n\tname: 'SidebarPanel',\n\tcomponents: {\n\t\tMainPanel,\n\t\tChatsWithUserPanel,\n\t\tMembersPanel,\n\t\tFavoritePanel,\n\t\tLinkPanel,\n\t\tFilePanel,\n\t\tTaskPanel,\n\t\tMeetingPanel,\n\t\tMarketPanel,\n\t\tMessageSearchPanel,\n\t\tFileUnsortedPanel,\n\t\tMultidialogPanel,\n\t},\n\tprops:\n\t{\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tpanel: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsecondLevel: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tentityId: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\tpanelComponentName(): string\n\t\t{\n\t\t\treturn `${Text.capitalize(this.panel)}Panel`;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar-panel__container\" :class=\"{'--second-level': secondLevel}\">\n\t\t\t<KeepAlive>\n\t\t\t\t<component\n\t\t\t\t\t:is=\"panelComponentName\"\n\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t:entityId=\"entityId\"\n\t\t\t\t\t:secondLevel=\"secondLevel\"\n\t\t\t\t\tclass=\"bx-im-sidebar-panel__component\"\n\t\t\t\t/>\n\t\t\t</KeepAlive>\n\t\t</div>\n\t`,\n};\n","import { Logger } from 'im.v2.lib.logger';\nimport { LocalStorageManager } from 'im.v2.lib.local-storage';\nimport { EventType, LocalStorageKey, SidebarDetailBlock } from 'im.v2.const';\n\nimport { SidebarPanel } from './components/sidebar-panel';\n\nimport './css/icons.css';\nimport './css/sidebar.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { BaseEvent, EventEmitter } from 'main.core.events';\n\ntype SidebarPanelType = $Values<typeof SidebarDetailBlock>;\n\n// @vue/component\nexport const ChatSidebar = {\n\tname: 'ChatSidebar',\n\tcomponents: { SidebarPanel },\n\tprops:\n\t{\n\t\toriginDialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisActive: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['changePanel'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tneedTopLevelTransition: true,\n\t\t\tneedSecondLevelTransition: true,\n\n\t\t\ttopLevelPanelType: '',\n\t\t\ttopLevelPanelDialogId: '',\n\t\t\ttopLevelPanelStandalone: false,\n\n\t\t\tsecondLevelPanelType: '',\n\t\t\tsecondLevelPanelDialogId: '',\n\t\t\tsecondLevelPanelEntityId: '',\n\t\t\tsecondLevelPanelStandalone: false,\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tSidebarDetailBlock: () => SidebarDetailBlock,\n\t\ttopLevelTransitionName(): string\n\t\t{\n\t\t\treturn this.needTopLevelTransition ? 'top-level-panel' : '';\n\t\t},\n\t\tsecondLevelTransitionName(): string\n\t\t{\n\t\t\treturn this.needSecondLevelTransition ? 'second-level-panel' : '';\n\t\t},\n\t\tcanShowTopPanel(): boolean\n\t\t{\n\t\t\tconst membersPanel = this.topLevelPanelType === SidebarDetailBlock.members;\n\t\t\tconst personalChat = !this.originDialogId.startsWith('chat');\n\t\t\tif (membersPanel && personalChat)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst messageSearchPanel = this.topLevelPanelType === SidebarDetailBlock.messageSearch;\n\n\t\t\treturn !messageSearchPanel;\n\t\t},\n\t\tsidebarOpened(): boolean\n\t\t{\n\t\t\treturn this.topLevelPanelType || this.secondLevelPanelType;\n\t\t},\n\t},\n\twatch:\n\t{\n\t\toriginDialogId(newValue: string, oldValue: string)\n\t\t{\n\t\t\tconst chatSwitched = Boolean(newValue && oldValue);\n\t\t\tif (chatSwitched)\n\t\t\t{\n\t\t\t\tthis.needTopLevelTransition = false;\n\t\t\t}\n\n\t\t\tif (!this.topLevelPanelStandalone)\n\t\t\t{\n\t\t\t\tthis.updateTopPanelOriginDialogId(newValue);\n\t\t\t}\n\n\t\t\tconst isSecondLevelPanelOpened = this.secondLevelPanelType.length > 0;\n\t\t\tif (isSecondLevelPanelOpened && !this.secondLevelPanelStandalone)\n\t\t\t{\n\t\t\t\tthis.closeSecondLevelPanel();\n\t\t\t}\n\n\t\t\tif (!this.canShowTopPanel)\n\t\t\t{\n\t\t\t\tthis.closeTopPanel();\n\t\t\t}\n\t\t},\n\t\ttopLevelPanelType(newValue: SidebarPanelType, oldValue: SidebarPanelType)\n\t\t{\n\t\t\tthis.needTopLevelTransition = oldValue.length === 0 || newValue.length === 0;\n\n\t\t\tconst isMainPanelOpened = newValue === SidebarDetailBlock.main;\n\t\t\tthis.saveSidebarOpenedState(isMainPanelOpened);\n\t\t},\n\t\tsecondLevelPanelType(newValue: SidebarPanelType, oldValue: SidebarPanelType)\n\t\t{\n\t\t\tthis.needSecondLevelTransition = !(newValue && oldValue);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tLogger.warn('ChatSidebar: created');\n\t\tthis.restoreOpenState();\n\t},\n\tmounted()\n\t{\n\t\tthis.getEmitter().subscribe(EventType.sidebar.open, this.onSidebarOpen);\n\t\tthis.getEmitter().subscribe(EventType.sidebar.close, this.onSidebarClose);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.getEmitter().unsubscribe(EventType.sidebar.open, this.onSidebarOpen);\n\t\tthis.getEmitter().unsubscribe(EventType.sidebar.close, this.onSidebarClose);\n\t},\n\tmethods:\n\t{\n\t\tonSidebarOpen(event: BaseEvent<{panel: SidebarPanelType, standalone: boolean, dialogId: string}>)\n\t\t{\n\t\t\tif (!this.isActive)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { panel = '', standalone = false, dialogId, entityId = '' } = event.getData();\n\n\t\t\tconst needToCloseSecondLevelPanel = !standalone && panel && this.secondLevelPanelType === panel;\n\t\t\tif (needToCloseSecondLevelPanel)\n\t\t\t{\n\t\t\t\tthis.closeSecondLevelPanel();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst needToOpenSecondLevelPanel = this.topLevelPanelType && this.topLevelPanelType !== panel;\n\t\t\tif (needToOpenSecondLevelPanel)\n\t\t\t{\n\t\t\t\tthis.openSecondLevelPanel(panel, dialogId, standalone, entityId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.openTopPanel(panel, dialogId, standalone);\n\t\t\t}\n\t\t},\n\t\tonSidebarClose(event: BaseEvent<{panel: SidebarPanelType}>)\n\t\t{\n\t\t\tif (!this.isActive)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.needTopLevelTransition = true;\n\n\t\t\tconst { panel = '' } = event.getData();\n\t\t\tconst needToCloseSecondLevelPanel = panel && this.secondLevelPanelType === panel;\n\t\t\tif (needToCloseSecondLevelPanel)\n\t\t\t{\n\t\t\t\tthis.closeSecondLevelPanel();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.closeSecondLevelPanel();\n\t\t\t\tthis.closeTopPanel();\n\t\t\t}\n\t\t},\n\t\trestoreOpenState()\n\t\t{\n\t\t\tconst sidebarOpenState = LocalStorageManager.getInstance().get(LocalStorageKey.sidebarOpened);\n\t\t\tif (!sidebarOpenState)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.openTopPanel(SidebarDetailBlock.main, this.originDialogId, false);\n\t\t},\n\t\tsaveSidebarOpenedState(sidebarOpened: boolean)\n\t\t{\n\t\t\tconst WRITE_TO_STORAGE_TIMEOUT = 200;\n\t\t\tclearTimeout(this.saveSidebarStateTimeout);\n\t\t\tthis.saveSidebarStateTimeout = setTimeout(() => {\n\t\t\t\tLocalStorageManager.getInstance().set(LocalStorageKey.sidebarOpened, sidebarOpened);\n\t\t\t}, WRITE_TO_STORAGE_TIMEOUT);\n\t\t},\n\t\topenTopPanel(type, dialogId, standalone = false)\n\t\t{\n\t\t\tthis.topLevelPanelType = type;\n\t\t\tthis.topLevelPanelDialogId = dialogId;\n\t\t\tthis.topLevelPanelStandalone = standalone;\n\t\t\tthis.$emit('changePanel', { panel: this.topLevelPanelType });\n\t\t},\n\t\tupdateTopPanelOriginDialogId(dialogId: string)\n\t\t{\n\t\t\tthis.topLevelPanelDialogId = dialogId;\n\t\t},\n\t\topenSecondLevelPanel(type, dialogId, standalone = false, entityId = '')\n\t\t{\n\t\t\tthis.secondLevelPanelType = type;\n\t\t\tthis.secondLevelPanelDialogId = dialogId;\n\t\t\tthis.secondLevelPanelStandalone = standalone;\n\t\t\tthis.secondLevelPanelEntityId = entityId;\n\t\t\tthis.$emit('changePanel', { panel: this.secondLevelPanelType });\n\t\t},\n\t\tcloseTopPanel()\n\t\t{\n\t\t\tthis.topLevelPanelType = '';\n\t\t\tthis.topLevelPanelDialogId = '';\n\t\t\tthis.topLevelPanelStandalone = false;\n\t\t\tthis.$emit('changePanel', { panel: '' });\n\t\t},\n\t\tcloseSecondLevelPanel()\n\t\t{\n\t\t\tthis.secondLevelPanelType = '';\n\t\t\tthis.secondLevelPanelDialogId = '';\n\t\t\tthis.secondLevelPanelStandalone = false;\n\t\t\tthis.$emit('changePanel', { panel: this.topLevelPanelType });\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-sidebar__container\" :class=\"{'--opened': sidebarOpened}\">\n\t\t\t<Transition :name=\"topLevelTransitionName\">\n\t\t\t\t<SidebarPanel\n\t\t\t\t\tv-if=\"topLevelPanelType\"\n\t\t\t\t\t:dialogId=\"topLevelPanelDialogId\"\n\t\t\t\t\t:panel=\"topLevelPanelType\"\n\t\t\t\t/>\n\t\t\t</Transition>\n\t\t\t<Transition :name=\"secondLevelTransitionName\">\n\t\t\t\t<SidebarPanel\n\t\t\t\t\tv-if=\"secondLevelPanelType\"\n\t\t\t\t\t:dialogId=\"secondLevelPanelDialogId\" \n\t\t\t\t\t:panel=\"secondLevelPanelType\"\n\t\t\t\t\t:entityId=\"secondLevelPanelEntityId\"\n\t\t\t\t\t:secondLevel=\"true\"\n\t\t\t\t/>\n\t\t\t</Transition>\n\t\t</div>\n\t`,\n};\n"],"names":["getChatId","dialogId","dialog","Core","getStore","getters","chatId","getLastElementId","collection","sort","length","a","b","id","lastCollectionItem","Type","isNumber","REQUEST_ITEMS_LIMIT","Favorite","constructor","store","restClient","getRestClient","userManager","UserManager","getInitialQuery","RestMethod","imChatFavoriteCounterGet","chat_id","imChatFavoriteGet","limit","getResponseHandler","response","Promise","reject","Error","favoriteCounterGetResponse","setCounterResult","dispatch","counter","setFavoriteResult","handleResponse","all","loadNextPage","queryParams","getQueryParams","requestPage","CHAT_ID","LIMIT","lastId","LAST_ID","callMethod","then","data","catch","error","console","updateModels","resultData","list","users","files","tariffRestrictions","addUsersPromise","setUsersToModel","isHistoryLimitExceeded","Boolean","rawMessages","map","favorite","message","hasNextPage","setFilesPromise","storeMessagesPromise","setFavoritesPromise","favorites","Link","imChatUrlCounterGet","imChatUrlGet","urlGetResult","handleUrlGetResponse","counterGetResult","handleCounterGetResponse","linksCount","getLinksCountFromModel","resolve","offset","OFFSET","setLinksPromise","links","File","imChatFileCollectionGet","group","historyLimitPromise","isArrayFilled","sortedGroups","forEach","file","fileGroup","SidebarFileGroups","fileUnsorted","push","setSidebarFilesPromises","Object","entries","groupName","listByGroup","loadFirstPage","loadFirstPageByGroup","loadNextPageByGroup","filesCount","getFilesCountFromModel","GROUP","imChatFileGet","Task","imChatTaskGet","tasksCount","getTasksCountFromModel","setTasksPromise","tasks","Meeting","imChatCalendarGet","meetingsCount","getMeetingsCountFromState","setMeetingsPromise","meetings","MembersService","imV2ChatMemberTail","membersCount","getMembersCountFromModel","nextCursor","cursor","restResult","userIds","user","setMembersPromise","cursorPromise","Multidialog","isInitedMultidialogBlock","imBotNetworkChatCount","setInitedPromise","updateModelsPromise","config","params","keys","key","value","runAction","imBotNetworkChatList","createSupportChat","Logger","warn","imBotNetworkChatAdd","chats","isInitedDetail","numberMultidialogs","count","chatIdsWithCounters","multidialogs","openSessionsLimit","promises","setChatsPromise","setUsersPromise","setSupportTicketPromise","chatsCount","unreadChats","FileUnsorted","imDiskFolderListGet","SidebarDetailBlock","diskFolderListGetResult","hasMoreItemsToLoad","preparedFiles","setSidebarFilesPromise","hasNextPagePromise","setLastIdPromise","MainPanelServiceClasses","Members","BlockToServices","freeze","SidebarMainPanelBlock","chat","members","copilot","task","copilotInfo","info","link","fileList","fileUnsortedList","taskList","meetingList","meeting","multidialog","Main","blockServices","buildBlocks","requestInitialData","query","callBatch","handleBatchRequestResult","classNames","getServiceClassesForBlocks","ClassName","blockService","initialQuery","responseHandler","services","sidebarConfig","SidebarManager","getInstance","getConfig","blockList","getBlocks","block","service","Text","capitalize","assign","responseHandlersResult","setInited","MainMenu","RecentMenu","applicationContext","permissionManager","PermissionManager","getMenuOptions","className","getMenuClassName","angle","getMenuItems","getPinMessageItem","getEditItem","getAddMembersToChatItem","getOpenProfileItem","getOpenUserCalendarItem","getChatsWithUserItem","getCopyInviteLinkItem","getHideItem","getLeaveItem","getDeleteItem","BX","clipboard","isCopySupported","isUser","isCollabChat","isGroupCopilotChat","CopilotManager","context","isCopilotChat","title","Loc","getMessage","onClick","chatLink","ChatManager","buildChatLink","copy","Notifier","onCopyLinkComplete","Analytics","chatInviteLink","onCopyContextMenu","canPerformActionByRole","ActionByRole","update","chatEdit","onOpenForm","LayoutManager","setLayout","name","Layout","updateChat","entityId","delete","design","MenuItemDesign","Alert","chatDelete","onConfirm","isBot","profileUri","Utils","getCalendarLink","SidePanel","Instance","open","menuInstance","close","isChatWithCurrentUser","hasCreateChatAccess","canPerformActionByUserType","ActionByUserType","createChat","hasAccessByRole","extend","isChannel","userAdd","onChatSidebarClick","emit","events","onAddToChatShow","ChatService","deleteChat","clearCurrentLayoutEntityId","collab","onBeforeDelete","deleteCollab","deleteLastOpenedElementById","confirmResult","showDeleteChatConfirm","onCancel","MainHeader","components","AddToChat","AddToCollab","props","type","String","required","showAddToChatPopup","computed","recentItem","$store","headerTitle","getHeaderTitle","showMenuIcon","canOpenMenu","isMenuEnabled","openSidebarMenu","isHeaderMenuEnabled","addMembersPopupComponent","ChatType","created","contextMenu","emitter","getEmitter","subscribe","onAddChatShow","beforeUnmount","destroy","unsubscribe","methods","onContextMenuClick","event","openMenu","target","onSidebarCloseClick","EventType","sidebar","$Bitrix","eventEmitter","loc","phraseCode","template","ChatLinks","directives","hint","expanded","urlCounter","getCounterString","isLinksAvailable","state","isLinksMigrated","hintDirectiveContent","text","popupOptions","targetContainer","document","body","offsetLeft","offsetTop","bindOptions","position","MAX_COUNTER","toString","onLinkClick","panel","ChatFavourites","favoriteCounter","onFavouriteClick","MAX_DESCRIPTION_SYMBOLS","VISIBLE_DESCRIPTION_LINES","NEW_LINE_SYMBOL","DescriptionByChatType","channel","openChannel","generalChannel","comment","default","ChatDescription","UserType","bot","customDescription","getCustomDescription","isLongDescription","lineBreakCount","description","split","hasSeveralLines","previewDescription","chatTypeText","slice","descriptionToShow","getAIModelName","showExpandButton","ChatShared","chatsWithUser","standalone","InfoPreview","isSelfChat","getUserId","isUserOrBot","includes","showSharedChats","isSharedChatsEnabled","areSharedChatsEnabled","FilePreviewItem","lazyload","fileItem","sidebarFileItem","fileId","previewImageStyles","hasPreview","backgroundImage","urlPreview","fileShortName","NAME_MAX_LENGTH","getShortFileName","viewerAttributes","getViewerDataAttributes","viewerAttrs","previewImageSrc","imageSrc","FileViewerContext","sidebarMain","isImage","isVideo","isAudio","fileIconClass","icon","isViewerAvailable","isAnimation","extension","urlShow","download","window","urlDownload","DetailEmptyState","iconType","iconClass","toKebabCase","FileListPreview","isMigrationFinished","hasFiles","isFilesMigrated","onOpenDetail","SidebarMenu","BaseMenu","getOpenContextMessageItem","messageId","goToMessageContext","getCopyLinkItem","source","TaskManager","LINK_ID","imChatTaskDelete","TaskMenu","taskManager","bind","TaskItem","ChatAvatar","AvatarSize","searchQuery","emits","showContextButton","taskItem","taskTitle","encode","highlightText","taskAuthorDialogId","creatorId","taskResponsibleDialogId","responsibleId","taskDeadlineText","statusToShow","isStringFilled","statusTitle","convertHtmlEntities","taskBackgroundColorClass","status","statusColorClass","color","LabelColor","toUpperCase","toLowerCase","onTaskClick","cacheable","$emit","currentTarget","TaskListPreview","ChatButton","ButtonSize","ButtonColor","firstTask","showAddButton","createTask","addButtonColor","PrimaryLight","getEntityCreator","EntityCreator","onAddClick","chatEntities","onCreateTaskFromSidebarClick","createTaskForChat","item","MarketItem","marketItem","options","iconName","iconColor","MarketAppListPreview","marketMenuItems","MarketManager","getAvailablePlacementsByType","PlacementType","onMarketItemClick","market","MeetingManager","imChatCalendarDelete","MeetingMenu","meetingManager","MeetingItem","meetingItem","date","meetingDate","dateFrom","DateFormatter","formatByTemplate","DateTemplate","day","getDate","monthShort","DateTimeFormat","format","isActive","getTime","Date","now","onMeetingClick","top","Calendar","SliderLoader","show","MeetingListPreview","firstMeeting","createMeeting","onCreateEventFromSidebarClick","createMeetingForChat","CopilotInfoPreview","MuteChat","Toggle","ToggleSize","canBeMuted","mute","isChatMuted","isMuted","muteList","find","element","hintMuteNotAvailable","getChatService","chatService","muteActionHandler","unmuteChat","muteChat","AutoDelete","AutoDeleteHint","AutoDeleteDropdown","AutoDeletePopup","showHint","showPopup","autoDeleteDelayInHours","isAutoDeleteFeatureEnabled","FeatureManager","isFeatureAvailable","Feature","messagesAutoDeleteEnabled","isAutoDeleteAllowed","AutoDeleteManager","isAutoDeleteAvailableByChatType","NoAutoDeleteChatTypes","lines","videoconf","ChannelManager","getChannelTypes","isAutoDeleteActive","changeAutoDeleteActionHandler","updateAutoDeleteDelay","AutoDeleteDelay","Off","messagesAutoDelete","openFeatureSlider","delay","setMessagesAutoDeleteDelay","onAutoDeleteDelayChange","onDropDownClick","stopPropagation","ChatMembersAvatars","showMembers","dialogIds","PREVIEW_USERS_COUNT","canSeeMembers","userList","canInviteMembers","usersInChatCount","userCounter","moreUsersCount","Math","max","isCollab","addUsersButtonColor","Collab","onOpenUsers","onOpenInvitePopup","ChatPreview","ChatTitle","areChatMembersEnabled","isAutoDeleteEnabled","PostPreview","postDialog","parentChatId","UserPreview","userPosition","canCreateChat","canExtendChat","showInviteButton","userLink","getProfileLink","CopilotService","updateRole","newRole","currentRole","code","role","newRoleCode","requestParams","imV2ChatCopilotUpdateRole","ChangeRolePromo","bindElement","videoSource","basePath","sources","ru","en","language","promoPopup","PromoVideoPopup","videoSrc","targetOptions","angleOptions","UI","AnglePosition","RIGHT","colors","iconBackground","IconSet","COPILOT_AI","left","PromoVideoPopupEvents","ACCEPT","onAccept","HIDE","onHide","mounted","hide","replacements","CopilotRole","CopilotRolesDialog","shouldShowChangeRolePromo","showRolesDialog","chatRole","roleName","canShowChangeRolePromo","needShowAddUsersToChatHint","PromoManager","needToShow","PromoId","addUsersToCopilotChat","needToShowChangeRolePromo","changeRoleCopilot","setTimeout","handleChangeRole","onChangeRolePromoAccept","markAsWatched","onCopilotDialogSelectRole","CopilotAiModelService","updateAIModel","aiModelCode","aiModel","engineCode","imV2ChatCopilotUpdateAiModel","AiModelItem","selected","MARKET_PAGE","AIModelPopupContent","isAdmin","selectedAIModelCode","aiModelsItems","settingsPageUrl","settings","Extension","getSettings","get","openAiSettings","location","origin","openMarket","openHelpCenter","ARTICLE_CODE","openHelpdeskArticle","isSelectedAIModel","selectAIModel","POPUP_ID","AIModelPopup","MessengerPopup","width","fixed","AIModel","showAIModelPopup","currentAIModelName","toggleAIModelPopup","closeAIModelPopup","CopilotPreview","isAIModelChangeAllowed","SupportPreview","MultidialogPreview","numberRequests","totalChatCounter","TariffLimit","chatHistory","getLimitTitle","preparedDescription","getLimitSubtitle","replace","tooltipText","getTooltipText","watch","sendAnalyticsOnCreate","onDetailClick","sendAnalyticsOnClick","historyLimit","onSidebarBannerClick","onSidebarLimitExceeded","TariffLimitPreview","INTRANET_MANUAL_CODE","COLLABER_MANUAL_CODE","CollabHelpdeskPreview","collabHelpdeskSidebar","isCurrentUserCollaber","currentUser","collaber","openHelpdesk","manualCode","urlParams","utm_source","utm_content","Manual","NotesPreview","ChatAvatarType","ChatTitleType","TaskPreview","TaskCommentsHistory","entityLink","taskId","Number","HistoryGrid","Runtime","loadExtension","openHistoryGrid","ComponentMap","notes","post","support","taskCommentsHistory","FileUnsortedListPreview","marketAppList","tariffLimit","collabHelpdesk","SidebarSkeleton","MainPanel","isLoading","blocks","dialogInited","inited","hasInitialData","initializeSidebar","sidebarService","concatAndSortSearchResult","concatArrayFirst","concatArraySecond","z","TaskSearch","searchOnServer","request","resetSearchState","responseData","SEARCH_TASK_NAME","DateGroup","dateText","DetailHeader","SearchInput","secondLevel","withAddButton","withSearch","isSearchHeaderOpened","delayForFocusOnStart","DetailEmptySearchState","subTitle","SidebarCollectionFormatter","cachedDateGroups","dateGroups","dateGroup","getDateGroup","dateGroupTitle","items","values","INDEX_BETWEEN_DATE_AND_TIME","shortDate","toJSON","DEFAULT_MIN_TOKEN_SIZE","TaskPanel","StartState","Loader","searchResult","currentServerQueries","minTokenSize","formattedCollection","collectionFormatter","isEmptyState","preparedQuery","trim","isSearchQueryMinimumSize","hasHistoryLimit","newQuery","previousQuery","cleanSearchResult","startSearch","initSettings","serviceSearch","searchOnServerDelayed","debounce","messageIds","finally","stopLoader","onChangeQuery","toggleSearchPanelOpened","onBackClick","needToLoadNextPage","isAtThreshold","scrollTop","clientHeight","scrollHeight","nameGetter","onScroll","ARROW_CONTROL_SIZE","DetailTabs","tabs","Array","hasLeftControl","hasRightControl","currentElementIndex","highlightOffsetLeft","highlightWidth","highlightStyle","newIndex","updateHighlightPosition","scrollToElement","$refs","scrollWidth","offsetWidth","getElementNodeByIndex","index","children","filter","node","Dom","hasClass","elementIndex","scroll","behavior","onTabClick","getTabTitle","tab","tabNameToUpperCase","langPhraseCode","isSelectedTab","onLeftClick","onRightClick","updateControlsVisibility","scrollLeft","clientWidth","FileSearch","listByType","SEARCH_FILE_NAME","MediaDetailItem","MessageAvatar","videoDuration","previewPicture","sidebarTabMedia","videoDurationText","formatTime","canBeOpenedWithViewer","Viewer","rawSeconds","floor","durationHours","durationMinutes","hours","minutes","padStart","seconds","handleVideoEvent","video","duration","sidebarFile","progress","FileManager","diskService","DiskService","saveOnDisk","fileIds","save","FileMenu","mediaManager","getDownloadFileItem","getSaveFileOnDiskItem","getDeleteFileItem","downloadFiles","onDiskSaveComplete","getCurrentUserId","authorId","MediaTab","isSearch","isLoadingSearch","media","AudioDetailItem","AudioPlayer","audioUrl","AudioTab","audio","BriefItem","brief","shortName","fileSize","formatFileSize","size","sidebarTabBriefs","BriefTab","FileDetailItem","viewerContext","FileTab","FilePanel","SidebarFileTabGroups","tabComponentName","tabTypes","canShowBriefs","sidebarBriefs","onTabSelect","tabName","FileUnsortedPanel","LinkItem","linkItem","shortDescription","hostName","URL","hostname","richData","decodedDescription","authorDialogId","previewUrl","previewStyles","backgroundSize","backgroundRepeat","iconTypeClass","LinkSearch","SEARCH_URL","LinkManager","imChatUrlDelete","LinkMenu","linkManager","getDeleteLinkItem","LinkPanel","MarketPanel","Spinner","SpinnerSize","placement","placementId","parseInt","marketManager","loadPlacement","html","MeetingSearch","SEARCH_TITLE","MeetingPanel","DetailUser","contextDialogId","isOwner","isManager","isCopilot","needContextMenu","isAiAssistant","userId","hasLink","onClickContextMenu","userDialogId","MembersMenu","UserMenu","callManager","CallManager","getProfileItem","getMentionItem","getSendItem","getManagerItem","getCallItem","getKickItem","ownerId","canChangeManagers","changeManagers","managerList","removeManager","addManager","chatCanBeCalled","chatIsAllowedToCall","call","startCall","isCurrentUser","canLeaveCollab","canLeaveChat","leave","userChoice","showLeaveChatConfirm","leaveCollab","leaveChat","MemberTitleByChatType","MembersPanel","showAddToChatTarget","userDialogIds","panelInited","phrase","needAddButton","needCopyLinkButton","onCopyInviteClick","onCopyMembersPanel","FavoriteMenu","getDeleteFromFavoriteItem","messageService","MessageService","removeMessageFromFavorite","FavoriteSearch","SEARCH_MESSAGE","FavoriteItem","MessageAuthorTitle","favoriteItem","favoriteMessage","messageText","purifiedMessage","Parser","purifyMessage","textToShow","onItemClick","FavoritePanel","MessageSearch","imDialogMessagesSearch","messages","rawData","usersShort","reactions","additionalMessages","usersPromise","addUsersToModel","filesPromise","reactionsPromise","additionalMessagesPromise","messagesPromise","SearchItem","isSystem","onMessageBodyClick","tagName","SearchHeader","MessageSearchPanel","mergeResult","onClickBack","messageSearch","ItemTextByChatType","ChatItem","dateMessage","chatItemText","formattedDate","cast","formatDate","nativeEvent","recent","ChatsWithUser","imV2ChatListShared","ChatsWithUserPanel","Messenger","openChat","nextPageChats","MultidialogItem","multidialogItem","transferredStatus","containerClasses","chatIsOpened","MultidialogPanel","isCreating","activeMultidialogs","MultidialogStatus","new","closedMultidialogs","limitReached","openMultidialogs","isDisabledButtonCreate","buttonCreateTitle","onAddSupport","newDialogId","SidebarPanel","panelComponentName","ChatSidebar","originDialogId","needTopLevelTransition","needSecondLevelTransition","topLevelPanelType","topLevelPanelDialogId","topLevelPanelStandalone","secondLevelPanelType","secondLevelPanelDialogId","secondLevelPanelEntityId","secondLevelPanelStandalone","topLevelTransitionName","secondLevelTransitionName","canShowTopPanel","membersPanel","personalChat","startsWith","messageSearchPanel","sidebarOpened","newValue","oldValue","chatSwitched","updateTopPanelOriginDialogId","isSecondLevelPanelOpened","closeSecondLevelPanel","closeTopPanel","isMainPanelOpened","main","saveSidebarOpenedState","restoreOpenState","onSidebarOpen","onSidebarClose","getData","needToCloseSecondLevelPanel","needToOpenSecondLevelPanel","openSecondLevelPanel","openTopPanel","sidebarOpenState","LocalStorageManager","LocalStorageKey","WRITE_TO_STORAGE_TIMEOUT","clearTimeout","saveSidebarStateTimeout","set"],"mappings":"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"}