{"version":3,"file":"registry.bundle.js","sources":["../src/classes/search-service.js","../src/classes/search-context-menu.js","../src/helpers/get-first-search-item.js","../src/helpers/get-min-token-size.js","../src/helpers/merge-search-items.js","../src/components/elements/empty-state.js","../src/components/elements/search-item.js","../src/components/elements/my-notes.js","../src/components/elements/carousel-user.js","../src/components/elements/recent-users-carousel.js","../src/components/chat-search.js","../src/components/chat-search-input.js","../src/components/add-to-chat.js","../src/components/forward-search.js"],"sourcesContent":["import { ajax as Ajax } from 'main.core';\n\nimport {\n\tEntityId,\n\tgetSearchConfig,\n\tLocalSearch,\n\tStoreUpdater,\n\tSearchConfig,\n\ttype ImRecentProviderItem,\n\ttype SearchResultItem,\n} from 'im.v2.lib.search';\nimport { Logger } from 'im.v2.lib.logger';\nimport { Utils } from 'im.v2.lib.utils';\n\ntype RecentItem = [string, string | number];\n\nconst SEARCH_REQUEST_ENDPOINT = 'ui.entityselector.doSearch';\nconst LOAD_LATEST_RESULTS_ENDPOINT = 'ui.entityselector.load';\nconst SAVE_ITEM_ENDPOINT = 'ui.entityselector.saveRecentItems';\n\nexport class SearchService\n{\n\t#localSearch: LocalSearch;\n\t#localCollection: Map<string, Date> = new Map();\n\t#searchConfig: SearchConfig;\n\t#storeUpdater: StoreUpdater;\n\n\tconstructor(searchConfig)\n\t{\n\t\tthis.#searchConfig = searchConfig;\n\t\tthis.#storeUpdater = new StoreUpdater();\n\t\tthis.#localSearch = new LocalSearch(searchConfig);\n\t}\n\n\tasync loadLatestResults(): Promise<SearchResultItem[]>\n\t{\n\t\tconst response = await this.#loadLatestResultsRequest();\n\t\tconst { items, recentItems } = response;\n\t\tif (items.length === 0 || recentItems.length === 0)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst itemsFromRecentItems = this.#getItemsFromRecentItems(recentItems, items);\n\t\tawait this.#storeUpdater.update(itemsFromRecentItems);\n\n\t\treturn this.#getDialogIdAndDate(itemsFromRecentItems);\n\t}\n\n\tsearchLocal(query: string): SearchResultItem[]\n\t{\n\t\tconst localCollection = [...this.#localCollection.values()];\n\n\t\treturn this.#localSearch.search(query, localCollection);\n\t}\n\n\tasync search(query: string): Promise<SearchResultItem[]>\n\t{\n\t\tconst items = await this.#searchRequest(query);\n\t\tawait this.#storeUpdater.update(items);\n\n\t\tconst searchResult = this.#getDialogIdAndDate(items);\n\n\t\tsearchResult.forEach((searchItem) => {\n\t\t\tthis.#localCollection.set(searchItem.dialogId, searchItem);\n\t\t});\n\n\t\treturn searchResult;\n\t}\n\n\tsaveItemToRecentSearch(dialogId: string): void\n\t{\n\t\tconst recentItems = [{ id: dialogId, entityId: EntityId }];\n\n\t\tconst config = {\n\t\t\tjson: {\n\t\t\t\t...getSearchConfig(this.#searchConfig),\n\t\t\t\trecentItems,\n\t\t\t},\n\t\t};\n\n\t\tvoid Ajax.runAction(SAVE_ITEM_ENDPOINT, config);\n\t}\n\n\tclearSessionResult()\n\t{\n\t\tthis.#localCollection.clear();\n\t}\n\n\tasync #loadLatestResultsRequest(): Promise<{items: ImRecentProviderItem[], recentItems: Object[]}>\n\t{\n\t\tconst config = {\n\t\t\tjson: getSearchConfig(this.#searchConfig),\n\t\t};\n\n\t\tlet items = { items: [], recentItems: [] };\n\t\ttry\n\t\t{\n\t\t\tconst response = await Ajax.runAction(LOAD_LATEST_RESULTS_ENDPOINT, config);\n\t\t\tLogger.warn('Search service: latest search request result', response);\n\t\t\titems = response.data.dialog;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tLogger.warn('Search service: latest search request error', error);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tasync #searchRequest(query: string): Promise<ImRecentProviderItem[]>\n\t{\n\t\tconst config = {\n\t\t\tjson: getSearchConfig(this.#searchConfig),\n\t\t};\n\n\t\tconfig.json.searchQuery = {\n\t\t\tqueryWords: Utils.text.getWordsFromString(query),\n\t\t\tquery,\n\t\t};\n\n\t\tlet items = [];\n\t\ttry\n\t\t{\n\t\t\tconst response = await Ajax.runAction(SEARCH_REQUEST_ENDPOINT, config);\n\t\t\tLogger.warn('Search service: request result', response);\n\t\t\titems = response.data.dialog.items;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tLogger.warn('Search service: error', error);\n\t\t}\n\n\t\treturn items;\n\t}\n\n\t#getDialogIdAndDate(items: ImRecentProviderItem[]): SearchResultItem[]\n\t{\n\t\treturn items.map((item) => {\n\t\t\treturn {\n\t\t\t\tdialogId: item.id.toString(),\n\t\t\t\tdateMessage: item.customData?.dateMessage ?? '',\n\t\t\t};\n\t\t});\n\t}\n\n\t#getItemsFromRecentItems(recentItems: RecentItem[], items: ImRecentProviderItem[]): ImRecentProviderItem[]\n\t{\n\t\tconst filledRecentItems = [];\n\t\trecentItems.forEach(([, dialogId]) => {\n\t\t\tconst found = items.find((recentItem) => {\n\t\t\t\treturn recentItem.id === dialogId.toString();\n\t\t\t});\n\t\t\tif (found)\n\t\t\t{\n\t\t\t\tfilledRecentItems.push(found);\n\t\t\t}\n\t\t});\n\n\t\treturn filledRecentItems;\n\t}\n}\n","import { Loc } from 'main.core';\n\nimport { Messenger } from 'im.public';\nimport { Utils } from 'im.v2.lib.utils';\nimport { BaseMenu } from 'im.v2.lib.menu';\nimport { CallManager } from 'im.v2.lib.call';\nimport { PermissionManager } from 'im.v2.lib.permission';\nimport { EventType, SidebarDetailBlock, UserType } from 'im.v2.const';\n\nimport type { MenuItemOptions } from 'ui.system.menu';\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelUser } from 'im.v2.model';\nimport type { ApplicationContext } from 'im.v2.const';\n\nexport class SearchContextMenu extends BaseMenu\n{\n\tcallManager: CallManager;\n\temitter: EventEmitter;\n\n\tconstructor(applicationContext: ApplicationContext)\n\t{\n\t\tsuper();\n\n\t\tthis.id = 'im-chat-search-context-menu';\n\t\tthis.callManager = CallManager.getInstance();\n\t\tthis.permissionManager = PermissionManager.getInstance();\n\n\t\tconst { emitter } = applicationContext;\n\t\tthis.emitter = emitter;\n\t}\n\n\tgetMenuItems(): MenuItemOptions | null[]\n\t{\n\t\treturn [\n\t\t\tthis.getOpenItem(),\n\t\t\tthis.getOpenProfileItem(),\n\t\t\tthis.getChatsWithUserItem(),\n\t\t];\n\t}\n\n\tgetOpenItem(): MenuItemOptions\n\t{\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_OPEN'),\n\t\t\tonClick: () => {\n\t\t\t\tvoid Messenger.openChat(this.context.dialogId);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetOpenProfileItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.isUser() || this.isBot())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst profileUri = Utils.user.getProfileLink(this.context.dialogId);\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_OPEN_PROFILE_V2'),\n\t\t\tonClick: () => {\n\t\t\t\tBX.SidePanel.Instance.open(profileUri);\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tgetChatsWithUserItem(): ?MenuItemOptions\n\t{\n\t\tif (!this.isUser() || this.isBot() || this.isChatWithCurrentUser())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst isAnyChatOpened = this.store.getters['application/getLayout'].entityId.length > 0;\n\n\t\treturn {\n\t\t\ttitle: Loc.getMessage('IM_LIB_MENU_FIND_SHARED_CHATS'),\n\t\t\tonClick: async () => {\n\t\t\t\tif (!isAnyChatOpened)\n\t\t\t\t{\n\t\t\t\t\tawait Messenger.openChat(this.context.dialogId);\n\t\t\t\t}\n\n\t\t\t\tthis.emitter.emit(EventType.sidebar.open, {\n\t\t\t\t\tpanel: SidebarDetailBlock.chatsWithUser,\n\t\t\t\t\tstandalone: true,\n\t\t\t\t\tdialogId: this.context.dialogId,\n\t\t\t\t});\n\t\t\t\tthis.menuInstance.close();\n\t\t\t},\n\t\t};\n\t}\n\n\tisUser(): boolean\n\t{\n\t\treturn this.store.getters['chats/isUser'](this.context.dialogId);\n\t}\n\n\tisBot(): boolean\n\t{\n\t\tif (!this.isUser())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst user: ImModelUser = this.store.getters['users/get'](this.context.dialogId);\n\n\t\treturn user.type === UserType.bot;\n\t}\n\n\tisChatWithCurrentUser(): boolean\n\t{\n\t\treturn this.getCurrentUserId() === Number.parseInt(this.context.dialogId, 10);\n\t}\n}\n","import type { SearchResultItem } from 'im.v2.lib.search';\n\nexport const getFirstItemFromSearchResults = ({ searchResult, recentItems }): ?SearchResultItem => {\n\tif (searchResult.length > 0)\n\t{\n\t\treturn searchResult[0];\n\t}\n\n\tif (recentItems.length > 0)\n\t{\n\t\treturn recentItems[0];\n\t}\n\n\treturn null;\n};\n","import { Extension } from 'main.core';\n\nconst DEFAULT_MIN_TOKEN_SIZE = 3;\n\nexport const getMinTokenSize = (): number => {\n\tconst settings = Extension.getSettings('im.v2.component.search');\n\n\treturn settings.get('minTokenSize', DEFAULT_MIN_TOKEN_SIZE);\n};\n","import type { SearchResultItem } from 'im.v2.lib.search';\n\nexport const mergeSearchItems = (\n\toriginalItems: SearchResultItem[],\n\tnewItems: SearchResultItem[],\n): SearchResultItem[] => {\n\tconst mergedItems = [...originalItems, ...newItems].map((item) => {\n\t\treturn [item.dialogId, item];\n\t});\n\tconst result = new Map(mergedItems);\n\n\treturn [...result.values()];\n};\n","import '../css/empty-state.css';\n\n// @vue/component\nexport const EmptyState = {\n\tname: 'EmptyState',\n\tcomputed:\n\t{\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_RESULT_NOT_FOUND');\n\t\t},\n\t\tsubTitle(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_RESULT_NOT_FOUND_DESCRIPTION');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-search-empty-state__container bx-im-search-empty-state__scope\">\n\t\t\t<div class=\"bx-im-search-empty-state__icon\"></div>\n\t\t\t<div class=\"bx-im-search-empty-state__title\">\n\t\t\t\t{{ title }}\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-empty-state__subtitle\">\n\t\t\t\t{{ subTitle }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\nimport { Text, Loc } from 'main.core';\n\nimport { ChatType } from 'im.v2.const';\nimport { Utils } from 'im.v2.lib.utils';\nimport { highlightText } from 'im.v2.lib.text-highlighter';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\nimport { ChatTitleWithHighlighting, ChatTitleType } from 'im.v2.component.elements.chat-title';\nimport { ChatAvatar, AvatarSize, ChatAvatarType } from 'im.v2.component.elements.avatar';\n\nimport '../css/search-item.css';\n\nimport type { ImModelChat } from 'im.v2.model';\n\nconst ItemTextByChatType = {\n\t[ChatType.openChannel]: Loc.getMessage('IM_SEARCH_ITEM_OPEN_CHANNEL_TYPE_GROUP'),\n\t[ChatType.generalChannel]: Loc.getMessage('IM_SEARCH_ITEM_OPEN_CHANNEL_TYPE_GROUP'),\n\t[ChatType.channel]: Loc.getMessage('IM_SEARCH_ITEM_PRIVATE_CHANNEL_TYPE_GROUP'),\n\t[ChatType.collab]: Loc.getMessage('IM_SEARCH_ITEM_COLLAB_TYPE'),\n\tdefault: Loc.getMessage('IM_SEARCH_ITEM_CHAT_TYPE_GROUP_V2'),\n};\n\n// @vue/component\nexport const SearchItem = {\n\tname: 'SearchItem',\n\tcomponents: { ChatAvatar, ChatTitleWithHighlighting },\n\tprops: {\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdateMessage: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\twithDate: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tselected: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\treplaceWithNotes: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['clickItem', 'openContextMenu'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tdialog(): ImModelChat\n\t\t{\n\t\t\treturn this.$store.getters['chats/get'](this.dialogId, true);\n\t\t},\n\t\tisChat(): boolean\n\t\t{\n\t\t\treturn !this.isUser;\n\t\t},\n\t\tisUser(): boolean\n\t\t{\n\t\t\treturn this.dialog.type === ChatType.user;\n\t\t},\n\t\tisNotes(): boolean\n\t\t{\n\t\t\tif (!this.replaceWithNotes)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn this.$store.getters['chats/isNotes'](this.dialogId);\n\t\t},\n\t\tavatarType(): string\n\t\t{\n\t\t\tif (!this.replaceWithNotes)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.isNotes ? ChatAvatarType.notes : '';\n\t\t},\n\t\ttitleType(): string\n\t\t{\n\t\t\tif (!this.replaceWithNotes)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.isNotes ? ChatTitleType.notes : '';\n\t\t},\n\t\tposition(): string\n\t\t{\n\t\t\tif (!this.isUser)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn this.$store.getters['users/getPosition'](this.dialogId);\n\t\t},\n\t\tuserItemText(): string\n\t\t{\n\t\t\tif (!this.position)\n\t\t\t{\n\t\t\t\treturn this.loc('IM_SEARCH_ITEM_USER_TYPE_GROUP_V2');\n\t\t\t}\n\n\t\t\treturn highlightText(Text.encode(this.position), this.query);\n\t\t},\n\t\tchatItemText(): string\n\t\t{\n\t\t\treturn ItemTextByChatType[this.dialog.type] ?? ItemTextByChatType.default;\n\t\t},\n\t\titemText(): string\n\t\t{\n\t\t\tif (this.isNotes)\n\t\t\t{\n\t\t\t\treturn this.notesText;\n\t\t\t}\n\n\t\t\treturn this.isUser ? this.userItemText : this.chatItemText;\n\t\t},\n\t\titemTextForTitle(): string\n\t\t{\n\t\t\tif (this.isNotes)\n\t\t\t{\n\t\t\t\treturn this.notesText;\n\t\t\t}\n\n\t\t\treturn this.isUser ? this.position : this.chatItemText;\n\t\t},\n\t\tnotesText(): string\n\t\t{\n\t\t\treturn this.loc('IM_LIST_RECENT_CHAT_SELF_SUBTITLE');\n\t\t},\n\t\tformattedDate(): ?string\n\t\t{\n\t\t\tif (!this.dateMessage)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst date = Utils.date.cast(this.dateMessage);\n\n\t\t\treturn this.formatDate(date);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tonClick(event: PointerEvent)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tonRightClick(event: PointerEvent)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('openContextMenu', { dialogId: this.dialogId, nativeEvent: event });\n\t\t},\n\t\tformatDate(date: Date): string\n\t\t{\n\t\t\treturn DateFormatter.formatByTemplate(date, DateTemplate.recent);\n\t\t},\n\t\tloc(phraseCode: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\" \n\t\t\tclass=\"bx-im-search-item__container bx-im-search-item__scope\"\n\t\t\t:class=\"{'--selected': selected}\"\n\t\t>\n\t\t\t<div class=\"bx-im-search-item__avatar-container\">\n\t\t\t\t<ChatAvatar\n\t\t\t\t\t:avatarDialogId=\"dialogId\" \n\t\t\t\t\t:contextDialogId=\"dialogId\" \n\t\t\t\t\t:size=\"AvatarSize.XL\"\n\t\t\t\t\t:customType=\"avatarType\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-search-item__content-container\" :class=\"{'--centered': isNotes}\">\n\t\t\t\t<div class=\"bx-im-search-item__content_header\">\n\t\t\t\t\t<ChatTitleWithHighlighting\n\t\t\t\t\t\t:dialogId=\"dialogId\"\n\t\t\t\t\t\t:textToHighlight=\"query\"\n\t\t\t\t\t\t:customType=\"titleType\"\n\t\t\t\t\t\t:showItsYou=\"!replaceWithNotes\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div v-if=\"withDate && formattedDate\" class=\"bx-im-search-item__date\">\n\t\t\t\t\t\t<span>{{ formattedDate }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div v-if=\"itemText\" class=\"bx-im-search-item__item-text\" :title=\"itemTextForTitle\" v-html=\"itemText\"></div>\n\t\t\t</div>\n\t\t\t<div v-if=\"selected\" class=\"bx-im-chat-search-item__selected\"></div>\n\t\t</div>\n\t`,\n};\n","import { Core } from 'im.v2.application.core';\n\nimport { SearchContextMenu } from '../../classes/search-context-menu';\n\nimport '../css/my-notes.css';\n\nimport type { EventEmitter } from 'main.core.events';\n\n// @vue/component\nexport const MyNotes = {\n\tname: 'MyNotes',\n\temits: ['clickItem'],\n\tcomputed:\n\t{\n\t\tdialogId(): number\n\t\t{\n\t\t\treturn Core.getUserId().toString();\n\t\t},\n\t\tname(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage('IM_SEARCH_MY_NOTES');\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new SearchContextMenu({ emitter: this.getEmitter() });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-search-my-notes__container bx-im-search-my-notes__scope\"\n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent\n\t\t>\n\t\t\t<div class=\"bx-im-search-my-notes__avatar\"></div>\n\t\t\t<div class=\"bx-im-search-my-notes__title\" :title=\"name\">\n\t\t\t\t{{ name }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { ChatAvatar, AvatarSize } from 'im.v2.component.elements.avatar';\nimport { UserType } from 'im.v2.const';\n\nimport { SearchContextMenu } from '../../classes/search-context-menu';\n\nimport '../css/carousel-user.css';\n\nimport type { EventEmitter } from 'main.core.events';\nimport type { ImModelUser } from 'im.v2.model';\n\n// @vue/component\nexport const CarouselUser = {\n\tname: 'CarouselUser',\n\tcomponents: { ChatAvatar },\n\tprops: {\n\t\tuserDialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tselected: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['clickItem', 'openContextMenu'],\n\tcomputed:\n\t{\n\t\tAvatarSize: () => AvatarSize,\n\t\tuser(): ImModelUser\n\t\t{\n\t\t\treturn this.$store.getters['users/get'](this.userDialogId, true);\n\t\t},\n\t\tname(): string\n\t\t{\n\t\t\treturn this.user.firstName ?? this.user.name;\n\t\t},\n\t\tisExtranet(): boolean\n\t\t{\n\t\t\treturn this.user.type === UserType.extranet;\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new SearchContextMenu({ emitter: this.getEmitter() });\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.contextMenuManager.destroy();\n\t},\n\tmethods:\n\t{\n\t\tonClick(event)\n\t\t{\n\t\t\tthis.$emit('clickItem', {\n\t\t\t\tdialogId: this.userDialogId,\n\t\t\t\tnativeEvent: event,\n\t\t\t});\n\t\t},\n\t\tonRightClick(event)\n\t\t{\n\t\t\tif (event.altKey && event.shiftKey)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('openContextMenu', { dialogId: this.userDialogId, nativeEvent: event });\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div \n\t\t\tclass=\"bx-im-carousel-user__container bx-im-carousel-user__scope\"\n\t\t\t:class=\"{'--extranet': isExtranet, '--selected': selected}\"\n\t\t\t@click=\"onClick\" \n\t\t\t@click.right.prevent=\"onRightClick\"\n\t\t>\n\t\t\t<div v-if=\"selected\" class=\"bx-im-carousel-user__selected-mark\"></div>\n\t\t\t<ChatAvatar :avatarDialogId=\"userDialogId\" :size=\"AvatarSize.XL\" />\n\t\t\t<div class=\"bx-im-carousel-user__title\" :title=\"name\">\n\t\t\t\t{{ name }}\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { getUsersFromRecentItems } from 'im.v2.lib.search';\n\nimport { MyNotes } from './my-notes';\nimport { CarouselUser } from './carousel-user';\n\nimport '../css/recent-users-carousel.css';\n\nconst SHOW_USERS_LIMIT = 6;\n\n// @vue/component\nexport const RecentUsersCarousel = {\n\tname: 'RecentUsersCarousel',\n\tcomponents: { CarouselUser, MyNotes },\n\temits: ['clickItem', 'openContextMenu'],\n\tcomputed:\n\t{\n\t\tusersDialogIds(): string[]\n\t\t{\n\t\t\treturn getUsersFromRecentItems({ withFakeUsers: false }).map(({ dialogId }) => dialogId);\n\t\t},\n\t\titems(): string[]\n\t\t{\n\t\t\treturn this.usersDialogIds.slice(0, SHOW_USERS_LIMIT - 1);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tisChat(dialogId: string): boolean\n\t\t{\n\t\t\treturn dialogId.startsWith('chat');\n\t\t},\n\t\tloc(key: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(key);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"bx-im-recent-users-carousel__container bx-im-recent-users-carousel__scope\">\n\t\t\t<div class=\"bx-im-recent-users-carousel__title-container\">\n\t\t\t\t<span class=\"bx-im-recent-users-carousel__section-title\">\n\t\t\t\t\t{{ loc('IM_SEARCH_SECTION_RECENT_CHATS') }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<div class=\"bx-im-recent-users-carousel__users-container\">\n\t\t\t\t<MyNotes\n\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\" \n\t\t\t\t/>\n\t\t\t\t<CarouselUser\n\t\t\t\t\tv-for=\"userDialogId in items\"\n\t\t\t\t\t:key=\"userDialogId\"\n\t\t\t\t\t:userDialogId=\"userDialogId\"\n\t\t\t\t\t@clickItem=\"$emit('clickItem', $event)\"\n\t\t\t\t\t@openContextMenu=\"$emit('openContextMenu', $event)\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport { Runtime, type JsonObject } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\n\nimport { Messenger } from 'im.public';\nimport { Utils } from 'im.v2.lib.utils';\nimport { EventType } from 'im.v2.const';\n\nimport { ScrollWithGradient } from 'im.v2.component.elements.scroll-with-gradient';\nimport { Loader } from 'im.v2.component.elements.loader';\nimport { sortByDate, type SearchResultItem } from 'im.v2.lib.search';\n\nimport { SearchService } from '../classes/search-service';\nimport { SearchContextMenu } from '../classes/search-context-menu';\nimport { getFirstItemFromSearchResults } from '../helpers/get-first-search-item';\nimport { getMinTokenSize } from '../helpers/get-min-token-size';\nimport { mergeSearchItems } from '../helpers/merge-search-items';\nimport { EmptyState } from './elements/empty-state';\nimport { SearchItem } from './elements/search-item';\nimport { RecentUsersCarousel } from './elements/recent-users-carousel';\n\nimport './css/chat-search.css';\n\nimport type { EventEmitter } from 'main.core.events';\n\n// @vue/component\nexport const ChatSearch = {\n\tname: 'ChatSearch',\n\tcomponents: { ScrollWithGradient, SearchItem, EmptyState, RecentUsersCarousel, Loader },\n\tprops: {\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsearchMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['loading', 'closeSearch'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisRecentLoading: false,\n\t\t\tisServerLoading: false,\n\n\t\t\tcurrentServerQueries: 0,\n\t\t\trecentItems: [],\n\t\t\tsearchResult: [],\n\t\t};\n\t},\n\tcomputed: {\n\t\tcleanQuery(): string\n\t\t{\n\t\t\treturn this.query.trim().toLowerCase();\n\t\t},\n\t\tshowLatestSearchResult(): boolean\n\t\t{\n\t\t\treturn this.cleanQuery.length === 0;\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.searchResult.length === 0;\n\t\t},\n\t},\n\twatch: {\n\t\tcleanQuery(newQuery: string)\n\t\t{\n\t\t\tif (newQuery.length === 0)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\n\t\t\tthis.startSearch(newQuery);\n\t\t},\n\t\tisServerLoading(newValue: boolean)\n\t\t{\n\t\t\tthis.$emit('loading', newValue);\n\t\t},\n\t\tsearchMode(newValue: boolean)\n\t\t{\n\t\t\tif (!newValue)\n\t\t\t{\n\t\t\t\tthis.searchService.clearSessionResult();\n\t\t\t\tvoid this.loadRecentSearchFromServer();\n\t\t\t}\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.contextMenuManager = new SearchContextMenu({ emitter: this.getEmitter() });\n\n\t\tthis.searchService = new SearchService({\n\t\t\tchats: true,\n\t\t\tusers: true,\n\t\t});\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 400, this);\n\n\t\tthis.getEmitter().subscribe(EventType.search.keyPressed, this.onKeyPressed);\n\n\t\tvoid this.loadRecentSearchFromServer();\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.getEmitter().unsubscribe(EventType.search.keyPressed, this.onKeyPressed);\n\t},\n\tmethods: {\n\t\tasync loadRecentSearchFromServer()\n\t\t{\n\t\t\tthis.isRecentLoading = true;\n\t\t\tthis.recentItems = await this.searchService.loadLatestResults();\n\t\t\tthis.isRecentLoading = false;\n\t\t},\n\t\tstartSearch(query: string)\n\t\t{\n\t\t\tif (query.length > 0)\n\t\t\t{\n\t\t\t\tconst result = this.searchService.searchLocal(query);\n\t\t\t\tif (query !== this.cleanQuery)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.searchResult = sortByDate(result);\n\t\t\t}\n\n\t\t\tif (query.length >= getMinTokenSize())\n\t\t\t{\n\t\t\t\tthis.isServerLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(query);\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.searchResult = [];\n\t\t\tthis.searchService.clearSessionResult();\n\t\t},\n\t\tasync searchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tconst searchResult = await this.searchService.search(query);\n\t\t\tif (query !== this.cleanQuery)\n\t\t\t{\n\t\t\t\tthis.stopLoader();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst mergedItems = mergeSearchItems(this.searchResult, searchResult);\n\t\t\tthis.searchResult = sortByDate(mergedItems);\n\t\t\tthis.stopLoader();\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tthis.currentServerQueries--;\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isServerLoading = false;\n\t\t},\n\t\tonOpenContextMenu(event)\n\t\t{\n\t\t\tconst { dialogId, nativeEvent } = event;\n\t\t\tif (Utils.key.isAltOrOption(nativeEvent))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.contextMenuManager.openMenu({ dialogId }, nativeEvent.currentTarget);\n\t\t},\n\t\tonScroll()\n\t\t{\n\t\t\tthis.contextMenuManager.destroy();\n\t\t},\n\t\tasync onClickItem(event: {dialogId: string, nativeEvent: KeyboardEvent})\n\t\t{\n\t\t\tconst { dialogId, nativeEvent } = event;\n\t\t\tthis.searchService.saveItemToRecentSearch(dialogId);\n\t\t\tvoid Messenger.openChat(dialogId);\n\n\t\t\tif (!Utils.key.isAltOrOption(nativeEvent))\n\t\t\t{\n\t\t\t\tthis.$emit('closeSearch');\n\t\t\t}\n\t\t},\n\t\tonKeyPressed(event: BaseEvent)\n\t\t{\n\t\t\tif (!this.searchMode)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { keyboardEvent } = event.getData();\n\n\t\t\tif (Utils.key.isCombination(keyboardEvent, 'Enter'))\n\t\t\t{\n\t\t\t\tthis.onPressEnterKey(event);\n\t\t\t}\n\t\t},\n\t\tonPressEnterKey(keyboardEvent: KeyboardEvent)\n\t\t{\n\t\t\tconst firstItem: ?SearchResultItem = getFirstItemFromSearchResults({\n\t\t\t\tsearchResult: this.searchResult,\n\t\t\t\trecentItems: this.recentItems,\n\t\t\t});\n\t\t\tif (!firstItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.onClickItem({\n\t\t\t\tdialogId: firstItem.dialogId,\n\t\t\t\tnativeEvent: keyboardEvent,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(key: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(key);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ScrollWithGradient :gradientHeight=\"28\" :withShadow=\"false\" @scroll=\"onScroll\"> \n\t\t\t<div class=\"bx-im-chat-search__container\">\n\t\t\t\t<template v-if=\"showLatestSearchResult\">\n\t\t\t\t\t<RecentUsersCarousel\n\t\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t\t\t@openContextMenu=\"onOpenContextMenu\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"bx-im-chat-search__title\">{{ loc('IM_SEARCH_SECTION_RECENT') }}</div>\n\t\t\t\t\t<SearchItem\n\t\t\t\t\t\tv-for=\"item in recentItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:dialogId=\"item.dialogId\"\n\t\t\t\t\t\t:replaceWithNotes=\"true\"\n\t\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t\t\t@openContextMenu=\"onOpenContextMenu\"\n\t\t\t\t\t/>\n\t\t\t\t\t<Loader v-if=\"isRecentLoading\" class=\"bx-im-chat-search__loader\" />\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<SearchItem\n\t\t\t\t\t\tv-for=\"item in searchResult\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:dialogId=\"item.dialogId\"\n\t\t\t\t\t\t:dateMessage=\"item.dateMessage\"\n\t\t\t\t\t\t:withDate=\"true\"\n\t\t\t\t\t\t:query=\"cleanQuery\"\n\t\t\t\t\t\t:replaceWithNotes=\"true\"\n\t\t\t\t\t\t@clickItem=\"onClickItem\"\n\t\t\t\t\t\t@openContextMenu=\"onOpenContextMenu\"\n\t\t\t\t\t/>\n\t\t\t\t\t<EmptyState v-if=\"isEmptyState\" />\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</ScrollWithGradient> \n\t`,\n};\n","import { EventType } from 'im.v2.const';\nimport { SearchInput } from 'im.v2.component.elements.search-input';\n\nimport type { EventEmitter } from 'main.core.events';\n\n// @vue/component\nexport const ChatSearchInput = {\n\tname: 'ChatSearchInput',\n\tcomponents: { SearchInput },\n\tprops: {\n\t\tsearchMode: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tisLoading: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t},\n\t\tdelayForFocusOnStart: {\n\t\t\ttype: [Number, null],\n\t\t\tdefault: null,\n\t\t},\n\t\twithIcon: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['closeSearch', 'openSearch', 'updateSearch'],\n\tmethods: {\n\t\tonInputFocus()\n\t\t{\n\t\t\tthis.$emit('openSearch');\n\t\t},\n\t\tonClose()\n\t\t{\n\t\t\tthis.$emit('closeSearch');\n\t\t},\n\t\tonInputUpdate(query: string)\n\t\t{\n\t\t\tthis.$emit('updateSearch', query);\n\t\t},\n\t\tonKeyPressed(event: KeyboardEvent)\n\t\t{\n\t\t\tthis.getEmitter().emit(EventType.search.keyPressed, { keyboardEvent: event });\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(key: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(key);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<SearchInput\n\t\t\t:placeholder=\"loc('IM_SEARCH_INPUT_PLACEHOLDER_V2')\"\n\t\t\t:searchMode=\"searchMode\"\n\t\t\t:isLoading=\"isLoading\"\n\t\t\t:withLoader=\"true\"\n\t\t\t:delayForFocusOnStart=\"delayForFocusOnStart\"\n\t\t\t:withIcon=\"withIcon\"\n\t\t\t@inputFocus=\"onInputFocus\"\n\t\t\t@inputBlur=\"onClose\"\n\t\t\t@queryChange=\"onInputUpdate\"\n\t\t\t@keyPressed=\"onKeyPressed\"\n\t\t\t@close=\"onClose\"\n\t\t\t@closeByEsc=\"onClose\"\n\t\t/>\n\t`,\n};\n","import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\n\nimport { Runtime } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\n\nimport { Utils } from 'im.v2.lib.utils';\nimport { EventType } from 'im.v2.const';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { ScrollWithGradient } from 'im.v2.component.elements.scroll-with-gradient';\nimport { sortByDate, getUsersFromRecentItems, type SearchResultItem } from 'im.v2.lib.search';\n\nimport { SearchService } from '../classes/search-service';\nimport { getFirstItemFromSearchResults } from '../helpers/get-first-search-item';\nimport { getMinTokenSize } from '../helpers/get-min-token-size';\nimport { mergeSearchItems } from '../helpers/merge-search-items';\nimport { EmptyState } from './elements/empty-state';\nimport { SearchItem } from './elements/search-item';\n\nimport './css/chat-search.css';\n\nimport type { JsonObject } from 'main.core';\nimport type { EventEmitter } from 'main.core.events';\n\n// @vue/component\nexport const AddToChat = {\n\tname: 'AddToChat',\n\tcomponents: { ScrollWithGradient, SearchItem, EmptyState },\n\tprops: {\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tselectedItems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t},\n\temits: ['clickItem'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\n\t\t\tcurrentServerQueries: 0,\n\t\t\tsearchResult: [],\n\t\t};\n\t},\n\tcomputed: {\n\t\tshowLatestSearchResult(): boolean\n\t\t{\n\t\t\treturn this.query.length === 0;\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.searchResult.length === 0;\n\t\t},\n\t},\n\twatch: {\n\t\tquery(newQuery: string)\n\t\t{\n\t\t\tif (newQuery.length === 0)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\n\t\t\tthis.startSearch(newQuery);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.searchService = new SearchService({\n\t\t\tchats: false,\n\t\t\tusers: true,\n\t\t});\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 400, this);\n\t\tthis.recentSearchItems = getUsersFromRecentItems({ withFakeUsers: true });\n\n\t\tthis.getEmitter().subscribe(EventType.search.keyPressed, this.onKeyPressed);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.getEmitter().unsubscribe(EventType.search.keyPressed, this.onKeyPressed);\n\t},\n\tmethods: {\n\t\tstartSearch(query: string)\n\t\t{\n\t\t\tif (query.length > 0)\n\t\t\t{\n\t\t\t\tconst result = this.searchService.searchLocal(query);\n\t\t\t\tif (query !== this.query)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.searchResult = sortByDate(result);\n\t\t\t}\n\n\t\t\tif (query.length >= getMinTokenSize())\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(query);\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.searchService.clearSessionResult();\n\t\t\tthis.searchResult = [];\n\t\t},\n\t\tasync searchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tconst searchResult = await this.searchService.search(query);\n\t\t\tif (query !== this.query)\n\t\t\t{\n\t\t\t\tthis.stopLoader();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst mergedItems = mergeSearchItems(this.searchResult, searchResult);\n\t\t\tthis.searchResult = sortByDate(mergedItems);\n\t\t\tthis.stopLoader();\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tthis.currentServerQueries--;\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tasync onClickItem(event: {dialogId: string, nativeEvent: KeyboardEvent}, itemIndex: number)\n\t\t{\n\t\t\tAnalytics.getInstance().userAdd.onSelectUserFromSearchResult({\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tposition: itemIndex + 1,\n\t\t\t});\n\t\t\tthis.$emit('clickItem', event);\n\t\t},\n\t\tasync onClickItemRecentItem(event: {dialogId: string, nativeEvent: KeyboardEvent}, itemIndex: number)\n\t\t{\n\t\t\tAnalytics.getInstance().userAdd.onSelectUserFromRecent({\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tposition: itemIndex + 1,\n\t\t\t});\n\t\t\tthis.$emit('clickItem', event);\n\t\t},\n\t\tonKeyPressed(event: BaseEvent)\n\t\t{\n\t\t\tconst { keyboardEvent } = event.getData();\n\n\t\t\tif (Utils.key.isCombination(keyboardEvent, 'Enter'))\n\t\t\t{\n\t\t\t\tthis.onPressEnterKey(event);\n\t\t\t}\n\t\t},\n\t\tonPressEnterKey(keyboardEvent: KeyboardEvent)\n\t\t{\n\t\t\tconst firstItem: ?SearchResultItem = getFirstItemFromSearchResults({\n\t\t\t\tsearchResult: this.searchResult,\n\t\t\t\trecentItems: this.recentSearchItems,\n\t\t\t});\n\t\t\tif (!firstItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.onClickItem({\n\t\t\t\tdialogId: firstItem.dialogId,\n\t\t\t\tnativeEvent: keyboardEvent,\n\t\t\t});\n\t\t},\n\t\tisSelected(dialogId: string): boolean\n\t\t{\n\t\t\treturn this.selectedItems.includes(dialogId);\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(key: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(key);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ScrollWithGradient :gradientHeight=\"28\" :withShadow=\"false\"> \n\t\t\t<div class=\"bx-im-chat-search__container\">\n\t\t\t\t<div class=\"bx-im-chat-search__title\">\n\t\t\t\t\t{{ loc('IM_SEARCH_SECTION_RECENT_CHATS') }}\n\t\t\t\t</div>\n\t\t\t\t<template v-if=\"showLatestSearchResult\">\n\t\t\t\t\t<SearchItem\n\t\t\t\t\t\tv-for=\"(item, index) in recentSearchItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:dialogId=\"item.dialogId\"\n\t\t\t\t\t\t:selected=\"isSelected(item.dialogId)\"\n\t\t\t\t\t\t:replaceWithNotes=\"false\"\n\t\t\t\t\t\t@clickItem=\"onClickItemRecentItem($event, index)\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<SearchItem\n\t\t\t\t\t\tv-for=\"(item, index) in searchResult\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:dialogId=\"item.dialogId\"\n\t\t\t\t\t\t:dateMessage=\"item.dateMessage\"\n\t\t\t\t\t\t:withDate=\"true\"\n\t\t\t\t\t\t:isSelected=\"isSelected(item.dialogId)\"\n\t\t\t\t\t\t:query=\"query\"\n\t\t\t\t\t\t:replaceWithNotes=\"false\"\n\t\t\t\t\t\t@clickItem=\"onClickItem($event, index)\"\n\t\t\t\t\t/>\n\t\t\t\t\t<EmptyState v-if=\"isEmptyState\" />\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</ScrollWithGradient> \n\t`,\n};\n","import 'ui.design-tokens';\nimport 'ui.fonts.opensans';\nimport { Runtime, type JsonObject } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\n\nimport { Core } from 'im.v2.application.core';\nimport { Utils } from 'im.v2.lib.utils';\nimport { EventType } from 'im.v2.const';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { getRecentListItems, sortByDate, type SearchResultItem } from 'im.v2.lib.search';\nimport { ScrollWithGradient } from 'im.v2.component.elements.scroll-with-gradient';\n\nimport { getFirstItemFromSearchResults } from '../helpers/get-first-search-item';\nimport { getMinTokenSize } from '../helpers/get-min-token-size';\nimport { mergeSearchItems } from '../helpers/merge-search-items';\nimport { EmptyState } from './elements/empty-state';\nimport { SearchItem } from './elements/search-item';\nimport { SearchService } from '../classes/search-service';\n\nimport './css/chat-search.css';\n\nimport type { EventEmitter } from 'main.core.events';\n\n// @vue/component\nexport const ForwardSearch = {\n\tname: 'ForwardSearch',\n\tcomponents: { ScrollWithGradient, SearchItem, EmptyState },\n\tprops: {\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tdialogId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\temits: ['clickItem', 'loading'],\n\tdata(): JsonObject\n\t{\n\t\treturn {\n\t\t\tisLoading: false,\n\n\t\t\tcurrentServerQueries: 0,\n\t\t\tsearchResult: [],\n\t\t};\n\t},\n\tcomputed: {\n\t\tshowLatestSearchResult(): boolean\n\t\t{\n\t\t\treturn this.query.length === 0;\n\t\t},\n\t\trecentSearchItems(): SearchResultItem[]\n\t\t{\n\t\t\tconst filteredRecent = this.recentListItems.filter(({ dialogId }) => {\n\t\t\t\treturn dialogId !== Core.getUserId().toString();\n\t\t\t});\n\n\t\t\tfilteredRecent.unshift({\n\t\t\t\tdialogId: Core.getUserId().toString(),\n\t\t\t\tdateMessage: '',\n\t\t\t});\n\n\t\t\treturn filteredRecent;\n\t\t},\n\t\tisEmptyState(): boolean\n\t\t{\n\t\t\treturn this.searchResult.length === 0;\n\t\t},\n\t},\n\twatch: {\n\t\tquery(newQuery: string)\n\t\t{\n\t\t\tif (newQuery.length === 0)\n\t\t\t{\n\t\t\t\tthis.cleanSearchResult();\n\t\t\t}\n\n\t\t\tthis.startSearch(newQuery);\n\t\t},\n\t\tisLoading(newValue: boolean)\n\t\t{\n\t\t\tthis.$emit('loading', newValue);\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.searchService = new SearchService({\n\t\t\tchats: true,\n\t\t\tusers: true,\n\t\t});\n\t\tthis.searchOnServerDelayed = Runtime.debounce(this.searchOnServer, 400, this);\n\t\tthis.recentListItems = getRecentListItems({ withFakeUsers: true });\n\n\t\tthis.getEmitter().subscribe(EventType.search.keyPressed, this.onKeyPressed);\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.getEmitter().unsubscribe(EventType.search.keyPressed, this.onKeyPressed);\n\t},\n\tmethods: {\n\t\tstartSearch(query: string)\n\t\t{\n\t\t\tif (query.length > 0)\n\t\t\t{\n\t\t\t\tconst result = this.searchService.searchLocal(query);\n\t\t\t\tif (query !== this.query)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.searchResult = sortByDate(result);\n\t\t\t}\n\n\t\t\tif (query.length >= getMinTokenSize())\n\t\t\t{\n\t\t\t\tthis.isLoading = true;\n\t\t\t\tthis.searchOnServerDelayed(query);\n\t\t\t}\n\t\t},\n\t\tcleanSearchResult()\n\t\t{\n\t\t\tthis.searchResult = [];\n\t\t\tthis.searchService.clearSessionResult();\n\t\t},\n\t\tasync searchOnServer(query: string)\n\t\t{\n\t\t\tthis.currentServerQueries++;\n\n\t\t\tconst searchResult = await this.searchService.search(query);\n\t\t\tif (query !== this.query)\n\t\t\t{\n\t\t\t\tthis.stopLoader();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst mergedItems = mergeSearchItems(this.searchResult, searchResult);\n\t\t\tthis.searchResult = sortByDate(mergedItems);\n\t\t\tthis.stopLoader();\n\t\t},\n\t\tstopLoader()\n\t\t{\n\t\t\tthis.currentServerQueries--;\n\t\t\tif (this.currentServerQueries > 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tasync onClickItem(event: {dialogId: string, nativeEvent: KeyboardEvent}, itemIndex: number)\n\t\t{\n\t\t\tAnalytics.getInstance().messageForward.onSelectRecipientFromSearchResult({\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tposition: itemIndex + 1,\n\t\t\t});\n\t\t\tthis.$emit('clickItem', event);\n\t\t},\n\t\tasync onClickRecentItem(event: {dialogId: string, nativeEvent: KeyboardEvent}, itemIndex: number)\n\t\t{\n\t\t\tAnalytics.getInstance().messageForward.onSelectRecipientFromRecent({\n\t\t\t\tdialogId: this.dialogId,\n\t\t\t\tposition: itemIndex + 1,\n\t\t\t});\n\t\t\tthis.$emit('clickItem', event);\n\t\t},\n\t\tonKeyPressed(event: BaseEvent)\n\t\t{\n\t\t\tconst { keyboardEvent } = event.getData();\n\n\t\t\tif (Utils.key.isCombination(keyboardEvent, 'Enter'))\n\t\t\t{\n\t\t\t\tthis.onPressEnterKey(event);\n\t\t\t}\n\t\t},\n\t\tonPressEnterKey(keyboardEvent: KeyboardEvent)\n\t\t{\n\t\t\tconst firstItem: ?SearchResultItem = getFirstItemFromSearchResults({\n\t\t\t\trecentItems: this.recentSearchItems,\n\t\t\t\tsearchResult: this.searchResult,\n\t\t\t});\n\t\t\tif (!firstItem)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.onClickItem({\n\t\t\t\tdialogId: firstItem.dialogId,\n\t\t\t\tnativeEvent: keyboardEvent,\n\t\t\t});\n\t\t},\n\t\tgetEmitter(): EventEmitter\n\t\t{\n\t\t\treturn this.$Bitrix.eventEmitter;\n\t\t},\n\t\tloc(key: string): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(key);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ScrollWithGradient :gradientHeight=\"28\" :withShadow=\"false\"> \n\t\t\t<div class=\"bx-im-chat-search__container\">\n\t\t\t\t<div class=\"bx-im-chat-search__title\">\n\t\t\t\t\t{{ loc('IM_SEARCH_SECTION_RECENT_CHATS') }}\n\t\t\t\t</div>\n\t\t\t\t<template v-if=\"showLatestSearchResult\">\n\t\t\t\t\t<SearchItem\n\t\t\t\t\t\tv-for=\"(item, index) in recentSearchItems\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:dialogId=\"item.dialogId\"\n\t\t\t\t\t\t:replaceWithNotes=\"true\"\n\t\t\t\t\t\t@clickItem=\"onClickRecentItem($event, index)\"\n\t\t\t\t\t/>\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t<SearchItem\n\t\t\t\t\t\tv-for=\"(item, index) in searchResult\"\n\t\t\t\t\t\t:key=\"item.dialogId\"\n\t\t\t\t\t\t:dialogId=\"item.dialogId\"\n\t\t\t\t\t\t:dateMessage=\"item.dateMessage\"\n\t\t\t\t\t\t:withDate=\"true\"\n\t\t\t\t\t\t:query=\"query\"\n\t\t\t\t\t\t:replaceWithNotes=\"true\"\n\t\t\t\t\t\t@clickItem=\"onClickItem($event, index)\"\n\t\t\t\t\t/>\n\t\t\t\t\t<EmptyState v-if=\"isEmptyState\" />\n\t\t\t\t</template>\n\t\t\t</div>\n\t\t</ScrollWithGradient> \n\t`,\n};\n"],"names":["SEARCH_REQUEST_ENDPOINT","LOAD_LATEST_RESULTS_ENDPOINT","SAVE_ITEM_ENDPOINT","SearchService","constructor","searchConfig","Map","StoreUpdater","LocalSearch","loadLatestResults","response","items","recentItems","length","itemsFromRecentItems","update","searchLocal","query","localCollection","values","search","searchResult","forEach","searchItem","set","dialogId","saveItemToRecentSearch","id","entityId","EntityId","config","json","getSearchConfig","Ajax","runAction","clearSessionResult","clear","Logger","warn","data","dialog","error","searchQuery","queryWords","Utils","text","getWordsFromString","map","item","toString","dateMessage","customData","filledRecentItems","found","find","recentItem","push","SearchContextMenu","BaseMenu","applicationContext","callManager","CallManager","getInstance","permissionManager","PermissionManager","emitter","getMenuItems","getOpenItem","getOpenProfileItem","getChatsWithUserItem","title","Loc","getMessage","onClick","Messenger","openChat","context","menuInstance","close","isUser","isBot","profileUri","user","getProfileLink","BX","SidePanel","Instance","open","isChatWithCurrentUser","isAnyChatOpened","store","getters","emit","EventType","sidebar","panel","SidebarDetailBlock","chatsWithUser","standalone","type","UserType","bot","getCurrentUserId","Number","parseInt","getFirstItemFromSearchResults","DEFAULT_MIN_TOKEN_SIZE","getMinTokenSize","settings","Extension","getSettings","get","mergeSearchItems","originalItems","newItems","mergedItems","result","EmptyState","name","computed","$Bitrix","subTitle","template","ItemTextByChatType","ChatType","openChannel","generalChannel","channel","collab","default","SearchItem","components","ChatAvatar","ChatTitleWithHighlighting","props","String","required","withDate","Boolean","selected","replaceWithNotes","emits","AvatarSize","$store","isChat","isNotes","avatarType","ChatAvatarType","notes","titleType","ChatTitleType","position","userItemText","loc","highlightText","Text","encode","chatItemText","itemText","notesText","itemTextForTitle","formattedDate","date","cast","formatDate","methods","event","$emit","nativeEvent","onRightClick","altKey","shiftKey","DateFormatter","formatByTemplate","DateTemplate","recent","phraseCode","MyNotes","Core","getUserId","created","contextMenuManager","getEmitter","beforeUnmount","destroy","eventEmitter","CarouselUser","userDialogId","firstName","isExtranet","extranet","SHOW_USERS_LIMIT","RecentUsersCarousel","usersDialogIds","getUsersFromRecentItems","withFakeUsers","slice","startsWith","key","ChatSearch","ScrollWithGradient","Loader","searchMode","isRecentLoading","isServerLoading","currentServerQueries","cleanQuery","trim","toLowerCase","showLatestSearchResult","isEmptyState","watch","newQuery","cleanSearchResult","startSearch","newValue","searchService","loadRecentSearchFromServer","chats","users","searchOnServerDelayed","Runtime","debounce","searchOnServer","subscribe","keyPressed","onKeyPressed","unsubscribe","sortByDate","stopLoader","onOpenContextMenu","isAltOrOption","openMenu","currentTarget","onScroll","onClickItem","keyboardEvent","getData","isCombination","onPressEnterKey","firstItem","ChatSearchInput","SearchInput","isLoading","delayForFocusOnStart","withIcon","onInputFocus","onClose","onInputUpdate","AddToChat","selectedItems","Array","recentSearchItems","itemIndex","Analytics","userAdd","onSelectUserFromSearchResult","onClickItemRecentItem","onSelectUserFromRecent","isSelected","includes","ForwardSearch","filteredRecent","recentListItems","filter","unshift","getRecentListItems","messageForward","onSelectRecipientFromSearchResult","onClickRecentItem","onSelectRecipientFromRecent"],"mappings":";;;;;;;CAgBA,MAAMA,uBAAuB,GAAG,4BAA4B;CAC5D,MAAMC,4BAA4B,GAAG,wBAAwB;CAC7D,MAAMC,kBAAkB,GAAG,mCAAmC;CAAC;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;CAAA;AAE/D,CAAO,MAAMC,aAAa,CAC1B;GAMCC,WAAW,CAACC,YAAY,EACxB;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;;KAAA;OAAA;OAAA;;KAAA;OAAA;OAAA,OALsC,IAAIC,GAAG;;KAAE;OAAA;OAAA;;KAAA;OAAA;OAAA;;KAM9C,4CAAI,kCAAiBD,YAAY;KACjC,4CAAI,kCAAiB,IAAIE,6BAAY,EAAE;KACvC,4CAAI,gCAAgB,IAAIC,4BAAW,CAACH,YAAY,CAAC;;GAGlD,MAAMI,iBAAiB,GACvB;KACC,MAAMC,QAAQ,GAAG,8CAAM,IAAI,yDAA4B;KACvD,MAAM;OAAEC,KAAK;OAAEC;MAAa,GAAGF,QAAQ;KACvC,IAAIC,KAAK,CAACE,MAAM,KAAK,CAAC,IAAID,WAAW,CAACC,MAAM,KAAK,CAAC,EAClD;OACC,OAAO,EAAE;;KAGV,MAAMC,oBAAoB,2CAAG,IAAI,sDAA0BF,WAAW,EAAED,KAAK,CAAC;KAC9E,MAAM,4CAAI,gCAAeI,MAAM,CAACD,oBAAoB,CAAC;KAErD,+CAAO,IAAI,4CAAqBA,oBAAoB;;GAGrDE,WAAW,CAACC,KAAa,EACzB;KACC,MAAMC,eAAe,GAAG,CAAC,GAAG,4CAAI,sCAAkBC,MAAM,EAAE,CAAC;KAE3D,OAAO,4CAAI,8BAAcC,MAAM,CAACH,KAAK,EAAEC,eAAe,CAAC;;GAGxD,MAAME,MAAM,CAACH,KAAa,EAC1B;KACC,MAAMN,KAAK,GAAG,8CAAM,IAAI,kCAAgBM,KAAK,CAAC;KAC9C,MAAM,4CAAI,gCAAeF,MAAM,CAACJ,KAAK,CAAC;KAEtC,MAAMU,YAAY,2CAAG,IAAI,4CAAqBV,KAAK,CAAC;KAEpDU,YAAY,CAACC,OAAO,CAAEC,UAAU,IAAK;OACpC,4CAAI,sCAAkBC,GAAG,CAACD,UAAU,CAACE,QAAQ,EAAEF,UAAU,CAAC;MAC1D,CAAC;KAEF,OAAOF,YAAY;;GAGpBK,sBAAsB,CAACD,QAAgB,EACvC;KACC,MAAMb,WAAW,GAAG,CAAC;OAAEe,EAAE,EAAEF,QAAQ;OAAEG,QAAQ,EAAEC;MAAU,CAAC;KAE1D,MAAMC,MAAM,GAAG;OACdC,IAAI,EAAE;SACL,GAAGC,gCAAe,yCAAC,IAAI,gCAAe;SACtCpB;;MAED;KAED,KAAKqB,cAAI,CAACC,SAAS,CAAChC,kBAAkB,EAAE4B,MAAM,CAAC;;GAGhDK,kBAAkB,GAClB;KACC,4CAAI,sCAAkBC,KAAK,EAAE;;CA2E/B;CAAC,4CAvEA;GACC,MAAMN,MAAM,GAAG;KACdC,IAAI,EAAEC,gCAAe,yCAAC,IAAI;IAC1B;GAED,IAAIrB,KAAK,GAAG;KAAEA,KAAK,EAAE,EAAE;KAAEC,WAAW,EAAE;IAAI;GAC1C,IACA;KACC,MAAMF,QAAQ,GAAG,MAAMuB,cAAI,CAACC,SAAS,CAACjC,4BAA4B,EAAE6B,MAAM,CAAC;KAC3EO,uBAAM,CAACC,IAAI,CAAC,8CAA8C,EAAE5B,QAAQ,CAAC;KACrEC,KAAK,GAAGD,QAAQ,CAAC6B,IAAI,CAACC,MAAM;IAC5B,CACD,OAAOC,KAAK,EACZ;KACCJ,uBAAM,CAACC,IAAI,CAAC,6CAA6C,EAAEG,KAAK,CAAC;;GAGlE,OAAO9B,KAAK;CACb;CAAC,+BAEoBM,KAAa,EAClC;GACC,MAAMa,MAAM,GAAG;KACdC,IAAI,EAAEC,gCAAe,yCAAC,IAAI;IAC1B;GAEDF,MAAM,CAACC,IAAI,CAACW,WAAW,GAAG;KACzBC,UAAU,EAAEC,qBAAK,CAACC,IAAI,CAACC,kBAAkB,CAAC7B,KAAK,CAAC;KAChDA;IACA;GAED,IAAIN,KAAK,GAAG,EAAE;GACd,IACA;KACC,MAAMD,QAAQ,GAAG,MAAMuB,cAAI,CAACC,SAAS,CAAClC,uBAAuB,EAAE8B,MAAM,CAAC;KACtEO,uBAAM,CAACC,IAAI,CAAC,gCAAgC,EAAE5B,QAAQ,CAAC;KACvDC,KAAK,GAAGD,QAAQ,CAAC6B,IAAI,CAACC,MAAM,CAAC7B,KAAK;IAClC,CACD,OAAO8B,KAAK,EACZ;KACCJ,uBAAM,CAACC,IAAI,CAAC,uBAAuB,EAAEG,KAAK,CAAC;;GAG5C,OAAO9B,KAAK;CACb;CAAC,8BAEmBA,KAA6B,EACjD;GACC,OAAOA,KAAK,CAACoC,GAAG,CAAEC,IAAI,IAAK;KAAA;KAC1B,OAAO;OACNvB,QAAQ,EAAEuB,IAAI,CAACrB,EAAE,CAACsB,QAAQ,EAAE;OAC5BC,WAAW,+CAAEF,IAAI,CAACG,UAAU,qBAAf,iBAAiBD,WAAW,oCAAI;MAC7C;IACD,CAAC;CACH;CAAC,mCAEwBtC,WAAyB,EAAED,KAA6B,EACjF;GACC,MAAMyC,iBAAiB,GAAG,EAAE;GAC5BxC,WAAW,CAACU,OAAO,CAAC,CAAC,GAAGG,QAAQ,CAAC,KAAK;KACrC,MAAM4B,KAAK,GAAG1C,KAAK,CAAC2C,IAAI,CAAEC,UAAU,IAAK;OACxC,OAAOA,UAAU,CAAC5B,EAAE,KAAKF,QAAQ,CAACwB,QAAQ,EAAE;MAC5C,CAAC;KACF,IAAII,KAAK,EACT;OACCD,iBAAiB,CAACI,IAAI,CAACH,KAAK,CAAC;;IAE9B,CAAC;GAEF,OAAOD,iBAAiB;CACzB;;CClJM,MAAMK,iBAAiB,SAASC,uBAAQ,CAC/C;GAICtD,WAAW,CAACuD,kBAAsC,EAClD;KACC,KAAK,EAAE;KAEP,IAAI,CAAChC,EAAE,GAAG,6BAA6B;KACvC,IAAI,CAACiC,WAAW,GAAGC,0BAAW,CAACC,WAAW,EAAE;KAC5C,IAAI,CAACC,iBAAiB,GAAGC,sCAAiB,CAACF,WAAW,EAAE;KAExD,MAAM;OAAEG;MAAS,GAAGN,kBAAkB;KACtC,IAAI,CAACM,OAAO,GAAGA,OAAO;;GAGvBC,YAAY,GACZ;KACC,OAAO,CACN,IAAI,CAACC,WAAW,EAAE,EAClB,IAAI,CAACC,kBAAkB,EAAE,EACzB,IAAI,CAACC,oBAAoB,EAAE,CAC3B;;GAGFF,WAAW,GACX;KACC,OAAO;OACNG,KAAK,EAAEC,aAAG,CAACC,UAAU,CAAC,kBAAkB,CAAC;OACzCC,OAAO,EAAE,MAAM;SACd,KAAKC,mBAAS,CAACC,QAAQ,CAAC,IAAI,CAACC,OAAO,CAACnD,QAAQ,CAAC;SAC9C,IAAI,CAACoD,YAAY,CAACC,KAAK,EAAE;;MAE1B;;GAGFV,kBAAkB,GAClB;KACC,IAAI,CAAC,IAAI,CAACW,MAAM,EAAE,IAAI,IAAI,CAACC,KAAK,EAAE,EAClC;OACC,OAAO,IAAI;;KAGZ,MAAMC,UAAU,GAAGrC,qBAAK,CAACsC,IAAI,CAACC,cAAc,CAAC,IAAI,CAACP,OAAO,CAACnD,QAAQ,CAAC;KAEnE,OAAO;OACN6C,KAAK,EAAEC,aAAG,CAACC,UAAU,CAAC,6BAA6B,CAAC;OACpDC,OAAO,EAAE,MAAM;SACdW,EAAE,CAACC,SAAS,CAACC,QAAQ,CAACC,IAAI,CAACN,UAAU,CAAC;SACtC,IAAI,CAACJ,YAAY,CAACC,KAAK,EAAE;;MAE1B;;GAGFT,oBAAoB,GACpB;KACC,IAAI,CAAC,IAAI,CAACU,MAAM,EAAE,IAAI,IAAI,CAACC,KAAK,EAAE,IAAI,IAAI,CAACQ,qBAAqB,EAAE,EAClE;OACC,OAAO,IAAI;;KAGZ,MAAMC,eAAe,GAAG,IAAI,CAACC,KAAK,CAACC,OAAO,CAAC,uBAAuB,CAAC,CAAC/D,QAAQ,CAACf,MAAM,GAAG,CAAC;KAEvF,OAAO;OACNyD,KAAK,EAAEC,aAAG,CAACC,UAAU,CAAC,+BAA+B,CAAC;OACtDC,OAAO,EAAE,YAAY;SACpB,IAAI,CAACgB,eAAe,EACpB;WACC,MAAMf,mBAAS,CAACC,QAAQ,CAAC,IAAI,CAACC,OAAO,CAACnD,QAAQ,CAAC;;SAGhD,IAAI,CAACwC,OAAO,CAAC2B,IAAI,CAACC,qBAAS,CAACC,OAAO,CAACP,IAAI,EAAE;WACzCQ,KAAK,EAAEC,8BAAkB,CAACC,aAAa;WACvCC,UAAU,EAAE,IAAI;WAChBzE,QAAQ,EAAE,IAAI,CAACmD,OAAO,CAACnD;UACvB,CAAC;SACF,IAAI,CAACoD,YAAY,CAACC,KAAK,EAAE;;MAE1B;;GAGFC,MAAM,GACN;KACC,OAAO,IAAI,CAACW,KAAK,CAACC,OAAO,CAAC,cAAc,CAAC,CAAC,IAAI,CAACf,OAAO,CAACnD,QAAQ,CAAC;;GAGjEuD,KAAK,GACL;KACC,IAAI,CAAC,IAAI,CAACD,MAAM,EAAE,EAClB;OACC,OAAO,KAAK;;KAGb,MAAMG,IAAiB,GAAG,IAAI,CAACQ,KAAK,CAACC,OAAO,CAAC,WAAW,CAAC,CAAC,IAAI,CAACf,OAAO,CAACnD,QAAQ,CAAC;KAEhF,OAAOyD,IAAI,CAACiB,IAAI,KAAKC,oBAAQ,CAACC,GAAG;;GAGlCb,qBAAqB,GACrB;KACC,OAAO,IAAI,CAACc,gBAAgB,EAAE,KAAKC,MAAM,CAACC,QAAQ,CAAC,IAAI,CAAC5B,OAAO,CAACnD,QAAQ,EAAE,EAAE,CAAC;;CAE/E;;CCnHO,MAAMgF,6BAA6B,GAAG,CAAC;GAAEpF,YAAY;GAAET;CAAY,CAAC,KAAwB;GAClG,IAAIS,YAAY,CAACR,MAAM,GAAG,CAAC,EAC3B;KACC,OAAOQ,YAAY,CAAC,CAAC,CAAC;;GAGvB,IAAIT,WAAW,CAACC,MAAM,GAAG,CAAC,EAC1B;KACC,OAAOD,WAAW,CAAC,CAAC,CAAC;;GAGtB,OAAO,IAAI;CACZ,CAAC;;CCZD,MAAM8F,sBAAsB,GAAG,CAAC;AAEhC,CAAO,MAAMC,eAAe,GAAG,MAAc;GAC5C,MAAMC,QAAQ,GAAGC,mBAAS,CAACC,WAAW,CAAC,wBAAwB,CAAC;GAEhE,OAAOF,QAAQ,CAACG,GAAG,CAAC,cAAc,EAAEL,sBAAsB,CAAC;CAC5D,CAAC;;CCNM,MAAMM,gBAAgB,GAAG,CAC/BC,aAAiC,EACjCC,QAA4B,KACJ;GACxB,MAAMC,WAAW,GAAG,CAAC,GAAGF,aAAa,EAAE,GAAGC,QAAQ,CAAC,CAACnE,GAAG,CAAEC,IAAI,IAAK;KACjE,OAAO,CAACA,IAAI,CAACvB,QAAQ,EAAEuB,IAAI,CAAC;IAC5B,CAAC;GACF,MAAMoE,MAAM,GAAG,IAAI9G,GAAG,CAAC6G,WAAW,CAAC;GAEnC,OAAO,CAAC,GAAGC,MAAM,CAACjG,MAAM,EAAE,CAAC;CAC5B,CAAC;;CCVD;AACA,CAAO,MAAMkG,UAAU,GAAG;GACzBC,IAAI,EAAE,YAAY;GAClBC,QAAQ,EACR;KACCjD,KAAK,GACL;OACC,OAAO,IAAI,CAACkD,OAAO,CAACjD,GAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC;MAChE;KACDiD,QAAQ,GACR;OACC,OAAO,IAAI,CAACD,OAAO,CAACjD,GAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;;IAE7E;GACDkD,QAAQ,EAAG;;;;;;;;;;;CAWZ,CAAC;;CCbD,MAAMC,kBAAkB,GAAG;GAC1B,CAACC,oBAAQ,CAACC,WAAW,GAAGtD,aAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;GAChF,CAACoD,oBAAQ,CAACE,cAAc,GAAGvD,aAAG,CAACC,UAAU,CAAC,wCAAwC,CAAC;GACnF,CAACoD,oBAAQ,CAACG,OAAO,GAAGxD,aAAG,CAACC,UAAU,CAAC,2CAA2C,CAAC;GAC/E,CAACoD,oBAAQ,CAACI,MAAM,GAAGzD,aAAG,CAACC,UAAU,CAAC,4BAA4B,CAAC;GAC/DyD,OAAO,EAAE1D,aAAG,CAACC,UAAU,CAAC,mCAAmC;CAC5D,CAAC;;CAED;AACA,CAAO,MAAM0D,UAAU,GAAG;GACzBZ,IAAI,EAAE,YAAY;GAClBa,UAAU,EAAE;iBAAEC,0CAAU;gCAAEC;IAA2B;GACrDC,KAAK,EAAE;KACN7G,QAAQ,EAAE;OACT0E,IAAI,EAAEoC,MAAM;OACZC,QAAQ,EAAE;MACV;KACDtF,WAAW,EAAE;OACZiD,IAAI,EAAEoC,MAAM;OACZN,OAAO,EAAE;MACT;KACDQ,QAAQ,EAAE;OACTtC,IAAI,EAAEuC,OAAO;OACbT,OAAO,EAAE;MACT;KACDU,QAAQ,EAAE;OACTxC,IAAI,EAAEuC,OAAO;OACbF,QAAQ,EAAE;MACV;KACDvH,KAAK,EAAE;OACNkF,IAAI,EAAEoC,MAAM;OACZN,OAAO,EAAE;MACT;KACDW,gBAAgB,EAAE;OACjBzC,IAAI,EAAEuC,OAAO;OACbT,OAAO,EAAE;;IAEV;GACDY,KAAK,EAAE,CAAC,WAAW,EAAE,iBAAiB,CAAC;GACvCtB,QAAQ,EACR;KACCuB,UAAU,EAAE,MAAMA,0CAAU;KAC5BtG,MAAM,GACN;OACC,OAAO,IAAI,CAACuG,MAAM,CAACpD,OAAO,CAAC,WAAW,CAAC,CAAC,IAAI,CAAClE,QAAQ,EAAE,IAAI,CAAC;MAC5D;KACDuH,MAAM,GACN;OACC,OAAO,CAAC,IAAI,CAACjE,MAAM;MACnB;KACDA,MAAM,GACN;OACC,OAAO,IAAI,CAACvC,MAAM,CAAC2D,IAAI,KAAKyB,oBAAQ,CAAC1C,IAAI;MACzC;KACD+D,OAAO,GACP;OACC,IAAI,CAAC,IAAI,CAACL,gBAAgB,EAC1B;SACC,OAAO,KAAK;;OAGb,OAAO,IAAI,CAACG,MAAM,CAACpD,OAAO,CAAC,eAAe,CAAC,CAAC,IAAI,CAAClE,QAAQ,CAAC;MAC1D;KACDyH,UAAU,GACV;OACC,IAAI,CAAC,IAAI,CAACN,gBAAgB,EAC1B;SACC,OAAO,EAAE;;OAGV,OAAO,IAAI,CAACK,OAAO,GAAGE,8CAAc,CAACC,KAAK,GAAG,EAAE;MAC/C;KACDC,SAAS,GACT;OACC,IAAI,CAAC,IAAI,CAACT,gBAAgB,EAC1B;SACC,OAAO,EAAE;;OAGV,OAAO,IAAI,CAACK,OAAO,GAAGK,gDAAa,CAACF,KAAK,GAAG,EAAE;MAC9C;KACDG,QAAQ,GACR;OACC,IAAI,CAAC,IAAI,CAACxE,MAAM,EAChB;SACC,OAAO,EAAE;;OAGV,OAAO,IAAI,CAACgE,MAAM,CAACpD,OAAO,CAAC,mBAAmB,CAAC,CAAC,IAAI,CAAClE,QAAQ,CAAC;MAC9D;KACD+H,YAAY,GACZ;OACC,IAAI,CAAC,IAAI,CAACD,QAAQ,EAClB;SACC,OAAO,IAAI,CAACE,GAAG,CAAC,mCAAmC,CAAC;;OAGrD,OAAOC,uCAAa,CAACC,cAAI,CAACC,MAAM,CAAC,IAAI,CAACL,QAAQ,CAAC,EAAE,IAAI,CAACtI,KAAK,CAAC;MAC5D;KACD4I,YAAY,GACZ;OAAA;OACC,gCAAOlC,kBAAkB,CAAC,IAAI,CAACnF,MAAM,CAAC2D,IAAI,CAAC,oCAAIwB,kBAAkB,CAACM,OAAO;MACzE;KACD6B,QAAQ,GACR;OACC,IAAI,IAAI,CAACb,OAAO,EAChB;SACC,OAAO,IAAI,CAACc,SAAS;;OAGtB,OAAO,IAAI,CAAChF,MAAM,GAAG,IAAI,CAACyE,YAAY,GAAG,IAAI,CAACK,YAAY;MAC1D;KACDG,gBAAgB,GAChB;OACC,IAAI,IAAI,CAACf,OAAO,EAChB;SACC,OAAO,IAAI,CAACc,SAAS;;OAGtB,OAAO,IAAI,CAAChF,MAAM,GAAG,IAAI,CAACwE,QAAQ,GAAG,IAAI,CAACM,YAAY;MACtD;KACDE,SAAS,GACT;OACC,OAAO,IAAI,CAACN,GAAG,CAAC,mCAAmC,CAAC;MACpD;KACDQ,aAAa,GACb;OACC,IAAI,CAAC,IAAI,CAAC/G,WAAW,EACrB;SACC,OAAO,IAAI;;OAEZ,MAAMgH,IAAI,GAAGtH,qBAAK,CAACsH,IAAI,CAACC,IAAI,CAAC,IAAI,CAACjH,WAAW,CAAC;OAE9C,OAAO,IAAI,CAACkH,UAAU,CAACF,IAAI,CAAC;;IAE7B;GACDG,OAAO,EACP;KACC5F,OAAO,CAAC6F,KAAmB,EAC3B;OACC,IAAI,CAACC,KAAK,CAAC,WAAW,EAAE;SACvB9I,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvB+I,WAAW,EAAEF;QACb,CAAC;MACF;KACDG,YAAY,CAACH,KAAmB,EAChC;OACC,IAAIA,KAAK,CAACI,MAAM,IAAIJ,KAAK,CAACK,QAAQ,EAClC;SACC;;OAGD,IAAI,CAACJ,KAAK,CAAC,iBAAiB,EAAE;SAAE9I,QAAQ,EAAE,IAAI,CAACA,QAAQ;SAAE+I,WAAW,EAAEF;QAAO,CAAC;MAC9E;KACDF,UAAU,CAACF,IAAU,EACrB;OACC,OAAOU,qCAAa,CAACC,gBAAgB,CAACX,IAAI,EAAEY,oCAAY,CAACC,MAAM,CAAC;MAChE;KACDtB,GAAG,CAACuB,UAAkB,EACtB;OACC,OAAO,IAAI,CAACxD,OAAO,CAACjD,GAAG,CAACC,UAAU,CAACwG,UAAU,CAAC;;IAE/C;GACDtD,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAgCZ,CAAC;;CCzMD;AACA,CAAO,MAAMuD,OAAO,GAAG;GACtB3D,IAAI,EAAE,SAAS;GACfuB,KAAK,EAAE,CAAC,WAAW,CAAC;GACpBtB,QAAQ,EACR;KACC9F,QAAQ,GACR;OACC,OAAOyJ,2BAAI,CAACC,SAAS,EAAE,CAAClI,QAAQ,EAAE;MAClC;KACDqE,IAAI,GACJ;OACC,OAAO,IAAI,CAACE,OAAO,CAACjD,GAAG,CAACC,UAAU,CAAC,oBAAoB,CAAC;;IAEzD;GACD4G,OAAO,GACP;KACC,IAAI,CAACC,kBAAkB,GAAG,IAAI5H,iBAAiB,CAAC;OAAEQ,OAAO,EAAE,IAAI,CAACqH,UAAU;MAAI,CAAC;IAC/E;GACDC,aAAa,GACb;KACC,IAAI,CAACF,kBAAkB,CAACG,OAAO,EAAE;IACjC;GACDnB,OAAO,EACP;KACC5F,OAAO,CAAC6F,KAAK,EACb;OACC,IAAI,CAACC,KAAK,CAAC,WAAW,EAAE;SACvB9I,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvB+I,WAAW,EAAEF;QACb,CAAC;MACF;KACDgB,UAAU,GACV;OACC,OAAO,IAAI,CAAC9D,OAAO,CAACiE,YAAY;;IAEjC;GACD/D,QAAQ,EAAG;;;;;;;;;;;;CAYZ,CAAC;;CC/CD;AACA,CAAO,MAAMgE,YAAY,GAAG;GAC3BpE,IAAI,EAAE,cAAc;GACpBa,UAAU,EAAE;iBAAEC;IAAY;GAC1BE,KAAK,EAAE;KACNqD,YAAY,EAAE;OACbxF,IAAI,EAAEoC,MAAM;OACZC,QAAQ,EAAE;MACV;KACDG,QAAQ,EAAE;OACTxC,IAAI,EAAEuC,OAAO;OACbT,OAAO,EAAE;;IAEV;GACDY,KAAK,EAAE,CAAC,WAAW,EAAE,iBAAiB,CAAC;GACvCtB,QAAQ,EACR;KACCuB,UAAU,EAAE,MAAMA,0CAAU;KAC5B5D,IAAI,GACJ;OACC,OAAO,IAAI,CAAC6D,MAAM,CAACpD,OAAO,CAAC,WAAW,CAAC,CAAC,IAAI,CAACgG,YAAY,EAAE,IAAI,CAAC;MAChE;KACDrE,IAAI,GACJ;OAAA;OACC,+BAAO,IAAI,CAACpC,IAAI,CAAC0G,SAAS,mCAAI,IAAI,CAAC1G,IAAI,CAACoC,IAAI;MAC5C;KACDuE,UAAU,GACV;OACC,OAAO,IAAI,CAAC3G,IAAI,CAACiB,IAAI,KAAKC,oBAAQ,CAAC0F,QAAQ;;IAE5C;GACDV,OAAO,GACP;KACC,IAAI,CAACC,kBAAkB,GAAG,IAAI5H,iBAAiB,CAAC;OAAEQ,OAAO,EAAE,IAAI,CAACqH,UAAU;MAAI,CAAC;IAC/E;GACDC,aAAa,GACb;KACC,IAAI,CAACF,kBAAkB,CAACG,OAAO,EAAE;IACjC;GACDnB,OAAO,EACP;KACC5F,OAAO,CAAC6F,KAAK,EACb;OACC,IAAI,CAACC,KAAK,CAAC,WAAW,EAAE;SACvB9I,QAAQ,EAAE,IAAI,CAACkK,YAAY;SAC3BnB,WAAW,EAAEF;QACb,CAAC;MACF;KACDG,YAAY,CAACH,KAAK,EAClB;OACC,IAAIA,KAAK,CAACI,MAAM,IAAIJ,KAAK,CAACK,QAAQ,EAClC;SACC;;OAGD,IAAI,CAACJ,KAAK,CAAC,iBAAiB,EAAE;SAAE9I,QAAQ,EAAE,IAAI,CAACkK,YAAY;SAAEnB,WAAW,EAAEF;QAAO,CAAC;MAClF;KACDgB,UAAU,GACV;OACC,OAAO,IAAI,CAAC9D,OAAO,CAACiE,YAAY;;IAEjC;GACD/D,QAAQ,EAAG;;;;;;;;;;;;;;CAcZ,CAAC;;CC/ED,MAAMqE,gBAAgB,GAAG,CAAC;;CAE1B;AACA,CAAO,MAAMC,mBAAmB,GAAG;GAClC1E,IAAI,EAAE,qBAAqB;GAC3Ba,UAAU,EAAE;KAAEuD,YAAY;KAAET;IAAS;GACrCpC,KAAK,EAAE,CAAC,WAAW,EAAE,iBAAiB,CAAC;GACvCtB,QAAQ,EACR;KACC0E,cAAc,GACd;OACC,OAAOC,wCAAuB,CAAC;SAAEC,aAAa,EAAE;QAAO,CAAC,CAACpJ,GAAG,CAAC,CAAC;SAAEtB;QAAU,KAAKA,QAAQ,CAAC;MACxF;KACDd,KAAK,GACL;OACC,OAAO,IAAI,CAACsL,cAAc,CAACG,KAAK,CAAC,CAAC,EAAEL,gBAAgB,GAAG,CAAC,CAAC;;IAE1D;GACD1B,OAAO,EACP;KACCrB,MAAM,CAACvH,QAAgB,EACvB;OACC,OAAOA,QAAQ,CAAC4K,UAAU,CAAC,MAAM,CAAC;MAClC;KACD5C,GAAG,CAAC6C,GAAW,EACf;OACC,OAAO,IAAI,CAAC9E,OAAO,CAACjD,GAAG,CAACC,UAAU,CAAC8H,GAAG,CAAC;;IAExC;GACD5E,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;CAqBZ,CAAC;;CC9BD;AACA,OAAa6E,UAAU,GAAG;GACzBjF,IAAI,EAAE,YAAY;GAClBa,UAAU,EAAE;yBAAEqE,8DAAkB;KAAEtE,UAAU;KAAEb,UAAU;KAAE2E,mBAAmB;aAAES;IAAQ;GACvFnE,KAAK,EAAE;KACNrH,KAAK,EAAE;OACNkF,IAAI,EAAEoC,MAAM;OACZN,OAAO,EAAE;MACT;KACDyE,UAAU,EAAE;OACXvG,IAAI,EAAEuC,OAAO;OACbF,QAAQ,EAAE;;IAEX;GACDK,KAAK,EAAE,CAAC,SAAS,EAAE,aAAa,CAAC;GACjCtG,IAAI,GACJ;KACC,OAAO;OACNoK,eAAe,EAAE,KAAK;OACtBC,eAAe,EAAE,KAAK;OAEtBC,oBAAoB,EAAE,CAAC;OACvBjM,WAAW,EAAE,EAAE;OACfS,YAAY,EAAE;MACd;IACD;GACDkG,QAAQ,EAAE;KACTuF,UAAU,GACV;OACC,OAAO,IAAI,CAAC7L,KAAK,CAAC8L,IAAI,EAAE,CAACC,WAAW,EAAE;MACtC;KACDC,sBAAsB,GACtB;OACC,OAAO,IAAI,CAACH,UAAU,CAACjM,MAAM,KAAK,CAAC;MACnC;KACDqM,YAAY,GACZ;OACC,OAAO,IAAI,CAAC7L,YAAY,CAACR,MAAM,KAAK,CAAC;;IAEtC;GACDsM,KAAK,EAAE;KACNL,UAAU,CAACM,QAAgB,EAC3B;OACC,IAAIA,QAAQ,CAACvM,MAAM,KAAK,CAAC,EACzB;SACC,IAAI,CAACwM,iBAAiB,EAAE;;OAGzB,IAAI,CAACC,WAAW,CAACF,QAAQ,CAAC;MAC1B;KACDR,eAAe,CAACW,QAAiB,EACjC;OACC,IAAI,CAAChD,KAAK,CAAC,SAAS,EAAEgD,QAAQ,CAAC;MAC/B;KACDb,UAAU,CAACa,QAAiB,EAC5B;OACC,IAAI,CAACA,QAAQ,EACb;SACC,IAAI,CAACC,aAAa,CAACrL,kBAAkB,EAAE;SACvC,KAAK,IAAI,CAACsL,0BAA0B,EAAE;;;IAGxC;GACDrC,OAAO,GACP;KACC,IAAI,CAACC,kBAAkB,GAAG,IAAI5H,iBAAiB,CAAC;OAAEQ,OAAO,EAAE,IAAI,CAACqH,UAAU;MAAI,CAAC;KAE/E,IAAI,CAACkC,aAAa,GAAG,IAAIrN,aAAa,CAAC;OACtCuN,KAAK,EAAE,IAAI;OACXC,KAAK,EAAE;MACP,CAAC;KACF,IAAI,CAACC,qBAAqB,GAAGC,iBAAO,CAACC,QAAQ,CAAC,IAAI,CAACC,cAAc,EAAE,GAAG,EAAE,IAAI,CAAC;KAE7E,IAAI,CAACzC,UAAU,EAAE,CAAC0C,SAAS,CAACnI,qBAAS,CAACzE,MAAM,CAAC6M,UAAU,EAAE,IAAI,CAACC,YAAY,CAAC;KAE3E,KAAK,IAAI,CAACT,0BAA0B,EAAE;IACtC;GACDlC,aAAa,GACb;KACC,IAAI,CAACD,UAAU,EAAE,CAAC6C,WAAW,CAACtI,qBAAS,CAACzE,MAAM,CAAC6M,UAAU,EAAE,IAAI,CAACC,YAAY,CAAC;IAC7E;GACD7D,OAAO,EAAE;KACR,MAAMoD,0BAA0B,GAChC;OACC,IAAI,CAACd,eAAe,GAAG,IAAI;OAC3B,IAAI,CAAC/L,WAAW,GAAG,MAAM,IAAI,CAAC4M,aAAa,CAAC/M,iBAAiB,EAAE;OAC/D,IAAI,CAACkM,eAAe,GAAG,KAAK;MAC5B;KACDW,WAAW,CAACrM,KAAa,EACzB;OACC,IAAIA,KAAK,CAACJ,MAAM,GAAG,CAAC,EACpB;SACC,MAAMuG,MAAM,GAAG,IAAI,CAACoG,aAAa,CAACxM,WAAW,CAACC,KAAK,CAAC;SACpD,IAAIA,KAAK,KAAK,IAAI,CAAC6L,UAAU,EAC7B;WACC;;SAGD,IAAI,CAACzL,YAAY,GAAG+M,2BAAU,CAAChH,MAAM,CAAC;;OAGvC,IAAInG,KAAK,CAACJ,MAAM,IAAI8F,eAAe,EAAE,EACrC;SACC,IAAI,CAACiG,eAAe,GAAG,IAAI;SAC3B,IAAI,CAACgB,qBAAqB,CAAC3M,KAAK,CAAC;;MAElC;KACDoM,iBAAiB,GACjB;OACC,IAAI,CAAChM,YAAY,GAAG,EAAE;OACtB,IAAI,CAACmM,aAAa,CAACrL,kBAAkB,EAAE;MACvC;KACD,MAAM4L,cAAc,CAAC9M,KAAa,EAClC;OACC,IAAI,CAAC4L,oBAAoB,EAAE;OAE3B,MAAMxL,YAAY,GAAG,MAAM,IAAI,CAACmM,aAAa,CAACpM,MAAM,CAACH,KAAK,CAAC;OAC3D,IAAIA,KAAK,KAAK,IAAI,CAAC6L,UAAU,EAC7B;SACC,IAAI,CAACuB,UAAU,EAAE;SAEjB;;OAED,MAAMlH,WAAW,GAAGH,gBAAgB,CAAC,IAAI,CAAC3F,YAAY,EAAEA,YAAY,CAAC;OACrE,IAAI,CAACA,YAAY,GAAG+M,2BAAU,CAACjH,WAAW,CAAC;OAC3C,IAAI,CAACkH,UAAU,EAAE;MACjB;KACDA,UAAU,GACV;OACC,IAAI,CAACxB,oBAAoB,EAAE;OAC3B,IAAI,IAAI,CAACA,oBAAoB,GAAG,CAAC,EACjC;SACC;;OAGD,IAAI,CAACD,eAAe,GAAG,KAAK;MAC5B;KACD0B,iBAAiB,CAAChE,KAAK,EACvB;OACC,MAAM;SAAE7I,QAAQ;SAAE+I;QAAa,GAAGF,KAAK;OACvC,IAAI1H,qBAAK,CAAC0J,GAAG,CAACiC,aAAa,CAAC/D,WAAW,CAAC,EACxC;SACC;;OAGD,IAAI,CAACa,kBAAkB,CAACmD,QAAQ,CAAC;SAAE/M;QAAU,EAAE+I,WAAW,CAACiE,aAAa,CAAC;MACzE;KACDC,QAAQ,GACR;OACC,IAAI,CAACrD,kBAAkB,CAACG,OAAO,EAAE;MACjC;KACD,MAAMmD,WAAW,CAACrE,KAAqD,EACvE;OACC,MAAM;SAAE7I,QAAQ;SAAE+I;QAAa,GAAGF,KAAK;OACvC,IAAI,CAACkD,aAAa,CAAC9L,sBAAsB,CAACD,QAAQ,CAAC;OACnD,KAAKiD,mBAAS,CAACC,QAAQ,CAAClD,QAAQ,CAAC;OAEjC,IAAI,CAACmB,qBAAK,CAAC0J,GAAG,CAACiC,aAAa,CAAC/D,WAAW,CAAC,EACzC;SACC,IAAI,CAACD,KAAK,CAAC,aAAa,CAAC;;MAE1B;KACD2D,YAAY,CAAC5D,KAAgB,EAC7B;OACC,IAAI,CAAC,IAAI,CAACoC,UAAU,EACpB;SACC;;OAGD,MAAM;SAAEkC;QAAe,GAAGtE,KAAK,CAACuE,OAAO,EAAE;OAEzC,IAAIjM,qBAAK,CAAC0J,GAAG,CAACwC,aAAa,CAACF,aAAa,EAAE,OAAO,CAAC,EACnD;SACC,IAAI,CAACG,eAAe,CAACzE,KAAK,CAAC;;MAE5B;KACDyE,eAAe,CAACH,aAA4B,EAC5C;OACC,MAAMI,SAA4B,GAAGvI,6BAA6B,CAAC;SAClEpF,YAAY,EAAE,IAAI,CAACA,YAAY;SAC/BT,WAAW,EAAE,IAAI,CAACA;QAClB,CAAC;OACF,IAAI,CAACoO,SAAS,EACd;SACC;;OAGD,KAAK,IAAI,CAACL,WAAW,CAAC;SACrBlN,QAAQ,EAAEuN,SAAS,CAACvN,QAAQ;SAC5B+I,WAAW,EAAEoE;QACb,CAAC;MACF;KACDtD,UAAU,GACV;OACC,OAAO,IAAI,CAAC9D,OAAO,CAACiE,YAAY;MAChC;KACDhC,GAAG,CAAC6C,GAAW,EACf;OACC,OAAO,IAAI,CAAC9E,OAAO,CAACjD,GAAG,CAACC,UAAU,CAAC8H,GAAG,CAAC;;IAExC;GACD5E,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAoCZ,CAAC;;CCnQD;AACA,OAAauH,eAAe,GAAG;GAC9B3H,IAAI,EAAE,iBAAiB;GACvBa,UAAU,EAAE;kBAAE+G;IAAa;GAC3B5G,KAAK,EAAE;KACNoE,UAAU,EAAE;OACXvG,IAAI,EAAEuC,OAAO;OACbF,QAAQ,EAAE;MACV;KACD2G,SAAS,EAAE;OACVhJ,IAAI,EAAEuC,OAAO;OACbF,QAAQ,EAAE;MACV;KACD4G,oBAAoB,EAAE;OACrBjJ,IAAI,EAAE,CAACI,MAAM,EAAE,IAAI,CAAC;OACpB0B,OAAO,EAAE;MACT;KACDoH,QAAQ,EAAE;OACTlJ,IAAI,EAAEuC,OAAO;OACbT,OAAO,EAAE;;IAEV;GACDY,KAAK,EAAE,CAAC,aAAa,EAAE,YAAY,EAAE,cAAc,CAAC;GACpDwB,OAAO,EAAE;KACRiF,YAAY,GACZ;OACC,IAAI,CAAC/E,KAAK,CAAC,YAAY,CAAC;MACxB;KACDgF,OAAO,GACP;OACC,IAAI,CAAChF,KAAK,CAAC,aAAa,CAAC;MACzB;KACDiF,aAAa,CAACvO,KAAa,EAC3B;OACC,IAAI,CAACsJ,KAAK,CAAC,cAAc,EAAEtJ,KAAK,CAAC;MACjC;KACDiN,YAAY,CAAC5D,KAAoB,EACjC;OACC,IAAI,CAACgB,UAAU,EAAE,CAAC1F,IAAI,CAACC,qBAAS,CAACzE,MAAM,CAAC6M,UAAU,EAAE;SAAEW,aAAa,EAAEtE;QAAO,CAAC;MAC7E;KACDgB,UAAU,GACV;OACC,OAAO,IAAI,CAAC9D,OAAO,CAACiE,YAAY;MAChC;KACDhC,GAAG,CAAC6C,GAAW,EACf;OACC,OAAO,IAAI,CAAC9E,OAAO,CAACjD,GAAG,CAACC,UAAU,CAAC8H,GAAG,CAAC;;IAExC;GACD5E,QAAQ,EAAG;;;;;;;;;;;;;;;;CAgBZ,CAAC;;CC9CD;AACA,OAAa+H,SAAS,GAAG;GACxBnI,IAAI,EAAE,WAAW;GACjBa,UAAU,EAAE;yBAAEqE,8DAAkB;KAAEtE,UAAU;KAAEb;IAAY;GAC1DiB,KAAK,EAAE;KACNrH,KAAK,EAAE;OACNkF,IAAI,EAAEoC,MAAM;OACZN,OAAO,EAAE;MACT;KACDxG,QAAQ,EAAE;OACT0E,IAAI,EAAEoC,MAAM;OACZC,QAAQ,EAAE;MACV;KACDkH,aAAa,EAAE;OACdvJ,IAAI,EAAEwJ,KAAK;OACXnH,QAAQ,EAAE,KAAK;OACfP,OAAO,EAAE,MAAM;;IAEhB;GACDY,KAAK,EAAE,CAAC,WAAW,CAAC;GACpBtG,IAAI,GACJ;KACC,OAAO;OACN4M,SAAS,EAAE,KAAK;OAEhBtC,oBAAoB,EAAE,CAAC;OACvBxL,YAAY,EAAE;MACd;IACD;GACDkG,QAAQ,EAAE;KACT0F,sBAAsB,GACtB;OACC,OAAO,IAAI,CAAChM,KAAK,CAACJ,MAAM,KAAK,CAAC;MAC9B;KACDqM,YAAY,GACZ;OACC,OAAO,IAAI,CAAC7L,YAAY,CAACR,MAAM,KAAK,CAAC;;IAEtC;GACDsM,KAAK,EAAE;KACNlM,KAAK,CAACmM,QAAgB,EACtB;OACC,IAAIA,QAAQ,CAACvM,MAAM,KAAK,CAAC,EACzB;SACC,IAAI,CAACwM,iBAAiB,EAAE;;OAGzB,IAAI,CAACC,WAAW,CAACF,QAAQ,CAAC;;IAE3B;GACDhC,OAAO,GACP;KACC,IAAI,CAACoC,aAAa,GAAG,IAAIrN,aAAa,CAAC;OACtCuN,KAAK,EAAE,KAAK;OACZC,KAAK,EAAE;MACP,CAAC;KACF,IAAI,CAACC,qBAAqB,GAAGC,iBAAO,CAACC,QAAQ,CAAC,IAAI,CAACC,cAAc,EAAE,GAAG,EAAE,IAAI,CAAC;KAC7E,IAAI,CAAC6B,iBAAiB,GAAG1D,wCAAuB,CAAC;OAAEC,aAAa,EAAE;MAAM,CAAC;KAEzE,IAAI,CAACb,UAAU,EAAE,CAAC0C,SAAS,CAACnI,qBAAS,CAACzE,MAAM,CAAC6M,UAAU,EAAE,IAAI,CAACC,YAAY,CAAC;IAC3E;GACD3C,aAAa,GACb;KACC,IAAI,CAACD,UAAU,EAAE,CAAC6C,WAAW,CAACtI,qBAAS,CAACzE,MAAM,CAAC6M,UAAU,EAAE,IAAI,CAACC,YAAY,CAAC;IAC7E;GACD7D,OAAO,EAAE;KACRiD,WAAW,CAACrM,KAAa,EACzB;OACC,IAAIA,KAAK,CAACJ,MAAM,GAAG,CAAC,EACpB;SACC,MAAMuG,MAAM,GAAG,IAAI,CAACoG,aAAa,CAACxM,WAAW,CAACC,KAAK,CAAC;SACpD,IAAIA,KAAK,KAAK,IAAI,CAACA,KAAK,EACxB;WACC;;SAGD,IAAI,CAACI,YAAY,GAAG+M,2BAAU,CAAChH,MAAM,CAAC;;OAGvC,IAAInG,KAAK,CAACJ,MAAM,IAAI8F,eAAe,EAAE,EACrC;SACC,IAAI,CAACwI,SAAS,GAAG,IAAI;SACrB,IAAI,CAACvB,qBAAqB,CAAC3M,KAAK,CAAC;;MAElC;KACDoM,iBAAiB,GACjB;OACC,IAAI,CAACG,aAAa,CAACrL,kBAAkB,EAAE;OACvC,IAAI,CAACd,YAAY,GAAG,EAAE;MACtB;KACD,MAAM0M,cAAc,CAAC9M,KAAa,EAClC;OACC,IAAI,CAAC4L,oBAAoB,EAAE;OAE3B,MAAMxL,YAAY,GAAG,MAAM,IAAI,CAACmM,aAAa,CAACpM,MAAM,CAACH,KAAK,CAAC;OAC3D,IAAIA,KAAK,KAAK,IAAI,CAACA,KAAK,EACxB;SACC,IAAI,CAACoN,UAAU,EAAE;SAEjB;;OAED,MAAMlH,WAAW,GAAGH,gBAAgB,CAAC,IAAI,CAAC3F,YAAY,EAAEA,YAAY,CAAC;OACrE,IAAI,CAACA,YAAY,GAAG+M,2BAAU,CAACjH,WAAW,CAAC;OAC3C,IAAI,CAACkH,UAAU,EAAE;MACjB;KACDA,UAAU,GACV;OACC,IAAI,CAACxB,oBAAoB,EAAE;OAC3B,IAAI,IAAI,CAACA,oBAAoB,GAAG,CAAC,EACjC;SACC;;OAGD,IAAI,CAACsC,SAAS,GAAG,KAAK;MACtB;KACD,MAAMR,WAAW,CAACrE,KAAqD,EAAEuF,SAAiB,EAC1F;OACCC,6BAAS,CAAChM,WAAW,EAAE,CAACiM,OAAO,CAACC,4BAA4B,CAAC;SAC5DvO,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvB8H,QAAQ,EAAEsG,SAAS,GAAG;QACtB,CAAC;OACF,IAAI,CAACtF,KAAK,CAAC,WAAW,EAAED,KAAK,CAAC;MAC9B;KACD,MAAM2F,qBAAqB,CAAC3F,KAAqD,EAAEuF,SAAiB,EACpG;OACCC,6BAAS,CAAChM,WAAW,EAAE,CAACiM,OAAO,CAACG,sBAAsB,CAAC;SACtDzO,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvB8H,QAAQ,EAAEsG,SAAS,GAAG;QACtB,CAAC;OACF,IAAI,CAACtF,KAAK,CAAC,WAAW,EAAED,KAAK,CAAC;MAC9B;KACD4D,YAAY,CAAC5D,KAAgB,EAC7B;OACC,MAAM;SAAEsE;QAAe,GAAGtE,KAAK,CAACuE,OAAO,EAAE;OAEzC,IAAIjM,qBAAK,CAAC0J,GAAG,CAACwC,aAAa,CAACF,aAAa,EAAE,OAAO,CAAC,EACnD;SACC,IAAI,CAACG,eAAe,CAACzE,KAAK,CAAC;;MAE5B;KACDyE,eAAe,CAACH,aAA4B,EAC5C;OACC,MAAMI,SAA4B,GAAGvI,6BAA6B,CAAC;SAClEpF,YAAY,EAAE,IAAI,CAACA,YAAY;SAC/BT,WAAW,EAAE,IAAI,CAACgP;QAClB,CAAC;OACF,IAAI,CAACZ,SAAS,EACd;SACC;;OAGD,KAAK,IAAI,CAACL,WAAW,CAAC;SACrBlN,QAAQ,EAAEuN,SAAS,CAACvN,QAAQ;SAC5B+I,WAAW,EAAEoE;QACb,CAAC;MACF;KACDuB,UAAU,CAAC1O,QAAgB,EAC3B;OACC,OAAO,IAAI,CAACiO,aAAa,CAACU,QAAQ,CAAC3O,QAAQ,CAAC;MAC5C;KACD6J,UAAU,GACV;OACC,OAAO,IAAI,CAAC9D,OAAO,CAACiE,YAAY;MAChC;KACDhC,GAAG,CAAC6C,GAAW,EACf;OACC,OAAO,IAAI,CAAC9E,OAAO,CAACjD,GAAG,CAACC,UAAU,CAAC8H,GAAG,CAAC;;IAExC;GACD5E,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAiCZ,CAAC;;CC3MD;AACA,OAAa2I,aAAa,GAAG;GAC5B/I,IAAI,EAAE,eAAe;GACrBa,UAAU,EAAE;yBAAEqE,8DAAkB;KAAEtE,UAAU;KAAEb;IAAY;GAC1DiB,KAAK,EAAE;KACNrH,KAAK,EAAE;OACNkF,IAAI,EAAEoC,MAAM;OACZN,OAAO,EAAE;MACT;KACDxG,QAAQ,EAAE;OACT0E,IAAI,EAAEoC,MAAM;OACZC,QAAQ,EAAE;;IAEX;GACDK,KAAK,EAAE,CAAC,WAAW,EAAE,SAAS,CAAC;GAC/BtG,IAAI,GACJ;KACC,OAAO;OACN4M,SAAS,EAAE,KAAK;OAEhBtC,oBAAoB,EAAE,CAAC;OACvBxL,YAAY,EAAE;MACd;IACD;GACDkG,QAAQ,EAAE;KACT0F,sBAAsB,GACtB;OACC,OAAO,IAAI,CAAChM,KAAK,CAACJ,MAAM,KAAK,CAAC;MAC9B;KACD+O,iBAAiB,GACjB;OACC,MAAMU,cAAc,GAAG,IAAI,CAACC,eAAe,CAACC,MAAM,CAAC,CAAC;SAAE/O;QAAU,KAAK;SACpE,OAAOA,QAAQ,KAAKyJ,2BAAI,CAACC,SAAS,EAAE,CAAClI,QAAQ,EAAE;QAC/C,CAAC;OAEFqN,cAAc,CAACG,OAAO,CAAC;SACtBhP,QAAQ,EAAEyJ,2BAAI,CAACC,SAAS,EAAE,CAAClI,QAAQ,EAAE;SACrCC,WAAW,EAAE;QACb,CAAC;OAEF,OAAOoN,cAAc;MACrB;KACDpD,YAAY,GACZ;OACC,OAAO,IAAI,CAAC7L,YAAY,CAACR,MAAM,KAAK,CAAC;;IAEtC;GACDsM,KAAK,EAAE;KACNlM,KAAK,CAACmM,QAAgB,EACtB;OACC,IAAIA,QAAQ,CAACvM,MAAM,KAAK,CAAC,EACzB;SACC,IAAI,CAACwM,iBAAiB,EAAE;;OAGzB,IAAI,CAACC,WAAW,CAACF,QAAQ,CAAC;MAC1B;KACD+B,SAAS,CAAC5B,QAAiB,EAC3B;OACC,IAAI,CAAChD,KAAK,CAAC,SAAS,EAAEgD,QAAQ,CAAC;;IAEhC;GACDnC,OAAO,GACP;KACC,IAAI,CAACoC,aAAa,GAAG,IAAIrN,aAAa,CAAC;OACtCuN,KAAK,EAAE,IAAI;OACXC,KAAK,EAAE;MACP,CAAC;KACF,IAAI,CAACC,qBAAqB,GAAGC,iBAAO,CAACC,QAAQ,CAAC,IAAI,CAACC,cAAc,EAAE,GAAG,EAAE,IAAI,CAAC;KAC7E,IAAI,CAACwC,eAAe,GAAGG,mCAAkB,CAAC;OAAEvE,aAAa,EAAE;MAAM,CAAC;KAElE,IAAI,CAACb,UAAU,EAAE,CAAC0C,SAAS,CAACnI,qBAAS,CAACzE,MAAM,CAAC6M,UAAU,EAAE,IAAI,CAACC,YAAY,CAAC;IAC3E;GACD3C,aAAa,GACb;KACC,IAAI,CAACD,UAAU,EAAE,CAAC6C,WAAW,CAACtI,qBAAS,CAACzE,MAAM,CAAC6M,UAAU,EAAE,IAAI,CAACC,YAAY,CAAC;IAC7E;GACD7D,OAAO,EAAE;KACRiD,WAAW,CAACrM,KAAa,EACzB;OACC,IAAIA,KAAK,CAACJ,MAAM,GAAG,CAAC,EACpB;SACC,MAAMuG,MAAM,GAAG,IAAI,CAACoG,aAAa,CAACxM,WAAW,CAACC,KAAK,CAAC;SACpD,IAAIA,KAAK,KAAK,IAAI,CAACA,KAAK,EACxB;WACC;;SAGD,IAAI,CAACI,YAAY,GAAG+M,2BAAU,CAAChH,MAAM,CAAC;;OAGvC,IAAInG,KAAK,CAACJ,MAAM,IAAI8F,eAAe,EAAE,EACrC;SACC,IAAI,CAACwI,SAAS,GAAG,IAAI;SACrB,IAAI,CAACvB,qBAAqB,CAAC3M,KAAK,CAAC;;MAElC;KACDoM,iBAAiB,GACjB;OACC,IAAI,CAAChM,YAAY,GAAG,EAAE;OACtB,IAAI,CAACmM,aAAa,CAACrL,kBAAkB,EAAE;MACvC;KACD,MAAM4L,cAAc,CAAC9M,KAAa,EAClC;OACC,IAAI,CAAC4L,oBAAoB,EAAE;OAE3B,MAAMxL,YAAY,GAAG,MAAM,IAAI,CAACmM,aAAa,CAACpM,MAAM,CAACH,KAAK,CAAC;OAC3D,IAAIA,KAAK,KAAK,IAAI,CAACA,KAAK,EACxB;SACC,IAAI,CAACoN,UAAU,EAAE;SAEjB;;OAED,MAAMlH,WAAW,GAAGH,gBAAgB,CAAC,IAAI,CAAC3F,YAAY,EAAEA,YAAY,CAAC;OACrE,IAAI,CAACA,YAAY,GAAG+M,2BAAU,CAACjH,WAAW,CAAC;OAC3C,IAAI,CAACkH,UAAU,EAAE;MACjB;KACDA,UAAU,GACV;OACC,IAAI,CAACxB,oBAAoB,EAAE;OAC3B,IAAI,IAAI,CAACA,oBAAoB,GAAG,CAAC,EACjC;SACC;;OAGD,IAAI,CAACsC,SAAS,GAAG,KAAK;MACtB;KACD,MAAMR,WAAW,CAACrE,KAAqD,EAAEuF,SAAiB,EAC1F;OACCC,6BAAS,CAAChM,WAAW,EAAE,CAAC6M,cAAc,CAACC,iCAAiC,CAAC;SACxEnP,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvB8H,QAAQ,EAAEsG,SAAS,GAAG;QACtB,CAAC;OACF,IAAI,CAACtF,KAAK,CAAC,WAAW,EAAED,KAAK,CAAC;MAC9B;KACD,MAAMuG,iBAAiB,CAACvG,KAAqD,EAAEuF,SAAiB,EAChG;OACCC,6BAAS,CAAChM,WAAW,EAAE,CAAC6M,cAAc,CAACG,2BAA2B,CAAC;SAClErP,QAAQ,EAAE,IAAI,CAACA,QAAQ;SACvB8H,QAAQ,EAAEsG,SAAS,GAAG;QACtB,CAAC;OACF,IAAI,CAACtF,KAAK,CAAC,WAAW,EAAED,KAAK,CAAC;MAC9B;KACD4D,YAAY,CAAC5D,KAAgB,EAC7B;OACC,MAAM;SAAEsE;QAAe,GAAGtE,KAAK,CAACuE,OAAO,EAAE;OAEzC,IAAIjM,qBAAK,CAAC0J,GAAG,CAACwC,aAAa,CAACF,aAAa,EAAE,OAAO,CAAC,EACnD;SACC,IAAI,CAACG,eAAe,CAACzE,KAAK,CAAC;;MAE5B;KACDyE,eAAe,CAACH,aAA4B,EAC5C;OACC,MAAMI,SAA4B,GAAGvI,6BAA6B,CAAC;SAClE7F,WAAW,EAAE,IAAI,CAACgP,iBAAiB;SACnCvO,YAAY,EAAE,IAAI,CAACA;QACnB,CAAC;OACF,IAAI,CAAC2N,SAAS,EACd;SACC;;OAGD,KAAK,IAAI,CAACL,WAAW,CAAC;SACrBlN,QAAQ,EAAEuN,SAAS,CAACvN,QAAQ;SAC5B+I,WAAW,EAAEoE;QACb,CAAC;MACF;KACDtD,UAAU,GACV;OACC,OAAO,IAAI,CAAC9D,OAAO,CAACiE,YAAY;MAChC;KACDhC,GAAG,CAAC6C,GAAW,EACf;OACC,OAAO,IAAI,CAAC9E,OAAO,CAACjD,GAAG,CAACC,UAAU,CAAC8H,GAAG,CAAC;;IAExC;GACD5E,QAAQ,EAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CA+BZ,CAAC;;;;;;;;;;;"}