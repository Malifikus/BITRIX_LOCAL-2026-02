this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};this.BX.Messenger.v2.Component=this.BX.Messenger.v2.Component||{};(function(e,t,s,o,i,n,a,r,l,d){"use strict";const b={name:"KeyboardButton",props:{config:{type:Object,required:true},keyboardBlocked:{type:Boolean,required:true}},emits:["action","customCommand","blockKeyboard"],data(){return{}},computed:{button(){return this.config},commonAttributes(){return{class:["bx-im-keyboard-button__container",this.buttonClasses],style:this.buttonStyles}},buttonClasses(){const{bgColorToken:e=d.ColorToken.base,display:t,disabled:s,wait:o}=this.button;const i=t===d.KeyboardButtonDisplay.block?"--block":"--line";const n=[i,e];if(this.keyboardBlocked||s){n.push("--disabled")}if(o){n.push("--loading")}return n},buttonStyles(){const e={};const{width:t}=this.button;if(t){e.width=`${t}px`}return e},preparedLink(){if(!this.button.link){return""}return t.Text.decode(this.button.link)}},methods:{onClick(e){if(this.keyboardBlocked||this.button.disabled||this.button.wait){e.preventDefault();return}if(this.button.link){return}if(this.button.action&&this.button.actionValue){this.handleAction()}else if(this.button.appId){s.Logger.warn("Messenger keyboard: open app is not implemented.")}else if(this.button.command){this.handleCustomCommand()}},handleAction(){this.$emit("action",{action:this.button.action,payload:this.button.actionValue})},handleCustomCommand(){if(this.button.block){this.$emit("blockKeyboard")}this.button.wait=true;this.$emit("customCommand",{botId:this.button.botId,command:this.button.command,payload:this.button.commandParams})}},template:`\n\t\t<a\n\t\t\tv-if="button.link"\n\t\t\t:href="preparedLink"\n\t\t\ttarget="_blank"\n\t\t\tv-bind="commonAttributes"\n\t\t\t@click="onClick"\n\t\t>\n\t\t\t{{ button.text }}\n\t\t</a>\n\t\t<div\n\t\t\tv-else\n\t\t\tv-bind="commonAttributes"\n\t\t\t@click="onClick"\n\t\t>\n\t\t\t{{ button.text }}\n\t\t</div>\n\t`};const c={name:"KeyboardSeparator",data(){return{}},template:`\n\t\t<div class="bx-im-keyboard-button__separator"></div>\n\t`};var u=babelHelpers.classPrivateFieldLooseKey("dialogId");var h=babelHelpers.classPrivateFieldLooseKey("emitter");var p=babelHelpers.classPrivateFieldLooseKey("actionHandlers");var v=babelHelpers.classPrivateFieldLooseKey("sendMessage");var m=babelHelpers.classPrivateFieldLooseKey("insertText");var y=babelHelpers.classPrivateFieldLooseKey("startCall");var B=babelHelpers.classPrivateFieldLooseKey("copyText");var g=babelHelpers.classPrivateFieldLooseKey("openChat");class k{constructor(e){Object.defineProperty(this,g,{value:M});Object.defineProperty(this,B,{value:L});Object.defineProperty(this,y,{value:P});Object.defineProperty(this,m,{value:C});Object.defineProperty(this,v,{value:f});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,h,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:{[d.KeyboardButtonAction.send]:babelHelpers.classPrivateFieldLooseBase(this,v)[v].bind(this),[d.KeyboardButtonAction.put]:babelHelpers.classPrivateFieldLooseBase(this,m)[m].bind(this),[d.KeyboardButtonAction.call]:babelHelpers.classPrivateFieldLooseBase(this,y)[y].bind(this),[d.KeyboardButtonAction.copy]:babelHelpers.classPrivateFieldLooseBase(this,B)[B].bind(this),[d.KeyboardButtonAction.dialog]:babelHelpers.classPrivateFieldLooseBase(this,g)[g].bind(this)}});const{dialogId:t,context:{emitter:s}}=e;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=t;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=s}handleAction(e){const{action:t,payload:s}=e;if(!babelHelpers.classPrivateFieldLooseBase(this,p)[p][t]){console.error("Keyboard: action not found")}babelHelpers.classPrivateFieldLooseBase(this,p)[p][t](s)}}function f(e){n.SendingService.getInstance().sendMessage({text:e,dialogId:babelHelpers.classPrivateFieldLooseBase(this,u)[u]})}function C(e){babelHelpers.classPrivateFieldLooseBase(this,h)[h].emit(d.EventType.textarea.insertText,{text:e,dialogId:babelHelpers.classPrivateFieldLooseBase(this,u)[u]})}function P(e){void a.PhoneManager.getInstance().startCall(e)}function L(e){var t;if((t=BX.clipboard)!=null&&t.copy(e)){r.Notifier.onCopyTextComplete()}}function M(e){void i.Messenger.openChat(e)}var K=babelHelpers.classPrivateFieldLooseKey("messageId");var H=babelHelpers.classPrivateFieldLooseKey("dialogId");class F{constructor(e){Object.defineProperty(this,K,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});const{messageId:t,dialogId:s}=e;babelHelpers.classPrivateFieldLooseBase(this,K)[K]=t;babelHelpers.classPrivateFieldLooseBase(this,H)[H]=s}sendCommand(e){const{botId:t,command:s,payload:o}=e;const i={MESSAGE_ID:babelHelpers.classPrivateFieldLooseBase(this,K)[K],DIALOG_ID:babelHelpers.classPrivateFieldLooseBase(this,H)[H],BOT_ID:t,COMMAND:s,COMMAND_PARAMS:o};l.Core.getRestClient().callMethod(d.RestMethod.imMessageCommand,i).catch((e=>{console.error("BotService: error sending command:",e.error())}))}}const I={props:{buttons:{type:Array,required:true},dialogId:{type:String,required:true},messageId:{type:[Number,String],required:true}},components:{KeyboardButton:b,KeyboardSeparator:c},data(){return{keyboardBlocked:false}},emits:["click"],watch:{buttons(){this.keyboardBlocked=false}},computed:{ButtonType:()=>d.KeyboardButtonType,preparedButtons(){return this.buttons.filter((e=>e.context!==d.KeyboardButtonContext.mobile))}},methods:{onButtonActionClick(e){this.getActionManager().handleAction(e)},onButtonCustomCommandClick(e){this.getBotService().sendCommand(e)},getActionManager(){if(!this.actionManager){this.actionManager=new k({dialogId:this.dialogId,context:{emitter:this.getEmitter()}})}return this.actionManager},getBotService(){if(!this.botService){this.botService=new F({messageId:this.messageId,dialogId:this.dialogId})}return this.botService},getEmitter(){return this.$Bitrix.eventEmitter}},template:`\n\t\t<div class="bx-im-keyboard__container">\n\t\t\t<template v-for="button in preparedButtons">\n\t\t\t\t<KeyboardButton\n\t\t\t\t\tv-if="button.type === ButtonType.button"\n\t\t\t\t\t:config="button"\n\t\t\t\t\t:keyboardBlocked="keyboardBlocked"\n\t\t\t\t\t@blockKeyboard="keyboardBlocked = true"\n\t\t\t\t\t@action="onButtonActionClick"\n\t\t\t\t\t@customCommand="onButtonCustomCommandClick"\n\t\t\t\t/>\n\t\t\t\t<KeyboardSeparator v-else-if="button.type === ButtonType.newLine" />\n\t\t\t</template>\n\t\t</div>\n\t`};e.Keyboard=I})(this.BX.Messenger.v2.Component.Elements=this.BX.Messenger.v2.Component.Elements||{},BX,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Service,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Application,BX.Messenger.v2.Const);
//# sourceMappingURL=keyboard.bundle.map.js