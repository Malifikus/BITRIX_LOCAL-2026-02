this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,i,s,o,a,n,r,l,c,d,u,m){"use strict";const g=e=>m.Type.isNumber(e)||m.Type.isString(e);const h=e=>e.toString();const f=e=>Number.parseInt(e,10);const p=e=>r.Utils.date.cast(e,false);const y=/(_[\da-z])/gi;const I=e=>{const t={};Object.entries(e).forEach((([e,i])=>{const s=F(e);if(m.Type.isPlainObject(i)){t[s]=I(i);return}if(m.Type.isArray(i)){t[s]=N(i);return}t[s]=i}));return t};const F=e=>{let t=e;if(t.search(y)!==-1){t=t.toLowerCase()}return m.Text.toCamelCase(t)};const N=e=>e.map((e=>{if(!m.Type.isPlainObject(e)){return e}return I(e)}));const b={tasks:2600,calendar:2500,im:2400,blog:2300,vote:2200,main:2100,socialnetwork:2e3,bizproc:1900,rpa:1800,lists:1700,mail:1600,crm:1500,sender:1400,booking:1300,voximplant:1200,imopenlines:1100,timeman:1e3,disk:900,bitrix24:800,sign:700,biconnector:600,rest:500,intranet:400,photogallery:300,wiki:200,forum:100};const C=e=>{const t={};const i=S(e);i.forEach((e=>{const i={};e.notices.forEach((e=>{i[e.id]=e}));t[e.id]={id:e.id,label:e.label,items:i}}));return t};const S=e=>[...e].sort(((e,t)=>{var i,s;const o=(i=b[e.id])!=null?i:0;const a=(s=b[t.id])!=null?s:0;return a-o}));const T=[{fieldName:l.Settings.notification.enableSound,targetFieldName:l.Settings.notification.enableSound,checkFunction:m.Type.isBoolean},{fieldName:l.Settings.notification.enableAutoRead,targetFieldName:l.Settings.notification.enableAutoRead,checkFunction:m.Type.isBoolean},{fieldName:l.Settings.notification.mode,targetFieldName:l.Settings.notification.mode,checkFunction:m.Type.isString},{fieldName:l.Settings.notification.enableWeb,targetFieldName:l.Settings.notification.enableWeb,checkFunction:m.Type.isBoolean},{fieldName:l.Settings.notification.enableMail,targetFieldName:l.Settings.notification.enableMail,checkFunction:m.Type.isBoolean},{fieldName:l.Settings.notification.enablePush,targetFieldName:l.Settings.notification.enablePush,checkFunction:m.Type.isBoolean},{fieldName:"notifications",targetFieldName:"notifications",checkFunction:m.Type.isArray,formatFunction:C},{fieldName:l.Settings.message.bigSmiles,targetFieldName:l.Settings.message.bigSmiles,checkFunction:m.Type.isBoolean},{fieldName:l.Settings.appearance.background,targetFieldName:l.Settings.appearance.background,checkFunction:g,formatFunction:f},{fieldName:l.Settings.appearance.alignment,targetFieldName:l.Settings.appearance.alignment,checkFunction:m.Type.isString},{fieldName:l.Settings.recent.showBirthday,targetFieldName:l.Settings.recent.showBirthday,checkFunction:m.Type.isBoolean},{fieldName:l.Settings.recent.showInvited,targetFieldName:l.Settings.recent.showInvited,checkFunction:m.Type.isBoolean},{fieldName:l.Settings.recent.showLastMessage,targetFieldName:l.Settings.recent.showLastMessage,checkFunction:m.Type.isBoolean},{fieldName:l.Settings.hotkey.sendByEnter,targetFieldName:l.Settings.hotkey.sendByEnter,checkFunction:m.Type.isString,formatFunction:e=>e==="1"},{fieldName:l.Settings.hotkey.sendByEnter,targetFieldName:l.Settings.hotkey.sendByEnter,checkFunction:m.Type.isBoolean},{fieldName:l.Settings.desktop.enableRedirect,targetFieldName:l.Settings.desktop.enableRedirect,checkFunction:m.Type.isBoolean},{fieldName:l.Settings.user.status,targetFieldName:l.Settings.user.status,checkFunction:m.Type.isString}];const v=(e,t)=>{const i={};const s=I(e);t.forEach((t=>{const{fieldName:o,targetFieldName:a,checkFunction:n,formatFunction:r}=t;const l=k(s,o);if(!l){return}if(!P(s[l],n)){return}i[a]=L({fieldValue:s[l],formatFunction:r,currentResult:i,rawFields:e})}));return i};const k=(e,t)=>{let i=t;if(m.Type.isStringFilled(i)){i=[i]}for(const t of i){if(!m.Type.isUndefined(e[t])){return t}}return null};const P=(e,t)=>{let i=t;if(m.Type.isUndefined(i)){return true}if(m.Type.isFunction(i)){i=[i]}return i.some((t=>t(e)))};const L=e=>{const{fieldValue:t,formatFunction:i,currentResult:s,rawFields:o}=e;if(m.Type.isUndefined(i)){return t}return i(t,s,o)};class M extends d.BuilderModel{getState(){return{[l.Settings.appearance.background]:1,[l.Settings.appearance.alignment]:l.DialogAlignment.left,[l.Settings.notification.enableSound]:true,[l.Settings.notification.enableAutoRead]:true,[l.Settings.notification.mode]:l.NotificationSettingsMode.simple,[l.Settings.notification.enableWeb]:true,[l.Settings.notification.enableMail]:true,[l.Settings.notification.enablePush]:true,notifications:{},[l.Settings.message.bigSmiles]:true,[l.Settings.recent.showBirthday]:true,[l.Settings.recent.showInvited]:true,[l.Settings.recent.showLastMessage]:true,[l.Settings.desktop.enableRedirect]:true}}getGetters(){return{get:e=>t=>e[t]}}getActions(){return{set:(e,t)=>{e.commit("set",this.formatFields(t))},setNotificationOption:(e,t)=>{e.commit("setNotificationOption",t)}}}getMutations(){return{set:(e,t)=>{Object.entries(t).forEach((([t,i])=>{e[t]=i}))},setNotificationOption:(e,t)=>{var i;const{moduleId:s,optionName:o,type:a,value:n}=t;const r=e.notifications[s];if(!(r!=null&&(i=r.items)!=null&&i[o])){return}r.items[o][a]=n}}}formatFields(e){return v(e,T)}}const E=[{fieldName:"fullChatHistory",targetFieldName:"fullChatHistory",checkFunction:m.Type.isPlainObject}];class B extends d.BuilderModel{getState(){return{fullChatHistory:{isAvailable:true,limitDays:null}}}getGetters(){return{get:e=>e,isHistoryAvailable:e=>{var t,i;return(t=(i=e.fullChatHistory)==null?void 0:i.isAvailable)!=null?t:false}}}getActions(){return{set:(e,t)=>{e.commit("set",this.formatFields(t))}}}getMutations(){return{set:(e,t)=>{Object.entries(t).forEach((([t,i])=>{e[t]=i}))}}}formatFields(e){return v(e,E)}}class x extends d.BuilderModel{getName(){return"application"}getNestedModules(){return{settings:M,tariffRestrictions:B}}getState(){return{layout:{name:l.Layout.chat,entityId:"",contextId:0}}}getGetters(){return{getLayout:e=>e.layout,isChatOpen:e=>t=>{if(!i.LayoutManager.getInstance().isChatLayout(e.layout.name)){return false}return e.layout.entityId===t.toString()},isLinesChatOpen:e=>t=>{if(e.layout.name!==l.Layout.openlines&&e.layout.name!==l.Layout.openlinesV2){return false}return e.layout.entityId===t.toString()},areNotificationsOpen:e=>e.layout.name===l.Layout.notification}}getActions(){return{setLayout:(e,i)=>{const{name:s,entityId:o="",contextId:a=0}=i;if(!m.Type.isStringFilled(s)){return}const n={...e.state.layout};const r={name:this.validateLayout(s),entityId:this.validateLayoutEntityId(s,o),contextId:a};t.EventEmitter.emit(l.EventType.layout.onLayoutChange,{from:n,to:r});if(n.name===r.name&&n.entityId===r.entityId){return}e.commit("updateLayout",{layout:r})}}}getMutations(){return{updateLayout:(e,t)=>{e.layout={...e.layout,...t.layout}}}}validateLayout(e){if(!i.LayoutManager.getInstance().isValidLayout(e)){return l.Layout.chat}return e}validateLayoutEntityId(e,t){if(!i.LayoutManager.getInstance().isValidLayout(e)){return""}return t}}const A=e=>{const t=Object.values(l.MessageComponent);if(!t.includes(e)){return l.MessageComponent.unsupported}return e};const H=(e,t,i)=>{if(m.Type.isString(i.system)&&i.system==="Y"){return 0}if(m.Type.isBoolean(i.isSystem)&&i.isSystem===true){return 0}return f(e)};const w=e=>e.map((e=>({...e,block:e.block==="Y",disabled:e.disabled==="Y",vote:e.vote==="Y",wait:e.wait==="Y"})));const O=[{fieldName:["id","temporaryId"],targetFieldName:"id",checkFunction:[m.Type.isNumber,r.Utils.text.isTempMessage]},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:g,formatFunction:f},{fieldName:"date",targetFieldName:"date",checkFunction:[m.Type.isString,m.Type.isDate],formatFunction:r.Utils.date.cast},{fieldName:"text",targetFieldName:"text",checkFunction:g,formatFunction:h},{fieldName:["senderId","authorId"],targetFieldName:"authorId",checkFunction:g,formatFunction:H},{fieldName:"sending",targetFieldName:"sending",checkFunction:m.Type.isBoolean},{fieldName:"unread",targetFieldName:"unread",checkFunction:m.Type.isBoolean},{fieldName:"viewed",targetFieldName:"viewed",checkFunction:m.Type.isBoolean},{fieldName:"viewedByOthers",targetFieldName:"viewedByOthers",checkFunction:m.Type.isBoolean},{fieldName:"error",targetFieldName:"error",checkFunction:m.Type.isBoolean},{fieldName:"componentId",targetFieldName:"componentId",checkFunction:e=>m.Type.isString(e)&&e!=="",formatFunction:A},{fieldName:"componentParams",targetFieldName:"componentParams",checkFunction:m.Type.isPlainObject},{fieldName:["files","fileId"],targetFieldName:"files",checkFunction:m.Type.isArray},{fieldName:"attach",targetFieldName:"attach",checkFunction:[m.Type.isArray,m.Type.isBoolean,m.Type.isString]},{fieldName:"keyboard",targetFieldName:"keyboard",checkFunction:m.Type.isArray,formatFunction:w},{fieldName:"keyboard",targetFieldName:"keyboard",checkFunction:e=>e==="N",formatFunction:()=>[]},{fieldName:"isEdited",targetFieldName:"isEdited",checkFunction:m.Type.isString,formatFunction:e=>e==="Y"},{fieldName:"isEdited",targetFieldName:"isEdited",checkFunction:m.Type.isBoolean},{fieldName:"isDeleted",targetFieldName:"isDeleted",checkFunction:m.Type.isString,formatFunction:e=>e==="Y"},{fieldName:"isDeleted",targetFieldName:"isDeleted",checkFunction:m.Type.isBoolean},{fieldName:"replyId",targetFieldName:"replyId",checkFunction:g,formatFunction:f},{fieldName:"forward",targetFieldName:"forward",checkFunction:m.Type.isPlainObject}];class U extends d.BuilderModel{getState(){return{collection:{}}}getGetters(){return{getPinned:e=>t=>{if(!e.collection[t]){return[]}const i=[];[...e.collection[t]].forEach((e=>{const t=c.Core.getStore().getters["messages/getById"](e);if(t){i.push(t)}}));return i},isPinned:e=>t=>{const{chatId:i,messageId:s}=t;if(!e.collection[i]){return false}return e.collection[i].has(s)}}}getActions(){return{setPinned:(e,t)=>{const{chatId:i,pinnedMessages:s}=t;if(s.length===0){return}e.commit("setPinned",{chatId:i,pinnedMessageIds:s})},set:(e,t)=>{e.commit("set",t)},add:(e,t)=>{e.commit("add",t)},delete:(e,t)=>{e.commit("delete",t)}}}getMutations(){return{setPinned:(e,t)=>{a.Logger.warn("Messages/pin model: setPinned mutation",t);const{chatId:i,pinnedMessageIds:s}=t;e.collection[i]=new Set(s.reverse())},add:(e,t)=>{a.Logger.warn("Messages/pin model: add pin mutation",t);const{chatId:i,messageId:s}=t;if(!e.collection[i]){e.collection[i]=new Set}e.collection[i].add(s)},delete:(e,t)=>{a.Logger.warn("Messages/pin model: delete pin mutation",t);const{chatId:i,messageId:s}=t;if(!e.collection[i]){return}e.collection[i].delete(s)}}}}const j=5;class R extends d.BuilderModel{getState(){return{collection:{}}}getElementState(){return{reactionCounters:{},reactionUsers:{},ownReactions:new Set}}getGetters(){return{getByMessageId:e=>t=>e.collection[t]}}getActions(){return{set:(e,t)=>{e.commit("set",this.prepareSetPayload(t))},setReaction:(e,t)=>{e.commit("setReaction",t)},removeReaction:(e,t)=>{if(!e.state.collection[t.messageId]){return}e.commit("removeReaction",t)},clearCollection:e=>{e.commit("clearCollection")}}}getMutations(){return{set:(e,t)=>{t.forEach((t=>{var i;const s=e.collection[t.messageId];const o=s?s.ownReactions:[];const a=(i=t.ownReactions)!=null?i:[];const n=new Set([...a,...o]);if(t.ownReactionsToRemove){t.ownReactionsToRemove.forEach((e=>{n.delete(e)}))}e.collection[t.messageId]={reactionCounters:t.reactionCounters,reactionUsers:t.reactionUsers,ownReactions:n}}))},setReaction:(e,t)=>{const{messageId:i,userId:s,reaction:o}=t;if(!e.collection[i]){e.collection[i]=this.getElementState()}const a=e.collection[i];if(c.Core.getUserId()===s){this.handleOwnReactions(a,t)}if(!a.reactionCounters[o]){a.reactionCounters[o]=0}const n=a.reactionCounters[o];const r=n+1;if(r<=j){this.addUserToReaction(a,t)}a.reactionCounters[o]=r},removeReaction:(e,t)=>{var i;const{messageId:s,userId:o,reaction:a}=t;const n=e.collection[s];if(c.Core.getUserId()===o){n.ownReactions.delete(a)}(i=n.reactionUsers[a])==null?void 0:i.delete(o);n.reactionCounters[a]--;if(n.reactionCounters[a]===0){delete n.reactionCounters[a]}},clearCollection:e=>{e.collection={}}}}handleOwnReactions(e,t){const{reaction:i,withReplace:s=true}=t;if(s){this.removeAllCurrentUserReactions(e)}e.ownReactions.add(i)}addUserToReaction(e,t){const{userId:i,reaction:s}=t;if(!e.reactionUsers[s]){e.reactionUsers[s]=new Set}e.reactionUsers[s].add(i)}removeAllCurrentUserReactions(e){e.ownReactions.forEach((t=>{var i;(i=e.reactionUsers[t])==null?void 0:i.delete(c.Core.getUserId());e.reactionCounters[t]--;if(e.reactionCounters[t]===0){delete e.reactionCounters[t]}}));e.ownReactions=new Set}prepareSetPayload(e){return e.map((e=>{const t={};Object.entries(e.reactionUsers).forEach((([e,i])=>{t[e]=new Set(i)}));return{...e,reactionUsers:t}}))}}const D=[{fieldName:"chatId",targetFieldName:"chatId",checkFunction:m.Type.isNumber},{fieldName:"lastUserIds",targetFieldName:"lastUserIds",checkFunction:m.Type.isArray},{fieldName:"messageCount",targetFieldName:"messageCount",checkFunction:m.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:m.Type.isNumber},{fieldName:"isUserSubscribed",targetFieldName:"isUserSubscribed",checkFunction:m.Type.isBoolean}];const V=3;var G=babelHelpers.classPrivateFieldLooseKey("formatFields");var K=babelHelpers.classPrivateFieldLooseKey("isMessageAuthor");class W extends d.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,K,{value:X});Object.defineProperty(this,G,{value:_})}getState(){return{collection:{},layout:{opened:false,channelDialogId:"",postId:0}}}getElementState(){return{chatId:0,lastUserIds:[],messageCount:0,messageId:0,isUserSubscribed:false}}getGetters(){return{getByMessageId:e=>t=>{var i;return(i=e.collection[t])!=null?i:this.getElementState()},getMessageIdByChatId:e=>t=>{const i=Object.values(e.collection);const s=i.find((e=>e.chatId===t));return s==null?void 0:s.messageId},isUserSubscribed:e=>t=>{var i;const s=e.collection[t];if(!s&&babelHelpers.classPrivateFieldLooseBase(this,K)[K](t)){return true}return(i=s==null?void 0:s.isUserSubscribed)!=null?i:false},areOpened:e=>e.layout.opened,areOpenedForChannel:e=>t=>e.layout.channelDialogId===t,areOpenedForChannelPost:e=>t=>e.layout.postId===t,getOpenedChannelId:e=>{var t;return(t=e.layout.channelDialogId)!=null?t:""}}}getActions(){return{set:(e,t)=>{let i=t;if(!i){return}if(!Array.isArray(i)&&m.Type.isPlainObject(i)){i=[i]}i=i.map((t=>{const i=e.state.collection[t.messageId];if(i){return{...i,...babelHelpers.classPrivateFieldLooseBase(this,G)[G](t)}}return{...this.getElementState(),isUserSubscribed:babelHelpers.classPrivateFieldLooseBase(this,K)[K](t.messageId),...babelHelpers.classPrivateFieldLooseBase(this,G)[G](t)}}));e.commit("set",i)},setLastUser:(e,t)=>{const{messageId:i,newUserId:s}=t;const o=e.state.collection[i];if(!o||s===0){return}e.commit("setLastUser",t)},subscribe:(e,t)=>{c.Core.getStore().dispatch("messages/comments/set",{messageId:t,isUserSubscribed:true})},unsubscribe:(e,t)=>{c.Core.getStore().dispatch("messages/comments/set",{messageId:t,isUserSubscribed:false})},setOpened:(e,t)=>{e.commit("setOpened",t)},setClosed:e=>{e.commit("setClosed")}}}getMutations(){return{set:(e,t)=>{t.forEach((t=>{e.collection[t.messageId]=t}))},setLastUser:(e,t)=>{const{messageId:i,newUserId:s}=t;const{lastUserIds:o}=e.collection[i];if(o.includes(s)){return}if(o.length<V){o.unshift(s);return}o.pop();o.unshift(s)},setOpened:(e,t)=>{const{channelDialogId:i,commentsPostId:s}=t;e.layout={opened:true,channelDialogId:i,postId:s}},setClosed:e=>{e.layout={opened:false,channelDialogId:"",commentsPostId:0}}}}}function _(e){return u.formatFieldsWithConfig(e,D)}function X(e){const t=c.Core.getStore().getters["messages/getById"](e);return(t==null?void 0:t.authorId)===c.Core.getUserId()}class z extends d.BuilderModel{getState(){return{collection:{}}}getGetters(){return{getCollection:e=>t=>{if(!e.collection[t]){return null}const i=[...e.collection[t]];const s=i.filter((e=>c.Core.getStore().getters["messages/isExists"](e)));return new Set(s)},isBulkActionsModeActive:e=>t=>Boolean(e.collection[t]),isMessageSelected:e=>(t,i)=>{if(!e.collection[i]){return false}return e.collection[i].has(t)}}}getActions(){return{enableBulkMode:(e,t)=>{const{messageId:i,dialogId:s}=t;if(e.state.collection[s]){return}e.commit("enableBulkMode",{messageId:i,dialogId:s})},disableBulkMode:(e,t)=>{const{dialogId:i}=t;if(!e.state.collection[i]){return}e.commit("disableBulkMode",{dialogId:i})},toggleMessageSelection:(e,t)=>{const{messageId:i,dialogId:s}=t;if(!e.state.collection[s]){return}e.commit("toggleMessageSelection",{messageId:i,dialogId:s})},clearCollection:e=>{e.commit("clearCollection")}}}getMutations(){return{enableBulkMode:(e,t)=>{const{messageId:i,dialogId:s}=t;e.collection[s]=new Set;e.collection[s].add(i)},disableBulkMode:(e,t)=>{const{dialogId:i}=t;delete e.collection[i]},toggleMessageSelection:(e,t)=>{const{messageId:i,dialogId:s}=t;if(e.collection[s].has(i)){e.collection[s].delete(i);return}e.collection[s].add(i)},clearCollection:e=>{e.collection={}}}}}function $(e,t){return e.messageId===t.messageId&&e.type===t.type&&e.fromUserId===t.fromUserId}function Y(e,t,i){return e.chatId===i&&e.type===t}class q extends d.BuilderModel{getName(){return"anchors"}getState(){return{anchors:[]}}getGetters(){return{getChatMessageIdsWithAnchors:e=>t=>[...e.anchors].filter((e=>e.chatId===t)).map((e=>e.messageId)),isMessageHasAnchors:e=>t=>e.anchors.some((e=>e.messageId===t)),isChatHasAnchors:e=>t=>e.anchors.some((e=>e.chatId===t)),isChatHasAnchorsWithType:e=>(t,i)=>e.anchors.some((e=>Y(e,i,t))),getCounterInChatByType:e=>(t,i)=>{const s=e.anchors.filter((e=>Y(e,i,t)));return new Set(s.map((e=>e.messageId))).size},getNextMessageIdWithAnchorType:e=>(t,i)=>{var s;const o=e.anchors.filter((e=>Y(e,i,t))).sort(((e,t)=>e.messageId-t.messageId));return(s=o.at(0))==null?void 0:s.messageId},getAnchorsByChatType:e=>t=>e.anchors.filter((e=>{const{type:i}=c.Core.getStore().getters["chats/getByChatId"](e.chatId,true);return i===t}))}}getActions(){return{setAnchors:(e,t)=>{if(m.Type.isPlainObject(t)===false){return}e.commit("setAnchors",{anchors:t.anchors})},addAnchor:(e,t)=>{if(m.Type.isPlainObject(t)===false){return}const i=e.state.anchors.find((e=>$(e,t.anchor)));if(!i){e.commit("addAnchor",t)}},removeAnchor:(e,t)=>{if(m.Type.isPlainObject(t)===false){return}e.commit("removeAnchor",t)},removeUserAnchorsFromMessage:(e,t)=>{e.state.anchors.forEach((i=>{if(i.messageId===t){e.commit("removeAnchor",{anchor:i})}}))},removeChatAnchors:(e,t)=>{e.commit("removeChatAnchors",t)},removeAllAnchorsByChatType:(e,t)=>{e.commit("removeAllAnchorsByChatType",t)},removeAllAnchors:e=>{e.commit("removeAllAnchors")}}}getMutations(){return{setAnchors:(e,t)=>{e.anchors=[...t.anchors]},addAnchor:(e,t)=>{e.anchors.push(t.anchor)},removeAnchor:(e,t)=>{const i=e.anchors.findIndex((e=>$(e,t.anchor)));if(i>-1){e.anchors.splice(i,1)}},removeChatAnchors:(e,t)=>{e.anchors=e.anchors.filter((e=>e.chatId!==t))},removeAllAnchorsByChatType:(e,t)=>{const{type:i}=t;const s=c.Core.getStore().getters["messages/anchors/getAnchorsByChatType"](i);const o=new Set(s.map((e=>e.chatId)));e.anchors=e.anchors.filter((e=>!o.has(e.chatId)))},removeAllAnchors:e=>{e.anchors=[]}}}}var Q=babelHelpers.classPrivateFieldLooseKey("findNextLoadingMessages");var J=babelHelpers.classPrivateFieldLooseKey("formatFields");var Z=babelHelpers.classPrivateFieldLooseKey("needToSwapAuthorId");var ee=babelHelpers.classPrivateFieldLooseKey("prepareSwapAuthorId");var te=babelHelpers.classPrivateFieldLooseKey("getMaxMessageId");var ie=babelHelpers.classPrivateFieldLooseKey("findLowestMessageId");var se=babelHelpers.classPrivateFieldLooseKey("findMaxMessageId");var oe=babelHelpers.classPrivateFieldLooseKey("findLastOwnMessageId");var ae=babelHelpers.classPrivateFieldLooseKey("findFirstUnread");var ne=babelHelpers.classPrivateFieldLooseKey("sortCollection");var re=babelHelpers.classPrivateFieldLooseKey("makeFakePreviousSiblingId");class le extends d.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,re,{value:Fe});Object.defineProperty(this,ne,{value:Ie});Object.defineProperty(this,ae,{value:ye});Object.defineProperty(this,oe,{value:pe});Object.defineProperty(this,se,{value:fe});Object.defineProperty(this,ie,{value:he});Object.defineProperty(this,te,{value:ge});Object.defineProperty(this,ee,{value:me});Object.defineProperty(this,Z,{value:ue});Object.defineProperty(this,J,{value:de});Object.defineProperty(this,Q,{value:ce})}getName(){return"messages"}getNestedModules(){return{pin:U,reactions:R,comments:W,select:z,anchors:q}}getState(){return{collection:{},chatCollection:{},loadingMessages:{}}}getElementState(){return{id:0,chatId:0,authorId:0,replyId:0,date:new Date,text:"",files:[],attach:[],keyboard:[],unread:false,viewed:true,viewedByOthers:false,sending:false,error:false,componentId:l.MessageComponent.default,componentParams:{},forward:{id:"",userId:0},isEdited:false,isDeleted:false}}getGetters(){return{getByChatId:(e,t)=>i=>{if(!e.chatCollection[i]){return[]}const s={id:babelHelpers.classPrivateFieldLooseBase(this,re)[re](i)};const o=babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](s,t);return[...e.chatCollection[i]].map((t=>e.collection[t])).sort(babelHelpers.classPrivateFieldLooseBase(this,ne)[ne]).reduce(((e,i)=>{e.push(i,...babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](i,t));return e}),[...o])},getById:e=>t=>e.collection[t],getByIdList:e=>t=>{const i=[];t.forEach((t=>{if(e.collection[t]){i.push(e.collection[t])}}));return i},hasMessage:e=>({chatId:t,messageId:i})=>{if(!e.chatCollection[t]){return false}return e.chatCollection[t].has(i)},isForward:e=>t=>{const i=e.collection[t];if(!i){return false}return m.Type.isStringFilled(i.forward.id)},isVideoNote:(e,t)=>i=>{const s=e.collection[i];if(!s){return false}return t.getMessageFiles(i).some((e=>e.isVideoNote))},isExists:e=>t=>{const i=e.collection[t];return i&&!i.isDeleted},isInChatCollection:e=>t=>{var i;const{messageId:s}=t;const o=e.collection[s];if(!o){return false}const{chatId:a}=o;return(i=e.chatCollection[a])==null?void 0:i.has(s)},getFirstId:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](e,t)},getLastId:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,se)[se](e,t)},getLastOwnMessageId:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](e,t)},getFirstUnread:e=>t=>{if(!e.chatCollection[t]){return 0}return babelHelpers.classPrivateFieldLooseBase(this,ae)[ae](e,t)},getChatUnreadMessages:e=>t=>{if(!e.chatCollection[t]){return[]}const i=[...e.chatCollection[t]].map((t=>e.collection[t]));return i.filter((e=>e.unread===true))},getMessageFiles:e=>t=>{const i=t;if(!e.collection[i]){return[]}return e.collection[i].files.map((e=>this.store.getters["files/get"](e,true)))},getMessageType:e=>t=>{const i=e.collection[t];if(!i){return null}const s=c.Core.getUserId();if(i.authorId===0){return l.MessageType.system}if(i.authorId===s){return l.MessageType.self}return l.MessageType.opponent},getPreviousMessage:e=>t=>{const{messageId:i,chatId:s}=t;const o=e.collection[i];if(!o){return null}const a=[...e.chatCollection[s]];const n=a.indexOf(i);const r=a[n-1];if(!r){return null}return e.collection[r]},findPreviousMessageId:(e,t)=>e=>{const i=t.getByChatId(e.chatId);const s=i.findIndex((t=>t.id===e.messageId));if(s>0){return i[s-1].id}return-1},findLastChatMessageId:(e,t)=>e=>{const i=t.getByChatId(e).pop();if(i){return i.id}return null},hasLoadingMessageByPreviousSiblingId:e=>t=>Boolean(e.loadingMessages[t]),getLoadingMessageByPreviousSiblingId:e=>t=>{var i;return(i=e.loadingMessages[t])!=null?i:null},getLoadingMessageByMessageId:e=>t=>{const i=Object.values(e.loadingMessages).find((e=>e.id===t));if(i){return i}return null},hasLoadingMessageByMessageId:(e,t)=>e=>t.getLoadingMessageByMessageId(e)!==null,isRealMessage:()=>e=>!r.Utils.text.isTempMessage(e)}}getActions(){return{setChatCollection:(e,t)=>{var i,s;let{messages:o,clearCollection:a}=t;a=(i=a)!=null?i:false;if(!Array.isArray(o)&&m.Type.isPlainObject(o)){o=[o]}o=o.map((e=>({...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,J)[J](e)})));const n=(s=o[0])==null?void 0:s.chatId;if(n&&a){e.commit("clearCollection",{chatId:n})}e.commit("store",{messages:o});e.commit("setChatCollection",{messages:o})},store:(e,t)=>{let i=t;if(m.Type.isPlainObject(t)){i=[t]}i=i.map((t=>{const i=e.state.collection[t.id];if(i){return{...i,...babelHelpers.classPrivateFieldLooseBase(this,J)[J](t)}}return{...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,J)[J](t)}}));if(i.length===0){return}e.commit("store",{messages:i})},add:(e,t)=>{const i={...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,J)[J](t)};e.commit("store",{messages:[i]});e.commit("setChatCollection",{messages:[i]});return i.id},updateWithId:(e,t)=>{const{id:i,fields:s}=t;if(!e.state.collection[i]){return}e.commit("updateWithId",{id:i,fields:babelHelpers.classPrivateFieldLooseBase(this,J)[J](s)})},update:(e,t)=>{const{id:i,fields:s}=t;const o=e.state.collection[i];if(!o){return}e.commit("update",{id:i,fields:{...o,...babelHelpers.classPrivateFieldLooseBase(this,J)[J](s)}})},readMessages:(e,t)=>{const{chatId:i,messageIds:s}=t;if(!e.state.chatCollection[i]){return 0}const o=[...e.state.chatCollection[i]].map((t=>e.state.collection[t]));let a=0;const n=babelHelpers.classPrivateFieldLooseBase(this,te)[te](s);const r=s;const l=[];o.forEach((e=>{if(!e.unread){return}if(e.id<=n){a++;l.push(e.id)}}));e.commit("readMessages",{messageIdsToRead:l,messageIdsToView:r});return a},setViewedByOthers:(e,t)=>{const{ids:i}=t;e.commit("setViewedByOthers",{ids:i})},delete:(e,t)=>{const{id:i}=t;if(!e.state.collection[i]){return}if(e.getters.hasLoadingMessageByPreviousSiblingId(i)){const t=e.state.collection[i];const s=e.getters.findPreviousMessageId({messageId:t.id,chatId:t.chatId});e.commit("updateLoadingMessagePreviousSiblingId",{oldId:t.id,newId:s})}if(e.getters.hasLoadingMessageByMessageId(i)){e.commit("deleteLoadingMessageByMessageId",{messageId:i})}e.commit("delete",{id:i})},clearChatCollection:(e,t)=>{const{chatId:i}=t;e.commit("clearCollection",{chatId:i})},deleteAttach:(e,t)=>{const{messageId:i,attachId:s}=t;const o=e.state.collection[i];if(!o||!m.Type.isArray(o.attach)){return}const a=o.attach.filter((e=>s!==e.id));e.commit("update",{id:i,fields:{...o,...babelHelpers.classPrivateFieldLooseBase(this,J)[J]({attach:a})}})},addLoadingMessage:(e,t)=>{const i={...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,J)[J](t.message)};e.commit("store",{messages:[i]});if(!e.state.chatCollection[i.chatId]){e.commit("initChatCollection",{chatId:i.chatId})}const s=(()=>{const t=e.getters.findLastChatMessageId(i.chatId);if(m.Type.isNull(t)){return babelHelpers.classPrivateFieldLooseBase(this,re)[re](i.chatId)}return t})();e.commit("addLoadingMessage",{message:i,previousSiblingId:s})},deleteLoadingMessageByMessageId:(e,t)=>{e.commit("deleteLoadingMessageByMessageId",{...t})}}}getMutations(){return{setChatCollection:(e,t)=>{a.Logger.warn("Messages model: setChatCollection mutation",t);t.messages.forEach((t=>{if(!e.chatCollection[t.chatId]){e.chatCollection[t.chatId]=new Set}e.chatCollection[t.chatId].add(t.id)}))},initChatCollection:(e,t)=>{if(!e.chatCollection[t.chatId]){e.chatCollection[t.chatId]=new Set}},store:(e,t)=>{a.Logger.warn("Messages model: store mutation",t);t.messages.forEach((t=>{e.collection[t.id]=t}))},updateWithId:(e,t)=>{a.Logger.warn("Messages model: updateWithId mutation",t);const{id:i,fields:s}=t;const o={...e.collection[i]};delete e.collection[i];e.collection[s.id]={...o,...s,sending:false};if(e.chatCollection[o.chatId].has(i)){e.chatCollection[o.chatId].delete(i);e.chatCollection[o.chatId].add(s.id)}},update:(e,t)=>{a.Logger.warn("Messages model: update mutation",t);const{id:i,fields:s}=t;e.collection[i]={...e.collection[i],...s}},delete:(e,t)=>{var i;a.Logger.warn("Messages model: delete mutation",t);const{id:s}=t;const{chatId:o}=e.collection[s];(i=e.chatCollection[o])==null?void 0:i.delete(s);delete e.collection[s]},clearCollection:(e,t)=>{a.Logger.warn("Messages model: clear collection mutation",t.chatId);e.chatCollection[t.chatId]=new Set},readMessages:(e,t)=>{const{messageIdsToRead:i,messageIdsToView:s}=t;i.forEach((t=>{const i=e.collection[t];if(!i){return}i.unread=false}));s.forEach((t=>{const i=e.collection[t];if(!i){return}i.viewed=true}))},setViewedByOthers:(e,t)=>{const{ids:i}=t;i.forEach((t=>{const i=e.collection[t];if(!i){return}const s=i.authorId===c.Core.getUserId();if(!s||i.viewedByOthers){return}i.viewedByOthers=true}))},addLoadingMessage:(e,t)=>{const{message:i,previousSiblingId:s}=t;e.loadingMessages[s]=i},deleteLoadingMessageByMessageId:(e,t)=>{const i=Object.entries(e.loadingMessages);const s=i.find((([,e])=>e.id===t.messageId));if(s){const[t]=s;delete e.loadingMessages[t]}},updateLoadingMessagePreviousSiblingId:(e,t)=>{const{oldId:i,newId:s}=t;const o=e.loadingMessages[i];if(o){delete e.loadingMessages[i];e.loadingMessages[s]=o}}}}}function ce(e,t){if(t.hasLoadingMessageByPreviousSiblingId(e.id)){const i=t.getLoadingMessageByPreviousSiblingId(e.id);return[i,...babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](i,t)]}return[]}function de(e){const t=m.Type.isPlainObject(e.params)?e.params:{};const i={...e,...t};const s=u.formatFieldsWithConfig(i,O);if(babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](s,t)){s.authorId=babelHelpers.classPrivateFieldLooseBase(this,ee)[ee](s,t)}return s}function ue(e,t){const{NAME:i,USER_ID:s}=t;return Boolean(i&&s&&e.authorId)}function me(e,t){const{NAME:i,USER_ID:o,AVATAR:a}=t;const n=e.authorId;const r=f(o);const c=new s.UserManager;const d=`${l.UserIdNetworkPrefix}-${n}-${r}`;void c.setUsersToModel({networkId:d,name:i,avatar:a!=null?a:""});return d}function ge(e){let t=0;e.forEach((e=>{if(t<e){t=e}}));return t}function he(e,t){let i=null;const s=[...e.chatCollection[t]];for(const t of s){const s=e.collection[t];if(!i){i=s.id}if(r.Utils.text.isTempMessage(s.id)){continue}if(s.id<i){i=s.id}}return i}function fe(e,t){let i=0;const s=[...e.chatCollection[t]];for(const t of s){const s=e.collection[t];if(r.Utils.text.isTempMessage(s.id)){continue}if(s.id>i){i=s.id}}return i}function pe(e,t){let i=0;const s=[...e.chatCollection[t]].sort(((e,t)=>t-e));for(const t of s){const s=e.collection[t];if(r.Utils.text.isTempMessage(s.id)){continue}if(s.authorId===c.Core.getUserId()){i=s.id;break}}return i}function ye(e,t){let i=0;for(const s of e.chatCollection[t]){const t=e.collection[s];if(t.unread){i=s;break}}return i}function Ie(e,t){if(r.Utils.text.isUuidV4(e.id)&&!r.Utils.text.isUuidV4(t.id)){return 1}if(!r.Utils.text.isUuidV4(e.id)&&r.Utils.text.isUuidV4(t.id)){return-1}if(r.Utils.text.isUuidV4(e.id)&&r.Utils.text.isUuidV4(t.id)){return e.date.getTime()-t.date.getTime()}return e.id-t.id}function Fe(e){return`${e}/-1`}const Ne=e=>{const t=[];e.forEach((e=>{const i=Number.parseInt(e,10);if(i>0){t.push(i)}}));return t};const be=e=>m.Text.decode(e.toString());const Ce=e=>{let t="";if(!e||e.endsWith("/js/im/images/blank.gif")){t=""}else if(e.startsWith("http")){t=e}else{t=c.Core.getHost()+e}if(t){t=encodeURI(t)}return t};const Se=e=>{const t=[];if(m.Type.isArray(e)){e.forEach((e=>{const i=Number.parseInt(e,10);if(i>0){t.push(i)}}))}else if(m.Type.isPlainObject(e)){Object.entries(e).forEach((([e,i])=>{if(!i){return}const s=Number.parseInt(e,10);if(s>0){t.push(s)}}))}return t};const Te=e=>{const{countOfViewers:t,firstViewers:i,messageId:s}=e;let o=null;for(const e of i){if(e.userId===c.Core.getUserId()){continue}o={userId:e.userId,userName:e.userName,date:r.Utils.date.cast(e.date)};break}if(t>0&&!o){throw new Error("Chats model: no first viewer for message")}return{countOfViewers:t,firstViewer:o,messageId:s}};const ve=[{fieldName:"dialogId",targetFieldName:"dialogId",checkFunction:g,formatFunction:h},{fieldName:["id","chatId"],targetFieldName:"chatId",checkFunction:g,formatFunction:f},{fieldName:"type",targetFieldName:"type",checkFunction:m.Type.isString},{fieldName:"quoteId",targetFieldName:"quoteId",checkFunction:m.Type.isNumber},{fieldName:"counter",targetFieldName:"counter",checkFunction:g,formatFunction:f},{fieldName:"userCounter",targetFieldName:"userCounter",checkFunction:g,formatFunction:f},{fieldName:"lastId",targetFieldName:"lastReadId",checkFunction:m.Type.isNumber},{fieldName:"markedId",targetFieldName:"markedId",checkFunction:m.Type.isNumber},{fieldName:"lastMessageId",targetFieldName:"lastMessageId",checkFunction:g,formatFunction:f},{fieldName:"lastMessageViews",targetFieldName:"lastMessageViews",checkFunction:m.Type.isPlainObject,formatFunction:Te},{fieldName:"hasPrevPage",targetFieldName:"hasPrevPage",checkFunction:m.Type.isBoolean},{fieldName:"hasNextPage",targetFieldName:"hasNextPage",checkFunction:m.Type.isBoolean},{fieldName:"savedPositionMessageId",targetFieldName:"savedPositionMessageId",checkFunction:m.Type.isNumber},{fieldName:["title","name"],targetFieldName:"name",checkFunction:g,formatFunction:be},{fieldName:["owner","ownerId"],targetFieldName:"ownerId",checkFunction:g,formatFunction:f},{fieldName:"avatar",targetFieldName:"avatar",checkFunction:m.Type.isString,formatFunction:Ce},{fieldName:"color",targetFieldName:"color",checkFunction:m.Type.isString},{fieldName:"extranet",targetFieldName:"extranet",checkFunction:m.Type.isBoolean},{fieldName:"containsCollaber",targetFieldName:"containsCollaber",checkFunction:m.Type.isBoolean},{fieldName:"entityLink",targetFieldName:"entityLink",checkFunction:m.Type.isPlainObject,formatFunction:e=>u.formatFieldsWithConfig(e,ke)},{fieldName:"dateCreate",targetFieldName:"dateCreate",formatFunction:r.Utils.date.cast},{fieldName:"public",targetFieldName:"public",checkFunction:m.Type.isPlainObject},{fieldName:"inputActionList",targetFieldName:"inputActionList",checkFunction:m.Type.isPlainObject},{fieldName:"managerList",targetFieldName:"managerList",checkFunction:m.Type.isArray,formatFunction:Ne},{fieldName:"muteList",targetFieldName:"muteList",checkFunction:[m.Type.isArray,m.Type.isPlainObject],formatFunction:Se},{fieldName:"inited",targetFieldName:"inited",checkFunction:m.Type.isBoolean},{fieldName:"loading",targetFieldName:"loading",checkFunction:m.Type.isBoolean},{fieldName:"description",targetFieldName:"description",checkFunction:m.Type.isString},{fieldName:"diskFolderId",targetFieldName:"diskFolderId",checkFunction:m.Type.isNumber},{fieldName:"role",targetFieldName:"role",checkFunction:m.Type.isString,formatFunction:e=>e.toLowerCase()},{fieldName:"permissions",targetFieldName:"permissions",checkFunction:m.Type.isPlainObject},{fieldName:"tariffRestrictions",targetFieldName:"tariffRestrictions",checkFunction:m.Type.isPlainObject},{fieldName:"parentChatId",targetFieldName:"parentChatId",checkFunction:m.Type.isNumber},{fieldName:"backgroundId",targetFieldName:"backgroundId",checkFunction:m.Type.isString},{fieldName:"textFieldEnabled",targetFieldName:"isTextareaEnabled",checkFunction:m.Type.isBoolean}];const ke=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isString},{fieldName:"type",targetFieldName:"type",checkFunction:m.Type.isString},{fieldName:"url",targetFieldName:"url",checkFunction:m.Type.isString}];const Pe=[{fieldName:"delay",targetFieldName:"delay",checkFunction:m.Type.isNumber},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:m.Type.isNumber}];var Le=babelHelpers.classPrivateFieldLooseKey("formatFields");class Me extends d.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,Le,{value:Ee})}getState(){return{collection:new Map}}getGetters(){return{isEnabled:e=>t=>{var i;return(i=e.collection.has(t))!=null?i:false},getDelay:e=>t=>{var i;return(i=e.collection.get(t))!=null?i:l.AutoDeleteDelay.Off}}}getActions(){return{set:(e,t)=>{let i=t;if(!Array.isArray(i)&&m.Type.isPlainObject(i)){i=[i]}i.forEach((t=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Le)[Le](t);const{delay:s}=i;if(s===l.AutoDeleteDelay.Off){e.commit("delete",i);return}e.commit("set",i)}))}}}getMutations(){return{set:(e,t)=>{const{chatId:i,delay:s}=t;e.collection.set(i,s)},delete:(e,t)=>{const{chatId:i}=t;e.collection.delete(i)}}}}function Ee(e){return u.formatFieldsWithConfig(e,Pe)}const Be=[{fieldName:"collabId",targetFieldName:"collabId",checkFunction:m.Type.isNumber},{fieldName:"guestCount",targetFieldName:"guestCount",checkFunction:m.Type.isNumber},{fieldName:"entities",targetFieldName:"entities",checkFunction:m.Type.isPlainObject,formatFunction:e=>u.formatFieldsWithConfig(e,xe)}];const xe=[{fieldName:"tasks",targetFieldName:"tasks",checkFunction:m.Type.isPlainObject,formatFunction:e=>u.formatFieldsWithConfig(e,Ae)},{fieldName:"files",targetFieldName:"files",checkFunction:m.Type.isPlainObject,formatFunction:e=>u.formatFieldsWithConfig(e,Ae)},{fieldName:"calendar",targetFieldName:"calendar",checkFunction:m.Type.isPlainObject,formatFunction:e=>u.formatFieldsWithConfig(e,Ae)}];const Ae=[{fieldName:"counter",targetFieldName:"counter",checkFunction:m.Type.isNumber},{fieldName:"url",targetFieldName:"url",checkFunction:m.Type.isStringFilled}];var He=babelHelpers.classPrivateFieldLooseKey("formatFields");class we extends d.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,He,{value:Oe})}getState(){return{collection:{}}}getElementState(){return{collabId:0,guestCount:0,entities:{tasks:{counter:0,url:""},files:{counter:0,url:""},calendar:{counter:0,url:""}}}}getGetters(){return{getByChatId:e=>t=>{var i;return(i=e.collection[t])!=null?i:this.getElementState()}}}getActions(){return{set:(e,t)=>{const{chatId:i,collabInfo:s}=t;if(!m.Type.isPlainObject(s)){return}e.commit("set",{chatId:i,collabInfo:babelHelpers.classPrivateFieldLooseBase(this,He)[He](s)})},setCounter:(e,t)=>{const{chatId:i,entity:s,counter:o}=t;const a=e.state;const n=a.collection[i];if(!n||!n.entities[s]){return}e.commit("setCounter",{chatId:i,entity:s,counter:o})},setGuestCount:(e,t)=>{const{chatId:i,guestCount:s}=t;const o=e.state;const a=o.collection[i];if(!a){return}e.commit("setGuestCount",{chatId:i,guestCount:s})}}}getMutations(){return{set:(e,t)=>{const{chatId:i,collabInfo:s}=t;e.collection[i]=s},setCounter:(e,t)=>{const{chatId:i,entity:s,counter:o}=t;const a=e.collection[i];a.entities[s].counter=o},setGuestCount:(e,t)=>{const{chatId:i,guestCount:s}=t;const o=e.collection[i];o.guestCount=s}}}}function Oe(e){return u.formatFieldsWithConfig(e,Be)}class Ue extends d.BuilderModel{getState(){return{collection:{}}}getGetters(){return{getByDialogId:e=>t=>{const i=e.collection[t];if(!i||i.length===0){return null}return i},isChatActive:e=>t=>{const i=e.collection[t];if(!i){return false}return i.length>0},isActionActive:e=>t=>{const{dialogId:i,userId:s}=t;if(!e.collection[i]){return false}const o=e.collection[i];return this.isAlreadyActive(o,s)}}}getActions(){return{start:(e,t)=>{const{dialogId:i,userId:s}=t;if(!e.state.collection[i]){e.commit("initCollection",i)}const o=e.state.collection[i];const a=this.isAlreadyActive(o,s);if(a){return}e.commit("start",t)},stop:(e,t)=>{const{dialogId:i,userId:s}=t;const o=e.state.collection[i];if(!o){return}const a=this.isAlreadyActive(o,s);if(!a){return}e.commit("stop",t)}}}getMutations(){return{start:(e,t)=>{const{dialogId:i,type:s,userId:o,userName:a,duration:n,statusMessageCode:r}=t;const l=e.collection[i];l.push({type:s,userId:o,userName:a,duration:n,statusMessageCode:r})},stop:(e,t)=>{const{dialogId:i,userId:s}=t;const o=e.collection[i];e.collection[i]=o.filter((e=>e.userId!==s))},initCollection:(e,t)=>{e.collection[t]=[]}}}isAlreadyActive(e,t){return e.some((e=>e.userId===t))}}class je extends d.BuilderModel{getName(){return"chats"}getNestedModules(){return{collabs:we,inputActions:Ue,autoDelete:Me}}getState(){return{collection:{}}}getElementState(){return{dialogId:"0",chatId:0,type:l.ChatType.chat,name:"",description:"",avatar:"",color:l.Color.base,extranet:false,containsCollaber:false,counter:0,userCounter:0,lastReadId:0,markedId:0,lastMessageId:0,lastMessageViews:{countOfViewers:0,firstViewer:null,messageId:0},savedPositionMessageId:0,managerList:[],inputActionList:{},muteList:[],quoteId:0,ownerId:0,entityLink:{},dateCreate:null,public:{code:"",link:""},inited:false,loading:false,hasPrevPage:false,hasNextPage:false,diskFolderId:0,role:l.UserRole.member,permissions:{manageUi:l.UserRole.none,manageSettings:l.UserRole.none,manageUsersAdd:l.UserRole.none,manageUsersDelete:l.UserRole.none,manageMessages:l.UserRole.member},tariffRestrictions:{isHistoryLimitExceeded:false},parentChatId:0,backgroundId:"",isTextareaEnabled:true}}getGetters(){return{get:e=>(t,i=false)=>{if(!e.collection[t]&&i){return this.getElementState()}if(!e.collection[t]&&!i){return null}return e.collection[t]},getByChatId:e=>(t,i=false)=>{const s=Number.parseInt(t,10);const o=Object.values(e.collection).find((e=>e.chatId===s));if(!o&&i){return this.getElementState()}return o},getQuoteId:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].quoteId},isUser:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].type===l.ChatType.user},getLastReadId:e=>t=>{if(!e.collection[t]){return 0}const{lastReadId:i}=e.collection[t];const s=c.Core.getStore().getters["messages/getById"](i);if(!s){return 0}return i},getInitialMessageId:e=>t=>{if(!e.collection[t]){return 0}const{lastReadId:i,markedId:s}=e.collection[t];if(s===0){return i}return Math.min(i,s)},isSupport:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].type===l.ChatType.support24Question},isNotes:()=>e=>c.Core.getUserId().toString()===e,getBackgroundId:e=>t=>{if(!e.collection[t]){return""}return e.collection[t].backgroundId},getCollectionByChatType:e=>t=>Object.values(e.collection).filter((e=>e.type===t))}}getActions(){return{set:(e,t)=>{let i=t;if(!Array.isArray(i)&&m.Type.isPlainObject(i)){i=[i]}i.map((e=>this.formatFields(e))).forEach((t=>{const i=e.state.collection[t.dialogId];if(i){e.commit("update",{dialogId:t.dialogId,fields:t})}else{e.commit("add",{dialogId:t.dialogId,fields:{...this.getElementState(),...t}})}}))},add:(e,t)=>{let i=t;if(!Array.isArray(i)&&m.Type.isPlainObject(i)){i=[i]}i.map((e=>this.formatFields(e))).forEach((t=>{const i=e.state.collection[t.dialogId];if(!i){e.commit("add",{dialogId:t.dialogId,fields:{...this.getElementState(),...t}})}}))},update:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("update",{dialogId:t.dialogId,fields:this.formatFields(t.fields)})},delete:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("delete",{dialogId:t.dialogId})},clearCountersByChatType:(e,t)=>{e.commit("clearCountersByChatType",t)},clearCounters:e=>{e.commit("clearCounters")},mute:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const s=c.Core.getUserId();if(i.muteList.includes(s)){return}const o=[...i.muteList,s];e.commit("update",{actionName:"mute",dialogId:t.dialogId,fields:this.formatFields({muteList:o})})},unmute:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const s=c.Core.getUserId();const o=i.muteList.filter((e=>e!==s));e.commit("update",{actionName:"unmute",dialogId:t.dialogId,fields:this.formatFields({muteList:o})})},setLastMessageViews:(e,t)=>{const{dialogId:i,fields:{userId:s,userName:o,date:a,messageId:n}}=t;const l=e.state.collection[i];if(!l){return}const c={countOfViewers:1,messageId:n,firstViewer:{userId:s,userName:o,date:r.Utils.date.cast(a)}};e.commit("update",{actionName:"setLastMessageViews",dialogId:i,fields:{lastMessageViews:c}})},clearLastMessageViews:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const{lastMessageViews:s}=this.getElementState();e.commit("update",{actionName:"clearLastMessageViews",dialogId:t.dialogId,fields:{lastMessageViews:s}})},incrementLastMessageViews:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}const s=i.lastMessageViews.countOfViewers+1;e.commit("update",{actionName:"incrementLastMessageViews",dialogId:t.dialogId,fields:{lastMessageViews:{...i.lastMessageViews,countOfViewers:s}}})}}}getMutations(){return{add:(e,t)=>{e.collection[t.dialogId]=t.fields},update:(e,t)=>{e.collection[t.dialogId]={...e.collection[t.dialogId],...t.fields}},delete:(e,t)=>{delete e.collection[t.dialogId]},clearCountersByChatType:(e,t)=>{const{type:i}=t;const s=this.store.getters["chats/getCollectionByChatType"](i);s.forEach((t=>{e.collection[t.dialogId].counter=0;e.collection[t.dialogId].markedId=0}))},clearCounters:e=>{Object.keys(e.collection).forEach((t=>{e.collection[t].counter=0;e.collection[t].markedId=0}))}}}formatFields(e){return u.formatFieldsWithConfig(e,ve)}}const Re=e=>{let t="";if(!e||e.endsWith("/js/im/images/blank.gif")){t=""}else if(e.startsWith("http")){t=e}else{t=c.Core.getHost()+e}if(t){t=encodeURI(t)}return t};const De=e=>{const t=[];e.forEach((e=>{const i=Number.parseInt(e,10);if(i>0){t.push(i)}}));return t};const Ve=e=>{const t={};if(m.Type.isStringFilled(e.workPhone)||m.Type.isNumber(e.workPhone)){t.workPhone=e.workPhone.toString()}if(m.Type.isStringFilled(e.personalMobile)||m.Type.isNumber(e.personalMobile)){t.personalMobile=e.personalMobile.toString()}if(m.Type.isStringFilled(e.personalPhone)||m.Type.isNumber(e.personalPhone)){t.personalPhone=e.personalPhone.toString()}if(m.Type.isStringFilled(e.innerPhone)||m.Type.isNumber(e.innerPhone)){t.innerPhone=e.innerPhone.toString()}return t};const Ge=[{fieldName:"id",targetFieldName:"id",checkFunction:g,formatFunction:f},{fieldName:"networkId",targetFieldName:"id",checkFunction:r.Utils.user.isNetworkUserId},{fieldName:"firstName",targetFieldName:"firstName",checkFunction:m.Type.isString,formatFunction:m.Text.decode},{fieldName:"lastName",targetFieldName:"lastName",checkFunction:m.Type.isString,formatFunction:m.Text.decode},{fieldName:"name",targetFieldName:"name",checkFunction:m.Type.isString,formatFunction:m.Text.decode},{fieldName:"color",targetFieldName:"color",checkFunction:m.Type.isString},{fieldName:"avatar",targetFieldName:"avatar",checkFunction:m.Type.isString,formatFunction:Re},{fieldName:"workPosition",targetFieldName:"workPosition",checkFunction:m.Type.isString,formatFunction:m.Text.decode},{fieldName:"gender",targetFieldName:"gender",checkFunction:m.Type.isString},{fieldName:"birthday",targetFieldName:"birthday",checkFunction:m.Type.isString},{fieldName:"isBirthday",targetFieldName:"isBirthday",checkFunction:m.Type.isBoolean},{fieldName:"type",targetFieldName:"type",checkFunction:m.Type.isString},{fieldName:"network",targetFieldName:"network",checkFunction:m.Type.isBoolean},{fieldName:"connector",targetFieldName:"connector",checkFunction:m.Type.isBoolean},{fieldName:"externalAuthId",targetFieldName:"externalAuthId",checkFunction:m.Type.isString},{fieldName:"status",targetFieldName:"status",checkFunction:m.Type.isString},{fieldName:"idle",targetFieldName:"idle",formatFunction:p},{fieldName:"lastActivityDate",targetFieldName:"lastActivityDate",formatFunction:p},{fieldName:"mobileLastDate",targetFieldName:"mobileLastDate",formatFunction:p},{fieldName:"absent",targetFieldName:"absent",formatFunction:p},{fieldName:"isAbsent",targetFieldName:"isAbsent",checkFunction:m.Type.isBoolean},{fieldName:"departments",targetFieldName:"departments",checkFunction:m.Type.isArray,formatFunction:De},{fieldName:"phones",targetFieldName:"phones",checkFunction:m.Type.isPlainObject,formatFunction:Ve},{fieldName:"email",targetFieldName:"email",checkFunction:m.Type.isStringFilled},{fieldName:"website",targetFieldName:"website",checkFunction:m.Type.isStringFilled}];const Ke=[{fieldName:"appId",targetFieldName:"appId",checkFunction:m.Type.isString},{fieldName:"type",targetFieldName:"type",checkFunction:m.Type.isString},{fieldName:"code",targetFieldName:"code",checkFunction:m.Type.isString},{fieldName:"isHidden",targetFieldName:"isHidden",checkFunction:m.Type.isBoolean},{fieldName:"isSupportOpenline",targetFieldName:"isHidden",checkFunction:m.Type.isBoolean},{fieldName:"isHuman",targetFieldName:"isHidden",checkFunction:m.Type.isBoolean},{fieldName:"backgroundId",targetFieldName:"backgroundId",checkFunction:m.Type.isString},{fieldName:"reactionsEnabled",targetFieldName:"reactionsEnabled",checkFunction:m.Type.isBoolean}];class We extends d.BuilderModel{getState(){return{collection:{}}}getElementState(){return{code:"",type:l.BotType.bot,appId:"",isHidden:false,isSupportOpenline:false,isHuman:false,backgroundId:"",reactionsEnabled:false}}getGetters(){return{getByUserId:e=>t=>e.collection[t],isNetwork:e=>t=>{var i;return((i=e.collection[t])==null?void 0:i.type)===l.BotType.network},isSupport:e=>t=>{var i;return((i=e.collection[t])==null?void 0:i.type)===l.BotType.support24},isAiAssistant:e=>t=>{var i;return((i=e.collection[t])==null?void 0:i.code)===l.BotCode.aiAssistant},getCopilotBotDialogId:e=>{for(const[t,i]of Object.entries(e.collection)){if(i.code===l.BotCode.copilot){return t}}return null},isCopilot:(e,t)=>e=>{const i=Number(t.getCopilotBotDialogId);return i===Number.parseInt(e,10)},getBackgroundId:e=>t=>{if(!e.collection[t]){return""}return e.collection[t].backgroundId}}}getActions(){return{set:(e,t)=>{const{userId:i,botData:s}=t;if(!s){return}e.commit("set",{userId:i,botData:{...this.getElementState(),...this.formatFields(s)}})}}}getMutations(){return{set:(e,t)=>{const{userId:i,botData:s}=t;e.collection[i]=s}}}formatFields(e){const t=I(e);if(t.type===l.RawBotType.human){t.type=l.BotType.bot;t.isHuman=true}const i=[l.RawBotType.openline,l.RawBotType.supervisor];if(i.includes(t.type)){t.type=l.BotType.bot}return u.formatFieldsWithConfig(t,Ke)}}const _e={[l.UserType.bot]:m.Loc.getMessage("IM_MODEL_USERS_CHAT_BOT"),[l.UserType.collaber]:m.Loc.getMessage("IM_MODEL_USERS_COLLABER"),default:m.Loc.getMessage("IM_MODEL_USERS_DEFAULT_NAME")};class Xe extends d.BuilderModel{getName(){return"users"}getNestedModules(){return{bots:We}}getState(){return{collection:{},absentList:[],absentCheckInterval:null,isCurrentUserAdmin:false}}getElementState(e={}){const{id:t=0}=e;return{id:t,name:"",firstName:"",lastName:"",avatar:"",color:l.Color.base,workPosition:"",gender:"M",type:l.UserType.user,network:false,connector:false,externalAuthId:"default",status:"",idle:false,lastActivityDate:false,mobileLastDate:false,birthday:false,isBirthday:false,absent:false,isAbsent:false,departments:[],phones:{workPhone:"",personalMobile:"",personalPhone:"",innerPhone:""},email:"",website:""}}getGetters(){return{get:e=>(t,i=false)=>{const s=e.collection[t];if(!i&&!s){return null}if(i&&!s){return this.getElementState({id:t})}return s},getBlank:()=>e=>this.getElementState(e),getList:e=>t=>{const i=[];if(!Array.isArray(t)){return null}t.forEach((t=>{if(e.collection[t]){i.push(e.collection[t])}else{i.push(this.getElementState({id:t}))}}));return i},hasBirthday:e=>t=>{const i=Number.parseInt(t,10);const s=e.collection[i];if(i<=0||!s){return false}return s.isBirthday},hasVacation:e=>t=>{const i=Number.parseInt(t,10);const s=e.collection[i];if(i<=0||!s){return false}return s.isAbsent},getLastOnline:e=>t=>{const i=Number.parseInt(t,10);const s=e.collection[i];if(i<=0||!s){return""}return r.Utils.user.getLastDateText(s)},getPosition:e=>t=>{var i;const s=Number.parseInt(t,10);const o=e.collection[s];const a=c.Core.getStore().getters["users/bots/isSupport"](s);if(s<=0||!o||a){return""}if(o.workPosition){return o.workPosition}return(i=_e[o.type])!=null?i:_e.default},isCurrentUserAdmin:e=>e.isCurrentUserAdmin}}getActions(){return{set:(e,t)=>{let i=t;if(!Array.isArray(i)&&m.Type.isPlainObject(i)){i=[i]}i.map((e=>this.formatFields(e))).forEach((t=>{const i=e.state.collection[t.id];if(i){e.commit("update",{id:t.id,fields:t})}else{e.commit("add",{id:t.id,fields:{...this.getElementState(),...t}})}}))},add:(e,t)=>{let i=t;if(!Array.isArray(i)&&m.Type.isPlainObject(i)){i=[i]}i.map((e=>this.formatFields(e))).forEach((t=>{const i=e.state.collection[t.id];if(!i){e.commit("add",{id:t.id,fields:{...this.getElementState(),...t}})}}))},update:(e,t)=>{const i=t;i.id=Number.parseInt(i.id,10);const s=e.state.collection[i.id];if(!s){return}const o={...i.fields,id:i.id};e.commit("update",{id:i.id,fields:this.formatFields(o)})},delete:(e,t)=>{e.commit("delete",t.id)},setStatus:(e,t)=>{e.commit("update",{id:c.Core.getUserId(),fields:this.formatFields(t)})},setCurrentUserAdminStatus:(e,t)=>{e.commit("setCurrentUserAdminStatus",t)}}}getMutations(){return{add:(e,t)=>{e.collection[t.id]=t.fields;o.UserStatusManager.getInstance().onUserUpdate(t.fields)},update:(e,t)=>{e.collection[t.id]={...e.collection[t.id],...t.fields};o.UserStatusManager.getInstance().onUserUpdate(t.fields)},delete:(e,t)=>{delete e.collection[t.id]},setCurrentUserAdminStatus:(e,t)=>{e.isCurrentUserAdmin=t}}}formatFields(e){const t=u.formatFieldsWithConfig(e,Ge);const i=t.type===l.UserType.bot;if(i){c.Core.getStore().dispatch("users/bots/set",{userId:t.id,botData:e.botData||e.bot_data})}return t}addToAbsentList(e){const t=this.store.state.users;if(!t.absentList.includes(e)){t.absentList.push(e)}}startAbsentCheckInterval(){const e=this.store.state.users;if(e.absentCheckInterval){return}const t=1e3*60*60*24;e.absentCheckInterval=setTimeout((()=>{setInterval((()=>{e.absentList.forEach((t=>{const i=e.collection[t];if(!i){return}const s=Date.now();const o=new Date(i.absent).getTime();if(o<=s){e.absentList=e.absentList.filter((e=>e!==t));i.isAbsent=false}}))}),t)}),r.Utils.date.getTimeToNextMidnight())}}const ze=e=>{const t=e.extension.toString();if(e.type==="image"){return"img"}if(e.type==="video"){return"mov"}return r.Utils.file.getIconTypeByExtension(t)};const $e=e=>{let t={width:0,height:0};if(m.Type.isString(e.width)||m.Type.isNumber(e.width)){t.width=Number.parseInt(e.width,10)}if(m.Type.isString(e.height)||m.Type.isNumber(e.height)){t.height=Number.parseInt(e.height,10)}if(t.width<=0||t.height<=0){t=false}return t};const Ye=e=>{if(!e||e.startsWith("http")||e.startsWith("bx")||e.startsWith("file")||e.startsWith("blob")){return e}return c.Core.getHost()+e};const qe=[{fieldName:"id",targetFieldName:"id",checkFunction:g},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:g,formatFunction:f},{fieldName:"date",targetFieldName:"date",formatFunction:r.Utils.date.cast},{fieldName:"type",targetFieldName:"type",checkFunction:m.Type.isString},{fieldName:"extension",targetFieldName:"icon",checkFunction:m.Type.isString,formatFunction:(e,t,i)=>ze(i)},{fieldName:"name",targetFieldName:"name",checkFunction:g,formatFunction:h},{fieldName:"size",targetFieldName:"size",checkFunction:g,formatFunction:f},{fieldName:"image",targetFieldName:"image",checkFunction:[m.Type.isPlainObject,m.Type.isBoolean],formatFunction:e=>{if(m.Type.isBoolean(e)){return e}return $e(e)}},{fieldName:"status",targetFieldName:"status",checkFunction:[m.Type.isString,e=>!m.Type.isUndefined(l.FileStatus[e.status])]},{fieldName:"progress",targetFieldName:"progress",checkFunction:g,formatFunction:f},{fieldName:"isVideoNote",targetFieldName:"isVideoNote",checkFunction:m.Type.isBoolean},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:g,formatFunction:f},{fieldName:"authorName",targetFieldName:"authorName",checkFunction:g,formatFunction:h},{fieldName:"urlPreview",targetFieldName:"urlPreview",checkFunction:m.Type.isString,formatFunction:Ye},{fieldName:"urlDownload",targetFieldName:"urlDownload",checkFunction:m.Type.isString,formatFunction:Ye},{fieldName:"urlShow",targetFieldName:"urlShow",checkFunction:m.Type.isString,formatFunction:Ye},{fieldName:"viewerAttrs",targetFieldName:"viewerAttrs",checkFunction:m.Type.isPlainObject},{fieldName:"isTranscribable",targetFieldName:"isTranscribable",checkFunction:m.Type.isBoolean}];class Qe extends d.BuilderModel{getName(){return"files"}getState(){return{collection:{},temporaryFilesMap:new Map,transcriptions:{}}}getElementState(){return{id:0,chatId:0,name:"File is deleted",date:new Date,type:"file",extension:"",icon:"empty",isTranscribable:false,size:0,image:null,status:l.FileStatus.done,progress:100,authorId:0,authorName:"",urlPreview:"",urlShow:"",urlDownload:"",viewerAttrs:null,isVideoNote:false}}getGetters(){return{get:(e,t)=>(i,s=false)=>{if(!i){return null}if(!s&&!e.collection[i]){return null}const o=e.collection[i];const a=t.hasMappedTemporaryFile({serverFileId:i});if(o&&a){const e=t.getMappedTemporaryFile({serverFileId:i});return{...o,urlPreview:e.urlPreview,urlShow:e.urlShow}}return o},isInCollection:e=>t=>{const{fileId:i}=t;return Boolean(e.collection[i])},hasMappedTemporaryFile:e=>t=>{if(e.temporaryFilesMap.has(t.serverFileId)){const i=e.temporaryFilesMap.get(t.serverFileId);return Object.hasOwn(e.collection,i)}return false},getMappedTemporaryFile:e=>t=>{const{serverFileId:i}=t;if(e.temporaryFilesMap.has(i)){const t=e.temporaryFilesMap.get(i);return e.collection[t]}return null},getTranscription:e=>t=>e.transcriptions[t]||null}}getActions(){return{add:(e,t)=>{const i={...this.getElementState(),...this.formatFields(t)};e.commit("add",{files:[i]})},set:(e,...t)=>{const i=t.flat().map((e=>({...this.getElementState(),...this.formatFields(e)})));e.commit("add",{files:i})},update:(e,t)=>{const{id:i,fields:s}=t;const o=e.state.collection[i];if(!o){return false}e.commit("update",{id:i,fields:this.formatFields(s)});return true},updateWithId:(e,t)=>{const{id:i,fields:s}=t;if(!e.state.collection[i]){return}e.commit("updateWithId",{id:i,fields:this.formatFields(s)})},delete:(e,t)=>{const{id:i}=t;if(!e.state.collection[i]){return}e.commit("delete",{id:i})},setTemporaryFileMapping:(e,t)=>{e.commit("setTemporaryFileMapping",t)},setTranscription:(e,t)=>{const{fileId:i,status:s,transcriptText:o,errorCode:a}=t;e.commit("setTranscription",{fileId:i,status:s,transcriptText:o,errorCode:a})}}}getMutations(){return{add:(e,t)=>{t.files.forEach((t=>{e.collection[t.id]=t}))},update:(e,t)=>{Object.entries(t.fields).forEach((([i,s])=>{e.collection[t.id][i]=s}))},updateWithId:(e,t)=>{const{id:i,fields:s}=t;const o={...e.collection[i]};delete e.collection[i];e.collection[s.id]={...o,...s}},delete:(e,t)=>{a.Logger.warn("Files model: delete mutation",t);const{id:i}=t;delete e.collection[i]},setTemporaryFileMapping:(e,t)=>{e.temporaryFilesMap.set(t.serverFileId,t.temporaryFileId)},setTranscription:(e,t)=>{e.transcriptions[t.fileId]={status:t.status,transcriptText:t.transcriptText,errorCode:t.errorCode}}}}formatFields(e){return u.formatFieldsWithConfig(e,qe)}}const Je=e=>{if(!e.text||e.text===""){return{text:"",date:null}}return{text:e.text,date:new Date}};const Ze=e=>{if(m.Type.isPlainObject(e)){return{isActive:true,originator:e.originatorId,canResend:e.canResend}}return{isActive:false,originator:0,canResend:false}};const et=[{fieldName:["id","dialogId"],targetFieldName:"dialogId",checkFunction:g,formatFunction:h},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:g},{fieldName:"draft",targetFieldName:"draft",checkFunction:m.Type.isPlainObject,formatFunction:Je},{fieldName:"invited",targetFieldName:"invitation",checkFunction:[m.Type.isPlainObject,m.Type.isBoolean],formatFunction:Ze},{fieldName:"unread",targetFieldName:"unread",checkFunction:m.Type.isBoolean},{fieldName:"pinned",targetFieldName:"pinned",checkFunction:m.Type.isBoolean},{fieldName:"liked",targetFieldName:"liked",checkFunction:m.Type.isBoolean},{fieldName:["defaultUserRecord","isFakeElement"],targetFieldName:"isFakeElement",checkFunction:m.Type.isBoolean},{fieldName:"isBirthdayPlaceholder",targetFieldName:"isBirthdayPlaceholder",checkFunction:m.Type.isBoolean},{fieldName:["dateLastActivity","lastActivityDate"],targetFieldName:"lastActivityDate",checkFunction:[m.Type.isString,m.Type.isDate],formatFunction:r.Utils.date.cast}];class tt extends d.BuilderModel{getState(){return{collection:{}}}getElementState(){return{dialogId:0,name:"",call:{},state:l.RecentCallStatus.waiting}}getGetters(){return{get:e=>Object.values(e.collection),getCallByDialog:e=>t=>e.collection[t],hasActiveCall:e=>t=>{if(m.Type.isUndefined(t)){const t=Object.values(e.collection).find((e=>e.state===l.RecentCallStatus.joined));return Boolean(t)}const i=Object.values(e.collection).find((e=>e.dialogId===t));if(!i){return false}return i.state===l.RecentCallStatus.joined}}}getActions(){return{addActiveCall:(e,t)=>{const i=Object.values(e.state.collection).find((e=>e.dialogId===t.dialogId||e.call.uuid===t.call.uuid));if(i){e.commit("updateActiveCall",{dialogId:i.dialogId,fields:this.validateActiveCall(t)});return true}e.commit("addActiveCall",this.prepareActiveCall(t))},updateActiveCall:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("updateActiveCall",{dialogId:i.dialogId,fields:this.validateActiveCall(t.fields)})},deleteActiveCall:(e,t)=>{const i=e.state.collection[t.dialogId];if(!i){return}e.commit("deleteActiveCall",{dialogId:i.dialogId})}}}getMutations(){return{addActiveCall:(e,t)=>{e.collection[t.dialogId]=t},updateActiveCall:(e,t)=>{e.collection[t.dialogId]={...e.collection[t.dialogId],...t.fields}},deleteActiveCall:(e,t)=>{delete e.collection[t.dialogId]}}}prepareActiveCall(e){return{...this.getElementState(),...this.validateActiveCall(e)}}validateActiveCall(e){const t={};if(m.Type.isStringFilled(e.dialogId)||m.Type.isNumber(e.dialogId)){t.dialogId=e.dialogId}if(m.Type.isStringFilled(e.name)){t.name=e.name}if(m.Type.isObjectLike(e.call)){var i,s;t.call=e.call;if(((i=e.call)==null?void 0:(s=i.associatedEntity)==null?void 0:s.avatar)==="/bitrix/js/im/images/blank.gif"){t.call.associatedEntity.avatar=""}}if(l.RecentCallStatus[e.state]){t.state=e.state}return t}}var it=babelHelpers.classPrivateFieldLooseKey("formatFields");var st=babelHelpers.classPrivateFieldLooseKey("updateUnloadedRecentCounters");var ot=babelHelpers.classPrivateFieldLooseKey("updateUnloadedCopilotCounters");var at=babelHelpers.classPrivateFieldLooseKey("updateUnloadedCollabCounters");var nt=babelHelpers.classPrivateFieldLooseKey("updateUnloadedTaskCounters");var rt=babelHelpers.classPrivateFieldLooseKey("updateUnloadedCounters");var lt=babelHelpers.classPrivateFieldLooseKey("getMessage");var ct=babelHelpers.classPrivateFieldLooseKey("getDialog");var dt=babelHelpers.classPrivateFieldLooseKey("hasTodayMessage");var ut=babelHelpers.classPrivateFieldLooseKey("canDelete");var mt=babelHelpers.classPrivateFieldLooseKey("handleFakeItemWithDraft");var gt=babelHelpers.classPrivateFieldLooseKey("prepareFakeItemWithDraft");var ht=babelHelpers.classPrivateFieldLooseKey("createFakeMessageForDraft");var ft=babelHelpers.classPrivateFieldLooseKey("shouldDeleteItemWithDraft");class pt extends d.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,ft,{value:Et});Object.defineProperty(this,ht,{value:Mt});Object.defineProperty(this,gt,{value:Lt});Object.defineProperty(this,mt,{value:Pt});Object.defineProperty(this,ut,{value:kt});Object.defineProperty(this,dt,{value:vt});Object.defineProperty(this,ct,{value:Tt});Object.defineProperty(this,lt,{value:St});Object.defineProperty(this,rt,{value:Ct});Object.defineProperty(this,nt,{value:bt});Object.defineProperty(this,at,{value:Nt});Object.defineProperty(this,ot,{value:Ft});Object.defineProperty(this,st,{value:It});Object.defineProperty(this,it,{value:yt})}getName(){return"recent"}getNestedModules(){return{calls:tt}}getState(){return{collection:{},recentCollection:new Set,unreadCollection:new Set,copilotCollection:new Set,channelCollection:new Set,collabCollection:new Set,taskCollection:new Set}}getElementState(){return{dialogId:"0",messageId:0,draft:{text:"",date:null},unread:false,pinned:false,liked:false,invitation:{isActive:false,originator:0,canResend:false},isFakeElement:false,isBirthdayPlaceholder:false,lastActivityDate:null}}getGetters(){return{getRecentCollection:e=>[...e.recentCollection].filter((e=>{const t=this.store.getters["chats/get"](e);return Boolean(t)})).map((t=>e.collection[t])),getUnreadCollection:e=>[...e.unreadCollection].map((t=>e.collection[t])),getCopilotCollection:e=>[...e.copilotCollection].filter((e=>{const t=this.store.getters["chats/get"](e);return Boolean(t)})).map((t=>e.collection[t])),getChannelCollection:e=>[...e.channelCollection].filter((e=>{const t=this.store.getters["chats/get"](e);return Boolean(t)})).map((t=>e.collection[t])),getCollabCollection:e=>[...e.collabCollection].filter((e=>{const t=this.store.getters["chats/get"](e);return Boolean(t)})).map((t=>e.collection[t])),getTaskCollection:e=>[...e.taskCollection].filter((e=>{const t=this.store.getters["chats/get"](e);return Boolean(t)})).map((t=>e.collection[t])),getSortedCollection:e=>{const t=[...e.recentCollection].map((t=>e.collection[t]));return t.sort(((e,t)=>{const i=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt](e.messageId);const s=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt](t.messageId);return s.date-i.date}))},get:e=>t=>{if(!e.collection[t]){return null}return e.collection[t]},getMessage:e=>t=>{const i=e.collection[t];if(!i){return null}return babelHelpers.classPrivateFieldLooseBase(this,lt)[lt](i.messageId)},needsBirthdayPlaceholder:e=>t=>{const i=e.collection[t];if(!i){return false}const s=this.store.getters["chats/get"](t);if(!s||s.type!==l.ChatType.user){return false}const o=this.store.getters["users/hasBirthday"](t);if(!o){return false}const a=Number.parseInt(t,10)===c.Core.getUserId();if(a){return false}const n=this.store.getters["application/settings/get"](l.Settings.recent.showBirthday);const r=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](i.messageId);return n&&!r&&s.counter===0},needsVacationPlaceholder:e=>t=>{const i=e.collection[t];if(!i){return false}const s=c.Core.getStore().getters["chats/isNotes"](t);if(s){return false}const o=this.store.getters["chats/get"](t);if(!o||o.type!==l.ChatType.user){return false}const a=this.store.getters["users/hasVacation"](t);if(!a){return false}const n=babelHelpers.classPrivateFieldLooseBase(this,dt)[dt](i.messageId);return!n&&o.counter===0},getSortDate:e=>t=>{const i=e.collection[t];if(!i){return null}const s=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt](i.messageId);if(m.Type.isDate(i.draft.date)&&i.draft.date>s.date){return i.draft.date}const o=this.store.getters["recent/needsBirthdayPlaceholder"](i.dialogId);if(o){return r.Utils.date.getStartOfTheDay()}const a=i.lastActivityDate;const l=m.Type.isDate(a)&&a>s.date;if(n.ChannelManager.isChannel(i.dialogId)&&l){return a}return s.date},isInRecentCollection:e=>t=>e.recentCollection.has(t),isInCollabCollection:e=>t=>e.collabCollection.has(t),isInTaskCollection:e=>t=>e.taskCollection.has(t),isInCopilotCollection:e=>t=>e.copilotCollection.has(t)}}getActions(){return{setRecent:async(e,t)=>{const i=await c.Core.getStore().dispatch("recent/store",t);e.commit("setRecentCollection",i);babelHelpers.classPrivateFieldLooseBase(this,st)[st](t)},setUnread:async(e,t)=>{const i=await this.store.dispatch("recent/store",t);e.commit("setUnreadCollection",i)},setCopilot:async(e,t)=>{const i=await this.store.dispatch("recent/store",t);e.commit("setCopilotCollection",i);babelHelpers.classPrivateFieldLooseBase(this,ot)[ot](t)},setChannel:async(e,t)=>{const i=await this.store.dispatch("recent/store",t);e.commit("setChannelCollection",i)},setCollab:async(e,t)=>{const i=await this.store.dispatch("recent/store",t);e.commit("setCollabCollection",i);babelHelpers.classPrivateFieldLooseBase(this,at)[at](t)},setTask:async(e,t)=>{const i=await this.store.dispatch("recent/store",t);e.commit("setTaskCollection",i);babelHelpers.classPrivateFieldLooseBase(this,nt)[nt](t)},clearChannelCollection:e=>{e.commit("clearChannelCollection")},clearUnreadCollection:e=>{e.commit("clearUnreadCollection")},store:(e,t)=>{if(!Array.isArray(t)&&m.Type.isPlainObject(t)){t=[t]}const i=[];const s=[];t.map((e=>babelHelpers.classPrivateFieldLooseBase(this,it)[it](e))).forEach((t=>{const o={...t};const a=e.state.collection[t.dialogId];if(a){i.push({dialogId:a.dialogId,fields:o})}else{s.push({...this.getElementState(),...o})}}));if(s.length>0){e.commit("add",s)}if(i.length>0){e.commit("update",i)}return[...s,...i].map((e=>e.dialogId))},update:(e,t)=>{const{id:i,fields:s}=t;const o=e.state.collection[i];if(!o){return}e.commit("update",{dialogId:o.dialogId,fields:babelHelpers.classPrivateFieldLooseBase(this,it)[it](s)})},unread:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}e.commit("update",{dialogId:i.dialogId,fields:{unread:t.action}})},pin:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}e.commit("update",{dialogId:i.dialogId,fields:{pinned:t.action}})},like:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}const s=i.messageId===Number.parseInt(t.messageId,10);const o=!m.Type.isUndefined(t.messageId)&&t.liked===true;if(o&&!s){return}e.commit("update",{dialogId:i.dialogId,fields:{liked:t.liked===true}})},setDraft:(e,t)=>{const{id:i,text:s,addFakeItems:o=true}=t;const a=!m.Type.isStringFilled(s);if(a&&babelHelpers.classPrivateFieldLooseBase(this,ft)[ft](t)){void c.Core.getStore().dispatch("recent/hide",{id:i});return}const n=e.state.recentCollection.has(i);const r=!n&&!a;if(r&&o){babelHelpers.classPrivateFieldLooseBase(this,mt)[mt](t,e)}const l=e.state.collection[i];if(!l){return}void c.Core.getStore().dispatch("recent/update",{id:i,fields:{draft:{text:s.toString()}}})},hide:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}e.commit("deleteCollections",i.dialogId);const s=babelHelpers.classPrivateFieldLooseBase(this,ut)[ut](i.dialogId);if(!s){return}e.commit("delete",{id:i.dialogId})},delete:(e,t)=>{const i=e.state.collection[t.id];if(!i){return}e.commit("deleteCollections",i.dialogId);e.commit("deleteFromChannelCollection",i.dialogId);const s=babelHelpers.classPrivateFieldLooseBase(this,ut)[ut](i.dialogId);if(!s){return}e.commit("delete",{id:i.dialogId})},resetTasksUnreadStatus:e=>{e.commit("resetTasksUnreadStatus")},resetUnreadStatus:e=>{e.commit("resetUnreadStatus")}}}getMutations(){return{setRecentCollection:(e,t)=>{t.forEach((t=>{e.recentCollection.add(t)}))},setUnreadCollection:(e,t)=>{t.forEach((t=>{e.unreadCollection.add(t)}))},setCopilotCollection:(e,t)=>{t.forEach((t=>{e.copilotCollection.add(t)}))},deleteFromChannelCollection:(e,t)=>{e.channelCollection.delete(t)},setChannelCollection:(e,t)=>{t.forEach((t=>{e.channelCollection.add(t)}))},clearChannelCollection:e=>{e.channelCollection=new Set},clearUnreadCollection:e=>{e.unreadCollection=new Set},setCollabCollection:(e,t)=>{t.forEach((t=>{e.collabCollection.add(t)}))},setTaskCollection:(e,t)=>{t.forEach((t=>{e.taskCollection.add(t)}))},add:(e,t)=>{if(!Array.isArray(t)&&m.Type.isPlainObject(t)){t=[t]}t.forEach((t=>{e.collection[t.dialogId]=t}))},update:(e,t)=>{if(!Array.isArray(t)&&m.Type.isPlainObject(t)){t=[t]}t.forEach((({dialogId:t,fields:i})=>{const s=e.recentCollection.has(t);const o=i.isFakeElement&&r.Utils.text.isTempMessage(i.messageId);if(s&&o&&!i.invitation){return}const a=e.collection[t];e.collection[t]={...a,...i}}))},delete:(e,t)=>{delete e.collection[t.id]},resetTasksUnreadStatus:e=>{[...e.taskCollection].forEach((t=>{e.collection[t].unread=false}))},resetUnreadStatus:e=>{Object.keys(e.collection).forEach((t=>{e.collection[t].unread=false}))},deleteCollections:(e,t)=>{e.recentCollection.delete(t);e.copilotCollection.delete(t);e.collabCollection.delete(t);e.taskCollection.delete(t)}}}}function yt(e){const t=m.Type.isPlainObject(e.options)?e.options:{};const i={...e,...t};return u.formatFieldsWithConfig(i,et)}function It(e){babelHelpers.classPrivateFieldLooseBase(this,rt)[rt](e,"counters/setUnloadedChatCounters")}function Ft(e){babelHelpers.classPrivateFieldLooseBase(this,rt)[rt](e,"counters/setUnloadedCopilotCounters")}function Nt(e){babelHelpers.classPrivateFieldLooseBase(this,rt)[rt](e,"counters/setUnloadedCollabCounters")}function bt(e){babelHelpers.classPrivateFieldLooseBase(this,rt)[rt](e,"counters/setUnloadedTaskCounters")}function Ct(e,t){if(!Array.isArray(e)&&m.Type.isPlainObject(e)){e=[e]}const i={};const s=e.map((e=>u.convertObjectKeysToCamelCase(e)));s.forEach((e=>{i[e.chatId]=0}));void c.Core.getStore().dispatch(t,i)}function St(e){return c.Core.getStore().getters["messages/getById"](e)}function Tt(e){return c.Core.getStore().getters["chats/get"](e)}function vt(e){const t=babelHelpers.classPrivateFieldLooseBase(this,lt)[lt](e);const i=r.Utils.text.isUuidV4(t.id)||t.id>0;return i&&r.Utils.date.isToday(t.date)}function kt(e){const t=[l.ChatType.openChannel];const{type:i}=babelHelpers.classPrivateFieldLooseBase(this,ct)[ct](e);return!t.includes(i)}function Pt(e,t){const i=t.state.collection[e.id];if(!i){t.commit("add",{...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,gt)[gt](e)})}t.commit("setRecentCollection",[e.id.toString()])}function Lt(e){const t=babelHelpers.classPrivateFieldLooseBase(this,ht)[ht](e.id);return babelHelpers.classPrivateFieldLooseBase(this,it)[it]({dialogId:e.id.toString(),draft:{text:e.text.toString()},messageId:t})}function Mt(e){const t=`${l.FakeDraftMessagePrefix}-${e}`;void c.Core.getStore().dispatch("messages/store",{id:t,date:new Date});return t}function Et(e){const t=c.Core.getStore().state.recent.collection[e.id];return t&&!m.Type.isStringFilled(e.text)&&t.messageId.toString().startsWith(l.FakeDraftMessagePrefix)}class Bt extends d.BuilderModel{getName(){return"notifications"}getState(){return{collection:new Map,searchCollection:new Map,unreadCounter:0}}getElementState(){return{id:0,authorId:0,date:new Date,title:"",text:"",params:{},replaces:[],notifyButtons:[],sectionCode:l.NotificationTypesCodes.simple,read:false,settingName:"im|default",moduleId:""}}getGetters(){return{getSortedCollection:e=>[...e.collection.values()].sort(this.sortByType),getSearchResultCollection:e=>[...e.searchCollection.values()].sort(this.sortByType),getConfirmsCount:e=>[...e.collection.values()].filter((e=>e.sectionCode===l.NotificationTypesCodes.confirm)).length,getById:e=>t=>{if(m.Type.isString(t)){t=Number.parseInt(t,10)}const i=e.collection.get(t);if(!i){return false}return i},getSearchItemById:e=>t=>{if(m.Type.isString(t)){const i=Number.parseInt(t,10);const s=e.searchCollection.get(i);return s!=null?s:null}const i=e.searchCollection.get(t);return i!=null?i:null},getCounter:e=>e.unreadCounter}}getActions(){return{initialSet:(e,t)=>{if(m.Type.isNumber(t.total_unread_count)){e.commit("setCounter",t.total_unread_count)}if(!m.Type.isArrayFilled(t.notifications)){return}const i=[];const s=[];const o=c.Core.getUserId();t.notifications.map((e=>Bt.validate(e,o))).forEach((t=>{const o=e.state.collection.get(t.id);if(o){i.push({id:o.id,fields:{...t}})}else{s.push({...this.getElementState(),...t})}}));if(s.length>0){e.commit("add",s)}if(i.length>0){e.commit("update",i)}},set:(e,t)=>{if(!Array.isArray(t)&&m.Type.isPlainObject(t)){t=[t]}const i=[];const s=[];const o=c.Core.getUserId();t.map((e=>Bt.validate(e,o))).forEach((t=>{const o=e.state.collection.get(t.id);if(o){i.push({id:o.id,fields:{...t}})}else{s.push({...this.getElementState(),...t})}}));if(s.length>0){e.commit("add",s)}if(i.length>0){e.commit("update",i)}},setSearchResult:(e,t)=>{const i=[];const s=[];let{notifications:o}=t;const a=!!t.skipValidation;if(!a){const e=c.Core.getUserId();o=o.map((t=>Bt.validate(t,e)))}o.forEach((t=>{const o=e.state.searchCollection.get(t.id);if(o){i.push({id:o.id,fields:{...t}})}else{s.push({...this.getElementState(),...t})}}));if(s.length>0){e.commit("addSearchResult",s)}if(i.length>0){e.commit("updateSearchResult",i)}},read:(e,t)=>{t.ids.forEach((i=>{const s=e.state.collection.get(i);if(!s||s.read===t.read){return false}if(t.read){e.commit("decreaseCounter")}else{e.commit("increaseCounter")}e.commit("read",{id:s.id,read:t.read})}))},readAllSimple:(e,t={})=>{const i=t.excludeIds||[];const s=new Set(i);const o=[];e.state.collection.forEach((e=>{if(!e.read&&e.sectionCode===l.NotificationTypesCodes.simple&&!s.has(e.id)){o.push(e.id)}}));if(o.length>0){e.commit("markAsRead",o)}},delete:(e,t)=>{const i=e.state.collection.get(t.id);if(!i){return}if(i.read===false){e.commit("decreaseCounter")}e.commit("delete",{id:i.id})},deleteFromSearch:(e,t)=>{const i=e.state.searchCollection.get(t.id);if(!i){return}e.commit("delete",{id:i.id})},clearSearchResult:e=>{e.commit("clearSearchResult")},setCounter:(e,t)=>{e.commit("setCounter",t)}}}getMutations(){return{add:(e,t)=>{t.forEach((t=>{e.collection.set(t.id,t)}))},addSearchResult:(e,t)=>{t.forEach((t=>{e.searchCollection.set(t.id,t)}))},update:(e,t)=>{t.forEach((t=>{e.collection.set(t.id,{...e.collection.get(t.id),...t.fields})}))},updateSearchResult:(e,t)=>{t.forEach((t=>{e.searchCollection.set(t.id,{...e.searchCollection.get(t.id),...t.fields})}))},delete:(e,t)=>{e.collection.delete(t.id);e.searchCollection.delete(t.id)},read:(e,t)=>{e.collection.set(t.id,{...e.collection.get(t.id),read:t.read});e.searchCollection.set(t.id,{...e.collection.get(t.id),read:t.read})},readAll:e=>{[...e.collection.values()].forEach((e=>{if(!e.read){e.read=true}}))},markAsRead:(e,t)=>{t.forEach((t=>{const i=e.collection.get(t);if(i){i.read=true;const s=e.searchCollection.get(t);if(s){s.read=true}}}))},setCounter:(e,t)=>{e.unreadCounter=Number.parseInt(t,10)},decreaseCounter:e=>{if(e.unreadCounter>0){e.unreadCounter--}},increaseCounter:e=>{e.unreadCounter++},clearSearchResult:e=>{e.searchCollection.clear()}}}static validate(e){const t={};if(m.Type.isString(e.id)||m.Type.isNumber(e.id)){t.id=e.id}if(m.Type.isNumber(e.author_id)){t.authorId=e.author_id}else if(m.Type.isNumber(e.userId)){t.authorId=e.userId}if(!m.Type.isNil(e.date)){t.date=r.Utils.date.cast(e.date)}if(m.Type.isString(e.notify_title)){t.title=e.notify_title}else if(m.Type.isString(e.title)){t.title=e.title}if(m.Type.isString(e.text)||m.Type.isNumber(e.text)){t.text=m.Text.decode(e.text.toString())}if(m.Type.isObjectLike(e.params)){t.params=I(e.params)}if(m.Type.isArray(e.replaces)){t.replaces=e.replaces}if(!m.Type.isNil(e.notify_buttons)){t.notifyButtons=JSON.parse(e.notify_buttons)}else if(!m.Type.isNil(e.buttons)){t.notifyButtons=e.buttons.map((e=>({COMMAND:"notifyConfirm",COMMAND_PARAMS:`${t.id}|${e.VALUE}`,TEXT:`${e.TITLE}`,TYPE:"BUTTON",DISPLAY:"LINE",BG_COLOR:e.VALUE==="Y"?"#8bc84b":"#ef4b57",TEXT_COLOR:"#fff"})))}if(e.notify_type===l.NotificationTypesCodes.confirm||e.type===l.NotificationTypesCodes.confirm){t.sectionCode=l.NotificationTypesCodes.confirm}else{t.sectionCode=l.NotificationTypesCodes.simple}if(!m.Type.isNil(e.notify_read)){t.read=e.notify_read==="Y"}else if(!m.Type.isNil(e.read)){t.read=e.read==="Y"}if(m.Type.isString(e.setting_name)){t.settingName=e.setting_name}else if(m.Type.isString(e.settingName)){t.settingName=e.settingName}if(m.Type.isString(e.notify_module)){t.moduleId=e.notify_module}return t}sortByType(e,t){if(e.sectionCode===l.NotificationTypesCodes.confirm&&t.sectionCode!==l.NotificationTypesCodes.confirm){return-1}else if(e.sectionCode!==l.NotificationTypesCodes.confirm&&t.sectionCode===l.NotificationTypesCodes.confirm){return 1}else{return t.id-e.id}}}const xt=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:m.Type.isNumber},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:m.Type.isNumber},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:m.Type.isNumber},{fieldName:"url",targetFieldName:"source",checkFunction:m.Type.isPlainObject,formatFunction:e=>{var t;return(t=e.source)!=null?t:""}},{fieldName:"dateCreate",targetFieldName:"date",checkFunction:m.Type.isString,formatFunction:r.Utils.date.cast},{fieldName:"url",targetFieldName:"richData",checkFunction:m.Type.isPlainObject,formatFunction:e=>v(e.richData,At)}];const At=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"description",targetFieldName:"description",checkFunction:m.Type.isString},{fieldName:"link",targetFieldName:"link",checkFunction:m.Type.isString},{fieldName:"name",targetFieldName:"name",checkFunction:m.Type.isString},{fieldName:"previewUrl",targetFieldName:"previewUrl",checkFunction:m.Type.isString},{fieldName:"type",targetFieldName:"type",checkFunction:m.Type.isString}];class Ht extends d.BuilderModel{getState(){return{collection:{},collectionSearch:{},counters:{},historyLimitExceededCollection:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,source:"",date:new Date,richData:{id:null,description:null,link:null,name:null,previewUrl:null,type:null}}}getChatState(){return{items:new Map,hasNextPage:true}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].items.values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].items.size},getCounter:e=>t=>{if(!e.counters[t]){return 0}return e.counters[t]},hasNextPage:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].hasNextPage},hasNextPageSearch:e=>t=>{if(!e.collectionSearch[t]){return false}return e.collectionSearch[t].hasNextPage},getSearchResultCollectionSize:e=>t=>{if(!e.collectionSearch[t]){return 0}return e.collectionSearch[t].items.size},getSearchResultCollection:e=>t=>{if(!e.collectionSearch[t]){return[]}return[...e.collectionSearch[t].items.values()].sort(((e,t)=>t.id-e.id))},isHistoryLimitExceeded:e=>t=>{var i;const s=c.Core.getStore().getters["application/tariffRestrictions/isHistoryAvailable"];if(s){return false}return(i=e.historyLimitExceededCollection[t])!=null?i:false}}}getActions(){return{setCounter:(e,t)=>{if(!m.Type.isNumber(t.counter)||!m.Type.isNumber(t.chatId)){return}e.commit("setCounter",t)},set:(e,t)=>{const{chatId:i,links:s,hasNextPage:o,isHistoryLimitExceeded:a=false}=t;if(!m.Type.isNumber(i)){return}e.commit("setHasNextPage",{chatId:i,hasNextPage:o});e.commit("setHistoryLimitExceeded",{chatId:i,isHistoryLimitExceeded:a});s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("add",{chatId:i,link:s})}))},setSearch:(e,t)=>{const{chatId:i,links:s,hasNextPage:o,isHistoryLimitExceeded:a=false}=t;if(!m.Type.isNumber(i)){return}e.commit("setHasNextPageSearch",{chatId:i,hasNextPage:o});e.commit("setHistoryLimitExceeded",{chatId:i,isHistoryLimitExceeded:a});s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("addSearch",{chatId:i,link:s})}))},clearSearch:e=>{e.commit("clearSearch",{})},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!m.Type.isNumber(s)||!m.Type.isNumber(i)){return}if(!e.state.collection[i]||!e.state.collection[i].items.has(s)){return}e.commit("delete",{chatId:i,id:s})}}}getMutations(){return{setHasNextPage:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].hasNextPage=s},setHasNextPageSearch:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(!o){e.collectionSearch[i]=this.getChatState()}e.collectionSearch[i].hasNextPage=s},setHistoryLimitExceeded:(e,t)=>{const{chatId:i,isHistoryLimitExceeded:s}=t;if(e.historyLimitExceededCollection[i]&&!s){return}e.historyLimitExceededCollection[i]=s},setCounter:(e,t)=>{const{chatId:i,counter:s}=t;e.counters[i]=s},add:(e,t)=>{const{chatId:i,link:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].items.set(s.id,s)},addSearch:(e,t)=>{const{chatId:i,link:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(!o){e.collectionSearch[i]=this.getChatState()}e.collectionSearch[i].items.set(s.id,s)},clearSearch:e=>{e.collectionSearch={}},delete:(e,t)=>{const{chatId:i,id:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(o){e.collectionSearch[i].items.delete(s)}e.collection[i].items.delete(s);e.counters[i]--}}}formatFields(e){return v(e,xt)}}const wt=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:m.Type.isNumber},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:m.Type.isNumber},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:m.Type.isNumber},{fieldName:"dateCreate",targetFieldName:"date",checkFunction:m.Type.isString,formatFunction:r.Utils.date.cast}];class Ot extends d.BuilderModel{getState(){return{collection:{},counters:{},collectionSearch:{},historyLimitExceededCollection:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date}}getChatState(){return{items:new Map,hasNextPage:true,lastId:0}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].items.values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].items.size},getCounter:e=>t=>{if(e.counters[t]){return e.counters[t]}return 0},isFavoriteMessage:e=>(t,i)=>{if(!e.collection[t]){return false}const s=Object.fromEntries(e.collection[t].items);const o=Object.values(s).find((e=>e.messageId===i));return Boolean(o)},hasNextPage:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].hasNextPage},getLastId:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].lastId},getSearchResultCollectionLastId:e=>t=>{if(!e.collectionSearch[t]){return 0}return e.collectionSearch[t].lastId},hasNextPageSearch:e=>t=>{if(!e.collectionSearch[t]){return false}return e.collectionSearch[t].hasNextPage},getSearchResultCollection:e=>t=>{if(!e.collectionSearch[t]){return[]}return[...e.collectionSearch[t].items.values()].sort(((e,t)=>t.id-e.id))},isHistoryLimitExceeded:e=>t=>{var i;const s=c.Core.getStore().getters["application/tariffRestrictions/isHistoryAvailable"];if(s){return false}return(i=e.historyLimitExceededCollection[t])!=null?i:false}}}getActions(){return{setCounter:(e,t)=>{if(!m.Type.isNumber(t.counter)||!m.Type.isNumber(t.chatId)){return}e.commit("setCounter",t)},set:(e,t)=>{if(m.Type.isNumber(t.favorites)){t.favorites=[t.favorites]}const{chatId:i,favorites:s,hasNextPage:o,lastId:a,isHistoryLimitExceeded:n=false}=t;if(!m.Type.isNumber(i)){return}e.commit("setHistoryLimitExceeded",{chatId:i,isHistoryLimitExceeded:n});e.commit("setHasNextPage",{chatId:i,hasNextPage:o});e.commit("setLastId",{chatId:i,lastId:a});s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("add",{chatId:i,favorite:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!m.Type.isNumber(s)||!m.Type.isNumber(i)){return}if(!e.state.collection[i]||!e.state.collection[i].items.has(s)){return}e.commit("delete",{chatId:i,id:s})},deleteByMessageId:(e,t)=>{const{chatId:i,messageId:s}=t;if(!e.state.collection[i]){return}const o=e.state.collection[i].items;let a=null;for(const[e,t]of o){if(t.messageId===s){a=e;break}}if(!a){return}e.commit("delete",{chatId:i,id:a})},setSearch:(e,t)=>{const{chatId:i,favorites:s,hasNextPage:o,lastId:a,isHistoryLimitExceeded:n=false}=t;if(!m.Type.isNumber(i)){return}e.commit("setHistoryLimitExceeded",{chatId:i,isHistoryLimitExceeded:n});e.commit("setHasNextPageSearch",{chatId:i,hasNextPage:o});e.commit("setLastIdSearch",{chatId:i,lastId:a});s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("addSearch",{chatId:i,favorite:s})}))},clearSearch:e=>{e.commit("clearSearch",{})}}}getMutations(){return{setHasNextPage:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].hasNextPage=s},setHasNextPageSearch:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(!o){e.collectionSearch[i]=this.getChatState()}e.collectionSearch[i].hasNextPage=s},setCounter:(e,t)=>{const{chatId:i,counter:s}=t;e.counters[i]=s},setLastId:(e,t)=>{const{chatId:i,lastId:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].lastId=s},add:(e,t)=>{const{chatId:i,favorite:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].items.set(s.id,s)},addSearch:(e,t)=>{const{chatId:i,favorite:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(!o){e.collectionSearch[i]=this.getChatState()}e.collectionSearch[i].items.set(s.id,s)},clearSearch:e=>{e.collectionSearch={}},setLastIdSearch:(e,t)=>{const{chatId:i,lastId:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(!o){e.collectionSearch[i]=this.getChatState()}e.collectionSearch[i].lastId=s},delete:(e,t)=>{const{chatId:i,id:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(o){e.collectionSearch[i].items.delete(s)}e.collection[i].items.delete(s);e.counters[i]--},setHistoryLimitExceeded:(e,t)=>{const{chatId:i,isHistoryLimitExceeded:s}=t;if(e.historyLimitExceededCollection[i]&&!s){return}e.historyLimitExceededCollection[i]=s}}}formatFields(e){return v(e,wt)}}class Ut extends d.BuilderModel{getState(){return{collection:{}}}getChatState(){return{users:new Set,hasNextPage:true,nextCursor:null,inited:false}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].users]},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].users.size},hasNextPage:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].hasNextPage},getNextCursor:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].nextCursor},getInited:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].inited}}}getActions(){return{set:(e,t)=>{const{chatId:i,users:s,hasNextPage:o,nextCursor:a}=t;if(!m.Type.isNil(o)){e.commit("setHasNextPage",{chatId:i,hasNextPage:o})}e.commit("setInited",{chatId:i,inited:true});if(s.length>0){e.commit("set",{chatId:i,users:s})}},setNextCursor:(e,t)=>{e.commit("setNextCursor",t)},delete:(e,t)=>{const{chatId:i,userId:s}=t;if(!m.Type.isNumber(i)||!m.Type.isNumber(s)){return}if(!e.state.collection[i]){return}e.commit("delete",{userId:s,chatId:i})}}}getMutations(){return{set:(e,t)=>{const{chatId:i,users:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}s.forEach((t=>{e.collection[i].users.add(t)}))},setHasNextPage:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].hasNextPage=s},setNextCursor:(e,t)=>{const{chatId:i,nextCursor:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].nextCursor=s},setInited:(e,t)=>{const{chatId:i,inited:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].inited=s},delete:(e,t)=>{const{chatId:i,userId:s}=t;e.collection[i].users.delete(s)}}}}class jt extends d.BuilderModel{getState(){return{historyLimitExceededCollection:{}}}getGetters(){return{isHistoryLimitExceeded:e=>t=>{var i;const s=c.Core.getStore().getters["application/tariffRestrictions/isHistoryAvailable"];if(s){return false}return(i=e.historyLimitExceededCollection[t])!=null?i:false}}}getActions(){return{setHistoryLimitExceeded:(e,t)=>{const{chatId:i,isHistoryLimitExceeded:s=false}=t;e.commit("setHistoryLimitExceeded",{chatId:i,isHistoryLimitExceeded:s})}}}getMutations(){return{setHistoryLimitExceeded:(e,t)=>{const{chatId:i,isHistoryLimitExceeded:s}=t;if(e.historyLimitExceededCollection[i]&&!s){return}e.historyLimitExceededCollection[i]=s}}}}const Rt=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:m.Type.isNumber},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:m.Type.isNumber},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:m.Type.isNumber},{fieldName:"dateCreate",targetFieldName:"date",checkFunction:m.Type.isString,formatFunction:r.Utils.date.cast},{fieldName:"task",targetFieldName:"task",checkFunction:m.Type.isPlainObject,formatFunction:e=>v(e,Dt)}];const Dt=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"title",targetFieldName:"title",checkFunction:m.Type.isString},{fieldName:"creatorId",targetFieldName:"creatorId",checkFunction:m.Type.isNumber},{fieldName:"responsibleId",targetFieldName:"responsibleId",checkFunction:m.Type.isNumber},{fieldName:"statusTitle",targetFieldName:"statusTitle",checkFunction:m.Type.isString},{fieldName:"deadline",targetFieldName:"deadline",checkFunction:m.Type.isString,formatFunction:r.Utils.date.cast},{fieldName:"state",targetFieldName:"state",checkFunction:m.Type.isString},{fieldName:"color",targetFieldName:"color",checkFunction:m.Type.isString},{fieldName:"source",targetFieldName:"source",checkFunction:m.Type.isString}];class Vt extends d.BuilderModel{getState(){return{collection:{},collectionSearch:{},historyLimitExceededCollection:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date,task:{id:0,title:"",creatorId:0,responsibleId:0,status:0,statusTitle:"",deadline:new Date,state:"",color:"",source:""}}}getChatState(){return{items:new Map,hasNextPage:true,lastId:0}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].items.values()].sort(((e,t)=>t.id-e.id))},getSearchResultCollection:e=>t=>{if(!e.collectionSearch[t]){return[]}return[...e.collectionSearch[t].items.values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].items.size},hasNextPage:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].hasNextPage},getLastId:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].lastId},getSearchResultCollectionLastId:e=>t=>{if(!e.collectionSearch[t]){return false}return e.collectionSearch[t].lastId},isHistoryLimitExceeded:e=>t=>{var i;const s=c.Core.getStore().getters["application/tariffRestrictions/isHistoryAvailable"];if(s){return false}return(i=e.historyLimitExceededCollection[t])!=null?i:false}}}getActions(){return{set:(e,t)=>{const{chatId:i,tasks:s,hasNextPage:o,lastId:a,isHistoryLimitExceeded:n=false}=t;if(!m.Type.isNumber(i)){return}e.commit("setHistoryLimitExceeded",{chatId:i,isHistoryLimitExceeded:n});if(!m.Type.isNil(o)){e.commit("setHasNextPage",{chatId:i,hasNextPage:o})}if(!m.Type.isNil(a)){e.commit("setLastId",{chatId:i,lastId:a})}s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("add",{chatId:i,task:s})}))},clearSearch:e=>{e.commit("clearSearch",{})},setSearch:(e,t)=>{const{chatId:i,tasks:s,hasNextPage:o,lastId:a,isHistoryLimitExceeded:n=false}=t;if(!m.Type.isNumber(i)){return}e.commit("setHistoryLimitExceeded",{chatId:i,isHistoryLimitExceeded:n});if(!m.Type.isNil(o)){e.commit("setHasNextPageSearch",{chatId:i,hasNextPage:o})}if(!m.Type.isNil(a)){e.commit("setLastIdSearch",{chatId:i,lastId:a})}s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("addSearch",{chatId:i,task:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!m.Type.isNumber(i)||!m.Type.isNumber(s)){return}if(!e.state.collection[i]){return}e.commit("delete",{id:s,chatId:i})}}}getMutations(){return{add:(e,t)=>{const{chatId:i,task:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].items.set(s.id,s)},addSearch:(e,t)=>{const{chatId:i,task:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(!o){e.collectionSearch[i]=this.getChatState()}e.collectionSearch[i].items.set(s.id,s)},delete:(e,t)=>{const{id:i,chatId:s}=t;const o=!m.Type.isNil(e.collectionSearch[s]);if(o){e.collectionSearch[s].items.delete(i)}e.collection[s].items.delete(i)},setHasNextPage:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].hasNextPage=s},setHasNextPageSearch:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(!o){e.collectionSearch[i]=this.getChatState()}e.collectionSearch[i].hasNextPage=s},setLastId:(e,t)=>{const{chatId:i,lastId:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].lastId=s},setLastIdSearch:(e,t)=>{const{chatId:i,lastId:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(!o){e.collectionSearch[i]=this.getChatState()}e.collectionSearch[i].lastId=s},clearSearch:e=>{e.collectionSearch={}},setHistoryLimitExceeded:(e,t)=>{const{chatId:i,isHistoryLimitExceeded:s}=t;if(e.historyLimitExceededCollection[i]&&!s){return}e.historyLimitExceededCollection[i]=s}}}formatFields(e){return v(e,Rt)}}const Gt=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:m.Type.isNumber},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:m.Type.isNumber},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:m.Type.isNumber},{fieldName:"dateCreate",targetFieldName:"date",checkFunction:m.Type.isString,formatFunction:r.Utils.date.cast},{fieldName:"calendar",targetFieldName:"meeting",checkFunction:m.Type.isPlainObject,formatFunction:e=>v(e,Kt)}];const Kt=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"title",targetFieldName:"title",checkFunction:m.Type.isString},{fieldName:"dateFrom",targetFieldName:"dateFrom",checkFunction:m.Type.isString,formatFunction:r.Utils.date.cast},{fieldName:"dateTo",targetFieldName:"dateTo",checkFunction:m.Type.isString,formatFunction:r.Utils.date.cast},{fieldName:"source",targetFieldName:"source",checkFunction:m.Type.isString}];class Wt extends d.BuilderModel{getState(){return{collection:{},collectionSearch:{},historyLimitExceededCollection:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date,meeting:{id:0,title:"",dateFrom:new Date,dateTo:new Date,source:""}}}getChatState(){return{items:new Map,hasNextPage:true,lastId:0}}getGetters(){return{get:e=>t=>{if(!e.collection[t]){return[]}return[...e.collection[t].items.values()].sort(((e,t)=>t.id-e.id))},getSearchResultCollection:e=>t=>{if(!e.collectionSearch[t]){return[]}return[...e.collectionSearch[t].items.values()].sort(((e,t)=>t.id-e.id))},getSize:e=>t=>{if(!e.collection[t]){return 0}return e.collection[t].items.size},hasNextPage:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].hasNextPage},getLastId:e=>t=>{if(!e.collection[t]){return false}return e.collection[t].lastId},getSearchResultCollectionLastId:e=>t=>{if(!e.collectionSearch[t]){return false}return e.collectionSearch[t].lastId},isHistoryLimitExceeded:e=>t=>{var i;const s=c.Core.getStore().getters["application/tariffRestrictions/isHistoryAvailable"];if(s){return false}return(i=e.historyLimitExceededCollection[t])!=null?i:false}}}getActions(){return{set:(e,t)=>{const{chatId:i,meetings:s,hasNextPage:o,lastId:a,isHistoryLimitExceeded:n=false}=t;if(!m.Type.isNumber(i)){return}e.commit("setHistoryLimitExceeded",{chatId:i,isHistoryLimitExceeded:n});if(!m.Type.isNil(o)){e.commit("setHasNextPage",{chatId:i,hasNextPage:o})}if(!m.Type.isNil(a)){e.commit("setLastId",{chatId:i,lastId:a})}s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("add",{chatId:i,meeting:s})}))},setSearch:(e,t)=>{const{chatId:i,meetings:s,hasNextPage:o,lastId:a,isHistoryLimitExceeded:n=false}=t;if(!m.Type.isNumber(i)){return}e.commit("setHistoryLimitExceeded",{chatId:i,isHistoryLimitExceeded:n});if(!m.Type.isNil(o)){e.commit("setHasNextPageSearch",{chatId:i,hasNextPage:o})}if(!m.Type.isNil(a)){e.commit("setLastIdSearch",{chatId:i,lastId:a})}s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("addSearch",{chatId:i,meeting:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!m.Type.isNumber(i)||!m.Type.isNumber(s)){return}if(!e.state.collection[i]){return}e.commit("delete",{id:s,chatId:i})},clearSearch:e=>{e.commit("clearSearch",{})}}}getMutations(){return{add:(e,t)=>{const{chatId:i,meeting:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].items.set(s.id,s)},addSearch:(e,t)=>{const{chatId:i,meeting:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(!o){e.collectionSearch[i]=this.getChatState()}e.collectionSearch[i].items.set(s.id,s)},delete:(e,t)=>{const{id:i,chatId:s}=t;const o=!m.Type.isNil(e.collectionSearch[s]);if(o){e.collectionSearch[s].items.delete(i)}e.collection[s].items.delete(i)},setHasNextPage:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].hasNextPage=s},setHasNextPageSearch:(e,t)=>{const{chatId:i,hasNextPage:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(!o){e.collectionSearch[i]=this.getChatState()}e.collectionSearch[i].hasNextPage=s},setLastId:(e,t)=>{const{chatId:i,lastId:s}=t;const o=!m.Type.isNil(e.collection[i]);if(!o){e.collection[i]=this.getChatState()}e.collection[i].lastId=s},setLastIdSearch:(e,t)=>{const{chatId:i,lastId:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);if(!o){e.collectionSearch[i]=this.getChatState()}e.collectionSearch[i].lastId=s},clearSearch:e=>{e.collectionSearch={}},setHistoryLimitExceeded:(e,t)=>{const{chatId:i,isHistoryLimitExceeded:s}=t;if(e.historyLimitExceededCollection[i]&&!s){return}e.historyLimitExceededCollection[i]=s}}}formatFields(e){return v(e,Gt)}}const _t=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"messageId",targetFieldName:"messageId",checkFunction:m.Type.isNumber},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:m.Type.isNumber},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:m.Type.isNumber},{fieldName:["dateCreate","date"],targetFieldName:"date",checkFunction:m.Type.isString,formatFunction:r.Utils.date.cast},{fieldName:["fileId","id"],targetFieldName:"fileId",checkFunction:m.Type.isNumber}];class Xt extends d.BuilderModel{getState(){return{collection:{},collectionSearch:{},historyLimitExceededCollection:{}}}getElementState(){return{id:0,messageId:0,chatId:0,authorId:0,date:new Date,fileId:0}}getChatState(){return{items:new Map,hasNextPage:true,lastId:0}}getGetters(){return{get:e=>(t,i)=>{if(!e.collection[t]||!e.collection[t][i]){return[]}return[...e.collection[t][i].items.values()].sort(((e,t)=>t.id-e.id))},getSearchResultCollection:e=>(t,i)=>{if(!e.collectionSearch[t]||!e.collectionSearch[t][i]){return[]}return[...e.collectionSearch[t][i].items.values()].sort(((e,t)=>t.id-e.id))},getLatest:(e,t,i,s)=>t=>{if(!e.collection[t]){return[]}let i=[];let o=[];let a=[];let n=[];if(e.collection[t][l.SidebarFileGroups.media]){i=[...e.collection[t][l.SidebarFileGroups.media].items.values()]}if(e.collection[t][l.SidebarFileGroups.audio]){o=[...e.collection[t][l.SidebarFileGroups.audio].items.values()]}if(e.collection[t][l.SidebarFileGroups.file]){a=[...e.collection[t][l.SidebarFileGroups.file].items.values()]}if(e.collection[t][l.SidebarFileGroups.brief]){n=[...e.collection[t][l.SidebarFileGroups.brief].items.values()]}const r=[i,o,a,n].flat().sort(((e,t)=>t.id-e.id));return this.getTopThreeCompletedFiles(r,s)},getLatestUnsorted:(e,t,i,s)=>t=>{if(!e.collection[t]){return[]}let i=[];if(e.collection[t][l.SidebarFileGroups.fileUnsorted]){i=[...e.collection[t][l.SidebarFileGroups.fileUnsorted].items.values()]}const o=i.sort(((e,t)=>t.id-e.id));return this.getTopThreeCompletedFiles(o,s)},getSize:e=>(t,i)=>{if(!e.collection[t]||!e.collection[t][i]){return 0}return e.collection[t][i].items.size},hasNextPage:e=>(t,i)=>{if(!e.collection[t]||!e.collection[t][i]){return false}return e.collection[t][i].hasNextPage},hasNextPageSearch:e=>(t,i)=>{if(!e.collectionSearch[t]||!e.collectionSearch[t][i]){return false}return e.collectionSearch[t][i].hasNextPage},getLastId:e=>(t,i)=>{if(!e.collection[t]||!e.collection[t][i]){return false}return e.collection[t][i].lastId},getSearchResultCollectionLastId:e=>(t,i)=>{if(!e.collectionSearch[t]||!e.collectionSearch[t][i]){return false}return e.collectionSearch[t][i].lastId},isHistoryLimitExceeded:e=>t=>{var i;const s=c.Core.getStore().getters["application/tariffRestrictions/isHistoryAvailable"];if(s){return false}return(i=e.historyLimitExceededCollection[t])!=null?i:false}}}getActions(){return{set:(e,t)=>{const{chatId:i,files:s,group:o}=t;if(!m.Type.isArrayFilled(s)||!m.Type.isNumber(i)){return}s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("add",{chatId:i,group:o,file:s})}))},setSearch:(e,t)=>{const{chatId:i,files:s,group:o}=t;if(!m.Type.isArrayFilled(s)||!m.Type.isNumber(i)){return}s.forEach((t=>{const s={...this.getElementState(),...this.formatFields(t)};e.commit("addSearch",{chatId:i,group:o,file:s})}))},delete:(e,t)=>{const{chatId:i,id:s}=t;if(!m.Type.isNumber(s)||!m.Type.isNumber(i)){return}if(!e.state.collection[i]){return}e.commit("delete",{chatId:i,id:s})},setHasNextPage:(e,t)=>{const{chatId:i,group:s,hasNextPage:o}=t;if(!m.Type.isNumber(i)){return}if(!e.state.collection[i]){return}e.commit("setHasNextPage",{chatId:i,group:s,hasNextPage:o})},setHasNextPageSearch:(e,t)=>{const{chatId:i,group:s,hasNextPage:o}=t;if(!m.Type.isNumber(i)){return}if(!e.state.collectionSearch[i]){return}e.commit("setHasNextPageSearch",{chatId:i,group:s,hasNextPage:o})},setLastId:(e,t)=>{const{chatId:i,group:s,lastId:o}=t;if(!m.Type.isNumber(i)){return}if(!e.state.collection[i]){return}e.commit("setLastId",{chatId:i,group:s,lastId:o})},setLastIdSearch:(e,t)=>{const{chatId:i,group:s,lastId:o}=t;if(!m.Type.isNumber(i)){return}if(!e.state.collectionSearch[i]){return}e.commit("setLastIdSearch",{chatId:i,group:s,lastId:o})},clearSearch:e=>{e.commit("clearSearch",{})},setHistoryLimitExceeded:(e,t)=>{const{chatId:i,isHistoryLimitExceeded:s=false}=t;e.commit("setHistoryLimitExceeded",{chatId:i,isHistoryLimitExceeded:s})}}}getMutations(){return{add:(e,t)=>{const{chatId:i,file:s,group:o}=t;if(!e.collection[i]){e.collection[i]={}}if(!e.collection[i][o]){e.collection[i][o]=this.getChatState()}e.collection[i][o].items.set(s.id,s)},addSearch:(e,t)=>{const{chatId:i,file:s,group:o}=t;if(!e.collectionSearch[i]){e.collectionSearch[i]={}}if(!e.collectionSearch[i][o]){e.collectionSearch[i][o]=this.getChatState()}e.collectionSearch[i][o].items.set(s.id,s)},delete:(e,t)=>{const{chatId:i,id:s}=t;const o=!m.Type.isNil(e.collectionSearch[i]);Object.values(l.SidebarFileGroups).forEach((t=>{if(e.collection[i][t]&&e.collection[i][t].items.has(s)){e.collection[i][t].items.delete(s);if(o){e.collectionSearch[i][t].items.delete(s)}}}))},setHasNextPage:(e,t)=>{const{chatId:i,group:s,hasNextPage:o}=t;if(!e.collection[i]){e.collection[i]={}}const a=!m.Type.isNil(e.collection[i][s]);if(!a){e.collection[i][s]=this.getChatState()}e.collection[i][s].hasNextPage=o},setHasNextPageSearch:(e,t)=>{const{chatId:i,group:s,hasNextPage:o}=t;if(!e.collectionSearch[i]){e.collectionSearch[i]={}}const a=!m.Type.isNil(e.collectionSearch[i][s]);if(!a){e.collectionSearch[i][s]=this.getChatState()}e.collectionSearch[i][s].hasNextPage=o},setLastId:(e,t)=>{const{chatId:i,group:s,lastId:o}=t;if(!e.collection[i]){e.collection[i]={}}const a=!m.Type.isNil(e.collection[i][s]);if(!a){e.collection[i][s]=this.getChatState()}e.collection[i][s].lastId=o},setLastIdSearch:(e,t)=>{const{chatId:i,group:s,lastId:o}=t;if(!e.collectionSearch[i]){e.collectionSearch[i]={}}const a=!m.Type.isNil(e.collectionSearch[i][s]);if(!a){e.collectionSearch[i][s]=this.getChatState()}e.collectionSearch[i][s].lastId=o},clearSearch:e=>{e.collectionSearch={}},setHistoryLimitExceeded:(e,t)=>{const{chatId:i,isHistoryLimitExceeded:s}=t;if(e.historyLimitExceededCollection[i]&&!s){return}e.historyLimitExceededCollection[i]=s}}}formatFields(e){return v(e,_t)}getTopThreeCompletedFiles(e,t){return e.filter((e=>{const i=t["files/get"](e.fileId,true);return i.progress===100})).slice(0,3)}}const zt=[{fieldName:"dialogId",targetFieldName:"dialogId",checkFunction:m.Type.String},{fieldName:"chatId",targetFieldName:"chatId",checkFunction:m.Type.isNumber},{fieldName:"openSessionsLimit",targetFieldName:"openSessionsLimit",checkFunction:m.Type.isNumber},{fieldName:"status",targetFieldName:"status",checkFunction:m.Type.isString},{fieldName:"dateMessage",targetFieldName:"date",checkFunction:m.Type.isString,formatFunction:r.Utils.date.cast}];class $t extends d.BuilderModel{getState(){return{isInited:false,isInitedDetail:false,chatsCount:0,unreadChats:new Set,openSessionsLimit:0,multidialogs:{}}}getElementState(){return{dialogId:"",chatId:0,status:"",date:new Date}}getGetters(){return{isInited:({isInited:e})=>e,isInitedDetail:({isInitedDetail:e})=>e,getOpenSessionsLimit:({openSessionsLimit:e})=>e,getChatsCount:({chatsCount:e})=>e,getTotalChatCounter:({unreadChats:e})=>{let t=0;e.forEach((e=>{t+=c.Core.getStore().getters["counters/getChatCounterByChatId"](e)}));return t},get:({multidialogs:e})=>t=>e[t],isSupport:()=>e=>{const t=c.Core.getStore().getters["users/bots/isSupport"](e);const i=c.Core.getStore().getters["chats/isSupport"](e);return i||t},hasNextPage:({chatsCount:e,multidialogs:t})=>e>Object.keys(t).length,getNumberMultidialogs:({multidialogs:e})=>Object.keys(e).length,getMultidialogsByStatus:({multidialogs:e})=>t=>Object.values(e).filter((e=>t.includes(e.status)))}}getActions(){return{setInited:(e,t)=>{e.commit("setInited",t)},setInitedDetail:(e,t)=>{e.commit("setInitedDetail",t)},addMultidialogs:(e,t)=>{if(!m.Type.isArray(t)){return}t.forEach((t=>{const i={...this.getElementState(),...this.formatFields(t)};e.commit("addMultidialog",i)}))},setOpenSessionsLimit:(e,t)=>{if(m.Type.isNumber(t)){e.commit("setOpenSessionsLimit",t)}},setChatsCount:(e,t)=>{if(m.Type.isNumber(t)){e.commit("setChatsCount",t)}},setUnreadChats:(e,t)=>{if(m.Type.isArray(t)){e.commit("setUnreadChats",t)}},set:(e,t)=>{const{unreadChats:i,multidialogs:s,chatsCount:o,openSessionsLimit:a}=t;e.dispatch("setUnreadChats",i);e.dispatch("setChatsCount",o);e.dispatch("setOpenSessionsLimit",a);e.dispatch("addMultidialogs",s)},deleteUnreadChats:(e,t)=>{e.commit("deleteUnreadChats",t)}}}getMutations(){return{setInited:(e,t)=>{e.isInited=t},setInitedDetail:(e,t)=>{e.isInitedDetail=t},addMultidialog:(e,t)=>{e.multidialogs[t.chatId]=t},setChatsCount:(e,t)=>{e.chatsCount=t},setOpenSessionsLimit:(e,t)=>{e.openSessionsLimit=t},setUnreadChats:(e,t)=>{t.forEach((t=>{e.unreadChats.add(t)}))},deleteUnreadChats:({unreadChats:e},t)=>{e.delete(t)}}}formatFields(e){return v(e,zt)}}class Yt extends d.BuilderModel{getName(){return"sidebar"}getNestedModules(){return{members:Ut,links:Ht,favorites:Ot,tasks:Vt,meetings:Wt,files:Xt,multidialog:$t,messageSearch:jt}}getState(){return{initedList:new Set,isFilesMigrated:false,isLinksMigrated:false}}getGetters(){return{isInited:e=>t=>e.initedList.has(t),hasHistoryLimit:()=>e=>{const t=["sidebar/links/isHistoryLimitExceeded","sidebar/files/isHistoryLimitExceeded","sidebar/favorites/isHistoryLimitExceeded","sidebar/meetings/isHistoryLimitExceeded","sidebar/tasks/isHistoryLimitExceeded","sidebar/messageSearch/isHistoryLimitExceeded"].map((t=>c.Core.getStore().getters[t](e)));return t.some((e=>e))}}}getActions(){return{setInited:(e,t)=>{if(!m.Type.isNumber(t)){return}e.commit("setInited",t)},setFilesMigrated:(e,t)=>{if(!m.Type.isBoolean(t)){return}e.commit("setFilesMigrated",t)},setLinksMigrated:(e,t)=>{if(!m.Type.isBoolean(t)){return}e.commit("setLinksMigrated",t)}}}getMutations(){return{setInited:(e,t)=>{e.initedList.add(t)},setFilesMigrated:(e,t)=>{e.isFilesMigrated=t},setLinksMigrated:(e,t)=>{e.isLinksMigrated=t}}}}var qt=babelHelpers.classPrivateFieldLooseKey("validate");var Qt=babelHelpers.classPrivateFieldLooseKey("validateOptions");var Jt=babelHelpers.classPrivateFieldLooseKey("validateLoadConfiguration");class Zt extends d.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,Jt,{value:ii});Object.defineProperty(this,Qt,{value:ti});Object.defineProperty(this,qt,{value:ei})}getName(){return"market"}getState(){return{collection:new Map,placementCollection:{[l.PlacementType.contextMenu]:new Set,[l.PlacementType.navigation]:new Set,[l.PlacementType.textarea]:new Set,[l.PlacementType.sidebar]:new Set,[l.PlacementType.smilesSelector]:new Set}}}getElementState(){return{id:0,title:"",options:{role:"",extranet:"",context:null,width:null,height:null,color:null,iconName:null},placement:"",order:0,loadConfiguration:{ID:0,PLACEMENT:"",PLACEMENT_ID:0}}}getGetters(){return{getByPlacement:e=>t=>{const i=[...e.placementCollection[t].values()];return i.map((t=>e.collection.get(t)))},getById:e=>t=>e.collection.get(t)}}getActions(){return{set:(e,t)=>{const{items:i}=t;i.forEach((t=>{e.commit("setPlacementCollection",{placement:t.placement,id:t.id});e.commit("setCollection",t)}))}}}getMutations(){return{setPlacementCollection:(e,t)=>{e.placementCollection[t.placement].add(t.id)},setCollection:(e,t)=>{e.collection.set(t.id,{...this.getElementState(),...babelHelpers.classPrivateFieldLooseBase(this,qt)[qt](t)})}}}}function ei(e){const t={};if(m.Type.isNumber(e.id)||m.Type.isStringFilled(e.id)){t.id=e.id.toString()}if(m.Type.isString(e.title)){t.title=e.title}t.options=babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt](e.options);if(m.Type.isString(e.placement)){t.placement=e.placement}if(m.Type.isNumber(e.order)){t.order=e.order}t.loadConfiguration=babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt](e.loadConfiguration);return t}function ti(e){const t={context:null,width:null,height:null,color:null,iconName:null};if(!m.Type.isPlainObject(e)){return t}if(m.Type.isArrayFilled(e.context)){t.context=e.context}if(m.Type.isNumber(e.width)){t.width=e.width}if(m.Type.isNumber(e.height)){t.height=e.height}if(m.Type.isStringFilled(e.color)){t.color=e.color}if(m.Type.isStringFilled(e.iconName)){t.iconName=e.iconName}return t}function ii(e){const t={ID:0,PLACEMENT:"",PLACEMENT_ID:0};if(!m.Type.isPlainObject(e)){return t}if(m.Type.isNumber(e.ID)){t.ID=e.ID}if(m.Type.isStringFilled(e.PLACEMENT)){t.PLACEMENT=e.PLACEMENT}if(m.Type.isNumber(e.PLACEMENT_ID)){t.PLACEMENT_ID=e.PLACEMENT_ID}return t}var si=babelHelpers.classPrivateFieldLooseKey("getChat");var oi=babelHelpers.classPrivateFieldLooseKey("getChatByChatId");var ai=babelHelpers.classPrivateFieldLooseKey("isChatMuted");var ni=babelHelpers.classPrivateFieldLooseKey("getRecentItemCounter");var ri=babelHelpers.classPrivateFieldLooseKey("getLoadedChatsCounter");class li extends d.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,ri,{value:gi});Object.defineProperty(this,ni,{value:mi});Object.defineProperty(this,ai,{value:ui});Object.defineProperty(this,oi,{value:di});Object.defineProperty(this,si,{value:ci})}getName(){return"counters"}getState(){return{unloadedChatCounters:{},unloadedLinesCounters:{},unloadedCopilotCounters:{},unloadedCollabCounters:{},unloadedTaskCounters:{},commentCounters:{}}}getGetters(){return{getUnloadedChatCounters:e=>e.unloadedChatCounters,getTotalChatCounter:e=>{const t=c.Core.getStore().getters["recent/getRecentCollection"];const i=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri](t);let s=0;Object.values(e.unloadedChatCounters).forEach((e=>{s+=e}));const o=c.Core.getStore().getters["counters/getTotalCommentsCounter"];return i+s+o},getTotalCopilotCounter:e=>{const t=c.Core.getStore().getters["recent/getCopilotCollection"];const i=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri](t);let s=0;Object.values(e.unloadedCopilotCounters).forEach((e=>{s+=e}));return i+s},getTotalCollabCounter:e=>{const t=c.Core.getStore().getters["recent/getCollabCollection"];const i=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri](t);let s=0;Object.values(e.unloadedCollabCounters).forEach((e=>{s+=e}));return i+s},getTotalTaskCounter:e=>{const t=c.Core.getStore().getters["recent/getTaskCollection"];const i=babelHelpers.classPrivateFieldLooseBase(this,ri)[ri](t);let s=0;Object.values(e.unloadedTaskCounters).forEach((e=>{s+=e}));return i+s},getTotalLinesCounter:e=>{let t=0;Object.values(e.unloadedLinesCounters).forEach((e=>{t+=e}));return t},getSpecificLinesCounter:e=>t=>{if(!e.unloadedLinesCounters[t]){return 0}return e.unloadedLinesCounters[t]},getTotalCommentsCounter:e=>{let t=0;Object.entries(e.commentCounters).forEach((([e,i])=>{const s=babelHelpers.classPrivateFieldLooseBase(this,oi)[oi](e);if(babelHelpers.classPrivateFieldLooseBase(this,ai)[ai](s)){return}Object.values(i).forEach((e=>{t+=e}))}));return t},getChannelComments:e=>t=>{if(!e.commentCounters[t]){return[]}return e.commentCounters[t]},getChannelCommentsCounter:e=>t=>{if(!e.commentCounters[t]){return 0}let i=0;Object.values(e.commentCounters[t]).forEach((e=>{i+=e}));return i},getChatCounterByChatId:e=>t=>{const i=c.Core.getStore().getters["recent/getRecentCollection"];const s=i.find((e=>{const i=this.store.getters["chats/get"](e.dialogId,true);return i.chatId===t}));if(!s){var o;return(o=e.unloadedChatCounters[t])!=null?o:0}return babelHelpers.classPrivateFieldLooseBase(this,ni)[ni](s)},getSpecificCommentsCounter:e=>t=>{var i;const{channelId:s,commentChatId:o}=t;if(!e.commentCounters[s]){return 0}return(i=e.commentCounters[s][o])!=null?i:0}}}getActions(){return{setUnloadedChatCounters:(e,t)=>{if(!m.Type.isPlainObject(t)){return}e.commit("setUnloadedChatCounters",t)},setUnloadedLinesCounters:(e,t)=>{if(!m.Type.isPlainObject(t)){return}e.commit("setUnloadedLinesCounters",t)},setUnloadedCopilotCounters:(e,t)=>{if(!m.Type.isPlainObject(t)){return}e.commit("setUnloadedCopilotCounters",t)},setUnloadedCollabCounters:(e,t)=>{if(!m.Type.isPlainObject(t)){return}e.commit("setUnloadedCollabCounters",t)},setUnloadedTaskCounters:(e,t)=>{if(!m.Type.isPlainObject(t)){return}e.commit("setUnloadedTaskCounters",t)},setCommentCounters:(e,t)=>{if(!m.Type.isPlainObject(t)){return}e.commit("setCommentCounters",t)},readAllChannelComments:(e,t)=>{if(!m.Type.isNumber(t)){return}e.commit("readAllChannelComments",t)},deleteForChannel:(e,t)=>{if(!m.Type.isPlainObject(t)){return}e.commit("deleteForChannel",t)},clearUnloadedTaskCounters:e=>{e.commit("clearUnloadedTaskCounters")},clear:e=>{e.commit("clear")}}}getMutations(){return{setUnloadedChatCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(i===0){delete e.unloadedChatCounters[t];return}e.unloadedChatCounters[t]=i}))},setUnloadedLinesCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(i===0){delete e.unloadedLinesCounters[t];return}e.unloadedLinesCounters[t]=i}))},setUnloadedCopilotCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(i===0){delete e.unloadedCopilotCounters[t];return}e.unloadedCopilotCounters[t]=i}))},setUnloadedCollabCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(i===0){delete e.unloadedCollabCounters[t];return}e.unloadedCollabCounters[t]=i}))},setUnloadedTaskCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(i===0){delete e.unloadedTaskCounters[t];return}e.unloadedTaskCounters[t]=i}))},setCommentCounters:(e,t)=>{Object.entries(t).forEach((([t,i])=>{if(!e.commentCounters[t]){e.commentCounters[t]={}}const s=e.commentCounters[t];Object.entries(i).forEach((([e,t])=>{if(t===0){delete s[e];return}s[e]=t}))}))},readAllChannelComments:(e,t)=>{delete e.commentCounters[t]},deleteForChannel:(e,t)=>{const{channelChatId:i,commentChatId:s}=t;if(!e.commentCounters[i]){return}if(!s){delete e.commentCounters[i];return}delete e.commentCounters[i][s]},clearUnloadedTaskCounters:e=>{e.unloadedTaskCounters={}},clear:e=>{e.unloadedChatCounters={};e.unloadedLinesCounters={};e.unloadedCopilotCounters={};e.unloadedCollabCounters={};e.unloadedTaskCounters={};e.commentCounters={}}}}}function ci(e){return c.Core.getStore().getters["chats/get"](e,true)}function di(e){return c.Core.getStore().getters["chats/getByChatId"](e,true)}function ui(e){return e.muteList.includes(c.Core.getUserId())}function mi(e){const t=babelHelpers.classPrivateFieldLooseBase(this,si)[si](e.dialogId);if(babelHelpers.classPrivateFieldLooseBase(this,ai)[ai](t)){return 0}const i=e.unread;if(t.counter===0&&i){return 1}return t.counter}function gi(e){let t=0;e.forEach((e=>{const i=babelHelpers.classPrivateFieldLooseBase(this,ni)[ni](e);t+=i}));return t}const hi=[{fieldName:"code",targetFieldName:"code",checkFunction:m.Type.isString},{fieldName:"default",targetFieldName:"default",checkFunction:m.Type.isBoolean},{fieldName:"recommended",targetFieldName:"recommended",checkFunction:m.Type.isBoolean},{fieldName:"supportsReasoning",targetFieldName:"supportsReasoning",checkFunction:m.Type.isBoolean},{fieldName:"name",targetFieldName:"name",checkFunction:m.Type.isString}];const fi=[{fieldName:"dialogId",targetFieldName:"dialogId",checkFunction:m.Type.isString},{fieldName:"role",targetFieldName:"role",checkFunction:m.Type.isString},{fieldName:"engine",targetFieldName:"aiModel",checkFunction:m.Type.isString}];const pi="none";class yi extends d.BuilderModel{getState(){return{collection:{}}}getElementState(){return{dialogId:"",role:"",aiModel:"",reasoningEnabled:false}}getGetters(){return{getRole:e=>t=>{const i=e.collection[t];if(!i){return null}return c.Core.getStore().getters["copilot/roles/getByCode"](i.role)},getRoleAvatar:(e,t)=>e=>{const i=t.getRole(e);if(!i){return""}return c.Core.getStore().getters["copilot/roles/getAvatar"](i.code)},getAIModel:e=>t=>{const i=e.collection[t];if(!i){return null}const s=c.Core.getStore().getters["copilot/getAIModels"];const o=s.find((e=>e.code===i.aiModel));return o!=null?o:pi},isReasoningEnabled:e=>t=>{const i=e.collection[t];if(!i){return false}return e.collection[t].reasoningEnabled}}}getActions(){return{set:(e,t)=>{if(!t){return}const i=m.Type.isArrayFilled(t)?t:[t];const s=i.map((e=>this.formatFields(e)));s.forEach((t=>{const i=e.state.collection[t.dialogId];if(i){e.commit("update",{dialogId:t.dialogId,fields:t});return}e.commit("add",{dialogId:t.dialogId,fields:{...this.getElementState(),...t}})}))},updateModel:(e,t)=>{if(!t||!e.state.collection[t.dialogId]){return}e.commit("updateModel",t)},toggleReasoning:(e,t)=>{if(!e.state.collection[t]){return}e.commit("toggleReasoning",t)}}}getMutations(){return{add:(e,t)=>{const{dialogId:i,fields:s}=t;e.collection[i]=s},update:(e,t)=>{const{dialogId:i,fields:s}=t;e.collection[i]={...e.collection[i],...s}},updateModel:(e,t)=>{const{dialogId:i,aiModel:s}=t;e.collection[i].aiModel=s},toggleReasoning:(e,t)=>{e.collection[t].reasoningEnabled=!e.collection[t].reasoningEnabled}}}formatFields(e){return v(e,fi)}}const Ii=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"role",targetFieldName:"roleCode",checkFunction:m.Type.isString}];class Fi extends d.BuilderModel{getState(){return{collection:{}}}getElementState(){return{id:0,roleCode:""}}getGetters(){return{getRole:e=>t=>{const i=e.collection[t];if(!i){return c.Core.getStore().getters["copilot/roles/getDefault"]}return c.Core.getStore().getters["copilot/roles/getByCode"](i.roleCode)},getPrompts:e=>t=>{const i=e.collection[t];if(!i){return[]}return c.Core.getStore().getters["copilot/roles/getPrompts"](i.roleCode)},getAvatar:(e,t)=>e=>{const i=t.getRole(e);if(!i){return""}return c.Core.getStore().getters["copilot/roles/getAvatar"](i.code)}}}getActions(){return{add:(e,t)=>{if(!m.Type.isArrayFilled(t)){return}t.forEach((t=>{const i={...this.getElementState(),...this.formatFields(t)};e.commit("add",i)}))}}}getMutations(){return{add:(e,t)=>{e.collection[t.id]=t}}}formatFields(e){return v(e,Ii)}}const Ni=[{fieldName:"avatar",targetFieldName:"avatar",checkFunction:m.Type.isPlainObject,formatFunction:e=>u.formatFieldsWithConfig(e,Ci)},{fieldName:"code",targetFieldName:"code",checkFunction:m.Type.isString},{fieldName:["desc","description"],targetFieldName:"desc",checkFunction:m.Type.isString},{fieldName:"name",targetFieldName:"name",checkFunction:m.Type.isString},{fieldName:"default",targetFieldName:"default",checkFunction:m.Type.isBoolean},{fieldName:"prompts",targetFieldName:"prompts",checkFunction:m.Type.isArray,formatFunction:e=>e.map((e=>u.formatFieldsWithConfig(e,bi)))}];const bi=[{fieldName:"code",targetFieldName:"code",checkFunction:m.Type.isString},{fieldName:"promptType",targetFieldName:"promptType",checkFunction:m.Type.isString},{fieldName:"text",targetFieldName:"text",checkFunction:m.Type.isString},{fieldName:"title",targetFieldName:"title",checkFunction:m.Type.isString}];const Ci=[{fieldName:"small",targetFieldName:"small",checkFunction:m.Type.isString},{fieldName:"medium",targetFieldName:"medium",checkFunction:m.Type.isString},{fieldName:"large",targetFieldName:"large",checkFunction:m.Type.isString}];const Si=Object.freeze({S:"small",M:"medium",L:"large"});class Ti extends d.BuilderModel{getState(){return{roles:{}}}getElementState(){return{code:"",name:"",desc:"",default:false,avatar:{small:"",medium:"",large:""},prompts:[]}}getGetters(){return{get:e=>()=>Object.values(e.roles),getByCode:(e,t)=>i=>{var s;return(s=e.roles[i])!=null?s:t.getDefault},getPrompts:(e,t)=>i=>{if(!e.roles[i]){var s,o;return(s=(o=t.getDefault)==null?void 0:o.prompts)!=null?s:[]}return e.roles[i].prompts},getDefault:e=>Object.values(e.roles).find((e=>e.default)),getDefaultAvatar:(e,t)=>(e="M")=>{var i,s;const o=Si[e];return(i=(s=t.getDefault)==null?void 0:s.avatar[o])!=null?i:""},getAvatar:(e,t)=>(i,s="M")=>{const o=Si[s];if(!e.roles[i]){var a,n;return(a=(n=t.getDefault)==null?void 0:n.avatar[o])!=null?a:""}return e.roles[i].avatar[o]}}}getActions(){return{add:(e,t)=>{const i=Object.values(t);if(!m.Type.isArrayFilled(i)){return}i.forEach((t=>{const i={...this.getElementState(),...this.formatFields(t)};e.commit("add",i)}))}}}getMutations(){return{add:(e,t)=>{e.roles[t.code]=t}}}formatFields(e){return v(e,Ni)}}const vi=4;class ki extends d.BuilderModel{getNestedModules(){return{roles:Ti,messages:Fi,chats:yi}}getName(){return"copilot"}getState(){return{recommendedRoles:[],aiProvider:"",availableAIModels:{}}}getGetters(){return{getProvider:e=>e.aiProvider,getAIModels:e=>Object.values(e.availableAIModels),getRecommendedRoles:e=>()=>{const t=e.recommendedRoles.map((e=>c.Core.getStore().getters["copilot/roles/getByCode"](e)));return t.slice(0,vi)},getDefaultModelName:e=>{const t=Object.values(e.availableAIModels);if(t.length===0){return""}const i=t.find((e=>e.default===true));if(!i){return""}return i.name},isReasoningAvailableInModel:e=>t=>{var i;return Boolean((i=e.availableAIModels[t])==null?void 0:i.supportsReasoning)}}}getActions(){return{setRecommendedRoles:(e,t)=>{if(!m.Type.isArrayFilled(t)){return}e.commit("setRecommendedRoles",t)},setProvider:(e,t)=>{if(!m.Type.isStringFilled(t)){return}e.commit("setProvider",t)},setAvailableAIModels:(e,t)=>{if(!m.Type.isArrayFilled(t)){return}t.forEach((t=>{e.commit("setAvailableAIModel",this.formatFields(t))}))}}}getMutations(){return{setRecommendedRoles:(e,t)=>{e.recommendedRoles=t},setProvider:(e,t)=>{e.aiProvider=t},setAvailableAIModel:(e,t)=>{e.availableAIModels[t.code]=t}}}formatFields(e){return u.formatFieldsWithConfig(e,hi)}}class Pi extends d.BuilderModel{getName(){return"aiAssistant"}getState(){return{mcpAuthId:null}}getGetters(){return{getMcpAuthId:e=>e.mcpAuthId}}getActions(){return{setMcpAuthId:(e,t)=>{e.commit("setMcpAuthId",t)}}}getMutations(){return{setMcpAuthId:(e,t)=>{e.mcpAuthId=t}}}}const Li=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"packId",targetFieldName:"packId",checkFunction:m.Type.isNumber},{fieldName:"packType",targetFieldName:"packType",checkFunction:m.Type.isString},{fieldName:"uri",targetFieldName:"uri",checkFunction:m.Type.isString},{fieldName:"type",targetFieldName:"type",checkFunction:m.Type.isString},{fieldName:"width",targetFieldName:"width",checkFunction:m.Type.isNumber},{fieldName:"height",targetFieldName:"height",checkFunction:m.Type.isNumber},{fieldName:"sort",targetFieldName:"sort",checkFunction:m.Type.isNumber}];const Mi=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"packId",targetFieldName:"packId",checkFunction:m.Type.isNumber},{fieldName:"packType",targetFieldName:"packType",checkFunction:m.Type.isString}];const Ei=12;var Bi=babelHelpers.classPrivateFieldLooseKey("formatFields");var xi=babelHelpers.classPrivateFieldLooseKey("isEqual");class Ai extends d.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,xi,{value:wi});Object.defineProperty(this,Bi,{value:Hi})}getState(){return{collection:[]}}getElementState(){return{id:0,packId:0,packType:""}}getGetters(){return{get:(e,t,i,s)=>{const o=e.collection.slice(0,Ei);return o.map((e=>s["stickers/get"]({id:e.id,packId:e.packId,packType:e.packType}))).filter((e=>Boolean(e)))}}}getActions(){return{set:(e,t)=>{t.forEach((t=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Bi)[Bi](t);e.commit("add",{...this.getElementState(),...i})}))},update:(e,t)=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Bi)[Bi](t);e.commit("update",{...this.getElementState(),...i})},clear:e=>{e.commit("clear")},delete:(e,t)=>{e.commit("delete",t)}}}getMutations(){return{add:(e,t)=>{e.collection.push(t)},update:(e,t)=>{e.collection=e.collection.filter((e=>!babelHelpers.classPrivateFieldLooseBase(this,xi)[xi](e,t)));e.collection.unshift(t)},clear:e=>{e.collection=[]},delete:(e,t)=>{e.collection=e.collection.filter((e=>!babelHelpers.classPrivateFieldLooseBase(this,xi)[xi](e,t)))}}}}function Hi(e){return v(e,Mi)}function wi(e,t){return e.id===t.id&&e.packId===t.packId&&e.packType===t.packType}const Oi=[{fieldName:"messageId",targetFieldName:"messageId",checkFunction:u.isNumberOrString},{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"packId",targetFieldName:"packId",checkFunction:m.Type.isNumber},{fieldName:"packType",targetFieldName:"packType",checkFunction:m.Type.isString}];var Ui=babelHelpers.classPrivateFieldLooseKey("formatFields");class ji extends d.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,Ui,{value:Ri})}getState(){return{collection:new Map}}getElementState(){return{id:0,packId:0,packType:""}}getGetters(){return{isSticker:e=>t=>e.collection.has(t),getStickerByMessageId:e=>t=>e.collection.get(t)}}getActions(){return{set:(e,t)=>{t.forEach((t=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Ui)[Ui](t);e.commit("add",{...this.getElementState(),...i})}))},updateWithId:(e,t)=>{const{oldId:i,newId:s}=t;const o=e.state.collection.get(i);o.messageId=s;e.commit("delete",i);e.commit("add",o)}}}getMutations(){return{add:(e,t)=>{const i=t.messageId;delete t.messageId;e.collection.set(i,t)},delete:(e,t)=>{e.collection.delete(t)}}}}function Ri(e){return u.formatFieldsWithConfig(e,Oi)}const Di=[{fieldName:"id",targetFieldName:"id",checkFunction:m.Type.isNumber},{fieldName:"authorId",targetFieldName:"authorId",checkFunction:m.Type.isNumber},{fieldName:"name",targetFieldName:"name",checkFunction:m.Type.isString},{fieldName:"type",targetFieldName:"type",checkFunction:m.Type.isString},{fieldName:"isAdded",targetFieldName:"isAdded",checkFunction:m.Type.isBoolean}];var Vi=babelHelpers.classPrivateFieldLooseKey("formatFields");var Gi=babelHelpers.classPrivateFieldLooseKey("getPackKey");class Ki extends d.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,Gi,{value:_i});Object.defineProperty(this,Vi,{value:Wi})}getState(){return{collection:new Map}}getElementState(){return{id:0,key:"",type:"",name:"",authorId:null,isAdded:false}}getGetters(){return{get:e=>[...e.collection.values()],getAddedPacks:e=>[...e.collection.values()].filter((e=>e.isAdded)),getByIdentifier:e=>({id:t,type:i})=>{const s=babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi]({id:t,type:i});return e.collection.get(s)},hasPack:e=>({id:t,type:i})=>{const s=babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi]({id:t,type:i});return e.collection.has(s)}}}getActions(){return{set:(e,t)=>{t.forEach((t=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Vi)[Vi](t);const s=babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi](i);e.commit("add",{key:s,pack:{...this.getElementState(),...i,key:s}})}))},addNew:(e,t)=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Vi)[Vi](t);const s=babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi](i);e.commit("unshift",{key:s,pack:{...this.getElementState(),...i,key:s}})},link:(e,t)=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi](t);e.commit("update",{key:i,fields:{isAdded:true}})},rename:(e,t)=>{if(!m.Type.isStringFilled(t.name)){return}const i=babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi](t);e.commit("update",{key:i,fields:{name:t.name}})},unlink:(e,t)=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi](t);e.commit("update",{key:i,fields:{isAdded:false}})},delete:(e,t)=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Gi)[Gi](t);e.commit("delete",{key:i})}}}getMutations(){return{add:(e,t)=>{const{key:i,pack:s}=t;e.collection.set(i,s)},delete:(e,t)=>{e.collection.delete(t.key)},update:(e,t)=>{const i=e.collection.get(t.key);if(!i){return}e.collection.set(t.key,{...i,...t.fields})},unshift:(e,t)=>{const i=new Map([[t.key,t.pack],...e.collection]);e.collection.clear();i.forEach(((t,i)=>{e.collection.set(i,t)}))}}}}function Wi(e){return u.formatFieldsWithConfig(e,Di)}function _i({id:e,type:t}){return`${e}:${t}`}var Xi=babelHelpers.classPrivateFieldLooseKey("formatFields");var zi=babelHelpers.classPrivateFieldLooseKey("getStickerKey");class $i extends d.BuilderModel{constructor(...e){super(...e);Object.defineProperty(this,zi,{value:qi});Object.defineProperty(this,Xi,{value:Yi})}getName(){return"stickers"}getNestedModules(){return{packs:Ki,recent:Ai,messages:ji}}getState(){return{collection:new Map}}getElementState(){return{id:0,packId:0,packType:"",type:"image",uri:"",width:0,height:0,sort:0}}getGetters(){return{get:e=>({id:t,packId:i,packType:s})=>{const o=babelHelpers.classPrivateFieldLooseBase(this,zi)[zi]({id:t,packId:i,packType:s});return e.collection.get(o)},getByPack:e=>({id:t,type:i})=>[...e.collection.values()].filter((e=>e.packId===t&&e.packType===i)).sort(((e,t)=>e.sort-t.sort)),getPackCover:(e,t)=>({id:e,type:i})=>{const s=t.getByPack({id:e,type:i});if(s.length>0){return s[0].uri}return""}}}getActions(){return{set:(e,t)=>{t.forEach((t=>{const i=babelHelpers.classPrivateFieldLooseBase(this,Xi)[Xi](t);const s=babelHelpers.classPrivateFieldLooseBase(this,zi)[zi](i);e.commit("add",{key:s,sticker:{...this.getElementState(),...i}})}))},delete:(e,t)=>{const{ids:i,packId:s,packType:o}=t;i.forEach((t=>{const i=babelHelpers.classPrivateFieldLooseBase(this,zi)[zi]({id:t,packId:s,packType:o});e.commit("delete",i)}))},deleteByPack:(e,t)=>{const{id:i,type:s}=t;[...e.state.collection.values()].forEach((t=>{if(t.packId!==i||t.packType!==s){return}const{id:o}=t;const a=babelHelpers.classPrivateFieldLooseBase(this,zi)[zi]({id:o,packId:i,packType:s});e.commit("delete",a)}))}}}getMutations(){return{add:(e,t)=>{const{key:i,sticker:s}=t;e.collection.set(i,s)},delete:(e,t)=>{e.collection.delete(t)}}}}function Yi(e){return v(e,Li)}function qi({id:e,packId:t,packType:i}){return`${t}:${i}:${e}`}e.ApplicationModel=x;e.MessagesModel=le;e.ChatsModel=je;e.UsersModel=Xe;e.FilesModel=Qe;e.RecentModel=pt;e.NotificationsModel=Bt;e.SidebarModel=Yt;e.MarketModel=Zt;e.CountersModel=li;e.CopilotModel=ki;e.AiAssistantModel=Pi;e.StickersModel=$i;e.formatFieldsWithConfig=v;e.convertToNumber=f;e.convertToString=h;e.isNumberOrString=g;e.convertObjectKeysToCamelCase=I;e.prepareDraft=Je;e.prepareInvitation=Ze})(this.BX.Messenger.v2.Model=this.BX.Messenger.v2.Model||{},BX.Event,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Messenger.v2.Application,BX.Vue3.Vuex,BX.Messenger.v2.Model,BX);
//# sourceMappingURL=registry.bundle.map.js