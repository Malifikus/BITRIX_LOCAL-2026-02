{"version":3,"file":"quote.bundle.js","sources":["../src/quote.js"],"sourcesContent":["import { Loc } from 'main.core';\n\nimport { CopilotManager } from 'im.v2.lib.copilot';\nimport { Core } from 'im.v2.application.core';\nimport { EventType, ChatType } from 'im.v2.const';\nimport { DateFormatter, DateTemplate } from 'im.v2.lib.date-formatter';\nimport { Parser } from 'im.v2.lib.parser';\n\nimport type { ImModelMessage, ImModelUser, ImModelChat } from 'im.v2.model';\nimport type { ApplicationContext } from 'im.v2.const';\n\ntype SendQuoteEventPayload = {\n\tmessage: ImModelMessage,\n\ttext: string,\n\tdialogId: string,\n\tcontext: ApplicationContext,\n};\n\nconst QUOTE_DELIMITER = '-'.repeat(54);\n\nexport const Quote = {\n\tsendQuoteEvent(payload: SendQuoteEventPayload)\n\t{\n\t\tconst { text, dialogId, context: { emitter }, additionalParams = {} } = payload;\n\n\t\temitter.emit(EventType.textarea.insertText, {\n\t\t\ttext,\n\t\t\tdialogId,\n\t\t\twithNewLine: true,\n\t\t\t...additionalParams,\n\t\t});\n\t},\n\tprepareInlineQuote(textBefore: string, textAfter: string, quoteText: string): string\n\t{\n\t\tconst needNewLineBefore = textBefore && !textBefore.endsWith('\\n');\n\t\tconst formattedTextBefore = needNewLineBefore ? `${textBefore}\\n` : textBefore;\n\n\t\tconst needNewLineAfter = textAfter && !textAfter.startsWith('\\n');\n\t\tconst formattedTextAfter = needNewLineAfter ? `\\n${textAfter}` : textAfter;\n\n\t\treturn `${formattedTextBefore}${QUOTE_DELIMITER}\\n${quoteText}\\n${QUOTE_DELIMITER}${formattedTextAfter}`;\n\t},\n\tprepareInlineMessageQuote(message: ImModelMessage, text: string): string\n\t{\n\t\tconst dialog: ImModelChat = Core.getStore().getters['chats/getByChatId'](message.chatId);\n\n\t\tlet quoteTitle = Loc.getMessage('IM_DIALOG_CHAT_QUOTE_DEFAULT_TITLE');\n\t\tif (message.authorId)\n\t\t{\n\t\t\tquoteTitle = getName(message);\n\t\t}\n\n\t\tconst quoteDate = DateFormatter.formatByTemplate(message.date, DateTemplate.notification);\n\n\t\tconst quoteText = Parser.prepareQuote(message, text);\n\n\t\tlet quoteContext = '';\n\t\tif (dialog && dialog.type === ChatType.user)\n\t\t{\n\t\t\tquoteContext = `#${dialog.dialogId}:${Core.getUserId()}/${message.id}`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tquoteContext = `#${dialog.dialogId}/${message.id}`;\n\t\t}\n\n\t\treturn `${QUOTE_DELIMITER}\\n`\n\t\t\t+ `${quoteTitle} [${quoteDate}] ${quoteContext}\\n`\n\t\t\t+ `${quoteText}\\n`\n\t\t\t+ `${QUOTE_DELIMITER}\\n`\n\t\t;\n\t},\n};\n\nconst getName = (message: ImModelMessage): string => {\n\tlet name = '';\n\n\tconst copilotManager = new CopilotManager();\n\tif (copilotManager.isCopilotBot(message.authorId))\n\t{\n\t\tname = copilotManager.getName({\n\t\t\tdialogId: message.authorId,\n\t\t\tmessageId: message.id,\n\t\t});\n\t}\n\telse\n\t{\n\t\tconst user: ImModelUser = Core.getStore().getters['users/get'](message.authorId);\n\t\tname = user.name;\n\t}\n\n\treturn name;\n};\n"],"names":["QUOTE_DELIMITER","repeat","Quote","sendQuoteEvent","payload","text","dialogId","context","emitter","additionalParams","emit","EventType","textarea","insertText","withNewLine","prepareInlineQuote","textBefore","textAfter","quoteText","needNewLineBefore","endsWith","formattedTextBefore","needNewLineAfter","startsWith","formattedTextAfter","prepareInlineMessageQuote","message","dialog","Core","getStore","getters","chatId","quoteTitle","Loc","getMessage","authorId","getName","quoteDate","DateFormatter","formatByTemplate","date","DateTemplate","notification","Parser","prepareQuote","quoteContext","type","ChatType","user","getUserId","id","name","copilotManager","CopilotManager","isCopilotBot","messageId"],"mappings":";;;;;;;CAkBA,MAAMA,eAAe,GAAG,GAAG,CAACC,MAAM,CAAC,EAAE,CAAC;AAEtC,OAAaC,KAAK,GAAG;GACpBC,cAAc,CAACC,OAA8B,EAC7C;KACC,MAAM;OAAEC,IAAI;OAAEC,QAAQ;OAAEC,OAAO,EAAE;SAAEC;QAAS;OAAEC,gBAAgB,GAAG;MAAI,GAAGL,OAAO;KAE/EI,OAAO,CAACE,IAAI,CAACC,qBAAS,CAACC,QAAQ,CAACC,UAAU,EAAE;OAC3CR,IAAI;OACJC,QAAQ;OACRQ,WAAW,EAAE,IAAI;OACjB,GAAGL;MACH,CAAC;IACF;GACDM,kBAAkB,CAACC,UAAkB,EAAEC,SAAiB,EAAEC,SAAiB,EAC3E;KACC,MAAMC,iBAAiB,GAAGH,UAAU,IAAI,CAACA,UAAU,CAACI,QAAQ,CAAC,IAAI,CAAC;KAClE,MAAMC,mBAAmB,GAAGF,iBAAiB,GAAI,GAAEH,UAAW,IAAG,GAAGA,UAAU;KAE9E,MAAMM,gBAAgB,GAAGL,SAAS,IAAI,CAACA,SAAS,CAACM,UAAU,CAAC,IAAI,CAAC;KACjE,MAAMC,kBAAkB,GAAGF,gBAAgB,GAAI,KAAIL,SAAU,EAAC,GAAGA,SAAS;KAE1E,OAAQ,GAAEI,mBAAoB,GAAErB,eAAgB,KAAIkB,SAAU,KAAIlB,eAAgB,GAAEwB,kBAAmB,EAAC;IACxG;GACDC,yBAAyB,CAACC,OAAuB,EAAErB,IAAY,EAC/D;KACC,MAAMsB,MAAmB,GAAGC,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,mBAAmB,CAAC,CAACJ,OAAO,CAACK,MAAM,CAAC;KAExF,IAAIC,UAAU,GAAGC,aAAG,CAACC,UAAU,CAAC,oCAAoC,CAAC;KACrE,IAAIR,OAAO,CAACS,QAAQ,EACpB;OACCH,UAAU,GAAGI,OAAO,CAACV,OAAO,CAAC;;KAG9B,MAAMW,SAAS,GAAGC,qCAAa,CAACC,gBAAgB,CAACb,OAAO,CAACc,IAAI,EAAEC,oCAAY,CAACC,YAAY,CAAC;KAEzF,MAAMxB,SAAS,GAAGyB,uBAAM,CAACC,YAAY,CAAClB,OAAO,EAAErB,IAAI,CAAC;KAEpD,IAAIwC,YAAY,GAAG,EAAE;KACrB,IAAIlB,MAAM,IAAIA,MAAM,CAACmB,IAAI,KAAKC,oBAAQ,CAACC,IAAI,EAC3C;OACCH,YAAY,GAAI,IAAGlB,MAAM,CAACrB,QAAS,IAAGsB,2BAAI,CAACqB,SAAS,EAAG,IAAGvB,OAAO,CAACwB,EAAG,EAAC;MACtE,MAED;OACCL,YAAY,GAAI,IAAGlB,MAAM,CAACrB,QAAS,IAAGoB,OAAO,CAACwB,EAAG,EAAC;;KAGnD,OAAQ,GAAElD,eAAgB,IAAG,GACzB,GAAEgC,UAAW,KAAIK,SAAU,KAAIQ,YAAa,IAAG,GAC/C,GAAE3B,SAAU,IAAG,GACf,GAAElB,eAAgB,IAAG;;CAG3B,CAAC;CAED,MAAMoC,OAAO,GAAIV,OAAuB,IAAa;GACpD,IAAIyB,IAAI,GAAG,EAAE;GAEb,MAAMC,cAAc,GAAG,IAAIC,gCAAc,EAAE;GAC3C,IAAID,cAAc,CAACE,YAAY,CAAC5B,OAAO,CAACS,QAAQ,CAAC,EACjD;KACCgB,IAAI,GAAGC,cAAc,CAAChB,OAAO,CAAC;OAC7B9B,QAAQ,EAAEoB,OAAO,CAACS,QAAQ;OAC1BoB,SAAS,EAAE7B,OAAO,CAACwB;MACnB,CAAC;IACF,MAED;KACC,MAAMF,IAAiB,GAAGpB,2BAAI,CAACC,QAAQ,EAAE,CAACC,OAAO,CAAC,WAAW,CAAC,CAACJ,OAAO,CAACS,QAAQ,CAAC;KAChFgB,IAAI,GAAGH,IAAI,CAACG,IAAI;;GAGjB,OAAOA,IAAI;CACZ,CAAC;;;;;;;;"}