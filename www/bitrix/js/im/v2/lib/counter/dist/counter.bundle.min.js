this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,s,t,a,o,i,l){"use strict";const r=e=>{const s=99;const t=`${s}+`;const a=/^\((?<currentCounter>\d+|\d+\+)\)\s(?<text>.*)/;const o=document.title.match(a);const i=e>s?t:e;if(o!=null&&o.groups.currentCounter){const s=Number.parseInt(o.groups.currentCounter,10);if(e!==s){const s=e>0?`(${i}) `:"";document.title=`${s}${o.groups.text}`}}else if(e>0){document.title=`(${i}) ${document.title}`}};const n={[l.ChatType.taskComments]:["chats/clearCountersByChatType","recent/resetTasksUnreadStatus","counters/clearUnloadedTaskCounters","messages/anchors/removeAllAnchorsByChatType"]};const c=["chats/clearCounters","recent/resetUnreadStatus","counters/clear","messages/anchors/removeAllAnchors"];var b=babelHelpers.classPrivateFieldLooseKey("instance");var u=babelHelpers.classPrivateFieldLooseKey("store");var p=babelHelpers.classPrivateFieldLooseKey("emitCountersUpdateWithDebounce");var h=babelHelpers.classPrivateFieldLooseKey("init");var d=babelHelpers.classPrivateFieldLooseKey("prepareChatCounters");var v=babelHelpers.classPrivateFieldLooseKey("subscribeToCountersChange");var C=babelHelpers.classPrivateFieldLooseKey("emitLegacyNotificationCounterUpdate");var L=babelHelpers.classPrivateFieldLooseKey("emitLegacyChatCounterUpdate");var P=babelHelpers.classPrivateFieldLooseKey("emitCountersUpdate");var B=babelHelpers.classPrivateFieldLooseKey("onTotalCounterChange");class g{static getInstance(){if(!babelHelpers.classPrivateFieldLooseBase(this,b)[b]){babelHelpers.classPrivateFieldLooseBase(this,b)[b]=new this}return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}constructor(){Object.defineProperty(this,B,{value:E});Object.defineProperty(this,P,{value:y});Object.defineProperty(this,L,{value:f});Object.defineProperty(this,C,{value:m});Object.defineProperty(this,v,{value:T});Object.defineProperty(this,d,{value:F});Object.defineProperty(this,h,{value:H});Object.defineProperty(this,u,{writable:true,value:void 0});Object.defineProperty(this,p,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,u)[u]=a.Core.getStore();babelHelpers.classPrivateFieldLooseBase(this,p)[p]=t.Runtime.debounce(babelHelpers.classPrivateFieldLooseBase(this,P)[P],0,this);const{counters:e}=a.Core.getApplicationData();i.Logger.warn("CounterManager: counters",e);babelHelpers.classPrivateFieldLooseBase(this,h)[h](e)}static init(){g.getInstance()}emitCounters(){babelHelpers.classPrivateFieldLooseBase(this,P)[P]()}removeBrowserTitleCounter(){const e=/^(?<counterWithWhitespace>\(\d+\)\s).*/;const s=document.title.match(e);if(!(s!=null&&s.groups.counterWithWhitespace)){return}const t=s.groups.counterWithWhitespace;document.title=document.title.slice(t)}}function H(e){const s=babelHelpers.classPrivateFieldLooseBase(this,d)[d](e.CHAT,e.CHAT_UNREAD);babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("counters/setUnloadedChatCounters",s);babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("counters/setUnloadedLinesCounters",e.LINES);const t=babelHelpers.classPrivateFieldLooseBase(this,d)[d](e.COLLAB,e.COLLAB_UNREAD);babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("counters/setUnloadedCollabCounters",t);const a=babelHelpers.classPrivateFieldLooseBase(this,d)[d](e.COPILOT,e.COPILOT_UNREAD);babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("counters/setUnloadedCopilotCounters",a);const o=babelHelpers.classPrivateFieldLooseBase(this,d)[d](e.TASKS_TASK,e.TASKS_TASK_UNREAD);babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("counters/setUnloadedTaskCounters",o);babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("counters/setCommentCounters",e.CHANNEL_COMMENT);babelHelpers.classPrivateFieldLooseBase(this,u)[u].dispatch("notifications/setCounter",e.TYPE.NOTIFY);babelHelpers.classPrivateFieldLooseBase(this,P)[P]();babelHelpers.classPrivateFieldLooseBase(this,v)[v]();babelHelpers.classPrivateFieldLooseBase(this,L)[L](e.TYPE.CHAT);babelHelpers.classPrivateFieldLooseBase(this,C)[C](e.TYPE.NOTIFY);babelHelpers.classPrivateFieldLooseBase(this,B)[B]()}function F(e,s){const t={...e};s.forEach((s=>{const a=Boolean(e[s]);if(a){return}t[s]=1}));return t}function T(){babelHelpers.classPrivateFieldLooseBase(this,u)[u].watch(M,(e=>{babelHelpers.classPrivateFieldLooseBase(this,C)[C](e);babelHelpers.classPrivateFieldLooseBase(this,p)[p]();babelHelpers.classPrivateFieldLooseBase(this,B)[B]()}));babelHelpers.classPrivateFieldLooseBase(this,u)[u].watch(A,(e=>{babelHelpers.classPrivateFieldLooseBase(this,L)[L](e);babelHelpers.classPrivateFieldLooseBase(this,p)[p]();babelHelpers.classPrivateFieldLooseBase(this,B)[B]()}));babelHelpers.classPrivateFieldLooseBase(this,u)[u].watch(N,(()=>{babelHelpers.classPrivateFieldLooseBase(this,p)[p]();babelHelpers.classPrivateFieldLooseBase(this,B)[B]()}));babelHelpers.classPrivateFieldLooseBase(this,u)[u].watch(w,(()=>babelHelpers.classPrivateFieldLooseBase(this,p)[p]()));babelHelpers.classPrivateFieldLooseBase(this,u)[u].watch(O,(()=>babelHelpers.classPrivateFieldLooseBase(this,p)[p]()));babelHelpers.classPrivateFieldLooseBase(this,u)[u].watch(U,(()=>babelHelpers.classPrivateFieldLooseBase(this,p)[p]()))}function m(e){const t=new s.BaseEvent({compatData:[e]});s.EventEmitter.emit(window,l.EventType.counter.onNotificationCounterChange,t)}function f(e){const t=new s.BaseEvent({compatData:[e]});s.EventEmitter.emit(window,l.EventType.counter.onChatCounterChange,t)}function y(){const e={[l.NavigationMenuItem.chat]:babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["counters/getTotalChatCounter"],[l.NavigationMenuItem.copilot]:babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["counters/getTotalCopilotCounter"],[l.NavigationMenuItem.collab]:babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["counters/getTotalCollabCounter"],[l.NavigationMenuItem.tasksTask]:babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["counters/getTotalTaskCounter"],[l.NavigationMenuItem.openlines]:babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["counters/getTotalLinesCounter"],[l.NavigationMenuItem.openlinesV2]:babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["counters/getTotalLinesCounter"],[l.NavigationMenuItem.notification]:babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["notifications/getCounter"]};i.Logger.warn("CounterManager: Emitting IM.Counters:onUpdate",e);s.EventEmitter.emit(l.EventType.counter.onUpdate,e)}function E(){const e=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["notifications/getCounter"];const s=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["counters/getTotalChatCounter"];const t=babelHelpers.classPrivateFieldLooseBase(this,u)[u].getters["counters/getTotalLinesCounter"];const a=e+s+t;if(o.DesktopManager.getInstance().isDesktopActive()){return}r(a)}Object.defineProperty(g,b,{writable:true,value:void 0});const M=(e,s)=>s["notifications/getCounter"];const A=(e,s)=>s["counters/getTotalChatCounter"];const N=(e,s)=>s["counters/getTotalLinesCounter"];const w=(e,s)=>s["counters/getTotalCopilotCounter"];const O=(e,s)=>s["counters/getTotalCollabCounter"];const U=(e,s)=>s["counters/getTotalTaskCounter"];e.CounterManager=g;e.CounterClearActionsByChatType=n;e.CounterClearActionsDefault=c})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Event,BX,BX.Messenger.v2.Application,BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const);
//# sourceMappingURL=counter.bundle.map.js