{"version":3,"file":"parser.bundle.js","sources":["../src/functions/slash-command.js","../src/utils/core-proxy.js","../src/utils/utils.js","../src/functions/icon.js","../src/functions/quote.js","../src/functions/image.js","../src/functions/smile.js","../src/functions/url.js","../src/functions/font.js","../src/functions/lines.js","../src/functions/action.js","../src/functions/call.js","../src/classes/mention-handler.js","../src/functions/mention.js","../src/functions/common.js","../src/functions/disk.js","../src/functions/date.js","../src/utils/nested-tag-handler.js","../src/parser.js"],"sourcesContent":["export const ParserSlashCommand = {\n\n\tdecode(text): string\n\t{\n\t\tif (text.startsWith('/me'))\n\t\t{\n\t\t\treturn `[i]${text.substr(4)}[/i]`;\n\t\t}\n\n\t\tif (text.startsWith('/loud'))\n\t\t{\n\t\t\treturn `[size=20]${text.substr(6)}[/size]`;\n\t\t}\n\n\t\treturn text;\n\t},\n\n\tpurify(text): string\n\t{\n\t\tif (text.startsWith('/me'))\n\t\t{\n\t\t\treturn  text.substr(4);\n\t\t}\n\n\t\tif (text.startsWith('/loud'))\n\t\t{\n\t\t\treturn  text.substr(6);\n\t\t}\n\n\t\treturn text;\n\t}\n}","import {Extension, Type} from 'main.core';\n\n// const isDesktop = Type.isObject(window.BXDesktopSystem);\nconst settings = Extension.getSettings('im.v2.lib.parser');\nconst v2 = settings.get('v2');\n\nconst getCore = () => {\n\treturn v2 ? BX.Messenger.v2.Application.Core : BX.Messenger.Embedding.Application.Core;\n};\nconst getUtils = () => {\n\treturn v2 ? BX.Messenger.v2.Lib.Utils : BX.Messenger.Embedding.Lib.Utils;\n};\nconst getLogger = () => {\n\treturn v2 ? BX.Messenger.v2.Lib.Logger : BX.Messenger.Embedding.Lib.Logger;\n};\nconst getConst = () => {\n\treturn v2 ? BX.Messenger.v2.Const : BX.Messenger.Embedding.Const;\n};\nconst getSmileManager = () => {\n\treturn v2 ? BX.Messenger.v2.Lib.SmileManager : BX.Messenger.Embedding.Lib.SmileManager;\n};\nconst getBigSmileOption = () => {\n\tif (v2)\n\t{\n\t\tconst settingName = BX.Messenger.v2.Const.Settings.message.bigSmiles;\n\t\treturn getCore().getStore().getters['application/settings/get'](settingName);\n\t}\n\n\treturn getCore().getStore().getters['application/getOption']('bigSmileEnable');\n};\n\nexport {getCore, getUtils, getLogger, getConst, getSmileManager, getBigSmileOption};\n\nexport type Smile = {\n\tid: string;\n\tsetId: string;\n\tname: string;\n\timage: string;\n\ttyping: string;\n\talternative: boolean;\n\twidth: number;\n\theight: number;\n\tdefinition: string;\n};","import { Type } from 'main.core';\n\nimport { getCore } from './core-proxy';\n\nconst RECURSIVE_LIMIT = 10;\nexport const ParserUtils = {\n\n\trecursiveReplace(text, pattern, replacement): string\n\t{\n\t\tif (!Type.isStringFilled(text))\n\t\t{\n\t\t\treturn text;\n\t\t}\n\n\t\tlet count = 0;\n\t\tlet deep = true;\n\t\tdo\n\t\t{\n\t\t\tdeep = false;\n\t\t\tcount++;\n\t\t\ttext = text.replace(pattern, (...params) => {\n\t\t\t\tdeep = true;\n\t\t\t\treturn replacement(...params);\n\t\t\t});\n\t\t}\n\t\twhile (deep && count <= RECURSIVE_LIMIT);\n\n\t\treturn text;\n\t},\n\n\tgetFinalContextTag(contextTag)\n\t{\n\t\tconst match = contextTag.match(/(chat\\d+|(\\d+):(\\d+))\\/(\\d+)/i);\n\t\tif (!match)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tlet [, dialogId, user1, user2, messageId] = match;\n\t\tif (dialogId.toString().startsWith('chat'))\n\t\t{\n\t\t\tif (dialogId === 'chat0')\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\treturn contextTag;\n\t\t}\n\n\t\tuser1 = Number.parseInt(user1, 10);\n\t\tuser2 = Number.parseInt(user2, 10);\n\t\tif (getCore().getUserId() === user1)\n\t\t{\n\t\t\treturn `${user2}/${messageId}`;\n\t\t}\n\n\t\tif (getCore().getUserId() === user2)\n\t\t{\n\t\t\treturn `${user1}/${messageId}`;\n\t\t}\n\n\t\treturn '';\n\t},\n\n\tgetDialogIdFromFinalContextTag(finalContextTag: string): string\n\t{\n\t\tif (!/^(chat\\d+|\\d+)\\/\\d+$/.test(finalContextTag))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst [dialogId] = finalContextTag.split('/');\n\n\t\treturn dialogId;\n\t},\n\n\tgetDialogIdByChatId(chatId: number): string\n\t{\n\t\tconst dialog = getCore().getStore().getters['chats/getByChatId'](chatId);\n\t\tif (!dialog)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn dialog.dialogId;\n\t},\n};\n","import { Loc, Type } from 'main.core';\n\nimport { getConst } from '../utils/core-proxy';\nimport { Parser } from '../parser';\n\nconst { FileType, FileIconType, AttachDescription } = getConst();\n\nexport const ParserIcon = {\n\tgetIcon(icon: $Values<typeof FileIconType>, fallbackText: string = ''): string\n\t{\n\t\treturn fallbackText;\n\t\t/*\n\t\tif (!FileIconType[icon])\n\t\t{\n\t\t\treturn fallbackText;\n\t\t}\n\n\t\treturn Dom.create({\n\t\t\ttag: 'span',\n\t\t\tattrs: {\n\t\t\t\tclassName: `bx-im-icon --${icon}`,\n\t\t\t},\n\t\t}).outerHTML;\n\t\t */\n\t},\n\n\taddIconToShortText(config: {\n\t\ttext: string,\n\t\tattach: boolean | string | Array,\n\t\tfiles: boolean | Array,\n\t\tisSticker: boolean,\n\t}): string\n\t{\n\t\tlet { text } = config;\n\t\tconst { attach, files, isSticker } = config;\n\n\t\tif (Type.isArrayFilled(files) || files === true)\n\t\t{\n\t\t\ttext = this.getTextForFile(text, files);\n\t\t}\n\t\telse if (\n\t\t\tattach === true\n\t\t\t|| Type.isArrayFilled(attach)\n\t\t\t|| Type.isStringFilled(attach)\n\t\t)\n\t\t{\n\t\t\ttext = this.getTextForAttach(text, attach);\n\t\t}\n\t\telse if (isSticker)\n\t\t{\n\t\t\ttext = this.getTextForSticker();\n\t\t}\n\n\t\treturn text.trim();\n\t},\n\n\tgetQuoteBlock(): string\n\t{\n\t\tconst icon = this.getIcon(FileIconType.quote);\n\t\tif (icon)\n\t\t{\n\t\t\treturn icon;\n\t\t}\n\n\t\treturn `[${Loc.getMessage('IM_PARSER_ICON_TYPE_QUOTE')}]`;\n\t},\n\n\tgetCodeBlock(): string\n\t{\n\t\tconst icon = this.getIcon(FileIconType.code);\n\t\tif (icon)\n\t\t{\n\t\t\treturn icon;\n\t\t}\n\n\t\treturn `[${Loc.getMessage('IM_PARSER_ICON_TYPE_CODE')}]`;\n\t},\n\n\tgetImageBlock(): string\n\t{\n\t\tconst icon = this.getIcon(FileIconType.image);\n\t\tif (icon)\n\t\t{\n\t\t\treturn icon;\n\t\t}\n\n\t\treturn `[${Loc.getMessage('IM_PARSER_ICON_TYPE_IMAGE')}]`;\n\t},\n\n\tgetFileBlock(): string\n\t{\n\t\tconst icon = this.getIcon(FileIconType.file);\n\t\tif (icon)\n\t\t{\n\t\t\treturn icon;\n\t\t}\n\n\t\treturn `[${Loc.getMessage('IM_PARSER_ICON_TYPE_FILE')}]`;\n\t},\n\n\tgetTextForFile(rawText: string, files: boolean | Array): string\n\t{\n\t\tlet preparedText = rawText;\n\t\tif (Type.isArray(files) && files.length > 0)\n\t\t{\n\t\t\tpreparedText = this.getIconTextForFile(rawText, files);\n\t\t}\n\t\telse if (files === true)\n\t\t{\n\t\t\tpreparedText = this.getIconTextForFileType(rawText, FileIconType.file);\n\t\t}\n\n\t\treturn preparedText;\n\t},\n\n\tgetTextForAttach(text: string, attach: boolean | string | Array): string\n\t{\n\t\tlet attachDescription = '';\n\t\tif (Type.isArray(attach) && attach.length > 0)\n\t\t{\n\t\t\tconst [firstAttach] = attach;\n\t\t\tif (Type.isStringFilled(firstAttach.description))\n\t\t\t{\n\t\t\t\tattachDescription = firstAttach.description;\n\t\t\t}\n\t\t}\n\t\telse if (Type.isStringFilled(attach))\n\t\t{\n\t\t\tattachDescription = attach;\n\t\t}\n\n\t\tif (Type.isStringFilled(attachDescription))\n\t\t{\n\t\t\tif (attachDescription === AttachDescription.skipMessage)\n\t\t\t{\n\t\t\t\tattachDescription = '';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tattachDescription = Parser.purifyText(attachDescription);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst icon = this.getIcon(FileIconType.attach);\n\t\t\tif (icon)\n\t\t\t{\n\t\t\t\tattachDescription = `${icon} ${Loc.getMessage('IM_PARSER_ICON_TYPE_ATTACH')}`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tattachDescription = `[${Loc.getMessage('IM_PARSER_ICON_TYPE_ATTACH')}]`;\n\t\t\t}\n\t\t}\n\n\t\treturn `${text} ${attachDescription}`.trim();\n\t},\n\n\tgetTextForSticker(): string\n\t{\n\t\treturn `[${Loc.getMessage('IM_PARSER_ICON_TYPE_STICKER')}]`;\n\t},\n\n\tgetIconTextForFileType(text: string, type: $Values<typeof FileIconType> = FileIconType.file): string\n\t{\n\t\tlet result = text;\n\t\tconst icon = this.getIcon(type);\n\t\tconst iconText = Loc.getMessage(`IM_PARSER_ICON_TYPE_${type.toUpperCase()}`);\n\t\tif (icon)\n\t\t{\n\t\t\tconst withText = text.replace(/(\\s|\\n)/gi, '').length > 0;\n\t\t\tconst textDescription = withText? text: iconText;\n\t\t\tresult = `${icon} ${textDescription}`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = `[${iconText}] ${text}`;\n\t\t}\n\n\t\treturn result.trim();\n\t},\n\n\tgetIconTextForFile(text: string, files: Array<Object>): string\n\t{\n\t\tconst withText = text.replace(/(\\s|\\n)/gi, '').length > 0;\n\t\tconst [file] = files;\n\n\t\t// todo: remove this hack after fix receiving messages with files on P&P\n\t\tif (!file || !file.type)\n\t\t{\n\t\t\treturn text;\n\t\t}\n\n\t\tconst isGallery = files.every((file) => [FileIconType.image, FileIconType.video].includes(file.type));\n\n\t\tif (file.type === FileType.image && files.length === 1)\n\t\t{\n\t\t\treturn this.getIconTextForFileType(text, FileIconType.image);\n\t\t}\n\t\telse if (isGallery && files.length > 1)\n\t\t{\n\t\t\treturn this.getIconTextForFileType(text, FileIconType.gallery);\n\t\t}\n\t\telse if (file.type === FileType.audio)\n\t\t{\n\t\t\treturn this.getIconTextForFileType(text, FileIconType.audio);\n\t\t}\n\t\telse if (file.type === FileType.video)\n\t\t{\n\t\t\treturn this.getIconTextForFileType(text, FileIconType.video);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst icon = this.getIcon(FileIconType.file);\n\t\t\tif (icon)\n\t\t\t{\n\t\t\t\tconst textDescription = withText ? text : '';\n\t\t\t\ttext = `${icon} ${file.name} ${textDescription}`;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttext = `${Loc.getMessage('IM_PARSER_ICON_TYPE_FILE')}: ${file.name} ${text}`;\n\t\t\t}\n\n\t\t\treturn text.trim();\n\t\t}\n\t}\n};\n","import { Dom, Tag } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport { ParserUtils } from '../utils/utils';\nimport { getUtils, getConst } from '../utils/core-proxy';\nimport { ParserIcon } from './icon';\n\nimport type { ApplicationContext } from 'im.v2.const';\n\nconst { EventType } = getConst();\n\nconst QUOTE_SIGN = '&gt;&gt;';\nconst NO_CONTEXT_TAG = 'none';\n\nexport const ParserQuote = {\n\n\tdecodeArrowQuote(text: string): string\n\t{\n\t\tif (!text.includes(QUOTE_SIGN))\n\t\t{\n\t\t\treturn text;\n\t\t}\n\n\t\tlet isProcessed = false;\n\n\t\tconst textLines = text.split('<br />');\n\t\tfor (let i = 0; i < textLines.length; i++)\n\t\t{\n\t\t\tif (!textLines[i].startsWith(QUOTE_SIGN))\n\t\t\t{\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst quoteStartIndex = i;\n\n\t\t\tconst outerContainerStart = `<div data-context=\"${NO_CONTEXT_TAG}\" class=\"bx-im-message-quote --inline\">`;\n\t\t\tconst innerContainerStart = '<div class=\"bx-im-message-quote__wrap\">';\n\t\t\tconst containerEnd = '</div>';\n\t\t\ttextLines[quoteStartIndex] = textLines[quoteStartIndex].replace(QUOTE_SIGN, `${outerContainerStart}${innerContainerStart}`);\n\t\t\t// remove >> from all next lines\n\t\t\twhile (++i < textLines.length && textLines[i].startsWith(QUOTE_SIGN))\n\t\t\t{\n\t\t\t\ttextLines[i] = textLines[i].replace(QUOTE_SIGN, '');\n\t\t\t}\n\t\t\tconst quoteEndIndex = i - 1;\n\t\t\ttextLines[quoteEndIndex] += `${containerEnd}${containerEnd}`;\n\t\t\tisProcessed = true;\n\t\t}\n\n\t\tif (!isProcessed)\n\t\t{\n\t\t\treturn text;\n\t\t}\n\n\t\treturn textLines.join('<br />');\n\t},\n\n\tpurifyArrowQuote(text, spaceLetter = ' '): string\n\t{\n\t\ttext = text.replace(\n\t\t\tnew RegExp(`^(${QUOTE_SIGN}(.*))`, 'gim'),\n\t\t\tParserIcon.getQuoteBlock() + spaceLetter\n\t\t);\n\n\t\treturn text;\n\t},\n\n\tdecodeQuote(text, { contextDialogId = '' } = {}): string\n\t{\n\t\treturn text.replaceAll(\n\t\t\t/-{54}(<br \\/>(.*?)\\[(.*?)]( #(?:chat\\d+|\\d+:\\d+)\\/\\d+)?)?<br \\/>(.*?)-{54}(<br \\/>)?/gs,\n\t\t\t(whole, userBlock, userName, timeTag, contextTag, quoteText): string => {\n\t\t\t\tconst preparedQuoteText = getQuoteText(userName, timeTag, quoteText);\n\t\t\t\tconst userContainer = getUserBlock(userName, timeTag);\n\t\t\t\tconst finalContextTag = getFinalContextTag(contextTag, contextDialogId);\n\n\t\t\t\tconst layout = Tag.render`\n\t\t\t\t\t<div class='bx-im-message-quote' data-context='${finalContextTag}'>\n\t\t\t\t\t\t<div class='bx-im-message-quote__wrap'>\n\t\t\t\t\t\t\t${userContainer}\n\t\t\t\t\t\t\t<div class='bx-im-message-quote__text'>${preparedQuoteText}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\n\t\t\t\treturn layout.outerHTML;\n\t\t\t},\n\t\t);\n\t},\n\n\tpurifyQuote(text: string, spaceLetter: string = ' '): string\n\t{\n\t\treturn text.replace(/-{54}(.*?)-{54}/gims, ParserIcon.getQuoteBlock() + spaceLetter);\n\t},\n\n\tdecodeCode(text: string): string\n\t{\n\t\treturn text.replace(/\\[code](<br \\/>)?([\\0-\\uFFFF]*?)\\[\\/code](<br \\/>)?/gis, (whole, br, code) => {\n\t\t\treturn Dom.create({\n\t\t\t\ttag: 'div',\n\t\t\t\tattrs: {className: 'bx-im-message-content-code'},\n\t\t\t\thtml: code\n\t\t\t}).outerHTML;\n\t\t});\n\t},\n\n\tpurifyCode(text: string, spaceLetter: string = ' '): string\n\t{\n\t\treturn text.replace(/\\[code](<br \\/>)?([\\0-\\uFFFF]*?)\\[\\/code]/gis, ParserIcon.getCodeBlock() + spaceLetter);\n\t},\n\n\texecuteClickEvent(event: PointerEvent, context: ApplicationContext)\n\t{\n\t\tif (\n\t\t\t!event.target.className.startsWith('bx-im-message-quote')\n\t\t\t&& !(\n\t\t\t\tevent.target.parentNode\n\t\t\t\t&& event.target.parentNode.className.startsWith('bx-im-message-quote')\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst target = getUtils().dom.recursiveBackwardNodeSearch(event.target, 'bx-im-message-quote');\n\t\tif (!target || target.dataset.context === NO_CONTEXT_TAG)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst [dialogId, messageId] = target.dataset.context.split('/');\n\n\t\tconst { emitter } = context;\n\t\temitter.emit(EventType.dialog.goToMessageContext, {\n\t\t\tmessageId: Number.parseInt(messageId, 10),\n\t\t\tdialogId: dialogId.toString(),\n\t\t});\n\t},\n};\n\nconst getQuoteText = (userName, timeTag, text): string => {\n\tconst hasUserBlock = userName && timeTag;\n\tif (!hasUserBlock && !text)\n\t{\n\t\t// the case, when inside the quote we have only some string in square brackets\n\t\treturn String(timeTag);\n\t}\n\n\tconst BR_HTML_TAG = '<br />';\n\n\tif (text.endsWith(BR_HTML_TAG))\n\t{\n\t\treturn text.slice(0, -BR_HTML_TAG.length);\n\t}\n\n\treturn text;\n};\n\nconst getUserBlock = (userName: string, timeTag: string): HTMLElement | '' => {\n\tconst hasDataForUserBlock = userName && timeTag;\n\tif (!hasDataForUserBlock)\n\t{\n\t\treturn '';\n\t}\n\n\treturn Tag.render`\n\t\t<div class='bx-im-message-quote__name'>\n\t\t\t<div class=\"bx-im-message-quote__name-text\">${userName.trim()}</div>\n\t\t\t<div class=\"bx-im-message-quote__name-time\">${timeTag.trim()}</div>\n\t\t</div>\n\t`;\n};\n\nconst getFinalContextTag = (contextTag: string, contextDialogId: string): string => {\n\tif (!contextTag)\n\t{\n\t\treturn NO_CONTEXT_TAG;\n\t}\n\n\tconst tagWithoutHashSign = contextTag.trim().slice(1);\n\tconst finalContextTag = ParserUtils.getFinalContextTag(tagWithoutHashSign);\n\tif (!isQuoteFromTheSameChat(finalContextTag, contextDialogId))\n\t{\n\t\treturn NO_CONTEXT_TAG;\n\t}\n\n\treturn finalContextTag;\n};\n\nconst isQuoteFromTheSameChat = (finalContextTag: string, dialogId: string): boolean => {\n\tconst contextDialogId = ParserUtils.getDialogIdFromFinalContextTag(finalContextTag);\n\n\treturn contextDialogId === dialogId;\n};\n","import { Dom, Loc, Tag, Text, Type } from 'main.core';\n\nimport { getBigSmileOption, getCore, getUtils } from '../utils/core-proxy';\nimport { ParserIcon } from './icon';\n\nexport const ImageBbCodeSizes = Object.freeze({\n\tsmall: 'small',\n\tmedium: 'medium',\n\tlarge: 'large',\n});\n\nexport const ParserImage = {\n\tdecodeLink(text: string): string\n\t{\n\t\treturn text.replaceAll(/>((https|http):\\/\\/(\\S+)\\.(jpg|jpeg|png|gif|webp)(\\?\\S+[^<])?)<\\/a>/gi, (whole, urlParsed): string => {\n\t\t\tconst url = Text.decode(urlParsed);\n\t\t\tif (\n\t\t\t\t!/(\\.(jpg|jpeg|png|gif|webp)\\?|\\.(jpg|jpeg|png|gif|webp)$)/i.test(url)\n\t\t\t\t|| url.toLowerCase().indexOf('/docs/pub/') > 0\n\t\t\t\t|| url.toLowerCase().indexOf('logout=yes') > 0\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn whole;\n\t\t\t}\n\n\t\t\tif (!getUtils().text.checkUrl(url))\n\t\t\t{\n\t\t\t\treturn whole;\n\t\t\t}\n\n\t\t\tconst result = Dom.create({\n\t\t\t\ttag: 'span',\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bx-im-message-image',\n\t\t\t\t},\n\t\t\t\tchildren: [\n\t\t\t\t\tDom.create({\n\t\t\t\t\t\ttag: 'img',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tclassName: 'bx-im-message-image-source',\n\t\t\t\t\t\t\tsrc: url,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\terror() {\n\t\t\t\t\t\t\t\tParserImage.hideErrorImage(this);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t}).outerHTML;\n\n\t\t\treturn `>${result}</a>`;\n\t\t});\n\t},\n\n\tpurifyLink(text: string): string\n\t{\n\t\treturn text.replaceAll(/(.)?(https?:\\/\\/\\S+)/gi, (whole, symbolBeforeUrl, url): string => {\n\t\t\tif (!canPurifyLink(symbolBeforeUrl, url))\n\t\t\t{\n\t\t\t\treturn whole;\n\t\t\t}\n\n\t\t\tconst firstSymbol = symbolBeforeUrl || '';\n\n\t\t\treturn `${firstSymbol}${ParserIcon.getImageBlock()}`;\n\t\t});\n\t},\n\n\t// eslint-disable-next-line max-lines-per-function,sonarjs/cognitive-complexity\n\tdecodeIcon(text: string): string\n\t{\n\t\tlet textElementSize = 0;\n\n\t\tconst enableBigSmile = getBigSmileOption();\n\t\tif (enableBigSmile)\n\t\t{\n\t\t\ttextElementSize = text.replaceAll(/\\[icon=([^\\]]*)]/gi, '').trim().length;\n\t\t}\n\n\t\treturn text.replaceAll(/\\[icon=([^\\]]*)]/gi, (whole) => {\n\t\t\tlet url = whole.match(/icon=(\\S+[^\\s!\"'),.;>?\\]])/i);\n\t\t\tif (url && url[1])\n\t\t\t{\n\t\t\t\turl = url[1];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (!getUtils().text.checkUrl(url))\n\t\t\t{\n\t\t\t\treturn whole;\n\t\t\t}\n\n\t\t\tconst attrs = { src: url, border: 0 };\n\n\t\t\tconst size = whole.match(/size=(\\d+)/i);\n\t\t\tif (size && size[1])\n\t\t\t{\n\t\t\t\tattrs.width = size[1];\n\t\t\t\tattrs.height = size[1];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst width = whole.match(/width=(\\d+)/i);\n\t\t\t\tif (width && width[1])\n\t\t\t\t{\n\t\t\t\t\tattrs.width = width[1];\n\t\t\t\t}\n\n\t\t\t\tconst height = whole.match(/height=(\\d+)/i);\n\t\t\t\tif (height && height[1])\n\t\t\t\t{\n\t\t\t\t\tattrs.height = height[1];\n\t\t\t\t}\n\n\t\t\t\tif (attrs.width && !attrs.height)\n\t\t\t\t{\n\t\t\t\t\tattrs.height = attrs.width;\n\t\t\t\t}\n\t\t\t\telse if (attrs.height && !attrs.width)\n\t\t\t\t{\n\t\t\t\t\tattrs.width = attrs.height;\n\t\t\t\t}\n\t\t\t\telse if (attrs.height && attrs.width)\n\t\t\t\t{\n\t\t\t\t\t/* empty */\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tattrs.width = 20;\n\t\t\t\t\tattrs.height = 20;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tattrs.width = attrs.width > 100 ? 100 : attrs.width;\n\t\t\tattrs.height = attrs.height > 100 ? 100 : attrs.height;\n\n\t\t\tif (\n\t\t\t\tenableBigSmile\n\t\t\t\t&& textElementSize === 0\n\t\t\t\t&& attrs.width === attrs.height\n\t\t\t\t&& attrs.width === 20\n\t\t\t)\n\t\t\t{\n\t\t\t\tattrs.width = 40;\n\t\t\t\tattrs.height = 40;\n\t\t\t}\n\n\t\t\tlet title = whole.match(/title=(.*[^\\s\\]])/i);\n\t\t\tif (title && title[1])\n\t\t\t{\n\t\t\t\ttitle = title[1];\n\t\t\t\tif (title.includes('width='))\n\t\t\t\t{\n\t\t\t\t\ttitle = title.slice(0, Math.max(0, title.indexOf('width=')));\n\t\t\t\t}\n\n\t\t\t\tif (title.includes('height='))\n\t\t\t\t{\n\t\t\t\t\ttitle = title.slice(0, Math.max(0, title.indexOf('height=')));\n\t\t\t\t}\n\n\t\t\t\tif (title.includes('size='))\n\t\t\t\t{\n\t\t\t\t\ttitle = title.slice(0, Math.max(0, title.indexOf('size=')));\n\t\t\t\t}\n\n\t\t\t\tif (title)\n\t\t\t\t{\n\t\t\t\t\tattrs.title = Text.decode(title).trim();\n\t\t\t\t\tattrs.alt = attrs.title;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn Dom.create({\n\t\t\t\ttag: 'img',\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bx-smile bx-icon',\n\t\t\t\t\t...attrs,\n\t\t\t\t},\n\t\t\t}).outerHTML;\n\t\t});\n\t},\n\n\tpurifyIcon(text: string): string\n\t{\n\t\treturn text.replaceAll(/\\[icon=([^\\]]*)]/gi, (whole) => {\n\t\t\tlet title = whole.match(/title=(.*[^\\s\\]])/i);\n\t\t\tif (title && title[1])\n\t\t\t{\n\t\t\t\ttitle = title[1];\n\n\t\t\t\tif (title.includes('width='))\n\t\t\t\t{\n\t\t\t\t\ttitle = title.slice(0, Math.max(0, title.indexOf('width=')));\n\t\t\t\t}\n\n\t\t\t\tif (title.includes('height='))\n\t\t\t\t{\n\t\t\t\t\ttitle = title.slice(0, Math.max(0, title.indexOf('height=')));\n\t\t\t\t}\n\n\t\t\t\tif (title.includes('size='))\n\t\t\t\t{\n\t\t\t\t\ttitle = title.slice(0, Math.max(0, title.indexOf('size=')));\n\t\t\t\t}\n\n\t\t\t\tif (title)\n\t\t\t\t{\n\t\t\t\t\ttitle = `(${title.trim()})`;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttitle = `(${Loc.getMessage('IM_PARSER_IMAGE_ICON')})`;\n\t\t\t}\n\n\t\t\treturn title;\n\t\t});\n\t},\n\n\tpurifyImageBbCode(text: string): string\n\t{\n\t\tconst sizesFragment = Object.values(ImageBbCodeSizes).join('|');\n\t\tconst imageTagRegex = new RegExp(\n\t\t\t`\\\\[img\\\\s+size=(${sizesFragment})]([\\\\s\\\\S]*?)\\\\[\\\\/img]`,\n\t\t\t'gi',\n\t\t);\n\n\t\treturn text.replaceAll(imageTagRegex, () => ParserIcon.getImageBlock());\n\t},\n\n\thideErrorImage(element: HTMLImageElement): void\n\t{\n\t\tconst result = element;\n\n\t\tif (result && result.parentNode)\n\t\t{\n\t\t\tresult.parentNode.innerHTML = `<a href=\"${encodeURI(element.src)}\" target=\"_blank\">${element.src}</a>`;\n\t\t}\n\t},\n\n\tdecodeImageBbCode(text: string, { contextDialogId = '' } = {}): string\n\t{\n\t\tif (!Type.isStringFilled(text))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn text.replaceAll(\n\t\t\t/\\[img(?:\\s+size=([^\\]]+))?]\\s*(?:\\[url])?([\\S\\s]*?)(?:\\[\\/url])?\\s*\\[\\/img]/gi,\n\t\t\t(whole, size, urlParsed) => {\n\t\t\t\tconst url = Text.decode(urlParsed);\n\n\t\t\t\tconst isValidSize = size && Object.values(ImageBbCodeSizes).includes(size.toLowerCase());\n\t\t\t\tconst isInvalidUrl = ['/docs/pub/', 'logout=yes'].includes(url.toLowerCase());\n\t\t\t\tconst isSafeUrl = getUtils().text.checkUrl(url);\n\t\t\t\tconst isImage = isImageUrl(url);\n\t\t\t\tconst hasNestedItems = hasNestedImgBbCodes(url);\n\n\t\t\t\tif (!isValidSize || isInvalidUrl || !isSafeUrl || !isImage || hasNestedItems)\n\t\t\t\t{\n\t\t\t\t\treturn whole.replaceAll(/\\[url]([\\S\\s]*?)\\[\\/url]/gi, '$1');\n\t\t\t\t}\n\n\t\t\t\tconst classModifier = `--${size}`;\n\t\t\t\tconst { file } = getUtils();\n\t\t\t\tconst dialog = getCore().getStore().getters['chats/get'](contextDialogId, true);\n\t\t\t\tconst viewerGroupBy = dialog.chatId;\n\t\t\t\tconst viewerAttributes = file.getViewerDataForImageSrc({ src: url, viewerGroupBy });\n\n\t\t\t\tconst layout = Tag.render`\n\t\t\t\t\t<a class='bx-im-message-image ${classModifier}'>\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tclass='bx-im-message-image-source'\n\t\t\t\t\t\t\tsrc=\"${url}\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</a>\n\t\t\t\t`;\n\n\t\t\t\tDom.attr(layout.firstChild, viewerAttributes);\n\n\t\t\t\treturn layout.outerHTML;\n\t\t\t},\n\t\t);\n\t},\n};\n\nfunction isLinkFromDisk(url: string): boolean\n{\n\treturn url.toLowerCase().indexOf('/docs/pub/') > 0;\n}\n\nfunction isLogoutLink(url: string): boolean\n{\n\treturn url.toLowerCase().indexOf('logout=yes') > 0;\n}\n\nfunction hasImageFileExtension(url: string): boolean\n{\n\tconst [urlWithoutQueryString: string] = url.split('?');\n\n\treturn /\\.(jpg|jpeg|png|gif|webp)$/i.test(urlWithoutQueryString);\n}\n\nfunction hasLeadingTextBeforeUrl(symbolBeforeUrl: string): boolean\n{\n\tconst AllowedSymbolsBeforeImageUrl = new Set(['>', ']', ' ']);\n\n\treturn Type.isStringFilled(symbolBeforeUrl) && !AllowedSymbolsBeforeImageUrl.has(symbolBeforeUrl);\n}\n\nfunction canPurifyLink(symbolBeforeUrl: string, url: string): boolean\n{\n\treturn hasImageFileExtension(url)\n\t\t&& !isLinkFromDisk(url)\n\t\t&& !isLogoutLink(url)\n\t\t&& !hasLeadingTextBeforeUrl(symbolBeforeUrl);\n}\n\nfunction isImageUrl(url: string): boolean\n{\n\treturn /^https?:\\/\\/.+\\.(jpg|jpeg|png|gif|webp)(\\?.*)?$/i.test(url.trim());\n}\n\nfunction hasNestedImgBbCodes(url: string): boolean\n{\n\treturn /\\[img/i.test(url.trim());\n}\n","import { Dom, Tag, Type } from 'main.core';\nimport { getUtils, getSmileManager, getBigSmileOption } from '../utils/core-proxy';\n\nimport type { Smile } from '../utils/core-proxy';\n\nexport const RatioConfig = Object.freeze({\n\tDefault: 1,\n\tBig: 1.6,\n});\nconst getSmileRatio = (text: string, pattern: string, config = RatioConfig): number => {\n\tconst replacedText = text.replaceAll(new RegExp(pattern, 'g'), '');\n\tconst hasOnlySmiles = replacedText.trim().length === 0;\n\n\tconst matchOnlySmiles = new RegExp(`(?:(?:${pattern})\\\\s*){4,}`);\n\tif (hasOnlySmiles && !matchOnlySmiles.test(text))\n\t{\n\t\treturn config.Big;\n\t}\n\n\treturn config.Default;\n};\n\nconst mapTypings = (smiles: Array<Smile>): {[string]: HTMLElement} => {\n\tconst typings = smiles.reduce((acc, smile) => {\n\t\tconst {\n\t\t\timage,\n\t\t\ttyping,\n\t\t\tdefinition,\n\t\t\tname,\n\t\t\twidth,\n\t\t\theight,\n\t\t} = smile;\n\t\tconst smileImg = Tag.render`\n\t\t\t<img\n\t\t\t\tsrc=\"${image}\"\n\t\t\t\tdata-code=\"${typing}\"\n\t\t\t\tdata-definition=\"${definition}\"\n\t\t\t\ttitle=\"${name ?? typing}\"\n\t\t\t\talt=\"${typing}\"\n\t\t\t\tclass=\"bx-smile bx-im-message-base__text_smile\"\n\t\t\t\tstyle=\"width: ${width}px; height: ${height}px;\"\n\t\t\t\tdraggable=\"false\"\n\t\t\t/>\n\t\t`;\n\n\t\treturn { ...acc, [typing]: smileImg };\n\t}, {});\n\n\treturn typings;\n};\n\nconst lookBehind = function(text, match, offset): string\n{\n\tconst substring = text.slice(0, offset + match.length);\n\tconst escaped = getUtils().text.escapeRegex(match);\n\tconst regExp = new RegExp(`(?:^|&quot;|>|(?:${this.pattern})|\\\\s|<)(?:${escaped})$`);\n\n\treturn substring.match(regExp);\n};\n\nexport const ParserSmile = {\n\ttypings: null,\n\tpattern: '',\n\n\tloadSmilePatterns()\n\t{\n\t\tif (!getSmileManager())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst smileManager = getSmileManager().getInstance();\n\t\tconst smiles = smileManager.smileList?.smiles ?? [];\n\t\tif (smiles.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst sortedSmiles = [...smiles].sort((a, b) => {\n\t\t\treturn b.typing.localeCompare(a.typing);\n\t\t});\n\t\tthis.pattern = sortedSmiles.map((smile) => {\n\t\t\treturn getUtils().text.escapeRegex(smile.typing);\n\t\t}).join('|');\n\t\tthis.typings = mapTypings(sortedSmiles);\n\t},\n\n\tdecodeSmile(text: string, options = {}): string // TODO add options types\n\t{\n\t\tif (!this.typings)\n\t\t{\n\t\t\tthis.loadSmilePatterns();\n\t\t}\n\n\t\tif (!this.pattern)\n\t\t{\n\t\t\treturn text;\n\t\t}\n\n\t\tlet enableBigSmile;\n\t\tif (Type.isBoolean(options.enableBigSmile))\n\t\t{\n\t\t\tenableBigSmile = options.enableBigSmile;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tenableBigSmile = getBigSmileOption();\n\t\t}\n\n\t\tconst ratioConfig = Type.isObjectLike(options.ratioConfig) ? options.ratioConfig : RatioConfig;\n\t\tconst ratio = enableBigSmile ? getSmileRatio(text, this.pattern, ratioConfig) : ratioConfig.Default;\n\n\t\tconst pattern = `(?:(?:${this.pattern})(?=(?:(?:${this.pattern})|\\\\s|&quot;|<|$)))`;\n\t\tconst regExp = new RegExp(pattern, 'g');\n\t\tconst replacedText = text.replaceAll(regExp, (match, offset) => {\n\t\t\tconst behindMatching = lookBehind.call(this, text, match, offset);\n\t\t\tif (!behindMatching)\n\t\t\t{\n\t\t\t\treturn match;\n\t\t\t}\n\n\t\t\tconst image = this.typings[match].cloneNode();\n\t\t\tconst { width, height } = image.style;\n\t\t\tDom.style(image, 'width', `${Number.parseInt(width, 10) * ratio}px`);\n\t\t\tDom.style(image, 'height', `${Number.parseInt(height, 10) * ratio}px`);\n\n\t\t\treturn image.outerHTML;\n\t\t});\n\n\t\treturn replacedText;\n\t},\n};\n","import { Dom, Text } from 'main.core';\n\nimport { getUtils, getConst } from '../utils/core-proxy';\n\nconst { DataAttribute } = getConst();\n\nexport const ParserUrl = {\n\n\tdecode(text, config = {}): string\n\t{\n\t\tconst {\n\t\t\turlTarget = '_blank',\n\t\t\tremoveLinks = false,\n\t\t} = config;\n\n\t\t// base pattern for urls\n\t\ttext = text.replace(/\\[url(?:=([^[\\]]+))?](.*?)\\[\\/url]/gis, (whole, link, text) =>\n\t\t{\n\t\t\tconst url = Text.decode(link || text);\n\t\t\tif (!getUtils().text.checkUrl(url))\n\t\t\t{\n\t\t\t\treturn text;\n\t\t\t}\n\n\t\t\treturn this.getLinkHtml(url, urlTarget, text);\n\t\t});\n\n\t\t// url like https://bitrix24.com/?params[1]=\"test\"\n\t\ttext = text.replace(/\\[url(?:=(.+?[^[\\]]))?](.*?)\\[\\/url]/gis, (whole, link, text) =>\n\t\t{\n\t\t\tlet url = Text.decode(link || text);\n\t\t\tif (!getUtils().text.checkUrl(url))\n\t\t\t{\n\t\t\t\treturn text;\n\t\t\t}\n\n\t\t\tif (!url.slice(url.lastIndexOf('[')).includes(']'))\n\t\t\t{\n\t\t\t\tif (text.startsWith(']'))\n\t\t\t\t{\n\t\t\t\t\turl = `${url}]`;\n\t\t\t\t\ttext = text.slice(1);\n\t\t\t\t}\n\t\t\t\telse if (text.startsWith('='))\n\t\t\t\t{\n\t\t\t\t\tconst urlPart = Text.decode(text.slice(1, text.lastIndexOf(']')));\n\t\t\t\t\turl = `${url}]=${urlPart}`;\n\t\t\t\t\ttext = text.slice(text.lastIndexOf(']')+1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.getLinkHtml(url, urlTarget, text);\n\t\t});\n\n\t\tif (removeLinks)\n\t\t{\n\t\t\ttext = text.replace(/<a.*?href=\"([^\"]*)\".*?>(.*?)<\\/a>/gi, '$2');\n\t\t}\n\n\t\treturn text;\n\t},\n\n\tpurify(text): string\n\t{\n\t\ttext = text.replace(/\\[url(?:=([^\\[\\]]+))?](.*?)\\[\\/url]/gis, (whole, link, text) => {\n\t\t\treturn text? text: link;\n\t\t});\n\n\t\ttext = text.replace(/\\[url(?:=(.+))?](.*?)\\[\\/url]/gis, (whole, link, text) => {\n\t\t\treturn text? text: link;\n\t\t});\n\n\t\treturn text;\n\t},\n\n\tremoveSimpleUrlTag(text): string\n\t{\n\t\ttext = text.replace(/\\[url](.*?)\\[\\/url]/gis, (whole, link) => link);\n\t\treturn text;\n\t},\n\n\tgetLinkHtml(url: string, urlTarget: string, text: string): string\n\t{\n\t\treturn Dom.create({\n\t\t\ttag: 'a',\n\t\t\tattrs: {\n\t\t\t\thref: url,\n\t\t\t\ttarget: urlTarget,\n\t\t\t\t[DataAttribute.useNativeContextMenu]: true,\n\t\t\t},\n\t\t\thtml: text,\n\t\t}).outerHTML;\n\t},\n};\n","import {Dom} from 'main.core';\n\nimport {ParserUtils} from '../utils/utils';\n\nexport const ParserFont = {\n\n\tdecode(text): string\n\t{\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[b]([^[]*(?:\\[(?!b]|\\/b])[^[]*)*)\\[\\/b]/gi, (whole, text) => '<b>'+text+'</b>');\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[u]([^[]*(?:\\[(?!u]|\\/u])[^[]*)*)\\[\\/u]/gi, (whole, text) => '<u>'+text+'</u>');\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[i]([^[]*(?:\\[(?!i]|\\/i])[^[]*)*)\\[\\/i]/gi, (whole, text) => '<i>'+text+'</i>');\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[s]([^[]*(?:\\[(?!s]|\\/s])[^[]*)*)\\[\\/s]/gi, (whole, text) => '<s>'+text+'</s>');\n\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[size=(\\d+)(?:pt|px)?](.*?)\\[\\/size]/gis, (whole, number, text) => {\n\t\t\tnumber = Number.parseInt(number, 10);\n\t\t\tif (number <= 8)\n\t\t\t{\n\t\t\t\tnumber = 8;\n\t\t\t}\n\t\t\telse if (number >= 30)\n\t\t\t{\n\t\t\t\tnumber = 30;\n\t\t\t}\n\n\t\t\treturn Dom.create({\n\t\t\t\ttag: 'span',\n\t\t\t\tstyle: {fontSize: `${number}px`},\n\t\t\t\thtml: text\n\t\t\t}).outerHTML;\n\t\t});\n\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[color=#([0-9a-f]{3}|[0-9a-f]{6})](.*?)\\[\\/color]/gis, (whole, hex, text) => {\n\t\t\treturn Dom.create({\n\t\t\t\ttag: 'span',\n\t\t\t\tstyle: { color: '#'+ hex },\n\t\t\t\thtml: text\n\t\t\t}).outerHTML;\n\t\t});\n\n\t\treturn text;\n\t},\n\n\tpurify(text, removeStrike = true): string\n\t{\n\t\tif (removeStrike)\n\t\t{\n\t\t\ttext = ParserUtils.recursiveReplace(text, /\\[s]([^[]*(?:\\[(?!s]|\\/s])[^[]*)*)\\[\\/s]/gi, () => ' ');\n\t\t}\n\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[b]([^[]*(?:\\[(?!b]|\\/b])[^[]*)*)\\[\\/b]/gi, (whole, text) => text);\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[u]([^[]*(?:\\[(?!u]|\\/u])[^[]*)*)\\[\\/u]/gi, (whole, text) => text);\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[i]([^[]*(?:\\[(?!i]|\\/i])[^[]*)*)\\[\\/i]/gi, (whole, text) => text);\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[s]([^[]*(?:\\[(?!s]|\\/s])[^[]*)*)\\[\\/s]/gi, (whole, text) => text);\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[size=(\\d+)(?:pt|px)?](.*?)\\[\\/size]/gis, (whole, number, text) => text);\n\t\ttext = ParserUtils.recursiveReplace(text, /\\[color=#([0-9a-f]{3}|[0-9a-f]{6})](.*?)\\[\\/color]/gis, (whole, hex, text) => text);\n\n\t\treturn text;\n\t}\n}\n\n","import { Loc, Tag } from 'main.core';\n\nexport const ParserLines = {\n\n\tdecode(text): string\n\t{\n\t\tlet result = text;\n\n\t\tresult = result.replaceAll(\n\t\t\t/\\[like]/gi,\n\t\t\t`<span class=\"bx-im-lines-vote-like\" title=\"${Loc.getMessage('IM_PARSER_LINES_RATING_LIKE')}\"></span>`,\n\t\t);\n\n\t\tresult = result.replaceAll(\n\t\t\t/\\[dislike]/gi,\n\t\t\t`<span class=\"bx-im-lines-vote-dislike\" title=\"${Loc.getMessage('IM_PARSER_LINES_RATING_DISLIKE')}\"></span>`,\n\t\t);\n\n\t\tresult = result.replaceAll(/\\[rating=([1-5])]/gi, (whole, rating) => {\n\t\t\tconst tag = Tag.render`\n\t\t\t\t<span class=\"bx-im-lines-rating\" title=\"${Loc.getMessage('IM_PARSER_LINES_RATING')} - ${rating}\">\n\t\t\t\t\t<span class=\"bx-im-lines-rating-selected\" style=\"width: ${rating * 20}%\"></span>\n\t\t\t\t</span>\n\t\t\t`;\n\n\t\t\treturn tag.outerHTML;\n\t\t});\n\n\t\treturn result;\n\t},\n\n\tpurify(text): string\n\t{\n\t\tlet result = text;\n\n\t\tresult = result.replaceAll(\n\t\t\t/\\[like]/gi,\n\t\t\tLoc.getMessage('IM_PARSER_LINES_RATING_LIKE'),\n\t\t);\n\n\t\tresult = result.replaceAll(\n\t\t\t/\\[dislike]/gi,\n\t\t\tLoc.getMessage('IM_PARSER_LINES_RATING_DISLIKE'),\n\t\t);\n\n\t\tresult = result.replaceAll(/\\[rating=([1-5])]/gi, () => {\n\t\t\treturn `[${Loc.getMessage('IM_PARSER_LINES_RATING')}] `;\n\t\t});\n\n\t\treturn result;\n\t},\n};\n","import { Dom, Text } from 'main.core';\n\nimport { getConst, getCore } from '../utils/core-proxy';\n\nimport type { ApplicationContext } from 'im.v2.const';\n\nconst { EventType } = getConst();\n\nconst ActionType = {\n\tput: 'put',\n\tsend: 'send',\n};\n\nexport const ParserAction = {\n\n\tdecodePut(text): string\n\t{\n\t\ttext = text.replace(/\\[PUT(?:=(?:.+?))?](?:.+?)?\\[\\/PUT]/gi, (match) =>\n\t\t{\n\t\t\treturn match.replace(/\\[PUT(?:=(.+))?](.+?)?\\[\\/PUT]/gi, (whole, command, text) =>\n\t\t\t{\n\t\t\t\ttext = text? text: command;\n\t\t\t\tcommand = command? command: text;\n\n\t\t\t\ttext = Text.decode(text);\n\t\t\t\tcommand = Text.decode(command).replace('<br />', '\\n');\n\n\t\t\t\tif (!text.trim())\n\t\t\t\t{\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\ttext = text.replace(/<(\\w+)[^>]*>(.*?)<\\/\\1>/i, \"$2\", text);\n\t\t\t\ttext = text.replace(/\\[(\\w+)[^\\]]*](.*?)\\[\\/\\1]/i, \"$2\", text);\n\n\t\t\t\treturn this._getHtmlForAction('put', text, command);\n\t\t\t});\n\t\t});\n\n\t\treturn text;\n\t},\n\n\tpurifyPut(text): string\n\t{\n\t\ttext = text.replace(/\\[PUT(?:=(?:.+?))?](?:.+?)?\\[\\/PUT]/gi, (match) =>\n\t\t{\n\t\t\treturn match.replace(/\\[PUT(?:=(.+))?](.+?)?\\[\\/PUT]/gi, (whole, command, text) => {\n\t\t\t\treturn text? text: command;\n\t\t\t});\n\t\t});\n\n\t\treturn text;\n\t},\n\n\tdecodeSend(text): string\n\t{\n\t\ttext = text.replace(/\\[SEND(?:=(?:.+?))?](?:.+?)?\\[\\/SEND]/gi, (match) =>\n\t\t{\n\t\t\treturn match.replace(/\\[SEND(?:=(.+))?](.+?)?\\[\\/SEND]/gi, (whole, command, text) =>\n\t\t\t{\n\t\t\t\ttext = text? text: command;\n\t\t\t\tcommand = command? command: text;\n\n\t\t\t\ttext = Text.decode(text);\n\t\t\t\tcommand = Text.decode(command).replace('<br />', '\\n');\n\n\t\t\t\tif (!text.trim())\n\t\t\t\t{\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\ttext = text.replace(/<(\\w+)[^>]*>(.*?)<\\\\1>/i, \"$2\", text);\n\t\t\t\ttext = text.replace(/\\[(\\w+)[^\\]]*](.*?)\\[\\/\\1]/i, \"$2\", text);\n\n\t\t\t\tcommand = command.split('####REPLACEMENT_PUT_').join('####REPLACEMENT_SP_');\n\n\t\t\t\treturn this._getHtmlForAction('send', text, command);\n\t\t\t});\n\t\t});\n\n\t\treturn text;\n\t},\n\n\tpurifySend(text): string\n\t{\n\t\ttext = text.replace(/\\[SEND(?:=(?:.+?))?](?:.+?)?\\[\\/SEND]/gi, (match) =>\n\t\t{\n\t\t\treturn match.replace(/\\[SEND(?:=(.+))?](.+?)?\\[\\/SEND]/gi, (whole, command, text) => {\n\t\t\t\treturn text? text: command;\n\t\t\t});\n\t\t});\n\n\t\treturn text;\n\t},\n\n\t_getHtmlForAction(method, text, data)\n\t{\n\t\treturn Dom.create({\n\t\t\ttag: 'span',\n\t\t\tattrs: { className: 'bx-im-message-command-wrap' },\n\t\t\tchildren: [\n\t\t\t\tDom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'bx-im-message-command',\n\t\t\t\t\t\t'data-entity': method,\n\t\t\t\t\t},\n\t\t\t\t\ttext\n\t\t\t\t}),\n\t\t\t\tDom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: { className: 'bx-im-message-command-data' },\n\t\t\t\t\ttext: data\n\t\t\t\t}),\n\t\t\t]\n\t\t}).outerHTML;\n\t},\n\n\texecuteClickEvent(event: PointerEvent, context: ApplicationContext)\n\t{\n\t\tif (!Dom.hasClass(event.target, 'bx-im-message-command'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { emitter } = context;\n\n\t\tconst element: HTMLSpanElement = event.target;\n\t\tconst messageId = getMessageIdForClickElement(element);\n\t\tconst dialogId = getDialogIdByMessageId(messageId) ?? '';\n\t\tif (element.dataset.entity === ActionType.put)\n\t\t{\n\t\t\tconst { innerText: textToInsert = '' } = element.parentElement.querySelector('.bx-im-message-command-data');\n\t\t\tif (!textToInsert)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\temitter.emit(EventType.textarea.insertText, {\n\t\t\t\ttext: textToInsert,\n\t\t\t\tdialogId,\n\t\t\t});\n\t\t}\n\t\telse if (element.dataset.entity === ActionType.send)\n\t\t{\n\t\t\tconst { innerText: textToSend = '' } = element.parentElement.querySelector('.bx-im-message-command-data');\n\t\t\tif (!textToSend)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\temitter.emit(EventType.textarea.sendMessage, {\n\t\t\t\ttext: textToSend,\n\t\t\t\tdialogId,\n\t\t\t});\n\t\t}\n\t},\n};\n\nconst getMessageIdForClickElement = (element: HTMLSpanElement): number | null => {\n\tconst messageElement = element.closest('.bx-im-message-base__wrap');\n\tif (!messageElement || !messageElement.dataset.id)\n\t{\n\t\treturn null;\n\t}\n\n\treturn messageElement.dataset.id;\n};\n\nconst getDialogIdByMessageId = (messageId: number): string | null => {\n\tconst message = getCore().getStore().getters['messages/getById'](messageId);\n\tif (!message)\n\t{\n\t\treturn null;\n\t}\n\tconst dialog = getCore().getStore().getters['chats/getByChatId'](message.chatId);\n\tif (!dialog)\n\t{\n\t\treturn null;\n\t}\n\n\treturn dialog.dialogId;\n};\n","import { Dom, Text } from 'main.core';\nimport { getConst, getUtils } from '../utils/core-proxy';\n\nconst { MessageMentionType } = getConst();\nexport const ParserCall = {\n\n\tdecode(text): string\n\t{\n\t\tlet result = text;\n\n\t\tresult = result.replaceAll(/\\[call(?:=([\\d #()+./-]+))?](.+?)\\[\\/call]/gi, (whole, number, text) => {\n\t\t\tif (!text)\n\t\t\t{\n\t\t\t\treturn whole;\n\t\t\t}\n\n\t\t\tlet destination = '';\n\n\t\t\tif (number)\n\t\t\t{\n\t\t\t\tdestination = number;\n\t\t\t}\n\t\t\telse if (getUtils.call.isNumber(text))\n\t\t\t{\n\t\t\t\tdestination = text;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn whole;\n\t\t\t}\n\n\t\t\treturn Dom.create({\n\t\t\t\ttag: 'span',\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: 'bx-im-mention',\n\t\t\t\t\t'data-type': MessageMentionType.call,\n\t\t\t\t\t'data-destination': destination,\n\t\t\t\t},\n\t\t\t\ttext: Text.decode(text),\n\t\t\t}).outerHTML;\n\t\t});\n\n\t\tresult = result.replaceAll(/\\[pch=(\\d+)](.*?)\\[\\/pch]/gi, (whole, historyId, text) => '');\n\n\t\treturn result;\n\t},\n\n\tpurify(text): string\n\t{\n\t\tlet result = text;\n\n\t\tresult = result.replaceAll(\n\t\t\t/\\[call(?:=([\\d #()+./-]+))?](.+?)\\[\\/call]/gi,\n\t\t\t(whole, number, text) => {\n\t\t\t\treturn text || number;\n\t\t\t},\n\t\t);\n\n\t\tresult = result.replaceAll(\n\t\t\t/\\[pch=(\\d+)](.*?)\\[\\/pch]/gi,\n\t\t\t(whole, historyId, text) => text,\n\t\t);\n\n\t\treturn result;\n\t},\n};\n","import { Dom } from 'main.core';\n\nimport { Messenger } from 'im.public';\n\nimport { getConst, getUtils, getCore } from '../utils/core-proxy';\n\nimport type { ApplicationContext } from 'im.v2.const';\n\nconst { EventType, MessageMentionType, SidebarDetailBlock, SpecialMentionDialogId, ChatType } = getConst();\n\nconst MENTION_CSS_CLASS = 'bx-im-mention';\n\nexport class MentionHandler\n{\n\t#handlersByMentionType = {\n\t\t[MessageMentionType.user]: (dataset) => this.#handleChat(dataset),\n\t\t[MessageMentionType.chat]: (dataset) => this.#handleChat(dataset),\n\t\t[MessageMentionType.lines]: (dataset) => this.#handleLines(dataset),\n\t\t[MessageMentionType.context]: (dataset) => this.#handleContext(dataset),\n\t\t[MessageMentionType.call]: (dataset) => this.#handleCall(dataset),\n\t};\n\n\t#handlersByDialogId = {\n\t\t[this.#getCopilotBotDialogId()]: () => this.#handleCopilot(),\n\t\t[SpecialMentionDialogId.allParticipants]: () => this.#handleAllParticipants(),\n\t};\n\n\tconstructor(context: ApplicationContext)\n\t{\n\t\tconst { emitter } = context;\n\t\tthis.emitter = emitter;\n\t}\n\n\thandleClick(event: PointerEvent): void\n\t{\n\t\tif (!Dom.hasClass(event.target, MENTION_CSS_CLASS))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst dataset = event.target.dataset;\n\n\t\tconst handlerByDialogId = this.#handlersByDialogId[dataset.value];\n\t\tif (handlerByDialogId)\n\t\t{\n\t\t\thandlerByDialogId();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst handlerByMentionType = this.#handlersByMentionType[dataset.type];\n\t\tif (!handlerByMentionType)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\thandlerByMentionType(dataset);\n\t}\n\n\t#getCopilotBotDialogId(): ?string\n\t{\n\t\treturn getCore().getStore().getters['users/bots/getCopilotBotDialogId'];\n\t}\n\n\t#handleCopilot(): void\n\t{\n\t\tvoid Messenger.openCopilot();\n\t}\n\n\t#handleChat(dataset: { value: string }): void\n\t{\n\t\tvoid Messenger.openChat(dataset.value);\n\t}\n\n\t#handleLines(dataset: { value: string }): void\n\t{\n\t\tconst dialogId = dataset.value;\n\n\t\tif (getUtils().dialog.isLinesHistoryId(dialogId))\n\t\t{\n\t\t\tvoid Messenger.openLinesHistory(dialogId);\n\t\t}\n\t\telse if (getUtils().dialog.isLinesExternalId(dialogId))\n\t\t{\n\t\t\tvoid Messenger.openLines(dialogId);\n\t\t}\n\t}\n\n\t#handleContext(dataset: { messageId: string, dialogId: string }): void\n\t{\n\t\tconst messageId = Number.parseInt(dataset.messageId, 10);\n\n\t\tthis.emitter.emit(EventType.dialog.goToMessageContext, {\n\t\t\tmessageId,\n\t\t\tdialogId: dataset.dialogId,\n\t\t});\n\t}\n\n\t#handleCall(dataset: { destination: string }): void\n\t{\n\t\tconst destination = dataset.destination;\n\t\tif (getUtils().call.isNumber(destination))\n\t\t{\n\t\t\tvoid Messenger.startPhoneCall(destination);\n\t\t}\n\t}\n\n\t#handleAllParticipants()\n\t{\n\t\tconst { entityId } = getCore().getStore().getters['application/getLayout'];\n\t\tconst { type } = getCore().getStore().getters['chats/get'](entityId, true);\n\n\t\tif (!entityId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (type === ChatType.user)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.emitter.emit(EventType.sidebar.open, {\n\t\t\tpanel: SidebarDetailBlock.members,\n\t\t\tdialogId: entityId,\n\t\t});\n\t}\n}\n","import { Loc, Dom, Text, Type } from 'main.core';\n\nimport { Parser } from '../parser';\nimport { ParserUtils } from '../utils/utils';\nimport { getCore, getConst } from '../utils/core-proxy';\nimport { MentionHandler } from '../classes/mention-handler';\n\nconst { UserType, MessageMentionType, SpecialMentionDialogId = {} } = getConst();\n\nconst SpecialMentionHandlers = {\n\t[SpecialMentionDialogId.allParticipants]: (userName) => ParserMention.renderAllParticipantsMention(userName),\n};\n\nconst MENTION_BASE_CLASS = 'bx-im-mention';\nconst MentionModifier = {\n\thighlight: '--highlight',\n\textranet: '--extranet',\n};\n\nexport const ParserMention = {\n\tdecode(text): string\n\t{\n\t\ttext = text.replace(/\\[USER=(all|[0-9]+)( REPLACE)?](.*?)\\[\\/USER]/gi, (whole, userId, replace, userName) => {\n\t\t\tif (SpecialMentionHandlers[userId])\n\t\t\t{\n\t\t\t\treturn SpecialMentionHandlers[userId](userName);\n\t\t\t}\n\n\t\t\tuserId = Number.parseInt(userId, 10);\n\t\t\tif (!Type.isNumber(userId) || userId === 0)\n\t\t\t{\n\t\t\t\treturn userName;\n\t\t\t}\n\n\t\t\tconst user = getCore().getStore().getters['users/get'](userId);\n\n\t\t\tif (replace || !userName)\n\t\t\t{\n\t\t\t\tif (user)\n\t\t\t\t{\n\t\t\t\t\tuserName = user.name;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tuserName = Text.decode(userName);\n\t\t\t}\n\n\t\t\tif (!userName)\n\t\t\t{\n\t\t\t\tuserName = `User ${userId}`;\n\t\t\t}\n\n\t\t\tlet className = MENTION_BASE_CLASS;\n\t\t\tif (getCore().getUserId() === userId)\n\t\t\t{\n\t\t\t\tclassName += ` ${MentionModifier.highlight}`;\n\t\t\t}\n\n\t\t\tif (user && user.type === UserType.extranet)\n\t\t\t{\n\t\t\t\tclassName += ` ${MentionModifier.extranet}`;\n\t\t\t}\n\n\t\t\treturn Dom.create({\n\t\t\t\ttag: 'span',\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName,\n\t\t\t\t\t'data-type': MessageMentionType.user,\n\t\t\t\t\t'data-value': userId,\n\t\t\t\t},\n\t\t\t\ttext: userName,\n\t\t\t}).outerHTML;\n\t\t});\n\n\t\ttext = text.replace(/\\[chat=(imol\\|)?(\\d+)](.*?)\\[\\/chat]/gi, (whole, isLines, chatId, chatNameParsed) => {\n\t\t\tif (chatId === 0)\n\t\t\t{\n\t\t\t\treturn chatNameParsed;\n\t\t\t}\n\n\t\t\tlet chatName = chatNameParsed;\n\t\t\tif (chatName)\n\t\t\t{\n\t\t\t\tchatName = Text.decode(chatName);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst dialog = getCore().getStore().getters['chats/get'](`chat${chatId}`);\n\t\t\t\tchatName = dialog ? dialog.name : `Chat ${chatId}`;\n\t\t\t}\n\n\t\t\treturn Dom.create({\n\t\t\t\ttag: 'span',\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: MENTION_BASE_CLASS,\n\t\t\t\t\t'data-type': (isLines ? MessageMentionType.lines : MessageMentionType.chat),\n\t\t\t\t\t'data-value': (isLines ? `imol|${chatId}` : `chat${chatId}`),\n\t\t\t\t},\n\t\t\t\ttext: chatName,\n\t\t\t}).outerHTML;\n\t\t});\n\n\t\ttext = text.replace(/\\[context=((?:chat\\d+|\\d+:\\d+)\\/(\\d+))](.*?)\\[\\/context]/gis, (whole, contextTag, messageId, text) =>\n\t\t{\n\t\t\tif (!text)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\ttext = Text.decode(text);\n\t\t\tcontextTag = ParserUtils.getFinalContextTag(contextTag);\n\t\t\tif (!contextTag)\n\t\t\t{\n\t\t\t\treturn text;\n\t\t\t}\n\t\t\tconst dialogId = contextTag.split('/')[0];\n\n\t\t\tlet title = '';\n\t\t\tmessageId = Number.parseInt(messageId, 10);\n\t\t\tif (Type.isNumber(messageId) && messageId > 0)\n\t\t\t{\n\t\t\t\tconst message = getCore().getStore().getters['messages/getById'](messageId);\n\t\t\t\tif (message)\n\t\t\t\t{\n\t\t\t\t\ttitle = Parser.purifyMessage(message);\n\t\t\t\t\tconst user = getCore().getStore().getters['users/get'](message.authorId);\n\t\t\t\t\tif (user)\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle = `${user.name}: ${title}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!Type.isStringFilled(title))\n\t\t\t{\n\t\t\t\ttitle = Loc.getMessage('IM_PARSER_MENTION_DIALOG');\n\t\t\t}\n\n\t\t\treturn Dom.create({\n\t\t\t\ttag: 'span',\n\t\t\t\tattrs: {\n\t\t\t\t\tclassName: MENTION_BASE_CLASS,\n\t\t\t\t\t'data-type': MessageMentionType.context,\n\t\t\t\t\t'data-dialog-id': dialogId,\n\t\t\t\t\t'data-message-id': messageId,\n\t\t\t\t\ttitle,\n\t\t\t\t},\n\t\t\t\ttext\n\t\t\t}).outerHTML;\n\t\t});\n\n\t\treturn text;\n\t},\n\n\tpurify(text): string\n\t{\n\t\ttext = text.replace(/\\[USER=(all|[0-9]+)( REPLACE)?](.*?)\\[\\/USER]/gi, (whole, userId, replace, userName) => {\n\t\t\tuserId = Number.parseInt(userId, 10);\n\n\t\t\tif (!Type.isNumber(userId) || userId === 0)\n\t\t\t{\n\t\t\t\treturn userName;\n\t\t\t}\n\n\t\t\tif (replace || !userName)\n\t\t\t{\n\t\t\t\tconst user = getCore().getStore().getters['users/get'](userId);\n\t\t\t\tif (user)\n\t\t\t\t{\n\t\t\t\t\tuserName = user.name;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tuserName = Text.decode(userName);\n\t\t\t}\n\n\t\t\tif (!userName)\n\t\t\t{\n\t\t\t\tuserName = `User ${userId}`;\n\t\t\t}\n\n\t\t\treturn userName;\n\t\t});\n\n\t\ttext = text.replace(/\\[CHAT=(imol\\|)?(\\d+)](.*?)\\[\\/CHAT]/gi, (whole, openlines, chatId, chatName) => {\n\t\t\tchatId = Number.parseInt(chatId, 10);\n\n\t\t\tif (!chatName)\n\t\t\t{\n\t\t\t\tconst dialog = getCore().getStore().getters['chats/get']('chat'+chatId);\n\t\t\t\tchatName = dialog? dialog.name: 'Chat '+chatId;\n\t\t\t}\n\n\t\t\treturn chatName;\n\t\t});\n\n\t\ttext = text.replace(/\\[context=(chat\\d+|\\d+:\\d+)\\/(\\d+)](.*?)\\[\\/context]/gis, (whole, dialogId, messageId, text) => {\n\t\t\tif (!text)\n\t\t\t{\n\t\t\t\tconst dialog = getCore().getStore().getters['chats/get'](dialogId);\n\t\t\t\ttext = dialog? dialog.name: 'Dialog '+dialogId;\n\t\t\t}\n\n\t\t\treturn text;\n\t\t});\n\n\t\treturn text;\n\t},\n\n\texecuteClickEvent(event: PointerEvent, context: ApplicationContext)\n\t{\n\t\tconst mentionHandler = new MentionHandler(context);\n\n\t\tmentionHandler.handleClick(event);\n\t},\n\n\trenderAllParticipantsMention(userName: string): string\n\t{\n\t\tconst className = `${MENTION_BASE_CLASS} ${MentionModifier.highlight}`;\n\n\t\treturn Dom.create({\n\t\t\ttag: 'span',\n\t\t\tattrs: {\n\t\t\t\tclassName,\n\t\t\t\t'data-type': MessageMentionType.user,\n\t\t\t\t'data-value': SpecialMentionDialogId.allParticipants,\n\t\t\t},\n\t\t\ttext: userName,\n\t\t}).outerHTML;\n\t},\n};\n","export const ParserCommon = {\n\n\tdecodeNewLine(text): string\n\t{\n\t\ttext = text.replace(/\\n/gi, '<br />');\n\t\ttext = text.replace(/\\[BR]/gi, '<br />');\n\n\t\treturn text;\n\t},\n\n\tpurifyNewLine(text, replaceSymbol = ' '): string\n\t{\n\t\tif (replaceSymbol !== \"\\n\")\n\t\t{\n\t\t\ttext = text.replace(/\\n/gi, replaceSymbol);\n\t\t}\n\t\ttext = text.replace(/\\[BR]/gi, replaceSymbol);\n\n\t\treturn text;\n\t},\n\n\tpurifyBreakLine(text, replaceLetter = ' '): string\n\t{\n\t\ttext = text.replace(/<br><br \\/>/gi, '<br />');\n\t\ttext = text.replace(/<br \\/><br>/gi, '<br />');\n\t\ttext = text.replace(/\\[BR]/gi, '<br />');\n\t\ttext = text.replace(/<br \\/>/gi, replaceLetter);\n\n\t\t// text = text.replace(/<\\/?[^>]+>/gi, '');\n\n\t\treturn text;\n\t},\n\n\tdecodeTabulation(text): string\n\t{\n\t\ttext = text.replace(/( ){4}/gi, '\\t');\n\t\ttext = text.replace(/\\t/gi, '&nbsp;&nbsp;&nbsp;&nbsp;');\n\n\t\treturn text;\n\t},\n\n\tpurifyTabulation(text): string\n\t{\n\t\ttext = text.replace(/&nbsp;&nbsp;&nbsp;&nbsp;/gi, \" \");\n\n\t\treturn text;\n\t},\n\n\tpurifyNbsp(text): string\n\t{\n\t\ttext = text.replace(/&nbsp;/gi, \" \");\n\n\t\treturn text;\n\t},\n\n\tremoveDuplicateTags(text): string\n\t{\n\t\tif (text.substr(-6) === '<br />')\n\t\t{\n\t\t\ttext = text.substr(0, text.length - 6);\n\t\t}\n\n\t\ttext = text.replace(/<br><br \\/>/gi, '<br />');\n\t\ttext = text.replace(/<br \\/><br>/gi, '<br />');\n\n\t\treturn text;\n\t},\n}\n\n","import { Loc } from 'main.core';\n\nexport const ParserDisk = {\n\tdecode(text: string): string\n\t{\n\t\tconst diskText = `[${Loc.getMessage('IM_PARSER_ICON_TYPE_FILE')}]`;\n\n\t\treturn text.replaceAll(/\\[disk=\\d+]/gi, diskText);\n\t},\n\tpurify(text: string): string\n\t{\n\t\treturn this.decode(text);\n\t},\n};\n","import { Reflection, Text } from 'main.core';\n\nexport const ParserDate = {\n\tdecode(text: string): string\n\t{\n\t\treturn handleTimestampCode(text);\n\t},\n\n\tpurify(text: string): string\n\t{\n\t\treturn handleTimestampCode(text);\n\t},\n};\n\nconst handleTimestampCode = (text: string): string => {\n\t// [timestamp=1645844720 format=SHORT_TIME_FORMAT]\n\tconst regex = /\\[timestamp=(?<timestamp>\\d+)\\s+format=(?<format>[_a-z]+)]/gi;\n\n\treturn text.replaceAll(regex, (initialText, ...args) => {\n\t\tconst { timestamp, format } = args.at(-1);\n\n\t\tconst DateFormatter = Reflection.getClass('BX.Messenger.v2.Lib.DateFormatter');\n\t\tconst DateFormat = Reflection.getClass('BX.Messenger.v2.Lib.DateFormat');\n\t\tconst DateCode = Reflection.getClass('BX.Messenger.v2.Lib.DateCode');\n\t\tif (!DateFormatter)\n\t\t{\n\t\t\treturn initialText;\n\t\t}\n\n\t\tconst timestampInMilliseconds = Number(timestamp) * 1000;\n\t\tconst date = new Date(timestampInMilliseconds);\n\n\t\tconst preparedFormat = Text.toCamelCase(format);\n\t\tconst availableFormats = Object.keys(DateFormat);\n\t\tif (!availableFormats.includes(preparedFormat))\n\t\t{\n\t\t\treturn initialText;\n\t\t}\n\n\t\treturn DateFormatter.formatByCode(date, DateCode[preparedFormat]);\n\t});\n};\n","export const NestedTagHandler = {\n\tputReplacement: [],\n\tsendReplacement: [],\n\tcodeReplacement: [],\n\n\tclean()\n\t{\n\t\tthis.putReplacement = [];\n\t\tthis.sendReplacement = [];\n\t\tthis.codeReplacement = [];\n\t},\n\n\tcutPutTag(text: string): string\n\t{\n\t\treturn text.replaceAll(/\\[put(?:=(.+?))?](.+?)?\\[\\/put]/gi, (whole) => {\n\t\t\tconst id = this.putReplacement.length;\n\t\t\tthis.putReplacement.push(whole);\n\n\t\t\treturn `####REPLACEMENT_PUT_${id}####`;\n\t\t});\n\t},\n\n\trecoverPutTag(text: string): string\n\t{\n\t\tthis.putReplacement.forEach((value, index) => {\n\t\t\ttext = text.replace(`####REPLACEMENT_PUT_${index}####`, value);\n\t\t});\n\n\t\treturn text;\n\t},\n\n\tcutSendTag(text: string): string\n\t{\n\t\ttext = text.replaceAll(/\\[send(?:=(.+?))?](.+?)?\\[\\/send]/gi, (whole) => {\n\t\t\tconst id = this.sendReplacement.length;\n\t\t\tthis.sendReplacement.push(whole);\n\n\t\t\treturn `####REPLACEMENT_SEND_${id}####`;\n\t\t});\n\n\t\treturn text;\n\t},\n\n\trecoverSendTag(text: string): string\n\t{\n\t\tthis.sendReplacement.forEach((value, index) => {\n\t\t\tconst placeholder = `####REPLACEMENT_SEND_${index}####`;\n\t\t\ttext = text.split(placeholder).join(value);\n\t\t});\n\n\t\treturn text;\n\t},\n\n\tcutCodeTag(text: string): string\n\t{\n\t\ttext = text.replaceAll(/\\[code](<br \\/>)?(.*?)\\[\\/code]/gis, (whole) => {\n\t\t\tconst id = this.codeReplacement.length;\n\t\t\tthis.codeReplacement.push(whole);\n\n\t\t\treturn `####REPLACEMENT_CODE_${id}####`;\n\t\t});\n\n\t\treturn text;\n\t},\n\n\trecoverCodeTag(text: string): string\n\t{\n\t\tthis.codeReplacement.forEach((value, index) => {\n\t\t\ttext = text.replace(`####REPLACEMENT_CODE_${index}####`, value);\n\t\t});\n\n\t\tthis.sendReplacement.forEach((value, index) => {\n\t\t\ttext = text.replaceAll(`####REPLACEMENT_SEND_${index}####`, value);\n\t\t});\n\n\t\treturn text;\n\t},\n\n\trecoverRecursionTag(text: string): string\n\t{\n\t\tif (this.sendReplacement.length > 0)\n\t\t{\n\t\t\tthis.sendReplacement.forEach((value, index) => {\n\t\t\t\ttext = text.replaceAll(`####REPLACEMENT_SEND_${index}####`, value);\n\t\t\t});\n\t\t}\n\n\t\ttext = text.split('####REPLACEMENT_SP_').join('####REPLACEMENT_PUT_');\n\n\t\tif (this.putReplacement.length > 0)\n\t\t{\n\t\t\tdo\n\t\t\t{\n\t\t\t\tthis.putReplacement.forEach((value, index) => {\n\t\t\t\t\ttext = text.replace(`####REPLACEMENT_PUT_${index}####`, value);\n\t\t\t\t});\n\t\t\t}\n\t\t\twhile (text.includes('####REPLACEMENT_PUT_'));\n\t\t}\n\n\t\treturn text;\n\t},\n};\n","import { Type, Text, Loc, Extension } from 'main.core';\n\nimport { DesktopApi } from 'im.v2.lib.desktop-api';\n\nimport { ParserSlashCommand } from './functions/slash-command';\nimport { ParserQuote } from './functions/quote';\nimport { ParserImage } from './functions/image';\nimport { ParserSmile } from './functions/smile';\nimport { ParserUrl } from './functions/url';\nimport { ParserFont } from './functions/font';\nimport { ParserLines } from './functions/lines';\nimport { ParserAction } from './functions/action';\nimport { ParserCall } from './functions/call';\nimport { ParserMention } from './functions/mention';\nimport { ParserCommon } from './functions/common';\nimport { ParserIcon } from './functions/icon';\nimport { ParserDisk } from './functions/disk';\nimport { ParserDate } from './functions/date';\nimport { NestedTagHandler } from './utils/nested-tag-handler';\nimport { ParserUtils } from './utils/utils';\n\nimport { getCore, getLogger } from './utils/core-proxy';\n\nimport './parser.css';\n\nimport type { ImModelMessage, ImModelNotification, ImModelRecentItem } from 'im.v2.model';\nimport type { ApplicationContext } from 'im.v2.const';\nimport type { ParserConfig } from './types/parser-config';\n\ntype ResultRecentConfig = {\n\tfiles: boolean | Object[],\n\tattach: boolean | string | Object[],\n\ttext: string,\n\tsticker?: boolean,\n};\n\nexport const Parser = {\n\tdecodeMessage(message: ImModelMessage): string\n\t{\n\t\tconst messageFiles = getCore().getStore().getters['messages/getMessageFiles'](message.id);\n\t\tconst contextDialogId = ParserUtils.getDialogIdByChatId(message.chatId);\n\n\t\treturn this.decode({\n\t\t\ttext: message.text,\n\t\t\tattach: message.attach,\n\t\t\tfiles: messageFiles,\n\t\t\tshowIconIfEmptyText: false,\n\t\t\tcontextDialogId,\n\t\t});\n\t},\n\n\tdecodeNotification(notification: ImModelNotification): string\n\t{\n\t\treturn this.decode({\n\t\t\ttext: notification.text,\n\t\t\tattach: notification.params.attach ?? false,\n\t\t\tshowIconIfEmptyText: false,\n\t\t\tshowImageFromLink: false,\n\t\t\turlTarget: DesktopApi.isDesktop() ? '_blank' : '_self',\n\t\t});\n\t},\n\n\tdecodeNotificationParam(text: string): string\n\t{\n\t\treturn this.decode({\n\t\t\ttext,\n\t\t\turlTarget: DesktopApi.isDesktop() ? '_blank' : '_self',\n\t\t});\n\t},\n\n\tdecodeText(text: string): string\n\t{\n\t\treturn this.decode({ text });\n\t},\n\n\tdecodeHtml(text: string): string\n\t{\n\t\treturn this.decode({ text });\n\t},\n\n\tdecodeSmile(text: string, options: {}): string\n\t{\n\t\treturn ParserSmile.decodeSmile(text, options);\n\t},\n\n\tdecodeSmileForLegacyCore(text: string, options: {}): string\n\t{\n\t\tconst legacyConfig = { ...options };\n\t\tlegacyConfig.ratioConfig = Object.freeze({\n\t\t\tDefault: 1,\n\t\t\tBig: 1.6,\n\t\t});\n\n\t\treturn ParserSmile.decodeSmile(text, legacyConfig);\n\t},\n\n\tdecode(config: ParserConfig): string\n\t{\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\tgetLogger().error('Parser.decode: the first parameter must be object', config);\n\n\t\t\treturn '<b style=\"color:red\">Parser.decode: the first parameter must be a parameter object</b';\n\t\t}\n\n\t\tlet { text } = config;\n\t\tconst {\n\t\t\tattach = false,\n\t\t\tfiles = false,\n\t\t\tremoveLinks = false,\n\t\t\tshowIconIfEmptyText = true,\n\t\t\tshowImageFromLink = true,\n\t\t\tcontextDialogId = '',\n\t\t\turlTarget = '_blank',\n\t\t} = config;\n\n\t\tif (!Type.isString(text))\n\t\t{\n\t\t\tif (Type.isNumber(text))\n\t\t\t{\n\t\t\t\treturn text.toString();\n\t\t\t}\n\n\t\t\treturn '';\n\t\t}\n\n\t\tif (!text)\n\t\t{\n\t\t\tif (showIconIfEmptyText)\n\t\t\t{\n\t\t\t\ttext = ParserIcon.addIconToShortText({ text, attach, files });\n\t\t\t}\n\n\t\t\treturn text.trim();\n\t\t}\n\n\t\ttext = Text.encode(text.trim());\n\n\t\ttext = ParserCommon.decodeNewLine(text);\n\t\ttext = ParserCommon.decodeTabulation(text);\n\n\t\ttext = NestedTagHandler.cutPutTag(text);\n\t\ttext = NestedTagHandler.cutSendTag(text);\n\t\ttext = NestedTagHandler.cutCodeTag(text);\n\n\t\ttext = ParserSmile.decodeSmile(text);\n\t\ttext = ParserSlashCommand.decode(text);\n\t\ttext = ParserImage.decodeImageBbCode(text, { contextDialogId });\n\t\ttext = ParserUrl.decode(text, { urlTarget, removeLinks });\n\t\ttext = ParserFont.decode(text);\n\t\ttext = ParserLines.decode(text);\n\t\ttext = ParserMention.decode(text);\n\t\ttext = ParserCall.decode(text);\n\t\ttext = ParserImage.decodeIcon(text);\n\t\tif (showImageFromLink)\n\t\t{\n\t\t\ttext = ParserImage.decodeLink(text);\n\t\t}\n\t\ttext = ParserDisk.decode(text);\n\t\ttext = ParserDate.decode(text);\n\n\t\ttext = ParserQuote.decodeArrowQuote(text);\n\t\ttext = ParserQuote.decodeQuote(text, { contextDialogId });\n\n\t\ttext = NestedTagHandler.recoverSendTag(text);\n\t\ttext = ParserAction.decodeSend(text);\n\n\t\ttext = NestedTagHandler.recoverPutTag(text);\n\t\ttext = ParserAction.decodePut(text);\n\n\t\ttext = NestedTagHandler.recoverCodeTag(text);\n\t\ttext = ParserQuote.decodeCode(text);\n\n\t\ttext = NestedTagHandler.recoverRecursionTag(text);\n\n\t\ttext = ParserCommon.removeDuplicateTags(text);\n\n\t\tNestedTagHandler.clean();\n\n\t\treturn text;\n\t},\n\n\tpurifyMessage(message: ImModelMessage): string\n\t{\n\t\tconst messageFiles = getCore().getStore().getters['messages/getMessageFiles'](message.id);\n\t\tconst isSticker = getCore().getStore().getters['stickers/messages/isSticker'](message.id);\n\n\t\treturn this.purify({\n\t\t\ttext: message.text,\n\t\t\tattach: message.attach,\n\t\t\tfiles: messageFiles,\n\t\t\tisSticker,\n\t\t});\n\t},\n\n\tpurifyNotification(notification: ImModelNotification): string\n\t{\n\t\tconst messageFiles = getCore().getStore().getters['messages/getMessageFiles'](notification.id);\n\n\t\treturn this.purify({\n\t\t\ttext: notification.text,\n\t\t\tattach: notification.params.attach ?? false,\n\t\t\tfiles: messageFiles,\n\t\t});\n\t},\n\n\tpurifyRecent(recentMessage: ImModelRecentItem): string\n\t{\n\t\tconst settings = Extension.getSettings('im.v2.lib.parser');\n\t\tconst v2 = settings.get('v2');\n\t\tif (!v2)\n\t\t{\n\t\t\tconst { files, attach, text } = this.prepareLegacyConfigForRecent(recentMessage);\n\n\t\t\treturn this.purify({\n\t\t\t\ttext,\n\t\t\t\tattach,\n\t\t\t\tfiles,\n\t\t\t\tshowPhraseMessageWasDeleted: recentMessage.message.id !== 0,\n\t\t\t});\n\t\t}\n\n\t\tconst { files, attach, text, isSticker } = this.prepareConfigForRecent(recentMessage);\n\n\t\treturn this.purify({\n\t\t\ttext,\n\t\t\tattach,\n\t\t\tfiles,\n\t\t\tshowPhraseMessageWasDeleted: recentMessage.messageId !== 0,\n\t\t\tisSticker,\n\t\t});\n\t},\n\n\tpurifyText(text: string): string\n\t{\n\t\treturn this.purify({ text });\n\t},\n\n\tpurify(config: ParserConfig): string\n\t{\n\t\tif (!Type.isPlainObject(config))\n\t\t{\n\t\t\tgetLogger().error('Parser.purify: the first parameter must be a object', config);\n\n\t\t\treturn 'Parser.purify: the first parameter must be a parameter object';\n\t\t}\n\n\t\tlet { text } = config;\n\t\tconst {\n\t\t\tattach = false,\n\t\t\tfiles = false,\n\t\t\tisSticker = false,\n\t\t\tshowPhraseMessageWasDeleted = true,\n\t\t} = config;\n\n\t\tif (!Type.isString(text))\n\t\t{\n\t\t\ttext = Type.isNumber(text) ? text.toString() : '';\n\t\t}\n\n\t\tif (!text || isSticker)\n\t\t{\n\t\t\ttext = ParserIcon.addIconToShortText({ text, attach, files, isSticker });\n\n\t\t\treturn text.trim();\n\t\t}\n\n\t\ttext = Text.encode(text.trim());\n\n\t\ttext = ParserCommon.purifyNewLine(text, '\\n');\n\t\ttext = ParserSlashCommand.purify(text);\n\t\ttext = ParserQuote.purifyArrowQuote(text);\n\t\ttext = ParserQuote.purifyQuote(text);\n\t\ttext = ParserQuote.purifyCode(text);\n\t\ttext = ParserAction.purifyPut(text);\n\t\ttext = ParserAction.purifySend(text);\n\t\ttext = ParserMention.purify(text);\n\t\ttext = ParserFont.purify(text);\n\t\ttext = ParserLines.purify(text);\n\t\ttext = ParserCall.purify(text);\n\t\ttext = ParserUrl.purify(text);\n\t\ttext = ParserImage.purifyLink(text);\n\t\ttext = ParserImage.purifyIcon(text);\n\t\ttext = ParserImage.purifyImageBbCode(text);\n\t\ttext = ParserDisk.purify(text);\n\t\ttext = ParserDate.purify(text);\n\t\ttext = ParserCommon.purifyNewLine(text);\n\t\ttext = ParserIcon.addIconToShortText({ text, attach, files });\n\n\t\tif (text.length > 0)\n\t\t{\n\t\t\ttext = Text.decode(text);\n\t\t}\n\t\telse if (showPhraseMessageWasDeleted)\n\t\t{\n\t\t\ttext = Loc.getMessage('IM_PARSER_MESSAGE_DELETED');\n\t\t}\n\n\t\treturn text.trim();\n\t},\n\n\tprepareQuote(message: ImModelMessage, quoteText: string = ''): string\n\t{\n\t\tconst { id, attach } = message;\n\n\t\tlet text = quoteText === '' ? message.text : quoteText;\n\n\t\tconst files = getCore().getStore().getters['messages/getMessageFiles'](id);\n\t\tconst isSticker = getCore().getStore().getters['stickers/messages/isSticker'](id);\n\n\t\ttext = Text.encode(text.trim());\n\n\t\ttext = ParserMention.purify(text);\n\t\ttext = ParserCall.purify(text);\n\t\ttext = ParserLines.purify(text);\n\t\ttext = ParserCommon.purifyBreakLine(text, '\\n');\n\t\ttext = ParserCommon.purifyNbsp(text);\n\t\ttext = ParserUrl.removeSimpleUrlTag(text);\n\t\ttext = ParserQuote.purifyCode(text, ' ');\n\t\ttext = ParserQuote.purifyQuote(text, ' ');\n\t\ttext = ParserQuote.purifyArrowQuote(text, ' ');\n\t\tif (quoteText === '')\n\t\t{\n\t\t\ttext = ParserIcon.addIconToShortText({ text, attach, files });\n\t\t}\n\n\t\tif (isSticker)\n\t\t{\n\t\t\ttext = ParserIcon.addIconToShortText({ isSticker });\n\t\t}\n\n\t\ttext = text.length > 0 ? Text.decode(text) : Loc.getMessage('IM_PARSER_MESSAGE_DELETED');\n\n\t\treturn text.trim();\n\t},\n\n\tprepareEdit(message: ImModelMessage): string\n\t{\n\t\tlet { text } = message;\n\n\t\ttext = ParserUrl.removeSimpleUrlTag(text);\n\t\ttext = ParserMention.purify(text);\n\n\t\treturn text.trim();\n\t},\n\n\tprepareCopy(message: ImModelMessage): string\n\t{\n\t\tlet { text } = message;\n\n\t\ttext = ParserUrl.removeSimpleUrlTag(text);\n\n\t\treturn text.trim();\n\t},\n\n\tprepareCopyFile(message: ImModelMessage): string\n\t{\n\t\tconst { id } = message;\n\n\t\tconst files = getCore().getStore().getters['messages/getMessageFiles'](id).map((file) => {\n\t\t\treturn `[DISK=${file.id}]\\n`;\n\t\t});\n\n\t\treturn files.join('\\n').trim();\n\t},\n\n\tprepareConfigForRecent(recentMessage: ImModelRecentItem): ResultRecentConfig\n\t{\n\t\tlet files = getCore().getStore().getters['messages/getMessageFiles'](recentMessage.messageId);\n\t\tif (files.length === 0)\n\t\t{\n\t\t\tfiles = false;\n\t\t}\n\n\t\tconst message = getCore().getStore().getters['messages/getById'](recentMessage.messageId);\n\n\t\tlet attach = false;\n\t\tif (\n\t\t\tType.isBoolean(message?.attach)\n\t\t\t|| Type.isStringFilled(message?.attach)\n\t\t\t|| Type.isArray(message?.attach)\n\t\t)\n\t\t{\n\t\t\tattach = message.attach;\n\t\t}\n\t\telse if (Type.isPlainObject(message?.attach))\n\t\t{\n\t\t\tattach = [message.attach];\n\t\t}\n\t\tconst isSticker = getCore().getStore().getters['stickers/messages/isSticker'](recentMessage.messageId);\n\n\t\treturn { files, attach, text: message.text, isSticker };\n\t},\n\n\tprepareLegacyConfigForRecent(recentMessage): ResultRecentConfig\n\t{\n\t\tlet files = false;\n\t\tconst fileField = recentMessage.message.params.withFile;\n\t\tif (Type.isBoolean(fileField))\n\t\t{\n\t\t\tfiles = fileField;\n\t\t}\n\t\telse if (Type.isPlainObject(fileField))\n\t\t{\n\t\t\tfiles = [fileField];\n\t\t}\n\n\t\tlet attach = false;\n\t\tconst attachField = recentMessage.message.params.withAttach;\n\t\tif (\n\t\t\tType.isBoolean(attachField)\n\t\t\t|| Type.isStringFilled(attachField)\n\t\t\t|| Type.isArray(attachField)\n\t\t)\n\t\t{\n\t\t\tattach = attachField;\n\t\t}\n\t\telse if (Type.isPlainObject(attachField))\n\t\t{\n\t\t\tattach = [attachField];\n\t\t}\n\n\t\treturn { files, attach, text: recentMessage.message.text };\n\t},\n\n\texecuteClickEvent(event: PointerEvent, context: ApplicationContext)\n\t{\n\t\tParserMention.executeClickEvent(event, context);\n\t\tParserQuote.executeClickEvent(event, context);\n\t\tParserAction.executeClickEvent(event, context);\n\t},\n\n\tgetContextCodeFromForwardId(forwardId: string): string\n\t{\n\t\treturn ParserUtils.getFinalContextTag(forwardId);\n\t},\n};\n"],"names":["ParserSlashCommand","decode","text","startsWith","substr","purify","settings","Extension","getSettings","v2","get","getCore","BX","Messenger","Application","Core","Embedding","getUtils","Lib","Utils","getLogger","Logger","getConst","Const","getSmileManager","SmileManager","getBigSmileOption","settingName","Settings","message","bigSmiles","getStore","getters","RECURSIVE_LIMIT","ParserUtils","recursiveReplace","pattern","replacement","Type","isStringFilled","count","deep","replace","params","getFinalContextTag","contextTag","match","dialogId","user1","user2","messageId","toString","Number","parseInt","getUserId","getDialogIdFromFinalContextTag","finalContextTag","test","split","getDialogIdByChatId","chatId","dialog","FileType","FileIconType","AttachDescription","ParserIcon","getIcon","icon","fallbackText","addIconToShortText","config","attach","files","isSticker","isArrayFilled","getTextForFile","getTextForAttach","getTextForSticker","trim","getQuoteBlock","quote","Loc","getMessage","getCodeBlock","code","getImageBlock","image","getFileBlock","file","rawText","preparedText","isArray","length","getIconTextForFile","getIconTextForFileType","attachDescription","firstAttach","description","skipMessage","Parser","purifyText","type","result","iconText","toUpperCase","withText","textDescription","isGallery","every","video","includes","gallery","audio","name","EventType","QUOTE_SIGN","NO_CONTEXT_TAG","ParserQuote","decodeArrowQuote","isProcessed","textLines","i","quoteStartIndex","outerContainerStart","innerContainerStart","containerEnd","quoteEndIndex","join","purifyArrowQuote","spaceLetter","RegExp","decodeQuote","contextDialogId","replaceAll","whole","userBlock","userName","timeTag","quoteText","preparedQuoteText","getQuoteText","userContainer","getUserBlock","layout","Tag","render","outerHTML","purifyQuote","decodeCode","br","Dom","create","tag","attrs","className","html","purifyCode","executeClickEvent","event","context","target","parentNode","dom","recursiveBackwardNodeSearch","dataset","emitter","emit","goToMessageContext","hasUserBlock","String","BR_HTML_TAG","endsWith","slice","hasDataForUserBlock","tagWithoutHashSign","isQuoteFromTheSameChat","ImageBbCodeSizes","Object","freeze","small","medium","large","ParserImage","decodeLink","urlParsed","url","Text","toLowerCase","indexOf","checkUrl","children","src","events","error","hideErrorImage","purifyLink","symbolBeforeUrl","canPurifyLink","firstSymbol","decodeIcon","textElementSize","enableBigSmile","border","size","width","height","title","Math","max","alt","purifyIcon","purifyImageBbCode","sizesFragment","values","imageTagRegex","element","innerHTML","encodeURI","decodeImageBbCode","isValidSize","isInvalidUrl","isSafeUrl","isImage","isImageUrl","hasNestedItems","hasNestedImgBbCodes","classModifier","viewerGroupBy","viewerAttributes","getViewerDataForImageSrc","attr","firstChild","isLinkFromDisk","isLogoutLink","hasImageFileExtension","urlWithoutQueryString","hasLeadingTextBeforeUrl","AllowedSymbolsBeforeImageUrl","Set","has","RatioConfig","Default","Big","getSmileRatio","replacedText","hasOnlySmiles","matchOnlySmiles","mapTypings","smiles","typings","reduce","acc","smile","typing","definition","smileImg","lookBehind","offset","substring","escaped","escapeRegex","regExp","ParserSmile","loadSmilePatterns","smileManager","getInstance","smileList","sortedSmiles","sort","a","b","localeCompare","map","decodeSmile","options","isBoolean","ratioConfig","isObjectLike","ratio","behindMatching","call","cloneNode","style","DataAttribute","ParserUrl","urlTarget","removeLinks","link","getLinkHtml","lastIndexOf","urlPart","removeSimpleUrlTag","href","useNativeContextMenu","ParserFont","number","fontSize","hex","color","removeStrike","ParserLines","rating","ActionType","put","send","ParserAction","decodePut","command","_getHtmlForAction","purifyPut","decodeSend","purifySend","method","data","hasClass","getMessageIdForClickElement","getDialogIdByMessageId","entity","innerText","textToInsert","parentElement","querySelector","textarea","insertText","textToSend","sendMessage","messageElement","closest","id","MessageMentionType","ParserCall","destination","isNumber","historyId","SidebarDetailBlock","SpecialMentionDialogId","ChatType","MENTION_CSS_CLASS","MentionHandler","constructor","user","chat","lines","allParticipants","handleClick","handlerByDialogId","value","handlerByMentionType","openCopilot","openChat","isLinesHistoryId","openLinesHistory","isLinesExternalId","openLines","startPhoneCall","entityId","sidebar","open","panel","members","UserType","SpecialMentionHandlers","ParserMention","renderAllParticipantsMention","MENTION_BASE_CLASS","MentionModifier","highlight","extranet","userId","isLines","chatNameParsed","chatName","purifyMessage","authorId","openlines","mentionHandler","ParserCommon","decodeNewLine","purifyNewLine","replaceSymbol","purifyBreakLine","replaceLetter","decodeTabulation","purifyTabulation","purifyNbsp","removeDuplicateTags","ParserDisk","diskText","ParserDate","handleTimestampCode","regex","initialText","args","timestamp","format","at","DateFormatter","Reflection","getClass","DateFormat","DateCode","timestampInMilliseconds","date","Date","preparedFormat","toCamelCase","availableFormats","keys","formatByCode","NestedTagHandler","putReplacement","sendReplacement","codeReplacement","clean","cutPutTag","push","recoverPutTag","forEach","index","cutSendTag","recoverSendTag","placeholder","cutCodeTag","recoverCodeTag","recoverRecursionTag","decodeMessage","messageFiles","showIconIfEmptyText","decodeNotification","notification","showImageFromLink","DesktopApi","isDesktop","decodeNotificationParam","decodeText","decodeHtml","decodeSmileForLegacyCore","legacyConfig","isPlainObject","isString","encode","purifyNotification","purifyRecent","recentMessage","prepareLegacyConfigForRecent","showPhraseMessageWasDeleted","prepareConfigForRecent","prepareQuote","prepareEdit","prepareCopy","prepareCopyFile","fileField","withFile","attachField","withAttach","getContextCodeFromForwardId","forwardId"],"mappings":"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"}