{"version":3,"file":"navigation.bundle.js","sources":["../src/navigation.js"],"sourcesContent":["import { FeaturePromoter } from 'ui.info-helper';\n\nimport { Layout, SliderCode, NavigationMenuItem, Path, GetParameter } from 'im.v2.const';\nimport { Analytics } from 'im.v2.lib.analytics';\nimport { Feature, FeatureManager } from 'im.v2.lib.feature';\nimport { LayoutManager } from 'im.v2.lib.layout';\nimport { PhoneManager } from 'im.v2.lib.phone';\nimport { Utils } from 'im.v2.lib.utils';\nimport { MarketManager } from 'im.v2.lib.market';\n\nexport type NavigationMenuItemParams = {\n\tid: string,\n\tentityId?: string,\n\ttarget?: HTMLElement,\n\tasLink?: boolean,\n};\n\ntype LayoutParams = {\n\tlayoutName: string,\n\tlayoutEntityId?: string | number\n};\n\nconst customClickHandler = {\n\t[NavigationMenuItem.copilot]: onCopilotClick,\n\t[NavigationMenuItem.call]: onCallClick,\n\t[NavigationMenuItem.timemanager]: onTimeManagerClick,\n\t[NavigationMenuItem.homepage]: onHomepageClick,\n\t[NavigationMenuItem.market]: onMarketClick,\n};\n\nexport const NavigationManager = {\n\topen(payload: NavigationMenuItemParams): void\n\t{\n\t\tconst { id } = payload;\n\t\tif (!NavigationMenuItem[id])\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (customClickHandler[id])\n\t\t{\n\t\t\tcustomClickHandler[id](payload);\n\n\t\t\treturn;\n\t\t}\n\n\t\thandleMenuItem(payload);\n\t},\n\tisMarketApp(payload: NavigationMenuItemParams): boolean\n\t{\n\t\tconst { id, entityId } = payload;\n\t\tconst isMarketMenuItem = id === NavigationMenuItem.market;\n\n\t\treturn isMarketMenuItem && Boolean(entityId);\n\t},\n};\n\nfunction onCopilotClick(payload: NavigationMenuItemParams)\n{\n\tif (!FeatureManager.isFeatureAvailable(Feature.copilotActive))\n\t{\n\t\tconst promoter = new FeaturePromoter({ code: SliderCode.copilotDisabled });\n\t\tpromoter.show();\n\t\tAnalytics.getInstance().copilot.onOpenTab({ isAvailable: false });\n\n\t\treturn;\n\t}\n\n\thandleMenuItem(payload);\n}\n\nfunction onCallClick(payload: NavigationMenuItemParams)\n{\n\tconst KEYPAD_OFFSET_TOP = -30;\n\tconst KEYPAD_OFFSET_LEFT = 64;\n\n\tPhoneManager.getInstance().openKeyPad({\n\t\tbindElement: payload?.target,\n\t\toffsetTop: KEYPAD_OFFSET_TOP,\n\t\toffsetLeft: KEYPAD_OFFSET_LEFT,\n\t});\n}\n\nfunction onTimeManagerClick()\n{\n\tBX.Timeman?.Monitor?.openReport();\n}\n\nfunction onHomepageClick()\n{\n\tUtils.browser.openLink('/');\n}\n\nfunction onMarketClick(payload: NavigationMenuItemParams)\n{\n\tconst { entityId } = payload;\n\tif (entityId)\n\t{\n\t\t// specific apps should be opened as layouts\n\t\tchangeLayout({\n\t\t\tlayoutName: Layout.market,\n\t\t\tlayoutEntityId: entityId,\n\t\t});\n\n\t\treturn;\n\t}\n\n\t// marketplace should be opened as slider\n\tMarketManager.openChatMarket();\n}\n\nfunction handleMenuItem(payload: NavigationMenuItemParams): void\n{\n\tconst { id: layoutName, entityId: layoutEntityId, asLink } = payload;\n\tif (asLink)\n\t{\n\t\topenLink({ layoutName, layoutEntityId });\n\n\t\treturn;\n\t}\n\n\tchangeLayout({ layoutName, layoutEntityId });\n}\n\nfunction openLink({ layoutName, layoutEntityId }: LayoutParams): void\n{\n\tconst LayoutToUrlConfigMap: Record<string, { paramName: string, useParamByDefault: boolean, canUseId: boolean }> = {\n\t\t[NavigationMenuItem.chat]: {\n\t\t\tparamName: GetParameter.openChat,\n\t\t\tuseParamByDefault: false,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.copilot]: {\n\t\t\tparamName: GetParameter.openCopilotChat,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.collab]: {\n\t\t\tparamName: GetParameter.openCollab,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.channel]: {\n\t\t\tparamName: GetParameter.openChannel,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.tasksTask]: {\n\t\t\tparamName: GetParameter.openTaskComments,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.openlines]: {\n\t\t\tparamName: GetParameter.openLines,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: true,\n\t\t},\n\t\t[NavigationMenuItem.notification]: {\n\t\t\tparamName: GetParameter.openNotifications,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: false,\n\t\t},\n\t\t[NavigationMenuItem.settings]: {\n\t\t\tparamName: GetParameter.openSettings,\n\t\t\tuseParamByDefault: true,\n\t\t\tcanUseId: false,\n\t\t},\n\t};\n\n\tconst basePath = Path.online;\n\tconst urlConfig = LayoutToUrlConfigMap[layoutName];\n\tif (!urlConfig)\n\t{\n\t\treturn;\n\t}\n\n\tlet finalUrl = basePath;\n\tif (urlConfig.canUseId && layoutEntityId)\n\t{\n\t\tfinalUrl += `?${urlConfig.paramName}=${layoutEntityId}`;\n\t}\n\telse if (urlConfig.useParamByDefault)\n\t{\n\t\tfinalUrl += `?${urlConfig.paramName}`;\n\t}\n\n\tlocation.href = finalUrl;\n}\n\nfunction changeLayout({ layoutName, layoutEntityId }: LayoutParams)\n{\n\tconst layoutManager = LayoutManager.getInstance();\n\tif (!layoutManager.isValidLayout(layoutName))\n\t{\n\t\treturn;\n\t}\n\n\tlet entityId = layoutEntityId;\n\n\tconst lastOpenedElement = layoutManager.getLastOpenedElement(layoutName);\n\tif (!entityId && lastOpenedElement)\n\t{\n\t\tentityId = lastOpenedElement;\n\t}\n\n\tvoid layoutManager.setLayout({ name: layoutName, entityId });\n}\n"],"names":["customClickHandler","NavigationMenuItem","copilot","onCopilotClick","call","onCallClick","timemanager","onTimeManagerClick","homepage","onHomepageClick","market","onMarketClick","NavigationManager","open","payload","id","handleMenuItem","isMarketApp","entityId","isMarketMenuItem","Boolean","FeatureManager","isFeatureAvailable","Feature","copilotActive","promoter","FeaturePromoter","code","SliderCode","copilotDisabled","show","Analytics","getInstance","onOpenTab","isAvailable","KEYPAD_OFFSET_TOP","KEYPAD_OFFSET_LEFT","PhoneManager","openKeyPad","bindElement","target","offsetTop","offsetLeft","BX","Timeman","Monitor","openReport","Utils","browser","openLink","changeLayout","layoutName","Layout","layoutEntityId","MarketManager","openChatMarket","asLink","LayoutToUrlConfigMap","chat","paramName","GetParameter","openChat","useParamByDefault","canUseId","openCopilotChat","collab","openCollab","channel","openChannel","tasksTask","openTaskComments","openlines","openLines","notification","openNotifications","settings","openSettings","basePath","Path","online","urlConfig","finalUrl","location","href","layoutManager","LayoutManager","isValidLayout","lastOpenedElement","getLastOpenedElement","setLayout","name"],"mappings":";;;;;;;CAsBA,MAAMA,kBAAkB,GAAG;GAC1B,CAACC,8BAAkB,CAACC,OAAO,GAAGC,cAAc;GAC5C,CAACF,8BAAkB,CAACG,IAAI,GAAGC,WAAW;GACtC,CAACJ,8BAAkB,CAACK,WAAW,GAAGC,kBAAkB;GACpD,CAACN,8BAAkB,CAACO,QAAQ,GAAGC,eAAe;GAC9C,CAACR,8BAAkB,CAACS,MAAM,GAAGC;CAC9B,CAAC;AAED,OAAaC,iBAAiB,GAAG;GAChCC,IAAI,CAACC,OAAiC,EACtC;KACC,MAAM;OAAEC;MAAI,GAAGD,OAAO;KACtB,IAAI,CAACb,8BAAkB,CAACc,EAAE,CAAC,EAC3B;OACC;;KAGD,IAAIf,kBAAkB,CAACe,EAAE,CAAC,EAC1B;OACCf,kBAAkB,CAACe,EAAE,CAAC,CAACD,OAAO,CAAC;OAE/B;;KAGDE,cAAc,CAACF,OAAO,CAAC;IACvB;GACDG,WAAW,CAACH,OAAiC,EAC7C;KACC,MAAM;OAAEC,EAAE;OAAEG;MAAU,GAAGJ,OAAO;KAChC,MAAMK,gBAAgB,GAAGJ,EAAE,KAAKd,8BAAkB,CAACS,MAAM;KAEzD,OAAOS,gBAAgB,IAAIC,OAAO,CAACF,QAAQ,CAAC;;CAE9C,CAAC;CAED,SAASf,cAAc,CAACW,OAAiC,EACzD;GACC,IAAI,CAACO,gCAAc,CAACC,kBAAkB,CAACC,yBAAO,CAACC,aAAa,CAAC,EAC7D;KACC,MAAMC,QAAQ,GAAG,IAAIC,6BAAe,CAAC;OAAEC,IAAI,EAAEC,sBAAU,CAACC;MAAiB,CAAC;KAC1EJ,QAAQ,CAACK,IAAI,EAAE;KACfC,6BAAS,CAACC,WAAW,EAAE,CAAC9B,OAAO,CAAC+B,SAAS,CAAC;OAAEC,WAAW,EAAE;MAAO,CAAC;KAEjE;;GAGDlB,cAAc,CAACF,OAAO,CAAC;CACxB;CAEA,SAAST,WAAW,CAACS,OAAiC,EACtD;GACC,MAAMqB,iBAAiB,GAAG,CAAC,EAAE;GAC7B,MAAMC,kBAAkB,GAAG,EAAE;GAE7BC,4BAAY,CAACL,WAAW,EAAE,CAACM,UAAU,CAAC;KACrCC,WAAW,EAAEzB,OAAO,oBAAPA,OAAO,CAAE0B,MAAM;KAC5BC,SAAS,EAAEN,iBAAiB;KAC5BO,UAAU,EAAEN;IACZ,CAAC;CACH;CAEA,SAAS7B,kBAAkB,GAC3B;GAAA;GACC,eAAAoC,EAAE,CAACC,OAAO,4CAAV,YAAYC,OAAO,qBAAnB,oBAAqBC,UAAU,EAAE;CAClC;CAEA,SAASrC,eAAe,GACxB;GACCsC,qBAAK,CAACC,OAAO,CAACC,QAAQ,CAAC,GAAG,CAAC;CAC5B;CAEA,SAAStC,aAAa,CAACG,OAAiC,EACxD;GACC,MAAM;KAAEI;IAAU,GAAGJ,OAAO;GAC5B,IAAII,QAAQ,EACZ;;KAECgC,YAAY,CAAC;OACZC,UAAU,EAAEC,kBAAM,CAAC1C,MAAM;OACzB2C,cAAc,EAAEnC;MAChB,CAAC;KAEF;;;;GAIDoC,8BAAa,CAACC,cAAc,EAAE;CAC/B;CAEA,SAASvC,cAAc,CAACF,OAAiC,EACzD;GACC,MAAM;KAAEC,EAAE,EAAEoC,UAAU;KAAEjC,QAAQ,EAAEmC,cAAc;KAAEG;IAAQ,GAAG1C,OAAO;GACpE,IAAI0C,MAAM,EACV;KACCP,QAAQ,CAAC;OAAEE,UAAU;OAAEE;MAAgB,CAAC;KAExC;;GAGDH,YAAY,CAAC;KAAEC,UAAU;KAAEE;IAAgB,CAAC;CAC7C;CAEA,SAASJ,QAAQ,CAAC;GAAEE,UAAU;GAAEE;CAA6B,CAAC,EAC9D;GACC,MAAMI,oBAA0G,GAAG;KAClH,CAACxD,8BAAkB,CAACyD,IAAI,GAAG;OAC1BC,SAAS,EAAEC,wBAAY,CAACC,QAAQ;OAChCC,iBAAiB,EAAE,KAAK;OACxBC,QAAQ,EAAE;MACV;KACD,CAAC9D,8BAAkB,CAACC,OAAO,GAAG;OAC7ByD,SAAS,EAAEC,wBAAY,CAACI,eAAe;OACvCF,iBAAiB,EAAE,IAAI;OACvBC,QAAQ,EAAE;MACV;KACD,CAAC9D,8BAAkB,CAACgE,MAAM,GAAG;OAC5BN,SAAS,EAAEC,wBAAY,CAACM,UAAU;OAClCJ,iBAAiB,EAAE,IAAI;OACvBC,QAAQ,EAAE;MACV;KACD,CAAC9D,8BAAkB,CAACkE,OAAO,GAAG;OAC7BR,SAAS,EAAEC,wBAAY,CAACQ,WAAW;OACnCN,iBAAiB,EAAE,IAAI;OACvBC,QAAQ,EAAE;MACV;KACD,CAAC9D,8BAAkB,CAACoE,SAAS,GAAG;OAC/BV,SAAS,EAAEC,wBAAY,CAACU,gBAAgB;OACxCR,iBAAiB,EAAE,IAAI;OACvBC,QAAQ,EAAE;MACV;KACD,CAAC9D,8BAAkB,CAACsE,SAAS,GAAG;OAC/BZ,SAAS,EAAEC,wBAAY,CAACY,SAAS;OACjCV,iBAAiB,EAAE,IAAI;OACvBC,QAAQ,EAAE;MACV;KACD,CAAC9D,8BAAkB,CAACwE,YAAY,GAAG;OAClCd,SAAS,EAAEC,wBAAY,CAACc,iBAAiB;OACzCZ,iBAAiB,EAAE,IAAI;OACvBC,QAAQ,EAAE;MACV;KACD,CAAC9D,8BAAkB,CAAC0E,QAAQ,GAAG;OAC9BhB,SAAS,EAAEC,wBAAY,CAACgB,YAAY;OACpCd,iBAAiB,EAAE,IAAI;OACvBC,QAAQ,EAAE;;IAEX;GAED,MAAMc,QAAQ,GAAGC,gBAAI,CAACC,MAAM;GAC5B,MAAMC,SAAS,GAAGvB,oBAAoB,CAACN,UAAU,CAAC;GAClD,IAAI,CAAC6B,SAAS,EACd;KACC;;GAGD,IAAIC,QAAQ,GAAGJ,QAAQ;GACvB,IAAIG,SAAS,CAACjB,QAAQ,IAAIV,cAAc,EACxC;KACC4B,QAAQ,IAAK,IAAGD,SAAS,CAACrB,SAAU,IAAGN,cAAe,EAAC;IACvD,MACI,IAAI2B,SAAS,CAAClB,iBAAiB,EACpC;KACCmB,QAAQ,IAAK,IAAGD,SAAS,CAACrB,SAAU,EAAC;;GAGtCuB,QAAQ,CAACC,IAAI,GAAGF,QAAQ;CACzB;CAEA,SAAS/B,YAAY,CAAC;GAAEC,UAAU;GAAEE;CAA6B,CAAC,EAClE;GACC,MAAM+B,aAAa,GAAGC,8BAAa,CAACrD,WAAW,EAAE;GACjD,IAAI,CAACoD,aAAa,CAACE,aAAa,CAACnC,UAAU,CAAC,EAC5C;KACC;;GAGD,IAAIjC,QAAQ,GAAGmC,cAAc;GAE7B,MAAMkC,iBAAiB,GAAGH,aAAa,CAACI,oBAAoB,CAACrC,UAAU,CAAC;GACxE,IAAI,CAACjC,QAAQ,IAAIqE,iBAAiB,EAClC;KACCrE,QAAQ,GAAGqE,iBAAiB;;GAG7B,KAAKH,aAAa,CAACK,SAAS,CAAC;KAAEC,IAAI,EAAEvC,UAAU;KAAEjC;IAAU,CAAC;CAC7D;;;;;;;;"}