this.BX=this.BX||{};this.BX.Messenger=this.BX.Messenger||{};this.BX.Messenger.v2=this.BX.Messenger.v2||{};(function(e,t,o,s,i,n){"use strict";const r={isDesktop(){return n.Type.isObject(window.BXDesktopSystem)},restart(){var e;if(this.getApiVersion()<74){return}(e=BXDesktopSystem)==null?void 0:e.Restart()},shutdown(){var e;(e=BXDesktopSystem)==null?void 0:e.Shutdown()}};const a={mask:{id:"mask",version:72},restart:{id:"restart",version:74},accountManagement:{id:"accountManagement",version:75},openNewTab:{id:"openNewTab",version:76},openPage:{id:"openPage",version:79},portalTabActivation:{id:"portalTabActivation",version:85}};const u={openAddAccountTab(){var e;(e=BXDesktopSystem)==null?void 0:e.AccountAddForm()},deleteAccount(e,t){var o;(o=BXDesktopSystem)==null?void 0:o.AccountDelete(e,t)},connectAccount(e,t,o,s){var i;(i=BXDesktopSystem)==null?void 0:i.AccountConnect(e,t,o,s)},disconnectAccount(e){var t;(t=BXDesktopSystem)==null?void 0:t.AccountDisconnect(e)},getAccountList(){var e;return(e=BXDesktopSystem)==null?void 0:e.AccountList()},getLogin(){return BXDesktopWindow.GetBDiskLogin()},login(){return new Promise((e=>{var t;(t=BXDesktopSystem)==null?void 0:t.Login({success:()=>e()})}))},async logout(){try{var e;await n.ajax.runAction(s.RestMethod.imV2DesktopLogout);(e=BXDesktopSystem)==null?void 0:e.Logout(2)}catch(e){var t;console.error("DesktopApi logout error",e);(t=BXDesktopSystem)==null?void 0:t.Logout(3)}},async terminate(){try{await n.ajax.runAction(s.RestMethod.imV2DesktopLogout)}finally{r.shutdown()}}};const l={getMajorVersion(){if(!this.isDesktop()){return 0}const[e]=window.BXDesktopSystem.GetProperty("versionParts");return e},getApiVersion(){if(!this.isDesktop()){return 0}const[e,t,o,s]=window.BXDesktopSystem.GetProperty("versionParts");return s},getBackendRevision(){const e=BXDesktopSystem.GetBackendRevision(location.hostname,u.getLogin());return Number(e)},setBackendRevision(e){BXDesktopSystem.SetBackendRevision(location.hostname,u.getLogin(),e)},isFeatureEnabled(e){var t;return Boolean((t=window.BXDesktopSystem)==null?void 0:t.FeatureEnabled(e))},isFeatureSupported(e){return this.isFeatureSupportedInVersion(this.getApiVersion(),e)},isFeatureSupportedInVersion(e,t){if(!a[t]){return false}return e>=a[t].version},getWindowsOSBuild(){var e,t;if(!n.Browser.isWin()){return 0}return(e=(t=window.BXDesktopSystem)==null?void 0:t.UserOsBuild())!=null?e:0}};const d={};const c={subscribe(e,t){if(!this.isDesktop()){return}const o=e=>{var o;const s=(o=e.detail)!=null?o:[];t.apply(window,s)};if(!d[e]){d[e]=[]}d[e].push(o);n.Event.bind(window,e,o)},unsubscribe(e,t){if(!n.Type.isFunction(t)){if(!n.Type.isArrayFilled(d[e])){return}d[e].forEach((t=>{n.Event.unbind(window,e,t)}));return}n.Event.unbind(window,e,t)},emit(e,t=[]){const o=opener||top;const s=o.BXWindows;s.forEach((o=>{var s;if(!o||o.name===""){return}o==null?void 0:(s=o.BXDesktopWindow)==null?void 0:s.DispatchCustomEvent(e,t)}));this.emitToMainWindow(e,t)},emitToMainWindow(e,t=[]){var o,s;const i=opener||top;(o=i.BXDesktopSystem)==null?void 0:(s=o.GetMainWindow())==null?void 0:s.DispatchCustomEvent(e,t)}};const p={hideImTab:"bxd_hide_im_tab",smoothing:"bxd_camera_smoothing",smoothing_v2:"bxd_camera_smoothing_v2",sliderBindingsStatus:"sliderBindingsStatus"};const m={getSliderBindingsStatus(){const e=this.getCustomSetting(p.sliderBindingsStatus,"1");return e==="1"},getCameraSmoothingStatus(){return this.getCustomSetting(p.smoothing,"0")==="1"},setCameraSmoothingStatus(e){const t=e===true?"1":"0";if(this.getApiVersion()>76){this.setCustomSetting(p.smoothing_v2,t);return}this.setCustomSetting(p.smoothing,t)},isTwoWindowMode(){var e;return Boolean((e=BXDesktopSystem)==null?void 0:e.IsTwoWindowsMode())},setTwoWindowMode(e){var t;if(e===true){var o;(o=BXDesktopSystem)==null?void 0:o.V10();return}(t=BXDesktopSystem)==null?void 0:t.V8()},getAutostartStatus(){var e;return(e=BXDesktopSystem)==null?void 0:e.GetProperty("autostart")},setAutostartStatus(e){var t;(t=BXDesktopSystem)==null?void 0:t.SetProperty("autostart",e)},setCustomSetting(e,t){var o;(o=BXDesktopSystem)==null?void 0:o.StoreSettings(e,t)},getCustomSetting(e,t){var o;return(o=BXDesktopSystem)==null?void 0:o.QuerySettings(e,t)}};const v={wait(e){return new Promise((t=>{setTimeout(t,e)}))},async handlePortalTabActivation(){const e=await this.hasActivePortalTab();if(e){return Promise.resolve()}this.activatePortalFirstTab();return Promise.resolve()},activatePortalFirstTab(){BXDesktopSystem.ActivateFirstTab()},hasActivePortalTab(){return BXDesktopSystem.HasActiveTab()},async setTabWithChatPageActive(){this.setActiveTabUrl(`${location.origin}${s.Path.online}`);await this.wait(s.WINDOW_ACTIVATION_DELAY)},shouldActivateTabWithChatPage(){const e=this.getTabsList();const t=e.filter((e=>e.url.includes(s.Path.online)));const o=t.some((e=>e.visible));return t.length>0&&!o},getTabsList(){return BXDesktopSystem.BrowserList()},isTwoWindowMode(){var e;return Boolean((e=BXDesktopSystem)==null?void 0:e.IsTwoWindowsMode())},isChatWindow(){const e=n.Extension.getSettings("im.v2.lib.desktop-api");return this.isDesktop()&&e.get("isChatWindow")},isChatTab(){if(this.isChatWindow()){return true}return this.isDesktop()&&location.href.includes("&IM_TAB=Y")},isActiveTab(){return this.isDesktop()&&BXDesktopSystem.IsActiveTab()},setActiveTab(e=window){var t;if(!n.Type.isObject(e)){return}(t=e.BXDesktopSystem)==null?void 0:t.SetActiveTab()},setActiveTabUrl(e){BXDesktopSystem.SetActiveTabUrl(e)},async showBrowserWindow(){BXDesktopWindow.ExecuteCommand("show.main");await this.wait(s.WINDOW_ACTIVATION_DELAY)},showWindow(e=window){var t;if(!n.Type.isObject(e)){return}(t=e.BXDesktopWindow)==null?void 0:t.ExecuteCommand("show")},activateWindow(e=window){this.setActiveTab(e);this.showWindow(e)},hideWindow(e=window){var t;if(!n.Type.isObject(e)){return}(t=e.BXDesktopWindow)==null?void 0:t.ExecuteCommand("hide")},closeWindow(e=window){var t;if(!n.Type.isObject(e)){return}(t=e.BXDesktopWindow)==null?void 0:t.ExecuteCommand("close")},hideLoader(){n.Dom.remove(document.getElementById("bx-desktop-loader"))},reloadWindow(){BXDesktopSystem.Login({})},reloadChatWindow(){var e;(e=BXDesktopSystem)==null?void 0:e.ExecJsInApp(location.hostname,"location.reload()")},findWindow(e=""){const t=opener||top;return t.BXWindows.find((t=>(t==null?void 0:t.name)===e))},openPage(e,o={}){const s=new URL(e);if(s.host!==location.host){setTimeout((()=>this.hideWindow()),100);return Promise.resolve(false)}if(!m.isTwoWindowMode()){if(o.skipNativeBrowser===true){setTimeout((()=>this.hideWindow()),100);return Promise.resolve(false)}t.Utils.browser.openLink(s.href);setTimeout((()=>this.hideWindow()),100);return Promise.resolve(true)}this.createTab(s.href);return Promise.resolve(true)},openInBrowser(e){BXDesktopSystem.OpenInBrowser(e)},createTab(e){const t=n.Dom.create({tag:"a",attrs:{href:e}}).href;BXDesktopSystem.CreateTab(t)},createImTab(e){const t=n.Dom.create({tag:"a",attrs:{href:e}}).href;BXDesktopSystem.CreateImTab(t)},createWindow(e,t){BXDesktopSystem.GetWindow(e,t)},createTopmostWindow(e){return BXDesktopSystem.ExecuteCommand("topmost.show.html",e)},setWindowPosition(e){var t;const o={};Object.entries(e).forEach((([e,t])=>{const s=e[0].toUpperCase()+e.slice(1);o[s]=t}));(t=BXDesktopWindow)==null?void 0:t.SetProperty("position",o)},prepareHtml(e,t){let o="";if(n.Type.isDomNode(e)){o=e.outerHTML}else{o=e}let s="";if(n.Type.isDomNode(t)){s=t.outerHTML}else{s=t}n.Event.ready();if(n.Type.isStringFilled(s)){s=`\n\t\t\t\t<script>\n\t\t\t\t\tBX.ready(() => {\n\t\t\t\t\t\t${s}\n\t\t\t\t\t});\n\t\t\t\t<\/script>\n\t\t\t`}return`${o}${s}`},setWindowSize(e,t){BXDesktopWindow.SetProperty("clientSize",{Width:e,Height:t})},setMinimumWindowSize(e,t){BXDesktopWindow.SetProperty("minClientSize",{Width:e,Height:t})}};const g={setCounter(e,t=false){var o,s;const i=e.toString();(o=BXDesktopSystem)==null?void 0:o.SetIconBadge(i,t);(s=BXDesktopSystem)==null?void 0:s.SetTabBadge(0,i)},setBrowserIconBadge(e){var t;(t=BXDesktopSystem)==null?void 0:t.SetBrowserIconBadge(e.toString())},setIconStatus(e){var t;(t=BXDesktopSystem)==null?void 0:t.SetIconStatus(e)},setOfflineIcon(){var e;(e=BXDesktopSystem)==null?void 0:e.SetIconStatus("offline")},flashIcon(){var e;if(!n.Browser.isWin()){return}(e=BXDesktopSystem)==null?void 0:e.FlashIcon()}};const B={prepareResourcePath(e){let t="";try{const o=new URL(e,location.origin);t=o.href}catch{}return t}};const S={changeTab(e){const t=n.Extension.getSettings("im.v2.lib.desktop-api");const o=t.get("v2");if(o){return}BX.desktop.changeTab(e)}};const h={removeNativeNotifications(){var e;if(this.getApiVersion()<74){return}(e=BXDesktopSystem)==null?void 0:e.NotificationRemoveAll()}};const w={writeToLogFile(e,t){var o;if(!n.Type.isStringFilled(e)){console.error("Desktop logger: filename is not defined");return}let s="";if(n.Type.isString(t)){s=t}else if(n.Type.isNumber(t)){s=t.toString()}else{s=JSON.stringify(t)}(o=BXDesktopSystem)==null?void 0:o.Log(e,s)},printWelcomePrompt(){const e=BXDesktopSystem.GetProperty("versionParts").join(".");let t="unknown";if(n.Browser.isMac()){t="MacOS"}else if(n.Browser.isWin()){t="Windows"}else if(n.Browser.isLinux()){t="Linux"}const s=n.Loc.getMessage("IM_LIB_DESKTOP_API_WELCOME_PROMPT",{"#VERSION#":e,"#OS#":t});o.Logger.desktop(s)},setLogInfo(e){BXDesktopSystem.LogInfo=e}};const k={getCallMask(){if(!this.isDesktop()){return{id:""}}return{id:BXDesktopSystem.QuerySettings("bxd_camera_3dbackground_id")||""}},setCallMaskLoadHandlers(e){this.subscribe("BX3dAvatarReady",e);this.subscribe("BX3dAvatarError",e)},setCallMask(e,t,o){if(this.getApiVersion()<72){return false}if(!e){BXDesktopSystem.Set3dAvatar("","");BXDesktopSystem.StoreSettings("bxd_camera_3dbackground_id","");return true}t=this.prepareResourcePath(t);o=this.prepareResourcePath(o);BXDesktopSystem.Set3dAvatar(t,o);BXDesktopSystem.StoreSettings("bxd_camera_3dbackground_id",e);return true}};const y={isBlur(e){return e.toString().toLowerCase().includes("blur")},getLimitationBackground(e){const t=BX.message("call_features");const o={enable:true};let s="";if(e&&e!=="none"){s=`${this.isBlur(e)?"blur_":""}background`}const i=s?t==null?void 0:t[`call_${s}`]:null;if(!i){return o}return{enable:i.enable,articleCode:i.articleCode}},openArticle(e){const t=BX.UI.InfoHelper;if(t.isOpen()){t.close()}t.show(e)},handleLimitationBackground(e,t){const{enable:o,articleCode:s}=e;if(o&&typeof t==="function"){t()}if(!o&&s){this.openArticle(s)}},getBackgroundImage(){var e;const t=BXDesktopSystem.QuerySettings("bxd_camera_background_id")||"none";if(!this.isDesktop()||!((e=this.getLimitationBackground(t))!=null&&e.enable)){return{id:"none",source:""}}return{id:t}},setCallBackground(e,t){if(t==="none"||t===""){t=""}else if(t==="blur");else if(t==="gaussianBlur"){t="GaussianBlur"}else{t=this.prepareResourcePath(t)}var o=new BX.Promise;const s=this.getLimitationBackground(t);let i="";let n="";this.handleLimitationBackground(s,(()=>{i=t;n=e}));setTimeout((()=>{this.setCallMask(false);BXDesktopSystem.StoreSettings("bxd_camera_background_id",n);BXDesktopSystem.StoreSettings("bxd_camera_background",i);o.resolve(n||"none")}),100);return o}};const D={startDiskSync(){var e;(e=BXFileStorage)==null?void 0:e.SyncPause(false);const t=new i.BaseEvent({compatData:[true]});i.EventEmitter.emit(window,s.EventType.desktop.onSyncPause,t)},stopDiskSync(){var e;(e=BXFileStorage)==null?void 0:e.SyncPause(true);const t=new i.BaseEvent({compatData:[false]});i.EventEmitter.emit(window,s.EventType.desktop.onSyncPause,t)}};const X={openDeveloperTools(){var e;(e=BXDesktopWindow)==null?void 0:e.OpenDeveloperTools()},openLogsFolder(){var e;(e=BXDesktopSystem)==null?void 0:e.OpenLogsFolder()}};const b={isMediaCompressorAvailable(){return this.getApiVersion()>=88&&n.Type.isFunction(window.BXMediaCompressor)},createMediaCompressor(){return new window.BXMediaCompressor}};const f={...r,...B,...l,...c,...v,...g,...h,...m,...S,...y,...k,...w,...u,...D,...X,...b};e.DesktopApi=f;e.DesktopFeature=a;e.DesktopSettingsKey=p})(this.BX.Messenger.v2.Lib=this.BX.Messenger.v2.Lib||{},BX.Messenger.v2.Lib,BX.Messenger.v2.Lib,BX.Messenger.v2.Const,BX.Event,BX);
//# sourceMappingURL=desktop-api.bundle.map.js