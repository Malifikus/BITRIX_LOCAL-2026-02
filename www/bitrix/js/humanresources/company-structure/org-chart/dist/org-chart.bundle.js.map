{"version":3,"file":"org-chart.bundle.js","sources":["../src/consts.js","../src/components/title-panel/add-button/add-button.js","../src/api.js","../src/actions.js","../src/components/title-panel/search/search-bar.js","../src/components/title-panel/burger-menu-button/burger-menu-button.js","../src/components/title-panel/title-panel.js","../../department-content/src/api.js","../src/classes/url-provided-params-service.js","../src/components/tree/tree-node/head-list.js","../src/components/menu/abstract-action-menu.js","../src/components/menu/items/abstract-menu-item.js","../src/components/menu/menu-actions.js","../src/components/menu/items/department/add-department-menu-item.js","../src/components/menu/items/department/edit-department-menu-item.js","../src/components/menu/items/department/remove-department-menu-item.js","../src/components/menu/items/employees/add-employee-menu-item.js","../src/components/menu/items/employees/move-employee-menu-item.js","../src/components/menu/items/employees/user-invite-menu-item.js","../src/components/menu/menu/entity-action-menu.js","../src/components/tree/tree-node/department-menu-button.js","../src/components/tree/tree-node/department-info-icon-button.js","../src/components/tree/tree-node/subdivision-add-button.js","../src/components/tree/tree-node/tree-node.js","../src/components/tree/connectors.js","../src/components/tree/directives/classes/drag-and-drop-controller.js","../src/components/tree/directives/drag-and-drop.js","../src/components/tree/tree.js","../src/components/transfrom-panel.js","../src/components/detail-panel/detail-panel-collapsed-title.js","../src/components/detail-panel/detail-panel-edit-button.js","../src/components/detail-panel/detail-panel.js","../src/components/first-popup/first-popup.js","../src/app.js","../src/components/menu/menu/users-tab-action-menu.js","../src/components/menu/menu/empty-users-tab-action-menu.js","../src/components/menu/items/user-item/fire-user-from-company.js","../src/components/menu/items/user-item/move-from-department.js","../src/components/menu/items/user-item/remove-from-department.js","../src/components/menu/menu/user-list-item-action-menu.js","../src/components/menu/items/chats/open-chat-menu-item.js","../src/components/menu/items/chats/unbund-chat-menu-item.js","../src/components/menu/menu/chat-list-action-menu.js","../src/not-converted-state.js","../src/main.js"],"sourcesContent":["export const events = Object.freeze({\n\tHR_DEPARTMENT_CONNECT: 'hr-department-connect',\n\tHR_DEPARTMENT_DISCONNECT: 'hr-department-disconnect',\n\tHR_DEPARTMENT_ADAPT_SIBLINGS: 'hr-department-adapt-siblings',\n\tHR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT: 'hr-department-adapt-connector-height',\n\tHR_DEPARTMENT_FOCUS: 'hr-department-focus',\n\tHR_DEPARTMENT_CONTROL: 'hr-department-control',\n\tHR_DEPARTMENT_MENU_CLOSE: 'hr-department-menu-close',\n\tHR_ORG_CHART_CLOSE_BY_ESC: 'SidePanel.Slider:onCloseByEsc',\n\tHR_ORG_CHART_CLOSE: 'SidePanel.Slider:onClose',\n\tHR_FIRST_POPUP_SHOW: 'HR.company-structure:first-popup-showed',\n\tHR_DRAG_ENTITY: 'hr-drag-entity',\n\tHR_DROP_ENTITY: 'hr-drop-entity',\n\tHR_ORG_CHART_TRANSFORM_CANVAS: 'hr-org-chart-transform-canvas',\n\tHR_DEPARTMENT_SLIDER_ON_MESSAGE: 'SidePanel.Slider:onMessage',\n\tHR_ORG_CHART_LOCATE_TO_DEPARTMENT: 'hr-org-chart-locate-to-department',\n\tHR_ENTITY_TOGGLE_ELEMENTS: 'hr-entity-toggle-elements',\n\n\tHR_ENTITY_SHOW_WIZARD: 'hr-entity-show-wizard',\n\tHR_ENTITY_REMOVE: 'hr-entity-remove',\n\tHR_PUBLIC_FOCUS_NODE: 'HumanResources.CompanyStructure:focusNode',\n\n\tINTRANET_USER_MINIPROFILE_CLOSE: 'Intranet.User.MiniProfile:close',\n\n\tHR_USER_DRAG_START: 'HumanResources.User:dragStart',\n\tHR_USER_DRAG_MOVE: 'HumanResources.User:dragMove',\n\tHR_USER_DRAG_DROP: 'HumanResources.User:drop',\n\tHR_USER_DRAG_END: 'HumanResources.User:dragEnd',\n\tHR_USER_DRAG_ENTER_NODE: 'HumanResources.User:dragEnterNode',\n\tHR_USER_DRAG_LEAVE_NODE: 'HumanResources.User:dragLeaveNode',\n});\n\nexport const detailPanelWidth = 364;\n","import { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { Main, CRM } from 'ui.icon-set.api.core';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.crm';\n\nconst MenuOption = Object.freeze({\n\taddDepartment: 'add-department',\n\taddEmployee: 'add-employee',\n});\n\n// @vue/component\nexport const AddButton = {\n\tname: 'AddButton',\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\temits: ['addDepartment'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tactionMenu: {\n\t\t\t\tvisible: false,\n\t\t\t},\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tMenuOption(): typeof MenuOption\n\t\t{\n\t\t\treturn MenuOption;\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tif (!permissionChecker)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.dropdownItems = [\n\t\t\t{\n\t\t\t\tid: MenuOption.addDepartment,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_DEPARTMENT_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_DEPARTMENT_DESCR'),\n\t\t\t\tbIcon: {\n\t\t\t\t\tname: Main.CUBE_PLUS,\n\t\t\t\t\tsize: 20,\n\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t},\n\t\t\t\tpermission: {\n\t\t\t\t\taction: PermissionActions.departmentCreate,\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: MenuOption.addEmployee,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_EMPLOYEE_TITLE'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON_MENU_ADD_EMPLOYEE_DESCR'),\n\t\t\t\tbIcon: {\n\t\t\t\t\tname: CRM.PERSON_PLUS_2,\n\t\t\t\t\tsize: 20,\n\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t},\n\t\t\t\tpermission: {\n\t\t\t\t\taction: PermissionActions.employeeAddToDepartment,\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\n\t\tthis.dropdownItems = this.dropdownItems.filter((item) => {\n\t\t\tif (!item.permission)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn permissionChecker.hasPermissionOfAction(item.permission.action);\n\t\t});\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\taddDepartment(): void\n\t\t{\n\t\t\tthis.$emit('addDepartment');\n\t\t},\n\t\tactionMenuItemClickHandler(actionId: string): void\n\t\t{\n\t\t\tif (actionId === MenuOption.addDepartment)\n\t\t\t{\n\t\t\t\tthis.$emit('addDepartment');\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"ui-btn ui-btn-success ui-btn-round ui-btn-sm humanresources-title-panel__add-button\"\n\t\t\tdata-test-id=\"hr-org-chart_title-panel__add-button\"\n\t\t\t@click=\"addDepartment\"\n\t\t>\n\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_ADD_BUTTON') }}\n\t\t</div>\n\t`,\n};\n","import { getData, postData } from 'humanresources.company-structure.api';\nimport { getNodeColorSettings } from 'humanresources.company-structure.utils';\nimport type { TreeItem } from './types';\n\nconst createTreeDataStore = (treeData: Array<TreeItem>): Map<number, TreeItem> => {\n\tconst dataMap = new Map();\n\ttreeData.forEach((item) => {\n\t\tconst { id, parentId, colorName, entityType } = item;\n\t\tconst mapItem = dataMap.get(id) ?? {};\n\t\tconst teamColor = getNodeColorSettings(colorName, entityType);\n\t\tdataMap.set(id, { ...mapItem, ...item, teamColor });\n\t\tif (parentId === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst mapParentItem = dataMap.get(parentId) ?? {};\n\t\tconst children = mapParentItem.children ?? [];\n\t\tdataMap.set(parentId, {\n\t\t\t...mapParentItem,\n\t\t\tchildren: [...children, id],\n\t\t});\n\t});\n\n\treturn dataMap;\n};\n\nexport const chartAPI = {\n\tremoveDepartment: (id: Number): Promise<void> => {\n\t\treturn getData('humanresources.api.Structure.Node.delete', { nodeId: id });\n\t},\n\tgetDepartmentsData: (): Promise<Array<TreeItem>> => {\n\t\treturn getData('humanresources.api.Structure.get', {}, { tool: 'structure', category: 'structure', event: 'open_structure' });\n\t},\n\tgetCurrentDepartments: (): Promise<number[]> => {\n\t\treturn getData('humanresources.api.Structure.Node.current');\n\t},\n\tgetDictionary: (): Promise<Object> => {\n\t\treturn getData('humanresources.api.Structure.dictionary');\n\t},\n\tgetUserId: (): Promise<number> => {\n\t\treturn getData('humanresources.api.User.getCurrentId');\n\t},\n\tfirstTimeOpened: (): Promise<void> => {\n\t\treturn postData('humanresources.api.User.firstTimeOpen');\n\t},\n\tupdateDepartment: (nodeId: number, parentId: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.update', {\n\t\t\tnodeId,\n\t\t\tparentId,\n\t\t\tname: null,\n\t\t});\n\t},\n\tchangeOrder: (draggedId: Number, direction: Number, count: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.changeOrder', {\n\t\t\tnodeId: draggedId,\n\t\t\tdirection,\n\t\t\tcount,\n\t\t});\n\t},\n\tcreateTreeDataStore,\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { memberRoles } from 'humanresources.company-structure.api';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { chartAPI } from './api';\nimport type { TreeItem } from './types';\nimport type { UserData } from 'humanresources.company-structure.utils';\n\nexport const OrgChartActions = {\n\tapplyData: (\n\t\tdepartments: Map<Number, TreeItem>,\n\t\tcurrentDepartments: number[],\n\t\tuserId: number,\n\t\tstructureMap: Array,\n\t\tmultipleUsers,\n\t): void => {\n\t\tconst store = useChartStore();\n\t\tstore.$patch({\n\t\t\tdepartments,\n\t\t\tcurrentDepartments,\n\t\t\tuserId,\n\t\t\tsearchedUserId: userId,\n\t\t\tstructureMap,\n\t\t\tmultipleUsers,\n\t\t});\n\t},\n\tfocusDepartment: (departmentId: number): void => {\n\t\tconst store = useChartStore();\n\t\tstore.focusedNode = departmentId;\n\t},\n\tsearchUserInDepartment: (userId: number): void => {\n\t\tconst store = useChartStore();\n\t\tstore.searchedUserId = userId;\n\t},\n\tmoveSubordinatesToParent: (removableDepartmentId: number): void => {\n\t\tconst store = useChartStore();\n\t\tconst { departments, currentDepartments, structureMap } = store;\n\t\tconst removableDepartment = departments.get(removableDepartmentId);\n\t\tconst {\n\t\t\tparentId,\n\t\t\tentityType,\n\t\t\tchildren: removableDeparmentChildren = [],\n\t\t\tuserCount: removableDepartmentUserCount,\n\t\t\theads: removableDeparmentHeads,\n\t\t\temployees: removableDeparmentEmployees = [],\n\t\t} = removableDepartment;\n\t\tconst parentDepartment = departments.get(parentId);\n\n\t\tremovableDeparmentChildren.forEach((childId) => {\n\t\t\tconst department = departments.get(childId);\n\t\t\tconst mapEntity = structureMap.get(childId);\n\t\t\tmapEntity.parentId = parentId;\n\t\t\tdepartment.parentId = parentId;\n\t\t});\n\t\tif ((removableDepartmentUserCount > 0) && (entityType === EntityTypes.department))\n\t\t{\n\t\t\tconst parentDepartmentUsersIds = new Set([\n\t\t\t\t...parentDepartment.heads,\n\t\t\t\t...(parentDepartment.employees ?? []),\n\t\t\t].map((user) => user.id));\n\t\t\tconst removableDeparmentUsers = [...removableDeparmentHeads, ...removableDeparmentEmployees];\n\t\t\tconst movableUsers = removableDeparmentUsers.filter((user) => {\n\t\t\t\treturn !parentDepartmentUsersIds.has(user.id);\n\t\t\t});\n\t\t\tfor (const user of movableUsers)\n\t\t\t{\n\t\t\t\tuser.role = memberRoles.employee;\n\t\t\t}\n\t\t\tparentDepartment.userCount += movableUsers.length;\n\t\t\tparentDepartment.employees = [\n\t\t\t\t...(parentDepartment.employees ?? []),\n\t\t\t\t...movableUsers,\n\t\t\t];\n\t\t}\n\n\t\tparentDepartment.children = [...parentDepartment.children, ...removableDeparmentChildren];\n\t\tif (currentDepartments.includes(removableDepartmentId) && (entityType === EntityTypes.department))\n\t\t{\n\t\t\tstore.changeCurrentDepartment(removableDepartmentId, parentId);\n\t\t}\n\t},\n\tmarkDepartmentAsRemoved: (removableDepartmentId: number): void => {\n\t\tconst { departments } = useChartStore();\n\t\tconst removableDepartment = departments.get(removableDepartmentId);\n\t\tconst { parentId } = removableDepartment;\n\t\tconst parentDepartment = departments.get(parentId);\n\t\tparentDepartment.children = parentDepartment.children.filter((childId) => {\n\t\t\treturn childId !== removableDepartmentId;\n\t\t});\n\t\tdelete removableDepartment.parentId;\n\t\tdepartments.set(removableDepartmentId, { ...removableDepartment, prevParentId: parentId });\n\t},\n\tremoveDepartment: (departmentId: number): void => {\n\t\tconst { departments, structureMap } = useChartStore();\n\t\tdepartments.delete(departmentId);\n\t\tstructureMap.delete(departmentId);\n\t},\n\tinviteUser: (userData: UserData): void => {\n\t\tconst { nodeId, ...restData } = userData;\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(nodeId);\n\t\tif (department.employees)\n\t\t{\n\t\t\tdepartments.set(nodeId, {\n\t\t\t\t...department,\n\t\t\t\temployees: [...department.employees, { ...restData }],\n\t\t\t\tuserCount: department.userCount + 1,\n\t\t\t});\n\t\t}\n\t},\n\torderDepartments: async (draggedId: number, targetId: number, direction: number, count: number): Promise<boolean> => {\n\t\tconst { departments } = useChartStore();\n\t\tconst department = departments.get(draggedId);\n\t\tconst { parentId } = department;\n\t\tconst parentDepartment = departments.get(parentId);\n\t\tconst { children } = parentDepartment;\n\t\tconst targetIndex = children.indexOf(targetId);\n\t\tconst newChildren = children.filter((childId) => childId !== draggedId);\n\t\tnewChildren.splice(targetIndex, 0, draggedId);\n\t\tdepartments.set(parentId, { ...parentDepartment, children: newChildren });\n\t\ttry\n\t\t{\n\t\t\tawait chartAPI.changeOrder(draggedId, direction, count);\n\n\t\t\treturn true;\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tdepartments.set(parentId, { ...parentDepartment, children });\n\n\t\t\treturn false;\n\t\t}\n\t},\n\tclearNodesChatLists: (nodeIds: Array<Number>): void => {\n\t\tconst { departments } = useChartStore();\n\t\tnodeIds.forEach((nodeId) => {\n\t\t\tconst department = departments.get(nodeId);\n\t\t\tdepartments.set(nodeId, { ...department, chats: null, channels: null });\n\t\t});\n\t},\n};\n","import { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { Event, Dom } from 'main.core';\nimport { type BaseEvent } from 'main.core.events';\nimport { Dialog, type Item } from 'ui.entity-selector';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { mapState } from 'ui.vue3.pinia';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport { OrgChartActions } from '../../../actions';\n\nimport './style.css';\n\n// @vue/component\nexport const SearchBar = {\n\tname: 'search-bar',\n\n\tcomponents: {\n\t\tBIcon,\n\t},\n\n\tdirectives: {\n\t\tfocus: {\n\t\t\tmounted(el)\n\t\t\t{\n\t\t\t\tel.focus();\n\t\t\t},\n\t\t},\n\t},\n\n\temits: [\n\t\t'locate',\n\t],\n\n\tdata(): { canEditPermissions: boolean; showSearchBar: boolean; }\n\t{\n\t\treturn {\n\t\t\tcanEditPermissions: false,\n\t\t\tshowSearchBar: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\t...mapState(useChartStore, ['departments']),\n\t},\n\n\twatch: {\n\t\tdepartments: {\n\t\t\thandler(): void\n\t\t\t{\n\t\t\t\tthis.searchDialog.destroy();\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\n\tcreated()\n\t{\n\t\tthis.searchDialog = this.getSearchDialog();\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tshowSearchbar(): void\n\t\t{\n\t\t\tif (this.showSearchBar)\n\t\t\t{\n\t\t\t\tthis.showSearchBar = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tanalyticsSendData({ tool: 'structure', category: 'structure', event: 'search' });\n\n\t\t\tthis.showSearchBar = true;\n\t\t},\n\t\thideSearchbar(): void\n\t\t{\n\t\t\tthis.showSearchBar = false;\n\t\t},\n\t\tgetSearchDialog(): Dialog\n\t\t{\n\t\t\tconst dialog = new Dialog({\n\t\t\t\twidth: 425,\n\t\t\t\theight: 320,\n\t\t\t\tmultiple: false,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'user',\n\t\t\t\t\t\tsearchFields: [\n\t\t\t\t\t\t\t{ name: 'supertitle', type: 'string', system: true, searchable: true },\n\t\t\t\t\t\t\t{ name: 'position', type: 'string' },\n\t\t\t\t\t\t],\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tintranetUsersOnly: true,\n\t\t\t\t\t\t\temailUsers: false,\n\t\t\t\t\t\t\tinviteEmployeeLink: false,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'structure-node',\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\tselectMode: 'departmentsOnly',\n\t\t\t\t\t\t\tuseMultipleTabs: true,\n\t\t\t\t\t\t\trestricted: 'view',\n\t\t\t\t\t\t\tflatMode: true,\n\t\t\t\t\t\t\tincludedNodeEntityTypes: ['department', 'team'],\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\trecentTabOptions: {\n\t\t\t\t\tid: 'recents',\n\t\t\t\t\tvisible: true,\n\t\t\t\t},\n\t\t\t\tdropdownMode: true,\n\t\t\t\tenableSearch: false,\n\t\t\t\thideOnDeselect: false,\n\t\t\t\tcontext: 'HR_STRUCTURE',\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event: BaseEvent<{ item: Item }>) => {\n\t\t\t\t\t\tconst item = event.getData().item;\n\n\t\t\t\t\t\tif (item.entityType === 'employee')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$emit('locate', item.customData.get('nodeId'));\n\t\t\t\t\t\t\tOrgChartActions.searchUserInDepartment(item.id);\n\t\t\t\t\t\t\tdialog.recentItemsToSave.push(item);\n\t\t\t\t\t\t\tdialog.saveRecentItems();\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdialog.recentItemsToSave.push(item);\n\t\t\t\t\t\tdialog.saveRecentItems();\n\n\t\t\t\t\t\tthis.$emit('locate', item.id);\n\t\t\t\t\t},\n\t\t\t\t\tonLoad: (event) => {\n\t\t\t\t\t\tevent.target.items.get('user')?.forEach((item) => {\n\t\t\t\t\t\t\tif (!item.getSubtitle())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.setSubtitle(item.customData.get('position'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\t'SearchTab:onLoad': (event) => {\n\t\t\t\t\t\tevent.target.items.get('user')?.forEach((item) => {\n\t\t\t\t\t\t\tif (!item.getSubtitle())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\titem.setSubtitle(item.customData.get('position'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tonDestroy: () => {\n\t\t\t\t\t\tthis.searchDialog = this.getSearchDialog();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tconst dialogContainer = dialog.getContainer();\n\t\t\tDom.attr(dialogContainer, 'data-test-id', 'hr-org-chart_title-panel__search-dialog-container');\n\n\t\t\treturn dialog;\n\t\t},\n\n\t\tonEnter(): void\n\t\t{\n\t\t\tif (this.$refs.searchName)\n\t\t\t{\n\t\t\t\tthis.searchDialog.setTargetNode(this.$refs.searchName);\n\t\t\t\tif (!this.searchDialog.isOpen())\n\t\t\t\t{\n\t\t\t\t\tthis.searchDialog.show();\n\t\t\t\t}\n\t\t\t\tEvent.bind(window, 'mousedown', this.handleClickOutside);\n\t\t\t}\n\t\t},\n\t\thandleClickOutside(event): void\n\t\t{\n\t\t\tif (this.$refs.searchName\n\t\t\t\t&& !this.$refs.searchName.parentElement.contains(event.target) && !this.searchDialog.isOpen())\n\t\t\t{\n\t\t\t\tthis.clearSearch();\n\t\t\t\tthis.hideSearchbar();\n\t\t\t\tEvent.unbind(window, 'mousedown', this.handleClickOutside);\n\t\t\t}\n\t\t},\n\t\tsearch(value: string): void\n\t\t{\n\t\t\tif (!this.searchDialog.isOpen())\n\t\t\t{\n\t\t\t\tthis.searchDialog.show();\n\t\t\t}\n\n\t\t\tthis.searchDialog.search(value);\n\t\t},\n\t\tclearSearch()\n\t\t{\n\t\t\tthis.searchDialog.getSearchTab().clearResults();\n\t\t\tthis.searchDialog.selectTab('recents');\n\n\t\t\tif (this.$refs.searchName)\n\t\t\t{\n\t\t\t\tthis.$refs.searchName.value = '';\n\t\t\t\tthis.$refs.searchName.focus();\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t    class=\"humanresources-title-panel-search-bar-container\"\n\t\t    :class=\"{'--opened': showSearchBar}\"\n\t\t>\n\t\t  <div\n\t\t      class=\"humanresources-title-panel-search-bar-block__search\"\n\t\t      @click=\"showSearchbar\"\n\t\t\t\tdata-test-id=\"hr-org-chart_title-panel__search-bar-button\"\n\t\t  >\n\t\t    <BIcon :name=\"set.SEARCH_2\" :size=\"24\" class=\"hr-title-search-icon\"></BIcon>\n\t\t  </div>\n\t\t  <transition name=\"humanresources-title-panel-search-bar-fade\" mode=\"in-out\" @after-enter=\"onEnter\">\n\t\t    <div v-if=\"showSearchBar\"\n\t\t         class=\"humanresources-title-panel-search-bar-block__search-bar\"\n\t\t    >\n\t\t      <input\n\t\t          ref=\"searchName\"\n\t\t          key=\"searchInput\"\n\t\t          type=\"text\"\n\t\t          :placeholder=\"loc('HUMANRESOURCES_SEARCH_PLACEHOLDER_MSGVER_1')\"\n\t\t          v-focus\n\t\t          class=\"humanresources-title-panel-search-bar-block__search-input\"\n\t\t          @click=\"onEnter\"\n\t\t          @input=\"search($event.target.value)\"\n\t\t\t\t\tdata-test-id=\"hr-org-chart_title-panel__search-bar-input\"\n\t\t      >\n\t\t      <div\n\t\t          key=\"searchReset\"\n\t\t          @click=\"clearSearch\"\n\t\t          class=\"humanresources-title-panel-search-bar-block__search-reset\"\n\t\t      >\n\t\t        <div class=\"humanresources-title-panel-search-bar-block__search-cursor\"></div>\n\t\t        <BIcon\n\t\t            :name=\"set.CROSS_CIRCLE_50\"\n\t\t            :size=\"24\"\n\t\t            color=\"#2FC6F6\"\n\t\t        ></BIcon>\n\t\t      </div>\n\t\t    </div>\n\t\t  </transition>\n\t\t</div>\n\t`,\n};\n","import { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { Main } from 'ui.icon-set.api.core';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { sendData as analyticsSendData } from 'ui.analytics';\n\nimport 'ui.icon-set.main';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\n\nconst MenuOption = Object.freeze({\n\taccessRights: 'access-rights',\n\tteamAccessRights: 'team-access-rights',\n});\n\n// @vue/component\nexport const BurgerMenuButton = {\n\tname: 'BurgerMenuButton',\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tactionMenu: {\n\t\t\t\tvisible: false,\n\t\t\t},\n\t\t};\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\tconst id = permissionChecker.hasPermissionOfAction(PermissionActions.accessEdit)\n\t\t\t? MenuOption.accessRights\n\t\t\t: MenuOption.teamAccessRights\n\t\t;\n\n\t\tthis.dropdownItems = [\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_PERMISSION'),\n\t\t\t\tdescription: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIG_PERMISSION_DESCR_MSGVER_2'),\n\t\t\t\tbIcon: {\n\t\t\t\t\tname: Main.PERSONS_2,\n\t\t\t\t\tsize: 20,\n\t\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t\t},\n\t\t\t\tdataTestId: 'hr-org-chart_title-panel__access-rights-button',\n\t\t\t\tpermission: permissionChecker.hasPermissionOfAction(PermissionActions.accessEdit)\n\t\t\t\t\t|| permissionChecker.hasPermissionOfAction(PermissionActions.teamAccessEdit)\n\t\t\t\t,\n\t\t\t},\n\t\t];\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\n\t\tactionMenuItemClickHandler(actionId: string): void\n\t\t{\n\t\t\tanalyticsSendData({ tool: 'structure', category: 'roles', event: 'open_roles' });\n\n\t\t\tif (actionId === MenuOption.accessRights)\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.open('/hr/config/permission/', { usePadding: true });\n\t\t\t}\n\n\t\t\tif (actionId === MenuOption.teamAccessRights)\n\t\t\t{\n\t\t\t\tBX.SidePanel.Instance.open('/hr/config/permission/?category=TEAM', { usePadding: true });\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<span\n\t\t\tref=\"burgerMenuButton\"\n\t\t\t@click=\"actionMenu.visible = true\"\n\t\t\tclass=\"humanresources-title-panel__burger-menu-button\"\n\t\t\tdata-test-id=\"hr-org-chart_title-panel__burger-menu-button\"\n\t\t>\n\t\t\t<svg\n\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\tfill=\"none\"\n\t\t\t\tclass=\"humanresources-title-panel__icon\"\n\t\t\t\t:class=\"{'--selected': actionMenu.visible }\"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M18.7067 15.5577C18.8172 15.5577 18.9067 15.6473 18.9067 15.7577L18.9067 17.2424C18.9067 17.3528 18.8172 17.4424 18.7067 17.4424H5.29375C5.1833 17.4424 5.09375 17.3528 5.09375 17.2424L5.09379 15.7577C5.09379 15.6473 5.18333 15.5577 5.29379 15.5577H18.7067ZM18.7067 11.5577C18.8172 11.5577 18.9067 11.6473 18.9067 11.7577L18.9067 13.2424C18.9067 13.3528 18.8172 13.4424 18.7067 13.4424H5.29375C5.1833 13.4424 5.09375 13.3528 5.09375 13.2424L5.09379 11.7577C5.09379 11.6473 5.18333 11.5577 5.29379 11.5577H18.7067ZM18.7067 7.55774C18.8172 7.55774 18.9067 7.64729 18.9067 7.75774L18.9067 9.24238C18.9067 9.35284 18.8172 9.44238 18.7067 9.44238H5.29375C5.1833 9.44238 5.09375 9.35283 5.09375 9.24237L5.09379 7.75773C5.09379 7.64728 5.18333 7.55774 5.29379 7.55774H18.7067Z\" fill=\"#959ca4\"/>\n\t\t\t</svg>\n\t\t </span>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"actionMenu.visible\"\n\t\t\tid=\"title-panel-burger-menu\"\n\t\t\t:items=\"dropdownItems.filter(item => item.permission)\"\n\t\t\t:bindElement=\"this.$refs.burgerMenuButton\"\n\t\t\t@action=\"actionMenuItemClickHandler($event)\"\n\t\t\t@close=\"this.actionMenu.visible = false\"\n\t\t\tcontainerDataTestId=\"hr-org-chart_title-panel__burger-menu-container\"\n\t\t/>\n\t`,\n\n};\n","import { events } from 'humanresources.company-structure.org-chart';\nimport { EventEmitter } from 'main.core.events';\nimport { AddButton } from './add-button/add-button.js';\nimport { SearchBar } from './search/search-bar.js';\nimport { BurgerMenuButton } from './burger-menu-button/burger-menu-button.js';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { UI } from 'ui.notification';\nimport { Dom } from 'main.core';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { ResponsiveHint } from 'humanresources.company-structure.structure-components';\n\nimport './style.css';\n\nexport const TitlePanel = {\n\tcomponents: {\n\t\tAddButton,\n\t\tBurgerMenuButton,\n\t\tSearchBar,\n\t\tBIcon,\n\t\tSet,\n\t\tResponsiveHint,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcanEditPermissions: false,\n\t\t\tcanAddNode: false,\n\t\t\ttoolbarStarActive: false,\n\t\t\tisHovered: false,\n\t\t\thintKey: 0,\n\t\t};\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.toolbarStarElement = document.getElementById('uiToolbarStar');\n\t},\n\n\tmounted()\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\tthis.canEditPermissions = permissionChecker\n\t\t\t\t&& (permissionChecker.hasPermissionOfAction(PermissionActions.accessEdit)\n\t\t\t\t|| permissionChecker.hasPermissionOfAction(PermissionActions.teamAccessEdit)\n\t\t\t\t);\n\t\t\tthis.canAddNode = permissionChecker\n\t\t\t\t&& (\n\t\t\t\t\tpermissionChecker.hasPermissionOfAction(PermissionActions.departmentCreate)\n\t\t\t\t\t|| permissionChecker.hasPermissionOfAction(PermissionActions.teamCreate)\n\t\t\t\t);\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tconsole.error('Failed to fetch data:', error);\n\t\t}\n\n\t\tconst observer = new MutationObserver(() => {\n\t\t\tconst newState = Dom.hasClass(this.toolbarStarElement, 'ui-toolbar-star-active');\n\t\t\tif (this.toolbarStarActive !== newState)\n\t\t\t{\n\t\t\t\tthis.toolbarStarActive = newState;\n\t\t\t\tthis.hintKey++;\n\t\t\t}\n\t\t});\n\n\t\tobserver.observe(this.toolbarStarElement, { attributes: true, attributeFilter: ['class'] });\n\n\t\tthis.toolbarStarActive = Dom.hasClass(this.toolbarStarElement, 'ui-toolbar-star-active');\n\t},\n\n\tname: 'title-panel',\n\n\temits: ['showWizard'],\n\n\tcomputed: {\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\ttoolbarStarIcon(): string\n\t\t{\n\t\t\tif (this.isAirTemplate)\n\t\t\t{\n\t\t\t\treturn this.set.FAVORITE_0;\n\t\t\t}\n\n\t\t\tif (this.isHovered || this.toolbarStarActive)\n\t\t\t{\n\t\t\t\treturn this.set.FAVORITE_1;\n\t\t\t}\n\n\t\t\treturn this.set.FAVORITE_0;\n\t\t},\n\t\tisAirTemplate(): boolean\n\t\t{\n\t\t\treturn BX.Reflection.getClass('top.BX.Intranet.Bitrix24.Template') !== null;\n\t\t},\n\t\ttoolbarClassIcon(): string\n\t\t{\n\t\t\tif (!this.isAirTemplate)\n\t\t\t{\n\t\t\t\treturn 'humanresources-title-panel__star';\n\t\t\t}\n\n\t\t\treturn this.toolbarStarActive ? 'humanresources-title-panel__unpin' : 'humanresources-title-panel__pin';\n\t\t},\n\t\tstarHintText(): string\n\t\t{\n\t\t\treturn this.toolbarStarActive\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_LEFT_MENU_UN_SAVE_HINT')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_LEFT_MENU_SAVE_HINT')\n\t\t\t;\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\taddDepartment(): void\n\t\t{\n\t\t\tthis.$emit('showWizard', { source: AnalyticsSourceType.HEADER });\n\t\t},\n\t\tonLocate(nodeId: number)\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT, { nodeId });\n\t\t},\n\t\ttriggerFavoriteStar()\n\t\t{\n\t\t\tthis.toolbarStarElement.click();\n\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: this.toolbarStarActive\n\t\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_LEFT_MENU_UN_SAVED')\n\t\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_LEFT_MENU_SAVED'),\n\t\t\t\tautoHideDelay: 2000,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-title-panel\">\n\t\t\t<p class=\"humanresources-title-panel__title\">\n\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_TITLE') }}\n\t\t\t</p>\n\t\t\t<ResponsiveHint v-if=\"!isAirTemplate\" :content=\"starHintText\" :key=\"'hint-air-' + hintKey\">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"toolbarStarIcon\"\n\t\t\t\t\t:size=\"24\"\n\t\t\t\t\tcolor=\"rgba(149, 156, 164, 1)\"\n\t\t\t\t\t:class=\"toolbarClassIcon\"\n\t\t\t\t\t@mouseover=\"isHovered = true\"\n\t\t\t\t\t@mouseleave=\"isHovered = false\" \n\t\t\t\t\t@click=\"triggerFavoriteStar\"\n\t\t\t\t></BIcon>\n\t\t\t</ResponsiveHint>\n\t\t\t<ResponsiveHint v-else :content=\"starHintText\" :key=\"'hint-other-' + hintKey\">\n\t\t\t\t<div \n\t\t\t\t\t:class=\"['ui-icon-set', '--size-sm', toolbarClassIcon]\" \n\t\t\t\t\t@click=\"triggerFavoriteStar\"\n\t\t\t\t></div>\n\t\t\t</ResponsiveHint>\n\t\t\t<AddButton\n\t\t\t\tv-if=\"canAddNode\"\n\t\t\t\t@addDepartment=\"addDepartment\"\n\t\t\t/>\n\t\t\t<div class=\"humanresources-title-panel__icon-buttons\">\n\t\t\t\t<BurgerMenuButton v-if=\"canEditPermissions\"/>\n\t\t\t\t<SearchBar @locate=\"onLocate\"/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { getData, postData } from 'humanresources.company-structure.api';\nimport type { ChatListResponse } from 'humanresources.company-structure.utils';\n\nexport const DepartmentAPI = {\n\tgetPagedEmployees: (id: Number, page: Number, countPerPage: Number) => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.Employee.list', { nodeId: id, page, countPerPage });\n\t},\n\tremoveUserFromDepartment: (nodeId: number, userId: number): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.deleteUser', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t});\n\t},\n\tmoveUserToDepartment: (nodeId: number, userId: number, targetNodeId: number, role: string): Promise<void> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.moveUser', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t\ttargetNodeId,\n\t\t\troleXmlId: role,\n\t\t});\n\t},\n\tisUserInMultipleDepartments: (userId: number): Promise<void> => {\n\t\treturn getData('humanresources.api.User.isUserInMultipleDepartments', {\n\t\t\tuserId,\n\t\t});\n\t},\n\tgetUserInfo: (nodeId: number, userId: number): Promise<void> => {\n\t\treturn getData('humanresources.api.User.getInfoByUserMember', {\n\t\t\tnodeId,\n\t\t\tuserId,\n\t\t});\n\t},\n\tfireUser: (userId: number): Promise<void> => {\n\t\treturn postData('intranet.user.fire', {\n\t\t\tuserId,\n\t\t});\n\t},\n\tfindMemberByQuery: (nodeId: number, query: string): Promise<void> => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.find', {\n\t\t\tnodeId,\n\t\t\tquery,\n\t\t});\n\t},\n\tgetChatsAndChannels: (nodeId: number): Promise<ChatListResponse> => {\n\t\treturn getData('humanresources.api.Structure.Node.Member.Chat.getList', {\n\t\t\tnodeId,\n\t\t});\n\t},\n\tsaveChats: (\n\t\tnodeId: number,\n\t\tids: number[],\n\t\tremoveIds: number[],\n\t\twithChildren: number = 0,\n\t): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Chat.saveChatList', {\n\t\t\tnodeId,\n\t\t\tids,\n\t\t\tremoveIds,\n\t\t\twithChildren,\n\t\t});\n\t},\n\tsaveChannel: (\n\t\tnodeId: number,\n\t\tids: number[],\n\t\tremoveIds: number[],\n\t\twithChildren: number = 0,\n\t): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Chat.saveChannelList', {\n\t\t\tnodeId,\n\t\t\tids,\n\t\t\tremoveIds,\n\t\t\twithChildren,\n\t\t});\n\t},\n\tsaveCollab: (\n\t\tnodeId: number,\n\t\tids: number[],\n\t\tremoveIds: number[],\n\t\twithChildren: number = 0,\n\t): Promise<Array> => {\n\t\treturn postData('humanresources.api.Structure.Node.Member.Chat.saveCollabList', {\n\t\t\tnodeId,\n\t\t\tids,\n\t\t\tremoveIds,\n\t\t\twithChildren,\n\t\t});\n\t},\n};\n","import { Type } from 'main.core';\n\ntype UrlProvidedParamsType = {\n\tfocusNodeId: ?number,\n};\n\nconst UrlParamNames = Object.freeze({\n\tFocusNodeId: 'focusNodeId',\n});\n\nexport class UrlProvidedParamsService\n{\n\tstatic getParams(): UrlProvidedParamsType\n\t{\n\t\tconst paramMap = this.#getParamsFromUrl();\n\n\t\treturn {\n\t\t\tfocusNodeId: this.#castAndValidate(UrlParamNames.FocusNodeId, paramMap.get(UrlParamNames.FocusNodeId)),\n\t\t};\n\t}\n\n\tstatic #getParamsFromUrl(): Map<$Values<typeof UrlParamNames>, string>\n\t{\n\t\tconst paramMap = new Map();\n\n\t\tconst urlSearchParams = new URLSearchParams(document.location.search);\n\t\tObject.values(UrlParamNames).forEach((paramName: string) => {\n\t\t\tconst paramValue = urlSearchParams.get(paramName);\n\t\t\tif (!paramValue)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tparamMap.set(paramName, paramValue);\n\t\t});\n\n\t\treturn paramMap;\n\t}\n\n\tstatic #castAndValidate(paramName: string, value: ?string): string | number | null\n\t{\n\t\tif (Type.isUndefined(value))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet castedValue = value;\n\t\tif (paramName === UrlParamNames.FocusNodeId)\n\t\t{\n\t\t\tcastedValue = Number(value);\n\t\t\tif (!Type.isInteger(castedValue))\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\treturn castedValue;\n\t}\n}\n","import { BIcon, Main } from 'ui.icon-set.api.vue';\nimport { Hint } from 'humanresources.company-structure.structure-components';\nimport { getColorCode, EntityTypes } from 'humanresources.company-structure.utils';\nimport { UserListActionMenu } from 'humanresources.company-structure.structure-components';\nimport { mapState } from 'ui.vue3.pinia';\nimport { events } from '../../../consts';\nimport { EventEmitter } from 'main.core.events';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport type { UserData } from 'humanresources.company-structure.utils';\nimport { Type } from 'main.core';\n\nimport './style.css';\n\n// @vue/component\nexport const HeadList = {\n\tname: 'headList',\n\n\tcomponents: {\n\t\tUserListActionMenu,\n\t\tBIcon,\n\t},\n\n\tdirectives: { hint: Hint },\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: false,\n\t\t\tdefault: 0,\n\t\t},\n\t\titems: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: () => [],\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tcollapsed: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: 'head',\n\t\t},\n\t\tisTeamEntity: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisCollapsed: false,\n\t\t\tisUpdating: true,\n\t\t\theadsVisible: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tdefaultAvatar(): String\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\tdropdownItems(): Array<UserData>\n\t\t{\n\t\t\treturn this.items.map((item: UserData): UserData => {\n\t\t\t\tconst workPosition = this.getPositionText(item);\n\n\t\t\t\treturn { ...item, workPosition };\n\t\t\t});\n\t\t},\n\t\ttitleBar(): string\n\t\t{\n\t\t\treturn this.type === this.userTypes.deputy\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_DEPUTY_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_WIZARD_EMPLOYEE_HEAD_TITLE')\n\t\t\t;\n\t\t},\n\t\tsubordinatesCount(): number\n\t\t{\n\t\t\treturn this.getSubtreeUserCount(this.entityId);\n\t\t},\n\t\tMainIcons: () => Main,\n\t\t...mapState(useChartStore, ['departments', 'multipleUsers']),\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.userTypes = {\n\t\t\thead: 'head',\n\t\t\tdeputy: 'deputy',\n\t\t};\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\thandleUserClick(url: string): void\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(url, {\n\t\t\t\twidth: 1100,\n\t\t\t\tcacheable: false,\n\t\t\t});\n\t\t},\n\t\tcloseHeadList(): void\n\t\t{\n\t\t\tif (this.headsVisible) // to prevent double unsubscription\n\t\t\t{\n\t\t\t\tthis.headsVisible = false;\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeHeadList);\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DRAG_ENTITY, this.closeHeadList);\n\t\t\t}\n\t\t},\n\t\topenHeadList(): void\n\t\t{\n\t\t\tif (!this.headsVisible) // to prevent double subscription\n\t\t\t{\n\t\t\t\tthis.headsVisible = true;\n\t\t\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeHeadList);\n\t\t\t\tEventEmitter.subscribe(events.HR_DRAG_ENTITY, this.closeHeadList);\n\t\t\t}\n\t\t},\n\t\tgetPositionText(item: UserData): string\n\t\t{\n\t\t\treturn item.workPosition || this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_HEAD_POSITION');\n\t\t},\n\t\tgetSubtreeUserCount(rootId: number): number\n\t\t{\n\t\t\tif (!rootId)\n\t\t\t{\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tlet sum = 0;\n\t\t\tconst checkedEntities = new Set();\n\t\t\tconst countedEntities = new Set();\n\t\t\tconst stack = [rootId];\n\n\t\t\twhile (stack.length > 0)\n\t\t\t{\n\t\t\t\tconst id = stack.pop();\n\t\t\t\tif (checkedEntities.has(id))\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tcheckedEntities.add(id);\n\n\t\t\t\tconst entity = this.departments.get(id);\n\t\t\t\tif (!entity)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (entity.entityType === EntityTypes.team)\n\t\t\t\t{\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet count = Number(entity.userCount) || 0;\n\n\t\t\t\t// if we are at the root, we should not count heads that are already displayed\n\t\t\t\tif (id === rootId)\n\t\t\t\t{\n\t\t\t\t\tconst headsAtRoot = this.items.length;\n\t\t\t\t\tcount = Math.max(0, count - headsAtRoot);\n\t\t\t\t}\n\n\t\t\t\tif (count > 0)\n\t\t\t\t{\n\t\t\t\t\tsum += count;\n\t\t\t\t\tcountedEntities.add(String(id));\n\t\t\t\t}\n\n\t\t\t\tif (entity.children?.length > 0)\n\t\t\t\t{\n\t\t\t\t\tfor (const childId of entity.children)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!checkedEntities.has(childId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tstack.push(childId);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet duplicatesToSubtract = 0;\n\n\t\t\tif (this.multipleUsers && countedEntities.size > 0)\n\t\t\t{\n\t\t\t\tconst headUserIds = new Set(\n\t\t\t\t\tthis.items.map((item) => String(item.id)),\n\t\t\t\t);\n\n\t\t\t\t// for each user that is in multiple departments\n\t\t\t\t// check how many of those departments are in the countedEntities set\n\t\t\t\tfor (const [userId, entityIds] of Object.entries(this.multipleUsers))\n\t\t\t\t{\n\t\t\t\t\tif (!Type.isArray(entityIds) || entityIds.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet cnt = 0;\n\t\t\t\t\tfor (const entityId of entityIds)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (countedEntities.has(String(entityId)))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcnt++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// if user is in more than one counted entity, we need to subtract the duplicates\n\t\t\t\t\tif (cnt > 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet duplicatesCount = cnt - 1;\n\t\t\t\t\t\tif (headUserIds.has(String(userId)))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tduplicatesCount = Math.max(0, duplicatesCount - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tduplicatesToSubtract += duplicatesCount;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn Math.max(0, sum - duplicatesToSubtract);\n\t\t},\n\t\tgetEmployeesCountIconColor(): string\n\t\t{\n\t\t\treturn getColorCode('paletteGray70');\n\t\t},\n\t\tgetEmployeesCountIconText(): string\n\t\t{\n\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_ALL_EMPLOYEES_COUNT_HINT_TEXT');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div v-if=\"items.length\">\n\t\t\t<p v-if=\"title\" class=\"humanresources-tree__node_employees-title\">\n\t\t\t\t{{ title }}\n\t\t\t</p>\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-tree__node_head\"\n\t\t\t\t:class=\"{ '--collapsed': collapsed }\"\n\t\t\t\tv-for=\"(item, index) in items.slice(0, 2)\"\n\t\t\t>\n\t\t\t\t<img\n\t\t\t\t\t:src=\"item.avatar ? encodeURI(item.avatar) : defaultAvatar\"\n\t\t\t\t\tclass=\"humanresources-tree__node_avatar --head\"\n\t\t\t\t\t:class=\"{ '--collapsed': collapsed }\"\n\t\t\t\t\t@click.stop=\"handleUserClick(item.url)\"\n\t\t\t\t/>\n\t\t\t\t<div class=\"humanresources-tree__node_head-text\">\n\t\t\t\t\t<div class=\"humanresources-tree__node_head-name-container\">\n\t\t\t\t\t<span\n\t\t\t\t\t\t:bx-tooltip-user-id=\"item.id\"\n\t\t\t\t\t\tbx-tooltip-context=\"b24\"\n\t\t\t\t\t\tclass=\"humanresources-tree__node_head-name\"\n\t\t\t\t\t\t@click.stop=\"handleUserClick(item.url)\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ item.name }}\n\t\t\t\t\t</span>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-if=\"index === 0 && type === userTypes.head && !isTeamEntity\"\n\t\t\t\t\t\t\tv-hint=\"getEmployeesCountIconText()\"\n\t\t\t\t\t\t\tclass=\"humanresources-tree__node_head-subordinates\"\n\t\t\t\t\t\t\t:class=\"{ '--active': headsVisible }\"\n\t\t\t\t\t\t\t:data-test-id=\"'hr-company-structure_org-chart-tree__node-subordinates'\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\t:name=\"MainIcons.PERSONS_2\"\n\t\t\t\t\t\t\t\t:size=\"14\"\n\t\t\t\t\t\t\t\tclass=\"hr-company-structure_org-chart-tree__node-subordinates-icon\"\n\t\t\t\t\t\t\t\t:color=\"getEmployeesCountIconColor()\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<span class=\"hr-company-structure_org-chart-tree__node-subordinates-text\">{{ String(subordinatesCount) }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span v-if=\"!collapsed\" class=\"humanresources-tree__node_head-position\">\n\t\t\t\t\t\t{{ getPositionText(item) }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<span\n\t\t\t\t\tv-if=\"index === 1 && items.length > 2\"\n\t\t\t\t\tclass=\"humanresources-tree__node_head-rest\"\n\t\t\t\t\t:class=\"{ '--active': headsVisible }\"\n\t\t\t\t\t:data-test-id=\"'hr-company-structure_org-chart-tree__node-' + type + '-rest'\"\n\t\t\t\t\tref=\"showMoreHeadList\"\n\t\t\t\t\t@click.stop=\"openHeadList\"\n\t\t\t\t>\n\t\t\t\t\t{{ '+' + String(items.length - 2) }}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<UserListActionMenu\n\t\t\tv-if=\"headsVisible\"\n\t\t\t:id=\"type === userTypes.head ? 'head-list-popup-head' : 'head-list-popup-deputy'\"\n\t\t\t:items=\"dropdownItems\"\n\t\t\t:width=\"228\"\n\t\t\t:bindElement=\"$refs.showMoreHeadList[0]\"\n\t\t\t@close=\"closeHeadList\"\n\t\t\t:titleBar=\"titleBar\"\n\t\t/>\n\t`,\n};\n","import { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { Type } from 'main.core';\n\nexport class AbstractActionMenu\n{\n\tpermissionChecker: PermissionCheckerClass;\n\tentityId: number;\n\tanalyticSource: string;\n\tentityType: string;\n\n\tconstructor(entityId: number)\n\t{\n\t\tthis.permissionChecker = PermissionChecker.getInstance();\n\t\tthis.entityId = entityId;\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tthrow new Error('Must override this function');\n\t}\n\n\tgetFilteredItems(): Array\n\t{\n\t\tif (!this.permissionChecker)\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst items = this.getItems();\n\n\t\treturn items.filter((item) => {\n\t\t\tif (Type.isFunction(item.hasPermission))\n\t\t\t{\n\t\t\t\treturn item.hasPermission(this.permissionChecker, this.entityId);\n\t\t\t}\n\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tonActionMenuItemClick(actionId: string): void\n\t{\n\t\tconst targetItem = this.items.find((item) => item.id === actionId);\n\t\ttargetItem?.invoke({\n\t\t\tentityId: this.entityId,\n\t\t\tanalyticSource: this.analyticSource,\n\t\t\tentityType: this.entityType,\n\t\t});\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\n\ntype BIcon = {\n\tname: string,\n\tsize: number,\n\tcolor: string,\n};\n\nexport class AbstractMenuItem\n{\n\tid: string;\n\ttitle: string;\n\tdescription: string;\n\tbIcon: BIcon;\n\tpermissionAction: string;\n\tdataTestId: string;\n\n\tconstructor({ id, title, description, bIcon, permissionAction, dataTestId })\n\t{\n\t\tthis.id = id;\n\t\tthis.title = title;\n\t\tthis.description = description;\n\t\tthis.bIcon = bIcon;\n\t\tthis.permissionAction = permissionAction;\n\t\tthis.dataTestId = dataTestId;\n\t}\n\n\tinvoke(options: Object): void\n\t{\n\t\tthrow new Error('Must override this function');\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn permissionChecker.hasPermission(this.permissionAction, entityId);\n\t}\n}\n","export const MenuActions = Object.freeze({\n\teditDepartment: 'editDepartment',\n\taddDepartment: 'addDepartment',\n\taddEmployee: 'addEmployee',\n\teditEmployee: 'editEmployee',\n\tremoveDepartment: 'removeDepartment',\n\tmoveEmployee: 'moveEmployee',\n\tuserInvite: 'userInvite',\n\tteamRights: 'teamRights',\n\n\tmoveUserToAnotherDepartment: 'moveUserToAnotherDepartment',\n\tremoveUserFromDepartment: 'removeUserFromDepartment',\n\tfireUserFromCompany: 'fireUserFromCompany',\n\n\topenChat: 'openChat',\n\tunbindChat: 'unbindChat',\n});\n","import {\n\tPermissionActions,\n\tPermissionChecker,\n\tPermissionCheckerClass,\n} from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Main } from 'ui.icon-set.api.core';\nimport { UI } from 'ui.notification';\nimport { events } from '../../../../consts';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class AddDepartmentMenuItem extends AbstractMenuItem\n{\n\tpermissionChecker: PermissionCheckerClass;\n\tentityType: null;\n\n\tconstructor(entityType: string)\n\t{\n\t\tlet title = '';\n\t\tlet description = '';\n\n\t\t// temporary check for option\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\tif (permissionChecker.isTeamsAvailable)\n\t\t{\n\t\t\ttitle = entityType === EntityTypes.team\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_TITLE')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_TITLE_MSGVER_1');\n\n\t\t\tdescription = entityType === EntityTypes.team\n\t\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_SUBTITLE')\n\t\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_SUBTITLE_MSGVER_1');\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttitle = Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_TITLE_NO_TEAM');\n\t\t\tdescription = Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_DEPARTMENT_SUBTITLE_NO_TEAM');\n\t\t}\n\n\t\tsuper({\n\t\t\tid: MenuActions.addDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.CUBE_PLUS,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-company-structure_menu__add-department-item',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t\tthis.permissionChecker = permissionChecker;\n\t\tthis.entityType = entityType;\n\t}\n\n\tinvoke({ entityId, analyticSource, entityType }): void\n\t{\n\t\t// for a team we can create only another team\n\t\tif (entityType === EntityTypes.team)\n\t\t{\n\t\t\tif (!this.permissionChecker.isTeamsAvailable)\n\t\t\t{\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_TEAMS_DISABLED_ERROR_MSGVER_1'),\n\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tEventEmitter.emit(events.HR_ENTITY_SHOW_WIZARD, {\n\t\t\t\tnodeId: entityId,\n\t\t\t\tisEditMode: false,\n\t\t\t\tshowEntitySelector: false,\n\t\t\t\tsource: analyticSource,\n\t\t\t\tentityType,\n\t\t\t});\n\t\t}\n\t\t// for a department we offer to chose entity\n\t\telse\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ENTITY_SHOW_WIZARD, {\n\t\t\t\tnodeId: entityId,\n\t\t\t\tisEditMode: false,\n\t\t\t\tshowEntitySelector: true,\n\t\t\t\tsource: analyticSource,\n\t\t\t\tentityType,\n\t\t\t});\n\t\t}\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn permissionChecker.hasPermission(PermissionActions.teamCreate, entityId);\n\t\t}\n\n\t\treturn permissionChecker.hasPermission(PermissionActions.departmentCreate, entityId)\n\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamCreate, entityId)\n\t\t;\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Main } from 'ui.icon-set.api.core';\nimport { events } from '../../../../consts';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class EditDepartmentMenuItem extends AbstractMenuItem\n{\n\tentityType: null;\n\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_DEPARTMENT_TITLE');\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_TEAM_SUBTITLE_MSGVER_1')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_EDIT_DEPARTMENT_SUBTITLE_MSGVER_1');\n\n\t\tsuper({\n\t\t\tid: MenuActions.editDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.EDIT_PENCIL,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-company-structure_menu__edit-department-item',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t}\n\n\tinvoke({ entityId, analyticSource, refToFocus = 'title' }): void\n\t{\n\t\tEventEmitter.emit(events.HR_ENTITY_SHOW_WIZARD, {\n\t\t\tnodeId: entityId,\n\t\t\tisEditMode: true,\n\t\t\tshowEntitySelector: false,\n\t\t\ttype: 'department',\n\t\t\tentityType: this.entityType,\n\t\t\tsource: analyticSource,\n\t\t\trefToFocus,\n\t\t});\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn permissionChecker.hasPermission(PermissionActions.teamEdit, entityId)\n\t\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamAddMember, entityId)\n\t\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamChatEdit, entityId)\n\t\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamChannelEdit, entityId)\n\t\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamCollabEdit, entityId)\n\t\t\t\t|| permissionChecker.hasPermission(PermissionActions.teamSettingsEdit, entityId)\n\t\t\t;\n\t\t}\n\n\t\treturn permissionChecker.hasPermission(PermissionActions.departmentEdit, entityId)\n\t\t\t|| permissionChecker.hasPermission(PermissionActions.employeeAddToDepartment, entityId)\n\t\t\t|| permissionChecker.hasPermission(PermissionActions.departmentChatEdit, entityId)\n\t\t\t|| permissionChecker.hasPermission(PermissionActions.departmentChannelEdit, entityId)\n\t\t\t|| permissionChecker.hasPermission(PermissionActions.departmentCollabEdit, entityId)\n\t\t;\n\t}\n}\n","import { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Main } from 'ui.icon-set.api.core';\nimport { events } from '../../../../consts';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class RemoveDepartmentMenuItem extends AbstractMenuItem\n{\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_DEPARTMENT_TITLE');\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_TEAM_SUBTITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_REMOVE_DEPARTMENT_SUBTITLE');\n\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamDelete\n\t\t\t: PermissionActions.departmentDelete\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.removeDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.TRASH_BIN,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteRed40'),\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-company-structure_menu__remove-department-item',\n\t\t});\n\t}\n\n\tinvoke({ entityId, entityType }): void\n\t{\n\t\tEventEmitter.emit(events.HR_ENTITY_REMOVE, { nodeId: entityId, entityType });\n\t}\n}\n","import { memberRoles, teamMemberRoles } from 'humanresources.company-structure.api';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { CRM } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\nimport { UserManagementDialog } from 'humanresources.company-structure.user-management-dialog';\n\nexport class AddEmployeeMenuItem extends AbstractMenuItem\n{\n\trole: ?string;\n\n\tconstructor(entityType: string, role: ?string)\n\t{\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamAddMember\n\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.addEmployee,\n\t\t\tbIcon: {\n\t\t\t\tname: CRM.PERSON_PLUS_2,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-company-structure_menu__add-employee-item',\n\t\t});\n\n\t\tthis.localize(entityType, role);\n\t}\n\n\tlocalize(entityType: string, role: ?string): [string, string]\n\t{\n\t\tconst i18nRole = ['head', 'employee'].includes(role) ? role : 'default';\n\t\tconst i18nType = entityType === EntityTypes.team ? 'team' : 'default';\n\n\t\tconst i18nMap = {\n\t\t\thead: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_HEAD_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_HEAD_SUBTITLE'),\n\t\t\t\t\trole: teamMemberRoles.head,\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_HEAD_SUBTITLE'),\n\t\t\t\t\trole: memberRoles.head,\n\t\t\t\t},\n\t\t\t},\n\t\t\temployee: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_TEAM_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: teamMemberRoles.employee,\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_TAB_USERS_MEMBER_ACTION_MENU_ADD_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: memberRoles.employee,\n\t\t\t\t},\n\t\t\t},\n\t\t\tdefault: {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_TEAM_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: null,\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_EMPLOYEE_TITLE'),\n\t\t\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_ADD_EMPLOYEE_SUBTITLE'),\n\t\t\t\t\trole: null,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tthis.title = i18nMap[i18nRole][i18nType].title;\n\t\tthis.description = i18nMap[i18nRole][i18nType].description;\n\t\tthis.role = i18nMap[i18nRole][i18nType].role;\n\t}\n\n\tinvoke({ entityId, entityType }): void\n\t{\n\t\tUserManagementDialog.openDialog({\n\t\t\tnodeId: entityId,\n\t\t\ttype: 'add',\n\t\t\trole: this.role,\n\t\t\tentityType,\n\t\t});\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\nimport { UserManagementDialog } from 'humanresources.company-structure.user-management-dialog';\n\nexport class MoveEmployeeMenuItem extends AbstractMenuItem\n{\n\tconstructor()\n\t{\n\t\tsuper({\n\t\t\tid: MenuActions.moveEmployee,\n\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_MOVE_EMPLOYEE_TITLE'),\n\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_MOVE_EMPLOYEE_SUBTITLE'),\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSON_ARROW_LEFT_1,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: PermissionActions.employeeAddToDepartment,\n\t\t\tdataTestId: 'hr-company-structure_menu__move-employee-item',\n\t\t});\n\t}\n\n\tinvoke({ entityId, analyticSource }): void\n\t{\n\t\tUserManagementDialog.openDialog({\n\t\t\tnodeId: entityId,\n\t\t\ttype: 'move',\n\t\t});\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn permissionChecker.currentUserPermissions.ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT\n\t\t\t&& permissionChecker.hasPermission(this.permissionAction, entityId)\n\t\t;\n\t}\n}\n","import { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class UserInviteMenuItem extends AbstractMenuItem\n{\n\tconstructor()\n\t{\n\t\tsuper({\n\t\t\tid: MenuActions.userInvite,\n\t\t\ttitle: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_USER_INVITE_TITLE'),\n\t\t\tdescription: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_DETAIL_EDIT_MENU_USER_INVITE_SUBTITLE'),\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSON_LETTER,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: PermissionActions.inviteToDepartment,\n\t\t\tdataTestId: 'hr-company-structure_menu__user-invite-item',\n\t\t});\n\t}\n\n\tinvoke({ entityId }): void\n\t{\n\t\tBX.SidePanel.Instance.open(\n\t\t\t'/bitrix/services/main/ajax.php?action=getSliderContent'\n\t\t\t+ '&c=bitrix%3Aintranet.invitation&mode=ajax'\n\t\t\t+ `&departments[]=${Number(entityId)}&firstInvitationBlock=invite-with-group-dp`,\n\t\t\t{ cacheable: false, allowChangeHistory: false, width: 1100 },\n\t\t);\n\t}\n}\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { AddDepartmentMenuItem } from '../items/department/add-department-menu-item';\nimport { EditDepartmentMenuItem } from '../items/department/edit-department-menu-item';\nimport { RemoveDepartmentMenuItem } from '../items/department/remove-department-menu-item';\nimport { AddEmployeeMenuItem } from '../items/employees/add-employee-menu-item';\nimport { MoveEmployeeMenuItem } from '../items/employees/move-employee-menu-item';\nimport { UserInviteMenuItem } from '../items/employees/user-invite-menu-item';\n\nexport class EntityActionMenu extends AbstractActionMenu\n{\n\tconstructor(entityId: number, entityType: string, analyticSource: string)\n\t{\n\t\tsuper(entityId);\n\t\tthis.entityType = entityType;\n\t\tthis.analyticSource = analyticSource;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn [\n\t\t\t\tnew EditDepartmentMenuItem(this.entityType),\n\t\t\t\tnew AddDepartmentMenuItem(this.entityType),\n\t\t\t\tnew AddEmployeeMenuItem(this.entityType),\n\t\t\t\tnew RemoveDepartmentMenuItem(this.entityType),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tnew EditDepartmentMenuItem(this.entityType),\n\t\t\tnew AddDepartmentMenuItem(this.entityType),\n\t\t\tnew AddEmployeeMenuItem(this.entityType),\n\t\t\tnew MoveEmployeeMenuItem(),\n\t\t\tnew UserInviteMenuItem(),\n\t\t\tnew RemoveDepartmentMenuItem(this.entityType),\n\t\t];\n\t}\n}\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { EventEmitter } from 'main.core.events';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport 'ui.icon-set.main';\nimport { events } from '../../../consts';\nimport { EntityActionMenu } from '../../menu/menu/entity-action-menu';\n\n// @vue/component\nexport const DepartmentMenuButton = {\n\tname: 'DepartmentMenuButton',\n\n\tcomponents: {\n\t\tRouteActionMenu,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tmenu(): EntityActionMenu\n\t\t{\n\t\t\treturn new EntityActionMenu(this.entityId, this.entityType, AnalyticsSourceType.CARD);\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.menu.onActionMenuItemClick(actionId);\n\t\t},\n\t\tcloseMenu(): void\n\t\t{\n\t\t\tif (this.menuVisible)\n\t\t\t{\n\t\t\t\tthis.menuVisible = false;\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeMenu);\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DRAG_ENTITY, this.closeMenu);\n\t\t\t}\n\t\t},\n\t\topenMenu(): void\n\t\t{\n\t\t\tif (!this.menuVisible)\n\t\t\t{\n\t\t\t\tthis.menuVisible = true;\n\t\t\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.closeMenu);\n\t\t\t\tEventEmitter.subscribe(events.HR_DRAG_ENTITY, this.closeMenu);\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"menu.items.length\"\n\t\t\tclass=\"ui-icon-set --more humanresources-tree__node_department-menu-button\"\n\t\t\t:class=\"{ '--focused': this.menuVisible }\"\n\t\t\tref=\"departmentMenuButton\"\n\t\t\tdata-test-id=\"tree-node-more-button\"\n\t\t\t@click.stop=\"openMenu\"\n\t\t>\n\t\t</div>\n\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\t:id=\"'tree-node-department-menu-' + entityId\"\n\t\t\t:width=\"302\"\n\t\t\t:items=\"menu.items\"\n\t\t\t:bindElement=\"this.$refs.departmentMenuButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"closeMenu\"\n\t\t/>\n\t`,\n};\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { BasePopup } from 'humanresources.company-structure.structure-components';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { EventEmitter } from 'main.core.events';\nimport type { PopupOptions } from 'main.popup';\nimport { events } from '../../../consts';\nimport { EditDepartmentMenuItem } from '../../menu/items/department/edit-department-menu-item';\n\n// @vue/component\nexport const DepartmentInfoIconButton = {\n\tname: 'DepartmentInfoIconButton',\n\n\tcomponents: {\n\t\tBasePopup,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tcanvasZoom: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tdescription: {\n\t\t\ttype: [String, null],\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tdata(): { showPopup: boolean }\n\t{\n\t\treturn {\n\t\t\tshowPopup: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tpopupConfig(): PopupOptions\n\t\t{\n\t\t\tconst popupWidth = 340;\n\t\t\tconst buttonWidth = 22 * this.canvasZoom;\n\t\t\tconst initialPopupOffset = 41 - this.canvasZoom; // subtract 1px * zoom\n\t\t\tconst angleWidth = 33;\n\n\t\t\treturn {\n\t\t\t\twidth: popupWidth,\n\t\t\t\tbindElement: this.$refs.departmentMenuButton,\n\t\t\t\tbindOptions: { position: 'top' },\n\t\t\t\tborderRadius: '12px',\n\t\t\t\tcontentNoPaddings: true,\n\t\t\t\tcontentPadding: 0,\n\t\t\t\tpadding: 16,\n\t\t\t\toffsetTop: -2 * this.canvasZoom,\n\t\t\t\toffsetLeft: buttonWidth / 2 - popupWidth / 2 + initialPopupOffset,\n\t\t\t\tangleOffset: popupWidth / 2 - angleWidth / 2,\n\t\t\t};\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItem = new EditDepartmentMenuItem(EntityTypes.team);\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tthis.canEdit = this.menuItem.hasPermission(permissionChecker, this.entityId);\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonClose(): void\n\t\t{\n\t\t\tif (this.showPopup)\n\t\t\t{\n\t\t\t\tthis.showPopup = false;\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.onClose);\n\t\t\t\tEventEmitter.unsubscribe(events.HR_DRAG_ENTITY, this.onClose);\n\t\t\t}\n\t\t},\n\t\tonOpen(): void\n\t\t{\n\t\t\tif (!this.showPopup)\n\t\t\t{\n\t\t\t\tthis.showPopup = true;\n\t\t\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_MENU_CLOSE, this.onClose);\n\t\t\t\tEventEmitter.subscribe(events.HR_DRAG_ENTITY, this.onClose);\n\t\t\t}\n\t\t},\n\t\taddDescription(): void\n\t\t{\n\t\t\tthis.onClose();\n\t\t\tthis.menuItem.invoke({\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tanalyticSource: AnalyticsSourceType.CARD,\n\t\t\t\trefToFocus: 'description',\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"canEdit || description\"\n\t\t\tclass=\"ui-icon-set --info-1 humanresources-tree__node_department-menu-button\"\n\t\t\t:class=\"{ '--focused': this.showPopup }\"\n\t\t\tref=\"departmentMenuButton\"\n\t\t\t@click.stop=\"onOpen\"\n\t\t\tdata-test-id=\"tree-node-info-button\"\n\t\t>\n\t\t</div>\n\t\t<BasePopup\n\t\t\tv-if=\"showPopup\"\n\t\t\t:config=\"popupConfig\"\n\t\t\t:id=\"'humanresources-tree__node_info-popup' + entityId\"\n\t\t\t@close=\"onClose\"\n\t\t>\n\t\t\t<div class=\"humanresources-tree__node_info-popup-content_description\" v-if=\"description\">\n\t\t\t\t{{ description }}\n\t\t\t</div>\n\t\t\t<div v-else class=\"humanresources-tree__node_info-popup-content\">\n\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_left\"></div>\n\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_right\">\n\t\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_right_title\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"humanresources-tree__node_info-popup-content_right_text\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_TEXT') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"ui-btn ui-btn-primary ui-btn-round ui-btn-xs ui-btn-no-caps\"\n\t\t\t\t\t\tdata-test-id=\"tree-node-info-popup_add-button\"\n\t\t\t\t\t\t@click=\"addDescription\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_INFO_POPUP_ADD_DESCRIPTION_BUTTON') }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</BasePopup>\n\t`,\n};\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport 'ui.icon-set.main';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { AddDepartmentMenuItem } from '../../menu/items/department/add-department-menu-item';\n\n// @vue/component\nexport const SubdivisionAddButton = {\n\tname: 'SubdivisionAddButton',\n\n\tcomponents: {\n\t\tBIcon,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.menuItem = new AddDepartmentMenuItem(this.entityType);\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\n\t\tthis.canShow = this.menuItem.hasPermission(permissionChecker, this.entityId);\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\taddSubdivision(): void\n\t\t{\n\t\t\tthis.menuItem.invoke({\n\t\t\t\tentityId: this.entityId,\n\t\t\t\tanalyticSource: AnalyticsSourceType.PLUS,\n\t\t\t\tentityType: this.entityType,\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-tree__node_add-subdivision\" v-if=\"canShow\">\n\t\t  <button class=\"humanresources-tree__node_add-button\" @click=\"addSubdivision\">\n\t\t    <BIcon :name=\"set.PLUS_20\" :size=\"32\" class=\"humanresources-tree__node_add-icon\"></BIcon>\n\t\t  </button>\n\t\t</div>\n\t`,\n};\n","import { Dom, Loc } from 'main.core';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { getMemberRoles, type MemberRolesType } from 'humanresources.company-structure.api';\nimport { Hint } from 'humanresources.company-structure.structure-components';\nimport { EventEmitter } from 'main.core.events';\nimport { events } from '../../../consts';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { HeadList } from './head-list';\nimport { DepartmentMenuButton } from './department-menu-button';\nimport { DepartmentInfoIconButton } from './department-info-icon-button';\nimport { SubdivisionAddButton } from './subdivision-add-button';\nimport { PermissionActions, PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport type { MountedDepartment, TreeItem, TreeNodeData } from '../../../types';\nimport './style.css';\n\n// @vue/component\nexport const TreeNode = {\n\tname: 'treeNode',\n\n\tcomponents: {\n\t\tDepartmentMenuButton,\n\t\tHeadList,\n\t\tSubdivisionAddButton,\n\t\tDepartmentInfoIconButton,\n\t},\n\n\tdirectives: { hint: Hint },\n\n\tinject: ['getTreeBounds'],\n\n\tprops: {\n\t\tnodeId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\texpandedNodes: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tcanvasZoom: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tcurrentDepartments: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tisShown: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: true,\n\t\t},\n\t\tuserDropTargetNodeId: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t},\n\t\tisUserDropAllowed: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tisDraggingUser: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\temits: ['calculatePosition'],\n\n\tdata(): TreeNodeData\n\t{\n\t\treturn {\n\t\t\tchildrenOffset: 0,\n\t\t\tchildrenMounted: false,\n\t\t\tshowInfo: true,\n\t\t\tshowDnd: true,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.nodeData.entityType);\n\t\t},\n\t\tnodeData(): TreeItem\n\t\t{\n\t\t\treturn this.departments.get(this.nodeId);\n\t\t},\n\t\tnodeClass(): { [key: string]: boolean; }\n\t\t{\n\t\t\tconst isDragSource = this.isDraggingUser && this.nodeId === this.focusedNode;\n\n\t\t\treturn {\n\t\t\t\t'--expanded': this.expandedNodes.includes(this.nodeId),\n\t\t\t\t'--current-department': this.isCurrentDepartment,\n\t\t\t\t'--focused': this.focusedNode === this.nodeId,\n\t\t\t\t'--with-restricted-access-rights': !this.showInfo,\n\t\t\t\t'--team': this.isTeamEntity,\n\t\t\t\t'--drag-source': isDragSource,\n\t\t\t};\n\t\t},\n\t\tsubdivisionsClass(): { [key: string]: boolean; }\n\t\t{\n\t\t\treturn {\n\t\t\t\t'humanresources-tree__node_arrow': this.hasChildren,\n\t\t\t\t'--up': this.hasChildren && this.isExpanded,\n\t\t\t\t'--down': this.hasChildren && !this.isExpanded,\n\t\t\t\t'--transparent': !this.hasChildren,\n\t\t\t};\n\t\t},\n\t\thasChildren(): boolean\n\t\t{\n\t\t\treturn this.nodeData.children?.length > 0;\n\t\t},\n\t\tisExpanded(): boolean\n\t\t{\n\t\t\treturn this.expandedNodes.includes(this.nodeId);\n\t\t},\n\t\tisCurrentDepartment(): Boolean\n\t\t{\n\t\t\treturn this.currentDepartments.includes(this.nodeId);\n\t\t},\n\t\thead(): ?TreeItem['heads']\n\t\t{\n\t\t\treturn this.nodeData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.head;\n\t\t\t});\n\t\t},\n\t\tdeputy(): ?TreeItem['heads']\n\t\t{\n\t\t\treturn this.nodeData.heads?.filter((head) => {\n\t\t\t\treturn head.role === this.memberRoles.deputyHead;\n\t\t\t});\n\t\t},\n\t\temployeeCount(): number\n\t\t{\n\t\t\treturn this.nodeData.userCount - this.nodeData.heads.length;\n\t\t},\n\t\tchildNodeStyle(): { left: String; }\n\t\t{\n\t\t\treturn { left: `${this.childrenOffset}px` };\n\t\t},\n\t\tshowSubdivisionAddButton(): boolean\n\t\t{\n\t\t\treturn this.expandedNodes.includes(this.nodeId) || this.focusedNode === this.nodeId;\n\t\t},\n\t\tisTeamEntity(): boolean\n\t\t{\n\t\t\treturn this.nodeData.entityType === EntityTypes.team;\n\t\t},\n\t\tnodeDataTitle(): ?string\n\t\t{\n\t\t\tif (!this.isCurrentDepartment)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_CURRENT_TEAM')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_CURRENT_DEPARTMENT');\n\t\t},\n\t\tsubdivisionsText(): string\n\t\t{\n\t\t\tconst wrapCountInHtml = (nodeType: string, pluralString: string, count: number): string => {\n\t\t\t\treturn pluralString.replace(\n\t\t\t\t\tcount.toString(),\n\t\t\t\t\t`<span data-test-id=\"humanresources-tree__node-subdivisions-count --${nodeType}\">${count}</span>`,\n\t\t\t\t);\n\t\t\t};\n\n\t\t\tconst nodeTypeTeam = 'team';\n\t\t\tconst nodeTypeDept = 'dept';\n\n\t\t\tif (this.isTeamEntity)\n\t\t\t{\n\t\t\t\tif (!this.nodeData.children?.length)\n\t\t\t\t{\n\t\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_TEAM_NO_SUBDEPARTMENTS');\n\t\t\t\t}\n\t\t\t\tconst pluralString = this.locPlural('HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT', this.nodeData.children.length);\n\n\t\t\t\treturn wrapCountInHtml(nodeTypeTeam, pluralString, this.nodeData.children.length);\n\t\t\t}\n\n\t\t\tif (!(this.nodeData.children?.length))\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_NO_SUBDEPARTMENTS');\n\t\t\t}\n\n\t\t\tconst childDepartmentsCount = [...this.departments.values()].filter((department) => {\n\t\t\t\treturn department.entityType === EntityTypes.department && this.nodeData.children.includes(department.id);\n\t\t\t}).length;\n\n\t\t\tconst childTeamsCount = [...this.departments.values()].filter((department) => {\n\t\t\t\treturn department.entityType === EntityTypes.team && this.nodeData.children.includes(department.id);\n\t\t\t}).length;\n\n\t\t\tif ((childTeamsCount > 0) && (childDepartmentsCount > 0))\n\t\t\t{\n\t\t\t\tconst deptPlural = this.locPlural('HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT', childDepartmentsCount);\n\t\t\t\tconst teamPlural = this.locPlural('HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT', childTeamsCount);\n\n\t\t\t\tconst deptHtml = wrapCountInHtml(nodeTypeDept, deptPlural, childDepartmentsCount);\n\t\t\t\tconst teamHtml = wrapCountInHtml(nodeTypeTeam, teamPlural, childTeamsCount);\n\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT_WITH_CONJUNCTION', {\n\t\t\t\t\t'#DEPT_COUNT#': deptHtml,\n\t\t\t\t\t'#TEAM_COUNT#': teamHtml,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (childDepartmentsCount > 0)\n\t\t\t{\n\t\t\t\tconst pluralString = this.locPlural('HUMANRESOURCES_COMPANY_DEPARTMENT_CHILDREN_COUNT', childDepartmentsCount);\n\n\t\t\t\treturn wrapCountInHtml(nodeTypeDept, pluralString, childDepartmentsCount);\n\t\t\t}\n\n\t\t\tif (childTeamsCount > 0)\n\t\t\t{\n\t\t\t\tconst pluralString = this.locPlural('HUMANRESOURCES_COMPANY_TEAM_CHILDREN_COUNT', childTeamsCount);\n\n\t\t\t\treturn wrapCountInHtml(nodeTypeTeam, pluralString, childTeamsCount);\n\t\t\t}\n\n\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_NO_SUBDEPARTMENTS');\n\t\t},\n\t\tdeputyTitle(): string\n\t\t{\n\t\t\treturn this.isTeamEntity\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_TEAM_DEPUTY_TITLE')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_DEPUTY_TITLE')\n\t\t\t;\n\t\t},\n\t\tdropOverlayText(): string\n\t\t{\n\t\t\tconst sourceNode = this.departments.get(this.focusedNode);\n\n\t\t\tif (\n\t\t\t\tsourceNode.entityType === EntityTypes.team\n\t\t\t\t&& this.nodeData.entityType === EntityTypes.department\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_MOVED_FORBIDDEN');\n\t\t\t}\n\n\t\t\treturn this.isUserDropAllowed\n\t\t\t\t? this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_MOVED_APPROVED')\n\t\t\t\t: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_MOVED_NO_RIGHTS')\n\t\t\t;\n\t\t},\n\t\tshowOverlay(): boolean\n\t\t{\n\t\t\treturn this.nodeId === this.userDropTargetNodeId && this.nodeId !== this.focusedNode;\n\t\t},\n\t\t...mapState(useChartStore, ['departments', 'focusedNode']),\n\t},\n\n\twatch:\n\t{\n\t\thead(): void\n\t\t{\n\t\t\tthis.adaptHeight();\n\t\t},\n\t\tisShown(): void\n\t\t{\n\t\t\tthis.adaptHeight();\n\t\t},\n\t\tisExpanded:\n\t\t{\n\t\t\thandler(isExpanded: boolean): void\n\t\t\t{\n\t\t\t\tif (isExpanded && !this.childrenMounted)\n\t\t\t\t{\n\t\t\t\t\tthis.childrenMounted = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\timmediate: true,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.width = 278;\n\t\tthis.gap = 24;\n\t\tthis.prevChildrenOffset = 0;\n\t\tthis.prevHeight = 0;\n\t},\n\n\tasync mounted(): Promise<void>\n\t{\n\t\tlet editAction = '';\n\t\tlet viewAction = '';\n\t\tif (this.isTeamEntity)\n\t\t{\n\t\t\tviewAction = PermissionActions.teamView;\n\t\t\teditAction = PermissionActions.teamEdit;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tviewAction = PermissionActions.structureView;\n\t\t\teditAction = PermissionActions.departmentEdit;\n\t\t}\n\n\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\tthis.showInfo = permissionChecker.hasPermission(viewAction, this.nodeId);\n\t\tthis.showDnd =\tpermissionChecker.hasPermission(editAction, this.nodeId)\n\t\t\t&& permissionChecker.hasPermission(editAction, this.nodeData.parentId);\n\n\t\tthis.$emit('calculatePosition', this.nodeId);\n\t\tawait this.$nextTick();\n\t\tthis.prevHeight = this.$el.offsetHeight;\n\t\tEventEmitter.emit(events.HR_DEPARTMENT_CONNECT, {\n\t\t\tid: this.nodeId,\n\t\t\tparentId: this.nodeData.parentId,\n\t\t\thtml: this.$el,\n\t\t\tparentsPath: this.getParentsPath(this.nodeData.parentId),\n\t\t\t...this.calculateNodePoints(),\n\t\t});\n\t},\n\tunmounted(): void\n\t{\n\t\tDom.remove(this.$el);\n\t\tconst { prevParentId } = this.nodeData;\n\t\tif (!prevParentId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.$emit('calculatePosition', this.nodeId);\n\t\tEventEmitter.emit(events.HR_DEPARTMENT_DISCONNECT, {\n\t\t\tid: this.nodeId,\n\t\t\tparentId: prevParentId,\n\t\t});\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonDepartmentClick(targetId: string): void\n\t\t{\n\t\t\tif (!this.showInfo)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_FOCUS, {\n\t\t\t\tnodeId: this.nodeId,\n\t\t\t\tshowEmployees: targetId === 'employees',\n\t\t\t\tsubdivisionsSelected: targetId === 'subdivisions',\n\t\t\t});\n\t\t},\n\t\tcalculatePosition(nodeId: number): void\n\t\t{\n\t\t\tconst node = this.departments.get(this.nodeId);\n\n\t\t\tif (node.children.length === 0)\n\t\t\t{\n\t\t\t\tthis.childrenOffset = 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst gap = this.gap * (node.children.length - 1);\n\t\t\t\tthis.prevChildrenOffset = this.childrenOffset;\n\t\t\t\tthis.childrenOffset = (this.width - (this.width * node.children.length + gap)) / 2;\n\t\t\t}\n\n\t\t\tconst offset = this.childrenOffset - this.prevChildrenOffset;\n\t\t\tif (offset !== 0)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_ADAPT_SIBLINGS, {\n\t\t\t\t\tparentId: this.nodeId,\n\t\t\t\t\tnodeId,\n\t\t\t\t\toffset,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tlocPlural(phraseCode: string, count: number): string\n\t\t{\n\t\t\treturn Loc.getMessagePlural(phraseCode, count, { '#COUNT#': count });\n\t\t},\n\t\tcalculateNodePoints(): { startPoint: MountedDepartment['startPoint'], endPoint: MountedDepartment['endPoint'] }\n\t\t{\n\t\t\tconst { left, top, width } = this.$el.getBoundingClientRect();\n\t\t\tconst { $el: parentNode } = this.$parent.$parent;\n\t\t\tconst {\n\t\t\t\tleft: parentLeft,\n\t\t\t\ttop: parentTop,\n\t\t\t\twidth: parentWidth,\n\t\t\t\theight: parentHeight,\n\t\t\t} = parentNode.getBoundingClientRect();\n\t\t\tconst { x: chartX, y: chartY } = this.getTreeBounds();\n\n\t\t\treturn {\n\t\t\t\tstartPoint: {\n\t\t\t\t\tx: (parentLeft - chartX + parentWidth / 2) / this.canvasZoom,\n\t\t\t\t\ty: (parentTop - chartY + parentHeight) / this.canvasZoom,\n\t\t\t\t},\n\t\t\t\tendPoint: {\n\t\t\t\t\tx: (left - chartX + width / 2) / this.canvasZoom,\n\t\t\t\t\ty: (top - chartY) / this.canvasZoom,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tgetParentsPath(parentId: number): Array<number>\n\t\t{\n\t\t\tlet topLevelId = parentId;\n\t\t\tconst parentsPath = [parentId];\n\t\t\twhile (topLevelId)\n\t\t\t{\n\t\t\t\tconst parentNode = this.departments.get(topLevelId);\n\t\t\t\ttopLevelId = parentNode.parentId;\n\t\t\t\tif (topLevelId)\n\t\t\t\t{\n\t\t\t\t\tparentsPath.push(topLevelId);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn parentsPath;\n\t\t},\n\t\tasync adaptHeight(): Promise<void>\n\t\t{\n\t\t\tif (!this.isShown)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tawait this.$nextTick();\n\t\t\tconst shift = this.$el.offsetHeight - this.prevHeight;\n\t\t\tif (shift !== 0)\n\t\t\t{\n\t\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT, {\n\t\t\t\t\tnodeId: this.nodeId,\n\t\t\t\t\tshift,\n\t\t\t\t});\n\t\t\t\tthis.prevHeight = this.$el.offsetHeight;\n\t\t\t}\n\t\t},\n\t\tonDragMouseEnter(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_USER_DRAG_ENTER_NODE, { nodeId: this.nodeId });\n\t\t},\n\n\t\tonDragMouseLeave(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_USER_DRAG_LEAVE_NODE, { nodeId: this.nodeId });\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\t:data-id=\"nodeId\"\n\t\t\t:class=\"nodeClass\"\n\t\t\t:data-title=\"nodeDataTitle\"\n\t\t\tclass=\"humanresources-tree__node\"\n\t\t\t:style=\"{\n\t\t\t\t'--team-bubble-background': nodeData.teamColor?.bubbleBackground,\n\t\t\t\t'--team-focused-border-color': nodeData.teamColor?.focusedBorderColor,\n\t\t\t\t'--node-expanded-color': nodeData.teamColor?.expandedBorderColor,\n\t\t\t}\"\n\t\t>\n\t\t\t<div v-if=\"showOverlay\"\n\t\t\t\tclass=\"humanresources-tree__node_drop-overlay\"\n\t\t\t>\n\t\t\t\t<div class=\"ui-icon-set\"\n\t\t\t\t\t :class=\"{\n\t\t\t\t\t'--circle-plus': isUserDropAllowed,\n\t\t\t\t\t'--cross-circle-50': !isUserDropAllowed\n\t\t\t\t}\"\n\t\t\t\t></div>\n\t\t\t\t<div class=\"humanresources-tree__node_drop-overlay-text\">\n\t\t\t\t\t{{ dropOverlayText }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-tree__node_summary\"\n\t\t\t\t@click.stop=\"onDepartmentClick('department')\"\n\t\t\t\t@mouseenter=\"onDragMouseEnter\"\n\t\t\t\t@mouseleave=\"onDragMouseLeave\"\n\t\t\t>\n\t\t\t\t<template v-if=\"showInfo\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"humanresources-tree__node_department\"\n\t\t\t\t\t\t:style=\"{ 'background-color': nodeData.teamColor?.treeHeadBackground}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"humanresources-tree__node_department-title\">\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tv-if=\"nodeData.parentId !== 0 && showDnd\"\n\t\t\t\t\t\t\t\tclass=\"humanresources-tree__node_dnd-icon ui-icon-set --more-points\"\n\t\t\t\t\t\t\t\t:class=\"{ '--team': isTeamEntity }\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tv-hint\n\t\t\t\t\t\t\t\tclass=\"humanresources-tree__node_department-title_text\"\n\t\t\t\t\t\t\t\t:class=\"{ '--no-dnd': !showDnd }\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{{nodeData.name}}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"humanresources-tree__node_department-menu-icons\">\n\t\t\t\t\t\t\t<DepartmentInfoIconButton\n\t\t\t\t\t\t\t\tv-if=\"isTeamEntity\"\n\t\t\t\t\t\t\t\t:description=\"nodeData.description\"\n\t\t\t\t\t\t\t\t:entityId=\"nodeId\"\n\t\t\t\t\t\t\t\t:canvasZoom=\"canvasZoom\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<DepartmentMenuButton\n\t\t\t\t\t\t\t\tv-if=\"head && deputy\"\n\t\t\t\t\t\t\t\t:entityId=\"nodeId\"\n\t\t\t\t\t\t\t\t:entityType=\"nodeData.entityType\"\n\t\t\t\t\t\t\t></DepartmentMenuButton>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"humanresources-tree__node_description\">\n\t\t\t\t\t\t<HeadList v-if=\"head\"\n\t\t\t\t\t\t\t\t:entityId=\"nodeId\"\n\t\t\t\t\t\t\t\t:items=\"head\"\n\t\t\t\t\t\t\t\t:isTeamEntity=\"isTeamEntity\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"humanresources-tree__node_load-skeleton --heads\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t\t<div v-if=\"deputy\" class=\"humanresources-tree__node_employees\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p class=\"humanresources-tree__node_employees-title\">\n\t\t\t\t\t\t\t\t\t{{\n\t\t\t\t\t\t\t\t\t\tisTeamEntity\n\t\t\t\t\t\t\t\t\t\t\t? loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_TEAM_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t\t\t\t: loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_EMPLOYEES_TITLE')\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass=\"humanresources-tree__node_employees-count\"\n\t\t\t\t\t\t\t\t\t@click.stop=\"onDepartmentClick('employees')\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{{locPlural('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_EMPLOYEES_COUNT', employeeCount)}}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div v-if=\"!deputy.length\"></div>\n\t\t\t\t\t\t\t<HeadList\n\t\t\t\t\t\t\t\t:items=\"deputy\"\n\t\t\t\t\t\t\t\t:title=\"deputyTitle\"\n\t\t\t\t\t\t\t\t:collapsed=\"true\"\n\t\t\t\t\t\t\t\t:type=\"'deputy'\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</HeadList>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-else\n\t\t\t\t\t\t\tclass=\"humanresources-tree__node_load-skeleton --deputies\"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"humanresources-tree__node_subdivisions\"\n\t\t\t\t\t\t:class=\"subdivisionsClass\"\n\t\t\t\t\t\t@click.stop=\"onDepartmentClick('subdivisions')\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span v-html=\"subdivisionsText\"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t\t<svg v-else width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" class=\"humanresources-tree__node_lock\">\n\t\t\t\t\t<path d=\"M12.0646 4.231C13.9529 4.231 15.4836 5.76968 15.4836 7.66775V10.5612H17.2905V7.66775C17.2905 4.76657 14.9507 2.41476 12.0645 2.41476C9.17827 2.41476 6.83847 4.76657 6.83847 7.66775V10.5612H8.64544V7.66775C8.64544 5.76968 10.1762 4.231 12.0646 4.231Z\" fill=\"#D5D7DB\"/>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.14721 10.3237C6.12854 10.3237 5.30273 11.1495 5.30273 12.1682V18.506C5.30273 19.5246 6.12854 20.3504 7.14722 20.3504H17.1029C18.1216 20.3504 18.9474 19.5246 18.9474 18.506V12.1682C18.9474 11.1495 18.1216 10.3237 17.1029 10.3237H7.14721ZM12.9216 15.5869C12.9216 15.5685 12.93 15.5512 12.944 15.5392C13.2142 15.3085 13.3859 14.9643 13.3859 14.5797C13.3859 13.8847 12.8259 13.3214 12.1353 13.3214C11.4446 13.3214 10.8846 13.8847 10.8846 14.5797C10.8846 14.9643 11.0563 15.3085 11.3266 15.5392C11.3406 15.5512 11.3489 15.5685 11.3489 15.5869V16.7572C11.3489 17.1915 11.701 17.5435 12.1353 17.5435C12.5696 17.5435 12.9216 17.1915 12.9216 16.7572V15.5869Z\" fill=\"#D5D7DB\"/>\n\t\t\t\t</svg>\n\t\t\t\t<SubdivisionAddButton\n\t\t\t\t\tv-if=\"showSubdivisionAddButton\"\n\t\t\t\t\t:entityId=\"nodeId\"\n\t\t\t\t\t:entityType=\"nodeData.entityType\"\n\t\t\t\t\t@click.stop\n\t\t\t\t></SubdivisionAddButton>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"nodeData.parentId === 0 && !hasChildren\"\n\t\t\t\tclass=\"humanresources-tree__node_empty-skeleton\"\n\t\t\t></div>\n\t\t\t<div\n\t\t\t\tv-if=\"hasChildren\"\n\t\t\t\tref=\"childrenNode\"\n\t\t\t\tclass=\"humanresources-tree__node_children\"\n\t\t\t\t:style=\"childNodeStyle\"\n\t\t\t>\n\t\t\t\t<TransitionGroup>\n\t\t\t\t\t<treeNode\n\t\t\t\t\t\tv-for=\"id in nodeData.children\"\n\t\t\t\t\t\tv-if=\"isExpanded || childrenMounted\"\n\t\t\t\t\t\tv-show=\"isExpanded\"\n\t\t\t\t\t\t:ref=\"'node-' + id\"\n\t\t\t\t\t\t:key=\"id\"\n\t\t\t\t\t\t:nodeId=\"id\"\n\t\t\t\t\t\t:expandedNodes=\"expandedNodes\"\n\t\t\t\t\t\t:canvasZoom=\"canvasZoom\"\n\t\t\t\t\t\t:currentDepartments=\"currentDepartments\"\n\t\t\t\t\t\t:isShown=\"isExpanded\"\n\t\t\t\t\t\t@calculatePosition=\"calculatePosition\"\n\t\t\t\t\t\t:userDropTargetNodeId=\"userDropTargetNodeId\"\n\t\t\t\t\t\t:isUserDropAllowed=\"isUserDropAllowed\"\n\t\t\t\t\t\t:isDraggingUser=\"isDraggingUser\"\n\t\t\t\t\t/>\n\t\t\t\t</TransitionGroup>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Event } from 'main.core';\nimport { mapState } from 'ui.vue3.pinia';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { events } from '../../consts';\nimport type { ConnectorsData, MountedDepartment } from '../../types';\n\n// @vue/component\nexport const Connectors = {\n\tname: 'companyTreeConnectors',\n\n\texpose: [\n\t\t'toggleConnectorsVisibility',\n\t\t'toggleConnectorHighlighting',\n\t\t'toggleAllConnectorsVisibility',\n\t\t'adaptConnectorsAfterReorder',\n\t],\n\n\tprops: {\n\t\tisLocatedDepartmentVisible: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type Map */\n\t\ttreeNodes: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): { connectors: Record<string, ConnectorsData> }\n\t{\n\t\treturn { connectors: {} };\n\t},\n\n\tcomputed:\n\t{\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.subscribeOnEvents();\n\t\tthis.prevWindowWidth = window.innerWidth;\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.unsubscribeFromEvents();\n\t},\n\n\tmethods:\n\t{\n\t\tonAddConnector({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { id, parentId } = data;\n\t\t\tif (!parentId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst connector = this.connectors[`${parentId}-${id}`] ?? {};\n\t\t\tObject.assign(connector, data);\n\t\t\tif (connector.highlighted)\n\t\t\t{\n\t\t\t\tdelete this.connectors[`${parentId}-${id}`];\n\t\t\t}\n\n\t\t\tthis.connectors[`${parentId}-${id}`] = {\n\t\t\t\tshow: true,\n\t\t\t\thighlighted: false,\n\t\t\t\t...connector,\n\t\t\t};\n\t\t},\n\t\tonRemoveConnector({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { parentId, id } = data;\n\t\t\tdelete this.connectors[`${parentId}-${id}`];\n\t\t},\n\t\tonAdaptSiblingConnectors({ data }: { nodeId: number; parentId: number; offset: number; }): void\n\t\t{\n\t\t\tconst { nodeId, parentId, offset } = data;\n\t\t\tconst parentDepartment = this.departments.get(parentId);\n\t\t\tconst isMounted = parentDepartment.children.includes(nodeId);\n\t\t\tconst values = Object.values(this.connectors);\n\t\t\tconst parsedSiblingConnectors = values.reduce((acc, connector) => {\n\t\t\t\tconst { endPoint: currentEndPoint, id: currentId, parentId: currentParentId } = connector;\n\t\t\t\tif (!currentId || currentParentId !== parentId || currentId === nodeId)\n\t\t\t\t{\n\t\t\t\t\treturn acc;\n\t\t\t\t}\n\n\t\t\t\tlet sign = 0;\n\t\t\t\tif (isMounted)\n\t\t\t\t{\n\t\t\t\t\tsign = parentDepartment.children.indexOf(nodeId)\n\t\t\t\t\t\t> parentDepartment.children.indexOf(currentId) ? 1 : -1;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst { endPoint } = this.connectors[`${parentId}-${nodeId}`];\n\t\t\t\t\tsign = endPoint.x > currentEndPoint.x ? 1 : -1;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\t...acc,\n\t\t\t\t\t[currentId]: sign,\n\t\t\t\t};\n\t\t\t}, {});\n\t\t\tvalues.forEach((connector) => {\n\t\t\t\tconst {\n\t\t\t\t\tid: currentId,\n\t\t\t\t\tparentId: currentParentId,\n\t\t\t\t\tparentsPath,\n\t\t\t\t\tendPoint: currentEndPoint,\n\t\t\t\t\tstartPoint: currentStartPoint,\n\t\t\t\t} = connector;\n\t\t\t\tif (!currentId || currentId === nodeId)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (currentParentId === parentId)\n\t\t\t\t{\n\t\t\t\t\tconst { x } = currentEndPoint;\n\t\t\t\t\tconst sign = parsedSiblingConnectors[currentId];\n\t\t\t\t\tObject.assign(currentEndPoint, { x: x + offset * sign });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst ancestorId = parentsPath?.find((id) => {\n\t\t\t\t\treturn Boolean(parsedSiblingConnectors[id]);\n\t\t\t\t});\n\t\t\t\tif (ancestorId)\n\t\t\t\t{\n\t\t\t\t\tconst ancestorSign = parsedSiblingConnectors[ancestorId];\n\t\t\t\t\tObject.assign(currentStartPoint, { x: currentStartPoint.x + offset * ancestorSign });\n\t\t\t\t\tObject.assign(currentEndPoint, { x: currentEndPoint.x + offset * ancestorSign });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tadaptConnectorsAfterReorder(ids: number[], shift: Number, isRoot: boolean): void\n\t\t{\n\t\t\tids.forEach((departmentId) => {\n\t\t\t\tconst { parentId, children } = this.departments.get(departmentId);\n\t\t\t\tconst connector = this.connectors[`${parentId}-${departmentId}`];\n\t\t\t\tif (!connector)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tObject.assign(connector.endPoint, { x: connector.endPoint.x + shift });\n\t\t\t\tif (!isRoot)\n\t\t\t\t{\n\t\t\t\t\tObject.assign(connector.startPoint, { x: connector.startPoint.x + shift });\n\t\t\t\t}\n\n\t\t\t\tif (children?.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.adaptConnectorsAfterReorder(children, shift, false);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tonAdaptConnectorHeight({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { shift, nodeId } = data;\n\t\t\tObject.values(this.connectors).forEach((connector) => {\n\t\t\t\tif (connector.parentId === nodeId)\n\t\t\t\t{\n\t\t\t\t\tObject.assign(connector.startPoint, { y: connector.startPoint.y + shift });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\ttoggleConnectorsVisibility(parentId: number, show: boolean): void\n\t\t{\n\t\t\tconst { children } = this.departments.get(parentId);\n\t\t\tchildren.forEach((childId) => {\n\t\t\t\tconst connector = this.connectors[`${parentId}-${childId}`] ?? {};\n\t\t\t\tthis.connectors = {\n\t\t\t\t\t...this.connectors,\n\t\t\t\t\t[`${parentId}-${childId}`]: { ...connector, show },\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t\ttoggleAllConnectorsVisibility(shouldShow: boolean, expandedNodes: number[]): void\n\t\t{\n\t\t\tObject.keys(this.connectors).forEach((key) => {\n\t\t\t\tconst connector = this.connectors[key];\n\t\t\t\tif (!shouldShow || (expandedNodes.includes(connector.parentId) && shouldShow))\n\t\t\t\t{\n\t\t\t\t\tconnector.show = shouldShow;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\ttoggleConnectorHighlighting(nodeId: number, expanded: boolean): void\n\t\t{\n\t\t\tconst { parentId } = this.departments.get(nodeId);\n\t\t\tif (!parentId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!expanded)\n\t\t\t{\n\t\t\t\tthis.connectors[`${parentId}-${nodeId}`] = {\n\t\t\t\t\t...this.connectors[`${parentId}-${nodeId}`],\n\t\t\t\t\thighlighted: false,\n\t\t\t\t};\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst highlightedConnector = this.connectors[`${parentId}-${nodeId}`] ?? {};\n\t\t\tdelete this.connectors[`${parentId}-${nodeId}`];\n\t\t\tthis.connectors = {\n\t\t\t\t...this.connectors,\n\t\t\t\t[`${parentId}-${nodeId}`]: {\n\t\t\t\t\t...highlightedConnector,\n\t\t\t\t\thighlighted: true,\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\t\tgetPath(id: string): string\n\t\t{\n\t\t\tconst connector = this.connectors[id];\n\t\t\tconst { startPoint, endPoint, parentId } = connector;\n\n\t\t\tif (!startPoint || !endPoint)\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tlet verticalLineHeight = 115;\n\t\t\tconst parentNode = this.treeNodes.get(parentId);\n\t\t\tconst parentNodeStyle = getComputedStyle(parentNode);\n\t\t\tconst minDepartmentHeight = parseInt(parentNodeStyle.getPropertyValue('--min-height'), 10);\n\t\t\tconst diffHeight = parentNode.offsetHeight - minDepartmentHeight;\n\t\t\tverticalLineHeight = diffHeight > 0 ? verticalLineHeight - diffHeight : verticalLineHeight;\n\t\t\tconst shiftY = 1;\n\n\t\t\tconst startY = startPoint.y - shiftY;\n\t\t\tconst shadowOffset = this.focusedNode === connector.id ? 12 : 0;\n\t\t\tconst rounded = { start: '', end: '' };\n\t\t\tlet arcRadius = 0;\n\n\t\t\tif (Math.round(startPoint.x) > Math.round(endPoint.x))\n\t\t\t{\n\t\t\t\tarcRadius = 15;\n\t\t\t\trounded.start = 'a15,15 0 0 1 -15,15';\n\t\t\t\trounded.end = 'a15,15 0 0 0 -15,15';\n\t\t\t}\n\t\t\telse if (Math.round(startPoint.x) < Math.round(endPoint.x))\n\t\t\t{\n\t\t\t\tarcRadius = -15;\n\t\t\t\trounded.start = 'a15,15 0 0 0 15,15';\n\t\t\t\trounded.end = 'a15,15 0 0 1 15,15';\n\t\t\t}\n\n\t\t\tconst adjustedEndY = endPoint.y - shadowOffset;\n\n\t\t\treturn [\n\t\t\t\t`M${startPoint.x} ${startY}`,\n\t\t\t\t`V${startY + verticalLineHeight}`,\n\t\t\t\t`${String(rounded.start)}`,\n\t\t\t\t`H${endPoint.x + arcRadius}`,\n\t\t\t\t`${String(rounded.end)}`,\n\t\t\t\t`V${adjustedEndY}`,\n\t\t\t].join('');\n\t\t},\n\t\tsubscribeOnEvents(): void\n\t\t{\n\t\t\tthis.events = {\n\t\t\t\t[events.HR_DEPARTMENT_CONNECT]: this.onAddConnector,\n\t\t\t\t[events.HR_DEPARTMENT_DISCONNECT]: this.onRemoveConnector,\n\t\t\t\t[events.HR_DEPARTMENT_ADAPT_SIBLINGS]: this.onAdaptSiblingConnectors,\n\t\t\t\t[events.HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT]: this.onAdaptConnectorHeight,\n\t\t\t};\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.subscribe(event, handle);\n\t\t\t});\n\t\t\tEvent.bind(window, 'resize', this.onResizeWindow);\n\t\t},\n\t\tunsubscribeFromEvents(): void\n\t\t{\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.unsubscribe(event, handle);\n\t\t\t});\n\t\t\tEvent.unbind(window, 'resize', this.onResizeWindow);\n\t\t},\n\t\tonResizeWindow(): void\n\t\t{\n\t\t\tconst offset = (window.innerWidth - this.prevWindowWidth) / 2;\n\t\t\tthis.prevWindowWidth = window.innerWidth;\n\t\t\tif (offset === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tObject.keys(this.connectors).forEach((key) => {\n\t\t\t\tconst connector = this.connectors[key];\n\t\t\t\tif (connector.startPoint && connector.endPoint)\n\t\t\t\t{\n\t\t\t\t\tconst startPointX = connector.startPoint.x;\n\t\t\t\t\tconst endPointX = connector.endPoint.x;\n\t\t\t\t\tObject.assign(connector.startPoint, { x: startPointX + offset });\n\t\t\t\t\tObject.assign(connector.endPoint, { x: endPointX + offset });\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<svg class=\"humanresources-tree__connectors\" fill=\"none\">\n\t\t\t<marker\n\t\t\t\tid='arrow'\n\t\t\t\tmarkerUnits='userSpaceOnUse'\n\t\t\t\tmarkerWidth='20'\n\t\t\t\tmarkerHeight='12'\n\t\t\t\trefX='10'\n\t\t\t\trefY='10.5'\n\t\t\t>\n\t\t\t\t<path d=\"M1 1L10 10L19 1\" class=\"--highlighted\" />\n\t\t\t</marker>\n\t\t\t<path\n\t\t\t\tv-for=\"(connector, id) in connectors\"\n\t\t\t\tv-show=\"connector.show\"\n\t\t\t\t:ref=\"id\"\n\t\t\t\t:marker-end=\"connector.highlighted ? 'url(#arrow)' : null\"\n\t\t\t\t:class=\"{ '--highlighted': connector.highlighted }\"\n\t\t\t\t:id=\"id\"\n\t\t\t\t:d=\"getPath(id)\"\n\t\t\t></path>\n\t\t</svg>\n\t`,\n};\n","import { Event, Dom, Tag, Loc } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { events } from '../../../../consts';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\n\nconst FULL_WIDTH = 302;\nconst CANVAS_MOVE_SPEED = 15;\n\nexport class TreeNodeDragController\n{\n\t#prevAffectedItems: HTMLElement[];\n\t#targetData: { targetItem: HTMLElement; insertion: string; };\n\t#transform: { x: number; y: number; prevX: number; prevY: number; };\n\t#tree: HTMLElement;\n\t#draggedItem: HTMLElement;\n\t#ghost: HTMLElement;\n\t#positionPointer: HTMLElement;\n\t#zoom: number;\n\t#canvas: { x: number; y: number; };\n\t#prevPageX: number = 0;\n\t#prevPageY: number = 0;\n\t#targetTeams: HTMLElement[];\n\t#permissionChecker: PermissionChecker;\n\t#draggedEntityType: string;\n\t#mouseMoveHandler: (event: MouseEvent) => void;\n\t#mouseUpHandler: (event: MouseEvent) => void;\n\t#mouseWheelHandler: (event: MouseEvent) => void;\n\n\tconstructor(el: HTMLElement)\n\t{\n\t\tEvent.bind(el, 'mousedown', (event: MouseEvent) => {\n\t\t\tthis.#onMouseDown(event);\n\t\t});\n\t\tthis.#mouseMoveHandler = (event: MouseEvent) => {\n\t\t\tthis.#onMouseMove(event);\n\t\t};\n\n\t\tthis.#mouseUpHandler = (event: MouseEvent) => {\n\t\t\tthis.#onMouseUp(event);\n\t\t};\n\n\t\tthis.#mouseWheelHandler = (event: MouseEvent) => {\n\t\t\tthis.#onMouseWheel(event);\n\t\t};\n\n\t\tthis.#permissionChecker = PermissionChecker.getInstance();\n\t}\n\n\t#onMouseDown({ target, currentTarget: tree, pageX, pageY }: MouseEvent): void\n\t{\n\t\tif (!Dom.hasClass(target, 'humanresources-tree__node_dnd-icon'))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\t\tthis.#tree = tree;\n\t\tthis.#zoom = Number(tree.dataset.zoom);\n\t\tthis.#canvas = { x: Number(tree.dataset.x), y: Number(tree.dataset.y) };\n\t\tthis.#draggedItem = target.closest('.humanresources-tree__node');\n\t\tthis.#ghost = this.#createGhost();\n\t\tthis.#prevPageX = pageX;\n\t\tthis.#prevPageY = pageY;\n\t\tthis.#positionPointer = this.#createPositionPointer();\n\t\tthis.#targetTeams = [];\n\t\tthis.#prevAffectedItems = [];\n\t\tthis.#transform = { x: 0, y: 0, prevX: 0, prevY: 0 };\n\t\tthis.#targetData = {};\n\t\tthis.#draggedEntityType = Dom.hasClass(this.#draggedItem, '--team') ? EntityTypes.team : EntityTypes.department;\n\t\tDom.addClass(tree, '--drag-progress');\n\t\tDom.addClass(this.#draggedItem.parentElement.parentElement, '--blur');\n\t\tthis.#setPositionPointerTransform(this.#draggedItem);\n\t\tthis.#setStyles();\n\t\tEvent.bind(document, 'mousemove', this.#mouseMoveHandler);\n\t\tEvent.bind(document, 'mouseup', this.#mouseUpHandler);\n\t\tEvent.bind(document, 'wheel', this.#mouseWheelHandler);\n\t\tEventEmitter.emit(events.HR_ENTITY_TOGGLE_ELEMENTS, { shouldShowElements: false });\n\t\tconst draggedId = Number(this.#draggedItem.dataset.id);\n\t\tEventEmitter.emit(events.HR_DRAG_ENTITY, { draggedId });\n\t}\n\n\t#onMouseMove({ pageX, pageY }: MouseEvent): void\n\t{\n\t\tDom.addClass(this.#draggedItem, '--hidden');\n\t\tDom.addClass(this.#tree.parentElement, '--disabled-transition');\n\t\tDom.removeClass(this.#positionPointer, ['--inside', '--no-permission']);\n\t\tDom.style(this.#positionPointer, 'height', `${this.#draggedItem.offsetHeight}px`);\n\t\tthis.#resetTeamsBlur();\n\t\tthis.#transform.prevX = this.#transform.x;\n\t\tthis.#transform.prevY = this.#transform.y;\n\t\tthis.#transform.x += (pageX - this.#prevPageX) / this.#zoom;\n\t\tthis.#transform.y += (pageY - this.#prevPageY) / this.#zoom;\n\t\tthis.#prevPageX = pageX;\n\t\tthis.#prevPageY = pageY;\n\t\tthis.#prevAffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, 0, 0));\n\t\tthis.#prevAffectedItems = [];\n\t\tconst { directionX, directionY } = this.#checkForDraggedOverflow();\n\t\tthis.#transform.x = directionX === 0\n\t\t\t? this.#transform.x\n\t\t\t: this.#transform.x + directionX * CANVAS_MOVE_SPEED / this.#zoom;\n\t\tthis.#transform.y = directionY === 0\n\t\t\t? this.#transform.y\n\t\t\t: this.#transform.y + directionY * CANVAS_MOVE_SPEED / this.#zoom;\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y, 4);\n\t\tthis.#setPositionPointerTransform(this.#draggedItem);\n\t\tthis.#targetData = this.#getTargetData();\n\t\tif (!this.#targetData.insertion)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { insertion, targetItem, hasPermission } = this.#targetData;\n\t\tif (!hasPermission)\n\t\t{\n\t\t\tDom.addClass(this.#positionPointer, '--no-permission');\n\t\t}\n\n\t\tthis.#setPositionPointerTransform(targetItem);\n\t\tswitch (insertion)\n\t\t{\n\t\t\tcase 'reorder':\n\t\t\t{\n\t\t\t\tconst affectedItems = this.#reorderEntity(targetItem);\n\t\t\t\tthis.#prevAffectedItems = affectedItems;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'sibling-left':\n\t\t\tcase 'sibling-right':\n\t\t\t{\n\t\t\t\tconst affectedItems = this.#changeParentWithReorder(targetItem, insertion);\n\t\t\t\tthis.#prevAffectedItems = affectedItems;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\tDom.addClass(this.#positionPointer, '--inside');\n\t\t\t\tDom.style(this.#positionPointer, 'height', `${targetItem.offsetHeight}px`);\n\t\t}\n\t}\n\n\t#onMouseUp(): void\n\t{\n\t\tthis.#setStyles(true);\n\t\tEvent.unbind(document, 'mousemove', this.#mouseMoveHandler);\n\t\tEvent.unbind(document, 'mouseup', this.#mouseUpHandler);\n\t\tEvent.unbind(document, 'mouseup', this.#mouseWheelHandler);\n\t\tthis.#prevAffectedItems.forEach((item) => this.#setTransform(item, 0, 0));\n\t\tDom.removeClass(this.#tree, '--drag-progress');\n\t\tDom.removeClass(this.#draggedItem.parentElement.parentElement, '--blur');\n\t\tDom.removeClass(this.#draggedItem, '--hidden');\n\t\tDom.removeClass(this.#tree.parentElement, '--disabled-transition');\n\t\tDom.remove(this.#ghost);\n\t\tDom.remove(this.#positionPointer);\n\t\tthis.#resetTeamsBlur();\n\t\tEventEmitter.emit(events.HR_ENTITY_TOGGLE_ELEMENTS, { shouldShowElements: true });\n\t\tconst { insertion, targetItem, hasPermission } = this.#targetData;\n\t\tif (!insertion || !hasPermission)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst draggedIndex = [...this.#draggedItem.parentElement.children].indexOf(this.#draggedItem);\n\t\tconst targetIndex = [...targetItem.parentElement.children].indexOf(targetItem);\n\t\tconst draggedId = Number(this.#draggedItem.dataset.id);\n\t\tEventEmitter.emit(events.HR_DROP_ENTITY, {\n\t\t\tdraggedId,\n\t\t\ttargetId: Number(targetItem.dataset.id),\n\t\t\ttargetIndex,\n\t\t\taffectedItems: this.#prevAffectedItems.map((item) => Number(item.dataset.id)),\n\t\t\tdirection: draggedIndex < targetIndex ? 1 : -1,\n\t\t\tinsertion,\n\t\t});\n\t}\n\n\t#onMouseWheel({ shiftKey }: WheelEvent): void\n\t{\n\t\tif (shiftKey)\n\t\t{\n\t\t\tconst currentCanvasX = Number(this.#tree.dataset.x);\n\t\t\tconst movementX = currentCanvasX - this.#canvas.x;\n\t\t\tthis.#transform.x -= movementX / this.#zoom;\n\t\t\tthis.#canvas.x = currentCanvasX;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentCanvasY = Number(this.#tree.dataset.y);\n\t\t\tconst movementY = currentCanvasY - this.#canvas.y;\n\t\t\tthis.#transform.y -= movementY / this.#zoom;\n\t\t\tthis.#canvas.y = currentCanvasY;\n\t\t}\n\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y, 4);\n\t}\n\n\t#createGhost(): HTMLElement\n\t{\n\t\tconst ghost = this.#draggedItem.cloneNode(true);\n\t\tDom.addClass(ghost, 'humanresources-tree__dnd-ghost');\n\t\tDom.removeClass(ghost, ['--expanded', '--focused']);\n\t\tconst { x: treeX, y: treeY } = this.#tree.getBoundingClientRect();\n\t\tconst { x: draggedX, y: draggedY } = this.#draggedItem.getBoundingClientRect();\n\t\tconst left = draggedX - treeX;\n\t\tconst top = draggedY - treeY;\n\t\tDom.style(ghost, 'left', `${left / this.#zoom}px`);\n\t\tDom.style(ghost, 'top', `${top / this.#zoom}px`);\n\t\tDom.append(ghost, this.#tree);\n\n\t\treturn ghost;\n\t}\n\n\t#createPositionPointer(): HTMLElement\n\t{\n\t\tconst { offsetWidth, offsetHeight } = this.#draggedItem;\n\t\tconst text = Dom.hasClass(this.#draggedItem, '--team')\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DRAG_TEAM_LABEL')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_DRAG_DEPARTMENT_LABEL');\n\t\tconst positionPointer = Tag.render`\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-tree__position-pointer\"\n\t\t\t\tstyle=\"width: ${offsetWidth}px; height: ${offsetHeight}px;);\"\n\t\t\t>\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"ui-icon-set --circle-plus\"></div>\n\t\t\t\t\t<span>${text}</span>\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\"ui-icon-set --cross-circle-50\"></div>\n\t\t\t\t\t<span>\n\t\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_NO_DRAG_PERMISSION')}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t\tDom.append(positionPointer, this.#tree);\n\t\tthis.#setPositionPointerTransform(this.#draggedItem);\n\n\t\treturn positionPointer;\n\t}\n\n\t#setTransform(element: HTMLElement, x: number, y: number, rotation: number = 0): void\n\t{\n\t\tif (x === 0 && y === 0)\n\t\t{\n\t\t\tDom.style(element, 'transform', '');\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(element, 'transform', `translate3d(${x}px, ${y}px, 0) rotate(${rotation}deg)`);\n\t}\n\n\t#setPositionPointerTransform(node: HTMLElement): void\n\t{\n\t\tconst { x: treeX, y: treeY } = this.#tree.getBoundingClientRect();\n\t\tconst { x: nodeX, y: nodeY } = node.getBoundingClientRect();\n\t\tconst x = (nodeX - treeX) / this.#zoom;\n\t\tconst y = (nodeY - treeY) / this.#zoom;\n\t\tthis.#setTransform(this.#positionPointer, x, y);\n\t}\n\n\t#getTargetData(): { insertion?: string; targetItem?: HTMLElement; }\n\t{\n\t\tDom.addClass(this.#ghost, '--disabled-events');\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y);\n\t\tconst reorderThreshold = 0.7;\n\t\tconst changeParentWithReorderThreshold = 0.6;\n\t\tconst {\n\t\t\tx,\n\t\t\ty,\n\t\t\twidth: draggedWidth,\n\t\t\theight: draggedHeight,\n\t\t} = this.#ghost.getBoundingClientRect();\n\t\tthis.#setTransform(this.#ghost, this.#transform.x, this.#transform.y, 4);\n\t\tconst points = [\n\t\t\t{ x, y },\n\t\t\t{ x: x + draggedWidth, y },\n\t\t\t{ x, y: y + draggedHeight },\n\t\t\t{ x: x + draggedWidth, y: y + draggedHeight },\n\t\t\t{ x, y: y + draggedHeight / 2 },\n\t\t\t{ x: x + draggedWidth, y: y + draggedHeight / 2 },\n\t\t];\n\t\tconst targetData = points.reduce((acc, point, i) => {\n\t\t\tif (acc.insertion)\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst belowItem = document.elementFromPoint(point.x, point.y);\n\t\t\tconst targetItemSummary = belowItem?.closest('.humanresources-tree__node_summary');\n\t\t\tconst targetItem = targetItemSummary?.parentElement;\n\t\t\tif (!targetItem || targetItem === this.#draggedItem)\n\t\t\t{\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tx: targetX,\n\t\t\t\ty: targetY,\n\t\t\t\twidth: targetWidth,\n\t\t\t\theight: targetHeight,\n\t\t\t} = targetItem.getBoundingClientRect();\n\t\t\tconst sameParent = this.#draggedItem.parentElement === targetItem.parentElement;\n\t\t\tconst hasSortPermission = this.#permissionChecker.canSortEntitiesByParentId(\n\t\t\t\tNumber(targetItem.parentElement.parentElement.dataset.id),\n\t\t\t);\n\t\t\tconst allowSort = i === 0 && !Dom.hasClass(targetItem, '--root') && hasSortPermission;\n\t\t\tacc.targetItem = targetItem;\n\t\t\tif (sameParent && x + reorderThreshold * draggedWidth < targetX + targetWidth && allowSort)\n\t\t\t{\n\t\t\t\treturn { ...acc, insertion: 'reorder' };\n\t\t\t}\n\n\t\t\tif (!sameParent && y + changeParentWithReorderThreshold * draggedHeight < targetY + targetHeight && allowSort)\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\t...acc,\n\t\t\t\t\tinsertion: x < targetX + targetWidth / 2 ? 'sibling-left' : 'sibling-right',\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tconst isDepartmentInsertToTeam = Dom.hasClass(targetItem, '--team') && !Dom.hasClass(this.#draggedItem, '--team');\n\t\t\tconst isInsertToParent = this.#draggedItem.parentElement.parentElement === targetItem;\n\t\t\tif (isDepartmentInsertToTeam || isInsertToParent)\n\t\t\t{\n\t\t\t\tif (isDepartmentInsertToTeam)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(targetItem, '--blur');\n\t\t\t\t\tthis.#targetTeams.push(targetItem);\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...acc,\n\t\t\t\tinsertion: 'inside',\n\t\t\t\thasPermission: this.#permissionChecker.canBeParentForEntity(\n\t\t\t\t\tNumber(targetItem.dataset.id),\n\t\t\t\t\tthis.#draggedEntityType,\n\t\t\t\t),\n\t\t\t};\n\t\t}, { hasPermission: true });\n\n\t\tDom.removeClass(this.#ghost, '--disabled-events');\n\n\t\treturn targetData;\n\t}\n\n\t#reorderEntity(targetItem: HTMLElement): HTMLElement[]\n\t{\n\t\tconst children = [...this.#draggedItem.parentElement.children];\n\t\tconst draggedIndex = children.indexOf(this.#draggedItem);\n\t\tconst targetIndex = [...targetItem.parentElement.children].indexOf(targetItem);\n\t\tconst direction = draggedIndex < targetIndex ? 1 : -1;\n\t\tconst affectedItems = direction > 0\n\t\t\t? children.slice(draggedIndex + 1, targetIndex + 1)\n\t\t\t: children.slice(targetIndex, draggedIndex);\n\t\taffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, -direction * FULL_WIDTH, 0));\n\n\t\treturn affectedItems;\n\t}\n\n\t#changeParentWithReorder(targetItem: HTMLElement, insertion: string): HTMLElement[]\n\t{\n\t\tconst children = [...targetItem.parentElement.children];\n\t\tconst targetIndex = children.indexOf(targetItem);\n\t\tlet affectedItems = [];\n\t\tif (insertion === 'sibling-right')\n\t\t{\n\t\t\taffectedItems = children.slice(0, targetIndex + 1);\n\t\t\taffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, -FULL_WIDTH, 0));\n\t\t}\n\t\telse\n\t\t{\n\t\t\taffectedItems = children.slice(targetIndex);\n\t\t\taffectedItems.forEach((affectedItem) => this.#setTransform(affectedItem, FULL_WIDTH, 0));\n\t\t}\n\n\t\treturn affectedItems;\n\t}\n\n\t#checkForDraggedOverflow(): { directionX: number; directionY: number; }\n\t{\n\t\tlet directionX = 0;\n\t\tlet directionY = 0;\n\t\tconst { left, top } = this.#draggedItem.getBoundingClientRect();\n\t\tconst zoomedLeft = left / this.#zoom;\n\t\tconst zoomedTop = top / this.#zoom;\n\t\tif (zoomedLeft + this.#transform.x < 0)\n\t\t{\n\t\t\tdirectionX = this.#transform.x < this.#transform.prevX ? -1 : 0;\n\t\t}\n\n\t\tif (zoomedLeft + this.#transform.x + this.#draggedItem.offsetWidth > document.body.offsetWidth / this.#zoom)\n\t\t{\n\t\t\tdirectionX = this.#transform.x > this.#transform.prevX ? 1 : 0;\n\t\t}\n\n\t\tif (zoomedTop + this.#transform.y < 0)\n\t\t{\n\t\t\tdirectionY = this.#transform.y < this.#transform.prevY ? -1 : 0;\n\t\t}\n\n\t\tif (zoomedTop + this.#transform.y + this.#draggedItem.offsetHeight > document.body.offsetHeight / this.#zoom)\n\t\t{\n\t\t\tdirectionY = this.#transform.y > this.#transform.prevY ? 1 : 0;\n\t\t}\n\n\t\tif (directionX !== 0 || directionY !== 0)\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ORG_CHART_TRANSFORM_CANVAS, {\n\t\t\t\tdirectionX,\n\t\t\t\tdirectionY,\n\t\t\t\tspeed: CANVAS_MOVE_SPEED,\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tdirectionX,\n\t\t\tdirectionY,\n\t\t};\n\t}\n\n\t#setStyles(shouldReset: ?boolean): void\n\t{\n\t\tDom.style(document.body, 'userSelect', 'none');\n\t\tDom.style(document.body, '-webkit-user-select', 'none');\n\t\tDom.style(document.body, 'cursor', 'grabbing');\n\t\tif (shouldReset)\n\t\t{\n\t\t\tDom.style(document.body, 'userSelect', '');\n\t\t\tDom.style(document.body, '-webkit-user-select', '');\n\t\t\tDom.style(document.body, 'cursor', '');\n\t\t}\n\t}\n\n\t#resetTeamsBlur(): void\n\t{\n\t\tthis.#targetTeams.forEach((team) => Dom.removeClass(team, '--blur'));\n\t}\n}\n","import { TreeNodeDragController } from './classes/drag-and-drop-controller';\n\nexport const DragAndDrop = {\n\tmounted(el: HTMLElement): void\n\t{\n\t\tnew TreeNodeDragController(el);\n\t},\n\tupdated(el: HTMLElement, { value }: Object): void\n\t{\n\t\tconst { x, y, zoom } = value;\n\t\tel.setAttribute('data-zoom', zoom);\n\t\tel.setAttribute('data-x', x);\n\t\tel.setAttribute('data-y', y);\n\t},\n};\n","import { PermissionChecker, PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { UserManagementDialogAPI } from 'humanresources.company-structure.user-management-dialog';\nimport { Runtime, Loc, Text } from 'main.core';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { MessageBox, MessageBoxButtons } from 'ui.dialogs.messagebox';\nimport { UI } from 'ui.notification';\nimport { ButtonColor } from 'ui.buttons';\nimport { DepartmentAPI } from '../../../../department-content/src/api';\nimport { UrlProvidedParamsService } from '../../classes/url-provided-params-service';\nimport { TreeNode } from './tree-node/tree-node';\nimport { Connectors } from './connectors';\nimport { DragAndDrop } from './directives/drag-and-drop';\nimport { useChartStore, UserService } from 'humanresources.company-structure.chart-store';\nimport { MoveEmployeeConfirmationPopup, ConfirmationPopup } from 'humanresources.company-structure.structure-components';\nimport { mapState } from 'ui.vue3.pinia';\nimport { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { events } from '../../consts';\nimport { chartAPI } from '../../api';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport { OrgChartActions } from '../../actions';\nimport type { MountedDepartment, TreeData, DragAndDropData } from '../../types';\nimport './style.css';\n\n// @vue/component\nexport const Tree = {\n\tname: 'companyTree',\n\n\tcomponents: {\n\t\tTreeNode,\n\t\tConnectors,\n\t\tMoveEmployeeConfirmationPopup,\n\t\tConfirmationPopup,\n\t},\n\n\tdirectives: { dnd: DragAndDrop },\n\n\tprovide(): { [key: string]: Function }\n\t{\n\t\treturn {\n\t\t\tgetTreeBounds: () => this.getTreeBounds(),\n\t\t};\n\t},\n\n\tprops: {\n\t\tcanvasTransform: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['moveTo', 'showWizard', 'controlDetail'],\n\n\tdata(): TreeData\n\t{\n\t\treturn {\n\t\t\texpandedNodes: [],\n\t\t\tisLocatedDepartmentVisible: false,\n\t\t\tisLoaded: false,\n\t\t\tuserDropTargetNodeId: null,\n\t\t\tisUserDropAllowed: false,\n\t\t\tdraggedUserData: null,\n\t\t\tshowDndConfirmationPopup: false,\n\t\t\tshowDndErrorPopup: false,\n\t\t\tdndErrorPopupDescription: '',\n\t\t\tdndUserMoveContext: null,\n\t\t\tisCombineOnly: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tdndTargetEntityType(): string\n\t\t{\n\t\t\treturn this.targetDepartment.entityType || '';\n\t\t},\n\t\tdndSourceEntityType(): string\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode)?.entityType || '';\n\t\t},\n\t\trootId(): number\n\t\t{\n\t\t\tconst { id: rootId } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn rootId;\n\t\t},\n\t\tconnectors(): Connectors\n\t\t{\n\t\t\treturn this.$refs.connectors;\n\t\t},\n\t\ttargetDepartment(): ?Object\n\t\t{\n\t\t\tif (!this.dndUserMoveContext?.targetDepartmentId)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this.departments.get(this.dndUserMoveContext.targetDepartmentId);\n\t\t},\n\t\tisTeamTarget(): string\n\t\t{\n\t\t\treturn this.targetDepartment?.entityType === EntityTypes.team;\n\t\t},\n\t\tdndPopupDescription(): string\n\t\t{\n\t\t\tconst phrase = this.isTeamTarget\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_CONFIRM_POPUP_DESC_ROLE_TEAM'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_CONFIRM_POPUP_DESC_ROLE_DEPARTMENT'\n\t\t\t;\n\n\t\t\treturn Loc.getMessage(phrase, {\n\t\t\t\t'#USER_NAME#': Text.encode(this.dndUserMoveContext.user.name),\n\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(this.targetDepartment.name),\n\t\t\t\t'[link]': `<a class=\"hr-department-detail-content__move-user-department-user-link\" href=\"${this.dndUserMoveContext.user.url}\">`,\n\t\t\t\t'[/link]': '</a>',\n\t\t\t});\n\t\t},\n\t\t...mapState(useChartStore, ['currentDepartments', 'userId', 'focusedNode', 'departments']),\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.treeNodes = new Map();\n\t\tthis.subscribeOnEvents();\n\t\tthis.loadHeads([this.rootId]);\n\t},\n\n\tmounted(): void\n\t{\n\t\tconst departmentToFocus = this.getDepartmentIdForInitialFocus();\n\t\tthis.currentDepartmentsLocated = [departmentToFocus];\n\n\t\tif (departmentToFocus !== this.rootId)\n\t\t{\n\t\t\tthis.expandDepartmentParents(departmentToFocus);\n\t\t\tthis.focus(departmentToFocus, { expandAfterFocus: true });\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.expandLowerDepartments();\n\t\tthis.focus(departmentToFocus);\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.unsubscribeFromEvents();\n\t},\n\n\tmethods:\n\t{\n\t\tgetDepartmentIdForInitialFocus(): ?number\n\t\t{\n\t\t\tconst providedFocusNodeId = UrlProvidedParamsService.getParams().focusNodeId;\n\t\t\tif (providedFocusNodeId)\n\t\t\t{\n\t\t\t\tconst node = this.departments.get(providedFocusNodeId);\n\t\t\t\tif (node)\n\t\t\t\t{\n\t\t\t\t\treturn providedFocusNodeId;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const currentDepartmentId: number of this.currentDepartments)\n\t\t\t{\n\t\t\t\tconst node = this.departments.get(currentDepartmentId);\n\n\t\t\t\tif (node.entityType === EntityTypes.department)\n\t\t\t\t{\n\t\t\t\t\treturn currentDepartmentId;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn this.rootId;\n\t\t},\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tgetTreeBounds(): DOMRect\n\t\t{\n\t\t\treturn this.$el.getBoundingClientRect();\n\t\t},\n\t\tonConnectDepartment({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { id, html } = data;\n\t\t\tthis.treeNodes.set(id, html);\n\t\t\tconst departmentIdToFocus = this.getDepartmentIdForInitialFocus();\n\t\t\tif (id === departmentIdToFocus && !this.isLoaded) // zoom to  department when loading\n\t\t\t{\n\t\t\t\tconst movingDelay = 1800;\n\t\t\t\tthis.isLoaded = true;\n\t\t\t\tRuntime.debounce(() => {\n\t\t\t\t\tthis.moveTo(departmentIdToFocus);\n\t\t\t\t}, movingDelay)();\n\t\t\t}\n\t\t},\n\t\tonDisconnectDepartment({ data }: MountedDepartment): void\n\t\t{\n\t\t\tconst { id } = data;\n\t\t\tconst department = this.departments.get(id);\n\t\t\tdelete department.prevParentId;\n\t\t\tif (!department.parentId)\n\t\t\t{\n\t\t\t\tOrgChartActions.removeDepartment(id);\n\t\t\t}\n\t\t},\n\t\tonDragEntity({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { draggedId } = data;\n\t\t\tif (this.expandedNodes.includes(draggedId))\n\t\t\t{\n\t\t\t\tthis.collapseRecursively(draggedId);\n\t\t\t}\n\t\t},\n\t\tonToggleConnectors({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { shouldShowElements } = data;\n\t\t\tthis.connectors.toggleAllConnectorsVisibility(shouldShowElements, this.expandedNodes);\n\t\t},\n\t\tasync changeOrder(data: DragAndDropData): Promise<void>\n\t\t{\n\t\t\tconst { draggedId, targetId, affectedItems, direction } = data;\n\t\t\tconst promise = OrgChartActions.orderDepartments(draggedId, targetId, direction, affectedItems.length);\n\t\t\tconst fullDepartmentWidth = 302;\n\t\t\tconst draggedShift = affectedItems.length * direction * fullDepartmentWidth;\n\t\t\tthis.connectors.adaptConnectorsAfterReorder([draggedId], draggedShift, true);\n\t\t\tconst affectedShift = -direction * fullDepartmentWidth;\n\t\t\tthis.connectors.adaptConnectorsAfterReorder(affectedItems, affectedShift, true);\n\t\t\tconst ordered = await promise;\n\t\t\tif (!ordered)\n\t\t\t{\n\t\t\t\tthis.connectors.adaptConnectorsAfterReorder([draggedId], -draggedShift, true);\n\t\t\t\tthis.connectors.adaptConnectorsAfterReorder(affectedItems, -affectedShift, true);\n\t\t\t}\n\t\t},\n\t\tasync updateParent(data: DragAndDropData): Promise<void>\n\t\t{\n\t\t\tconst { draggedId, targetId, targetIndex, insertion } = data;\n\t\t\tconst { id, parentId } = this.departments.get(draggedId);\n\t\t\tif (parentId === targetId && insertion === 'inside')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet updateParentPromise = null;\n\t\t\tconst store = useChartStore();\n\t\t\tif (insertion === 'sibling-left' || insertion === 'sibling-right')\n\t\t\t{\n\t\t\t\tconst { parentId: targetParentId } = this.departments.get(targetId);\n\t\t\t\tconst position = insertion === 'sibling-left' ? targetIndex : targetIndex + 1;\n\t\t\t\tstore.updateDepartment({ id, parentId: targetParentId }, position);\n\t\t\t\tupdateParentPromise = chartAPI.updateDepartment(draggedId, targetParentId);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tstore.updateDepartment({ id, parentId: targetId });\n\t\t\t\tupdateParentPromise = chartAPI.updateDepartment(draggedId, targetId);\n\t\t\t}\n\n\t\t\tthis.locateToDepartment(draggedId);\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait updateParentPromise;\n\t\t\t\tif (insertion === 'sibling-left' || insertion === 'sibling-right')\n\t\t\t\t{\n\t\t\t\t\tconst { parentId: targetParentId } = this.departments.get(targetId);\n\t\t\t\t\tconst { children } = this.departments.get(targetParentId);\n\t\t\t\t\tconst shift = insertion === 'sibling-left' ? 1 : 2;\n\t\t\t\t\tconst affectedCount = children.length - targetIndex - shift;\n\t\t\t\t\tawait chartAPI.changeOrder(draggedId, -1, affectedCount);\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (err)\n\t\t\t{\n\t\t\t\tconsole.error(err);\n\t\t\t}\n\t\t},\n\t\tonDropEntity({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { insertion } = data;\n\t\t\tif (insertion === 'reorder')\n\t\t\t{\n\t\t\t\tthis.changeOrder(data);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.updateParent(data);\n\t\t},\n\t\tonPublicFocusNode({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { nodeId } = data;\n\n\t\t\tconst node = this.departments.get(nodeId);\n\t\t\tif (!node)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.locateToDepartment(nodeId);\n\t\t},\n\t\tcollapse(nodeId: number): void\n\t\t{\n\t\t\tthis.expandedNodes = this.expandedNodes.filter((expandedId) => expandedId !== nodeId);\n\t\t\tthis.connectors.toggleConnectorsVisibility(nodeId, false);\n\t\t\tthis.connectors.toggleConnectorHighlighting(nodeId, false);\n\t\t},\n\t\tcollapseRecursively(nodeId: number): void\n\t\t{\n\t\t\tconst deepCollapse = (id: number) => {\n\t\t\t\tthis.collapse(id);\n\t\t\t\tconst node = this.departments.get(id);\n\t\t\t\tnode.children?.forEach((childId) => {\n\t\t\t\t\tif (this.expandedNodes.includes(childId))\n\t\t\t\t\t{\n\t\t\t\t\t\tdeepCollapse(childId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t\tconst { parentId } = this.departments.get(nodeId);\n\t\t\tconst expandedNode = this.expandedNodes.find((id) => {\n\t\t\t\tconst node = this.departments.get(id);\n\n\t\t\t\treturn node.parentId === parentId;\n\t\t\t});\n\t\t\tif (expandedNode)\n\t\t\t{\n\t\t\t\tdeepCollapse(expandedNode);\n\t\t\t}\n\t\t},\n\t\texpand(departmentId: number, options: { isManual?: boolean } = {}): void\n\t\t{\n\t\t\tconst { isManual = false } = options;\n\n\t\t\tthis.collapseRecursively(departmentId);\n\t\t\tthis.expandedNodes = [...this.expandedNodes, departmentId];\n\t\t\tthis.connectors.toggleConnectorsVisibility(departmentId, true);\n\t\t\tthis.connectors.toggleConnectorHighlighting(departmentId, true);\n\t\t\tconst department = this.departments.get(departmentId);\n\t\t\tconst childrenWithoutHeads = department.children.filter((childId) => {\n\t\t\t\treturn !this.departments.get(childId).heads;\n\t\t\t});\n\t\t\tif (childrenWithoutHeads.length > 0)\n\t\t\t{\n\t\t\t\tthis.loadHeads(childrenWithoutHeads);\n\t\t\t}\n\n\t\t\tif (isManual)\n\t\t\t{\n\t\t\t\tanalyticsSendData({ tool: 'structure', category: 'structure', event: 'expand_department' });\n\t\t\t}\n\t\t},\n\t\tfocus(nodeId: number, options: Object = {}): void\n\t\t{\n\t\t\tconst { expandAfterFocus = false, showEmployees = false, subdivisionsSelected = false } = options;\n\t\t\tconst hasChildren = this.departments.get(nodeId).children?.length > 0;\n\n\t\t\tlet shouldExpand = expandAfterFocus || !this.expandedNodes.includes(nodeId);\n\t\t\tif (showEmployees)\n\t\t\t{\n\t\t\t\tshouldExpand = this.expandedNodes.includes(nodeId);\n\t\t\t}\n\n\t\t\tif (subdivisionsSelected || !hasChildren)\n\t\t\t{\n\t\t\t\tthis.collapseRecursively(nodeId);\n\t\t\t}\n\n\t\t\tif (hasChildren && shouldExpand)\n\t\t\t{\n\t\t\t\tthis.expand(nodeId, { isManual: true });\n\t\t\t}\n\n\t\t\tif (this.focusedNode && !this.expandedNodes.includes(this.focusedNode))\n\t\t\t{\n\t\t\t\tthis.connectors.toggleConnectorHighlighting(this.focusedNode, false);\n\t\t\t}\n\n\t\t\tOrgChartActions.focusDepartment(nodeId);\n\t\t\tthis.connectors.toggleConnectorHighlighting(this.focusedNode, true);\n\t\t},\n\t\tonFocusDepartment({ data }: { nodeId: number }): void\n\t\t{\n\t\t\tconst { nodeId, showEmployees, subdivisionsSelected } = data;\n\t\t\tthis.focus(nodeId, { showEmployees, subdivisionsSelected });\n\t\t\tthis.$emit('controlDetail', {\n\t\t\t\tshowEmployees,\n\t\t\t\tpreventSwitch: subdivisionsSelected,\n\t\t\t});\n\t\t},\n\t\ttryRemoveDepartment(nodeId: number, entityType: string): void\n\t\t{\n\t\t\tconst localizationMap = {\n\t\t\t\tteam: {\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_TITLE'),\n\t\t\t\t\tmessage: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_MESSAGE'),\n\t\t\t\t\tsuccess: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_REMOVED'),\n\t\t\t\t\terror: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_TEAM_ERROR'),\n\t\t\t\t},\n\t\t\t\tdefault: {\n\t\t\t\t\ttitle: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_TITLE'),\n\t\t\t\t\tmessage: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_MESSAGE'),\n\t\t\t\t\tsuccess: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_REMOVED'),\n\t\t\t\t\terror: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_ERROR'),\n\t\t\t\t},\n\t\t\t};\n\t\t\tconst mapIndex = entityType === EntityTypes.team ? 'team' : 'default';\n\t\t\tconst messageBox = MessageBox.create({\n\t\t\t\ttitle: localizationMap[mapIndex].title,\n\t\t\t\tmessage: localizationMap[mapIndex].message,\n\t\t\t\tbuttons: MessageBoxButtons.OK_CANCEL,\n\t\t\t\tonOk: async (dialog: MessageBox) => {\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tawait this.removeDepartment(nodeId);\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: localizationMap[mapIndex].success,\n\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tdialog.close();\n\t\t\t\t\t}\n\t\t\t\t\tcatch\n\t\t\t\t\t{\n\t\t\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\t\t\tcontent: localizationMap[mapIndex].error,\n\t\t\t\t\t\t\tautoHideDelay: 2000,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonCancel: (dialog: MessageBox) => dialog.close(),\n\t\t\t\tminWidth: 250,\n\t\t\t\tmaxWidth: 320,\n\t\t\t\tminHeight: 175,\n\t\t\t\tokCaption: this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_CONFIRM_REMOVE_DEPARTMENT_OK_CAPTION'),\n\t\t\t\tpopupOptions: { className: 'humanresources-tree__message-box', overlay: { opacity: 40 } },\n\t\t\t});\n\t\t\tconst okButton = messageBox.getOkButton();\n\t\t\tconst cancelButton = messageBox.getCancelButton();\n\t\t\tokButton.setRound(true);\n\t\t\tcancelButton.setRound(true);\n\t\t\tokButton.setColor(ButtonColor.DANGER);\n\t\t\tcancelButton.setColor(ButtonColor.LIGHT_BORDER);\n\t\t\tmessageBox.show();\n\t\t},\n\t\tasync removeDepartment(nodeId: number): Promise<void>\n\t\t{\n\t\t\tconst store = useChartStore();\n\t\t\tstore.updateChatsInChildrenNodes(nodeId);\n\n\t\t\tawait chartAPI.removeDepartment(nodeId);\n\t\t\tconst removableDepartment = this.departments.get(nodeId);\n\t\t\tconst { parentId, children: removableDepartmentChildren = [] } = removableDepartment;\n\t\t\tif (removableDepartmentChildren.length > 0)\n\t\t\t{\n\t\t\t\tthis.collapse(nodeId);\n\t\t\t}\n\n\t\t\tOrgChartActions.moveSubordinatesToParent(nodeId);\n\t\t\tawait this.$nextTick();\n\t\t\tOrgChartActions.markDepartmentAsRemoved(nodeId);\n\t\t\tthis.focus(parentId, { expandAfterFocus: true });\n\t\t\tthis.moveTo(parentId);\n\t\t},\n\t\texpandDepartmentParents(nodeId: number): void\n\t\t{\n\t\t\tlet { parentId } = this.departments.get(nodeId);\n\t\t\twhile (parentId)\n\t\t\t{\n\t\t\t\tif (!this.expandedNodes.includes(parentId))\n\t\t\t\t{\n\t\t\t\t\tthis.expand(parentId);\n\t\t\t\t}\n\n\t\t\t\tparentId = this.departments.get(parentId).parentId;\n\t\t\t}\n\t\t},\n\t\texpandLowerDepartments(): void\n\t\t{\n\t\t\tlet expandLevel = 0;\n\t\t\tconst expandRecursively = (departmentId: number) => {\n\t\t\t\tconst { children = [] } = this.departments.get(departmentId);\n\t\t\t\tif (expandLevel === 4 || children.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.expand(departmentId);\n\t\t\t\texpandLevel += 1;\n\t\t\t\tconst middleBound = Math.trunc(children.length / 2);\n\t\t\t\tconst childId = children[middleBound];\n\t\t\t\tif (this.departments.get(childId).children?.length > 0)\n\t\t\t\t{\n\t\t\t\t\texpandRecursively(childId);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfor (let i = middleBound - 1; i >= 0; i--)\n\t\t\t\t{\n\t\t\t\t\tif (traverseSibling(children[i]))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (let i = middleBound + 1; i < children.length; i++)\n\t\t\t\t{\n\t\t\t\t\tif (traverseSibling(children[i]))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst traverseSibling = (siblingId: number) => {\n\t\t\t\tconst { children: currentChildren = [] } = this.departments.get(siblingId);\n\n\t\t\t\tif (currentChildren.length > 0)\n\t\t\t\t{\n\t\t\t\t\texpandRecursively(siblingId);\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\t\t\texpandRecursively(this.rootId);\n\t\t},\n\t\tasync locateToCurrentDepartment(): Promise<void>\n\t\t{\n\t\t\t// currentDepartmentsLocated manipulation needed to cycle through current departments\n\t\t\tif (this.currentDepartmentsLocated.length === this.currentDepartments.length)\n\t\t\t{\n\t\t\t\tthis.currentDepartmentsLocated = [];\n\t\t\t}\n\t\t\tconst currentDepartment = this.currentDepartments.find((item) => !this.currentDepartmentsLocated.includes(item));\n\t\t\tif (!currentDepartment)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentDepartmentsLocated.push(currentDepartment);\n\t\t\tawait this.locateToDepartment(currentDepartment);\n\t\t\tOrgChartActions.searchUserInDepartment(this.userId);\n\t\t},\n\t\tasync locateToDepartment(nodeId: number): Promise<void>\n\t\t{\n\t\t\tthis.isLocatedDepartmentVisible = false;\n\t\t\tthis.expandDepartmentParents(nodeId);\n\t\t\tthis.focus(nodeId, { expandAfterFocus: true });\n\t\t\t// $nextTick makes sure that this.getTreeBounds() returns correct value when nodeId is not visible\n\t\t\tawait this.$nextTick();\n\t\t\tthis.isLocatedDepartmentVisible = true;\n\t\t\tawait this.moveTo(nodeId);\n\t\t},\n\t\tasync moveTo(nodeId: number): Promise<void>\n\t\t{\n\t\t\tawait this.$nextTick();\n\t\t\tconst treeRect = this.getTreeBounds();\n\t\t\tconst centerX = treeRect.x + treeRect.width / 2;\n\t\t\tconst centerY = treeRect.y + treeRect.height / 2;\n\t\t\tconst treeNode = this.treeNodes.get(nodeId);\n\t\t\tconst treeNodeRect = treeNode.getBoundingClientRect();\n\t\t\tthis.$emit('moveTo', {\n\t\t\t\tx: centerX - treeNodeRect.x - treeNodeRect.width / 2,\n\t\t\t\ty: centerY - treeNodeRect.y - treeNodeRect.height / 2,\n\t\t\t\tnodeId,\n\t\t\t});\n\t\t},\n\t\tloadHeads(departmentIds: number[]): void\n\t\t{\n\t\t\tconst store = useChartStore();\n\t\t\tstore.loadHeads(departmentIds);\n\t\t},\n\t\tsubscribeOnEvents(): void\n\t\t{\n\t\t\tthis.events = {\n\t\t\t\t[events.HR_DEPARTMENT_CONNECT]: this.onConnectDepartment,\n\t\t\t\t[events.HR_DEPARTMENT_DISCONNECT]: this.onDisconnectDepartment,\n\t\t\t\t[events.HR_DEPARTMENT_FOCUS]: this.onFocusDepartment,\n\t\t\t\t[events.HR_DRAG_ENTITY]: this.onDragEntity,\n\t\t\t\t[events.HR_DROP_ENTITY]: this.onDropEntity,\n\t\t\t\t[events.HR_ENTITY_TOGGLE_ELEMENTS]: this.onToggleConnectors,\n\t\t\t\t[events.HR_PUBLIC_FOCUS_NODE]: this.onPublicFocusNode,\n\t\t\t\t[events.HR_USER_DRAG_START]: this.onUserDragStart,\n\t\t\t\t[events.HR_USER_DRAG_DROP]: this.onUserDragDrop,\n\t\t\t\t[events.HR_USER_DRAG_END]: this.onUserDragEnd,\n\t\t\t\t[events.HR_USER_DRAG_ENTER_NODE]: this.onUserDragEnterNode,\n\t\t\t\t[events.HR_USER_DRAG_LEAVE_NODE]: this.onUserDragLeaveNode,\n\t\t\t};\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.subscribe(event, handle);\n\t\t\t});\n\t\t},\n\t\tunsubscribeFromEvents(): void\n\t\t{\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.unsubscribe(event, handle);\n\t\t\t});\n\t\t},\n\t\tonUserDragStart({ data }): void\n\t\t{\n\t\t\tthis.draggedUserData = data.user;\n\t\t},\n\t\tonUserDragEnterNode({ data }): void\n\t\t{\n\t\t\tif (!this.draggedUserData)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst hoveredNodeId = data.nodeId;\n\t\t\tconst sourceDepartmentId = this.focusedNode;\n\n\t\t\tif (hoveredNodeId === sourceDepartmentId)\n\t\t\t{\n\t\t\t\tthis.userDropTargetNodeId = hoveredNodeId;\n\t\t\t\tthis.isUserDropAllowed = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.userDropTargetNodeId = hoveredNodeId;\n\t\t\tconst movePermissions = this.canMoveUser(sourceDepartmentId, hoveredNodeId);\n\t\t\tthis.isUserDropAllowed = movePermissions.isAllowed;\n\t\t\tthis.isCombineOnly = movePermissions.combineOnly;\n\t\t},\n\t\tonUserDragLeaveNode({ data }): void\n\t\t{\n\t\t\tif (!this.draggedUserData)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.userDropTargetNodeId === data.nodeId)\n\t\t\t{\n\t\t\t\tthis.userDropTargetNodeId = null;\n\t\t\t\tthis.isUserDropAllowed = false;\n\t\t\t}\n\t\t},\n\t\tasync onUserDragDrop(): Promise<void>\n\t\t{\n\t\t\tif (!this.userDropTargetNodeId || !this.isUserDropAllowed)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dndUserMoveContext = {\n\t\t\t\tuser: this.draggedUserData,\n\t\t\t\tsourceDepartmentId: this.focusedNode,\n\t\t\t\ttargetDepartmentId: this.userDropTargetNodeId,\n\t\t\t\tsourceRole: this.draggedUserData.role,\n\t\t\t};\n\n\t\t\tthis.showDndConfirmationPopup = true;\n\t\t},\n\t\tasync confirmUserMove(payload: {\n\t\t\trole: string;\n\t\t\troleLabel: string;\n\t\t\tisCombineMode: boolean;\n\t\t\tbadgeText: string;\n\t\t}): Promise<void>\n\t\t{\n\t\t\tthis.showDndConfirmationPopup = false;\n\t\t\tconst { user } = this.dndUserMoveContext;\n\n\t\t\tconst userInTarget = (this.targetDepartment?.heads ?? []).find((u) => u.id === user.id)\n\t\t\t\t|| (this.targetDepartment?.employees ?? []).find((u) => u.id === user.id);\n\t\t\tconst isAlreadyInTarget = Boolean(userInTarget);\n\t\t\tconst isRoleTheSame = isAlreadyInTarget && (userInTarget.role === payload.role);\n\n\t\t\tif (isAlreadyInTarget && isRoleTheSame)\n\t\t\t{\n\t\t\t\tthis.displayDndErrorPopup(user);\n\t\t\t\tthis.dndUserMoveContext = null;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry\n\t\t\t{\n\t\t\t\tif (payload.isCombineMode)\n\t\t\t\t{\n\t\t\t\t\tawait this.handleCombineUser(this.dndUserMoveContext, payload);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tawait this.handleMoveUser(this.dndUserMoveContext, payload, isAlreadyInTarget);\n\t\t\t\t}\n\n\t\t\t\tconst phrase = this.isTeamTarget\n\t\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_MOVED_SUCCESS_TEAM'\n\t\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_USER_MOVED_SUCCESS_DEPARTMENT'\n\t\t\t\t;\n\t\t\t\tUI.Notification.Center.notify({\n\t\t\t\t\tcontent: this.loc(phrase, {\n\t\t\t\t\t\t'#USER_NAME#': Text.encode(user.name),\n\t\t\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(this.targetDepartment?.name),\n\t\t\t\t\t\t'#USER_ROLE#': Text.encode(payload.roleLabel),\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\n\t\t\tthis.dndUserMoveContext = null;\n\t\t},\n\t\tasync handleCombineUser(dndContext, payload): Promise<void>\n\t\t{\n\t\t\tconst { user, targetDepartmentId } = dndContext;\n\t\t\tconst data = await UserManagementDialogAPI.addUsersToDepartment(targetDepartmentId, [user.id], payload.role);\n\n\t\t\tUserService.addUsersToEntity(\n\t\t\t\ttargetDepartmentId,\n\t\t\t\t[{ ...user, role: payload.role, badgeText: payload.badgeText ?? null }],\n\t\t\t\tdata.userCount,\n\t\t\t\tpayload.role,\n\t\t\t);\n\t\t},\n\t\tasync handleMoveUser(dndContext, payload, isAlreadyInTarget): Promise<void>\n\t\t{\n\t\t\tconst { user, sourceDepartmentId, targetDepartmentId, sourceRole } = dndContext;\n\t\t\tconst targetDepartment = this.departments.get(targetDepartmentId);\n\n\t\t\tif (isAlreadyInTarget)\n\t\t\t{\n\t\t\t\tawait UserManagementDialogAPI.addUsersToDepartment(targetDepartmentId, [user.id], payload.role);\n\t\t\t\tawait DepartmentAPI.removeUserFromDepartment(sourceDepartmentId, user.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tawait DepartmentAPI.moveUserToDepartment(\n\t\t\t\t\tsourceDepartmentId,\n\t\t\t\t\tuser.id,\n\t\t\t\t\ttargetDepartmentId,\n\t\t\t\t\tpayload.role,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst finalUserCount = targetDepartment.userCount + (isAlreadyInTarget ? 0 : 1);\n\t\t\tUserService.removeUserFromEntity(sourceDepartmentId, user.id, sourceRole);\n\t\t\tUserService.addUsersToEntity(\n\t\t\t\ttargetDepartmentId,\n\t\t\t\t[{ ...user, role: payload.role, badgeText: payload.badgeText ?? null }],\n\t\t\t\tfinalUserCount,\n\t\t\t\tpayload.role,\n\t\t\t);\n\t\t},\n\t\tdisplayDndErrorPopup(user): void\n\t\t{\n\t\t\tconst phrase = this.isTeamTarget\n\t\t\t\t? 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_ERROR_POPUP_DESC_TEAM'\n\t\t\t\t: 'HUMANRESOURCES_COMPANY_STRUCTURE_DND_ERROR_POPUP_DESC_DEPARTMENT'\n\t\t\t;\n\t\t\tthis.dndErrorPopupDescription = Loc.getMessage(phrase, {\n\t\t\t\t'#USER_NAME#': Text.encode(user.name),\n\t\t\t\t'#DEPARTMENT_NAME#': Text.encode(this.targetDepartment?.name),\n\t\t\t\t'[link]': `<a class=\"hr-department-detail-content__move-user-department-user-link\" href=\"${user.url}\">`,\n\t\t\t\t'[/link]': '</a>',\n\t\t\t});\n\n\t\t\tthis.showDndErrorPopup = true;\n\t\t},\n\t\tcancelUserMove(): void\n\t\t{\n\t\t\tif (!this.dndUserMoveContext)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.showDndConfirmationPopup = false;\n\t\t\tthis.dndUserMoveContext = null;\n\t\t},\n\t\tcloseDndErrorPopup(): void\n\t\t{\n\t\t\tthis.showDndErrorPopup = false;\n\t\t\tthis.dndErrorPopupDescription = '';\n\t\t\tthis.dndUserMoveContext = null;\n\t\t},\n\t\tonUserDragEnd(): void\n\t\t{\n\t\t\tthis.userDropTargetNodeId = null;\n\t\t\tthis.isUserDropAllowed = false;\n\t\t\tthis.draggedUserData = null;\n\t\t},\n\t\tcanMoveUser(sourceDepartmentId: number, targetDepartmentId: number): { isAllowed: boolean; combineOnly: boolean }\n\t\t{\n\t\t\tconst permissionChecker = PermissionChecker.getInstance();\n\t\t\tconst source = this.departments.get(sourceDepartmentId);\n\t\t\tconst target = this.departments.get(targetDepartmentId);\n\n\t\t\tif (!source || !target)\n\t\t\t{\n\t\t\t\treturn { isAllowed: false, combineOnly: false };\n\t\t\t}\n\n\t\t\tconst isTeamToDept = source.entityType === EntityTypes.team && target.entityType === EntityTypes.department;\n\t\t\tif (isTeamToDept)\n\t\t\t{\n\t\t\t\treturn { isAllowed: false, combineOnly: false };\n\t\t\t}\n\n\t\t\tconst sourcePermission = source.entityType === EntityTypes.team\n\t\t\t\t? PermissionActions.teamRemoveMember\n\t\t\t\t: PermissionActions.employeeRemoveFromDepartment;\n\t\t\tconst canTakeFromSource = permissionChecker.hasPermission(sourcePermission, sourceDepartmentId);\n\n\t\t\tconst targetPermission = this.isTeamTarget\n\t\t\t\t? PermissionActions.teamAddMember\n\t\t\t\t: PermissionActions.employeeAddToDepartment;\n\t\t\tconst canPutToTarget = permissionChecker.hasPermission(targetPermission, targetDepartmentId);\n\n\t\t\tif (!canPutToTarget)\n\t\t\t{\n\t\t\t\treturn { isAllowed: false, combineOnly: false };\n\t\t\t}\n\n\t\t\tconst isDeptToTeam = source.entityType === EntityTypes.department && target.entityType === EntityTypes.team;\n\t\t\tif (isDeptToTeam)\n\t\t\t{\n\t\t\t\treturn { isAllowed: true, combineOnly: true };\n\t\t\t}\n\n\t\t\treturn { isAllowed: true, combineOnly: !canTakeFromSource };\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"humanresources-tree\"\n\t\t\tv-if=\"departments.size > 0\"\n\t\t\tv-dnd=\"canvasTransform\"\n\t\t>\n\t\t\t<TreeNode\n\t\t\t\tclass=\"--root\"\n\t\t\t\t:key=\"rootId\"\n\t\t\t\t:nodeId=\"rootId\"\n\t\t\t\t:expandedNodes=\"[...expandedNodes]\"\n\t\t\t\t:canvasZoom=\"canvasTransform.zoom\"\n\t\t\t\t:currentDepartments=\"currentDepartments\"\n\t\t\t\t:userDropTargetNodeId=\"userDropTargetNodeId\"\n\t\t\t\t:isUserDropAllowed=\"isUserDropAllowed\"\n\t\t\t\t:isDraggingUser=\"!!draggedUserData\"\n\t\t\t></TreeNode>\n\t\t\t<Connectors\n\t\t\t\tref=\"connectors\"\n\t\t\t\t:isLocatedDepartmentVisible=\"isLocatedDepartmentVisible\"\n\t\t\t\t:treeNodes=\"treeNodes\"\n\t\t\t></Connectors>\n\t\t\t<MoveEmployeeConfirmationPopup\n\t\t\t\tv-if=\"showDndConfirmationPopup\"\n\t\t\t\t:description=\"dndPopupDescription\"\n\t\t\t\t:showRoleSelect=\"true\"\n\t\t\t\t:showCombineCheckbox=\"true\"\n\t\t\t\t:isCombineOnly=\"isCombineOnly\"\n\t\t\t\t:targetType=\"dndTargetEntityType\"\n\t\t\t\t:sourceType=\"dndSourceEntityType\"\n\t\t\t\t@confirm=\"confirmUserMove\"\n\t\t\t\t@close=\"cancelUserMove\"\n\t\t\t/>\n\t\t\t<ConfirmationPopup\n\t\t\t\tv-if=\"showDndErrorPopup\"\n\t\t\t\t:withoutTitleBar = true\n\t\t\t\t:onlyConfirmButtonMode = true\n\t\t\t\t:confirmBtnText = \"loc('HUMANRESOURCES_COMPANY_STRUCTURE_DEPARTMENT_CONTENT_USER_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_ALREADY_BELONGS_TO_DEPARTMENT_CLOSE_BUTTON')\"\n\t\t\t\t:width=\"300\"\n\t\t\t\t@action=\"closeDndErrorPopup\"\n\t\t\t\t@close=\"closeDndErrorPopup\"\n\t\t\t>\n\t\t\t\t<template v-slot:content>\n\t\t\t\t\t<div class=\"hr-department-detail-content__user-action-text-container\">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"hr-department-detail-content__user-belongs-to-department-text-container\"\n\t\t\t\t\t\t\tv-html=\"dndErrorPopupDescription\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</ConfirmationPopup>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter } from 'main.core.events';\nimport { detailPanelWidth, events } from '../consts';\n\n// @vue/component\nexport const TransformPanel = {\n\tname: 'transform-panel',\n\n\tprops:\n\t{\n\t\tmodelValue: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\temits: ['update:modelValue'],\n\n\tdata(): { selectedId: string; }\n\t{\n\t\treturn {\n\t\t\tselectedId: '',\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tzoomInPercent(): string\n\t\t{\n\t\t\tconst percent = '<span class=\"humanresources-transform-panel__zoom_percent\">%</span>';\n\n\t\t\treturn `${(this.modelValue.zoom * 100).toFixed(0)}${percent}`;\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.actions = Object.freeze({\n\t\t\tzoomIn: 'zoomIn',\n\t\t\tzoomOut: 'zoomOut',\n\t\t\tlocate: 'locate',\n\t\t\tnavigate: 'navigate',\n\t\t});\n\t},\n\n\tmethods:\n\t{\n\t\tloc(phraseCode: string, replacements: {[p: string]: string} = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonZoom(zoomIn: boolean): void\n\t\t{\n\t\t\tconst leftBound = 0.2;\n\t\t\tconst rightBound = 3;\n\t\t\tlet direction = -1;\n\t\t\tif (zoomIn)\n\t\t\t{\n\t\t\t\tdirection = 1;\n\t\t\t\tthis.selectedId = this.actions.zoomIn;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.selectedId = this.actions.zoomOut;\n\t\t\t}\n\n\t\t\tconst zoom = Number((this.modelValue.zoom + leftBound * direction).toFixed(1));\n\t\t\tif (zoom < leftBound || zoom > rightBound)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// calibrate x and y according to viewpoint center\n\t\t\tconst treeRect = this.$parent.$refs.tree.getTreeBounds();\n\t\t\tconst centerX = (treeRect.width / 2) / this.modelValue.zoom - detailPanelWidth / 2;\n\t\t\tconst centerY = (treeRect.height / 2) / this.modelValue.zoom;\n\n\t\t\tconst oldCenterX = (centerX - this.modelValue.x) / this.modelValue.zoom;\n\t\t\tconst oldCenterY = (centerY - this.modelValue.y) / this.modelValue.zoom;\n\n\t\t\tconst x = centerX - oldCenterX * zoom;\n\t\t\tconst y = centerY - oldCenterY * zoom;\n\n\t\t\tthis.$emit('update:modelValue', { ...this.modelValue, zoom, x, y });\n\t\t},\n\t\tonLocate(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT);\n\t\t\tthis.selectedId = this.actions.locate;\n\t\t},\n\t\tonfocusout(): void\n\t\t{\n\t\t\tthis.selectedId = '';\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-transform-panel\" @focusout=\"onfocusout\" tabindex=\"-1\">\n\t\t\t<div\n\t\t\t\tclass=\"humanresources-transform-panel__locate\"\n\t\t\t\t:class=\"{ '--selected': selectedId === actions.locate }\"\n\t\t\t\t@click=\"onLocate\"\n\t\t\t>\n\t\t\t\t{{loc('HUMANRESOURCES_COMPANY_STRUCTURE_TREE_LOCATE')}}\n\t\t\t</div>\n\t\t\t<div class=\"humanresources-transform-panel__separator\"></div>\n\t\t\t<div class=\"humanresources-transform-panel__zoom\">\n\t\t\t\t<svg\n\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tclass=\"humanresources-transform-panel__icon --zoom-out\"\n\t\t\t\t\t:class=\"{ '--selected': selectedId === actions.zoomOut }\"\n\t\t\t\t\t@click=\"onZoom(false)\"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M4 8.66671V7.33337H7.33333H8.66667H12V8.66671H8.66667H7.33333H4Z\" fill=\"#6A737F\"/>\n\t\t\t\t</svg>\n\t\t\t\t<span v-html=\"zoomInPercent\"></span>\n\t\t\t\t<svg\n\t\t\t\t\tviewBox=\"0 0 16 16\"\n\t\t\t\t\tfill=\"none\"\n\t\t\t\t\tclass=\"humanresources-transform-panel__icon --zoom-in\"\n\t\t\t\t\t:class=\"{ '--selected': selectedId === actions.zoomIn }\"\n\t\t\t\t\t@click=\"onZoom(true)\"\n\t\t\t\t>\n\t\t\t\t\t<path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M7.83333 4H9.16667V7.33333H12.5V8.66667H9.16667V12H7.83333V8.66667H4.5V7.33333H7.83333V4Z\" fill=\"#6A737F\"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","// @vue/component\nexport const DetailPanelCollapsedTitle = {\n\tname: 'detailPanelCollapsedTitle',\n\n\tprops:\n\t{\n\t\ttitle:\n\t\t{\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tavatars:\n\t\t{\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tcomputed:\n\t{\n\t\tmaxVisibleAvatarsCount(): Number\n\t\t{\n\t\t\treturn 2;\n\t\t},\n\t\tadditionalCount(): Number\n\t\t{\n\t\t\treturn this.avatars.length > this.maxVisibleAvatarsCount ? this.avatars.length - this.maxVisibleAvatarsCount : 0;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"humanresources-detail-panel__collapsed-title\">\n\t\t\t<template v-for=\"(avatar, index) in avatars\">\n\t\t\t\t<img\n\t\t\t\t\tv-if=\"index < this.maxVisibleAvatarsCount\"\n\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t:src=\"encodeURI(avatar)\"\n\t\t\t\t\tclass=\"humanresources-detail-panel__collapsed-title-avatar\"\n\t\t\t\t/>\n\t\t\t</template>\n\t\t\t<div\n\t\t\t\tv-if=\"avatars.length > maxVisibleAvatarsCount\"\n\t\t\t\tclass=\"humanresources-detail-panel__collapsed-title-avatar --additional\"\n\t\t\t>\n\t\t\t +{{ additionalCount }}\n\t\t\t</div>\n\t\t\t<div class=\"humanresources-detail-panel__title\">{{ title }}</div>\n\t\t</div>\n\t`,\n};\n","import { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport { EntityTypes } from 'humanresources.company-structure.utils';\nimport { RouteActionMenu } from 'humanresources.company-structure.structure-components';\nimport { EntityActionMenu } from '../menu/menu/entity-action-menu';\n\nimport '../../style.css';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.crm';\n\n/**\n * Component for displaying icon that shows EntityActionMenu\n */\n// @vue/component\nexport const DetailPanelEditButton = {\n\tname: 'detailPanelEditButton',\n\n\tcomponents: {\n\t\tBIcon,\n\t\tRouteActionMenu,\n\t},\n\n\tprops: {\n\t\tentityId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tentityType: {\n\t\t\ttype: String,\n\t\t\tdefault: EntityTypes.department,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tmenuVisible: false,\n\t\t};\n\t},\n\n\tcomputed: {\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t\tmenu(): EntityActionMenu\n\t\t{\n\t\t\treturn new EntityActionMenu(this.entityId, this.entityType, AnalyticsSourceType.NODE_DETAIL);\n\t\t},\n\t},\n\n\tmethods: {\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t\tonActionMenuItemClick(actionId: string): void\n\t\t{\n\t\t\tthis.menu.onActionMenuItemClick(actionId);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"menu.items.length\"\n\t\t\tclass=\"humanresources-detail-panel__edit-button\"\n\t\t\t:class=\"{ '--focused': menuVisible }\"\n\t\t\t:ref=\"'detailPanelEditButton'\"\n\t\t\tdata-id=\"hr-department-detail-panel__edit-menu-button\"\n\t\t\t@click.stop=\"menuVisible = true\"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tclass=\"humanresources-detail-panel__edit-button-icon\"\n\t\t\t\t:name=\"set.MORE\"\n\t\t\t\t:size=\"20\"\n\t\t\t/>\n\t\t</div>\n\t\t<RouteActionMenu\n\t\t\tv-if=\"menuVisible\"\n\t\t\tid=\"department-detail-content-edit-menu\"\n\t\t\t:items=\"menu.items\"\n\t\t\t:width=\"302\"\n\t\t\t:bindElement=\"$refs.detailPanelEditButton\"\n\t\t\t@action=\"onActionMenuItemClick\"\n\t\t\t@close=\"menuVisible = false\"\n\t\t/>\n\t`,\n};\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport type { BaseEvent } from 'main.core.events';\nimport { EventEmitter } from 'main.core.events';\nimport { events } from '../../consts';\nimport { DetailPanelCollapsedTitle } from './detail-panel-collapsed-title';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { mapState } from 'ui.vue3.pinia';\nimport { getMemberRoles, type MemberRolesType } from 'humanresources.company-structure.api';\nimport { DepartmentContent } from 'humanresources.company-structure.department-content';\nimport { Hint } from 'humanresources.company-structure.structure-components';\nimport { DetailPanelEditButton } from './detail-panel-edit-button';\n\nimport './style.css';\n\n// @vue/component\nexport const DetailPanel = {\n\tname: 'detailPanel',\n\n\tcomponents: { DepartmentContent, DetailPanelCollapsedTitle, DetailPanelEditButton },\n\n\tdirectives: { hint: Hint },\n\n\tprops: {\n\t\tpreventPanelSwitch: Boolean,\n\t\tmodelValue: Boolean,\n\t},\n\n\temits: ['showWizard', 'removeDepartment', 'update:modelValue'],\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\ttitle: '',\n\t\t\tisTeamEntity: false,\n\t\t\tteamColor: null,\n\t\t\tisCollapsed: true,\n\t\t\tisHidden: false,\n\t\t\tisLoading: true,\n\t\t\tneedToShowLoader: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\t...mapState(useChartStore, ['focusedNode', 'departments']),\n\t\tdefaultAvatar(): String\n\t\t{\n\t\t\treturn '/bitrix/js/humanresources/company-structure/org-chart/src/images/default-user.svg';\n\t\t},\n\t\theadAvatarsArray(): Array\n\t\t{\n\t\t\tconst heads = this.departments.get(this.focusedNode).heads ?? [];\n\n\t\t\treturn heads\n\t\t\t\t?.filter((employee) => employee.role === this.memberRoles.head)\n\t\t\t\t?.map((employee) => employee.avatar || this.defaultAvatar) ?? []\n\t\t\t;\n\t\t},\n\t\tentityType(): string\n\t\t{\n\t\t\treturn this.departments.get(this.focusedNode).entityType;\n\t\t},\n\t\tmemberRoles(): MemberRolesType\n\t\t{\n\t\t\treturn getMemberRoles(this.entityType);\n\t\t},\n\t\tisPanelCollapsed(): boolean\n\t\t{\n\t\t\treturn this.isCollapsed || this.isHidden;\n\t\t}\n\t},\n\n\twatch: {\n\t\tfocusedNode(newId: number, oldId: number): void\n\t\t{\n\t\t\tthis.updateDetailPageHandler(newId, oldId);\n\t\t},\n\t\tmodelValue(collapsed: boolean): void\n\t\t{\n\t\t\tthis.isCollapsed = collapsed;\n\t\t},\n\t\tdepartments: {\n\t\t\thandler(newDepartments): void\n\t\t\t{\n\t\t\t\tconst department = newDepartments.get(this.focusedNode);\n\t\t\t\tif (department)\n\t\t\t\t{\n\t\t\t\t\tthis.title = department.name ?? '';\n\t\t\t\t}\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\n\tcreated(): void\n\t{\n\t\tthis.subscribeOnEvents();\n\t},\n\n\tbeforeUnmount(): void\n\t{\n\t\tthis.unsubscribeFromEvents();\n\t},\n\n\tmethods:\n\t{\n\t\ttoggleCollapse(): void\n\t\t{\n\t\t\tthis.$emit('update:modelValue', !this.isCollapsed);\n\t\t},\n\t\tupdateDetailPageHandler(nodeId: number, oldId: number): void\n\t\t{\n\t\t\tif (!this.preventPanelSwitch && oldId !== 0)\n\t\t\t{\n\t\t\t\tthis.$emit('update:modelValue', false);\n\t\t\t}\n\n\t\t\tthis.isLoading = true;\n\t\t\tconst department = this.departments.get(nodeId);\n\n\t\t\tthis.isTeamEntity = department.entityType === EntityTypes.team;\n\t\t\tthis.title = department.name ?? '';\n\t\t\tthis.teamColor = department.teamColor ?? null;\n\t\t\tthis.isLoading = false;\n\t\t},\n\t\tshowLoader(): void\n\t\t{\n\t\t\tthis.needToShowLoader = true;\n\t\t},\n\t\thideLoader(): void\n\t\t{\n\t\t\tthis.needToShowLoader = false;\n\t\t},\n\t\tsubscribeOnEvents(): void\n\t\t{\n\t\t\tthis.events = {\n\t\t\t\t[events.HR_ENTITY_TOGGLE_ELEMENTS]: this.onToggleDetailPanel,\n\t\t\t};\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.subscribe(event, handle);\n\t\t\t});\n\t\t},\n\t\tunsubscribeFromEvents(): void\n\t\t{\n\t\t\tObject.entries(this.events).forEach(([event, handle]) => {\n\t\t\t\tEventEmitter.unsubscribe(event, handle);\n\t\t\t});\n\t\t},\n\t\tonToggleDetailPanel({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { shouldShowElements } = data;\n\t\t\tthis.isHidden = !shouldShowElements;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"['humanresources-detail-panel', { '--collapsed': isPanelCollapsed }]\"\n\t\t\tv-on=\"isPanelCollapsed ? { click: toggleCollapse } : {}\"\n\t\t\tdata-id=\"hr-department-detail-panel__container\"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-if=\"!isLoading\"\n\t\t\t\tclass=\"humanresources-detail-panel-container\"\n\t\t\t\t:class=\"{ '--hide': needToShowLoader && !isPanelCollapsed }\"\n\t\t\t>\n\t\t\t\t<div class=\"humanresources-detail-panel__head\" \n\t\t\t\t\t :class=\"{ '--team': isTeamEntity, '--collapsed': isPanelCollapsed }\"\n\t\t\t\t\t :style=\"{ '--team-head-background': teamColor?.treeHeadBackground }\"\n\t\t\t\t>\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if=\"!isPanelCollapsed\"\n\t\t\t\t\t\tv-hint\n\t\t\t\t\t\tclass=\"humanresources-detail-panel__title\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ title }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<DetailPanelCollapsedTitle\n\t\t\t\t\t\tv-else\n\t\t\t\t\t\t:title=\"title\"\n\t\t\t\t\t\t:avatars=\"headAvatarsArray\"\n\t\t\t\t\t>\n\t\t\t\t\t</DetailPanelCollapsedTitle>\n\t\t\t\t\t<div class=\"humanresources-detail-panel__header_buttons_container\">\n\t\t\t\t\t\t<DetailPanelEditButton\n\t\t\t\t\t\t\tv-if=\"!isPanelCollapsed\"\n\t\t\t\t\t\t\t:entityId=\"focusedNode\"\n\t\t\t\t\t\t\t:entityType=\"entityType\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass=\"humanresources-detail-panel__collapse_button --icon\"\n\t\t\t\t\t\t\t@click=\"toggleCollapse\"\n\t\t\t\t\t\t\t:class=\"{ '--collapsed': isPanelCollapsed }\"\n\t\t\t\t\t\t\tdata-id=\"hr-department-detail-panel__collapse-button\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"humanresources-detail-panel__content\" v-show=\"!isPanelCollapsed\">\n\t\t\t\t\t<DepartmentContent\n\t\t\t\t\t\t@showDetailLoader=\"showLoader\"\n\t\t\t\t\t\t@hideDetailLoader=\"hideLoader\"\n\t\t\t\t\t\t:isCollapsed=\"isPanelCollapsed\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"needToShowLoader && !isPanelCollapsed\" class=\"humanresources-detail-panel-loader-container\"/>\n\t\t</div>\n\t`,\n};\n","import 'ui.buttons';\nimport 'ui.forms';\nimport './style.css';\nimport { chartAPI } from '../../api';\nimport { events } from '../../consts';\nimport { BIcon, Set } from 'ui.icon-set.api.vue';\nimport type { FirstPopupData } from '../../types';\n\n// @vue/component\nexport const FirstPopup = {\n\tname: 'FirstPopup',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\n\tdata(): FirstPopupData\n\t{\n\t\treturn {\n\t\t\tshow: false,\n\t\t\ttitle: '',\n\t\t\tdescription: '',\n\t\t\tsubDescription: '',\n\t\t\tfeatures: [],\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\tset(): Set\n\t\t{\n\t\t\treturn Set;\n\t\t},\n\t},\n\n\tasync mounted(): Promise<void>\n\t{\n\t\tthis.title = this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_TITLE');\n\t\tthis.description = this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_DESCRIPTION');\n\t\tthis.subDescription = this.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_SUB_DESCRIPTION');\n\t\tthis.features = [\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_1'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_2'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_3'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_4'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_5'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_6'),\n\t\t\tthis.loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_FEATURE_7'),\n\t\t];\n\n\t\tconst { firstTimeOpened } = await chartAPI.getDictionary();\n\t\tthis.show = firstTimeOpened === 'N' && this.title.length > 0;\n\t},\n\n\tmethods: {\n\t\tclosePopup(): void\n\t\t{\n\t\t\tchartAPI.firstTimeOpened();\n\t\t\tthis.show = false;\n\t\t\ttop.BX.Event.EventEmitter.emit(events.HR_FIRST_POPUP_SHOW);\n\t\t},\n\t\tloc(phraseCode: string, replacements: { [p: string]: string } = {}): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(phraseCode, replacements);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div v-if=\"show\" class=\"first-popup\">\n\t\t\t<div class=\"first-popup-overlay\" @click=\"closePopup\"></div>\n\t\t\t<div class=\"first-popup-content\">\n\t\t\t\t<div class=\"title\">{{ title }}</div>\n\t\t\t\t<div class=\"first-popup-left\">\n\t\t\t\t\t<p class=\"description\">{{ description }}</p>\n\t\t\t\t\t<p class=\"sub-description\">{{ subDescription }}</p>\n\t\t\t\t\t<div class=\"first-popup-list\">\n\t\t\t\t\t\t<div class=\"first-popup-list-item\" v-for=\"(feature, index) in features\" :key=\"index\">\n\t\t\t\t\t\t\t<div class=\"first-popup-list-item-point\"></div>\n\t\t\t\t\t\t\t<div class=\"first-popup-list-item-feature\">{{ feature }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class=\"ui-btn ui-btn-success first-popup-ui-btn\" @click=\"closePopup\">\n\t\t\t\t\t\t{{ loc('HUMANRESOURCES_COMPANY_STRUCTURE_FIRST_OPEN_BUTTON_START') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"first-popup-right\">\n\t\t\t\t\t<video\n\t\t\t\t\t\tsrc=\"/bitrix/js/humanresources/company-structure/org-chart/src/components/first-popup/images/preview.webm\"\n\t\t\t\t\t\tautoplay\n\t\t\t\t\t\tloop\n\t\t\t\t\t\tmuted\n\t\t\t\t\t\tplaysinline\n\t\t\t\t\t\tclass=\"first-popup-animation\"\n\t\t\t\t\t></video>\n\t\t\t\t</div>\n\t\t\t\t<BIcon :name=\"set.CROSS_25\" :size=\"24\" class=\"first-popup-close\" @click=\"closePopup\"></BIcon>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { Confetti } from 'ui.confetti';\nimport { mapState } from 'ui.vue3.pinia';\nimport { TransformCanvas } from 'ui.canvas';\nimport { AnalyticsSourceType } from 'humanresources.company-structure.api';\nimport { TitlePanel } from './components/title-panel/title-panel';\nimport { Tree } from './components/tree/tree';\nimport { TransformPanel } from './components/transfrom-panel';\nimport { DetailPanel } from './components/detail-panel/detail-panel';\nimport { FirstPopup } from './components/first-popup/first-popup';\nimport { useChartStore } from 'humanresources.company-structure.chart-store';\nimport { ChartWizard } from 'humanresources.company-structure.chart-wizard';\nimport { EntityTypes, getInvitedUserData } from 'humanresources.company-structure.utils';\nimport { chartAPI } from './api';\nimport { events, detailPanelWidth } from './consts';\nimport { OrgChartActions } from './actions';\nimport { sendData as analyticsSendData } from 'ui.analytics';\nimport { addCustomEvent, removeCustomEvent } from 'main.core';\n\nimport type { ChartData } from './types';\nimport './style.css';\nimport 'ui.design-tokens';\n\n// @vue/component\nexport const Chart = {\n\tcomponents: {\n\t\tTransformCanvas,\n\t\tTree,\n\t\tTransformPanel,\n\t\tChartWizard,\n\t\tFirstPopup,\n\t\tDetailPanel,\n\t\tTitlePanel,\n\t},\n\n\tdata(): ChartData\n\t{\n\t\treturn {\n\t\t\tcanvas: {\n\t\t\t\tshown: false,\n\t\t\t\tmoved: false,\n\t\t\t\tmodelTransform: {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t\tzoom: 0.3,\n\t\t\t\t},\n\t\t\t},\n\t\t\twizard: {\n\t\t\t\tshown: false,\n\t\t\t\tisEditMode: false,\n\t\t\t\tshowEntitySelector: true,\n\t\t\t\tentity: '',\n\t\t\t\tnodeId: 0,\n\t\t\t\tsource: '',\n\t\t\t},\n\t\t\tdetailPanel: {\n\t\t\t\tcollapsed: true,\n\t\t\t\tpreventSwitch: false,\n\t\t\t},\n\t\t\t// so we block all controls until transition isn't completed\n\t\t\tisTransitionCompleted: false,\n\t\t\tanalyticsQueue: [],\n\t\t\tisAnalyticsBusy: false,\n\t\t};\n\t},\n\n\tcomputed:\n\t{\n\t\trootId(): number\n\t\t{\n\t\t\tconst { id: rootId } = [...this.departments.values()].find((department) => {\n\t\t\t\treturn department.parentId === 0;\n\t\t\t});\n\n\t\t\treturn rootId;\n\t\t},\n\t\t...mapState(useChartStore, ['departments', 'currentDepartments']),\n\t},\n\n\tasync created(): Promise<void>\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\tslider?.showLoader();\n\t\tconst [departmentsData, currentDepartments, userId] = await Promise.all([\n\t\t\tchartAPI.getDepartmentsData(),\n\t\t\tchartAPI.getCurrentDepartments(),\n\t\t\tchartAPI.getUserId(),\n\t\t]);\n\t\tslider?.closeLoader();\n\t\tconst departments = departmentsData.structure;\n\t\tconst structureMap = Object.entries(departmentsData.map).reduce((map, [id, value]) => {\n\t\t\tmap.set(Number(id), { id: Number(id), ...value });\n\n\t\t\treturn map;\n\t\t}, new Map());\n\t\tconst multipleUsers = departmentsData.multipleMembers ?? [];\n\t\tconst parsedDepartments = chartAPI.createTreeDataStore(departments);\n\t\tconst availableDepartments = currentDepartments.filter((item) => parsedDepartments.has(item));\n\t\tOrgChartActions.applyData(parsedDepartments, availableDepartments, userId, structureMap, multipleUsers);\n\t\tthis.rootOffset = 100;\n\t\tthis.transformCanvas();\n\t\tthis.canvas.shown = true;\n\t\tthis.showConfetti = false;\n\t\tEventEmitter.subscribe(events.HR_DEPARTMENT_SLIDER_ON_MESSAGE, this.handleInviteSliderMessage);\n\t\tBX.PULL.subscribe({\n\t\t\ttype: BX.PullClient.SubscriptionType.Server,\n\t\t\tmoduleId: 'humanresources',\n\t\t\tcommand: 'linkChatsToNodes',\n\t\t\tcallback: (data) => this.clearChatLists(data),\n\t\t});\n\t\tEventEmitter.subscribe(events.HR_ENTITY_SHOW_WIZARD, this.showWizardEventHandler);\n\t\tEventEmitter.subscribe(events.HR_ENTITY_REMOVE, this.removeDepartmentEventHandler);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_TRANSFORM_CANVAS, this.onCanvasTransformWhenDragging);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT, this.onLocate);\n\n\t\tthis.handleAnalyticsAjaxSuccess = this.handleAnalyticsAjaxSuccess.bind(this);\n\t\taddCustomEvent('OnAjaxSuccess', this.handleAnalyticsAjaxSuccess);\n\t},\n\n\tunmounted(): void\n\t{\n\t\tEventEmitter.unsubscribe(events.HR_DEPARTMENT_SLIDER_ON_MESSAGE, this.handleInviteSliderMessage);\n\t\tEventEmitter.unsubscribe(events.HR_ENTITY_SHOW_WIZARD, this.showWizardEventHandler);\n\t\tEventEmitter.unsubscribe(events.HR_ENTITY_REMOVE, this.removeDepartmentEventHandler);\n\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_TRANSFORM_CANVAS, this.onCanvasTransformWhenDragging);\n\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_LOCATE_TO_DEPARTMENT, this.onLocate);\n\n\t\tremoveCustomEvent('OnAjaxSuccess', this.handleAnalyticsAjaxSuccess);\n\t},\n\n\tmethods:\n\t{\n\t\tonMoveTo({ x, y, nodeId }: { x: Number; y: Number; nodeId: Number; }): void\n\t\t{\n\t\t\tconst { x: prevX, y: prevY, zoom } = this.canvas.modelTransform;\n\t\t\tconst detailPanelWidthZoomed = detailPanelWidth * zoom;\n\t\t\tconst newX = x - detailPanelWidthZoomed / 2;\n\t\t\tconst newY = nodeId === this.rootId ? this.rootOffset : y / zoom;\n\t\t\tconst samePoint = Math.round(newX) === Math.round(prevX) && Math.round(y) === Math.round(prevY);\n\t\t\tthis.detailPanel = {\n\t\t\t\t...this.detailPanel,\n\t\t\t\tcollapsed: false,\n\t\t\t};\n\t\t\tif (samePoint)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.canvas = {\n\t\t\t\t...this.canvas,\n\t\t\t\tmoved: true,\n\t\t\t\tmodelTransform: { ...this.canvas.modelTransform, x: newX / zoom, y: newY, zoom: 1 },\n\t\t\t};\n\t\t\tthis.onUpdateTransform();\n\t\t},\n\t\tonLocate({ data }: BaseEvent): void\n\t\t{\n\t\t\tif (data.nodeId)\n\t\t\t{\n\t\t\t\tthis.$refs.tree.locateToDepartment(data.nodeId);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$refs.tree.locateToCurrentDepartment();\n\t\t},\n\t\tshowWizardEventHandler({ data }: BaseEvent): void\n\t\t{\n\t\t\tthis.onShowWizard(data);\n\t\t},\n\t\tsendAnalyticsSequentially(data)\n\t\t{\n\t\t\tthis.analyticsQueue.push(data);\n\t\t\tthis.processAnalyticsQueue();\n\t\t},\n\t\tprocessAnalyticsQueue()\n\t\t{\n\t\t\tif (this.isAnalyticsBusy || this.analyticsQueue.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isAnalyticsBusy = true;\n\t\t\tconst dataToSend = this.analyticsQueue[0];\n\n\t\t\tanalyticsSendData(dataToSend);\n\t\t},\n\n\t\thandleAnalyticsAjaxSuccess()\n\t\t{\n\t\t\tif (!this.isAnalyticsBusy)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.analyticsQueue.shift();\n\t\t\tthis.isAnalyticsBusy = false;\n\n\t\t\tthis.processAnalyticsQueue();\n\t\t},\n\t\tonShowWizard({\n\t\t\tnodeId = 0,\n\t\t\tisEditMode = false,\n\t\t\ttype,\n\t\t\tshowEntitySelector = true,\n\t\t\tsource = '',\n\t\t\tentityType,\n\t\t\trefToFocus,\n\t\t}: {\n\t\t\tnodeId: number;\n\t\t\tisEditMode: boolean,\n\t\t\ttype: string,\n\t\t\tshowEntitySelector: boolean,\n\t\t\tsource: string,\n\t\t\tentityType: string,\n\t\t\trefToFocus: any\n\t\t} = {}): void\n\t\t{\n\t\t\tlet analyticsType = null;\n\t\t\tif (entityType === EntityTypes.team)\n\t\t\t{\n\t\t\t\tanalyticsType = 'team';\n\t\t\t}\n\t\t\telse if (entityType === EntityTypes.department || entityType === EntityTypes.company)\n\t\t\t{\n\t\t\t\tanalyticsType = 'dept';\n\t\t\t}\n\n\t\t\tthis.wizard = {\n\t\t\t\t...this.wizard,\n\t\t\t\tshown: true,\n\t\t\t\tisEditMode,\n\t\t\t\tshowEntitySelector,\n\t\t\t\tentity: type,\n\t\t\t\tnodeId,\n\t\t\t\tsource,\n\t\t\t\tentityType,\n\t\t\t\trefToFocus,\n\t\t\t};\n\n\t\t\tif (!isEditMode && source !== AnalyticsSourceType.HEADER)\n\t\t\t{\n\t\t\t\tthis.sendAnalyticsSequentially({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: 'create_wizard',\n\t\t\t\t\ttype: analyticsType,\n\t\t\t\t\tc_element: source,\n\t\t\t\t});\n\n\t\t\t\tif (entityType === EntityTypes.team)\n\t\t\t\t{\n\t\t\t\t\tthis.sendAnalyticsSequentially({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: 'create_team_step1',\n\t\t\t\t\t\ttype: analyticsType,\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (isEditMode)\n\t\t\t{\n\t\t\t\tanalyticsSendData({\n\t\t\t\t\ttool: 'structure',\n\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\tevent: `edit_${analyticsType}`,\n\t\t\t\t\tc_element: source,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line default-case\n\t\t\tswitch (type)\n\t\t\t{\n\t\t\t\tcase 'department':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: `create_${analyticsType}_step1`,\n\t\t\t\t\t\ttype: analyticsType,\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'employees':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: `create_${analyticsType}_step2`,\n\t\t\t\t\t\ttype: analyticsType,\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bindChat':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: `create_${analyticsType}_step3`,\n\t\t\t\t\t\ttype: analyticsType,\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'teamRights':\n\t\t\t\t\tanalyticsSendData({\n\t\t\t\t\t\ttool: 'structure',\n\t\t\t\t\t\tcategory: 'structure',\n\t\t\t\t\t\tevent: `create_${analyticsType}_step4`,\n\t\t\t\t\t\ttype: analyticsType,\n\t\t\t\t\t\tc_element: source,\n\t\t\t\t\t});\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\t\tonModifyTree({ id, showConfetti }): void\n\t\t{\n\t\t\tthis.showConfetti = showConfetti ?? false;\n\t\t\tconst { tree } = this.$refs;\n\t\t\ttree.locateToDepartment(id);\n\t\t},\n\t\tonWizardClose(): void\n\t\t{\n\t\t\tthis.wizard.shown = false;\n\t\t},\n\t\tremoveDepartmentEventHandler({ data }: BaseEvent): void\n\t\t{\n\t\t\tthis.onRemoveDepartment(data.nodeId, data.entityType);\n\t\t},\n\t\tonRemoveDepartment(nodeId: number, entityType: string): void\n\t\t{\n\t\t\tconst { tree } = this.$refs;\n\t\t\ttree.tryRemoveDepartment(nodeId, entityType);\n\t\t},\n\t\tasync onTransitionEnd(): Promise<void>\n\t\t{\n\t\t\tif (this.canvas.moved)\n\t\t\t{\n\t\t\t\tthis.isTransitionCompleted = true;\n\t\t\t}\n\n\t\t\tthis.canvas.moved = false;\n\t\t\tif (!this.showConfetti)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isTransitionCompleted = false;\n\t\t\tconst promise = Confetti.fire({\n\t\t\t\tparticleCount: 300,\n\t\t\t\tstartVelocity: 10,\n\t\t\t\tspread: 400,\n\t\t\t\tticks: 100,\n\t\t\t\torigin: { y: 0.4, x: 0.37 },\n\t\t\t});\n\t\t\tthis.showConfetti = false;\n\t\t\tawait promise;\n\t\t\tthis.isTransitionCompleted = true;\n\t\t},\n\t\tonControlDetail({ showEmployees, preventSwitch }): void\n\t\t{\n\t\t\tthis.detailPanel = {\n\t\t\t\t...this.detailPanel,\n\t\t\t\tpreventSwitch,\n\t\t\t};\n\t\t\tif (!showEmployees)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.detailPanel = {\n\t\t\t\t...this.detailPanel,\n\t\t\t\tcollapsed: false,\n\t\t\t};\n\t\t},\n\t\ttransformCanvas(): void\n\t\t{\n\t\t\tconst { zoom } = this.canvas.modelTransform;\n\t\t\tconst { offsetWidth, offsetHeight } = this.$el;\n\t\t\tconst [currentDepartment] = this.currentDepartments;\n\t\t\tconst y = currentDepartment === this.rootId ? this.rootOffset : offsetHeight / 2 - (offsetHeight * zoom) / 2;\n\t\t\tthis.canvas.modelTransform = {\n\t\t\t\t...this.canvas.modelTransform,\n\t\t\t\tx: offsetWidth / 2 - (offsetWidth * zoom) / 2,\n\t\t\t\ty,\n\t\t\t};\n\t\t},\n\t\tonUpdateTransform(): void\n\t\t{\n\t\t\tEventEmitter.emit(events.INTRANET_USER_MINIPROFILE_CLOSE);\n\t\t\tEventEmitter.emit(events.HR_DEPARTMENT_MENU_CLOSE);\n\t\t},\n\t\thandleInviteSliderMessage(event: BaseEvent): void\n\t\t{\n\t\t\tconst [messageEvent] = event.getData();\n\t\t\tconst eventId = messageEvent.getEventId();\n\t\t\tif (eventId !== 'BX.Intranet.Invitation:onAdd')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { users } = messageEvent.getData();\n\t\t\tusers.forEach((user) => {\n\t\t\t\tconst invitedUserData = getInvitedUserData(user);\n\t\t\t\tOrgChartActions.inviteUser(invitedUserData);\n\t\t\t});\n\t\t},\n\t\tclearChatLists(data): void\n\t\t{\n\t\t\tconst nodeIds = Object.keys(data).map((key) => Number(key));\n\t\t\tOrgChartActions.clearNodesChatLists(nodeIds);\n\t\t},\n\t\tonKeyDown(event: KeyboardEvent): void\n\t\t{\n\t\t\tif (!this.isTransitionCompleted)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t},\n\t\tonCanvasTransformWhenDragging({ data }: BaseEvent): void\n\t\t{\n\t\t\tconst { directionX, directionY, speed } = data;\n\t\t\tif (directionX !== 0)\n\t\t\t{\n\t\t\t\tthis.canvas.modelTransform.x += -directionX * speed;\n\t\t\t}\n\n\t\t\tif (directionY !== 0)\n\t\t\t{\n\t\t\t\tthis.canvas.modelTransform.y += -directionY * speed;\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"humanresources-chart\"\n\t\t\t:class=\"{ '--locked': !isTransitionCompleted }\"\n\t\t\t@keydown=\"onKeyDown\"\n\t\t>\n\t\t\t<TitlePanel @showWizard=\"onShowWizard\"></TitlePanel>\n\t\t\t<TransformCanvas\n\t\t\t\tv-if=\"canvas.shown\"\n\t\t\t\tv-slot=\"{transform}\"\n\t\t\t\tv-model=\"canvas.modelTransform\"\n\t\t\t\t@update:modelValue=\"onUpdateTransform\"\n\t\t\t\t:class=\"{ '--moved': canvas.moved }\"\n\t\t\t\t@transitionend=\"onTransitionEnd\"\n\t\t\t>\n\t\t\t\t<Tree\n\t\t\t\t\t:canvasTransform=\"transform\"\n\t\t\t\t\tref=\"tree\"\n\t\t\t\t\t@moveTo=\"onMoveTo\"\n\t\t\t\t\t@showWizard=\"onShowWizard\"\n\t\t\t\t\t@controlDetail=\"onControlDetail\"\n\t\t\t\t></Tree>\n\t\t\t</TransformCanvas>\n\t\t\t<DetailPanel\n\t\t\t\t@showWizard=\"onShowWizard\"\n\t\t\t\t@removeDepartment=\"onRemoveDepartment\"\n\t\t\t\tv-model=\"detailPanel.collapsed\"\n\t\t\t\t:preventPanelSwitch=\"detailPanel.preventSwitch\"\n\t\t\t></DetailPanel>\n\t\t\t<TransformPanel\n\t\t\t\tv-model=\"canvas.modelTransform\"\n\t\t\t></TransformPanel>\n\t\t\t<ChartWizard\n\t\t\t\tv-if=\"wizard.shown\"\n\t\t\t\t:nodeId=\"wizard.nodeId\"\n\t\t\t\t:isEditMode=\"wizard.isEditMode\"\n\t\t\t\t:showEntitySelector=\"wizard.showEntitySelector\"\n\t\t\t\t:entity=\"wizard.entity\"\n\t\t\t\t:entityType=\"wizard.entityType\"\n\t\t\t\t:source=\"wizard.source\"\n\t\t\t\t:refToFocus=\"wizard.refToFocus\"\n\t\t\t\t@modifyTree=\"onModifyTree\"\n\t\t\t\t@close=\"onWizardClose\"\n\t\t\t></ChartWizard>\n\t\t\t<FirstPopup></FirstPopup>\n\t\t\t<div class=\"humanresources-chart__back\"></div>\n\t\t</div>\n\t`,\n};\n","import { AbstractActionMenu } from '../abstract-action-menu';\nimport { AddEmployeeMenuItem } from '../items/employees/add-employee-menu-item';\n\nexport class UsersTabActionMenu extends AbstractActionMenu\n{\n\tconstructor(entityId: number, analyticSource: string, role: string, entityType: string)\n\t{\n\t\tsuper(entityId);\n\t\tthis.analyticSource = analyticSource;\n\t\tthis.role = role;\n\t\tthis.entityType = entityType;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\treturn [\n\t\t\tnew AddEmployeeMenuItem(this.entityType, this.role),\n\t\t];\n\t}\n}\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { AddEmployeeMenuItem } from '../items/employees/add-employee-menu-item';\nimport { MoveEmployeeMenuItem } from '../items/employees/move-employee-menu-item';\nimport { UserInviteMenuItem } from '../items/employees/user-invite-menu-item';\n\nexport class EmptyUsersTabActionMenu extends AbstractActionMenu\n{\n\tconstructor(entityId: number, analyticSource: string, role: string, entityType: string)\n\t{\n\t\tsuper(entityId);\n\t\tthis.entityType = entityType;\n\t\tthis.analyticSource = analyticSource;\n\t\tthis.role = role;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn [\n\t\t\t\tnew AddEmployeeMenuItem(this.entityType, this.role),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tnew MoveEmployeeMenuItem(),\n\t\t\tnew UserInviteMenuItem(),\n\t\t\tnew AddEmployeeMenuItem(this.entityType, this.role),\n\t\t];\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class FireUserFromCompanyMenuItem extends AbstractMenuItem\n{\n\tconstructor(isUserInvited: boolean)\n\t{\n\t\tsuper({\n\t\t\tid: MenuActions.fireUserFromCompany,\n\t\t\ttitle: isUserInvited\n\t\t\t\t? Loc.getMessage(\n\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_DELETE_FROM_COMPANY_TITLE',\n\t\t\t\t)\n\t\t\t\t: Loc.getMessage(\n\t\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_FIRE_FROM_COMPANY_TITLE',\n\t\t\t\t),\n\t\t\tdescription: Loc.getMessage(\n\t\t\t\t'HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_FIRE_FROM_COMPANY_SUBTITLE_MSGVER_1',\n\t\t\t),\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSONS_DENY,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteRed40'),\n\t\t\t},\n\t\t\tpermissionAction: isUserInvited ? '' : PermissionActions.employeeFire,\n\t\t\tdataTestId: 'hr-department-detail-content__user-list_fire-user-from-department',\n\t\t});\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn permissionChecker.hasPermissionOfAction(this.permissionAction);\n\t}\n}\n","import type { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class MoveFromDepartmentMenuItem extends AbstractMenuItem\n{\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_TITLE')\n\t\t;\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_TEAM_SUBTITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_MOVE_TO_ANOTHER_DEPARTMENT_SUBTITLE')\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.moveUserToAnotherDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.PERSON_ARROW_LEFT_1,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-department-detail-content__user-list_move-from-department',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\tconst permissions = permissionChecker.currentUserPermissions;\n\n\t\tconst addMemberPermissionAction = this.entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamAddMember\n\t\t\t: PermissionActions.employeeAddToDepartment\n\t\t;\n\n\t\tconst removeMemberPermissionAction = this.entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamRemoveMember\n\t\t\t: PermissionActions.employeeRemoveFromDepartment\n\t\t;\n\n\t\tconst addMemberPermissionValue = this.entityType === EntityTypes.team\n\t\t\t? permissions.ACTION_TEAM_MEMBER_ADD\n\t\t\t: permissions.ACTION_EMPLOYEE_ADD_TO_DEPARTMENT\n\t\t;\n\n\t\tconst removeMemberPermissionValue = this.entityType === EntityTypes.team\n\t\t\t? permissions.ACTION_TEAM_MEMBER_REMOVE\n\t\t\t: permissions.ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT\n\t\t;\n\n\t\tconst moveUserPermission = addMemberPermissionValue < removeMemberPermissionValue\n\t\t\t? addMemberPermissionAction\n\t\t\t: removeMemberPermissionAction\n\t\t;\n\n\t\treturn permissionChecker.hasPermission(moveUserPermission, entityId);\n\t}\n}\n","import { PermissionActions } from 'humanresources.company-structure.permission-checker';\nimport { EntityTypes, getColorCode } from 'humanresources.company-structure.utils';\nimport { Loc } from 'main.core';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\n\nexport class RemoveFromDepartmentMenuItem extends AbstractMenuItem\n{\n\tconstructor(entityType: string)\n\t{\n\t\tconst title = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_TEAM_TITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_DEPARTMENT_TITLE')\n\t\t;\n\n\t\tconst description = entityType === EntityTypes.team\n\t\t\t? Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_TEAM_SUBTITLE')\n\t\t\t: Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_USER_LIST_ACTION_MENU_REMOVE_FROM_DEPARTMENT_SUBTITLE')\n\t\t;\n\n\t\tconst color = entityType === EntityTypes.team\n\t\t\t? getColorCode('paletteRed40')\n\t\t\t: getColorCode('paletteBlue50')\n\t\t;\n\n\t\tconst permissionAction = entityType === EntityTypes.team\n\t\t\t? PermissionActions.teamRemoveMember\n\t\t\t: PermissionActions.employeeRemoveFromDepartment\n\t\t;\n\n\t\tsuper({\n\t\t\tid: MenuActions.removeUserFromDepartment,\n\t\t\ttitle,\n\t\t\tdescription,\n\t\t\tbIcon: {\n\t\t\t\tname: Main.TRASH_BIN,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor,\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-department-detail-content__user-list_remove-from-department',\n\t\t});\n\t}\n}\n","import { EntityTypes } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { FireUserFromCompanyMenuItem } from '../items/user-item/fire-user-from-company';\nimport { MoveFromDepartmentMenuItem } from '../items/user-item/move-from-department';\nimport { RemoveFromDepartmentMenuItem } from '../items/user-item/remove-from-department';\n\nexport class UserListActionMenu extends AbstractActionMenu\n{\n\tisUserInvited: boolean;\n\n\tconstructor(entityId: number, entityType: string, isUserInvited: boolean)\n\t{\n\t\tsuper(entityId);\n\t\tthis.isUserInvited = isUserInvited;\n\t\tthis.entityType = entityType;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\tif (this.entityType === EntityTypes.team)\n\t\t{\n\t\t\treturn [\n\t\t\t\tnew MoveFromDepartmentMenuItem(this.entityType),\n\t\t\t\tnew RemoveFromDepartmentMenuItem(this.entityType),\n\t\t\t];\n\t\t}\n\n\t\treturn [\n\t\t\tnew MoveFromDepartmentMenuItem(this.entityType),\n\t\t\tnew RemoveFromDepartmentMenuItem(this.entityType),\n\t\t\tnew FireUserFromCompanyMenuItem(this.isUserInvited),\n\t\t];\n\t}\n}\n","import type { CommunicationDetailed } from 'humanresources.company-structure.utils';\nimport { getColorCode, ChatTypes } from 'humanresources.company-structure.utils';\nimport { Main } from 'ui.icon-set.api.core';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { MenuActions } from '../../menu-actions';\nimport { Loc } from 'main.core';\n\n/**\n * Menu item for opening a chat or channel.\n * Displays appropriate title, and description based on chat type.\n * Checks permissions using hasAccess property of the chat.\n */\nexport class OpenChatMenuItem extends AbstractMenuItem\n{\n\tchat: CommunicationDetailed;\n\n\tstatic Dictionary = Object.freeze({\n\t\t[ChatTypes.chat]: {\n\t\t\ttitle: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHAT_TITLE',\n\t\t\tdescription: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHAT_DESCRIPTION',\n\t\t},\n\t\t[ChatTypes.channel]: {\n\t\t\ttitle: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHANNEL_TITLE',\n\t\t\tdescription: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_CHANNEL_DESCRIPTION',\n\t\t},\n\t\t[ChatTypes.collab]: {\n\t\t\ttitle: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_COLLAB_TITLE',\n\t\t\tdescription: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_OPEN_COLLAB_DESCRIPTION',\n\t\t},\n\t});\n\n\tconstructor(entityType: string, chat: CommunicationDetailed)\n\t{\n\t\tconst { title, description } = OpenChatMenuItem.Dictionary[chat.type] || {};\n\n\t\tsuper({\n\t\t\tid: MenuActions.openChat,\n\t\t\ttitle: Loc.getMessage(title),\n\t\t\tdescription: Loc.getMessage(description),\n\t\t\tbIcon: {\n\t\t\t\tname: Main.EDIT_PENCIL,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteBlue50'),\n\t\t\t},\n\t\t\tpermissionAction: null,\n\t\t\tdataTestId: 'hr-department-detail-content__chat-list_open-chat',\n\t\t});\n\n\t\tthis.entityType = entityType;\n\t\tthis.chat = chat;\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn this.chat.hasAccess;\n\t}\n}\n","import type { CommunicationDetailed } from 'humanresources.company-structure.utils';\nimport { EntityTypes, getColorCode, ChatTypes } from 'humanresources.company-structure.utils';\nimport { Main } from 'ui.icon-set.api.core';\nimport { PermissionActions, PermissionCheckerClass } from 'humanresources.company-structure.permission-checker';\nimport { AbstractMenuItem } from '../abstract-menu-item';\nimport { MenuActions } from '../../menu-actions';\nimport { Loc } from 'main.core';\n\n/**\n * Menu item for unbinding a chat or channel from a team or department.\n * Displays appropriate title, description, and permission requirements\n * based on the entity type and chat type.\n */\nexport class UnbindChatMenuItem extends AbstractMenuItem\n{\n\tchat: CommunicationDetailed;\n\n\tstatic Dictionary = Object.freeze({\n\t\t[EntityTypes.team]: {\n\t\t\t[ChatTypes.chat]: {\n\t\t\t\ttitle: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHAT_TITLE',\n\t\t\t\tdescription: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHAT_DESCRIPTION',\n\t\t\t\tpermissionAction: PermissionActions.teamChatEdit,\n\t\t\t},\n\t\t\t[ChatTypes.channel]: {\n\t\t\t\ttitle: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHANNEL_TITLE',\n\t\t\t\tdescription: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_CHANNEL_DESCRIPTION',\n\t\t\t\tpermissionAction: PermissionActions.teamChannelEdit,\n\t\t\t},\n\t\t\t[ChatTypes.collab]: {\n\t\t\t\ttitle: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_COLLAB_TITLE',\n\t\t\t\tdescription: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_TEAM_COLLAB_DESCRIPTION',\n\t\t\t\tpermissionAction: PermissionActions.teamCollabEdit,\n\t\t\t},\n\t\t},\n\t\t[EntityTypes.department]: {\n\t\t\t[ChatTypes.chat]: {\n\t\t\t\ttitle: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHAT_TITLE',\n\t\t\t\tdescription: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHAT_DESCRIPTION',\n\t\t\t\tpermissionAction: PermissionActions.departmentChatEdit,\n\t\t\t},\n\t\t\t[ChatTypes.channel]: {\n\t\t\t\ttitle: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHANNEL_TITLE',\n\t\t\t\tdescription: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_CHANNEL_DESCRIPTION',\n\t\t\t\tpermissionAction: PermissionActions.departmentChannelEdit,\n\t\t\t},\n\t\t\t[ChatTypes.collab]: {\n\t\t\t\ttitle: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_COLLAB_TITLE',\n\t\t\t\tdescription: 'HUMANRESOURCES_COMPANY_STRUCTURE_CHAT_LIST_ACTION_MENU_UNBIND_DEPARTMENT_COLLAB_DESCRIPTION',\n\t\t\t\tpermissionAction: PermissionActions.departmentCollabEdit,\n\t\t\t},\n\t\t},\n\t});\n\n\tconstructor(entityType: string, chat: CommunicationDetailed)\n\t{\n\t\tconst { title, description, permissionAction } = (UnbindChatMenuItem.Dictionary[entityType][chat.type]) || {};\n\n\t\tsuper({\n\t\t\tid: MenuActions.unbindChat,\n\t\t\ttitle: Loc.getMessage(title),\n\t\t\tdescription: Loc.getMessage(description),\n\t\t\tbIcon: {\n\t\t\t\tname: Main.TRASH_BIN,\n\t\t\t\tsize: 20,\n\t\t\t\tcolor: getColorCode('paletteRed40'),\n\t\t\t},\n\t\t\tpermissionAction,\n\t\t\tdataTestId: 'hr-department-detail-content__chat-list_unbind-chat',\n\t\t});\n\n\t\tthis.chat = chat;\n\t}\n\n\thasPermission(permissionChecker: PermissionCheckerClass, entityId: number): boolean\n\t{\n\t\treturn !this.chat.originalNodeId\n\t\t\t&& this.chat.hasAccess\n\t\t\t&& permissionChecker.hasPermission(this.permissionAction, entityId)\n\t\t;\n\t}\n}\n","import type { CommunicationDetailed } from 'humanresources.company-structure.utils';\nimport { AbstractActionMenu } from '../abstract-action-menu';\nimport { OpenChatMenuItem } from '../items/chats/open-chat-menu-item';\nimport { UnbindChatMenuItem } from '../items/chats/unbund-chat-menu-item';\n\n/**\n * Action menu for chat or channel items in the company structure.\n * Provides menu items to open or unbind a chat/channel.\n */\nexport class ChatListActionMenu extends AbstractActionMenu\n{\n\tchat: CommunicationDetailed;\n\n\tconstructor(entityType: number, chat: CommunicationDetailed, entityId: number)\n\t{\n\t\tsuper(entityId);\n\t\tthis.chat = chat;\n\t\tthis.entityType = entityType;\n\t\tthis.items = this.getFilteredItems();\n\t}\n\n\tgetItems(): Array\n\t{\n\t\treturn [\n\t\t\tnew OpenChatMenuItem(this.entityType, this.chat),\n\t\t\tnew UnbindChatMenuItem(this.entityType, this.chat),\n\t\t];\n\t}\n}\n","import { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { events } from './consts';\nimport { Dom, Loc, Tag } from 'main.core';\nimport { chartAPI } from './api';\n\nexport class NotConvertedState\n{\n\tstatic updateConvertedStatusInterval;\n\n\tstatic #subscribeOnEvents(): void\n\t{\n\t\tconst onCloseByEsc = (event: BaseEvent) => {\n\t\t\tconst [sidePanelEvent] = event.data;\n\t\t\tsidePanelEvent.denyAction();\n\t\t};\n\n\t\tconst onClose = () => {\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t\t\tclearInterval(this.updateConvertedStatusInterval);\n\t\t};\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t}\n\n\tstatic async mount(containerId: string): Promise<void>\n\t{\n\t\tconst container = document.getElementById(containerId);\n\t\tDom.append(this.#getNotConvertedStateScreen(), container);\n\t\tthis.#subscribeOnEvents();\n\n\t\tconst updateTimeMs = 30000;\n\t\tthis.updateConvertedStatusInterval = setInterval(async () => {\n\t\t\ttry\n\t\t\t{\n\t\t\t\tawait chartAPI.getDictionary();\n\t\t\t}\n\t\t\tcatch (e)\n\t\t\t{\n\t\t\t\tif (e.code === 'STRUCTURE_IS_NOT_CONVERTED')\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e.code === 'STRUCTURE_ACCESS_DENIED')\n\t\t\t\t{\n\t\t\t\t\tclearInterval(this.updateConvertedStatusInterval);\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t}\n\n\t\t\t\tthrow e;\n\t\t\t}\n\n\t\t\tclearInterval(this.updateConvertedStatusInterval);\n\t\t\twindow.location.reload();\n\t\t}, updateTimeMs);\n\t}\n\n\tstatic #getNotConvertedStateScreen(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"humanresources-not-converted-state-screen\">\n\t\t\t\t<div class=\"humanresources-not-converted-state-screen__icon\"></div>\n\t\t\t\t<div class=\"humanresources-not-converted-state-screen__title\">\n\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_NOT_CONVERTED_SCREEN_LOADING_TITLE')}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"humanresources-not-converted-state-screen__description\">\n\t\t\t\t\t${Loc.getMessage('HUMANRESOURCES_COMPANY_STRUCTURE_NOT_CONVERTED_SCREEN_LOADING_DESCRIPTION')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n}\n","import { EventEmitter, type BaseEvent } from 'main.core.events';\nimport { events } from './consts';\nimport { BitrixVue } from 'ui.vue3';\nimport { createPinia } from 'ui.vue3.pinia';\nimport { Dom } from 'main.core';\nimport { Chart } from './app';\nimport { PermissionChecker } from 'humanresources.company-structure.permission-checker';\n\nexport { UsersTabActionMenu } from './components/menu/menu/users-tab-action-menu';\nexport { EmptyUsersTabActionMenu } from './components/menu/menu/empty-users-tab-action-menu';\nexport { UserListActionMenu } from './components/menu/menu/user-list-item-action-menu';\nexport { ChatListActionMenu } from './components/menu/menu/chat-list-action-menu';\nexport { MenuActions } from './components/menu/menu-actions';\nexport { NotConvertedState } from './not-converted-state';\nexport { events } from './consts';\n\nexport class App\n{\n\tstatic #subscribeOnEvents(app: Object): void\n\t{\n\t\tconst onCloseByEsc = (event: BaseEvent) => {\n\t\t\tconst [sidePanelEvent] = event.data;\n\t\t\tsidePanelEvent.denyAction();\n\t\t};\n\n\t\tconst onClose = () => {\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\t\tEventEmitter.unsubscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t\t\tapp.unmount();\n\t\t};\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE_BY_ESC, onCloseByEsc);\n\t\tEventEmitter.subscribe(events.HR_ORG_CHART_CLOSE, onClose);\n\t}\n\n\tstatic async mount(containerId: string): Promise<void>\n\t{\n\t\tconst container = document.getElementById(containerId);\n\t\tconst app = BitrixVue.createApp(Chart);\n\t\tconst store = createPinia();\n\t\tapp.use(store);\n\t\tApp.#subscribeOnEvents(app);\n\n\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\tif (slider)\n\t\t{\n\t\t\tslider.showLoader();\n\t\t}\n\t\tDom.addClass(container, 'humanresources-chart__back');\n\n\t\tawait PermissionChecker.init();\n\t\tif (slider)\n\t\t{\n\t\t\tslider.closeLoader();\n\t\t}\n\t\tDom.removeClass(container, 'humanresources-chart__back');\n\t\tapp.mount(container);\n\t}\n}\n"],"names":["events","Object","freeze","HR_DEPARTMENT_CONNECT","HR_DEPARTMENT_DISCONNECT","HR_DEPARTMENT_ADAPT_SIBLINGS","HR_DEPARTMENT_ADAPT_CONNECTOR_HEIGHT","HR_DEPARTMENT_FOCUS","HR_DEPARTMENT_CONTROL","HR_DEPARTMENT_MENU_CLOSE","HR_ORG_CHART_CLOSE_BY_ESC","HR_ORG_CHART_CLOSE","HR_FIRST_POPUP_SHOW","HR_DRAG_ENTITY","HR_DROP_ENTITY","HR_ORG_CHART_TRANSFORM_CANVAS","HR_DEPARTMENT_SLIDER_ON_MESSAGE","HR_ORG_CHART_LOCATE_TO_DEPARTMENT","HR_ENTITY_TOGGLE_ELEMENTS","HR_ENTITY_SHOW_WIZARD","HR_ENTITY_REMOVE","HR_PUBLIC_FOCUS_NODE","INTRANET_USER_MINIPROFILE_CLOSE","HR_USER_DRAG_START","HR_USER_DRAG_MOVE","HR_USER_DRAG_DROP","HR_USER_DRAG_END","HR_USER_DRAG_ENTER_NODE","HR_USER_DRAG_LEAVE_NODE","detailPanelWidth","MenuOption","addDepartment","addEmployee","AddButton","name","components","RouteActionMenu","emits","data","actionMenu","visible","computed","mounted","permissionChecker","PermissionChecker","getInstance","dropdownItems","id","title","loc","description","bIcon","Main","CUBE_PLUS","size","color","getColorCode","permission","action","PermissionActions","departmentCreate","CRM","PERSON_PLUS_2","employeeAddToDepartment","filter","item","hasPermissionOfAction","methods","phraseCode","replacements","$Bitrix","Loc","getMessage","$emit","actionMenuItemClickHandler","actionId","template","createTreeDataStore","treeData","dataMap","Map","forEach","parentId","colorName","entityType","mapItem","get","teamColor","getNodeColorSettings","set","mapParentItem","children","chartAPI","removeDepartment","getData","nodeId","getDepartmentsData","tool","category","event","getCurrentDepartments","getDictionary","getUserId","firstTimeOpened","postData","updateDepartment","changeOrder","draggedId","direction","count","OrgChartActions","applyData","departments","currentDepartments","userId","structureMap","multipleUsers","store","useChartStore","$patch","searchedUserId","focusDepartment","departmentId","focusedNode","searchUserInDepartment","moveSubordinatesToParent","removableDepartmentId","removableDepartment","removableDeparmentChildren","userCount","removableDepartmentUserCount","heads","removableDeparmentHeads","employees","removableDeparmentEmployees","parentDepartment","childId","department","mapEntity","EntityTypes","parentDepartmentUsersIds","Set","map","user","removableDeparmentUsers","movableUsers","has","role","memberRoles","employee","length","includes","changeCurrentDepartment","markDepartmentAsRemoved","prevParentId","delete","inviteUser","userData","restData","orderDepartments","targetId","targetIndex","indexOf","newChildren","splice","clearNodesChatLists","nodeIds","chats","channels","SearchBar","BIcon","directives","focus","el","canEditPermissions","showSearchBar","mapState","watch","handler","searchDialog","destroy","deep","created","getSearchDialog","showSearchbar","analyticsSendData","hideSearchbar","dialog","Dialog","width","height","multiple","entities","searchFields","type","system","searchable","options","intranetUsersOnly","emailUsers","inviteEmployeeLink","selectMode","useMultipleTabs","restricted","flatMode","includedNodeEntityTypes","recentTabOptions","dropdownMode","enableSearch","hideOnDeselect","context","customData","recentItemsToSave","push","saveRecentItems","onLoad","target","items","getSubtitle","setSubtitle","onDestroy","dialogContainer","getContainer","Dom","attr","onEnter","$refs","searchName","setTargetNode","isOpen","show","Event","bind","window","handleClickOutside","parentElement","contains","clearSearch","unbind","search","value","getSearchTab","clearResults","selectTab","accessRights","teamAccessRights","BurgerMenuButton","accessEdit","PERSONS_2","dataTestId","teamAccessEdit","BX","SidePanel","Instance","open","usePadding","TitlePanel","ResponsiveHint","canAddNode","toolbarStarActive","isHovered","hintKey","toolbarStarElement","document","getElementById","teamCreate","error","console","observer","MutationObserver","newState","hasClass","observe","attributes","attributeFilter","toolbarStarIcon","isAirTemplate","FAVORITE_0","FAVORITE_1","Reflection","getClass","toolbarClassIcon","starHintText","source","AnalyticsSourceType","HEADER","onLocate","EventEmitter","emit","triggerFavoriteStar","click","UI","Notification","Center","notify","content","autoHideDelay","DepartmentAPI","getPagedEmployees","page","countPerPage","removeUserFromDepartment","moveUserToDepartment","targetNodeId","roleXmlId","isUserInMultipleDepartments","getUserInfo","fireUser","findMemberByQuery","query","getChatsAndChannels","saveChats","ids","removeIds","withChildren","saveChannel","saveCollab","UrlParamNames","FocusNodeId","UrlProvidedParamsService","getParams","paramMap","focusNodeId","urlSearchParams","URLSearchParams","location","values","paramName","paramValue","Type","isUndefined","castedValue","Number","isInteger","HeadList","UserListActionMenu","hint","Hint","props","entityId","required","default","Array","String","collapsed","Boolean","isTeamEntity","isCollapsed","isUpdating","headsVisible","defaultAvatar","workPosition","getPositionText","titleBar","userTypes","deputy","subordinatesCount","getSubtreeUserCount","MainIcons","head","handleUserClick","url","cacheable","closeHeadList","unsubscribe","openHeadList","subscribe","rootId","sum","checkedEntities","countedEntities","stack","pop","add","entity","team","headsAtRoot","Math","max","duplicatesToSubtract","headUserIds","entityIds","entries","isArray","cnt","duplicatesCount","getEmployeesCountIconColor","getEmployeesCountIconText","AbstractActionMenu","constructor","getItems","Error","getFilteredItems","isFunction","hasPermission","onActionMenuItemClick","targetItem","find","invoke","analyticSource","AbstractMenuItem","permissionAction","MenuActions","editDepartment","editEmployee","moveEmployee","userInvite","teamRights","moveUserToAnotherDepartment","fireUserFromCompany","openChat","unbindChat","AddDepartmentMenuItem","isTeamsAvailable","isEditMode","showEntitySelector","EditDepartmentMenuItem","EDIT_PENCIL","refToFocus","teamEdit","teamAddMember","teamChatEdit","teamChannelEdit","teamCollabEdit","teamSettingsEdit","departmentEdit","departmentChatEdit","departmentChannelEdit","departmentCollabEdit","RemoveDepartmentMenuItem","teamDelete","departmentDelete","TRASH_BIN","AddEmployeeMenuItem","localize","i18nRole","i18nType","i18nMap","teamMemberRoles","UserManagementDialog","openDialog","MoveEmployeeMenuItem","PERSON_ARROW_LEFT_1","currentUserPermissions","ACTION_EMPLOYEE_REMOVE_FROM_DEPARTMENT","UserInviteMenuItem","PERSON_LETTER","inviteToDepartment","allowChangeHistory","EntityActionMenu","DepartmentMenuButton","menuVisible","menu","CARD","closeMenu","openMenu","DepartmentInfoIconButton","BasePopup","canvasZoom","showPopup","popupConfig","popupWidth","buttonWidth","initialPopupOffset","angleWidth","bindElement","departmentMenuButton","bindOptions","position","borderRadius","contentNoPaddings","contentPadding","padding","offsetTop","offsetLeft","angleOffset","menuItem","canEdit","onClose","onOpen","addDescription","SubdivisionAddButton","canShow","addSubdivision","PLUS","TreeNode","inject","expandedNodes","isShown","userDropTargetNodeId","isUserDropAllowed","isDraggingUser","childrenOffset","childrenMounted","showInfo","showDnd","getMemberRoles","nodeData","nodeClass","isDragSource","isCurrentDepartment","subdivisionsClass","hasChildren","isExpanded","deputyHead","employeeCount","childNodeStyle","left","showSubdivisionAddButton","nodeDataTitle","subdivisionsText","wrapCountInHtml","nodeType","pluralString","replace","toString","nodeTypeTeam","nodeTypeDept","locPlural","childDepartmentsCount","childTeamsCount","deptPlural","teamPlural","deptHtml","teamHtml","deputyTitle","dropOverlayText","sourceNode","showOverlay","adaptHeight","immediate","gap","prevChildrenOffset","prevHeight","editAction","viewAction","teamView","structureView","$nextTick","$el","offsetHeight","html","parentsPath","getParentsPath","calculateNodePoints","unmounted","remove","onDepartmentClick","showEmployees","subdivisionsSelected","calculatePosition","node","offset","getMessagePlural","top","getBoundingClientRect","parentNode","$parent","parentLeft","parentTop","parentWidth","parentHeight","x","chartX","y","chartY","getTreeBounds","startPoint","endPoint","topLevelId","shift","onDragMouseEnter","onDragMouseLeave","Connectors","expose","isLocatedDepartmentVisible","treeNodes","connectors","subscribeOnEvents","prevWindowWidth","innerWidth","beforeUnmount","unsubscribeFromEvents","onAddConnector","connector","assign","highlighted","onRemoveConnector","onAdaptSiblingConnectors","isMounted","parsedSiblingConnectors","reduce","acc","currentEndPoint","currentId","currentParentId","sign","currentStartPoint","ancestorId","ancestorSign","adaptConnectorsAfterReorder","isRoot","onAdaptConnectorHeight","toggleConnectorsVisibility","toggleAllConnectorsVisibility","shouldShow","keys","key","toggleConnectorHighlighting","expanded","highlightedConnector","getPath","verticalLineHeight","parentNodeStyle","getComputedStyle","minDepartmentHeight","parseInt","getPropertyValue","diffHeight","shiftY","startY","shadowOffset","rounded","start","end","arcRadius","round","adjustedEndY","join","handle","onResizeWindow","startPointX","endPointX","FULL_WIDTH","CANVAS_MOVE_SPEED","TreeNodeDragController","currentTarget","tree","pageX","pageY","stopPropagation","dataset","zoom","closest","prevX","prevY","addClass","shouldShowElements","removeClass","style","affectedItem","directionX","directionY","insertion","affectedItems","draggedIndex","shiftKey","currentCanvasX","movementX","currentCanvasY","movementY","ghost","cloneNode","treeX","treeY","draggedX","draggedY","append","offsetWidth","text","positionPointer","Tag","render","element","rotation","nodeX","nodeY","reorderThreshold","changeParentWithReorderThreshold","draggedWidth","draggedHeight","points","targetData","point","i","belowItem","elementFromPoint","targetItemSummary","targetX","targetY","targetWidth","targetHeight","sameParent","hasSortPermission","canSortEntitiesByParentId","allowSort","isDepartmentInsertToTeam","isInsertToParent","canBeParentForEntity","slice","zoomedLeft","zoomedTop","body","speed","shouldReset","DragAndDrop","updated","setAttribute","Tree","MoveEmployeeConfirmationPopup","ConfirmationPopup","dnd","provide","canvasTransform","isLoaded","draggedUserData","showDndConfirmationPopup","showDndErrorPopup","dndErrorPopupDescription","dndUserMoveContext","isCombineOnly","dndTargetEntityType","targetDepartment","dndSourceEntityType","targetDepartmentId","isTeamTarget","dndPopupDescription","phrase","Text","encode","loadHeads","departmentToFocus","getDepartmentIdForInitialFocus","currentDepartmentsLocated","expandDepartmentParents","expandAfterFocus","expandLowerDepartments","providedFocusNodeId","currentDepartmentId","onConnectDepartment","departmentIdToFocus","movingDelay","Runtime","debounce","moveTo","onDisconnectDepartment","onDragEntity","collapseRecursively","onToggleConnectors","promise","fullDepartmentWidth","draggedShift","affectedShift","ordered","updateParent","updateParentPromise","targetParentId","locateToDepartment","affectedCount","err","onDropEntity","onPublicFocusNode","collapse","expandedId","deepCollapse","expandedNode","expand","isManual","childrenWithoutHeads","shouldExpand","onFocusDepartment","preventSwitch","tryRemoveDepartment","localizationMap","message","success","mapIndex","messageBox","MessageBox","create","buttons","MessageBoxButtons","OK_CANCEL","onOk","close","onCancel","minWidth","maxWidth","minHeight","okCaption","popupOptions","className","overlay","opacity","okButton","getOkButton","cancelButton","getCancelButton","setRound","setColor","ButtonColor","DANGER","LIGHT_BORDER","updateChatsInChildrenNodes","removableDepartmentChildren","expandLevel","expandRecursively","middleBound","trunc","traverseSibling","siblingId","currentChildren","locateToCurrentDepartment","currentDepartment","treeRect","centerX","centerY","treeNode","treeNodeRect","departmentIds","onUserDragStart","onUserDragDrop","onUserDragEnd","onUserDragEnterNode","onUserDragLeaveNode","hoveredNodeId","sourceDepartmentId","movePermissions","canMoveUser","isAllowed","combineOnly","sourceRole","confirmUserMove","payload","userInTarget","u","isAlreadyInTarget","isRoleTheSame","displayDndErrorPopup","isCombineMode","handleCombineUser","handleMoveUser","roleLabel","dndContext","UserManagementDialogAPI","addUsersToDepartment","UserService","addUsersToEntity","badgeText","finalUserCount","removeUserFromEntity","cancelUserMove","closeDndErrorPopup","isTeamToDept","sourcePermission","teamRemoveMember","employeeRemoveFromDepartment","canTakeFromSource","targetPermission","canPutToTarget","isDeptToTeam","TransformPanel","modelValue","selectedId","zoomInPercent","percent","toFixed","actions","zoomIn","zoomOut","locate","navigate","onZoom","leftBound","rightBound","oldCenterX","oldCenterY","onfocusout","DetailPanelCollapsedTitle","avatars","maxVisibleAvatarsCount","additionalCount","DetailPanelEditButton","NODE_DETAIL","DetailPanel","DepartmentContent","preventPanelSwitch","isHidden","isLoading","needToShowLoader","headAvatarsArray","avatar","isPanelCollapsed","newId","oldId","updateDetailPageHandler","newDepartments","toggleCollapse","showLoader","hideLoader","onToggleDetailPanel","FirstPopup","subDescription","features","closePopup","Chart","TransformCanvas","ChartWizard","canvas","shown","moved","modelTransform","wizard","detailPanel","isTransitionCompleted","analyticsQueue","isAnalyticsBusy","slider","getTopSlider","departmentsData","Promise","all","closeLoader","structure","multipleMembers","parsedDepartments","availableDepartments","rootOffset","transformCanvas","showConfetti","handleInviteSliderMessage","PULL","PullClient","SubscriptionType","Server","moduleId","command","callback","clearChatLists","showWizardEventHandler","removeDepartmentEventHandler","onCanvasTransformWhenDragging","handleAnalyticsAjaxSuccess","addCustomEvent","removeCustomEvent","onMoveTo","detailPanelWidthZoomed","newX","newY","samePoint","onUpdateTransform","onShowWizard","sendAnalyticsSequentially","processAnalyticsQueue","dataToSend","analyticsType","company","c_element","onModifyTree","onWizardClose","onRemoveDepartment","onTransitionEnd","Confetti","fire","particleCount","startVelocity","spread","ticks","origin","onControlDetail","messageEvent","eventId","getEventId","users","invitedUserData","getInvitedUserData","onKeyDown","preventDefault","UsersTabActionMenu","EmptyUsersTabActionMenu","FireUserFromCompanyMenuItem","isUserInvited","PERSONS_DENY","employeeFire","MoveFromDepartmentMenuItem","permissions","addMemberPermissionAction","removeMemberPermissionAction","addMemberPermissionValue","ACTION_TEAM_MEMBER_ADD","ACTION_EMPLOYEE_ADD_TO_DEPARTMENT","removeMemberPermissionValue","ACTION_TEAM_MEMBER_REMOVE","moveUserPermission","RemoveFromDepartmentMenuItem","OpenChatMenuItem","chat","Dictionary","hasAccess","ChatTypes","channel","collab","UnbindChatMenuItem","originalNodeId","ChatListActionMenu","NotConvertedState","mount","containerId","container","updateTimeMs","updateConvertedStatusInterval","setInterval","e","code","clearInterval","reload","onCloseByEsc","sidePanelEvent","denyAction","App","app","BitrixVue","createApp","createPinia","use","init","unmount"],"mappings":"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"}