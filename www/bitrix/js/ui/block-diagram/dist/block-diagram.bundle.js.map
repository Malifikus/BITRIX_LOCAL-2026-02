{"version":3,"file":"block-diagram.bundle.js","sources":["../src/composables/state.js","../src/constants.js","../src/utils/diagram.js","../src/utils/command-to-array.js","../src/utils/create-hook.js","../src/utils/slots.js","../src/lib/gl-matrix/common.js","../src/lib/gl-matrix/mat3.js","../src/lib/gl-matrix/vec3.js","../src/lib/gl-matrix/vec4.js","../src/lib/gl-matrix/quat.js","../src/lib/gl-matrix/vec2.js","../src/utils/canvas/camera.js","../src/utils/canvas/canvas.js","../src/utils/canvas/shaders/grid.js","../src/utils/canvas/helpers.js","../src/utils/canvas/grid.js","../src/composables/history.js","../src/composables/actions.js","../src/composables/getters.js","../src/composables/hooks.js","../src/composables/block-diagram.js","../src/composables/context-menu.js","../src/composables/new-connection.js","../src/composables/block-state.js","../src/composables/moveable-block.js","../src/composables/model-value.js","../src/composables/watch-props.js","../src/composables/register-hooks.js","../src/composables/search-blocks.js","../src/composables/canvas.js","../src/composables/highlighted-blocks.js","../src/composables/loc.js","../src/composables/port-state.js","../src/composables/connection-state.js","../src/composables/init-app-elements.js","../src/composables/new-connection-state.js","../src/composables/animation-queue.js","../src/composables/canvas-transform.js","../src/composables/drag-n-drop.js","../src/composables/resizable-block.js","../src/composables/canvas-selection.js","../src/composables/group-drag-logic.js","../src/composables/group-selection-logic.js","../src/components/canvas-transform/canvas-transform.js","../src/components/connection/connection.js","../src/components/delete-connection-btn/delete-connection-btn.js","../src/components/context-menu-layout/context-menu-layout.js","../src/components/blocks-queue-transition/blocks-queue-transition.js","../src/components/grouped-blocks/grouped-blocks.js","../src/components/new-connection/new-connection.js","../src/components/connections-queue-transition/connections-queue-transition.js","../src/components/grouped-connections/grouped-connections.js","../src/components/moveable-block/moveable-block.js","../src/components/port/port.js","../src/components/block-content-stub/block-content-stub.js","../src/components/block-diagram/block-diagram.js","../src/components/icon-button/icon-button.js","../src/components/history-bar/history-bar.js","../src/components/zoom-btn/zoom-btn.js","../src/components/zoom-percent/zoom-percent.js","../src/components/canvas-map/canvas-map.js","../src/components/canvas-map-btn/canvas-map-btn.js","../src/components/zoom-bar/zoom-bar.js","../src/components/search-bar/search-result.js","../src/components/search-bar/search-nav-btn.js","../src/components/search-bar/open-search-btn.js","../src/components/search-bar/search-input.js","../src/components/search-bar/search-bar.js","../src/components/resizable-block/resizable-block.js","../src/components/group-selection-box/group-selection-box.js","../src/directives/drag-block.js"],"sourcesContent":["import { markRaw } from 'ui.vue3';\nimport type { State } from '../types';\n\nexport function useState(): State\n{\n\treturn {\n\t\tblockDiagramRef: null,\n\t\tblockDiagramTop: 0,\n\t\tblockDiagramLeft: 0,\n\n\t\tcursorType: 'default',\n\n\t\tisResizing: false,\n\t\tisDisabled: false,\n\n\t\tblocks: [],\n\t\tconnections: [],\n\n\t\tportsElMap: markRaw(new Map()),\n\t\tportsRectMap: {},\n\n\t\tnewConnection: null,\n\t\tisValidNewConnection: true,\n\n\t\tmovingBlock: null,\n\t\tmovingConnections: [],\n\n\t\tresizingBlock: null,\n\n\t\tcanvasRef: null,\n\t\ttransformLayoutRef: null,\n\t\tcanvasInstance: null,\n\t\tcanvasWidth: 0,\n\t\tcanvasHeight: 0,\n\t\ttransformX: 0,\n\t\ttransformY: 0,\n\t\tviewportX: 0,\n\t\tviewportY: 0,\n\t\tzoom: 1,\n\t\tminZoom: 0.2,\n\t\tmaxZoom: 4,\n\n\t\tcontextMenuLayerRef: null,\n\t\ttargetContainerRef: null,\n\t\tisOpenContextMenu: false,\n\t\tcontextMenuInstance: null,\n\t\tpositionContextMenu: {\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t},\n\n\t\thistoryCurrentState: markRaw({\n\t\t\tblocks: [],\n\t\t\tconnections: [],\n\t\t}),\n\n\t\theadSnapshot: null,\n\t\ttailSnapshot: null,\n\t\tcurrentSnapshot: null,\n\t\tmaxCountSnapshots: 20,\n\t\tsnapshotHandler: null,\n\t\trevertHandler: null,\n\n\t\thighlitedBlockIds: [],\n\t\tisSelectionActive: false,\n\t\tselectionWorldRect: null,\n\n\t\tanimationQueue: null,\n\t\tcurrentAnimationItem: null,\n\t\tisPauseAnimation: false,\n\t\tisStopAnimation: false,\n\t};\n}\n","import type { AnimationItemTypes } from './types';\n\nexport const PORT_SIZE = 9;\nexport const NODE_HEADER_HEIGHT = 46;\nexport const NODE_CONTENT_HEADER_HEIGHT = 14;\nexport const DELETE_BUTTON_SIZE = 22;\nexport const GRID_SIZE = 100;\nexport const STICKING_DISTANCE = 5;\n\nexport const HOOK_NAMES = {\n\tCHANGED_BLOCKS: 'changedBlocks',\n\tCHANGED_CONNECTIONS: 'changedConnections',\n\tSTART_DRAG_BLOCK: 'startDragBlock',\n\tMOVE_DRAG_BLOCK: 'moveDragBlock',\n\tEND_DRAG_BLOCK: 'endDragBlock',\n\tADD_BLOCK: 'addBlock',\n\tUPDATE_BLOCK: 'updateBlock',\n\tDELETE_BLOCK: 'deleteBlock',\n\tCREATE_CONNECTION: 'createConnection',\n\tDELETE_CONNECTION: 'deleteConnection',\n\tBLOCK_TRANSITION_START: 'blockTransitionStart',\n\tBLOCK_TRANSITION_END: 'blockTransitionEnd',\n\tCONNECTION_TRANSITION_START: 'connectionTransitionStart',\n\tCONNECTION_TRANSITION_END: 'connectionTransitionEnd',\n\tDROP_NEW_BLOCK: 'dropNewBlock',\n};\n\nexport const PORT_TYPES: { ... } = {\n\tINPUT: 'input',\n\tOUTPUT: 'output',\n};\n\nexport const NODE_TYPES: { ... } = {\n\tSIMPLE: 'simple',\n\tTRIGGER: 'trigger',\n\tCOMPLEX: 'complex',\n};\n\nexport const BLOCK_GROUP_DEFAULT_NAME = 'default';\nexport const CONNECTION_GROUP_DEFAULT_NAME = 'default';\n\nexport const PORT_POSITION = {\n\tTOP: 'top',\n\tBOTTOM: 'bottom',\n\tRIGHT: 'right',\n\tLEFT: 'left',\n};\n\nexport const ANIMATED_TYPES: { [string]: AnimationItemTypes } = {\n\tBLOCK: 'block',\n\tCONNECTION: 'connection',\n\tREMOVE_BLOCK: 'remove_block',\n\tREMOVE_CONNECTION: 'remove_connection',\n};\n\nexport const CURSOR_TYPES = {\n\tEW_RESIZE: 'ew-resize',\n\tNS_RESIZE: 'ns-resize',\n\tNWSE_RESIZE: 'nwse-resize',\n\tNESW_RESIZE: 'nesw-resize',\n};\n\nexport const BLOCK_INDEXES = {\n\tHIGHLITED: 4,\n\tMOVABLE: 3,\n\tSTANDING: 2,\n\tRESIZABLE: 1,\n};\n","import type { Point, DiagramPortPosition } from '../types';\nimport { PORT_POSITION } from '../constants';\n\nconst DIR_ACCESSOR_X = 'x';\nconst DIR_ACCESSOR_Y = 'y';\n\nconst DIRECTIONS_BY_POSITION: { [DiagramPortPosition]: Point } = {\n\t[PORT_POSITION.LEFT]: { x: -1, y: 0 },\n\t[PORT_POSITION.RIGHT]: { x: 1, y: 0 },\n\t[PORT_POSITION.TOP]: { x: 0, y: -1 },\n\t[PORT_POSITION.BOTTOM]: { x: 0, y: 1 },\n};\n\nexport type PathInfo = {\n\tpath: string;\n\tcenter: {\n\t\tx: number;\n\t\ty: number;\n\t}\n};\n\nexport function getLinePath(start: Point, end: Point): PathInfo\n{\n\tconst [x, y] = getConnectionCenter({\n\t\tsourceX: start.x,\n\t\tsourceY: start.y,\n\t\ttargetX: end.x,\n\t\ttargetY: end.y,\n\t});\n\n\treturn {\n\t\tpath: `M ${start.x} ${start.y} L ${end.x} ${end.y}`,\n\t\tcenter: { x, y },\n\t};\n}\n\nexport const BEZIER_DIR = {\n\tVERTICAL: 'vertical',\n\tHORIZONTAL: 'horizontal',\n};\n\nexport function getBeziePath(\n\tstart: Point,\n\tend: Point,\n\tdir: 'vertical' | 'horizontal' = BEZIER_DIR.VERTICAL,\n): PathInfo\n{\n\tconst midX: number = (start.x + end.x) / 2;\n\tconst midY: number = (start.y + end.y) / 2;\n\tconst [centerX, centerY] = getConnectionCenter({\n\t\tsourceX: start.x,\n\t\tsourceY: start.y,\n\t\ttargetX: end.x,\n\t\ttargetY: end.y,\n\t});\n\n\treturn {\n\t\tpath: dir === BEZIER_DIR.HORIZONTAL\n\t\t\t? `M ${start.x} ${start.y} C ${midX} ${start.y}, ${midX} ${end.y}, ${end.x} ${end.y}`\n\t\t\t: `M ${start.x} ${start.y} C ${start.x} ${midY}, ${end.x} ${midY}, ${end.x} ${end.y}`,\n\t\tcenter: {\n\t\t\tx: centerX,\n\t\t\ty: centerY,\n\t\t},\n\t};\n}\n\nexport function transformPoint(point: Point, transform, viewport): Point\n{\n\tlet transformedX: number = Math.round((point.x - transform.x) / transform.zoom);\n\tlet transformedY: number = Math.round((point.y - transform.y) / transform.zoom);\n\n\ttransformedX -= Math.round(viewport.left / transform.zoom);\n\ttransformedY -= Math.round(viewport.top / transform.zoom);\n\n\treturn {\n\t\tx: transformedX,\n\t\ty: transformedY,\n\t};\n}\n\nexport function getConnectionCenter({\n\tsourceX,\n\tsourceY,\n\ttargetX,\n\ttargetY,\n}: {\n\tsourceX: number,\n\tsourceY: number,\n\ttargetX: number,\n\ttargetY: number,\n}): [number, number, number, number]\n{\n\tconst xOffset = Math.abs(targetX - sourceX) / 2;\n\tconst centerX = targetX < sourceX\n\t\t? targetX + xOffset\n\t\t: targetX - xOffset;\n\n\tconst yOffset = Math.abs(targetY - sourceY) / 2;\n\tconst centerY = targetY < sourceY\n\t\t? targetY + yOffset\n\t\t: targetY - yOffset;\n\n\treturn [centerX, centerY, xOffset, yOffset];\n}\n\nfunction getDirection({ source, sourcePosition = PORT_POSITION.BOTTOM, target }: {\n\tsource: XYPosition,\n\tsourcePosition: Position,\n\ttarget: XYPosition,\n}): XYPosition\n{\n\tif (sourcePosition === PORT_POSITION.LEFT || sourcePosition === PORT_POSITION.RIGHT)\n\t{\n\t\treturn source.x < target.x\n\t\t\t? { x: 1, y: 0 }\n\t\t\t: { x: -1, y: 0 };\n\t}\n\n\treturn source.y < target.y\n\t\t? { x: 0, y: 1 }\n\t\t: { x: 0, y: -1 };\n}\n\nfunction distance(a: Point, b: Point): number\n{\n\treturn Math.sqrt((b.x - a.x) ** 2 + (b.y - a.y) ** 2);\n}\n\nexport type GetPointsParams = {\n\tsource: Point;\n\tsourcePosition: DiagramPortPosition;\n\ttarget: Point;\n}\n\n// eslint-disable-next-line max-lines-per-function\nfunction getPoints({\n\tsource,\n\tsourcePosition = PORT_POSITION.BOTTOM,\n\ttarget,\n\ttargetPosition = PORT_POSITION.TOP,\n\tcenter,\n\toffset,\n}: {\n  source: Point,\n  sourcePosition: DiagramPortPosition,\n  target: Point,\n  targetPosition: DiagramPortPosition,\n  center: Partial<Point>,\n  offset: number,\n}): [Point[], number, number, number, number]\n{\n\tconst sourceDir = DIRECTIONS_BY_POSITION[sourcePosition];\n\tconst targetDir = DIRECTIONS_BY_POSITION[targetPosition];\n\tconst sourceGapped: Point = {\n\t\tx: source.x + sourceDir.x * offset,\n\t\ty: source.y + sourceDir.y * offset,\n\t};\n\tconst targetGapped: Point = {\n\t\tx: target.x + targetDir.x * offset,\n\t\ty: target.y + targetDir.y * offset,\n\t};\n\tconst dir = getDirection({\n\t\tsource: sourceGapped,\n\t\tsourcePosition,\n\t\ttarget: targetGapped,\n\t});\n\tconst dirAccessor = dir.x !== 0\n\t\t? DIR_ACCESSOR_X\n\t\t: DIR_ACCESSOR_Y;\n\tconst currDir = dir[dirAccessor];\n\n\tlet points: Point[] = [];\n\tlet centerX = 0;\n\tlet centerY = 0;\n\n\tconst sourceGapOffset: Point = { x: 0, y: 0 };\n\tconst targetGapOffset: Point = { x: 0, y: 0 };\n\n\tconst [\n\t\tdefaultCenterX,\n\t\tdefaultCenterY,\n\t\tdefaultOffsetX,\n\t\tdefaultOffsetY,\n\t] = getConnectionCenter({\n\t\tsourceX: source.x,\n\t\tsourceY: source.y,\n\t\ttargetX: target.x,\n\t\ttargetY: target.y,\n\t});\n\n\tif (sourceDir[dirAccessor] * targetDir[dirAccessor] === -1)\n\t{\n\t\tcenterX = center.x ?? defaultCenterX;\n\t\tcenterY = center.y ?? defaultCenterY;\n\n\t\tconst verticalSplit: Point[] = [\n\t\t\t{ x: centerX, y: sourceGapped.y },\n\t\t\t{ x: centerX, y: targetGapped.y },\n\t\t];\n\n\t\tconst horizontalSplit: Point[] = [\n\t\t\t{ x: sourceGapped.x, y: centerY },\n\t\t\t{ x: targetGapped.x, y: centerY },\n\t\t];\n\n\t\tif (sourceDir[dirAccessor] === currDir)\n\t\t{\n\t\t\tpoints = dirAccessor === DIR_ACCESSOR_X\n\t\t\t\t? verticalSplit\n\t\t\t\t: horizontalSplit;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpoints = dirAccessor === DIR_ACCESSOR_X\n\t\t\t\t? horizontalSplit\n\t\t\t\t: verticalSplit;\n\t\t}\n\t}\n\telse\n\t{\n\t\tconst sourceTarget: Point[] = [{\n\t\t\tx: sourceGapped.x,\n\t\t\ty: targetGapped.y,\n\t\t}];\n\t\tconst targetSource: Point[] = [{\n\t\t\tx: targetGapped.x,\n\t\t\ty: sourceGapped.y,\n\t\t}];\n\n\t\tif (dirAccessor === DIR_ACCESSOR_X)\n\t\t{\n\t\t\tpoints = sourceDir.x === currDir\n\t\t\t\t? targetSource\n\t\t\t\t: sourceTarget;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpoints = sourceDir.y === currDir\n\t\t\t\t? sourceTarget\n\t\t\t\t: targetSource;\n\t\t}\n\n\t\tif (sourcePosition === targetPosition)\n\t\t{\n\t\t\tconst diff = Math.abs(source[dirAccessor] - target[dirAccessor]);\n\n\t\t\tif (diff <= offset)\n\t\t\t{\n\t\t\t\tconst gapOffset = Math.min(offset - 1, offset - diff);\n\n\t\t\t\tif (sourceDir[dirAccessor] === currDir)\n\t\t\t\t{\n\t\t\t\t\tconst dirSource = sourceGapped[dirAccessor] > source[dirAccessor] ? -1 : 1;\n\t\t\t\t\tsourceGapOffset[dirAccessor] = dirSource * gapOffset;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst dirTarget = targetGapped[dirAccessor] > target[dirAccessor] ? -1 : 1;\n\t\t\t\t\ttargetGapOffset[dirAccessor] = dirTarget * gapOffset;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (sourcePosition !== targetPosition)\n\t\t{\n\t\t\tconst dirAccessorOpposite = dirAccessor === DIR_ACCESSOR_X\n\t\t\t\t? DIR_ACCESSOR_Y\n\t\t\t\t: DIR_ACCESSOR_X;\n\t\t\tconst isSameDir = sourceDir[dirAccessor] === targetDir[dirAccessorOpposite];\n\t\t\tconst sourceGtTargetOppo = sourceGapped[dirAccessorOpposite] > targetGapped[dirAccessorOpposite];\n\t\t\tconst sourceLtTargetOppo = sourceGapped[dirAccessorOpposite] < targetGapped[dirAccessorOpposite];\n\t\t\tconst isFlipSourceTarget =\n\t\t\t\t(sourceDir[dirAccessor] === 1 && ((!isSameDir && sourceGtTargetOppo) || (isSameDir && sourceLtTargetOppo))) ||\n\t\t\t\t(sourceDir[dirAccessor] !== 1 && ((!isSameDir && sourceLtTargetOppo) || (isSameDir && sourceGtTargetOppo)));\n\n\t\t\tif (isFlipSourceTarget)\n\t\t\t{\n\t\t\t\tpoints = dirAccessor === DIR_ACCESSOR_X\n\t\t\t\t\t? sourceTarget\n\t\t\t\t\t: targetSource;\n\t\t\t}\n\t\t}\n\n\t\tconst sourceGapPoint = {\n\t\t\tx: sourceGapped.x + sourceGapOffset.x,\n\t\t\ty: sourceGapped.y + sourceGapOffset.y,\n\t\t};\n\t\tconst targetGapPoint = {\n\t\t\tx: targetGapped.x + targetGapOffset.x,\n\t\t\ty: targetGapped.y + targetGapOffset.y,\n\t\t};\n\t\tconst maxXDistance = Math.max(\n\t\t\tMath.abs(sourceGapPoint.x - points[0].x),\n\t\t\tMath.abs(targetGapPoint.x - points[0].x),\n\t\t);\n\t\tconst maxYDistance = Math.max(\n\t\t\tMath.abs(sourceGapPoint.y - points[0].y),\n\t\t\tMath.abs(targetGapPoint.y - points[0].y),\n\t\t);\n\n\t\tif (maxXDistance >= maxYDistance)\n\t\t{\n\t\t\tcenterX = (sourceGapPoint.x + targetGapPoint.x) / 2;\n\t\t\tcenterY = points[0].y;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcenterX = points[0].x;\n\t\t\tcenterY = (sourceGapPoint.y + targetGapPoint.y) / 2;\n\t\t}\n\t}\n\n\tconst pathPoints: Point[] = [\n\t\tsource,\n\t\t{\n\t\t\tx: sourceGapped.x + sourceGapOffset.x,\n\t\t\ty: sourceGapped.y + sourceGapOffset.y,\n\t\t},\n\t\t...points,\n\t\t{\n\t\t\tx: targetGapped.x + targetGapOffset.x,\n\t\t\ty: targetGapped.y + targetGapOffset.y,\n\t\t},\n\t\ttarget,\n\t];\n\n\treturn {\n\t\tpoints: pathPoints,\n\t\toffsetX: defaultOffsetX,\n\t\toffsetY: defaultOffsetY,\n\t\tcenterX,\n\t\tcenterY,\n\t};\n}\n\nfunction getBend(\n\ta: Point,\n\tb: Point,\n\tc: Point,\n\tsize: number,\n): string\n{\n\tconst bendSize = Math.min(\n\t\tdistance(a, b) / 2,\n\t\tdistance(b, c) / 2,\n\t\tsize,\n\t);\n\tconst { x, y } = b;\n\n\tif ((a.x === x && x === c.x) || (a.y === y && y === c.y))\n\t{\n\t\treturn `L${x} ${y}`;\n\t}\n\n\tif (a.y === y)\n\t{\n\t\tconst xDir = a.x < c.x ? -1 : 1;\n\t\tconst yDir = a.y < c.y ? 1 : -1;\n\n\t\treturn `L ${x + bendSize * xDir},${y}Q ${x},${y} ${x},${y + bendSize * yDir}`;\n\t}\n\n\tconst xDir = a.x < c.x ? 1 : -1;\n\tconst yDir = a.y < c.y ? -1 : 1;\n\n\treturn `L ${x},${y + bendSize * yDir}Q ${x},${y} ${x + bendSize * xDir},${y}`;\n}\n\nexport type GetSmoothStepPathParams = {\n\tsourceX: number;\n\tsourceY: number;\n\tsourcePosition?: DiagramPortPosition;\n\ttargetX: number;\n\ttargetY: number;\n\ttargetPosition?: DiagramPortPosition;\n\tborderRadius?: number;\n\tcenterX?: number;\n\tcenterY?: number;\n\toffset?: number;\n};\n\nexport function getSmoothStepPath(params: GetSmoothStepPathParams): PathInfo\n{\n\tconst {\n\t\tsourceX,\n\t\tsourceY,\n\t\tsourcePosition = PORT_POSITION.BOTTOM,\n\t\ttargetX,\n\t\ttargetY,\n\t\ttargetPosition = PORT_POSITION.TOP,\n\t\tborderRadius = 5,\n\t\tcenterX,\n\t\tcenterY,\n\t\toffset = 20,\n\t} = params;\n\n\tconst {\n\t\tpoints,\n\t\tcenterX: pointsCenterX,\n\t\tcenterY: pointsCenterY,\n\t} = getPoints({\n\t\tsource: { x: sourceX, y: sourceY },\n\t\tsourcePosition,\n\t\ttarget: { x: targetX, y: targetY },\n\t\ttargetPosition,\n\t\tcenter: { x: centerX, y: centerY },\n\t\toffset,\n\t});\n\n\tconst path = points.reduce((res, p, i) => {\n\t\tlet segment = '';\n\n\t\tif (i > 0 && i < points.length - 1)\n\t\t{\n\t\t\tsegment = getBend(points[i - 1], p, points[i + 1], borderRadius);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsegment = `${i === 0 ? 'M' : 'L'}${p.x} ${p.y}`;\n\t\t}\n\n\t\tres += segment;\n\n\t\treturn res;\n\t}, '');\n\n\treturn {\n\t\tpath,\n\t\tpoints,\n\t\tcenter: {\n\t\t\tx: pointsCenterX,\n\t\t\ty: pointsCenterY,\n\t\t},\n\t};\n}\n","export const ARRAY_COMMANDS = Object.freeze({\n\tREPLACE: 'replace',\n\tPUSH: 'push',\n\tUPDATE_BY_INDEX: 'updateByIndex',\n\tDELETE_BY_INDEX: 'deleteByIndex',\n});\n\nexport type CommandPayload = {\n\tcommandType: $Values<typeof ARRAY_COMMANDS>,\n\tpayload?: Array<{...}> | {...},\n\tindex?: number,\n};\n\nconst commandExecMap = {\n\t[ARRAY_COMMANDS.REPLACE]: ({ payload }) => {\n\t\treturn [...payload];\n\t},\n\t[ARRAY_COMMANDS.PUSH]: ({ source, payload }) => {\n\t\tconst result = [...source];\n\t\tresult.push(payload);\n\n\t\treturn result;\n\t},\n\t[ARRAY_COMMANDS.UPDATE_BY_INDEX]: ({ source, payload, index }) => {\n\t\tconst result = [...source];\n\t\tresult[index] = {\n\t\t\t...result[index],\n\t\t\t...payload,\n\t\t};\n\n\t\treturn result;\n\t},\n\t[ARRAY_COMMANDS.DELETE_BY_INDEX]: ({ source, index }) => {\n\t\tconst result = [...source];\n\t\tresult.splice(index, 1);\n\n\t\treturn result;\n\t},\n};\n\nfunction command(\n\tcommandType: $Values<typeof ARRAY_COMMANDS>,\n\targs: { payload: Array<{...}> | {...}, index: number },\n): CommandReturnType<P, I>\n{\n\treturn {\n\t\tcommandType,\n\t\t...args,\n\t};\n}\n\nexport function commandReplace(payload: Array<{...}>): CommandPayload\n{\n\treturn command(ARRAY_COMMANDS.REPLACE, { payload });\n}\n\nexport function commandPush(payload: {...}): CommandPayload\n{\n\treturn command(ARRAY_COMMANDS.PUSH, { payload });\n}\n\nexport function commandUpdateByIndex(index: number, payload: {...}): CommandPayload\n{\n\treturn command(ARRAY_COMMANDS.UPDATE_BY_INDEX, { index, payload });\n}\n\nexport function commandDeleteByIndex(index: number): CommandPayload\n{\n\treturn command(ARRAY_COMMANDS.DELETE_BY_INDEX, { index });\n}\n\nexport function runCommand(\n\tsourceArray: Array<{...}>,\n\tcommandPayload: CommandPayload,\n\tcallback: (value: Array<{...}>) => any,\n): void\n{\n\tconst { commandType, payload, index } = commandPayload;\n\tconst result = commandExecMap[commandType]({\n\t\tsource: sourceArray,\n\t\tpayload,\n\t\tindex,\n\t});\n\n\tcallback(result);\n}\n","import { Type } from 'main.core';\n\nexport type CreateHook = {\n\ton: (handler: () => void) => void,\n\toff: (handler: () => void) => void,\n\ttrigger: (...args: any) => void,\n};\n\nexport function createHook(): CreateHook\n{\n\tconst handlers = new Set();\n\n\tconst on = (handler: () => void) => {\n\t\tif (Type.isFunction(handler) && !handlers.has(handler))\n\t\t{\n\t\t\thandlers.add(handler);\n\t\t}\n\t};\n\n\tconst off = (handler) => {\n\t\thandlers.delete(handler);\n\t};\n\n\tconst trigger = (...args) => {\n\t\tfor (const handler of handlers)\n\t\t{\n\t\t\thandler(...args);\n\t\t}\n\t};\n\n\treturn {\n\t\ton,\n\t\toff,\n\t\ttrigger,\n\t};\n}\n","export function getGroupBlockSlotName(group: string): string\n{\n\treturn `block:${group}`;\n}\n\nexport function getGroupConnectionSlotName(group: string): string\n{\n\treturn `connection:${group}`;\n}\n","/**\n * Common utilities\n * @module glMatrix\n */\n// Configuration Constants\nexport var EPSILON = 0.000001;\nexport var ARRAY_TYPE = typeof Float32Array !== \"undefined\" ? Float32Array : Array;\nexport var RANDOM = Math.random;\nexport var ANGLE_ORDER = \"zyx\";\n/**\n * Sets the type of array used when creating new vectors and matrices\n *\n * @param {Float32ArrayConstructor | ArrayConstructor} type Array type, such as Float32Array or Array\n */\n\nexport function setMatrixArrayType(type) {\n  ARRAY_TYPE = type;\n}\nvar degree = Math.PI / 180;\n/**\n * Convert Degree To Radian\n *\n * @param {Number} a Angle in Degrees\n */\n\nexport function toRadian(a) {\n  return a * degree;\n}\n/**\n * Tests whether or not the arguments have approximately the same value, within an absolute\n * or relative tolerance of glMatrix.EPSILON (an absolute tolerance is used for values less\n * than or equal to 1.0, and a relative tolerance is used for larger values)\n *\n * @param {Number} a The first number to test.\n * @param {Number} b The second number to test.\n * @returns {Boolean} True if the numbers are approximately equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  return Math.abs(a - b) <= EPSILON * Math.max(1.0, Math.abs(a), Math.abs(b));\n}\nif (!Math.hypot) Math.hypot = function () {\n  var y = 0,\n      i = arguments.length;\n\n  while (i--) {\n    y += arguments[i] * arguments[i];\n  }\n\n  return Math.sqrt(y);\n};","import * as glMatrix from \"./common.js\";\n/**\n * 3x3 Matrix\n * @module mat3\n */\n\n/**\n * Creates a new identity mat3\n *\n * @returns {mat3} a new 3x3 matrix\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(9);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[5] = 0;\n    out[6] = 0;\n    out[7] = 0;\n  }\n\n  out[0] = 1;\n  out[4] = 1;\n  out[8] = 1;\n  return out;\n}\n/**\n * Copies the upper-left 3x3 values into the given mat3.\n *\n * @param {mat3} out the receiving 3x3 matrix\n * @param {ReadonlyMat4} a   the source 4x4 matrix\n * @returns {mat3} out\n */\n\nexport function fromMat4(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[4];\n  out[4] = a[5];\n  out[5] = a[6];\n  out[6] = a[8];\n  out[7] = a[9];\n  out[8] = a[10];\n  return out;\n}\n/**\n * Creates a new mat3 initialized with values from an existing matrix\n *\n * @param {ReadonlyMat3} a matrix to clone\n * @returns {mat3} a new 3x3 matrix\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n/**\n * Copy the values from one mat3 to another\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  out[4] = a[4];\n  out[5] = a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n/**\n * Create a new mat3 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} A new mat3\n */\n\nexport function fromValues(m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  var out = new glMatrix.ARRAY_TYPE(9);\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n/**\n * Set the components of a mat3 to the given values\n *\n * @param {mat3} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m10 Component in column 1, row 0 position (index 3)\n * @param {Number} m11 Component in column 1, row 1 position (index 4)\n * @param {Number} m12 Component in column 1, row 2 position (index 5)\n * @param {Number} m20 Component in column 2, row 0 position (index 6)\n * @param {Number} m21 Component in column 2, row 1 position (index 7)\n * @param {Number} m22 Component in column 2, row 2 position (index 8)\n * @returns {mat3} out\n */\n\nexport function set(out, m00, m01, m02, m10, m11, m12, m20, m21, m22) {\n  out[0] = m00;\n  out[1] = m01;\n  out[2] = m02;\n  out[3] = m10;\n  out[4] = m11;\n  out[5] = m12;\n  out[6] = m20;\n  out[7] = m21;\n  out[8] = m22;\n  return out;\n}\n/**\n * Set a mat3 to the identity matrix\n *\n * @param {mat3} out the receiving matrix\n * @returns {mat3} out\n */\n\nexport function identity(out) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n/**\n * Transpose the values of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\n\nexport function transpose(out, a) {\n  // If we are transposing ourselves we can skip a few steps but have to cache some values\n  if (out === a) {\n    var a01 = a[1],\n        a02 = a[2],\n        a12 = a[5];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a01;\n    out[5] = a[7];\n    out[6] = a02;\n    out[7] = a12;\n  } else {\n    out[0] = a[0];\n    out[1] = a[3];\n    out[2] = a[6];\n    out[3] = a[1];\n    out[4] = a[4];\n    out[5] = a[7];\n    out[6] = a[2];\n    out[7] = a[5];\n    out[8] = a[8];\n  }\n\n  return out;\n}\n/**\n * Inverts a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\n\nexport function invert(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2];\n  var a10 = a[3],\n      a11 = a[4],\n      a12 = a[5];\n  var a20 = a[6],\n      a21 = a[7],\n      a22 = a[8];\n  var b01 = a22 * a11 - a12 * a21;\n  var b11 = -a22 * a10 + a12 * a20;\n  var b21 = a21 * a10 - a11 * a20; // Calculate the determinant\n\n  var det = a00 * b01 + a01 * b11 + a02 * b21;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = b01 * det;\n  out[1] = (-a22 * a01 + a02 * a21) * det;\n  out[2] = (a12 * a01 - a02 * a11) * det;\n  out[3] = b11 * det;\n  out[4] = (a22 * a00 - a02 * a20) * det;\n  out[5] = (-a12 * a00 + a02 * a10) * det;\n  out[6] = b21 * det;\n  out[7] = (-a21 * a00 + a01 * a20) * det;\n  out[8] = (a11 * a00 - a01 * a10) * det;\n  return out;\n}\n/**\n * Calculates the adjugate of a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the source matrix\n * @returns {mat3} out\n */\n\nexport function adjoint(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2];\n  var a10 = a[3],\n      a11 = a[4],\n      a12 = a[5];\n  var a20 = a[6],\n      a21 = a[7],\n      a22 = a[8];\n  out[0] = a11 * a22 - a12 * a21;\n  out[1] = a02 * a21 - a01 * a22;\n  out[2] = a01 * a12 - a02 * a11;\n  out[3] = a12 * a20 - a10 * a22;\n  out[4] = a00 * a22 - a02 * a20;\n  out[5] = a02 * a10 - a00 * a12;\n  out[6] = a10 * a21 - a11 * a20;\n  out[7] = a01 * a20 - a00 * a21;\n  out[8] = a00 * a11 - a01 * a10;\n  return out;\n}\n/**\n * Calculates the determinant of a mat3\n *\n * @param {ReadonlyMat3} a the source matrix\n * @returns {Number} determinant of a\n */\n\nexport function determinant(a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2];\n  var a10 = a[3],\n      a11 = a[4],\n      a12 = a[5];\n  var a20 = a[6],\n      a21 = a[7],\n      a22 = a[8];\n  return a00 * (a22 * a11 - a12 * a21) + a01 * (-a22 * a10 + a12 * a20) + a02 * (a21 * a10 - a11 * a20);\n}\n/**\n * Multiplies two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\n\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2];\n  var a10 = a[3],\n      a11 = a[4],\n      a12 = a[5];\n  var a20 = a[6],\n      a21 = a[7],\n      a22 = a[8];\n  var b00 = b[0],\n      b01 = b[1],\n      b02 = b[2];\n  var b10 = b[3],\n      b11 = b[4],\n      b12 = b[5];\n  var b20 = b[6],\n      b21 = b[7],\n      b22 = b[8];\n  out[0] = b00 * a00 + b01 * a10 + b02 * a20;\n  out[1] = b00 * a01 + b01 * a11 + b02 * a21;\n  out[2] = b00 * a02 + b01 * a12 + b02 * a22;\n  out[3] = b10 * a00 + b11 * a10 + b12 * a20;\n  out[4] = b10 * a01 + b11 * a11 + b12 * a21;\n  out[5] = b10 * a02 + b11 * a12 + b12 * a22;\n  out[6] = b20 * a00 + b21 * a10 + b22 * a20;\n  out[7] = b20 * a01 + b21 * a11 + b22 * a21;\n  out[8] = b20 * a02 + b21 * a12 + b22 * a22;\n  return out;\n}\n/**\n * Translate a mat3 by the given vector\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to translate\n * @param {ReadonlyVec2} v vector to translate by\n * @returns {mat3} out\n */\n\nexport function translate(out, a, v) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a10 = a[3],\n      a11 = a[4],\n      a12 = a[5],\n      a20 = a[6],\n      a21 = a[7],\n      a22 = a[8],\n      x = v[0],\n      y = v[1];\n  out[0] = a00;\n  out[1] = a01;\n  out[2] = a02;\n  out[3] = a10;\n  out[4] = a11;\n  out[5] = a12;\n  out[6] = x * a00 + y * a10 + a20;\n  out[7] = x * a01 + y * a11 + a21;\n  out[8] = x * a02 + y * a12 + a22;\n  return out;\n}\n/**\n * Rotates a mat3 by the given angle\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to rotate\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\n\nexport function rotate(out, a, rad) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a10 = a[3],\n      a11 = a[4],\n      a12 = a[5],\n      a20 = a[6],\n      a21 = a[7],\n      a22 = a[8],\n      s = Math.sin(rad),\n      c = Math.cos(rad);\n  out[0] = c * a00 + s * a10;\n  out[1] = c * a01 + s * a11;\n  out[2] = c * a02 + s * a12;\n  out[3] = c * a10 - s * a00;\n  out[4] = c * a11 - s * a01;\n  out[5] = c * a12 - s * a02;\n  out[6] = a20;\n  out[7] = a21;\n  out[8] = a22;\n  return out;\n}\n/**\n * Scales the mat3 by the dimensions in the given vec2\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to rotate\n * @param {ReadonlyVec2} v the vec2 to scale the matrix by\n * @returns {mat3} out\n **/\n\nexport function scale(out, a, v) {\n  var x = v[0],\n      y = v[1];\n  out[0] = x * a[0];\n  out[1] = x * a[1];\n  out[2] = x * a[2];\n  out[3] = y * a[3];\n  out[4] = y * a[4];\n  out[5] = y * a[5];\n  out[6] = a[6];\n  out[7] = a[7];\n  out[8] = a[8];\n  return out;\n}\n/**\n * Creates a matrix from a vector translation\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.translate(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyVec2} v Translation vector\n * @returns {mat3} out\n */\n\nexport function fromTranslation(out, v) {\n  out[0] = 1;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = 1;\n  out[5] = 0;\n  out[6] = v[0];\n  out[7] = v[1];\n  out[8] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a given angle\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.rotate(dest, dest, rad);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {Number} rad the angle to rotate the matrix by\n * @returns {mat3} out\n */\n\nexport function fromRotation(out, rad) {\n  var s = Math.sin(rad),\n      c = Math.cos(rad);\n  out[0] = c;\n  out[1] = s;\n  out[2] = 0;\n  out[3] = -s;\n  out[4] = c;\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n/**\n * Creates a matrix from a vector scaling\n * This is equivalent to (but much faster than):\n *\n *     mat3.identity(dest);\n *     mat3.scale(dest, dest, vec);\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyVec2} v Scaling vector\n * @returns {mat3} out\n */\n\nexport function fromScaling(out, v) {\n  out[0] = v[0];\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = v[1];\n  out[5] = 0;\n  out[6] = 0;\n  out[7] = 0;\n  out[8] = 1;\n  return out;\n}\n/**\n * Copies the values from a mat2d into a mat3\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat2d} a the matrix to copy\n * @returns {mat3} out\n **/\n\nexport function fromMat2d(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = 0;\n  out[3] = a[2];\n  out[4] = a[3];\n  out[5] = 0;\n  out[6] = a[4];\n  out[7] = a[5];\n  out[8] = 1;\n  return out;\n}\n/**\n * Calculates a 3x3 matrix from the given quaternion\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyQuat} q Quaternion to create matrix from\n *\n * @returns {mat3} out\n */\n\nexport function fromQuat(out, q) {\n  var x = q[0],\n      y = q[1],\n      z = q[2],\n      w = q[3];\n  var x2 = x + x;\n  var y2 = y + y;\n  var z2 = z + z;\n  var xx = x * x2;\n  var yx = y * x2;\n  var yy = y * y2;\n  var zx = z * x2;\n  var zy = z * y2;\n  var zz = z * z2;\n  var wx = w * x2;\n  var wy = w * y2;\n  var wz = w * z2;\n  out[0] = 1 - yy - zz;\n  out[3] = yx - wz;\n  out[6] = zx + wy;\n  out[1] = yx + wz;\n  out[4] = 1 - xx - zz;\n  out[7] = zy - wx;\n  out[2] = zx - wy;\n  out[5] = zy + wx;\n  out[8] = 1 - xx - yy;\n  return out;\n}\n/**\n * Calculates a 3x3 normal matrix (transpose inverse) from the 4x4 matrix\n *\n * @param {mat3} out mat3 receiving operation result\n * @param {ReadonlyMat4} a Mat4 to derive the normal matrix from\n *\n * @returns {mat3} out\n */\n\nexport function normalFromMat4(out, a) {\n  var a00 = a[0],\n      a01 = a[1],\n      a02 = a[2],\n      a03 = a[3];\n  var a10 = a[4],\n      a11 = a[5],\n      a12 = a[6],\n      a13 = a[7];\n  var a20 = a[8],\n      a21 = a[9],\n      a22 = a[10],\n      a23 = a[11];\n  var a30 = a[12],\n      a31 = a[13],\n      a32 = a[14],\n      a33 = a[15];\n  var b00 = a00 * a11 - a01 * a10;\n  var b01 = a00 * a12 - a02 * a10;\n  var b02 = a00 * a13 - a03 * a10;\n  var b03 = a01 * a12 - a02 * a11;\n  var b04 = a01 * a13 - a03 * a11;\n  var b05 = a02 * a13 - a03 * a12;\n  var b06 = a20 * a31 - a21 * a30;\n  var b07 = a20 * a32 - a22 * a30;\n  var b08 = a20 * a33 - a23 * a30;\n  var b09 = a21 * a32 - a22 * a31;\n  var b10 = a21 * a33 - a23 * a31;\n  var b11 = a22 * a33 - a23 * a32; // Calculate the determinant\n\n  var det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  if (!det) {\n    return null;\n  }\n\n  det = 1.0 / det;\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n  out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n  out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n  out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n  out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n  out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n  out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n  out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n  out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n  return out;\n}\n/**\n * Generates a 2D projection matrix with the given bounds\n *\n * @param {mat3} out mat3 frustum matrix will be written into\n * @param {number} width Width of your gl context\n * @param {number} height Height of gl context\n * @returns {mat3} out\n */\n\nexport function projection(out, width, height) {\n  out[0] = 2 / width;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 0;\n  out[4] = -2 / height;\n  out[5] = 0;\n  out[6] = -1;\n  out[7] = 1;\n  out[8] = 1;\n  return out;\n}\n/**\n * Returns a string representation of a mat3\n *\n * @param {ReadonlyMat3} a matrix to represent as a string\n * @returns {String} string representation of the matrix\n */\n\nexport function str(a) {\n  return \"mat3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \", \" + a[4] + \", \" + a[5] + \", \" + a[6] + \", \" + a[7] + \", \" + a[8] + \")\";\n}\n/**\n * Returns Frobenius norm of a mat3\n *\n * @param {ReadonlyMat3} a the matrix to calculate Frobenius norm of\n * @returns {Number} Frobenius norm\n */\n\nexport function frob(a) {\n  return Math.hypot(a[0], a[1], a[2], a[3], a[4], a[5], a[6], a[7], a[8]);\n}\n/**\n * Adds two mat3's\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  out[4] = a[4] + b[4];\n  out[5] = a[5] + b[5];\n  out[6] = a[6] + b[6];\n  out[7] = a[7] + b[7];\n  out[8] = a[8] + b[8];\n  return out;\n}\n/**\n * Subtracts matrix b from matrix a\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @returns {mat3} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  out[4] = a[4] - b[4];\n  out[5] = a[5] - b[5];\n  out[6] = a[6] - b[6];\n  out[7] = a[7] - b[7];\n  out[8] = a[8] - b[8];\n  return out;\n}\n/**\n * Multiply each element of the matrix by a scalar.\n *\n * @param {mat3} out the receiving matrix\n * @param {ReadonlyMat3} a the matrix to scale\n * @param {Number} b amount to scale the matrix's elements by\n * @returns {mat3} out\n */\n\nexport function multiplyScalar(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  out[4] = a[4] * b;\n  out[5] = a[5] * b;\n  out[6] = a[6] * b;\n  out[7] = a[7] * b;\n  out[8] = a[8] * b;\n  return out;\n}\n/**\n * Adds two mat3's after multiplying each element of the second operand by a scalar value.\n *\n * @param {mat3} out the receiving vector\n * @param {ReadonlyMat3} a the first operand\n * @param {ReadonlyMat3} b the second operand\n * @param {Number} scale the amount to scale b's elements by before adding\n * @returns {mat3} out\n */\n\nexport function multiplyScalarAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  out[4] = a[4] + b[4] * scale;\n  out[5] = a[5] + b[5] * scale;\n  out[6] = a[6] + b[6] * scale;\n  out[7] = a[7] + b[7] * scale;\n  out[8] = a[8] + b[8] * scale;\n  return out;\n}\n/**\n * Returns whether or not the matrices have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyMat3} a The first matrix.\n * @param {ReadonlyMat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3] && a[4] === b[4] && a[5] === b[5] && a[6] === b[6] && a[7] === b[7] && a[8] === b[8];\n}\n/**\n * Returns whether or not the matrices have approximately the same elements in the same position.\n *\n * @param {ReadonlyMat3} a The first matrix.\n * @param {ReadonlyMat3} b The second matrix.\n * @returns {Boolean} True if the matrices are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3],\n      a4 = a[4],\n      a5 = a[5],\n      a6 = a[6],\n      a7 = a[7],\n      a8 = a[8];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3],\n      b4 = b[4],\n      b5 = b[5],\n      b6 = b[6],\n      b7 = b[7],\n      b8 = b[8];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3)) && Math.abs(a4 - b4) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a4), Math.abs(b4)) && Math.abs(a5 - b5) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a5), Math.abs(b5)) && Math.abs(a6 - b6) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a6), Math.abs(b6)) && Math.abs(a7 - b7) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a7), Math.abs(b7)) && Math.abs(a8 - b8) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a8), Math.abs(b8));\n}\n/**\n * Alias for {@link mat3.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link mat3.subtract}\n * @function\n */\n\nexport var sub = subtract;","import * as glMatrix from \"./common.js\";\n/**\n * 3 Dimensional Vector\n * @module vec3\n */\n\n/**\n * Creates a new, empty vec3\n *\n * @returns {vec3} a new 3D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(3);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec3 initialized with values from an existing vector\n *\n * @param {ReadonlyVec3} a vector to clone\n * @returns {vec3} a new 3D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Calculates the length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Creates a new vec3 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} a new 3D vector\n */\n\nexport function fromValues(x, y, z) {\n  var out = new glMatrix.ARRAY_TYPE(3);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Copy the values from one vec3 to another\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the source vector\n * @returns {vec3} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  return out;\n}\n/**\n * Set the components of a vec3 to the given values\n *\n * @param {vec3} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @returns {vec3} out\n */\n\nexport function set(out, x, y, z) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  return out;\n}\n/**\n * Adds two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  return out;\n}\n/**\n * Multiplies two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  return out;\n}\n/**\n * Divides two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  return out;\n}\n/**\n * Math.ceil the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to ceil\n * @returns {vec3} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  return out;\n}\n/**\n * Math.floor the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to floor\n * @returns {vec3} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  return out;\n}\n/**\n * Returns the minimum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  return out;\n}\n/**\n * Returns the maximum of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  return out;\n}\n/**\n * Math.round the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to round\n * @returns {vec3} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  return out;\n}\n/**\n * Scales a vec3 by a scalar number\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec3} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  return out;\n}\n/**\n * Adds two vec3's after scaling the second operand by a scalar value\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec3} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return Math.hypot(x, y, z);\n}\n/**\n * Calculates the squared euclidian distance between two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Calculates the squared length of a vec3\n *\n * @param {ReadonlyVec3} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  return x * x + y * y + z * z;\n}\n/**\n * Negates the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to negate\n * @returns {vec3} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to invert\n * @returns {vec3} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  return out;\n}\n/**\n * Normalize a vec3\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a vector to normalize\n * @returns {vec3} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var len = x * x + y * y + z * z;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  out[2] = a[2] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec3's\n *\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n/**\n * Computes the cross product of two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2];\n  out[0] = ay * bz - az * by;\n  out[1] = az * bx - ax * bz;\n  out[2] = ax * by - ay * bx;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  return out;\n}\n/**\n * Performs a spherical linear interpolation between two vec3's\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function slerp(out, a, b, t) {\n  var angle = Math.acos(Math.min(Math.max(dot(a, b), -1), 1));\n  var sinTotal = Math.sin(angle);\n  var ratioA = Math.sin((1 - t) * angle) / sinTotal;\n  var ratioB = Math.sin(t * angle) / sinTotal;\n  out[0] = ratioA * a[0] + ratioB * b[0];\n  out[1] = ratioA * a[1] + ratioB * b[1];\n  out[2] = ratioA * a[2] + ratioB * b[2];\n  return out;\n}\n/**\n * Performs a hermite interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function hermite(out, a, b, c, d, t) {\n  var factorTimes2 = t * t;\n  var factor1 = factorTimes2 * (2 * t - 3) + 1;\n  var factor2 = factorTimes2 * (t - 2) + t;\n  var factor3 = factorTimes2 * (t - 1);\n  var factor4 = factorTimes2 * (3 - 2 * t);\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Performs a bezier interpolation with two control points\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the first operand\n * @param {ReadonlyVec3} b the second operand\n * @param {ReadonlyVec3} c the third operand\n * @param {ReadonlyVec3} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec3} out\n */\n\nexport function bezier(out, a, b, c, d, t) {\n  var inverseFactor = 1 - t;\n  var inverseFactorTimesTwo = inverseFactor * inverseFactor;\n  var factorTimes2 = t * t;\n  var factor1 = inverseFactorTimesTwo * inverseFactor;\n  var factor2 = 3 * t * inverseFactorTimesTwo;\n  var factor3 = 3 * factorTimes2 * inverseFactor;\n  var factor4 = factorTimes2 * t;\n  out[0] = a[0] * factor1 + b[0] * factor2 + c[0] * factor3 + d[0] * factor4;\n  out[1] = a[1] * factor1 + b[1] * factor2 + c[1] * factor3 + d[1] * factor4;\n  out[2] = a[2] * factor1 + b[2] * factor2 + c[2] * factor3 + d[2] * factor4;\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec3} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec3} out\n */\n\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  var z = glMatrix.RANDOM() * 2.0 - 1.0;\n  var zScale = Math.sqrt(1.0 - z * z) * scale;\n  out[0] = Math.cos(r) * zScale;\n  out[1] = Math.sin(r) * zScale;\n  out[2] = z * scale;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat4.\n * 4th vector component is implicitly '1'\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var w = m[3] * x + m[7] * y + m[11] * z + m[15];\n  w = w || 1.0;\n  out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n  out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n  out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n  return out;\n}\n/**\n * Transforms the vec3 with a mat3.\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyMat3} m the 3x3 matrix to transform with\n * @returns {vec3} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  out[0] = x * m[0] + y * m[3] + z * m[6];\n  out[1] = x * m[1] + y * m[4] + z * m[7];\n  out[2] = x * m[2] + y * m[5] + z * m[8];\n  return out;\n}\n/**\n * Transforms the vec3 with a quat\n * Can also be used for dual quaternions. (Multiply it with the real part)\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec3} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec3} out\n */\n\nexport function transformQuat(out, a, q) {\n  // benchmarks: https://jsperf.com/quaternion-transform-vec3-implementations-fixed\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3];\n  var x = a[0],\n      y = a[1],\n      z = a[2]; // var qvec = [qx, qy, qz];\n  // var uv = vec3.cross([], qvec, a);\n\n  var uvx = qy * z - qz * y,\n      uvy = qz * x - qx * z,\n      uvz = qx * y - qy * x; // var uuv = vec3.cross([], qvec, uv);\n\n  var uuvx = qy * uvz - qz * uvy,\n      uuvy = qz * uvx - qx * uvz,\n      uuvz = qx * uvy - qy * uvx; // vec3.scale(uv, uv, 2 * w);\n\n  var w2 = qw * 2;\n  uvx *= w2;\n  uvy *= w2;\n  uvz *= w2; // vec3.scale(uuv, uuv, 2);\n\n  uuvx *= 2;\n  uuvy *= 2;\n  uuvz *= 2; // return vec3.add(out, a, vec3.add(out, uv, uuv));\n\n  out[0] = x + uvx + uuvx;\n  out[1] = y + uvy + uuvy;\n  out[2] = z + uvz + uuvz;\n  return out;\n}\n/**\n * Rotate a 3D vector around the x-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateX(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0];\n  r[1] = p[1] * Math.cos(rad) - p[2] * Math.sin(rad);\n  r[2] = p[1] * Math.sin(rad) + p[2] * Math.cos(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the y-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateY(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[2] * Math.sin(rad) + p[0] * Math.cos(rad);\n  r[1] = p[1];\n  r[2] = p[2] * Math.cos(rad) - p[0] * Math.sin(rad); //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Rotate a 3D vector around the z-axis\n * @param {vec3} out The receiving vec3\n * @param {ReadonlyVec3} a The vec3 point to rotate\n * @param {ReadonlyVec3} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec3} out\n */\n\nexport function rotateZ(out, a, b, rad) {\n  var p = [],\n      r = []; //Translate point to the origin\n\n  p[0] = a[0] - b[0];\n  p[1] = a[1] - b[1];\n  p[2] = a[2] - b[2]; //perform rotation\n\n  r[0] = p[0] * Math.cos(rad) - p[1] * Math.sin(rad);\n  r[1] = p[0] * Math.sin(rad) + p[1] * Math.cos(rad);\n  r[2] = p[2]; //translate to correct position\n\n  out[0] = r[0] + b[0];\n  out[1] = r[1] + b[1];\n  out[2] = r[2] + b[2];\n  return out;\n}\n/**\n * Get the angle between two 3D vectors\n * @param {ReadonlyVec3} a The first operand\n * @param {ReadonlyVec3} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      bx = b[0],\n      by = b[1],\n      bz = b[2],\n      mag = Math.sqrt((ax * ax + ay * ay + az * az) * (bx * bx + by * by + bz * bz)),\n      cosine = mag && dot(a, b) / mag;\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec3 to zero\n *\n * @param {vec3} out the receiving vector\n * @returns {vec3} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec3} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec3(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec3} a The first vector.\n * @param {ReadonlyVec3} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2));\n}\n/**\n * Alias for {@link vec3.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec3.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec3.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec3.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec3.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec3.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec3.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec3s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec3. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec3s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 3;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n    }\n\n    return a;\n  };\n}();","import * as glMatrix from \"./common.js\";\n/**\n * 4 Dimensional Vector\n * @module vec4\n */\n\n/**\n * Creates a new, empty vec4\n *\n * @returns {vec4} a new 4D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(4);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec4 initialized with values from an existing vector\n *\n * @param {ReadonlyVec4} a vector to clone\n * @returns {vec4} a new 4D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\n * Creates a new vec4 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {vec4} a new 4D vector\n */\n\nexport function fromValues(x, y, z, w) {\n  var out = new glMatrix.ARRAY_TYPE(4);\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n/**\n * Copy the values from one vec4 to another\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the source vector\n * @returns {vec4} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  out[2] = a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\n * Set the components of a vec4 to the given values\n *\n * @param {vec4} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {vec4} out\n */\n\nexport function set(out, x, y, z, w) {\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = w;\n  return out;\n}\n/**\n * Adds two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  out[2] = a[2] + b[2];\n  out[3] = a[3] + b[3];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  out[2] = a[2] - b[2];\n  out[3] = a[3] - b[3];\n  return out;\n}\n/**\n * Multiplies two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  out[2] = a[2] * b[2];\n  out[3] = a[3] * b[3];\n  return out;\n}\n/**\n * Divides two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  out[2] = a[2] / b[2];\n  out[3] = a[3] / b[3];\n  return out;\n}\n/**\n * Math.ceil the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to ceil\n * @returns {vec4} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  out[2] = Math.ceil(a[2]);\n  out[3] = Math.ceil(a[3]);\n  return out;\n}\n/**\n * Math.floor the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to floor\n * @returns {vec4} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  out[2] = Math.floor(a[2]);\n  out[3] = Math.floor(a[3]);\n  return out;\n}\n/**\n * Returns the minimum of two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  out[2] = Math.min(a[2], b[2]);\n  out[3] = Math.min(a[3], b[3]);\n  return out;\n}\n/**\n * Returns the maximum of two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {vec4} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  out[2] = Math.max(a[2], b[2]);\n  out[3] = Math.max(a[3], b[3]);\n  return out;\n}\n/**\n * Math.round the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to round\n * @returns {vec4} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  out[2] = Math.round(a[2]);\n  out[3] = Math.round(a[3]);\n  return out;\n}\n/**\n * Scales a vec4 by a scalar number\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec4} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  out[2] = a[2] * b;\n  out[3] = a[3] * b;\n  return out;\n}\n/**\n * Adds two vec4's after scaling the second operand by a scalar value\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec4} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  out[2] = a[2] + b[2] * scale;\n  out[3] = a[3] + b[3] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return Math.hypot(x, y, z, w);\n}\n/**\n * Calculates the squared euclidian distance between two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0];\n  var y = b[1] - a[1];\n  var z = b[2] - a[2];\n  var w = b[3] - a[3];\n  return x * x + y * y + z * z + w * w;\n}\n/**\n * Calculates the length of a vec4\n *\n * @param {ReadonlyVec4} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return Math.hypot(x, y, z, w);\n}\n/**\n * Calculates the squared length of a vec4\n *\n * @param {ReadonlyVec4} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  return x * x + y * y + z * z + w * w;\n}\n/**\n * Negates the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to negate\n * @returns {vec4} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  out[3] = -a[3];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to invert\n * @returns {vec4} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  out[2] = 1.0 / a[2];\n  out[3] = 1.0 / a[3];\n  return out;\n}\n/**\n * Normalize a vec4\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a vector to normalize\n * @returns {vec4} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0];\n  var y = a[1];\n  var z = a[2];\n  var w = a[3];\n  var len = x * x + y * y + z * z + w * w;\n\n  if (len > 0) {\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = x * len;\n  out[1] = y * len;\n  out[2] = z * len;\n  out[3] = w * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec4's\n *\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\n/**\n * Returns the cross-product of three vectors in a 4-dimensional space\n *\n * @param {ReadonlyVec4} result the receiving vector\n * @param {ReadonlyVec4} U the first vector\n * @param {ReadonlyVec4} V the second vector\n * @param {ReadonlyVec4} W the third vector\n * @returns {vec4} result\n */\n\nexport function cross(out, u, v, w) {\n  var A = v[0] * w[1] - v[1] * w[0],\n      B = v[0] * w[2] - v[2] * w[0],\n      C = v[0] * w[3] - v[3] * w[0],\n      D = v[1] * w[2] - v[2] * w[1],\n      E = v[1] * w[3] - v[3] * w[1],\n      F = v[2] * w[3] - v[3] * w[2];\n  var G = u[0];\n  var H = u[1];\n  var I = u[2];\n  var J = u[3];\n  out[0] = H * F - I * E + J * D;\n  out[1] = -(G * F) + I * C - J * B;\n  out[2] = G * E - H * C + J * A;\n  out[3] = -(G * D) + H * B - I * A;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec4's\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the first operand\n * @param {ReadonlyVec4} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec4} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0];\n  var ay = a[1];\n  var az = a[2];\n  var aw = a[3];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  out[2] = az + t * (b[2] - az);\n  out[3] = aw + t * (b[3] - aw);\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec4} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec4} out\n */\n\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale; // Marsaglia, George. Choosing a Point from the Surface of a\n  // Sphere. Ann. Math. Statist. 43 (1972), no. 2, 645--646.\n  // http://projecteuclid.org/euclid.aoms/1177692644;\n\n  var v1, v2, v3, v4;\n  var s1, s2;\n\n  do {\n    v1 = glMatrix.RANDOM() * 2 - 1;\n    v2 = glMatrix.RANDOM() * 2 - 1;\n    s1 = v1 * v1 + v2 * v2;\n  } while (s1 >= 1);\n\n  do {\n    v3 = glMatrix.RANDOM() * 2 - 1;\n    v4 = glMatrix.RANDOM() * 2 - 1;\n    s2 = v3 * v3 + v4 * v4;\n  } while (s2 >= 1);\n\n  var d = Math.sqrt((1 - s1) / s2);\n  out[0] = scale * v1;\n  out[1] = scale * v2;\n  out[2] = scale * v3 * d;\n  out[3] = scale * v4 * d;\n  return out;\n}\n/**\n * Transforms the vec4 with a mat4.\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec4} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0],\n      y = a[1],\n      z = a[2],\n      w = a[3];\n  out[0] = m[0] * x + m[4] * y + m[8] * z + m[12] * w;\n  out[1] = m[1] * x + m[5] * y + m[9] * z + m[13] * w;\n  out[2] = m[2] * x + m[6] * y + m[10] * z + m[14] * w;\n  out[3] = m[3] * x + m[7] * y + m[11] * z + m[15] * w;\n  return out;\n}\n/**\n * Transforms the vec4 with a quat\n *\n * @param {vec4} out the receiving vector\n * @param {ReadonlyVec4} a the vector to transform\n * @param {ReadonlyQuat} q quaternion to transform with\n * @returns {vec4} out\n */\n\nexport function transformQuat(out, a, q) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  var qx = q[0],\n      qy = q[1],\n      qz = q[2],\n      qw = q[3]; // calculate quat * vec\n\n  var ix = qw * x + qy * z - qz * y;\n  var iy = qw * y + qz * x - qx * z;\n  var iz = qw * z + qx * y - qy * x;\n  var iw = -qx * x - qy * y - qz * z; // calculate result * inverse quat\n\n  out[0] = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n  out[1] = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n  out[2] = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n  out[3] = a[3];\n  return out;\n}\n/**\n * Set the components of a vec4 to zero\n *\n * @param {vec4} out the receiving vector\n * @returns {vec4} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  out[2] = 0.0;\n  out[3] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec4} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec4(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \")\";\n}\n/**\n * Returns whether or not the vectors have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec4} a The first vector.\n * @param {ReadonlyVec4} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec4} a The first vector.\n * @param {ReadonlyVec4} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var b0 = b[0],\n      b1 = b[1],\n      b2 = b[2],\n      b3 = b[3];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1)) && Math.abs(a2 - b2) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a2), Math.abs(b2)) && Math.abs(a3 - b3) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a3), Math.abs(b3));\n}\n/**\n * Alias for {@link vec4.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec4.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec4.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec4.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec4.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec4.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec4.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec4s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec4. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec4s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 4;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      vec[2] = a[i + 2];\n      vec[3] = a[i + 3];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n      a[i + 2] = vec[2];\n      a[i + 3] = vec[3];\n    }\n\n    return a;\n  };\n}();","import * as glMatrix from \"./common.js\";\nimport * as mat3 from \"./mat3.js\";\nimport * as vec3 from \"./vec3.js\";\nimport * as vec4 from \"./vec4.js\";\n/**\n * Quaternion in the format XYZW\n * @module quat\n */\n\n/**\n * Creates a new identity quat\n *\n * @returns {quat} a new quaternion\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(4);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n  }\n\n  out[3] = 1;\n  return out;\n}\n/**\n * Set a quat to the identity quaternion\n *\n * @param {quat} out the receiving quaternion\n * @returns {quat} out\n */\n\nexport function identity(out) {\n  out[0] = 0;\n  out[1] = 0;\n  out[2] = 0;\n  out[3] = 1;\n  return out;\n}\n/**\n * Sets a quat from the given angle and rotation axis,\n * then returns it.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyVec3} axis the axis around which to rotate\n * @param {Number} rad the angle in radians\n * @returns {quat} out\n **/\n\nexport function setAxisAngle(out, axis, rad) {\n  rad = rad * 0.5;\n  var s = Math.sin(rad);\n  out[0] = s * axis[0];\n  out[1] = s * axis[1];\n  out[2] = s * axis[2];\n  out[3] = Math.cos(rad);\n  return out;\n}\n/**\n * Gets the rotation axis and angle for a given\n *  quaternion. If a quaternion is created with\n *  setAxisAngle, this method will return the same\n *  values as providied in the original parameter list\n *  OR functionally equivalent values.\n * Example: The quaternion formed by axis [0, 0, 1] and\n *  angle -90 is the same as the quaternion formed by\n *  [0, 0, 1] and 270. This method favors the latter.\n * @param  {vec3} out_axis  Vector receiving the axis of rotation\n * @param  {ReadonlyQuat} q     Quaternion to be decomposed\n * @return {Number}     Angle, in radians, of the rotation\n */\n\nexport function getAxisAngle(out_axis, q) {\n  var rad = Math.acos(q[3]) * 2.0;\n  var s = Math.sin(rad / 2.0);\n\n  if (s > glMatrix.EPSILON) {\n    out_axis[0] = q[0] / s;\n    out_axis[1] = q[1] / s;\n    out_axis[2] = q[2] / s;\n  } else {\n    // If s is zero, return any axis (no rotation - axis does not matter)\n    out_axis[0] = 1;\n    out_axis[1] = 0;\n    out_axis[2] = 0;\n  }\n\n  return rad;\n}\n/**\n * Gets the angular distance between two unit quaternions\n *\n * @param  {ReadonlyQuat} a     Origin unit quaternion\n * @param  {ReadonlyQuat} b     Destination unit quaternion\n * @return {Number}     Angle, in radians, between the two quaternions\n */\n\nexport function getAngle(a, b) {\n  var dotproduct = dot(a, b);\n  return Math.acos(2 * dotproduct * dotproduct - 1);\n}\n/**\n * Multiplies two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @returns {quat} out\n */\n\nexport function multiply(out, a, b) {\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      aw = a[3];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2],\n      bw = b[3];\n  out[0] = ax * bw + aw * bx + ay * bz - az * by;\n  out[1] = ay * bw + aw * by + az * bx - ax * bz;\n  out[2] = az * bw + aw * bz + ax * by - ay * bx;\n  out[3] = aw * bw - ax * bx - ay * by - az * bz;\n  return out;\n}\n/**\n * Rotates a quaternion by the given angle about the X axis\n *\n * @param {quat} out quat receiving operation result\n * @param {ReadonlyQuat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\n\nexport function rotateX(out, a, rad) {\n  rad *= 0.5;\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      aw = a[3];\n  var bx = Math.sin(rad),\n      bw = Math.cos(rad);\n  out[0] = ax * bw + aw * bx;\n  out[1] = ay * bw + az * bx;\n  out[2] = az * bw - ay * bx;\n  out[3] = aw * bw - ax * bx;\n  return out;\n}\n/**\n * Rotates a quaternion by the given angle about the Y axis\n *\n * @param {quat} out quat receiving operation result\n * @param {ReadonlyQuat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\n\nexport function rotateY(out, a, rad) {\n  rad *= 0.5;\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      aw = a[3];\n  var by = Math.sin(rad),\n      bw = Math.cos(rad);\n  out[0] = ax * bw - az * by;\n  out[1] = ay * bw + aw * by;\n  out[2] = az * bw + ax * by;\n  out[3] = aw * bw - ay * by;\n  return out;\n}\n/**\n * Rotates a quaternion by the given angle about the Z axis\n *\n * @param {quat} out quat receiving operation result\n * @param {ReadonlyQuat} a quat to rotate\n * @param {number} rad angle (in radians) to rotate\n * @returns {quat} out\n */\n\nexport function rotateZ(out, a, rad) {\n  rad *= 0.5;\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      aw = a[3];\n  var bz = Math.sin(rad),\n      bw = Math.cos(rad);\n  out[0] = ax * bw + ay * bz;\n  out[1] = ay * bw - ax * bz;\n  out[2] = az * bw + aw * bz;\n  out[3] = aw * bw - az * bz;\n  return out;\n}\n/**\n * Calculates the W component of a quat from the X, Y, and Z components.\n * Assumes that quaternion is 1 unit in length.\n * Any existing W component will be ignored.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate W component of\n * @returns {quat} out\n */\n\nexport function calculateW(out, a) {\n  var x = a[0],\n      y = a[1],\n      z = a[2];\n  out[0] = x;\n  out[1] = y;\n  out[2] = z;\n  out[3] = Math.sqrt(Math.abs(1.0 - x * x - y * y - z * z));\n  return out;\n}\n/**\n * Calculate the exponential of a unit quaternion.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate the exponential of\n * @returns {quat} out\n */\n\nexport function exp(out, a) {\n  var x = a[0],\n      y = a[1],\n      z = a[2],\n      w = a[3];\n  var r = Math.sqrt(x * x + y * y + z * z);\n  var et = Math.exp(w);\n  var s = r > 0 ? et * Math.sin(r) / r : 0;\n  out[0] = x * s;\n  out[1] = y * s;\n  out[2] = z * s;\n  out[3] = et * Math.cos(r);\n  return out;\n}\n/**\n * Calculate the natural logarithm of a unit quaternion.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate the exponential of\n * @returns {quat} out\n */\n\nexport function ln(out, a) {\n  var x = a[0],\n      y = a[1],\n      z = a[2],\n      w = a[3];\n  var r = Math.sqrt(x * x + y * y + z * z);\n  var t = r > 0 ? Math.atan2(r, w) / r : 0;\n  out[0] = x * t;\n  out[1] = y * t;\n  out[2] = z * t;\n  out[3] = 0.5 * Math.log(x * x + y * y + z * z + w * w);\n  return out;\n}\n/**\n * Calculate the scalar power of a unit quaternion.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate the exponential of\n * @param {Number} b amount to scale the quaternion by\n * @returns {quat} out\n */\n\nexport function pow(out, a, b) {\n  ln(out, a);\n  scale(out, out, b);\n  exp(out, out);\n  return out;\n}\n/**\n * Performs a spherical linear interpolation between two quat\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n */\n\nexport function slerp(out, a, b, t) {\n  // benchmarks:\n  //    http://jsperf.com/quaternion-slerp-implementations\n  var ax = a[0],\n      ay = a[1],\n      az = a[2],\n      aw = a[3];\n  var bx = b[0],\n      by = b[1],\n      bz = b[2],\n      bw = b[3];\n  var omega, cosom, sinom, scale0, scale1; // calc cosine\n\n  cosom = ax * bx + ay * by + az * bz + aw * bw; // adjust signs (if necessary)\n\n  if (cosom < 0.0) {\n    cosom = -cosom;\n    bx = -bx;\n    by = -by;\n    bz = -bz;\n    bw = -bw;\n  } // calculate coefficients\n\n\n  if (1.0 - cosom > glMatrix.EPSILON) {\n    // standard case (slerp)\n    omega = Math.acos(cosom);\n    sinom = Math.sin(omega);\n    scale0 = Math.sin((1.0 - t) * omega) / sinom;\n    scale1 = Math.sin(t * omega) / sinom;\n  } else {\n    // \"from\" and \"to\" quaternions are very close\n    //  ... so we can do a linear interpolation\n    scale0 = 1.0 - t;\n    scale1 = t;\n  } // calculate final values\n\n\n  out[0] = scale0 * ax + scale1 * bx;\n  out[1] = scale0 * ay + scale1 * by;\n  out[2] = scale0 * az + scale1 * bz;\n  out[3] = scale0 * aw + scale1 * bw;\n  return out;\n}\n/**\n * Generates a random unit quaternion\n *\n * @param {quat} out the receiving quaternion\n * @returns {quat} out\n */\n\nexport function random(out) {\n  // Implementation of http://planning.cs.uiuc.edu/node198.html\n  // TODO: Calling random 3 times is probably not the fastest solution\n  var u1 = glMatrix.RANDOM();\n  var u2 = glMatrix.RANDOM();\n  var u3 = glMatrix.RANDOM();\n  var sqrt1MinusU1 = Math.sqrt(1 - u1);\n  var sqrtU1 = Math.sqrt(u1);\n  out[0] = sqrt1MinusU1 * Math.sin(2.0 * Math.PI * u2);\n  out[1] = sqrt1MinusU1 * Math.cos(2.0 * Math.PI * u2);\n  out[2] = sqrtU1 * Math.sin(2.0 * Math.PI * u3);\n  out[3] = sqrtU1 * Math.cos(2.0 * Math.PI * u3);\n  return out;\n}\n/**\n * Calculates the inverse of a quat\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate inverse of\n * @returns {quat} out\n */\n\nexport function invert(out, a) {\n  var a0 = a[0],\n      a1 = a[1],\n      a2 = a[2],\n      a3 = a[3];\n  var dot = a0 * a0 + a1 * a1 + a2 * a2 + a3 * a3;\n  var invDot = dot ? 1.0 / dot : 0; // TODO: Would be faster to return [0,0,0,0] immediately if dot == 0\n\n  out[0] = -a0 * invDot;\n  out[1] = -a1 * invDot;\n  out[2] = -a2 * invDot;\n  out[3] = a3 * invDot;\n  return out;\n}\n/**\n * Calculates the conjugate of a quat\n * If the quaternion is normalized, this function is faster than quat.inverse and produces the same result.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quat to calculate conjugate of\n * @returns {quat} out\n */\n\nexport function conjugate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  out[2] = -a[2];\n  out[3] = a[3];\n  return out;\n}\n/**\n * Creates a quaternion from the given 3x3 rotation matrix.\n *\n * NOTE: The resultant quaternion is not normalized, so you should be sure\n * to renormalize the quaternion yourself where necessary.\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyMat3} m rotation matrix\n * @returns {quat} out\n * @function\n */\n\nexport function fromMat3(out, m) {\n  // Algorithm in Ken Shoemake's article in 1987 SIGGRAPH course notes\n  // article \"Quaternion Calculus and Fast Animation\".\n  var fTrace = m[0] + m[4] + m[8];\n  var fRoot;\n\n  if (fTrace > 0.0) {\n    // |w| > 1/2, may as well choose w > 1/2\n    fRoot = Math.sqrt(fTrace + 1.0); // 2w\n\n    out[3] = 0.5 * fRoot;\n    fRoot = 0.5 / fRoot; // 1/(4w)\n\n    out[0] = (m[5] - m[7]) * fRoot;\n    out[1] = (m[6] - m[2]) * fRoot;\n    out[2] = (m[1] - m[3]) * fRoot;\n  } else {\n    // |w| <= 1/2\n    var i = 0;\n    if (m[4] > m[0]) i = 1;\n    if (m[8] > m[i * 3 + i]) i = 2;\n    var j = (i + 1) % 3;\n    var k = (i + 2) % 3;\n    fRoot = Math.sqrt(m[i * 3 + i] - m[j * 3 + j] - m[k * 3 + k] + 1.0);\n    out[i] = 0.5 * fRoot;\n    fRoot = 0.5 / fRoot;\n    out[3] = (m[j * 3 + k] - m[k * 3 + j]) * fRoot;\n    out[j] = (m[j * 3 + i] + m[i * 3 + j]) * fRoot;\n    out[k] = (m[k * 3 + i] + m[i * 3 + k]) * fRoot;\n  }\n\n  return out;\n}\n/**\n * Creates a quaternion from the given euler angle x, y, z using the provided intrinsic order for the conversion.\n *\n * @param {quat} out the receiving quaternion\n * @param {x} x Angle to rotate around X axis in degrees.\n * @param {y} y Angle to rotate around Y axis in degrees.\n * @param {z} z Angle to rotate around Z axis in degrees.\n * @param {'zyx'|'xyz'|'yxz'|'yzx'|'zxy'|'zyx'} order Intrinsic order for conversion, default is zyx.\n * @returns {quat} out\n * @function\n */\n\nexport function fromEuler(out, x, y, z) {\n  var order = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : glMatrix.ANGLE_ORDER;\n  var halfToRad = Math.PI / 360;\n  x *= halfToRad;\n  z *= halfToRad;\n  y *= halfToRad;\n  var sx = Math.sin(x);\n  var cx = Math.cos(x);\n  var sy = Math.sin(y);\n  var cy = Math.cos(y);\n  var sz = Math.sin(z);\n  var cz = Math.cos(z);\n\n  switch (order) {\n    case \"xyz\":\n      out[0] = sx * cy * cz + cx * sy * sz;\n      out[1] = cx * sy * cz - sx * cy * sz;\n      out[2] = cx * cy * sz + sx * sy * cz;\n      out[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case \"xzy\":\n      out[0] = sx * cy * cz - cx * sy * sz;\n      out[1] = cx * sy * cz - sx * cy * sz;\n      out[2] = cx * cy * sz + sx * sy * cz;\n      out[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    case \"yxz\":\n      out[0] = sx * cy * cz + cx * sy * sz;\n      out[1] = cx * sy * cz - sx * cy * sz;\n      out[2] = cx * cy * sz - sx * sy * cz;\n      out[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    case \"yzx\":\n      out[0] = sx * cy * cz + cx * sy * sz;\n      out[1] = cx * sy * cz + sx * cy * sz;\n      out[2] = cx * cy * sz - sx * sy * cz;\n      out[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case \"zxy\":\n      out[0] = sx * cy * cz - cx * sy * sz;\n      out[1] = cx * sy * cz + sx * cy * sz;\n      out[2] = cx * cy * sz + sx * sy * cz;\n      out[3] = cx * cy * cz - sx * sy * sz;\n      break;\n\n    case \"zyx\":\n      out[0] = sx * cy * cz - cx * sy * sz;\n      out[1] = cx * sy * cz + sx * cy * sz;\n      out[2] = cx * cy * sz - sx * sy * cz;\n      out[3] = cx * cy * cz + sx * sy * sz;\n      break;\n\n    default:\n      throw new Error('Unknown angle order ' + order);\n  }\n\n  return out;\n}\n/**\n * Returns a string representation of a quaternion\n *\n * @param {ReadonlyQuat} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"quat(\" + a[0] + \", \" + a[1] + \", \" + a[2] + \", \" + a[3] + \")\";\n}\n/**\n * Creates a new quat initialized with values from an existing quaternion\n *\n * @param {ReadonlyQuat} a quaternion to clone\n * @returns {quat} a new quaternion\n * @function\n */\n\nexport var clone = vec4.clone;\n/**\n * Creates a new quat initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {quat} a new quaternion\n * @function\n */\n\nexport var fromValues = vec4.fromValues;\n/**\n * Copy the values from one quat to another\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the source quaternion\n * @returns {quat} out\n * @function\n */\n\nexport var copy = vec4.copy;\n/**\n * Set the components of a quat to the given values\n *\n * @param {quat} out the receiving quaternion\n * @param {Number} x X component\n * @param {Number} y Y component\n * @param {Number} z Z component\n * @param {Number} w W component\n * @returns {quat} out\n * @function\n */\n\nexport var set = vec4.set;\n/**\n * Adds two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @returns {quat} out\n * @function\n */\n\nexport var add = vec4.add;\n/**\n * Alias for {@link quat.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Scales a quat by a scalar number\n *\n * @param {quat} out the receiving vector\n * @param {ReadonlyQuat} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {quat} out\n * @function\n */\n\nexport var scale = vec4.scale;\n/**\n * Calculates the dot product of two quat's\n *\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @returns {Number} dot product of a and b\n * @function\n */\n\nexport var dot = vec4.dot;\n/**\n * Performs a linear interpolation between two quat's\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n * @function\n */\n\nexport var lerp = vec4.lerp;\n/**\n * Calculates the length of a quat\n *\n * @param {ReadonlyQuat} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport var length = vec4.length;\n/**\n * Alias for {@link quat.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Calculates the squared length of a quat\n *\n * @param {ReadonlyQuat} a vector to calculate squared length of\n * @returns {Number} squared length of a\n * @function\n */\n\nexport var squaredLength = vec4.squaredLength;\n/**\n * Alias for {@link quat.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Normalize a quat\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a quaternion to normalize\n * @returns {quat} out\n * @function\n */\n\nexport var normalize = vec4.normalize;\n/**\n * Returns whether or not the quaternions have exactly the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyQuat} a The first quaternion.\n * @param {ReadonlyQuat} b The second quaternion.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport var exactEquals = vec4.exactEquals;\n/**\n * Returns whether or not the quaternions point approximately to the same direction.\n *\n * Both quaternions are assumed to be unit length.\n *\n * @param {ReadonlyQuat} a The first unit quaternion.\n * @param {ReadonlyQuat} b The second unit quaternion.\n * @returns {Boolean} True if the quaternions are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  return Math.abs(vec4.dot(a, b)) >= 1 - glMatrix.EPSILON;\n}\n/**\n * Sets a quaternion to represent the shortest rotation from one\n * vector to another.\n *\n * Both vectors are assumed to be unit length.\n *\n * @param {quat} out the receiving quaternion.\n * @param {ReadonlyVec3} a the initial vector\n * @param {ReadonlyVec3} b the destination vector\n * @returns {quat} out\n */\n\nexport var rotationTo = function () {\n  var tmpvec3 = vec3.create();\n  var xUnitVec3 = vec3.fromValues(1, 0, 0);\n  var yUnitVec3 = vec3.fromValues(0, 1, 0);\n  return function (out, a, b) {\n    var dot = vec3.dot(a, b);\n\n    if (dot < -0.999999) {\n      vec3.cross(tmpvec3, xUnitVec3, a);\n      if (vec3.len(tmpvec3) < 0.000001) vec3.cross(tmpvec3, yUnitVec3, a);\n      vec3.normalize(tmpvec3, tmpvec3);\n      setAxisAngle(out, tmpvec3, Math.PI);\n      return out;\n    } else if (dot > 0.999999) {\n      out[0] = 0;\n      out[1] = 0;\n      out[2] = 0;\n      out[3] = 1;\n      return out;\n    } else {\n      vec3.cross(tmpvec3, a, b);\n      out[0] = tmpvec3[0];\n      out[1] = tmpvec3[1];\n      out[2] = tmpvec3[2];\n      out[3] = 1 + dot;\n      return normalize(out, out);\n    }\n  };\n}();\n/**\n * Performs a spherical linear interpolation with two control points\n *\n * @param {quat} out the receiving quaternion\n * @param {ReadonlyQuat} a the first operand\n * @param {ReadonlyQuat} b the second operand\n * @param {ReadonlyQuat} c the third operand\n * @param {ReadonlyQuat} d the fourth operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {quat} out\n */\n\nexport var sqlerp = function () {\n  var temp1 = create();\n  var temp2 = create();\n  return function (out, a, b, c, d, t) {\n    slerp(temp1, a, d, t);\n    slerp(temp2, b, c, t);\n    slerp(out, temp1, temp2, 2 * t * (1 - t));\n    return out;\n  };\n}();\n/**\n * Sets the specified quaternion with values corresponding to the given\n * axes. Each axis is a vec3 and is expected to be unit length and\n * perpendicular to all other specified axes.\n *\n * @param {ReadonlyVec3} view  the vector representing the viewing direction\n * @param {ReadonlyVec3} right the vector representing the local \"right\" direction\n * @param {ReadonlyVec3} up    the vector representing the local \"up\" direction\n * @returns {quat} out\n */\n\nexport var setAxes = function () {\n  var matr = mat3.create();\n  return function (out, view, right, up) {\n    matr[0] = right[0];\n    matr[3] = right[1];\n    matr[6] = right[2];\n    matr[1] = up[0];\n    matr[4] = up[1];\n    matr[7] = up[2];\n    matr[2] = -view[0];\n    matr[5] = -view[1];\n    matr[8] = -view[2];\n    return normalize(out, fromMat3(out, matr));\n  };\n}();","import * as glMatrix from \"./common.js\";\n/**\n * 2 Dimensional Vector\n * @module vec2\n */\n\n/**\n * Creates a new, empty vec2\n *\n * @returns {vec2} a new 2D vector\n */\n\nexport function create() {\n  var out = new glMatrix.ARRAY_TYPE(2);\n\n  if (glMatrix.ARRAY_TYPE != Float32Array) {\n    out[0] = 0;\n    out[1] = 0;\n  }\n\n  return out;\n}\n/**\n * Creates a new vec2 initialized with values from an existing vector\n *\n * @param {ReadonlyVec2} a vector to clone\n * @returns {vec2} a new 2D vector\n */\n\nexport function clone(a) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n/**\n * Creates a new vec2 initialized with the given values\n *\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} a new 2D vector\n */\n\nexport function fromValues(x, y) {\n  var out = new glMatrix.ARRAY_TYPE(2);\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n/**\n * Copy the values from one vec2 to another\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the source vector\n * @returns {vec2} out\n */\n\nexport function copy(out, a) {\n  out[0] = a[0];\n  out[1] = a[1];\n  return out;\n}\n/**\n * Set the components of a vec2 to the given values\n *\n * @param {vec2} out the receiving vector\n * @param {Number} x X component\n * @param {Number} y Y component\n * @returns {vec2} out\n */\n\nexport function set(out, x, y) {\n  out[0] = x;\n  out[1] = y;\n  return out;\n}\n/**\n * Adds two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function add(out, a, b) {\n  out[0] = a[0] + b[0];\n  out[1] = a[1] + b[1];\n  return out;\n}\n/**\n * Subtracts vector b from vector a\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function subtract(out, a, b) {\n  out[0] = a[0] - b[0];\n  out[1] = a[1] - b[1];\n  return out;\n}\n/**\n * Multiplies two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function multiply(out, a, b) {\n  out[0] = a[0] * b[0];\n  out[1] = a[1] * b[1];\n  return out;\n}\n/**\n * Divides two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function divide(out, a, b) {\n  out[0] = a[0] / b[0];\n  out[1] = a[1] / b[1];\n  return out;\n}\n/**\n * Math.ceil the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to ceil\n * @returns {vec2} out\n */\n\nexport function ceil(out, a) {\n  out[0] = Math.ceil(a[0]);\n  out[1] = Math.ceil(a[1]);\n  return out;\n}\n/**\n * Math.floor the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to floor\n * @returns {vec2} out\n */\n\nexport function floor(out, a) {\n  out[0] = Math.floor(a[0]);\n  out[1] = Math.floor(a[1]);\n  return out;\n}\n/**\n * Returns the minimum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function min(out, a, b) {\n  out[0] = Math.min(a[0], b[0]);\n  out[1] = Math.min(a[1], b[1]);\n  return out;\n}\n/**\n * Returns the maximum of two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec2} out\n */\n\nexport function max(out, a, b) {\n  out[0] = Math.max(a[0], b[0]);\n  out[1] = Math.max(a[1], b[1]);\n  return out;\n}\n/**\n * Math.round the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to round\n * @returns {vec2} out\n */\n\nexport function round(out, a) {\n  out[0] = Math.round(a[0]);\n  out[1] = Math.round(a[1]);\n  return out;\n}\n/**\n * Scales a vec2 by a scalar number\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to scale\n * @param {Number} b amount to scale the vector by\n * @returns {vec2} out\n */\n\nexport function scale(out, a, b) {\n  out[0] = a[0] * b;\n  out[1] = a[1] * b;\n  return out;\n}\n/**\n * Adds two vec2's after scaling the second operand by a scalar value\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} scale the amount to scale b by before adding\n * @returns {vec2} out\n */\n\nexport function scaleAndAdd(out, a, b, scale) {\n  out[0] = a[0] + b[0] * scale;\n  out[1] = a[1] + b[1] * scale;\n  return out;\n}\n/**\n * Calculates the euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} distance between a and b\n */\n\nexport function distance(a, b) {\n  var x = b[0] - a[0],\n      y = b[1] - a[1];\n  return Math.hypot(x, y);\n}\n/**\n * Calculates the squared euclidian distance between two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} squared distance between a and b\n */\n\nexport function squaredDistance(a, b) {\n  var x = b[0] - a[0],\n      y = b[1] - a[1];\n  return x * x + y * y;\n}\n/**\n * Calculates the length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate length of\n * @returns {Number} length of a\n */\n\nexport function length(a) {\n  var x = a[0],\n      y = a[1];\n  return Math.hypot(x, y);\n}\n/**\n * Calculates the squared length of a vec2\n *\n * @param {ReadonlyVec2} a vector to calculate squared length of\n * @returns {Number} squared length of a\n */\n\nexport function squaredLength(a) {\n  var x = a[0],\n      y = a[1];\n  return x * x + y * y;\n}\n/**\n * Negates the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to negate\n * @returns {vec2} out\n */\n\nexport function negate(out, a) {\n  out[0] = -a[0];\n  out[1] = -a[1];\n  return out;\n}\n/**\n * Returns the inverse of the components of a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to invert\n * @returns {vec2} out\n */\n\nexport function inverse(out, a) {\n  out[0] = 1.0 / a[0];\n  out[1] = 1.0 / a[1];\n  return out;\n}\n/**\n * Normalize a vec2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a vector to normalize\n * @returns {vec2} out\n */\n\nexport function normalize(out, a) {\n  var x = a[0],\n      y = a[1];\n  var len = x * x + y * y;\n\n  if (len > 0) {\n    //TODO: evaluate use of glm_invsqrt here?\n    len = 1 / Math.sqrt(len);\n  }\n\n  out[0] = a[0] * len;\n  out[1] = a[1] * len;\n  return out;\n}\n/**\n * Calculates the dot product of two vec2's\n *\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {Number} dot product of a and b\n */\n\nexport function dot(a, b) {\n  return a[0] * b[0] + a[1] * b[1];\n}\n/**\n * Computes the cross product of two vec2's\n * Note that the cross product must by definition produce a 3D vector\n *\n * @param {vec3} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @returns {vec3} out\n */\n\nexport function cross(out, a, b) {\n  var z = a[0] * b[1] - a[1] * b[0];\n  out[0] = out[1] = 0;\n  out[2] = z;\n  return out;\n}\n/**\n * Performs a linear interpolation between two vec2's\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the first operand\n * @param {ReadonlyVec2} b the second operand\n * @param {Number} t interpolation amount, in the range [0-1], between the two inputs\n * @returns {vec2} out\n */\n\nexport function lerp(out, a, b, t) {\n  var ax = a[0],\n      ay = a[1];\n  out[0] = ax + t * (b[0] - ax);\n  out[1] = ay + t * (b[1] - ay);\n  return out;\n}\n/**\n * Generates a random vector with the given scale\n *\n * @param {vec2} out the receiving vector\n * @param {Number} [scale] Length of the resulting vector. If omitted, a unit vector will be returned\n * @returns {vec2} out\n */\n\nexport function random(out, scale) {\n  scale = scale === undefined ? 1.0 : scale;\n  var r = glMatrix.RANDOM() * 2.0 * Math.PI;\n  out[0] = Math.cos(r) * scale;\n  out[1] = Math.sin(r) * scale;\n  return out;\n}\n/**\n * Transforms the vec2 with a mat2\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat2(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[2] * y;\n  out[1] = m[1] * x + m[3] * y;\n  return out;\n}\n/**\n * Transforms the vec2 with a mat2d\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat2d} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat2d(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[2] * y + m[4];\n  out[1] = m[1] * x + m[3] * y + m[5];\n  return out;\n}\n/**\n * Transforms the vec2 with a mat3\n * 3rd vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat3} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat3(out, a, m) {\n  var x = a[0],\n      y = a[1];\n  out[0] = m[0] * x + m[3] * y + m[6];\n  out[1] = m[1] * x + m[4] * y + m[7];\n  return out;\n}\n/**\n * Transforms the vec2 with a mat4\n * 3rd vector component is implicitly '0'\n * 4th vector component is implicitly '1'\n *\n * @param {vec2} out the receiving vector\n * @param {ReadonlyVec2} a the vector to transform\n * @param {ReadonlyMat4} m matrix to transform with\n * @returns {vec2} out\n */\n\nexport function transformMat4(out, a, m) {\n  var x = a[0];\n  var y = a[1];\n  out[0] = m[0] * x + m[4] * y + m[12];\n  out[1] = m[1] * x + m[5] * y + m[13];\n  return out;\n}\n/**\n * Rotate a 2D vector\n * @param {vec2} out The receiving vec2\n * @param {ReadonlyVec2} a The vec2 point to rotate\n * @param {ReadonlyVec2} b The origin of the rotation\n * @param {Number} rad The angle of rotation in radians\n * @returns {vec2} out\n */\n\nexport function rotate(out, a, b, rad) {\n  //Translate point to the origin\n  var p0 = a[0] - b[0],\n      p1 = a[1] - b[1],\n      sinC = Math.sin(rad),\n      cosC = Math.cos(rad); //perform rotation and translate to correct position\n\n  out[0] = p0 * cosC - p1 * sinC + b[0];\n  out[1] = p0 * sinC + p1 * cosC + b[1];\n  return out;\n}\n/**\n * Get the angle between two 2D vectors\n * @param {ReadonlyVec2} a The first operand\n * @param {ReadonlyVec2} b The second operand\n * @returns {Number} The angle in radians\n */\n\nexport function angle(a, b) {\n  var x1 = a[0],\n      y1 = a[1],\n      x2 = b[0],\n      y2 = b[1],\n      // mag is the product of the magnitudes of a and b\n  mag = Math.sqrt((x1 * x1 + y1 * y1) * (x2 * x2 + y2 * y2)),\n      // mag &&.. short circuits if mag == 0\n  cosine = mag && (x1 * x2 + y1 * y2) / mag; // Math.min(Math.max(cosine, -1), 1) clamps the cosine between -1 and 1\n\n  return Math.acos(Math.min(Math.max(cosine, -1), 1));\n}\n/**\n * Set the components of a vec2 to zero\n *\n * @param {vec2} out the receiving vector\n * @returns {vec2} out\n */\n\nexport function zero(out) {\n  out[0] = 0.0;\n  out[1] = 0.0;\n  return out;\n}\n/**\n * Returns a string representation of a vector\n *\n * @param {ReadonlyVec2} a vector to represent as a string\n * @returns {String} string representation of the vector\n */\n\nexport function str(a) {\n  return \"vec2(\" + a[0] + \", \" + a[1] + \")\";\n}\n/**\n * Returns whether or not the vectors exactly have the same elements in the same position (when compared with ===)\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function exactEquals(a, b) {\n  return a[0] === b[0] && a[1] === b[1];\n}\n/**\n * Returns whether or not the vectors have approximately the same elements in the same position.\n *\n * @param {ReadonlyVec2} a The first vector.\n * @param {ReadonlyVec2} b The second vector.\n * @returns {Boolean} True if the vectors are equal, false otherwise.\n */\n\nexport function equals(a, b) {\n  var a0 = a[0],\n      a1 = a[1];\n  var b0 = b[0],\n      b1 = b[1];\n  return Math.abs(a0 - b0) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a0), Math.abs(b0)) && Math.abs(a1 - b1) <= glMatrix.EPSILON * Math.max(1.0, Math.abs(a1), Math.abs(b1));\n}\n/**\n * Alias for {@link vec2.length}\n * @function\n */\n\nexport var len = length;\n/**\n * Alias for {@link vec2.subtract}\n * @function\n */\n\nexport var sub = subtract;\n/**\n * Alias for {@link vec2.multiply}\n * @function\n */\n\nexport var mul = multiply;\n/**\n * Alias for {@link vec2.divide}\n * @function\n */\n\nexport var div = divide;\n/**\n * Alias for {@link vec2.distance}\n * @function\n */\n\nexport var dist = distance;\n/**\n * Alias for {@link vec2.squaredDistance}\n * @function\n */\n\nexport var sqrDist = squaredDistance;\n/**\n * Alias for {@link vec2.squaredLength}\n * @function\n */\n\nexport var sqrLen = squaredLength;\n/**\n * Perform some operation over an array of vec2s.\n *\n * @param {Array} a the array of vectors to iterate over\n * @param {Number} stride Number of elements between the start of each vec2. If 0 assumes tightly packed\n * @param {Number} offset Number of elements to skip at the beginning of the array\n * @param {Number} count Number of vec2s to iterate over. If 0 iterates over entire array\n * @param {Function} fn Function to call for each vector in the array\n * @param {Object} [arg] additional argument to pass to fn\n * @returns {Array} a\n * @function\n */\n\nexport var forEach = function () {\n  var vec = create();\n  return function (a, stride, offset, count, fn, arg) {\n    var i, l;\n\n    if (!stride) {\n      stride = 2;\n    }\n\n    if (!offset) {\n      offset = 0;\n    }\n\n    if (count) {\n      l = Math.min(count * stride + offset, a.length);\n    } else {\n      l = a.length;\n    }\n\n    for (i = offset; i < l; i += stride) {\n      vec[0] = a[i];\n      vec[1] = a[i + 1];\n      fn(vec, vec, arg);\n      a[i] = vec[0];\n      a[i + 1] = vec[1];\n    }\n\n    return a;\n  };\n}();","import { mat3, vec2 } from '../../lib/gl-matrix';\n\ndeclare type Landmark = {\n\tzoom: number,\n\tx: number,\n\ty: number,\n\trotation: number,\n\tviewportX: number,\n\tviewportY: number,\n};\n\nexport class Camera\n{\n\t#x: number = 0;\n\t#y: number = 0;\n\t#rotation: number = 0;\n\t#zoom: number = 1;\n\t#width: number = 0;\n\t#height: number = 0;\n\t#matrix: Float32Array = mat3.create();\n\t#projectionMatrix: Float32Array = mat3.create();\n\t#viewMatrix: Float32Array = mat3.create();\n\t#viewProjectionMatrix: Float32Array = mat3.create();\n\t#viewProjectionMatrixInv: Float32Array = mat3.create();\n\n\t#changeCallback: (...args: any) => void | null = null;\n\n\tconstructor(options)\n\t{\n\t\tconst {\n\t\t\twidth,\n\t\t\theight,\n\t\t\tonChangeCallback,\n\t\t} = options;\n\n\t\tthis.#changeCallback = onChangeCallback;\n\t\tthis.projection(width, height);\n\t\tthis.updateMatrix();\n\t\tthis.#onChangedTransformParams({ width, height });\n\t}\n\n\tget projectionMatrix(): Float32Array\n\t{\n\t\treturn this.#projectionMatrix;\n\t}\n\n\tget viewMatrix(): Float32Array\n\t{\n\t\treturn this.#viewMatrix;\n\t}\n\n\tget viewProjectionMatrix(): Float32Array\n\t{\n\t\treturn this.#viewProjectionMatrix;\n\t}\n\n\tget viewProjectionMatrixInv(): Float32Array\n\t{\n\t\treturn this.#viewProjectionMatrixInv;\n\t}\n\n\tget matrix(): Float32Array\n\t{\n\t\treturn this.#matrix;\n\t}\n\n\tget zoom(): number\n\t{\n\t\treturn this.#zoom;\n\t}\n\n\tset zoom(zoom: number): void\n\t{\n\t\tif (this.#zoom !== zoom)\n\t\t{\n\t\t\tthis.#zoom = zoom;\n\t\t\tthis.#onChangedTransformParams({ zoom });\n\t\t\tthis.updateMatrix();\n\t\t}\n\t}\n\n\tget x(): number\n\t{\n\t\treturn this.#x;\n\t}\n\n\tset x(x: number): void\n\t{\n\t\tif (this.#x !== x)\n\t\t{\n\t\t\tthis.#x = x;\n\t\t\tthis.#onChangedTransformParams({ x });\n\t\t\tthis.updateMatrix();\n\t\t}\n\t}\n\n\tget y(): number\n\t{\n\t\treturn this.#y;\n\t}\n\n\tset y(y: number): void\n\t{\n\t\tif (this.#y !== y)\n\t\t{\n\t\t\tthis.#y = y;\n\t\t\tthis.#onChangedTransformParams({ y });\n\t\t\tthis.updateMatrix();\n\t\t}\n\t}\n\n\tget rotation(): number\n\t{\n\t\treturn this.#rotation;\n\t}\n\n\tset rotation(rotation: number): void\n\t{\n\t\tif (this.#rotation !== rotation)\n\t\t{\n\t\t\tthis.#rotation = rotation;\n\t\t\tthis.updateMatrix();\n\t\t}\n\t}\n\n\tget width(): number\n\t{\n\t\treturn this.#width;\n\t}\n\n\tget height(): number\n\t{\n\t\treturn this.#height;\n\t}\n\n\tsetChangeTransformCallback(callback: ({ x: number, y: number, zoom: number }) => any): void\n\t{\n\t\tthis.#changeCallback = callback;\n\t}\n\n\t#onChangedTransformParams(params: {...}): void\n\t{\n\t\tthis.#changeCallback({\n\t\t\tx: this.#x,\n\t\t\ty: this.#y,\n\t\t\tzoom: this.#zoom,\n\t\t\twidth: this.#width,\n\t\t\theight: this.#height,\n\t\t\t...params,\n\t\t});\n\t}\n\n\tclone(width = null, height = null): Camera\n\t{\n\t\tconst camera = new Camera({\n\t\t\twidth: width || this.#width,\n\t\t\theight: height || this.#height,\n\t\t\tonChangeCallback: this.#changeCallback,\n\t\t});\n\t\tcamera.#x = this.#x;\n\t\tcamera.#y = this.#y;\n\t\tcamera.#zoom = this.#zoom;\n\t\tcamera.#rotation = this.#rotation;\n\t\tcamera.updateMatrix();\n\n\t\treturn camera;\n\t}\n\n\tprojection(width, height): void\n\t{\n\t\tthis.#width = width;\n\t\tthis.#height = height;\n\t\tmat3.projection(this.#projectionMatrix, width, height);\n\t\tthis.updateViewProjectionMatrix();\n\t}\n\n\tupdateMatrix(): void\n\t{\n\t\tconst zoomScale = 1 / this.#zoom;\n\t\tmat3.identity(this.#matrix);\n\t\tmat3.translate(this.#matrix, this.#matrix, [this.#x, this.#y]);\n\t\tmat3.rotate(this.#matrix, this.#matrix, this.#rotation);\n\t\tmat3.scale(this.#matrix, this.#matrix, [zoomScale, zoomScale]);\n\t\tmat3.invert(this.#viewMatrix, this.#matrix);\n\t\tthis.updateViewProjectionMatrix();\n\t}\n\n\tupdateViewProjectionMatrix(): void\n\t{\n\t\tmat3.multiply(\n\t\t\tthis.#viewProjectionMatrix,\n\t\t\tthis.#projectionMatrix,\n\t\t\tthis.#viewMatrix,\n\t\t);\n\t\tmat3.invert(this.#viewProjectionMatrixInv, this.#viewProjectionMatrix);\n\t}\n\n\tcreateLandmark(params: Partial<Landmark> = {}): Landmark\n\t{\n\t\treturn {\n\t\t\tzoom: this.#zoom,\n\t\t\tx: this.#x,\n\t\t\ty: this.#y,\n\t\t\trotation: this.#rotation,\n\t\t\t...params,\n\t\t};\n\t}\n\n\tviewportToCanvas(\n\t\t{ x, y }: { x: number, y: number },\n\t\tcamera: Camera,\n\t): { x: number, y: number }\n\t{\n\t\tconst { width, height, viewProjectionMatrixInv } = camera || this;\n\t\tconst canvas = vec2.transformMat3(\n\t\t\tvec2.create(),\n\t\t\t[(x / width) * 2 - 1, (1 - y / height) * 2 - 1],\n\t\t\tviewProjectionMatrixInv,\n\t\t);\n\n\t\treturn { x: canvas[0], y: canvas[1] };\n\t}\n\n\tapplyLandmark(landmark: Landmark): void\n\t{\n\t\tconst { x, y, zoom, rotation, viewportX, viewportY } = landmark;\n\t\tconst useFixedViewport = viewportX || viewportY;\n\t\tlet preZoomX = 0;\n\t\tlet preZoomY = 0;\n\n\t\tif (useFixedViewport)\n\t\t{\n\t\t\tconst canvas = this.viewportToCanvas({\n\t\t\t\tx: viewportX,\n\t\t\t\ty: viewportY,\n\t\t\t});\n\t\t\tpreZoomX = canvas.x;\n\t\t\tpreZoomY = canvas.y;\n\t\t}\n\n\t\tthis.#zoom = zoom;\n\t\tthis.#rotation = rotation;\n\t\tthis.#x = x;\n\t\tthis.#y = y;\n\t\tthis.updateMatrix();\n\t\tthis.#onChangedTransformParams({\n\t\t\tx: this.#x,\n\t\t\ty: this.#y,\n\t\t\tzoom: this.#zoom,\n\t\t});\n\n\t\tif (useFixedViewport)\n\t\t{\n\t\t\tconst { x: postZoomX, y: postZoomY } = this.viewportToCanvas({\n\t\t\t\tx: viewportX,\n\t\t\t\ty: viewportY,\n\t\t\t});\n\t\t\tthis.#x += preZoomX - postZoomX;\n\t\t\tthis.#y += preZoomY - postZoomY;\n\t\t\tthis.updateMatrix();\n\t\t\tthis.#onChangedTransformParams({\n\t\t\t\tx: this.#x,\n\t\t\t\ty: this.#y,\n\t\t\t\tzoom: this.#zoom,\n\t\t\t});\n\t\t}\n\t}\n}\n","import { ref } from 'ui.vue3';\nimport { mat3, vec2 } from '../../lib/gl-matrix';\nimport { Camera } from './camera';\n\nexport class Canvas\n{\n\t#canvas: HTMLCanvasElement | null = null;\n\t#dpr: number = window.devicePixelRatio || 1;\n\n\t#width: number = 0;\n\t#height: number = 0;\n\n\t#minZoom: number = 0.02;\n\t#maxZoom: number = 4;\n\n\t#camera: Camera | null = null;\n\t#canvasStyleInstance = null;\n\n\t#startInvertViewProjectionMatrix: Float32Array = mat3.create();\n\t#startCameraX: number = 0;\n\t#startCameraY: number = 0;\n\n\t#startPos: Float32Array = vec2.create();\n\n\t#resizeObserver: ResizeObserver | null = null;\n\n\ttransform = ref({\n\t\tx: 0,\n\t\ty: 0,\n\t\tzoom: 0,\n\t});\n\n\tconstructor(options)\n\t{\n\t\tconst {\n\t\t\tcanvas,\n\t\t\tcanvasStyle,\n\t\t\tminZoom,\n\t\t\tmaxZoom,\n\t\t} = options;\n\n\t\tthis.#minZoom = minZoom;\n\t\tthis.#maxZoom = maxZoom;\n\n\t\tthis.#initCanvas(canvas);\n\t\tthis.#initCamera();\n\t\tthis.#initCanvasStyle(canvasStyle);\n\t\tthis.#initResizeObserver();\n\t}\n\n\tget viewMatrix(): Float32Array\n\t{\n\t\treturn this.#camera?.viewMatrix ?? [];\n\t}\n\n\tget camera(): typeof Camera\n\t{\n\t\treturn this.#camera;\n\t}\n\n\t#initCanvas(canvas: HTMLCanvasElement): void\n\t{\n\t\tconst { width, height } = canvas.getBoundingClientRect();\n\n\t\tthis.#canvas = canvas;\n\t\tthis.#canvas.width = width * this.#dpr;\n\t\tthis.#canvas.height = height * this.#dpr;\n\t\tthis.#width = this.#canvas.width;\n\t\tthis.#height = this.#canvas.height;\n\t}\n\n\t#initCamera(): void\n\t{\n\t\tthis.#camera = new Camera({\n\t\t\twidth: this.#width / this.#dpr,\n\t\t\theight: this.#height / this.#dpr,\n\t\t\tonChangeCallback: ({ x, y, zoom }) => {\n\t\t\t\tthis.transform.x = x;\n\t\t\t\tthis.transform.y = y;\n\t\t\t\tthis.transform.zoom = zoom;\n\t\t\t},\n\t\t});\n\t}\n\n\t#initCanvasStyle(canvasStyle): void\n\t{\n\t\tif (canvasStyle)\n\t\t{\n\t\t\tconst StyleInstance = canvasStyle.instance;\n\t\t\tthis.#canvasStyleInstance = new StyleInstance(this.#canvas, canvasStyle.options);\n\t\t}\n\t}\n\n\t#initResizeObserver(): void\n\t{\n\t\tthis.#resizeObserver = new ResizeObserver((entries) => {\n\t\t\tfor (const entry of entries)\n\t\t\t{\n\t\t\t\tthis.#camera = this.#camera.clone(\n\t\t\t\t\tentry.contentRect.width,\n\t\t\t\t\tentry.contentRect.height,\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\tthis.#resizeObserver.observe(this.#canvas);\n\t}\n\n\tclientToViewport({ x, y }: { x: number, y: number }): { x: number, y: number }\n\t{\n\t\tconst { left, top } = this.#canvas.getBoundingClientRect();\n\n\t\treturn { x: x - left, y: y - top };\n\t}\n\n\tviewportToClient({ x, y }: { x: number, y: number }): { x: number, y: number }\n\t{\n\t\tconst { left, top } = this.#canvas.getBoundingClientRect();\n\n\t\treturn { x: x + left, y: y + top };\n\t}\n\n\trender(): void\n\t{\n\t\tthis.#canvasStyleInstance?.render({\n\t\t\tprojectionMatrix: this.#camera.projectionMatrix,\n\t\t\tviewMatrix: this.#camera.viewMatrix,\n\t\t\tviewProjectionMatrixInv: this.#camera.viewProjectionMatrixInv,\n\t\t\tzoomScale: this.#camera.zoom,\n\t\t});\n\t}\n\n\tsetCamera(params): void\n\t{\n\t\tthis.#camera.applyLandmark(\n\t\t\tthis.#camera.createLandmark({\n\t\t\t\t...params,\n\t\t\t}),\n\t\t);\n\t}\n\n\t#setCameraZoom(zoomStep: number): void\n\t{\n\t\tconst zoom: number = Number((this.#camera.zoom + zoomStep).toFixed(1));\n\n\t\tif (zoom < this.#minZoom || zoom > this.#maxZoom)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#camera.applyLandmark(\n\t\t\tthis.#camera.createLandmark({\n\t\t\t\tx: this.#camera.x,\n\t\t\t\ty: this.#camera.y,\n\t\t\t\tviewportX: this.#camera.width / 2,\n\t\t\t\tviewportY: this.#camera.height / 2,\n\t\t\t\tzoom,\n\t\t\t}),\n\t\t);\n\t}\n\n\tzoomIn(zoomStep: number): void\n\t{\n\t\tthis.#setCameraZoom(zoomStep);\n\t}\n\n\tzoomOut(zoomStep: number): void\n\t{\n\t\tthis.#setCameraZoom(zoomStep * -1);\n\t}\n\n\tsetCameraZoomByWheel(event: MouseEvent, zoomChange: number = 0): void\n\t{\n\t\tconst newZoom = Math.max(\n\t\t\tthis.#minZoom,\n\t\t\tMath.min(this.#maxZoom, (this.#camera.zoom + zoomChange) * 2 ** (event.deltaY * -0.01)),\n\t\t);\n\n\t\tconst viewport = this.clientToViewport({\n\t\t\tx: event.clientX,\n\t\t\ty: event.clientY,\n\t\t});\n\n\t\tthis.#camera.applyLandmark(\n\t\t\tthis.#camera.createLandmark({\n\t\t\t\tviewportX: viewport.x,\n\t\t\t\tviewportY: viewport.y,\n\t\t\t\tzoom: newZoom,\n\t\t\t}),\n\t\t);\n\t}\n\n\tsetCameraPositionByWheel(event: MouseEvent): void\n\t{\n\t\tthis.#camera.x += event.deltaX / this.#camera.zoom;\n\t\tthis.#camera.y += event.deltaY / this.#camera.zoom;\n\t}\n\n\t#getClipSpaceMousePosition(event: MouseEvent): Array<number, number>\n\t{\n\t\tconst { left, top } = this.#canvas.getBoundingClientRect();\n\t\tconst cssX: number = event.clientX - left;\n\t\tconst cssY: number = event.clientY - top;\n\n\t\tconst normalizedX: number = cssX / this.#canvas.clientWidth || this.#canvas.width / this.#dpr;\n\t\tconst normalizedY: number = cssY / this.#canvas.clientHeight || this.#canvas.height / this.#dpr;\n\n\t\tconst clipX: number = normalizedX * 2 - 1;\n\t\tconst clipY: number = normalizedY * -2 + 1;\n\n\t\treturn [clipX, clipY];\n\t}\n\n\tsetCameraPositionByMouseDown(event: MouseEvent): void\n\t{\n\t\tmat3.copy(\n\t\t\tthis.#startInvertViewProjectionMatrix,\n\t\t\tthis.#camera.viewProjectionMatrixInv,\n\t\t);\n\t\tthis.#startCameraX = this.#camera.x;\n\t\tthis.#startCameraY = this.#camera.y;\n\t\tvec2.transformMat3(\n\t\t\tthis.#startPos,\n\t\t\tthis.#getClipSpaceMousePosition(event),\n\t\t\tthis.#startInvertViewProjectionMatrix,\n\t\t);\n\t}\n\n\tsetCameraPositionByMouseMove(event: MouseEvent): void\n\t{\n\t\tconst pos = vec2.transformMat3(\n\t\t\tvec2.create(),\n\t\t\tthis.#getClipSpaceMousePosition(event),\n\t\t\tthis.#startInvertViewProjectionMatrix,\n\t\t);\n\n\t\tthis.#camera.x = this.#startCameraX + this.#startPos[0] - pos[0];\n\t\tthis.#camera.y = this.#startCameraY + this.#startPos[1] - pos[1];\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#canvasStyleInstance?.destroy();\n\t\tthis.#resizeObserver.unobserve(this.#canvas);\n\t}\n}\n","export const vertexShader: string = `\n  #extension GL_OES_standard_derivatives : enable\n  precision mediump float;\n\n  attribute vec2 a_Position;\n  uniform mat3 u_ViewProjectionInvMatrix;\n  varying vec2 v_Position;\n\n  vec2 project_clipspace(vec2 p) {\n  \treturn (u_ViewProjectionInvMatrix * vec3(p, 1)).xy;\n  }\n\n  void main() {\n  \tv_Position = project_clipspace(a_Position);\n  \tgl_Position = vec4(a_Position, 0, 1);\n  }\n`;\n\nexport const fragmentShader: string = `\n  #extension GL_OES_standard_derivatives : enable\n  precision mediump float;\n\n  uniform vec4 u_BackgroundColor;\n  uniform vec4 u_GridColor;\n  uniform float u_GridSize;\n  uniform float u_ZoomStep;\n  uniform float u_ZoomScale;\n  varying vec2 v_Position;\n\n  vec4 render_grid(vec2 coord) {\n  \tfloat alpha = 0.0;\n  \tfloat gridSize1 = u_GridSize;\n  \tfloat gridSize2 = gridSize1 / 4.0;\n\n  \tvec2 grid1 = abs(fract(coord / gridSize1 - 0.5) - 0.5) / fwidth(coord) * gridSize1 / 0.95;\n  \tvec2 grid2 = abs(fract(coord / gridSize2 - 0.5) - 0.5) / fwidth(coord) * gridSize2 / 0.75;\n  \tfloat v1 = 1.0 - min(min(grid1.x, grid1.y), 1.0);\n  \tfloat v2 = 1.0 - min(min(grid2.x, grid2.y), 1.0);\n\n  \tif (v1 > 0.0) {\n  \t\talpha = clamp(v1, 0.0, 0.222);\n  \t} else {\n  \t\talpha = v2 * clamp(u_ZoomScale / u_ZoomStep, 0.0, 1.0);\n  \t}\n\n  \treturn mix(u_BackgroundColor, u_GridColor, alpha);\n  }\n\n  void main() {\n  \tgl_FragColor = render_grid(v_Position);\n  }\n`;\n","export function compileShader(\n\tgl: WebGLRenderingContext,\n\tshaderSource: string,\n\tshaderType: number,\n): WebGLShader\n{\n\tconst shader = gl.createShader(shaderType);\n\tgl.shaderSource(shader, shaderSource);\n\tgl.compileShader(shader);\n\n\tconst success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\n\n\tif (!success)\n\t{\n\t\tthrow new Error(`Error shader compilation: ${gl.getShaderInfoLog(shader)}`);\n\t}\n\n\treturn shader;\n}\n\nexport function createProgram(\n\tgl: WebGLRenderingContext,\n\tvertexShader: WebGLShader,\n\tfragmentShader: WebGLShader,\n): WebGLProgram\n{\n\tconst program = gl.createProgram();\n\n\tgl.attachShader(program, vertexShader);\n\tgl.attachShader(program, fragmentShader);\n\tgl.linkProgram(program);\n\n\tconst success = gl.getProgramParameter(program, gl.LINK_STATUS);\n\n\tif (!success)\n\t{\n\t\tthrow new Error(`Error initializing shader program: ${gl.getProgramInfoLog(program)}`);\n\t}\n\n\treturn program;\n}\n\nexport function createBufferFromTypedArray(\n\tgl: WebGLRenderingContext,\n\tarray: ArrayBuffer,\n\ttype: number,\n\tdrawType: number,\n): WebGLBuffer\n{\n\tconst bufferType = type || gl.ARRAY_BUFFER;\n\tconst buffer = gl.createBuffer();\n\tgl.bindBuffer(bufferType, buffer);\n\tgl.bufferData(bufferType, array, drawType || gl.STATIC_DRAW);\n\n\treturn buffer;\n}\n\nexport function convHex(hex: string): Array<number>\n{\n\tconst preHex = hex.replace(/^#/, '');\n\tconst r = parseInt(preHex.slice(0, 2), 16);\n\tconst g = parseInt(preHex.slice(2, 4), 16);\n\tconst b = parseInt(preHex.slice(4, 6), 16);\n\n\treturn [r / 255, g / 255, b / 255];\n}\n","import { gridShaders } from './shaders';\nimport {\n\tcompileShader,\n\tcreateProgram,\n\tcreateBufferFromTypedArray,\n\tconvHex,\n} from './helpers';\nimport type { CanvasStyleZoomStep } from '../composables';\n\nexport type GridOptions = {\n\tsize: number,\n\tborderColor: string,\n\tbackgroundColor: string,\n};\n\nexport class Grid\n{\n\t#gl: WebGLRenderingContext;\n\t#program: WebGLProgram | null = null;\n\t#positionAttributeLocation: number | null = null;\n\n\t#vertexShader: WebGLShader | null = null;\n\t#fragmentShader: WebGLShader | null = null;\n\n\t#projectionMatrixLink: WebGLUniformLocation | null = null;\n\t#viewMatrixLink: WebGLUniformLocation | null = null;\n\t#viewProjectionInvMatrixLink: WebGLUniformLocation | null = null;\n\n\t#backgroundColorLink: WebGLUniformLocation | null = null;\n\t#backgroundColor = null;\n\n\t#gridColorLink: WebGLUniformLocation | null = null;\n\t#gridColor = null;\n\t#gridColorAlpha = null;\n\n\t#gridSizeLink: WebGLUniformLocation | null = null;\n\t#gridSize = null;\n\n\t#zoomScaleLink: WebGLUniformLocation | null = null;\n\n\t#gridPosition: Array<number> = [\n\t\t-1, -1,\n\t\t-1, 1,\n\t\t1, -1,\n\t\t1, 1,\n\t];\n\n\t#gridPositionBuffer: WebGLBuffer | null = null;\n\n\t#zoomStepLink: WebGLUniformLocation | null = null;\n\t#zoomStep: nubmer = 4;\n\t#zoomSteps = [];\n\n\tconstructor(canvas: HTMLElementCanvas, options: GridOptions)\n\t{\n\t\tthis.#initParams(options);\n\t\tthis.#initGrid(canvas);\n\t}\n\n\t#initGrid(canvas): void\n\t{\n\t\tthis.#gl = canvas.getContext('webgl');\n\t\tthis.#gl.getExtension('OES_standard_derivatives');\n\t\tthis.#gl.viewport(0, 0, this.#gl.canvas.width, this.#gl.canvas.height);\n\n\t\tthis.#vertexShader = compileShader(\n\t\t\tthis.#gl,\n\t\t\tgridShaders.vertexShader,\n\t\t\tthis.#gl.VERTEX_SHADER,\n\t\t);\n\t\tthis.#fragmentShader = compileShader(\n\t\t\tthis.#gl,\n\t\t\tgridShaders.fragmentShader,\n\t\t\tthis.#gl.FRAGMENT_SHADER,\n\t\t);\n\t\tthis.#program = createProgram(\n\t\t\tthis.#gl,\n\t\t\tthis.#vertexShader,\n\t\t\tthis.#fragmentShader,\n\t\t);\n\t\tthis.#positionAttributeLocation = this.#gl.getAttribLocation(\n\t\t\tthis.#program,\n\t\t\t'a_Position',\n\t\t);\n\t\tthis.#projectionMatrixLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_ProjectionMatrix',\n\t\t);\n\t\tthis.#viewMatrixLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_ViewMatrix',\n\t\t);\n\t\tthis.#viewProjectionInvMatrixLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_ViewProjectionInvMatrix',\n\t\t);\n\t\tthis.#backgroundColorLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_BackgroundColor',\n\t\t);\n\t\tthis.#gridColorLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_GridColor',\n\t\t);\n\t\tthis.#gridSizeLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_GridSize',\n\t\t);\n\t\tthis.#zoomStepLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_ZoomStep',\n\t\t);\n\t\tthis.#zoomScaleLink = this.#gl.getUniformLocation(\n\t\t\tthis.#program,\n\t\t\t'u_ZoomScale',\n\t\t);\n\t\tthis.#gridPositionBuffer = createBufferFromTypedArray(\n\t\t\tthis.#gl,\n\t\t\tnew Float32Array(this.#gridPosition),\n\t\t);\n\t}\n\n\t#getPreparedZoomSteps(zoomSteps: CanvasStyleZoomStep): CanvasStyleZoomStep\n\t{\n\t\treturn zoomSteps\n\t\t\t.sort((stepA, stepB) => stepB.zoomStep - stepA.zoomStep)\n\t\t\t.map((step) => ({\n\t\t\t\tzoomStep: this.#zoomStep,\n\t\t\t\t...step,\n\t\t\t\tsize: 'size' in step\n\t\t\t\t\t? step.size\n\t\t\t\t\t: this.#gridSize,\n\t\t\t\tgridColor: 'gridColor' in step\n\t\t\t\t\t? convHex(step.gridColor)\n\t\t\t\t\t: this.#gridColor,\n\t\t\t}));\n\t}\n\n\t#initParams(options)\n\t{\n\t\tconst {\n\t\t\tsize,\n\t\t\tgridColor,\n\t\t\tgridColorAlpha,\n\t\t\tbackgroundColor,\n\t\t\tzoomStep,\n\t\t\tzoomSteps,\n\t\t} = options;\n\n\t\tthis.#gridSize = size;\n\t\tthis.#zoomStep = zoomStep;\n\t\tthis.#gridColor = new Float32Array(convHex(gridColor));\n\t\tthis.#gridColorAlpha = gridColorAlpha;\n\t\tthis.#backgroundColor = new Float32Array(convHex(backgroundColor));\n\t\tthis.#zoomSteps = this.#getPreparedZoomSteps(zoomSteps);\n\t}\n\n\t#getParamsByZoom(zoom: number): CanvasStyleZoomStep\n\t{\n\t\tfor (const step of this.#zoomSteps)\n\t\t{\n\t\t\tif (step.zoom <= zoom)\n\t\t\t{\n\t\t\t\treturn step;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tgridColor: this.#gridColor,\n\t\t\tsize: this.#gridSize,\n\t\t\tzoomStep: this.#zoomStep,\n\t\t};\n\t}\n\n\trender({\n\t\tprojectionMatrix,\n\t\tviewMatrix,\n\t\tviewProjectionMatrixInv,\n\t\tzoomScale,\n\t}): void\n\t{\n\t\tthis.#gl.clearColor(1, 1, 1, 1);\n\t\tthis.#gl.clear(this.#gl.COLOR_BUFFER_BIT);\n\t\tthis.#gl.useProgram(this.#program);\n\n\t\tconst {\n\t\t\tgridColor,\n\t\t\tzoomStep,\n\t\t\tsize,\n\t\t} = this.#getParamsByZoom(zoomScale);\n\n\t\tthis.#gl.uniformMatrix3fv(\n\t\t\tthis.#projectionMatrixLink,\n\t\t\tfalse,\n\t\t\tprojectionMatrix,\n\t\t);\n\t\tthis.#gl.uniformMatrix3fv(\n\t\t\tthis.#viewMatrixLink,\n\t\t\tfalse,\n\t\t\tviewMatrix,\n\t\t);\n\t\tthis.#gl.uniformMatrix3fv(\n\t\t\tthis.#viewProjectionInvMatrixLink,\n\t\t\tfalse,\n\t\t\tviewProjectionMatrixInv,\n\t\t);\n\t\tthis.#gl.uniform4f(\n\t\t\tthis.#backgroundColorLink,\n\t\t\t...this.#backgroundColor,\n\t\t\t1,\n\t\t);\n\t\tthis.#gl.uniform4f(\n\t\t\tthis.#gridColorLink,\n\t\t\t...gridColor,\n\t\t\t1,\n\t\t);\n\t\tthis.#gl.uniform1f(\n\t\t\tthis.#gridSizeLink,\n\t\t\tsize,\n\t\t);\n\t\tthis.#gl.uniform1f(\n\t\t\tthis.#zoomStepLink,\n\t\t\tzoomStep,\n\t\t);\n\t\tthis.#gl.uniform1f(\n\t\t\tthis.#zoomScaleLink,\n\t\t\tzoomScale,\n\t\t);\n\n\t\tthis.#gl.enableVertexAttribArray(this.#positionAttributeLocation);\n\t\tthis.#gl.bindBuffer(this.#gl.ARRAY_BUFFER, this.#gridPositionBuffer);\n\n\t\tthis.#gl.vertexAttribPointer(\n\t\t\tthis.#positionAttributeLocation,\n\t\t\t2,\n\t\t\tthis.#gl.FLOAT,\n\t\t\tfalse,\n\t\t\t0,\n\t\t\t0,\n\t\t);\n\n\t\tthis.#gl.drawArrays(\n\t\t\tthis.#gl.TRIANGLE_STRIP,\n\t\t\t0,\n\t\t\t4,\n\t\t);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#gl.deleteProgram(this.#program);\n\t\tthis.#gl.deleteShader(this.#vertexShader);\n\t\tthis.#gl.deleteShader(this.#fragmentShader);\n\t}\n}\n","import { computed, toValue, nextTick, markRaw } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport { commandToArray } from '../utils';\nimport type { State, Snapshot } from '../types';\n\nexport type SnapshotHandler = (state: State) => {...};\nexport type RevertHandler = (snapshot: Snapshot) => void;\n\nexport type UseHistoryOptions = {\n\tsnapshotHandler?: SnapshotHandler,\n\trevertHandler?: RevertHandler,\n\tmaxCount?: number,\n};\n\nexport type HandlerOptions = {\n\tsnapshotHandler?: SnapshotHandler,\n\trevertHandler?: RevertHandler,\n\temptyHistorySnapshot: {...},\n};\n\nexport type UseHistory = {\n\thasNext: boolean,\n\thasPrev: boolean,\n\tsetHandlers: (options: HandlerOptions) => void,\n\tmakeSnapshot: (options: HandlerOptions) => void,\n\tnext: () => void,\n\tprev: () => void,\n\tclear: () => void,\n};\n\n// eslint-disable-next-line max-lines-per-function\nexport function useHistory(options: UseHistoryOptions = {}): UseHistory\n{\n\tconst commonSnapshotHandler = (newState) => {\n\t\treturn markRaw({\n\t\t\tblocks: markRaw(JSON.parse(JSON.stringify(newState.blocks))),\n\t\t\tconnections: markRaw(JSON.parse(JSON.stringify(newState.connections))),\n\t\t});\n\t};\n\n\tconst commonRevertHandler = (snapshot): void => {\n\t\thooks.changedBlocks.trigger(\n\t\t\tcommandToArray.commandReplace(snapshot.blocks),\n\t\t);\n\t\thooks.changedConnections.trigger(\n\t\t\tcommandToArray.commandReplace(snapshot.connections),\n\t\t);\n\t};\n\n\tconst commonEmptyHistorySnapshot = {\n\t\tblocks: [],\n\t\tconnections: [],\n\t};\n\n\tconst instance = useBlockDiagram();\n\tconst {\n\t\theadSnapshot,\n\t\ttailSnapshot,\n\t\tcurrentSnapshot,\n\t\tmaxCountSnapshots,\n\t\thooks,\n\t\tsnapshotHandler,\n\t\trevertHandler,\n\t\tsetHistoryHandlers,\n\t\thistoryCurrentState,\n\t} = instance;\n\n\tconst {\n\t\tsnapshotHandler: newSnapshotHandler = null,\n\t\trevertHandler: newRevertHandler = null,\n\t\temptyHistorySnapshot = commonEmptyHistorySnapshot,\n\t\tmaxCount,\n\t} = options;\n\tsetHandlers({ newSnapshotHandler, newRevertHandler });\n\tmaxCountSnapshots.value = maxCount || toValue(maxCountSnapshots);\n\n\tconst hasNext = computed(() => toValue(currentSnapshot) && toValue(currentSnapshot).next !== null);\n\tconst hasPrev = computed(() => toValue(currentSnapshot) && toValue(currentSnapshot).prev !== null);\n\n\tfunction setHandlers(newHandlerOptions: HandlerOptions): void\n\t{\n\t\tconst handlerOptions = {\n\t\t\tsnapshotHandler: newHandlerOptions.snapshotHandler ?? toValue(snapshotHandler) ?? commonSnapshotHandler,\n\t\t\trevertHandler: newHandlerOptions.revertHandler ?? toValue(revertHandler) ?? commonRevertHandler,\n\t\t};\n\n\t\tsetHistoryHandlers(handlerOptions);\n\t}\n\n\tfunction getCountSnapshots(): number\n\t{\n\t\tlet count = 0;\n\t\tlet current: Snapshot | null = toValue(headSnapshot);\n\n\t\twhile (current)\n\t\t{\n\t\t\tcurrent = current.next;\n\t\t\tcount += 1;\n\t\t}\n\n\t\treturn count;\n\t}\n\n\tfunction makeSnapshot(options: HandlerOptions = {}): void\n\t{\n\t\tconst {\n\t\t\tsnapshotHandler: newSnapshotHandler = null,\n\t\t\trevertHandler: newRevertHandler = null,\n\t\t\temptySnapshot: newEmptySnapshot = null,\n\t\t} = options;\n\n\t\tconst snapshotHistoryHandler = newSnapshotHandler || toValue(snapshotHandler);\n\t\tconst revertHistoryHandler = newRevertHandler || toValue(revertHandler);\n\t\tconst emptySnapshot = newEmptySnapshot || emptyHistorySnapshot;\n\n\t\tconst newSnapshot = markRaw({\n\t\t\tsnapshot: snapshotHistoryHandler(toValue(historyCurrentState)),\n\t\t\trevertHandler: revertHistoryHandler,\n\t\t\temptySnapshot,\n\t\t\tnext: null,\n\t\t\tprev: tailSnapshot.value,\n\t\t});\n\n\t\tif (toValue(currentSnapshot) && toValue(currentSnapshot)?.next !== null)\n\t\t{\n\t\t\tcurrentSnapshot.value.next = newSnapshot;\n\t\t\tnewSnapshot.prev = currentSnapshot.value;\n\t\t\ttailSnapshot.value.prev = null;\n\t\t\ttailSnapshot.value.next = null;\n\t\t\ttailSnapshot.value = newSnapshot;\n\t\t}\n\t\telse if (toValue(headSnapshot) === null)\n\t\t{\n\t\t\theadSnapshot.value = newSnapshot;\n\t\t\ttailSnapshot.value = newSnapshot;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttailSnapshot.value.next = newSnapshot;\n\t\t\ttailSnapshot.value = newSnapshot;\n\t\t}\n\n\t\tcurrentSnapshot.value = newSnapshot;\n\n\t\tif (getCountSnapshots() <= toValue(maxCountSnapshots) + 1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst firstSnapshot = headSnapshot.value;\n\t\theadSnapshot.value = firstSnapshot.next;\n\t\theadSnapshot.value.prev = null;\n\t\tfirstSnapshot.next = null;\n\t}\n\n\tasync function revertState({ revertHandler, snapshot, emptySnapshot }): void\n\t{\n\t\trevertHandler(emptySnapshot);\n\t\tawait nextTick();\n\t\trevertHandler(snapshot);\n\t}\n\n\tasync function next(): void\n\t{\n\t\tif (toValue(currentSnapshot) === null || toValue(currentSnapshot).next === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait revertState(toValue(currentSnapshot).next);\n\t\tcurrentSnapshot.value = toValue(currentSnapshot).next;\n\t}\n\n\tasync function prev(): void\n\t{\n\t\tif (toValue(currentSnapshot) === null || toValue(currentSnapshot).prev === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tawait revertState(toValue(currentSnapshot).prev);\n\t\tcurrentSnapshot.value = toValue(currentSnapshot).prev;\n\t}\n\n\tfunction clear(): void\n\t{\n\t\theadSnapshot.value = null;\n\t\ttailSnapshot.value = null;\n\t\tcurrentSnapshot.value = null;\n\t}\n\n\treturn {\n\t\thasNext,\n\t\thasPrev,\n\t\tsetHandlers,\n\t\tmakeSnapshot: () => nextTick(() => makeSnapshot()),\n\t\tnext,\n\t\tprev,\n\t\tclear,\n\t\tcommonSnapshotHandler,\n\t\tcommonRevertHandler,\n\t};\n}\n","import { toValue, toRaw } from 'ui.vue3';\nimport {\n\tSTICKING_DISTANCE,\n\tNODE_HEADER_HEIGHT,\n\tNODE_CONTENT_HEADER_HEIGHT,\n\tNODE_TYPES,\n} from '../constants';\nimport { commandToArray } from '../utils';\nimport { Text } from 'main.core';\nimport { HandlerOptions } from './history';\nimport type {\n\tDiagramBlockId,\n\tDiagramBlock,\n\tDiagramConnectionId,\n\tDiagramConnection,\n\tDiagramAddConnection,\n\tDiagramPortId,\n\tDiagramPort,\n\tPoint,\n} from '../types';\n\nexport type UseActions = {\n\tsetState: () => void,\n\tisExistConnection: (connection: DiagramConnection) => boolean,\n\taddConnection: (connection: DiagramAddConnection) => void,\n\tdeleteConnectionById: (connectionId: DiagramConnectionId) => void,\n\taddBlock: (block: DiagramBlock) => void,\n\tupdateBlockPositionByIndex: (index: number, x: number, y: number) => void,\n\tupdateBlock: (newBlock: DiagramBlock) => void,\n\tdeleteBlockById: (blockId: DiagramBlockId) => void,\n\tgetPortAbsolutePosition: (block: DiagramBlock, port: DiagramPort) => Point,\n\tfindNearestPort: (clientX: number, clientY: number) => DiagramPort | null,\n\ttransformEventToPoint: (point: { clientX: number, clientY: number }) => Point,\n\tsetMovingBlock: (block: DiagramBlock) => void,\n\tupdateMovingBlockPosition: (x: number, y: number) => void,\n\tresetMovingBlock: () => void,\n\tsetHistoryHandlers: (HandlerOptions) => void,\n\tsetPortOffsetByBlockId: (blockId: string, offsets: { x: number, y: number }) => void;\n};\n\n/* eslint-disable no-param-reassign */\n// eslint-disable-next-line max-lines-per-function\nexport function useActions({ state, getters, hooks }): UseActions\n{\n\tfunction setState(options): void\n\t{\n\t\tstate.blocks = toValue(options.blocks);\n\t\tstate.connections = toValue(options.connections);\n\t\tstate.transformX = options.transform.x;\n\t\tstate.transformY = options.transfrom.y;\n\t\tstate.zoom = toValue(options.zoom);\n\t}\n\n\tfunction updateCanvasTransform(transform: Transform): void\n\t{\n\t\tconst {\n\t\t\tx = 0,\n\t\t\ty = 0,\n\t\t\tzoom = 1,\n\t\t\tviewportX = 0,\n\t\t\tviewportY = 0,\n\t\t} = transform;\n\t\tstate.transformX = x;\n\t\tstate.transformY = y;\n\t\tstate.viewportX = viewportX;\n\t\tstate.viewportY = viewportY;\n\t\tstate.zoom = zoom;\n\t}\n\n\tconst isExistConnection = (connection: DiagramConnection): boolean => {\n\t\tconst {\n\t\t\tsourceBlockId,\n\t\t\tsourcePortId,\n\t\t\ttargetBlockId,\n\t\t\ttargetPortId,\n\t\t} = connection;\n\n\t\treturn state.connections.some(({\n\t\t\tsourceBlockId: exSourceBlockId,\n\t\t\tsourcePortId: exSourcePortId,\n\t\t\ttargetBlockId: exTargetBlockId,\n\t\t\ttargetPortId: exTargetPortId,\n\t\t}) => {\n\t\t\tconst isSource = (\n\t\t\t\texSourceBlockId === sourceBlockId\n\t\t\t\t&& exSourcePortId === sourcePortId\n\t\t\t\t&& exTargetBlockId === targetBlockId\n\t\t\t\t&& exTargetPortId === targetPortId\n\t\t\t);\n\t\t\tconst isTarget = (\n\t\t\t\texSourceBlockId === targetBlockId\n\t\t\t\t&& exSourcePortId === targetPortId\n\t\t\t\t&& exTargetBlockId === sourceBlockId\n\t\t\t\t&& exTargetPortId === sourcePortId\n\t\t\t);\n\n\t\t\treturn isSource || isTarget;\n\t\t});\n\t};\n\n\tconst addConnection = (newConnection: DiagramAddConnection): void => {\n\t\tif (!isExistConnection(newConnection))\n\t\t{\n\t\t\thooks.changedConnections.trigger(commandToArray.commandPush(newConnection));\n\t\t\thooks.createConnection.trigger(newConnection);\n\t\t}\n\t};\n\n\tconst deleteConnectionById = (connectionId: DiagramConnectionId): void => {\n\t\tconst connections = state.connections\n\t\t\t.filter((connection) => connection.id !== connectionId);\n\n\t\thooks.changedConnections.trigger(\n\t\t\tcommandToArray.commandReplace(connections),\n\t\t);\n\t\thooks.deleteConnection.trigger(connectionId);\n\t};\n\n\tconst deleteConnectionByBlockIdAndPortId = (blockId: DiagramBlockId, portId: DiagramPortId): void => {\n\t\tconst block = state.blocks.find((stateBlock) => stateBlock.id === blockId);\n\n\t\tif (!block)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst portIdMap = new Set(\n\t\t\t[\n\t\t\t\t...(block.ports?.input ?? []),\n\t\t\t\t...(block.ports?.output ?? []),\n\t\t\t].map((port) => port.id),\n\t\t);\n\t\tconst newConnections = state.connections.filter((connection) => {\n\t\t\tconst {\n\t\t\t\tsourceBlockId,\n\t\t\t\tsourcePortId,\n\t\t\t\ttargetBlockId,\n\t\t\t\ttargetPortId,\n\t\t\t} = connection;\n\t\t\tconst isSource = sourceBlockId === blockId && portIdMap.has(sourcePortId);\n\t\t\tconst isTarget = targetBlockId === blockId && portIdMap.has(targetPortId);\n\n\t\t\treturn !isSource && !isTarget;\n\t\t});\n\n\t\thooks.changedConnections.trigger(\n\t\t\tcommandToArray.commandReplace(newConnections),\n\t\t);\n\t};\n\n\tconst deleteBlockById = (blockId: DiagramBlockId): void => {\n\t\tconst blockIndex = state.blocks.findIndex((block) => block.id === blockId);\n\n\t\tif (blockIndex === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdeleteConnectionByBlockIdAndPortId(blockId);\n\n\t\thooks.changedBlocks.trigger(\n\t\t\tcommandToArray.commandDeleteByIndex(blockIndex),\n\t\t);\n\t\thooks.deleteBlock.trigger(blockId);\n\t};\n\n\tconst addBlock = (block: DiagramBlock): void => {\n\t\thooks.changedBlocks.trigger(\n\t\t\tcommandToArray.commandPush(block),\n\t\t);\n\t\thooks.addBlock.trigger(block);\n\t};\n\n\tconst updateBlockPositionByIndex = (index: number, x: number, y: nubmer): void => {\n\t\tstate.blocks[index].position.x = x;\n\t\tstate.blocks[index].position.y = y;\n\t};\n\n\tconst updateBlock = (newBlock: DiagramBlock): void => {\n\t\tconst blockIndex = state.blocks.findIndex((block) => block.id === newBlock.id);\n\n\t\tif (blockIndex === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\thooks.changedBlocks.trigger(\n\t\t\tcommandToArray.commandUpdateByIndex(blockIndex, newBlock),\n\t\t);\n\t\thooks.updateBlock.trigger(newBlock);\n\t};\n\n\tconst getPortAbsolutePosition = (block: DiagramBlock, port: DiagramPort): Point => {\n\t\tconst {\n\t\t\tposition: { x: blockX, y: blockY },\n\t\t\tdimensions: { width },\n\t\t\tports: { output },\n\t\t\tnode: { type: nodeType },\n\t\t} = block;\n\t\tconst { position, id: portId } = port;\n\n\t\tlet portOffsetY: number = position * NODE_HEADER_HEIGHT / 2;\n\t\tif (nodeType === NODE_TYPES.COMPLEX)\n\t\t{\n\t\t\tportOffsetY += NODE_CONTENT_HEADER_HEIGHT + NODE_HEADER_HEIGHT;\n\t\t}\n\t\tlet portX: number = blockX;\n\n\t\tconst isOutputPort = output.some((outputPort): boolean => outputPort.id === portId);\n\n\t\tif (isOutputPort)\n\t\t{\n\t\t\tportX = Number(blockX) + Number(width);\n\t\t}\n\n\t\treturn { x: portX, y: Number(blockY) + portOffsetY };\n\t};\n\n\tconst findNearestPort = (clientX: number, clientY: number): { block: DiagramBlock, port: DiagramPort } | null => {\n\t\tlet nearest = null;\n\t\tlet nearestDistance: number = Infinity;\n\n\t\tstate.blocks.forEach((block): void => {\n\t\t\tblock.ports.forEach((port): void => {\n\t\t\t\tconst { x, y } = getPortAbsolutePosition(block, port);\n\t\t\t\tconst dx: number = clientX - x;\n\t\t\t\tconst dy: number = clientY - y;\n\t\t\t\tconst distance: number = Math.hypot(dx, dy);\n\n\t\t\t\tif (distance < STICKING_DISTANCE && distance < nearestDistance)\n\t\t\t\t{\n\t\t\t\t\tnearest = { block, port };\n\t\t\t\t\tnearestDistance = distance;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn nearest;\n\t};\n\n\tconst transformEventToPoint = (point: { clientX: number, clientY: number }): Point => {\n\t\tlet transformedX: number = Math.round(point.clientX / toValue(state.zoom));\n\t\tlet transformedY: number = Math.round(point.clientY / toValue(state.zoom));\n\n\t\tconst { top, left } = toValue(state.blockDiagramRef)?.getBoundingClientRect() ?? { top: 0, left: 0 };\n\n\t\ttransformedX -= Math.round(left / toValue(state.zoom));\n\t\ttransformedY -= Math.round(top / toValue(state.zoom));\n\n\t\treturn { x: transformedX, y: transformedY };\n\t};\n\n\tconst setMovingBlock = (block: DiagramBlock): void => {\n\t\tstate.movingBlock = toRaw({ ...block });\n\t\tconst movingConnections = [];\n\n\t\tblock.ports.forEach((port) => {\n\t\t\tconst connections = state.connections.filter((connection) => {\n\t\t\t\tconst {\n\t\t\t\t\ttargetBlockId,\n\t\t\t\t\ttargetPortId,\n\t\t\t\t\tsourceBlockId,\n\t\t\t\t\tsourcePortId,\n\t\t\t\t} = connection;\n\t\t\t\tconst isTarget = targetBlockId === block.id && targetPortId === port.id;\n\t\t\t\tconst isSource = sourceBlockId === block.id && sourcePortId === port.id;\n\n\t\t\t\treturn isTarget || isSource;\n\t\t\t});\n\n\t\t\tmovingConnections.push(...connections);\n\t\t});\n\n\t\tstate.movingConnections = movingConnections;\n\t};\n\n\tconst updateMovingBlockPosition = (x: number, y: number): void => {\n\t\tstate.movingBlock.position.x = x;\n\t\tstate.movingBlock.position.y = y;\n\t};\n\n\tconst resetMovingBlock = (): void => {\n\t\tstate.movingBlock = null;\n\t\tstate.movingConnections = [];\n\t};\n\n\tconst setHistoryHandlers = ({\n\t\tsnapshotHandler: newSnapshotHandler = null,\n\t\trevertHandler: newRevertHandler = null,\n\t}: HandlerOptions): void => {\n\t\tstate.snapshotHandler = newSnapshotHandler || state.snapshotHandler;\n\t\tstate.revertHandler = newRevertHandler || state.revertHandler;\n\t};\n\n\tconst setPortOffsetByBlockId = (blockId: string, offsets: { x: number, y: number }): void => {\n\t\tconst ports = toValue(state.portsRectMap)?.[blockId] ?? {};\n\n\t\tObject.entries(ports)\n\t\t\t.forEach(([id, portRect]) => {\n\t\t\t\tports[id].x = portRect.x - offsets.x;\n\t\t\t\tports[id].y = portRect.y - offsets.y;\n\t\t\t});\n\t};\n\n\tconst updatePortPosition = (blockId: DigramBlockId, portId: DiagramPortId): void => {\n\t\tconst {\n\t\t\tportsElMap,\n\t\t\tblockDiagramLeft,\n\t\t\tblockDiagramTop,\n\t\t\tzoom,\n\t\t\ttransformX,\n\t\t\ttransformY,\n\t\t} = state;\n\t\tconst hasBlock = toValue(portsElMap).has(blockId);\n\t\tconst hasPort = hasBlock && toValue(portsElMap).get(blockId).has(portId);\n\n\t\tif (!hasBlock || !hasPort)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tx = 0,\n\t\t\ty = 0,\n\t\t\twidth = 0,\n\t\t\theight = 0,\n\t\t} = portsElMap.get(blockId)?.get(portId)?.getBoundingClientRect() ?? {};\n\n\t\tstate.portsRectMap[blockId][portId].x = (x / zoom) + toValue(transformX) - (toValue(blockDiagramLeft) / zoom);\n\t\tstate.portsRectMap[blockId][portId].y = (y / zoom) + toValue(transformY) - (toValue(blockDiagramTop) / zoom);\n\t\tstate.portsRectMap[blockId][portId].width = width;\n\t\tstate.portsRectMap[blockId][portId].height = height;\n\t};\n\n\tconst setSelectionActive = (value: boolean): void => {\n\t\tstate.isSelectionActive = value;\n\t};\n\n\tconst setSelectionWorldRect = (rect: Rect | null): void => {\n\t\tstate.selectionWorldRect = rect;\n\t};\n\n\treturn {\n\t\tsetState,\n\t\tupdateCanvasTransform,\n\t\tisExistConnection,\n\t\taddConnection,\n\t\tdeleteConnectionById,\n\t\taddBlock,\n\t\tupdateBlockPositionByIndex,\n\t\tupdateBlock,\n\t\tdeleteBlockById,\n\t\tgetPortAbsolutePosition,\n\t\tfindNearestPort,\n\t\ttransformEventToPoint,\n\t\tsetMovingBlock,\n\t\tupdateMovingBlockPosition,\n\t\tresetMovingBlock,\n\t\tsetHistoryHandlers,\n\t\tsetPortOffsetByBlockId,\n\t\tupdatePortPosition,\n\t\tsetSelectionActive,\n\t\tsetSelectionWorldRect,\n\t};\n}\n","import { computed, toValue } from 'ui.vue3';\nimport { BLOCK_GROUP_DEFAULT_NAME, CONNECTION_GROUP_DEFAULT_NAME } from '../constants';\nimport type {\n\tGroupedBlocks,\n\tBlockGroupNames,\n\tGroupedConnections,\n\tConnectionGroupNames,\n\tTransform,\n} from '../types';\n\nexport type UseGetters = {\n\ttransform: Transform;\n\tcanvasId: string | null;\n\tgroupedBlocks: GroupedBlocks;\n\tblockGroupNames: BlockGroupNames;\n\tgroupedConnections: GroupedConnections;\n\tconnectionGroupNames: ConnectionGroupNames;\n\tisAnimate: boolean;\n\tisDisabledBlockDiagram: boolean;\n\tisMakeNewConnection: boolean;\n};\n\nexport function useGetters(state): UseGetters\n{\n\tconst transform = computed((): Transform => ({\n\t\tx: state.transformX,\n\t\ty: state.transformY,\n\t\tzoom: state.zoom,\n\t\tviewportX: state.viewportX,\n\t\tviewportY: state.viewportY,\n\t}));\n\n\tconst canvasId = computed((): string | null => {\n\t\treturn state.canvasRef?.canvasId ?? null;\n\t});\n\n\tconst isMakeNewConnection = computed((): boolean => {\n\t\treturn state.newConnection !== null;\n\t});\n\n\tconst groupedBlocks = computed((): GroupedBlocks => {\n\t\treturn state.blocks\n\t\t\t.reduce((acc, block) => {\n\t\t\t\tconst type = block?.type ?? BLOCK_GROUP_DEFAULT_NAME;\n\n\t\t\t\tif (type in acc)\n\t\t\t\t{\n\t\t\t\t\tacc[type] = [...acc[type], block];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tacc[type] = [block];\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, { [BLOCK_GROUP_DEFAULT_NAME]: [] });\n\t});\n\n\tconst blockGroupNames = computed((): BlockGroupNames => {\n\t\treturn Object.keys(toValue(groupedBlocks));\n\t});\n\n\tconst groupedConnections = computed((): GroupedConnections => {\n\t\treturn state.connections\n\t\t\t.reduce((acc, connection) => {\n\t\t\t\tconst type = connection?.type ?? CONNECTION_GROUP_DEFAULT_NAME;\n\n\t\t\t\tif (type in acc)\n\t\t\t\t{\n\t\t\t\t\tacc[type] = [...acc[type], connection];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tacc[type] = [connection];\n\t\t\t\t}\n\n\t\t\t\treturn acc;\n\t\t\t}, { [CONNECTION_GROUP_DEFAULT_NAME]: [] });\n\t});\n\n\tconst connectionGroupNames = computed((): ConnectionGroupNames => {\n\t\treturn Object.keys(toValue(groupedConnections));\n\t});\n\n\tconst isAnimate = computed((): boolean => {\n\t\treturn state.animationQueue !== null;\n\t});\n\n\tconst isDisabledBlockDiagram = computed((): boolean => {\n\t\treturn state.isDisabled || toValue(isAnimate);\n\t});\n\n\treturn {\n\t\ttransform,\n\t\tcanvasId,\n\t\tgroupedBlocks,\n\t\tblockGroupNames,\n\t\tgroupedConnections,\n\t\tconnectionGroupNames,\n\t\tisAnimate,\n\t\tisDisabledBlockDiagram,\n\t\tisMakeNewConnection,\n\t};\n}\n","import { createHook, CreateHook } from '../utils';\nimport { HOOK_NAMES } from '../constants';\n\nexport type UseHooks = Record<$Values<HOOK_NAMES>, CreateHook>;\n\nexport function useHooks(): UseHooks\n{\n\treturn {\n\t\t[HOOK_NAMES.START_DRAG_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.MOVE_DRAG_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.END_DRAG_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.ADD_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.UPDATE_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.DELETE_BLOCK]: createHook(),\n\t\t[HOOK_NAMES.CREATE_CONNECTION]: createHook(),\n\t\t[HOOK_NAMES.DELETE_CONNECTION]: createHook(),\n\t\t[HOOK_NAMES.CHANGED_BLOCKS]: createHook(),\n\t\t[HOOK_NAMES.CHANGED_CONNECTIONS]: createHook(),\n\t\t[HOOK_NAMES.BLOCK_TRANSITION_START]: createHook(),\n\t\t[HOOK_NAMES.BLOCK_TRANSITION_END]: createHook(),\n\t\t[HOOK_NAMES.CONNECTION_TRANSITION_START]: createHook(),\n\t\t[HOOK_NAMES.CONNECTION_TRANSITION_END]: createHook(),\n\t\t[HOOK_NAMES.DROP_NEW_BLOCK]: createHook(),\n\t};\n}\n","import { getCurrentInstance, reactive, toRefs } from 'ui.vue3';\nimport { State } from '../types';\nimport { useState } from './state';\nimport { useActions, UseActions } from './actions';\nimport { useGetters, UseGetters } from './getters';\nimport { useHooks, UseHooks } from './hooks';\n\nexport type UseBlockDiagran = {\n\t...State,\n\t...UseGetters,\n\t...UseHooks,\n\t...UseActions,\n};\n\nexport function useBlockDiagram(options): UseBlockDiagran\n{\n\tconst app = getCurrentInstance()?.appContext.app;\n\tconst blockDiagramState = app?.config?.globalProperties?.$blockDiagram ?? null;\n\n\tif (blockDiagramState !== null)\n\t{\n\t\treturn blockDiagramState;\n\t}\n\n\tconst state = useState(options);\n\tconst reactiveState = reactive(state);\n\tconst getters = useGetters(reactiveState);\n\tconst hooks = useHooks();\n\tconst actions = useActions({ state: reactiveState, getters, hooks });\n\n\tif (options)\n\t{\n\t\tactions.setState(options);\n\t}\n\n\tapp.config.globalProperties.$blockDiagram = {\n\t\t...toRefs(reactiveState),\n\t\t...getters,\n\t\t...actions,\n\t\thooks,\n\t};\n\n\tapp.config.globalProperties.$blockDiagramTestId = (id: string, ...args: Array<string>): string => {\n\t\tif (!id)\n\t\t{\n\t\t\tthrow new Error('ui.block-diagram not found test id');\n\t\t}\n\n\t\tconst preparedArgs = args.reduce((acc, arg) => {\n\t\t\treturn `${acc}-${arg}`;\n\t\t}, '');\n\n\t\treturn `${id}${preparedArgs}`;\n\t};\n\n\treturn app.config.globalProperties?.$blockDiagram;\n}\n","import { ref, toValue, shallowRef } from 'ui.vue3';\nimport { Type } from 'main.core';\nimport { MenuItemOptions, MenuOptions, MenuManager } from 'main.popup';\nimport type { Point } from '../types';\nimport { useBlockDiagram } from './block-diagram';\n\nexport type UseContextMenu = {\n\tisOpen: boolean,\n\tshowContextMenu: (payload: { clientX: number, clientY: number }) => void,\n\tcloseContextMenu: () => void,\n\tsetOptions: (options: MenuOptions) => void,\n};\n\n/**\n * @param menuItems is deprecated, use items in showMenu()\n */\nexport function useContextMenu(menuItems: MenuItemOptions[] = []): UseContextMenu\n{\n\tconst {\n\t\tcontextMenuLayerRef,\n\t\ttargetContainerRef,\n\t\tisOpenContextMenu,\n\t\tpositionContextMenu,\n\t\tcontextMenuInstance,\n\t\tzoom,\n\t} = useBlockDiagram();\n\n\tcontextMenuInstance.value = toValue(contextMenuInstance) || shallowRef(MenuManager.create(getMenuOptions()));\n\tconst isOpen = ref(false);\n\tlet options: MenuOptions = { items: menuItems };\n\n\tfunction setOptions(newOptions: MenuOptions): void\n\t{\n\t\toptions = getMenuOptions(newOptions);\n\t}\n\n\tfunction getItems(items: MenuItemOptions[] = []): MenuItemOptions[]\n\t{\n\t\treturn items.map((item) => {\n\t\t\treturn {\n\t\t\t\t...item,\n\t\t\t\tonclick: () => {\n\t\t\t\t\tif (Type.isFunction(item.onclick))\n\t\t\t\t\t{\n\t\t\t\t\t\tconst point: Point = {\n\t\t\t\t\t\t\tx: positionContextMenu.value.left,\n\t\t\t\t\t\t\ty: positionContextMenu.value.top,\n\t\t\t\t\t\t};\n\t\t\t\t\t\titem.onclick(point);\n\t\t\t\t\t}\n\n\t\t\t\t\tcloseMenu();\n\t\t\t\t},\n\t\t\t};\n\t\t});\n\t}\n\n\tfunction getMenuOptions(additionalOptions: MenuOptions): MenuOptions\n\t{\n\t\treturn {\n\t\t\tid: 'block-diagram-context-menu',\n\t\t\tbindElement: {\n\t\t\t\tleft: 0,\n\t\t\t\ttop: 0,\n\t\t\t},\n\t\t\tminWidth: 200,\n\t\t\tautoHide: true,\n\t\t\tdraggable: false,\n\t\t\tcacheable: false,\n\t\t\ttargetContainer: toValue(targetContainerRef),\n\t\t\t...additionalOptions,\n\t\t\titems: getItems(additionalOptions?.items ?? []),\n\t\t};\n\t}\n\n\tfunction setDestroyHandler(handler: () => void): void\n\t{\n\t\ttoValue(contextMenuInstance)\n\t\t\t?.popupWindow\n\t\t\t?.subscribeOnce('onDestroy', handler);\n\t}\n\n\tfunction showMenu(menuOptions: MenuOptions): void\n\t{\n\t\ttoValue(contextMenuInstance)?.destroy();\n\t\tcontextMenuInstance.value = shallowRef(MenuManager.create(\n\t\t\tgetMenuOptions(menuOptions),\n\t\t));\n\t\ttoValue(contextMenuInstance).show();\n\t}\n\n\tfunction closeMenu(): void\n\t{\n\t\ttoValue(contextMenuInstance)?.close();\n\t}\n\n\tfunction showContextMenu(payload: { clientX: number, clientY: number, items: MenuItemOptions[]}): void\n\t{\n\t\tconst { clientX = 0, clientY = 0, items = [] } = payload;\n\t\tif (Type.isArrayFilled(toValue(items)))\n\t\t{\n\t\t\tsetOptions({ items: toValue(items) });\n\t\t}\n\n\t\tconst { left, top } = toValue(contextMenuLayerRef)?.getBoundingClientRect() ?? { top: 0, left: 0 };\n\t\tpositionContextMenu.value.top = (clientY - top) / toValue(zoom);\n\t\tpositionContextMenu.value.left = (clientX - left) / toValue(zoom);\n\n\t\tshowMenu(options);\n\t\tsetDestroyHandler(() => {\n\t\t\tisOpen.value = false;\n\t\t});\n\n\t\tisOpen.value = true;\n\t\tisOpenContextMenu.value = true;\n\t}\n\n\tfunction closeContextMenu(): void\n\t{\n\t\tisOpen.value = false;\n\t\tisOpenContextMenu.value = false;\n\n\t\tcloseMenu();\n\t}\n\n\treturn {\n\t\tisOpen,\n\t\tshowContextMenu,\n\t\tcloseContextMenu,\n\t\tsetOptions,\n\t};\n}\n","import { toValue, ref, computed } from 'ui.vue3';\nimport { Event, Text, Type } from 'main.core';\nimport { useBlockDiagram } from './block-diagram';\nimport type {\n\tDiagramBlock,\n\tDiagramPort,\n\tDiagramAddConnection,\n\tDiagramNewConnection,\n\tDiagramValidationPortRuleFn,\n\tDiagramNormalyzeConnectionFn,\n} from '../types';\n\nexport type UseNewConnection = {\n\tisSourcePort: boolean;\n\tisValid: boolean;\n\tonMouseDownPort: (event: MouseEvent) => void;\n\tonMouseOverPort: () => void;\n\tonMouseLeavePort: () => void;\n};\n\nexport type useNewConnectionOptions = {\n\tblock: DiagramBlock,\n\tport: DiagramPort,\n\tposition: DiagramPortPosition,\n\tvalidationRules: Array<DiagramValidationPortRuleFn> | null,\n\tnormalyzeConnectionFn: DiagramNormalyzeConnectionFn | null,\n};\n\n// eslint-disable-next-line max-lines-per-function\nexport function useNewConnection(options: useNewConnectionOptions): UseNewConnection\n{\n\tconst {\n\t\tisDisabledBlockDiagram,\n\t\tnewConnection,\n\t\tisValidNewConnection,\n\t\tportsRectMap,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t\tzoom,\n\t\ttransformX,\n\t\ttransformY,\n\t\taddConnection,\n\t} = useBlockDiagram();\n\tconst {\n\t\tblock,\n\t\tport,\n\t\tposition,\n\t\tvalidationRules = null,\n\t\tnormalyzeConnectionFn = null,\n\t} = options;\n\tconst isSourcePort = ref(false);\n\n\tconst isValid = computed((): boolean => {\n\t\tif (toValue(newConnection) === null)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst {\n\t\t\tsourceBlockId,\n\t\t\tsourcePortId,\n\t\t\ttargetBlockId,\n\t\t\ttargetPortId,\n\t\t} = toValue(newConnection);\n\n\t\tif (targetPortId === null)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst isSource = toValue(block).id === sourceBlockId && toValue(port).id === sourcePortId;\n\t\tconst isTarget = toValue(block).id === targetBlockId && toValue(port).id === targetPortId;\n\n\t\tif (isSource || isTarget)\n\t\t{\n\t\t\treturn toValue(isValidNewConnection);\n\t\t}\n\n\t\treturn true;\n\t});\n\n\tfunction validateNewConnection(\n\t\trules: Array<DiagramValidationPortRuleFn> | DiagramValidationPortRuleFn | null,\n\t): boolean\n\t{\n\t\tif (rules === null)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (Type.isArray(rules))\n\t\t{\n\t\t\treturn rules.every((rule) => rule(toValue(newConnection)));\n\t\t}\n\n\t\tif (!Type.isFunction(rules))\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn rules(toValue(newConnection));\n\t}\n\n\tfunction normalyzeNewConnection(\n\t\tnewConnection: DiagramNewConnection,\n\t\tnormalyzeFn: DiagramNormalyzeConnectionFn | null = null,\n\t): DiagramAddConnection\n\t{\n\t\tif (Type.isFunction(normalyzeFn))\n\t\t{\n\t\t\treturn normalyzeFn(newConnection);\n\t\t}\n\n\t\treturn {\n\t\t\tid: newConnection.id,\n\t\t\tsourceBlockId: newConnection.sourceBlockId,\n\t\t\tsourcePortId: newConnection.sourcePortId,\n\t\t\ttargetBlockId: newConnection.targetBlockId,\n\t\t\ttargetPortId: newConnection.targetPortId,\n\t\t};\n\t}\n\n\tfunction onMouseDownPort(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tisSourcePort.value = true;\n\t\tconst portRect = toValue(portsRectMap)?.[toValue(block).id]?.[toValue(port).id];\n\t\tconst startPosition = {\n\t\t\tx: portRect.x + (portRect.width / 2),\n\t\t\ty: portRect.y + (portRect.height / 2),\n\t\t};\n\n\t\tnewConnection.value = {\n\t\t\tid: Text.getRandom(),\n\t\t\tsourceBlockId: toValue(block).id,\n\t\t\tsourcePortId: toValue(port).id,\n\t\t\tsourcePort: { ...toValue(port) },\n\t\t\tsourcePortPosition: position,\n\t\t\ttargetBlockId: null,\n\t\t\ttargetPortId: null,\n\t\t\ttargetPort: null,\n\t\t\tstart: startPosition,\n\t\t\tend: startPosition,\n\t\t};\n\n\t\tEvent.bind(document, 'mousemove', onMouseMove);\n\t\tEvent.bind(document, 'mouseup', onMouseUp);\n\t}\n\n\tfunction onMouseMove(event: MouseEvent): void\n\t{\n\t\tif (!toValue(newConnection) || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst x: number = event.clientX / toValue(zoom);\n\t\tconst y: number = event.clientY / toValue(zoom);\n\n\t\tnewConnection.value.end = {\n\t\t\tx: x + toValue(transformX) - (toValue(blockDiagramLeft) / toValue(zoom)),\n\t\t\ty: y + toValue(transformY) - (toValue(blockDiagramTop) / toValue(zoom)),\n\t\t};\n\t}\n\n\tfunction onMouseUp(event: MouseEvent): void\n\t{\n\t\tif (toValue(newConnection) === null || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst {\n\t\t\tsourceBlockId = null,\n\t\t\tsourcePortId = null,\n\t\t\ttargetBlockId = null,\n\t\t\ttargetPortId = null,\n\t\t} = toValue(newConnection);\n\n\t\tconst isSamePort = sourceBlockId === targetBlockId && sourcePortId === targetPortId;\n\t\tconst hasSourceIds = sourceBlockId !== null && sourcePortId !== null;\n\t\tconst hasTargetIds = targetBlockId !== null && targetPortId !== null;\n\n\t\tif (!isSamePort && hasSourceIds && hasTargetIds && toValue(isValidNewConnection))\n\t\t{\n\t\t\taddConnection(\n\t\t\t\tnormalyzeNewConnection(\n\t\t\t\t\ttoValue(newConnection),\n\t\t\t\t\tnormalyzeConnectionFn,\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tnewConnection.value = null;\n\t\tisSourcePort.value = false;\n\t\tEvent.unbind(document, 'mousemove', onMouseMove);\n\t\tEvent.unbind(document, 'mouseup', onMouseUp);\n\t}\n\n\tfunction onMouseOverPort(): void\n\t{\n\t\tif (toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (toValue(newConnection) !== null)\n\t\t{\n\t\t\tnewConnection.value.targetBlockId = toValue(block).id;\n\t\t\tnewConnection.value.targetPortId = toValue(port).id;\n\t\t\tnewConnection.value.targetPort = { ...toValue(port) };\n\t\t\tisValidNewConnection.value = validateNewConnection(toValue(validationRules));\n\t\t}\n\t}\n\n\tfunction onMouseLeavePort(): void\n\t{\n\t\tif (toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (toValue(newConnection) !== null)\n\t\t{\n\t\t\tnewConnection.value.targetBlockId = null;\n\t\t\tnewConnection.value.targetPortId = null;\n\t\t\tnewConnection.value.targetPort = null;\n\t\t\tisValidNewConnection.value = true;\n\t\t}\n\t}\n\n\treturn {\n\t\tisSourcePort,\n\t\tisValid,\n\t\tonMouseDownPort,\n\t\tonMouseOverPort,\n\t\tonMouseLeavePort,\n\t};\n}\n","import { computed, toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport { BLOCK_INDEXES } from '../constants';\nimport type { DiagramPort } from '../types';\n\nexport type UseBlockState = {\n\tisHiglitedBlock: boolean;\n\tisDisabled: boolean;\n\tupdatePortsPositions: () => void;\n};\n\nexport function useBlockState(block): UseBlockState\n{\n\tconst {\n\t\thighlitedBlockIds,\n\t\tisDisabledBlockDiagram,\n\t\tmovingBlock,\n\t\tupdatePortPosition,\n\t} = useBlockDiagram();\n\n\tconst isHiglitedBlock = computed(() => {\n\t\treturn highlitedBlockIds.value.includes(toValue(block).id);\n\t});\n\n\tconst isDisabled = computed(() => {\n\t\treturn toValue(isDisabledBlockDiagram);\n\t});\n\n\tconst blockZindex = computed(() => {\n\t\tif (toValue(movingBlock)?.id === toValue(block).id)\n\t\t{\n\t\t\treturn { zIndex: BLOCK_INDEXES.MOVABLE };\n\t\t}\n\n\t\tif (toValue(isHiglitedBlock))\n\t\t{\n\t\t\treturn { zIndex: BLOCK_INDEXES.HIGHLITED };\n\t\t}\n\n\t\treturn { zIndex: BLOCK_INDEXES.STANDING };\n\t});\n\n\tfunction updatePortsPositions()\n\t{\n\t\t([...toValue(block).ports.input, ...toValue(block).ports.output])\n\t\t\t.forEach((port: DiagramPort) => {\n\t\t\t\tupdatePortPosition(toValue(block).id, port.id);\n\t\t\t});\n\t}\n\n\treturn {\n\t\tisHiglitedBlock,\n\t\tisDisabled,\n\t\tblockZindex,\n\t\tupdatePortsPositions,\n\t};\n}\n","import { Event } from 'main.core';\nimport {\n\tref,\n\ttoValue,\n\tonMounted,\n\tonBeforeUnmount,\n\tcomputed,\n\twatchEffect,\n} from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\n\nexport type UseBlockReturnType = {\n\tisDragged: boolean,\n\tblockPositionStyle: {\n\t\ttop: string,\n\t\tleft: string,\n\t\twidth: string,\n\t},\n};\n\n// eslint-disable-next-line max-lines-per-function\nexport function useMoveableBlock(blockRef, block): UseBlockReturnType\n{\n\tconst isDragged = ref(false);\n\tconst {\n\t\tisDisabledBlockDiagram,\n\t\tzoom,\n\t\tupdateBlock,\n\t\thooks,\n\t\tsetMovingBlock,\n\t\tupdateMovingBlockPosition,\n\t\tresetMovingBlock,\n\t\tsetPortOffsetByBlockId,\n\t\tblocks: allBlocksRef,\n\t\thighlitedBlockIds,\n\t} = useBlockDiagram();\n\n\tlet prevValueBlockX = 0;\n\tlet prevValueBlockY = 0;\n\n\tconst offsetBlockX = ref(0);\n\tconst offsetBlockY = ref(0);\n\tlet cachedGroupBlocks = [];\n\n\tconst x = ref(toValue(block).position.x);\n\tconst y = ref(toValue(block).position.y);\n\n\twatchEffect(() => {\n\t\tx.value = toValue(block).position.x;\n\t\ty.value = toValue(block).position.y;\n\t});\n\n\tconst blockPositionStyle = computed(() => {\n\t\treturn {\n\t\t\ttop: `${y.value}px`,\n\t\t\tleft: `${x.value}px`,\n\t\t};\n\t});\n\n\tonMounted(() => {\n\t\tEvent.bind(toValue(blockRef), 'mousedown', onMouseDown);\n\t});\n\n\tonBeforeUnmount(() => {\n\t\tEvent.unbind(toValue(blockRef), 'mousedown', onMouseDown);\n\t});\n\n\tconst onMouseDown = (event: MouseEvent): void => {\n\t\tif (event.button !== 0 || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\n\t\tconst blockId = toValue(block).id;\n\t\tconst selectedIds = toValue(highlitedBlockIds);\n\t\tconst isSelected = selectedIds.includes(blockId);\n\n\t\tif (!isSelected)\n\t\t{\n\t\t\thighlitedBlockIds.value = [blockId];\n\t\t}\n\n\t\tsetMovingBlock(toValue(block));\n\t\thooks.startDragBlock.trigger(block);\n\n\t\tprevValueBlockX = toValue(block).position.x;\n\t\tprevValueBlockY = toValue(block).position.y;\n\n\t\toffsetBlockX.value = Math.round(event.clientX - (toValue(block).position.x * toValue(zoom)));\n\t\toffsetBlockY.value = Math.round(event.clientY - (toValue(block).position.y * toValue(zoom)));\n\n\t\tcachedGroupBlocks = [];\n\t\tconst groupIds = toValue(highlitedBlockIds);\n\t\tif (groupIds.length > 1)\n\t\t{\n\t\t\tconst allBlocks = toValue(allBlocksRef);\n\t\t\tcachedGroupBlocks = allBlocks.filter((b) => groupIds.includes(b.id) && b.id !== blockId);\n\t\t}\n\n\t\tisDragged.value = true;\n\t\tEvent.bind(document, 'mousemove', onMouseMove);\n\t\tEvent.bind(document, 'mouseup', onMouseUp);\n\t};\n\n\tconst onMouseMove = (event: MouseEvent): void => {\n\t\tif (!toValue(isDragged) || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tevent.stopPropagation();\n\t\thooks.moveDragBlock.trigger(block);\n\n\t\tconst newX = Math.round((event.clientX - toValue(offsetBlockX)) / toValue(zoom));\n\t\tconst newY = Math.round((event.clientY - toValue(offsetBlockY)) / toValue(zoom));\n\n\t\tconst deltaX = newX - prevValueBlockX;\n\t\tconst deltaY = newY - prevValueBlockY;\n\n\t\tx.value = newX;\n\t\ty.value = newY;\n\n\t\tfor (const targetBlock of cachedGroupBlocks)\n\t\t{\n\t\t\ttargetBlock.position.x += deltaX;\n\t\t\ttargetBlock.position.y += deltaY;\n\n\t\t\tif (setPortOffsetByBlockId)\n\t\t\t{\n\t\t\t\tsetPortOffsetByBlockId(targetBlock.id, { x: -deltaX, y: -deltaY });\n\t\t\t}\n\t\t}\n\n\t\tupdateMovingBlockPosition(x.value, y.value);\n\t\tsetPortOffsetByBlockId(\n\t\t\ttoValue(block).id,\n\t\t\t{\n\t\t\t\tx: prevValueBlockX - x.value,\n\t\t\t\ty: prevValueBlockY - y.value,\n\t\t\t},\n\t\t);\n\t\tprevValueBlockX = x.value;\n\t\tprevValueBlockY = y.value;\n\t};\n\n\tconst onMouseUp = (event: MouseEvent): void => {\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isDragged) || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst positionX: number = Math.round((event.clientX - toValue(offsetBlockX)) / toValue(zoom));\n\t\tconst positionY: number = Math.round((event.clientY - toValue(offsetBlockY)) / toValue(zoom));\n\n\t\tconst isMoved = toValue(block).position.x !== positionX || toValue(block).position.y !== positionY;\n\n\t\tif (isMoved)\n\t\t{\n\t\t\tcachedGroupBlocks.forEach((targetBlock) => {\n\t\t\t\tconst finalX = targetBlock.position.x;\n\t\t\t\tconst finalY = targetBlock.position.y;\n\n\t\t\t\tconst newBlockState = {\n\t\t\t\t\t...targetBlock,\n\t\t\t\t\tposition: { ...targetBlock.position, x: finalX, y: finalY },\n\t\t\t\t};\n\n\t\t\t\tif (setPortOffsetByBlockId)\n\t\t\t\t{\n\t\t\t\t\tsetPortOffsetByBlockId(targetBlock.id, { x: 0, y: 0 });\n\t\t\t\t}\n\n\t\t\t\tupdateBlock(newBlockState);\n\t\t\t\thooks.endDragBlock.trigger(newBlockState);\n\t\t\t});\n\n\t\t\tconst currentBlockState = {\n\t\t\t\t...toValue(block),\n\t\t\t\tposition: { ...toValue(block).position, x: positionX, y: positionY },\n\t\t\t};\n\n\t\t\tif (setPortOffsetByBlockId)\n\t\t\t{\n\t\t\t\tsetPortOffsetByBlockId(toValue(block).id, {\n\t\t\t\t\tx: prevValueBlockX - positionX,\n\t\t\t\t\ty: prevValueBlockY - positionY,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tupdateBlock(currentBlockState);\n\t\t\thooks.endDragBlock.trigger(currentBlockState);\n\t\t}\n\n\t\tresetMovingBlock();\n\t\tcachedGroupBlocks = [];\n\n\t\toffsetBlockX.value = 0;\n\t\toffsetBlockY.value = 0;\n\t\tisDragged.value = false;\n\t\tEvent.unbind(document, 'mousemove', onMouseMove);\n\t\tEvent.unbind(document, 'mouseup', onMouseUp);\n\t};\n\n\treturn {\n\t\tisDragged,\n\t\tblockPositionStyle,\n\t};\n}\n","import { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport { HOOK_NAMES } from '../constants';\nimport { commandToArray, CommandPayload } from '../utils';\n\nexport type UseModelValue = { dispose: () => void };\n\nexport function useModelValue(emit): UseModelValue\n{\n\tconst {\n\t\tblocks,\n\t\tconnections,\n\t\thistoryCurrentState,\n\t\thooks,\n\t} = useBlockDiagram();\n\n\tconst handlersMap: { [$Values<typeof HOOK_NAMES>]: (command: CommandPayload) => void } = {\n\t\t[HOOK_NAMES.CHANGED_BLOCKS]: handleChangeBlocks,\n\t\t[HOOK_NAMES.CHANGED_CONNECTIONS]: handleChangeConnections,\n\t};\n\n\tObject.entries(handlersMap)\n\t\t.forEach(([hookName, handler]) => {\n\t\t\thooks[hookName].on(handler);\n\t\t});\n\n\tfunction handleChangeBlocks(command: CommandPayload): void\n\t{\n\t\tcommandToArray.runCommand(\n\t\t\ttoValue(historyCurrentState.value.blocks),\n\t\t\tcommand,\n\t\t\t(value) => {\n\t\t\t\thistoryCurrentState.value.blocks = value;\n\t\t\t\temit('update:blocks', value);\n\t\t\t},\n\t\t);\n\t}\n\n\tfunction handleChangeConnections(command: CommandPayload): void\n\t{\n\t\tcommandToArray.runCommand(\n\t\t\ttoValue(historyCurrentState.value.connections),\n\t\t\tcommand,\n\t\t\t(value) => {\n\t\t\t\thistoryCurrentState.value.connections = value;\n\t\t\t\temit('update:connections', value);\n\t\t\t},\n\t\t);\n\t}\n\n\tfunction dispose(): void\n\t{\n\t\tObject.entries(handlersMap)\n\t\t\t.forEach(([hookName, handler]) => {\n\t\t\t\thooks[hookName].off(handler);\n\t\t\t});\n\t}\n\n\treturn {\n\t\tdispose,\n\t};\n}\n","import { watch, effectScope, markRaw } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\n\nexport type UseWatchProps = {\n\tdispose: () => void,\n};\n\nexport function useWatchProps(props): UseWatchProps\n{\n\tconst {\n\t\tblocks,\n\t\tconnections,\n\t\thistoryCurrentState,\n\t\tzoom,\n\t\tisDisabled,\n\t} = useBlockDiagram();\n\tconst scope = effectScope(true);\n\n\tscope.run(() => {\n\t\twatch([() => props.blocks, () => props.blocks.length], ([newBlocks]) => {\n\t\t\tif (newBlocks && Array.isArray(newBlocks))\n\t\t\t{\n\t\t\t\thistoryCurrentState.value.blocks = markRaw(JSON.parse(JSON.stringify(newBlocks)));\n\t\t\t\tblocks.value = newBlocks;\n\t\t\t}\n\t\t}, { immediate: true, deep: true });\n\n\t\twatch([() => props.connections, () => props.connections.length], ([newConnections]) => {\n\t\t\thistoryCurrentState.value.connections = markRaw(JSON.parse(JSON.stringify(newConnections)));\n\t\t\tconnections.value = [...newConnections];\n\t\t}, { immediate: true, deep: true });\n\n\t\twatch(() => props.zoom, (newZoom) => {\n\t\t\tzoom.value = newZoom;\n\t\t}, { immediate: true });\n\n\t\twatch(() => props.minZoom, (newMinZoom) => {\n\t\t\tzoom.value = newMinZoom;\n\t\t}, { immediate: true });\n\n\t\twatch(() => props.maxZoom, (newMaxZoom) => {\n\t\t\tzoom.value = newMaxZoom;\n\t\t}, { immediate: true });\n\n\t\twatch(() => props.disabled, (disabled) => {\n\t\t\tisDisabled.value = disabled;\n\t\t}, { immediate: true });\n\t});\n\n\tfunction dispose(): void\n\t{\n\t\tscope.stop();\n\t}\n\n\treturn {\n\t\tdispose,\n\t};\n}\n","import { Type } from 'main.core';\nimport { useBlockDiagram } from './block-diagram';\n\nexport type UseRegisterHooks = {\n\tdispose: () => void,\n};\n\nexport function useRegisterHooks(...hooksMaps): UseRegisterHooks\n{\n\tconst { hooks } = useBlockDiagram();\n\n\tconst mergedHookMaps = ([...hooksMaps])\n\t\t.reduce((accHookMaps, hookMap) => {\n\t\t\tconst result = { ...accHookMaps };\n\n\t\t\tObject.entries(hookMap)\n\t\t\t\t.forEach(([hookName, handler]) => {\n\t\t\t\t\tif (hookName in accHookMaps)\n\t\t\t\t\t{\n\t\t\t\t\t\tresult[hookName].push(\n\t\t\t\t\t\t\t...(Type.isFunction(handler) ? [handler] : handler),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult[hookName] = [\n\t\t\t\t\t\t\t...(Type.isFunction(handler) ? [handler] : handler),\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\treturn result;\n\t\t}, {});\n\n\tObject.entries(mergedHookMaps)\n\t\t.forEach(([hookName, handlers]) => {\n\t\t\thandlers.forEach((handler) => {\n\t\t\t\thooks?.[hookName]?.on(handler);\n\t\t\t});\n\t\t});\n\n\tfunction dispose()\n\t{\n\t\tObject.entries(mergedHookMaps)\n\t\t\t.forEach(([hookName, handlers]) => {\n\t\t\t\thandlers.forEach((handler) => {\n\t\t\t\t\thooks?.[hookName]?.off(handler);\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\treturn {\n\t\tdispose,\n\t};\n}\n","import { debounce } from 'main.core';\nimport { ref, toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type { DiagramBlock } from '../types';\n\ntype UseSearchBlocksOptions = {\n\tsearchCallback: (item: {...}, searchText: string) => boolean;\n\tdelay: number;\n};\n\ntype UseSearchBlocks = {\n\tseachText: string;\n\tfoundBlocks: Array<DiagramBlock>;\n\tonSearchBlocks: (searchText: string) => void;\n\tonClearSearch: () => void;\n};\n\nconst DEFAULT_OPTIONS: UseSearchBlocksOptions = {\n\tsearchCallback: () => false,\n\tdelay: 300,\n};\n\nexport function useSearchBlocks(optionParams: UseSearchBlocksOptions): UseSearchBlocks\n{\n\tconst {\n\t\tblocks,\n\t} = useBlockDiagram();\n\tconst options: UseSearchBlocksOptions = { ...DEFAULT_OPTIONS, ...optionParams };\n\tconst seachText: string = ref('');\n\tconst foundBlocks: Array<DiagramBlock> = ref([]);\n\n\tfunction onSearchBlocks(searchText: string): void\n\t{\n\t\tseachText.value = searchText;\n\t\tfoundBlocks.value = [];\n\n\t\tif (toValue(seachText).trim() === '')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tblocks.value.forEach((block) => {\n\t\t\tif (options.searchCallback(block, toValue(seachText)))\n\t\t\t{\n\t\t\t\tfoundBlocks.value.push(block);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction onClearSearch(): void\n\t{\n\t\tseachText.value = '';\n\t\tfoundBlocks.value = [];\n\t}\n\n\treturn {\n\t\tseachText,\n\t\tfoundBlocks,\n\t\tonSearchBlocks: debounce(onSearchBlocks, options.delay),\n\t\tonClearSearch,\n\t};\n}\n","import { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type { DiagramBlockId } from '../types';\n\nexport type UseCanvas = {\n\tzoomIn: (zoomStep: number) => void,\n\tzoomOut: (zoomStep: number) => void,\n\tsetCamera: (params: { x: number, y: number, zoom: number}) => void,\n\tgoToBlockById: (id: DiagramBlockId) => void,\n};\n\nexport function useCanvas(): UseCanvas\n{\n\tconst {\n\t\tzoom,\n\t\tblocks,\n\t\tcanvasWidth,\n\t\tcanvasHeight,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t\tcanvasInstance,\n\t} = useBlockDiagram();\n\n\tfunction zoomIn(zoomStep: number): void\n\t{\n\t\ttoValue(canvasInstance)?.zoomIn(zoomStep);\n\t}\n\n\tfunction zoomOut(zoomStep: number): void\n\t{\n\t\ttoValue(canvasInstance)?.zoomOut(zoomStep);\n\t}\n\n\tfunction setCamera(params: { x: number, y: number, zoom: number}): void\n\t{\n\t\ttoValue(canvasInstance)?.setCamera(params);\n\t}\n\n\tfunction goToBlockById(id: DiagramBlockId): void\n\t{\n\t\tconst block = toValue(blocks).find((block) => block.id === id);\n\n\t\tif (!block)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { x, y } = block.position;\n\t\tconst { width, height } = block.dimensions;\n\t\tconst centerX = x + (width / 2);\n\t\tconst centerY = y + (height / 2);\n\n\t\tsetCamera({\n\t\t\tx: centerX - (toValue(canvasWidth) / 2 / toValue(zoom)) - toValue(blockDiagramLeft) / toValue(zoom),\n\t\t\ty: centerY - (toValue(canvasHeight) / 2 / toValue(zoom)) - toValue(blockDiagramTop) / toValue(zoom),\n\t\t});\n\t}\n\n\treturn {\n\t\tzoomIn,\n\t\tzoomOut,\n\t\tsetCamera,\n\t\tgoToBlockById,\n\t};\n}\n","import { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type { DiagramBlockId } from '../types';\n\nexport type UseHighlightedBlocks = {\n\thighlitedBlockIds: Array<DiagramBlockId>;\n\tset: (blockIds: Array<DiagramBlockId>) => void;\n\tadd: (blockId: DiagramBlockId) => void;\n\tremove: (blockId: DiagramBlockId) => void;\n\tclear: () => void;\n};\n\nexport function useHighlightedBlocks(): UseHighlightedBlocks\n{\n\tconst { highlitedBlockIds } = useBlockDiagram();\n\n\tfunction set(blockIds: Array<DiagramBlockId>): void\n\t{\n\t\ttoValue(highlitedBlockIds).push(...blockIds);\n\t}\n\n\tfunction add(blockId: DiagramBlockId): void\n\t{\n\t\ttoValue(highlitedBlockIds).push(blockId);\n\t}\n\n\tfunction remove(blockId: DiagramBlockId)\n\t{\n\t\tconst highlitedIndx: number = highlitedBlockIds.value.indexOf(blockId);\n\n\t\tif (highlitedIndx > -1)\n\t\t{\n\t\t\thighlitedBlockIds.value.splice(highlitedIndx, 1);\n\t\t}\n\t}\n\n\tfunction clear(): void\n\t{\n\t\thighlitedBlockIds.value = [];\n\t}\n\n\treturn {\n\t\thighlitedBlockIds,\n\t\tset,\n\t\tadd,\n\t\tremove,\n\t\tclear,\n\t};\n}\n","import { getCurrentInstance } from 'ui.vue3';\n\nexport type UseLoc = {\n\tgetMessage: (messageId: string, replacements: string) => string,\n};\n\nexport function useLoc(): UseLoc\n{\n\tconst app = getCurrentInstance()?.appContext.app;\n\tconst bitrix = app?.config?.globalProperties?.$bitrix ?? null;\n\n\treturn {\n\t\tgetMessage: (messageId: string, replacements: string): string => {\n\t\t\treturn bitrix?.Loc?.getMessage(messageId, replacements);\n\t\t},\n\t};\n}\n","import { toValue, computed } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type { DiagramBlockId, DiagramPortId } from '../types';\nimport { PORT_POSITION } from '../constants';\n\ntype UsePortState = {\n\tisDisabled: boolean;\n\tonMountedPort: () => void;\n\tonUnmountedPort: () => void;\n};\n\n// eslint-disable-next-line max-lines-per-function\nexport function usePortState(options): UsePortState\n{\n\tconst {\n\t\tportRef,\n\t\tblock,\n\t\tport,\n\t\tposition = PORT_POSITION.LEFT,\n\t} = options;\n\n\tconst {\n\t\tportsElMap,\n\t\tportsRectMap,\n\t\tzoom,\n\t\ttransformX,\n\t\ttransformY,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t\tisDisabledBlockDiagram,\n\t} = useBlockDiagram();\n\n\tconst isDisabled = computed((): boolean => {\n\t\treturn toValue(isDisabledBlockDiagram);\n\t});\n\n\tfunction addPortElement(blockId: DiagramBlockId, portId: DiagramPortId, portEl: HTMLElement): void\n\t{\n\t\tif (!toValue(portsElMap).has(blockId))\n\t\t{\n\t\t\ttoValue(portsElMap).set(blockId, new Map());\n\t\t}\n\n\t\ttoValue(portsElMap)\n\t\t\t.get(blockId)\n\t\t\t.set(portId, toValue(portEl));\n\t}\n\n\tfunction deletePortElement(blockId: DiagramBlockId, portId: DiagramPortId): void\n\t{\n\t\tif (!toValue(portsElMap).has(blockId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\ttoValue(portsElMap)\n\t\t\t.get(blockId)\n\t\t\t.delete(portId);\n\t}\n\n\tfunction addPortRect(\n\t\tblockId: DiagramBlockId,\n\t\tportId: DiagramPortId,\n\t\tportEl: HTMLElement,\n\t): void\n\t{\n\t\tif (!(blockId in toValue(portsRectMap)))\n\t\t{\n\t\t\ttoValue(portsRectMap)[blockId] = {};\n\t\t}\n\n\t\tconst {\n\t\t\tx = 0,\n\t\t\ty = 0,\n\t\t\twidth = 0,\n\t\t\theight = 0,\n\t\t} = toValue(portEl)?.getBoundingClientRect() ?? {};\n\n\t\ttoValue(portsRectMap)[blockId][portId] = {\n\t\t\tx: (x / toValue(zoom)) + toValue(transformX) - (toValue(blockDiagramLeft) / toValue(zoom)),\n\t\t\ty: (y / toValue(zoom)) + toValue(transformY) - (toValue(blockDiagramTop) / toValue(zoom)),\n\t\t\twidth,\n\t\t\theight,\n\t\t\tposition,\n\t\t};\n\t}\n\n\tfunction deletePortRect(blockId: DiagramBlockId, portId: DiagramPortId): void\n\t{\n\t\tif (!(blockId in toValue(portsRectMap)))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst portsMap = toValue(portsRectMap)[blockId];\n\n\t\tif (Object.keys(portsMap).length === 1)\n\t\t{\n\t\t\tdelete toValue(portsRectMap)[blockId];\n\t\t}\n\t\telse\n\t\t{\n\t\t\tdelete toValue(portsMap)[portId];\n\t\t}\n\t}\n\n\tfunction onMountedPort(): void\n\t{\n\t\taddPortElement(\n\t\t\ttoValue(block).id,\n\t\t\ttoValue(port).id,\n\t\t\tportRef,\n\t\t);\n\t\taddPortRect(\n\t\t\ttoValue(block).id,\n\t\t\ttoValue(port).id,\n\t\t\tportRef,\n\t\t);\n\t}\n\n\tfunction onUnmountedPort(): void\n\t{\n\t\tdeletePortElement(toValue(block).id, toValue(port).id);\n\t\tdeletePortRect(toValue(block).id, toValue(port).id);\n\t}\n\n\treturn {\n\t\tisDisabled,\n\t\tonMountedPort,\n\t\tonUnmountedPort,\n\t};\n}\n","import { toValue, computed } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport { getBeziePath, getSmoothStepPath, BEZIER_DIR } from '../utils';\nimport { PORT_POSITION } from '../constants';\nimport type { PathInfo } from '../utils';\nimport type { DiagramConnection, DiagramConnectionViewType } from '../../types';\n\ntype PortPosition = {\n\tx: number;\n\ty: number;\n};\n\ntype ConnectionPortPosition = {\n\tsourcePort: PortPosition;\n\ttargetPort: PortPosition;\n};\n\ntype UseConnectionState = {\n\tconnectionPortsPosition: ConnectionPortPosition | null;\n\tconnectionPathInfo: PathInfo;\n\tisDisabled: boolean;\n};\n\nexport type UseConnectionStateOptions = {\n\tconnection: DiagramConnection;\n\tviewType: DiagramConnectionViewType;\n};\n\nconst DEFAULT_PATH_INFO: PathInfo = {\n\tpath: '',\n\tcenter: {\n\t\tx: 0,\n\t\ty: 0,\n\t},\n};\nconst SMOOTHSTEP_OFFSET = 30;\nconst SMOOTHSTEP_BORDER_RADIUS = 10;\n\n// eslint-disable-next-line max-lines-per-function\nexport function useConnectionState(connection: DiagramConnection): UseConnectionState\n{\n\tconst {\n\t\tportsRectMap,\n\t\tisDisabledBlockDiagram,\n\t} = useBlockDiagram();\n\n\tconst connectionPortsPosition = computed((): ConnectionPortPosition | null => {\n\t\tconst {\n\t\t\tsourceBlockId,\n\t\t\tsourcePortId,\n\t\t\ttargetBlockId,\n\t\t\ttargetPortId,\n\t\t} = toValue(connection);\n\n\t\tconst hasSourceBlockId = sourceBlockId in toValue(portsRectMap);\n\t\tconst hasSourcePortId = hasSourceBlockId && (sourcePortId in toValue(portsRectMap)[sourceBlockId]);\n\t\tconst hasTargetBlockId = targetBlockId in toValue(portsRectMap);\n\t\tconst hasTargetPortId = hasTargetBlockId && (targetPortId in toValue(portsRectMap)[targetBlockId]);\n\n\t\tif (\n\t\t\t!hasSourceBlockId\n\t\t\t|| !hasSourcePortId\n\t\t\t|| !hasTargetBlockId\n\t\t\t|| !hasTargetPortId\n\t\t)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst {\n\t\t\tx: sourceX,\n\t\t\ty: sourceY,\n\t\t\twidth: sourceWidth,\n\t\t\theight: sourceHeight,\n\t\t\tposition: sourcePosition,\n\t\t} = toValue(portsRectMap)[sourceBlockId][sourcePortId];\n\t\tconst {\n\t\t\tx: targetX,\n\t\t\ty: targetY,\n\t\t\twidth: targetWidth,\n\t\t\theight: targetHeight,\n\t\t\tposition: targetPosition,\n\t\t} = toValue(portsRectMap)[targetBlockId][targetPortId];\n\n\t\treturn {\n\t\t\tsourcePort: {\n\t\t\t\tx: sourceX + (sourceWidth / 2),\n\t\t\t\ty: sourceY + (sourceHeight / 2),\n\t\t\t\tposition: sourcePosition,\n\t\t\t},\n\t\t\ttargetPort: {\n\t\t\t\tx: targetX + (targetWidth / 2),\n\t\t\t\ty: targetY + (targetHeight / 2),\n\t\t\t\tposition: targetPosition,\n\t\t\t},\n\t\t};\n\t});\n\n\tconst connectionPathInfo = computed((): PathInfo => {\n\t\tif (toValue(connectionPortsPosition) === null)\n\t\t{\n\t\t\treturn DEFAULT_PATH_INFO;\n\t\t}\n\n\t\tconst sourcePosition = toValue(connectionPortsPosition).sourcePort.position;\n\t\tconst targetPosition = toValue(connectionPortsPosition).targetPort.position;\n\n\t\tconst isVerticalDirBezier = sourcePosition !== targetPosition\n\t\t\t&& ([PORT_POSITION.TOP, PORT_POSITION.BOTTOM]).includes(sourcePosition)\n\t\t\t&& ([PORT_POSITION.TOP, PORT_POSITION.BOTTOM]).includes(targetPosition);\n\n\t\tconst isHorizontalDirBezier = sourcePosition !== targetPosition\n\t\t\t&& ([PORT_POSITION.LEFT, PORT_POSITION.RIGHT]).includes(sourcePosition)\n\t\t\t&& ([PORT_POSITION.LEFT, PORT_POSITION.RIGHT]).includes(targetPosition);\n\n\t\tconst { path: smoothStepPath, center, points } = getSmoothStepPath({\n\t\t\tsourceX: toValue(connectionPortsPosition).sourcePort.x,\n\t\t\tsourceY: toValue(connectionPortsPosition).sourcePort.y,\n\t\t\tsourcePosition,\n\t\t\ttargetX: toValue(connectionPortsPosition).targetPort.x,\n\t\t\ttargetY: toValue(connectionPortsPosition).targetPort.y,\n\t\t\ttargetPosition,\n\t\t\tborderRadius: SMOOTHSTEP_BORDER_RADIUS,\n\t\t\toffset: SMOOTHSTEP_OFFSET,\n\t\t});\n\t\tconst [p1, p2, p3, p4, p5, p6] = points;\n\n\t\tconst isXConsistOfThreeParts = p1.x === p2.x\n\t\t\t&& p1.x === p3.x\n\t\t\t&& p4.x === p5.x\n\t\t\t&& p4.x === p6.x;\n\t\tconst isYConsistOfThreeParts = p1.y === p2.y\n\t\t\t&& p1.y === p3.y\n\t\t\t&& p4.y === p5.y\n\t\t\t&& p4.y === p6.y;\n\n\t\tif (\n\t\t\t(isXConsistOfThreeParts && isVerticalDirBezier)\n\t\t\t|| (isYConsistOfThreeParts && isHorizontalDirBezier)\n\t\t)\n\t\t{\n\t\t\treturn getBeziePath(\n\t\t\t\ttoValue(connectionPortsPosition).sourcePort,\n\t\t\t\ttoValue(connectionPortsPosition).targetPort,\n\t\t\t\tisVerticalDirBezier ? BEZIER_DIR.VERTICAL : BEZIER_DIR.HORIZONTAL,\n\t\t\t);\n\t\t}\n\n\t\treturn {\n\t\t\tpath: smoothStepPath,\n\t\t\tcenter,\n\t\t};\n\t});\n\n\tconst isDisabled = computed((): boolean => {\n\t\treturn toValue(isDisabledBlockDiagram);\n\t});\n\n\treturn {\n\t\tconnectionPortsPosition,\n\t\tconnectionPathInfo,\n\t\tisDisabled,\n\t};\n}\n","import 'main.polyfill.intersectionobserver';\nimport { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\n\ntype UseInitAppElements = {\n\tonMountedAppElements: () => void;\n\tonUnmountedAppElements: () => void;\n}\n\ntype Options = {\n\tblockDiagramRef: HTMLElement;\n}\n\nexport function useInitAppElements(options: Options): UseInitAppElements\n{\n\tconst {\n\t\tblockDiagramRef: newBlockDiagramRef,\n\t} = options;\n\tconst {\n\t\tblockDiagramRef,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t} = useBlockDiagram();\n\n\tlet observer: typeof IntersectionObserver | null = null;\n\n\tfunction handleInterObserver(entries): void\n\t{\n\t\tentries.forEach((entry) => {\n\t\t\tconst { top, left } = entry.boundingClientRect;\n\n\t\t\tblockDiagramTop.value = top;\n\t\t\tblockDiagramLeft.value = left;\n\t\t});\n\t}\n\n\tfunction onMountedAppElements()\n\t{\n\t\tblockDiagramRef.value = toValue(newBlockDiagramRef);\n\n\t\tconst { left, top } = toValue(newBlockDiagramRef).getBoundingClientRect();\n\n\t\tblockDiagramTop.value = top;\n\t\tblockDiagramLeft.value = left;\n\n\t\tobserver = new IntersectionObserver(handleInterObserver);\n\t\tobserver.observe(toValue(blockDiagramRef));\n\t}\n\n\tfunction onUnmountedAppElements(): void\n\t{\n\t\tobserver.unobserve(toValue(blockDiagramRef));\n\t}\n\n\treturn {\n\t\tonMountedAppElements,\n\t\tonUnmountedAppElements,\n\t};\n}\n","import { computed, toValue } from 'ui.vue3';\nimport { getBeziePath, BEZIER_DIR } from '../utils';\nimport { PORT_POSITION } from '../constants';\nimport type { PathInfo } from '../utils';\nimport { useBlockDiagram } from './block-diagram';\n\nexport type UseNewConnectionState = {\n\thasNewConnection: boolean;\n\tnewConnectionPathInfo: PathInfo;\n\tisValid: boolean;\n};\n\nexport function useNewConnectionState(): UseNewConnectionState\n{\n\tconst { newConnection, isValidNewConnection } = useBlockDiagram();\n\n\tconst hasNewConnection = computed((): boolean => {\n\t\treturn toValue(newConnection) !== null;\n\t});\n\n\tconst newConnectionPathInfo = computed((): PathInfo => {\n\t\tif (!toValue(hasNewConnection))\n\t\t{\n\t\t\treturn {\n\t\t\t\tpath: '',\n\t\t\t\tcenter: {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: 0,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tconst isHorizontalBezier = ([PORT_POSITION.LEFT, PORT_POSITION.RIGHT])\n\t\t\t.includes(toValue(newConnection).sourcePortPosition);\n\n\t\treturn getBeziePath(\n\t\t\ttoValue(newConnection).start,\n\t\t\ttoValue(newConnection).end,\n\t\t\tisHorizontalBezier ? BEZIER_DIR.HORIZONTAL : BEZIER_DIR.VERTICAL,\n\t\t);\n\t});\n\n\tconst isValid = computed((): boolean => {\n\t\tif (toValue(newConnection) === null)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn toValue(isValidNewConnection);\n\t});\n\n\treturn {\n\t\thasNewConnection,\n\t\tnewConnectionPathInfo,\n\t\tisValid,\n\t};\n}\n","import { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type {\n\tAnimationItem,\n} from '../types';\n\nimport { ANIMATED_TYPES } from '../constants';\n\ntype Options = {\n\titems: Array<AnimationItem>;\n\tzoom: number;\n};\n\ntype UseAnimatedQueue = {\n\tstart: (options: Options) => void;\n\tpause: () => void;\n\tplay: () => void;\n\tstop: () => void;\n};\n\nexport function useAnimationQueue(): UseAnimatedQueue\n{\n\tconst {\n\t\tzoom,\n\t\tisPauseAnimation,\n\t\tisStopAnimation,\n\t\tanimationQueue,\n\t\tcurrentAnimationItem,\n\t\taddConnection,\n\t\tdeleteConnectionById,\n\t\taddBlock,\n\t\tdeleteBlockById,\n\t} = useBlockDiagram();\n\n\tfunction animateItem(animatedItem: AnimationItem): void\n\t{\n\t\tswitch (animatedItem.type)\n\t\t{\n\t\t\tcase ANIMATED_TYPES.BLOCK: {\n\t\t\t\taddBlock(animatedItem.item);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase ANIMATED_TYPES.CONNECTION: {\n\t\t\t\taddConnection(animatedItem.item);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase ANIMATED_TYPES.REMOVE_BLOCK: {\n\t\t\t\tdeleteBlockById(animatedItem.item.id);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcase ANIMATED_TYPES.REMOVE_CONNECTION: {\n\t\t\t\tdeleteConnectionById(animatedItem.item.id);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tfunction* animationQueueFn(animatedQueueItems: Array<AnimationItem>): Generator<AnimationItem | undefined>\n\t{\n\t\tfor (const animatedItem: AnimationItem of animatedQueueItems)\n\t\t{\n\t\t\tif (toValue(isPauseAnimation))\n\t\t\t{\n\t\t\t\tyield;\n\t\t\t}\n\n\t\t\tif (toValue(isStopAnimation))\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcurrentAnimationItem.value = animatedItem;\n\n\t\t\tif (animatedItem.type && animatedItem.item)\n\t\t\t{\n\t\t\t\tanimateItem(animatedItem);\n\n\t\t\t\tyield animatedItem;\n\t\t\t}\n\t\t}\n\n\t\tstop();\n\t}\n\n\tfunction start(options: Options): void\n\t{\n\t\tconst {\n\t\t\titems: shouldAnimatedItems = [],\n\t\t} = options ?? {};\n\n\t\tzoom.value = 1;\n\t\tisStopAnimation.value = false;\n\n\t\tanimationQueue.value = animationQueueFn(shouldAnimatedItems);\n\t\tif (shouldAnimatedItems.length > 0)\n\t\t{\n\t\t\tsetTimeout((): void => play(), 100);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstop();\n\t\t}\n\t}\n\n\tfunction pause(): void\n\t{\n\t\tisPauseAnimation.value = true;\n\t}\n\n\tfunction play(): void\n\t{\n\t\tisPauseAnimation.value = false;\n\t\tanimationQueue.value?.next();\n\t}\n\n\tfunction stop(): void\n\t{\n\t\tisStopAnimation.value = true;\n\t\tisPauseAnimation.value = false;\n\t\tcurrentAnimationItem.value = null;\n\t\tanimationQueue.value = null;\n\t}\n\n\treturn {\n\t\tstart,\n\t\tpause,\n\t\tplay,\n\t\tstop,\n\t};\n}\n","import { ref, toValue, markRaw } from 'ui.vue3';\nimport { Dom } from 'main.core';\nimport { useBlockDiagram } from './block-diagram';\nimport { Canvas, Grid } from '../utils';\n\nexport type UseCanvasTransform = {\n\tisDragging: boolean,\n\tonMounted: () => void,\n\tonUnmounted: () => void,\n\tonMouseDown: (event: MouseEvent) => void,\n};\n\nexport type UseCanvasTransformOptions = {\n\tcanvasRef: HTMLElement,\n\ttransformLayoutRef: HTMLElement,\n\tcanvasStyle: newCanvasStyle,\n};\n\nconst CANVAS_STYLE_DEFAULT_OPTIONS: {...} = {\n\tgrid: {\n\t\toptions: {\n\t\t\tsize: 64,\n\t\t\tgridColor: '#A1B8D9',\n\t\t\tbackgroundColor: '#ECF0F2',\n\t\t\tzoomStep: 4,\n\t\t\tzoomSteps: [\n\t\t\t\t{\n\t\t\t\t\tzoom: 1.1,\n\t\t\t\t\tsize: 64,\n\t\t\t\t\tzoomStep: 4,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tzoom: 1,\n\t\t\t\t\tsize: 64,\n\t\t\t\t\tzoomStep: 4,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tzoom: 0.99,\n\t\t\t\t\tsize: 64,\n\t\t\t\t\tzoomStep: 4,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tzoom: 0.5,\n\t\t\t\t\tsize: 64 * 5,\n\t\t\t\t\tzoomStep: 0.5,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tzoom: 0.25,\n\t\t\t\t\tsize: 64 * 25,\n\t\t\t\t\tzoomStep: 0.25,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tzoom: 0.125,\n\t\t\t\t\tsize: 64 * 125,\n\t\t\t\t\tzoomStep: 0.125,\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\tinstance: Grid,\n\t},\n};\n\n// eslint-disable-next-line max-lines-per-function\nexport function useCanvasTransfrom(options: UseCanvasTransformOptions): UseCanvasTransform\n{\n\tconst {\n\t\tcanvasRef: newCanvasRef,\n\t\ttransformLayoutRef: newTransformLayoutRef,\n\t\tcanvasStyle: newCanvasStyle,\n\t\tzoomSensitivity,\n\t\tzoomSensitivityMouse,\n\t} = options;\n\n\tconst {\n\t\tisDisabledBlockDiagram,\n\t\ttransformX,\n\t\ttransformY,\n\t\tzoom,\n\t\tminZoom,\n\t\tmaxZoom,\n\t\tcanvasRef,\n\t\ttransformLayoutRef,\n\t\tcanvasWidth,\n\t\tcanvasHeight,\n\t\tcanvasInstance,\n\t} = useBlockDiagram();\n\n\tconst dragOn = ref(false);\n\tconst isDragging = ref(false);\n\tconst zooming = ref(false);\n\n\tlet requestAnimationId = null;\n\n\tfunction getCanvasStyleOptions(canvasStyle: CanvasStyle): CanvasStyle | null\n\t{\n\t\tif (canvasStyle && canvasStyle.style in CANVAS_STYLE_DEFAULT_OPTIONS)\n\t\t{\n\t\t\treturn {\n\t\t\t\tinstance: CANVAS_STYLE_DEFAULT_OPTIONS[canvasStyle.style].instance,\n\t\t\t\toptions: {\n\t\t\t\t\t...CANVAS_STYLE_DEFAULT_OPTIONS[canvasStyle.style].options,\n\t\t\t\t\t...canvasStyle,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction onMounted(): void\n\t{\n\t\tcanvasRef.value = newCanvasRef;\n\t\ttransformLayoutRef.value = newTransformLayoutRef;\n\n\t\tcanvasInstance.value = markRaw(new Canvas({\n\t\t\tcanvas: toValue(newCanvasRef),\n\t\t\tcanvasStyle: getCanvasStyleOptions(newCanvasStyle),\n\t\t\tminZoom: toValue(minZoom),\n\t\t\tmaxZoom: toValue(maxZoom),\n\t\t}));\n\n\t\ttoValue(canvasInstance).camera.setChangeTransformCallback((payload) => {\n\t\t\ttransformX.value = payload.x;\n\t\t\ttransformY.value = payload.y;\n\t\t\tzoom.value = payload.zoom;\n\t\t\tcanvasWidth.value = payload.width;\n\t\t\tcanvasHeight.value = payload.height;\n\t\t});\n\n\t\trender();\n\t}\n\n\tfunction onUnmounted(): void\n\t{\n\t\ttoValue(canvasInstance)?.destroy();\n\t\tcancelAnimationFrame(requestAnimationId);\n\t}\n\n\tfunction onMouseDown(event: MouseEvent): void\n\t{\n\t\tif (toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tdragOn.value = true;\n\t\ttoValue(canvasInstance)?.setCameraPositionByMouseDown(event);\n\t}\n\n\tfunction onMouseMove(event: MouseEvent): void\n\t{\n\t\tif (!toValue(dragOn) || toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (event.buttons !== 1 && event.buttons !== 4)\n\t\t{\n\t\t\tdragOn.value = false;\n\t\t\tisDragging.value = false;\n\n\t\t\treturn;\n\t\t}\n\n\t\tisDragging.value = true;\n\t\ttoValue(canvasInstance)?.setCameraPositionByMouseMove(event);\n\t}\n\n\tfunction onMouseUp(): void\n\t{\n\t\tdragOn.value = false;\n\t\tisDragging.value = false;\n\t}\n\n\tfunction onWheel(event: WheelEvent): void\n\t{\n\t\tevent.preventDefault();\n\n\t\tif (toValue(isDisabledBlockDiagram))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst isTrackpad = event.wheelDeltaY\n\t\t\t? event.wheelDeltaY === -3 * event.deltaY\n\t\t\t: event.deltaMode === 0;\n\n\t\tif (event.ctrlKey)\n\t\t{\n\t\t\tconst zoomChange = isTrackpad\n\t\t\t\t? -event.deltaY * toValue(zoomSensitivity)\n\t\t\t\t: -Math.sign(event.deltaY) * toValue(zoomSensitivityMouse);\n\n\t\t\tzooming.value = true;\n\t\t\ttoValue(canvasInstance)?.setCameraZoomByWheel(event, zoomChange);\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tzooming.value = false;\n\t\t\t}, 200);\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttoValue(canvasInstance)?.setCameraPositionByWheel(event);\n\t\t}\n\t}\n\n\tfunction render(): void\n\t{\n\t\tif (canvasInstance)\n\t\t{\n\t\t\ttoValue(canvasInstance)?.render();\n\t\t\tconst viewMatrix = toValue(canvasInstance).viewMatrix;\n\n\t\t\tDom.style(\n\t\t\t\ttoValue(transformLayoutRef),\n\t\t\t\t'transform',\n\t\t\t\t`\n\t\t\t\t\tmatrix(\n\t\t\t\t\t\t${viewMatrix[0]}, 0, 0, ${viewMatrix[4]}, ${viewMatrix[6]}, ${viewMatrix[7]}\n\t\t\t\t\t)\n\t\t\t\t`,\n\t\t\t);\n\t\t}\n\n\t\trequestAnimationId = requestAnimationFrame(render);\n\t}\n\n\treturn {\n\t\tisDragging,\n\t\tonMounted,\n\t\tonUnmounted,\n\t\tonMouseDown,\n\t\tonMouseMove,\n\t\tonMouseUp,\n\t\tonWheel,\n\t};\n}\n","import { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport type { DiagramBlock } from '../types';\n\nexport function useDragAndDrop(): {...}\n{\n\tconst {\n\t\tzoom,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t\ttransformX,\n\t\ttransformY,\n\t\taddBlock,\n\t\thooks,\n\t} = useBlockDiagram();\n\n\tfunction onDrop(event: DragEvent): void\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst dataString = event.dataTransfer.getData('text/plain');\n\t\tconst receivedData = JSON.parse(dataString);\n\n\t\tconst { width, height } = receivedData.dimensions;\n\n\t\treceivedData.position.x = (event.clientX - (width * toValue(zoom) / 2)) / toValue(zoom);\n\t\treceivedData.position.y = (event.clientY - (height * toValue(zoom) / 2)) / toValue(zoom);\n\n\t\treceivedData.position.x += toValue(transformX);\n\t\treceivedData.position.y += toValue(transformY);\n\n\t\treceivedData.position.x -= toValue(blockDiagramLeft) / toValue(zoom);\n\t\treceivedData.position.y -= toValue(blockDiagramTop) / toValue(zoom);\n\n\t\taddBlock(receivedData);\n\t\thooks.dropNewBlock.trigger(receivedData);\n\t}\n\n\tfunction setBlockData(event, addedBlock: DiagramBlock): void\n\t{\n\t\tevent.dataTransfer.setData('text/plain', JSON.stringify(addedBlock));\n\t}\n\n\treturn {\n\t\tsetBlockData,\n\t\tonDrop,\n\t};\n}\n","import { Event } from 'main.core';\nimport { toValue, ref, computed } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\nimport { CURSOR_TYPES } from '../constants';\n\n// eslint-disable-next-line max-lines-per-function\nexport function useResizableBlock(options): {...}\n{\n\tconst {\n\t\tcursorType,\n\t\tresizingBlock,\n\t\tblockDiagramTop,\n\t\tblockDiagramLeft,\n\t\ttransformX,\n\t\ttransformY,\n\t\tzoom,\n\t\tupdateBlock,\n\t} = useBlockDiagram();\n\tconst {\n\t\tblock,\n\t\tminWidth,\n\t\tminHeight,\n\t\tleftSideRef,\n\t\ttopSideRef,\n\t\trightSideRef,\n\t\tbottomSideRef,\n\t\tleftTopCornerRef,\n\t\trightTopCornerRef,\n\t\trightBottomCornerRef,\n\t\tleftBottomCornerRef,\n\t} = options;\n\n\tconst isResize = ref(false);\n\tlet prevBlockX = 0;\n\tlet prevBlockY = 0;\n\tlet prevBlockWidth = 0;\n\tlet prevBlockHeight = 0;\n\n\tconst sizeBlockStyle = computed(() => {\n\t\tif (toValue(isResize))\n\t\t{\n\t\t\treturn {\n\t\t\t\twidth: `${toValue(resizingBlock).dimensions.width}px`,\n\t\t\t\theight: `${toValue(resizingBlock).dimensions.height}px`,\n\t\t\t\tcursor: toValue(cursorType),\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\twidth: `${toValue(block).dimensions.width}px`,\n\t\t\theight: `${toValue(block).dimensions.height}px`,\n\t\t\tcursor: toValue(cursorType),\n\t\t};\n\t});\n\n\tfunction updateResizableBlock(): void\n\t{\n\t\tupdateBlock({\n\t\t\t...toValue(block),\n\t\t\tposition: {\n\t\t\t\tx: toValue(resizingBlock).position.x,\n\t\t\t\ty: toValue(resizingBlock).position.y,\n\t\t\t},\n\t\t\tdimensions: {\n\t\t\t\twidth: toValue(resizingBlock).dimensions.width,\n\t\t\t\theight: toValue(resizingBlock).dimensions.height,\n\t\t\t},\n\t\t});\n\t}\n\n\tfunction onMounted(): void\n\t{\n\t\tEvent.bind(toValue(rightSideRef), 'mousedown', onMouseDownRightSide);\n\t\tEvent.bind(toValue(bottomSideRef), 'mousedown', onMouseDownBottomSide);\n\t\tEvent.bind(toValue(leftSideRef), 'mousedown', onMouseDownLeftSide);\n\t\tEvent.bind(toValue(topSideRef), 'mousedown', onMouseDownTopSide);\n\n\t\tEvent.bind(toValue(rightTopCornerRef), 'mousedown', onMouseDownRightTopCorner);\n\t\tEvent.bind(toValue(rightBottomCornerRef), 'mousedown', onMouseDownRightBottomCorner);\n\t\tEvent.bind(toValue(leftTopCornerRef), 'mousedown', onMouseDownLeftTopCorner);\n\t\tEvent.bind(toValue(leftBottomCornerRef), 'mousedown', onMouseDownLeftBottomCorner);\n\t}\n\n\tfunction onUnmounted(): void\n\t{\n\t\tEvent.unbind(toValue(rightSideRef), 'mousedown', onMouseDownRightSide);\n\t\tEvent.unbind(toValue(bottomSideRef), 'mousedown', onMouseDownBottomSide);\n\t\tEvent.unbind(toValue(leftSideRef), 'mousedown', onMouseDownLeftSide);\n\t\tEvent.unbind(toValue(topSideRef), 'mousedown', onMouseDownTopSide);\n\n\t\tEvent.unbind(toValue(rightTopCornerRef), 'mousedown', onMouseDownRightTopCorner);\n\t\tEvent.unbind(toValue(rightBottomCornerRef), 'mousedown', onMouseDownRightBottomCorner);\n\t\tEvent.unbind(toValue(leftTopCornerRef), 'mousedown', onMouseDownLeftTopCorner);\n\t\tEvent.unbind(toValue(leftBottomCornerRef), 'mousedown', onMouseDownLeftBottomCorner);\n\t}\n\n\tfunction startResize(event: MouseEvent, curType: string): void\n\t{\n\t\tevent.stopPropagation();\n\t\tcursorType.value = curType;\n\t\tresizingBlock.value = { ...toValue(block) };\n\t\tprevBlockX = toValue(block).position.x;\n\t\tprevBlockY = toValue(block).position.y;\n\t\tprevBlockWidth = toValue(block).dimensions.width;\n\t\tprevBlockHeight = toValue(block).dimensions.height;\n\t\tisResize.value = true;\n\t}\n\n\tfunction endResize(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\t\tcursorType.value = 'default';\n\t\tupdateResizableBlock();\n\t\tisResize.value = false;\n\t\tresizingBlock.value = null;\n\t}\n\n\tfunction resizeTopSide(event: MouseEvent): void\n\t{\n\t\tlet newY = event.clientY / toValue(zoom);\n\t\tnewY += toValue(transformY);\n\t\tnewY -= toValue(blockDiagramTop) / toValue(zoom);\n\n\t\tlet newHeight = event.clientY / toValue(zoom);\n\t\tnewHeight += toValue(transformY);\n\t\tnewHeight -= toValue(blockDiagramTop) / toValue(zoom);\n\t\tnewHeight -= prevBlockY + prevBlockHeight;\n\t\tnewHeight = Math.abs(newHeight);\n\n\t\tconst fixedPositionY = prevBlockY + prevBlockHeight - toValue(minHeight);\n\n\t\tresizingBlock.value.position.y = newHeight < toValue(minHeight) || newY >= fixedPositionY\n\t\t\t? fixedPositionY\n\t\t\t: newY;\n\n\t\tresizingBlock.value.dimensions.height = newHeight < toValue(minHeight) || newY >= fixedPositionY\n\t\t\t? toValue(minHeight)\n\t\t\t: newHeight;\n\t}\n\n\tfunction resizeRightSide(event: MouseEvent): void\n\t{\n\t\tlet cursorX = event.clientX / toValue(zoom);\n\t\tcursorX += toValue(transformX);\n\t\tcursorX -= toValue(blockDiagramLeft) / toValue(zoom);\n\n\t\tlet newWidth = prevBlockX;\n\t\tnewWidth -= event.clientX / toValue(zoom);\n\t\tnewWidth -= toValue(transformX);\n\t\tnewWidth -= toValue(blockDiagramLeft) / toValue(zoom);\n\t\tnewWidth = Math.abs(newWidth);\n\n\t\tresizingBlock.value.dimensions.width = newWidth < toValue(minWidth) || cursorX <= prevBlockX\n\t\t\t? toValue(minWidth)\n\t\t\t: newWidth;\n\t}\n\n\tfunction resizeBottomSide(event: MouseEvent): void\n\t{\n\t\tlet cursorX = event.clientY / toValue(zoom);\n\t\tcursorX += toValue(transformY);\n\t\tcursorX -= toValue(blockDiagramTop) / toValue(zoom);\n\n\t\tlet newHeight = event.clientY / toValue(zoom);\n\t\tnewHeight -= prevBlockY;\n\t\tnewHeight += toValue(transformY);\n\t\tnewHeight -= toValue(blockDiagramTop) / toValue(zoom);\n\t\tnewHeight = Math.abs(newHeight);\n\n\t\tresizingBlock.value.dimensions.height = newHeight < toValue(minHeight) || cursorX <= prevBlockY\n\t\t\t? toValue(minHeight)\n\t\t\t: newHeight;\n\t}\n\n\tfunction resizeLeftSide(event: MouseEvent): void\n\t{\n\t\tlet newX = event.clientX / toValue(zoom);\n\t\tnewX += toValue(transformX);\n\t\tnewX -= toValue(blockDiagramLeft) / toValue(zoom);\n\n\t\tlet newWidth = event.clientX / toValue(zoom);\n\t\tnewWidth += toValue(transformX);\n\t\tnewWidth -= toValue(blockDiagramLeft) / toValue(zoom);\n\t\tnewWidth -= (prevBlockX + prevBlockWidth);\n\t\tnewWidth = Math.abs(newWidth);\n\n\t\tconst fixedPositionX = prevBlockX + prevBlockWidth - toValue(minWidth);\n\n\t\tresizingBlock.value.position.x = newWidth < toValue(minWidth) || newX >= fixedPositionX\n\t\t\t? fixedPositionX\n\t\t\t: newX;\n\n\t\tresizingBlock.value.dimensions.width = newWidth < toValue(minWidth) || newX >= fixedPositionX\n\t\t\t? toValue(minWidth)\n\t\t\t: newWidth;\n\t}\n\n\tfunction onMouseDownRightSide(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.EW_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveRightSide);\n\t\tEvent.bind(document, 'mouseup', onMouseUpRightSide);\n\t}\n\n\tfunction onMouseMoveRightSide(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeRightSide(event);\n\t}\n\n\tfunction onMouseUpRightSide(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveRightSide);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpRightSide);\n\t}\n\n\tfunction onMouseDownBottomSide(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NS_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveBottomSide);\n\t\tEvent.bind(document, 'mouseup', onMouseUpBottomSide);\n\t}\n\n\tfunction onMouseMoveBottomSide(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeBottomSide(event);\n\t}\n\n\tfunction onMouseUpBottomSide(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveBottomSide);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpBottomSide);\n\t}\n\n\tfunction onMouseDownLeftSide(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.EW_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveLeftSide);\n\t\tEvent.bind(document, 'mouseup', onMouseUpLeftSide);\n\t}\n\n\tfunction onMouseMoveLeftSide(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeLeftSide(event);\n\t}\n\n\tfunction onMouseUpLeftSide(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveLeftSide);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpLeftSide);\n\t}\n\n\tfunction onMouseDownTopSide(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NS_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveTopSide);\n\t\tEvent.bind(document, 'mouseup', onMouseUpTopSide);\n\t}\n\n\tfunction onMouseMoveTopSide(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeTopSide(event);\n\t}\n\n\tfunction onMouseUpTopSide(event: MouseEvent)\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveTopSide);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpTopSide);\n\t}\n\n\tfunction onMouseDownRightBottomCorner(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NWSE_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveRightBottomCorner);\n\t\tEvent.bind(document, 'mouseup', onMouseUpRightBottomCorner);\n\t}\n\n\tfunction onMouseMoveRightBottomCorner(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeRightSide(event);\n\t\tresizeBottomSide(event);\n\t}\n\n\tfunction onMouseUpRightBottomCorner(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveRightBottomCorner);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpRightBottomCorner);\n\t}\n\n\tfunction onMouseDownRightTopCorner(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NESW_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveRightTopCorner);\n\t\tEvent.bind(document, 'mouseup', onMouseUpRightTopCorner);\n\t}\n\n\tfunction onMouseMoveRightTopCorner(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeTopSide(event);\n\t\tresizeRightSide(event);\n\t}\n\n\tfunction onMouseUpRightTopCorner(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveRightTopCorner);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpRightTopCorner);\n\t}\n\n\tfunction onMouseDownLeftBottomCorner(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NESW_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveLeftBottomCorner);\n\t\tEvent.bind(document, 'mouseup', onMouseUpLeftBottomCorner);\n\t}\n\n\tfunction onMouseMoveLeftBottomCorner(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeLeftSide(event);\n\t\tresizeBottomSide(event);\n\t}\n\n\tfunction onMouseUpLeftBottomCorner(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveLeftBottomCorner);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpLeftBottomCorner);\n\t}\n\n\tfunction onMouseDownLeftTopCorner(event: MouseEvent): void\n\t{\n\t\tstartResize(event, CURSOR_TYPES.NWSE_RESIZE);\n\t\tEvent.bind(document, 'mousemove', onMouseMoveLeftTopCorner);\n\t\tEvent.bind(document, 'mouseup', onMouseUpLeftTopCorner);\n\t}\n\n\tfunction onMouseMoveLeftTopCorner(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\n\t\tif (!toValue(isResize))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tresizeLeftSide(event);\n\t\tresizeTopSide(event);\n\t}\n\n\tfunction onMouseUpLeftTopCorner(event: MouseEvent): void\n\t{\n\t\tendResize(event);\n\t\tEvent.unbind(document, 'mousemove', onMouseMoveLeftTopCorner);\n\t\tEvent.unbind(document, 'mouseup', onMouseUpLeftTopCorner);\n\t}\n\n\treturn {\n\t\tisResize,\n\t\tsizeBlockStyle,\n\t\tonMounted,\n\t\tonUnmounted,\n\t};\n}\n","import { ref, toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\n\ntype Rect = {\n\tx: number,\n\ty: number,\n\twidth: number,\n\theight: number,\n};\n\ntype UseCanvasSelectionParams = {\n\trootRef: ?HTMLElement,\n\ttransformLayoutRef: ?HTMLElement,\n};\n\ntype UseCanvasSelection = {\n\tisSelecting: boolean,\n\tselectionRect: Rect,\n\tstart: MouseEvent,\n\tmove: MouseEvent,\n};\n\nexport function useCanvasSelection(params: UseCanvasSelectionParams): UseCanvasSelection\n{\n\tconst { zoom, setSelectionWorldRect, setSelectionActive, isSelectionActive } = useBlockDiagram();\n\tconst { rootRef, transformLayoutRef } = params;\n\tconst selectionRect = ref({ x: 0, y: 0, width: 0, height: 0 });\n\n\tlet startClientX = 0;\n\tlet startClientY = 0;\n\tlet cachedRootRect = null;\n\tlet cachedLayerRect = null;\n\n\tfunction start(event: MouseEvent): void\n\t{\n\t\tconst root = toValue(rootRef);\n\t\tconst layer = toValue(transformLayoutRef);\n\t\tif (!root || !layer)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tstartClientX = event.clientX;\n\t\tstartClientY = event.clientY;\n\n\t\tcachedRootRect = root.getBoundingClientRect();\n\t\tcachedLayerRect = layer.getBoundingClientRect();\n\n\t\tconst visualStartX = startClientX - cachedRootRect.left;\n\t\tconst visualStartY = startClientY - cachedRootRect.top;\n\n\t\tsetSelectionActive(true);\n\t\tselectionRect.value = { x: visualStartX, y: visualStartY, width: 0, height: 0 };\n\t}\n\n\tfunction move(event: MouseEvent): void\n\t{\n\t\tif (!toValue(isSelectionActive) || !cachedRootRect || !cachedLayerRect)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst root = toValue(rootRef);\n\t\tconst layer = toValue(transformLayoutRef);\n\t\tconst currentZoom = toValue(zoom);\n\n\t\tif (!root || !layer || !currentZoom)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst visualStartX = startClientX - cachedRootRect.left;\n\t\tconst visualStartY = startClientY - cachedRootRect.top;\n\t\tconst currentVisualX = event.clientX - cachedRootRect.left;\n\t\tconst currentVisualY = event.clientY - cachedRootRect.top;\n\n\t\tselectionRect.value = {\n\t\t\tx: Math.min(visualStartX, currentVisualX),\n\t\t\ty: Math.min(visualStartY, currentVisualY),\n\t\t\twidth: Math.abs(currentVisualX - visualStartX),\n\t\t\theight: Math.abs(currentVisualY - visualStartY),\n\t\t};\n\n\t\tconst startLayerX = startClientX - cachedLayerRect.left;\n\t\tconst startLayerY = startClientY - cachedLayerRect.top;\n\t\tconst currentLayerX = event.clientX - cachedLayerRect.left;\n\t\tconst currentLayerY = event.clientY - cachedLayerRect.top;\n\n\t\tsetSelectionWorldRect({\n\t\t\tx: Math.min(startLayerX, currentLayerX) / currentZoom,\n\t\t\ty: Math.min(startLayerY, currentLayerY) / currentZoom,\n\t\t\twidth: Math.abs(currentLayerX - startLayerX) / currentZoom,\n\t\t\theight: Math.abs(currentLayerY - startLayerY) / currentZoom,\n\t\t});\n\t}\n\n\tfunction end(): void\n\t{\n\t\tif (toValue(isSelectionActive))\n\t\t{\n\t\t\tsetSelectionActive(false);\n\t\t\tsetSelectionWorldRect(null);\n\t\t\tselectionRect.value = { x: 0, y: 0, width: 0, height: 0 };\n\t\t}\n\n\t\tcachedRootRect = null;\n\t\tcachedLayerRect = null;\n\t}\n\n\treturn {\n\t\tisSelecting: isSelectionActive,\n\t\tselectionRect,\n\t\tstart,\n\t\tmove,\n\t\tend,\n\t};\n}\n","import { Event } from 'main.core';\nimport { toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\n\ntype UseGroupDragLogic = {\n\tonGroupMouseDown: MouseEvent;\n};\n\nexport function useGroupDragLogic(\n\tcloseContextMenu: () => void,\n): UseGroupDragLogic\n{\n\tconst {\n\t\tblocks: uiBlocksRef,\n\t\tzoom,\n\t\tupdateBlock,\n\t\tsetPortOffsetByBlockId,\n\t\thighlitedBlockIds,\n\t} = useBlockDiagram();\n\n\tlet checkBoxDragStartX = 0;\n\tlet checkBoxDragStartY = 0;\n\tlet lastDeltaX = 0;\n\tlet lastDeltaY = 0;\n\tlet movingItems = [];\n\n\tfunction onGroupMouseDown(event: MouseEvent): void\n\t{\n\t\tevent.stopPropagation();\n\t\tcloseContextMenu();\n\t\tif (event.button !== 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcheckBoxDragStartX = event.clientX;\n\t\tcheckBoxDragStartY = event.clientY;\n\t\tlastDeltaX = 0;\n\t\tlastDeltaY = 0;\n\n\t\tmovingItems = [];\n\t\tconst ids = toValue(highlitedBlockIds);\n\t\tconst blocks = toValue(uiBlocksRef);\n\n\t\tids.forEach((id) => {\n\t\t\tconst block = blocks.find((item) => item.id === id);\n\t\t\tif (block)\n\t\t\t{\n\t\t\t\tmovingItems.push({\n\t\t\t\t\tblock,\n\t\t\t\t\tstartX: Number(block.position.x),\n\t\t\t\t\tstartY: Number(block.position.y),\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tEvent.bind(window, 'mousemove', onGroupMouseMove);\n\t\tEvent.bind(window, 'mouseup', onGroupMouseUp);\n\t}\n\n\tfunction onGroupMouseMove(event: MouseEvent): void\n\t{\n\t\tevent.preventDefault();\n\n\t\tconst currentZoom = toValue(zoom);\n\t\tif (!currentZoom)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst totalDeltaX = (event.clientX - checkBoxDragStartX) / currentZoom;\n\t\tconst totalDeltaY = (event.clientY - checkBoxDragStartY) / currentZoom;\n\n\t\tconst stepX = totalDeltaX - lastDeltaX;\n\t\tconst stepY = totalDeltaY - lastDeltaY;\n\t\tlastDeltaX = totalDeltaX;\n\t\tlastDeltaY = totalDeltaY;\n\n\t\tfor (const item of movingItems)\n\t\t{\n\t\t\tconst { block, startX, startY } = item;\n\n\t\t\tblock.position.x = startX + totalDeltaX;\n\t\t\tblock.position.y = startY + totalDeltaY;\n\n\t\t\tif (setPortOffsetByBlockId)\n\t\t\t{\n\t\t\t\tsetPortOffsetByBlockId(block.id, { x: -stepX, y: -stepY });\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction onGroupMouseUp(): void\n\t{\n\t\tEvent.unbind(window, 'mousemove', onGroupMouseMove);\n\t\tEvent.unbind(window, 'mouseup', onGroupMouseUp);\n\n\t\tfor (const item of movingItems)\n\t\t{\n\t\t\tconst { block } = item;\n\n\t\t\tblock.position.x = Math.round(block.position.x);\n\t\t\tblock.position.y = Math.round(block.position.y);\n\n\t\t\tif (setPortOffsetByBlockId)\n\t\t\t{\n\t\t\t\tsetPortOffsetByBlockId(block.id, { x: 0, y: 0 });\n\t\t\t}\n\n\t\t\tupdateBlock({ ...block });\n\t\t}\n\n\t\tmovingItems = [];\n\t}\n\n\treturn { onGroupMouseDown };\n}\n","import { Type } from 'main.core';\nimport { computed, toValue } from 'ui.vue3';\nimport { useBlockDiagram } from './block-diagram';\n\ntype UseGroupSelectionLogic = {\n\tonCanvasSelect: ?{ x: number, y: number, width: number, height: number },\n\tonSelectionStart: Function,\n\tgroupSelectionStyle: {\n\t\tleft: string,\n\t\ttop: string,\n\t\twidth: string,\n\t\theight: string,\n\t},\n};\n\ntype PaddingConfig = {\n\ttop: number,\n\tright: number,\n\tbottom: number,\n\tleft: number,\n};\n\ntype DefaultBlockSize = {\n\twidth: number,\n\theight: number,\n};\n\ntype UseGroupSelectionLogicOptions = {\n\tpadding?: number | PaddingConfig,\n\tdefaultBlockSize?: DefaultBlockSize,\n};\n\nexport function useGroupSelectionLogic(closeContextMenu, options: UseGroupSelectionLogicOptions): UseGroupSelectionLogic\n{\n\tconst {\n\t\tblocks: uiBlocksRef,\n\t\ttransformLayoutRef,\n\t\thighlitedBlockIds,\n\t\tsetSelectionActive,\n\t\tisSelectionActive,\n\t} = useBlockDiagram();\n\n\tconst width = options.defaultBlockSize.width;\n\tconst height = options.defaultBlockSize.height;\n\n\tconst getBlockDimensions = (block, container) => {\n\t\tlet w = block.dimensions?.width;\n\t\tlet h = block.dimensions?.height;\n\n\t\tif (!w || !h)\n\t\t{\n\t\t\tconst el = container?.querySelector(`[data-id=\"${block.id}\"]`);\n\t\t\tif (el)\n\t\t\t{\n\t\t\t\tw = el.offsetWidth;\n\t\t\t\th = el.offsetHeight;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tw = width;\n\t\t\t\th = height;\n\t\t\t}\n\t\t}\n\n\t\treturn { w, h };\n\t};\n\n\tconst getSelectionBoxPadding = (): PaddingConfig => {\n\t\tconst pad = options.padding;\n\n\t\tif (Type.isNumber(pad))\n\t\t{\n\t\t\treturn { top: pad, right: pad, bottom: pad, left: pad };\n\t\t}\n\n\t\treturn {\n\t\t\ttop: pad.top,\n\t\t\tright: pad.right,\n\t\t\tbottom: pad.bottom,\n\t\t\tleft: pad.left,\n\t\t};\n\t};\n\n\tfunction onCanvasSelect(worldRect): void\n\t{\n\t\tif (!worldRect)\n\t\t{\n\t\t\tsetSelectionActive(false);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst blocks = toValue(uiBlocksRef);\n\t\tconst container = toValue(transformLayoutRef);\n\n\t\tconst intersectingIds = new Set();\n\n\t\tblocks.forEach((block) => {\n\t\t\tconst { x, y } = block.position;\n\t\t\tconst { w, h } = getBlockDimensions(block, container);\n\n\t\t\tconst isIntersecting = worldRect.x < x + w\n\t\t\t\t&& worldRect.x + worldRect.width > x\n\t\t\t\t&& worldRect.y < y + h\n\t\t\t\t&& worldRect.y + worldRect.height > y;\n\n\t\t\tif (isIntersecting)\n\t\t\t{\n\t\t\t\tintersectingIds.add(block.id);\n\t\t\t}\n\t\t});\n\n\t\tconst currentIds = toValue(highlitedBlockIds) || [];\n\t\tconst nextIds = currentIds.filter((id) => intersectingIds.has(id));\n\n\t\tintersectingIds.forEach((id) => {\n\t\t\tif (!nextIds.includes(id))\n\t\t\t{\n\t\t\t\tnextIds.push(id);\n\t\t\t}\n\t\t});\n\n\t\thighlitedBlockIds.value = nextIds;\n\t}\n\n\tfunction onSelectionStart(): void\n\t{\n\t\tsetSelectionActive(true);\n\t\tcloseContextMenu();\n\t\thighlitedBlockIds.value = [];\n\t}\n\n\tconst groupSelectionStyle = computed(() => {\n\t\tif (toValue(isSelectionActive))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst ids = toValue(highlitedBlockIds) || [];\n\n\t\tif (ids.length <= 1)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet minX = Infinity;\n\t\tlet minY = Infinity;\n\t\tlet maxX = -Infinity;\n\t\tlet maxY = -Infinity;\n\t\tlet hasBlocks = false;\n\t\tconst blocks = toValue(uiBlocksRef);\n\t\tconst container = toValue(transformLayoutRef);\n\n\t\tids.forEach((id) => {\n\t\t\tconst block = blocks.find((item) => item.id === id);\n\t\t\tif (block)\n\t\t\t{\n\t\t\t\thasBlocks = true;\n\t\t\t\tconst { x, y } = block.position;\n\t\t\t\tconst { w, h } = getBlockDimensions(block, container);\n\n\t\t\t\tminX = Math.min(minX, x);\n\t\t\t\tminY = Math.min(minY, y);\n\t\t\t\tmaxX = Math.max(maxX, x + w);\n\t\t\t\tmaxY = Math.max(maxY, y + h);\n\t\t\t}\n\t\t});\n\n\t\tif (!hasBlocks)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst padding = getSelectionBoxPadding();\n\n\t\treturn {\n\t\t\tleft: `${minX - padding.left}px`,\n\t\t\ttop: `${minY - padding.top}px`,\n\t\t\twidth: `${maxX - minX + padding.left + padding.right}px`,\n\t\t\theight: `${maxY - minY + padding.top + padding.bottom}px`,\n\t\t};\n\t});\n\n\treturn {\n\t\tonCanvasSelect,\n\t\tonSelectionStart,\n\t\tgroupSelectionStyle,\n\t};\n}\n","import {\n\tcomputed,\n\ttoValue,\n\tuseTemplateRef,\n\tonMounted,\n\tonUnmounted,\n\tref,\n} from 'ui.vue3';\nimport { Event } from 'main.core';\nimport { useCanvasTransfrom, useCanvasSelection, type UseCanvasTransform } from '../../composables';\nimport './canvas-transform.css';\n\ntype CanvasTransformSetup = {\n\trootRef: ?HTMLElement,\n\tcanvasRef: ?HTMLElement,\n\ttransformLayoutRef: ?HTMLElement,\n\tcanvasTransformClassNames: { [key: string]: boolean },\n\tonMouseDown: Pick<UseCanvasTransform, 'onMouseDown'>,\n\tonMouseMove: Pick<UseCanvasTransform, 'onMouseMove'>,\n\tonMouseUp: Pick<UseCanvasTransform, 'onMouseUp'>,\n\tonWheel: Pick<UseCanvasTransform, 'onWheel'>,\n\tisSelecting: boolean,\n\tselectionRect: { x: number, y: number, width: number, height: number },\n\topenContextMenu: (event: MouseEvent) => void,\n};\n\nconst CANVAS_TRANSFORM_CLASS_NAMES = {\n\tbase: 'ui-block-diagram-canvas-transform',\n\tdragging: '--dragging',\n\tgrabbing: '--grabbing',\n\tgrab: '--grab',\n};\n\nconst KEY_SPACE = 'Space';\nconst INPUT_TAGS = Object.freeze({\n\tINPUT: true,\n\tTEXTAREA: true,\n\tSELECT: true,\n});\n\n// @vue/component\nexport const CanvasTransform = {\n\tname: 'canvas-transform',\n\tprops: {\n\t\tcanvasStyle: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tzoomSensitivity: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.01,\n\t\t},\n\t\tzoomSensitivityMouse: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.04,\n\t\t},\n\t\tselectionEnabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t},\n\temits: ['openContextMenu'],\n\tsetup(props, { emit }): CanvasTransformSetup\n\t{\n\t\tconst rootRef = useTemplateRef('rootRef');\n\t\tconst canvasRef = useTemplateRef('canvasLayout');\n\t\tconst transformLayoutRef = useTemplateRef('transformLayout');\n\n\t\tconst isSpacePressed = ref(false);\n\t\tconst isPanning = ref(false);\n\n\t\tconst {\n\t\t\tisDragging,\n\t\t\tonMounted: onMountedCanvasTransform,\n\t\t\tonUnmounted: onUnmountedCanvasTransform,\n\t\t\tonMouseDown: onPanStart,\n\t\t\tonMouseMove: onPanMove,\n\t\t\tonMouseUp: onPanEnd,\n\t\t\tonWheel,\n\t\t} = useCanvasTransfrom({\n\t\t\tcanvasRef,\n\t\t\ttransformLayoutRef,\n\t\t\tcanvasStyle: props.canvasStyle,\n\t\t\tzoomSensitivity: props.zoomSensitivity,\n\t\t\tzoomSensitivityMouse: props.zoomSensitivityMouse,\n\t\t});\n\n\t\tconst {\n\t\t\tisSelecting,\n\t\t\tselectionRect,\n\t\t\tstart: onSelectionStart,\n\t\t\tmove: onSelectionMove,\n\t\t\tend: onSelectionEnd,\n\t\t} = useCanvasSelection({\n\t\t\trootRef,\n\t\t\ttransformLayoutRef,\n\t\t});\n\n\t\tconst canvasTransformClassNames = computed((): { [string]: boolean } => ({\n\t\t\t[CANVAS_TRANSFORM_CLASS_NAMES.base]: true,\n\t\t\t[CANVAS_TRANSFORM_CLASS_NAMES.dragging]: toValue(isDragging),\n\t\t\t[CANVAS_TRANSFORM_CLASS_NAMES.grabbing]: toValue(isPanning),\n\t\t\t[CANVAS_TRANSFORM_CLASS_NAMES.grab]: toValue(isSpacePressed) && !toValue(isPanning),\n\t\t}));\n\n\t\tonMounted(() => {\n\t\t\tonMountedCanvasTransform();\n\t\t\tEvent.bind(window, 'keydown', onKeyDown);\n\t\t\tEvent.bind(window, 'keyup', onKeyUp);\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\tonUnmountedCanvasTransform();\n\t\t\tEvent.unbind(window, 'keydown', onKeyDown);\n\t\t\tEvent.unbind(window, 'keyup', onKeyUp);\n\t\t});\n\n\t\tfunction onMouseDown(event: MouseEvent): void\n\t\t{\n\t\t\tif (event.button === 2)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst isMiddleClick = event.button === 1;\n\t\t\tconst isLeftClick = event.button === 0;\n\t\t\tconst isSpace = toValue(isSpacePressed);\n\t\t\tconst shouldPan = isMiddleClick || (isLeftClick && (isSpace || !props.selectionEnabled));\n\t\t\tconst shouldSelect = isLeftClick && !isSpace && props.selectionEnabled;\n\n\t\t\tif (shouldPan)\n\t\t\t{\n\t\t\t\tif (toValue(isSelecting))\n\t\t\t\t{\n\t\t\t\t\tonSelectionEnd();\n\t\t\t\t}\n\n\t\t\t\tisPanning.value = true;\n\n\t\t\t\tif (isMiddleClick || (isLeftClick && !props.selectionEnabled))\n\t\t\t\t{\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\n\t\t\t\tonPanStart(event);\n\t\t\t}\n\t\t\telse if (shouldSelect)\n\t\t\t{\n\t\t\t\tisPanning.value = false;\n\t\t\t\tevent.preventDefault();\n\t\t\t\tonSelectionStart(event);\n\t\t\t}\n\t\t}\n\n\t\tfunction onMouseMove(event: MouseEvent): void\n\t\t{\n\t\t\tif (toValue(isSelecting) && toValue(isSpacePressed))\n\t\t\t{\n\t\t\t\tonSelectionEnd();\n\t\t\t\tisPanning.value = true;\n\t\t\t\tonPanStart(event);\n\t\t\t}\n\n\t\t\tif (toValue(isSelecting))\n\t\t\t{\n\t\t\t\tonSelectionMove(event);\n\t\t\t}\n\t\t\telse if (toValue(isPanning))\n\t\t\t{\n\t\t\t\tonPanMove(event);\n\t\t\t}\n\t\t}\n\n\t\tfunction onMouseUp(): void\n\t\t{\n\t\t\tif (toValue(isSelecting))\n\t\t\t{\n\t\t\t\tonSelectionEnd();\n\t\t\t}\n\n\t\t\tif (toValue(isPanning))\n\t\t\t{\n\t\t\t\tisPanning.value = false;\n\t\t\t\tonPanEnd();\n\t\t\t}\n\t\t}\n\n\t\tconst onKeyDown = (event: KeyboardEvent) => {\n\t\t\tif (event.code !== KEY_SPACE)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (event.repeat)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst target = event.target;\n\t\t\tconst isInputActive = (target.tagName in INPUT_TAGS) || target.isContentEditable;\n\n\t\t\tif (isInputActive)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisSpacePressed.value = true;\n\t\t};\n\n\t\tconst onKeyUp = (event: KeyboardEvent) => {\n\t\t\tif (event.code === KEY_SPACE)\n\t\t\t{\n\t\t\t\tisSpacePressed.value = false;\n\t\t\t}\n\t\t};\n\n\t\tfunction openContextMenu(event: MouseEvent): void\n\t\t{\n\t\t\tif (\n\t\t\t\tevent.target === toValue(canvasRef)\n\t\t\t\t|| event.target?.parentElement === toValue(transformLayoutRef)\n\t\t\t)\n\t\t\t{\n\t\t\t\temit('openContextMenu', event);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\trootRef,\n\t\t\tcanvasRef,\n\t\t\ttransformLayoutRef,\n\t\t\tcanvasTransformClassNames,\n\t\t\tonMouseDown,\n\t\t\tonMouseMove,\n\t\t\tonMouseUp,\n\t\t\tonWheel,\n\t\t\topenContextMenu,\n\t\t\tisSelecting,\n\t\t\tselectionRect,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tref=\"rootRef\"\n\t\t\t:class=\"canvasTransformClassNames\"\n\t\t\t@mousedown=\"onMouseDown\"\n\t\t\t@mousemove=\"onMouseMove\"\n\t\t\t@mouseup=\"onMouseUp\"\n\t\t\t@wheel=\"onWheel\"\n\t\t\t@contextmenu.prevent=\"openContextMenu\"\n\t\t>\n\t\t\t<canvas\n\t\t\t\tref=\"canvasLayout\"\n\t\t\t\tclass=\"ui-block-diagram-canvas-transform__canvas\"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tref=\"transformLayout\"\n\t\t\t\tclass=\"ui-block-diagram-canvas-transform__transform\"\n\t\t\t>\n\t\t\t\t<slot/>\n\t\t\t</div>\n\t\t\t<div v-if=\"isSelecting\" class=\"ui-block-diagram-selection-rect\"\n\t\t\t\t :style=\"{\n\t\t\t\t\tleft: selectionRect.x + 'px',\n\t\t\t\t\ttop: selectionRect.y + 'px',\n\t\t\t\t\twidth: selectionRect.width + 'px',\n\t\t\t\t\theight: selectionRect.height + 'px'\n\t\t\t\t}\"\n\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { computed, toValue } from 'ui.vue3';\nimport {\n\tuseConnectionState,\n\tuseContextMenu,\n\tuseBlockDiagram,\n\tuseLoc,\n} from '../../composables';\nimport './connection.css';\nimport type { UseConnectionState } from '../../composables';\n\ntype ConnectionSetup = {\n\tconnectionPathInfo: Pick<UseConnectionState, 'connectionPathInfo'>;\n\ttargetConnectionClasses: { [string]: boolean };\n\tbarStyle: { [string]: string };\n\tonOpenContextMenu: () => void;\n}\n\nconst TARGET_CONNECTION_CLASSES = {\n\tbase: 'ui-block-diagram-connection__target',\n\tactive: '--active',\n};\n\n// @vue/component\nexport const Connection = {\n\tname: 'diagram-connection',\n\tprops: {\n\t\t/** @type DiagramConnection */\n\t\tconnection: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tbarWidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 22,\n\t\t},\n\t\tbarHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 22,\n\t\t},\n\t\tcontextMenuItems: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): ConnectionSetup\n\t{\n\t\tconst {\n\t\t\tconnectionPathInfo,\n\t\t\tisDisabled,\n\t\t} = useConnectionState(props.connection);\n\t\tconst { deleteConnectionById } = useBlockDiagram();\n\t\tconst loc = useLoc();\n\t\tconst { isOpen, showContextMenu } = useContextMenu([\n\t\t\t{\n\t\t\t\tid: 'deleteConnection',\n\t\t\t\ttext: loc.getMessage('UI_BLOCK_DIAGRAM_DELETE_CONNECTION_CONTEXT_MENU_ITEM'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tdeleteConnectionById(props.connection.id);\n\t\t\t\t},\n\t\t\t},\n\t\t]);\n\n\t\tconst targetConnectionClasses = computed((): { [string]: boolean } => ({\n\t\t\t[TARGET_CONNECTION_CLASSES.base]: true,\n\t\t\t[TARGET_CONNECTION_CLASSES.active]: toValue(isOpen),\n\t\t}));\n\n\t\tconst barPosition = computed((): { [string]: number } => {\n\t\t\tconst { x: centerX = 0, y: centerY = 0 } = toValue(connectionPathInfo).center ?? {};\n\n\t\t\treturn {\n\t\t\t\tx: centerX - (props.barWidth / 2),\n\t\t\t\ty: centerY - (props.barHeight / 2),\n\t\t\t};\n\t\t});\n\n\t\tfunction onOpenContextMenu(event: MouseEvent): void\n\t\t{\n\t\t\tif (toValue(isDisabled) || props.disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\t\t\tshowContextMenu(event);\n\t\t}\n\n\t\treturn {\n\t\t\tisDisabled,\n\t\t\tconnectionPathInfo,\n\t\t\ttargetConnectionClasses,\n\t\t\tbarPosition,\n\t\t\tonOpenContextMenu,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<svg class=\"ui-block-diagram-connection\">\n\t\t\t<g class=\"ui-block-diagram-connection__group\">\n\t\t\t\t<path\n\t\t\t\t\t:d=\"connectionPathInfo.path\"\n\t\t\t\t\t:class=\"targetConnectionClasses\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('connectionLine', connection.id)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\t:d=\"connectionPathInfo.path\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('connectionHoveredLine', connection.id)\"\n\t\t\t\t\tclass=\"ui-block-diagram-connection__hovered\"\n\t\t\t\t\tstroke=\"transparent\"\n\t\t\t\t\tfill=\"transparent\"\n\t\t\t\t\t@contextmenu=\"onOpenContextMenu\"\n\t\t\t\t/>\n\t\t\t\t<foreignObject\n\t\t\t\t\t:x=\"barPosition.x\"\n\t\t\t\t\t:y=\"barPosition.y\"\n\t\t\t\t\t:width=\"barWidth\"\n\t\t\t\t\t:height=\"barHeight\"\n\t\t\t\t\tclass=\"ui-block-diagram-connection__bar\"\n\t\t\t\t>\n\t\t\t\t\t<slot :isDisabled=\"isDisabled || disabled\" />\n\t\t\t\t</foreignObject>\n\t\t\t</g>\n\t\t</svg>\n\t`,\n};\n","import './delete-connection-btn.css';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { useBlockDiagram } from '../../composables';\n\ntype DeleteConnectionBtnSetup = {\n\ticonSet: string,\n\tonDeleteConnection: () => void,\n};\n\n// @vue/component\nexport const DeleteConnectionBtn = {\n\tname: 'delete-connection-btn',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\tconnectionId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): DeleteConnectionBtnSetup\n\t{\n\t\tconst { deleteConnectionById } = useBlockDiagram();\n\n\t\tfunction onDeleteConnection(): void\n\t\t{\n\t\t\tif (props.disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdeleteConnectionById(props.connectionId);\n\t\t}\n\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t\tonDeleteConnection,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\tclass=\"ui-block-diagram-delete-connection-btn\"\n\t\t\t:data-test-id=\"$blockDiagramTestId('connectionDeleteBtn', connectionId)\"\n\t\t\t@click=\"onDeleteConnection\"\n\t\t>\n\t\t\t<div class=\"ui-block-diagram-delete-connection-btn__icon-wrap\">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"iconSet.TRASHCAN\"\n\t\t\t\t\t:size=\"14\"\n\t\t\t\t\tclass=\"ui-block-diagram-delete-connection-btn__icon\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</button>\n\t`,\n};\n","import './context-menu-layout.css';\nimport { computed, toValue } from 'ui.vue3';\nimport { useBlockDiagram } from '../../composables';\nimport type { UseBlockDiagran } from '../../composables';\n\nexport type ContextMenuLayoutSetup = {\n\tinstance: UseBlockDiagran,\n\ttargetContainerStyle: { [string]: string },\n};\n\n// @vue/component\nexport const ContextMenuLayout = {\n\tname: 'ContextMenuLayout',\n\tsetup(): ContextMenuLayoutSetup\n\t{\n\t\tconst instance = useBlockDiagram();\n\n\t\tconst targetContainerStyle = computed(() => ({\n\t\t\ttop: `${toValue(instance.positionContextMenu).top}px`,\n\t\t\tleft: `${toValue(instance.positionContextMenu).left}px`,\n\t\t}));\n\n\t\treturn {\n\t\t\tinstance,\n\t\t\ttargetContainerStyle,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:ref=\"instance.contextMenuLayerRef\"\n\t\t\tclass=\"ui-block-diagram-context-menu__layout\"\n\t\t>\n\t\t\t<slot/>\n\t\t\t<div\n\t\t\t\t:ref=\"instance.targetContainerRef\"\n\t\t\t\t:style=\"targetContainerStyle\"\n\t\t\t\tclass=\"ui-block-diagram-context-menu__target-container\"\n\t\t\t\t@mousedown.stop\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import './blocks-queue-transition.css';\nimport { toValue } from 'ui.vue3';\nimport { useBlockDiagram, useCanvas, useHistory, useHighlightedBlocks } from '../../composables';\n\ntype BlocksQueueTransitionSetup = {\n\tisAnimate: boolean;\n\tonEnter: () => void;\n\tonAfterEnter: () => void;\n\tonBeforeEnter: () => void;\n\tonAfterLeave: () => void;\n};\n\n// @vue/component\nexport const BlocksQueueTransition = {\n\tname: 'blocks-queue-transition',\n\tsetup(): BlocksQueueTransitionSetup\n\t{\n\t\tconst {\n\t\t\tisAnimate,\n\t\t\tcurrentAnimationItem,\n\t\t\tanimationQueue,\n\t\t\thooks,\n\t\t} = useBlockDiagram();\n\t\tconst canvas = useCanvas();\n\t\tconst history = useHistory();\n\t\tconst highlighted = useHighlightedBlocks();\n\n\t\tfunction nextAnimationItem()\n\t\t{\n\t\t\tconst { done = false } = toValue(animationQueue)?.next() ?? {};\n\n\t\t\tif (done)\n\t\t\t{\n\t\t\t\tanimationQueue.value = null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thistory.makeSnapshot();\n\t\t\t}\n\t\t}\n\n\t\tfunction onBeforeEnter(): void\n\t\t{\n\t\t\thooks.blockTransitionStart.trigger(toValue(currentAnimationItem)?.item);\n\t\t}\n\n\t\tfunction onEnter(): void\n\t\t{\n\t\t\thighlighted.clear();\n\t\t\thighlighted.add(toValue(currentAnimationItem).item.id);\n\t\t\tcanvas.goToBlockById(toValue(currentAnimationItem).item.id);\n\t\t}\n\n\t\tfunction onAfterEnter(): void\n\t\t{\n\t\t\thooks.blockTransitionEnd.trigger(toValue(currentAnimationItem)?.item);\n\t\t\tnextAnimationItem();\n\t\t}\n\n\t\tfunction onAfterLeave(): void\n\t\t{\n\t\t\tnextAnimationItem();\n\t\t}\n\n\t\treturn {\n\t\t\tisAnimate,\n\t\t\tonBeforeEnter,\n\t\t\tonEnter,\n\t\t\tonAfterEnter,\n\t\t\tonAfterLeave,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<TransitionGroup\n\t\t\tv-if=\"isAnimate\"\n\t\t\tname=\"ui-block-diagram-blocks-queue-transition\"\n\t\t\t@before-enter=\"onBeforeEnter\"\n\t\t\t@enter=\"onEnter\"\n\t\t\t@after-enter=\"onAfterEnter\"\n\t\t\t@after-leave=\"onAfterLeave\"\n\t\t>\n\t\t\t<slot/>\n\t\t</TransitionGroup>\n\t\t<template v-else>\n\t\t\t<slot/>\n\t\t</template>\n\t`,\n};\n","import './grouped-blocks.css';\nimport { useBlockDiagram } from '../../composables';\nimport { getGroupBlockSlotName } from '../../utils';\nimport { BlocksQueueTransition } from '../blocks-queue-transition/blocks-queue-transition';\nimport type {\n\tGroupedBlocks as TGroupedBlocks,\n\tBlockGroupNames,\n} from '../../types';\n\ntype GroupedBlocksSetup = {\n\tblockGroupNames: BlockGroupNames;\n\tgroupedBlocks: TGroupedBlocks;\n\tgetGroupBlockSlotName: typeof getGroupBlockSlotName;\n};\n\n// @vue/component\nexport const GroupedBlocks = {\n\tname: 'grouped-blocks',\n\tcomponents: {\n\t\tBlocksQueueTransition,\n\t},\n\tsetup(): GroupedBlocksSetup\n\t{\n\t\tconst { groupedBlocks, blockGroupNames } = useBlockDiagram();\n\n\t\treturn {\n\t\t\tblockGroupNames,\n\t\t\tgroupedBlocks,\n\t\t\tgetGroupBlockSlotName,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<BlocksQueueTransition>\n\t\t\t<slot\n\t\t\t\tv-for=\"group in blockGroupNames\"\n\t\t\t\t:key=\"group\"\n\t\t\t\t:name=\"getGroupBlockSlotName(group)\"\n\t\t\t\t:blocks=\"groupedBlocks[group]\"\n\t\t\t/>\n\t\t</BlocksQueueTransition>\n\t`,\n};\n","import { computed, toValue } from 'ui.vue3';\nimport { useNewConnectionState } from '../../composables';\nimport type { UseNewConnectionState } from '../../composables';\nimport './new-connection.css';\n\ntype NewConnectionSetup = {\n\thasNewConnection: boolean;\n\tnewConnectionPathInfo: Pick<UseNewConnectionState, 'newConnectionPathInfo'>;\n};\n\nconst PATH_CLASS_NAMES = {\n\tbase: 'ui-block-diagram-new-connection__path',\n\terror: '--error',\n};\n\n// @vue/component\nexport const NewConnection = {\n\tname: 'NewConnection',\n\tsetup(props): NewConnectionSetup\n\t{\n\t\tconst {\n\t\t\thasNewConnection,\n\t\t\tnewConnectionPathInfo,\n\t\t\tisValid,\n\t\t} = useNewConnectionState();\n\n\t\tconst pathClassNames = computed((): { [string]: boolean } => ({\n\t\t\t[PATH_CLASS_NAMES.base]: true,\n\t\t\t[PATH_CLASS_NAMES.error]: !toValue(isValid),\n\t\t}));\n\n\t\treturn {\n\t\t\thasNewConnection,\n\t\t\tnewConnectionPathInfo,\n\t\t\tpathClassNames,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<svg\n\t\t\tv-if=\"hasNewConnection\"\n\t\t\tclass=\"ui-block-diagram-new-connection\"\n\t\t>\n\t\t\t<path\n\t\t\t\t:d=\"newConnectionPathInfo.path\"\n\t\t\t\t:class=\"pathClassNames\"\n\t\t\t/>\n\t\t</svg>\n\t`,\n};\n","import './connections-queue-transition.css';\nimport { toValue } from 'ui.vue3';\nimport { useBlockDiagram, useHistory } from '../../composables';\n\ntype ConnectionsQueueTransitionSetup = {\n\tisAnimate: boolean;\n\tonBeforeEnter: () => void;\n\tonAfterEnter: () => void;\n\tonAfterLeave: () => void;\n};\n\n// @vue/component\nexport const ConnectionsQueueTransition = {\n\tname: 'connections-queue-transition',\n\tsetup(): ConnectionsQueueTransitionSetup\n\t{\n\t\tconst {\n\t\t\tisAnimate,\n\t\t\tcurrentAnimationItem,\n\t\t\tanimationQueue,\n\t\t\tupdatePortPosition,\n\t\t\thooks,\n\t\t} = useBlockDiagram();\n\t\tconst history = useHistory();\n\n\t\tfunction onBeforeEnter(): void\n\t\t{\n\t\t\tconst { item: connection } = toValue(currentAnimationItem) ?? {};\n\t\t\thooks.connectionTransitionStart.trigger(connection);\n\t\t\tconst {\n\t\t\t\tsourceBlockId,\n\t\t\t\tsourcePortId,\n\t\t\t\ttargetBlockId,\n\t\t\t\ttargetPortId,\n\t\t\t} = connection;\n\n\t\t\tupdatePortPosition(sourceBlockId, sourcePortId);\n\t\t\tupdatePortPosition(targetBlockId, targetPortId);\n\t\t}\n\n\t\tfunction nextAnimatedItem(): void\n\t\t{\n\t\t\tconst { done = false } = toValue(animationQueue)?.next() ?? {};\n\n\t\t\tif (done)\n\t\t\t{\n\t\t\t\tanimationQueue.value = null;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thistory.makeSnapshot();\n\t\t\t}\n\t\t}\n\n\t\tfunction onAfterEnter(): void\n\t\t{\n\t\t\thooks.connectionTransitionEnd.trigger(toValue(currentAnimationItem)?.item);\n\t\t\tnextAnimatedItem();\n\t\t}\n\n\t\tfunction onAfterLeave(): void\n\t\t{\n\t\t\tnextAnimatedItem();\n\t\t}\n\n\t\treturn {\n\t\t\tisAnimate,\n\t\t\tonBeforeEnter,\n\t\t\tonAfterEnter,\n\t\t\tonAfterLeave,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<TransitionGroup\n\t\t\tv-if=\"isAnimate\"\n\t\t\tname=\"ui-block-diagram-connections-queue-transition\"\n\t\t\t@before-enter=\"onBeforeEnter\"\n\t\t\t@after-enter=\"onAfterEnter\"\n\t\t\t@after-leave=\"onAfterLeave\"\n\t\t>\n\t\t\t<slot/>\n\t\t</TransitionGroup>\n\t\t<template v-else>\n\t\t\t<slot/>\n\t\t</template>\n\t`,\n};\n","import './grouped-connections.css';\nimport { useBlockDiagram } from '../../composables';\nimport { Connection } from '../connection/connection';\nimport { NewConnection } from '../new-connection/new-connection';\nimport { ConnectionsQueueTransition } from '../connections-queue-transition/connections-queue-transition';\nimport { getGroupConnectionSlotName } from '../../utils';\nimport type {\n\tGroupedConnections as TGroupedConnections,\n\tConnectionGroupNames,\n} from '../../types';\n\ntype GroupedConnectionsSetup = {\n\tgroupedConnections: TGroupedConnections;\n\tconnectionGroupNames: ConnectionGroupNames;\n\tgetGroupConnectionSlotName: typeof getGroupConnectionSlotName;\n};\n\n// @vue/component\nexport const GroupedConnections = {\n\tname: 'grouped-connections',\n\tcomponents: {\n\t\tConnection,\n\t\tNewConnection,\n\t\tConnectionsQueueTransition,\n\t},\n\tsetup(): GroupedConnectionsSetup\n\t{\n\t\tconst {\n\t\t\tgroupedConnections,\n\t\t\tconnectionGroupNames,\n\t\t} = useBlockDiagram();\n\n\t\treturn {\n\t\t\tgroupedConnections,\n\t\t\tconnectionGroupNames,\n\t\t\tgetGroupConnectionSlotName,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<ConnectionsQueueTransition>\n\t\t\t<slot\n\t\t\t\tv-for=\"connection in connectionGroupNames\"\n\t\t\t\t:key=\"connection\"\n\t\t\t\t:name=\"getGroupConnectionSlotName(connection)\"\n\t\t\t\t:connections=\"groupedConnections[connection]\"\n\t\t\t/>\n\t\t\t<NewConnection/>\n\t\t</ConnectionsQueueTransition>\n\t`,\n};\n","import './moveable-block.css';\nimport { toRefs, useTemplateRef, watch, onUnmounted, computed, toValue } from 'ui.vue3';\nimport { useMoveableBlock, useBlockState, useHighlightedBlocks, useBlockDiagram } from '../../composables';\n// eslint-disable-next-line no-unused-vars\nimport type { DiagramBlock } from '../../types';\n\ntype MoveableBlockSetup = {\n\tisDragged: boolean;\n\tisHiglitedBlock: boolean;\n\tblockPositionStyle: { [string]: string };\n\tisDisabled: boolean;\n\tonMouseDownSelectBlock: () => void;\n};\n\n// @vue/component\nexport const MoveableBlock = {\n\tname: 'moveable-block',\n\tprops: {\n\t\t/** @type DiagramBlock */\n\t\tblock: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\thighlighted: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): MoveableBlockSetup\n\t{\n\t\tconst { block } = toRefs(props);\n\t\tconst { isMakeNewConnection } = useBlockDiagram();\n\t\tconst {\n\t\t\tblockZindex,\n\t\t\tisHiglitedBlock,\n\t\t\tisDisabled,\n\t\t} = useBlockState(block);\n\t\tconst highlightedBlocks = useHighlightedBlocks();\n\t\tconst { isDragged, blockPositionStyle } = useMoveableBlock(\n\t\t\tuseTemplateRef('blockEl'),\n\t\t\tblock,\n\t\t);\n\n\t\twatch(() => props.highlighted, (value) => {\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\thighlightedBlocks.add(props.block.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thighlightedBlocks.remove(props.block.id);\n\t\t\t}\n\t\t});\n\n\t\tconst blockStyle = computed((): { [string]: string } => ({\n\t\t\t...toValue(blockPositionStyle),\n\t\t\t...toValue(blockZindex),\n\t\t}));\n\n\t\tonUnmounted(() => {\n\t\t\thighlightedBlocks.remove(props.block.id);\n\t\t});\n\n\t\tfunction onMouseDownSelectBlock(): void\n\t\t{\n\t\t\thighlightedBlocks.clear();\n\t\t\thighlightedBlocks.add(props.block.id);\n\t\t}\n\n\t\treturn {\n\t\t\tisHiglitedBlock,\n\t\t\tisDisabled,\n\t\t\tisDragged,\n\t\t\tisMakeNewConnection,\n\t\t\tblockStyle,\n\t\t\tblockZindex,\n\t\t\tblockPositionStyle,\n\t\t\tonMouseDownSelectBlock,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"ui-block-diagram-moveable-block\"\n\t\t\t:style=\"blockStyle\"\n\t\t\tref=\"blockEl\"\n\t\t\t:data-test-id=\"$blockDiagramTestId('block', block.id)\"\n\t\t\t:data-id=\"block.id\"\n\t\t\t@mousedown=\"onMouseDownSelectBlock\"\n\t\t>\n\t\t\t<slot\n\t\t\t\t:block=\"block\"\n\t\t\t\t:isHighlighted=\"isHiglitedBlock\"\n\t\t\t\t:isDragged=\"isDragged\"\n\t\t\t\t:isDisabled=\"isDisabled\"\n\t\t\t\t:isMakeNewConnection=\"isMakeNewConnection\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import {\n\tuseTemplateRef,\n\tcomputed,\n\ttoValue,\n\tonMounted,\n\tonUnmounted,\n} from 'ui.vue3';\nimport { usePortState, useNewConnection } from '../../composables';\nimport { PORT_POSITION } from '../../constants';\nimport './port.css';\n\ntype PortSetup = {\n\tportClassNames: { [string]: boolean },\n\tonMouseDownPort: (event: MouseEvent) => void;\n\tonMouseOverPort: () => void;\n\tonMouseLeavePort: () => void;\n};\n\nconst PORT_CLASS_NAMES = {\n\tbase: 'ui-block-diagram-port',\n\tdisabled: '--disabled',\n\tactive: '--active',\n\terror: '--error',\n};\n\n// @vue/component\nexport const Port = {\n\tname: 'DiagramPort',\n\tprops: {\n\t\t/** @type DiagramBlock */\n\t\tblock: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type DiagramPort */\n\t\tport: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type DiagramPortPosition */\n\t\tposition: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tvalidator(position): boolean\n\t\t\t{\n\t\t\t\treturn Object.values(PORT_POSITION).includes(position);\n\t\t\t},\n\t\t},\n\t\t/** @type Array<DiagramValidationPortRuleFn> */\n\t\tvalidationRules: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t\t/** @type DiagramNormalyzeConnectionFn | null */\n\t\tnormalyzeConnectionFn: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): PortSetup\n\t{\n\t\tconst {\n\t\t\tisDisabled,\n\t\t\tonMountedPort,\n\t\t\tonUnmountedPort,\n\t\t} = usePortState({\n\t\t\tportRef: useTemplateRef('port'),\n\t\t\tblock: props.block,\n\t\t\tport: props.port,\n\t\t\tposition: props.position,\n\t\t});\n\t\tconst {\n\t\t\tisSourcePort,\n\t\t\tisValid,\n\t\t\tonMouseDownPort,\n\t\t\tonMouseOverPort,\n\t\t\tonMouseLeavePort,\n\t\t} = useNewConnection({\n\t\t\tblock: props.block,\n\t\t\tport: props.port,\n\t\t\tposition: props.position,\n\t\t\tvalidationRules: props.validationRules,\n\t\t\tnormalyzeConnectionFn: props.normalyzeConnectionFn,\n\t\t});\n\n\t\tconst portClassNames = computed((): { [string]: boolean } => ({\n\t\t\t[PORT_CLASS_NAMES.base]: true,\n\t\t\t[PORT_CLASS_NAMES.active]: toValue(isSourcePort),\n\t\t\t[PORT_CLASS_NAMES.disabled]: toValue(isDisabled),\n\t\t\t[PORT_CLASS_NAMES.error]: !toValue(isValid),\n\t\t}));\n\n\t\tonMounted(() => {\n\t\t\tonMountedPort();\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\tonUnmountedPort();\n\t\t});\n\n\t\treturn {\n\t\t\tportClassNames,\n\t\t\tonMouseDownPort,\n\t\t\tonMouseOverPort,\n\t\t\tonMouseLeavePort,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tref=\"port\"\n\t\t\t:class=\"portClassNames\"\n\t\t\t:data-test-id=\"$blockDiagramTestId('port', port.id)\"\n\t\t\t@mousedown=\"onMouseDownPort\"\n\t\t\t@mouseover=\"onMouseOverPort\"\n\t\t\t@mouseleave=\"onMouseLeavePort\"\n\t\t/>\n\t`,\n};\n","import './block-content-stub.css';\nimport { computed } from 'ui.vue3';\nimport { Port } from '../port/port';\nimport { useBlockDiagram, useContextMenu, useLoc } from '../../composables';\nimport type { DiagramBlock } from '../../type';\n\ntype BlockContentStubSetup = {\n\tblockContentClassNames: { [string]: boolean };\n};\n\nconst BLOCK_CONTENT_STUB_CLASS_NAMES = {\n\tbase: 'ui-block-diagram-block-content-stub',\n\thighlighted: '--highlighted',\n};\n\n// @vue/component\nexport const BlockContentStub = {\n\tname: 'block-content-stub',\n\tcomponents: {\n\t\tPort,\n\t},\n\tprops: {\n\t\t/* @type DiagramBlock */\n\t\tblock: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\thighlighted: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdragged: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): BlockContentStubSetup\n\t{\n\t\tconst { deleteBlockById } = useBlockDiagram();\n\t\tconst loc = useLoc();\n\t\tconst { showContextMenu } = useContextMenu([\n\t\t\t{\n\t\t\t\tid: 'deleteConnection',\n\t\t\t\ttext: loc.getMessage('UI_BLOCK_DIAGRAM_DELETE_BLOCK_CONTEXT_MENU_ITEM'),\n\t\t\t\tonclick: () => {\n\t\t\t\t\tdeleteBlockById(props.block.id);\n\t\t\t\t},\n\t\t\t},\n\t\t]);\n\n\t\tconst blockContentClassNames = computed((): { [string]: boolean } => ({\n\t\t\t[BLOCK_CONTENT_STUB_CLASS_NAMES.base]: true,\n\t\t\t[BLOCK_CONTENT_STUB_CLASS_NAMES.highlighted]: props.highlighted,\n\t\t}));\n\n\t\tfunction onShowContextMenu(event: MouseEvent): void\n\t\t{\n\t\t\tevent.preventDefault();\n\n\t\t\tif (props.disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { clientX, clientY } = event;\n\n\t\t\tshowContextMenu({\n\t\t\t\tclientX,\n\t\t\t\tclientY,\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tblockContentClassNames,\n\t\t\tonShowContextMenu,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"blockContentClassNames\"\n\t\t\t@contextmenu=\"onShowContextMenu\"\n\t\t>\n\t\t\t<div class=\"ui-block-diagram-block-content-stub__id\">\n\t\t\t\t{{ block.id }}\n\t\t\t</div>\n\n\t\t\t<div class=\"ui-block-diagram-block-content-stub__left-column\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"port in block.ports.input\"\n\t\t\t\t\t:key=\"port.id\"\n\t\t\t\t\tclass=\"ui-block-diagram-block-content-stub__port-line\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"ui-block-diagram-block-content-stub__port --left\">\n\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t\t\t:port=\"port\"\n\t\t\t\t\t\t\t:styled=\"false\"\n\t\t\t\t\t\t\t:portsToShow=\"null\"\n\t\t\t\t\t\t\tposition=\"left\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"ui-block-diagram-block-content-stub__right-column\">\n\t\t\t\t<div\n\t\t\t\t\tv-for=\"port in block.ports.output\"\n\t\t\t\t\t:key=\"port.id\"\n\t\t\t\t\tclass=\"ui-block-diagram-block-content-stub__port-line\"\n\t\t\t\t>\n\t\t\t\t\t<div class=\"ui-block-diagram-block-content-stub__port --right\">\n\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t\t\t:port=\"port\"\n\t\t\t\t\t\t\t:styled=\"false\"\n\t\t\t\t\t\t\t:portsToShow=\"null\"\n\t\t\t\t\t\t\tposition=\"right\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './block-diagram.css';\nimport type { MenuItemOptions } from 'ui.vue3.components.menu';\nimport { onMounted, onUnmounted, useTemplateRef, computed, ref, toValue } from 'ui.vue3';\nimport { CanvasTransform } from '../canvas-transform/canvas-transform';\nimport { Connection } from '../connection/connection';\nimport { DeleteConnectionBtn } from '../delete-connection-btn/delete-connection-btn';\nimport { ContextMenuLayout } from '../context-menu-layout/context-menu-layout';\nimport { GroupedBlocks } from '../grouped-blocks/grouped-blocks';\nimport { GroupedConnections } from '../grouped-connections/grouped-connections';\nimport { MoveableBlock } from '../moveable-block/moveable-block';\nimport { BlockContentStub } from '../block-content-stub/block-content-stub';\nimport {\n\tuseHistory,\n\tuseBlockDiagram,\n\tuseModelValue,\n\tuseWatchProps,\n\tuseRegisterHooks,\n\tuseInitAppElements,\n\tuseDragAndDrop,\n\tuseContextMenu,\n} from '../../composables';\nimport { getGroupBlockSlotName, getGroupConnectionSlotName } from '../../utils';\n\nimport { HOOK_NAMES, CURSOR_TYPES } from '../../constants';\nimport type {\n\tBlockGroupNames,\n\tConnectionGroupNames,\n\tDiagramBlock,\n\tDiagramConnection,\n} from '../../types';\n\ntype BlockDiagramSetup = {\n\tblockGroupNames: BlockGroupNames;\n\tconnectionGroupNames: ConnectionGroupNames;\n\tgetGroupBlockSlotName: typeof getGroupBlockSlotName;\n\tgetGroupConnectionSlotName: typeof getGroupConnectionSlotName;\n\topenContextMenu: (event: MouseEvent) => void;\n};\n\nconst UI_CANVAS_GRID_COLOR = '#A1B8D9';\nconst UI_CANVAS_BACKGROUND_COLOR = '#ECF0F2';\n\nconst BLOCK_DIAGRAM_CLASS_NAMES = {\n\tbase: 'ui-block-diagram',\n\tewResize: '--cursor-ew-resize',\n\tnsResize: '--cursor-ns-resize',\n\tnwSeResize: '--cursor-nwse-resize',\n\tneSwResize: '--cursor-nesw-resize',\n\tgrabbing: '--grabbing',\n\tdisabled: '--disabled',\n};\n\ntype Props = {\n\tblocks: Array<DiagramBlock>,\n\tconnections: Array<DiagramConnection>,\n\tcanvasStyle: Object,\n\tzoomSensitivity: number,\n\tzoomSensitivityMouse: number,\n\tzoom: number,\n\tminZoom: number,\n\tmaxZoom: number,\n\thistoryHooks: Array<string>,\n\tsnapshotHandler: () => void,\n\trevertHandler: () => void,\n\tdisabled: boolean,\n\tcontextMenuItems: Array<MenuItemOptions>,\n};\n\n// @vue/component\nexport const BlockDiagram = {\n\tname: 'block-diagram',\n\tcomponents: {\n\t\tCanvasTransform,\n\t\tContextMenuLayout,\n\t\tGroupedBlocks,\n\t\tGroupedConnections,\n\t\tConnection,\n\t\tDeleteConnectionBtn,\n\t\tMoveableBlock,\n\t\tBlockContentStub,\n\t},\n\tprops: {\n\t\t/** @type Array<DiagramBlock> */\n\t\tblocks: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\t/** @type Array<DiagramConnection> */\n\t\tconnections: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tcanvasStyle: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({\n\t\t\t\tstyle: 'grid',\n\t\t\t\tsize: 64,\n\t\t\t\tgridColor: UI_CANVAS_GRID_COLOR,\n\t\t\t\tbackgroundColor: UI_CANVAS_BACKGROUND_COLOR,\n\t\t\t}),\n\t\t},\n\t\tzoomSensitivity: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.01,\n\t\t},\n\t\tzoomSensitivityMouse: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.04,\n\t\t},\n\t\tzoom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 1,\n\t\t},\n\t\tminZoom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.2,\n\t\t},\n\t\tmaxZoom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 4,\n\t\t},\n\t\thistoryHooks: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => ([\n\t\t\t\tHOOK_NAMES.END_DRAG_BLOCK,\n\t\t\t\tHOOK_NAMES.ADD_BLOCK,\n\t\t\t\tHOOK_NAMES.DELETE_BLOCK,\n\t\t\t\tHOOK_NAMES.CREATE_CONNECTION,\n\t\t\t\tHOOK_NAMES.DELETE_CONNECTION,\n\t\t\t]),\n\t\t},\n\t\tsnapshotHandler: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t\trevertHandler: {\n\t\t\ttype: Function,\n\t\t\tdefault: null,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tenableGrouping: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\t/** @type Array<MenuItemOptions> */\n\t\tcontextMenuItems: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => ([]),\n\t\t},\n\t},\n\temits: [\n\t\t'update:blocks',\n\t\t'update:connections',\n\t\tHOOK_NAMES.CHANGED_BLOCKS,\n\t\tHOOK_NAMES.CHANGED_CONNECTIONS,\n\t\tHOOK_NAMES.START_DRAG_BLOCK,\n\t\tHOOK_NAMES.MOVE_DRAG_BLOCK,\n\t\tHOOK_NAMES.END_DRAG_BLOCK,\n\t\tHOOK_NAMES.ADD_BLOCK,\n\t\tHOOK_NAMES.UPDATE_BLOCK,\n\t\tHOOK_NAMES.DELETE_BLOCK,\n\t\tHOOK_NAMES.CREATE_CONNECTION,\n\t\tHOOK_NAMES.DELETE_CONNECTION,\n\t\tHOOK_NAMES.BLOCK_TRANSITION_START,\n\t\tHOOK_NAMES.BLOCK_TRANSITION_END,\n\t\tHOOK_NAMES.CONNECTION_TRANSITION_START,\n\t\tHOOK_NAMES.CONNECTION_TRANSITION_END,\n\t\tHOOK_NAMES.DROP_NEW_BLOCK,\n\t],\n\tsetup(props: Props, { emit }): BlockDiagramSetup\n\t{\n\t\tconst {\n\t\t\tblockGroupNames,\n\t\t\tconnectionGroupNames,\n\t\t\tcursorType,\n\t\t} = useBlockDiagram(props);\n\n\t\tconst initAppElements = useInitAppElements({\n\t\t\tblockDiagramRef: useTemplateRef('blockDiagram'),\n\t\t});\n\n\t\tconst { makeSnapshot } = useHistory();\n\t\tconst { dispose: disposeModelValue } = useModelValue(emit);\n\t\tconst { dispose: disposeWatchProps } = useWatchProps(props);\n\t\tconst { dispose: disposeRegisterHooks } = useRegisterHooks(\n\t\t\t{\n\t\t\t\t...Object.entries(HOOK_NAMES)\n\t\t\t\t\t.reduce((acc, [name, hookName]) => {\n\t\t\t\t\t\tacc[hookName] = (...args) => {\n\t\t\t\t\t\t\temit(hookName, ...args);\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn acc;\n\t\t\t\t\t}, {}),\n\t\t\t},\n\t\t\t{\n\t\t\t\t...props.historyHooks.reduce((acc, hookName) => {\n\t\t\t\t\tacc[hookName] = () => makeSnapshot();\n\n\t\t\t\t\treturn acc;\n\t\t\t\t}, {}),\n\t\t\t},\n\t\t);\n\t\tconst { onDrop } = useDragAndDrop();\n\t\tconst isGrabbing = ref(false);\n\n\t\tconst blockDiagramClassNames = computed(() => ({\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.base]: true,\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.grabbing]: isGrabbing.value,\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.disabled]: props.disabled,\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.ewResize]: toValue(cursorType) === CURSOR_TYPES.EW_RESIZE,\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.nsResize]: toValue(cursorType) === CURSOR_TYPES.NS_RESIZE,\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.nwSeResize]: toValue(cursorType) === CURSOR_TYPES.NWSE_RESIZE,\n\t\t\t[BLOCK_DIAGRAM_CLASS_NAMES.neSwResize]: toValue(cursorType) === CURSOR_TYPES.NESW_RESIZE,\n\t\t}));\n\n\t\tconst { showContextMenu } = useContextMenu();\n\n\t\tonMounted(() => {\n\t\t\tinitAppElements.onMountedAppElements();\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\tdisposeModelValue();\n\t\t\tdisposeWatchProps();\n\t\t\tdisposeRegisterHooks();\n\t\t\tinitAppElements.onUnmountedAppElements();\n\t\t});\n\n\t\tfunction onDragEnter(event)\n\t\t{\n\t\t\tisGrabbing.value = true;\n\t\t}\n\n\t\tfunction onDragLeave(event)\n\t\t{\n\t\t\tisGrabbing.value = false;\n\t\t}\n\n\t\tfunction onDragDrop(event): void\n\t\t{\n\t\t\tisGrabbing.value = false;\n\t\t\tonDrop(event);\n\t\t}\n\n\t\tfunction openContextMenu(event: MouseEvent): void\n\t\t{\n\t\t\tif (props.contextMenuItems.length > 0)\n\t\t\t{\n\t\t\t\tshowContextMenu({\n\t\t\t\t\tclientX: event.clientX,\n\t\t\t\t\tclientY: event.clientY,\n\t\t\t\t\titems: props.contextMenuItems,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tblockDiagramClassNames,\n\t\t\tblockGroupNames,\n\t\t\tconnectionGroupNames,\n\t\t\tgetGroupBlockSlotName,\n\t\t\tgetGroupConnectionSlotName,\n\t\t\tonDragDrop,\n\t\t\tonDragEnter,\n\t\t\tonDragLeave,\n\t\t\topenContextMenu,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"blockDiagramClassNames\"\n\t\t\tref=\"blockDiagram\"\n\t\t\t@dragover.prevent\n\t\t\t@dragenter=\"onDragEnter\"\n\t\t\t@dragleave=\"onDragLeave\"\n\t\t\t@drop=\"onDragDrop\"\n\t\t>\n\t\t\t<CanvasTransform\n\t\t\t\t:canvasStyle=\"canvasStyle\"\n\t\t\t\t:zoomSensitivity=\"zoomSensitivity\"\n\t\t\t\t:zoomSensitivityMouse=\"zoomSensitivityMouse\"\n\t\t\t\t@openContextMenu=\"openContextMenu\"\n\t\t\t\t:selectionEnabled=\"enableGrouping\"\n\t\t\t>\n\t\t\t\t<slot name=\"group-selection-box\"/>\n\t\t\t\t<ContextMenuLayout>\n\t\t\t\t\t<GroupedConnections>\n\t\t\t\t\t\t<template\n\t\t\t\t\t\t\tv-for=\"groupName in connectionGroupNames\"\n\t\t\t\t\t\t\t#[getGroupConnectionSlotName(groupName)]=\"{ connections }\"\n\t\t\t\t\t\t\t:key=\"groupName\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\tv-for=\"connection in connections\"\n\t\t\t\t\t\t\t\t:name=\"getGroupConnectionSlotName(groupName)\"\n\t\t\t\t\t\t\t\t:key=\"connection.id\"\n\t\t\t\t\t\t\t\t:connection=\"connection\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Connection\n\t\t\t\t\t\t\t\t\t:connection=\"connection\"\n\t\t\t\t\t\t\t\t\t:key=\"connection.id\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #default=\"{ isDisabled }\">\n\t\t\t\t\t\t\t\t\t\t<DeleteConnectionBtn \n\t\t\t\t\t\t\t\t\t\t\t:connectionId=\"connection.id\"\n\t\t\t\t\t\t\t\t\t\t\t:disabled=\"isDisabled\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</Connection>\n\t\t\t\t\t\t\t</slot>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #new-connection>\n\t\t\t\t\t\t\t<slot name=\"new-connection\"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</GroupedConnections>\n\t\t\t\t\t<GroupedBlocks>\n\t\t\t\t\t\t<template\n\t\t\t\t\t\t\tv-for=\"groupName in blockGroupNames\"\n\t\t\t\t\t\t\t#[getGroupBlockSlotName(groupName)]=\"{ blocks }\"\n\t\t\t\t\t\t\t:key=\"groupName\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\tv-for=\"block in blocks\"\n\t\t\t\t\t\t\t\t:name=\"getGroupBlockSlotName(groupName)\"\n\t\t\t\t\t\t\t\t:key=\"block.id\"\n\t\t\t\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<MoveableBlock\n\t\t\t\t\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t\t\t\t\t:key=\"block.id\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #default=\"{ isHighlighted, isDragged, isDisabled }\">\n\t\t\t\t\t\t\t\t\t\t<BlockContentStub\n\t\t\t\t\t\t\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t\t\t\t\t\t\t:highlighted=\"isHighlighted\"\n\t\t\t\t\t\t\t\t\t\t\t:dragged=\"isDragged\"\n\t\t\t\t\t\t\t\t\t\t\t:disabled=\"isDisabled\"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</MoveableBlock>\n\t\t\t\t\t\t\t</slot>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</GroupedBlocks>\n\t\t\t\t</ContextMenuLayout>\n\t\t\t</CanvasTransform>\n\t\t</div>\n\t`,\n};\n","import './icon-button.css';\nimport { computed, toRefs, toValue } from 'ui.vue3';\nimport { BIcon } from 'ui.icon-set.api.vue';\n\nexport type IconButtonSetup = {\n\ticonName: string,\n\tcolor: string,\n\tsize: number,\n\tbuttonClassNames: { [string]: boolean },\n\tbuttonStyle: { [string]: string },\n\ticonClassNames: { [string]: boolean },\n};\n\n// @vue/component\nexport const IconButton = {\n\tname: 'icon-button',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\ticonName: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsize: {\n\t\t\ttype: [Number, String],\n\t\t\tdefault: 16,\n\t\t},\n\t\tcolor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#959CA4',\n\t\t},\n\t\tactive: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tactiveColor: {\n\t\t\ttype: String,\n\t\t\tdefault: '#4A9DFF',\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): IconButtonSetup\n\t{\n\t\tconst { size, active, disabled } = toRefs(props);\n\t\tconst buttonClassNames = computed(() => ({\n\t\t\t'ui-block-diagram-icon-button': true,\n\t\t\t'--disabled': toValue(disabled),\n\t\t}));\n\t\tconst buttonStyle = computed(() => ({\n\t\t\twidth: `${toValue(size)}px`,\n\t\t\theight: `${toValue(size)}px`,\n\t\t}));\n\t\tconst iconClassNames = computed(() => ({\n\t\t\t'ui-block-diagram-icon-button__icon': true,\n\t\t\t'--active': toValue(active),\n\t\t}));\n\n\t\treturn {\n\t\t\tbuttonClassNames,\n\t\t\tbuttonStyle,\n\t\t\ticonClassNames,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\t:class=\"buttonClassNames\"\n\t\t\t:style=\"buttonStyle\"\n\t\t>\n\t\t\t<slot>\n\t\t\t\t<BIcon\n\t\t\t\t\t:class=\"iconClassNames\"\n\t\t\t\t\t:name=\"iconName\"\n\t\t\t\t\t:color=\"color\"\n\t\t\t\t\t:size=\"size\"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t</button>\n\t`,\n};\n","import './history-bar.css';\nimport { toValue } from 'ui.vue3';\nimport { useHistory, useBlockDiagram } from '../../composables';\nimport { IconButton } from '../icon-button/icon-button';\nimport { Outline } from 'ui.icon-set.api.vue';\n\nexport type HistoryBarSetup = {\n\thasNext: boolean,\n\thasPrev: boolean,\n\tonNext: () => void,\n\tonPrev: () => void,\n\tOutline: {...},\n};\n\n// @vue/component\nexport const HistoryBar = {\n\tname: 'history-bar',\n\tcomponents: {\n\t\tIconButton,\n\t},\n\tprops: {\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): HistoryBarSetup\n\t{\n\t\tconst { isDisabledBlockDiagram } = useBlockDiagram();\n\t\tconst {\n\t\t\thasNext,\n\t\t\thasPrev,\n\t\t\tnext,\n\t\t\tprev,\n\t\t} = useHistory();\n\n\t\tfunction onNext(): void\n\t\t{\n\t\t\tif (props.disabled || toValue(isDisabledBlockDiagram))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tnext();\n\t\t}\n\n\t\tfunction onPrev(): void\n\t\t{\n\t\t\tif (props.disabled || toValue(isDisabledBlockDiagram))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tprev();\n\t\t}\n\n\t\treturn {\n\t\t\thasNext,\n\t\t\thasPrev,\n\t\t\tonNext,\n\t\t\tonPrev,\n\t\t\tOutline,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-block-diagram-histoy-bar\">\n\t\t\t<slot>\n\t\t\t\t<IconButton\n\t\t\t\t\tclass=\"ui-block-diagram-histoy-bar__prev-button\"\n\t\t\t\t\t:icon-name=\"Outline.FORWARD\"\n\t\t\t\t\t:size=\"22\"\n\t\t\t\t\t:disabled=\"!hasPrev\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('historyPrevBtn')\"\n\t\t\t\t\t@click=\"onPrev\"\n\t\t\t\t/>\n\t\t\t\t<IconButton\n\t\t\t\t\t:icon-name=\"Outline.FORWARD\"\n\t\t\t\t\t:size=\"22\"\n\t\t\t\t\t:disabled=\"!hasNext\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('historyNextBtn')\"\n\t\t\t\t\t@click=\"onNext\"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t</div>\n\t`,\n};\n","import './zoom-btn.css';\nimport { toValue, toRefs } from 'ui.vue3';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { useBlockDiagram, useCanvas } from '../../composables';\n\ntype ZoomType = 'in' | 'out';\n\nconst ZOOM_TYPES = {\n\tin: 'in',\n\tout: 'out',\n};\n\n// @vue/component\nexport const ZoomBtn = {\n\tname: 'zoom-btn',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\tstepZoom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.2,\n\t\t},\n\t\t/** @type ZoomType */\n\t\ttypeZoom: {\n\t\t\ttype: String,\n\t\t\tdefault: ZOOM_TYPES.in,\n\t\t\tvalidator(value): boolean\n\t\t\t{\n\t\t\t\treturn value === ZOOM_TYPES.in || value === ZOOM_TYPES.out;\n\t\t\t},\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['zoom-change'],\n\tsetup(props, { emit }): {...}\n\t{\n\t\tconst { isDisabledBlockDiagram } = useBlockDiagram();\n\t\tconst { zoomIn, zoomOut } = useCanvas();\n\n\t\tconst {\n\t\t\tstepZoom,\n\t\t\ttypeZoom,\n\t\t} = toRefs(props);\n\n\t\tfunction onZoom()\n\t\t{\n\t\t\tif (props.disabled || toValue(isDisabledBlockDiagram))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (toValue(typeZoom) === ZOOM_TYPES.in)\n\t\t\t{\n\t\t\t\tzoomIn(toValue(stepZoom));\n\t\t\t}\n\t\t\telse if (toValue(typeZoom) === ZOOM_TYPES.out)\n\t\t\t{\n\t\t\t\tzoomOut(toValue(stepZoom));\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t\tzoomTypes: ZOOM_TYPES,\n\t\t\tonZoom,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\tclass=\"ui-block-diagram-control-btn__btn\"\n\t\t\t@click=\"onZoom\"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tv-if=\"typeZoom === zoomTypes.in\"\n\t\t\t\t:name=\"iconSet.PLUS_M\"\n\t\t\t\t:size=\"22\"\n\t\t\t\tclass=\"ui-block-diagram-control-btn__icon\"\n\t\t\t/>\n\t\t\t<BIcon\n\t\t\t\tv-else\n\t\t\t\t:name=\"iconSet.MINUS_M\"\n\t\t\t\t:size=\"22\"\n\t\t\t\tclass=\"ui-block-diagram-control-btn__icon\"\n\t\t\t/>\n\t\t</button>\n\t`,\n};\n","import './zoom-percent.css';\nimport { computed, toValue } from 'ui.vue3';\nimport { useBlockDiagram } from '../../composables';\n\ntype ZoomPercentSetup = {\n\tpercent: number,\n}\n\n// @vue/component\nexport const ZoomPercent = {\n\tname: 'zoom-percent',\n\tsetup(props): ZoomPercentSetup\n\t{\n\t\tconst { zoom } = useBlockDiagram();\n\n\t\tconst percent = computed(() => {\n\t\t\treturn ((toValue(zoom) ?? 0) * 100).toFixed(0);\n\t\t});\n\n\t\treturn {\n\t\t\tpercent,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<span class=\"ui-block-diagram-percent\">{{ percent }}</span>\n\t`,\n};\n","import './canvas-map.css';\nimport { Type } from 'main.core';\nimport { toValue, ref, computed, toRefs, useTemplateRef } from 'ui.vue3';\nimport { useBlockDiagram, useCanvas } from '../../composables';\nimport type { DiagramBlock } from '../../types';\n\ntype CursorRectPosition = {\n\tx: number;\n\ty: number;\n\twidth: number;\n\theight: number;\n}\n\ntype CanvasMapSetup = {\n\tmapWidth: number;\n\tmapHeight: number;\n\tpreparedBlock: Array<DiagramBlock>,\n\tcanvasMapStyle: { [string]: string };\n\tstartDiagramX: number;\n\tstartDiagramY: number;\n\tscaleMap: number;\n\tcursorRectPosition: CursorRectPosition;\n\tonMapMouseDown: (event: MouseEvent) => void;\n\tonMapMouseMove: (event: MouseEvent) => void;\n\tonMapMouseUp: (event: MouseEvent) => void;\n};\n\nconst CURSOR_RECT_STROKE_WIDTH: number = 2;\n\nconst FIRST_EMPTY_BLOCK_ID = 'firstCanvasBlock';\nconst LAST_EMPTY_BLOCK_ID = 'lastCanvasBlock';\n\n// @vue/component\nexport const CanvasMap = {\n\tname: 'canvas-map',\n\tprops: {\n\t\tmapWidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 310,\n\t\t},\n\t\tmapHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 183,\n\t\t},\n\t},\n\t// eslint-disable-next-line max-lines-per-function\n\tsetup(props, { emit }): CanvasMapSetup\n\t{\n\t\tconst {\n\t\t\tblocks,\n\t\t\tcanvasWidth,\n\t\t\tcanvasHeight,\n\t\t\ttransformX,\n\t\t\ttransformY,\n\t\t\tzoom,\n\t\t} = useBlockDiagram();\n\t\tconst { setCamera } = useCanvas();\n\t\tconst { mapWidth, mapHeight } = toRefs(props);\n\t\tconst mapEl = useTemplateRef('map');\n\n\t\tlet mapElLeft: number = 0;\n\t\tlet mapElTop: number = 0;\n\n\t\tconst isDragged = ref(false);\n\n\t\tconst canvasMapStyle = computed((): { [string]: string } => ({\n\t\t\twidth: `${toValue(mapWidth)}px`,\n\t\t\theight: `${toValue(mapHeight)}px`,\n\t\t}));\n\n\t\tconst preparedBlock = computed((): Array<DiagramBlock> => {\n\t\t\tif (toValue(blocks).length === 1)\n\t\t\t{\n\t\t\t\treturn [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: FIRST_EMPTY_BLOCK_ID,\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tx: 0,\n\t\t\t\t\t\t\ty: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdimensions: {\n\t\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\t\theight: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{ ...toValue(blocks)[0] },\n\t\t\t\t\t{\n\t\t\t\t\t\tid: LAST_EMPTY_BLOCK_ID,\n\t\t\t\t\t\tposition: {\n\t\t\t\t\t\t\tx: props.mapWidth,\n\t\t\t\t\t\t\ty: props.mapHeight,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdimensions: {\n\t\t\t\t\t\t\twidth: 0,\n\t\t\t\t\t\t\theight: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t];\n\t\t\t}\n\n\t\t\treturn toValue(blocks);\n\t\t});\n\n\t\tconst startDiagramX = computed((): number => {\n\t\t\treturn toValue(preparedBlock)\n\t\t\t\t.reduce((min, block) => Math.min(min, block.position.x), Infinity);\n\t\t});\n\n\t\tconst startDiagramY = computed((): number => {\n\t\t\treturn toValue(preparedBlock)\n\t\t\t\t.reduce((min, block) => Math.min(min, block.position.y), Infinity);\n\t\t});\n\n\t\tconst diagramWidth = computed((): number => {\n\t\t\tif (!Type.isArrayFilled(toValue(blocks)))\n\t\t\t{\n\t\t\t\treturn props.mapWidth;\n\t\t\t}\n\n\t\t\tconst maxX: number = toValue(preparedBlock).reduce(\n\t\t\t\t(max, block): number => Math.max(max, block.position.x + block.dimensions.width),\n\t\t\t\t-Infinity,\n\t\t\t);\n\n\t\t\treturn maxX - toValue(startDiagramX);\n\t\t});\n\n\t\tconst diagramHeight = computed((): number => {\n\t\t\tif (!Type.isArrayFilled(toValue(blocks)))\n\t\t\t{\n\t\t\t\treturn props.mapHeight;\n\t\t\t}\n\n\t\t\tconst maxY: number = toValue(preparedBlock).reduce(\n\t\t\t\t(max, block) => Math.max(max, block.position.y + block.dimensions.height),\n\t\t\t\t-Infinity,\n\t\t\t);\n\n\t\t\treturn maxY - toValue(startDiagramY);\n\t\t});\n\n\t\tconst scaleMap = computed((): number => {\n\t\t\treturn Math.min(\n\t\t\t\ttoValue(mapWidth) / toValue(diagramWidth),\n\t\t\t\ttoValue(mapHeight) / toValue(diagramHeight),\n\t\t\t);\n\t\t});\n\n\t\tconst cursorRectWidth = computed((): number => {\n\t\t\treturn toValue(canvasWidth) * toValue(scaleMap) / toValue(zoom);\n\t\t});\n\n\t\tconst cursorRectHeight = computed((): number => {\n\t\t\treturn toValue(canvasHeight) * toValue(scaleMap) / toValue(zoom);\n\t\t});\n\n\t\tconst cursorRectPosition = computed((): CursorRectPosition => {\n\t\t\tlet width = toValue(cursorRectWidth);\n\t\t\tlet height = toValue(cursorRectHeight);\n\n\t\t\tlet x = (toValue(transformX) - toValue(startDiagramX)) * toValue(scaleMap);\n\t\t\tlet y = (toValue(transformY) - toValue(startDiagramY)) * toValue(scaleMap);\n\n\t\t\t[x, width] = width > toValue(mapWidth)\n\t\t\t\t? [1, toValue(mapWidth) - CURSOR_RECT_STROKE_WIDTH]\n\t\t\t\t: [x, width];\n\n\t\t\t[y, height] = height > toValue(mapHeight)\n\t\t\t\t? [1, toValue(mapHeight) - CURSOR_RECT_STROKE_WIDTH]\n\t\t\t\t: [y, height];\n\n\t\t\tx = x < 0 ? 1 : x;\n\t\t\ty = y < 0 ? 1 : y;\n\n\t\t\tx = (x + width) > toValue(mapWidth)\n\t\t\t\t? toValue(mapWidth) - width - CURSOR_RECT_STROKE_WIDTH\n\t\t\t\t: x;\n\t\t\ty = (y + height) > toValue(mapHeight)\n\t\t\t\t? toValue(mapHeight) - height - CURSOR_RECT_STROKE_WIDTH\n\t\t\t\t: y;\n\n\t\t\treturn {\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t\twidth,\n\t\t\t\theight,\n\t\t\t};\n\t\t});\n\n\t\tfunction updateCameraPosition(event: MouseEvent): void\n\t\t{\n\t\t\tconst x: number = event.clientX - mapElLeft;\n\t\t\tconst y: number = event.clientY - mapElTop;\n\n\t\t\tconst canvasX: number = x / toValue(scaleMap) + toValue(startDiagramX);\n\t\t\tconst canvasY: number = y / toValue(scaleMap) + toValue(startDiagramY);\n\n\t\t\tsetCamera({\n\t\t\t\tx: canvasX - (toValue(canvasWidth) / toValue(zoom) / 2),\n\t\t\t\ty: canvasY - (toValue(canvasHeight) / toValue(zoom) / 2),\n\t\t\t\tzoom: toValue(zoom),\n\t\t\t\tviewportX: 0,\n\t\t\t\tviewportY: 0,\n\t\t\t});\n\t\t}\n\n\t\tfunction onMapMouseDown(event: MouseEvent): void\n\t\t{\n\t\t\tisDragged.value = true;\n\n\t\t\tif (toValue(mapEl))\n\t\t\t{\n\t\t\t\tconst { left, top } = toValue(mapEl).getBoundingClientRect();\n\t\t\t\t[mapElLeft, mapElTop] = [left, top];\n\t\t\t}\n\n\t\t\tupdateCameraPosition(event);\n\t\t}\n\n\t\tfunction onMapMouseMove(event: MouseEvent): void\n\t\t{\n\t\t\tif (!toValue(isDragged))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdateCameraPosition(event);\n\t\t}\n\n\t\tfunction onMapMouseUp(event: MouseEvent): void\n\t\t{\n\t\t\tisDragged.value = false;\n\t\t\tupdateCameraPosition(event);\n\t\t}\n\n\t\treturn {\n\t\t\tpreparedBlock,\n\t\t\tcanvasMapStyle,\n\t\t\tstartDiagramX,\n\t\t\tstartDiagramY,\n\t\t\tscaleMap,\n\t\t\tcursorRectPosition,\n\t\t\tonMapMouseDown,\n\t\t\tonMapMouseMove,\n\t\t\tonMapMouseUp,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div :style=\"canvasMapStyle\">\n\t\t\t<svg\n\t\t\t\t:width=\"mapWidth\"\n\t\t\t\t:height=\"mapHeight\"\n\t\t\t\tref=\"map\"\n\t\t\t\tclass=\"ui-block-diagram-canvas-map\"\n\t\t\t\t@mousedown=\"onMapMouseDown\"\n\t\t\t\t@mousemove=\"onMapMouseMove\"\n\t\t\t\t@mouseup=\"onMapMouseUp\"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tv-for=\"block in preparedBlock\"\n\t\t\t\t\t:key=\"block.id\"\n\t\t\t\t\t:x=\"(block.position.x - startDiagramX) * scaleMap\"\n\t\t\t\t\t:y=\"(block.position.y - startDiagramY) * scaleMap\"\n\t\t\t\t\t:width=\"block.dimensions.width * scaleMap\"\n\t\t\t\t\t:height=\"block.dimensions.height * scaleMap\"\n\t\t\t\t\t:rx=\"2\"\n\t\t\t\t\tclass=\"ui-block-diagram-canvas-map__block\"\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\t:x=\"cursorRectPosition.x\"\n\t\t\t\t\t:y=\"cursorRectPosition.y\"\n\t\t\t\t\t:width=\"cursorRectPosition.width\"\n\t\t\t\t\t:height=\"cursorRectPosition.height\"\n\t\t\t\t\t:rx=\"3\"\n\t\t\t\t\tclass=\"ui-block-diagram-canvas-map__cursor\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</div>\n\t`,\n};\n","import './canvas-map-btn.css';\nimport { Type } from 'main.core';\nimport { toValue, computed } from 'ui.vue3';\nimport { useBlockDiagram } from '../../composables';\nimport type { DiagramBlock } from '../../types';\n\ntype CanvasMapBtnSetup = {\n\tblocks: Array<DiagramBlock>,\n\tbtnStyle: { [string]: string};\n\tstartDiagramX: number;\n\tstartDiagramY: number;\n\tscaleButton: number;\n};\n\n// @vue/component\nexport const CanvasMapBtn = {\n\tname: 'canvas-map-btn',\n\tprops: {\n\t\twidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 75,\n\t\t},\n\t\theight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 32,\n\t\t},\n\t},\n\tsetup(props): CanvasMapBtnSetup\n\t{\n\t\tconst { blocks } = useBlockDiagram();\n\n\t\tconst btnStyle = computed(() => ({\n\t\t\twidth: `${props.width}px`,\n\t\t\theight: `${props.height}px`,\n\t\t}));\n\n\t\tconst startDiagramX = computed((): number => {\n\t\t\treturn toValue(blocks)\n\t\t\t\t.reduce((min, block) => Math.min(min, block.position.x), Infinity);\n\t\t});\n\n\t\tconst startDiagramY = computed((): number => {\n\t\t\treturn toValue(blocks)\n\t\t\t\t.reduce((min, block) => Math.min(min, block.position.y), Infinity);\n\t\t});\n\n\t\tconst diagramWidth = computed((): number => {\n\t\t\tif (!Type.isArrayFilled(toValue(blocks)))\n\t\t\t{\n\t\t\t\treturn props.width;\n\t\t\t}\n\n\t\t\tconst maxX: number = toValue(blocks).reduce(\n\t\t\t\t(max, block): number => Math.max(max, block.position.x + block.dimensions.width),\n\t\t\t\t-Infinity,\n\t\t\t);\n\n\t\t\treturn maxX - toValue(startDiagramX);\n\t\t});\n\n\t\tconst diagramHeight = computed((): number => {\n\t\t\tif (!Type.isArrayFilled(toValue(blocks)))\n\t\t\t{\n\t\t\t\treturn props.height;\n\t\t\t}\n\n\t\t\tconst maxY: number = toValue(blocks).reduce(\n\t\t\t\t(max, block) => Math.max(max, block.position.y + block.dimensions.height),\n\t\t\t\t-Infinity,\n\t\t\t);\n\n\t\t\treturn maxY - toValue(startDiagramY);\n\t\t});\n\n\t\tconst scaleButton = computed((): number => {\n\t\t\treturn Math.min(props.width / toValue(diagramWidth), props.height / toValue(diagramHeight));\n\t\t});\n\n\t\treturn {\n\t\t\tblocks,\n\t\t\tbtnStyle,\n\t\t\tstartDiagramX,\n\t\t\tstartDiagramY,\n\t\t\tscaleButton,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<button\n\t\t\t:style=\"btnStyle\"\n\t\t\tclass=\"ui-block-diagram-canvas-map-btn\"\n\t\t>\n\t\t\t<svg\n\t\t\t\t:width=\"width\"\n\t\t\t\t:height=\"height\"\n\t\t\t\tclass=\"ui-block-diagram-canvas-map-btn__icon\"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tv-for=\"block in blocks\"\n\t\t\t\t\t:key=\"block.id\"\n\t\t\t\t\t:x=\"(block.position.x - startDiagramX) * scaleButton\"\n\t\t\t\t\t:y=\"(block.position.y - startDiagramY) * scaleButton\"\n\t\t\t\t\t:width=\"block.dimensions.width * scaleButton\"\n\t\t\t\t\t:height=\"block.dimensions.height * scaleButton\"\n\t\t\t\t\t:rx=\"1\"\n\t\t\t\t\tclass=\"ui-block-diagram-canvas-map-btn__rect\"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</button>\n\t`,\n};\n","import './zoom-bar.css';\nimport { ref, toValue, computed } from 'ui.vue3';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { ZoomBtn } from '../zoom-btn/zoom-btn';\nimport { ZoomPercent } from '../zoom-percent/zoom-percent';\nimport { CanvasMap } from '../canvas-map/canvas-map';\nimport { CanvasMapBtn } from '../canvas-map-btn/canvas-map-btn';\n\ntype ZoomBarSetup = {\n\ticonSet: { [string]: string };\n\tmapPositionClasses: { [string]: boolean };\n\tisShowMap: boolean;\n\tonToggleMap: () => void,\n};\n\nconst VERTICAL_MAP_POSITION: { [string]: string } = {\n\tleft: 'left',\n\tright: 'right',\n};\n\nconst GORIZONTAL_MAP_POSITION: { [string]: string } = {\n\ttop: 'top',\n\tbottom: 'bottom',\n};\n\nconst MAP_CLASSES: { [string]: string } = {\n\tbase: 'ui-block-diagram-canvas-zoom-bar__map',\n\ttop: '--top',\n\tbottom: '--bottom',\n\tleft: '--left',\n\tright: '--right',\n};\n\nconst POSITION_MAP_DEFAULT_VALUES: string = 'top right';\n\n// @vue/component\nexport const ZoomBar = {\n\tname: 'zoom-bar',\n\tcomponents: {\n\t\tBIcon,\n\t\tZoomBtn,\n\t\tZoomPercent,\n\t\tCanvasMap,\n\t\tCanvasMapBtn,\n\t},\n\tprops: {\n\t\tstepZoom: {\n\t\t\ttype: Number,\n\t\t\tdefault: 0.2,\n\t\t},\n\t\tpositionMap: {\n\t\t\ttype: String,\n\t\t\tdefault: POSITION_MAP_DEFAULT_VALUES,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['update:modelValue'],\n\tsetup(props): ZoomBarSetup\n\t{\n\t\tconst isShowMap = ref(false);\n\n\t\tconst mapPositionClasses = computed((): { [string]: boolean } => {\n\t\t\tconst isTop = props.positionMap\n\t\t\t\t.toLowerCase()\n\t\t\t\t.includes(GORIZONTAL_MAP_POSITION.top);\n\t\t\tconst isLeft = props.positionMap\n\t\t\t\t.toLowerCase()\n\t\t\t\t.includes(VERTICAL_MAP_POSITION.left);\n\n\t\t\treturn {\n\t\t\t\t[MAP_CLASSES.base]: true,\n\t\t\t\t[MAP_CLASSES.top]: isTop,\n\t\t\t\t[MAP_CLASSES.bottom]: !isTop,\n\t\t\t\t[MAP_CLASSES.left]: isLeft,\n\t\t\t\t[MAP_CLASSES.right]: !isLeft,\n\t\t\t};\n\t\t});\n\n\t\tfunction onToggleMap(): void\n\t\t{\n\t\t\tif (props.disabled)\n\t\t\t{\n\t\t\t\tisShowMap.value = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tisShowMap.value = !toValue(isShowMap);\n\t\t}\n\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t\tmapPositionClasses,\n\t\t\tisShowMap,\n\t\t\tonToggleMap,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-block-diagram-canvas-zoom-bar\">\n\t\t\t<div class=\"ui-block-diagram-canvas-zoom-bar__locate\">\n\t\t\t\t<CanvasMapBtn\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('zoomOpenMapBtn')\"\n\t\t\t\t\t@click=\"onToggleMap\"\n\t\t\t\t/>\n\t\t\t\t<transition name=\"editor-large-map-fade\" mode=\"in-out\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if=\"isShowMap\"\n\t\t\t\t\t\tclass=\"ui-block-diagram-canvas-zoom-bar__map\"\n\t\t\t\t\t\t:class=\"mapPositionClasses\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"ui-block-diagram-canvas-zoom-bar__map-header\">\n\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\t:name=\"iconSet.CROSS_M\"\n\t\t\t\t\t\t\t\t:size=\"24\"\n\t\t\t\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('zoomCloseMapBtn')\"\n\t\t\t\t\t\t\t\tclass=\"ui-block-diagram-canvas-zoom-bar__map-close-icon\"\n\t\t\t\t\t\t\t\tcolor=\"#2FC6F6\"\n\t\t\t\t\t\t\t\t@click=\"onToggleMap\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<CanvasMap\n\t\t\t\t\t\t\t:mapSize=\"310\"\n\t\t\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('zoomCanvasMap')\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</transition>\n\t\t\t</div>\n\t\t\t<div class=\"ui-block-diagram-canvas-zoom-bar__separator\"/>\n\t\t\t<div class=\"ui-block-diagram-canvas-zoom-bar__zoom\">\n\t\t\t\t<ZoomBtn\n\t\t\t\t\t:stepZoom=\"stepZoom\"\n\t\t\t\t\t:disabled=\"disabled\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('zoomOutBtn')\"\n\t\t\t\t\ttypeZoom=\"out\"\n\t\t\t\t/>\n\t\t\t\t<ZoomPercent/>\n\t\t\t\t<ZoomBtn\n\t\t\t\t\t:stepZoom=\"stepZoom\"\n\t\t\t\t\t:disabled=\"disabled\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('zoomInBtn')\"\n\t\t\t\t\ttypeZoom=\"in\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './search-result.css';\n\n// @vue/component\nexport const SearchResult = {\n\tname: 'search-result',\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tcount: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-block-diagram-search-result\">\n\t\t\t<div class=\"ui-block-diagram-search-result__left-col\">\n\t\t\t\t<p class=\"ui-block-diagram-search-result__title\">{{ title }}</p>\n\t\t\t</div>\n\t\t\t<div class=\"ui-block-diagram-search-result__right-col\">\n\t\t\t\t<span class=\"ui-block-diagram-search-result__count\">{{ count }}</span>\n\t\t\t\t<div class=\"ui-block-diagram-search-result__nav\">\n\t\t\t\t\t<slot/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { BIcon } from 'ui.icon-set.api.vue';\nimport './search-nav-btn.css';\n\n// @vue/component\nexport const SearchNavBtn = {\n\tname: 'search-nav-btn',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tprops: {\n\t\ticonName: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\ttemplate: `\n\t\t<button class=\"ui-block-diagram-search-nav-btn\">\n\t\t\t<BIcon\n\t\t\t\t:name=\"iconName\"\n\t\t\t\t:size=\"18\"\n\t\t\t\tclass=\"ui-block-diagram-search-nav-btn__icon\"\n\t\t\t/>\n\t\t</button>\n\t`,\n};\n","import './open-search-btn.css';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\n\ntype OpenSearchBtnSetup = {\n\ticonSet: {...};\n};\n\n// @vue/component\nexport const OpenSearchBtn = {\n\tname: 'open-search-btn',\n\tcomponents: {\n\t\tBIcon,\n\t},\n\tsetup(): OpenSearchBtnSetup\n\t{\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<button class=\"ui-block-diagram-open-search-btn\">\n\t\t\t<BIcon\n\t\t\t\t:name=\"iconSet.SEARCH\"\n\t\t\t\t:size=\"24\"\n\t\t\t\tclass=\"ui-block-diagram-open-search-btn__icon\"\n\t\t\t/>\n\t\t</button>\n\t`,\n};\n","import { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport {\n\tuseTemplateRef,\n\ttoValue,\n\tcomputed,\n\tref,\n\tnextTick,\n} from 'ui.vue3';\nimport { useLoc } from '../../composables';\nimport { OpenSearchBtn } from './open-search-btn';\nimport './search-input.css';\n\ntype SearchInputSetup = {\n\ticonSet: {...};\n\tplaceholderOrDefaultValue: string;\n\tshowSearchBtn: boolean;\n\tshowSearchBar: boolean;\n\tsearchInputClassNames: { [string]: boolean };\n\tonInput: (event: InputEvent) => void;\n\tonClear: () => void;\n};\n\nconst SEARCH_INPUT_CLASS_NAMES = {\n\tbase: 'ui-block-diagram-search-input',\n\topen: '--open',\n\tfocus: '--focus',\n};\n\n// @vue/component\nexport const SearchInput = {\n\tname: 'SearchInput',\n\tcomponents: {\n\t\tBIcon,\n\t\tOpenSearchBtn,\n\t},\n\tprops: {\n\t\tvalue: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\topen: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\temits: ['update:value', 'clear', 'update:open'],\n\tsetup(props, { emit }): SearchInputSetup\n\t{\n\t\tconst loc = useLoc();\n\t\tconst searchInput = useTemplateRef('searchInput');\n\t\tconst showSearchBtn = ref(true);\n\t\tconst showSearchBar = ref(false);\n\t\tconst isFocus = ref(false);\n\n\t\tconst placeholderOrDefaultValue = computed((): string => {\n\t\t\tif (props.placeholder)\n\t\t\t{\n\t\t\t\treturn props.placeholder;\n\t\t\t}\n\n\t\t\treturn loc.getMessage('UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_PLACEHOLDER');\n\t\t});\n\n\t\tconst searchInputClassNames = computed((): { [string]: boolean } => ({\n\t\t\t[SEARCH_INPUT_CLASS_NAMES.base]: true,\n\t\t\t[SEARCH_INPUT_CLASS_NAMES.open]: toValue(showSearchBar),\n\t\t\t[SEARCH_INPUT_CLASS_NAMES.focus]: toValue(isFocus),\n\t\t}));\n\n\t\tfunction onInput(event: InputEvent): void\n\t\t{\n\t\t\tif (props.disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\temit('update:value', event.target.value);\n\t\t}\n\n\t\tfunction onClear(event: MouseEvent): void\n\t\t{\n\t\t\tevent.stopPropagation();\n\n\t\t\tif (props.disabled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tshowSearchBar.value = false;\n\t\t\temit('clear');\n\t\t}\n\n\t\tfunction onAfterEnterTransition(): void\n\t\t{\n\t\t\tnextTick(() => {\n\t\t\t\tisFocus.value = true;\n\t\t\t\ttoValue(searchInput)?.focus();\n\t\t\t});\n\t\t}\n\n\t\tfunction onLeaveTransition(): void\n\t\t{\n\t\t\tshowSearchBtn.value = true;\n\t\t\temit('update:open', false);\n\t\t}\n\n\t\tfunction onOpenSearchBar(): void\n\t\t{\n\t\t\tshowSearchBar.value = true;\n\t\t\tshowSearchBtn.value = false;\n\n\t\t\temit('update:open', true);\n\t\t}\n\n\t\tfunction onClickSearchInput(): void\n\t\t{\n\t\t\tisFocus.value = true;\n\t\t\ttoValue(searchInput)?.focus();\n\t\t}\n\n\t\tfunction onBlurSearchInput(): void\n\t\t{\n\t\t\tisFocus.value = false;\n\t\t}\n\n\t\tfunction collapseSearchBar(): void\n\t\t{\n\t\t\tshowSearchBar.value = false;\n\t\t}\n\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t\tshowSearchBar,\n\t\t\tshowSearchBtn,\n\t\t\tplaceholderOrDefaultValue,\n\t\t\tsearchInputClassNames,\n\t\t\tonInput,\n\t\t\tonClear,\n\t\t\tonAfterEnterTransition,\n\t\t\tonLeaveTransition,\n\t\t\tonOpenSearchBar,\n\t\t\tonClickSearchInput,\n\t\t\tonBlurSearchInput,\n\t\t\tcollapseSearchBar,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<OpenSearchBtn\n\t\t\tv-show=\"showSearchBtn\"\n\t\t\t:data-test-id=\"$blockDiagramTestId('searchOpenBtn')\"\n\t\t\t@click=\"onOpenSearchBar\"\n\t\t/>\n\t\t<transition\n\t\t\tname=\"ui-block-diagram-search-bar-fade\"\n\t\t\tenter-active-class=\"ui-block-diagram-open-search-bar\"\n\t\t\tleave-active-class=\"ui-block-diagram-close-search-bar\"\n\t\t\t@after-enter=\"onAfterEnterTransition\"\n\t\t\t@after-leave=\"onLeaveTransition\"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-show=\"showSearchBar\"\n\t\t\t\t:class=\"searchInputClassNames\"\n\t\t\t\tref=\"searchBar\"\n\t\t\t\t@click=\"onClickSearchInput\"\n\t\t\t>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name=\"iconSet.SEARCH\"\n\t\t\t\t\t:size=\"20\"\n\t\t\t\t\tclass=\"ui-block-diagram-search-input__icon\"\n\t\t\t\t/>\n\t\t\t\t<input\n\t\t\t\t\t:value=\"value\"\n\t\t\t\t\t:placeholder=\"placeholderOrDefaultValue\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('searchInput')\"\n\t\t\t\t\tref=\"searchInput\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tclass=\"ui-block-diagram-search-input__input\"\n\t\t\t\t\t@input=\"onInput\"\n\t\t\t\t\t@blur=\"onBlurSearchInput\"\n\t\t\t\t/>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-block-diagram-search-input__clear-btn\"\n\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('searchClearInputBtn')\"\n\t\t\t\t\t@click=\"onClear\"\n\t\t\t\t>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name=\"iconSet.CROSS_L\"\n\t\t\t\t\t\t:size=\"20\"\n\t\t\t\t\t\tclass=\"ui-block-diagram-search-input__clear-btn-icon\"\n\t\t\t\t\t/>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</transition>\n\t`,\n};\n","import './search-bar.css';\nimport { Event } from 'main.core';\nimport {\n\tref,\n\twatch,\n\ttoValue,\n\tcomputed,\n\tonMounted,\n\tonUnmounted,\n\tuseTemplateRef,\n} from 'ui.vue3';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport {\n\tuseBlockDiagram,\n\tuseSearchBlocks,\n\tuseCanvas,\n\tuseHighlightedBlocks,\n\tuseLoc,\n} from '../../composables';\nimport type { DiagramBlock } from '../../types';\nimport { SearchResult } from './search-result';\nimport { SearchNavBtn } from './search-nav-btn';\nimport { SearchInput } from './search-input';\nimport { OpenSearchBtn } from './open-search-btn';\n\ntype SearchBarSetup = {\n\ticonSet: { ... };\n\tplaceholderOrDefaultValue: string;\n\tsearchResultTitleOrDefaultValue: string;\n\tseachText: string;\n\tlabelResult: string;\n\tfoundBlocks: Array<DiagramBlock>;\n\tonInputSearchText: (event: MouseEvent) => void;\n\tonClearSearch: () => void;\n\tgoToNextBlock: () => void;\n\tgoToPrevBlock: () => void;\n}\n\nconst SEARCH_BAR_CLASS_NAMES = {\n\tbase: 'ui-block-diagram-search-bar',\n\topened: '--opened',\n};\n\n// @vue/component\nexport const SearchBar = {\n\tname: 'SearchBar',\n\tcomponents: {\n\t\tSearchResult,\n\t\tSearchNavBtn,\n\t\tSearchInput,\n\t\tOpenSearchBtn,\n\t},\n\tprops: {\n\t\tsearchResultTitle: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tsearchCallback: {\n\t\t\ttype: Function,\n\t\t\trequired: true,\n\t\t\tdefault: (block, text) => {\n\t\t\t\treturn block.node.title\n\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t.includes(text.toLowerCase());\n\t\t\t},\n\t\t},\n\t\tsearchDelay: {\n\t\t\ttype: Number,\n\t\t\tdefault: 300,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\t// eslint-disable-next-line max-lines-per-function\n\tsetup(props): SearchBarSetup\n\t{\n\t\tconst {\n\t\t\tseachText,\n\t\t\tfoundBlocks,\n\t\t\tonSearchBlocks,\n\t\t\tonClearSearch,\n\t\t} = useSearchBlocks({\n\t\t\tsearchCallback: props.searchCallback,\n\t\t\tdelay: props.searchDelay,\n\t\t});\n\t\tconst { isDisabledBlockDiagram } = useBlockDiagram();\n\t\tconst highlitedBlocks = useHighlightedBlocks();\n\t\tconst loc = useLoc();\n\t\tconst { goToBlockById } = useCanvas();\n\t\tconst searchPanel = useTemplateRef('searchPanel');\n\t\tconst searchInputRef = useTemplateRef('searchInput');\n\t\tconst currentBlockIndex = ref(0);\n\n\t\tconst isOpenedSearchBar = ref(false);\n\n\t\tconst isDisabled = computed((): boolean => {\n\t\t\treturn props.disabled || toValue(isDisabledBlockDiagram);\n\t\t});\n\n\t\tconst labelResult = computed(() => {\n\t\t\treturn `${currentBlockIndex.value + 1} / ${toValue(foundBlocks).length}`;\n\t\t});\n\n\t\tconst placeholderOrDefaultValue = computed((): string => {\n\t\t\tif (props.placeholder)\n\t\t\t{\n\t\t\t\treturn props.placeholder;\n\t\t\t}\n\n\t\t\treturn loc.getMessage('UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_PLACEHOLDER');\n\t\t});\n\n\t\tconst searchResultTitleOrDefaultValue = computed((): string => {\n\t\t\tif (props.searchResultTitle)\n\t\t\t{\n\t\t\t\treturn props.searchResultTitle;\n\t\t\t}\n\n\t\t\treturn loc.getMessage('UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_RESULT_TITLE');\n\t\t});\n\n\t\tconst searchBarClassNames = computed((): { [string]: boolean } => ({\n\t\t\t[SEARCH_BAR_CLASS_NAMES.base]: true,\n\t\t\t[SEARCH_BAR_CLASS_NAMES.opened]: toValue(isOpenedSearchBar),\n\t\t}));\n\n\t\twatch(foundBlocks, (newBlocks) => {\n\t\t\tcurrentBlockIndex.value = 0;\n\n\t\t\tif (toValue(newBlocks).length > 0)\n\t\t\t{\n\t\t\t\tconst id = toValue(newBlocks)[0].id;\n\t\t\t\thighlitedBlocks.clear();\n\t\t\t\thighlitedBlocks.add(id);\n\t\t\t\tgoToBlockById(id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thighlitedBlocks.clear();\n\t\t\t}\n\t\t});\n\n\t\tonMounted(() => {\n\t\t\tEvent.bind(document, 'mousedown', onClickOutside);\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\tEvent.unbind(document, 'mousedown', onClickOutside);\n\t\t});\n\n\t\tfunction onGoToNextBlock(): void\n\t\t{\n\t\t\tif (toValue(isDisabled))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcurrentBlockIndex.value += 1;\n\n\t\t\tif (toValue(currentBlockIndex) > toValue(foundBlocks).length - 1)\n\t\t\t{\n\t\t\t\tcurrentBlockIndex.value = 0;\n\t\t\t}\n\n\t\t\tconst id = toValue(foundBlocks)[toValue(currentBlockIndex)].id;\n\t\t\thighlitedBlocks.clear();\n\t\t\thighlitedBlocks.add(id);\n\t\t\tgoToBlockById(id);\n\t\t}\n\n\t\tfunction onGoToPrevBlock(): void\n\t\t{\n\t\t\tif (toValue(isDisabled))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcurrentBlockIndex.value -= 1;\n\n\t\t\tif (toValue(currentBlockIndex) < 0)\n\t\t\t{\n\t\t\t\tcurrentBlockIndex.value = toValue(foundBlocks).length - 1;\n\t\t\t}\n\n\t\t\tconst id = toValue(foundBlocks)[toValue(currentBlockIndex)].id;\n\t\t\thighlitedBlocks.clear();\n\t\t\thighlitedBlocks.add(id);\n\t\t\tgoToBlockById(toValue(foundBlocks)[toValue(currentBlockIndex)].id);\n\t\t}\n\n\t\tfunction closeAndResetSearch(): void\n\t\t{\n\t\t\thighlitedBlocks.clear();\n\t\t\tonClearSearch();\n\t\t\tcurrentBlockIndex.value = 0;\n\t\t}\n\n\t\tfunction onClickOutside(event: MouseEvent): void\n\t\t{\n\t\t\tif (toValue(searchPanel) && !toValue(searchPanel).contains(event.target))\n\t\t\t{\n\t\t\t\tcloseAndResetSearch();\n\t\t\t\ttoValue(searchInputRef)?.collapseSearchBar();\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ticonSet: Outline,\n\t\t\tsearchBarClassNames,\n\t\t\tisOpenedSearchBar,\n\t\t\tisDisabled,\n\t\t\tplaceholderOrDefaultValue,\n\t\t\tsearchResultTitleOrDefaultValue,\n\t\t\tseachText,\n\t\t\tlabelResult,\n\t\t\tfoundBlocks,\n\t\t\tonSearchBlocks,\n\t\t\tonClearSearch,\n\t\t\tcloseAndResetSearch,\n\t\t\tonGoToNextBlock,\n\t\t\tonGoToPrevBlock,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:class=\"searchBarClassNames\"\n\t\t\tref=\"searchPanel\"\n\t\t>\n\t\t\t<SearchInput\n\t\t\t\tv-model:open=\"isOpenedSearchBar\"\n\t\t\t\t:value=\"seachText\"\n\t\t\t\t:placeholder=\"placeholderOrDefaultValue\"\n\t\t\t\t:disabled=\"isDisabled\"\n\t\t\t\tref=\"searchInput\"\n\t\t\t\t@update:value=\"onSearchBlocks\"\n\t\t\t\t@clear=\"closeAndResetSearch\"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tv-if=\"foundBlocks.length > 0\"\n\t\t\t\tclass=\"ui-block-diagram-search-bar__search-result\"\n\t\t\t>\n\t\t\t\t<SearchResult\n\t\t\t\t\t:title=\"searchResultTitleOrDefaultValue\"\n\t\t\t\t\t:count=\"labelResult\"\n\t\t\t\t>\n\t\t\t\t\t<SearchNavBtn\n\t\t\t\t\t\t:iconName=\"iconSet.CHEVRON_LEFT_L\"\n\t\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('searchResultPrevBtn')\"\n\t\t\t\t\t\t@click=\"onGoToPrevBlock\"\n\t\t\t\t\t/>\n\t\t\t\t\t<SearchNavBtn\n\t\t\t\t\t\t:iconName=\"iconSet.CHEVRON_RIGHT_L\"\n\t\t\t\t\t\t:data-test-id=\"$blockDiagramTestId('searchResultNextBtn')\"\n\t\t\t\t\t\t@click=\"onGoToNextBlock\"\n\t\t\t\t\t/>\n\t\t\t\t</SearchResult>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import './resizable-block.css';\nimport {\n\ttoValue,\n\ttoRefs,\n\tuseTemplateRef,\n\tcomputed,\n\twatch,\n\tonMounted,\n\tonUnmounted,\n} from 'ui.vue3';\nimport {\n\tuseMoveableBlock,\n\tuseResizableBlock,\n\tuseBlockState,\n\tuseHighlightedBlocks,\n} from '../../composables';\n\n// @vue/component\nexport const ResizableBlock = {\n\tname: 'resizable-block',\n\tprops: {\n\t\t/** @type DiagramBlock */\n\t\tblock: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tminWidth: {\n\t\t\ttype: Number,\n\t\t\tdefault: 100,\n\t\t},\n\t\tminHeight: {\n\t\t\ttype: Number,\n\t\t\tdefault: 100,\n\t\t},\n\t\thighlighted: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tsetup(props): {...}\n\t{\n\t\tconst { block, minWidth, minHeight } = toRefs(props);\n\t\tconst { isHiglitedBlock, isDisabled } = useBlockState(block);\n\t\tconst highlightedBlocks = useHighlightedBlocks();\n\t\tconst { isDragged, blockPositionStyle } = useMoveableBlock(\n\t\t\tuseTemplateRef('blockEl'),\n\t\t\tblock,\n\t\t);\n\t\tconst {\n\t\t\tisResize,\n\t\t\tsizeBlockStyle,\n\t\t\tonMounted: onMountedResizableBlock,\n\t\t\tonUnmounted: onUnmountedResizableBlock,\n\t\t} = useResizableBlock({\n\t\t\tblock,\n\t\t\tminWidth,\n\t\t\tminHeight,\n\t\t\tleftSideRef: useTemplateRef('leftSide'),\n\t\t\ttopSideRef: useTemplateRef('topSide'),\n\t\t\trightSideRef: useTemplateRef('rightSide'),\n\t\t\tbottomSideRef: useTemplateRef('bottomSide'),\n\t\t\tleftTopCornerRef: useTemplateRef('leftTopCorner'),\n\t\t\trightTopCornerRef: useTemplateRef('rightTopCorner'),\n\t\t\trightBottomCornerRef: useTemplateRef('rightBottomCorner'),\n\t\t\tleftBottomCornerRef: useTemplateRef('leftBottomCorner'),\n\t\t});\n\n\t\tconst blockStyle = computed(() => {\n\t\t\treturn {\n\t\t\t\t...toValue(blockPositionStyle),\n\t\t\t\t...toValue(sizeBlockStyle),\n\t\t\t};\n\t\t});\n\n\t\twatch(() => props.highlighted, (value) => {\n\t\t\tif (value)\n\t\t\t{\n\t\t\t\thighlightedBlocks.add(props.block.id);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thighlightedBlocks.remove(props.block.id);\n\t\t\t}\n\t\t});\n\n\t\tonMounted(() => {\n\t\t\tonMountedResizableBlock();\n\t\t});\n\n\t\tonUnmounted(() => {\n\t\t\thighlightedBlocks.remove(props.block.id);\n\t\t\tonUnmountedResizableBlock();\n\t\t});\n\n\t\tfunction onMouseDownSelectBlock(): void\n\t\t{\n\t\t\thighlightedBlocks.clear();\n\t\t\thighlightedBlocks.add(props.block.id);\n\t\t}\n\n\t\treturn {\n\t\t\tisHiglitedBlock,\n\t\t\tisDisabled,\n\t\t\tisResize,\n\t\t\tisDragged,\n\t\t\tblockStyle,\n\t\t\tonMouseDownSelectBlock,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\t:style=\"blockStyle\"\n\t\t\tref=\"blockEl\"\n\t\t\tclass=\"ui-block-diagram-resizable-block\"\n\t\t\t@mousedown=\"onMouseDownSelectBlock\"\n\t\t>\n\t\t\t<div class=\"ui-block-diagram-resizable-block__container\">\n\t\t\t\t<div\n\t\t\t\t\tref=\"leftSide\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__left-side\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"topSide\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__top-side\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"rightSide\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__right-side\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"bottomSide\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__bottom-side\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"leftTopCorner\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__top-left-corner\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"rightTopCorner\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__top-right-corner\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"rightBottomCorner\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__bottom-right-corner\"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref=\"leftBottomCorner\"\n\t\t\t\t\tclass=\"ui-block-diagram-resizable-block__bottom-left-corner\"\n\t\t\t\t/>\n\n\t\t\t\t<slot\n\t\t\t\t\t:block=\"block\"\n\t\t\t\t\t:isHighlighted=\"isHiglitedBlock\"\n\t\t\t\t\t:isDragged=\"isDragged\"\n\t\t\t\t\t:isResize=\"isResize\"\n\t\t\t\t\t:isDisabled=\"isDisabled\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { toValue, watch } from 'ui.vue3';\nimport {\n\tuseHighlightedBlocks,\n\tuseGroupSelectionLogic,\n\tuseGroupDragLogic,\n\tuseContextMenu,\n\tuseBlockDiagram,\n} from '../../composables';\n\nconst DEFAULT_SELECTION_PADDING = 17;\nconst DEFAULT_BLOCK_SIZE = { width: 150, height: 100 };\n\nexport const GroupSelectionBox = {\n\tname: 'GroupSelectionBox',\n\tprops: {\n\t\tmenuItems: {\n\t\t\ttype: Array,\n\t\t\tdefault: () => [],\n\t\t},\n\t\tpadding: {\n\t\t\ttype: [Number, Object],\n\t\t\tdefault: DEFAULT_SELECTION_PADDING,\n\t\t},\n\t\tdefaultBlockSize: {\n\t\t\ttype: Object,\n\t\t\tdefault: DEFAULT_BLOCK_SIZE,\n\t\t},\n\t},\n\tsetup(props)\n\t{\n\t\tconst highlightedBlocks = useHighlightedBlocks();\n\t\tconst { selectionWorldRect, isSelectionActive } = useBlockDiagram();\n\t\tconst { showContextMenu, setOptions, closeContextMenu } = useContextMenu();\n\t\tconst {\n\t\t\tonCanvasSelect,\n\t\t\tonSelectionStart,\n\t\t\tgroupSelectionStyle,\n\t\t} = useGroupSelectionLogic(\n\t\t\tcloseContextMenu,\n\t\t\t{\n\t\t\t\tpadding: props.padding,\n\t\t\t\tdefaultBlockSize: props.defaultBlockSize,\n\t\t\t},\n\t\t);\n\n\t\twatch(selectionWorldRect, (newRect) => {\n\t\t\tonCanvasSelect(newRect);\n\t\t});\n\n\t\twatch(isSelectionActive, (isActive) => {\n\t\t\tif (isActive)\n\t\t\t{\n\t\t\t\tonSelectionStart();\n\t\t\t}\n\t\t});\n\n\t\tconst { onGroupMouseDown } = useGroupDragLogic(\n\t\t\tcloseContextMenu,\n\t\t);\n\n\t\tfunction onGroupContextMenu(event): void\n\t\t{\n\t\t\tconst ids = toValue(highlightedBlocks.highlitedBlockIds);\n\t\t\tif (!ids || ids.length === 0 || props.menuItems.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsetOptions({ items: props.menuItems });\n\t\t\tshowContextMenu({ clientX: event.clientX, clientY: event.clientY });\n\t\t}\n\n\t\treturn {\n\t\t\tgroupSelectionStyle,\n\t\t\tonGroupMouseDown,\n\t\t\tonGroupContextMenu,\n\t\t};\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tv-if=\"groupSelectionStyle\"\n\t\t\t:style=\"groupSelectionStyle\"\n\t\t\tclass=\"ui-block-diagram-group-box\"\n\t\t\t@mousedown=\"onGroupMouseDown\"\n\t\t\t@contextmenu.prevent.stop=\"onGroupContextMenu\"\n\t\t></div>\n\t`,\n};\n","import { Dom, Type, Event, Tag } from 'main.core';\nimport { toValue } from 'ui.vue3';\nimport type { DragData } from '../types';\n\nlet copiedDragItem = null;\n\nfunction onDragStart(event: MouseEvent, value: DragData | () => DragData): void\n{\n\tconst { dragData, dragImage } = Type.isFunction(value)\n\t\t? value()\n\t\t: value;\n\n\tcopiedDragItem = toValue(dragImage).cloneNode(true).children[0];\n\n\tconst wrapper = document.getElementById('blockDiagramDragWrapper');\n\tDom.append(copiedDragItem, wrapper);\n\n\tDom.style(copiedDragItem, {\n\t\tdisplay: 'block',\n\t\tposition: 'absolute',\n\t\ttop: 0,\n\t\tleft: 0,\n\t});\n\n\tconst { width, height } = copiedDragItem.getBoundingClientRect();\n\n\tevent.dataTransfer.setDragImage(\n\t\tcopiedDragItem,\n\t\twidth / 2,\n\t\theight / 2,\n\t);\n\n\tevent.dataTransfer.setData('text/plain', JSON.stringify({\n\t\t...toValue(dragData),\n\t\tdimensions: {\n\t\t\twidth,\n\t\t\theight,\n\t\t},\n\t}));\n}\n\nfunction onDragEnd(event: MouseEvent): void\n{\n\tDom.remove(copiedDragItem);\n\tcopiedDragItem = null;\n}\n\nfunction initDragItemWrapper(): void\n{\n\tconst hasWrapper = document.getElementById('blockDiagramDragWrapper');\n\n\tif (hasWrapper)\n\t{\n\t\treturn;\n\t}\n\n\tconst wrapper = Tag.render`\n\t\t<div>\n\t\t\t<div\n\t\t\t\tid=\"blockDiagramDragWrapper\"\n\t\t\t\tstyle=\"position: relative; width: 100%; height: 100%;\"\n\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\t`;\n\tDom.append(wrapper, document.body);\n\tDom.style(wrapper, {\n\t\tposition: 'absolute',\n\t\ttransform: 'translate(-100%, -100%)',\n\t\ttop: 0,\n\t\tright: 0,\n\t});\n}\n\nexport const DragBlock = {\n\tmounted(el, { arg, value }): void\n\t{\n\t\tinitDragItemWrapper();\n\t\tDom.attr(el, 'draggable', 'true');\n\t\tEvent.bind(el, 'dragstart', (event: MouseEvent) => onDragStart(event, value));\n\t\tEvent.bind(el, 'dragend', (event: MouseEvent) => onDragEnd());\n\t},\n\tunmounted(el, { arg, value })\n\t{\n\t\tEvent.unbind(el, 'dragstart', (event: MouseEvent) => onDragStart(event, value));\n\t\tEvent.unbind(el, 'dragend', (event: MouseEvent) => onDragEnd(event));\n\t},\n};\n"],"names":["useState","blockDiagramRef","blockDiagramTop","blockDiagramLeft","cursorType","isResizing","isDisabled","blocks","connections","portsElMap","markRaw","Map","portsRectMap","newConnection","isValidNewConnection","movingBlock","movingConnections","resizingBlock","canvasRef","transformLayoutRef","canvasInstance","canvasWidth","canvasHeight","transformX","transformY","viewportX","viewportY","zoom","minZoom","maxZoom","contextMenuLayerRef","targetContainerRef","isOpenContextMenu","contextMenuInstance","positionContextMenu","top","left","historyCurrentState","headSnapshot","tailSnapshot","currentSnapshot","maxCountSnapshots","snapshotHandler","revertHandler","highlitedBlockIds","isSelectionActive","selectionWorldRect","animationQueue","currentAnimationItem","isPauseAnimation","isStopAnimation","NODE_HEADER_HEIGHT","NODE_CONTENT_HEADER_HEIGHT","STICKING_DISTANCE","HOOK_NAMES","CHANGED_BLOCKS","CHANGED_CONNECTIONS","START_DRAG_BLOCK","MOVE_DRAG_BLOCK","END_DRAG_BLOCK","ADD_BLOCK","UPDATE_BLOCK","DELETE_BLOCK","CREATE_CONNECTION","DELETE_CONNECTION","BLOCK_TRANSITION_START","BLOCK_TRANSITION_END","CONNECTION_TRANSITION_START","CONNECTION_TRANSITION_END","DROP_NEW_BLOCK","NODE_TYPES","SIMPLE","TRIGGER","COMPLEX","BLOCK_GROUP_DEFAULT_NAME","CONNECTION_GROUP_DEFAULT_NAME","PORT_POSITION","TOP","BOTTOM","RIGHT","LEFT","ANIMATED_TYPES","BLOCK","CONNECTION","REMOVE_BLOCK","REMOVE_CONNECTION","CURSOR_TYPES","EW_RESIZE","NS_RESIZE","NWSE_RESIZE","NESW_RESIZE","BLOCK_INDEXES","HIGHLITED","MOVABLE","STANDING","RESIZABLE","DIR_ACCESSOR_X","DIR_ACCESSOR_Y","DIRECTIONS_BY_POSITION","x","y","BEZIER_DIR","VERTICAL","HORIZONTAL","getBeziePath","start","end","dir","midX","midY","centerX","centerY","getConnectionCenter","sourceX","sourceY","targetX","targetY","path","center","transformPoint","point","transform","viewport","transformedX","Math","round","transformedY","xOffset","abs","yOffset","getDirection","source","sourcePosition","target","distance","a","b","sqrt","getPoints","targetPosition","offset","sourceDir","targetDir","sourceGapped","targetGapped","dirAccessor","currDir","points","sourceGapOffset","targetGapOffset","defaultCenterX","defaultCenterY","defaultOffsetX","defaultOffsetY","verticalSplit","horizontalSplit","sourceTarget","targetSource","diff","gapOffset","min","dirSource","dirTarget","dirAccessorOpposite","isSameDir","sourceGtTargetOppo","sourceLtTargetOppo","isFlipSourceTarget","sourceGapPoint","targetGapPoint","maxXDistance","max","maxYDistance","pathPoints","offsetX","offsetY","getBend","c","size","bendSize","xDir","yDir","getSmoothStepPath","params","borderRadius","pointsCenterX","pointsCenterY","reduce","res","p","i","segment","length","ARRAY_COMMANDS","Object","freeze","REPLACE","PUSH","UPDATE_BY_INDEX","DELETE_BY_INDEX","commandExecMap","payload","result","push","index","splice","command","commandType","args","commandReplace","commandPush","commandUpdateByIndex","commandDeleteByIndex","runCommand","sourceArray","commandPayload","callback","createHook","handlers","Set","on","handler","Type","isFunction","has","add","off","delete","trigger","getGroupBlockSlotName","group","getGroupConnectionSlotName","EPSILON","ARRAY_TYPE","Float32Array","Array","degree","PI","hypot","arguments","create","out","glMatrix","copy","identity","invert","a00","a01","a02","a10","a11","a12","a20","a21","a22","b01","b11","b21","det","multiply","b00","b02","b10","b12","b20","b22","translate","v","rotate","rad","s","sin","cos","scale","projection","width","height","z","fromValues","normalize","len","dot","cross","ax","ay","az","bx","by","bz","forEach","vec","stride","count","fn","arg","l","w","setAxisAngle","axis","slerp","t","aw","bw","omega","cosom","sinom","scale0","scale1","acos","fromMat3","m","fTrace","fRoot","j","k","vec4","rotationTo","tmpvec3","vec3","xUnitVec3","yUnitVec3","sqlerp","temp1","temp2","d","setAxes","matr","mat3","view","right","up","transformMat3","Camera","constructor","options","onChangeCallback","updateMatrix","projectionMatrix","viewMatrix","viewProjectionMatrix","viewProjectionMatrixInv","matrix","rotation","setChangeTransformCallback","clone","camera","updateViewProjectionMatrix","zoomScale","createLandmark","viewportToCanvas","canvas","vec2","applyLandmark","landmark","useFixedViewport","preZoomX","preZoomY","postZoomX","postZoomY","Canvas","window","devicePixelRatio","ref","canvasStyle","clientToViewport","getBoundingClientRect","viewportToClient","render","setCamera","zoomIn","zoomStep","zoomOut","setCameraZoomByWheel","event","zoomChange","newZoom","deltaY","clientX","clientY","setCameraPositionByWheel","deltaX","setCameraPositionByMouseDown","setCameraPositionByMouseMove","pos","destroy","unobserve","StyleInstance","instance","ResizeObserver","entries","entry","contentRect","observe","Number","toFixed","cssX","cssY","normalizedX","clientWidth","normalizedY","clientHeight","clipX","clipY","vertexShader","fragmentShader","compileShader","gl","shaderSource","shaderType","shader","createShader","success","getShaderParameter","COMPILE_STATUS","Error","getShaderInfoLog","createProgram","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","createBufferFromTypedArray","array","type","drawType","bufferType","ARRAY_BUFFER","buffer","createBuffer","bindBuffer","bufferData","STATIC_DRAW","convHex","hex","preHex","replace","r","parseInt","slice","g","Grid","clearColor","clear","COLOR_BUFFER_BIT","useProgram","gridColor","uniformMatrix3fv","uniform4f","uniform1f","enableVertexAttribArray","vertexAttribPointer","FLOAT","drawArrays","TRIANGLE_STRIP","deleteProgram","deleteShader","getContext","getExtension","gridShaders","VERTEX_SHADER","FRAGMENT_SHADER","getAttribLocation","getUniformLocation","zoomSteps","sort","stepA","stepB","map","step","gridColorAlpha","backgroundColor","useHistory","commonSnapshotHandler","newState","JSON","parse","stringify","commonRevertHandler","snapshot","hooks","changedBlocks","commandToArray","changedConnections","commonEmptyHistorySnapshot","useBlockDiagram","setHistoryHandlers","newSnapshotHandler","newRevertHandler","emptyHistorySnapshot","maxCount","setHandlers","value","toValue","hasNext","computed","next","hasPrev","prev","newHandlerOptions","handlerOptions","getCountSnapshots","current","makeSnapshot","emptySnapshot","newEmptySnapshot","snapshotHistoryHandler","revertHistoryHandler","newSnapshot","firstSnapshot","revertState","nextTick","useActions","state","getters","setState","transfrom","updateCanvasTransform","isExistConnection","connection","sourceBlockId","sourcePortId","targetBlockId","targetPortId","some","exSourceBlockId","exSourcePortId","exTargetBlockId","exTargetPortId","isSource","isTarget","addConnection","createConnection","deleteConnectionById","connectionId","filter","id","deleteConnection","deleteConnectionByBlockIdAndPortId","blockId","portId","block","find","stateBlock","portIdMap","ports","input","output","port","newConnections","deleteBlockById","blockIndex","findIndex","deleteBlock","addBlock","updateBlockPositionByIndex","position","updateBlock","newBlock","getPortAbsolutePosition","blockX","blockY","dimensions","node","nodeType","portOffsetY","portX","isOutputPort","outputPort","findNearestPort","nearest","nearestDistance","Infinity","dx","dy","transformEventToPoint","setMovingBlock","toRaw","updateMovingBlockPosition","resetMovingBlock","setPortOffsetByBlockId","offsets","portRect","updatePortPosition","hasBlock","hasPort","get","setSelectionActive","setSelectionWorldRect","rect","useGetters","canvasId","isMakeNewConnection","groupedBlocks","acc","blockGroupNames","keys","groupedConnections","connectionGroupNames","isAnimate","isDisabledBlockDiagram","useHooks","app","getCurrentInstance","appContext","blockDiagramState","config","globalProperties","$blockDiagram","reactiveState","reactive","actions","toRefs","$blockDiagramTestId","preparedArgs","useContextMenu","menuItems","shallowRef","MenuManager","getMenuOptions","isOpen","items","setOptions","newOptions","getItems","item","onclick","closeMenu","additionalOptions","bindElement","minWidth","autoHide","draggable","cacheable","targetContainer","setDestroyHandler","popupWindow","subscribeOnce","showMenu","menuOptions","show","close","showContextMenu","isArrayFilled","closeContextMenu","useNewConnection","validationRules","normalyzeConnectionFn","isSourcePort","isValid","validateNewConnection","rules","isArray","every","rule","normalyzeNewConnection","normalyzeFn","onMouseDownPort","stopPropagation","startPosition","Text","getRandom","sourcePort","sourcePortPosition","targetPort","Event","bind","document","onMouseMove","onMouseUp","isSamePort","hasSourceIds","hasTargetIds","unbind","onMouseOverPort","onMouseLeavePort","useBlockState","isHiglitedBlock","includes","blockZindex","zIndex","updatePortsPositions","useMoveableBlock","blockRef","isDragged","allBlocksRef","prevValueBlockX","prevValueBlockY","offsetBlockX","offsetBlockY","cachedGroupBlocks","watchEffect","blockPositionStyle","onMounted","onMouseDown","onBeforeUnmount","button","selectedIds","isSelected","startDragBlock","groupIds","allBlocks","moveDragBlock","newX","newY","targetBlock","positionX","positionY","isMoved","finalX","finalY","newBlockState","endDragBlock","currentBlockState","useModelValue","emit","handlersMap","handleChangeBlocks","handleChangeConnections","hookName","dispose","useWatchProps","props","scope","effectScope","run","watch","newBlocks","immediate","deep","newMinZoom","newMaxZoom","disabled","stop","useRegisterHooks","hooksMaps","mergedHookMaps","accHookMaps","hookMap","DEFAULT_OPTIONS","searchCallback","delay","useSearchBlocks","optionParams","seachText","foundBlocks","onSearchBlocks","searchText","trim","onClearSearch","debounce","useCanvas","goToBlockById","useHighlightedBlocks","set","blockIds","remove","highlitedIndx","indexOf","useLoc","bitrix","$bitrix","getMessage","messageId","replacements","Loc","usePortState","portRef","addPortElement","portEl","deletePortElement","addPortRect","deletePortRect","portsMap","onMountedPort","onUnmountedPort","DEFAULT_PATH_INFO","SMOOTHSTEP_OFFSET","SMOOTHSTEP_BORDER_RADIUS","useConnectionState","connectionPortsPosition","hasSourceBlockId","hasSourcePortId","hasTargetBlockId","hasTargetPortId","sourceWidth","sourceHeight","targetWidth","targetHeight","connectionPathInfo","isVerticalDirBezier","isHorizontalDirBezier","smoothStepPath","p1","p2","p3","p4","p5","p6","isXConsistOfThreeParts","isYConsistOfThreeParts","useInitAppElements","newBlockDiagramRef","observer","handleInterObserver","boundingClientRect","onMountedAppElements","IntersectionObserver","onUnmountedAppElements","useNewConnectionState","hasNewConnection","newConnectionPathInfo","isHorizontalBezier","useAnimationQueue","animateItem","animatedItem","animationQueueFn","animatedQueueItems","shouldAnimatedItems","setTimeout","play","pause","CANVAS_STYLE_DEFAULT_OPTIONS","grid","useCanvasTransfrom","newCanvasRef","newTransformLayoutRef","newCanvasStyle","zoomSensitivity","zoomSensitivityMouse","dragOn","isDragging","zooming","requestAnimationId","getCanvasStyleOptions","style","onUnmounted","cancelAnimationFrame","buttons","onWheel","preventDefault","isTrackpad","wheelDeltaY","deltaMode","ctrlKey","sign","Dom","requestAnimationFrame","useDragAndDrop","onDrop","dataString","dataTransfer","getData","receivedData","dropNewBlock","setBlockData","addedBlock","setData","useResizableBlock","minHeight","leftSideRef","topSideRef","rightSideRef","bottomSideRef","leftTopCornerRef","rightTopCornerRef","rightBottomCornerRef","leftBottomCornerRef","isResize","prevBlockX","prevBlockY","prevBlockWidth","prevBlockHeight","sizeBlockStyle","cursor","updateResizableBlock","onMouseDownRightSide","onMouseDownBottomSide","onMouseDownLeftSide","onMouseDownTopSide","onMouseDownRightTopCorner","onMouseDownRightBottomCorner","onMouseDownLeftTopCorner","onMouseDownLeftBottomCorner","startResize","curType","endResize","resizeTopSide","newHeight","fixedPositionY","resizeRightSide","cursorX","newWidth","resizeBottomSide","resizeLeftSide","fixedPositionX","onMouseMoveRightSide","onMouseUpRightSide","onMouseMoveBottomSide","onMouseUpBottomSide","onMouseMoveLeftSide","onMouseUpLeftSide","onMouseMoveTopSide","onMouseUpTopSide","onMouseMoveRightBottomCorner","onMouseUpRightBottomCorner","onMouseMoveRightTopCorner","onMouseUpRightTopCorner","onMouseMoveLeftBottomCorner","onMouseUpLeftBottomCorner","onMouseMoveLeftTopCorner","onMouseUpLeftTopCorner","useCanvasSelection","rootRef","selectionRect","startClientX","startClientY","cachedRootRect","cachedLayerRect","root","layer","visualStartX","visualStartY","move","currentZoom","currentVisualX","currentVisualY","startLayerX","startLayerY","currentLayerX","currentLayerY","isSelecting","useGroupDragLogic","uiBlocksRef","checkBoxDragStartX","checkBoxDragStartY","lastDeltaX","lastDeltaY","movingItems","onGroupMouseDown","ids","startX","startY","onGroupMouseMove","onGroupMouseUp","totalDeltaX","totalDeltaY","stepX","stepY","useGroupSelectionLogic","defaultBlockSize","getBlockDimensions","container","h","el","querySelector","offsetWidth","offsetHeight","getSelectionBoxPadding","pad","padding","isNumber","bottom","onCanvasSelect","worldRect","intersectingIds","isIntersecting","currentIds","nextIds","onSelectionStart","groupSelectionStyle","minX","minY","maxX","maxY","hasBlocks","CANVAS_TRANSFORM_CLASS_NAMES","base","dragging","grabbing","grab","KEY_SPACE","INPUT_TAGS","INPUT","TEXTAREA","SELECT","CanvasTransform","name","required","default","selectionEnabled","Boolean","emits","setup","useTemplateRef","isSpacePressed","isPanning","onMountedCanvasTransform","onUnmountedCanvasTransform","onPanStart","onPanMove","onPanEnd","onSelectionMove","onSelectionEnd","canvasTransformClassNames","onKeyDown","onKeyUp","isMiddleClick","isLeftClick","isSpace","shouldPan","shouldSelect","code","repeat","isInputActive","tagName","isContentEditable","openContextMenu","parentElement","template","TARGET_CONNECTION_CLASSES","active","Connection","barWidth","barHeight","contextMenuItems","loc","text","targetConnectionClasses","barPosition","onOpenContextMenu","DeleteConnectionBtn","components","BIcon","String","onDeleteConnection","iconSet","Outline","ContextMenuLayout","targetContainerStyle","BlocksQueueTransition","history","highlighted","nextAnimationItem","done","onBeforeEnter","blockTransitionStart","onEnter","onAfterEnter","blockTransitionEnd","onAfterLeave","GroupedBlocks","PATH_CLASS_NAMES","error","NewConnection","pathClassNames","ConnectionsQueueTransition","connectionTransitionStart","nextAnimatedItem","connectionTransitionEnd","GroupedConnections","MoveableBlock","highlightedBlocks","blockStyle","onMouseDownSelectBlock","PORT_CLASS_NAMES","Port","validator","values","Function","portClassNames","BLOCK_CONTENT_STUB_CLASS_NAMES","BlockContentStub","dragged","blockContentClassNames","onShowContextMenu","UI_CANVAS_GRID_COLOR","UI_CANVAS_BACKGROUND_COLOR","BLOCK_DIAGRAM_CLASS_NAMES","ewResize","nsResize","nwSeResize","neSwResize","BlockDiagram","historyHooks","enableGrouping","initAppElements","disposeModelValue","disposeWatchProps","disposeRegisterHooks","isGrabbing","blockDiagramClassNames","onDragEnter","onDragLeave","onDragDrop","IconButton","iconName","color","activeColor","buttonClassNames","buttonStyle","iconClassNames","HistoryBar","onNext","onPrev","ZOOM_TYPES","in","ZoomBtn","stepZoom","typeZoom","onZoom","zoomTypes","ZoomPercent","percent","CURSOR_RECT_STROKE_WIDTH","FIRST_EMPTY_BLOCK_ID","LAST_EMPTY_BLOCK_ID","CanvasMap","mapWidth","mapHeight","mapEl","mapElLeft","mapElTop","canvasMapStyle","preparedBlock","startDiagramX","startDiagramY","diagramWidth","diagramHeight","scaleMap","cursorRectWidth","cursorRectHeight","cursorRectPosition","updateCameraPosition","canvasX","canvasY","onMapMouseDown","onMapMouseMove","onMapMouseUp","CanvasMapBtn","btnStyle","scaleButton","VERTICAL_MAP_POSITION","GORIZONTAL_MAP_POSITION","MAP_CLASSES","POSITION_MAP_DEFAULT_VALUES","ZoomBar","positionMap","isShowMap","mapPositionClasses","isTop","toLowerCase","isLeft","onToggleMap","SearchResult","title","SearchNavBtn","OpenSearchBtn","SEARCH_INPUT_CLASS_NAMES","open","focus","SearchInput","placeholder","searchInput","showSearchBtn","showSearchBar","isFocus","placeholderOrDefaultValue","searchInputClassNames","onInput","onClear","onAfterEnterTransition","onLeaveTransition","onOpenSearchBar","onClickSearchInput","onBlurSearchInput","collapseSearchBar","SEARCH_BAR_CLASS_NAMES","opened","SearchBar","searchResultTitle","searchDelay","highlitedBlocks","searchPanel","searchInputRef","currentBlockIndex","isOpenedSearchBar","labelResult","searchResultTitleOrDefaultValue","searchBarClassNames","onClickOutside","onGoToNextBlock","onGoToPrevBlock","closeAndResetSearch","contains","ResizableBlock","onMountedResizableBlock","onUnmountedResizableBlock","DEFAULT_SELECTION_PADDING","DEFAULT_BLOCK_SIZE","GroupSelectionBox","newRect","isActive","onGroupContextMenu","copiedDragItem","onDragStart","dragData","dragImage","cloneNode","children","wrapper","getElementById","append","display","setDragImage","onDragEnd","initDragItemWrapper","hasWrapper","Tag","body","DragBlock","mounted","attr","unmounted"],"mappings":"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"}