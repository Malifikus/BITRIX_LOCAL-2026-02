this.BX=this.BX||{};(function(t,e,o,n,a,s){"use strict";function i(){return{blockDiagramRef:null,blockDiagramTop:0,blockDiagramLeft:0,cursorType:"default",isResizing:false,isDisabled:false,blocks:[],connections:[],portsElMap:s.markRaw(new Map),portsRectMap:{},newConnection:null,isValidNewConnection:true,movingBlock:null,movingConnections:[],resizingBlock:null,canvasRef:null,transformLayoutRef:null,canvasInstance:null,canvasWidth:0,canvasHeight:0,transformX:0,transformY:0,viewportX:0,viewportY:0,zoom:1,minZoom:.2,maxZoom:4,contextMenuLayerRef:null,targetContainerRef:null,isOpenContextMenu:false,contextMenuInstance:null,positionContextMenu:{top:0,left:0},historyCurrentState:s.markRaw({blocks:[],connections:[]}),headSnapshot:null,tailSnapshot:null,currentSnapshot:null,maxCountSnapshots:20,snapshotHandler:null,revertHandler:null,highlitedBlockIds:[],isSelectionActive:false,selectionWorldRect:null,animationQueue:null,currentAnimationItem:null,isPauseAnimation:false,isStopAnimation:false}}const l=46;const r=14;const c=5;const u={CHANGED_BLOCKS:"changedBlocks",CHANGED_CONNECTIONS:"changedConnections",START_DRAG_BLOCK:"startDragBlock",MOVE_DRAG_BLOCK:"moveDragBlock",END_DRAG_BLOCK:"endDragBlock",ADD_BLOCK:"addBlock",UPDATE_BLOCK:"updateBlock",DELETE_BLOCK:"deleteBlock",CREATE_CONNECTION:"createConnection",DELETE_CONNECTION:"deleteConnection",BLOCK_TRANSITION_START:"blockTransitionStart",BLOCK_TRANSITION_END:"blockTransitionEnd",CONNECTION_TRANSITION_START:"connectionTransitionStart",CONNECTION_TRANSITION_END:"connectionTransitionEnd",DROP_NEW_BLOCK:"dropNewBlock"};const d={SIMPLE:"simple",TRIGGER:"trigger",COMPLEX:"complex"};const p="default";const b="default";const v={TOP:"top",BOTTOM:"bottom",RIGHT:"right",LEFT:"left"};const m={BLOCK:"block",CONNECTION:"connection",REMOVE_BLOCK:"remove_block",REMOVE_CONNECTION:"remove_connection"};const f={EW_RESIZE:"ew-resize",NS_RESIZE:"ns-resize",NWSE_RESIZE:"nwse-resize",NESW_RESIZE:"nesw-resize"};const h={HIGHLITED:4,MOVABLE:3,STANDING:2,RESIZABLE:1};const g="x";const y="y";const B={[v.LEFT]:{x:-1,y:0},[v.RIGHT]:{x:1,y:0},[v.TOP]:{x:0,y:-1},[v.BOTTOM]:{x:0,y:1}};const P={VERTICAL:"vertical",HORIZONTAL:"horizontal"};function k(t,e,o=P.VERTICAL){const n=(t.x+e.x)/2;const a=(t.y+e.y)/2;const[s,i]=L({sourceX:t.x,sourceY:t.y,targetX:e.x,targetY:e.y});return{path:o===P.HORIZONTAL?`M ${t.x} ${t.y} C ${n} ${t.y}, ${n} ${e.y}, ${e.x} ${e.y}`:`M ${t.x} ${t.y} C ${t.x} ${a}, ${e.x} ${a}, ${e.x} ${e.y}`,center:{x:s,y:i}}}function V(t,e,o){let n=Math.round((t.x-e.x)/e.zoom);let a=Math.round((t.y-e.y)/e.zoom);n-=Math.round(o.left/e.zoom);a-=Math.round(o.top/e.zoom);return{x:n,y:a}}function L({sourceX:t,sourceY:e,targetX:o,targetY:n}){const a=Math.abs(o-t)/2;const s=o<t?o+a:o-a;const i=Math.abs(n-e)/2;const l=n<e?n+i:n-i;return[s,l,a,i]}function H({source:t,sourcePosition:e=v.BOTTOM,target:o}){if(e===v.LEFT||e===v.RIGHT){return t.x<o.x?{x:1,y:0}:{x:-1,y:0}}return t.y<o.y?{x:0,y:1}:{x:0,y:-1}}function x(t,e){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}function C({source:t,sourcePosition:e=v.BOTTOM,target:o,targetPosition:n=v.TOP,center:a,offset:s}){const i=B[e];const l=B[n];const r={x:t.x+i.x*s,y:t.y+i.y*s};const c={x:o.x+l.x*s,y:o.y+l.y*s};const u=H({source:r,sourcePosition:e,target:c});const d=u.x!==0?g:y;const p=u[d];let b=[];let m=0;let f=0;const h={x:0,y:0};const P={x:0,y:0};const[k,V,x,C]=L({sourceX:t.x,sourceY:t.y,targetX:o.x,targetY:o.y});if(i[d]*l[d]===-1){var S,F;m=(S=a.x)!=null?S:k;f=(F=a.y)!=null?F:V;const t=[{x:m,y:r.y},{x:m,y:c.y}];const e=[{x:r.x,y:f},{x:c.x,y:f}];if(i[d]===p){b=d===g?t:e}else{b=d===g?e:t}}else{const a=[{x:r.x,y:c.y}];const u=[{x:c.x,y:r.y}];if(d===g){b=i.x===p?u:a}else{b=i.y===p?a:u}if(e===n){const e=Math.abs(t[d]-o[d]);if(e<=s){const n=Math.min(s-1,s-e);if(i[d]===p){const e=r[d]>t[d]?-1:1;h[d]=e*n}else{const t=c[d]>o[d]?-1:1;P[d]=t*n}}}if(e!==n){const t=d===g?y:g;const e=i[d]===l[t];const o=r[t]>c[t];const n=r[t]<c[t];const s=i[d]===1&&(!e&&o||e&&n)||i[d]!==1&&(!e&&n||e&&o);if(s){b=d===g?a:u}}const v={x:r.x+h.x,y:r.y+h.y};const B={x:c.x+P.x,y:c.y+P.y};const k=Math.max(Math.abs(v.x-b[0].x),Math.abs(B.x-b[0].x));const V=Math.max(Math.abs(v.y-b[0].y),Math.abs(B.y-b[0].y));if(k>=V){m=(v.x+B.x)/2;f=b[0].y}else{m=b[0].x;f=(v.y+B.y)/2}}const w=[t,{x:r.x+h.x,y:r.y+h.y},...b,{x:c.x+P.x,y:c.y+P.y},o];return{points:w,offsetX:x,offsetY:C,centerX:m,centerY:f}}function S(t,e,o,n){const a=Math.min(x(t,e)/2,x(e,o)/2,n);const{x:s,y:i}=e;if(t.x===s&&s===o.x||t.y===i&&i===o.y){return`L${s} ${i}`}if(t.y===i){const e=t.x<o.x?-1:1;const n=t.y<o.y?1:-1;return`L ${s+a*e},${i}Q ${s},${i} ${s},${i+a*n}`}const l=t.x<o.x?1:-1;const r=t.y<o.y?-1:1;return`L ${s},${i+a*r}Q ${s},${i} ${s+a*l},${i}`}function F(t){const{sourceX:e,sourceY:o,sourcePosition:n=v.BOTTOM,targetX:a,targetY:s,targetPosition:i=v.TOP,borderRadius:l=5,centerX:r,centerY:c,offset:u=20}=t;const{points:d,centerX:p,centerY:b}=C({source:{x:e,y:o},sourcePosition:n,target:{x:a,y:s},targetPosition:i,center:{x:r,y:c},offset:u});const m=d.reduce(((t,e,o)=>{let n="";if(o>0&&o<d.length-1){n=S(d[o-1],e,d[o+1],l)}else{n=`${o===0?"M":"L"}${e.x} ${e.y}`}t+=n;return t}),"");return{path:m,points:d,center:{x:p,y:b}}}const w=Object.freeze({REPLACE:"replace",PUSH:"push",UPDATE_BY_INDEX:"updateByIndex",DELETE_BY_INDEX:"deleteByIndex"});const E={[w.REPLACE]:({payload:t})=>[...t],[w.PUSH]:({source:t,payload:e})=>{const o=[...t];o.push(e);return o},[w.UPDATE_BY_INDEX]:({source:t,payload:e,index:o})=>{const n=[...t];n[o]={...n[o],...e};return n},[w.DELETE_BY_INDEX]:({source:t,index:e})=>{const o=[...t];o.splice(e,1);return o}};function M(t,e){return{commandType:t,...e}}function I(t){return M(w.REPLACE,{payload:t})}function _(t){return M(w.PUSH,{payload:t})}function T(t,e){return M(w.UPDATE_BY_INDEX,{index:t,payload:e})}function O(t){return M(w.DELETE_BY_INDEX,{index:t})}function R(t,e,o){const{commandType:n,payload:a,index:s}=e;const i=E[n]({source:t,payload:a,index:s});o(i)}function D(){const t=new Set;const e=e=>{if(a.Type.isFunction(e)&&!t.has(e)){t.add(e)}};const o=e=>{t.delete(e)};const n=(...e)=>{for(const o of t){o(...e)}};return{on:e,off:o,trigger:n}}function N(t){return`block:${t}`}function z(t){return`connection:${t}`}var A=1e-6;var j=typeof Float32Array!=="undefined"?Float32Array:Array;var K=Math.PI/180;if(!Math.hypot)Math.hypot=function(){var t=0,e=arguments.length;while(e--){t+=arguments[e]*arguments[e]}return Math.sqrt(t)};function G(){var t=new j(9);if(j!=Float32Array){t[1]=0;t[2]=0;t[3]=0;t[5]=0;t[6]=0;t[7]=0}t[0]=1;t[4]=1;t[8]=1;return t}function X(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function $(t){t[0]=1;t[1]=0;t[2]=0;t[3]=0;t[4]=1;t[5]=0;t[6]=0;t[7]=0;t[8]=1;return t}function Y(t,e){var o=e[0],n=e[1],a=e[2];var s=e[3],i=e[4],l=e[5];var r=e[6],c=e[7],u=e[8];var d=u*i-l*c;var p=-u*s+l*r;var b=c*s-i*r;var v=o*d+n*p+a*b;if(!v){return null}v=1/v;t[0]=d*v;t[1]=(-u*n+a*c)*v;t[2]=(l*n-a*i)*v;t[3]=p*v;t[4]=(u*o-a*r)*v;t[5]=(-l*o+a*s)*v;t[6]=b*v;t[7]=(-c*o+n*r)*v;t[8]=(i*o-n*s)*v;return t}function Z(t,e,o){var n=e[0],a=e[1],s=e[2];var i=e[3],l=e[4],r=e[5];var c=e[6],u=e[7],d=e[8];var p=o[0],b=o[1],v=o[2];var m=o[3],f=o[4],h=o[5];var g=o[6],y=o[7],B=o[8];t[0]=p*n+b*i+v*c;t[1]=p*a+b*l+v*u;t[2]=p*s+b*r+v*d;t[3]=m*n+f*i+h*c;t[4]=m*a+f*l+h*u;t[5]=m*s+f*r+h*d;t[6]=g*n+y*i+B*c;t[7]=g*a+y*l+B*u;t[8]=g*s+y*r+B*d;return t}function U(t,e,o){var n=e[0],a=e[1],s=e[2],i=e[3],l=e[4],r=e[5],c=e[6],u=e[7],d=e[8],p=o[0],b=o[1];t[0]=n;t[1]=a;t[2]=s;t[3]=i;t[4]=l;t[5]=r;t[6]=p*n+b*i+c;t[7]=p*a+b*l+u;t[8]=p*s+b*r+d;return t}function W(t,e,o){var n=e[0],a=e[1],s=e[2],i=e[3],l=e[4],r=e[5],c=e[6],u=e[7],d=e[8],p=Math.sin(o),b=Math.cos(o);t[0]=b*n+p*i;t[1]=b*a+p*l;t[2]=b*s+p*r;t[3]=b*i-p*n;t[4]=b*l-p*a;t[5]=b*r-p*s;t[6]=c;t[7]=u;t[8]=d;return t}function q(t,e,o){var n=o[0],a=o[1];t[0]=n*e[0];t[1]=n*e[1];t[2]=n*e[2];t[3]=a*e[3];t[4]=a*e[4];t[5]=a*e[5];t[6]=e[6];t[7]=e[7];t[8]=e[8];return t}function Q(t,e,o){t[0]=2/e;t[1]=0;t[2]=0;t[3]=0;t[4]=-2/o;t[5]=0;t[6]=-1;t[7]=1;t[8]=1;return t}function J(){var t=new j(3);if(j!=Float32Array){t[0]=0;t[1]=0;t[2]=0}return t}function tt(t){var e=t[0];var o=t[1];var n=t[2];return Math.hypot(e,o,n)}function et(t,e,o){var n=new j(3);n[0]=t;n[1]=e;n[2]=o;return n}function ot(t,e){var o=e[0];var n=e[1];var a=e[2];var s=o*o+n*n+a*a;if(s>0){s=1/Math.sqrt(s)}t[0]=e[0]*s;t[1]=e[1]*s;t[2]=e[2]*s;return t}function nt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function at(t,e,o){var n=e[0],a=e[1],s=e[2];var i=o[0],l=o[1],r=o[2];t[0]=a*r-s*l;t[1]=s*i-n*r;t[2]=n*l-a*i;return t}var st=tt;var it=function(){var t=J();return function(e,o,n,a,s,i){var l,r;if(!o){o=3}if(!n){n=0}if(a){r=Math.min(a*o+n,e.length)}else{r=e.length}for(l=n;l<r;l+=o){t[0]=e[l];t[1]=e[l+1];t[2]=e[l+2];s(t,t,i);e[l]=t[0];e[l+1]=t[1];e[l+2]=t[2]}return e}}();function lt(){var t=new j(4);if(j!=Float32Array){t[0]=0;t[1]=0;t[2]=0;t[3]=0}return t}function rt(t,e){var o=e[0];var n=e[1];var a=e[2];var s=e[3];var i=o*o+n*n+a*a+s*s;if(i>0){i=1/Math.sqrt(i)}t[0]=o*i;t[1]=n*i;t[2]=a*i;t[3]=s*i;return t}var ct=function(){var t=lt();return function(e,o,n,a,s,i){var l,r;if(!o){o=4}if(!n){n=0}if(a){r=Math.min(a*o+n,e.length)}else{r=e.length}for(l=n;l<r;l+=o){t[0]=e[l];t[1]=e[l+1];t[2]=e[l+2];t[3]=e[l+3];s(t,t,i);e[l]=t[0];e[l+1]=t[1];e[l+2]=t[2];e[l+3]=t[3]}return e}}();function ut(){var t=new j(4);if(j!=Float32Array){t[0]=0;t[1]=0;t[2]=0}t[3]=1;return t}function dt(t,e,o){o=o*.5;var n=Math.sin(o);t[0]=n*e[0];t[1]=n*e[1];t[2]=n*e[2];t[3]=Math.cos(o);return t}function pt(t,e,o,n){var a=e[0],s=e[1],i=e[2],l=e[3];var r=o[0],c=o[1],u=o[2],d=o[3];var p,b,v,m,f;b=a*r+s*c+i*u+l*d;if(b<0){b=-b;r=-r;c=-c;u=-u;d=-d}if(1-b>A){p=Math.acos(b);v=Math.sin(p);m=Math.sin((1-n)*p)/v;f=Math.sin(n*p)/v}else{m=1-n;f=n}t[0]=m*a+f*r;t[1]=m*s+f*c;t[2]=m*i+f*u;t[3]=m*l+f*d;return t}function bt(t,e){var o=e[0]+e[4]+e[8];var n;if(o>0){n=Math.sqrt(o+1);t[3]=.5*n;n=.5/n;t[0]=(e[5]-e[7])*n;t[1]=(e[6]-e[2])*n;t[2]=(e[1]-e[3])*n}else{var a=0;if(e[4]>e[0])a=1;if(e[8]>e[a*3+a])a=2;var s=(a+1)%3;var i=(a+2)%3;n=Math.sqrt(e[a*3+a]-e[s*3+s]-e[i*3+i]+1);t[a]=.5*n;n=.5/n;t[3]=(e[s*3+i]-e[i*3+s])*n;t[s]=(e[s*3+a]+e[a*3+s])*n;t[i]=(e[i*3+a]+e[a*3+i])*n}return t}var vt=rt;var mt=function(){var t=J();var e=et(1,0,0);var o=et(0,1,0);return function(n,a,s){var i=nt(a,s);if(i<-.999999){at(t,e,a);if(st(t)<1e-6)at(t,o,a);ot(t,t);dt(n,t,Math.PI);return n}else if(i>.999999){n[0]=0;n[1]=0;n[2]=0;n[3]=1;return n}else{at(t,a,s);n[0]=t[0];n[1]=t[1];n[2]=t[2];n[3]=1+i;return vt(n,n)}}}();var ft=function(){var t=ut();var e=ut();return function(o,n,a,s,i,l){pt(t,n,i,l);pt(e,a,s,l);pt(o,t,e,2*l*(1-l));return o}}();var ht=function(){var t=G();return function(e,o,n,a){t[0]=n[0];t[3]=n[1];t[6]=n[2];t[1]=a[0];t[4]=a[1];t[7]=a[2];t[2]=-o[0];t[5]=-o[1];t[8]=-o[2];return vt(e,bt(e,t))}}();function gt(){var t=new j(2);if(j!=Float32Array){t[0]=0;t[1]=0}return t}function yt(t,e,o){var n=e[0],a=e[1];t[0]=o[0]*n+o[3]*a+o[6];t[1]=o[1]*n+o[4]*a+o[7];return t}var Bt=function(){var t=gt();return function(e,o,n,a,s,i){var l,r;if(!o){o=2}if(!n){n=0}if(a){r=Math.min(a*o+n,e.length)}else{r=e.length}for(l=n;l<r;l+=o){t[0]=e[l];t[1]=e[l+1];s(t,t,i);e[l]=t[0];e[l+1]=t[1]}return e}}();var Pt=babelHelpers.classPrivateFieldLooseKey("x");var kt=babelHelpers.classPrivateFieldLooseKey("y");var Vt=babelHelpers.classPrivateFieldLooseKey("rotation");var Lt=babelHelpers.classPrivateFieldLooseKey("zoom");var Ht=babelHelpers.classPrivateFieldLooseKey("width");var xt=babelHelpers.classPrivateFieldLooseKey("height");var Ct=babelHelpers.classPrivateFieldLooseKey("matrix");var St=babelHelpers.classPrivateFieldLooseKey("projectionMatrix");var Ft=babelHelpers.classPrivateFieldLooseKey("viewMatrix");var wt=babelHelpers.classPrivateFieldLooseKey("viewProjectionMatrix");var Et=babelHelpers.classPrivateFieldLooseKey("viewProjectionMatrixInv");var Mt=babelHelpers.classPrivateFieldLooseKey("changeCallback");var It=babelHelpers.classPrivateFieldLooseKey("onChangedTransformParams");class _t{constructor(t){Object.defineProperty(this,It,{value:Tt});Object.defineProperty(this,Pt,{writable:true,value:0});Object.defineProperty(this,kt,{writable:true,value:0});Object.defineProperty(this,Vt,{writable:true,value:0});Object.defineProperty(this,Lt,{writable:true,value:1});Object.defineProperty(this,Ht,{writable:true,value:0});Object.defineProperty(this,xt,{writable:true,value:0});Object.defineProperty(this,Ct,{writable:true,value:G()});Object.defineProperty(this,St,{writable:true,value:G()});Object.defineProperty(this,Ft,{writable:true,value:G()});Object.defineProperty(this,wt,{writable:true,value:G()});Object.defineProperty(this,Et,{writable:true,value:G()});Object.defineProperty(this,Mt,{writable:true,value:null});const{width:e,height:o,onChangeCallback:n}=t;babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]=n;this.projection(e,o);this.updateMatrix();babelHelpers.classPrivateFieldLooseBase(this,It)[It]({width:e,height:o})}get projectionMatrix(){return babelHelpers.classPrivateFieldLooseBase(this,St)[St]}get viewMatrix(){return babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]}get viewProjectionMatrix(){return babelHelpers.classPrivateFieldLooseBase(this,wt)[wt]}get viewProjectionMatrixInv(){return babelHelpers.classPrivateFieldLooseBase(this,Et)[Et]}get matrix(){return babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]}get zoom(){return babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]}set zoom(t){if(babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]!==t){babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]=t;babelHelpers.classPrivateFieldLooseBase(this,It)[It]({zoom:t});this.updateMatrix()}}get x(){return babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]}set x(t){if(babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]!==t){babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]=t;babelHelpers.classPrivateFieldLooseBase(this,It)[It]({x:t});this.updateMatrix()}}get y(){return babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]}set y(t){if(babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]!==t){babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=t;babelHelpers.classPrivateFieldLooseBase(this,It)[It]({y:t});this.updateMatrix()}}get rotation(){return babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]}set rotation(t){if(babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]!==t){babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=t;this.updateMatrix()}}get width(){return babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]}get height(){return babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]}setChangeTransformCallback(t){babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]=t}clone(t=null,e=null){const o=new _t({width:t||babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht],height:e||babelHelpers.classPrivateFieldLooseBase(this,xt)[xt],onChangeCallback:babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]});babelHelpers.classPrivateFieldLooseBase(o,Pt)[Pt]=babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt];babelHelpers.classPrivateFieldLooseBase(o,kt)[kt]=babelHelpers.classPrivateFieldLooseBase(this,kt)[kt];babelHelpers.classPrivateFieldLooseBase(o,Lt)[Lt]=babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt];babelHelpers.classPrivateFieldLooseBase(o,Vt)[Vt]=babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt];o.updateMatrix();return o}projection(t,e){babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht]=t;babelHelpers.classPrivateFieldLooseBase(this,xt)[xt]=e;Q(babelHelpers.classPrivateFieldLooseBase(this,St)[St],t,e);this.updateViewProjectionMatrix()}updateMatrix(){const t=1/babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt];$(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]);U(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct],babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct],[babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt],babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]]);W(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct],babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct],babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]);q(babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct],babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct],[t,t]);Y(babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft],babelHelpers.classPrivateFieldLooseBase(this,Ct)[Ct]);this.updateViewProjectionMatrix()}updateViewProjectionMatrix(){Z(babelHelpers.classPrivateFieldLooseBase(this,wt)[wt],babelHelpers.classPrivateFieldLooseBase(this,St)[St],babelHelpers.classPrivateFieldLooseBase(this,Ft)[Ft]);Y(babelHelpers.classPrivateFieldLooseBase(this,Et)[Et],babelHelpers.classPrivateFieldLooseBase(this,wt)[wt])}createLandmark(t={}){return{zoom:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt],x:babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt],y:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt],rotation:babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt],...t}}viewportToCanvas({x:t,y:e},o){const{width:n,height:a,viewProjectionMatrixInv:s}=o||this;const i=yt(gt(),[t/n*2-1,(1-e/a)*2-1],s);return{x:i[0],y:i[1]}}applyLandmark(t){const{x:e,y:o,zoom:n,rotation:a,viewportX:s,viewportY:i}=t;const l=s||i;let r=0;let c=0;if(l){const t=this.viewportToCanvas({x:s,y:i});r=t.x;c=t.y}babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]=n;babelHelpers.classPrivateFieldLooseBase(this,Vt)[Vt]=a;babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]=e;babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]=o;this.updateMatrix();babelHelpers.classPrivateFieldLooseBase(this,It)[It]({x:babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt],y:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt],zoom:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]});if(l){const{x:t,y:e}=this.viewportToCanvas({x:s,y:i});babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt]+=r-t;babelHelpers.classPrivateFieldLooseBase(this,kt)[kt]+=c-e;this.updateMatrix();babelHelpers.classPrivateFieldLooseBase(this,It)[It]({x:babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt],y:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt],zoom:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt]})}}}function Tt(t){babelHelpers.classPrivateFieldLooseBase(this,Mt)[Mt]({x:babelHelpers.classPrivateFieldLooseBase(this,Pt)[Pt],y:babelHelpers.classPrivateFieldLooseBase(this,kt)[kt],zoom:babelHelpers.classPrivateFieldLooseBase(this,Lt)[Lt],width:babelHelpers.classPrivateFieldLooseBase(this,Ht)[Ht],height:babelHelpers.classPrivateFieldLooseBase(this,xt)[xt],...t})}var Ot=babelHelpers.classPrivateFieldLooseKey("canvas");var Rt=babelHelpers.classPrivateFieldLooseKey("dpr");var Dt=babelHelpers.classPrivateFieldLooseKey("width");var Nt=babelHelpers.classPrivateFieldLooseKey("height");var zt=babelHelpers.classPrivateFieldLooseKey("minZoom");var At=babelHelpers.classPrivateFieldLooseKey("maxZoom");var jt=babelHelpers.classPrivateFieldLooseKey("camera");var Kt=babelHelpers.classPrivateFieldLooseKey("canvasStyleInstance");var Gt=babelHelpers.classPrivateFieldLooseKey("startInvertViewProjectionMatrix");var Xt=babelHelpers.classPrivateFieldLooseKey("startCameraX");var $t=babelHelpers.classPrivateFieldLooseKey("startCameraY");var Yt=babelHelpers.classPrivateFieldLooseKey("startPos");var Zt=babelHelpers.classPrivateFieldLooseKey("resizeObserver");var Ut=babelHelpers.classPrivateFieldLooseKey("initCanvas");var Wt=babelHelpers.classPrivateFieldLooseKey("initCamera");var qt=babelHelpers.classPrivateFieldLooseKey("initCanvasStyle");var Qt=babelHelpers.classPrivateFieldLooseKey("initResizeObserver");var Jt=babelHelpers.classPrivateFieldLooseKey("setCameraZoom");var te=babelHelpers.classPrivateFieldLooseKey("getClipSpaceMousePosition");class ee{constructor(t){Object.defineProperty(this,te,{value:le});Object.defineProperty(this,Jt,{value:ie});Object.defineProperty(this,Qt,{value:se});Object.defineProperty(this,qt,{value:ae});Object.defineProperty(this,Wt,{value:ne});Object.defineProperty(this,Ut,{value:oe});Object.defineProperty(this,Ot,{writable:true,value:null});Object.defineProperty(this,Rt,{writable:true,value:window.devicePixelRatio||1});Object.defineProperty(this,Dt,{writable:true,value:0});Object.defineProperty(this,Nt,{writable:true,value:0});Object.defineProperty(this,zt,{writable:true,value:.02});Object.defineProperty(this,At,{writable:true,value:4});Object.defineProperty(this,jt,{writable:true,value:null});Object.defineProperty(this,Kt,{writable:true,value:null});Object.defineProperty(this,Gt,{writable:true,value:G()});Object.defineProperty(this,Xt,{writable:true,value:0});Object.defineProperty(this,$t,{writable:true,value:0});Object.defineProperty(this,Yt,{writable:true,value:gt()});Object.defineProperty(this,Zt,{writable:true,value:null});this.transform=s.ref({x:0,y:0,zoom:0});const{canvas:e,canvasStyle:o,minZoom:n,maxZoom:a}=t;babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]=n;babelHelpers.classPrivateFieldLooseBase(this,At)[At]=a;babelHelpers.classPrivateFieldLooseBase(this,Ut)[Ut](e);babelHelpers.classPrivateFieldLooseBase(this,Wt)[Wt]();babelHelpers.classPrivateFieldLooseBase(this,qt)[qt](o);babelHelpers.classPrivateFieldLooseBase(this,Qt)[Qt]()}get viewMatrix(){var t,e;return(t=(e=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt])==null?void 0:e.viewMatrix)!=null?t:[]}get camera(){return babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]}clientToViewport({x:t,y:e}){const{left:o,top:n}=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].getBoundingClientRect();return{x:t-o,y:e-n}}viewportToClient({x:t,y:e}){const{left:o,top:n}=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].getBoundingClientRect();return{x:t+o,y:e+n}}render(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt])==null?void 0:t.render({projectionMatrix:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].projectionMatrix,viewMatrix:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].viewMatrix,viewProjectionMatrixInv:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].viewProjectionMatrixInv,zoomScale:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].zoom})}setCamera(t){babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].applyLandmark(babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].createLandmark({...t}))}zoomIn(t){babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt](t)}zoomOut(t){babelHelpers.classPrivateFieldLooseBase(this,Jt)[Jt](t*-1)}setCameraZoomByWheel(t,e=0){const o=Math.max(babelHelpers.classPrivateFieldLooseBase(this,zt)[zt],Math.min(babelHelpers.classPrivateFieldLooseBase(this,At)[At],(babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].zoom+e)*2**(t.deltaY*-.01)));const n=this.clientToViewport({x:t.clientX,y:t.clientY});babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].applyLandmark(babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].createLandmark({viewportX:n.x,viewportY:n.y,zoom:o}))}setCameraPositionByWheel(t){babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].x+=t.deltaX/babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].zoom;babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].y+=t.deltaY/babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].zoom}setCameraPositionByMouseDown(t){X(babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt],babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].viewProjectionMatrixInv);babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].x;babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].y;yt(babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt],babelHelpers.classPrivateFieldLooseBase(this,te)[te](t),babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt])}setCameraPositionByMouseMove(t){const e=yt(gt(),babelHelpers.classPrivateFieldLooseBase(this,te)[te](t),babelHelpers.classPrivateFieldLooseBase(this,Gt)[Gt]);babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].x=babelHelpers.classPrivateFieldLooseBase(this,Xt)[Xt]+babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt][0]-e[0];babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].y=babelHelpers.classPrivateFieldLooseBase(this,$t)[$t]+babelHelpers.classPrivateFieldLooseBase(this,Yt)[Yt][1]-e[1]}destroy(){var t;(t=babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt])==null?void 0:t.destroy();babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt].unobserve(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot])}}function oe(t){const{width:e,height:o}=t.getBoundingClientRect();babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot]=t;babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].width=e*babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].height=o*babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].width;babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].height}function ne(){babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]=new _t({width:babelHelpers.classPrivateFieldLooseBase(this,Dt)[Dt]/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt],height:babelHelpers.classPrivateFieldLooseBase(this,Nt)[Nt]/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt],onChangeCallback:({x:t,y:e,zoom:o})=>{this.transform.x=t;this.transform.y=e;this.transform.zoom=o}})}function ae(t){if(t){const e=t.instance;babelHelpers.classPrivateFieldLooseBase(this,Kt)[Kt]=new e(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot],t.options)}}function se(){babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt]=new ResizeObserver((t=>{for(const e of t){babelHelpers.classPrivateFieldLooseBase(this,jt)[jt]=babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].clone(e.contentRect.width,e.contentRect.height)}}));babelHelpers.classPrivateFieldLooseBase(this,Zt)[Zt].observe(babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot])}function ie(t){const e=Number((babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].zoom+t).toFixed(1));if(e<babelHelpers.classPrivateFieldLooseBase(this,zt)[zt]||e>babelHelpers.classPrivateFieldLooseBase(this,At)[At]){return}babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].applyLandmark(babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].createLandmark({x:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].x,y:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].y,viewportX:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].width/2,viewportY:babelHelpers.classPrivateFieldLooseBase(this,jt)[jt].height/2,zoom:e}))}function le(t){const{left:e,top:o}=babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].getBoundingClientRect();const n=t.clientX-e;const a=t.clientY-o;const s=n/babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].clientWidth||babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].width/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];const i=a/babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].clientHeight||babelHelpers.classPrivateFieldLooseBase(this,Ot)[Ot].height/babelHelpers.classPrivateFieldLooseBase(this,Rt)[Rt];const l=s*2-1;const r=i*-2+1;return[l,r]}const re=`\n  #extension GL_OES_standard_derivatives : enable\n  precision mediump float;\n\n  attribute vec2 a_Position;\n  uniform mat3 u_ViewProjectionInvMatrix;\n  varying vec2 v_Position;\n\n  vec2 project_clipspace(vec2 p) {\n  \treturn (u_ViewProjectionInvMatrix * vec3(p, 1)).xy;\n  }\n\n  void main() {\n  \tv_Position = project_clipspace(a_Position);\n  \tgl_Position = vec4(a_Position, 0, 1);\n  }\n`;const ce=`\n  #extension GL_OES_standard_derivatives : enable\n  precision mediump float;\n\n  uniform vec4 u_BackgroundColor;\n  uniform vec4 u_GridColor;\n  uniform float u_GridSize;\n  uniform float u_ZoomStep;\n  uniform float u_ZoomScale;\n  varying vec2 v_Position;\n\n  vec4 render_grid(vec2 coord) {\n  \tfloat alpha = 0.0;\n  \tfloat gridSize1 = u_GridSize;\n  \tfloat gridSize2 = gridSize1 / 4.0;\n\n  \tvec2 grid1 = abs(fract(coord / gridSize1 - 0.5) - 0.5) / fwidth(coord) * gridSize1 / 0.95;\n  \tvec2 grid2 = abs(fract(coord / gridSize2 - 0.5) - 0.5) / fwidth(coord) * gridSize2 / 0.75;\n  \tfloat v1 = 1.0 - min(min(grid1.x, grid1.y), 1.0);\n  \tfloat v2 = 1.0 - min(min(grid2.x, grid2.y), 1.0);\n\n  \tif (v1 > 0.0) {\n  \t\talpha = clamp(v1, 0.0, 0.222);\n  \t} else {\n  \t\talpha = v2 * clamp(u_ZoomScale / u_ZoomStep, 0.0, 1.0);\n  \t}\n\n  \treturn mix(u_BackgroundColor, u_GridColor, alpha);\n  }\n\n  void main() {\n  \tgl_FragColor = render_grid(v_Position);\n  }\n`;function ue(t,e,o){const n=t.createShader(o);t.shaderSource(n,e);t.compileShader(n);const a=t.getShaderParameter(n,t.COMPILE_STATUS);if(!a){throw new Error(`Error shader compilation: ${t.getShaderInfoLog(n)}`)}return n}function de(t,e,o){const n=t.createProgram();t.attachShader(n,e);t.attachShader(n,o);t.linkProgram(n);const a=t.getProgramParameter(n,t.LINK_STATUS);if(!a){throw new Error(`Error initializing shader program: ${t.getProgramInfoLog(n)}`)}return n}function pe(t,e,o,n){const a=o||t.ARRAY_BUFFER;const s=t.createBuffer();t.bindBuffer(a,s);t.bufferData(a,e,n||t.STATIC_DRAW);return s}function be(t){const e=t.replace(/^#/,"");const o=parseInt(e.slice(0,2),16);const n=parseInt(e.slice(2,4),16);const a=parseInt(e.slice(4,6),16);return[o/255,n/255,a/255]}var ve=babelHelpers.classPrivateFieldLooseKey("gl");var me=babelHelpers.classPrivateFieldLooseKey("program");var fe=babelHelpers.classPrivateFieldLooseKey("positionAttributeLocation");var he=babelHelpers.classPrivateFieldLooseKey("vertexShader");var ge=babelHelpers.classPrivateFieldLooseKey("fragmentShader");var ye=babelHelpers.classPrivateFieldLooseKey("projectionMatrixLink");var Be=babelHelpers.classPrivateFieldLooseKey("viewMatrixLink");var Pe=babelHelpers.classPrivateFieldLooseKey("viewProjectionInvMatrixLink");var ke=babelHelpers.classPrivateFieldLooseKey("backgroundColorLink");var Ve=babelHelpers.classPrivateFieldLooseKey("backgroundColor");var Le=babelHelpers.classPrivateFieldLooseKey("gridColorLink");var He=babelHelpers.classPrivateFieldLooseKey("gridColor");var xe=babelHelpers.classPrivateFieldLooseKey("gridColorAlpha");var Ce=babelHelpers.classPrivateFieldLooseKey("gridSizeLink");var Se=babelHelpers.classPrivateFieldLooseKey("gridSize");var Fe=babelHelpers.classPrivateFieldLooseKey("zoomScaleLink");var we=babelHelpers.classPrivateFieldLooseKey("gridPosition");var Ee=babelHelpers.classPrivateFieldLooseKey("gridPositionBuffer");var Me=babelHelpers.classPrivateFieldLooseKey("zoomStepLink");var Ie=babelHelpers.classPrivateFieldLooseKey("zoomStep");var _e=babelHelpers.classPrivateFieldLooseKey("zoomSteps");var Te=babelHelpers.classPrivateFieldLooseKey("initGrid");var Oe=babelHelpers.classPrivateFieldLooseKey("getPreparedZoomSteps");var Re=babelHelpers.classPrivateFieldLooseKey("initParams");var De=babelHelpers.classPrivateFieldLooseKey("getParamsByZoom");class Ne{constructor(t,e){Object.defineProperty(this,De,{value:Ke});Object.defineProperty(this,Re,{value:je});Object.defineProperty(this,Oe,{value:Ae});Object.defineProperty(this,Te,{value:ze});Object.defineProperty(this,ve,{writable:true,value:void 0});Object.defineProperty(this,me,{writable:true,value:null});Object.defineProperty(this,fe,{writable:true,value:null});Object.defineProperty(this,he,{writable:true,value:null});Object.defineProperty(this,ge,{writable:true,value:null});Object.defineProperty(this,ye,{writable:true,value:null});Object.defineProperty(this,Be,{writable:true,value:null});Object.defineProperty(this,Pe,{writable:true,value:null});Object.defineProperty(this,ke,{writable:true,value:null});Object.defineProperty(this,Ve,{writable:true,value:null});Object.defineProperty(this,Le,{writable:true,value:null});Object.defineProperty(this,He,{writable:true,value:null});Object.defineProperty(this,xe,{writable:true,value:null});Object.defineProperty(this,Ce,{writable:true,value:null});Object.defineProperty(this,Se,{writable:true,value:null});Object.defineProperty(this,Fe,{writable:true,value:null});Object.defineProperty(this,we,{writable:true,value:[-1,-1,-1,1,1,-1,1,1]});Object.defineProperty(this,Ee,{writable:true,value:null});Object.defineProperty(this,Me,{writable:true,value:null});Object.defineProperty(this,Ie,{writable:true,value:4});Object.defineProperty(this,_e,{writable:true,value:[]});babelHelpers.classPrivateFieldLooseBase(this,Re)[Re](e);babelHelpers.classPrivateFieldLooseBase(this,Te)[Te](t)}render({projectionMatrix:t,viewMatrix:e,viewProjectionMatrixInv:o,zoomScale:n}){babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].clearColor(1,1,1,1);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].clear(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].COLOR_BUFFER_BIT);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].useProgram(babelHelpers.classPrivateFieldLooseBase(this,me)[me]);const{gridColor:a,zoomStep:s,size:i}=babelHelpers.classPrivateFieldLooseBase(this,De)[De](n);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniformMatrix3fv(babelHelpers.classPrivateFieldLooseBase(this,ye)[ye],false,t);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniformMatrix3fv(babelHelpers.classPrivateFieldLooseBase(this,Be)[Be],false,e);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniformMatrix3fv(babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe],false,o);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniform4f(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke],...babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve],1);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniform4f(babelHelpers.classPrivateFieldLooseBase(this,Le)[Le],...a,1);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniform1f(babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce],i);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniform1f(babelHelpers.classPrivateFieldLooseBase(this,Me)[Me],s);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].uniform1f(babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe],n);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].enableVertexAttribArray(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].bindBuffer(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].ARRAY_BUFFER,babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].vertexAttribPointer(babelHelpers.classPrivateFieldLooseBase(this,fe)[fe],2,babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].FLOAT,false,0,0);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].drawArrays(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].TRIANGLE_STRIP,0,4)}destroy(){babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].deleteProgram(babelHelpers.classPrivateFieldLooseBase(this,me)[me]);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].deleteShader(babelHelpers.classPrivateFieldLooseBase(this,he)[he]);babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].deleteShader(babelHelpers.classPrivateFieldLooseBase(this,ge)[ge])}}function ze(t){babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]=t.getContext("webgl");babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getExtension("OES_standard_derivatives");babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].viewport(0,0,babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].canvas.width,babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].canvas.height);babelHelpers.classPrivateFieldLooseBase(this,he)[he]=ue(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve],re,babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].VERTEX_SHADER);babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]=ue(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve],ce,babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].FRAGMENT_SHADER);babelHelpers.classPrivateFieldLooseBase(this,me)[me]=de(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve],babelHelpers.classPrivateFieldLooseBase(this,he)[he],babelHelpers.classPrivateFieldLooseBase(this,ge)[ge]);babelHelpers.classPrivateFieldLooseBase(this,fe)[fe]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getAttribLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"a_Position");babelHelpers.classPrivateFieldLooseBase(this,ye)[ye]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_ProjectionMatrix");babelHelpers.classPrivateFieldLooseBase(this,Be)[Be]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_ViewMatrix");babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_ViewProjectionInvMatrix");babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_BackgroundColor");babelHelpers.classPrivateFieldLooseBase(this,Le)[Le]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_GridColor");babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_GridSize");babelHelpers.classPrivateFieldLooseBase(this,Me)[Me]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_ZoomStep");babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve].getUniformLocation(babelHelpers.classPrivateFieldLooseBase(this,me)[me],"u_ZoomScale");babelHelpers.classPrivateFieldLooseBase(this,Ee)[Ee]=pe(babelHelpers.classPrivateFieldLooseBase(this,ve)[ve],new Float32Array(babelHelpers.classPrivateFieldLooseBase(this,we)[we]))}function Ae(t){return t.sort(((t,e)=>e.zoomStep-t.zoomStep)).map((t=>({zoomStep:babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie],...t,size:"size"in t?t.size:babelHelpers.classPrivateFieldLooseBase(this,Se)[Se],gridColor:"gridColor"in t?be(t.gridColor):babelHelpers.classPrivateFieldLooseBase(this,He)[He]})))}function je(t){const{size:e,gridColor:o,gridColorAlpha:n,backgroundColor:a,zoomStep:s,zoomSteps:i}=t;babelHelpers.classPrivateFieldLooseBase(this,Se)[Se]=e;babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]=s;babelHelpers.classPrivateFieldLooseBase(this,He)[He]=new Float32Array(be(o));babelHelpers.classPrivateFieldLooseBase(this,xe)[xe]=n;babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=new Float32Array(be(a));babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]=babelHelpers.classPrivateFieldLooseBase(this,Oe)[Oe](i)}function Ke(t){for(const e of babelHelpers.classPrivateFieldLooseBase(this,_e)[_e]){if(e.zoom<=t){return e}}return{gridColor:babelHelpers.classPrivateFieldLooseBase(this,He)[He],size:babelHelpers.classPrivateFieldLooseBase(this,Se)[Se],zoomStep:babelHelpers.classPrivateFieldLooseBase(this,Ie)[Ie]}}function Ge(t={}){const e=t=>s.markRaw({blocks:s.markRaw(JSON.parse(JSON.stringify(t.blocks))),connections:s.markRaw(JSON.parse(JSON.stringify(t.connections)))});const o=t=>{u.changedBlocks.trigger(I(t.blocks));u.changedConnections.trigger(I(t.connections))};const n={blocks:[],connections:[]};const a=Ze();const{headSnapshot:i,tailSnapshot:l,currentSnapshot:r,maxCountSnapshots:c,hooks:u,snapshotHandler:d,revertHandler:p,setHistoryHandlers:b,historyCurrentState:v}=a;const{snapshotHandler:m=null,revertHandler:f=null,emptyHistorySnapshot:h=n,maxCount:g}=t;P({newSnapshotHandler:m,newRevertHandler:f});c.value=g||s.toValue(c);const y=s.computed((()=>s.toValue(r)&&s.toValue(r).next!==null));const B=s.computed((()=>s.toValue(r)&&s.toValue(r).prev!==null));function P(t){var n,a,i,l;const r={snapshotHandler:(n=(a=t.snapshotHandler)!=null?a:s.toValue(d))!=null?n:e,revertHandler:(i=(l=t.revertHandler)!=null?l:s.toValue(p))!=null?i:o};b(r)}function k(){let t=0;let e=s.toValue(i);while(e){e=e.next;t+=1}return t}function V(t={}){var e;const{snapshotHandler:o=null,revertHandler:n=null,emptySnapshot:a=null}=t;const u=o||s.toValue(d);const b=n||s.toValue(p);const m=a||h;const f=s.markRaw({snapshot:u(s.toValue(v)),revertHandler:b,emptySnapshot:m,next:null,prev:l.value});if(s.toValue(r)&&((e=s.toValue(r))==null?void 0:e.next)!==null){r.value.next=f;f.prev=r.value;l.value.prev=null;l.value.next=null;l.value=f}else if(s.toValue(i)===null){i.value=f;l.value=f}else{l.value.next=f;l.value=f}r.value=f;if(k()<=s.toValue(c)+1){return}const g=i.value;i.value=g.next;i.value.prev=null;g.next=null}async function L({revertHandler:t,snapshot:e,emptySnapshot:o}){t(o);await s.nextTick();t(e)}async function H(){if(s.toValue(r)===null||s.toValue(r).next===null){return}await L(s.toValue(r).next);r.value=s.toValue(r).next}async function x(){if(s.toValue(r)===null||s.toValue(r).prev===null){return}await L(s.toValue(r).prev);r.value=s.toValue(r).prev}function C(){i.value=null;l.value=null;r.value=null}return{hasNext:y,hasPrev:B,setHandlers:P,makeSnapshot:()=>s.nextTick((()=>V())),next:H,prev:x,clear:C,commonSnapshotHandler:e,commonRevertHandler:o}}function Xe({state:t,getters:e,hooks:o}){function n(e){t.blocks=s.toValue(e.blocks);t.connections=s.toValue(e.connections);t.transformX=e.transform.x;t.transformY=e.transfrom.y;t.zoom=s.toValue(e.zoom)}function a(e){const{x:o=0,y:n=0,zoom:a=1,viewportX:s=0,viewportY:i=0}=e;t.transformX=o;t.transformY=n;t.viewportX=s;t.viewportY=i;t.zoom=a}const i=e=>{const{sourceBlockId:o,sourcePortId:n,targetBlockId:a,targetPortId:s}=e;return t.connections.some((({sourceBlockId:t,sourcePortId:e,targetBlockId:i,targetPortId:l})=>{const r=t===o&&e===n&&i===a&&l===s;const c=t===a&&e===s&&i===o&&l===n;return r||c}))};const u=t=>{if(!i(t)){o.changedConnections.trigger(_(t));o.createConnection.trigger(t)}};const p=e=>{const n=t.connections.filter((t=>t.id!==e));o.changedConnections.trigger(I(n));o.deleteConnection.trigger(e)};const b=(e,n)=>{var a,s,i,l;const r=t.blocks.find((t=>t.id===e));if(!r){return}const c=new Set([...(a=(s=r.ports)==null?void 0:s.input)!=null?a:[],...(i=(l=r.ports)==null?void 0:l.output)!=null?i:[]].map((t=>t.id)));const u=t.connections.filter((t=>{const{sourceBlockId:o,sourcePortId:n,targetBlockId:a,targetPortId:s}=t;const i=o===e&&c.has(n);const l=a===e&&c.has(s);return!i&&!l}));o.changedConnections.trigger(I(u))};const v=e=>{const n=t.blocks.findIndex((t=>t.id===e));if(n===-1){return}b(e);o.changedBlocks.trigger(O(n));o.deleteBlock.trigger(e)};const m=t=>{o.changedBlocks.trigger(_(t));o.addBlock.trigger(t)};const f=(e,o,n)=>{t.blocks[e].position.x=o;t.blocks[e].position.y=n};const h=e=>{const n=t.blocks.findIndex((t=>t.id===e.id));if(n===-1){return}o.changedBlocks.trigger(T(n,e));o.updateBlock.trigger(e)};const g=(t,e)=>{const{position:{x:o,y:n},dimensions:{width:a},ports:{output:s},node:{type:i}}=t;const{position:c,id:u}=e;let p=c*l/2;if(i===d.COMPLEX){p+=r+l}let b=o;const v=s.some((t=>t.id===u));if(v){b=Number(o)+Number(a)}return{x:b,y:Number(n)+p}};const y=(e,o)=>{let n=null;let a=Infinity;t.blocks.forEach((t=>{t.ports.forEach((s=>{const{x:i,y:l}=g(t,s);const r=e-i;const u=o-l;const d=Math.hypot(r,u);if(d<c&&d<a){n={block:t,port:s};a=d}}))}));return n};const B=e=>{var o,n;let a=Math.round(e.clientX/s.toValue(t.zoom));let i=Math.round(e.clientY/s.toValue(t.zoom));const{top:l,left:r}=(o=(n=s.toValue(t.blockDiagramRef))==null?void 0:n.getBoundingClientRect())!=null?o:{top:0,left:0};a-=Math.round(r/s.toValue(t.zoom));i-=Math.round(l/s.toValue(t.zoom));return{x:a,y:i}};const P=e=>{t.movingBlock=s.toRaw({...e});const o=[];e.ports.forEach((n=>{const a=t.connections.filter((t=>{const{targetBlockId:o,targetPortId:a,sourceBlockId:s,sourcePortId:i}=t;const l=o===e.id&&a===n.id;const r=s===e.id&&i===n.id;return l||r}));o.push(...a)}));t.movingConnections=o};const k=(e,o)=>{t.movingBlock.position.x=e;t.movingBlock.position.y=o};const V=()=>{t.movingBlock=null;t.movingConnections=[]};const L=({snapshotHandler:e=null,revertHandler:o=null})=>{t.snapshotHandler=e||t.snapshotHandler;t.revertHandler=o||t.revertHandler};const H=(e,o)=>{var n,a;const i=(n=(a=s.toValue(t.portsRectMap))==null?void 0:a[e])!=null?n:{};Object.entries(i).forEach((([t,e])=>{i[t].x=e.x-o.x;i[t].y=e.y-o.y}))};const x=(e,o)=>{var n,a,i;const{portsElMap:l,blockDiagramLeft:r,blockDiagramTop:c,zoom:u,transformX:d,transformY:p}=t;const b=s.toValue(l).has(e);const v=b&&s.toValue(l).get(e).has(o);if(!b||!v){return}const{x:m=0,y:f=0,width:h=0,height:g=0}=(n=(a=l.get(e))==null?void 0:(i=a.get(o))==null?void 0:i.getBoundingClientRect())!=null?n:{};t.portsRectMap[e][o].x=m/u+s.toValue(d)-s.toValue(r)/u;t.portsRectMap[e][o].y=f/u+s.toValue(p)-s.toValue(c)/u;t.portsRectMap[e][o].width=h;t.portsRectMap[e][o].height=g};const C=e=>{t.isSelectionActive=e};const S=e=>{t.selectionWorldRect=e};return{setState:n,updateCanvasTransform:a,isExistConnection:i,addConnection:u,deleteConnectionById:p,addBlock:m,updateBlockPositionByIndex:f,updateBlock:h,deleteBlockById:v,getPortAbsolutePosition:g,findNearestPort:y,transformEventToPoint:B,setMovingBlock:P,updateMovingBlockPosition:k,resetMovingBlock:V,setHistoryHandlers:L,setPortOffsetByBlockId:H,updatePortPosition:x,setSelectionActive:C,setSelectionWorldRect:S}}function $e(t){const e=s.computed((()=>({x:t.transformX,y:t.transformY,zoom:t.zoom,viewportX:t.viewportX,viewportY:t.viewportY})));const o=s.computed((()=>{var e,o;return(e=(o=t.canvasRef)==null?void 0:o.canvasId)!=null?e:null}));const n=s.computed((()=>t.newConnection!==null));const a=s.computed((()=>t.blocks.reduce(((t,e)=>{var o;const n=(o=e==null?void 0:e.type)!=null?o:p;if(n in t){t[n]=[...t[n],e]}else{t[n]=[e]}return t}),{[p]:[]})));const i=s.computed((()=>Object.keys(s.toValue(a))));const l=s.computed((()=>t.connections.reduce(((t,e)=>{var o;const n=(o=e==null?void 0:e.type)!=null?o:b;if(n in t){t[n]=[...t[n],e]}else{t[n]=[e]}return t}),{[b]:[]})));const r=s.computed((()=>Object.keys(s.toValue(l))));const c=s.computed((()=>t.animationQueue!==null));const u=s.computed((()=>t.isDisabled||s.toValue(c)));return{transform:e,canvasId:o,groupedBlocks:a,blockGroupNames:i,groupedConnections:l,connectionGroupNames:r,isAnimate:c,isDisabledBlockDiagram:u,isMakeNewConnection:n}}function Ye(){return{[u.START_DRAG_BLOCK]:D(),[u.MOVE_DRAG_BLOCK]:D(),[u.END_DRAG_BLOCK]:D(),[u.ADD_BLOCK]:D(),[u.UPDATE_BLOCK]:D(),[u.DELETE_BLOCK]:D(),[u.CREATE_CONNECTION]:D(),[u.DELETE_CONNECTION]:D(),[u.CHANGED_BLOCKS]:D(),[u.CHANGED_CONNECTIONS]:D(),[u.BLOCK_TRANSITION_START]:D(),[u.BLOCK_TRANSITION_END]:D(),[u.CONNECTION_TRANSITION_START]:D(),[u.CONNECTION_TRANSITION_END]:D(),[u.DROP_NEW_BLOCK]:D()}}function Ze(t){var e,o,n,a,l;const r=(e=s.getCurrentInstance())==null?void 0:e.appContext.app;const c=(o=r==null?void 0:(n=r.config)==null?void 0:(a=n.globalProperties)==null?void 0:a.$blockDiagram)!=null?o:null;if(c!==null){return c}const u=i(t);const d=s.reactive(u);const p=$e(d);const b=Ye();const v=Xe({state:d,getters:p,hooks:b});if(t){v.setState(t)}r.config.globalProperties.$blockDiagram={...s.toRefs(d),...p,...v,hooks:b};r.config.globalProperties.$blockDiagramTestId=(t,...e)=>{if(!t){throw new Error("ui.block-diagram not found test id")}const o=e.reduce(((t,e)=>`${t}-${e}`),"");return`${t}${o}`};return(l=r.config.globalProperties)==null?void 0:l.$blockDiagram}function Ue(t=[]){const{contextMenuLayerRef:o,targetContainerRef:n,isOpenContextMenu:i,positionContextMenu:l,contextMenuInstance:r,zoom:c}=Ze();r.value=s.toValue(r)||s.shallowRef(e.MenuManager.create(v()));const u=s.ref(false);let d={items:t};function p(t){d=v(t)}function b(t=[]){return t.map((t=>({...t,onclick:()=>{if(a.Type.isFunction(t.onclick)){const e={x:l.value.left,y:l.value.top};t.onclick(e)}h()}})))}function v(t){var e;return{id:"block-diagram-context-menu",bindElement:{left:0,top:0},minWidth:200,autoHide:true,draggable:false,cacheable:false,targetContainer:s.toValue(n),...t,items:b((e=t==null?void 0:t.items)!=null?e:[])}}function m(t){var e,o;(e=s.toValue(r))==null?void 0:(o=e.popupWindow)==null?void 0:o.subscribeOnce("onDestroy",t)}function f(t){var o;(o=s.toValue(r))==null?void 0:o.destroy();r.value=s.shallowRef(e.MenuManager.create(v(t)));s.toValue(r).show()}function h(){var t;(t=s.toValue(r))==null?void 0:t.close()}function g(t){var e,n;const{clientX:r=0,clientY:b=0,items:v=[]}=t;if(a.Type.isArrayFilled(s.toValue(v))){p({items:s.toValue(v)})}const{left:h,top:g}=(e=(n=s.toValue(o))==null?void 0:n.getBoundingClientRect())!=null?e:{top:0,left:0};l.value.top=(b-g)/s.toValue(c);l.value.left=(r-h)/s.toValue(c);f(d);m((()=>{u.value=false}));u.value=true;i.value=true}function y(){u.value=false;i.value=false;h()}return{isOpen:u,showContextMenu:g,closeContextMenu:y,setOptions:p}}function We(t){const{isDisabledBlockDiagram:e,newConnection:o,isValidNewConnection:n,portsRectMap:i,blockDiagramTop:l,blockDiagramLeft:r,zoom:c,transformX:u,transformY:d,addConnection:p}=Ze();const{block:b,port:v,position:m,validationRules:f=null,normalyzeConnectionFn:h=null}=t;const g=s.ref(false);const y=s.computed((()=>{if(s.toValue(o)===null){return true}const{sourceBlockId:t,sourcePortId:e,targetBlockId:a,targetPortId:i}=s.toValue(o);if(i===null){return true}const l=s.toValue(b).id===t&&s.toValue(v).id===e;const r=s.toValue(b).id===a&&s.toValue(v).id===i;if(l||r){return s.toValue(n)}return true}));function B(t){if(t===null){return true}if(a.Type.isArray(t)){return t.every((t=>t(s.toValue(o))))}if(!a.Type.isFunction(t)){return true}return t(s.toValue(o))}function P(t,e=null){if(a.Type.isFunction(e)){return e(t)}return{id:t.id,sourceBlockId:t.sourceBlockId,sourcePortId:t.sourcePortId,targetBlockId:t.targetBlockId,targetPortId:t.targetPortId}}function k(t){var n,l;t.stopPropagation();if(s.toValue(e)){return}g.value=true;const r=(n=s.toValue(i))==null?void 0:(l=n[s.toValue(b).id])==null?void 0:l[s.toValue(v).id];const c={x:r.x+r.width/2,y:r.y+r.height/2};o.value={id:a.Text.getRandom(),sourceBlockId:s.toValue(b).id,sourcePortId:s.toValue(v).id,sourcePort:{...s.toValue(v)},sourcePortPosition:m,targetBlockId:null,targetPortId:null,targetPort:null,start:c,end:c};a.Event.bind(document,"mousemove",V);a.Event.bind(document,"mouseup",L)}function V(t){if(!s.toValue(o)||s.toValue(e)){return}const n=t.clientX/s.toValue(c);const a=t.clientY/s.toValue(c);o.value.end={x:n+s.toValue(u)-s.toValue(r)/s.toValue(c),y:a+s.toValue(d)-s.toValue(l)/s.toValue(c)}}function L(t){if(s.toValue(o)===null||s.toValue(e)){return}const{sourceBlockId:i=null,sourcePortId:l=null,targetBlockId:r=null,targetPortId:c=null}=s.toValue(o);const u=i===r&&l===c;const d=i!==null&&l!==null;const b=r!==null&&c!==null;if(!u&&d&&b&&s.toValue(n)){p(P(s.toValue(o),h))}o.value=null;g.value=false;a.Event.unbind(document,"mousemove",V);a.Event.unbind(document,"mouseup",L)}function H(){if(s.toValue(e)){return}if(s.toValue(o)!==null){o.value.targetBlockId=s.toValue(b).id;o.value.targetPortId=s.toValue(v).id;o.value.targetPort={...s.toValue(v)};n.value=B(s.toValue(f))}}function x(){if(s.toValue(e)){return}if(s.toValue(o)!==null){o.value.targetBlockId=null;o.value.targetPortId=null;o.value.targetPort=null;n.value=true}}return{isSourcePort:g,isValid:y,onMouseDownPort:k,onMouseOverPort:H,onMouseLeavePort:x}}function qe(t){const{highlitedBlockIds:e,isDisabledBlockDiagram:o,movingBlock:n,updatePortPosition:a}=Ze();const i=s.computed((()=>e.value.includes(s.toValue(t).id)));const l=s.computed((()=>s.toValue(o)));const r=s.computed((()=>{var e;if(((e=s.toValue(n))==null?void 0:e.id)===s.toValue(t).id){return{zIndex:h.MOVABLE}}if(s.toValue(i)){return{zIndex:h.HIGHLITED}}return{zIndex:h.STANDING}}));function c(){[...s.toValue(t).ports.input,...s.toValue(t).ports.output].forEach((e=>{a(s.toValue(t).id,e.id)}))}return{isHiglitedBlock:i,isDisabled:l,blockZindex:r,updatePortsPositions:c}}function Qe(t,e){const o=s.ref(false);const{isDisabledBlockDiagram:n,zoom:i,updateBlock:l,hooks:r,setMovingBlock:c,updateMovingBlockPosition:u,resetMovingBlock:d,setPortOffsetByBlockId:p,blocks:b,highlitedBlockIds:v}=Ze();let m=0;let f=0;const h=s.ref(0);const g=s.ref(0);let y=[];const B=s.ref(s.toValue(e).position.x);const P=s.ref(s.toValue(e).position.y);s.watchEffect((()=>{B.value=s.toValue(e).position.x;P.value=s.toValue(e).position.y}));const k=s.computed((()=>({top:`${P.value}px`,left:`${B.value}px`})));s.onMounted((()=>{a.Event.bind(s.toValue(t),"mousedown",V)}));s.onBeforeUnmount((()=>{a.Event.unbind(s.toValue(t),"mousedown",V)}));const V=t=>{if(t.button!==0||s.toValue(n)){return}t.stopPropagation();const l=s.toValue(e).id;const u=s.toValue(v);const d=u.includes(l);if(!d){v.value=[l]}c(s.toValue(e));r.startDragBlock.trigger(e);m=s.toValue(e).position.x;f=s.toValue(e).position.y;h.value=Math.round(t.clientX-s.toValue(e).position.x*s.toValue(i));g.value=Math.round(t.clientY-s.toValue(e).position.y*s.toValue(i));y=[];const p=s.toValue(v);if(p.length>1){const t=s.toValue(b);y=t.filter((t=>p.includes(t.id)&&t.id!==l))}o.value=true;a.Event.bind(document,"mousemove",L);a.Event.bind(document,"mouseup",H)};const L=t=>{if(!s.toValue(o)||s.toValue(n)){return}t.stopPropagation();r.moveDragBlock.trigger(e);const a=Math.round((t.clientX-s.toValue(h))/s.toValue(i));const l=Math.round((t.clientY-s.toValue(g))/s.toValue(i));const c=a-m;const d=l-f;B.value=a;P.value=l;for(const t of y){t.position.x+=c;t.position.y+=d;if(p){p(t.id,{x:-c,y:-d})}}u(B.value,P.value);p(s.toValue(e).id,{x:m-B.value,y:f-P.value});m=B.value;f=P.value};const H=t=>{t.stopPropagation();if(!s.toValue(o)||s.toValue(n)){return}const c=Math.round((t.clientX-s.toValue(h))/s.toValue(i));const u=Math.round((t.clientY-s.toValue(g))/s.toValue(i));const b=s.toValue(e).position.x!==c||s.toValue(e).position.y!==u;if(b){y.forEach((t=>{const e=t.position.x;const o=t.position.y;const n={...t,position:{...t.position,x:e,y:o}};if(p){p(t.id,{x:0,y:0})}l(n);r.endDragBlock.trigger(n)}));const t={...s.toValue(e),position:{...s.toValue(e).position,x:c,y:u}};if(p){p(s.toValue(e).id,{x:m-c,y:f-u})}l(t);r.endDragBlock.trigger(t)}d();y=[];h.value=0;g.value=0;o.value=false;a.Event.unbind(document,"mousemove",L);a.Event.unbind(document,"mouseup",H)};return{isDragged:o,blockPositionStyle:k}}function Je(t){const{blocks:e,connections:o,historyCurrentState:n,hooks:a}=Ze();const i={[u.CHANGED_BLOCKS]:l,[u.CHANGED_CONNECTIONS]:r};Object.entries(i).forEach((([t,e])=>{a[t].on(e)}));function l(e){R(s.toValue(n.value.blocks),e,(e=>{n.value.blocks=e;t("update:blocks",e)}))}function r(e){R(s.toValue(n.value.connections),e,(e=>{n.value.connections=e;t("update:connections",e)}))}function c(){Object.entries(i).forEach((([t,e])=>{a[t].off(e)}))}return{dispose:c}}function to(t){const{blocks:e,connections:o,historyCurrentState:n,zoom:a,isDisabled:i}=Ze();const l=s.effectScope(true);l.run((()=>{s.watch([()=>t.blocks,()=>t.blocks.length],(([t])=>{if(t&&Array.isArray(t)){n.value.blocks=s.markRaw(JSON.parse(JSON.stringify(t)));e.value=t}}),{immediate:true,deep:true});s.watch([()=>t.connections,()=>t.connections.length],(([t])=>{n.value.connections=s.markRaw(JSON.parse(JSON.stringify(t)));o.value=[...t]}),{immediate:true,deep:true});s.watch((()=>t.zoom),(t=>{a.value=t}),{immediate:true});s.watch((()=>t.minZoom),(t=>{a.value=t}),{immediate:true});s.watch((()=>t.maxZoom),(t=>{a.value=t}),{immediate:true});s.watch((()=>t.disabled),(t=>{i.value=t}),{immediate:true})}));function r(){l.stop()}return{dispose:r}}function eo(...t){const{hooks:e}=Ze();const o=[...t].reduce(((t,e)=>{const o={...t};Object.entries(e).forEach((([e,n])=>{if(e in t){o[e].push(...a.Type.isFunction(n)?[n]:n)}else{o[e]=[...a.Type.isFunction(n)?[n]:n]}}));return o}),{});Object.entries(o).forEach((([t,o])=>{o.forEach((o=>{var n;e==null?void 0:(n=e[t])==null?void 0:n.on(o)}))}));function n(){Object.entries(o).forEach((([t,o])=>{o.forEach((o=>{var n;e==null?void 0:(n=e[t])==null?void 0:n.off(o)}))}))}return{dispose:n}}const oo={searchCallback:()=>false,delay:300};function no(t){const{blocks:e}=Ze();const o={...oo,...t};const n=s.ref("");const i=s.ref([]);function l(t){n.value=t;i.value=[];if(s.toValue(n).trim()===""){return}e.value.forEach((t=>{if(o.searchCallback(t,s.toValue(n))){i.value.push(t)}}))}function r(){n.value="";i.value=[]}return{seachText:n,foundBlocks:i,onSearchBlocks:a.debounce(l,o.delay),onClearSearch:r}}function ao(){const{zoom:t,blocks:e,canvasWidth:o,canvasHeight:n,blockDiagramTop:a,blockDiagramLeft:i,canvasInstance:l}=Ze();function r(t){var e;(e=s.toValue(l))==null?void 0:e.zoomIn(t)}function c(t){var e;(e=s.toValue(l))==null?void 0:e.zoomOut(t)}function u(t){var e;(e=s.toValue(l))==null?void 0:e.setCamera(t)}function d(l){const r=s.toValue(e).find((t=>t.id===l));if(!r){return}const{x:c,y:d}=r.position;const{width:p,height:b}=r.dimensions;const v=c+p/2;const m=d+b/2;u({x:v-s.toValue(o)/2/s.toValue(t)-s.toValue(i)/s.toValue(t),y:m-s.toValue(n)/2/s.toValue(t)-s.toValue(a)/s.toValue(t)})}return{zoomIn:r,zoomOut:c,setCamera:u,goToBlockById:d}}function so(){const{highlitedBlockIds:t}=Ze();function e(e){s.toValue(t).push(...e)}function o(e){s.toValue(t).push(e)}function n(e){const o=t.value.indexOf(e);if(o>-1){t.value.splice(o,1)}}function a(){t.value=[]}return{highlitedBlockIds:t,set:e,add:o,remove:n,clear:a}}function io(){var t,e,o,n;const a=(t=s.getCurrentInstance())==null?void 0:t.appContext.app;const i=(e=a==null?void 0:(o=a.config)==null?void 0:(n=o.globalProperties)==null?void 0:n.$bitrix)!=null?e:null;return{getMessage:(t,e)=>{var o;return i==null?void 0:(o=i.Loc)==null?void 0:o.getMessage(t,e)}}}function lo(t){const{portRef:e,block:o,port:n,position:a=v.LEFT}=t;const{portsElMap:i,portsRectMap:l,zoom:r,transformX:c,transformY:u,blockDiagramTop:d,blockDiagramLeft:p,isDisabledBlockDiagram:b}=Ze();const m=s.computed((()=>s.toValue(b)));function f(t,e,o){if(!s.toValue(i).has(t)){s.toValue(i).set(t,new Map)}s.toValue(i).get(t).set(e,s.toValue(o))}function h(t,e){if(!s.toValue(i).has(t)){return}s.toValue(i).get(t).delete(e)}function g(t,e,o){var n,i;if(!(t in s.toValue(l))){s.toValue(l)[t]={}}const{x:b=0,y:v=0,width:m=0,height:f=0}=(n=(i=s.toValue(o))==null?void 0:i.getBoundingClientRect())!=null?n:{};s.toValue(l)[t][e]={x:b/s.toValue(r)+s.toValue(c)-s.toValue(p)/s.toValue(r),y:v/s.toValue(r)+s.toValue(u)-s.toValue(d)/s.toValue(r),width:m,height:f,position:a}}function y(t,e){if(!(t in s.toValue(l))){return}const o=s.toValue(l)[t];if(Object.keys(o).length===1){delete s.toValue(l)[t]}else{delete s.toValue(o)[e]}}function B(){f(s.toValue(o).id,s.toValue(n).id,e);g(s.toValue(o).id,s.toValue(n).id,e)}function P(){h(s.toValue(o).id,s.toValue(n).id);y(s.toValue(o).id,s.toValue(n).id)}return{isDisabled:m,onMountedPort:B,onUnmountedPort:P}}const ro={path:"",center:{x:0,y:0}};const co=30;const uo=10;function po(t){const{portsRectMap:e,isDisabledBlockDiagram:o}=Ze();const n=s.computed((()=>{const{sourceBlockId:o,sourcePortId:n,targetBlockId:a,targetPortId:i}=s.toValue(t);const l=o in s.toValue(e);const r=l&&n in s.toValue(e)[o];const c=a in s.toValue(e);const u=c&&i in s.toValue(e)[a];if(!l||!r||!c||!u){return null}const{x:d,y:p,width:b,height:v,position:m}=s.toValue(e)[o][n];const{x:f,y:h,width:g,height:y,position:B}=s.toValue(e)[a][i];return{sourcePort:{x:d+b/2,y:p+v/2,position:m},targetPort:{x:f+g/2,y:h+y/2,position:B}}}));const a=s.computed((()=>{if(s.toValue(n)===null){return ro}const t=s.toValue(n).sourcePort.position;const e=s.toValue(n).targetPort.position;const o=t!==e&&[v.TOP,v.BOTTOM].includes(t)&&[v.TOP,v.BOTTOM].includes(e);const a=t!==e&&[v.LEFT,v.RIGHT].includes(t)&&[v.LEFT,v.RIGHT].includes(e);const{path:i,center:l,points:r}=F({sourceX:s.toValue(n).sourcePort.x,sourceY:s.toValue(n).sourcePort.y,sourcePosition:t,targetX:s.toValue(n).targetPort.x,targetY:s.toValue(n).targetPort.y,targetPosition:e,borderRadius:uo,offset:co});const[c,u,d,p,b,m]=r;const f=c.x===u.x&&c.x===d.x&&p.x===b.x&&p.x===m.x;const h=c.y===u.y&&c.y===d.y&&p.y===b.y&&p.y===m.y;if(f&&o||h&&a){return k(s.toValue(n).sourcePort,s.toValue(n).targetPort,o?P.VERTICAL:P.HORIZONTAL)}return{path:i,center:l}}));const i=s.computed((()=>s.toValue(o)));return{connectionPortsPosition:n,connectionPathInfo:a,isDisabled:i}}function bo(t){const{blockDiagramRef:e}=t;const{blockDiagramRef:o,blockDiagramTop:n,blockDiagramLeft:a}=Ze();let i=null;function l(t){t.forEach((t=>{const{top:e,left:o}=t.boundingClientRect;n.value=e;a.value=o}))}function r(){o.value=s.toValue(e);const{left:t,top:r}=s.toValue(e).getBoundingClientRect();n.value=r;a.value=t;i=new IntersectionObserver(l);i.observe(s.toValue(o))}function c(){i.unobserve(s.toValue(o))}return{onMountedAppElements:r,onUnmountedAppElements:c}}function vo(){const{newConnection:t,isValidNewConnection:e}=Ze();const o=s.computed((()=>s.toValue(t)!==null));const n=s.computed((()=>{if(!s.toValue(o)){return{path:"",center:{x:0,y:0}}}const e=[v.LEFT,v.RIGHT].includes(s.toValue(t).sourcePortPosition);return k(s.toValue(t).start,s.toValue(t).end,e?P.HORIZONTAL:P.VERTICAL)}));const a=s.computed((()=>{if(s.toValue(t)===null){return true}return s.toValue(e)}));return{hasNewConnection:o,newConnectionPathInfo:n,isValid:a}}function mo(){const{zoom:t,isPauseAnimation:e,isStopAnimation:o,animationQueue:n,currentAnimationItem:a,addConnection:i,deleteConnectionById:l,addBlock:r,deleteBlockById:c}=Ze();function u(t){switch(t.type){case m.BLOCK:{r(t.item);break}case m.CONNECTION:{i(t.item);break}case m.REMOVE_BLOCK:{c(t.item.id);break}case m.REMOVE_CONNECTION:{l(t.item.id);break}default:break}}function*d(t){for(const n of t){if(s.toValue(e)){yield}if(s.toValue(o)){break}a.value=n;if(n.type&&n.item){u(n);yield n}}f()}function p(e){const{items:a=[]}=e!=null?e:{};t.value=1;o.value=false;n.value=d(a);if(a.length>0){setTimeout((()=>v()),100)}else{f()}}function b(){e.value=true}function v(){var t;e.value=false;(t=n.value)==null?void 0:t.next()}function f(){o.value=true;e.value=false;a.value=null;n.value=null}return{start:p,pause:b,play:v,stop:f}}const fo={grid:{options:{size:64,gridColor:"#A1B8D9",backgroundColor:"#ECF0F2",zoomStep:4,zoomSteps:[{zoom:1.1,size:64,zoomStep:4},{zoom:1,size:64,zoomStep:4},{zoom:.99,size:64,zoomStep:4},{zoom:.5,size:64*5,zoomStep:.5},{zoom:.25,size:64*25,zoomStep:.25},{zoom:.125,size:64*125,zoomStep:.125}]},instance:Ne}};function ho(t){const{canvasRef:e,transformLayoutRef:o,canvasStyle:n,zoomSensitivity:i,zoomSensitivityMouse:l}=t;const{isDisabledBlockDiagram:r,transformX:c,transformY:u,zoom:d,minZoom:p,maxZoom:b,canvasRef:v,transformLayoutRef:m,canvasWidth:f,canvasHeight:h,canvasInstance:g}=Ze();const y=s.ref(false);const B=s.ref(false);const P=s.ref(false);let k=null;function V(t){if(t&&t.style in fo){return{instance:fo[t.style].instance,options:{...fo[t.style].options,...t}}}return null}function L(){v.value=e;m.value=o;g.value=s.markRaw(new ee({canvas:s.toValue(e),canvasStyle:V(n),minZoom:s.toValue(p),maxZoom:s.toValue(b)}));s.toValue(g).camera.setChangeTransformCallback((t=>{c.value=t.x;u.value=t.y;d.value=t.zoom;f.value=t.width;h.value=t.height}));w()}function H(){var t;(t=s.toValue(g))==null?void 0:t.destroy();cancelAnimationFrame(k)}function x(t){var e;if(s.toValue(r)){return}y.value=true;(e=s.toValue(g))==null?void 0:e.setCameraPositionByMouseDown(t)}function C(t){var e;if(!s.toValue(y)||s.toValue(r)){return}if(t.buttons!==1&&t.buttons!==4){y.value=false;B.value=false;return}B.value=true;(e=s.toValue(g))==null?void 0:e.setCameraPositionByMouseMove(t)}function S(){y.value=false;B.value=false}function F(t){t.preventDefault();if(s.toValue(r)){return}const e=t.wheelDeltaY?t.wheelDeltaY===-3*t.deltaY:t.deltaMode===0;if(t.ctrlKey){var o;const n=e?-t.deltaY*s.toValue(i):-Math.sign(t.deltaY)*s.toValue(l);P.value=true;(o=s.toValue(g))==null?void 0:o.setCameraZoomByWheel(t,n);setTimeout((()=>{P.value=false}),200)}else{var n;(n=s.toValue(g))==null?void 0:n.setCameraPositionByWheel(t)}}function w(){if(g){var t;(t=s.toValue(g))==null?void 0:t.render();const e=s.toValue(g).viewMatrix;a.Dom.style(s.toValue(m),"transform",`\n\t\t\t\t\tmatrix(\n\t\t\t\t\t\t${e[0]}, 0, 0, ${e[4]}, ${e[6]}, ${e[7]}\n\t\t\t\t\t)\n\t\t\t\t`)}k=requestAnimationFrame(w)}return{isDragging:B,onMounted:L,onUnmounted:H,onMouseDown:x,onMouseMove:C,onMouseUp:S,onWheel:F}}function go(){const{zoom:t,blockDiagramTop:e,blockDiagramLeft:o,transformX:n,transformY:a,addBlock:i,hooks:l}=Ze();function r(r){r.preventDefault();const c=r.dataTransfer.getData("text/plain");const u=JSON.parse(c);const{width:d,height:p}=u.dimensions;u.position.x=(r.clientX-d*s.toValue(t)/2)/s.toValue(t);u.position.y=(r.clientY-p*s.toValue(t)/2)/s.toValue(t);u.position.x+=s.toValue(n);u.position.y+=s.toValue(a);u.position.x-=s.toValue(o)/s.toValue(t);u.position.y-=s.toValue(e)/s.toValue(t);i(u);l.dropNewBlock.trigger(u)}function c(t,e){t.dataTransfer.setData("text/plain",JSON.stringify(e))}return{setBlockData:c,onDrop:r}}function yo(t){const{cursorType:e,resizingBlock:o,blockDiagramTop:n,blockDiagramLeft:i,transformX:l,transformY:r,zoom:c,updateBlock:u}=Ze();const{block:d,minWidth:p,minHeight:b,leftSideRef:v,topSideRef:m,rightSideRef:h,bottomSideRef:g,leftTopCornerRef:y,rightTopCornerRef:B,rightBottomCornerRef:P,leftBottomCornerRef:k}=t;const V=s.ref(false);let L=0;let H=0;let x=0;let C=0;const S=s.computed((()=>{if(s.toValue(V)){return{width:`${s.toValue(o).dimensions.width}px`,height:`${s.toValue(o).dimensions.height}px`,cursor:s.toValue(e)}}return{width:`${s.toValue(d).dimensions.width}px`,height:`${s.toValue(d).dimensions.height}px`,cursor:s.toValue(e)}}));function F(){u({...s.toValue(d),position:{x:s.toValue(o).position.x,y:s.toValue(o).position.y},dimensions:{width:s.toValue(o).dimensions.width,height:s.toValue(o).dimensions.height}})}function w(){a.Event.bind(s.toValue(h),"mousedown",D);a.Event.bind(s.toValue(g),"mousedown",A);a.Event.bind(s.toValue(v),"mousedown",G);a.Event.bind(s.toValue(m),"mousedown",Y);a.Event.bind(s.toValue(B),"mousedown",J);a.Event.bind(s.toValue(P),"mousedown",W);a.Event.bind(s.toValue(y),"mousedown",st);a.Event.bind(s.toValue(k),"mousedown",ot)}function E(){a.Event.unbind(s.toValue(h),"mousedown",D);a.Event.unbind(s.toValue(g),"mousedown",A);a.Event.unbind(s.toValue(v),"mousedown",G);a.Event.unbind(s.toValue(m),"mousedown",Y);a.Event.unbind(s.toValue(B),"mousedown",J);a.Event.unbind(s.toValue(P),"mousedown",W);a.Event.unbind(s.toValue(y),"mousedown",st);a.Event.unbind(s.toValue(k),"mousedown",ot)}function M(t,n){t.stopPropagation();e.value=n;o.value={...s.toValue(d)};L=s.toValue(d).position.x;H=s.toValue(d).position.y;x=s.toValue(d).dimensions.width;C=s.toValue(d).dimensions.height;V.value=true}function I(t){t.stopPropagation();e.value="default";F();V.value=false;o.value=null}function _(t){let e=t.clientY/s.toValue(c);e+=s.toValue(r);e-=s.toValue(n)/s.toValue(c);let a=t.clientY/s.toValue(c);a+=s.toValue(r);a-=s.toValue(n)/s.toValue(c);a-=H+C;a=Math.abs(a);const i=H+C-s.toValue(b);o.value.position.y=a<s.toValue(b)||e>=i?i:e;o.value.dimensions.height=a<s.toValue(b)||e>=i?s.toValue(b):a}function T(t){let e=t.clientX/s.toValue(c);e+=s.toValue(l);e-=s.toValue(i)/s.toValue(c);let n=L;n-=t.clientX/s.toValue(c);n-=s.toValue(l);n-=s.toValue(i)/s.toValue(c);n=Math.abs(n);o.value.dimensions.width=n<s.toValue(p)||e<=L?s.toValue(p):n}function O(t){let e=t.clientY/s.toValue(c);e+=s.toValue(r);e-=s.toValue(n)/s.toValue(c);let a=t.clientY/s.toValue(c);a-=H;a+=s.toValue(r);a-=s.toValue(n)/s.toValue(c);a=Math.abs(a);o.value.dimensions.height=a<s.toValue(b)||e<=H?s.toValue(b):a}function R(t){let e=t.clientX/s.toValue(c);e+=s.toValue(l);e-=s.toValue(i)/s.toValue(c);let n=t.clientX/s.toValue(c);n+=s.toValue(l);n-=s.toValue(i)/s.toValue(c);n-=L+x;n=Math.abs(n);const a=L+x-s.toValue(p);o.value.position.x=n<s.toValue(p)||e>=a?a:e;o.value.dimensions.width=n<s.toValue(p)||e>=a?s.toValue(p):n}function D(t){M(t,f.EW_RESIZE);a.Event.bind(document,"mousemove",N);a.Event.bind(document,"mouseup",z)}function N(t){t.stopPropagation();if(!s.toValue(V)){return}T(t)}function z(t){I(t);a.Event.unbind(document,"mousemove",N);a.Event.unbind(document,"mouseup",z)}function A(t){M(t,f.NS_RESIZE);a.Event.bind(document,"mousemove",j);a.Event.bind(document,"mouseup",K)}function j(t){t.stopPropagation();if(!s.toValue(V)){return}O(t)}function K(t){I(t);a.Event.unbind(document,"mousemove",j);a.Event.unbind(document,"mouseup",K)}function G(t){M(t,f.EW_RESIZE);a.Event.bind(document,"mousemove",X);a.Event.bind(document,"mouseup",$)}function X(t){t.stopPropagation();if(!s.toValue(V)){return}R(t)}function $(t){I(t);a.Event.unbind(document,"mousemove",X);a.Event.unbind(document,"mouseup",$)}function Y(t){M(t,f.NS_RESIZE);a.Event.bind(document,"mousemove",Z);a.Event.bind(document,"mouseup",U)}function Z(t){t.stopPropagation();if(!s.toValue(V)){return}_(t)}function U(t){I(t);a.Event.unbind(document,"mousemove",Z);a.Event.unbind(document,"mouseup",U)}function W(t){M(t,f.NWSE_RESIZE);a.Event.bind(document,"mousemove",q);a.Event.bind(document,"mouseup",Q)}function q(t){t.stopPropagation();if(!s.toValue(V)){return}T(t);O(t)}function Q(t){I(t);a.Event.unbind(document,"mousemove",q);a.Event.unbind(document,"mouseup",Q)}function J(t){M(t,f.NESW_RESIZE);a.Event.bind(document,"mousemove",tt);a.Event.bind(document,"mouseup",et)}function tt(t){t.stopPropagation();if(!s.toValue(V)){return}_(t);T(t)}function et(t){I(t);a.Event.unbind(document,"mousemove",tt);a.Event.unbind(document,"mouseup",et)}function ot(t){M(t,f.NESW_RESIZE);a.Event.bind(document,"mousemove",nt);a.Event.bind(document,"mouseup",at)}function nt(t){t.stopPropagation();if(!s.toValue(V)){return}R(t);O(t)}function at(t){I(t);a.Event.unbind(document,"mousemove",nt);a.Event.unbind(document,"mouseup",at)}function st(t){M(t,f.NWSE_RESIZE);a.Event.bind(document,"mousemove",it);a.Event.bind(document,"mouseup",lt)}function it(t){t.stopPropagation();if(!s.toValue(V)){return}R(t);_(t)}function lt(t){I(t);a.Event.unbind(document,"mousemove",it);a.Event.unbind(document,"mouseup",lt)}return{isResize:V,sizeBlockStyle:S,onMounted:w,onUnmounted:E}}function Bo(t){const{zoom:e,setSelectionWorldRect:o,setSelectionActive:n,isSelectionActive:a}=Ze();const{rootRef:i,transformLayoutRef:l}=t;const r=s.ref({x:0,y:0,width:0,height:0});let c=0;let u=0;let d=null;let p=null;function b(t){const e=s.toValue(i);const o=s.toValue(l);if(!e||!o){return}c=t.clientX;u=t.clientY;d=e.getBoundingClientRect();p=o.getBoundingClientRect();const a=c-d.left;const b=u-d.top;n(true);r.value={x:a,y:b,width:0,height:0}}function v(t){if(!s.toValue(a)||!d||!p){return}const n=s.toValue(i);const b=s.toValue(l);const v=s.toValue(e);if(!n||!b||!v){return}const m=c-d.left;const f=u-d.top;const h=t.clientX-d.left;const g=t.clientY-d.top;r.value={x:Math.min(m,h),y:Math.min(f,g),width:Math.abs(h-m),height:Math.abs(g-f)};const y=c-p.left;const B=u-p.top;const P=t.clientX-p.left;const k=t.clientY-p.top;o({x:Math.min(y,P)/v,y:Math.min(B,k)/v,width:Math.abs(P-y)/v,height:Math.abs(k-B)/v})}function m(){if(s.toValue(a)){n(false);o(null);r.value={x:0,y:0,width:0,height:0}}d=null;p=null}return{isSelecting:a,selectionRect:r,start:b,move:v,end:m}}function Po(t){const{blocks:e,zoom:o,updateBlock:n,setPortOffsetByBlockId:i,highlitedBlockIds:l}=Ze();let r=0;let c=0;let u=0;let d=0;let p=[];function b(o){o.stopPropagation();t();if(o.button!==0){return}r=o.clientX;c=o.clientY;u=0;d=0;p=[];const n=s.toValue(l);const i=s.toValue(e);n.forEach((t=>{const e=i.find((e=>e.id===t));if(e){p.push({block:e,startX:Number(e.position.x),startY:Number(e.position.y)})}}));a.Event.bind(window,"mousemove",v);a.Event.bind(window,"mouseup",m)}function v(t){t.preventDefault();const e=s.toValue(o);if(!e){return}const n=(t.clientX-r)/e;const a=(t.clientY-c)/e;const l=n-u;const b=a-d;u=n;d=a;for(const t of p){const{block:e,startX:o,startY:s}=t;e.position.x=o+n;e.position.y=s+a;if(i){i(e.id,{x:-l,y:-b})}}}function m(){a.Event.unbind(window,"mousemove",v);a.Event.unbind(window,"mouseup",m);for(const t of p){const{block:e}=t;e.position.x=Math.round(e.position.x);e.position.y=Math.round(e.position.y);if(i){i(e.id,{x:0,y:0})}n({...e})}p=[]}return{onGroupMouseDown:b}}function ko(t,e){const{blocks:o,transformLayoutRef:n,highlitedBlockIds:i,setSelectionActive:l,isSelectionActive:r}=Ze();const c=e.defaultBlockSize.width;const u=e.defaultBlockSize.height;const d=(t,e)=>{var o,n;let a=(o=t.dimensions)==null?void 0:o.width;let s=(n=t.dimensions)==null?void 0:n.height;if(!a||!s){const o=e==null?void 0:e.querySelector(`[data-id="${t.id}"]`);if(o){a=o.offsetWidth;s=o.offsetHeight}else{a=c;s=u}}return{w:a,h:s}};const p=()=>{const t=s.toValue(e.padding);if(a.Type.isNumber(t)){return{top:t,right:t,bottom:t,left:t}}return{top:t.top,right:t.right,bottom:t.bottom,left:t.left}};function b(t){if(!t){l(false);return}const e=s.toValue(o);const a=s.toValue(n);const r=new Set;e.forEach((e=>{const{x:o,y:n}=e.position;const{w:s,h:i}=d(e,a);const l=t.x<o+s&&t.x+t.width>o&&t.y<n+i&&t.y+t.height>n;if(l){r.add(e.id)}}));const c=s.toValue(i)||[];const u=c.filter((t=>r.has(t)));r.forEach((t=>{if(!u.includes(t)){u.push(t)}}));i.value=u}function v(){l(true);t();i.value=[]}const m=s.computed((()=>{if(s.toValue(r)){return null}const t=s.toValue(i)||[];if(t.length<=1){return null}let e=Infinity;let a=Infinity;let l=-Infinity;let c=-Infinity;let u=false;const b=s.toValue(o);const v=s.toValue(n);t.forEach((t=>{const o=b.find((e=>e.id===t));if(o){u=true;const{x:t,y:n}=o.position;const{w:s,h:i}=d(o,v);e=Math.min(e,t);a=Math.min(a,n);l=Math.max(l,t+s);c=Math.max(c,n+i)}}));if(!u){return null}const m=p();return{left:`${e-m.left}px`,top:`${a-m.top}px`,width:`${l-e+m.left+m.right}px`,height:`${c-a+m.top+m.bottom}px`}}));return{onCanvasSelect:b,onSelectionStart:v,groupSelectionStyle:m}}const Vo={base:"ui-block-diagram-canvas-transform",dragging:"--dragging",grabbing:"--grabbing",grab:"--grab"};const Lo="Space";const Ho=Object.freeze({INPUT:true,TEXTAREA:true,SELECT:true});const xo={name:"canvas-transform",props:{canvasStyle:{type:Object,required:true},zoomSensitivity:{type:Number,default:.01},zoomSensitivityMouse:{type:Number,default:.04},selectionEnabled:{type:Boolean,default:true}},emits:["openContextMenu"],setup(t,{emit:e}){const o=s.useTemplateRef("rootRef");const n=s.useTemplateRef("canvasLayout");const i=s.useTemplateRef("transformLayout");const l=s.ref(false);const r=s.ref(false);const{isDragging:c,onMounted:u,onUnmounted:d,onMouseDown:p,onMouseMove:b,onMouseUp:v,onWheel:m}=ho({canvasRef:n,transformLayoutRef:i,canvasStyle:t.canvasStyle,zoomSensitivity:t.zoomSensitivity,zoomSensitivityMouse:t.zoomSensitivityMouse});const{isSelecting:f,selectionRect:h,start:g,move:y,end:B}=Bo({rootRef:o,transformLayoutRef:i});const P=s.computed((()=>({[Vo.base]:true,[Vo.dragging]:s.toValue(c),[Vo.grabbing]:s.toValue(r),[Vo.grab]:s.toValue(l)&&!s.toValue(r)})));s.onMounted((()=>{u();a.Event.bind(window,"keydown",H);a.Event.bind(window,"keyup",x)}));s.onUnmounted((()=>{d();a.Event.unbind(window,"keydown",H);a.Event.unbind(window,"keyup",x)}));function k(e){if(e.button===2){return}const o=e.button===1;const n=e.button===0;const a=s.toValue(l);const i=o||n&&(a||!t.selectionEnabled);const c=n&&!a&&t.selectionEnabled;if(i){if(s.toValue(f)){B()}r.value=true;if(o||n&&!t.selectionEnabled){e.preventDefault()}p(e)}else if(c){r.value=false;e.preventDefault();g(e)}}function V(t){if(s.toValue(f)&&s.toValue(l)){B();r.value=true;p(t)}if(s.toValue(f)){y(t)}else if(s.toValue(r)){b(t)}}function L(){if(s.toValue(f)){B()}if(s.toValue(r)){r.value=false;v()}}const H=t=>{if(t.code!==Lo){return}if(t.repeat){return}const e=t.target;const o=e.tagName in Ho||e.isContentEditable;if(o){return}l.value=true};const x=t=>{if(t.code===Lo){l.value=false}};function C(t){var o;if(t.target===s.toValue(n)||((o=t.target)==null?void 0:o.parentElement)===s.toValue(i)){e("openContextMenu",t)}}return{rootRef:o,canvasRef:n,transformLayoutRef:i,canvasTransformClassNames:P,onMouseDown:k,onMouseMove:V,onMouseUp:L,onWheel:m,openContextMenu:C,isSelecting:f,selectionRect:h}},template:`\n\t\t<div\n\t\t\tref="rootRef"\n\t\t\t:class="canvasTransformClassNames"\n\t\t\t@mousedown="onMouseDown"\n\t\t\t@mousemove="onMouseMove"\n\t\t\t@mouseup="onMouseUp"\n\t\t\t@wheel="onWheel"\n\t\t\t@contextmenu.prevent="openContextMenu"\n\t\t>\n\t\t\t<canvas\n\t\t\t\tref="canvasLayout"\n\t\t\t\tclass="ui-block-diagram-canvas-transform__canvas"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tref="transformLayout"\n\t\t\t\tclass="ui-block-diagram-canvas-transform__transform"\n\t\t\t>\n\t\t\t\t<slot/>\n\t\t\t</div>\n\t\t\t<div v-if="isSelecting" class="ui-block-diagram-selection-rect"\n\t\t\t\t :style="{\n\t\t\t\t\tleft: selectionRect.x + 'px',\n\t\t\t\t\ttop: selectionRect.y + 'px',\n\t\t\t\t\twidth: selectionRect.width + 'px',\n\t\t\t\t\theight: selectionRect.height + 'px'\n\t\t\t\t}"\n\t\t\t>\n\t\t\t</div>\n\t\t</div>\n\t`};const Co={base:"ui-block-diagram-connection__target",active:"--active"};const So={name:"diagram-connection",props:{connection:{type:Object,required:true},barWidth:{type:Number,default:22},barHeight:{type:Number,default:22},contextMenuItems:{type:Array,default:()=>[]},disabled:{type:Boolean,default:false}},setup(t){const{connectionPathInfo:e,isDisabled:o}=po(t.connection);const{deleteConnectionById:n}=Ze();const a=io();const{isOpen:i,showContextMenu:l}=Ue([{id:"deleteConnection",text:a.getMessage("UI_BLOCK_DIAGRAM_DELETE_CONNECTION_CONTEXT_MENU_ITEM"),onclick:()=>{n(t.connection.id)}}]);const r=s.computed((()=>({[Co.base]:true,[Co.active]:s.toValue(i)})));const c=s.computed((()=>{var o;const{x:n=0,y:a=0}=(o=s.toValue(e).center)!=null?o:{};return{x:n-t.barWidth/2,y:a-t.barHeight/2}}));function u(e){if(s.toValue(o)||t.disabled){return}e.preventDefault();l(e)}return{isDisabled:o,connectionPathInfo:e,targetConnectionClasses:r,barPosition:c,onOpenContextMenu:u}},template:`\n\t\t<svg class="ui-block-diagram-connection">\n\t\t\t<g class="ui-block-diagram-connection__group">\n\t\t\t\t<path\n\t\t\t\t\t:d="connectionPathInfo.path"\n\t\t\t\t\t:class="targetConnectionClasses"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('connectionLine', connection.id)"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\t:d="connectionPathInfo.path"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('connectionHoveredLine', connection.id)"\n\t\t\t\t\tclass="ui-block-diagram-connection__hovered"\n\t\t\t\t\tstroke="transparent"\n\t\t\t\t\tfill="transparent"\n\t\t\t\t\t@contextmenu="onOpenContextMenu"\n\t\t\t\t/>\n\t\t\t\t<foreignObject\n\t\t\t\t\t:x="barPosition.x"\n\t\t\t\t\t:y="barPosition.y"\n\t\t\t\t\t:width="barWidth"\n\t\t\t\t\t:height="barHeight"\n\t\t\t\t\tclass="ui-block-diagram-connection__bar"\n\t\t\t\t>\n\t\t\t\t\t<slot :isDisabled="isDisabled || disabled" />\n\t\t\t\t</foreignObject>\n\t\t\t</g>\n\t\t</svg>\n\t`};const Fo={name:"delete-connection-btn",components:{BIcon:n.BIcon},props:{connectionId:{type:String,required:true},disabled:{type:Boolean,default:false}},setup(t){const{deleteConnectionById:e}=Ze();function o(){if(t.disabled){return}e(t.connectionId)}return{iconSet:n.Outline,onDeleteConnection:o}},template:`\n\t\t<button\n\t\t\tclass="ui-block-diagram-delete-connection-btn"\n\t\t\t:data-test-id="$blockDiagramTestId('connectionDeleteBtn', connectionId)"\n\t\t\t@click="onDeleteConnection"\n\t\t>\n\t\t\t<div class="ui-block-diagram-delete-connection-btn__icon-wrap">\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="iconSet.TRASHCAN"\n\t\t\t\t\t:size="14"\n\t\t\t\t\tclass="ui-block-diagram-delete-connection-btn__icon"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</button>\n\t`};const wo={name:"ContextMenuLayout",setup(){const t=Ze();const e=s.computed((()=>({top:`${s.toValue(t.positionContextMenu).top}px`,left:`${s.toValue(t.positionContextMenu).left}px`})));return{instance:t,targetContainerStyle:e}},template:`\n\t\t<div\n\t\t\t:ref="instance.contextMenuLayerRef"\n\t\t\tclass="ui-block-diagram-context-menu__layout"\n\t\t>\n\t\t\t<slot/>\n\t\t\t<div\n\t\t\t\t:ref="instance.targetContainerRef"\n\t\t\t\t:style="targetContainerStyle"\n\t\t\t\tclass="ui-block-diagram-context-menu__target-container"\n\t\t\t\t@mousedown.stop\n\t\t\t/>\n\t\t</div>\n\t`};const Eo={name:"blocks-queue-transition",setup(){const{isAnimate:t,currentAnimationItem:e,animationQueue:o,hooks:n}=Ze();const a=ao();const i=Ge();const l=so();function r(){var t,e;const{done:n=false}=(t=(e=s.toValue(o))==null?void 0:e.next())!=null?t:{};if(n){o.value=null}else{i.makeSnapshot()}}function c(){var t;n.blockTransitionStart.trigger((t=s.toValue(e))==null?void 0:t.item)}function u(){l.clear();l.add(s.toValue(e).item.id);a.goToBlockById(s.toValue(e).item.id)}function d(){var t;n.blockTransitionEnd.trigger((t=s.toValue(e))==null?void 0:t.item);r()}function p(){r()}return{isAnimate:t,onBeforeEnter:c,onEnter:u,onAfterEnter:d,onAfterLeave:p}},template:`\n\t\t<TransitionGroup\n\t\t\tv-if="isAnimate"\n\t\t\tname="ui-block-diagram-blocks-queue-transition"\n\t\t\t@before-enter="onBeforeEnter"\n\t\t\t@enter="onEnter"\n\t\t\t@after-enter="onAfterEnter"\n\t\t\t@after-leave="onAfterLeave"\n\t\t>\n\t\t\t<slot/>\n\t\t</TransitionGroup>\n\t\t<template v-else>\n\t\t\t<slot/>\n\t\t</template>\n\t`};const Mo={name:"grouped-blocks",components:{BlocksQueueTransition:Eo},setup(){const{groupedBlocks:t,blockGroupNames:e}=Ze();return{blockGroupNames:e,groupedBlocks:t,getGroupBlockSlotName:N}},template:`\n\t\t<BlocksQueueTransition>\n\t\t\t<slot\n\t\t\t\tv-for="group in blockGroupNames"\n\t\t\t\t:key="group"\n\t\t\t\t:name="getGroupBlockSlotName(group)"\n\t\t\t\t:blocks="groupedBlocks[group]"\n\t\t\t/>\n\t\t</BlocksQueueTransition>\n\t`};const Io={base:"ui-block-diagram-new-connection__path",error:"--error"};const _o={name:"NewConnection",setup(t){const{hasNewConnection:e,newConnectionPathInfo:o,isValid:n}=vo();const a=s.computed((()=>({[Io.base]:true,[Io.error]:!s.toValue(n)})));return{hasNewConnection:e,newConnectionPathInfo:o,pathClassNames:a}},template:`\n\t\t<svg\n\t\t\tv-if="hasNewConnection"\n\t\t\tclass="ui-block-diagram-new-connection"\n\t\t>\n\t\t\t<path\n\t\t\t\t:d="newConnectionPathInfo.path"\n\t\t\t\t:class="pathClassNames"\n\t\t\t/>\n\t\t</svg>\n\t`};const To={name:"connections-queue-transition",setup(){const{isAnimate:t,currentAnimationItem:e,animationQueue:o,updatePortPosition:n,hooks:a}=Ze();const i=Ge();function l(){var t;const{item:o}=(t=s.toValue(e))!=null?t:{};a.connectionTransitionStart.trigger(o);const{sourceBlockId:i,sourcePortId:l,targetBlockId:r,targetPortId:c}=o;n(i,l);n(r,c)}function r(){var t,e;const{done:n=false}=(t=(e=s.toValue(o))==null?void 0:e.next())!=null?t:{};if(n){o.value=null}else{i.makeSnapshot()}}function c(){var t;a.connectionTransitionEnd.trigger((t=s.toValue(e))==null?void 0:t.item);r()}function u(){r()}return{isAnimate:t,onBeforeEnter:l,onAfterEnter:c,onAfterLeave:u}},template:`\n\t\t<TransitionGroup\n\t\t\tv-if="isAnimate"\n\t\t\tname="ui-block-diagram-connections-queue-transition"\n\t\t\t@before-enter="onBeforeEnter"\n\t\t\t@after-enter="onAfterEnter"\n\t\t\t@after-leave="onAfterLeave"\n\t\t>\n\t\t\t<slot/>\n\t\t</TransitionGroup>\n\t\t<template v-else>\n\t\t\t<slot/>\n\t\t</template>\n\t`};const Oo={name:"grouped-connections",components:{Connection:So,NewConnection:_o,ConnectionsQueueTransition:To},setup(){const{groupedConnections:t,connectionGroupNames:e}=Ze();return{groupedConnections:t,connectionGroupNames:e,getGroupConnectionSlotName:z}},template:`\n\t\t<ConnectionsQueueTransition>\n\t\t\t<slot\n\t\t\t\tv-for="connection in connectionGroupNames"\n\t\t\t\t:key="connection"\n\t\t\t\t:name="getGroupConnectionSlotName(connection)"\n\t\t\t\t:connections="groupedConnections[connection]"\n\t\t\t/>\n\t\t\t<NewConnection/>\n\t\t</ConnectionsQueueTransition>\n\t`};const Ro={name:"moveable-block",props:{block:{type:Object,required:true},highlighted:{type:Boolean,default:false}},setup(t){const{block:e}=s.toRefs(t);const{isMakeNewConnection:o}=Ze();const{blockZindex:n,isHiglitedBlock:a,isDisabled:i}=qe(e);const l=so();const{isDragged:r,blockPositionStyle:c}=Qe(s.useTemplateRef("blockEl"),e);s.watch((()=>t.highlighted),(e=>{if(e){l.add(t.block.id)}else{l.remove(t.block.id)}}));const u=s.computed((()=>({...s.toValue(c),...s.toValue(n)})));s.onUnmounted((()=>{l.remove(t.block.id)}));function d(){l.clear();l.add(t.block.id)}return{isHiglitedBlock:a,isDisabled:i,isDragged:r,isMakeNewConnection:o,blockStyle:u,blockZindex:n,blockPositionStyle:c,onMouseDownSelectBlock:d}},template:`\n\t\t<div\n\t\t\tclass="ui-block-diagram-moveable-block"\n\t\t\t:style="blockStyle"\n\t\t\tref="blockEl"\n\t\t\t:data-test-id="$blockDiagramTestId('block', block.id)"\n\t\t\t:data-id="block.id"\n\t\t\t@mousedown="onMouseDownSelectBlock"\n\t\t>\n\t\t\t<slot\n\t\t\t\t:block="block"\n\t\t\t\t:isHighlighted="isHiglitedBlock"\n\t\t\t\t:isDragged="isDragged"\n\t\t\t\t:isDisabled="isDisabled"\n\t\t\t\t:isMakeNewConnection="isMakeNewConnection"\n\t\t\t/>\n\t\t</div>\n\t`};const Do={base:"ui-block-diagram-port",disabled:"--disabled",active:"--active",error:"--error"};const No={name:"DiagramPort",props:{block:{type:Object,required:true},port:{type:Object,required:true},position:{type:String,required:true,validator(t){return Object.values(v).includes(t)}},validationRules:{type:Array,default:()=>[]},normalyzeConnectionFn:{type:Function,default:null},disabled:{type:Boolean,default:false}},setup(t){const{isDisabled:e,onMountedPort:o,onUnmountedPort:n}=lo({portRef:s.useTemplateRef("port"),block:t.block,port:t.port,position:t.position});const{isSourcePort:a,isValid:i,onMouseDownPort:l,onMouseOverPort:r,onMouseLeavePort:c}=We({block:t.block,port:t.port,position:t.position,validationRules:t.validationRules,normalyzeConnectionFn:t.normalyzeConnectionFn});const u=s.computed((()=>({[Do.base]:true,[Do.active]:s.toValue(a),[Do.disabled]:s.toValue(e),[Do.error]:!s.toValue(i)})));s.onMounted((()=>{o()}));s.onUnmounted((()=>{n()}));return{portClassNames:u,onMouseDownPort:l,onMouseOverPort:r,onMouseLeavePort:c}},template:`\n\t\t<div\n\t\t\tref="port"\n\t\t\t:class="portClassNames"\n\t\t\t:data-test-id="$blockDiagramTestId('port', port.id)"\n\t\t\t@mousedown="onMouseDownPort"\n\t\t\t@mouseover="onMouseOverPort"\n\t\t\t@mouseleave="onMouseLeavePort"\n\t\t/>\n\t`};const zo={base:"ui-block-diagram-block-content-stub",highlighted:"--highlighted"};const Ao={name:"block-content-stub",components:{Port:No},props:{block:{type:Object,required:true},highlighted:{type:Boolean,default:false},dragged:{type:Boolean,default:false},disabled:{type:Boolean,default:false}},setup(t){const{deleteBlockById:e}=Ze();const o=io();const{showContextMenu:n}=Ue([{id:"deleteConnection",text:o.getMessage("UI_BLOCK_DIAGRAM_DELETE_BLOCK_CONTEXT_MENU_ITEM"),onclick:()=>{e(t.block.id)}}]);const a=s.computed((()=>({[zo.base]:true,[zo.highlighted]:t.highlighted})));function i(e){e.preventDefault();if(t.disabled){return}const{clientX:o,clientY:a}=e;n({clientX:o,clientY:a})}return{blockContentClassNames:a,onShowContextMenu:i}},template:`\n\t\t<div\n\t\t\t:class="blockContentClassNames"\n\t\t\t@contextmenu="onShowContextMenu"\n\t\t>\n\t\t\t<div class="ui-block-diagram-block-content-stub__id">\n\t\t\t\t{{ block.id }}\n\t\t\t</div>\n\n\t\t\t<div class="ui-block-diagram-block-content-stub__left-column">\n\t\t\t\t<div\n\t\t\t\t\tv-for="port in block.ports.input"\n\t\t\t\t\t:key="port.id"\n\t\t\t\t\tclass="ui-block-diagram-block-content-stub__port-line"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-block-diagram-block-content-stub__port --left">\n\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t:port="port"\n\t\t\t\t\t\t\t:styled="false"\n\t\t\t\t\t\t\t:portsToShow="null"\n\t\t\t\t\t\t\tposition="left"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="ui-block-diagram-block-content-stub__right-column">\n\t\t\t\t<div\n\t\t\t\t\tv-for="port in block.ports.output"\n\t\t\t\t\t:key="port.id"\n\t\t\t\t\tclass="ui-block-diagram-block-content-stub__port-line"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-block-diagram-block-content-stub__port --right">\n\t\t\t\t\t\t<Port\n\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t:port="port"\n\t\t\t\t\t\t\t:styled="false"\n\t\t\t\t\t\t\t:portsToShow="null"\n\t\t\t\t\t\t\tposition="right"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const jo="#A1B8D9";const Ko="#ECF0F2";const Go={base:"ui-block-diagram",ewResize:"--cursor-ew-resize",nsResize:"--cursor-ns-resize",nwSeResize:"--cursor-nwse-resize",neSwResize:"--cursor-nesw-resize",grabbing:"--grabbing",disabled:"--disabled"};const Xo={name:"block-diagram",components:{CanvasTransform:xo,ContextMenuLayout:wo,GroupedBlocks:Mo,GroupedConnections:Oo,Connection:So,DeleteConnectionBtn:Fo,MoveableBlock:Ro,BlockContentStub:Ao},props:{blocks:{type:Array,required:true},connections:{type:Array,required:true},canvasStyle:{type:Object,default:()=>({style:"grid",size:64,gridColor:jo,backgroundColor:Ko})},zoomSensitivity:{type:Number,default:.01},zoomSensitivityMouse:{type:Number,default:.04},zoom:{type:Number,default:1},minZoom:{type:Number,default:.2},maxZoom:{type:Number,default:4},historyHooks:{type:Array,default:()=>[u.END_DRAG_BLOCK,u.ADD_BLOCK,u.DELETE_BLOCK,u.CREATE_CONNECTION,u.DELETE_CONNECTION]},snapshotHandler:{type:Function,default:null},revertHandler:{type:Function,default:null},disabled:{type:Boolean,default:false},enableGrouping:{type:Boolean,default:false},contextMenuItems:{type:Array,default:()=>[]}},emits:["update:blocks","update:connections",u.CHANGED_BLOCKS,u.CHANGED_CONNECTIONS,u.START_DRAG_BLOCK,u.MOVE_DRAG_BLOCK,u.END_DRAG_BLOCK,u.ADD_BLOCK,u.UPDATE_BLOCK,u.DELETE_BLOCK,u.CREATE_CONNECTION,u.DELETE_CONNECTION,u.BLOCK_TRANSITION_START,u.BLOCK_TRANSITION_END,u.CONNECTION_TRANSITION_START,u.CONNECTION_TRANSITION_END,u.DROP_NEW_BLOCK],setup(t,{emit:e}){const{blockGroupNames:o,connectionGroupNames:n,cursorType:a}=Ze(t);const i=bo({blockDiagramRef:s.useTemplateRef("blockDiagram")});const{makeSnapshot:l}=Ge();const{dispose:r}=Je(e);const{dispose:c}=to(t);const{dispose:d}=eo({...Object.entries(u).reduce(((t,[o,n])=>{t[n]=(...t)=>{e(n,...t)};return t}),{})},{...t.historyHooks.reduce(((t,e)=>{t[e]=()=>l();return t}),{})});const{onDrop:p}=go();const b=s.ref(false);const v=s.computed((()=>({[Go.base]:true,[Go.grabbing]:b.value,[Go.disabled]:t.disabled,[Go.ewResize]:s.toValue(a)===f.EW_RESIZE,[Go.nsResize]:s.toValue(a)===f.NS_RESIZE,[Go.nwSeResize]:s.toValue(a)===f.NWSE_RESIZE,[Go.neSwResize]:s.toValue(a)===f.NESW_RESIZE})));const{showContextMenu:m}=Ue();s.onMounted((()=>{i.onMountedAppElements()}));s.onUnmounted((()=>{r();c();d();i.onUnmountedAppElements()}));function h(t){b.value=true}function g(t){b.value=false}function y(t){b.value=false;p(t)}function B(e){if(t.contextMenuItems.length>0){m({clientX:e.clientX,clientY:e.clientY,items:t.contextMenuItems})}}return{blockDiagramClassNames:v,blockGroupNames:o,connectionGroupNames:n,getGroupBlockSlotName:N,getGroupConnectionSlotName:z,onDragDrop:y,onDragEnter:h,onDragLeave:g,openContextMenu:B}},template:`\n\t\t<div\n\t\t\t:class="blockDiagramClassNames"\n\t\t\tref="blockDiagram"\n\t\t\t@dragover.prevent\n\t\t\t@dragenter="onDragEnter"\n\t\t\t@dragleave="onDragLeave"\n\t\t\t@drop="onDragDrop"\n\t\t>\n\t\t\t<CanvasTransform\n\t\t\t\t:canvasStyle="canvasStyle"\n\t\t\t\t:zoomSensitivity="zoomSensitivity"\n\t\t\t\t:zoomSensitivityMouse="zoomSensitivityMouse"\n\t\t\t\t@openContextMenu="openContextMenu"\n\t\t\t\t:selectionEnabled="enableGrouping"\n\t\t\t>\n\t\t\t\t<slot name="group-selection-box"/>\n\t\t\t\t<ContextMenuLayout>\n\t\t\t\t\t<GroupedConnections>\n\t\t\t\t\t\t<template\n\t\t\t\t\t\t\tv-for="groupName in connectionGroupNames"\n\t\t\t\t\t\t\t#[getGroupConnectionSlotName(groupName)]="{ connections }"\n\t\t\t\t\t\t\t:key="groupName"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\tv-for="connection in connections"\n\t\t\t\t\t\t\t\t:name="getGroupConnectionSlotName(groupName)"\n\t\t\t\t\t\t\t\t:key="connection.id"\n\t\t\t\t\t\t\t\t:connection="connection"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<Connection\n\t\t\t\t\t\t\t\t\t:connection="connection"\n\t\t\t\t\t\t\t\t\t:key="connection.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #default="{ isDisabled }">\n\t\t\t\t\t\t\t\t\t\t<DeleteConnectionBtn \n\t\t\t\t\t\t\t\t\t\t\t:connectionId="connection.id"\n\t\t\t\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</Connection>\n\t\t\t\t\t\t\t</slot>\n\t\t\t\t\t\t</template>\n\n\t\t\t\t\t\t<template #new-connection>\n\t\t\t\t\t\t\t<slot name="new-connection"/>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</GroupedConnections>\n\t\t\t\t\t<GroupedBlocks>\n\t\t\t\t\t\t<template\n\t\t\t\t\t\t\tv-for="groupName in blockGroupNames"\n\t\t\t\t\t\t\t#[getGroupBlockSlotName(groupName)]="{ blocks }"\n\t\t\t\t\t\t\t:key="groupName"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<slot\n\t\t\t\t\t\t\t\tv-for="block in blocks"\n\t\t\t\t\t\t\t\t:name="getGroupBlockSlotName(groupName)"\n\t\t\t\t\t\t\t\t:key="block.id"\n\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<MoveableBlock\n\t\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t\t:key="block.id"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<template #default="{ isHighlighted, isDragged, isDisabled }">\n\t\t\t\t\t\t\t\t\t\t<BlockContentStub\n\t\t\t\t\t\t\t\t\t\t\t:block="block"\n\t\t\t\t\t\t\t\t\t\t\t:highlighted="isHighlighted"\n\t\t\t\t\t\t\t\t\t\t\t:dragged="isDragged"\n\t\t\t\t\t\t\t\t\t\t\t:disabled="isDisabled"\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t</MoveableBlock>\n\t\t\t\t\t\t\t</slot>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</GroupedBlocks>\n\t\t\t\t</ContextMenuLayout>\n\t\t\t</CanvasTransform>\n\t\t</div>\n\t`};const $o={name:"icon-button",components:{BIcon:n.BIcon},props:{iconName:{type:String,default:""},size:{type:[Number,String],default:16},color:{type:String,default:"#959CA4"},active:{type:Boolean,default:false},activeColor:{type:String,default:"#4A9DFF"},disabled:{type:Boolean,default:false}},setup(t){const{size:e,active:o,disabled:n}=s.toRefs(t);const a=s.computed((()=>({"ui-block-diagram-icon-button":true,"--disabled":s.toValue(n)})));const i=s.computed((()=>({width:`${s.toValue(e)}px`,height:`${s.toValue(e)}px`})));const l=s.computed((()=>({"ui-block-diagram-icon-button__icon":true,"--active":s.toValue(o)})));return{buttonClassNames:a,buttonStyle:i,iconClassNames:l}},template:`\n\t\t<button\n\t\t\t:class="buttonClassNames"\n\t\t\t:style="buttonStyle"\n\t\t>\n\t\t\t<slot>\n\t\t\t\t<BIcon\n\t\t\t\t\t:class="iconClassNames"\n\t\t\t\t\t:name="iconName"\n\t\t\t\t\t:color="color"\n\t\t\t\t\t:size="size"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t</button>\n\t`};const Yo={name:"history-bar",components:{IconButton:$o},props:{disabled:{type:Boolean,default:false}},setup(t){const{isDisabledBlockDiagram:e}=Ze();const{hasNext:o,hasPrev:a,next:i,prev:l}=Ge();function r(){if(t.disabled||s.toValue(e)){return}i()}function c(){if(t.disabled||s.toValue(e)){return}l()}return{hasNext:o,hasPrev:a,onNext:r,onPrev:c,Outline:n.Outline}},template:`\n\t\t<div class="ui-block-diagram-histoy-bar">\n\t\t\t<slot>\n\t\t\t\t<IconButton\n\t\t\t\t\tclass="ui-block-diagram-histoy-bar__prev-button"\n\t\t\t\t\t:icon-name="Outline.FORWARD"\n\t\t\t\t\t:size="22"\n\t\t\t\t\t:disabled="!hasPrev"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('historyPrevBtn')"\n\t\t\t\t\t@click="onPrev"\n\t\t\t\t/>\n\t\t\t\t<IconButton\n\t\t\t\t\t:icon-name="Outline.FORWARD"\n\t\t\t\t\t:size="22"\n\t\t\t\t\t:disabled="!hasNext"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('historyNextBtn')"\n\t\t\t\t\t@click="onNext"\n\t\t\t\t/>\n\t\t\t</slot>\n\t\t</div>\n\t`};const Zo={in:"in",out:"out"};const Uo={name:"zoom-btn",components:{BIcon:n.BIcon},props:{stepZoom:{type:Number,default:.2},typeZoom:{type:String,default:Zo.in,validator(t){return t===Zo.in||t===Zo.out}},disabled:{type:Boolean,default:false}},emits:["zoom-change"],setup(t,{emit:e}){const{isDisabledBlockDiagram:o}=Ze();const{zoomIn:a,zoomOut:i}=ao();const{stepZoom:l,typeZoom:r}=s.toRefs(t);function c(){if(t.disabled||s.toValue(o)){return}if(s.toValue(r)===Zo.in){a(s.toValue(l))}else if(s.toValue(r)===Zo.out){i(s.toValue(l))}}return{iconSet:n.Outline,zoomTypes:Zo,onZoom:c}},template:`\n\t\t<button\n\t\t\tclass="ui-block-diagram-control-btn__btn"\n\t\t\t@click="onZoom"\n\t\t>\n\t\t\t<BIcon\n\t\t\t\tv-if="typeZoom === zoomTypes.in"\n\t\t\t\t:name="iconSet.PLUS_M"\n\t\t\t\t:size="22"\n\t\t\t\tclass="ui-block-diagram-control-btn__icon"\n\t\t\t/>\n\t\t\t<BIcon\n\t\t\t\tv-else\n\t\t\t\t:name="iconSet.MINUS_M"\n\t\t\t\t:size="22"\n\t\t\t\tclass="ui-block-diagram-control-btn__icon"\n\t\t\t/>\n\t\t</button>\n\t`};const Wo={name:"zoom-percent",setup(t){const{zoom:e}=Ze();const o=s.computed((()=>{var t;return(((t=s.toValue(e))!=null?t:0)*100).toFixed(0)}));return{percent:o}},template:`\n\t\t<span class="ui-block-diagram-percent">{{ percent }}</span>\n\t`};const qo=2;const Qo="firstCanvasBlock";const Jo="lastCanvasBlock";const tn={name:"canvas-map",props:{mapWidth:{type:Number,default:310},mapHeight:{type:Number,default:183}},setup(t,{emit:e}){const{blocks:o,canvasWidth:n,canvasHeight:i,transformX:l,transformY:r,zoom:c}=Ze();const{setCamera:u}=ao();const{mapWidth:d,mapHeight:p}=s.toRefs(t);const b=s.useTemplateRef("map");let v=0;let m=0;const f=s.ref(false);const h=s.computed((()=>({width:`${s.toValue(d)}px`,height:`${s.toValue(p)}px`})));const g=s.computed((()=>{if(s.toValue(o).length===1){return[{id:Qo,position:{x:0,y:0},dimensions:{width:0,height:0}},{...s.toValue(o)[0]},{id:Jo,position:{x:t.mapWidth,y:t.mapHeight},dimensions:{width:0,height:0}}]}return s.toValue(o)}));const y=s.computed((()=>s.toValue(g).reduce(((t,e)=>Math.min(t,e.position.x)),Infinity)));const B=s.computed((()=>s.toValue(g).reduce(((t,e)=>Math.min(t,e.position.y)),Infinity)));const P=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(o))){return t.mapWidth}const e=s.toValue(g).reduce(((t,e)=>Math.max(t,e.position.x+e.dimensions.width)),-Infinity);return e-s.toValue(y)}));const k=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(o))){return t.mapHeight}const e=s.toValue(g).reduce(((t,e)=>Math.max(t,e.position.y+e.dimensions.height)),-Infinity);return e-s.toValue(B)}));const V=s.computed((()=>Math.min(s.toValue(d)/s.toValue(P),s.toValue(p)/s.toValue(k))));const L=s.computed((()=>s.toValue(n)*s.toValue(V)/s.toValue(c)));const H=s.computed((()=>s.toValue(i)*s.toValue(V)/s.toValue(c)));const x=s.computed((()=>{let t=s.toValue(L);let e=s.toValue(H);let o=(s.toValue(l)-s.toValue(y))*s.toValue(V);let n=(s.toValue(r)-s.toValue(B))*s.toValue(V);[o,t]=t>s.toValue(d)?[1,s.toValue(d)-qo]:[o,t];[n,e]=e>s.toValue(p)?[1,s.toValue(p)-qo]:[n,e];o=o<0?1:o;n=n<0?1:n;o=o+t>s.toValue(d)?s.toValue(d)-t-qo:o;n=n+e>s.toValue(p)?s.toValue(p)-e-qo:n;return{x:o,y:n,width:t,height:e}}));function C(t){const e=t.clientX-v;const o=t.clientY-m;const a=e/s.toValue(V)+s.toValue(y);const l=o/s.toValue(V)+s.toValue(B);u({x:a-s.toValue(n)/s.toValue(c)/2,y:l-s.toValue(i)/s.toValue(c)/2,zoom:s.toValue(c),viewportX:0,viewportY:0})}function S(t){f.value=true;if(s.toValue(b)){const{left:t,top:e}=s.toValue(b).getBoundingClientRect();[v,m]=[t,e]}C(t)}function F(t){if(!s.toValue(f)){return}C(t)}function w(t){f.value=false;C(t)}return{preparedBlock:g,canvasMapStyle:h,startDiagramX:y,startDiagramY:B,scaleMap:V,cursorRectPosition:x,onMapMouseDown:S,onMapMouseMove:F,onMapMouseUp:w}},template:`\n\t\t<div :style="canvasMapStyle">\n\t\t\t<svg\n\t\t\t\t:width="mapWidth"\n\t\t\t\t:height="mapHeight"\n\t\t\t\tref="map"\n\t\t\t\tclass="ui-block-diagram-canvas-map"\n\t\t\t\t@mousedown="onMapMouseDown"\n\t\t\t\t@mousemove="onMapMouseMove"\n\t\t\t\t@mouseup="onMapMouseUp"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tv-for="block in preparedBlock"\n\t\t\t\t\t:key="block.id"\n\t\t\t\t\t:x="(block.position.x - startDiagramX) * scaleMap"\n\t\t\t\t\t:y="(block.position.y - startDiagramY) * scaleMap"\n\t\t\t\t\t:width="block.dimensions.width * scaleMap"\n\t\t\t\t\t:height="block.dimensions.height * scaleMap"\n\t\t\t\t\t:rx="2"\n\t\t\t\t\tclass="ui-block-diagram-canvas-map__block"\n\t\t\t\t/>\n\t\t\t\t<rect\n\t\t\t\t\t:x="cursorRectPosition.x"\n\t\t\t\t\t:y="cursorRectPosition.y"\n\t\t\t\t\t:width="cursorRectPosition.width"\n\t\t\t\t\t:height="cursorRectPosition.height"\n\t\t\t\t\t:rx="3"\n\t\t\t\t\tclass="ui-block-diagram-canvas-map__cursor"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</div>\n\t`};const en={name:"canvas-map-btn",props:{width:{type:Number,default:75},height:{type:Number,default:32}},setup(t){const{blocks:e}=Ze();const o=s.computed((()=>({width:`${t.width}px`,height:`${t.height}px`})));const n=s.computed((()=>s.toValue(e).reduce(((t,e)=>Math.min(t,e.position.x)),Infinity)));const i=s.computed((()=>s.toValue(e).reduce(((t,e)=>Math.min(t,e.position.y)),Infinity)));const l=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(e))){return t.width}const o=s.toValue(e).reduce(((t,e)=>Math.max(t,e.position.x+e.dimensions.width)),-Infinity);return o-s.toValue(n)}));const r=s.computed((()=>{if(!a.Type.isArrayFilled(s.toValue(e))){return t.height}const o=s.toValue(e).reduce(((t,e)=>Math.max(t,e.position.y+e.dimensions.height)),-Infinity);return o-s.toValue(i)}));const c=s.computed((()=>Math.min(t.width/s.toValue(l),t.height/s.toValue(r))));return{blocks:e,btnStyle:o,startDiagramX:n,startDiagramY:i,scaleButton:c}},template:`\n\t\t<button\n\t\t\t:style="btnStyle"\n\t\t\tclass="ui-block-diagram-canvas-map-btn"\n\t\t>\n\t\t\t<svg\n\t\t\t\t:width="width"\n\t\t\t\t:height="height"\n\t\t\t\tclass="ui-block-diagram-canvas-map-btn__icon"\n\t\t\t>\n\t\t\t\t<rect\n\t\t\t\t\tv-for="block in blocks"\n\t\t\t\t\t:key="block.id"\n\t\t\t\t\t:x="(block.position.x - startDiagramX) * scaleButton"\n\t\t\t\t\t:y="(block.position.y - startDiagramY) * scaleButton"\n\t\t\t\t\t:width="block.dimensions.width * scaleButton"\n\t\t\t\t\t:height="block.dimensions.height * scaleButton"\n\t\t\t\t\t:rx="1"\n\t\t\t\t\tclass="ui-block-diagram-canvas-map-btn__rect"\n\t\t\t\t/>\n\t\t\t</svg>\n\t\t</button>\n\t`};const on={left:"left",right:"right"};const nn={top:"top",bottom:"bottom"};const an={base:"ui-block-diagram-canvas-zoom-bar__map",top:"--top",bottom:"--bottom",left:"--left",right:"--right"};const sn="top right";const ln={name:"zoom-bar",components:{BIcon:n.BIcon,ZoomBtn:Uo,ZoomPercent:Wo,CanvasMap:tn,CanvasMapBtn:en},props:{stepZoom:{type:Number,default:.2},positionMap:{type:String,default:sn},disabled:{type:Boolean,default:false}},emits:["update:modelValue"],setup(t){const e=s.ref(false);const o=s.computed((()=>{const e=t.positionMap.toLowerCase().includes(nn.top);const o=t.positionMap.toLowerCase().includes(on.left);return{[an.base]:true,[an.top]:e,[an.bottom]:!e,[an.left]:o,[an.right]:!o}}));function a(){if(t.disabled){e.value=false;return}e.value=!s.toValue(e)}return{iconSet:n.Outline,mapPositionClasses:o,isShowMap:e,onToggleMap:a}},template:`\n\t\t<div class="ui-block-diagram-canvas-zoom-bar">\n\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__locate">\n\t\t\t\t<CanvasMapBtn\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomOpenMapBtn')"\n\t\t\t\t\t@click="onToggleMap"\n\t\t\t\t/>\n\t\t\t\t<transition name="editor-large-map-fade" mode="in-out">\n\t\t\t\t\t<div\n\t\t\t\t\t\tv-if="isShowMap"\n\t\t\t\t\t\tclass="ui-block-diagram-canvas-zoom-bar__map"\n\t\t\t\t\t\t:class="mapPositionClasses"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__map-header">\n\t\t\t\t\t\t\t<BIcon\n\t\t\t\t\t\t\t\t:name="iconSet.CROSS_M"\n\t\t\t\t\t\t\t\t:size="24"\n\t\t\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomCloseMapBtn')"\n\t\t\t\t\t\t\t\tclass="ui-block-diagram-canvas-zoom-bar__map-close-icon"\n\t\t\t\t\t\t\t\tcolor="#2FC6F6"\n\t\t\t\t\t\t\t\t@click="onToggleMap"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<CanvasMap\n\t\t\t\t\t\t\t:mapSize="310"\n\t\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomCanvasMap')"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</transition>\n\t\t\t</div>\n\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__separator"/>\n\t\t\t<div class="ui-block-diagram-canvas-zoom-bar__zoom">\n\t\t\t\t<ZoomBtn\n\t\t\t\t\t:stepZoom="stepZoom"\n\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomOutBtn')"\n\t\t\t\t\ttypeZoom="out"\n\t\t\t\t/>\n\t\t\t\t<ZoomPercent/>\n\t\t\t\t<ZoomBtn\n\t\t\t\t\t:stepZoom="stepZoom"\n\t\t\t\t\t:disabled="disabled"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('zoomInBtn')"\n\t\t\t\t\ttypeZoom="in"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const rn={name:"search-result",props:{title:{type:String,required:true},count:{type:String,required:true}},template:`\n\t\t<div class="ui-block-diagram-search-result">\n\t\t\t<div class="ui-block-diagram-search-result__left-col">\n\t\t\t\t<p class="ui-block-diagram-search-result__title">{{ title }}</p>\n\t\t\t</div>\n\t\t\t<div class="ui-block-diagram-search-result__right-col">\n\t\t\t\t<span class="ui-block-diagram-search-result__count">{{ count }}</span>\n\t\t\t\t<div class="ui-block-diagram-search-result__nav">\n\t\t\t\t\t<slot/>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};const cn={name:"search-nav-btn",components:{BIcon:n.BIcon},props:{iconName:{type:String,required:true}},template:`\n\t\t<button class="ui-block-diagram-search-nav-btn">\n\t\t\t<BIcon\n\t\t\t\t:name="iconName"\n\t\t\t\t:size="18"\n\t\t\t\tclass="ui-block-diagram-search-nav-btn__icon"\n\t\t\t/>\n\t\t</button>\n\t`};const un={name:"open-search-btn",components:{BIcon:n.BIcon},setup(){return{iconSet:n.Outline}},template:`\n\t\t<button class="ui-block-diagram-open-search-btn">\n\t\t\t<BIcon\n\t\t\t\t:name="iconSet.SEARCH"\n\t\t\t\t:size="24"\n\t\t\t\tclass="ui-block-diagram-open-search-btn__icon"\n\t\t\t/>\n\t\t</button>\n\t`};const dn={base:"ui-block-diagram-search-input",open:"--open",focus:"--focus"};const pn={name:"SearchInput",components:{BIcon:n.BIcon,OpenSearchBtn:un},props:{value:{type:String,default:""},open:{type:Boolean,default:false},placeholder:{type:String,default:""},disabled:{type:Boolean,default:false}},emits:["update:value","clear","update:open"],setup(t,{emit:e}){const o=io();const a=s.useTemplateRef("searchInput");const i=s.ref(true);const l=s.ref(false);const r=s.ref(false);const c=s.computed((()=>{if(t.placeholder){return t.placeholder}return o.getMessage("UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_PLACEHOLDER")}));const u=s.computed((()=>({[dn.base]:true,[dn.open]:s.toValue(l),[dn.focus]:s.toValue(r)})));function d(o){if(t.disabled){return}e("update:value",o.target.value)}function p(o){o.stopPropagation();if(t.disabled){return}l.value=false;e("clear")}function b(){s.nextTick((()=>{var t;r.value=true;(t=s.toValue(a))==null?void 0:t.focus()}))}function v(){i.value=true;e("update:open",false)}function m(){l.value=true;i.value=false;e("update:open",true)}function f(){var t;r.value=true;(t=s.toValue(a))==null?void 0:t.focus()}function h(){r.value=false}function g(){l.value=false}return{iconSet:n.Outline,showSearchBar:l,showSearchBtn:i,placeholderOrDefaultValue:c,searchInputClassNames:u,onInput:d,onClear:p,onAfterEnterTransition:b,onLeaveTransition:v,onOpenSearchBar:m,onClickSearchInput:f,onBlurSearchInput:h,collapseSearchBar:g}},template:`\n\t\t<OpenSearchBtn\n\t\t\tv-show="showSearchBtn"\n\t\t\t:data-test-id="$blockDiagramTestId('searchOpenBtn')"\n\t\t\t@click="onOpenSearchBar"\n\t\t/>\n\t\t<transition\n\t\t\tname="ui-block-diagram-search-bar-fade"\n\t\t\tenter-active-class="ui-block-diagram-open-search-bar"\n\t\t\tleave-active-class="ui-block-diagram-close-search-bar"\n\t\t\t@after-enter="onAfterEnterTransition"\n\t\t\t@after-leave="onLeaveTransition"\n\t\t>\n\t\t\t<div\n\t\t\t\tv-show="showSearchBar"\n\t\t\t\t:class="searchInputClassNames"\n\t\t\t\tref="searchBar"\n\t\t\t\t@click="onClickSearchInput"\n\t\t\t>\n\t\t\t\t<BIcon\n\t\t\t\t\t:name="iconSet.SEARCH"\n\t\t\t\t\t:size="20"\n\t\t\t\t\tclass="ui-block-diagram-search-input__icon"\n\t\t\t\t/>\n\t\t\t\t<input\n\t\t\t\t\t:value="value"\n\t\t\t\t\t:placeholder="placeholderOrDefaultValue"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('searchInput')"\n\t\t\t\t\tref="searchInput"\n\t\t\t\t\ttype="text"\n\t\t\t\t\tclass="ui-block-diagram-search-input__input"\n\t\t\t\t\t@input="onInput"\n\t\t\t\t\t@blur="onBlurSearchInput"\n\t\t\t\t/>\n\t\t\t\t<button\n\t\t\t\t\tclass="ui-block-diagram-search-input__clear-btn"\n\t\t\t\t\t:data-test-id="$blockDiagramTestId('searchClearInputBtn')"\n\t\t\t\t\t@click="onClear"\n\t\t\t\t>\n\t\t\t\t\t<BIcon\n\t\t\t\t\t\t:name="iconSet.CROSS_L"\n\t\t\t\t\t\t:size="20"\n\t\t\t\t\t\tclass="ui-block-diagram-search-input__clear-btn-icon"\n\t\t\t\t\t/>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</transition>\n\t`};const bn={base:"ui-block-diagram-search-bar",opened:"--opened"};const vn={name:"SearchBar",components:{SearchResult:rn,SearchNavBtn:cn,SearchInput:pn,OpenSearchBtn:un},props:{searchResultTitle:{type:String,default:""},placeholder:{type:String,default:""},searchCallback:{type:Function,required:true,default:(t,e)=>t.node.title.toLowerCase().includes(e.toLowerCase())},searchDelay:{type:Number,default:300},disabled:{type:Boolean,default:false}},setup(t){const{seachText:e,foundBlocks:o,onSearchBlocks:i,onClearSearch:l}=no({searchCallback:t.searchCallback,delay:t.searchDelay});const{isDisabledBlockDiagram:r}=Ze();const c=so();const u=io();const{goToBlockById:d}=ao();const p=s.useTemplateRef("searchPanel");const b=s.useTemplateRef("searchInput");const v=s.ref(0);const m=s.ref(false);const f=s.computed((()=>t.disabled||s.toValue(r)));const h=s.computed((()=>`${v.value+1} / ${s.toValue(o).length}`));const g=s.computed((()=>{if(t.placeholder){return t.placeholder}return u.getMessage("UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_PLACEHOLDER")}));const y=s.computed((()=>{if(t.searchResultTitle){return t.searchResultTitle}return u.getMessage("UI_BLOCK_DIAGRAM_SEARCH_BAR_SEARCH_RESULT_TITLE")}));const B=s.computed((()=>({[bn.base]:true,[bn.opened]:s.toValue(m)})));s.watch(o,(t=>{v.value=0;if(s.toValue(t).length>0){const e=s.toValue(t)[0].id;c.clear();c.add(e);d(e)}else{c.clear()}}));s.onMounted((()=>{a.Event.bind(document,"mousedown",L)}));s.onUnmounted((()=>{a.Event.unbind(document,"mousedown",L)}));function P(){if(s.toValue(f)){return}v.value+=1;if(s.toValue(v)>s.toValue(o).length-1){v.value=0}const t=s.toValue(o)[s.toValue(v)].id;c.clear();c.add(t);d(t)}function k(){if(s.toValue(f)){return}v.value-=1;if(s.toValue(v)<0){v.value=s.toValue(o).length-1}const t=s.toValue(o)[s.toValue(v)].id;c.clear();c.add(t);d(s.toValue(o)[s.toValue(v)].id)}function V(){c.clear();l();v.value=0}function L(t){if(s.toValue(p)&&!s.toValue(p).contains(t.target)){var e;V();(e=s.toValue(b))==null?void 0:e.collapseSearchBar()}}return{iconSet:n.Outline,searchBarClassNames:B,isOpenedSearchBar:m,isDisabled:f,placeholderOrDefaultValue:g,searchResultTitleOrDefaultValue:y,seachText:e,labelResult:h,foundBlocks:o,onSearchBlocks:i,onClearSearch:l,closeAndResetSearch:V,onGoToNextBlock:P,onGoToPrevBlock:k}},template:`\n\t\t<div\n\t\t\t:class="searchBarClassNames"\n\t\t\tref="searchPanel"\n\t\t>\n\t\t\t<SearchInput\n\t\t\t\tv-model:open="isOpenedSearchBar"\n\t\t\t\t:value="seachText"\n\t\t\t\t:placeholder="placeholderOrDefaultValue"\n\t\t\t\t:disabled="isDisabled"\n\t\t\t\tref="searchInput"\n\t\t\t\t@update:value="onSearchBlocks"\n\t\t\t\t@clear="closeAndResetSearch"\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tv-if="foundBlocks.length > 0"\n\t\t\t\tclass="ui-block-diagram-search-bar__search-result"\n\t\t\t>\n\t\t\t\t<SearchResult\n\t\t\t\t\t:title="searchResultTitleOrDefaultValue"\n\t\t\t\t\t:count="labelResult"\n\t\t\t\t>\n\t\t\t\t\t<SearchNavBtn\n\t\t\t\t\t\t:iconName="iconSet.CHEVRON_LEFT_L"\n\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('searchResultPrevBtn')"\n\t\t\t\t\t\t@click="onGoToPrevBlock"\n\t\t\t\t\t/>\n\t\t\t\t\t<SearchNavBtn\n\t\t\t\t\t\t:iconName="iconSet.CHEVRON_RIGHT_L"\n\t\t\t\t\t\t:data-test-id="$blockDiagramTestId('searchResultNextBtn')"\n\t\t\t\t\t\t@click="onGoToNextBlock"\n\t\t\t\t\t/>\n\t\t\t\t</SearchResult>\n\t\t\t</div>\n\t\t</div>\n\t`};const mn={name:"resizable-block",props:{block:{type:Object,required:true},minWidth:{type:Number,default:100},minHeight:{type:Number,default:100},highlighted:{type:Boolean,default:false}},setup(t){const{block:e,minWidth:o,minHeight:n}=s.toRefs(t);const{isHiglitedBlock:a,isDisabled:i}=qe(e);const l=so();const{isDragged:r,blockPositionStyle:c}=Qe(s.useTemplateRef("blockEl"),e);const{isResize:u,sizeBlockStyle:d,onMounted:p,onUnmounted:b}=yo({block:e,minWidth:o,minHeight:n,leftSideRef:s.useTemplateRef("leftSide"),topSideRef:s.useTemplateRef("topSide"),rightSideRef:s.useTemplateRef("rightSide"),bottomSideRef:s.useTemplateRef("bottomSide"),leftTopCornerRef:s.useTemplateRef("leftTopCorner"),rightTopCornerRef:s.useTemplateRef("rightTopCorner"),rightBottomCornerRef:s.useTemplateRef("rightBottomCorner"),leftBottomCornerRef:s.useTemplateRef("leftBottomCorner")});const v=s.computed((()=>({...s.toValue(c),...s.toValue(d)})));s.watch((()=>t.highlighted),(e=>{if(e){l.add(t.block.id)}else{l.remove(t.block.id)}}));s.onMounted((()=>{p()}));s.onUnmounted((()=>{l.remove(t.block.id);b()}));function m(){l.clear();l.add(t.block.id)}return{isHiglitedBlock:a,isDisabled:i,isResize:u,isDragged:r,blockStyle:v,onMouseDownSelectBlock:m}},template:`\n\t\t<div\n\t\t\t:style="blockStyle"\n\t\t\tref="blockEl"\n\t\t\tclass="ui-block-diagram-resizable-block"\n\t\t\t@mousedown="onMouseDownSelectBlock"\n\t\t>\n\t\t\t<div class="ui-block-diagram-resizable-block__container">\n\t\t\t\t<div\n\t\t\t\t\tref="leftSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__left-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="topSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__top-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="rightSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__right-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="bottomSide"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__bottom-side"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="leftTopCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__top-left-corner"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="rightTopCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__top-right-corner"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="rightBottomCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__bottom-right-corner"\n\t\t\t\t/>\n\t\t\t\t<div\n\t\t\t\t\tref="leftBottomCorner"\n\t\t\t\t\tclass="ui-block-diagram-resizable-block__bottom-left-corner"\n\t\t\t\t/>\n\n\t\t\t\t<slot\n\t\t\t\t\t:block="block"\n\t\t\t\t\t:isHighlighted="isHiglitedBlock"\n\t\t\t\t\t:isDragged="isDragged"\n\t\t\t\t\t:isResize="isResize"\n\t\t\t\t\t:isDisabled="isDisabled"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t`};const fn=17;const hn={width:150,height:100};const gn={name:"GroupSelectionBox",props:{menuItems:{type:Array,default:()=>[]},padding:{type:[Number,Object],default:fn},defaultBlockSize:{type:Object,default:hn}},setup(t){const e=so();const{selectionWorldRect:o,isSelectionActive:n}=Ze();const{showContextMenu:a,setOptions:i,closeContextMenu:l}=Ue();const{onCanvasSelect:r,onSelectionStart:c,groupSelectionStyle:u}=ko(l,{padding:s.computed((()=>t.padding)),defaultBlockSize:t.defaultBlockSize});s.watch(o,(t=>{r(t)}));s.watch(n,(t=>{if(t){c()}}));const{onGroupMouseDown:d}=Po(l);function p(o){const n=s.toValue(e.highlitedBlockIds);if(!n||n.length===0||t.menuItems.length===0){return}i({items:t.menuItems});a({clientX:o.clientX,clientY:o.clientY})}return{groupSelectionStyle:u,onGroupMouseDown:d,onGroupContextMenu:p}},template:`\n\t\t<div\n\t\t\tv-if="groupSelectionStyle"\n\t\t\t:style="groupSelectionStyle"\n\t\t\tclass="ui-block-diagram-group-box"\n\t\t\t@mousedown="onGroupMouseDown"\n\t\t\t@contextmenu.prevent.stop="onGroupContextMenu"\n\t\t></div>\n\t`};let yn=t=>t,Bn;let Pn=null;function kn(t,e){const{dragData:o,dragImage:n}=a.Type.isFunction(e)?e():e;Pn=s.toValue(n).cloneNode(true).children[0];const i=document.getElementById("blockDiagramDragWrapper");a.Dom.append(Pn,i);a.Dom.style(Pn,{display:"block",position:"absolute",top:0,left:0});const{width:l,height:r}=Pn.getBoundingClientRect();t.dataTransfer.setDragImage(Pn,l/2,r/2);t.dataTransfer.setData("text/plain",JSON.stringify({...s.toValue(o),dimensions:{width:l,height:r}}))}function Vn(t){a.Dom.remove(Pn);Pn=null}function Ln(){const t=document.getElementById("blockDiagramDragWrapper");if(t){return}const e=a.Tag.render(Bn||(Bn=yn`
		<div>
			<div
				id="blockDiagramDragWrapper"
				style="position: relative; width: 100%; height: 100%;"
			>
			</div>
		</div>
	`));a.Dom.append(e,document.body);a.Dom.style(e,{position:"absolute",transform:"translate(-100%, -100%)",top:0,right:0})}const Hn={mounted(t,{arg:e,value:o}){Ln();a.Dom.attr(t,"draggable","true");a.Event.bind(t,"dragstart",(t=>kn(t,o)));a.Event.bind(t,"dragend",(t=>Vn()))},unmounted(t,{arg:e,value:o}){a.Event.unbind(t,"dragstart",(t=>kn(t,o)));a.Event.unbind(t,"dragend",(t=>Vn(t)))}};t.BlockDiagram=Xo;t.HistoryBar=Yo;t.ZoomBar=ln;t.SearchBar=vn;t.MoveableBlock=Ro;t.ResizableBlock=mn;t.Port=No;t.Connection=So;t.GroupSelectionBox=gn;t.DeleteConnectionBtn=Fo;t.transformPoint=V;t.useBlockDiagram=Ze;t.useContextMenu=Ue;t.useHistory=Ge;t.useSearchBlocks=no;t.useCanvas=ao;t.useBlockState=qe;t.useMoveableBlock=Qe;t.useResizableBlock=yo;t.useHighlightedBlocks=so;t.useAnimationQueue=mo;t.usePortState=lo;t.useConnectionState=po;t.useNewConnectionState=vo;t.useDragAndDrop=go;t.useGroupSelectionLogic=ko;t.useGroupDragLogic=Po;t.DragBlock=Hn})(this.BX.UI=this.BX.UI||{},BX.Main,BX,BX.UI.IconSet,BX,BX.Vue3);
//# sourceMappingURL=block-diagram.bundle.map.js