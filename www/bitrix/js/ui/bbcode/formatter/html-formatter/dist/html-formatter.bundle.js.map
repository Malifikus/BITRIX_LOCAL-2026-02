{"version":3,"file":"html-formatter.bundle.js","sources":["../src/helpers/create-empty-paragraphs.js","../src/helpers/should-wrap-in-paragraph.js","../src/helpers/wrap-text-nodes.js","../src/helpers/normalize-text-nodes.js","../src/node-formatters/root/root-formatter.js","../src/helpers/find-parent.js","../src/node-formatters/text/text-formatter.js","../src/node-formatters/text/tab-formatter.js","../src/node-formatters/text/linebreak-formatter.js","../src/helpers/normalize-line-breaks.js","../src/node-formatters/paragraph/paragraph-formatter.js","../src/node-formatters/format/bold-formatter.js","../src/node-formatters/format/underline-formatter.js","../src/node-formatters/format/italic-formatter.js","../src/node-formatters/format/strikethrough-formatter.js","../src/node-formatters/table/table-formatter.js","../src/node-formatters/table/table-head-cell-formatter.js","../src/node-formatters/table/table-data-cell-formatter.js","../src/node-formatters/table/table-row-formatter.js","../src/node-formatters/list/list-formatter.js","../src/node-formatters/list/list-item-formatter.js","../src/node-formatters/quote/quote-formatter.js","../src/node-formatters/code/code-formatter.js","../src/helpers/validate-url.js","../src/node-formatters/link/link-formatter.js","../src/node-formatters/spoiler/spoiler-formatter.js","../src/node-formatters/mention/user-formatter.js","../src/node-formatters/mention/department-formatter.js","../src/node-formatters/mention/project-formatter.js","../src/helpers/create-image-node.js","../src/helpers/validate-image-url.js","../src/node-formatters/image/image-formatter.js","../src/helpers/create-video-node.js","../src/helpers/sanitize-url.js","../src/helpers/validate-video-url.js","../src/node-formatters/video/video-formatter.js","../src/node-formatters/file/file-formatter.js","../src/html-formatter.js","../src/html-formatter-component.js"],"sourcesContent":["import { BBCodeElementNode, BBCodeScheme } from 'ui.bbcode.model';\n\nexport function createEmptyParagraphs(scheme: BBCodeScheme, count: number = 1): Array<BBCodeElementNode>\n{\n\tconst result = [];\n\tfor (let i = 0; i < count; i++)\n\t{\n\t\tresult.push(scheme.createElement({ name: 'p' }));\n\t}\n\n\treturn result;\n}\n","import { type BBCodeElementNode, BBCodeNode } from 'ui.bbcode.model';\n\nexport function shouldWrapInParagraph(node: BBCodeNode | BBCodeElementNode): boolean\n{\n\treturn node.getType() !== BBCodeNode.ELEMENT_NODE || node.hasGroup('#inline') || node.hasGroup('#inlineBlock');\n}\n","import { BBCodeElementNode, BBCodeNode, BBCodeScheme } from 'ui.bbcode.model';\nimport { createEmptyParagraphs } from './create-empty-paragraphs';\nimport { shouldWrapInParagraph } from './should-wrap-in-paragraph';\n\nexport function wrapTextNodes(nodes: Array<BBCodeNode>, scheme: BBCodeScheme): Array<BBCodeElementNode>\n{\n\tconst result = [];\n\tlet currentParagraph = null;\n\tlet lineBreaks = 0;\n\n\tfor (const node of nodes)\n\t{\n\t\tif (scheme.isNewLine(node))\n\t\t{\n\t\t\tlineBreaks++;\n\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (shouldWrapInParagraph(node))\n\t\t{\n\t\t\tif (currentParagraph === null || lineBreaks >= 2)\n\t\t\t{\n\t\t\t\tresult.push(...createEmptyParagraphs(scheme, lineBreaks - 2));\n\t\t\t\tcurrentParagraph = scheme.createElement({ name: 'p' });\n\t\t\t\tresult.push(currentParagraph);\n\t\t\t}\n\t\t\telse if (lineBreaks === 1)\n\t\t\t{\n\t\t\t\tcurrentParagraph.appendChild(scheme.createNewLine());\n\t\t\t}\n\n\t\t\tcurrentParagraph.appendChild(node);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (lineBreaks > 2)\n\t\t\t{\n\t\t\t\tresult.push(...createEmptyParagraphs(scheme, lineBreaks - 2));\n\t\t\t}\n\n\t\t\tresult.push(node);\n\t\t\tcurrentParagraph = null;\n\t\t}\n\n\t\tlineBreaks = 0;\n\t}\n\n\t// to avoid a height collapsing for empty elements\n\tif (result.length === 0)\n\t{\n\t\treturn [scheme.createElement({ name: 'p' })];\n\t}\n\n\treturn result;\n}\n","import { BBCodeElementNode, BBCodeScheme } from 'ui.bbcode.model';\nimport { wrapTextNodes } from './wrap-text-nodes';\n\nexport function normalizeTextNodes(node: BBCodeElementNode): BBCodeElementNode\n{\n\tconst scheme: BBCodeScheme = node.getScheme();\n\tconst children: Array<BBCodeElementNode> = wrapTextNodes(node.getChildren(), scheme);\n\tnode.setChildren(children);\n\n\treturn node;\n}\n","import { Tag } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype NodeFormatterOptions,\n\ttype BeforeConvertCallbackOptions,\n\ttype AfterCallbackOptions,\n} from 'ui.bbcode.formatter';\n\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\nimport { type BBCodeNode } from 'ui.bbcode.model';\n\nexport class RootNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: '#root',\n\t\t\tconvert(): DocumentFragment {\n\t\t\t\treturn document.createDocumentFragment();\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\tafter({ element, formatter }: AfterCallbackOptions): HTMLElement {\n\t\t\t\tconst mode = formatter.getContainerMode();\n\t\t\t\tif (mode === 'void' || mode === 'collapsed')\n\t\t\t\t{\n\t\t\t\t\tconst container = Tag.render`<div class=\"ui-typography-container --${mode}\"></div>`;\n\t\t\t\t\tcontainer.appendChild(element);\n\n\t\t\t\t\treturn container;\n\t\t\t\t}\n\n\t\t\t\treturn element;\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { BBCodeNode } from 'ui.bbcode.model';\n\nexport function findParent(startingNode: BBCodeNode, findFn: (node: BBCodeNode) => boolean): BBCodeNode | null\n{\n\tlet curr: BBCodeNode | null = startingNode;\n\twhile (curr !== null && curr.getType() !== BBCodeNode.ROOT_NODE)\n\t{\n\t\tif (findFn(curr))\n\t\t{\n\t\t\treturn curr;\n\t\t}\n\n\t\tcurr = curr.getParent();\n\t}\n\n\treturn null;\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { type BBCodeNode } from 'ui.bbcode.model';\nimport { type Smiley, SmileyManager, SmileyParser } from 'ui.smiley';\nimport { findParent } from '../../helpers/find-parent';\n\nexport class TextNodeFormatter extends NodeFormatter\n{\n\t#smileyParser: SmileyParser = null;\n\n\tconstructor(options: NodeFormatterOptions = {}) {\n\t\tsuper({\n\t\t\tname: '#text',\n\t\t\tconvert({ node }: ConvertCallbackOptions): Text {\n\t\t\t\tconst text = node.toString({ encode: false });\n\t\t\t\tif (findParent(node, (parent: BBCodeNode) => parent.getName() === 'code'))\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(text);\n\t\t\t\t}\n\n\t\t\t\tconst splits: Array<{ start: number, end: number }> = this.#smileyParser.parse(text);\n\t\t\t\tif (splits.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(text);\n\t\t\t\t}\n\n\t\t\t\t// console.log('splits', splits);\n\n\t\t\t\tconst fragment = document.createDocumentFragment();\n\t\t\t\tlet currentIndex = 0;\n\t\t\t\tfor (const split of splits)\n\t\t\t\t{\n\t\t\t\t\tif (currentIndex < split.start)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst chunk = document.createTextNode(text.slice(currentIndex, split.start));\n\t\t\t\t\t\tfragment.appendChild(chunk);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst typing = text.slice(split.start, split.end);\n\t\t\t\t\tconst smiley = SmileyManager.get(typing);\n\t\t\t\t\tif (smiley === null)\n\t\t\t\t\t{\n\t\t\t\t\t\tfragment.appendChild(document.createTextNode(typing));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tfragment.appendChild(this.createImg(smiley));\n\t\t\t\t\t}\n\n\t\t\t\t\tcurrentIndex = split.end;\n\t\t\t\t}\n\n\t\t\t\tif (currentIndex < text.length)\n\t\t\t\t{\n\t\t\t\t\tconst tail = document.createTextNode(text.slice(currentIndex));\n\t\t\t\t\tfragment.appendChild(tail);\n\t\t\t\t}\n\n\t\t\t\treturn fragment;\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\n\t\tthis.#smileyParser = new SmileyParser(SmileyManager.getAll());\n\t}\n\n\tcreateImg(smiley: Smiley): HTMLImageElement\n\t{\n\t\tconst img: HTMLImageElement = document.createElement('img');\n\t\timg.src = encodeURI(smiley.getImage());\n\t\timg.className = 'ui-typography-smiley';\n\t\timg.alt = smiley.getTyping();\n\t\tif (smiley.getWidth() > 0 && smiley.getHeight() > 0)\n\t\t{\n\t\t\tDom.style(img, {\n\t\t\t\twidth: `${smiley.getWidth()}px`,\n\t\t\t\theight: `${smiley.getHeight()}px`,\n\t\t\t});\n\t\t}\n\n\t\treturn img;\n\t}\n}\n","import { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class TabNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {}) {\n\t\tsuper({\n\t\t\tname: '#tab',\n\t\t\tconvert({ node }: ConvertCallbackOptions): Text {\n\t\t\t\tif (node.getParent().getName() === 'code')\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t\t}\n\n\t\t\t\treturn document.createTextNode(' ');\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class LinebreakNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {}) {\n\t\tsuper({\n\t\t\tname: '#linebreak',\n\t\t\tconvert({ node }: ConvertCallbackOptions): Text | HTMLBRElement {\n\t\t\t\treturn document.createElement('br');\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { type BBCodeElementNode, type BBCodeScheme } from 'ui.bbcode.model';\n\nexport function normalizeLineBreaks(node: BBCodeElementNode): BBCodeElementNode\n{\n\tconst scheme: BBCodeScheme = node.getScheme();\n\n\t// To avoid a height collapsing for empty elements we need to add an additional <br> (<p></p> => <p><br></p>).\n\t// If we end an element with a LineBreakNode, then we need to add an additional <br>.\n\t// A browser doesn't render the last <br> (<p>text<br></p>).\n\n\tnode.appendChild(scheme.createNewLine());\n\n\treturn node;\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeLineBreaks } from '../../helpers/normalize-line-breaks';\n\nexport class ParagraphNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'p',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLParagraphElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: node.getName(),\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-paragraph',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeLineBreaks(node);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class BoldNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'b',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'b',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-bold',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class UnderlineNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'u',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'u',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-underline',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class ItalicNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'i',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'i',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-italic',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class StrikethroughNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 's',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 's',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: 'ui-typography-text-strikethrough',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Tag } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type AfterCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class TableNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'table',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'table',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tafter({ element }: AfterCallbackOptions): HTMLElement {\n\t\t\t\tconst container = Tag.render`<div class=\"ui-typography-table-scroll\"></div>`;\n\t\t\t\tcontainer.appendChild(element);\n\n\t\t\t\treturn container;\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\n\nexport class TableHeadCellNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'th',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'th',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table-cell ui-typography-table-cell-header',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\n\nexport class TableDataCellNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'td',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'td',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table-cell',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\n\nexport class TableRowNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'tr',\n\t\t\tconvert(): HTMLTableElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'tr',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassname: 'ui-typography-table-row',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\n\nexport class ListNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions)\n\t{\n\t\tsuper({\n\t\t\tname: 'list',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLUListElement | HTMLOListElement {\n\t\t\t\tconst tagName = node.getValue() === '1' ? 'ol' : 'ul';\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: tagName,\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: `ui-typography-${tagName}`,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { type BBCodeNode } from 'ui.bbcode.model';\n\nexport class ListItemNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions)\n\t{\n\t\tsuper({\n\t\t\tname: '*',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLLIElement {\n\t\t\t\tconst nested = node.getChildren().some((child) => child.getName() === 'list');\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'li',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\t...node.getAttributes(),\n\t\t\t\t\t\tclassName: `ui-typography-li${nested ? ' --nested' : ''}`,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport type { BeforeConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { NodeFormatter, type NodeFormatterOptions } from 'ui.bbcode.formatter';\nimport type { BBCodeNode } from 'ui.bbcode.model';\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\n\nexport class QuoteNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'quote',\n\t\t\tconvert(): HTMLQuoteElement {\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'blockquote',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-quote',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype NodeFormatterOptions,\n\ttype BeforeConvertCallbackOptions,\n\ttype ConvertCallbackOptions,\n} from 'ui.bbcode.formatter';\n\nimport { type BBCodeNode } from 'ui.bbcode.model';\nimport { CodeParser, type CodeToken } from 'ui.code-parser';\nimport { normalizeLineBreaks } from '../../helpers/normalize-line-breaks';\n\nexport class CodeNodeFormatter extends NodeFormatter\n{\n\t#codeParser: CodeParser = new CodeParser();\n\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'code',\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeLineBreaks(node);\n\t\t\t},\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\tconst content = node.getTextContent();\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'code',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-code',\n\t\t\t\t\t},\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tdecorator: true,\n\t\t\t\t\t},\n\t\t\t\t\tchildren: getCodeTokenNodes(this.#codeParser.parse(content)),\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n\nfunction getCodeTokenNodes(tokens: Array<CodeToken>): Array<Text | HTMLElement>\n{\n\tconst nodes: Array<Text | HTMLElement>[] = [];\n\ttokens.forEach((token: CodeToken): void => {\n\t\tconst partials: string[] = token.content.split(/([\\t\\n])/);\n\t\tconst partialsLength: number = partials.length;\n\t\tfor (let i = 0; i < partialsLength; i++)\n\t\t{\n\t\t\tconst part: string = partials[i];\n\t\t\tif (part === '\\n' || part === '\\r\\n')\n\t\t\t{\n\t\t\t\tnodes.push(document.createElement('br'));\n\t\t\t}\n\t\t\telse if (part === '\\t')\n\t\t\t{\n\t\t\t\tnodes.push(document.createTextNode('\\t'));\n\t\t\t}\n\t\t\telse if (part.length > 0)\n\t\t\t{\n\t\t\t\tconst span = document.createElement('span');\n\t\t\t\tspan.className = `ui-typography-token-${token.type}`;\n\t\t\t\tspan.textContent = part;\n\t\t\t\tnodes.push(span);\n\t\t\t}\n\t\t}\n\t});\n\n\treturn nodes;\n}\n","export function validateUrl(url: string, allowDomainRelativeUrl: boolean = true): boolean\n{\n\tif (allowDomainRelativeUrl)\n\t{\n\t\treturn /^(http:|https:|mailto:|tel:|sms:|\\/)/i.test(url);\n\t}\n\n\treturn /^(http:|https:|mailto:|tel:|sms:)/i.test(url);\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype NodeFormatterOptions,\n\ttype AfterCallbackOptions,\n\ttype ConvertCallbackOptions,\n\ttype ValidateCallbackOptions,\n} from 'ui.bbcode.formatter';\nimport type { BBCodeContentNode } from 'ui.bbcode.model';\nimport {\n\tBBCodeElementNode,\n\tBBCodeRootNode,\n\tBBCodeScheme,\n} from 'ui.bbcode.model';\n\nimport { validateUrl } from '../../helpers/validate-url';\n\nexport class LinkNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'url',\n\t\t\tbefore({ node, formatter }: AfterCallbackOptions): BBCodeElementNode {\n\t\t\t\tif (formatter.isShortLinkEnabled())\n\t\t\t\t{\n\t\t\t\t\tconst isIncludeImg: boolean = node.getChildren().some((node: BBCodeContentNode) => {\n\t\t\t\t\t\treturn node.getName() === 'img';\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!isIncludeImg)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst scheme: BBCodeScheme = node.getScheme();\n\t\t\t\t\t\tconst nodeContentLength: number = node.getPlainTextLength();\n\t\t\t\t\t\tconst { shortLink } = formatter.getLinkSettings();\n\t\t\t\t\t\tif (nodeContentLength > shortLink.maxLength)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst sourceHref: string = LinkNodeFormatter.fetchNodeValue(node);\n\n\t\t\t\t\t\t\tconst nodeRoot: BBCodeRootNode = scheme.createRoot({\n\t\t\t\t\t\t\t\tchildren: node.getChildren(),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconst [left, right] = nodeRoot.split({\n\t\t\t\t\t\t\t\toffset: shortLink.maxLength - shortLink.lastFragmentLength,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tconst sourceRightFragmentLength: number = right.getPlainTextLength();\n\t\t\t\t\t\t\tconst newLink: BBCodeElementNode = node.clone();\n\t\t\t\t\t\t\tnewLink.setValue(sourceHref);\n\n\t\t\t\t\t\t\tif (sourceRightFragmentLength > shortLink.lastFragmentLength)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnewLink.appendChild(\n\t\t\t\t\t\t\t\t\t...left.getChildren(),\n\t\t\t\t\t\t\t\t\tscheme.createText('...'),\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tconst [, lastFragment] = right.split({\n\t\t\t\t\t\t\t\t\toffset: sourceRightFragmentLength - shortLink.lastFragmentLength,\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tnewLink.appendChild(...lastFragment.getChildren());\n\n\t\t\t\t\t\t\t\treturn newLink;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnewLink.setChildren([\n\t\t\t\t\t\t\t\t...left.getChildren(),\n\t\t\t\t\t\t\t\tscheme.createText('...'),\n\t\t\t\t\t\t\t\t...right.getChildren(),\n\t\t\t\t\t\t\t]);\n\n\t\t\t\t\t\t\treturn newLink;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn node;\n\t\t\t},\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLLinkElement | HTMLUnknownElement {\n\t\t\t\tconst sourceHref: string = (() => {\n\t\t\t\t\tconst value: ?string = node.getValue();\n\t\t\t\t\tif (Type.isStringFilled(value))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node.getContent();\n\t\t\t\t})();\n\n\t\t\t\tif (validateUrl(sourceHref))\n\t\t\t\t{\n\t\t\t\t\tconst nodeAttributes: {[key: string]: string} = node.getAttributes();\n\t\t\t\t\tconst { defaultTarget = '_blank', attributes } = formatter.getLinkSettings();\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'a',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t...nodeAttributes,\n\t\t\t\t\t\t\t...attributes,\n\t\t\t\t\t\t\thref: sourceHref,\n\t\t\t\t\t\t\ttarget: defaultTarget,\n\t\t\t\t\t\t\tclassName: 'ui-typography-link',\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn document.createDocumentFragment();\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n\n\tstatic fetchNodeValue(node: BBCodeElementNode): string\n\t{\n\t\tconst value: ?string = node.getValue();\n\t\tif (Type.isStringFilled(value))\n\t\t{\n\t\t\treturn value;\n\t\t}\n\n\t\treturn node.toPlainText();\n\t}\n}\n","import { Dom, Type, Loc } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype AfterCallbackOptions,\n\ttype NodeFormatterOptions,\n\ttype ConvertCallbackOptions,\n\ttype BeforeConvertCallbackOptions,\n} from 'ui.bbcode.formatter';\n\nimport { normalizeTextNodes } from '../../helpers/normalize-text-nodes';\nimport type { BBCodeNode } from 'ui.bbcode.model';\n\nexport class SpoilerNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'spoiler',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLDetailsElement {\n\t\t\t\tconst value = node.getValue().trim();\n\t\t\t\tconst title = Type.isStringFilled(value) ? value : Loc.getMessage('HTML_FORMATTER_SPOILER_TITLE');\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'details',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-spoiler ui-icon-set__scope',\n\t\t\t\t\t},\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\tDom.create({\n\t\t\t\t\t\t\ttag: 'summary',\n\t\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\t\tclassName: 'ui-typography-spoiler-title',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttext: title,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t},\n\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeNode {\n\t\t\t\treturn normalizeTextNodes(node);\n\t\t\t},\n\t\t\tafter({ element }: AfterCallbackOptions): HTMLElement {\n\t\t\t\tconst [summary, ...content] = element.children;\n\n\t\t\t\telement.appendChild(summary);\n\t\t\t\telement.appendChild(\n\t\t\t\t\tDom.create({\n\t\t\t\t\t\ttag: 'div',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tclassName: 'ui-typography-spoiler-content',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\tspoilerContent: 'true',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t...content,\n\t\t\t\t\t\t],\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\treturn element;\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatterOptions } from '../../html-formatter';\n\nexport class UserNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions)\n\t{\n\t\tsuper({\n\t\t\tname: 'user',\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLAnchorElement {\n\t\t\t\tconst mentionSettings: HtmlFormatterOptions['mention'] = formatter.getMentionSettings();\n\t\t\t\tif (Type.isStringFilled(mentionSettings?.urlTemplate?.user))\n\t\t\t\t{\n\t\t\t\t\tconst urlTemplate: string = mentionSettings.urlTemplate.user;\n\t\t\t\t\tconst userUrl: string = urlTemplate.replaceAll('#ID#', node.getValue());\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'a',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\thref: userUrl,\n\t\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\tmentionEntityId: 'user',\n\t\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t},\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tmentionEntityId: 'user',\n\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatterOptions } from '../../html-formatter';\n\nexport class DepartmentNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'department',\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLAnchorElement | HTMLSpanElement {\n\t\t\t\tconst mentionSettings: HtmlFormatterOptions['mention'] = formatter.getMentionSettings();\n\t\t\t\tif (Type.isStringFilled(mentionSettings?.urlTemplate?.department))\n\t\t\t\t{\n\t\t\t\t\tconst urlTemplate: string = mentionSettings.urlTemplate.department;\n\t\t\t\t\tconst departmentUrl: string = urlTemplate.replaceAll('#ID#', node.getValue());\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'a',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\thref: departmentUrl,\n\t\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\tmentionEntityId: 'department',\n\t\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t},\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tmentionEntityId: 'department',\n\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatterOptions } from '../../html-formatter';\n\nexport class ProjectNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'project',\n\t\t\tconvert({ node, formatter }: ConvertCallbackOptions): HTMLAnchorElement | HTMLSpanElement {\n\t\t\t\tconst mentionSettings: HtmlFormatterOptions['mention'] = formatter.getMentionSettings();\n\t\t\t\tif (Type.isStringFilled(mentionSettings?.urlTemplate?.project))\n\t\t\t\t{\n\t\t\t\t\tconst urlTemplate: string = mentionSettings.urlTemplate.project;\n\t\t\t\t\tconst projectUrl: string = urlTemplate.replaceAll('#group_id#', node.getValue());\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'a',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\thref: projectUrl,\n\t\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\tmentionEntityId: 'project',\n\t\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'span',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\tclassName: 'ui-typography-mention',\n\t\t\t\t\t},\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tmentionEntityId: 'project',\n\t\t\t\t\t\tmentionId: node.getValue(),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\n\nexport function createImageNode({ src, width, height, viewerAttrs = {} }): HTMLSpanElement\n{\n\treturn Dom.create({\n\t\ttag: 'span',\n\t\tattrs: {\n\t\t\tclassName: 'ui-typography-image-container',\n\t\t},\n\t\tdataset: {\n\t\t\tdecorator: true,\n\t\t\t...viewerAttrs,\n\t\t},\n\t\tchildren: [\n\t\t\tDom.create({\n\t\t\t\ttag: 'img',\n\t\t\t\tattrs: {\n\t\t\t\t\tsrc,\n\t\t\t\t\tclassName: 'ui-typography-image',\n\t\t\t\t\twidth,\n\t\t\t\t\tloading: 'lazy',\n\t\t\t\t},\n\t\t\t\tstyle: {\n\t\t\t\t\taspectRatio: width > 0 && height > 0 ? `${width} / ${height}` : 'auto',\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\terror: (event) => {\n\t\t\t\t\t\tconst img: HTMLImageElement = event.target;\n\t\t\t\t\t\timg.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\t\t\t\t\t\tDom.addClass(img.parentNode, '--error ui-icon-set__scope');\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}),\n\t\t],\n\t});\n}\n","export function validateImageUrl(url: string): boolean\n{\n\treturn /^(http:|https:|ftp:|\\/)/i.test(url);\n}\n","import { Type } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { createImageNode } from '../../helpers/create-image-node';\nimport { validateImageUrl } from '../../helpers/validate-image-url';\n\nexport class ImageNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'img',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLSpanElement {\n\t\t\t\t// [img]{url}[/img]\n\t\t\t\t// [img width={width} height={height}]{url}[/img]\n\t\t\t\tconst src = node.getContent().trim();\n\t\t\t\tlet width = Number(node.getAttribute('width'));\n\t\t\t\tlet height = Number(node.getAttribute('height'));\n\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : null;\n\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : null;\n\n\t\t\t\tif (validateImageUrl(src))\n\t\t\t\t{\n\t\t\t\t\treturn createImageNode({ src, width, height });\n\t\t\t\t}\n\n\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom } from 'main.core';\n\nexport function createVideoNode({ url, width, height, viewerAttrs = {}, type }): HTMLSpanElement\n{\n\tconst video: HTMLVideoElement = Dom.create({\n\t\ttag: 'video',\n\t\tattrs: {\n\t\t\tcontrols: true,\n\t\t\tclassName: 'ui-typography-video-object',\n\t\t\tpreload: 'metadata',\n\t\t\tplaysinline: true,\n\t\t\tsrc: url,\n\t\t\twidth,\n\t\t},\n\t\tdataset: {\n\t\t\tdecorator: true,\n\t\t},\n\t\tstyle: {\n\t\t\taspectRatio: width > 0 && height > 0 ? `${width} / ${height}` : 'auto',\n\t\t},\n\t\t/* children: [\n\t\t\tDom.create({\n\t\t\t\ttag: 'source',\n\t\t\t\tattrs: {\n\t\t\t\t\ttype,\n\t\t\t\t\tsrc: url,\n\t\t\t\t},\n\t\t\t}),\n\t\t], */\n\t});\n\n\treturn Dom.create({\n\t\ttag: 'span',\n\t\tattrs: {\n\t\t\tclassName: 'ui-typography-video-container',\n\t\t},\n\t\tdataset: {\n\t\t\tdecorator: true,\n\t\t\t...viewerAttrs,\n\t\t},\n\t\tchildren: [video],\n\t});\n}\n","import { Type } from 'main.core';\n\n// eslint-disable-next-line no-control-regex\nconst ATTRIBUTE_WHITESPACES = /[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g;\nconst SAFE_URL = /^(?:(?:https?|ftps?|mailto):|[^a-z]|[+.a-z-]+(?:[^+.:a-z-]|$))/i;\n\nexport function sanitizeUrl(url: string): string\n{\n\tif (!Type.isStringFilled(url))\n\t{\n\t\treturn '';\n\t}\n\n\tconst normalizedUrl = url.replaceAll(ATTRIBUTE_WHITESPACES, '');\n\n\treturn SAFE_URL.test(normalizedUrl) ? normalizedUrl : '';\n}\n","export function validateVideoUrl(url: string): boolean\n{\n\treturn /^(http:|https:|\\/)/i.test(url);\n}\n","import { Dom, Type, Uri } from 'main.core';\nimport { NodeFormatter, type NodeFormatterOptions, type ConvertCallbackOptions } from 'ui.bbcode.formatter';\nimport { VideoService } from 'ui.video-service';\nimport { createVideoNode } from '../../helpers/create-video-node';\nimport { sanitizeUrl } from '../../helpers/sanitize-url';\nimport { validateVideoUrl } from '../../helpers/validate-video-url';\n\nexport class VideoNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tsuper({\n\t\t\tname: 'video',\n\t\t\tconvert({ node }: ConvertCallbackOptions): HTMLSpanElement {\n\t\t\t\t// [video type={type} width={width} height={height}]{url}[/video]\n\t\t\t\tconst src = sanitizeUrl(node.getContent().trim());\n\t\t\t\tif (!validateVideoUrl(src))\n\t\t\t\t{\n\t\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t\t}\n\n\t\t\t\tlet width = Number(node.getAttribute('width'));\n\t\t\t\tlet height = Number(node.getAttribute('height'));\n\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : 560;\n\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : 315;\n\n\t\t\t\tconst url = /^https?:/.test(src) ? src : `https://${src.replace(/^\\/\\//, '')}`;\n\t\t\t\tconst uri = new Uri(url);\n\t\t\t\tconst trusted = VideoService.createByHost(uri.getHost()) !== null;\n\t\t\t\tif (trusted)\n\t\t\t\t{\n\t\t\t\t\tconst video: HTMLIFrameElement = Dom.create({\n\t\t\t\t\t\ttag: 'iframe',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tsrc,\n\t\t\t\t\t\t\tclassName: 'ui-typography-video-object',\n\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\theight: 'auto',\n\t\t\t\t\t\t\tframeborder: 0,\n\t\t\t\t\t\t\tallowfullscreen: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\taspectRatio: `${width} / ${height}`,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\treturn Dom.create({\n\t\t\t\t\t\ttag: 'span',\n\t\t\t\t\t\tattrs: {\n\t\t\t\t\t\t\tclassName: 'ui-typography-video-container',\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdataset: {\n\t\t\t\t\t\t\tdecorator: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tchildren: [video],\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// const path = uri.getPath();\n\t\t\t\t// const position: number = path.lastIndexOf('.');\n\t\t\t\t// const extension = position >= 0 ? path.slice(Math.max(0, position + 1)).toLowerCase() : '';\n\t\t\t\t// const type = ['mp4', 'webm', 'mov'].includes(extension) ? `video/${extension}` : null;\n\n\t\t\t\treturn createVideoNode({ url, width, height });\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Dom, Type, Text } from 'main.core';\nimport {\n\tNodeFormatter,\n\ttype ConvertCallbackOptions,\n\ttype NodeFormatterOptions,\n} from 'ui.bbcode.formatter';\nimport type { HtmlFormatter } from 'ui.bbcode.formatter.html-formatter';\nimport type { UploaderFileInfo } from 'ui.uploader.core';\nimport { createImageNode } from '../../helpers/create-image-node';\nimport { createVideoNode } from '../../helpers/create-video-node';\n\nexport class FileNodeFormatter extends NodeFormatter\n{\n\tconstructor(options: NodeFormatterOptions = {})\n\t{\n\t\tconst formatter: HtmlFormatter = options.formatter;\n\t\tconst fileMode = formatter.getFileMode();\n\t\tconst viewerGroupBy = Text.getRandom();\n\n\t\tsuper({\n\t\t\tname: fileMode || '__unknown__',\n\t\t\tconvert({ node, data }: ConvertCallbackOptions): HTMLElement {\n\t\t\t\tif (fileMode === null)\n\t\t\t\t{\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t\t// [DISK FILE ID=n14194]\n\t\t\t\t// [DISK FILE ID=14194]\n\n\t\t\t\t// [FILE ID=5b87ba3b-edb1-49df-a840-50d17b6c3e8c.fbbdd477d5ff19d61...a875e731fa89cfd1e1]\n\t\t\t\t// [FILE ID=14194]\n\t\t\t\tconst serverFileId = node.getAttribute('id');\n\t\t\t\tconst createTextNode = () => {\n\t\t\t\t\treturn document.createTextNode(node.toString());\n\t\t\t\t};\n\n\t\t\t\tif (\n\t\t\t\t\t!Type.isStringFilled(serverFileId)\n\t\t\t\t\t|| (fileMode === 'disk' && !/^n?\\d+$/i.test(serverFileId))\n\t\t\t\t\t|| (fileMode === 'file' && !/^(\\d+|[\\da-f-]{36}\\.[\\da-f]{32,})$/i.test(serverFileId))\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn createTextNode();\n\t\t\t\t}\n\n\t\t\t\tconst info: UploaderFileInfo = data?.files?.find((file: UploaderFileInfo): boolean => {\n\t\t\t\t\treturn file.serverFileId.toString() === serverFileId.toString()\n\t\t\t\t\t\t|| `n${file.customData?.objectId.toString()}` === serverFileId.toString()\n\t\t\t\t\t;\n\t\t\t\t});\n\n\t\t\t\tif (!info)\n\t\t\t\t{\n\t\t\t\t\treturn createTextNode();\n\t\t\t\t}\n\n\t\t\t\tconst viewerAttrsExist = Type.isPlainObject(info.viewerAttrs);\n\t\t\t\tconst viewerAttrs = viewerAttrsExist ? { ...info.viewerAttrs } : {};\n\t\t\t\tif (\n\t\t\t\t\tviewerAttrsExist\n\t\t\t\t\t&& !Type.isStringFilled(viewerAttrs.viewerGroupBy)\n\t\t\t\t\t&& Type.isUndefined(viewerAttrs.viewerSeparateItem)\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tviewerAttrs.viewerGroupBy = viewerGroupBy;\n\t\t\t\t}\n\n\t\t\t\tif (info.isImage)\n\t\t\t\t{\n\t\t\t\t\tlet width = Text.toInteger(node.getAttribute('width'));\n\t\t\t\t\tlet height = Text.toInteger(node.getAttribute('height'));\n\n\t\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : info.serverPreviewWidth;\n\t\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : info.serverPreviewHeight;\n\n\t\t\t\t\treturn createImageNode({\n\t\t\t\t\t\twidth,\n\t\t\t\t\t\theight,\n\t\t\t\t\t\tsrc: info.serverPreviewUrl,\n\t\t\t\t\t\tviewerAttrs,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (info.isVideo)\n\t\t\t\t{\n\t\t\t\t\tlet width = Number(node.getAttribute('width'));\n\t\t\t\t\tlet height = Number(node.getAttribute('height'));\n\t\t\t\t\twidth = Type.isNumber(width) && width > 0 ? Math.round(width) : 600;\n\t\t\t\t\theight = Type.isNumber(height) && height > 0 ? Math.round(height) : null;\n\n\t\t\t\t\treturn createVideoNode({\n\t\t\t\t\t\turl: info.downloadUrl,\n\t\t\t\t\t\tviewerAttrs,\n\t\t\t\t\t\twidth,\n\t\t\t\t\t\theight,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn Dom.create({\n\t\t\t\t\ttag: 'a',\n\t\t\t\t\tattrs: {\n\t\t\t\t\t\thref: info.downloadUrl,\n\t\t\t\t\t\tclassName: 'ui-typography-link',\n\t\t\t\t\t},\n\t\t\t\t\ttext: info.name || 'unknown',\n\t\t\t\t\tdataset: {\n\t\t\t\t\t\tfileId: info.serverFileId,\n\t\t\t\t\t\tfileInfo: JSON.stringify(info),\n\t\t\t\t\t\t...viewerAttrs,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t...options,\n\t\t});\n\t}\n}\n","import { Type, Extension } from 'main.core';\nimport {\n\tFormatter,\n\tNodeFormatter,\n\ttype FormatterOptions,\n\ttype UnknownNodeCallbackOptions,\n\ttype BeforeConvertCallbackOptions,\n} from 'ui.bbcode.formatter';\nimport { BBCodeScheme, BBCodeFragmentNode } from 'ui.bbcode.model';\nimport * as NodeFormatters from './node-formatters';\n\nimport 'ui.typography';\n\nexport type HtmlFormatterOptions = FormatterOptions & {\n\tlinkSettings?: {\n\t\tallowedSchemes?: string,\n\t\tdefaultScheme?: 'http',\n\t\tdefaultTarget?: '_self' | '_blank' | '_parent' | '_top',\n\t\tshortLink: {\n\t\t\tenabled?: boolean,\n\t\t\tmaxLength?: number,\n\t\t\tlastFragmentLength?: number,\n\t\t},\n\t\tattributes?: {\n\t\t\t[key: string]: string,\n\t\t},\n\t},\n\tmention: {\n\t\turlTemplate: {\n\t\t\tuser: string,\n\t\t\tproject: string,\n\t\t\tdepartment: string,\n\t\t},\n\t},\n\tfileMode: 'disk' | 'file',\n\tcontainerMode: 'none' | 'void' | 'collapsed',\n};\n\nconst globalSettings = Extension.getSettings('ui.bbcode.formatter.html-formatter');\n\n/**\n * @memberOf BX.UI.BBCode.Formatter\n */\nexport class HtmlFormatter extends Formatter\n{\n\t#linkSettings: HtmlFormatterOptions['linkSettings'];\n\t#mentionSettings: HtmlFormatterOptions['mention'];\n\t#fileMode: HtmlFormatterOptions['fileMode'];\n\t#containerMode: HtmlFormatterOptions['container'];\n\n\tconstructor(options: HtmlFormatterOptions = {})\n\t{\n\t\tsuper();\n\n\t\tthis.setLinkSettings({\n\t\t\t...globalSettings.linkSettings,\n\t\t\t...options.linkSettings,\n\t\t});\n\n\t\tthis.setMentionSettings({\n\t\t\t...globalSettings.mention,\n\t\t\t...options.mention,\n\t\t});\n\n\t\tthis.#fileMode = ['file', 'disk'].includes(options.fileMode) ? options.fileMode : null;\n\n\t\tconst defaultFormatters = Object.values(NodeFormatters).map((FormatterClass: NodeFormatter) => {\n\t\t\treturn new FormatterClass({ formatter: this });\n\t\t});\n\n\t\tthis.setContainerMode(options.containerMode);\n\t\tthis.setNodeFormatters(defaultFormatters);\n\t\tthis.setNodeFormatters(options.formatters);\n\t}\n\n\tisShortLinkEnabled(): boolean\n\t{\n\t\tconst { shortLink } = this.getLinkSettings();\n\n\t\treturn (\n\t\t\tType.isPlainObject(shortLink)\n\t\t\t&& shortLink.enabled === true\n\t\t\t&& Type.isInteger(shortLink.maxLength)\n\t\t);\n\t}\n\n\tsetLinkSettings(settings: HtmlFormatterOptions['linkSettings'])\n\t{\n\t\tthis.#linkSettings = { ...settings };\n\t}\n\n\tgetLinkSettings(): HtmlFormatterOptions['linkSettings']\n\t{\n\t\treturn this.#linkSettings;\n\t}\n\n\tgetFileMode(): HtmlFormatterOptions['fileMode'] | null\n\t{\n\t\treturn this.#fileMode;\n\t}\n\n\tsetMentionSettings(settings: HtmlFormatterOptions['mention'])\n\t{\n\t\tthis.#mentionSettings = { ...settings };\n\t}\n\n\tgetMentionSettings(): HtmlFormatterOptions['mention']\n\t{\n\t\treturn this.#mentionSettings;\n\t}\n\n\tsetContainerMode(mode: HtmlFormatterOptions['containerMode']): void\n\t{\n\t\tthis.#containerMode = mode;\n\t}\n\n\tgetContainerMode(): HtmlFormatterOptions['container']\n\t{\n\t\treturn this.#containerMode;\n\t}\n\n\tisElement(source): boolean\n\t{\n\t\tif (source.nodeType === Node.DOCUMENT_FRAGMENT_NODE)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (source.nodeType !== Node.ELEMENT_NODE || this.#isVoidElement(source))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Type.isUndefined(source.dataset.decorator);\n\t}\n\n\t#isVoidElement(source): boolean\n\t{\n\t\treturn ['img', 'br', 'hr', 'input'].includes(source.tagName.toLowerCase());\n\t}\n\n\tgetDefaultUnknownNodeCallback(options): (UnknownNodeCallbackOptions) => NodeFormatter | null\n\t{\n\t\treturn () => {\n\t\t\treturn new NodeFormatter({\n\t\t\t\tname: 'unknown',\n\t\t\t\tbefore({ node }: BeforeConvertCallbackOptions): BBCodeFragmentNode {\n\t\t\t\t\tconst scheme: BBCodeScheme = node.getScheme();\n\n\t\t\t\t\tif (node.isVoid())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn scheme.createFragment({\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\tscheme.createText(node.getOpeningTag()),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn scheme.createFragment({\n\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\tscheme.createText(node.getOpeningTag()),\n\t\t\t\t\t\t\t...node.getChildren(),\n\t\t\t\t\t\t\tscheme.createText(node.getClosingTag()),\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tconvert(): DocumentFragment {\n\t\t\t\t\treturn document.createDocumentFragment();\n\t\t\t\t},\n\t\t\t});\n\t\t};\n\t}\n}\n","import { Dom } from 'main.core';\nimport { HtmlFormatter } from './html-formatter';\n\nexport const HtmlFormatterComponent = {\n\tprops: {\n\t\tbbcode: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\t/** @type HtmlFormatterOptions */\n\t\toptions: {\n\t\t\ttype: Object,\n\t\t\tdefault: undefined,\n\t\t},\n\t\t/** @type FormatterData */\n\t\tformatData: {\n\t\t\ttype: Object,\n\t\t\tdefault: () => ({}),\n\t\t},\n\t},\n\tbeforeCreate(): void\n\t{\n\t\tthis.htmlFormatter = null;\n\t},\n\tmounted(): void\n\t{\n\t\tthis.format();\n\t},\n\tunmounted(): void\n\t{\n\t\tthis.htmlFormatter = null;\n\t},\n\twatch: {\n\t\tbbcode(): void\n\t\t{\n\t\t\tthis.format();\n\t\t},\n\t\tformatData(): void\n\t\t{\n\t\t\tthis.format();\n\t\t},\n\t},\n\tmethods: {\n\t\tformat(): void\n\t\t{\n\t\t\tconst result = this.getHtmlFormatter().format({ source: this.bbcode, data: this.formatData });\n\n\t\t\tDom.clean(this.$el);\n\t\t\tDom.append(result, this.$el);\n\t\t},\n\t\tgetHtmlFormatter(): HtmlFormatter\n\t\t{\n\t\t\tthis.htmlFormatter ??= new HtmlFormatter(this.options);\n\n\t\t\treturn this.htmlFormatter;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-typography-container\"></div>\n\t`,\n};\n"],"names":["createEmptyParagraphs","scheme","count","result","i","push","createElement","name","shouldWrapInParagraph","node","getType","BBCodeNode","ELEMENT_NODE","hasGroup","wrapTextNodes","nodes","currentParagraph","lineBreaks","isNewLine","appendChild","createNewLine","length","normalizeTextNodes","getScheme","children","getChildren","setChildren","RootNodeFormatter","NodeFormatter","constructor","options","convert","document","createDocumentFragment","before","after","element","formatter","mode","getContainerMode","container","Tag","render","findParent","startingNode","findFn","curr","ROOT_NODE","getParent","TextNodeFormatter","text","toString","encode","parent","getName","createTextNode","splits","parse","fragment","currentIndex","split","start","chunk","slice","typing","end","smiley","SmileyManager","get","createImg","tail","SmileyParser","getAll","img","src","encodeURI","getImage","className","alt","getTyping","getWidth","getHeight","Dom","style","width","height","TabNodeFormatter","LinebreakNodeFormatter","normalizeLineBreaks","ParagraphNodeFormatter","create","tag","attrs","BoldNodeFormatter","getAttributes","UnderlineNodeFormatter","ItalicNodeFormatter","StrikethroughNodeFormatter","TableNodeFormatter","classname","TableHeadCellNodeFormatter","TableDataCellNodeFormatter","TableRowNodeFormatter","ListNodeFormatter","tagName","getValue","ListItemNodeFormatter","nested","some","child","QuoteNodeFormatter","CodeNodeFormatter","content","getTextContent","dataset","decorator","getCodeTokenNodes","CodeParser","tokens","forEach","token","partials","partialsLength","part","span","type","textContent","validateUrl","url","allowDomainRelativeUrl","test","LinkNodeFormatter","isShortLinkEnabled","isIncludeImg","nodeContentLength","getPlainTextLength","shortLink","getLinkSettings","maxLength","sourceHref","fetchNodeValue","nodeRoot","createRoot","left","right","offset","lastFragmentLength","sourceRightFragmentLength","newLink","clone","setValue","createText","lastFragment","value","Type","isStringFilled","getContent","nodeAttributes","defaultTarget","attributes","href","target","toPlainText","SpoilerNodeFormatter","trim","title","Loc","getMessage","summary","spoilerContent","UserNodeFormatter","mentionSettings","getMentionSettings","urlTemplate","user","userUrl","replaceAll","mentionEntityId","mentionId","DepartmentNodeFormatter","department","departmentUrl","ProjectNodeFormatter","project","projectUrl","createImageNode","viewerAttrs","loading","aspectRatio","events","error","event","addClass","parentNode","validateImageUrl","ImageNodeFormatter","Number","getAttribute","isNumber","Math","round","createVideoNode","video","controls","preload","playsinline","ATTRIBUTE_WHITESPACES","SAFE_URL","sanitizeUrl","normalizedUrl","validateVideoUrl","VideoNodeFormatter","replace","uri","Uri","trusted","VideoService","createByHost","getHost","frameborder","allowfullscreen","FileNodeFormatter","fileMode","getFileMode","viewerGroupBy","Text","getRandom","data","serverFileId","info","files","find","file","customData","objectId","viewerAttrsExist","isPlainObject","isUndefined","viewerSeparateItem","isImage","toInteger","serverPreviewWidth","serverPreviewHeight","serverPreviewUrl","isVideo","downloadUrl","fileId","fileInfo","JSON","stringify","globalSettings","Extension","getSettings","HtmlFormatter","Formatter","setLinkSettings","linkSettings","setMentionSettings","mention","includes","defaultFormatters","Object","values","NodeFormatters","map","FormatterClass","setContainerMode","containerMode","setNodeFormatters","formatters","enabled","isInteger","settings","isElement","source","nodeType","Node","DOCUMENT_FRAGMENT_NODE","getDefaultUnknownNodeCallback","isVoid","createFragment","getOpeningTag","getClosingTag","toLowerCase","HtmlFormatterComponent","props","bbcode","String","default","undefined","formatData","beforeCreate","htmlFormatter","mounted","format","unmounted","watch","methods","getHtmlFormatter","clean","$el","append","template"],"mappings":"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"}