{"version":3,"file":"ui.uploader.bundle.js","sources":["../src/enums/file-status.js","../src/enums/file-origin.js","../src/enums/file-event.js","../src/helpers/get-file-extension.js","../src/helpers/is-supported-video.js","../src/uploader-error.js","../src/backend/abstract-upload-controller.js","../src/backend/abstract-load-controller.js","../src/backend/abstract-remove-controller.js","../src/helpers/create-unique-id.js","../src/helpers/get-extension-from-type.js","../src/helpers/create-file-from-blob.js","../src/helpers/is-data-uri.js","../src/helpers/create-blob-from-data-uri.js","../src/helpers/is-resizable-image.js","../src/helpers/format-file-size.js","../src/uploader-file.js","../src/backend/chunk.js","../src/backend/upload-controller.js","../src/backend/server-load-multiple.js","../src/backend/server-load-controller.js","../src/backend/client-load-controller.js","../src/backend/remove-multiple.js","../src/backend/remove-controller.js","../src/backend/serverless-load-controller.js","../src/backend/server.js","../src/filters/filter.js","../src/filters/file-size-filter.js","../src/helpers/is-valid-file-type.js","../src/filters/file-type-filter.js","../src/helpers/get-array-buffer.js","../src/helpers/image-size/convert-string-to-buffer.js","../src/helpers/image-size/compare-buffers.js","../src/helpers/image-size/types/gif.js","../src/helpers/image-size/types/png.js","../src/helpers/image-size/types/bmp.js","../src/helpers/image-size/types/jpeg.js","../src/helpers/image-size/types/webp.js","../src/helpers/image-size/get-image-size.js","../src/filters/image-size-filter.js","../src/helpers/create-worker.js","../src/helpers/bitmap-worker.js","../src/helpers/resize-worker.js","../src/helpers/load-image.js","../src/helpers/create-image-preview-canvas.js","../src/helpers/get-resized-image-size.js","../src/helpers/convert-canvas-to-blob.js","../src/helpers/is-supported-mime-type.js","../src/helpers/sharpen.js","../src/helpers/create-image-preview.js","../src/helpers/get-canvas-to-blob-type.js","../src/helpers/get-filename-without-extension.js","../src/helpers/rename-file-to-match-mime-type.js","../src/helpers/resize-image.js","../src/helpers/is-video.js","../src/helpers/create-video-preview.js","../src/filters/image-preview-filter.js","../src/filters/image-resize-filter.js","../src/enums/uploader-status.js","../src/enums/uploader-event.js","../src/enums/filter-type.js","../src/helpers/get-files-in-directory.js","../src/helpers/is-directory-entry.js","../src/helpers/is-file-system-item.js","../src/helpers/get-files-from-data-transfer.js","../src/helpers/can-append-file-to-form.js","../src/helpers/assign-file-to-input.js","../src/uploader.js","../src/helpers/is-image.js","../src/helpers/get-jpeg-orientation.js","../src/helpers/is-jpeg.js"],"sourcesContent":["/**\n * @namespace BX.UI.Uploader\n */\nexport type FileStatusType = {\n\tINIT: string,\n\tADDED: string,\n\tLOADING: string,\n\tPENDING: string,\n\tPREPARING: string,\n\tUPLOADING: string,\n\tCOMPLETE: string,\n\tLOAD_FAILED: string,\n\tUPLOAD_FAILED: string,\n};\n\n/**\n * @namespace BX.UI.Uploader\n */\nexport const FileStatus: FileStatusType = {\n\tINIT: 'init',\n\tADDED: 'added',\n\tLOADING: 'loading',\n\tPENDING: 'pending',\n\tPREPARING: 'preparing',\n\tUPLOADING: 'uploading',\n\tCOMPLETE: 'complete',\n\t// REMOVING: 'removing',\n\t// REMOVE_FAILED: 'remove-failed',\n\tLOAD_FAILED: 'load-failed',\n\tUPLOAD_FAILED: 'upload-failed',\n};\n","/**\n * @namespace BX.UI.Uploader\n */\nexport const FileOrigin = {\n\tCLIENT: 'client',\n\tSERVER: 'server',\n};\n","/**\n * @namespace BX.UI.Uploader\n */\nexport const FileEvent = {\n\tADD: 'onAdd',\n\tBEFORE_UPLOAD: 'onBeforeUpload',\n\tUPLOAD_START: 'onUploadStart',\n\tUPLOAD_ERROR: 'onUploadError',\n\tUPLOAD_PROGRESS: 'onUploadProgress',\n\tUPLOAD_COMPLETE: 'onUploadComplete',\n\tUPLOAD_CONTROLLER_INIT: 'onUploadControllerInit',\n\tLOAD_START: 'onLoadStart',\n\tLOAD_PROGRESS: 'onLoadProgress',\n\tLOAD_COMPLETE: 'onLoadComplete',\n\tLOAD_ERROR: 'onLoadError',\n\tLOAD_CONTROLLER_INIT: 'onLoadControllerInit',\n\tREMOVE_ERROR: 'onRemoveError',\n\tREMOVE_COMPLETE: 'onRemoveComplete',\n\tREMOVE_CONTROLLER_INIT: 'onRemoveControllerInit',\n\tSTATE_CHANGE: 'onStateChange',\n\tSTATUS_CHANGE: 'onStatusChange',\n\tVALIDATE_FILE_ASYNC: 'onValidateFileAsync',\n\tPREPARE_FILE_ASYNC: 'onPrepareFileAsync',\n};\n","import { Type } from 'main.core';\n\nconst getFileExtension = (filename: string): string => {\n\tconst position: number = Type.isStringFilled(filename) ? filename.lastIndexOf('.') : -1;\n\n\treturn position > 0 ? filename.slice(Math.max(0, position + 1)) : '';\n};\n\nexport default getFileExtension;\n","import { Type } from 'main.core';\nimport getFileExtension from './get-file-extension';\nimport Uploader from '../uploader';\n\nlet videoExtensions = null;\n\nconst isSupportedVideo = (file: File | string, mimeType: string = null): boolean => {\n\tif (videoExtensions === null)\n\t{\n\t\tvideoExtensions = Uploader.getVideoExtensions();\n\t}\n\n\tconst fileName: string = Type.isFile(file) ? file.name : file;\n\tconst type: string = Type.isFile(file) ? file.type : mimeType;\n\tconst extension: string = getFileExtension(fileName).toLowerCase();\n\n\treturn videoExtensions.includes(extension) && (type === null || /^video\\/[\\d.a-z-]+$/i.test(type));\n};\n\nexport default isSupportedVideo;\n","import { BaseError, Type, Loc } from 'main.core';\n\n/**\n * @namespace BX.UI.Uploader\n */\nexport default class UploaderError extends BaseError\n{\n\tstatic Origin = {\n\t\tSERVER: 'server',\n\t\tCLIENT: 'client',\n\t};\n\n\tstatic Type = {\n\t\tUSER: 'user',\n\t\tSYSTEM: 'system',\n\t\tUNKNOWN: 'unknown',\n\t};\n\n\tdescription: string = '';\n\torigin: $Values<UploaderError.Origin> = UploaderError.Origin.CLIENT;\n\ttype: $Values<UploaderError.Type> = UploaderError.Type.USER;\n\n\t/**\n\t * new UploaderError(code)\n\t * new UploaderError(code, customData)\n\t * new UploaderError(code, message)\n\t * new UploaderError(code, message, description)\n\t * new UploaderError(code, message, customData)\n\t * new UploaderError(code, message, description, customData)\n\t */\n\tconstructor(code: string, ...args)\n\t{\n\t\tlet message = Type.isString(args[0]) ? args[0] : null;\n\t\tlet description = Type.isString(args[1]) ? args[1] : null;\n\t\tconst customData = Type.isPlainObject(args[args.length - 1]) ? args[args.length - 1] : {};\n\n\t\tconst replacements = {};\n\t\tObject.keys(customData).forEach((key: string): void => {\n\t\t\treplacements[`#${key}#`] = customData[key];\n\t\t});\n\n\t\tif (!Type.isString(message) && Loc.hasMessage(`UPLOADER_${code}`))\n\t\t{\n\t\t\tmessage = Loc.getMessage(`UPLOADER_${code}`, replacements);\n\t\t}\n\n\t\tif (Type.isStringFilled(message) && !Type.isString(description) && Loc.hasMessage(`UPLOADER_${code}_DESC`))\n\t\t{\n\t\t\tdescription = Loc.getMessage(`UPLOADER_${code}_DESC`, replacements);\n\t\t}\n\n\t\tsuper(message, code, customData);\n\t\tthis.setDescription(description);\n\t}\n\n\tstatic createFromAjaxErrors(errors: Array): UploaderError\n\t{\n\t\tif (!Type.isArrayFilled(errors) || !Type.isPlainObject(errors[0]))\n\t\t{\n\t\t\treturn new this('SERVER_ERROR');\n\t\t}\n\n\t\tconst uploaderError = errors.find(error => {\n\t\t\treturn error.type === 'file-uploader';\n\t\t});\n\n\t\tif (uploaderError && !uploaderError.system)\n\t\t{\n\t\t\t// Take the First Uploader User Error\n\t\t\tconst { code, message, description, customData } = uploaderError;\n\t\t\tconst error: UploaderError = new this(code, message, description, customData);\n\t\t\terror.setOrigin(UploaderError.Origin.SERVER);\n\t\t\terror.setType(UploaderError.Type.USER);\n\n\t\t\treturn error;\n\t\t}\n\n\t\tlet { code, message, description } = errors[0];\n\t\tconst { customData, system, type } = errors[0];\n\n\t\tif (code === 'NETWORK_ERROR')\n\t\t{\n\t\t\tmessage = Loc.getMessage('UPLOADER_NETWORK_ERROR');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tcode = Type.isStringFilled(code) ? code : 'SERVER_ERROR';\n\t\t\tif (!Type.isStringFilled(description))\n\t\t\t{\n\t\t\t\tdescription = message;\n\t\t\t\tmessage = Loc.getMessage('UPLOADER_SERVER_ERROR');\n\t\t\t}\n\t\t}\n\n\t\tconsole.error('Uploader', errors);\n\n\t\tconst error: UploaderError = new this(code, message, description, customData);\n\t\terror.setOrigin(UploaderError.Origin.SERVER);\n\n\t\tif (type === 'file-uploader')\n\t\t{\n\t\t\terror.setType(system ? UploaderError.Type.SYSTEM : UploaderError.Type.USER);\n\t\t}\n\t\telse\n\t\t{\n\t\t\terror.setType(UploaderError.Type.UNKNOWN);\n\t\t}\n\n\t\treturn error;\n\t}\n\n\tstatic createFromError(error: Error): UploaderError\n\t{\n\t\treturn new this(error.name, error.message);\n\t}\n\n\tgetDescription(): string\n\t{\n\t\treturn this.description;\n\t}\n\n\tsetDescription(text: string): this\n\t{\n\t\tif (Type.isString(text))\n\t\t{\n\t\t\tthis.description = text;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetOrigin(): $Values<UploaderError.Origin>\n\t{\n\t\treturn this.origin;\n\t}\n\n\tsetOrigin(origin: $Values<UploaderError.Origin>): this\n\t{\n\t\tif (Object.values(UploaderError.Origin).includes(origin))\n\t\t{\n\t\t\tthis.origin = origin;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tgetType(): $Values<UploaderError.Type>\n\t{\n\t\treturn this.type;\n\t}\n\n\tsetType(type: $Values<UploaderError.Type>): this\n\t{\n\t\tif (Type.isStringFilled(type))\n\t\t{\n\t\t\tthis.type = type;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tclone(): UploaderError\n\t{\n\t\tconst options = JSON.parse(JSON.stringify(this));\n\t\tconst error = new UploaderError(\n\t\t\toptions.code,\n\t\t\toptions.message,\n\t\t\toptions.description,\n\t\t\toptions.customData,\n\t\t);\n\n\t\terror.setOrigin(options.origin);\n\t\terror.setType(options.type);\n\n\t\treturn error;\n\t}\n\n\ttoString(): string\n\t{\n\t\treturn `Uploader Error (${this.getCode()}): ${this.getMessage()} (${this.getOrigin()})`;\n\t}\n\n\ttoJSON(): { [key: string]: any }\n\t{\n\t\treturn {\n\t\t\tcode: this.getCode(),\n\t\t\tmessage: this.getMessage(),\n\t\t\tdescription: this.getDescription(),\n\t\t\torigin: this.getOrigin(),\n\t\t\ttype: this.getType(),\n\t\t\tcustomData: this.getCustomData(),\n\t\t};\n\t}\n}\n","import { EventEmitter } from 'main.core.events';\nimport type Server from './server';\nimport type UploaderFile from '../uploader-file';\nimport { Type } from 'main.core';\n\nexport default class AbstractUploadController extends EventEmitter\n{\n\t#server: Server;\n\t#options: { [key: string]: any };\n\n\tconstructor(server: Server, options: { [key: string]: any } = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.UI.Uploader.UploadController');\n\n\t\tthis.#server = server;\n\t\tthis.#options = options;\n\t}\n\n\tgetServer(): Server\n\t{\n\t\treturn this.#server;\n\t}\n\n\tgetOptions(): { [key: string]: any }\n\t{\n\t\treturn this.#options;\n\t}\n\n\tgetOption(option: string, defaultValue?: any): any\n\t{\n\t\tif (!Type.isUndefined(this.#options[option]))\n\t\t{\n\t\t\treturn this.#options[option];\n\t\t}\n\n\t\tif (!Type.isUndefined(defaultValue))\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tupload(file: UploaderFile): void\n\t{\n\t\tthrow new Error('You must implement upload() method.');\n\t}\n\n\tabort(): void\n\t{\n\t\tthrow new Error('You must implement abort() method.');\n\t}\n}\n","import { Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport type Server from './server';\nimport type UploaderFile from '../uploader-file';\n\nexport default class AbstractLoadController extends EventEmitter\n{\n\t#server: Server;\n\t#options: { [key: string]: any };\n\n\tconstructor(server: Server, options: { [key: string]: any } = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.UI.Uploader.LoadController');\n\n\t\tthis.#server = server;\n\t\tthis.#options = options;\n\t}\n\n\tgetServer(): Server\n\t{\n\t\treturn this.#server;\n\t}\n\n\tgetOptions(): { [key: string]: any }\n\t{\n\t\treturn this.#options;\n\t}\n\n\tgetOption(option: string, defaultValue?: any): any\n\t{\n\t\tif (!Type.isUndefined(this.#options[option]))\n\t\t{\n\t\t\treturn this.#options[option];\n\t\t}\n\n\t\tif (!Type.isUndefined(defaultValue))\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tload(file: UploaderFile): void\n\t{\n\t\tthrow new Error('You must implement load() method.');\n\t}\n\n\tabort(): void\n\t{\n\t\tthrow new Error('You must implement abort() method.');\n\t}\n}\n","import { Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\n\nimport type Server from './server';\nimport type UploaderFile from '../uploader-file';\n\nexport default class AbstractRemoveController extends EventEmitter\n{\n\t#server: Server;\n\t#options: { [key: string]: any };\n\n\tconstructor(server: Server, options: { [key: string]: any } = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.UI.Uploader.RemoveController');\n\n\t\tthis.#server = server;\n\t\tthis.#options = options;\n\t}\n\n\tgetServer(): Server\n\t{\n\t\treturn this.#server;\n\t}\n\n\tgetOptions(): { [key: string]: any }\n\t{\n\t\treturn this.#options;\n\t}\n\n\tgetOption(option: string, defaultValue?: any): any\n\t{\n\t\tif (!Type.isUndefined(this.#options[option]))\n\t\t{\n\t\t\treturn this.#options[option];\n\t\t}\n\n\t\tif (!Type.isUndefined(defaultValue))\n\t\t{\n\t\t\treturn defaultValue;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tremove(file: UploaderFile): void\n\t{\n\t\tthrow new Error('You must implement remove() method.');\n\t}\n}\n","/* eslint-disable @bitrix24/bitrix24-rules/no-typeof */\n\nlet crypto = window.crypto || window.msCrypto;\nif (!crypto && typeof (process) === 'object')\n{\n\t// eslint-disable-next-line no-undef\n\tcrypto = require('crypto').webcrypto;\n}\n\nconst createUniqueId = (): string => {\n\treturn (`${1e7}-${1e3}-${4e3}-${8e3}-${1e11}`).replaceAll(\n\t\t/[018]/g,\n\t\t(part: string) => (part ^ (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (part / 4)))).toString(16),\n\t);\n};\n\nexport default createUniqueId;\n","import { Type } from 'main.core';\n\nconst getExtensionFromType = (type): string => {\n\tif (!Type.isStringFilled(type))\n\t{\n\t\treturn '';\n\t}\n\n\tconst subtype = type.split('/').pop();\n\n\tif (/javascript/.test(subtype))\n\t{\n\t\treturn 'js';\n\t}\n\n\tif (/plain/.test(subtype))\n\t{\n\t\treturn 'txt';\n\t}\n\n\tif (/svg/.test(subtype))\n\t{\n\t\treturn 'svg';\n\t}\n\n\tif (/[a-z]+/.test(subtype))\n\t{\n\t\treturn subtype;\n\t}\n\n\treturn '';\n};\n\nexport default getExtensionFromType;\n","import { Type } from 'main.core';\nimport getExtensionFromType from './get-extension-from-type';\n\nlet counter = 0;\nconst createFileFromBlob = (blob: Blob, fileName: string): File => {\n\tlet newFileName = fileName;\n\tif (!Type.isStringFilled(newFileName))\n\t{\n\t\tconst date = new Date();\n\t\tnewFileName = `File ${date.getFullYear()}-${date.getMonth()}-${date.getDate()}-${++counter}`;\n\n\t\tconst extension = getExtensionFromType(blob.type);\n\t\tif (extension)\n\t\t{\n\t\t\tnewFileName += `.${extension}`;\n\t\t}\n\t}\n\n\ttry\n\t{\n\t\treturn new File(\n\t\t\t[blob],\n\t\t\tnewFileName,\n\t\t\t{\n\t\t\t\tlastModified: Date.now(),\n\t\t\t\tlastModifiedDate: new Date(),\n\t\t\t\ttype: blob.type,\n\t\t\t},\n\t\t);\n\t}\n\tcatch\n\t{\n\t\tconst file = blob.slice(0, blob.size, blob.type);\n\t\tfile.name = newFileName;\n\t\tfile.lastModified = Date.now();\n\t\tfile.lastModifiedDate = new Date();\n\n\t\treturn file;\n\t}\n};\n\nexport default createFileFromBlob;\n","import { Type } from 'main.core';\n\nconst regexp = /^data:((?:\\w+\\/(?:(?!;).)+)?)((?:;[\\W\\w]*?[^;])*),(.+)$/;\n\nconst isDataUri = (str: string): boolean => {\n\treturn Type.isString(str) ? str.match(regexp) : false;\n};\n\nexport default isDataUri;\n","const createBlobFromDataUri = (dataURI: string): Blob => {\n\tconst byteString = atob(dataURI.split(',')[1]);\n\tconst mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n\n\tconst buffer = new ArrayBuffer(byteString.length);\n\tconst view = new Uint8Array(buffer);\n\n\tfor (let i = 0; i < byteString.length; i++)\n\t{\n\t\tview[i] = byteString.codePointAt(i);\n\t}\n\n\treturn new Blob([buffer], { type: mimeString });\n};\n\nexport default createBlobFromDataUri;\n","import { Type } from 'main.core';\nimport getFileExtension from './get-file-extension';\n\nconst imageExtensions: Set<string> = new Set(['jpg', 'bmp', 'jpeg', 'jpe', 'gif', 'png', 'webp']);\n\nconst isResizableImage = (file: File | string, mimeType: string = null): boolean => {\n\tconst fileName: string = Type.isFile(file) ? file.name : file;\n\tconst type: string = Type.isFile(file) ? file.type : mimeType;\n\tconst extension: string = getFileExtension(fileName).toLowerCase();\n\n\treturn imageExtensions.has(extension) && (type === null || /^image\\/[\\d.a-z-]+$/i.test(type));\n};\n\nexport default isResizableImage;\n","import { Loc, Type } from 'main.core';\n\nconst formatFileSize = (size: number, base: number = 1024): string => {\n\tlet i = 0;\n\tconst units = getUnits();\n\tlet currentSize = size;\n\twhile (currentSize >= base && units[i + 1])\n\t{\n\t\tcurrentSize /= base;\n\t\ti++;\n\t}\n\n\treturn (Type.isInteger(currentSize) ? currentSize : currentSize.toFixed(1)) + units[i];\n};\n\nlet fileSizeUnits = null;\nconst getUnits = () => {\n\tif (fileSizeUnits !== null)\n\t{\n\t\treturn fileSizeUnits;\n\t}\n\n\tconst units = Loc.getMessage('UPLOADER_FILE_SIZE_POSTFIXES').split(/\\|/);\n\tfileSizeUnits = Type.isArrayFilled(units) ? units : ['B', 'kB', 'MB', 'GB', 'TB'];\n\n\treturn fileSizeUnits;\n};\n\nexport default formatFileSize;\n","// eslint-disable-next-line max-classes-per-file\nimport { Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\n\nimport { FileStatus } from './enums/file-status';\nimport { FileOrigin } from './enums/file-origin';\nimport { FileEvent } from './enums/file-event';\nimport isSupportedVideo from './helpers/is-supported-video';\n\nimport UploaderError from './uploader-error';\nimport AbstractUploadController from './backend/abstract-upload-controller';\nimport AbstractLoadController from './backend/abstract-load-controller';\nimport AbstractRemoveController from './backend/abstract-remove-controller';\n\nimport createUniqueId from './helpers/create-unique-id';\nimport createFileFromBlob from './helpers/create-file-from-blob';\nimport isDataUri from './helpers/is-data-uri';\nimport createBlobFromDataUri from './helpers/create-blob-from-data-uri';\nimport isResizableImage from './helpers/is-resizable-image';\nimport formatFileSize from './helpers/format-file-size';\n\nimport type { UploaderFileOptions } from './types/uploader-file-options';\nimport type { UploaderFileInfo } from './types/uploader-file-info';\nimport type { RemoveFileOptions } from './types/remove-file-options';\n\nexport default class UploaderFile extends EventEmitter\n{\n\t#id: string = null;\n\t#file: File = null;\n\t#serverFileId: number | string = null;\n\n\t#name: string = null;\n\t#size: number = 0;\n\t#type: string = '';\n\t#width: ?number = null;\n\t#height: ?number = null;\n\t#animated: boolean = false;\n\t#treatImageAsFile: boolean = false;\n\n\t#clientPreview: ?Blob = null;\n\t#clientPreviewUrl: ?string = null;\n\t#clientPreviewWidth: ?number = null;\n\t#clientPreviewHeight: ?number = null;\n\n\t#serverPreviewUrl: ?string = null;\n\t#serverPreviewWidth: ?number = null;\n\t#serverPreviewHeight: ?number = null;\n\n\t#downloadUrl: ?string = null;\n\n\t#status: FileStatus = FileStatus.INIT;\n\t#origin: FileOrigin = FileOrigin.CLIENT;\n\t#errors: UploaderError[] = [];\n\t#progress: number = 0;\n\t#customData: Object<string, any> = Object.create(null);\n\t#viewerAttrs: Object<string, string> | null = null;\n\n\t#uploadController: AbstractUploadController = null;\n\t#loadController: AbstractLoadController = null;\n\t#removeController: AbstractRemoveController = null;\n\t#forceServerLoad: boolean = false;\n\n\t#uploadCallbacks: CallbackCollection = new CallbackCollection(this);\n\n\tconstructor(source: File | Blob | string | number | UploaderFileOptions, fileOptions: UploaderFileOptions = {})\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.UI.Uploader.File');\n\n\t\tconst options: UploaderFileOptions = Type.isPlainObject(fileOptions) ? fileOptions : {};\n\n\t\tif (Type.isFile(source))\n\t\t{\n\t\t\tthis.#file = source;\n\t\t\tthis.update(options);\n\t\t}\n\t\telse if (Type.isBlob(source))\n\t\t{\n\t\t\tthis.#file = createFileFromBlob(source, options.name || source.name);\n\t\t\tthis.update(options);\n\t\t}\n\t\telse if (isDataUri(source))\n\t\t{\n\t\t\tconst blob: Blob = createBlobFromDataUri(source);\n\t\t\tthis.#file = createFileFromBlob(blob, options.name);\n\t\t\tthis.update(options);\n\t\t}\n\t\telse if (Type.isNumber(source) || Type.isStringFilled(source))\n\t\t{\n\t\t\tthis.#origin = FileOrigin.SERVER;\n\t\t\tthis.#serverFileId = source;\n\t\t\tthis.update(options);\n\t\t}\n\t\telse if (\n\t\t\tType.isPlainObject(source)\n\t\t\t&& (Type.isNumber(source.serverFileId) || Type.isStringFilled(source.serverFileId))\n\t\t)\n\t\t{\n\t\t\tthis.#origin = FileOrigin.SERVER;\n\t\t\tthis.update(source);\n\t\t}\n\n\t\tthis.#id = Type.isStringFilled(options.id) ? options.id : createUniqueId();\n\t\tif (this.#origin === FileOrigin.SERVER)\n\t\t{\n\t\t\tthis.#forceServerLoad = options.preload === true || (Type.isPlainObject(source) && source.preload === true);\n\t\t}\n\n\t\tthis.subscribeFromOptions({\n\t\t\t[FileEvent.ADD]: (): void => {\n\t\t\t\tthis.#setStatus(FileStatus.ADDED);\n\t\t\t},\n\t\t});\n\n\t\tthis.subscribeFromOptions(options.events);\n\t}\n\n\tload(): void\n\t{\n\t\tif (!this.canLoad())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setStatus(FileStatus.LOADING);\n\t\tthis.emit(FileEvent.LOAD_START);\n\n\t\tthis.#loadController.load(this);\n\t}\n\n\tshouldForceServerLoad(): boolean\n\t{\n\t\treturn this.#forceServerLoad;\n\t}\n\n\tupload(callbacks: { onComplete: Function, onError: Function } = {}): void\n\t{\n\t\tthis.#uploadCallbacks.subscribe(callbacks);\n\t\tif (this.isComplete() && this.isUploadable())\n\t\t{\n\t\t\tthis.#uploadCallbacks.emit('onComplete');\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.isUploadFailed())\n\t\t{\n\t\t\tthis.#uploadCallbacks.emit('onError', { error: this.getError() });\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.canUpload())\n\t\t{\n\t\t\tthis.#uploadCallbacks.emit('onError', { error: new UploaderError('FILE_UPLOAD_NOT_ALLOWED') });\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst event: BaseEvent<{ file: UploaderFile }> = new BaseEvent({ data: { file: this } });\n\t\tthis.emit(FileEvent.BEFORE_UPLOAD, event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setStatus(FileStatus.PREPARING);\n\n\t\tconst prepareEvent: BaseEvent = new BaseEvent({ data: { file: this } });\n\t\tthis.emitAsync(FileEvent.PREPARE_FILE_ASYNC, prepareEvent)\n\t\t\t.then((): void => {\n\t\t\t\tthis.#setStatus(FileStatus.UPLOADING);\n\t\t\t\tthis.emit(FileEvent.UPLOAD_START);\n\t\t\t\tthis.#uploadController.upload(this);\n\t\t\t})\n\t\t\t.catch((prepareError) => {\n\t\t\t\tconst error = this.addError(prepareError);\n\t\t\t\tthis.#setStatus(FileStatus.UPLOAD_FAILED);\n\t\t\t\tthis.emit(FileEvent.UPLOAD_ERROR, { error });\n\t\t\t})\n\t\t;\n\t}\n\n\tremove(options?: RemoveFileOptions): void\n\t{\n\t\tif (this.getStatus() === FileStatus.INIT)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setStatus(FileStatus.INIT);\n\t\tthis.emit(FileEvent.REMOVE_COMPLETE);\n\n\t\tthis.abort();\n\n\t\t// this.#setStatus(FileStatus.REMOVING);\n\t\t// this.#removeController.remove(this);\n\n\t\tconst removeFromServer: boolean = !options || options.removeFromServer !== false;\n\t\tif (removeFromServer && this.#removeController !== null && this.getOrigin() === FileOrigin.CLIENT)\n\t\t{\n\t\t\tthis.#removeController.remove(this);\n\t\t}\n\n\t\tthis.#uploadController = null;\n\t\tthis.#loadController = null;\n\t\tthis.#removeController = null;\n\t}\n\n\t// stop(): void\n\t// {\n\t// \tif (this.isUploading())\n\t// \t{\n\t// \t\tthis.abort();\n\t// \t\tthis.setStatus(FileStatus.PENDING);\n\t// \t}\n\t// }\n\t//\n\t// resume(): void\n\t// {\n\t//\n\t// }\n\t// retry(): void\n\t// {\n\t// \t// TODO\n\t// }\n\n\tabort(): void\n\t{\n\t\tif (this.isLoading())\n\t\t{\n\t\t\tthis.#setStatus(FileStatus.LOAD_FAILED);\n\n\t\t\tconst error: UploaderError = new UploaderError('FILE_LOAD_ABORTED');\n\t\t\tthis.emit(FileEvent.LOAD_ERROR, { error });\n\t\t}\n\t\telse if (this.isUploading())\n\t\t{\n\t\t\tthis.#setStatus(FileStatus.UPLOAD_FAILED);\n\n\t\t\tconst error: UploaderError = new UploaderError('FILE_UPLOAD_ABORTED');\n\t\t\tthis.emit('onUploadError', { error });\n\t\t\tthis.#uploadCallbacks.emit('onError', { error });\n\t\t}\n\n\t\tif (this.#loadController)\n\t\t{\n\t\t\tthis.#loadController.abort();\n\t\t}\n\n\t\tif (this.#uploadController)\n\t\t{\n\t\t\tthis.#uploadController.abort();\n\t\t}\n\t}\n\n\tgetUploadController(): ?AbstractUploadController\n\t{\n\t\treturn this.#uploadController;\n\t}\n\n\tsetUploadController(controller: ?AbstractUploadController): void\n\t{\n\t\tif (!(controller instanceof AbstractUploadController) && !Type.isNull(controller))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.#uploadController !== controller;\n\t\tthis.#uploadController = controller;\n\n\t\tif (this.#uploadController && changed)\n\t\t{\n\t\t\tthis.#uploadController.subscribeOnce('onError', (event: BaseEvent): void => {\n\t\t\t\tconst error: UploaderError = this.addError(event.getData().error);\n\t\t\t\tthis.#setStatus(FileStatus.UPLOAD_FAILED);\n\t\t\t\tthis.emit(FileEvent.UPLOAD_ERROR, { error });\n\t\t\t\tthis.#uploadCallbacks.emit('onError', { error });\n\t\t\t});\n\n\t\t\tthis.#uploadController.subscribe('onProgress', (event: BaseEvent): void => {\n\t\t\t\tconst { progress } = event.getData();\n\t\t\t\tthis.setProgress(progress);\n\t\t\t\tthis.emit(FileEvent.UPLOAD_PROGRESS, { progress });\n\t\t\t});\n\n\t\t\tthis.#uploadController.subscribeOnce('onUpload', (event: BaseEvent): void => {\n\t\t\t\tthis.#setStatus(FileStatus.COMPLETE);\n\t\t\t\tthis.update(event.getData().fileInfo);\n\t\t\t\tthis.emit(FileEvent.UPLOAD_COMPLETE);\n\n\t\t\t\tthis.#uploadCallbacks.emit('onComplete');\n\t\t\t});\n\t\t}\n\n\t\tif (changed)\n\t\t{\n\t\t\tthis.emit(FileEvent.UPLOAD_CONTROLLER_INIT, { controller });\n\t\t}\n\t}\n\n\tsetLoadController(controller: AbstractLoadController): void\n\t{\n\t\tif (!(controller instanceof AbstractLoadController))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.#loadController !== controller;\n\t\tthis.#loadController = controller;\n\n\t\tif (this.#loadController && changed)\n\t\t{\n\t\t\tthis.#loadController.subscribeOnce('onError', (event: BaseEvent): void => {\n\t\t\t\tconst error: UploaderError = this.addError(event.getData().error);\n\t\t\t\tthis.#setStatus(FileStatus.LOAD_FAILED);\n\t\t\t\tthis.emit(FileEvent.LOAD_ERROR, { error });\n\t\t\t});\n\n\t\t\tthis.#loadController.subscribe('onProgress', (event: BaseEvent): void => {\n\t\t\t\tconst { progress } = event.getData();\n\t\t\t\tthis.emit(FileEvent.LOAD_PROGRESS, { progress });\n\t\t\t});\n\n\t\t\tthis.#loadController.subscribeOnce('onLoad', (event: BaseEvent): void => {\n\t\t\t\tif (this.getOrigin() === FileOrigin.CLIENT)\n\t\t\t\t{\n\t\t\t\t\tconst validationEvent: BaseEvent = new BaseEvent({ data: { file: this } });\n\t\t\t\t\tthis.emitAsync(FileEvent.VALIDATE_FILE_ASYNC, validationEvent)\n\t\t\t\t\t\t.then((): void => {\n\t\t\t\t\t\t\tif (this.isUploadable())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.#setStatus(FileStatus.PENDING);\n\t\t\t\t\t\t\t\tthis.emit(FileEvent.LOAD_COMPLETE);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconst preparationEvent: BaseEvent = new BaseEvent({ data: { file: this } });\n\t\t\t\t\t\t\t\tthis.emitAsync(FileEvent.PREPARE_FILE_ASYNC, preparationEvent)\n\t\t\t\t\t\t\t\t\t.then((): void => {\n\t\t\t\t\t\t\t\t\t\tthis.#setStatus(FileStatus.COMPLETE);\n\t\t\t\t\t\t\t\t\t\tthis.emit(FileEvent.LOAD_COMPLETE);\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.catch((preparationError) => {\n\t\t\t\t\t\t\t\t\t\tconst error = this.addError(preparationError);\n\t\t\t\t\t\t\t\t\t\tthis.#setStatus(FileStatus.LOAD_FAILED);\n\t\t\t\t\t\t\t\t\t\tthis.emit(FileEvent.LOAD_ERROR, { error });\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((validationError) => {\n\t\t\t\t\t\t\tconst error = this.addError(validationError);\n\t\t\t\t\t\t\tthis.#setStatus(FileStatus.LOAD_FAILED);\n\t\t\t\t\t\t\tthis.emit(FileEvent.LOAD_ERROR, { error });\n\t\t\t\t\t\t})\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.update(event.getData().fileInfo);\n\n\t\t\t\t\tif (this.isUploadable())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setStatus(FileStatus.PENDING);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#setStatus(FileStatus.COMPLETE);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.emit(FileEvent.LOAD_COMPLETE);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (changed)\n\t\t{\n\t\t\tthis.emit(FileEvent.LOAD_CONTROLLER_INIT, { controller });\n\t\t}\n\t}\n\n\tsetRemoveController(controller: ?AbstractRemoveController): void\n\t{\n\t\tif (!(controller instanceof AbstractRemoveController) && !Type.isNull(controller))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst changed = this.#removeController !== controller;\n\t\tthis.#removeController = controller;\n\n\t\tif (this.#removeController && changed)\n\t\t{\n\t\t\tthis.#removeController.subscribeOnce('onError', (event: BaseEvent) => {\n\t\t\t\t// const error = this.addError(event.getData().error);\n\t\t\t\t// this.emit(FileEvent.REMOVE_ERROR, { error });\n\t\t\t});\n\n\t\t\tthis.#removeController.subscribeOnce('onRemove', (event: BaseEvent) => {\n\t\t\t\t// this.#setStatus(FileStatus.INIT);\n\t\t\t\t// this.emit(FileEvent.REMOVE_COMPLETE);\n\t\t\t});\n\t\t}\n\n\t\tif (changed)\n\t\t{\n\t\t\tthis.emit(FileEvent.REMOVE_CONTROLLER_INIT, { controller });\n\t\t}\n\t}\n\n\tisReadyToUpload(): boolean\n\t{\n\t\treturn this.getStatus() === FileStatus.PENDING;\n\t}\n\n\tisUploadable(): boolean\n\t{\n\t\treturn this.#uploadController !== null;\n\t}\n\n\tisLoadable(): boolean\n\t{\n\t\treturn this.#loadController !== null;\n\t}\n\n\tisRemoveable(): boolean\n\t{\n\t\treturn this.#removeController !== null;\n\t}\n\n\tcanUpload(): boolean\n\t{\n\t\treturn this.isReadyToUpload() && this.isUploadable();\n\t}\n\n\tcanLoad(): boolean\n\t{\n\t\treturn this.getStatus() === FileStatus.ADDED && this.isLoadable();\n\t}\n\n\tisUploading(): boolean\n\t{\n\t\treturn this.getStatus() === FileStatus.UPLOADING;\n\t}\n\n\tisPreparing(): boolean\n\t{\n\t\treturn this.getStatus() === FileStatus.PREPARING;\n\t}\n\n\tisLoading(): boolean\n\t{\n\t\treturn this.getStatus() === FileStatus.LOADING;\n\t}\n\n\tisComplete(): boolean\n\t{\n\t\treturn this.getStatus() === FileStatus.COMPLETE;\n\t}\n\n\tisFailed(): boolean\n\t{\n\t\treturn this.getStatus() === FileStatus.LOAD_FAILED || this.getStatus() === FileStatus.UPLOAD_FAILED;\n\t}\n\n\tisLoadFailed(): boolean\n\t{\n\t\treturn this.getStatus() === FileStatus.LOAD_FAILED;\n\t}\n\n\tisUploadFailed(): boolean\n\t{\n\t\treturn this.getStatus() === FileStatus.UPLOAD_FAILED;\n\t}\n\n\tisInProgress(): boolean\n\t{\n\t\treturn [\n\t\t\tFileStatus.LOADING,\n\t\t\tFileStatus.PENDING,\n\t\t\tFileStatus.PREPARING,\n\t\t\tFileStatus.UPLOADING,\n\t\t].includes(this.getStatus());\n\t}\n\n\tgetBinary(): ?File\n\t{\n\t\treturn this.#file;\n\t}\n\n\tsetFile(file: File | Blob): void\n\t{\n\t\tif (Type.isFile(file))\n\t\t{\n\t\t\tthis.#file = file;\n\t\t}\n\t\telse if (Type.isBlob(file))\n\t\t{\n\t\t\tthis.#file = createFileFromBlob(file, this.getName());\n\t\t}\n\t}\n\n\tupdate(options: UploaderFileOptions): void\n\t{\n\t\tif (Type.isPlainObject(options))\n\t\t{\n\t\t\tthis.setName(options.name);\n\t\t\tthis.setType(options.type);\n\t\t\tthis.setSize(options.size);\n\n\t\t\tthis.setServerFileId(options.serverFileId);\n\t\t\tthis.setWidth(options.width);\n\t\t\tthis.setHeight(options.height);\n\t\t\tthis.setTreatImageAsFile(options.treatImageAsFile);\n\n\t\t\tthis.setClientPreview(options.clientPreview, options.clientPreviewWidth, options.clientPreviewHeight);\n\t\t\tthis.setServerPreview(options.serverPreviewUrl, options.serverPreviewWidth, options.serverPreviewHeight);\n\n\t\t\tthis.setDownloadUrl(options.downloadUrl);\n\t\t\tthis.setCustomData(options.customData);\n\t\t\tthis.setViewerAttrs(options.viewerAttrs);\n\n\t\t\tthis.setLoadController(options.loadController);\n\t\t\tthis.setUploadController(options.uploadController);\n\t\t\tthis.setRemoveController(options.removeController);\n\t\t}\n\t}\n\n\tgetName(): string\n\t{\n\t\treturn this.#name === null ? (this.getBinary() ? this.getBinary().name : '') : this.#name;\n\t}\n\n\tsetName(name: string | null): void\n\t{\n\t\tif (Type.isStringFilled(name) || Type.isNull(name))\n\t\t{\n\t\t\tthis.#name = name;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'name', value: name });\n\t\t}\n\t}\n\n\tgetExtension(): string\n\t{\n\t\tconst name: string = this.getName();\n\t\tconst position: number = name.lastIndexOf('.');\n\n\t\treturn position >= 0 ? name.slice(Math.max(0, position + 1)).toLowerCase() : '';\n\t}\n\n\tgetType(): string\n\t{\n\t\treturn this.getBinary() ? this.getBinary().type : this.#type;\n\t}\n\n\tsetType(type: string): string\n\t{\n\t\tif (Type.isStringFilled(type))\n\t\t{\n\t\t\tthis.#type = type;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'type', value: type });\n\t\t}\n\t}\n\n\tgetSize(): number\n\t{\n\t\treturn this.getBinary() ? this.getBinary().size : this.#size;\n\t}\n\n\tgetSizeFormatted(): string\n\t{\n\t\treturn formatFileSize(this.getSize());\n\t}\n\n\tsetSize(size: number): void\n\t{\n\t\tif (Type.isNumber(size) && size >= 0)\n\t\t{\n\t\t\tthis.#size = size;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'size', value: size });\n\t\t}\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.#id;\n\t}\n\n\tgetServerFileId(): number | string | null\n\t{\n\t\treturn this.#serverFileId;\n\t}\n\n\t/**\n\t * @deprecated\n\t * use getServerFileId\n\t */\n\tgetServerId(): number | string | null\n\t{\n\t\treturn this.getServerFileId();\n\t}\n\n\tsetServerFileId(id: number | string): void\n\t{\n\t\tif (Type.isNumber(id) || Type.isStringFilled(id))\n\t\t{\n\t\t\tthis.#serverFileId = id;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'serverFileId', value: id });\n\t\t}\n\t}\n\n\tgetStatus(): FileStatus\n\t{\n\t\treturn this.#status;\n\t}\n\n\t#setStatus(status: FileStatus): void\n\t{\n\t\tthis.#status = status;\n\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'status', value: status });\n\t\tthis.emit(FileEvent.STATUS_CHANGE);\n\t}\n\n\tgetOrigin(): FileOrigin\n\t{\n\t\treturn this.#origin;\n\t}\n\n\tgetDownloadUrl(): ?string\n\t{\n\t\treturn this.#downloadUrl;\n\t}\n\n\tsetDownloadUrl(url: string): void\n\t{\n\t\tif (Type.isStringFilled(url))\n\t\t{\n\t\t\tthis.#downloadUrl = url;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'downloadUrl', value: url });\n\t\t}\n\t}\n\n\tgetWidth(): ?number\n\t{\n\t\treturn this.#width;\n\t}\n\n\tsetWidth(width: number)\n\t{\n\t\tif (Type.isNumber(width))\n\t\t{\n\t\t\tthis.#width = width;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'width', value: width });\n\t\t}\n\t}\n\n\tgetHeight(): ?number\n\t{\n\t\treturn this.#height;\n\t}\n\n\tsetHeight(height: ?number)\n\t{\n\t\tif (Type.isNumber(height))\n\t\t{\n\t\t\tthis.#height = height;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'height', value: height });\n\t\t}\n\t}\n\n\tisAnimated(): boolean\n\t{\n\t\treturn this.#animated;\n\t}\n\n\tsetAnimated(flag: boolean): void\n\t{\n\t\tif (Type.isBoolean(flag))\n\t\t{\n\t\t\tthis.#animated = flag;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'animated', value: flag });\n\t\t}\n\t}\n\n\tsetTreatImageAsFile(flag: boolean): void\n\t{\n\t\tif (Type.isBoolean(flag))\n\t\t{\n\t\t\tthis.#treatImageAsFile = flag;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'treatImageAsFile', value: flag });\n\t\t}\n\t}\n\n\tshouldTreatImageAsFile(): boolean\n\t{\n\t\treturn this.#treatImageAsFile;\n\t}\n\n\tgetPreviewUrl(): ?string\n\t{\n\t\treturn this.getClientPreview() ? this.getClientPreviewUrl() : this.getServerPreviewUrl();\n\t}\n\n\tgetPreviewWidth(): ?number\n\t{\n\t\treturn this.getClientPreview() ? this.getClientPreviewWidth() : this.getServerPreviewWidth();\n\t}\n\n\tgetPreviewHeight(): ?number\n\t{\n\t\treturn this.getClientPreview() ? this.getClientPreviewHeight() : this.getServerPreviewHeight();\n\t}\n\n\tgetClientPreview(): ?Blob\n\t{\n\t\treturn this.#clientPreview;\n\t}\n\n\tsetClientPreview(file: ?Blob, width: number = null, height: number = null): void\n\t{\n\t\tif (Type.isBlob(file) || Type.isNull(file))\n\t\t{\n\t\t\tthis.revokeClientPreviewUrl();\n\n\t\t\tconst url = Type.isNull(file) ? null : URL.createObjectURL(file);\n\t\t\tthis.#clientPreview = file;\n\t\t\tthis.#clientPreviewUrl = url;\n\t\t\tthis.#clientPreviewWidth = width;\n\t\t\tthis.#clientPreviewHeight = height;\n\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'clientPreviewUrl', value: url });\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'clientPreviewWidth', value: width });\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'clientPreviewHeight', value: height });\n\t\t}\n\t}\n\n\tgetClientPreviewUrl(): ?string\n\t{\n\t\treturn this.#clientPreviewUrl;\n\t}\n\n\trevokeClientPreviewUrl(): void\n\t{\n\t\tif (this.#clientPreviewUrl !== null)\n\t\t{\n\t\t\tURL.revokeObjectURL(this.#clientPreviewUrl);\n\n\t\t\tthis.#clientPreviewUrl = null;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'clientPreviewUrl', value: null });\n\t\t}\n\t}\n\n\tgetClientPreviewWidth(): ?number\n\t{\n\t\treturn this.#clientPreviewWidth;\n\t}\n\n\tgetClientPreviewHeight(): ?number\n\t{\n\t\treturn this.#clientPreviewHeight;\n\t}\n\n\tgetServerPreviewUrl(): ?string\n\t{\n\t\treturn this.#serverPreviewUrl;\n\t}\n\n\tsetServerPreview(url: ?string, width: number = null, height: number = null): ?string\n\t{\n\t\tif (Type.isStringFilled(url) || Type.isNull(url))\n\t\t{\n\t\t\tthis.#serverPreviewUrl = url;\n\t\t\tthis.#serverPreviewWidth = width;\n\t\t\tthis.#serverPreviewHeight = height;\n\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'serverPreviewUrl', value: url });\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'serverPreviewWidth', value: width });\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'serverPreviewHeight', value: height });\n\t\t}\n\t}\n\n\tgetServerPreviewWidth(): ?number\n\t{\n\t\treturn this.#serverPreviewWidth;\n\t}\n\n\tgetServerPreviewHeight(): ?number\n\t{\n\t\treturn this.#serverPreviewHeight;\n\t}\n\n\tisImage(): boolean\n\t{\n\t\tif (this.shouldTreatImageAsFile())\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// return isResizableImage(this.getName(), this.getType());\n\t\treturn this.getWidth() > 0 && this.getHeight() > 0 && isResizableImage(this.getName(), this.getType());\n\t}\n\n\tisVideo(): boolean\n\t{\n\t\treturn isSupportedVideo(this.getName());\n\t}\n\n\tgetProgress(): number\n\t{\n\t\treturn this.#progress;\n\t}\n\n\tsetProgress(progress: ?number): void\n\t{\n\t\tif (Type.isNumber(progress))\n\t\t{\n\t\t\tthis.#progress = progress;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'progress', value: progress });\n\t\t}\n\t}\n\n\taddError(error: Error | UploaderError): UploaderError\n\t{\n\t\tconst uploaderError: UploaderError = error instanceof Error ? UploaderError.createFromError(error) : error;\n\n\t\tthis.#errors.push(uploaderError);\n\t\tthis.emit(FileEvent.STATE_CHANGE);\n\n\t\treturn uploaderError;\n\t}\n\n\tgetError(): ?UploaderError\n\t{\n\t\treturn this.#errors[0] || null;\n\t}\n\n\tgetErrors(): UploaderError[]\n\t{\n\t\treturn this.#errors;\n\t}\n\n\tgetState(): UploaderFileInfo\n\t{\n\t\treturn JSON.parse(JSON.stringify(this));\n\t}\n\n\tsetCustomData(property: ?string | { [key: string]: any }, value?: any): void\n\t{\n\t\tif (Type.isNull(property))\n\t\t{\n\t\t\tthis.#customData = Object.create(null);\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'customData', value: null });\n\t\t}\n\t\telse if (Type.isPlainObject(property))\n\t\t{\n\t\t\tObject.entries(property).forEach((item) => {\n\t\t\t\tconst [currentKey, currentValue] = item;\n\t\t\t\tthis.setCustomData(currentKey, currentValue);\n\t\t\t});\n\t\t}\n\t\telse if (Type.isString(property))\n\t\t{\n\t\t\tif (Type.isNull(value))\n\t\t\t{\n\t\t\t\tdelete this.#customData[property];\n\t\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'customData', customProperty: property, value: null });\n\t\t\t}\n\t\t\telse if (!Type.isUndefined(value))\n\t\t\t{\n\t\t\t\tthis.#customData[property] = value;\n\t\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'customData', customProperty: property, value });\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCustomData(property?: string): any\n\t{\n\t\tif (Type.isUndefined(property))\n\t\t{\n\t\t\treturn this.#customData;\n\t\t}\n\n\t\tif (Type.isStringFilled(property))\n\t\t{\n\t\t\treturn this.#customData[property];\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tsetViewerAttrs(viewerAttrs: Object | null): void\n\t{\n\t\tif (Type.isNull(viewerAttrs) || Type.isPlainObject(viewerAttrs))\n\t\t{\n\t\t\tthis.#viewerAttrs = viewerAttrs;\n\t\t\tthis.emit(FileEvent.STATE_CHANGE, { property: 'viewerAttrs', value: viewerAttrs });\n\t\t}\n\t}\n\n\tgetViewerAttrs(): Object<string, string> | null\n\t{\n\t\treturn this.#viewerAttrs;\n\t}\n\n\ttoJSON(): UploaderFileInfo\n\t{\n\t\treturn {\n\t\t\tid: this.getId(),\n\t\t\tserverFileId: this.getServerFileId(),\n\t\t\tserverId: this.getServerFileId(), // compatibility\n\t\t\tstatus: this.getStatus(),\n\t\t\tname: this.getName(),\n\t\t\tsize: this.getSize(),\n\t\t\tsizeFormatted: this.getSizeFormatted(),\n\t\t\ttype: this.getType(),\n\t\t\textension: this.getExtension(),\n\t\t\torigin: this.getOrigin(),\n\t\t\tisImage: this.isImage(),\n\t\t\tisVideo: this.isVideo(),\n\t\t\tfailed: this.isFailed(),\n\t\t\twidth: this.getWidth(),\n\t\t\theight: this.getHeight(),\n\t\t\tanimated: this.isAnimated(),\n\t\t\tprogress: this.getProgress(),\n\t\t\terror: this.getError(),\n\t\t\terrors: this.getErrors(),\n\t\t\tpreviewUrl: this.getPreviewUrl(),\n\t\t\tpreviewWidth: this.getPreviewWidth(),\n\t\t\tpreviewHeight: this.getPreviewHeight(),\n\t\t\tclientPreviewUrl: this.getClientPreviewUrl(),\n\t\t\tclientPreviewWidth: this.getClientPreviewWidth(),\n\t\t\tclientPreviewHeight: this.getClientPreviewHeight(),\n\t\t\tserverPreviewUrl: this.getServerPreviewUrl(),\n\t\t\tserverPreviewWidth: this.getServerPreviewWidth(),\n\t\t\tserverPreviewHeight: this.getServerPreviewHeight(),\n\t\t\tdownloadUrl: this.getDownloadUrl(),\n\t\t\tcustomData: this.getCustomData(),\n\t\t\tviewerAttrs: this.getViewerAttrs(),\n\t\t};\n\t}\n}\n\nclass CallbackCollection\n{\n\t#emitter: EventEmitter = null;\n\tconstructor(file: UploaderFile)\n\t{\n\t\tthis.#emitter = new EventEmitter(file, 'BX.UI.Uploader.File.UploadCallbacks');\n\t}\n\n\tsubscribe(callbacks: { onComplete: Function, onError: Function } = {}): void\n\t{\n\t\tconst handlers = Type.isPlainObject(callbacks) ? callbacks : {};\n\t\tif (Type.isFunction(handlers.onComplete))\n\t\t{\n\t\t\tthis.getEmitter().subscribeOnce('onComplete', handlers.onComplete);\n\t\t}\n\n\t\tif (Type.isFunction(handlers.onError))\n\t\t{\n\t\t\tthis.getEmitter().subscribeOnce('onError', handlers.onError);\n\t\t}\n\t}\n\n\temit(eventName: string, event: BaseEvent | {[key: string]: any}): void\n\t{\n\t\tif (this.#emitter)\n\t\t{\n\t\t\tthis.#emitter.emit(eventName, event);\n\t\t\tthis.#emitter.unsubscribeAll();\n\t\t}\n\t}\n\n\tgetEmitter(): EventEmitter\n\t{\n\t\tif (Type.isNull(this.#emitter))\n\t\t{\n\t\t\tthis.#emitter = new EventEmitter(this, 'BX.UI.Uploader.File.UploadCallbacks');\n\t\t}\n\n\t\treturn this.#emitter;\n\t}\n}\n","import { Type } from 'main.core';\n\nexport default class Chunk\n{\n\t#data: Blob = null;\n\t#offset: number = 0;\n\t#retries: number[] = [];\n\n\tconstructor(data, offset)\n\t{\n\t\tthis.#data = data;\n\t\tthis.#offset = offset;\n\t}\n\n\tgetNextRetryDelay(): ?number\n\t{\n\t\tif (this.#retries.length === 0)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn this.#retries.shift();\n\t}\n\n\tsetRetries(retries: number[]): void\n\t{\n\t\tif (Type.isArray(retries))\n\t\t{\n\t\t\tthis.#retries = retries;\n\t\t}\n\t}\n\n\tgetData(): Blob\n\t{\n\t\treturn this.#data;\n\t}\n\n\tgetOffset(): number\n\t{\n\t\treturn this.#offset;\n\t}\n\n\tgetSize(): number\n\t{\n\t\treturn this.getData().size;\n\t}\n}\n","import { ajax as Ajax, Type, type AjaxResponse, type JsonObject } from 'main.core';\n\nimport Server from './server';\nimport Chunk from './chunk';\nimport AbstractUploadController from './abstract-upload-controller';\nimport UploaderError from '../uploader-error';\n\nimport type UploaderFile from '../uploader-file';\n\nexport default class UploadController extends AbstractUploadController\n{\n\t#file: UploaderFile = null;\n\t#chunkOffset: ?number = null;\n\t#chunkTimeout: ?number = null;\n\t#token: string = null;\n\t#xhr: XMLHttpRequest = null;\n\t#aborted: boolean = false;\n\n\tconstructor(server: Server, options: { [key: string]: any } = {})\n\t{\n\t\tsuper(server, options);\n\t}\n\n\tupload(file: UploaderFile): void\n\t{\n\t\tif (!Type.isFile(file.getBinary()))\n\t\t{\n\t\t\tthis.emit('onError', { error: new UploaderError('WRONG_FILE_SOURCE') });\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#chunkOffset !== null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#file = file;\n\n\t\tconst nextChunk: ?Chunk = this.#getNextChunk();\n\t\tif (nextChunk)\n\t\t{\n\t\t\tthis.#uploadChunk(nextChunk);\n\t\t}\n\t}\n\n\tabort(): void\n\t{\n\t\tif (this.#xhr)\n\t\t{\n\t\t\tthis.#aborted = true;\n\t\t\tthis.#xhr.abort();\n\t\t\tthis.#xhr = null;\n\t\t}\n\n\t\tclearTimeout(this.#chunkTimeout);\n\t}\n\n\t#uploadChunk(chunk: Chunk): void\n\t{\n\t\tconst totalSize: number = this.getFile().getSize();\n\t\tconst isOnlyOneChunk: boolean = chunk.getOffset() === 0 && totalSize === chunk.getSize();\n\n\t\tlet fileName: string = this.getFile().getName();\n\t\tif (fileName.normalize)\n\t\t{\n\t\t\tfileName = fileName.normalize();\n\t\t}\n\n\t\tconst type: string = Type.isStringFilled(this.getFile().getType())\n\t\t\t? this.getFile().getType()\n\t\t\t: 'application/octet-stream'\n\t\t;\n\n\t\tconst headers = [\n\t\t\t{ name: 'Content-Type', value: type },\n\t\t\t{ name: 'X-Upload-Content-Name', value: encodeURIComponent(fileName) },\n\t\t];\n\n\t\tif (!isOnlyOneChunk)\n\t\t{\n\t\t\tconst rangeStart: number = chunk.getOffset();\n\t\t\tconst rangeEnd: number = chunk.getOffset() + chunk.getSize() - 1;\n\t\t\tconst rangeHeader = `bytes ${rangeStart}-${rangeEnd}/${totalSize}`;\n\n\t\t\theaders.push({ name: 'Content-Range', value: rangeHeader });\n\t\t}\n\n\t\tconst controllerOptions = this.getServer().getControllerOptions();\n\t\tAjax.runAction('ui.fileuploader.upload', {\n\t\t\theaders,\n\t\t\tdata: chunk.getData(),\n\t\t\tpreparePost: false,\n\t\t\tgetParameters: {\n\t\t\t\tcontroller: this.getServer().getController(),\n\t\t\t\tcontrollerOptions: controllerOptions ? JSON.stringify(controllerOptions) : null,\n\t\t\t\ttoken: this.getToken() || '',\n\t\t\t},\n\t\t\tonrequeststart: (xhr): void => {\n\t\t\t\tthis.#xhr = xhr;\n\t\t\t\tthis.#aborted = false;\n\t\t\t},\n\t\t\tonprogressupload: (event: ProgressEvent): void => {\n\t\t\t\tif (event.lengthComputable)\n\t\t\t\t{\n\t\t\t\t\tconst size: number = this.getFile().getSize();\n\t\t\t\t\tconst uploadedBytes: number = Math.min(size, chunk.getOffset() + event.loaded);\n\t\t\t\t\tconst progress: number = size > 0 ? Math.floor(uploadedBytes / size * 100) : 100;\n\t\t\t\t\tthis.emit('onProgress', { progress });\n\t\t\t\t}\n\t\t\t},\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tif (response.data.token)\n\t\t\t\t{\n\t\t\t\t\tthis.setToken(response.data.token);\n\n\t\t\t\t\tif (this.getFile().getServerFileId() === null)\n\t\t\t\t\t{\n\t\t\t\t\t\t// Now we can remove a temp file on the backend\n\t\t\t\t\t\tthis.getFile().setServerFileId(response.data.token);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst size: number = this.getFile().getSize();\n\t\t\t\t\tconst progress: number = size > 0 ? Math.floor((chunk.getOffset() + chunk.getSize()) / size * 100) : 100;\n\t\t\t\t\tthis.emit('onProgress', { progress });\n\n\t\t\t\t\tconst nextChunk: ?Chunk = this.#getNextChunk();\n\t\t\t\t\tif (nextChunk)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#uploadChunk(nextChunk);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.emit('onProgress', { progress: 100 });\n\t\t\t\t\t\tthis.emit('onUpload', { fileInfo: response.data.file });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.emit('onError', { error: new UploaderError('SERVER_ERROR') });\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((response: AjaxResponse<JsonObject>) => {\n\t\t\t\tif (this.#aborted)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst error: UploaderError = UploaderError.createFromAjaxErrors(response.errors);\n\t\t\t\tconst shouldRetry: boolean = (\n\t\t\t\t\terror.getCode() === 'NETWORK_ERROR'\n\t\t\t\t\t|| error.getType() === UploaderError.Type.UNKNOWN\n\t\t\t\t);\n\n\t\t\t\tif (!shouldRetry || !this.#retryUploadChunk(chunk))\n\t\t\t\t{\n\t\t\t\t\tthis.emit('onError', { error });\n\t\t\t\t}\n\t\t\t})\n\t\t;\n\t}\n\n\t#retryUploadChunk(chunk: Chunk): boolean\n\t{\n\t\tconst nextDelay: ?number = chunk.getNextRetryDelay();\n\t\tif (nextDelay === null)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tclearTimeout(this.#chunkTimeout);\n\n\t\tthis.#chunkTimeout = setTimeout((): void => {\n\t\t\tthis.#uploadChunk(chunk);\n\t\t}, nextDelay);\n\n\t\treturn true;\n\t}\n\n\t#getNextChunk(): ?Chunk\n\t{\n\t\tif (this.getChunkOffset() !== null && this.getChunkOffset() >= this.getFile().getSize())\n\t\t{\n\t\t\t// End of File\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.getChunkOffset() === null)\n\t\t{\n\t\t\t// First call\n\t\t\tthis.#chunkOffset = 0;\n\t\t}\n\n\t\tlet chunk: Chunk = null;\n\t\tif (this.getChunkOffset() === 0 && this.getFile().getSize() <= this.getChunkSize())\n\t\t{\n\t\t\tchunk = new Chunk(this.getFile().getBinary(), this.getChunkOffset());\n\t\t\tthis.#chunkOffset = this.getFile().getSize();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentChunkSize: number = Math.min(this.getChunkSize(), this.getFile().getSize() - this.getChunkOffset());\n\t\t\tconst nextOffset: number = this.getChunkOffset() + currentChunkSize;\n\t\t\tconst fileRange: Blob = this.getFile().getBinary().slice(this.getChunkOffset(), nextOffset);\n\n\t\t\tchunk = new Chunk(fileRange, this.getChunkOffset());\n\t\t\tthis.#chunkOffset = nextOffset;\n\t\t}\n\n\t\tchunk.setRetries([...this.getServer().getChunkRetryDelays()]);\n\n\t\treturn chunk;\n\t}\n\n\tgetFile(): UploaderFile\n\t{\n\t\treturn this.#file;\n\t}\n\n\tgetChunkSize(): number\n\t{\n\t\treturn this.getServer().getChunkSize();\n\t}\n\n\tgetChunkOffset(): number\n\t{\n\t\treturn this.#chunkOffset;\n\t}\n\n\tgetToken(): ?string\n\t{\n\t\treturn this.#token;\n\t}\n\n\tsetToken(token: string): void\n\t{\n\t\tif (Type.isStringFilled(token))\n\t\t{\n\t\t\tthis.#token = token;\n\t\t}\n\t}\n}\n","import { ajax as Ajax, Runtime } from 'main.core';\n\nimport UploaderError from '../uploader-error';\n\nimport type UploaderFile from '../uploader-file';\nimport type Server from './server';\nimport type ServerLoadController from './server-load-controller';\n\ntype QueueTask = {\n\tcontroller: ServerLoadController,\n\tfile: UploaderFile,\n}\n\ntype Queue = {\n\ttasks: QueueTask[],\n\tload: Function,\n\txhr: XMLHttpRequest,\n\taborted: boolean,\n};\n\nconst pendingQueues: WeakMap<Server, Queue> = new WeakMap();\nconst loadingFiles: WeakMap<UploaderFile, Queue> = new WeakMap();\n\nexport function loadMultiple(controller: ServerLoadController, file: UploaderFile): void\n{\n\tconst server: Server = controller.getServer();\n\tconst timeout = controller.getOption('timeout', 100);\n\n\tlet queue = pendingQueues.get(server);\n\tif (!queue)\n\t{\n\t\tqueue = {\n\t\t\ttasks: [],\n\t\t\tload: Runtime.debounce(loadInternal, timeout, server),\n\t\t\txhr: null,\n\t\t\taborted: false,\n\t\t};\n\n\t\tpendingQueues.set(server, queue);\n\t}\n\n\tqueue.tasks.push({ controller, file });\n\tqueue.load();\n}\n\nexport function abort(controller: ServerLoadController, file: UploaderFile): void\n{\n\tconst server: Server = controller.getServer();\n\tconst queue: Queue = pendingQueues.get(server);\n\tif (queue)\n\t{\n\t\tqueue.tasks = queue.tasks.filter((task: QueueTask): boolean => {\n\t\t\treturn task.file !== file;\n\t\t});\n\n\t\tif (queue.tasks.length === 0)\n\t\t{\n\t\t\tpendingQueues.delete(server);\n\t\t}\n\t}\n\telse\n\t{\n\t\tconst queue: Queue = loadingFiles.get(file);\n\t\tif (queue)\n\t\t{\n\t\t\tqueue.tasks = queue.tasks.filter((task: QueueTask): boolean => {\n\t\t\t\treturn task.file !== file;\n\t\t\t});\n\n\t\t\tloadingFiles.delete(file);\n\n\t\t\tif (queue.tasks.length === 0)\n\t\t\t{\n\t\t\t\tqueue.aborted = true;\n\t\t\t\tqueue.xhr.abort();\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction loadInternal(): void\n{\n\t// eslint-disable-next-line no-invalid-this,unicorn/no-this-assignment\n\tconst server: Server = this;\n\tconst queue: Queue = pendingQueues.get(server);\n\tif (!queue)\n\t{\n\t\treturn;\n\t}\n\n\tpendingQueues.delete(server);\n\n\tif (queue.tasks.length === 0)\n\t{\n\t\treturn;\n\t}\n\n\tconst fileIds = [];\n\tqueue.tasks.forEach((task: QueueTask): void => {\n\t\tconst file: UploaderFile = task.file;\n\t\tfileIds.push(file.getServerFileId());\n\t\tloadingFiles.set(file, queue);\n\t});\n\n\tconst controllerOptions = server.getControllerOptions();\n\tAjax.runAction('ui.fileuploader.load', {\n\t\tdata: {\n\t\t\tfileIds,\n\t\t},\n\t\tgetParameters: {\n\t\t\tcontroller: server.getController(),\n\t\t\tcontrollerOptions: controllerOptions ? JSON.stringify(controllerOptions) : null,\n\t\t},\n\t\tonrequeststart: (xhr): void => {\n\t\t\tqueue.xhr = xhr;\n\t\t},\n\t\tonprogress: (event: ProgressEvent): void => {\n\t\t\tif (event.lengthComputable)\n\t\t\t{\n\t\t\t\tconst progress: number = event.total > 0 ? Math.floor(event.loaded / event.total * 100) : 100;\n\n\t\t\t\tqueue.tasks.forEach((task: QueueTask): void => {\n\t\t\t\t\tconst { controller } = task;\n\t\t\t\t\tcontroller.emit('onProgress', { progress });\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t})\n\t\t.then((response) => {\n\t\t\tif (response.data?.files)\n\t\t\t{\n\t\t\t\tconst fileResults = {};\n\t\t\t\tresponse.data.files.forEach((fileResult): void => {\n\t\t\t\t\tfileResults[fileResult.id] = fileResult;\n\t\t\t\t});\n\n\t\t\t\tqueue.tasks.forEach((task: QueueTask): void => {\n\t\t\t\t\tconst { controller, file } = task;\n\t\t\t\t\tconst fileResult = fileResults[file.getServerFileId()] || null;\n\n\t\t\t\t\tloadingFiles.delete(file);\n\n\t\t\t\t\tif (fileResult && fileResult.success)\n\t\t\t\t\t{\n\t\t\t\t\t\tcontroller.emit('onProgress', { progress: 100 });\n\t\t\t\t\t\tcontroller.emit('onLoad', { fileInfo: fileResult.data.file });\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst error: UploaderError = UploaderError.createFromAjaxErrors(fileResult?.errors);\n\t\t\t\t\t\tcontroller.emit('onError', { error });\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst error: UploaderError = new UploaderError('SERVER_ERROR');\n\t\t\t\tqueue.tasks.forEach((task: QueueTask): void => {\n\t\t\t\t\tconst { controller, file } = task;\n\n\t\t\t\t\tloadingFiles.delete(file);\n\t\t\t\t\tcontroller.emit('onError', { error: error.clone() });\n\t\t\t\t});\n\t\t\t}\n\t\t})\n\t\t.catch((response) => {\n\t\t\tconst error: ?UploaderError = queue.aborted ? null : UploaderError.createFromAjaxErrors(response.errors);\n\t\t\tqueue.tasks.forEach((task: QueueTask): void => {\n\t\t\t\tconst { controller, file } = task;\n\n\t\t\t\tloadingFiles.delete(file);\n\n\t\t\t\tif (!queue.aborted)\n\t\t\t\t{\n\t\t\t\t\tcontroller.emit('onError', { error: error.clone() });\n\t\t\t\t}\n\t\t\t});\n\t\t})\n\t;\n}\n","import AbstractLoadController from './abstract-load-controller';\nimport type Server from './server';\nimport type UploaderFile from '../uploader-file';\nimport { loadMultiple, abort } from './server-load-multiple';\n\nexport default class ServerLoadController extends AbstractLoadController\n{\n\t#file: UploaderFile = null;\n\n\tconstructor(server: Server, options: { [key: string]: any } = {})\n\t{\n\t\tsuper(server, options);\n\t}\n\n\tload(file: UploaderFile): void\n\t{\n\t\tif (this.getServer().getController())\n\t\t{\n\t\t\tthis.#file = file;\n\t\t\tloadMultiple(this, file);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit('onProgress', { progress: 100 });\n\t\t\tthis.emit('onLoad', { fileInfo: null });\n\t\t}\n\t}\n\n\tabort(): void\n\t{\n\t\tif (this.getServer().getController() && this.#file)\n\t\t{\n\t\t\tabort(this, this.#file);\n\t\t}\n\t}\n}\n","import AbstractLoadController from './abstract-load-controller';\nimport Server from './server';\nimport UploaderFile from '../uploader-file';\nimport { Type } from 'main.core';\nimport UploaderError from '../uploader-error';\n\nexport default class ClientLoadController extends AbstractLoadController\n{\n\tconstructor(server: Server, options: { [key: string]: any } = {})\n\t{\n\t\tsuper(server, options);\n\t}\n\n\tload(file: UploaderFile): void\n\t{\n\t\tif (Type.isFile(file.getBinary()))\n\t\t{\n\t\t\tthis.emit('onProgress', { progress: 100 });\n\t\t\tthis.emit('onLoad', { fileInfo: file });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit('onError', { error: new UploaderError('WRONG_FILE_SOURCE') });\n\t\t}\n\t}\n\n\tabort(): void\n\t{\n\t\t// silent abort\n\t}\n}\n","import { ajax as Ajax, Runtime } from 'main.core';\n\nimport UploaderError from '../uploader-error';\n\nimport type UploaderFile from '../uploader-file';\nimport type Server from './server';\nimport type RemoveController from './remove-controller';\nimport type ServerLoadController from './server-load-controller';\n\ntype Queue = {\n\ttasks: Array<{ controller: ServerLoadController, file: UploaderFile }>,\n\tremove: Function,\n\txhr: XMLHttpRequest,\n}\n\nconst queues: WeakMap<Server, Queue> = new WeakMap();\n\nexport function removeMultiple(controller: RemoveController, file: UploaderFile)\n{\n\tconst server = controller.getServer();\n\tlet queue = queues.get(server);\n\tif (!queue)\n\t{\n\t\tqueue = {\n\t\t\ttasks: [],\n\t\t\tremove: Runtime.debounce(removeInternal, 1000, server),\n\t\t\txhr: null,\n\t\t};\n\n\t\tqueues.set(server, queue);\n\t}\n\n\tqueue.tasks.push({ controller, file });\n\tqueue.remove();\n}\n\nfunction removeInternal()\n{\n\t// eslint-disable-next-line no-invalid-this,unicorn/no-this-assignment\n\tconst server: Server = this;\n\tconst queue = queues.get(server);\n\tif (!queue)\n\t{\n\t\treturn;\n\t}\n\n\tconst { tasks } = queue;\n\tqueues.delete(server);\n\n\tconst fileIds = [];\n\ttasks.forEach((task) => {\n\t\tconst file: UploaderFile = task.file;\n\t\tif (file.getServerFileId() !== null)\n\t\t{\n\t\t\tfileIds.push(file.getServerFileId());\n\t\t}\n\t});\n\n\tif (fileIds.length === 0)\n\t{\n\t\treturn;\n\t}\n\n\tconst controllerOptions = server.getControllerOptions();\n\tAjax.runAction('ui.fileuploader.remove', {\n\t\tdata: {\n\t\t\tfileIds,\n\t\t},\n\t\tgetParameters: {\n\t\t\tcontroller: server.getController(),\n\t\t\tcontrollerOptions: controllerOptions ? JSON.stringify(controllerOptions) : null,\n\t\t},\n\t\tonrequeststart: (xhr) => {\n\t\t\tqueue.xhr = xhr;\n\t\t},\n\t}).then((response) => {\n\t\tif (response.data?.files)\n\t\t{\n\t\t\tconst fileResults = {};\n\t\t\tresponse.data.files.forEach((fileResult) => {\n\t\t\t\tfileResults[fileResult.id] = fileResult;\n\t\t\t});\n\n\t\t\ttasks.forEach((task) => {\n\t\t\t\tconst { controller, file } = task;\n\t\t\t\tconst fileResult = fileResults[file.getServerFileId()] || null;\n\n\t\t\t\tif (fileResult && fileResult.success)\n\t\t\t\t{\n\t\t\t\t\tcontroller.emit('onRemove', { fileId: fileResult.id });\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconst error = UploaderError.createFromAjaxErrors(fileResult?.errors);\n\t\t\t\t\tcontroller.emit('onError', { error });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst error = new UploaderError('SERVER_ERROR');\n\t\t\ttasks.forEach((task) => {\n\t\t\t\tconst { controller } = task;\n\t\t\t\tcontroller.emit('onError', { error: error.clone() });\n\t\t\t});\n\t\t}\n\t}).catch((response) => {\n\t\tconst error = UploaderError.createFromAjaxErrors(response.errors);\n\t\ttasks.forEach((task) => {\n\t\t\tconst { controller } = task;\n\t\t\tcontroller.emit('onError', { error: error.clone() });\n\t\t});\n\t});\n}\n","import AbstractRemoveController from './abstract-remove-controller';\nimport { removeMultiple } from './remove-multiple';\n\nimport type UploaderFile from '../uploader-file';\n\nexport default class RemoveController extends AbstractRemoveController\n{\n\tremove(file: UploaderFile): void\n\t{\n\t\tremoveMultiple(this, file);\n\t}\n}\n","import { Type } from 'main.core';\n\nimport AbstractLoadController from './abstract-load-controller';\nimport UploaderError from '../uploader-error';\n\nimport type Server from './server';\nimport type UploaderFile from '../uploader-file';\n\nexport default class ServerlessLoadController extends AbstractLoadController\n{\n\tconstructor(server: Server, options: { [key: string]: any } = {})\n\t{\n\t\tsuper(server, options);\n\t}\n\n\tload(file: UploaderFile): void\n\t{\n\t\tif (Type.isStringFilled(file.getName()))\n\t\t{\n\t\t\tthis.emit('onProgress', { progress: 100 });\n\t\t\tthis.emit('onLoad', { fileInfo: file });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.emit('onError', { error: new UploaderError('WRONG_FILE_SOURCE') });\n\t\t}\n\t}\n\n\tabort(): void\n\t{\n\t\t// silent abort\n\t}\n}\n","import { Extension, Runtime, Type } from 'main.core';\nimport UploadController from './upload-controller';\nimport AbstractUploadController from './abstract-upload-controller';\nimport ServerLoadController from './server-load-controller';\nimport AbstractLoadController from './abstract-load-controller';\nimport ClientLoadController from './client-load-controller';\nimport AbstractRemoveController from './abstract-remove-controller';\nimport RemoveController from './remove-controller';\nimport ServerlessLoadController from './serverless-load-controller';\n\nimport type { ServerOptions } from '../types/server-options';\n\nexport default class Server\n{\n\t#controller: ?string = null;\n\t#controllerOptions: ?{ [key: string]: any } = null;\n\t#uploadControllerClass: Class<AbstractUploadController> = null;\n\t#uploadControllerOptions: ?{ [key: string]: any } = {};\n\t#loadControllerClass: Class<AbstractLoadController> = null;\n\t#loadControllerOptions: ?{ [key: string]: any } = {};\n\t#removeControllerClass: Class<AbstractRemoveController> = null;\n\t#removeControllerOptions: ?{ [key: string]: any } = {};\n\t#chunkSize: number = null;\n\t#defaultChunkSize: number = null;\n\t#chunkMinSize: number = null;\n\t#chunkMaxSize: number = null;\n\t#chunkRetryDelays: number[] = [1000, 3000, 6000];\n\n\tconstructor(serverOptions: ServerOptions)\n\t{\n\t\tconst options: ServerOptions = Type.isPlainObject(serverOptions) ? serverOptions : {};\n\n\t\tthis.#controller = Type.isStringFilled(options.controller) ? options.controller : null;\n\t\tthis.#controllerOptions = Type.isPlainObject(options.controllerOptions) ? options.controllerOptions : null;\n\n\t\tconst chunkSize: number = (\n\t\t\tType.isNumber(options.chunkSize) && options.chunkSize > 0\n\t\t\t\t? options.chunkSize\n\t\t\t\t: this.getDefaultChunkSize()\n\t\t);\n\n\t\tthis.#chunkSize = options.forceChunkSize === true ? chunkSize : this.#calcChunkSize(chunkSize);\n\n\t\tif (options.chunkRetryDelays === false || options.chunkRetryDelays === null)\n\t\t{\n\t\t\tthis.#chunkRetryDelays = [];\n\t\t}\n\t\telse if (Type.isArray(options.chunkRetryDelays))\n\t\t{\n\t\t\tthis.#chunkRetryDelays = options.chunkRetryDelays;\n\t\t}\n\n\t\tconst controllerClasses: string[] = ['uploadControllerClass', 'loadControllerClass', 'removeControllerClass'];\n\t\tcontrollerClasses.forEach((controllerClass: string): void => {\n\t\t\tlet fn = null;\n\t\t\tif (Type.isStringFilled(options[controllerClass]))\n\t\t\t{\n\t\t\t\tfn = Runtime.getClass(options[controllerClass]);\n\t\t\t\tif (!Type.isFunction(fn))\n\t\t\t\t{\n\t\t\t\t\tthrow new TypeError(`Uploader.Server: \"${controllerClass}\" must be a function.`);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (Type.isFunction(options[controllerClass]))\n\t\t\t{\n\t\t\t\tfn = options[controllerClass];\n\t\t\t}\n\n\t\t\tswitch (controllerClass)\n\t\t\t{\n\t\t\t\tcase 'uploadControllerClass':\n\t\t\t\t\tthis.#uploadControllerClass = fn;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'loadControllerClass':\n\t\t\t\t\tthis.#loadControllerClass = fn;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'removeControllerClass':\n\t\t\t\t\tthis.#removeControllerClass = fn;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t// No default\n\t\t\t}\n\t\t});\n\n\t\tthis.#loadControllerOptions = (\n\t\t\tType.isPlainObject(options.loadControllerOptions) ? options.loadControllerOptions : {}\n\t\t);\n\n\t\tthis.#uploadControllerOptions = (\n\t\t\tType.isPlainObject(options.uploadControllerOptions) ? options.uploadControllerOptions : {}\n\t\t);\n\n\t\tthis.#removeControllerOptions = (\n\t\t\tType.isPlainObject(options.removeControllerOptions) ? options.removeControllerOptions : {}\n\t\t);\n\t}\n\n\tcreateUploadController(): ?UploadController\n\t{\n\t\tif (this.#uploadControllerClass)\n\t\t{\n\t\t\tconst controller: AbstractUploadController = new this.#uploadControllerClass(this, this.#uploadControllerOptions);\n\t\t\tif (!(controller instanceof AbstractUploadController))\n\t\t\t{\n\t\t\t\tthrow new TypeError(\n\t\t\t\t\t'Uploader.Server: \"uploadControllerClass\" must be an instance of AbstractUploadController.',\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn controller;\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#controller))\n\t\t{\n\t\t\treturn new UploadController(this, this.#uploadControllerOptions);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tcreateServerLoadController(): AbstractLoadController\n\t{\n\t\tif (this.#loadControllerClass)\n\t\t{\n\t\t\tconst controller: AbstractLoadController = new this.#loadControllerClass(this, this.#loadControllerOptions);\n\t\t\tif (!(controller instanceof AbstractLoadController))\n\t\t\t{\n\t\t\t\tthrow new TypeError(\n\t\t\t\t\t'Uploader.Server: \"loadControllerClass\" must be an instance of AbstractLoadController.',\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn controller;\n\t\t}\n\n\t\treturn this.createDefaultServerLoadController();\n\t}\n\n\tcreateDefaultServerLoadController(): ServerLoadController\n\t{\n\t\treturn new ServerLoadController(this, this.#loadControllerOptions);\n\t}\n\n\tcreateClientLoadController(): ClientLoadController\n\t{\n\t\treturn new ClientLoadController(this, this.#loadControllerOptions);\n\t}\n\n\tcreateServerlessLoadController(): ServerlessLoadController\n\t{\n\t\treturn new ServerlessLoadController(this, this.#loadControllerOptions);\n\t}\n\n\tcreateRemoveController(): ?AbstractRemoveController\n\t{\n\t\tif (this.#removeControllerClass)\n\t\t{\n\t\t\tconst controller: AbstractRemoveController = new this.#removeControllerClass(this, this.#removeControllerOptions);\n\t\t\tif (!(controller instanceof AbstractRemoveController))\n\t\t\t{\n\t\t\t\tthrow new TypeError(\n\t\t\t\t\t'Uploader.Server: \"removeControllerClass\" must be an instance of AbstractRemoveController.',\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn controller;\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#controller))\n\t\t{\n\t\t\treturn new RemoveController(this, this.#removeControllerOptions);\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetController(): ?string\n\t{\n\t\treturn this.#controller;\n\t}\n\n\tgetControllerOptions(): ?{ [key: string]: any }\n\t{\n\t\treturn this.#controllerOptions;\n\t}\n\n\tgetChunkSize(): number\n\t{\n\t\treturn this.#chunkSize;\n\t}\n\n\tgetDefaultChunkSize(): number\n\t{\n\t\tif (this.#defaultChunkSize === null)\n\t\t{\n\t\t\tconst settings = Extension.getSettings('ui.uploader.core');\n\t\t\tthis.#defaultChunkSize = settings.get('defaultChunkSize', 5 * 1024 * 1024);\n\t\t}\n\n\t\treturn this.#defaultChunkSize;\n\t}\n\n\tgetChunkMinSize(): number\n\t{\n\t\tif (this.#chunkMinSize === null)\n\t\t{\n\t\t\tconst settings = Extension.getSettings('ui.uploader.core');\n\t\t\tthis.#chunkMinSize = settings.get('chunkMinSize', 1024 * 1024);\n\t\t}\n\n\t\treturn this.#chunkMinSize;\n\t}\n\n\tgetChunkMaxSize(): number\n\t{\n\t\tif (this.#chunkMaxSize === null)\n\t\t{\n\t\t\tconst settings = Extension.getSettings('ui.uploader.core');\n\t\t\tthis.#chunkMaxSize = settings.get('chunkMaxSize', 5 * 1024 * 1024);\n\t\t}\n\n\t\treturn this.#chunkMaxSize;\n\t}\n\n\tgetChunkRetryDelays(): number[]\n\t{\n\t\treturn this.#chunkRetryDelays;\n\t}\n\n\t#calcChunkSize(chunkSize: number): number\n\t{\n\t\treturn Math.min(Math.max(this.getChunkMinSize(), chunkSize), this.getChunkMaxSize());\n\t}\n}\n","import type Uploader from '../uploader';\n\nexport default class Filter\n{\n\t#uploader: Uploader = null;\n\n\tconstructor(uploader: Uploader, filterOptions: { [key: string]: any } = {})\n\t{\n\t\tthis.#uploader = uploader;\n\t}\n\n\tgetUploader(): Uploader\n\t{\n\t\treturn this.#uploader;\n\t}\n\n\t/**\n\t * @abstract\n\t */\n\tapply(...args): Promise\n\t{\n\t\tthrow new Error('You must implement apply() method.');\n\t}\n}\n","import { Extension, Type } from 'main.core';\nimport Filter from './filter';\nimport UploaderError from '../uploader-error';\nimport formatFileSize from '../helpers/format-file-size';\nimport isResizableImage from '../helpers/is-resizable-image';\n\nimport type Uploader from '../uploader';\nimport type UploaderFile from '../uploader-file';\nimport type { UploaderOptions } from '../types/uploader-options';\n\nexport default class FileSizeFilter extends Filter\n{\n\t#maxFileSize: ?number = 256 * 1024 * 1024;\n\t#minFileSize: number = 0;\n\t#maxTotalFileSize: ?number = null;\n\t#imageMaxFileSize: ?number = 48 * 1024 * 1024;\n\t#imageMinFileSize: number = 0;\n\t#treatOversizeImageAsFile: boolean = false;\n\n\tconstructor(uploader: Uploader, filterOptions: UploaderOptions = {})\n\t{\n\t\tsuper(uploader);\n\n\t\tconst settings = Extension.getSettings('ui.uploader.core');\n\t\tthis.#maxFileSize = settings.get('maxFileSize', this.#maxFileSize);\n\t\tthis.#minFileSize = settings.get('minFileSize', this.#minFileSize);\n\t\tthis.#maxTotalFileSize = settings.get('maxTotalFileSize', this.#maxTotalFileSize);\n\t\tthis.#imageMaxFileSize = settings.get('imageMaxFileSize', this.#imageMaxFileSize);\n\t\tthis.#imageMinFileSize = settings.get('imageMinFileSize', this.#imageMinFileSize);\n\n\t\tconst options: UploaderOptions = Type.isPlainObject(filterOptions) ? filterOptions : {};\n\t\tthis.setMaxFileSize(options.maxFileSize);\n\t\tthis.setMinFileSize(options.minFileSize);\n\t\tthis.setMaxTotalFileSize(options.maxTotalFileSize);\n\t\tthis.setImageMaxFileSize(options.imageMaxFileSize);\n\t\tthis.setImageMinFileSize(options.imageMinFileSize);\n\t\tthis.setTreatOversizeImageAsFile(options.treatOversizeImageAsFile);\n\t}\n\n\tapply(file: UploaderFile): Promise\n\t{\n\t\treturn new Promise((resolve, reject): void => {\n\t\t\tif (this.getMaxFileSize() !== null && file.getSize() > this.getMaxFileSize())\n\t\t\t{\n\t\t\t\treject(\n\t\t\t\t\tnew UploaderError(\n\t\t\t\t\t\t'MAX_FILE_SIZE_EXCEEDED',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmaxFileSize: formatFileSize(this.getMaxFileSize()),\n\t\t\t\t\t\t\tmaxFileSizeInBytes: this.getMaxFileSize(),\n\t\t\t\t\t\t},\n\t\t\t\t\t),\n\t\t\t\t);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file.getSize() < this.getMinFileSize())\n\t\t\t{\n\t\t\t\treject(\n\t\t\t\t\tnew UploaderError(\n\t\t\t\t\t\t'MIN_FILE_SIZE_EXCEEDED',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tminFileSize: formatFileSize(this.getMinFileSize()),\n\t\t\t\t\t\t\tminFileSizeInBytes: this.getMinFileSize(),\n\t\t\t\t\t\t},\n\t\t\t\t\t),\n\t\t\t\t);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (isResizableImage(file.getName(), file.getType()))\n\t\t\t{\n\t\t\t\tif (this.getImageMaxFileSize() !== null && file.getSize() > this.getImageMaxFileSize())\n\t\t\t\t{\n\t\t\t\t\tif (this.shouldTreatOversizeImageAsFile())\n\t\t\t\t\t{\n\t\t\t\t\t\tfile.setTreatImageAsFile(true);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treject(\n\t\t\t\t\t\t\tnew UploaderError(\n\t\t\t\t\t\t\t\t'IMAGE_MAX_FILE_SIZE_EXCEEDED',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\timageMaxFileSize: formatFileSize(this.getImageMaxFileSize()),\n\t\t\t\t\t\t\t\t\timageMaxFileSizeInBytes: this.getImageMaxFileSize(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (file.getSize() < this.getImageMinFileSize())\n\t\t\t\t{\n\t\t\t\t\tif (this.shouldTreatOversizeImageAsFile())\n\t\t\t\t\t{\n\t\t\t\t\t\tfile.setTreatImageAsFile(true);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treject(\n\t\t\t\t\t\t\tnew UploaderError(\n\t\t\t\t\t\t\t\t'IMAGE_MIN_FILE_SIZE_EXCEEDED',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\timageMinFileSize: formatFileSize(this.getImageMinFileSize()),\n\t\t\t\t\t\t\t\t\timageMinFileSizeInBytes: this.getImageMinFileSize(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.getMaxTotalFileSize() !== null && this.getUploader().getTotalSize() > this.getMaxTotalFileSize())\n\t\t\t{\n\t\t\t\treject(\n\t\t\t\t\tnew UploaderError(\n\t\t\t\t\t\t'MAX_TOTAL_FILE_SIZE_EXCEEDED',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmaxTotalFileSize: formatFileSize(this.getMaxTotalFileSize()),\n\t\t\t\t\t\t\tmaxTotalFileSizeInBytes: this.getMaxTotalFileSize(),\n\t\t\t\t\t\t},\n\t\t\t\t\t),\n\t\t\t\t);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresolve();\n\t\t});\n\t}\n\n\tgetMaxFileSize(): ?number\n\t{\n\t\treturn this.#maxFileSize;\n\t}\n\n\tsetMaxFileSize(value: ?number)\n\t{\n\t\tif ((Type.isNumber(value) && value >= 0) || Type.isNull(value))\n\t\t{\n\t\t\tthis.#maxFileSize = value;\n\t\t}\n\t}\n\n\tgetMinFileSize(): number\n\t{\n\t\treturn this.#minFileSize;\n\t}\n\n\tsetMinFileSize(value: number)\n\t{\n\t\tif (Type.isNumber(value) && value >= 0)\n\t\t{\n\t\t\tthis.#minFileSize = value;\n\t\t}\n\t}\n\n\tgetMaxTotalFileSize(): ?number\n\t{\n\t\treturn this.#maxTotalFileSize;\n\t}\n\n\tsetMaxTotalFileSize(value: ?number)\n\t{\n\t\tif ((Type.isNumber(value) && value >= 0) || Type.isNull(value))\n\t\t{\n\t\t\tthis.#maxTotalFileSize = value;\n\t\t}\n\t}\n\n\tgetImageMaxFileSize(): ?number\n\t{\n\t\treturn this.#imageMaxFileSize;\n\t}\n\n\tsetImageMaxFileSize(value: ?number)\n\t{\n\t\tif ((Type.isNumber(value) && value >= 0) || Type.isNull(value))\n\t\t{\n\t\t\tthis.#imageMaxFileSize = value;\n\t\t}\n\t}\n\n\tgetImageMinFileSize(): number\n\t{\n\t\treturn this.#imageMinFileSize;\n\t}\n\n\tsetImageMinFileSize(value: number)\n\t{\n\t\tif (Type.isNumber(value) && value >= 0)\n\t\t{\n\t\t\tthis.#imageMinFileSize = value;\n\t\t}\n\t}\n\n\tsetTreatOversizeImageAsFile(value: boolean): void\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\tthis.#treatOversizeImageAsFile = value;\n\t\t}\n\t}\n\n\tshouldTreatOversizeImageAsFile(): boolean\n\t{\n\t\treturn this.#treatOversizeImageAsFile;\n\t}\n}\n","import { Type } from 'main.core';\n\nconst isValidFileType = (file: File, fileTypes: string[]): boolean => {\n\tif (!Type.isArrayFilled(fileTypes))\n\t{\n\t\treturn true;\n\t}\n\n\tconst mimeType = file.type;\n\tconst baseMimeType = mimeType.replace(/\\/.*$/, '');\n\n\tfor (const fileType of fileTypes)\n\t{\n\t\tif (!Type.isStringFilled(fileType))\n\t\t{\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst type = fileType.trim().toLowerCase();\n\n\t\tif (type.charAt(0) === '.') // extension case\n\t\t{\n\t\t\tif (file.name.toLowerCase().includes(type, file.name.length - type.length))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\telse if (/\\/\\*$/.test(type)) // image/* mime type case\n\t\t{\n\t\t\tif (baseMimeType === type.replace(/\\/.*$/, ''))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t\telse if (mimeType === type)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nexport default isValidFileType;\n","import Filter from './filter';\nimport isValidFileType from '../helpers/is-valid-file-type';\nimport UploaderError from '../uploader-error';\n\nimport type UploaderFile from '../uploader-file';\nimport type Uploader from '../uploader';\n\nexport default class FileTypeFilter extends Filter\n{\n\tconstructor(uploader: Uploader, filterOptions: { [key: string]: any } = {})\n\t{\n\t\tsuper(uploader);\n\t}\n\n\tapply(file: UploaderFile): Promise\n\t{\n\t\treturn new Promise((resolve, reject): void => {\n\t\t\tif (isValidFileType(file.getBinary(), this.getUploader().getAcceptedFileTypes()))\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treject(new UploaderError('FILE_TYPE_NOT_ALLOWED'));\n\t\t\t}\n\t\t});\n\t}\n}\n","const getArrayBuffer = (file: File | Blob): Promise<ArrayBuffer> => {\n\tif (file.arrayBuffer)\n\t{\n\t\treturn file.arrayBuffer();\n\t}\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst fileReader = new FileReader();\n\t\tfileReader.readAsArrayBuffer(file);\n\n\t\tfileReader.onload = () => {\n\t\t\tconst buffer: ArrayBuffer = fileReader.result;\n\n\t\t\tresolve(buffer);\n\t\t};\n\n\t\tfileReader.onerror = () => {\n\t\t\treject(fileReader.error);\n\t\t};\n\t});\n};\n\nexport default getArrayBuffer;\n","const convertStringToBuffer = (str: string): ArrayLike => {\n\tconst result = [];\n\tfor (let i = 0; i < str.length; i++)\n\t{\n\t\tresult.push(str.codePointAt(i) & 0xFF);\n\t}\n\n\treturn result;\n};\nexport default convertStringToBuffer;\n","const compareBuffers = (dataView: DataView, dest: ArrayLike, start: number): boolean => {\n\tfor (let i = start, j = 0; j < dest.length;)\n\t{\n\t\tif (dataView.getUint8(i++) !== dest[j++])\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n};\n\nexport default compareBuffers;\n","import getArrayBuffer from '../../get-array-buffer';\nimport convertStringToBuffer from '../convert-string-to-buffer';\nimport compareBuffers from '../compare-buffers';\n\nimport type { ImageSize } from '../image-size-type';\n\nconst GIF87a = convertStringToBuffer('GIF87a');\nconst GIF89a = convertStringToBuffer('GIF89a');\n\nexport default class Gif\n{\n\tgetSize(file: File): ?ImageSize\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (file.size < 10)\n\t\t\t{\n\t\t\t\treject(new Error('GIF signature not found.'));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tgetArrayBuffer(file)\n\t\t\t\t.then((buffer: ArrayBuffer) => {\n\t\t\t\t\tconst view = new DataView(buffer);\n\n\t\t\t\t\tif (!compareBuffers(view, GIF87a, 0) && !compareBuffers(view, GIF89a, 0))\n\t\t\t\t\t{\n\t\t\t\t\t\treject(new Error('GIF signature not found.'));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// * a static 4-byte sequence (\\x00\\x21\\xF9\\x04)\n\t\t\t\t\t// * 4 variable bytes\n\t\t\t\t\t// * a static 2-byte sequence (\\x00\\x2C) (some variants may use \\x00\\x21 ?)\n\t\t\t\t\t// We read through the file til we reach the end of the file, or we've found\n\t\t\t\t\t// at least 2 frame headers\n\t\t\t\t\tlet frames = 0;\n\t\t\t\t\tfor (let i = 0, len = view.byteLength - 9; i < len && frames < 2; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tview.getUint8(i) === 0x00\n\t\t\t\t\t\t\t&& view.getUint8(i + 1) === 0x21\n\t\t\t\t\t\t\t&& view.getUint8(i + 2) === 0xF9\n\t\t\t\t\t\t\t&& view.getUint8(i + 3) === 0x04\n\t\t\t\t\t\t\t&& view.getUint8(i + 8) === 0x00\n\t\t\t\t\t\t\t&& (view.getUint8(i + 9) === 0x2C || view.getUint8(i + 9) === 0x21)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tframes++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst animated = frames > 1;\n\n\t\t\t\t\tresolve({\n\t\t\t\t\t\twidth: view.getUint16(6, true),\n\t\t\t\t\t\theight: view.getUint16(8, true),\n\t\t\t\t\t\tanimated,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n}\n","import getArrayBuffer from '../../get-array-buffer';\nimport convertStringToBuffer from '../convert-string-to-buffer';\nimport compareBuffers from '../compare-buffers';\nimport type { ImageSize } from '../image-size-type';\n\nconst PNG_SIGNATURE = convertStringToBuffer('\\x89PNG\\r\\n\\x1A\\n');\nconst IHDR_SIGNATURE = convertStringToBuffer('IHDR');\nconst FRIED_CHUNK_NAME = convertStringToBuffer('CgBI');\n\nexport default class Png\n{\n\tgetSize(file: File): ?ImageSize\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (file.size < 40)\n\t\t\t{\n\t\t\t\treject(new Error('PNG signature not found.'));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst blob = file.slice(0, 40);\n\t\t\tgetArrayBuffer(blob)\n\t\t\t\t.then((buffer: ArrayBuffer) => {\n\t\t\t\t\tconst view = new DataView(buffer);\n\t\t\t\t\tif (!compareBuffers(view, PNG_SIGNATURE, 0))\n\t\t\t\t\t{\n\t\t\t\t\t\treject(new Error('PNG signature not found.'));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (compareBuffers(view, FRIED_CHUNK_NAME, 12))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (compareBuffers(view, IHDR_SIGNATURE, 28))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\twidth: view.getUint32(32),\n\t\t\t\t\t\t\t\theight: view.getUint32(36),\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(new Error('PNG IHDR not found.'));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (compareBuffers(view, IHDR_SIGNATURE, 12))\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\twidth: view.getUint32(16),\n\t\t\t\t\t\t\theight: view.getUint32(20),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treject(new Error('PNG IHDR not found.'));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treturn reject(error);\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n}\n","import getArrayBuffer from '../../get-array-buffer';\nimport type { ImageSize } from '../image-size-type';\n\nconst BMP_SIGNATURE = 0x424D; // BM\n\nexport default class Bmp\n{\n\tgetSize(file: File): ?ImageSize\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (file.size < 26)\n\t\t\t{\n\t\t\t\treject(new Error('BMP signature not found.'));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst blob = file.slice(0, 26);\n\t\t\tgetArrayBuffer(blob)\n\t\t\t\t.then((buffer: ArrayBuffer): void => {\n\t\t\t\t\tconst view = new DataView(buffer);\n\t\t\t\t\tif (!view.getUint16(0) === BMP_SIGNATURE)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(new Error('BMP signature not found.'));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve({\n\t\t\t\t\t\twidth: view.getUint32(18, true),\n\t\t\t\t\t\theight: Math.abs(view.getInt32(22, true)),\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error): void => {\n\t\t\t\t\treject(error);\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n}\n","import getArrayBuffer from '../../get-array-buffer';\nimport convertStringToBuffer from '../convert-string-to-buffer';\nimport compareBuffers from '../compare-buffers';\n\nimport type { ImageSize } from '../image-size-type';\n\nconst EXIF_SIGNATURE = convertStringToBuffer('Exif\\0\\0');\n\nexport default class Jpeg\n{\n\tgetSize(file: File): ?ImageSize\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (file.size < 2)\n\t\t\t{\n\t\t\t\treject(new Error('JPEG signature not found.'));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tgetArrayBuffer(file)\n\t\t\t\t.then((buffer: ArrayBuffer) => {\n\t\t\t\t\tconst view = new DataView(buffer);\n\t\t\t\t\tif (view.getUint8(0) !== 0xFF || view.getUint8(1) !== 0xD8)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(new Error('JPEG signature not found.'));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet offset = 2;\n\t\t\t\t\tlet orientation = -1;\n\t\t\t\t\tfor (;;)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (view.byteLength - offset < 2)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(new Error('JPEG signature not found.'));\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (view.getUint8(offset++) !== 0xFF)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(new Error('JPEG signature not found.'));\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet code = view.getUint8(offset++);\n\t\t\t\t\t\tlet length = 0;\n\n\t\t\t\t\t\t// skip padding bytes\n\t\t\t\t\t\twhile (code === 0xFF)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcode = view.getUint8(offset++);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ((code >= 0xD0 && code <= 0xD9) || code === 0x01)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlength = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (code >= 0xC0 && code <= 0xFE)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// the rest of the unreserved markers\n\t\t\t\t\t\t\tif (view.byteLength - offset < 2)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treject(new Error('JPEG signature not found.'));\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlength = view.getUint16(offset) - 2;\n\t\t\t\t\t\t\toffset += 2;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(new Error('JPEG unknown markers.'));\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (code === 0xD9 /* EOI */ || code === 0xDA /* SOS */)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(new Error('JPEG end of the data stream.'));\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// try to get orientation from Exif segment\n\t\t\t\t\t\tif (code === 0xE1 && length >= 10 && compareBuffers(view, EXIF_SIGNATURE, offset))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst exifBlock = new DataView(view.buffer, offset + 6, offset + length);\n\t\t\t\t\t\t\torientation = getOrientation(exifBlock);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tlength >= 5\n\t\t\t\t\t\t\t&& (code >= 0xC0 && code <= 0xCF)\n\t\t\t\t\t\t\t&& code !== 0xC4 && code !== 0xC8 && code !== 0xCC\n\t\t\t\t\t\t)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (view.byteLength - offset < length)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treject(new Error('JPEG size not found.'));\n\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet width = view.getUint16(offset + 3);\n\t\t\t\t\t\t\tlet height = view.getUint16(offset + 1);\n\t\t\t\t\t\t\tif (orientation >= 5 && orientation <= 8)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t[width, height] = [height, width];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\t\theight,\n\t\t\t\t\t\t\t\torientation,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\toffset += length;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n}\n\nconst Marker = {\n\tBIG_ENDIAN: 0x4D4D,\n\tLITTLE_ENDIAN: 0x4949,\n};\n\nconst getOrientation = (exifBlock: DataView): number => {\n\tconst byteAlign = exifBlock.getUint16(0);\n\tconst isBigEndian = byteAlign === Marker.BIG_ENDIAN;\n\tconst isLittleEndian = byteAlign === Marker.LITTLE_ENDIAN;\n\n\tif (isBigEndian || isLittleEndian)\n\t{\n\t\treturn extractOrientation(exifBlock, isLittleEndian);\n\t}\n\n\treturn -1;\n};\n\nconst extractOrientation = (exifBlock: DataView, littleEndian: boolean = false): number => {\n\tconst offset = 8; // idf offset\n\tconst idfDirectoryEntries = exifBlock.getUint16(offset, littleEndian);\n\n\tconst IDF_ENTRY_BYTES = 12;\n\tconst NUM_DIRECTORY_ENTRIES_BYTES = 2;\n\n\tfor (let directoryEntryNumber = 0; directoryEntryNumber < idfDirectoryEntries; directoryEntryNumber++)\n\t{\n\t\tconst start = offset + NUM_DIRECTORY_ENTRIES_BYTES + (directoryEntryNumber * IDF_ENTRY_BYTES);\n\t\tconst end = start + IDF_ENTRY_BYTES;\n\n\t\t// Skip on corrupt EXIF blocks\n\t\tif (start > exifBlock.byteLength)\n\t\t{\n\t\t\treturn -1;\n\t\t}\n\n\t\tconst block = new DataView(exifBlock.buffer, exifBlock.byteOffset + start, end - start);\n\t\tconst tagNumber = block.getUint16(0, littleEndian);\n\n\t\t// 274 is the `orientation` tag ID\n\t\tif (tagNumber === 274)\n\t\t{\n\t\t\tconst dataFormat = block.getUint16(2, littleEndian);\n\t\t\tif (dataFormat !== 3)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tconst numberOfComponents = block.getUint32(4, littleEndian);\n\t\t\tif (numberOfComponents !== 1)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\treturn block.getUint16(8, littleEndian);\n\t\t}\n\t}\n\n\treturn -1;\n};\n","import getArrayBuffer from '../../get-array-buffer';\nimport type { ImageSize } from '../image-size-type';\n\nconst RIFF_HEADER = 0x52494646; // RIFF\nconst WEBP_SIGNATURE = 0x57454250; // WEBP\nconst VP8_SIGNATURE = 0x56503820; // VP8\nconst VP8L_SIGNATURE = 0x5650384C; // VP8L\nconst VP8X_SIGNATURE = 0x56503858; // VP8X\n\nexport default class Webp\n{\n\tgetSize(file: File): Promise<?ImageSize>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (file.size < 16)\n\t\t\t{\n\t\t\t\treject(new Error('WEBP signature not found.'));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst blob = file.slice(0, 30);\n\t\t\tgetArrayBuffer(blob)\n\t\t\t\t.then((buffer: ArrayBuffer) => {\n\t\t\t\t\tconst view = new DataView(buffer);\n\t\t\t\t\tif (view.getUint32(0) !== RIFF_HEADER && view.getUint32(8) !== WEBP_SIGNATURE)\n\t\t\t\t\t{\n\t\t\t\t\t\treject(new Error('WEBP signature not found.'));\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst headerType = view.getUint32(12);\n\t\t\t\t\tconst headerView = new DataView(buffer, 20, 10);\n\t\t\t\t\tif (headerType === VP8_SIGNATURE && headerView.getUint8(0) !== 0x2F)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\twidth: headerView.getUint16(6, true) & 0x3FFF,\n\t\t\t\t\t\t\theight: headerView.getUint16(8, true) & 0x3FFF,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (headerType === VP8L_SIGNATURE && headerView.getUint8(0) === 0x2F)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst bits = headerView.getUint32(1, true);\n\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\twidth: (bits & 0x3FFF) + 1,\n\t\t\t\t\t\t\theight: ((bits >> 14) & 0x3FFF) + 1,\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (headerType === VP8X_SIGNATURE)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst extendedHeader = headerView.getUint8(0);\n\t\t\t\t\t\tconst validStart = (extendedHeader & 0xC0) === 0;\n\t\t\t\t\t\tconst validEnd = (extendedHeader & 0x01) === 0;\n\t\t\t\t\t\tif (validStart && validEnd)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconst animated = (extendedHeader & 2) === 2; // 00000010 means an animated image\n\n\t\t\t\t\t\t\tconst width = 1 + (\n\t\t\t\t\t\t\t\t(headerView.getUint8(6) << 16)\n\t\t\t\t\t\t\t\t| (headerView.getUint8(5) << 8)\n\t\t\t\t\t\t\t\t| headerView.getUint8(4)\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tconst height = 1 + (\n\t\t\t\t\t\t\t\t(Math.trunc(headerView.getUint8(9)))\n\t\t\t\t\t\t\t\t| (headerView.getUint8(8) << 8)\n\t\t\t\t\t\t\t\t| headerView.getUint8(7)\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tresolve({ width, height, animated });\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treject(new Error('WEBP signature not found.'));\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n}\n","import Gif from './types/gif';\nimport Png from './types/png';\nimport Bmp from './types/bmp';\nimport Jpeg from './types/jpeg';\nimport Webp from './types/webp';\n\nimport getFileExtension from '../get-file-extension';\nimport type { ImageSize } from './image-size-type';\n\nconst jpg = new Jpeg();\nconst typeHandlers = {\n\tgif: new Gif(),\n\tpng: new Png(),\n\tbmp: new Bmp(),\n\tjpg,\n\tjpeg: jpg,\n\tjpe: jpg,\n\twebp: new Webp(),\n};\n\nconst getImageSize = (file: File): Promise<ImageSize> => {\n\tif (file.size === 0)\n\t{\n\t\treturn Promise.reject(new Error('Unknown image type.'));\n\t}\n\n\tconst extension = getFileExtension(file.name).toLowerCase();\n\tconst type = file.type.replace(/^image\\//, '');\n\tconst typeHandler = typeHandlers[extension] || typeHandlers[type];\n\tif (!typeHandler)\n\t{\n\t\treturn Promise.reject(new Error('Unknown image type.'));\n\t}\n\n\treturn typeHandler.getSize(file);\n};\n\nexport default getImageSize;\n","import { Extension, Type } from 'main.core';\n\nimport Filter from './filter';\nimport UploaderError from '../uploader-error';\nimport getImageSize from '../helpers/image-size/get-image-size';\nimport isResizableImage from '../helpers/is-resizable-image';\n\nimport type Uploader from '../uploader';\nimport type UploaderFile from '../uploader-file';\nimport type { UploaderOptions } from '../types/uploader-options';\n\nexport default class ImageSizeFilter extends Filter\n{\n\t#imageMinWidth: number = 1;\n\t#imageMinHeight: number = 1;\n\t#imageMaxWidth: number = 7000;\n\t#imageMaxHeight: number = 7000;\n\t#ignoreUnknownImageTypes: boolean = false;\n\t#treatOversizeImageAsFile: boolean = false;\n\n\tconstructor(uploader: Uploader, filterOptions: UploaderOptions = {})\n\t{\n\t\tsuper(uploader);\n\n\t\tconst settings = Extension.getSettings('ui.uploader.core');\n\t\tthis.#imageMinWidth = settings.get('imageMinWidth', this.#imageMinWidth);\n\t\tthis.#imageMinHeight = settings.get('imageMinHeight', this.#imageMinHeight);\n\t\tthis.#imageMaxWidth = settings.get('imageMaxWidth', this.#imageMaxWidth);\n\t\tthis.#imageMaxHeight = settings.get('imageMaxHeight', this.#imageMaxHeight);\n\n\t\tconst options: UploaderOptions = Type.isPlainObject(filterOptions) ? filterOptions : {};\n\n\t\tthis.setImageMinWidth(options.imageMinWidth);\n\t\tthis.setImageMinHeight(options.imageMinHeight);\n\t\tthis.setImageMaxWidth(options.imageMaxWidth);\n\t\tthis.setImageMaxHeight(options.imageMaxHeight);\n\t\tthis.setIgnoreUnknownImageTypes(options.ignoreUnknownImageTypes);\n\t\tthis.setTreatOversizeImageAsFile(options.treatOversizeImageAsFile);\n\t}\n\n\tapply(file: UploaderFile): Promise\n\t{\n\t\treturn new Promise((resolve, reject): void => {\n\t\t\tif (!isResizableImage(file.getName(), file.getType()))\n\t\t\t{\n\t\t\t\tresolve();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tgetImageSize(file.getBinary())\n\t\t\t\t.then(({ width, height, animated }): void => {\n\t\t\t\t\tfile.setWidth(width);\n\t\t\t\t\tfile.setHeight(height);\n\t\t\t\t\tfile.setAnimated(animated === true);\n\n\t\t\t\t\tif (width < this.getImageMinWidth() || height < this.getImageMinHeight())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.shouldTreatOversizeImageAsFile())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfile.setTreatImageAsFile(true);\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(new UploaderError(\n\t\t\t\t\t\t\t\t'IMAGE_IS_TOO_SMALL',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tminWidth: this.getImageMinWidth(),\n\t\t\t\t\t\t\t\t\tminHeight: this.getImageMinHeight(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (width > this.getImageMaxWidth() || height > this.getImageMaxHeight())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.shouldTreatOversizeImageAsFile())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfile.setTreatImageAsFile(true);\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treject(new UploaderError(\n\t\t\t\t\t\t\t\t'IMAGE_IS_TOO_BIG',\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tmaxWidth: this.getImageMaxWidth(),\n\t\t\t\t\t\t\t\t\tmaxHeight: this.getImageMaxHeight(),\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error): void => {\n\t\t\t\t\tif (this.getIgnoreUnknownImageTypes())\n\t\t\t\t\t{\n\t\t\t\t\t\tfile.setTreatImageAsFile(true);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (error)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\t\t\tconsole.warn('Uploader ImageSizeFilter:', error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treject(new UploaderError('IMAGE_TYPE_NOT_SUPPORTED'));\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\tgetImageMinWidth(): number\n\t{\n\t\treturn this.#imageMinWidth;\n\t}\n\n\tsetImageMinWidth(value: number): void\n\t{\n\t\tif (Type.isNumber(value) && value > 0)\n\t\t{\n\t\t\tthis.#imageMinWidth = value;\n\t\t}\n\t}\n\n\tgetImageMinHeight(): number\n\t{\n\t\treturn this.#imageMinHeight;\n\t}\n\n\tsetImageMinHeight(value: number): void\n\t{\n\t\tif (Type.isNumber(value) && value > 0)\n\t\t{\n\t\t\tthis.#imageMinHeight = value;\n\t\t}\n\t}\n\n\tgetImageMaxWidth(): number\n\t{\n\t\treturn this.#imageMaxWidth;\n\t}\n\n\tsetImageMaxWidth(value: number): void\n\t{\n\t\tif (Type.isNumber(value) && value > 0)\n\t\t{\n\t\t\tthis.#imageMaxWidth = value;\n\t\t}\n\t}\n\n\tgetImageMaxHeight(): number\n\t{\n\t\treturn this.#imageMaxHeight;\n\t}\n\n\tsetImageMaxHeight(value: number): void\n\t{\n\t\tif (Type.isNumber(value) && value > 0)\n\t\t{\n\t\t\tthis.#imageMaxHeight = value;\n\t\t}\n\t}\n\n\tgetIgnoreUnknownImageTypes(): boolean\n\t{\n\t\treturn this.#ignoreUnknownImageTypes;\n\t}\n\n\tsetIgnoreUnknownImageTypes(value: boolean): void\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\tthis.#ignoreUnknownImageTypes = value;\n\t\t}\n\t}\n\n\tsetTreatOversizeImageAsFile(value: boolean): void\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\tthis.#treatOversizeImageAsFile = value;\n\t\t}\n\t}\n\n\tshouldTreatOversizeImageAsFile(): boolean\n\t{\n\t\treturn this.#treatOversizeImageAsFile;\n\t}\n}\n","import createUniqueId from './create-unique-id';\n\nconst createWorker = (fn: Function) => {\n\tconst workerBlob = new Blob(['(', fn.toString(), ')()'], { type: 'application/javascript' });\n\tconst workerURL = URL.createObjectURL(workerBlob);\n\tconst worker = new Worker(workerURL);\n\n\treturn {\n\t\tpost: (message, callback, transfer): void => {\n\t\t\tconst id = createUniqueId();\n\t\t\tworker.onmessage = event => {\n\t\t\t\tif (event.data.id === id)\n\t\t\t\t{\n\t\t\t\t\tcallback(event.data.message);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tworker.postMessage({ id, message }, transfer);\n\t\t},\n\t\tterminate: (): void => {\n\t\t\tworker.terminate();\n\t\t\tURL.revokeObjectURL(workerURL);\n\t\t},\n\t};\n};\n\nexport default createWorker;\n","const BitmapWorker = function() {\n\tself.onmessage = (event: MessageEvent) => {\n\t\t// Hack for Safari. Workers can become unpredictable.\n\t\t// Sometimes 'self.postMessage' doesn't emit 'onmessage' event.\n\t\tsetTimeout(() => {\n\t\t\tcreateImageBitmap(event.data.message.file)\n\t\t\t\t.then((bitmap: ImageBitmap) => {\n\t\t\t\t\tself.postMessage({ id: event?.data?.id, message: bitmap }, [bitmap]);\n\t\t\t\t})\n\t\t\t\t.catch(() => {\n\t\t\t\t\tself.postMessage({ id: event.data.id, message: null }, []);\n\t\t\t\t})\n\t\t\t;\n\t\t}, 0);\n\t};\n};\n\nexport default BitmapWorker;\n","/* eslint-disable no-new-func */\n\nconst ResizeWorker = (): void => {\n\tself.onmessage = (event: MessageEvent): void => {\n\t\t// Hack for Safari. Workers can become unpredictable.\n\t\t// Sometimes 'self.postMessage' doesn't emit 'onmessage' event.\n\t\tsetTimeout((): void => {\n\t\t\tconst {\n\t\t\t\tfile,\n\t\t\t\toptions = {},\n\t\t\t\tgetResizedImageSizeSource,\n\t\t\t\tcreateImagePreviewCanvasSource,\n\t\t\t\tsharpenSource,\n\t\t\t\tshouldSharpenSource,\n\t\t\t\t/* type, */\n\t\t\t} = event.data.message;\n\n\t\t\tcreateImageBitmap(file)\n\t\t\t\t.then((bitmap: ImageBitmap) => {\n\t\t\t\t\tconst getResizedImageSize = new Function(`return ${getResizedImageSizeSource}`)();\n\t\t\t\t\tconst { targetWidth, targetHeight, useOriginalSize } = getResizedImageSize(bitmap, options);\n\n\t\t\t\t\tif (useOriginalSize)\n\t\t\t\t\t{\n\t\t\t\t\t\tbitmap.close();\n\n\t\t\t\t\t\tself.postMessage({\n\t\t\t\t\t\t\tid: event?.data?.id,\n\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\tuseOriginalSize,\n\t\t\t\t\t\t\t\ttargetWidth,\n\t\t\t\t\t\t\t\ttargetHeight,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}, []);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconst createImagePreviewCanvas = new Function(`return ${createImagePreviewCanvasSource}`)();\n\t\t\t\t\t\tlet offscreenCanvas: OffscreenCanvas = createImagePreviewCanvas(bitmap, targetWidth, targetHeight);\n\n\t\t\t\t\t\tconst sharpen = new Function(`return ${sharpenSource}`)();\n\t\t\t\t\t\tconst shouldSharpen = new Function(`return ${shouldSharpenSource}`)();\n\t\t\t\t\t\tif (shouldSharpen(bitmap, targetWidth, targetHeight))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsharpen(offscreenCanvas, targetWidth, targetHeight, 0.2);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbitmap.close();\n\n\t\t\t\t\t\tconst previewBitmap = offscreenCanvas.transferToImageBitmap();\n\n\t\t\t\t\t\toffscreenCanvas.width = 0;\n\t\t\t\t\t\toffscreenCanvas.height = 0;\n\t\t\t\t\t\toffscreenCanvas = null;\n\n\t\t\t\t\t\tself.postMessage({\n\t\t\t\t\t\t\tid: event?.data?.id,\n\t\t\t\t\t\t\tmessage: {\n\t\t\t\t\t\t\t\tbitmap: previewBitmap,\n\t\t\t\t\t\t\t\tuseOriginalSize,\n\t\t\t\t\t\t\t\ttargetWidth,\n\t\t\t\t\t\t\t\ttargetHeight,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}, [previewBitmap]);\n\n\t\t\t\t\t\t// const { quality = 0.92 } = options;\n\t\t\t\t\t\t// offscreenCanvas.convertToBlob({ quality, type })\n\t\t\t\t\t\t// \t.then((blob: Blob): void => {\n\t\t\t\t\t\t// \t\tself.postMessage({\n\t\t\t\t\t\t// \t\t\tid: event?.data?.id,\n\t\t\t\t\t\t// \t\t\tmessage: {\n\t\t\t\t\t\t// \t\t\t\tblob,\n\t\t\t\t\t\t// \t\t\t\tuseOriginalSize,\n\t\t\t\t\t\t// \t\t\t\ttargetWidth,\n\t\t\t\t\t\t// \t\t\t\ttargetHeight,\n\t\t\t\t\t\t// \t\t\t},\n\t\t\t\t\t\t// \t\t}, []);\n\t\t\t\t\t\t// \t})\n\t\t\t\t\t\t// \t.catch((error): void => {\n\t\t\t\t\t\t// \t\tconsole.log('Resize Worker Error (convertToBlob)', error);\n\t\t\t\t\t\t// \t\tself.postMessage({\n\t\t\t\t\t\t// \t\t\tid: event.data.id,\n\t\t\t\t\t\t// \t\t\tmessage: null,\n\t\t\t\t\t\t// \t\t}, []);\n\t\t\t\t\t\t// \t})\n\t\t\t\t\t\t// ;\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((error): void => {\n\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\tconsole.log('Uploader: Resize Worker Error (createImageBitmap)', error);\n\t\t\t\t\tself.postMessage({\n\t\t\t\t\t\tid: event.data.id,\n\t\t\t\t\t\tmessage: null,\n\t\t\t\t\t}, []);\n\t\t\t\t})\n\t\t\t;\n\t\t}, 0);\n\t};\n};\n\nexport default ResizeWorker;\n","const loadImage = (file: File | Blob) => new Promise((resolve, reject) => {\n\tconst image: HTMLImageElement = document.createElement('img');\n\tconst url = URL.createObjectURL(file);\n\timage.src = url;\n\n\timage.onerror = (error) => {\n\t\tURL.revokeObjectURL(image.src);\n\t\treject(error);\n\t};\n\n\timage.onload = () => {\n\t\tURL.revokeObjectURL(url);\n\t\tresolve({\n\t\t\twidth: image.naturalWidth,\n\t\t\theight: image.naturalHeight,\n\t\t\timage,\n\t\t});\n\t};\n});\n\nexport default loadImage;\n","/* eslint-disable @bitrix24/bitrix24-rules/no-typeof */\n\n// Warning!\n// This function uses in a resize workers.\n// You cannot import anything from other files and extensions.\nconst createImagePreviewCanvas = (\n\timageSource: CanvasImageSource,\n\tnewWidth: number,\n\tnewHeight: number,\n): HTMLCanvasElement | OffscreenCanvas => {\n\tconst width: number = Math.round(newWidth);\n\tconst height: number = Math.round(newHeight);\n\n\tconst isPageContext: boolean = (\n\t\ttypeof (window) !== 'undefined'\n\t\t&& typeof (document) !== 'undefined'\n\t\t&& typeof (parent) !== 'undefined'\n\t);\n\n\tconst createCanvas = (canvasWidth: number, canvasHeight: number): HTMLCanvasElement | OffscreenCanvas => {\n\t\tif (isPageContext)\n\t\t{\n\t\t\tconst canvas: HTMLCanvasElement = document.createElement('canvas');\n\t\t\tcanvas.width = canvasWidth;\n\t\t\tcanvas.height = canvasHeight;\n\n\t\t\treturn canvas;\n\t\t}\n\n\t\treturn new OffscreenCanvas(canvasWidth, canvasHeight);\n\t};\n\n\tif (imageSource.height <= height && imageSource.width <= width)\n\t{\n\t\tconst canvas: HTMLCanvasElement = createCanvas(width, height);\n\t\tconst context: CanvasRenderingContext2D = canvas.getContext('2d');\n\t\tcontext.imageSmoothingQuality = 'high';\n\t\tcontext.drawImage(imageSource, 0, 0, width, height);\n\n\t\treturn canvas;\n\t}\n\n\tlet currentImageWidth: number = Math.floor(imageSource.width);\n\tlet currentImageHeight: number = Math.floor(imageSource.height);\n\tlet currentImageSource: CanvasImageSource = imageSource;\n\tlet resizingCanvas: HTMLCanvasElement = null;\n\n\twhile (currentImageWidth * 0.5 > width)\n\t{\n\t\tconst halfImageWidth: number = Math.floor(currentImageWidth * 0.5);\n\t\tconst halfImageHeight: number = Math.floor(currentImageHeight * 0.5);\n\n\t\tresizingCanvas = createCanvas(halfImageWidth, halfImageHeight);\n\t\tconst resizingCanvasContext: CanvasRenderingContext2D = resizingCanvas.getContext('2d');\n\t\tresizingCanvasContext.imageSmoothingQuality = 'high';\n\n\t\tresizingCanvasContext.drawImage(\n\t\t\tcurrentImageSource,\n\t\t\t0,\n\t\t\t0,\n\t\t\tcurrentImageWidth,\n\t\t\tcurrentImageHeight,\n\t\t\t0,\n\t\t\t0,\n\t\t\thalfImageWidth,\n\t\t\thalfImageHeight,\n\t\t);\n\n\t\tcurrentImageWidth = halfImageWidth;\n\t\tcurrentImageHeight = halfImageHeight;\n\t\tcurrentImageSource = resizingCanvas;\n\t}\n\n\tconst outputCanvas: HTMLCanvasElement = createCanvas(width, height);\n\tconst outputCanvasContext: CanvasRenderingContext2D = outputCanvas.getContext('2d');\n\toutputCanvasContext.imageSmoothingQuality = 'high';\n\toutputCanvasContext.drawImage(\n\t\tresizingCanvas === null ? imageSource : resizingCanvas,\n\t\t0,\n\t\t0,\n\t\tcurrentImageWidth,\n\t\tcurrentImageHeight,\n\t\t0,\n\t\t0,\n\t\twidth,\n\t\theight,\n\t);\n\n\tif (resizingCanvas)\n\t{\n\t\tresizingCanvas.width = 0;\n\t\tresizingCanvas.height = 0;\n\t\tresizingCanvas = null;\n\n\t\tcurrentImageSource.width = 0;\n\t\tcurrentImageSource.height = 0;\n\t\tcurrentImageSource = null;\n\t}\n\n\treturn outputCanvas;\n};\n\nexport default createImagePreviewCanvas;\n","import type { ResizeImageOptions } from '../types/resize-image-options';\n\ntype ImageData = ImageBitmap | HTMLImageElement | { width: number, height: number };\ntype ResizedImageSizeResult = { targetWidth: number, targetHeight: number, useOriginalSize: boolean };\n\nconst getResizedImageSize = (imageData: ImageData, options: ResizeImageOptions): ResizedImageSizeResult => {\n\tconst { mode = 'contain', upscale = false } = options;\n\tlet { width, height } = options;\n\n\tif (!width && !height)\n\t{\n\t\treturn {\n\t\t\ttargetWidth: 0,\n\t\t\ttargetHeight: 0,\n\t\t\tuseOriginalSize: true,\n\t\t};\n\t}\n\n\tif (width === null)\n\t{\n\t\twidth = height;\n\t}\n\telse if (height === null)\n\t{\n\t\theight = width;\n\t}\n\n\tif (mode !== 'force')\n\t{\n\t\tconst ratioWidth = width / imageData.width;\n\t\tconst ratioHeight = height / imageData.height;\n\t\tlet ratio = 1;\n\n\t\tif (mode === 'cover')\n\t\t{\n\t\t\tratio = Math.max(ratioWidth, ratioHeight);\n\t\t}\n\t\telse if (mode === 'contain')\n\t\t{\n\t\t\tratio = Math.min(ratioWidth, ratioHeight);\n\t\t}\n\n\t\t// if image is too small, exit here with original image\n\t\tif (ratio > 1 && upscale === false)\n\t\t{\n\t\t\treturn {\n\t\t\t\ttargetWidth: imageData.width,\n\t\t\t\ttargetHeight: imageData.height,\n\t\t\t\tuseOriginalSize: true,\n\t\t\t};\n\t\t}\n\n\t\twidth = imageData.width * ratio;\n\t\theight = imageData.height * ratio;\n\t}\n\n\t/*\n\tif (mode === 'crop')\n\t{\n\t\tconst sourceImageRatio = sourceImageWidth / sourceImageHeight;\n\t\tconst targetRatio = targetWidth / targetHeight;\n\n\t\tif (sourceImageRatio > targetRatio)\n\t\t{\n\t\t\tconst newWidth = sourceImageHeight * targetRatio;\n\t\t\tsrcX = (sourceImageWidth - newWidth) / 2;\n\t\t\tsourceImageWidth = newWidth;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst newHeight = sourceImageWidth / targetRatio;\n\t\t\tsrcY = (sourceImageHeight - newHeight) / 2;\n\t\t\tsourceImageHeight = newHeight;\n\t\t}\n\n\t\tcontext.drawImage(image, srcX, srcY, sourceImageWidth, sourceImageHeight, 0, 0, targetWidth, targetHeight);\n\t}\n\t*/\n\n\treturn {\n\t\ttargetWidth: Math.floor(width),\n\t\ttargetHeight: Math.floor(height),\n\t\tuseOriginalSize: false,\n\t};\n};\n\nexport default getResizedImageSize;\n","import { Type } from 'main.core';\nimport createBlobFromDataUri from './create-blob-from-data-uri';\n\nconst canvasPrototype = window.HTMLCanvasElement && window.HTMLCanvasElement.prototype;\nconst hasToBlobSupport = window.HTMLCanvasElement && canvasPrototype.toBlob;\nconst canUseOffscreenCanvas: boolean = !Type.isUndefined(window.OffscreenCanvas);\n\nconst convertCanvasToBlob = (canvas: HTMLCanvasElement, type: string, quality: number): Promise<Blob> => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (canUseOffscreenCanvas && (canvas instanceof OffscreenCanvas))\n\t\t{\n\t\t\tcanvas.convertToBlob({ type, quality }).then((blob: Blob) => {\n\t\t\t\tresolve(blob);\n\t\t\t}).catch((error) => {\n\t\t\t\treject(error);\n\t\t\t});\n\t\t}\n\t\telse if (hasToBlobSupport)\n\t\t{\n\t\t\tcanvas.toBlob((blob: Blob) => {\n\t\t\t\tresolve(blob);\n\t\t\t}, type, quality);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst blob = createBlobFromDataUri(canvas.toDataURL(type, quality));\n\n\t\t\tresolve(blob);\n\t\t}\n\t});\n};\n\nexport default convertCanvasToBlob;\n","import { Browser } from 'main.core';\n\nconst supportedMimeTypes: string[] = (\n\tBrowser.isSafari()\n\t\t? ['image/jpeg', 'image/png']\n\t\t: ['image/jpeg', 'image/png', 'image/webp']\n);\n\nconst isSupportedMimeType = (mimeType: string): boolean => {\n\treturn supportedMimeTypes.includes(mimeType);\n};\n\nexport default isSupportedMimeType;\n","export const sharpen = (\n\tcanvas: HTMLCanvasElement | OffscreenCanvas,\n\twidth: number,\n\theight: number,\n\tmixFactor: number,\n): void => {\n\tconst context: CanvasRenderingContext2D = canvas.getContext('2d');\n\tconst weights: number[] = [0, -1, 0, -1, 5, -1, 0, -1, 0];\n\tconst katet: number = Math.round(Math.sqrt(weights.length));\n\tconst half: number = Math.trunc(katet * 0.5);\n\tconst destinationData: ImageData = context.createImageData(width, height);\n\tconst destinationBuffer: Uint8ClampedArray = destinationData.data;\n\tconst sourceBuffer: Uint8ClampedArray = context.getImageData(0, 0, width, height).data;\n\tlet y: number = height;\n\twhile (y--)\n\t{\n\t\tlet x: number = width;\n\t\twhile (x--)\n\t\t{\n\t\t\tconst sy: number = y;\n\t\t\tconst sx: number = x;\n\t\t\tconst dstOff: number = (y * width + x) * 4;\n\t\t\tlet red = 0;\n\t\t\tlet green = 0;\n\t\t\tlet blue = 0;\n\t\t\t// let alpha = 0;\n\n\t\t\tfor (let cy = 0; cy < katet; cy++)\n\t\t\t{\n\t\t\t\tfor (let cx = 0; cx < katet; cx++)\n\t\t\t\t{\n\t\t\t\t\tconst scy: number = sy + cy - half;\n\t\t\t\t\tconst scx: number = sx + cx - half;\n\t\t\t\t\tif (scy >= 0 && scy < height && scx >= 0 && scx < width)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst srcOff: number = (scy * width + scx) * 4;\n\t\t\t\t\t\tconst wt: number = weights[cy * katet + cx];\n\t\t\t\t\t\tred += sourceBuffer[srcOff] * wt;\n\t\t\t\t\t\tgreen += sourceBuffer[srcOff + 1] * wt;\n\t\t\t\t\t\tblue += sourceBuffer[srcOff + 2] * wt;\n\t\t\t\t\t\t// alpha += sourceBuffer[srcOff + 3] * wt;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdestinationBuffer[dstOff] = red * mixFactor + sourceBuffer[dstOff] * (1 - mixFactor);\n\t\t\tdestinationBuffer[dstOff + 1] = green * mixFactor + sourceBuffer[dstOff + 1] * (1 - mixFactor);\n\t\t\tdestinationBuffer[dstOff + 2] = blue * mixFactor + sourceBuffer[dstOff + 2] * (1 - mixFactor);\n\t\t\tdestinationBuffer[dstOff + 3] = sourceBuffer[dstOff + 3];\n\t\t}\n\t}\n\n\tcontext.putImageData(destinationData, 0, 0);\n};\n\nexport const shouldSharpen = (imageData: CanvasImageSource, width: number, height: number): boolean => {\n\tconst scaleX: number = width / imageData.width;\n\tconst scaleY: number = height / imageData.height;\n\n\tconst scale: number = Math.min(scaleX, scaleY);\n\n\t// if target scale is less than half\n\treturn scale < 0.5;\n};\n","import getResizedImageSize from './get-resized-image-size';\nimport createImagePreviewCanvas from './create-image-preview-canvas';\nimport convertCanvasToBlob from './convert-canvas-to-blob';\nimport isSupportedMimeType from './is-supported-mime-type';\nimport { sharpen, shouldSharpen } from './sharpen';\n\nimport type { ResizeImageMimeType, ResizeImageOptions } from '../types/resize-image-options';\n\nconst createImagePreview = (imageData: ImageBitmap | HTMLImageElement, options: ResizeImageOptions): Promise => {\n\tconst { targetWidth, targetHeight } = getResizedImageSize(imageData, options);\n\n\tconst canvas: HTMLCanvasElement = createImagePreviewCanvas(imageData, targetWidth, targetHeight);\n\tif (shouldSharpen(imageData, targetWidth, targetHeight))\n\t{\n\t\tsharpen(canvas, targetWidth, targetHeight, 0.2);\n\t}\n\n\tconst { quality = 0.92 } = options;\n\tconst mimeType: ResizeImageMimeType = isSupportedMimeType(options.mimeType) ? options.mimeType : 'image/jpeg';\n\n\treturn convertCanvasToBlob(canvas, mimeType, quality).then((blob) => {\n\t\treturn {\n\t\t\twidth: targetWidth,\n\t\t\theight: targetHeight,\n\t\t\tblob,\n\t\t};\n\t});\n};\n\nexport default createImagePreview;\n","import isSupportedMimeType from './is-supported-mime-type';\n\nimport type { ResizeImageOptions, ResizeImageMimeTypeMode, ResizeImageMimeType } from '../types/resize-image-options';\n\nconst getCanvasToBlobType = (blob: Blob, options: ResizeImageOptions): string => {\n\tconst mimeType: ResizeImageMimeType = isSupportedMimeType(options.mimeType) ? options.mimeType : 'image/jpeg';\n\tconst mimeTypeMode: ResizeImageMimeTypeMode = options.mimeTypeMode;\n\tif (mimeTypeMode === 'force')\n\t{\n\t\treturn mimeType;\n\t}\n\n\treturn isSupportedMimeType(blob.type) ? blob.type : mimeType;\n};\n\nexport default getCanvasToBlobType;\n","const getFilenameWithoutExtension = (name) => {\n\treturn name.slice(0, Math.max(0, name.lastIndexOf('.'))) || name;\n};\n\nexport default getFilenameWithoutExtension;\n","import getFilenameWithoutExtension from './get-filename-without-extension';\n\nconst extensionMap = {\n\tjpeg: 'jpg',\n};\n\nconst renameFileToMatchMimeType = (filename, mimeType) => {\n\tconst name = getFilenameWithoutExtension(filename);\n\tconst type = mimeType.split('/')[1];\n\tconst extension = extensionMap[type] || type;\n\n\treturn `${name}.${extension}`;\n};\n\nexport default renameFileToMatchMimeType;\n","import { Browser, Type } from 'main.core';\n\nimport createWorker from './create-worker';\nimport BitmapWorker from './bitmap-worker';\nimport ResizeWorker from './resize-worker';\nimport loadImage from './load-image';\nimport createImagePreviewCanvas from './create-image-preview-canvas';\nimport createImagePreview from './create-image-preview';\nimport getCanvasToBlobType from './get-canvas-to-blob-type';\nimport renameFileToMatchMimeType from './rename-file-to-match-mime-type';\nimport createFileFromBlob from './create-file-from-blob';\nimport getResizedImageSize from './get-resized-image-size';\nimport { sharpen, shouldSharpen } from './sharpen';\n\nimport type { ResizeImageOptions } from '../types/resize-image-options';\nimport type { ResizeImageResult } from '../types/resize-image-result';\nimport convertCanvasToBlob from './convert-canvas-to-blob';\n\nlet canCreateImageBitmap = (\n\t'createImageBitmap' in window\n\t&& !Type.isUndefined(window.ImageBitmap)\n\t&& ImageBitmap.prototype\n\t&& ImageBitmap.prototype.close\n);\n\nif (canCreateImageBitmap && Browser.isSafari())\n{\n\tconst ua = navigator.userAgent.toLowerCase();\n\tconst regex = /version\\/([\\d.]+)/i;\n\tconst result = regex.exec(ua);\n\tif (result && result[1] && result[1] < '16.4')\n\t{\n\t\t// Webkit bug https://bugs.webkit.org/show_bug.cgi?id=223326\n\t\tcanCreateImageBitmap = false;\n\t}\n}\n\nconst createImagePreviewCanvasSource = createImagePreviewCanvas.toString();\nconst getResizedImageSizeSource = getResizedImageSize.toString();\nconst sharpenSource = sharpen.toString();\nconst shouldSharpenSource = shouldSharpen.toString();\nconst canUseOffscreenCanvas: boolean = canCreateImageBitmap && !Type.isUndefined(window.OffscreenCanvas);\n\n// eslint-disable-next-line max-lines-per-function\nconst resizeImage = (source: Blob | File, options: ResizeImageOptions): Promise<ResizeImageResult> => {\n\t// eslint-disable-next-line max-lines-per-function\n\treturn new Promise((resolve, reject) => {\n\t\tif (canUseOffscreenCanvas)\n\t\t{\n\t\t\tconst resizeWorker = createWorker(ResizeWorker);\n\t\t\tconst type: string = getCanvasToBlobType(source, options);\n\n\t\t\tresizeWorker.post(\n\t\t\t\t{\n\t\t\t\t\tfile: source,\n\t\t\t\t\ttype,\n\t\t\t\t\toptions,\n\t\t\t\t\tcreateImagePreviewCanvasSource,\n\t\t\t\t\tgetResizedImageSizeSource,\n\t\t\t\t\tsharpenSource,\n\t\t\t\t\tshouldSharpenSource,\n\t\t\t\t},\n\t\t\t\t(message): void => {\n\t\t\t\t\tresizeWorker.terminate();\n\t\t\t\t\tif (message)\n\t\t\t\t\t{\n\t\t\t\t\t\tconst { bitmap, targetWidth, targetHeight, useOriginalSize } = message;\n\t\t\t\t\t\tif (useOriginalSize)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\tpreview: source,\n\t\t\t\t\t\t\t\twidth: targetWidth,\n\t\t\t\t\t\t\t\theight: targetHeight,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet canvas: HTMLCanvasElement = document.createElement('canvas');\n\t\t\t\t\t\t\tcanvas.width = bitmap.width;\n\t\t\t\t\t\t\tcanvas.height = bitmap.height;\n\t\t\t\t\t\t\tconst context = canvas.getContext('bitmaprenderer');\n\t\t\t\t\t\t\tcontext.transferFromImageBitmap(bitmap);\n\n\t\t\t\t\t\t\t// console.log('bitmaprenderer');\n\n\t\t\t\t\t\t\tconst { quality = 0.92 } = options;\n\t\t\t\t\t\t\tconvertCanvasToBlob(canvas, type, quality).then((blob) => {\n\t\t\t\t\t\t\t\tlet preview: Blob = blob;\n\t\t\t\t\t\t\t\tif (Type.isFile(source))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t// File type could be changed pic.gif -> pic.jpg\n\t\t\t\t\t\t\t\t\tconst newFileName = renameFileToMatchMimeType(source.name, type);\n\t\t\t\t\t\t\t\t\tpreview = createFileFromBlob(blob, newFileName);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\tpreview,\n\t\t\t\t\t\t\t\t\twidth: targetWidth,\n\t\t\t\t\t\t\t\t\theight: targetHeight,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}).catch((error) => {\n\t\t\t\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\t\t\t\tconsole.log('Uploader: convertCanvasToBlob error', error);\n\t\t\t\t\t\t\t\tloadImageDataFallback();\n\t\t\t\t\t\t\t}).finally(() => {\n\t\t\t\t\t\t\t\tcanvas.width = 0;\n\t\t\t\t\t\t\t\tcanvas.height = 0;\n\t\t\t\t\t\t\t\tcanvas = null;\n\n\t\t\t\t\t\t\t\tbitmap.close();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// let preview: Blob = blob;\n\t\t\t\t\t\t\t// if (Type.isFile(source))\n\t\t\t\t\t\t\t// {\n\t\t\t\t\t\t\t// \t// File type could be changed pic.gif -> pic.jpg\n\t\t\t\t\t\t\t// \tconst newFileName = renameFileToMatchMimeType(source.name, type);\n\t\t\t\t\t\t\t// \tpreview = createFileFromBlob(blob, newFileName);\n\t\t\t\t\t\t\t// }\n\t\t\t\t\t\t\t//\n\t\t\t\t\t\t\t// resolve({\n\t\t\t\t\t\t\t// \tpreview,\n\t\t\t\t\t\t\t// \twidth: targetWidth,\n\t\t\t\t\t\t\t// \theight: targetHeight,\n\t\t\t\t\t\t\t// });\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tloadImageDataFallback();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\telse if (canCreateImageBitmap)\n\t\t{\n\t\t\tconst bitmapWorker = createWorker(BitmapWorker);\n\t\t\tbitmapWorker.post(\n\t\t\t\t{ file: source },\n\t\t\t\t(imageBitmap: ImageBitmap): void => {\n\t\t\t\t\tbitmapWorker.terminate();\n\t\t\t\t\tif (imageBitmap)\n\t\t\t\t\t{\n\t\t\t\t\t\thandleImageLoad(imageBitmap);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tloadImageDataFallback();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tloadImageDataFallback();\n\t\t}\n\n\t\tfunction handleImageLoad(imageData: ImageBitmap | HTMLImageElement): void\n\t\t{\n\t\t\tconst { useOriginalSize, targetWidth, targetHeight } = getResizedImageSize(imageData, options);\n\t\t\tif (useOriginalSize)\n\t\t\t{\n\t\t\t\t// if it was ImageBitmap\n\t\t\t\tif ('close' in imageData)\n\t\t\t\t{\n\t\t\t\t\timageData.close();\n\t\t\t\t}\n\n\t\t\t\tresolve({\n\t\t\t\t\tpreview: source,\n\t\t\t\t\twidth: targetWidth,\n\t\t\t\t\theight: targetHeight,\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconst mimeType: string = getCanvasToBlobType(source, options);\n\t\t\t\tcreateImagePreview(imageData, { ...options, mimeType })\n\t\t\t\t\t.then(({ blob, width, height }): void => {\n\t\t\t\t\t\tlet preview: Blob = blob;\n\t\t\t\t\t\tif (Type.isFile(source))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// File type could be changed pic.gif -> pic.jpg\n\t\t\t\t\t\t\tconst newFileName = renameFileToMatchMimeType(source.name, mimeType);\n\t\t\t\t\t\t\tpreview = createFileFromBlob(blob, newFileName);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve({ preview, width, height });\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t})\n\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t// if it was ImageBitmap\n\t\t\t\t\t\tif ('close' in imageData)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\timageData.close();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\t\t}\n\n\t\tfunction loadImageDataFallback(): void\n\t\t{\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.log('Uploader: resize image fallback');\n\t\t\tloadImage(source)\n\t\t\t\t.then(({ image }) => {\n\t\t\t\t\thandleImageLoad(image);\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treject(error);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t});\n};\n\nexport default resizeImage;\n","import type UploaderFile from '../uploader-file';\n\nconst isVideo = (file: UploaderFile) => {\n\treturn /^video\\/[\\d.a-z-]+$/i.test(file.getType()) || file.getExtension() === 'mkv';\n};\n\nexport default isVideo;\n","import { Event } from 'main.core';\nimport getResizedImageSize from './get-resized-image-size';\nimport type { ResizeImageOptions } from '../types/resize-image-options';\nimport convertCanvasToBlob from './convert-canvas-to-blob';\nimport createImagePreviewCanvas from './create-image-preview-canvas';\n\nconst createVideoPreview = (\n\tblob: Blob,\n\toptions: ResizeImageOptions = { width: 300, height: 3000 },\n\tseekTime: number = 10,\n): Promise => {\n\treturn new Promise((resolve, reject) => {\n\t\tconst video: HTMLVideoElement = document.createElement('video');\n\t\tvideo.setAttribute('src', URL.createObjectURL(blob));\n\t\tvideo.load();\n\n\t\tEvent.bind(video, 'error', (error) => {\n\t\t\treject(error || 'Error while loading video file');\n\t\t});\n\n\t\tEvent.bind(video, 'loadedmetadata', () => {\n\t\t\tvideo.currentTime = video.duration < seekTime ? 0 : seekTime;\n\n\t\t\tEvent.bind(video, 'seeked', () => {\n\t\t\t\tconst imageData = { width: video.videoWidth, height: video.videoHeight };\n\t\t\t\tconst { targetWidth, targetHeight } = getResizedImageSize(imageData, options);\n\t\t\t\tif (!targetWidth || !targetHeight)\n\t\t\t\t{\n\t\t\t\t\treject();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst canvas: HTMLCanvasElement = createImagePreviewCanvas(video, targetWidth, targetHeight);\n\t\t\t\tconst { quality = 0.92, mimeType = 'image/jpeg' } = options;\n\t\t\t\tconvertCanvasToBlob(canvas, mimeType, quality)\n\t\t\t\t\t.then((blob: Blob) => {\n\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\tpreview: blob,\n\t\t\t\t\t\t\twidth: targetWidth,\n\t\t\t\t\t\t\theight: targetHeight,\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\treject();\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t});\n\t\t});\n\t});\n};\n\nexport default createVideoPreview;\n","import { Browser, Type } from 'main.core';\n\nimport Filter from './filter';\nimport resizeImage from '../helpers/resize-image';\nimport isResizableImage from '../helpers/is-resizable-image';\nimport isVideo from '../helpers/is-video';\nimport createVideoPreview from '../helpers/create-video-preview';\n\nimport type UploaderFile from '../uploader-file';\nimport type Uploader from '../uploader';\nimport type { UploaderOptions } from '../types/uploader-options';\nimport type {\n\tResizeImageOptions,\n\tResizeImageMimeTypeMode,\n\tResizeImageMimeType,\n\tResizeImageMode,\n} from '../types/resize-image-options';\n\nexport default class ImagePreviewFilter extends Filter\n{\n\t#imagePreviewWidth: number = 300;\n\t#imagePreviewHeight: number = 300;\n\t#imagePreviewQuality: number = 0.92;\n\t#imagePreviewMimeType: ResizeImageMimeType = 'image/jpeg';\n\t#imagePreviewMimeTypeMode: ResizeImageMimeTypeMode = 'auto';\n\t#imagePreviewUpscale: boolean = false;\n\t#imagePreviewResizeMode: ResizeImageMode = 'contain';\n\t#imagePreviewFilter: Function = null;\n\n\tconstructor(uploader: Uploader, filterOptions: UploaderOptions = {})\n\t{\n\t\tsuper(uploader);\n\n\t\tconst options: UploaderOptions = Type.isPlainObject(filterOptions) ? filterOptions : {};\n\n\t\tthis.setImagePreviewWidth(options.imagePreviewWidth);\n\t\tthis.setImagePreviewHeight(options.imagePreviewHeight);\n\t\tthis.setImagePreviewQuality(options.imagePreviewQuality);\n\t\tthis.setImagePreviewUpscale(options.imagePreviewUpscale);\n\t\tthis.setImagePreviewResizeMode(options.imagePreviewResizeMode);\n\t\tthis.setImagePreviewMimeType(options.imagePreviewMimeType);\n\t\tthis.setImagePreviewMimeTypeMode(options.imagePreviewMimeTypeMode);\n\t\tthis.setImagePreviewFilter(options.imagePreviewFilter);\n\t}\n\n\tapply(file: UploaderFile): Promise\n\t{\n\t\treturn new Promise((resolve): void => {\n\t\t\tif (!file.shouldTreatImageAsFile() && isResizableImage(file.getBinary()))\n\t\t\t{\n\t\t\t\tconst result: boolean | ResizeImageOptions = this.invokeFilter(file);\n\t\t\t\tif (result === false)\n\t\t\t\t{\n\t\t\t\t\tresolve();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst resizeOptions = Type.isPlainObject(result) ? result : {};\n\n\t\t\t\t// const start = performance.now();\n\t\t\t\tresizeImage(file.getBinary(), this.#getResizeImageOptions(resizeOptions))\n\t\t\t\t\t.then(({ preview, width, height }): void => {\n\t\t\t\t\t\t// console.log(`resizeImage took ${performance.now() - start} milliseconds.`);\n\t\t\t\t\t\tfile.setClientPreview(preview, width, height);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error): void => {\n\t\t\t\t\t\tif (error)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\t\t\tconsole.warn('Uploader: image resize error', error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\t\t\telse if (isVideo(file) && !Browser.isSafari())\n\t\t\t{\n\t\t\t\tcreateVideoPreview(file.getBinary(), this.#getResizeImageOptions())\n\t\t\t\t\t.then(({ preview, width, height }): void => {\n\t\t\t\t\t\tfile.setClientPreview(preview, width, height);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error): void => {\n\t\t\t\t\t\tif (error)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\t\t\tconsole.warn('Uploader: video preview error', error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t})\n\t\t\t\t;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresolve();\n\t\t\t}\n\t\t});\n\t}\n\n\tgetImagePreviewWidth(): number\n\t{\n\t\treturn this.#imagePreviewWidth;\n\t}\n\n\tsetImagePreviewWidth(value: number): void\n\t{\n\t\tif (Type.isNumber(value) && value > 0)\n\t\t{\n\t\t\tthis.#imagePreviewWidth = value;\n\t\t}\n\t}\n\n\tgetImagePreviewHeight(): number\n\t{\n\t\treturn this.#imagePreviewHeight;\n\t}\n\n\tsetImagePreviewHeight(value: number): void\n\t{\n\t\tif (Type.isNumber(value) && value > 0)\n\t\t{\n\t\t\tthis.#imagePreviewHeight = value;\n\t\t}\n\t}\n\n\tgetImagePreviewQuality(): number\n\t{\n\t\treturn this.#imagePreviewQuality;\n\t}\n\n\tsetImagePreviewQuality(value: number): void\n\t{\n\t\tif (Type.isNumber(value) && value > 0.1 && value <= 1)\n\t\t{\n\t\t\tthis.#imagePreviewQuality = value;\n\t\t}\n\t}\n\n\tgetImagePreviewUpscale(): boolean\n\t{\n\t\treturn this.#imagePreviewUpscale;\n\t}\n\n\tsetImagePreviewUpscale(value: boolean): void\n\t{\n\t\tif (Type.isBoolean(value))\n\t\t{\n\t\t\tthis.#imagePreviewUpscale = value;\n\t\t}\n\t}\n\n\tgetImagePreviewResizeMode(): ResizeImageMode\n\t{\n\t\treturn this.#imagePreviewResizeMode;\n\t}\n\n\tsetImagePreviewResizeMode(value: ResizeImageMode): void\n\t{\n\t\tif (['contain', 'force', 'cover'].includes(value))\n\t\t{\n\t\t\tthis.#imagePreviewResizeMode = value;\n\t\t}\n\t}\n\n\tgetImagePreviewMimeType(): ResizeImageMimeType\n\t{\n\t\treturn this.#imagePreviewMimeType;\n\t}\n\n\tsetImagePreviewMimeType(value: ResizeImageMimeType): void\n\t{\n\t\tif (['image/jpeg', 'image/png', 'image/webp'].includes(value))\n\t\t{\n\t\t\tthis.#imagePreviewMimeType = value;\n\t\t}\n\t}\n\n\tgetImagePreviewMimeTypeMode(): ResizeImageMimeTypeMode\n\t{\n\t\treturn this.#imagePreviewMimeTypeMode;\n\t}\n\n\tsetImagePreviewMimeTypeMode(value: ResizeImageMimeTypeMode): void\n\t{\n\t\tif (['auto', 'force'].includes(value))\n\t\t{\n\t\t\tthis.#imagePreviewMimeTypeMode = value;\n\t\t}\n\t}\n\n\tsetImagePreviewFilter(fn: Function): void\n\t{\n\t\tif (Type.isFunction(fn))\n\t\t{\n\t\t\tthis.#imagePreviewFilter = fn;\n\t\t}\n\t}\n\n\tinvokeFilter(file: UploaderFile): boolean | ResizeImageOptions\n\t{\n\t\tif (this.#imagePreviewFilter !== null)\n\t\t{\n\t\t\tconst result = this.#imagePreviewFilter(file);\n\t\t\tif (Type.isBoolean(result) || Type.isPlainObject(result))\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t#getResizeImageOptions(overrides: ResizeImageOptions = {}): ResizeImageOptions\n\t{\n\t\treturn {\n\t\t\twidth: Type.isNumber(overrides.width) ? overrides.width : this.getImagePreviewWidth(),\n\t\t\theight: Type.isNumber(overrides.height) ? overrides.height : this.getImagePreviewHeight(),\n\t\t\tmode: Type.isStringFilled(overrides.mode) ? overrides.mode : this.getImagePreviewResizeMode(),\n\t\t\tupscale: Type.isBoolean(overrides.upscale) ? overrides.upscale : this.getImagePreviewUpscale(),\n\t\t\tquality: Type.isNumber(overrides.quality) ? overrides.quality : this.getImagePreviewQuality(),\n\t\t\tmimeType: Type.isStringFilled(overrides.mimeType) ? overrides.mimeType : this.getImagePreviewMimeType(),\n\t\t\tmimeTypeMode:\n\t\t\t\tType.isStringFilled(overrides.mimeTypeMode)\n\t\t\t\t\t? overrides.mimeTypeMode\n\t\t\t\t\t: this.getImagePreviewMimeTypeMode()\n\t\t\t,\n\t\t};\n\t}\n}\n","import { Type } from 'main.core';\nimport Filter from './filter';\n\nimport isResizableImage from '../helpers/is-resizable-image';\nimport resizeImage from '../helpers/resize-image';\n\nimport type Uploader from '../uploader';\nimport type UploaderFile from '../uploader-file';\nimport type { UploaderOptions } from '../types/uploader-options';\nimport type {\n\tResizeImageOptions,\n\tResizeImageMimeTypeMode,\n\tResizeImageMimeType,\n\tResizeImageMode,\n} from '../types/resize-image-options';\n\nexport default class ImageResizeFilter extends Filter\n{\n\t#resizeWidth: number = null;\n\t#resizeHeight: number = null;\n\t#resizeMethod: ResizeImageMode = 'contain';\n\t#resizeMimeType: ResizeImageMimeType = 'image/jpeg';\n\t#resizeMimeTypeMode: ResizeImageMimeTypeMode = 'auto';\n\t#resizeQuality: number = 0.92;\n\t#resizeFilter: Function = null;\n\n\tconstructor(uploader: Uploader, filterOptions: UploaderOptions = {})\n\t{\n\t\tsuper(uploader);\n\n\t\tconst options: UploaderOptions = Type.isPlainObject(filterOptions) ? filterOptions : {};\n\n\t\tthis.setResizeWidth(options.imageResizeWidth);\n\t\tthis.setResizeHeight(options.imageResizeHeight);\n\t\tthis.setResizeMode(options.imageResizeMode);\n\t\tthis.setResizeMimeType(options.imageResizeMimeType);\n\t\tthis.setResizeMimeTypeMode(options.imageResizeMimeTypeMode);\n\t\tthis.setResizeQuality(options.imageResizeQuality);\n\t\tthis.setResizeFilter(options.imageResizeFilter);\n\t}\n\n\tapply(file: UploaderFile): Promise\n\t{\n\t\treturn new Promise((resolve): void => {\n\t\t\tif (this.getResizeWidth() === null && this.getResizeHeight() === null)\n\t\t\t{\n\t\t\t\tresolve();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (file.shouldTreatImageAsFile() || !isResizableImage(file.getBinary()))\n\t\t\t{\n\t\t\t\tresolve();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst result: boolean | ResizeImageOptions = this.invokeFilter(file);\n\t\t\tif (result === false)\n\t\t\t{\n\t\t\t\tresolve();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst overrides = Type.isPlainObject(result) ? result : {};\n\t\t\tconst options: ResizeImageOptions = {\n\t\t\t\twidth: Type.isNumber(overrides.width) ? overrides.width : this.getResizeWidth(),\n\t\t\t\theight: Type.isNumber(overrides.height) ? overrides.height : this.getResizeHeight(),\n\t\t\t\tmode: Type.isStringFilled(overrides.mode) ? overrides.mode : this.getResizeMode(),\n\t\t\t\tquality: Type.isNumber(overrides.quality) ? overrides.quality : this.getResizeQuality(),\n\t\t\t\tmimeType: Type.isStringFilled(overrides.mimeType) ? overrides.mimeType : this.getResizeMimeType(),\n\t\t\t\tmimeTypeMode: (\n\t\t\t\t\tType.isStringFilled(overrides.mimeTypeMode) ? overrides.mimeTypeMode : this.getResizeMimeTypeMode()\n\t\t\t\t),\n\t\t\t};\n\n\t\t\tresizeImage(file.getBinary(), options)\n\t\t\t\t.then(({ preview, width, height }): void => {\n\t\t\t\t\tfile.setWidth(width);\n\t\t\t\t\tfile.setHeight(height);\n\t\t\t\t\tfile.setFile(preview);\n\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t\t.catch((error): void => {\n\t\t\t\t\tif (error)\n\t\t\t\t\t{\n\t\t\t\t\t\t// eslint-disable-next-line no-console\n\t\t\t\t\t\tconsole.warn('image resize error', error);\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve();\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\tgetResizeWidth(): ?number\n\t{\n\t\treturn this.#resizeWidth;\n\t}\n\n\tsetResizeWidth(value: ?number): void\n\t{\n\t\tif ((Type.isNumber(value) && value > 0) || Type.isNull(value))\n\t\t{\n\t\t\tthis.#resizeWidth = value;\n\t\t}\n\t}\n\n\tgetResizeHeight(): ?number\n\t{\n\t\treturn this.#resizeHeight;\n\t}\n\n\tsetResizeHeight(value: ?number): void\n\t{\n\t\tif ((Type.isNumber(value) && value > 0) || Type.isNull(value))\n\t\t{\n\t\t\tthis.#resizeHeight = value;\n\t\t}\n\t}\n\n\tgetResizeMode(): ResizeImageMode\n\t{\n\t\treturn this.#resizeMethod;\n\t}\n\n\tsetResizeMode(value): ResizeImageMode\n\t{\n\t\tif (['contain', 'force', 'cover'].includes(value))\n\t\t{\n\t\t\tthis.#resizeMethod = value;\n\t\t}\n\t}\n\n\tgetResizeMimeType(): ResizeImageMimeType\n\t{\n\t\treturn this.#resizeMimeType;\n\t}\n\n\tsetResizeMimeType(value): ResizeImageMimeType\n\t{\n\t\tif (['image/jpeg', 'image/png', 'image/webp'].includes(value))\n\t\t{\n\t\t\tthis.#resizeMimeType = value;\n\t\t}\n\t}\n\n\tgetResizeMimeTypeMode(): ResizeImageMimeTypeMode\n\t{\n\t\treturn this.#resizeMimeTypeMode;\n\t}\n\n\tsetResizeMimeTypeMode(value): ResizeImageMimeTypeMode\n\t{\n\t\tif (['auto', 'force'].includes(value))\n\t\t{\n\t\t\tthis.#resizeMimeTypeMode = value;\n\t\t}\n\t}\n\n\tgetResizeQuality(): number\n\t{\n\t\treturn this.#resizeQuality;\n\t}\n\n\tsetResizeQuality(value: number): void\n\t{\n\t\tif (Type.isNumber(value) && value > 0.1 && value <= 1)\n\t\t{\n\t\t\tthis.#resizeQuality = value;\n\t\t}\n\t}\n\n\tsetResizeFilter(fn: Function): void\n\t{\n\t\tif (Type.isFunction(fn))\n\t\t{\n\t\t\tthis.#resizeFilter = fn;\n\t\t}\n\t}\n\n\tinvokeFilter(file: UploaderFile): boolean | ResizeImageOptions\n\t{\n\t\tif (this.#resizeFilter !== null)\n\t\t{\n\t\t\tconst result = this.#resizeFilter(file);\n\t\t\tif (Type.isBoolean(result) || Type.isPlainObject(result))\n\t\t\t{\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n}\n","export const UploaderStatus: Object<string, string> = {\n\tSTARTED: 0,\n\tSTOPPED: 1,\n};\n","/**\n * @namespace BX.UI.Uploader\n */\nexport const UploaderEvent = {\n\tUPLOAD_START: 'onUploadStart',\n\tUPLOAD_COMPLETE: 'onUploadComplete',\n\tERROR: 'onError',\n\tMAX_FILE_COUNT_EXCEEDED: 'onMaxFileCountExceeded',\n\tDESTROY: 'onDestroy',\n\tBEFORE_BROWSE: 'onBeforeBrowse',\n\tBEFORE_DROP: 'onBeforeDrop',\n\tBEFORE_PASTE: 'onBeforePaste',\n\tBEFORE_FILES_ADD: 'onBeforeFilesAdd',\n\tFILE_BEFORE_ADD: 'File:onBeforeAdd',\n\tFILE_ADD_START: 'File:onAddStart',\n\tFILE_LOAD_START: 'File:onLoadStart',\n\tFILE_LOAD_PROGRESS: 'File:onLoadProgress',\n\tFILE_LOAD_COMPLETE: 'File:onLoadComplete',\n\tFILE_ERROR: 'File:onError',\n\tFILE_ADD: 'File:onAdd',\n\tFILE_REMOVE: 'File:onRemove',\n\tFILE_UPLOAD_START: 'File:onUploadStart',\n\tFILE_UPLOAD_PROGRESS: 'File:onUploadProgress',\n\tFILE_UPLOAD_COMPLETE: 'File:onUploadComplete',\n\tFILE_COMPLETE: 'File:onComplete',\n\tFILE_STATUS_CHANGE: 'File:onStatusChange',\n\tFILE_STATE_CHANGE: 'File:onStateChange',\n};\n","/**\n * @namespace BX.UI.Uploader\n */\nexport const FilterType = {\n\tVALIDATION: 'validation',\n\tPREPARATION: 'preparation',\n};\n","const getFilesInDirectory = (entry: FileSystemDirectoryEntry): Promise<File[]> => {\n\treturn new Promise((resolve, reject): void => {\n\t\tconst files = [];\n\t\tlet dirCounter = 0;\n\t\tlet fileCounter = 0;\n\n\t\tconst resolveIfDone = (): void => {\n\t\t\tif (fileCounter === 0 && dirCounter === 0)\n\t\t\t{\n\t\t\t\tresolve(files);\n\t\t\t}\n\t\t};\n\n\t\tconst readEntries = (dirEntry: FileSystemDirectoryEntry): void => {\n\t\t\tdirCounter++;\n\t\t\tconst directoryReader: FileSystemDirectoryReader = dirEntry.createReader();\n\t\t\tconst readBatch = (): void => {\n\t\t\t\tdirectoryReader.readEntries((entries: FileSystemEntry[]): void => {\n\t\t\t\t\tif (entries.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tdirCounter--;\n\t\t\t\t\t\tresolveIfDone();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tentries.forEach((fileEntry: FileSystemFileEntry | FileSystemDirectoryEntry): void => {\n\t\t\t\t\t\tif (fileEntry.isDirectory)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treadEntries(fileEntry);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfileCounter++;\n\t\t\t\t\t\t\tfileEntry.file((file: File): void => {\n\t\t\t\t\t\t\t\tfiles.push(file);\n\t\t\t\t\t\t\t\tfileCounter--;\n\t\t\t\t\t\t\t\tresolveIfDone();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treadBatch();\n\t\t\t\t}, reject);\n\t\t\t};\n\n\t\t\treadBatch();\n\t\t};\n\n\t\treadEntries(entry);\n\t});\n};\n\nexport default getFilesInDirectory;\n","const isDirectoryEntry = (item: DataTransferItem): boolean => {\n\treturn 'webkitGetAsEntry' in item && (item.webkitGetAsEntry() || {}).isDirectory === true;\n};\n\nexport default isDirectoryEntry;\n","const isFileSystemItem = (item: DataTransferItem) => {\n\tif ('webkitGetAsEntry' in item)\n\t{\n\t\tconst entry: ?FileSystemEntry = item.webkitGetAsEntry();\n\t\tif (entry)\n\t\t{\n\t\t\treturn entry.isFile || entry.isDirectory;\n\t\t}\n\t}\n\n\treturn item.kind === 'file';\n};\n\nexport default isFileSystemItem;\n","import getFilesInDirectory from './get-files-in-directory';\nimport isDirectoryEntry from './is-directory-entry';\nimport isFileSystemItem from './is-file-system-item';\n\nconst getFilesFromItem = (item: DataTransferItem): Promise<File[]> => {\n\treturn new Promise((resolve, reject): void => {\n\t\tif (isDirectoryEntry(item))\n\t\t{\n\t\t\tgetFilesInDirectory(item.webkitGetAsEntry())\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch(reject)\n\t\t\t;\n\n\t\t\treturn;\n\t\t}\n\n\t\tresolve([item.getAsFile()]);\n\t});\n};\n\nexport const getFilesFromDataTransfer = (dataTransfer: DataTransfer, browseFolders = true): Promise<File[]> => {\n\treturn new Promise((resolve, reject): void => {\n\t\tif (!dataTransfer.items || dataTransfer.items.length === 0)\n\t\t{\n\t\t\tresolve(dataTransfer.files ? [...dataTransfer.files] : []);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst items: Promise[] = [...dataTransfer.items]\n\t\t\t.filter((item: DataTransferItem): boolean => {\n\t\t\t\treturn browseFolders ? isFileSystemItem(item) : item.kind === 'file';\n\t\t\t})\n\t\t\t.map((item: DataTransferItem): Promise => {\n\t\t\t\treturn getFilesFromItem(item);\n\t\t\t})\n\t\t;\n\n\t\tPromise.all(items)\n\t\t\t.then((fileGroups: Array<File[]>): void => {\n\t\t\t\tconst files = [];\n\t\t\t\tfileGroups.forEach((group: File[]): void => {\n\t\t\t\t\tfiles.push(...group);\n\t\t\t\t});\n\n\t\t\t\tresolve(files);\n\t\t\t})\n\t\t\t.catch(reject)\n\t\t;\n\t});\n};\n\nexport const hasDataTransferOnlyFiles = (dataTransfer: DataTransfer, browseFolders = true): Promise<File[]> => {\n\treturn new Promise((resolve, reject): void => {\n\t\tif (!dataTransfer.items)\n\t\t{\n\t\t\tresolve(dataTransfer.files ? dataTransfer.files.length > 0 : false);\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst success: boolean = [...dataTransfer.items].every((item: DataTransferItem): boolean => {\n\t\t\treturn browseFolders ? isFileSystemItem(item) : item.kind === 'file' && !isDirectoryEntry(item);\n\t\t});\n\n\t\tresolve(success);\n\t});\n};\n\nexport const isFilePasted = (dataTransfer: DataTransfer, browseFolders = true): boolean => {\n\tif (!dataTransfer.types.includes('Files'))\n\t{\n\t\treturn false;\n\t}\n\n\tlet files = 0;\n\tlet texts = 0;\n\tconst items: DataTransferItemList = dataTransfer.items;\n\tfor (const item of items)\n\t{\n\t\tif (item.kind === 'string')\n\t\t{\n\t\t\ttexts++;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst isFile = browseFolders ? isFileSystemItem(item) : item.kind === 'file' && !isDirectoryEntry(item);\n\t\t\tif (isFile)\n\t\t\t{\n\t\t\t\tfiles++;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn files >= texts;\n};\n","let result = null;\n\nconst canAppendFileToForm = (): boolean => {\n\tif (result === null)\n\t{\n\t\ttry\n\t\t{\n\t\t\tconst dataTransfer = new DataTransfer();\n\t\t\tconst file = new File(['hello'], 'my.txt');\n\t\t\tdataTransfer.items.add(file);\n\n\t\t\tconst input = document.createElement('input');\n\t\t\tinput.setAttribute('type', 'file');\n\t\t\tinput.files = dataTransfer.files;\n\n\t\t\tresult = input.files.length === 1;\n\t\t}\n\t\tcatch\n\t\t{\n\t\t\tresult = false;\n\t\t}\n\t}\n\n\treturn result;\n};\n\nexport default canAppendFileToForm;\n","import { Type } from 'main.core';\n\nconst assignFileToInput = (input: HTMLInputElement, file: File | File[]) => {\n\ttry\n\t{\n\t\tconst dataTransfer = new DataTransfer();\n\t\tconst files = Type.isArray(file) ? file : [file];\n\n\t\tfiles.forEach((item) => {\n\t\t\tdataTransfer.items.add(item);\n\t\t});\n\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tinput.files = dataTransfer.files;\n\t}\n\tcatch\n\t{\n\t\treturn false;\n\t}\n\n\treturn true;\n};\n\nexport default assignFileToInput;\n","import { Type, Event, Reflection, Dom, Extension, Text, type JsonObject } from 'main.core';\nimport { EventEmitter, BaseEvent } from 'main.core.events';\n\nimport UploaderFile from './uploader-file';\nimport UploaderError from './uploader-error';\nimport Server from './backend/server';\nimport UploadController from './backend/upload-controller';\n\nimport Filter from './filters/filter';\nimport FileSizeFilter from './filters/file-size-filter';\nimport FileTypeFilter from './filters/file-type-filter';\nimport ImageSizeFilter from './filters/image-size-filter';\nimport ImagePreviewFilter from './filters/image-preview-filter';\nimport ImageResizeFilter from './filters/image-resize-filter';\n\nimport { UploaderStatus } from './enums/uploader-status';\nimport { UploaderEvent } from './enums/uploader-event';\nimport { FileStatus } from './enums/file-status';\nimport { FileOrigin } from './enums/file-origin';\nimport { FileEvent } from './enums/file-event';\nimport { FilterType } from './enums/filter-type';\n\nimport { getFilesFromDataTransfer, isFilePasted } from './helpers/get-files-from-data-transfer';\nimport canAppendFileToForm from './helpers/can-append-file-to-form';\nimport assignFileToInput from './helpers/assign-file-to-input';\n\nimport type { UploaderOptions } from './types/uploader-options';\nimport type { UploaderFileOptions } from './types/uploader-file-options';\nimport type { ServerOptions } from './types/server-options';\nimport type { RemoveFileOptions } from './types/remove-file-options';\nimport type { DestroyOptions } from './types/destroy-options';\n\nconst instances = new Map();\n\n/**\n * @namespace BX.UI.Uploader\n */\nexport default class Uploader extends EventEmitter\n{\n\t#id: ?string = null;\n\t#files: UploaderFile[] = [];\n\t#multiple: boolean = false;\n\t#autoUpload: boolean = true;\n\t#allowReplaceSingle: boolean = true;\n\t#maxParallelUploads: number = 2;\n\t#maxParallelLoads: number = 10;\n\t#acceptOnlyImages: boolean = false;\n\t#acceptedFileTypes: string[] = [];\n\t#ignoredFileNames: string[] = ['.ds_store', 'thumbs.db', 'desktop.ini'];\n\t#maxFileCount: ?number = null;\n\t#server: Server = null;\n\n\t#hiddenFields: Map<string, HTMLInputElement> = new Map();\n\t#hiddenFieldsContainer: HTMLElement = null;\n\t#hiddenFieldName: string = 'file';\n\t#assignAsFile: boolean = false;\n\t#assignServerFile: boolean = true;\n\n\t#filters: Map<FilterType, Filter[]> = new Map();\n\t#status: UploaderStatus = UploaderStatus.STOPPED;\n\n\t#onBeforeUploadHandler: Function = null;\n\t#onFileStatusChangeHandler: Function = null;\n\t#onFileStateChangeHandler: Function = null;\n\t#onInputFileChangeHandler: Function = null;\n\t#onPasteHandler: Function = null;\n\t#onDropHandler: Function = null;\n\n\t#browsingNodes: Map<HTMLElement, ?Function> = new Map();\n\t#dropNodes: Set<HTMLElement> = new Set();\n\t#pastingNodes: Set<HTMLElement> = new Set();\n\n\t#destroying: boolean = false;\n\n\tstatic getById(id: string): ?Uploader\n\t{\n\t\treturn instances.get(id) || null;\n\t}\n\n\tstatic getInstances(): Uploader[]\n\t{\n\t\treturn [...instances.values()];\n\t}\n\n\tconstructor(uploaderOptions: UploaderOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.UI.Uploader');\n\n\t\tthis.#onBeforeUploadHandler = this.#handleBeforeUpload.bind(this);\n\t\tthis.#onFileStatusChangeHandler = this.#handleFileStatusChange.bind(this);\n\t\tthis.#onFileStateChangeHandler = this.#handleFileStateChange.bind(this);\n\t\tthis.#onInputFileChangeHandler = this.#handleInputFileChange.bind(this);\n\t\tthis.#onPasteHandler = this.#handlePaste.bind(this);\n\t\tthis.#onDropHandler = this.#handleDrop.bind(this);\n\n\t\tconst options: UploaderOptions = Type.isPlainObject(uploaderOptions) ? ({ ...uploaderOptions }) : {};\n\t\tthis.#id = Type.isStringFilled(options.id) ? options.id : `ui-uploader-${Text.getRandom().toLowerCase()}`;\n\t\tthis.#multiple = Type.isBoolean(options.multiple) ? options.multiple : false;\n\n\t\tconst acceptOnlyImages: ?boolean = Type.isBoolean(options.acceptOnlyImages) ? options.acceptOnlyImages : null;\n\t\tconst acceptOnlyImagesGlobal: ?boolean = Uploader.getGlobalOption('acceptOnlyImages', null);\n\t\tthis.setAcceptOnlyImages(acceptOnlyImages || acceptOnlyImagesGlobal);\n\n\t\tif (Type.isString(options.acceptedFileTypes) || Type.isArray(options.acceptedFileTypes))\n\t\t{\n\t\t\tthis.setAcceptedFileTypes(options.acceptedFileTypes);\n\t\t}\n\t\telse if (acceptOnlyImages !== true)\n\t\t{\n\t\t\tconst acceptedFileTypesGlobal = Uploader.getGlobalOption('acceptedFileTypes', null);\n\t\t\tthis.setAcceptedFileTypes(acceptedFileTypesGlobal);\n\t\t}\n\n\t\tconst ignoredFileNames: ?string[] = (\n\t\t\tType.isArray(options.ignoredFileNames)\n\t\t\t\t? options.ignoredFileNames\n\t\t\t\t: Uploader.getGlobalOption('ignoredFileNames', null)\n\t\t);\n\t\tthis.setIgnoredFileNames(ignoredFileNames);\n\n\t\tthis.setMaxFileCount(options.maxFileCount);\n\t\tthis.setAllowReplaceSingle(options.allowReplaceSingle);\n\n\t\tthis.assignBrowse(options.browseElement);\n\t\tthis.assignDropzone(options.dropElement);\n\t\tthis.assignPaste(options.pasteElement);\n\n\t\tthis.setHiddenFieldsContainer(options.hiddenFieldsContainer);\n\t\tthis.setHiddenFieldName(options.hiddenFieldName);\n\t\tthis.setAssignAsFile(options.assignAsFile);\n\t\tthis.setAssignServerFile(options.assignServerFile);\n\n\t\tthis.setAutoUpload(options.autoUpload);\n\t\tthis.setMaxParallelUploads(options.maxParallelUploads);\n\t\tthis.setMaxParallelLoads(options.maxParallelLoads);\n\n\t\tlet serverOptions: ServerOptions = Type.isPlainObject(options.serverOptions) ? options.serverOptions : {};\n\t\tserverOptions = {\n\t\t\tcontroller: options.controller,\n\t\t\tcontrollerOptions: options.controllerOptions,\n\t\t\t...serverOptions,\n\t\t};\n\n\t\tthis.#server = new Server(serverOptions);\n\n\t\tthis.subscribeFromOptions(options.events);\n\n\t\tthis.addFilter(FilterType.VALIDATION, new FileSizeFilter(this, options));\n\t\tthis.addFilter(FilterType.VALIDATION, new FileTypeFilter(this, options));\n\t\tthis.addFilter(FilterType.VALIDATION, new ImageSizeFilter(this, options));\n\t\tthis.addFilter(FilterType.VALIDATION, new ImagePreviewFilter(this, options));\n\t\tthis.addFilter(FilterType.PREPARATION, new ImageResizeFilter(this, options));\n\t\tthis.addFilters(options.filters);\n\n\t\tthis.addFiles(options.files);\n\n\t\tinstances.set(this.#id, this);\n\t}\n\n\tstatic getGlobalOption(path: string, defaultValue: any = null): any\n\t{\n\t\tconst globalOptions = Extension.getSettings('ui.uploader.core');\n\n\t\treturn globalOptions.get(path, defaultValue);\n\t}\n\n\taddFiles(fileList: ArrayLike): UploaderFile[]\n\t{\n\t\tif (!Type.isArrayLike(fileList))\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst files: UploaderFile[] = [];\n\t\t[...fileList].forEach((item) => {\n\t\t\tif (item instanceof UploaderFile)\n\t\t\t{\n\t\t\t\tif (item.getStatus() === FileStatus.INIT)\n\t\t\t\t{\n\t\t\t\t\tfiles.push(item);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (Type.isArrayFilled(item))\n\t\t\t{\n\t\t\t\tfiles.push(new UploaderFile(item[0], item[1]));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfiles.push(new UploaderFile(item));\n\t\t\t}\n\t\t});\n\n\t\tconst event: BaseEvent = new BaseEvent({ data: { files: [...files] } });\n\t\tthis.emit(UploaderEvent.BEFORE_FILES_ADD, event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\tconst { error } = event.getData();\n\t\t\tif (error instanceof UploaderError)\n\t\t\t{\n\t\t\t\tthis.emit(UploaderEvent.ERROR, { error });\n\t\t\t}\n\n\t\t\treturn [];\n\t\t}\n\n\t\tif (this.#exceedsMaxFileCount(files))\n\t\t{\n\t\t\treturn [];\n\t\t}\n\n\t\tconst results = [];\n\t\tfiles.forEach((file) => {\n\t\t\tconst result: UploaderFile | null = this.addFile(file);\n\t\t\tif (result !== null)\n\t\t\t{\n\t\t\t\tresults.push(result);\n\t\t\t}\n\t\t});\n\n\t\treturn results;\n\t}\n\n\taddFile(\n\t\tsource: File | Blob | string | number | UploaderFileOptions,\n\t\toptions: UploaderFileOptions,\n\t): UploaderFile | null\n\t{\n\t\tlet file: UploaderFile = null;\n\t\tif (source instanceof UploaderFile)\n\t\t{\n\t\t\tif (source.getStatus() === FileStatus.INIT)\n\t\t\t{\n\t\t\t\tfile = source;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfile = new UploaderFile(source, options);\n\t\t}\n\n\t\tif (this.getIgnoredFileNames().includes(file.getName().toLowerCase()))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this.#exceedsMaxFileCount([file]))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tif (!this.isMultiple() && this.shouldReplaceSingle() && this.#files.length > 0)\n\t\t{\n\t\t\tconst fileToReplace: UploaderFile = this.#files[0];\n\t\t\tthis.removeFile(fileToReplace);\n\t\t}\n\n\t\tconst event: BaseEvent = new BaseEvent({ data: { file } });\n\t\tthis.emit(UploaderEvent.FILE_BEFORE_ADD, event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tfile.subscribe(FileEvent.STATUS_CHANGE, this.#onFileStatusChangeHandler);\n\t\tfile.subscribe(FileEvent.STATE_CHANGE, this.#onFileStateChangeHandler);\n\n\t\tthis.#setUploadEvents(file);\n\t\tthis.#setLoadEvents(file);\n\t\tthis.#setRemoveEvents(file);\n\n\t\tif (!file.isLoadable())\n\t\t{\n\t\t\tif (file.getOrigin() === FileOrigin.SERVER)\n\t\t\t{\n\t\t\t\tconst preloaded: boolean = Type.isStringFilled(file.getName());\n\t\t\t\tif (!preloaded || file.shouldForceServerLoad())\n\t\t\t\t{\n\t\t\t\t\tfile.setLoadController(this.getServer().createServerLoadController());\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfile.setLoadController(this.getServer().createServerlessLoadController());\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tfile.setLoadController(this.getServer().createClientLoadController());\n\t\t\t}\n\t\t}\n\n\t\tif (!file.isUploadable() && file.getOrigin() === FileOrigin.CLIENT)\n\t\t{\n\t\t\tconst uploadController: UploadController | null = this.getServer().createUploadController();\n\t\t\tfile.setUploadController(uploadController);\n\t\t}\n\n\t\tif (!file.isRemoveable())\n\t\t{\n\t\t\tfile.setRemoveController(this.getServer().createRemoveController());\n\t\t}\n\n\t\tthis.#files.push(file);\n\n\t\tfile.emit(FileEvent.ADD);\n\t\tthis.emit(UploaderEvent.FILE_ADD_START, { file });\n\n\t\tif (file.getOrigin() === FileOrigin.CLIENT)\n\t\t{\n\t\t\tthis.#loadNext();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfile.load();\n\t\t}\n\n\t\treturn file;\n\t}\n\n\t#setLoadEvents(file: UploaderFile): void\n\t{\n\t\tfile.subscribeFromOptions({\n\t\t\t[FileEvent.LOAD_START]: (): void => {\n\t\t\t\tthis.emit(UploaderEvent.FILE_LOAD_START, { file });\n\t\t\t},\n\t\t\t[FileEvent.LOAD_PROGRESS]: (event: BaseEvent): void => {\n\t\t\t\tconst { progress } = event.getData();\n\t\t\t\tthis.emit(UploaderEvent.FILE_LOAD_PROGRESS, { file, progress });\n\t\t\t},\n\t\t\t[FileEvent.LOAD_ERROR]: (event: BaseEvent): void => {\n\t\t\t\tconst { error } = event.getData();\n\t\t\t\tthis.emit(UploaderEvent.FILE_ERROR, { file, error });\n\t\t\t\tthis.emit(UploaderEvent.FILE_ADD, { file, error });\n\t\t\t\tthis.#loadNext();\n\t\t\t},\n\t\t\t[FileEvent.LOAD_COMPLETE]: (): void => {\n\t\t\t\tthis.emit(UploaderEvent.FILE_ADD, { file });\n\t\t\t\tthis.emit(UploaderEvent.FILE_LOAD_COMPLETE, { file });\n\n\t\t\t\tif (!file.isUploadable())\n\t\t\t\t{\n\t\t\t\t\tthis.emit(UploaderEvent.FILE_COMPLETE, { file });\n\t\t\t\t\tthis.#setHiddenField(file);\n\t\t\t\t}\n\t\t\t\telse if (this.shouldAutoUpload())\n\t\t\t\t{\n\t\t\t\t\tfile.upload();\n\t\t\t\t}\n\n\t\t\t\tthis.#loadNext();\n\t\t\t},\n\t\t\t[FileEvent.VALIDATE_FILE_ASYNC]: (event: BaseEvent) => {\n\t\t\t\tconst file: UploaderFile = event.getData().file;\n\n\t\t\t\treturn this.#applyFilters(FilterType.VALIDATION, file);\n\t\t\t},\n\t\t\t[FileEvent.PREPARE_FILE_ASYNC]: (event: BaseEvent) => {\n\t\t\t\tconst file: UploaderFile = event.getData().file;\n\n\t\t\t\treturn this.#applyFilters(FilterType.PREPARATION, file);\n\t\t\t},\n\t\t});\n\t}\n\n\t#setUploadEvents(file: UploaderFile): void\n\t{\n\t\tfile.subscribeFromOptions({\n\t\t\t[FileEvent.BEFORE_UPLOAD]: this.#onBeforeUploadHandler,\n\t\t\t[FileEvent.UPLOAD_START]: (): void => {\n\t\t\t\tthis.emit(UploaderEvent.FILE_UPLOAD_START, { file });\n\t\t\t},\n\t\t\t[FileEvent.UPLOAD_PROGRESS]: (event: BaseEvent): void => {\n\t\t\t\tconst { progress } = event.getData();\n\t\t\t\tthis.emit(UploaderEvent.FILE_UPLOAD_PROGRESS, { file, progress });\n\t\t\t},\n\t\t\t[FileEvent.UPLOAD_ERROR]: (event: BaseEvent): void => {\n\t\t\t\tconst { error } = event.getData();\n\t\t\t\tthis.emit(UploaderEvent.FILE_ERROR, { file, error });\n\t\t\t\tthis.#uploadNext();\n\t\t\t},\n\t\t\t[FileEvent.UPLOAD_COMPLETE]: (): void => {\n\t\t\t\tthis.emit(UploaderEvent.FILE_UPLOAD_COMPLETE, { file });\n\t\t\t\tthis.emit(UploaderEvent.FILE_COMPLETE, { file });\n\t\t\t\tthis.#setHiddenField(file);\n\t\t\t\tthis.#uploadNext();\n\t\t\t},\n\t\t});\n\t}\n\n\t#setRemoveEvents(file: UploaderFile): void\n\t{\n\t\tfile.subscribeOnce(FileEvent.REMOVE_ERROR, (event: BaseEvent): void => {\n\t\t\tconst { error } = event.getData();\n\t\t\tthis.emit(UploaderEvent.FILE_ERROR, { file, error });\n\t\t});\n\n\t\tfile.subscribeOnce(FileEvent.REMOVE_COMPLETE, (): void => {\n\t\t\tthis.#removeFile(file);\n\t\t});\n\t}\n\n\t#handleBeforeUpload(event: BaseEvent): void\n\t{\n\t\tif (this.getStatus() === UploaderStatus.STOPPED)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\tthis.start();\n\t\t}\n\t\telse if (this.getUploadingFileCount() >= this.getMaxParallelUploads())\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t}\n\t}\n\n\t#handleFileStatusChange(event: BaseEvent): void\n\t{\n\t\tconst file: UploaderFile = event.getTarget();\n\t\tthis.emit(UploaderEvent.FILE_STATUS_CHANGE, { file });\n\t}\n\n\t#handleFileStateChange(event: BaseEvent): void\n\t{\n\t\tconst file: UploaderFile = event.getTarget();\n\t\tconst property: string = event.getData().property;\n\t\tconst value: any = event.getData().value;\n\n\t\tif (property === 'serverFileId')\n\t\t{\n\t\t\tthis.#updateHiddenField(file);\n\t\t}\n\n\t\tthis.emit(UploaderEvent.FILE_STATE_CHANGE, { file, property, value });\n\t}\n\n\t#exceedsMaxFileCount(fileList: Array): boolean\n\t{\n\t\tconst totalNewFiles: number = fileList.length;\n\t\tconst totalFiles: number = this.#files.length;\n\n\t\tif (!this.isMultiple() && totalNewFiles > 1)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tlet maxFileCount = null;\n\t\tif (this.isMultiple())\n\t\t{\n\t\t\tmaxFileCount = this.getMaxFileCount();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tmaxFileCount = this.shouldReplaceSingle() ? null : 1;\n\t\t}\n\n\t\tif (maxFileCount !== null && totalFiles + totalNewFiles > maxFileCount)\n\t\t{\n\t\t\tconst error: UploaderError = new UploaderError('MAX_FILE_COUNT_EXCEEDED', { maxFileCount });\n\t\t\tthis.emit(UploaderEvent.MAX_FILE_COUNT_EXCEEDED, { error });\n\t\t\tthis.emit(UploaderEvent.ERROR, { error });\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t#applyFilters(type: FilterType, ...args): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst filters = [...(this.#filters.get(type) || [])];\n\t\t\tif (filters.length === 0)\n\t\t\t{\n\t\t\t\tresolve();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst firstFilter: Filter = filters.shift();\n\n\t\t\t// chain filters\n\t\t\tfilters\n\t\t\t\t.reduce(\n\t\t\t\t\t(current: Promise, next: Filter) => {\n\t\t\t\t\t\treturn current.then(() => next.apply(...args));\n\t\t\t\t\t},\n\t\t\t\t\tfirstFilter.apply(...args),\n\t\t\t\t)\n\t\t\t\t.then((result) => resolve(result))\n\t\t\t\t.catch(error => reject(error))\n\t\t\t;\n\t\t});\n\t}\n\n\tstart(): void\n\t{\n\t\tif (this.getStatus() !== UploaderStatus.STARTED && this.getPendingFileCount() > 0)\n\t\t{\n\t\t\tthis.#status = UploaderStatus.STARTED;\n\t\t\tthis.emit(UploaderEvent.UPLOAD_START);\n\t\t\tthis.#uploadNext();\n\t\t}\n\t}\n\n\tstop(): void\n\t{\n\t\tif (this.#status !== UploaderStatus.STOPPED)\n\t\t{\n\t\t\tthis.#status = UploaderStatus.STOPPED;\n\n\t\t\t// this.getFiles().forEach((file: UploaderFile) => {\n\t\t\t// \tif (file.isUploading())\n\t\t\t// \t{\n\t\t\t// \t\tfile.abort();\n\t\t\t// \t\tfile.setStatus(FileStatus.PENDING);\n\t\t\t// \t}\n\t\t\t// });\n\n\t\t\tthis.emit('onStop');\n\t\t}\n\t}\n\n\tisDestroyed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\tdestroy(options?: DestroyOptions): void\n\t{\n\t\tif (this.#destroying)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#destroying = true;\n\n\t\tthis.emit(UploaderEvent.DESTROY);\n\n\t\tthis.unassignBrowseAll();\n\t\tthis.unassignDropzoneAll();\n\t\tthis.unassignPasteAll();\n\n\t\tconst removeFromServer: boolean = !options || options.removeFilesFromServer !== false;\n\t\tthis.removeFiles({ removeFromServer });\n\n\t\tthis.#resetHiddenFields();\n\t\tinstances.delete(this.getId());\n\n\t\tthis.#files = [];\n\t\tthis.#server = null;\n\t\tthis.#acceptedFileTypes = null;\n\t\tthis.#ignoredFileNames = null;\n\t\tthis.#filters = null;\n\n\t\tObject.setPrototypeOf(this, null);\n\t\tthis.isDestroyed = () => true;\n\t}\n\n\tremoveFiles(options?: RemoveFileOptions): void\n\t{\n\t\tthis.getFiles().forEach((file: UploaderFile): void => {\n\t\t\tfile.remove(options);\n\t\t});\n\t}\n\n\tremoveFile(fileOrId: UploaderFile | string, options?: RemoveFileOptions): void\n\t{\n\t\tconst file: UploaderFile = Type.isString(fileOrId) ? this.getFile(fileOrId) : fileOrId;\n\t\tconst index: number = this.#files.indexOf(file);\n\t\tif (index === -1)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tfile.remove(options);\n\t}\n\n\t#removeFile(file: UploaderFile)\n\t{\n\t\tconst index: number = this.#files.indexOf(file);\n\t\tif (index !== -1)\n\t\t{\n\t\t\tthis.#files.splice(index, 1);\n\t\t}\n\n\t\tfile.unsubscribeAll();\n\n\t\tthis.emit(UploaderEvent.FILE_REMOVE, { file });\n\t\tthis.#resetHiddenField(file);\n\t}\n\n\tgetFile(id: string): ?UploaderFile\n\t{\n\t\treturn this.#files.find((file: UploaderFile): boolean => file.getId() === id) || null;\n\t}\n\n\tgetFiles(): UploaderFile[]\n\t{\n\t\treturn [...this.#files];\n\t}\n\n\tgetFileCount(): number\n\t{\n\t\treturn this.#files.length;\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.#id;\n\t}\n\n\tisMultiple(): boolean\n\t{\n\t\treturn this.#multiple;\n\t}\n\n\tgetStatus(): UploaderStatus\n\t{\n\t\treturn this.#status;\n\t}\n\n\taddFilter(type: FilterType, filterEntity: Filter | Class<Filter> | string, filterOptions: JsonObject = {}): void\n\t{\n\t\tlet filter: Filter = null;\n\t\tif (Type.isFunction(filterEntity) || Type.isString(filterEntity))\n\t\t{\n\t\t\tconst ClassName: Class<Filter> = Type.isString(filterEntity) ? Reflection.getClass(filterEntity) : filterEntity;\n\t\t\tif (Type.isFunction(ClassName))\n\t\t\t{\n\t\t\t\tfilter = new ClassName(this, filterOptions);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfilter = filterEntity;\n\t\t}\n\n\t\tif (filter instanceof Filter)\n\t\t{\n\t\t\tlet filters: Filter[] = this.#filters.get(type);\n\t\t\tif (!Type.isArray(filters))\n\t\t\t{\n\t\t\t\tfilters = [];\n\t\t\t\tthis.#filters.set(type, filters);\n\t\t\t}\n\n\t\t\tfilters.push(filter);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new TypeError('Uploader: a filter must be an instance of FileUploader.Filter.');\n\t\t}\n\t}\n\n\taddFilters(filters: Array): void\n\t{\n\t\tif (Type.isArray(filters))\n\t\t{\n\t\t\tfilters.forEach((filter): void => {\n\t\t\t\tif (Type.isPlainObject(filter))\n\t\t\t\t{\n\t\t\t\t\tthis.addFilter(filter.type, filter.filter, filter.options);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetServer(): Server\n\t{\n\t\treturn this.#server;\n\t}\n\n\tassignBrowse(htmlElement: HTMLElement | HTMLElement[]): void\n\t{\n\t\tconst nodes: HTMLElement[] = Type.isElementNode(htmlElement) ? [htmlElement] : htmlElement;\n\t\tif (!Type.isArray(nodes))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnodes.forEach((node: HTMLElement | HTMLInputElement) => {\n\t\t\tif (!Type.isElementNode(node) || this.#browsingNodes.has(node))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet input: HTMLInputElement = null;\n\t\t\tif (node.tagName === 'INPUT' && node.type === 'file')\n\t\t\t{\n\t\t\t\tinput = node;\n\n\t\t\t\t// Add already selected files\n\t\t\t\tif (input.files && input.files.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.addFiles(input.files);\n\t\t\t\t}\n\n\t\t\t\tconst acceptAttr = input.getAttribute('accept');\n\t\t\t\tif (Type.isStringFilled(acceptAttr))\n\t\t\t\t{\n\t\t\t\t\tthis.setAcceptedFileTypes(acceptAttr);\n\t\t\t\t}\n\n\t\t\t\tthis.#browsingNodes.set(node, null);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tinput = document.createElement('input');\n\t\t\t\tinput.setAttribute('type', 'file');\n\n\t\t\t\tconst onBrowseClickHandler = this.#handleBrowseClick.bind(this, input, node);\n\t\t\t\tthis.#browsingNodes.set(node, onBrowseClickHandler);\n\t\t\t\tEvent.bind(node, 'click', onBrowseClickHandler);\n\t\t\t}\n\n\t\t\tif (this.isMultiple())\n\t\t\t{\n\t\t\t\tinput.setAttribute('multiple', 'multiple');\n\t\t\t}\n\n\t\t\tif (Type.isArrayFilled(this.getAcceptedFileTypes()))\n\t\t\t{\n\t\t\t\tinput.setAttribute('accept', this.getAcceptedFileTypes().join(','));\n\t\t\t}\n\n\t\t\tEvent.bind(input, 'change', this.#onInputFileChangeHandler);\n\t\t});\n\t}\n\n\t#handleBrowseClick(input: HTMLInputElement, node: HTMLElement): void\n\t{\n\t\tconst event: BaseEvent = new BaseEvent({ data: { input, node } });\n\t\tthis.emit(UploaderEvent.BEFORE_BROWSE, event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tinput.click();\n\t}\n\n\t#handleInputFileChange(event: Event): void\n\t{\n\t\tconst input = event.currentTarget;\n\n\t\tthis.addFiles([...input.files]);\n\n\t\t// reset file input\n\t\tinput.value = '';\n\t}\n\n\tunassignBrowse(htmlElement: HTMLElement | HTMLElement[]): void\n\t{\n\t\tconst nodes: HTMLElement[] = Type.isElementNode(htmlElement) ? [htmlElement] : htmlElement;\n\t\tif (!Type.isArray(nodes))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnodes.forEach((node: HTMLElement | HTMLInputElement): void => {\n\t\t\tif (this.#browsingNodes.has(node))\n\t\t\t{\n\t\t\t\tEvent.unbind(node, 'click', this.#browsingNodes.get(node));\n\t\t\t\tEvent.unbind(node, 'change', this.#onInputFileChangeHandler);\n\t\t\t\tthis.#browsingNodes.delete(node);\n\t\t\t}\n\t\t});\n\t}\n\n\tunassignBrowseAll(): void\n\t{\n\t\t[...this.#browsingNodes.keys()].forEach((node: HTMLElement): void => {\n\t\t\tthis.unassignBrowse(node);\n\t\t});\n\t}\n\n\tassignDropzone(htmlElement: HTMLElement | HTMLElement[]): void\n\t{\n\t\tconst nodes = Type.isElementNode(htmlElement) ? [htmlElement] : htmlElement;\n\t\tif (!Type.isArray(nodes))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnodes.forEach((node: HTMLElement): void => {\n\t\t\tif (!Type.isElementNode(node) || this.#dropNodes.has(node))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEvent.bind(node, 'dragover', this.#preventDefault);\n\t\t\tEvent.bind(node, 'dragenter', this.#preventDefault);\n\t\t\tEvent.bind(node, 'drop', this.#onDropHandler);\n\n\t\t\tthis.#dropNodes.add(node);\n\t\t});\n\t}\n\n\t#handleDrop(dragEvent: DragEvent): void\n\t{\n\t\tdragEvent.preventDefault();\n\n\t\tconst event: BaseEvent = new BaseEvent({ data: { dragEvent } });\n\t\tthis.emit(UploaderEvent.BEFORE_DROP, event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tgetFilesFromDataTransfer(dragEvent.dataTransfer).then((files: File[]): void => {\n\t\t\tthis.addFiles(files);\n\t\t}).catch((error) => {\n\t\t\tconsole.error('Uploader: data transfer error', error);\n\t\t});\n\t}\n\n\t#preventDefault(event: DragEvent): void\n\t{\n\t\tevent.preventDefault();\n\t}\n\n\tunassignDropzone(htmlElement: HTMLElement | HTMLElement[]): void\n\t{\n\t\tconst nodes: HTMLElement[] = Type.isElementNode(htmlElement) ? [htmlElement] : htmlElement;\n\t\tif (!Type.isArray(nodes))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnodes.forEach((node: HTMLElement): void => {\n\t\t\tif (this.#dropNodes.has(node))\n\t\t\t{\n\t\t\t\tEvent.unbind(node, 'dragover', this.#preventDefault);\n\t\t\t\tEvent.unbind(node, 'dragenter', this.#preventDefault);\n\t\t\t\tEvent.unbind(node, 'drop', this.#onDropHandler);\n\t\t\t\tthis.#dropNodes.delete(node);\n\t\t\t}\n\t\t});\n\t}\n\n\tunassignDropzoneAll(): void\n\t{\n\t\t[...this.#dropNodes].forEach((node: HTMLElement): void => {\n\t\t\tthis.unassignDropzone(node);\n\t\t});\n\t}\n\n\tassignPaste(htmlElement: HTMLElement | HTMLElement[]): void\n\t{\n\t\tconst nodes: HTMLElement[] = Type.isElementNode(htmlElement) ? [htmlElement] : htmlElement;\n\t\tif (!Type.isArray(nodes))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnodes.forEach((node: HTMLElement): void => {\n\t\t\tif (!Type.isElementNode(node) || this.#pastingNodes.has(node))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tEvent.bind(node, 'paste', this.#onPasteHandler);\n\t\t\tthis.#pastingNodes.add(node);\n\t\t});\n\t}\n\n\t#handlePaste(clipboardEvent: ClipboardEvent): void\n\t{\n\t\tconst clipboardData: DataTransfer = clipboardEvent.clipboardData;\n\t\tif (!clipboardData)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst event: BaseEvent = new BaseEvent({ data: { clipboardEvent } });\n\t\tthis.emit(UploaderEvent.BEFORE_PASTE, event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isFilePasted(clipboardData))\n\t\t{\n\t\t\tclipboardEvent.preventDefault();\n\n\t\t\tgetFilesFromDataTransfer(clipboardData).then((files: File[]): void => {\n\t\t\t\tthis.addFiles(files);\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error('Uploader: data transfer error', error);\n\t\t\t});\n\t\t}\n\t}\n\n\tunassignPaste(htmlElement: HTMLElement | HTMLElement[]): void\n\t{\n\t\tconst nodes: HTMLElement[] = Type.isElementNode(htmlElement) ? [htmlElement] : htmlElement;\n\t\tif (!Type.isArray(nodes))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tnodes.forEach((node: HTMLElement): void => {\n\t\t\tif (this.#pastingNodes.has(node))\n\t\t\t{\n\t\t\t\tEvent.unbind(node, 'paste', this.#onPasteHandler);\n\t\t\t\tthis.#pastingNodes.delete(node);\n\t\t\t}\n\t\t});\n\t}\n\n\tunassignPasteAll(): void\n\t{\n\t\t[...this.#pastingNodes].forEach((node: HTMLElement): void => {\n\t\t\tthis.unassignPaste(node);\n\t\t});\n\t}\n\n\tgetHiddenFieldsContainer(): ?HTMLElement\n\t{\n\t\tlet element = null;\n\t\tif (Type.isStringFilled(this.#hiddenFieldsContainer))\n\t\t{\n\t\t\telement = document.querySelector(this.#hiddenFieldsContainer);\n\t\t\tif (!Type.isElementNode(element))\n\t\t\t{\n\t\t\t\tconsole.error(`Uploader: a hidden field container was not found (${this.#hiddenFieldsContainer}).`);\n\t\t\t}\n\t\t}\n\t\telse if (Type.isElementNode(this.#hiddenFieldsContainer))\n\t\t{\n\t\t\telement = this.#hiddenFieldsContainer;\n\t\t}\n\n\t\treturn element;\n\t}\n\n\tsetHiddenFieldsContainer(container: string | HTMLElement): void\n\t{\n\t\tif (Type.isStringFilled(container) || Type.isElementNode(container) || Type.isNull(container))\n\t\t{\n\t\t\tthis.#hiddenFieldsContainer = container;\n\t\t}\n\t}\n\n\tgetHiddenFieldName(): string\n\t{\n\t\treturn this.#hiddenFieldName;\n\t}\n\n\tsetHiddenFieldName(name: string): void\n\t{\n\t\tif (Type.isStringFilled(name))\n\t\t{\n\t\t\tthis.#hiddenFieldName = name;\n\t\t}\n\t}\n\n\tshouldAssignAsFile(): boolean\n\t{\n\t\treturn this.#assignAsFile;\n\t}\n\n\tsetAssignAsFile(flag: boolean): void\n\t{\n\t\tif (Type.isBoolean(flag))\n\t\t{\n\t\t\tthis.#assignAsFile = flag;\n\t\t}\n\t}\n\n\tshouldAssignServerFile(): boolean\n\t{\n\t\treturn this.#assignServerFile;\n\t}\n\n\tsetAssignServerFile(flag: boolean): void\n\t{\n\t\tif (Type.isBoolean(flag))\n\t\t{\n\t\t\tthis.#assignServerFile = flag;\n\t\t}\n\t}\n\n\tgetTotalSize(): number\n\t{\n\t\treturn this.#files.reduce((totalSize: number, file: UploaderFile) => {\n\t\t\treturn totalSize + file.getSize();\n\t\t}, 0);\n\t}\n\n\tshouldAutoUpload(): boolean\n\t{\n\t\treturn this.#autoUpload;\n\t}\n\n\tsetAutoUpload(flag: boolean): void\n\t{\n\t\tif (Type.isBoolean(flag))\n\t\t{\n\t\t\tthis.#autoUpload = flag;\n\t\t}\n\t}\n\n\tgetMaxParallelUploads(): number\n\t{\n\t\treturn this.#maxParallelUploads;\n\t}\n\n\tsetMaxParallelUploads(number: number): void\n\t{\n\t\tif (Type.isNumber(number) && number > 0)\n\t\t{\n\t\t\tthis.#maxParallelUploads = number;\n\t\t}\n\t}\n\n\tgetMaxParallelLoads(): number\n\t{\n\t\treturn this.#maxParallelLoads;\n\t}\n\n\tsetMaxParallelLoads(number: number): void\n\t{\n\t\tif (Type.isNumber(number) && number > 0)\n\t\t{\n\t\t\tthis.#maxParallelLoads = number;\n\t\t}\n\t}\n\n\tgetUploadingFileCount(): number\n\t{\n\t\treturn this.#files.filter((file: UploaderFile): boolean => file.isUploading() || file.isPreparing()).length;\n\t}\n\n\tgetPendingFileCount(): number\n\t{\n\t\treturn this.#files.filter((file: UploaderFile): boolean => file.isReadyToUpload()).length;\n\t}\n\n\tisInProgress(): boolean\n\t{\n\t\tif (this.getStatus() === UploaderStatus.STARTED)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.#files.some((file: UploaderFile): boolean => file.isInProgress());\n\t}\n\n\tstatic getImageExtensions(): Array<string>\n\t{\n\t\treturn this.getGlobalOption(\n\t\t\t'imageExtensions',\n\t\t\t['jpg', 'bmp', 'jpeg', 'jpe', 'gif', 'png', 'webp'],\n\t\t);\n\t}\n\n\tstatic getVideoExtensions(): Array<string>\n\t{\n\t\treturn this.getGlobalOption(\n\t\t\t'videoExtensions',\n\t\t\t['avi', 'wmv', 'mp4', 'mov', 'webm', 'flv', 'm4v', 'mkv', 'vob', '3gp', 'ogv', 'h264'],\n\t\t);\n\t}\n\n\tsetAcceptOnlyImages(flag: boolean): void\n\t{\n\t\tif (Type.isBoolean(flag))\n\t\t{\n\t\t\tthis.#acceptOnlyImages = flag;\n\t\t\tif (flag)\n\t\t\t{\n\t\t\t\tthis.acceptOnlyImages();\n\t\t\t}\n\t\t}\n\t}\n\n\tacceptOnlyImages(): void\n\t{\n\t\tconst imageExtensions: string[] = Uploader.getImageExtensions().map((extension: string): string => {\n\t\t\treturn `.${extension}`;\n\t\t});\n\n\t\tthis.setAcceptedFileTypes(imageExtensions);\n\t\tthis.#acceptOnlyImages = true;\n\t}\n\n\tshouldAcceptOnlyImages(): boolean\n\t{\n\t\treturn this.#acceptOnlyImages;\n\t}\n\n\tgetAcceptedFileTypes(): string[]\n\t{\n\t\treturn this.#acceptedFileTypes;\n\t}\n\n\tsetAcceptedFileTypes(fileTypes: string | string[]): void\n\t{\n\t\tconst types: string[] = Type.isString(fileTypes) ? fileTypes.split(',') : fileTypes;\n\t\tif (Type.isArray(types))\n\t\t{\n\t\t\tthis.#acceptedFileTypes = [];\n\t\t\tthis.#acceptOnlyImages = false;\n\n\t\t\ttypes.forEach((type: string) => {\n\t\t\t\tif (Type.isStringFilled(type))\n\t\t\t\t{\n\t\t\t\t\tthis.#acceptedFileTypes.push(type);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tgetIgnoredFileNames(): string[]\n\t{\n\t\treturn this.#ignoredFileNames;\n\t}\n\n\tsetIgnoredFileNames(fileNames: string[]): void\n\t{\n\t\tif (Type.isArray(fileNames))\n\t\t{\n\t\t\tthis.#ignoredFileNames = [];\n\n\t\t\tfileNames.forEach((fileName: string): void => {\n\t\t\t\tif (Type.isStringFilled(fileName))\n\t\t\t\t{\n\t\t\t\t\tthis.#ignoredFileNames.push(fileName.toLowerCase());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tsetMaxFileCount(maxFileCount: ?number): void\n\t{\n\t\tif ((Type.isNumber(maxFileCount) && maxFileCount > 0) || maxFileCount === null)\n\t\t{\n\t\t\tthis.#maxFileCount = maxFileCount;\n\t\t}\n\t}\n\n\tgetMaxFileCount(): ?number\n\t{\n\t\treturn this.#maxFileCount;\n\t}\n\n\tsetAllowReplaceSingle(flag: boolean): void\n\t{\n\t\tif (Type.isBoolean(flag))\n\t\t{\n\t\t\tthis.#allowReplaceSingle = flag;\n\t\t}\n\t}\n\n\tshouldReplaceSingle(): boolean\n\t{\n\t\treturn this.#allowReplaceSingle;\n\t}\n\n\t#uploadNext(): void\n\t{\n\t\tif (this.getStatus() !== UploaderStatus.STARTED)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst maxParallelUploads: number = this.getMaxParallelUploads();\n\t\tconst currentUploads: number = this.getUploadingFileCount();\n\t\tconst pendingFiles: UploaderFile[] = this.#files.filter((file: UploaderFile): boolean => file.isReadyToUpload());\n\t\tconst pendingUploads: number = pendingFiles.length;\n\n\t\tif (currentUploads < maxParallelUploads)\n\t\t{\n\t\t\tconst limit: number = Math.min(maxParallelUploads - currentUploads, pendingFiles.length);\n\t\t\tfor (let i = 0; i < limit; i++)\n\t\t\t{\n\t\t\t\tconst pendingFile: UploaderFile = pendingFiles[i];\n\t\t\t\tpendingFile.upload();\n\t\t\t}\n\t\t}\n\n\t\t// All files are COMPLETE or FAILED\n\t\tif (currentUploads === 0 && pendingUploads === 0)\n\t\t{\n\t\t\tthis.#status = UploaderStatus.STOPPED;\n\t\t\tthis.emit(UploaderEvent.UPLOAD_COMPLETE);\n\t\t}\n\t}\n\n\t#loadNext(): void\n\t{\n\t\tconst maxParallelLoads: number = this.getMaxParallelLoads();\n\t\tconst currentLoads: number = this.#files.filter((file: UploaderFile): boolean => file.isLoading()).length;\n\t\tconst pendingFiles: UploaderFile[] = this.#files.filter((file: UploaderFile) => {\n\t\t\treturn file.getStatus() === FileStatus.ADDED && file.getOrigin() === FileOrigin.CLIENT;\n\t\t});\n\n\t\tif (currentLoads < maxParallelLoads)\n\t\t{\n\t\t\tconst limit: number = Math.min(maxParallelLoads - currentLoads, pendingFiles.length);\n\t\t\tfor (let i = 0; i < limit; i++)\n\t\t\t{\n\t\t\t\tconst pendingFile: UploaderFile = pendingFiles[i];\n\t\t\t\tpendingFile.load();\n\t\t\t}\n\t\t}\n\t}\n\n\t#setHiddenField(file: UploaderFile): void\n\t{\n\t\tconst container: ?HTMLElement = this.getHiddenFieldsContainer();\n\t\tif (!container || this.#hiddenFields.has(file.getId()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (file.getOrigin() === FileOrigin.SERVER && !this.shouldAssignServerFile())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst assignAsFile: boolean = (\n\t\t\tfile.getOrigin() === FileOrigin.CLIENT\n\t\t\t&& !file.isUploadable()\n\t\t\t&& this.shouldAssignAsFile()\n\t\t\t&& canAppendFileToForm()\n\t\t);\n\n\t\tconst input: HTMLInputElement = document.createElement('input');\n\t\tinput.type = assignAsFile ? 'file' : 'hidden';\n\t\tinput.name = this.getHiddenFieldName() + (this.isMultiple() ? '[]' : '');\n\n\t\tif (assignAsFile)\n\t\t{\n\t\t\tDom.style(input, {\n\t\t\t\tvisibility: 'hidden',\n\t\t\t\tleft: 0,\n\t\t\t\ttop: 0,\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t\tposition: 'absolute',\n\t\t\t\t'pointer-events': 'none',\n\t\t\t});\n\n\t\t\tassignFileToInput(input, file.getBinary());\n\t\t}\n\t\telse if (file.getServerFileId() !== null)\n\t\t{\n\t\t\tinput.value = file.getServerFileId();\n\t\t}\n\n\t\tDom.append(input, container);\n\t\tthis.#hiddenFields.set(file.getId(), input);\n\n\t\tthis.#syncInputPositions();\n\t}\n\n\t#updateHiddenField(file: UploaderFile): void\n\t{\n\t\tconst input: ?HTMLInputElement = this.#hiddenFields.get(file.getId());\n\t\tif (input && input.type === 'hidden')\n\t\t{\n\t\t\tif (file.getServerFileId() === null)\n\t\t\t{\n\t\t\t\tthis.#resetHiddenField(file);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tinput.value = file.getServerFileId();\n\t\t\t}\n\t\t}\n\t}\n\n\t#resetHiddenField(file: UploaderFile): void\n\t{\n\t\tconst input: ?HTMLInputElement = this.#hiddenFields.get(file.getId());\n\t\tif (input)\n\t\t{\n\t\t\tDom.remove(input);\n\t\t\tthis.#hiddenFields.delete(file.getId());\n\t\t}\n\t}\n\n\t#resetHiddenFields(): void\n\t{\n\t\t[...this.#hiddenFields.values()].forEach((input: HTMLInputElement): void => {\n\t\t\tDom.remove(input);\n\t\t});\n\n\t\tthis.#hiddenFields = [];\n\t}\n\n\t#syncInputPositions(): void\n\t{\n\t\tconst container: ?HTMLElement = this.getHiddenFieldsContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.getFiles().forEach((file: UploaderFile): void => {\n\t\t\tconst input: ?HTMLInputElement = this.#hiddenFields.get(file.getId());\n\t\t\tif (input)\n\t\t\t{\n\t\t\t\tDom.append(input, container);\n\t\t\t}\n\t\t});\n\t}\n}\n","const isImage = (blob: Blob): boolean => {\n\treturn /^image\\/[\\d.a-z-]+$/i.test(blob.type);\n};\n\nexport default isImage;\n","const Marker = {\n\tJPEG: 0xFFD8,\n\tAPP1: 0xFFE1,\n\tEXIF: 0x45786966,\n\tTIFF: 0x4949,\n\tOrientation: 0x0112,\n\tUnknown: 0xFF00,\n};\n\nconst getUint16 = (view, offset, little = false) => view.getUint16(offset, little);\nconst getUint32 = (view, offset, little = false) => view.getUint32(offset, little);\n\nconst getJpegOrientation = (file) => {\n\treturn new Promise((resolve, reject) => {\n\t\tconst reader = new FileReader();\n\t\treader.onload = function(e) {\n\t\t\tconst view = new DataView(e.target.result);\n\t\t\tif (getUint16(view, 0) !== Marker.JPEG)\n\t\t\t{\n\t\t\t\tresolve(-1);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst length = view.byteLength;\n\t\t\tlet offset = 2;\n\n\t\t\twhile (offset < length)\n\t\t\t{\n\t\t\t\tconst marker = getUint16(view, offset);\n\t\t\t\toffset += 2;\n\n\t\t\t\t// APP1 Marker\n\t\t\t\tif (marker === Marker.APP1)\n\t\t\t\t{\n\t\t\t\t\toffset += 2;\n\t\t\t\t\tif (getUint32(view, offset) !== Marker.EXIF)\n\t\t\t\t\t{\n\t\t\t\t\t\t// no EXIF\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst little = getUint16(view, (offset += 6)) === Marker.TIFF;\n\t\t\t\t\toffset += getUint32(view, offset + 4, little);\n\n\t\t\t\t\tconst tags = getUint16(view, offset, little);\n\t\t\t\t\toffset += 2;\n\n\t\t\t\t\tfor (let i = 0; i < tags; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\t// Found the orientation tag\n\t\t\t\t\t\tif (getUint16(view, offset + i * 12, little) === Marker.Orientation)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresolve(getUint16(view, offset + i * 12 + 8, little));\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if ((marker & Marker.Unknown) === Marker.Unknown)\n\t\t\t\t{\n\t\t\t\t\toffset += getUint16(view, offset);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tbreak; // Invalid\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Nothing found\n\t\t\tresolve(-1);\n\t\t};\n\n\t\treader.readAsArrayBuffer(file.slice(0, 64 * 1024));\n\t});\n};\n\nexport default getJpegOrientation;\n","const isJpeg = (blob: Blob): boolean => {\n\treturn /^image\\/jpeg$/i.test(blob.type);\n};\n\nexport default isJpeg;\n"],"names":["FileStatus","INIT","ADDED","LOADING","PENDING","PREPARING","UPLOADING","COMPLETE","LOAD_FAILED","UPLOAD_FAILED","FileOrigin","CLIENT","SERVER","FileEvent","ADD","BEFORE_UPLOAD","UPLOAD_START","UPLOAD_ERROR","UPLOAD_PROGRESS","UPLOAD_COMPLETE","UPLOAD_CONTROLLER_INIT","LOAD_START","LOAD_PROGRESS","LOAD_COMPLETE","LOAD_ERROR","LOAD_CONTROLLER_INIT","REMOVE_ERROR","REMOVE_COMPLETE","REMOVE_CONTROLLER_INIT","STATE_CHANGE","STATUS_CHANGE","VALIDATE_FILE_ASYNC","PREPARE_FILE_ASYNC","getFileExtension","filename","position","Type","isStringFilled","lastIndexOf","slice","Math","max","videoExtensions","isSupportedVideo","file","mimeType","Uploader","getVideoExtensions","fileName","isFile","name","type","extension","toLowerCase","includes","test","UploaderError","BaseError","constructor","code","args","message","isString","description","customData","isPlainObject","length","replacements","Object","keys","forEach","key","Loc","hasMessage","getMessage","origin","Origin","USER","setDescription","createFromAjaxErrors","errors","isArrayFilled","uploaderError","find","error","system","setOrigin","setType","console","SYSTEM","UNKNOWN","createFromError","getDescription","text","getOrigin","values","getType","clone","options","JSON","parse","stringify","toString","getCode","toJSON","getCustomData","AbstractUploadController","EventEmitter","server","setEventNamespace","getServer","getOptions","getOption","option","defaultValue","isUndefined","upload","Error","abort","AbstractLoadController","load","AbstractRemoveController","remove","crypto","window","msCrypto","process","require","webcrypto","createUniqueId","replaceAll","part","getRandomValues","Uint8Array","getExtensionFromType","subtype","split","pop","counter","createFileFromBlob","blob","newFileName","date","Date","getFullYear","getMonth","getDate","File","lastModified","now","lastModifiedDate","size","regexp","isDataUri","str","match","createBlobFromDataUri","dataURI","byteString","atob","mimeString","buffer","ArrayBuffer","view","i","codePointAt","Blob","imageExtensions","Set","isResizableImage","has","formatFileSize","base","units","getUnits","currentSize","isInteger","toFixed","fileSizeUnits","UploaderFile","source","fileOptions","create","CallbackCollection","update","isBlob","isNumber","serverFileId","id","preload","subscribeFromOptions","events","canLoad","emit","shouldForceServerLoad","callbacks","subscribe","isComplete","isUploadable","isUploadFailed","getError","canUpload","event","BaseEvent","data","isDefaultPrevented","prepareEvent","emitAsync","then","catch","prepareError","addError","getStatus","removeFromServer","isLoading","isUploading","getUploadController","setUploadController","controller","isNull","changed","subscribeOnce","getData","progress","setProgress","fileInfo","setLoadController","validationEvent","preparationEvent","preparationError","validationError","setRemoveController","isReadyToUpload","isLoadable","isRemoveable","isPreparing","isFailed","isLoadFailed","isInProgress","getBinary","setFile","getName","setName","setSize","setServerFileId","setWidth","width","setHeight","height","setTreatImageAsFile","treatImageAsFile","setClientPreview","clientPreview","clientPreviewWidth","clientPreviewHeight","setServerPreview","serverPreviewUrl","serverPreviewWidth","serverPreviewHeight","setDownloadUrl","downloadUrl","setCustomData","setViewerAttrs","viewerAttrs","loadController","uploadController","removeController","property","value","getExtension","getSize","getSizeFormatted","getId","getServerFileId","getServerId","getDownloadUrl","url","getWidth","getHeight","isAnimated","setAnimated","flag","isBoolean","shouldTreatImageAsFile","getPreviewUrl","getClientPreview","getClientPreviewUrl","getServerPreviewUrl","getPreviewWidth","getClientPreviewWidth","getServerPreviewWidth","getPreviewHeight","getClientPreviewHeight","getServerPreviewHeight","revokeClientPreviewUrl","URL","createObjectURL","revokeObjectURL","isImage","isVideo","getProgress","push","getErrors","getState","entries","item","currentKey","currentValue","customProperty","undefined","getViewerAttrs","serverId","status","sizeFormatted","failed","animated","previewUrl","previewWidth","previewHeight","clientPreviewUrl","handlers","isFunction","onComplete","getEmitter","onError","eventName","unsubscribeAll","Chunk","offset","getNextRetryDelay","shift","setRetries","retries","isArray","getOffset","UploadController","nextChunk","clearTimeout","getFile","getChunkSize","getChunkOffset","getToken","setToken","token","chunk","totalSize","isOnlyOneChunk","normalize","headers","encodeURIComponent","rangeStart","rangeEnd","rangeHeader","controllerOptions","getControllerOptions","Ajax","runAction","preparePost","getParameters","getController","onrequeststart","xhr","onprogressupload","lengthComputable","uploadedBytes","min","loaded","floor","response","shouldRetry","nextDelay","setTimeout","currentChunkSize","nextOffset","fileRange","getChunkRetryDelays","pendingQueues","WeakMap","loadingFiles","loadMultiple","timeout","queue","get","tasks","Runtime","debounce","loadInternal","aborted","set","filter","task","delete","fileIds","onprogress","total","files","fileResults","fileResult","success","ServerLoadController","ClientLoadController","queues","removeMultiple","removeInternal","fileId","RemoveController","ServerlessLoadController","Server","serverOptions","chunkSize","getDefaultChunkSize","forceChunkSize","chunkRetryDelays","controllerClasses","controllerClass","fn","getClass","TypeError","loadControllerOptions","uploadControllerOptions","removeControllerOptions","createUploadController","createServerLoadController","createDefaultServerLoadController","createClientLoadController","createServerlessLoadController","createRemoveController","settings","Extension","getSettings","getChunkMinSize","getChunkMaxSize","Filter","uploader","filterOptions","getUploader","apply","FileSizeFilter","setMaxFileSize","maxFileSize","setMinFileSize","minFileSize","setMaxTotalFileSize","maxTotalFileSize","setImageMaxFileSize","imageMaxFileSize","setImageMinFileSize","imageMinFileSize","setTreatOversizeImageAsFile","treatOversizeImageAsFile","Promise","resolve","reject","getMaxFileSize","maxFileSizeInBytes","getMinFileSize","minFileSizeInBytes","getImageMaxFileSize","shouldTreatOversizeImageAsFile","imageMaxFileSizeInBytes","getImageMinFileSize","imageMinFileSizeInBytes","getMaxTotalFileSize","getTotalSize","maxTotalFileSizeInBytes","isValidFileType","fileTypes","baseMimeType","replace","fileType","trim","charAt","FileTypeFilter","getAcceptedFileTypes","getArrayBuffer","arrayBuffer","fileReader","FileReader","readAsArrayBuffer","onload","result","onerror","convertStringToBuffer","compareBuffers","dataView","dest","start","j","getUint8","GIF87a","GIF89a","Gif","DataView","frames","len","byteLength","getUint16","PNG_SIGNATURE","IHDR_SIGNATURE","FRIED_CHUNK_NAME","Png","getUint32","BMP_SIGNATURE","Bmp","abs","getInt32","EXIF_SIGNATURE","Jpeg","orientation","exifBlock","getOrientation","Marker","BIG_ENDIAN","LITTLE_ENDIAN","byteAlign","isBigEndian","isLittleEndian","extractOrientation","littleEndian","idfDirectoryEntries","IDF_ENTRY_BYTES","NUM_DIRECTORY_ENTRIES_BYTES","directoryEntryNumber","end","block","byteOffset","tagNumber","dataFormat","numberOfComponents","RIFF_HEADER","WEBP_SIGNATURE","VP8_SIGNATURE","VP8L_SIGNATURE","VP8X_SIGNATURE","Webp","headerType","headerView","bits","extendedHeader","validStart","validEnd","trunc","jpg","typeHandlers","gif","png","bmp","jpeg","jpe","webp","getImageSize","typeHandler","ImageSizeFilter","setImageMinWidth","imageMinWidth","setImageMinHeight","imageMinHeight","setImageMaxWidth","imageMaxWidth","setImageMaxHeight","imageMaxHeight","setIgnoreUnknownImageTypes","ignoreUnknownImageTypes","getImageMinWidth","getImageMinHeight","minWidth","minHeight","getImageMaxWidth","getImageMaxHeight","maxWidth","maxHeight","getIgnoreUnknownImageTypes","warn","createWorker","workerBlob","workerURL","worker","Worker","post","callback","transfer","onmessage","postMessage","terminate","BitmapWorker","self","createImageBitmap","bitmap","ResizeWorker","getResizedImageSizeSource","createImagePreviewCanvasSource","sharpenSource","shouldSharpenSource","getResizedImageSize","Function","targetWidth","targetHeight","useOriginalSize","close","createImagePreviewCanvas","offscreenCanvas","sharpen","shouldSharpen","previewBitmap","transferToImageBitmap","log","loadImage","image","document","createElement","src","naturalWidth","naturalHeight","imageSource","newWidth","newHeight","round","isPageContext","parent","createCanvas","canvasWidth","canvasHeight","canvas","OffscreenCanvas","context","getContext","imageSmoothingQuality","drawImage","currentImageWidth","currentImageHeight","currentImageSource","resizingCanvas","halfImageWidth","halfImageHeight","resizingCanvasContext","outputCanvas","outputCanvasContext","imageData","mode","upscale","ratioWidth","ratioHeight","ratio","canvasPrototype","HTMLCanvasElement","prototype","hasToBlobSupport","toBlob","canUseOffscreenCanvas","convertCanvasToBlob","quality","convertToBlob","toDataURL","supportedMimeTypes","Browser","isSafari","isSupportedMimeType","mixFactor","weights","katet","sqrt","half","destinationData","createImageData","destinationBuffer","sourceBuffer","getImageData","y","x","sy","sx","dstOff","red","green","blue","cy","cx","scy","scx","srcOff","wt","putImageData","scaleX","scaleY","scale","createImagePreview","getCanvasToBlobType","mimeTypeMode","getFilenameWithoutExtension","extensionMap","renameFileToMatchMimeType","canCreateImageBitmap","ImageBitmap","ua","navigator","userAgent","regex","exec","resizeImage","resizeWorker","preview","transferFromImageBitmap","loadImageDataFallback","finally","bitmapWorker","imageBitmap","handleImageLoad","createVideoPreview","seekTime","video","setAttribute","Event","bind","currentTime","duration","videoWidth","videoHeight","ImagePreviewFilter","setImagePreviewWidth","imagePreviewWidth","setImagePreviewHeight","imagePreviewHeight","setImagePreviewQuality","imagePreviewQuality","setImagePreviewUpscale","imagePreviewUpscale","setImagePreviewResizeMode","imagePreviewResizeMode","setImagePreviewMimeType","imagePreviewMimeType","setImagePreviewMimeTypeMode","imagePreviewMimeTypeMode","setImagePreviewFilter","imagePreviewFilter","invokeFilter","resizeOptions","getImagePreviewWidth","getImagePreviewHeight","getImagePreviewQuality","getImagePreviewUpscale","getImagePreviewResizeMode","getImagePreviewMimeType","getImagePreviewMimeTypeMode","overrides","ImageResizeFilter","setResizeWidth","imageResizeWidth","setResizeHeight","imageResizeHeight","setResizeMode","imageResizeMode","setResizeMimeType","imageResizeMimeType","setResizeMimeTypeMode","imageResizeMimeTypeMode","setResizeQuality","imageResizeQuality","setResizeFilter","imageResizeFilter","getResizeWidth","getResizeHeight","getResizeMode","getResizeQuality","getResizeMimeType","getResizeMimeTypeMode","UploaderStatus","STARTED","STOPPED","UploaderEvent","ERROR","MAX_FILE_COUNT_EXCEEDED","DESTROY","BEFORE_BROWSE","BEFORE_DROP","BEFORE_PASTE","BEFORE_FILES_ADD","FILE_BEFORE_ADD","FILE_ADD_START","FILE_LOAD_START","FILE_LOAD_PROGRESS","FILE_LOAD_COMPLETE","FILE_ERROR","FILE_ADD","FILE_REMOVE","FILE_UPLOAD_START","FILE_UPLOAD_PROGRESS","FILE_UPLOAD_COMPLETE","FILE_COMPLETE","FILE_STATUS_CHANGE","FILE_STATE_CHANGE","FilterType","VALIDATION","PREPARATION","getFilesInDirectory","entry","dirCounter","fileCounter","resolveIfDone","readEntries","dirEntry","directoryReader","createReader","readBatch","fileEntry","isDirectory","isDirectoryEntry","webkitGetAsEntry","isFileSystemItem","kind","getFilesFromItem","getAsFile","getFilesFromDataTransfer","dataTransfer","browseFolders","items","map","all","fileGroups","group","hasDataTransferOnlyFiles","every","isFilePasted","types","texts","canAppendFileToForm","DataTransfer","add","input","assignFileToInput","instances","Map","getById","getInstances","uploaderOptions","Text","getRandom","multiple","acceptOnlyImages","acceptOnlyImagesGlobal","getGlobalOption","setAcceptOnlyImages","acceptedFileTypes","setAcceptedFileTypes","acceptedFileTypesGlobal","ignoredFileNames","setIgnoredFileNames","setMaxFileCount","maxFileCount","setAllowReplaceSingle","allowReplaceSingle","assignBrowse","browseElement","assignDropzone","dropElement","assignPaste","pasteElement","setHiddenFieldsContainer","hiddenFieldsContainer","setHiddenFieldName","hiddenFieldName","setAssignAsFile","assignAsFile","setAssignServerFile","assignServerFile","setAutoUpload","autoUpload","setMaxParallelUploads","maxParallelUploads","setMaxParallelLoads","maxParallelLoads","addFilter","addFilters","filters","addFiles","path","globalOptions","fileList","isArrayLike","results","addFile","getIgnoredFileNames","isMultiple","shouldReplaceSingle","fileToReplace","removeFile","preloaded","getPendingFileCount","stop","isDestroyed","destroy","unassignBrowseAll","unassignDropzoneAll","unassignPasteAll","removeFilesFromServer","removeFiles","setPrototypeOf","getFiles","fileOrId","index","indexOf","getFileCount","filterEntity","ClassName","Reflection","htmlElement","nodes","isElementNode","node","tagName","acceptAttr","getAttribute","onBrowseClickHandler","join","unassignBrowse","unbind","unassignDropzone","unassignPaste","getHiddenFieldsContainer","element","querySelector","container","getHiddenFieldName","shouldAssignAsFile","shouldAssignServerFile","reduce","shouldAutoUpload","getMaxParallelUploads","number","getMaxParallelLoads","getUploadingFileCount","some","getImageExtensions","shouldAcceptOnlyImages","fileNames","getMaxFileCount","preventDefault","getTarget","totalNewFiles","totalFiles","firstFilter","current","next","splice","click","currentTarget","dragEvent","clipboardEvent","clipboardData","currentUploads","pendingFiles","pendingUploads","limit","pendingFile","currentLoads","Dom","style","visibility","left","top","append","JPEG","APP1","EXIF","TIFF","Orientation","Unknown","little","getJpegOrientation","reader","e","target","marker","tags","isJpeg"],"mappings":"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"}