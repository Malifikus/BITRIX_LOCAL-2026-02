this.BX=this.BX||{};this.BX.Intranet=this.BX.Intranet||{};(function(e,t,s){"use strict";class o{constructor(e={}){this.signedParameters=e.signedParameters;this.componentName=e.componentName;this.loader=null;this.container=e.contentContainer;this.userId=e.userId;this.currentPage=e.currentPage;this.menuContainer=e.menuContainer;this.changeContent(this.currentPage);if(t.Type.isDomNode(this.menuContainer)){this.menuItems=this.menuContainer.querySelectorAll("a");(this.menuItems||[]).forEach((e=>{t.Event.bind(e,"click",(()=>{this.changeContent(e.getAttribute("data-action"))}))}))}BX.addCustomEvent("BX.Security.UserOtpInit:afterOtpSetup",(e=>{this.showOtpConnectedComponent()}))}changeContent(e){if(!e){return}switch(e){case"otpConnected":case"otpList":case"changePassword":case"socnetEmail":const t={userId:this.userId};this.sendAction(e,t);break;case"otp":case"appPasswords":case"synchronize":case"mailingAgreement":case"sso":this.sendAction(e,{});break;case"recoveryCodes":this.showRecoveryCodesComponent();break;case"socserv":this.showSocservComponent();break}}clearHtml(){BX.html(this.container,"");const e=document.getElementsByClassName("ui-entity-wrap");if(e&&e[0]){t.Dom.remove(e[0])}}sendAction(e,t){this.clearHtml();this.loader=this.showLoader({node:this.container,loader:null,size:100});BX.ajax.runComponentAction(this.componentName,e,{signedParameters:this.signedParameters,mode:"ajax",data:t}).then((t=>{this.showComponentData(t,e)}),(e=>{this.showErrorPopup(e.errors[0].message);this.hideLoader({loader:this.loader})}))}showOtpComponent(){this.changeContent("otp")}showOtpConnectedComponent(){this.changeContent("otpList")}showRecoveryCodesComponent(e){if(!e){e=""}this.sendAction("recoveryCodes",{componentMode:e})}showSocservComponent(){this.clearHtml();const e=document.querySelector("[data-action='socserv']");if(BX.type.isDomNode(e)){const t=BX.data(e,"url");if(top.BX.SidePanel.Instance.open(t,{cacheable:false,width:840})){top.BX.addCustomEvent(top.BX.SidePanel.Instance.getSlider(t),"SidePanel.Slider:onClose",BX.proxy((()=>{const e=document.querySelector("[data-action='otpConnected']");if(BX.type.isDomNode(e)){e.click()}}),this))}}}showComponentData(e,t){const o=BX.prop.getArray(e,"errors",[]);if(o.length>0){this.showErrorPopup(e.errors[0].message);return}if(!e.data){this.showErrorPopup("Unknown error");this.hideLoader({loader:this.loader});return}const n=new Promise(BX.delegate(((t,s)=>{if(e.data.hasOwnProperty("assets")&&e.data.assets.css.length>0){BX.load(e.data.assets.css,(()=>{if(e.data.assets.js.length>0){BX.load(e.data.assets.js,(()=>{if(e.data.assets.string.length>0){for(let t=0;t<e.data.assets.string.length;t++){BX.html(null,e.data.assets.string[t])}}t()}))}}))}}),this));n.then(BX.delegate((function(){const s=BX.prop.getString(e.data,"html","");BX.html(this.container,s);const o=BX.prop.getString(BX.prop.getObject(e.data,"additionalParams",""),"pageTitle","");BX.html(BX("pagetitle"),o);top.history.pushState(null,"",`?page=${t}`)}),this));if(t==="otpConnected"){s.sendData({tool:"settings",category:"security",event:"show"})}}showLoader(e){let t=null;if(e.node){if(e.loader===null){t=new BX.Loader({target:e.node,size:e.hasOwnProperty("size")?e.size:40})}else{t=e.loader}t.show()}return t}hideLoader(e){if(e.loader!==null){e.loader.hide()}if(e.node){t.Dom.clean(e.node)}if(e.loader!==null){e.loader=null}}showErrorPopup(e){if(!e){return}BX.PopupWindowManager.create({id:"intranet-user-profile-error-popup",content:BX.create("div",{props:{style:"max-width: 450px"},html:BX.util.htmlspecialchars(e)}),closeIcon:true,lightShadow:true,offsetLeft:100,overlay:false,contentPadding:10}).show()}}e.Security=o})(this.BX.Intranet.UserProfile=this.BX.Intranet.UserProfile||{},BX,BX.UI.Analytics);
//# sourceMappingURL=security.bundle.map.js