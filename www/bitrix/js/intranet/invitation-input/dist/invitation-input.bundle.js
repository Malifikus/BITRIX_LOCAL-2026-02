this.BX=this.BX||{},function(e,s,t,a,l){"use strict";class i{invite(){throw new Error('Implement the method "invite" in the child class')}}var r=babelHelpers.classPrivateFieldLooseKey("groupId"),o=babelHelpers.classPrivateFieldLooseKey("users");class n extends i{constructor(e,s){super(),Object.defineProperty(this,r,{writable:!0,value:void 0}),Object.defineProperty(this,o,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,r)[r]=e,babelHelpers.classPrivateFieldLooseBase(this,o)[o]=s}invite(){return l.ajax.runAction("intranet.invite.inviteUsersToCollab",{data:{collabId:babelHelpers.classPrivateFieldLooseBase(this,r)[r],users:babelHelpers.classPrivateFieldLooseBase(this,o)[o]}}).then(e=>{const s=(null==e?void 0:e.data)||[];let t=null;const a=s.filter(e=>"INVITED"===e.status),i=s.filter(e=>"ACTIVE"===e.status);if(0===s.length?t="INTRANET_INVITATION_INPUT_NO_USERS":i.length===s.length?t=1===i.length?"INTRANET_INVITATION_INPUT_ALREADY_IN_COLLAB_SINGLE":"INTRANET_INVITATION_INPUT_ALREADY_IN_COLLAB_ALL":a.length!==s.length&&(t="INTRANET_INVITATION_INPUT_ALREADY_IN_COLLAB_PARTIAL"),t){const e=l.Loc.getMessage(t);l.Type.isStringFilled(e)&&BX.UI.Notification.Center.notify({content:e,autoHideDelay:2500})}return e})}}var b=babelHelpers.classPrivateFieldLooseKey("users");class c extends i{constructor(e){super(),Object.defineProperty(this,b,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,b)[b]=e}invite(){return l.ajax.runAction("intranet.v2.Invitation.inviteUsers",{data:{invitations:babelHelpers.classPrivateFieldLooseBase(this,b)[b]}})}}let d,p,h=e=>e;const v=Object.freeze({PHONE:"phone",EMAIL:"email",ALL:"all"});var P=babelHelpers.classPrivateFieldLooseKey("cache"),L=babelHelpers.classPrivateFieldLooseKey("invalidPhoneNumbersTagIds"),u=babelHelpers.classPrivateFieldLooseKey("isReadySendInvitation"),g=babelHelpers.classPrivateFieldLooseKey("placeholder"),T=babelHelpers.classPrivateFieldLooseKey("inputType"),H=babelHelpers.classPrivateFieldLooseKey("isPhoneEnabled"),B=babelHelpers.classPrivateFieldLooseKey("isEmailEnabled"),F=babelHelpers.classPrivateFieldLooseKey("userLang"),y=babelHelpers.classPrivateFieldLooseKey("minHeight"),I=babelHelpers.classPrivateFieldLooseKey("showErrorBeforeSubmit"),E=babelHelpers.classPrivateFieldLooseKey("showErrorAfterSubmit"),N=babelHelpers.classPrivateFieldLooseKey("invite"),f=babelHelpers.classPrivateFieldLooseKey("getPreparedUserList"),O=babelHelpers.classPrivateFieldLooseKey("getErrorTags"),A=babelHelpers.classPrivateFieldLooseKey("setReadySaveState"),_=babelHelpers.classPrivateFieldLooseKey("setUnreadySaveState"),m=babelHelpers.classPrivateFieldLooseKey("getPhoneParser"),S=babelHelpers.classPrivateFieldLooseKey("getDefaultPlaceholder"),j=babelHelpers.classPrivateFieldLooseKey("getDefaultValidationMessage"),w=babelHelpers.classPrivateFieldLooseKey("getEmptyValidationMessage"),K=babelHelpers.classPrivateFieldLooseKey("onAfterTagRemove"),C=babelHelpers.classPrivateFieldLooseKey("onBeforeTagAdd"),R=babelHelpers.classPrivateFieldLooseKey("setErrorStateForTag"),V=babelHelpers.classPrivateFieldLooseKey("onEnter"),x=babelHelpers.classPrivateFieldLooseKey("onBlur"),D=babelHelpers.classPrivateFieldLooseKey("onInput"),M=babelHelpers.classPrivateFieldLooseKey("onContainerClick"),U=babelHelpers.classPrivateFieldLooseKey("getEntityTypeByValue"),X=babelHelpers.classPrivateFieldLooseKey("addTagByValue"),W=babelHelpers.classPrivateFieldLooseKey("parseValue"),G=babelHelpers.classPrivateFieldLooseKey("isPhone"),k=babelHelpers.classPrivateFieldLooseKey("addErrorBlockByMessage"),Y=babelHelpers.classPrivateFieldLooseKey("removeErrorBlock"),$=babelHelpers.classPrivateFieldLooseKey("createErrorBlockByMessage");class q extends t.EventEmitter{constructor(e){var s;super(),Object.defineProperty(this,$,{value:ge}),Object.defineProperty(this,Y,{value:ue}),Object.defineProperty(this,k,{value:Le}),Object.defineProperty(this,G,{value:Pe}),Object.defineProperty(this,W,{value:ve}),Object.defineProperty(this,X,{value:he}),Object.defineProperty(this,U,{value:pe}),Object.defineProperty(this,M,{value:de}),Object.defineProperty(this,D,{value:ce}),Object.defineProperty(this,x,{value:be}),Object.defineProperty(this,V,{value:ne}),Object.defineProperty(this,R,{value:oe}),Object.defineProperty(this,C,{value:re}),Object.defineProperty(this,K,{value:ie}),Object.defineProperty(this,w,{value:le}),Object.defineProperty(this,j,{value:ae}),Object.defineProperty(this,S,{value:te}),Object.defineProperty(this,m,{value:se}),Object.defineProperty(this,_,{value:ee}),Object.defineProperty(this,A,{value:Z}),Object.defineProperty(this,O,{value:Q}),Object.defineProperty(this,f,{value:J}),Object.defineProperty(this,N,{value:z}),Object.defineProperty(this,P,{writable:!0,value:new l.Cache.MemoryCache}),Object.defineProperty(this,L,{writable:!0,value:[]}),Object.defineProperty(this,u,{writable:!0,value:!1}),Object.defineProperty(this,g,{writable:!0,value:void 0}),Object.defineProperty(this,T,{writable:!0,value:void 0}),Object.defineProperty(this,H,{writable:!0,value:void 0}),Object.defineProperty(this,B,{writable:!0,value:void 0}),Object.defineProperty(this,F,{writable:!0,value:null}),Object.defineProperty(this,y,{writable:!0,value:null}),Object.defineProperty(this,I,{writable:!0,value:void 0}),Object.defineProperty(this,E,{writable:!0,value:void 0}),babelHelpers.classPrivateFieldLooseBase(this,T)[T]=null!=(s=null==e?void 0:e.inputType)?s:v.ALL,this.setEventNamespace("BX.Intranet.InvitationInput"),babelHelpers.classPrivateFieldLooseBase(this,y)[y]=null==e?void 0:e.minHeight,babelHelpers.classPrivateFieldLooseBase(this,I)[I]=!!l.Type.isBoolean(null==e?void 0:e.showErrorBeforeSubmit)&&e.showErrorBeforeSubmit,babelHelpers.classPrivateFieldLooseBase(this,E)[E]=!l.Type.isBoolean(null==e?void 0:e.showErrorAfterSubmit)||e.showErrorAfterSubmit;const t=l.Extension.getSettings("intranet.invitation-input");if(babelHelpers.classPrivateFieldLooseBase(this,T)[T]===v.PHONE&&(null==t||!t.isInvitationByPhoneAvailable))throw new Error("Incorrect component operation parameters.");babelHelpers.classPrivateFieldLooseBase(this,H)[H]=[v.ALL,v.PHONE].includes(babelHelpers.classPrivateFieldLooseBase(this,T)[T])&&Boolean(null==t?void 0:t.isInvitationByPhoneAvailable),babelHelpers.classPrivateFieldLooseBase(this,B)[B]=[v.ALL,v.EMAIL].includes(babelHelpers.classPrivateFieldLooseBase(this,T)[T]),babelHelpers.classPrivateFieldLooseBase(this,g)[g]=l.Type.isStringFilled(null==e?void 0:e.placeholder)?e.placeholder:babelHelpers.classPrivateFieldLooseBase(this,S)[S]()}changeLanguage(e){l.Type.isString(e)&&(babelHelpers.classPrivateFieldLooseBase(this,F)[F]=e)}getTagSelector(){return babelHelpers.classPrivateFieldLooseBase(this,P)[P].remember("tagSelector",()=>new a.TagSelector({id:"intranet-invitation-input-"+Math.random(4),showTextBox:!0,showAddButton:!1,placeholder:babelHelpers.classPrivateFieldLooseBase(this,g)[g],tagTextColor:"#1E8D36",tagBgColor:"#D4FDB0",tagMaxWidth:200,events:{onAfterTagRemove:babelHelpers.classPrivateFieldLooseBase(this,K)[K].bind(this),onBeforeTagAdd:babelHelpers.classPrivateFieldLooseBase(this,C)[C].bind(this),onEnter:babelHelpers.classPrivateFieldLooseBase(this,V)[V].bind(this),onBlur:babelHelpers.classPrivateFieldLooseBase(this,x)[x].bind(this),onInput:babelHelpers.classPrivateFieldLooseBase(this,D)[D].bind(this),onContainerClick:babelHelpers.classPrivateFieldLooseBase(this,M)[M].bind(this)}}))}isReadySendInvitation(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}render(){return babelHelpers.classPrivateFieldLooseBase(this,P)[P].remember("node",()=>{if(this.getTagSelector().renderTo(this.getWrapper()),this.getTagSelector().focusTextBox(),l.Type.isNumber(babelHelpers.classPrivateFieldLooseBase(this,y)[y])){const e=this.getTagSelector().getItemsContainer();l.Dom.style(e,"min-height",babelHelpers.classPrivateFieldLooseBase(this,y)[y]+"px")}return this.getWrapper()})}renderTo(e){l.Dom.append(this.render(),e)}getWrapper(){return babelHelpers.classPrivateFieldLooseBase(this,P)[P].remember("wrapper",()=>l.Tag.render(d||(d=h`
				<div class="intranet-invitation-wrapper"></div>
			`)))}inviteToGroup(e){const s=new n(e,babelHelpers.classPrivateFieldLooseBase(this,f)[f]());return babelHelpers.classPrivateFieldLooseBase(this,N)[N](s)}inviteToPortal(){const e=new c(babelHelpers.classPrivateFieldLooseBase(this,f)[f]());return babelHelpers.classPrivateFieldLooseBase(this,N)[N](e)}hasErrorTags(){return babelHelpers.classPrivateFieldLooseBase(this,O)[O]().length>0}isEmptyTags(){return 0===this.getTagSelector().getTags().length}}function z(e){return new Promise((s,t)=>{babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](),babelHelpers.classPrivateFieldLooseBase(this,O)[O]().length>0?(babelHelpers.classPrivateFieldLooseBase(this,k)[k](babelHelpers.classPrivateFieldLooseBase(this,j)[j]()),t(babelHelpers.classPrivateFieldLooseBase(this,j)[j]())):0===this.getTagSelector().getTags().length?(babelHelpers.classPrivateFieldLooseBase(this,k)[k](babelHelpers.classPrivateFieldLooseBase(this,w)[w]()),t(babelHelpers.classPrivateFieldLooseBase(this,w)[w]())):e.invite().then(()=>{this.getTagSelector().removeTags(),babelHelpers.classPrivateFieldLooseBase(this,_)[_](),s()}).catch(e=>{babelHelpers.classPrivateFieldLooseBase(this,E)[E]?babelHelpers.classPrivateFieldLooseBase(this,k)[k](e.errors[0].message):this.getTagSelector().removeTags(),t(e.errors[0].message)})})}function J(){babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]();const e=this.getTagSelector().getTags(),s=[];return e.forEach(e=>{babelHelpers.classPrivateFieldLooseBase(this,B)[B]&&"email"===e.getEntityType()&&s.push({email:e.getTitle(),languageId:babelHelpers.classPrivateFieldLooseBase(this,F)[F]}),"phone"===e.getEntityType()&&babelHelpers.classPrivateFieldLooseBase(this,H)[H]&&!babelHelpers.classPrivateFieldLooseBase(this,L)[L].includes(e.getId())&&s.push({phone:e.getTitle()})}),s}function Q(){const e=this.getTagSelector().getTags(),s=[];return e.forEach(e=>{"error"===e.getEntityType()&&s.push(e),"phone"===e.getEntityType()&&babelHelpers.classPrivateFieldLooseBase(this,H)[H]&&babelHelpers.classPrivateFieldLooseBase(this,L)[L].includes(e.getId())&&s.push(e)}),s}function Z(){this.emit("onReadySave"),babelHelpers.classPrivateFieldLooseBase(this,u)[u]=!0}function ee(){this.emit("onUnreadySave"),babelHelpers.classPrivateFieldLooseBase(this,u)[u]=!1}function se(){return BX.PhoneNumberParser.getInstance()}function te(){return babelHelpers.classPrivateFieldLooseBase(this,H)[H]&&!babelHelpers.classPrivateFieldLooseBase(this,B)[B]?l.Loc.getMessage("INTRANET_INVITATION_INPUT_PLACEHOLDER_PHONE"):!babelHelpers.classPrivateFieldLooseBase(this,H)[H]&&babelHelpers.classPrivateFieldLooseBase(this,B)[B]?l.Loc.getMessage("INTRANET_INVITATION_INPUT_PLACEHOLDER"):l.Loc.getMessage("INTRANET_INVITATION_INPUT_PLACEHOLDER_WITH_PHONE")}function ae(){return babelHelpers.classPrivateFieldLooseBase(this,H)[H]&&!babelHelpers.classPrivateFieldLooseBase(this,B)[B]?l.Loc.getMessage("INTRANET_INVITATION_INPUT_VALIDATION_MESSAGE_PHONE"):!babelHelpers.classPrivateFieldLooseBase(this,H)[H]&&babelHelpers.classPrivateFieldLooseBase(this,B)[B]?l.Loc.getMessage("INTRANET_INVITATION_INPUT_VALIDATION_MESSAGE"):l.Loc.getMessage("INTRANET_INVITATION_INPUT_VALIDATION_MESSAGE_WITH_PHONE")}function le(){return babelHelpers.classPrivateFieldLooseBase(this,H)[H]&&!babelHelpers.classPrivateFieldLooseBase(this,B)[B]?l.Loc.getMessage("INTRANET_INVITATION_INPUT_VALIDATION_MESSAGE_PHONE"):!babelHelpers.classPrivateFieldLooseBase(this,H)[H]&&babelHelpers.classPrivateFieldLooseBase(this,B)[B]?l.Loc.getMessage("INTRANET_INVITATION_INPUT_EMPTY_MESSAGE"):l.Loc.getMessage("INTRANET_INVITATION_INPUT_EMPTY_MESSAGE_WITH_PHONE")}function ie(e){const s=e.getTarget().getTags(),t=s.filter(e=>"error"===e.getEntityType());0===t.length&&babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](),0===s.length?babelHelpers.classPrivateFieldLooseBase(this,_)[_]():0===t.length&&(babelHelpers.classPrivateFieldLooseBase(this,A)[A](),babelHelpers.classPrivateFieldLooseBase(this,I)[I]&&babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]())}function re(e){const{tag:s}=e.getData();e.target.getTextBox().placeholder="",babelHelpers.classPrivateFieldLooseBase(this,A)[A](),"error"===s.getEntityType()&&(babelHelpers.classPrivateFieldLooseBase(this,R)[R](s),babelHelpers.classPrivateFieldLooseBase(this,I)[I]&&babelHelpers.classPrivateFieldLooseBase(this,k)[k](babelHelpers.classPrivateFieldLooseBase(this,j)[j]())),"phone"===s.getEntityType()&&babelHelpers.classPrivateFieldLooseBase(this,m)[m]().parse(s.getTitle()).then(e=>{e.valid?s.setTitle(e.rawNumber):(babelHelpers.classPrivateFieldLooseBase(this,R)[R](s),babelHelpers.classPrivateFieldLooseBase(this,L)[L].push(s.getId())),s.render()}).catch(()=>{})}function oe(e){e.setTextColor("#E92F2A"),e.setBgColor("#FFDCDB")}function ne(e){const s=e.getTarget().getTextBoxValue();s&&!/^\s*$/.test(s)&&babelHelpers.classPrivateFieldLooseBase(this,X)[X](s)}function be(e){babelHelpers.classPrivateFieldLooseBase(this,V)[V](e)}function ce(e){babelHelpers.classPrivateFieldLooseBase(this,A)[A]();const s=e.target,t=e.getData().event,a=[" ",","];let l=s.getTextBoxValue();const i=a.indexOf(t.data);if(-1===i)return;const r=a[i];l.endsWith(r)&&(l=l.slice(0,-1)),l&&babelHelpers.classPrivateFieldLooseBase(this,X)[X](l)}function de(){this.getTagSelector().getTextBox().focus()}function pe(e){const s=!!babelHelpers.classPrivateFieldLooseBase(this,H)[H]&&babelHelpers.classPrivateFieldLooseBase(this,G)[G](e);return!!babelHelpers.classPrivateFieldLooseBase(this,B)[B]&&(l.Validation.isEmail(e)&&/^[^@]+@[^@]+\.[^@]+$/.test(e))?"email":s?"phone":"error"}function he(e){const s=this.getTagSelector();babelHelpers.classPrivateFieldLooseBase(this,W)[W](e).forEach(e=>{s.addTag({id:e,title:e,entityId:"invitation-tag",entityType:babelHelpers.classPrivateFieldLooseBase(this,U)[U](e)})}),s.clearTextBox()}function ve(e){return e.split(/[\s,]+/).filter(e=>e.length>0)}function Pe(e){return BX.PhoneNumber.getValidNumberRegex().test(e)}function Le(e){if(this.getWrapper().querySelector(".intranet-invitation-input-error__wrapper"))return;const s=babelHelpers.classPrivateFieldLooseBase(this,$)[$](e);this.getWrapper().append(s),babelHelpers.classPrivateFieldLooseBase(this,_)[_](),l.Dom.hasClass(this.getTagSelector().getOuterContainer(),"--error")||l.Dom.addClass(this.getTagSelector().getOuterContainer(),"--error")}function ue(){const e=this.getWrapper().querySelector(".intranet-invitation-input-error__wrapper");e&&e.remove(),l.Dom.hasClass(this.getTagSelector().getOuterContainer(),"--error")&&l.Dom.removeClass(this.getTagSelector().getOuterContainer(),"--error")}function ge(e){return l.Tag.render(p||(p=h`
			<div class="intranet-invitation-input-error__wrapper">
				<span class="ui-icon-set --warning"></span>
				<span class="intranet-invitation-input-error__text">${0}</span>
			</div>
		`),e)}e.InvitationInputType=v,e.InvitationInput=q}(this.BX.Intranet=this.BX.Intranet||{},BX.Cache,BX.Event,BX.UI.EntitySelector,BX);
//# sourceMappingURL=invitation-input.bundle.js.map
