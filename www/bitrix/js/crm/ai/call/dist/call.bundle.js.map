{"version":3,"file":"call.bundle.js","sources":["../src/base.js","../src/call-quality/pull.js","../src/call-quality/components/common/view-mode.js","../src/call-quality/components/compliance.js","../src/call-quality/components/common/loader.js","../src/call-quality/components/explanation/assessment-settings-pending-block.js","../src/call-quality/components/explanation/empty-script-list-block.js","../src/call-quality/components/explanation/error-block.js","../src/call-quality/components/explanation/not-assessment-script-block.js","../src/call-quality/components/explanation/other-script-block.js","../src/call-quality/components/explanation/pending-block.js","../src/call-quality/components/explanation/recommendation-block.js","../src/call-quality/script-selector-display-strategy.js","../src/call-quality/components/script-selector.js","../src/call-quality/components/call-quality.js","../src/call-quality/rating.js","../src/call-quality/call-quality.js","../src/summary.js","../src/transcription.js","../src/index.js"],"sourcesContent":["import { Slider } from 'crm.ai.slider';\nimport { Attention, AttentionPresets, Textbox } from 'crm.ai.textbox';\nimport { AudioPlayer } from 'crm.audio-player';\nimport { Dom, Loc, Tag, Text, Type } from 'main.core';\nimport { UI } from 'ui.notification';\n\nimport 'ui.design-tokens';\nimport './style.css';\n\nexport const ActivityProvider: Object<string, string> = Object.freeze({\n\tcall: 'VOXIMPLANT_CALL',\n\topenLine: 'IMOPENLINES_SESSION',\n});\n\nexport type aiData = {\n\tactivityId: number,\n\tactivityCreated?: number,\n\townerTypeId: number,\n\townerId: number,\n\tlanguageTitle ?: string,\n\tclientDetailUrl ?: string,\n\tclientFullName ?: string,\n\tuserPhotoUrl ?: string,\n\tjobId ?: number,\n\tassessmentSettingsId ?: number,\n\tactivityProvider ?: string,\n};\n\nexport class Base\n{\n\tactivityId: number;\n\townerTypeId: number;\n\townerId: number;\n\tlanguageTitle: ?string = null;\n\tactivityProvider: ?string = null;\n\n\tid: string;\n\tsliderTitle: string;\n\tsliderWidth: number;\n\ttextboxTitle: string;\n\taiDataAction: string;\n\n\twrapperSlider: Slider;\n\taudioPlayerApp: ?AudioPlayer = null;\n\ttextbox: Textbox;\n\ttopElementNode: ?HTMLElement = null;\n\n\tconstructor(data: aiData)\n\t{\n\t\tthis.initDefaultOptions();\n\n\t\tthis.activityId = data.activityId;\n\t\tthis.ownerTypeId = data.ownerTypeId;\n\t\tthis.ownerId = data.ownerId;\n\t\tthis.languageTitle = data.languageTitle ?? null;\n\t\tthis.activityProvider = data.activityProvider ?? null;\n\t\tthis.jobId = data.jobId ?? null;\n\n\t\tthis.textbox = new Textbox({\n\t\t\ttitle: this.textboxTitle,\n\t\t\tpreviousTextContent: this.getTopElementNode(),\n\t\t\tattentions: this.getTextboxAttentions(),\n\t\t});\n\n\t\tthis.sliderId = `${this.id}-${this.activityId}-${this.jobId ?? '0'}`;\n\t\tthis.wrapperSlider = new Slider({\n\t\t\turl: this.sliderId,\n\t\t\tsliderTitle: this.sliderTitle,\n\t\t\tsliderContentClass: this.getSliderContentClass(),\n\t\t\twidth: this.sliderWidth,\n\t\t\textensions: this.getExtensions(),\n\t\t\tdesign: this.getSliderDesign(),\n\t\t\tevents: this.getSliderEvents(),\n\t\t\ttoolbar: this.getSliderToolbar(),\n\t\t});\n\t}\n\n\tgetExtensions(): Array<string>\n\t{\n\t\treturn ['crm.ai.textbox', 'crm.audio-player'];\n\t}\n\n\tgetSliderContentClass(): ?string\n\t{\n\t\treturn null;\n\t}\n\n\tgetSliderDesign(): ?Object\n\t{\n\t\treturn null;\n\t}\n\n\tgetSliderToolbar(): ?Function\n\t{\n\t\treturn null;\n\t}\n\n\tgetSliderEvents(): Object\n\t{\n\t\treturn {\n\t\t\tonLoad: () => {\n\t\t\t\tthis.audioPlayerApp?.attachTemplate();\n\t\t\t},\n\t\t\tonClose: () => {\n\t\t\t\tthis.audioPlayerApp?.detachTemplate();\n\t\t\t},\n\t\t};\n\t}\n\n\topen()\n\t{\n\t\tconst content = new Promise((resolve, reject) => {\n\t\t\tthis.getAiData()\n\t\t\t\t.then((response) => {\n\t\t\t\t\tif (this.activityProvider === ActivityProvider.call)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.audioPlayerApp?.setAudioProps(this.prepareAudioProps(response));\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.activityProvider === ActivityProvider.openLine)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(this.getOpenLineElementNode(response.data.openline), this.topElementNode);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst aiJobResult = this.prepareAiJobResult(response);\n\t\t\t\t\tthis.textbox.setText(aiJobResult);\n\t\t\t\t\tthis.textbox.render();\n\n\t\t\t\t\tresolve(this.textbox.get());\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.showError(response);\n\t\t\t\t\tthis.wrapperSlider.destroy();\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\n\t\tthis.wrapperSlider.setContent(content);\n\t\tthis.wrapperSlider.open();\n\t}\n\n\tgetAiData(): Promise\n\t{\n\t\tconst actionData = {\n\t\t\tdata: {\n\t\t\t\tactivityId: this.activityId,\n\t\t\t\townerTypeId: this.ownerTypeId,\n\t\t\t\townerId: this.ownerId,\n\t\t\t\tjobId: this.jobId,\n\t\t\t},\n\t\t};\n\n\t\treturn BX.ajax.runAction(this.aiDataAction, actionData);\n\t}\n\n\tshowError(response)\n\t{\n\t\tUI.Notification.Center.notify({\n\t\t\tcontent: response.errors[0].message,\n\t\t\tautoHideDelay: 5000,\n\t\t});\n\t}\n\n\tprepareAiJobResult(response: Object): string\n\t{\n\t\treturn '';\n\t}\n\n\tprepareAudioProps(response: Object): Object\n\t{\n\t\tconst callRecord = response.data.callRecord;\n\n\t\treturn {\n\t\t\tid: callRecord.id,\n\t\t\tsrc: callRecord.src,\n\t\t\ttitle: callRecord.title,\n\t\t\tcontext: window.top,\n\t\t};\n\t}\n\n\tgetTextboxAttentions(): Array\n\t{\n\t\tconst attentions = [this.getNotAccurateAttention()];\n\n\t\tconst jobLanguageAttention = this.getJobLanguageAttention();\n\t\tif (jobLanguageAttention !== null)\n\t\t{\n\t\t\tattentions.push(jobLanguageAttention);\n\t\t}\n\n\t\treturn attentions;\n\t}\n\n\tgetNotAccurateAttention(): Attention\n\t{\n\t\tconst helpdeskCode = '20412666';\n\n\t\tconst content = Loc.getMessage(this.getNotAccuratePhraseCode(), {\n\t\t\t'[helpdesklink]': `<a href=\"##\" onclick=\"top.BX.Helper.show('redirect=detail&code=${helpdeskCode}');\">`,\n\t\t\t'[/helpdesklink]': '</a>',\n\t\t});\n\n\t\treturn new Attention({\n\t\t\tcontent,\n\t\t});\n\t}\n\n\tgetJobLanguageAttention(): ?Attention\n\t{\n\t\tif (!Type.isStringFilled(this.languageTitle))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst helpdeskCode = '20423978';\n\t\tconst content = Loc.getMessage('CRM_COPILOT_CALL_JOB_LANGUAGE_ATTENTION', {\n\t\t\t'#LANGUAGE_TITLE#': `<span style=\"text-transform: lowercase\">${Text.encode(this.languageTitle)}</span>`,\n\t\t\t'[helpdesklink]': `<a href=\"##\" onclick=\"top.BX.Helper.show('redirect=detail&code=${helpdeskCode}');\">`,\n\t\t\t'[/helpdesklink]': '</a>',\n\t\t});\n\n\t\treturn new Attention({\n\t\t\tpreset: AttentionPresets.COPILOT,\n\t\t\tcontent,\n\t\t});\n\t}\n\n\tgetTopElementNode(): ?HTMLElement\n\t{\n\t\tif (this.activityProvider === ActivityProvider.call)\n\t\t{\n\t\t\tthis.topElementNode = Tag.render`<div id=\"crm-textbox-audio-player\"></div>`;\n\n\t\t\t// by default, we attach audio player to the top element node\n\t\t\tthis.audioPlayerApp = new AudioPlayer({\n\t\t\t\trootNode: this.topElementNode,\n\t\t\t});\n\t\t}\n\t\telse if (this.activityProvider === ActivityProvider.openLine)\n\t\t{\n\t\t\tthis.topElementNode = Tag.render`<div id=\"crm-textbox-top-container\"></div>`;\n\t\t}\n\n\t\treturn this.topElementNode;\n\t}\n\n\tgetOpenLineElementNode(openlineData: { dialogId: string, name: string}): HTMLElement\n\t{\n\t\tconst openMessengerSliderFn = (dialogId) => {\n\t\t\treturn () => {\n\t\t\t\tif (Type.isStringFilled(dialogId))\n\t\t\t\t{\n\t\t\t\t\ttop.BXIM.openMessenger(dialogId);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthrow new Error('Dialog ID is empty');\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\t\tconst element = Tag.render`\n\t\t\t<div onclick=\"${openMessengerSliderFn(openlineData.dialogId)}\">\n\t\t\t\t${openlineData.name}\n\t\t\t</div>\n\t\t`;\n\n\t\tDom.addClass(element, 'openline-element-container');\n\n\t\treturn element;\n\t}\n\n\tgetNotAccuratePhraseCode(): string\n\t{\n\t\treturn '';\n\t}\n\n\tgetSliderTitle(): string\n\t{\n\t\treturn '';\n\t}\n\n\tgetTextboxTitle(): string\n\t{\n\t\treturn '';\n\t}\n\n\tinitDefaultOptions(): void {}\n}\n","import { Type } from 'main.core';\nimport { PULL } from 'pull.client';\nimport { QueueManager } from 'pull.queuemanager';\n\nconst CALL_SCORING_ADD_COMMAND = 'call_scoring_add';\nconst CALL_ASSESSMENT_UPDATE_COMMAND = 'call_assessment_update';\n\nexport class Pull\n{\n\t#callScoringCallback: Function;\n\t#callAssessmentCallback: Function;\n\t#unsubscribeFromCallScoring: ?Function = null;\n\t#unsubscribeFromCallAssessment: ?Function = null;\n\n\tconstructor(callScoringCallback: Function, callAssessmentCallback: Function)\n\t{\n\t\tthis.#callScoringCallback = callScoringCallback;\n\t\tthis.#callAssessmentCallback = callAssessmentCallback;\n\t}\n\n\tinit(): void\n\t{\n\t\tif (!PULL)\n\t\t{\n\t\t\tconsole.error('pull is not initialized');\n\n\t\t\treturn;\n\t\t}\n\n\t\t// @todo use only one subscribe with many actions in callback\n\t\tthis.#unsubscribeFromCallScoring = PULL.subscribe({\n\t\t\tmoduleId: 'crm',\n\t\t\tcommand: CALL_SCORING_ADD_COMMAND,\n\t\t\tcallback: (params) => {\n\t\t\t\tif (Type.isStringFilled(params.eventId) && QueueManager.eventIds.has(params.eventId))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#callScoringCallback(params);\n\t\t\t},\n\t\t});\n\n\t\tthis.#unsubscribeFromCallAssessment = PULL.subscribe({\n\t\t\tmoduleId: 'crm',\n\t\t\tcommand: CALL_ASSESSMENT_UPDATE_COMMAND,\n\t\t\tcallback: (params) => {\n\t\t\t\tif (Type.isStringFilled(params.eventId) && QueueManager.eventIds.has(params.eventId))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#callAssessmentCallback(params);\n\t\t\t},\n\t\t});\n\n\t\tPULL.extendWatch(CALL_SCORING_ADD_COMMAND);\n\t\tPULL.extendWatch(CALL_ASSESSMENT_UPDATE_COMMAND);\n\t}\n\n\tunsubscribe(): void\n\t{\n\t\tthis.#unsubscribeFromCallScoring();\n\t\tthis.#unsubscribeFromCallAssessment();\n\t}\n}\n","export type ViewModeType = ViewMode.usedNotAssessmentScript\n\t| ViewMode.usedCurrentVersionOfScript\n\t| ViewMode.usedOtherVersionOfScript\n\t| ViewMode.emptyScriptList\n\t| ViewMode.assessmentSettingsPending\n\t| ViewMode.pending\n\t| ViewMode.error\n;\n\n/*\n* @readonly\n* @enum {string}\n*/\nexport const ViewMode: Object<string, string> = Object.freeze({\n\tusedNotAssessmentScript: 'usedNotAssessmentScript',\n\tusedCurrentVersionOfScript: 'usedCurrentVersionOfScript',\n\tusedOtherVersionOfScript: 'usedOtherVersionOfScript',\n\temptyScriptList: 'emptyScriptList',\n\tassessmentSettingsPending: 'assessmentSettingsPending',\n\tpending: 'pending',\n\terror: 'error',\n});\n","import { Loc } from 'main.core';\nimport { ViewMode } from './common/view-mode';\n\nexport const Compliance = {\n\tprops: {\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tassessment: {\n\t\t\ttype: Number,\n\t\t\tdefault: null,\n\t\t},\n\t\tlowBorder: {\n\t\t\ttype: Number,\n\t\t\tdefault: 30,\n\t\t},\n\t\thighBorder: {\n\t\t\ttype: Number,\n\t\t\tdefault: 70,\n\t\t},\n\t\tviewMode: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t},\n\n\tmounted(): void\n\t{\n\t\tthis.startAnimate();\n\t},\n\n\tmethods: {\n\t\tstartAnimate(): void\n\t\t{\n\t\t\tif (this.$refs.assessment)\n\t\t\t{\n\t\t\t\tthis.animateCounter(this.$refs.assessment, this.assessment);\n\t\t\t}\n\t\t},\n\t\tanimateCounter(counterElement: HTMLElement, targetNumber: number): void\n\t\t{\n\t\t\tlet startNumber = 0;\n\n\t\t\tconst duration = 1500;\n\t\t\tconst increment = targetNumber / (duration / 50);\n\n\t\t\tconst interval = setInterval(() => {\n\t\t\t\tstartNumber += increment;\n\n\t\t\t\tif (startNumber >= targetNumber)\n\t\t\t\t{\n\t\t\t\t\tstartNumber = targetNumber;\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t}\n\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tcounterElement.textContent = Math.floor(startNumber);\n\t\t\t}, 50);\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tclassList(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'call-quality__compliance__container': true,\n\t\t\t\t'--empty-state': !this.isUsedCurrentVersionOfScript,\n\t\t\t\t'--low': this.assessment <= this.lowBorder,\n\t\t\t\t'--high': this.assessment >= this.highBorder,\n\t\t\t};\n\t\t},\n\t\tisUsedCurrentVersionOfScript(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.usedCurrentVersionOfScript;\n\t\t},\n\t\tinfoTitle(): string\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.viewMode === ViewMode.emptyScriptList\n\t\t\t\t\t? Loc.getMessage('CRM_COPILOT_CALL_QUALITY_COMPLIANCE_EMPTY_SCRIPT_LIST_TITLE')\n\t\t\t\t\t: Loc.getMessage('CRM_COPILOT_CALL_QUALITY_COMPLIANCE_TITLE')\n\t\t\t);\n\t\t},\n\t\tvalueTitle(): string\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.viewMode === ViewMode.emptyScriptList\n\t\t\t\t\t? Loc.getMessage('CRM_COPILOT_CALL_QUALITY_COMPLIANCE_EMPTY_SCRIPT_LIST_VALUE')\n\t\t\t\t\t: this.title\n\t\t\t);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div :class=\"classList\">\n\t\t\t<div class=\"call-quality__compliance\">\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isUsedCurrentVersionOfScript\"\n\t\t\t\t\tclass=\"call-quality__compliance__assessment\"\n\t\t\t\t>\n\t\t\t\t\t<span ref=\"assessment\" class=\"call-quality__compliance__assessment-value\">\n\t\t\t\t\t\t{{ assessment }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<div class=\"call-quality__compliance__assessment-measure\">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__compliance__info\">\n\t\t\t\t\t<span class=\"call-quality__compliance__info-title\">\n\t\t\t\t\t\t{{ infoTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class=\"call-quality__compliance__info-value\">\n\t\t\t\t\t\t{{ valueTitle }}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Lottie } from 'ui.lottie';\n\nexport const Loader = {\n\tmounted()\n\t{\n\t\tthis.renderLottieAnimation();\n\t},\n\n\tmethods: {\n\t\trenderLottieAnimation(): HTMLElement\n\t\t{\n\t\t\tconst mainAnimation = Lottie.loadAnimation({\n\t\t\t\tpath: this.getAnimationPath(),\n\t\t\t\tcontainer: this.$refs.lottie,\n\t\t\t\trenderer: 'svg',\n\t\t\t\tloop: true,\n\t\t\t\tautoplay: true,\n\t\t\t});\n\n\t\t\tmainAnimation.setSpeed(0.75);\n\n\t\t\treturn this.$refs.lottie.root;\n\t\t},\n\t\tgetAnimationPath(): string\n\t\t{\n\t\t\treturn '/bitrix/js/crm/ai/call/src/call-quality/lottie/loader.json';\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div ref=\"lottie\" class=\"call-quality__explanation-loader__lottie\"></div>\n\t`,\n};\n","import { Lottie } from 'ui.lottie';\nimport { Loader } from '../common/loader';\n\nexport const AssessmentSettingsPendingBlock = {\n\tcomponents: {\n\t\tLoader,\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container\">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_ASSESSMENT_SETTINGS_PENDING_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\">\n\t\t\t\t\t<div class=\"call-quality__explanation-loader__container\">\n\t\t\t\t\t\t<Loader />\n\t\t\t\t\t\t<div class=\"call-quality__explanation-loader__lottie-text\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_ASSESSMENT_SETTINGS_PENDING_TEXT') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};","import { Loc } from 'main.core';\n\nexport const EmptyScriptListBlock = {\n\n\tcomputed: {\n\t\ttitle(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_TITLE');\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_TEXT');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container\">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\" v-html=\"text\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc, Type } from 'main.core';\n\nexport const ErrorBlock = {\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\terrorText: null,\n\t\t};\n\t},\n\n\tmethods: {\n\t\tsetErrorMessage(message: string): void\n\t\t{\n\t\t\tthis.errorText = message;\n\t\t},\n\t},\n\n\tcomputed: {\n\t\texplanationText(): string\n\t\t{\n\t\t\treturn (\n\t\t\t\tType.isStringFilled(this.errorText)\n\t\t\t\t\t? this.errorText\n\t\t\t\t\t: Loc.getMessage('CRM_COPILOT_CALL_QUALITY_ERROR_TEXT')\n\t\t\t);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container --error\">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_ERROR_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div \n\t\t\t\t\tclass=\"call-quality__explanation-text\"\n\t\t\t\t\tv-html=\"explanationText\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nexport const NotAssessmentScriptBlock = {\n\tmethods: {\n\t\tdoAssessment(): void\n\t\t{\n\t\t\tthis.$emit('doAssessment');\n\t\t},\n\t},\n\n\tcomputed: {\n\t\ttitle(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_NO_EXPLANATION_TITLE');\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_NO_EXPLANATION_TEXT');\n\t\t},\n\t\tbuttonText(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_NO_EXPLANATION_ASSESSMENT');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container \">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ title }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\" v-html=\"text\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"call-quality__explanation__buttons-container\">\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-btn ui-btn-md ui-btn-no-caps ui-btn-color-ai ui-btn-round ui-btn-active\"\n\t\t\t\t\t@click=\"doAssessment\"\n\t\t\t\t>\n\t\t\t\t\t{{ buttonText }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nexport const OtherScriptBlock = {\n\tmethods: {\n\t\tshowAssessment(): void\n\t\t{\n\t\t\tthis.$emit('showAssessment');\n\t\t},\n\t\tdoAssessment(): void\n\t\t{\n\t\t\tthis.$emit('doAssessment');\n\t\t},\n\t},\n\n\tcomputed: {\n\t\ttitle(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_TITLE');\n\t\t},\n\t\ttext(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_TEXT');\n\t\t},\n\t\tbuttonShowText(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_SHOW_ASSESSMENT');\n\t\t},\n\t\tbuttonDoText(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_OLD_EXPLANATION_ASSESSMENT');\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container \">\n\t\t\t\t<div class=\"call-quality__explanation-title\" v-html=\"title\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\" v-html=\"text\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"call-quality__explanation__buttons-container\">\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-btn ui-btn-md ui-btn-no-caps ui-btn-color-ai ui-btn-round ui-btn-active\"\n\t\t\t\t\t@click=\"doAssessment\"\n\t\t\t\t>\n\t\t\t\t\t{{ buttonDoText }}\n\t\t\t\t</button>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-btn ui-btn-md ui-btn-no-caps ui-btn-light-border ui-btn-round\"\n\t\t\t\t\t@click=\"showAssessment\"\n\t\t\t\t>\n\t\t\t\t\t{{ buttonShowText }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Lottie } from 'ui.lottie';\nimport { Loader } from '../common/loader';\n\nexport const PendingBlock = {\n\tcomponents: {\n\t\tLoader,\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation\">\n\t\t\t<div class=\"call-quality__explanation__container\">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_PENDING_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\">\n\t\t\t\t\t<div class=\"call-quality__explanation-loader__container\">\n\t\t\t\t\t\t<Loader />\n\t\t\t\t\t\t<div class=\"call-quality__explanation-loader__lottie-text\">\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_PENDING_TEXT') }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Loc } from 'main.core';\n\nconst ARTICLE_CODE = '23240682';\nconst DISCLAIMER_ARTICLE_CODE = '20412666';\n\nexport const RecommendationBlock = {\n\tprops: {\n\t\trecommendations: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tsummary: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tuseInRating: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\n\tmethods: {\n\t\tshowArticle(): void\n\t\t{\n\t\t\twindow.top.BX?.Helper?.show(`redirect=detail&code=${ARTICLE_CODE}`);\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tdisclaimer(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EXPLANATION_DISCLAIMER_MSGVER_1', {\n\t\t\t\t'#LINK_START#': `<a onclick='window.top.BX?.Helper?.show(\\`redirect=detail&code=${DISCLAIMER_ARTICLE_CODE}\\`)' href=\"#\">`,\n\t\t\t\t'#LINK_END#': '</a>',\n\t\t\t});\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__explanation --copilot-content\">\n\t\t\t<div class=\"call-quality__explanation__container \">\n\t\t\t\t<div class=\"call-quality__explanation-title\">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EXPLANATION_TITLE') }}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-text\">\n\t\t\t\t\t<div \n\t\t\t\t\t\tv-if=\"!useInRating\"\n\t\t\t\t\t\tclass=\"call-quality__explanation-badge\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EXPLANATION_NOT_IN_RATING') }}\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tclass=\"call-quality__explanation-badge-article ui-icon-set --help\"\n\t\t\t\t\t\t\t\t@click=\"showArticle\"\n\t\t\t\t\t\t\t></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{{ summary }}\n\t\t\t\t\t</p>\n\t\t\t\t\t<p>\n\t\t\t\t\t\t{{ recommendations }}\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__explanation-disclaimer\" v-html=\"disclaimer\">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import type { DisplayStrategy } from 'crm.copilot.call-assessment-selector';\nimport { Dom, Tag } from 'main.core';\n\nexport class ScriptSelectorDisplayStrategy implements DisplayStrategy\n{\n\t#container: HTMLElement;\n\ttitleNode: HTMLElement;\n\tinnerTitleNode: HTMLElement;\n\t#isLoading: boolean = false;\n\n\tconstructor()\n\t{\n\t\tthis.#container = this.#createContainer();\n\t}\n\n\tgetTargetNode(): HTMLElement\n\t{\n\t\treturn this.titleNode;\n\t}\n\n\tupdateTitle(title: string): void\n\t{\n\t\tthis.innerTitleNode.innerText = title;\n\t\tthis.innerTitleNode.title = title;\n\t}\n\n\tsetLoading(isLoading: boolean): void\n\t{\n\t\tif (this.#isLoading === isLoading)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isLoading = isLoading;\n\t\tDom.toggleClass(this.#container, '--loading');\n\t}\n\n\t#createContainer(): HTMLElement\n\t{\n\t\tthis.innerTitleNode = Tag.render`<span></span>`;\n\t\tthis.titleNode = Tag.render`\n\t\t\t<div class=\"call-quality__script-selector\">\n\t\t\t\t${this.innerTitleNode}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.titleNode;\n\t}\n}\n","import { CallAssessmentSelector } from 'crm.copilot.call-assessment-selector';\nimport { Router } from 'crm.router';\nimport { DatetimeConverter } from 'crm.timeline.tools';\nimport { Dom, Loc, Runtime } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { HtmlFormatter } from 'ui.bbcode.formatter.html-formatter';\nimport { SidePanel } from 'ui.sidepanel';\nimport { ScriptSelectorDisplayStrategy } from '../script-selector-display-strategy';\nimport { ViewMode } from './common/view-mode';\n\nconst ARTICLE_CODE = '23240682';\nconst SUCCESS_STATUS = 'SUCCESS';\nconst PENDING_STATUS = 'PENDING';\n\nexport const ScriptSelector = {\n\tprops: {\n\t\tassessmentSettingsId: {\n\t\t\ttype: Number,\n\t\t\trequired: true,\n\t\t},\n\t\tassessmentSettingsStatus: {\n\t\t\ttype: String,\n\t\t\tdefault: SUCCESS_STATUS,\n\t\t},\n\t\tassessmentSettingsTitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tisPromptChanged: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t\tpromptUpdatedAt: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tprompt: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tviewMode: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcallAssessmentSelector: this.getCallAssessmentSelector(),\n\t\t\thtmlFormatter: new HtmlFormatter(),\n\t\t};\n\t},\n\n\tmethods: {\n\t\tgetCallAssessmentSelector(): CallAssessmentSelector\n\t\t{\n\t\t\treturn new CallAssessmentSelector({\n\t\t\t\tcurrentCallAssessment: {\n\t\t\t\t\tid: this.assessmentSettingsId,\n\t\t\t\t\ttitle: (\n\t\t\t\t\t\tthis.assessmentSettingsId > 0\n\t\t\t\t\t\t\t? this.assessmentSettingsTitle\n\t\t\t\t\t\t\t: Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_SCRIPT_TITLE')\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\temptyScriptListTitle: Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_SCRIPT_TITLE'),\n\t\t\t\tdisplayStrategy: new ScriptSelectorDisplayStrategy(),\n\t\t\t\tadditionalSelectorOptions: {\n\t\t\t\t\tdialog: {\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t'Item:onBeforeSelect': this.onBeforeSelect.bind(this),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tonBeforeSelect(event: BaseEvent)\n\t\t{\n\t\t\tthis.$emit('onBeforeSelect', this.callAssessmentSelector.getCurrentCallAssessmentItem()?.id);\n\t\t},\n\t\tonEditCallAssessmentSettings({ target }): void\n\t\t{\n\t\t\tif (this.assessmentSettingsStatus === PENDING_STATUS)\n\t\t\t{\n\t\t\t\tthis.showDisabledButtonHint(target);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tRouter.openSlider(\n\t\t\t\t`/crm/copilot-call-assessment/details/${this.assessmentSettingsId}/`,\n\t\t\t\t{\n\t\t\t\t\twidth: 700,\n\t\t\t\t\tcacheable: false,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tonShowActualPrompt(): void\n\t\t{\n\t\t\tthis.$emit('onShowActualPrompt');\n\t\t},\n\t\tshowArticle(): void\n\t\t{\n\t\t\twindow.top.BX?.Helper?.show(`redirect=detail&code=${ARTICLE_CODE}`);\n\t\t},\n\t\tformatHtml(source: string): string\n\t\t{\n\t\t\treturn this.htmlFormatter.format({ source });\n\t\t},\n\t\tclose(): void\n\t\t{\n\t\t\tthis.callAssessmentSelector?.close();\n\t\t},\n\t\tdisable(): void\n\t\t{\n\t\t\tthis.callAssessmentSelector?.disable();\n\t\t},\n\t\tenable(): void\n\t\t{\n\t\t\tthis.callAssessmentSelector?.enable();\n\t\t},\n\t\tdoAssessment({ target }): void\n\t\t{\n\t\t\tif (this.assessmentSettingsStatus === PENDING_STATUS)\n\t\t\t{\n\t\t\t\tthis.showDisabledButtonHint(target);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$emit('doAssessment');\n\t\t},\n\t\tshowDisabledButtonHint(target: HTMLElement): void\n\t\t{\n\t\t\ttop.BX.UI.Hint.popupParameters = {\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tangle: null,\n\t\t\t\tevents: {},\n\t\t\t};\n\n\t\t\tRuntime.debounce(\n\t\t\t\t() => {\n\t\t\t\t\ttop.BX.UI.Hint.show(\n\t\t\t\t\t\ttarget,\n\t\t\t\t\t\tLoc.getMessage('CRM_COPILOT_CALL_QUALITY_SCRIPT_DISABLED_DO_ASSESSMENT_HINT'),\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\t150,\n\t\t\t\tthis,\n\t\t\t)();\n\t\t},\n\t\tisDisabledAssessmentButton(): boolean\n\t\t{\n\t\t\treturn (this.assessmentSettingsStatus !== SUCCESS_STATUS);\n\t\t},\n\t\tisDisabledEditButton(): boolean\n\t\t{\n\t\t\treturn (this.assessmentSettingsStatus === PENDING_STATUS);\n\t\t},\n\t},\n\n\tmounted()\n\t{\n\t\tDom.append(this.callAssessmentSelector.getContainer(), this.$refs.container);\n\n\t\tif (this.$refs.prompt)\n\t\t{\n\t\t\tDom.append(this.formattedPrompt, this.$refs.prompt);\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tscriptUpdatedAt(): string\n\t\t{\n\t\t\tconst date = new Date(this.promptUpdatedAt);\n\t\t\tconst datetimeConverter = new DatetimeConverter(date);\n\n\t\t\tconst dateString = datetimeConverter.toDatetimeString({\n\t\t\t\twithDayOfWeek: false,\n\t\t\t\tdelimiter: ', ',\n\t\t\t});\n\n\t\t\treturn Loc.getMessage(\n\t\t\t\t'CRM_COPILOT_CALL_QUALITY_SCRIPT_INFO_UPDATED',\n\t\t\t\t{\n\t\t\t\t\t'#UPDATED_AT#': dateString,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tformattedPrompt(): string\n\t\t{\n\t\t\treturn this.formatHtml(this.prompt);\n\t\t},\n\t\tisShowFooterButtons(): boolean\n\t\t{\n\t\t\treturn (\n\t\t\t\tthis.viewMode !== ViewMode.usedOtherVersionOfScript\n\t\t\t\t&& this.viewMode !== ViewMode.usedNotAssessmentScript\n\t\t\t\t&& this.viewMode !== ViewMode.pending\n\t\t\t\t&& this.assessmentSettingsId > 0\n\t\t\t);\n\t\t},\n\t\tfooterButtonClassList(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'ui-btn',\n\t\t\t\t'ui-btn-xs',\n\t\t\t\t'ui-btn-no-caps',\n\t\t\t\t'ui-btn-light-border',\n\t\t\t\t'ui-btn-round',\n\t\t\t\t{ 'ui-btn-disabled': this.isDisabledAssessmentButton() },\n\t\t\t];\n\t\t},\n\t\tfooterEditButtonClassList(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'ui-btn',\n\t\t\t\t'ui-btn-xs',\n\t\t\t\t'ui-btn-no-caps',\n\t\t\t\t'ui-btn-round',\n\t\t\t\t'ui-btn-light',\n\t\t\t\t'edit-button',\n\t\t\t\t{ 'ui-btn-disabled': this.isDisabledEditButton() },\n\t\t\t];\n\t\t},\n\t\tisEmptyScriptListViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.emptyScriptList;\n\t\t},\n\t},\n\n\twatch: {\n\t\tprompt(): void\n\t\t{\n\t\t\tDom.clean(this.$refs.prompt);\n\t\t\tDom.append(this.formattedPrompt, this.$refs.prompt);\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div>\n\t\t\t<div class=\"call-quality__script-selector__container\">\n\t\t\t\t<div class=\"call-quality__script-selector__title\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_SCRIPT_SELECTOR_TITLE') }}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"call-quality__script-selector__selector-container\" ref=\"container\"></div>\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"call-quality__script-selector__article ui-icon-set --help\"\n\t\t\t\t\t\t@click=\"showArticle\"\n\t\t\t\t\t></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tv-if=\"this.isPromptChanged && isShowFooterButtons\"\n\t\t\t\tclass=\"call-quality__script-info__container\"\n\t\t\t>\n\t\t\t\t<span>{{scriptUpdatedAt}}</span>\n\t\t\t\t<button\n\t\t\t\t\tclass=\"ui-btn ui-btn-xs ui-btn-no-caps ui-btn-round ui-btn-link ui-btn-active\"\n\t\t\t\t\t@click=\"onShowActualPrompt\"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_SCRIPT_INFO_SHOW_NEW_PROMPT') }}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class=\"call-quality__script-container\">\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isEmptyScriptListViewMode\"\n\t\t\t\t\tclass=\"call-quality__script-text\"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_EMPTY_SCRIPT_LIST_PROMPT_TEXT') }}\n\t\t\t\t</div>\n\t\t\t\t<div v-else class=\"call-quality__script-text\" ref=\"prompt\">\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div\n\t\t\t\t\tv-if=\"isShowFooterButtons\"\n\t\t\t\t\tclass=\"call-quality__script-footer\"\n\t\t\t\t>\n\t\t\t\t\t<button \n\t\t\t\t\t\t:class=\"footerButtonClassList\"\n\t\t\t\t\t\t@click=\"doAssessment\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_SCRIPT_ASSESSMENT_REPLY') }}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button \n\t\t\t\t\t\t:class=\"footerEditButtonClassList\"\n\t\t\t\t\t\t@click=\"onEditCallAssessmentSettings\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('CRM_COPILOT_CALL_QUALITY_SCRIPT_EDIT') }}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { AudioPlayerComponent } from 'crm.audio-player';\nimport { DatetimeConverter } from 'crm.timeline.tools';\nimport { ajax as Ajax, Loc, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Pull } from '../pull';\nimport { ViewMode, ViewModeType } from './common/view-mode';\nimport { Compliance as ComplianceComponent } from './compliance';\nimport { AssessmentSettingsPendingBlock } from './explanation/assessment-settings-pending-block';\nimport { EmptyScriptListBlock } from './explanation/empty-script-list-block';\nimport { ErrorBlock } from './explanation/error-block';\nimport { NotAssessmentScriptBlock } from './explanation/not-assessment-script-block';\nimport { OtherScriptBlock } from './explanation/other-script-block';\nimport { PendingBlock } from './explanation/pending-block';\nimport { RecommendationBlock } from './explanation/recommendation-block';\nimport { ScriptSelector as ScriptSelectorComponent } from './script-selector';\n\ntype Quality = {\n\tid: number;\n\tcreatedAt: number;\n\tassessmentSettingsId: number;\n\tassessmentSettingsStatus: ?string;\n\tassessment: number;\n\tassessmentAvg: number;\n\tprevAssessmentAvg: number;\n\tisPromptChanged: boolean;\n\tuseInRating: boolean;\n\tprompt: string;\n\tactualPrompt: string;\n\tpromptUpdatedAt: string;\n\ttitle: string;\n\trecommendations: string;\n\tsummary: string;\n\tlowBorder: number;\n\thighBorder: number;\n}\n\ntype PullData = {\n\tassessmentSettingsId: ?number;\n\tactivityId: number;\n\tjobId: ?number;\n\tratedUserId: ?number;\n\tstatus?: string;\n}\n\nexport const CallQuality = {\n\tcomponents: {\n\t\tAudioPlayerComponent,\n\t\tScriptSelectorComponent,\n\t\tRecommendationBlock,\n\t\tOtherScriptBlock,\n\t\tNotAssessmentScriptBlock,\n\t\tAssessmentSettingsPendingBlock,\n\t\tPendingBlock,\n\t\tErrorBlock,\n\t\tEmptyScriptListBlock,\n\t\tComplianceComponent,\n\t},\n\n\tprops: {\n\t\tclient: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdata: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\taudioProps: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tcontext: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata(): Object\n\t{\n\t\tconst quality = this.getPreparedQualityProps(this.data);\n\t\tlet prompt = quality.prompt;\n\n\t\tconst currentQualityAssessmentId = quality.id ?? null;\n\t\tlet viewMode: ?ViewModeType = null;\n\t\tif (this.data.viewMode === ViewMode.usedNotAssessmentScript)\n\t\t{\n\t\t\tviewMode = ViewMode.usedNotAssessmentScript;\n\t\t}\n\t\telse if (this.data.viewMode === ViewMode.pending)\n\t\t{\n\t\t\tviewMode = ViewMode.pending;\n\t\t}\n\t\telse if (this.data.viewMode === ViewMode.emptyScriptList)\n\t\t{\n\t\t\tviewMode = ViewMode.emptyScriptList;\n\t\t}\n\t\telse if (quality.id)\n\t\t{\n\t\t\tviewMode = this.data.viewMode ?? ViewMode.usedCurrentVersionOfScript;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tviewMode = ViewMode.error;\n\t\t}\n\n\t\treturn {\n\t\t\tquality,\n\t\t\tcurrentQualityAssessmentId,\n\t\t\tviewMode,\n\t\t\tprompt,\n\t\t\tisShowAudioPlayer: false,\n\t\t\tdirection: this.data.callDirection,\n\t\t};\n\t},\n\n\tmounted()\n\t{\n\t\ttop.BX.Event.EventEmitter.subscribe(\n\t\t\t'crm:copilot:callAssessment:beforeSave',\n\t\t\tthis.onBeforeAssessmentSettingsChange,\n\t\t);\n\n\t\ttop.BX.Event.EventEmitter.subscribe(\n\t\t\t'crm:copilot:callAssessment:save',\n\t\t\tthis.onAssessmentSettingsChange,\n\t\t);\n\n\t\tthis.pull = new Pull(\n\t\t\tthis.onPullChangeScript,\n\t\t\tthis.onPullChangeAssessment,\n\t\t);\n\t\tthis.pull.init();\n\t},\n\n\tmethods: {\n\t\tonBeforeAssessmentSettingsChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst { data } = event.getData();\n\t\t\tif (!this.isPromptChanged(data.prompt))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.quality.assessmentSettingsStatus = 'PENDING';\n\t\t},\n\t\tonAssessmentSettingsChange(event: BaseEvent): void\n\t\t{\n\t\t\tconst { id, data } = event.getData();\n\t\t\tif (!this.isPromptChanged(data.prompt))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.onChangeScript(id);\n\t\t},\n\t\tisPromptChanged(newPrompt: string): boolean\n\t\t{\n\t\t\treturn this.quality.actualPrompt !== newPrompt;\n\t\t},\n\t\tshowAudioPlayer(): void\n\t\t{\n\t\t\tthis.isShowAudioPlayer = true;\n\t\t},\n\t\tonShowActualPrompt(): void\n\t\t{\n\t\t\tthis.viewMode = ViewMode.usedOtherVersionOfScript;\n\t\t\tthis.prompt = this.quality.actualPrompt;\n\t\t},\n\t\tonShowCurrentAssessment(): void\n\t\t{\n\t\t\tthis.viewMode = ViewMode.usedCurrentVersionOfScript;\n\t\t\tthis.prompt = this.quality.prompt;\n\t\t},\n\t\tonDoAssessment(): void\n\t\t{\n\t\t\tthis.viewMode = ViewMode.pending;\n\t\t\tthis.$refs.scriptSelector?.disable();\n\n\t\t\tconst config = {\n\t\t\t\tdata: {\n\t\t\t\t\t...this.context,\n\t\t\t\t\tassessmentSettingsId: this.quality.assessmentSettingsId,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tAjax\n\t\t\t\t.runAction('crm.copilot.callqualityassessment.doAssessment', config)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst { status, data } = response;\n\t\t\t\t\tthis.$refs.scriptSelector?.enable();\n\n\t\t\t\t\tif (status !== 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showError(response);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tEventEmitter.emit('crm.ai.callQuality:doAssessment', { data });\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.showError(response);\n\t\t\t\t\tthis.$refs.scriptSelector?.enable();\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tonChangeScript(assessmentSettingsId: number): void\n\t\t{\n\t\t\tconst config = {\n\t\t\t\tdata: {\n\t\t\t\t\t...this.context,\n\t\t\t\t\tassessmentSettingsId,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tAjax\n\t\t\t\t.runAction('crm.copilot.callqualityassessment.get', config)\n\t\t\t\t.then((response) => {\n\t\t\t\t\tthis.$refs.scriptSelector?.enable();\n\n\t\t\t\t\tconst { status, data } = response;\n\n\t\t\t\t\tif (status !== 'success')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.showError(response);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Type.isObject(data))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.quality = this.getPreparedQualityProps(data);\n\n\t\t\t\t\t\tif (!(\n\t\t\t\t\t\t\tthis.quality.isPromptChanged\n\t\t\t\t\t\t\t&& data.viewMode === ViewMode.assessmentSettingsPending\n\t\t\t\t\t\t\t//&& this.viewMode === ViewMode.usedCurrentVersionOfScript\n\t\t\t\t\t\t))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.viewMode = data.viewMode;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.$refs.scriptSelector?.enable();\n\t\t\t\t\ttop.BX.UI.Notification.Center.notify({\n\t\t\t\t\t\tcontent: response.errors[0].message,\n\t\t\t\t\t\tautoHideDelay: 5000,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tshowError(response)\n\t\t{\n\t\t\tthis.viewMode = ViewMode.error;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.$refs.errorBlock?.setErrorMessage(response.errors[0]?.message);\n\t\t\t});\n\t\t},\n\t\tgetPreparedQualityProps({ callQuality: quality }): Quality\n\t\t{\n\t\t\tif (!Type.isPlainObject(quality))\n\t\t\t{\n\t\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\t\tquality = {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tid: Number(quality.ID ?? 0),\n\t\t\t\tcreatedAt: quality.CREATED_AT ?? null,\n\t\t\t\tassessmentSettingsId: Number(quality.ASSESSMENT_SETTING_ID ?? 0),\n\t\t\t\tassessmentSettingsStatus: quality.ASSESSMENT_SETTINGS_STATUS ?? null,\n\t\t\t\tassessment: Number(quality.ASSESSMENT ?? 0),\n\t\t\t\tassessmentAvg: Number(quality.ASSESSMENT_AVG ?? 0),\n\t\t\t\tprevAssessmentAvg: Number(quality.PREV_ASSESSMENT_AVG ?? 0),\n\t\t\t\tisPromptChanged: Boolean(quality.IS_PROMPT_CHANGED ?? false),\n\t\t\t\tuseInRating: Boolean(quality.USE_IN_RATING ?? false),\n\t\t\t\tprompt: quality.PROMPT ?? '',\n\t\t\t\tactualPrompt: quality.ACTUAL_PROMPT ?? '',\n\t\t\t\tpromptUpdatedAt: quality.PROMPT_UPDATED_AT ?? '',\n\t\t\t\ttitle: quality.TITLE ?? '',\n\t\t\t\trecommendations: quality.RECOMMENDATIONS ?? '',\n\t\t\t\tsummary: quality.SUMMARY ?? '',\n\t\t\t\tlowBorder: Number(quality.LOW_BORDER ?? 30),\n\t\t\t\thighBorder: Number(quality.HIGH_BORDER ?? 70),\n\t\t\t};\n\t\t},\n\t\tclose(): void\n\t\t{\n\t\t\tthis.$refs.scriptSelector?.close();\n\t\t\tthis.pull.unsubscribe();\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe(\n\t\t\t\t'crm:copilot:callAssessment:beforeSave',\n\t\t\t\tthis.onBeforeAssessmentSettingsChange,\n\t\t\t);\n\t\t\ttop.BX.Event.EventEmitter.unsubscribe(\n\t\t\t\t'crm:copilot:callAssessment:save',\n\t\t\t\tthis.onAssessmentSettingsChange,\n\t\t\t);\n\t\t},\n\t\tonPullChangeScript(params: PullData): void\n\t\t{\n\t\t\tif (this.context.activityId !== params.activityId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (params.status === 'error' || !Type.isNumber(params.assessmentSettingsId))\n\t\t\t{\n\t\t\t\tthis.viewMode = ViewMode.error;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.onChangeScript(params.assessmentSettingsId);\n\t\t\t}\n\t\t},\n\t\tonPullChangeAssessment(params: PullData): void\n\t\t{\n\t\t\tconst assessmentSettingsId = params.assessmentSettingsId ?? null;\n\t\t\tconst currentAssessmentSettingsId = this.quality.assessmentSettingsId;\n\n\t\t\tif (assessmentSettingsId !== currentAssessmentSettingsId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.onChangeScript(assessmentSettingsId);\n\t\t},\n\t},\n\n\twatch: {\n\t\tquality: {\n\t\t\thandler(quality) {\n\t\t\t\tthis.prompt = quality.prompt;\n\t\t\t},\n\t\t\tdeep: true,\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tclientNameClassList(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t'call-quality__call-client-name': true,\n\t\t\t\t'--incoming': Number(this.direction) === 1,\n\t\t\t\t'--outgoing': Number(this.direction) === 2,\n\t\t\t}\n\t\t},\n\t\tclientName(): string\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_COPILOT_CALL_QUALITY_AI_CALL_TITLE', {\n\t\t\t\t'[clientname]': `<a href=\"${this.client.detailUrl}\">`,\n\t\t\t\t'[/clientname]': '</a>',\n\t\t\t\t'#CLIENT_NAME#': Text.encode(this.client.fullName),\n\t\t\t});\n\t\t},\n\t\tformattedDate(): string\n\t\t{\n\t\t\tconst datetimeConverter = DatetimeConverter.createFromServerTimestamp(this.client.activityCreated);\n\n\t\t\treturn datetimeConverter.toDatetimeString({\n\t\t\t\twithDayOfWeek: false,\n\t\t\t\tdelimiter: ', ',\n\t\t\t});\n\t\t},\n\t\tisUsedCurrentVersionOfScriptViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.usedCurrentVersionOfScript;\n\t\t},\n\t\tisUsedOtherVersionOfScriptViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.usedOtherVersionOfScript;\n\t\t},\n\t\tisUsedNotAssessmentScriptViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.usedNotAssessmentScript;\n\t\t},\n\t\tisAssessmentSettingsPendingViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.assessmentSettingsPending;\n\t\t},\n\t\tisPendingViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.pending;\n\t\t},\n\t\tisErrorViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.error;\n\t\t},\n\t\tisEmptyScriptListViewMode(): boolean\n\t\t{\n\t\t\treturn this.viewMode === ViewMode.emptyScriptList;\n\t\t},\n\t},\n\n\ttemplate: `\n\t\t<div class=\"call-quality__column --info\">\n\t\t\t<div>\n\t\t\t\t<div class=\"call-quality__header\">\n\t\t\t\t\t<div class=\"call-quality__header-row --flex\">\n\t\t\t\t\t\t<div :class=\"clientNameClassList\" v-html=\"clientName\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"call-quality__call-date\">\n\t\t\t\t\t\t\t{{ formattedDate }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"call-quality__header-row\">\n\t\t\t\t\t\t<div id=\"crm-textbox-audio-player\" ref=\"audioPlayer\">\n\t\t\t\t\t\t\t<AudioPlayerComponent v-if=\"isShowAudioPlayer\" v-bind=\"audioProps\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<ComplianceComponent \n\t\t\t\t\t:assessment=\"quality.assessment\"\n\t\t\t\t\t:title=\"quality.title\"\n\t\t\t\t\t:viewMode=\"viewMode\"\n\t\t\t\t\t:lowBorder=\"quality.lowBorder\"\n\t\t\t\t\t:highBorder=\"quality.highBorder\"\n\t\t\t\t/>\n\t\t\t\t<RecommendationBlock\n\t\t\t\t\tv-if=\"isUsedCurrentVersionOfScriptViewMode\"\n\t\t\t\t\t:recommendations=\"quality.recommendations\"\n\t\t\t\t\t:summary=\"quality.summary\"\n\t\t\t\t\t:use-in-rating=\"quality.useInRating\"\n\t\t\t\t/>\n\t\t\t\t<OtherScriptBlock\n\t\t\t\t\tv-if=\"isUsedOtherVersionOfScriptViewMode\"\n\t\t\t\t\t@showAssessment=\"onShowCurrentAssessment\"\n\t\t\t\t\t@doAssessment=\"onDoAssessment\"\n\t\t\t\t/>\n\t\t\t\t<NotAssessmentScriptBlock\n\t\t\t\t\tv-if=\"isUsedNotAssessmentScriptViewMode\"\n\t\t\t\t\t@doAssessment=\"onDoAssessment\"\n\t\t\t\t/>\n\t\t\t\t<AssessmentSettingsPendingBlock v-if=\"isAssessmentSettingsPendingViewMode\"/>\n\t\t\t\t<PendingBlock v-if=\"isPendingViewMode\"/>\n\t\t\t\t<ErrorBlock v-if=\"isErrorViewMode\" ref=\"errorBlock\"/>\n\t\t\t\t<EmptyScriptListBlock v-if=\"isEmptyScriptListViewMode\"/>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"call-quality__column --prompt\">\n\t\t\t<ScriptSelectorComponent\n\t\t\t\tref=\"scriptSelector\"\n\t\t\t\t:assessmentSettingsId=\"quality.assessmentSettingsId\"\n\t\t\t\t:assessmentSettingsStatus=\"quality.assessmentSettingsStatus\"\n\t\t\t\t:assessmentSettingsTitle=\"quality.title\"\n\t\t\t\t:isPromptChanged=\"quality.isPromptChanged\"\n\t\t\t\t:promptUpdatedAt=\"quality.promptUpdatedAt\"\n\t\t\t\t:prompt=\"prompt\"\n\t\t\t\t:viewMode=\"viewMode\"\n\t\t\t\t@onBeforeSelect=\"onChangeScript\"\n\t\t\t\t@onShowActualPrompt=\"onShowActualPrompt\"\n\t\t\t\t@doAssessment=\"onDoAssessment\"\n\t\t\t/>\n\t\t</div>\n\t`,\n};\n","import { Dom, Loc, Tag, Text, Type } from 'main.core';\n\nconst Trend = Object.freeze({\n\tup: 1,\n\tdown: -1,\n\tnoChanges: 0,\n});\n\ntype TrendValue = Trend.up | Trend.down | Trend.noChanges;\n\nconst ARTICLE_CODE = '23240682';\nconst ARTICLE_ANCHOR = 'rate';\n\nexport class Rating\n{\n\t#id: string;\n\t#rating: ?number = null;\n\t#prevRating: ?number = null;\n\t#userPhotoUrl: ?string = null;\n\t#articleCode: string = ARTICLE_CODE;\n\t#articleAnchor: string = ARTICLE_ANCHOR;\n\t#useSkeletonMode: boolean = true;\n\n\tconstructor()\n\t{\n\t\tthis.#id = `crm.ai.call.quality-rating-${Text.getRandom()}`;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tconst content = (\n\t\t\tthis.#useSkeletonMode\n\t\t\t\t? this.#getSkeleton()\n\t\t\t\t: this.#getContent()\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div id=\"${this.#id}\" class=\"call-quality__rating__container\">\n\t\t\t\t${content}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t// @todo\n\t#getSkeleton(): HTMLElement\n\t{\n\t\treturn Tag.render`<div></div>`;\n\t}\n\n\t#getContent(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"call-quality__rating__text-container\">\n\t\t\t\t${Loc.getMessage('CRM_COPILOT_CALL_QUALITY_RATING')}\n\t\t\t\t<div \n\t\t\t\t\tclass=\"call-quality__rating_article ui-icon-set --help\"\n\t\t\t\t\tonclick=\"${this.#showArticle.bind(this)}\"\n\t\t\t\t></div>\n\t\t\t</div>\n\t\t\t<div class=\"call-quality__rating__value-container\">\n\t\t\t\t${this.#getAvatar()}\n\t\t\t\t<div class=\"call-quality__rating__value\">\n\t\t\t\t\t${this.#rating}\n\t\t\t\t\t<span class=\"call-quality__rating__measure\">%</span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"call-quality__rating__trend ${this.#getTrendClass()}\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getAvatar(): HTMLElement\n\t{\n\t\tif (Type.isStringFilled(this.#userPhotoUrl))\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"call-quality__rating__avatar\"\n\t\t\t\t\tstyle=\"background-image: url('${encodeURI(Text.encode(this.#userPhotoUrl))}')\"\n\t\t\t\t></div>\n\t\t\t`;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"call-quality__rating__avatar ui-icon ui-icon-common-user\">\n\t\t\t\t<i style=\"\"></i>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getTrendClass(): string\n\t{\n\t\tconst trend = this.#getTrend();\n\n\t\tif (trend === Trend.up)\n\t\t{\n\t\t\treturn '--up';\n\t\t}\n\n\t\tif (trend === Trend.down)\n\t\t{\n\t\t\treturn '--down';\n\t\t}\n\n\t\treturn '--no-changes';\n\t}\n\n\t#getTrend(): TrendValue\n\t{\n\t\tif (this.#rating > this.#prevRating)\n\t\t{\n\t\t\treturn Trend.up;\n\t\t}\n\n\t\tif (this.#rating < this.#prevRating)\n\t\t{\n\t\t\treturn Trend.down;\n\t\t}\n\n\t\treturn Trend.noChanges;\n\t}\n\n\t#showArticle(): void\n\t{\n\t\twindow.top.BX?.Helper?.show(`redirect=detail&code=${this.#articleCode}&anchor=${this.#articleAnchor}`);\n\t}\n\n\tsetRating(rating: number): void\n\t{\n\t\tthis.#rating = rating;\n\t}\n\n\tsetPrevRating(rating: number): void\n\t{\n\t\tthis.#prevRating = rating;\n\t}\n\n\tsetUserPhotoUrl(userPhotoUrl: string): void\n\t{\n\t\tthis.#userPhotoUrl = userPhotoUrl;\n\t}\n\n\tsetSkeletonMode(useSkeletonMode: boolean = true): void\n\t{\n\t\tif (this.#useSkeletonMode !== useSkeletonMode)\n\t\t{\n\t\t\tthis.#useSkeletonMode = useSkeletonMode;\n\t\t\tthis.#layout();\n\t\t}\n\t}\n\n\t#layout(): void\n\t{\n\t\tconst currentContent = document.getElementById(this.#id);\n\t\tif (currentContent === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.replace(currentContent, this.render());\n\t}\n}\n","import { Loc, Tag, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { BitrixVue } from 'ui.vue3';\nimport type { aiData } from '../base.js';\nimport { ActivityProvider, Base } from '../base.js';\nimport './style.css';\nimport { CallQuality as CallQualityComponent } from './components/call-quality';\nimport { Rating } from './rating';\n\nimport 'ui.design-tokens';\n\n/**\n * @memberOf BX.Crm.AI.Call\n *\n */\nexport class CallQuality extends Base\n{\n\t#layoutComponent: ?Object = null;\n\t#app: ?Object = null;\n\trating: Rating;\n\t#jobId: ?number;\n\t#clientDetailUrl: ?string;\n\t#clientFullName: ?string;\n\t#activityCreated: ?number;\n\t#userPhotoUrl: ?string;\n\t#assessmentSettingsId: ?number;\n\n\tconstructor(data: aiData)\n\t{\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tdata.activityProvider = ActivityProvider.call; // for call only\n\n\t\tsuper(data);\n\n\t\tthis.#jobId = Type.isNumber(data.jobId) ? data.jobId : null;\n\t\tthis.sliderId = `${this.id}-${this.#jobId ?? this.activityId}`;\n\n\t\tthis.#clientDetailUrl = Type.isStringFilled(data.clientDetailUrl) ? data.clientDetailUrl : null;\n\t\tthis.#clientFullName = Type.isStringFilled(data.clientFullName) ? data.clientFullName : null;\n\t\tthis.#userPhotoUrl = Type.isStringFilled(data.userPhotoUrl) ? data.userPhotoUrl : null;\n\t\tthis.#activityCreated = Type.isNumber(data.activityCreated) ? data.activityCreated : null;\n\t\tthis.#assessmentSettingsId = Type.isNumber(data.assessmentSettingsId) ? data.assessmentSettingsId : null;\n\n\t\tthis.rating = new Rating();\n\t}\n\n\tinitDefaultOptions(): void\n\t{\n\t\tthis.id = 'crm-copilot-call-quality';\n\t\tthis.sliderTitle = Loc.getMessage('CRM_COPILOT_CALL_QUALITY_SLIDER_TITLE');\n\n\t\tconst width = Math.round(BX.SidePanel.Instance.getTopSlider().getWidth() * 0.75);\n\t\tthis.sliderWidth = width > 0 ? width : Math.round(window.screen.width * 0.75);\n\n\t\tthis.textboxTitle = Loc.getMessage('CRM_COPILOT_CALL_TRANSCRIPT_TITLE');\n\n\t\tthis.aiDataAction = 'crm.timeline.ai.getCopilotCallQuality';\n\t}\n\n\tgetExtensions(): Array<string>\n\t{\n\t\tconst extensions = super.getExtensions();\n\n\t\textensions.push('crm.ai.call');\n\n\t\treturn extensions;\n\t}\n\n\tgetSliderContentClass(): ?string\n\t{\n\t\treturn 'crm-copilot-call-quality-wrapper';\n\t}\n\n\tgetSliderDesign(): ?Object\n\t{\n\t\treturn {\n\t\t\tmargin: 0,\n\t\t};\n\t}\n\n\tgetSliderToolbar(): ?Function\n\t{\n\t\treturn () => {\n\t\t\treturn [\n\t\t\t\tthis.rating.render(),\n\t\t\t];\n\t\t};\n\t}\n\n\tgetSliderEvents(): Object\n\t{\n\t\tconst events = super.getSliderEvents();\n\n\t\tevents.onLoad = () => {\n\t\t\tthis.#layoutComponent.showAudioPlayer();\n\t\t};\n\n\t\tevents.onClose = () => {\n\t\t\tthis.#layoutComponent.close();\n\t\t};\n\n\t\treturn events;\n\t}\n\n\t/**\n\t * @override\n\t */\n\topen()\n\t{\n\t\tconst content = new Promise((resolve, reject) => {\n\t\t\tthis.getAiData()\n\t\t\t\t.then((response) => {\n\t\t\t\t\tconst audioProps = this.prepareAudioProps(response);\n\n\t\t\t\t\tthis.#prepareRating(response.data);\n\n\t\t\t\t\tconst context = {\n\t\t\t\t\t\tactivityId: this.activityId,\n\t\t\t\t\t\townerTypeId: this.ownerTypeId,\n\t\t\t\t\t\townerId: this.ownerId,\n\t\t\t\t\t\tjobId: this.#jobId,\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.#app = BitrixVue.createApp(CallQualityComponent, {\n\t\t\t\t\t\tclient: {\n\t\t\t\t\t\t\tdetailUrl: this.#clientDetailUrl,\n\t\t\t\t\t\t\tfullName: this.#clientFullName,\n\t\t\t\t\t\t\tactivityCreated: this.#activityCreated,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata: response.data,\n\t\t\t\t\t\taudioProps,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t});\n\n\t\t\t\t\tconst container = Tag.render`<div class=\"call-quality__container\"></div>`;\n\t\t\t\t\tthis.#layoutComponent = this.#app.mount(container);\n\n\t\t\t\t\tEventEmitter.subscribe('crm.ai.callQuality:doAssessment', () => {\n\t\t\t\t\t\t// @todo will the slider close?\n\t\t\t\t\t\t//this.wrapperSlider?.close();\n\t\t\t\t\t});\n\n\t\t\t\t\tresolve(container);\n\t\t\t\t})\n\t\t\t\t.catch((response) => {\n\t\t\t\t\tthis.showError(response);\n\t\t\t\t\tthis.wrapperSlider.destroy();\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\n\t\tthis.wrapperSlider.setContent(content);\n\t\tthis.wrapperSlider.open();\n\t}\n\n\tgetAiData(): Promise\n\t{\n\t\tconst actionData = {\n\t\t\tdata: {\n\t\t\t\tactivityId: this.activityId,\n\t\t\t\townerTypeId: this.ownerTypeId,\n\t\t\t\townerId: this.ownerId,\n\t\t\t\tjobId: this.#jobId,\n\t\t\t\tassessmentSettingsId: this.#assessmentSettingsId,\n\t\t\t},\n\t\t};\n\n\t\treturn BX.ajax.runAction(this.aiDataAction, actionData);\n\t}\n\n\tgetNotAccuratePhraseCode(): string\n\t{\n\t\treturn 'CRM_COPILOT_CALL_TRANSCRIPT_NOT_BE_ACCURATE';\n\t}\n\n\t#prepareRating({ callQuality }): void\n\t{\n\t\tif (!Type.isPlainObject(callQuality))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { rating } = this;\n\n\t\tif (callQuality)\n\t\t{\n\t\t\trating.setRating(callQuality?.ASSESSMENT_AVG);\n\t\t\trating.setPrevRating(callQuality?.PREV_ASSESSMENT_AVG);\n\t\t}\n\n\t\tif (Type.isStringFilled(this.#userPhotoUrl))\n\t\t{\n\t\t\trating.setUserPhotoUrl(this.#userPhotoUrl);\n\t\t}\n\n\t\trating.setSkeletonMode(false);\n\t}\n}\n","import { Loc } from 'main.core';\n\nimport { Base } from './base.js';\n\n/**\n * @memberOf BX.Crm.AI.Call\n */\nexport class Summary extends Base\n{\n\tinitDefaultOptions(): void\n\t{\n\t\tthis.id = 'crm-copilot-summary';\n\t\tthis.aiDataAction = 'crm.timeline.ai.getCopilotSummary';\n\n\t\tthis.sliderTitle = Loc.getMessage('CRM_COMMON_COPILOT');\n\t\tthis.sliderWidth = 520;\n\n\t\tthis.textboxTitle = Loc.getMessage('CRM_COPILOT_CALL_SUMMARY_TITLE');\n\t}\n\n\tgetNotAccuratePhraseCode(): string\n\t{\n\t\treturn 'CRM_COPILOT_CALL_SUMMARY_NOT_BE_ACCURATE';\n\t}\n\n\tprepareAiJobResult(response: Object): string\n\t{\n\t\treturn response.data.aiJobResult.summary;\n\t}\n}\n","import { Loc } from 'main.core';\n\nimport { ActivityProvider, Base } from './base.js';\nimport type { aiData } from './base.js';\n\n/**\n * @memberOf BX.Crm.AI.Call\n */\nexport class Transcription extends Base\n{\n\tconstructor(data: aiData)\n\t{\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tdata.activityProvider = ActivityProvider.call; // for call only\n\n\t\tsuper(data);\n\t}\n\n\tinitDefaultOptions(): void\n\t{\n\t\tthis.id = 'crm-copilot-transcript';\n\t\tthis.aiDataAction = 'crm.timeline.ai.getCopilotTranscript';\n\n\t\tthis.sliderTitle = Loc.getMessage('CRM_COMMON_COPILOT');\n\t\tthis.sliderWidth = 730;\n\n\t\tthis.textboxTitle = Loc.getMessage('CRM_COPILOT_CALL_TRANSCRIPT_TITLE');\n\t}\n\n\tgetNotAccuratePhraseCode(): string\n\t{\n\t\treturn 'CRM_COPILOT_CALL_TRANSCRIPT_NOT_BE_ACCURATE';\n\t}\n\n\tprepareAiJobResult(response: Object): string\n\t{\n\t\treturn response.data.aiJobResult.transcription;\n\t}\n}\n","import { CallQuality } from './call-quality/call-quality';\nimport { Summary } from './summary.js';\nimport { Transcription } from './transcription.js';\nimport { ActivityProvider } from './base';\n\nexport const Call = {\n\tSummary,\n\tTranscription,\n\tCallQuality,\n};\n\nexport { ActivityProvider };\n"],"names":["ActivityProvider","Object","freeze","call","openLine","Base","data","initDefaultOptions","activityId","ownerTypeId","ownerId","languageTitle","activityProvider","jobId","textbox","Textbox","title","textboxTitle","previousTextContent","getTopElementNode","attentions","getTextboxAttentions","sliderId","id","wrapperSlider","Slider","url","sliderTitle","sliderContentClass","getSliderContentClass","width","sliderWidth","extensions","getExtensions","design","getSliderDesign","events","getSliderEvents","toolbar","getSliderToolbar","onLoad","audioPlayerApp","attachTemplate","onClose","detachTemplate","content","Promise","resolve","reject","getAiData","then","response","setAudioProps","prepareAudioProps","Dom","append","getOpenLineElementNode","openline","topElementNode","aiJobResult","prepareAiJobResult","setText","render","get","showError","destroy","setContent","open","actionData","BX","ajax","runAction","aiDataAction","UI","Notification","Center","notify","errors","message","autoHideDelay","callRecord","src","context","window","top","getNotAccurateAttention","jobLanguageAttention","getJobLanguageAttention","push","helpdeskCode","Loc","getMessage","getNotAccuratePhraseCode","Attention","Type","isStringFilled","Text","encode","preset","AttentionPresets","COPILOT","Tag","AudioPlayer","rootNode","openlineData","openMessengerSliderFn","dialogId","BXIM","openMessenger","Error","element","name","addClass","CALL_SCORING_ADD_COMMAND","CALL_ASSESSMENT_UPDATE_COMMAND","Pull","callScoringCallback","callAssessmentCallback","PULL","console","error","subscribe","moduleId","command","callback","params","eventId","QueueManager","eventIds","has","extendWatch","ViewMode","usedNotAssessmentScript","usedCurrentVersionOfScript","usedOtherVersionOfScript","emptyScriptList","assessmentSettingsPending","pending","Compliance","props","type","String","required","assessment","Number","lowBorder","highBorder","viewMode","mounted","startAnimate","methods","$refs","animateCounter","counterElement","targetNumber","startNumber","duration","increment","interval","setInterval","clearInterval","textContent","Math","floor","computed","classList","isUsedCurrentVersionOfScript","infoTitle","valueTitle","template","Loader","renderLottieAnimation","mainAnimation","Lottie","loadAnimation","path","getAnimationPath","container","lottie","renderer","loop","autoplay","setSpeed","root","AssessmentSettingsPendingBlock","components","EmptyScriptListBlock","text","ErrorBlock","errorText","setErrorMessage","explanationText","NotAssessmentScriptBlock","doAssessment","$emit","buttonText","OtherScriptBlock","showAssessment","buttonShowText","buttonDoText","PendingBlock","ARTICLE_CODE","DISCLAIMER_ARTICLE_CODE","RecommendationBlock","recommendations","summary","useInRating","Boolean","showArticle","Helper","show","disclaimer","ScriptSelectorDisplayStrategy","_classPrivateFieldInitSpec","titleNode","innerTitleNode","innerText","isLoading","toggleClass","SUCCESS_STATUS","PENDING_STATUS","ScriptSelector","assessmentSettingsId","assessmentSettingsStatus","assessmentSettingsTitle","isPromptChanged","promptUpdatedAt","prompt","callAssessmentSelector","getCallAssessmentSelector","htmlFormatter","HtmlFormatter","CallAssessmentSelector","currentCallAssessment","emptyScriptListTitle","displayStrategy","additionalSelectorOptions","dialog","onBeforeSelect","bind","event","getCurrentCallAssessmentItem","onEditCallAssessmentSettings","target","showDisabledButtonHint","Router","openSlider","cacheable","onShowActualPrompt","formatHtml","source","format","close","disable","enable","Hint","popupParameters","closeByEsc","autoHide","angle","Runtime","debounce","isDisabledAssessmentButton","isDisabledEditButton","getContainer","formattedPrompt","scriptUpdatedAt","date","Date","datetimeConverter","DatetimeConverter","dateString","toDatetimeString","withDayOfWeek","delimiter","isShowFooterButtons","footerButtonClassList","footerEditButtonClassList","isEmptyScriptListViewMode","watch","clean","CallQuality","AudioPlayerComponent","ScriptSelectorComponent","ComplianceComponent","client","audioProps","quality","getPreparedQualityProps","currentQualityAssessmentId","isShowAudioPlayer","direction","callDirection","Event","EventEmitter","onBeforeAssessmentSettingsChange","onAssessmentSettingsChange","pull","onPullChangeScript","onPullChangeAssessment","init","getData","onChangeScript","newPrompt","actualPrompt","showAudioPlayer","onShowCurrentAssessment","onDoAssessment","scriptSelector","config","Ajax","status","emit","isObject","$nextTick","errorBlock","callQuality","isPlainObject","ID","createdAt","CREATED_AT","ASSESSMENT_SETTING_ID","ASSESSMENT_SETTINGS_STATUS","ASSESSMENT","assessmentAvg","ASSESSMENT_AVG","prevAssessmentAvg","PREV_ASSESSMENT_AVG","IS_PROMPT_CHANGED","USE_IN_RATING","PROMPT","ACTUAL_PROMPT","PROMPT_UPDATED_AT","TITLE","RECOMMENDATIONS","SUMMARY","LOW_BORDER","HIGH_BORDER","unsubscribe","isNumber","currentAssessmentSettingsId","handler","deep","clientNameClassList","clientName","detailUrl","fullName","formattedDate","createFromServerTimestamp","activityCreated","isUsedCurrentVersionOfScriptViewMode","isUsedOtherVersionOfScriptViewMode","isUsedNotAssessmentScriptViewMode","isAssessmentSettingsPendingViewMode","isPendingViewMode","isErrorViewMode","Trend","up","down","noChanges","ARTICLE_ANCHOR","Rating","_classPrivateMethodInitSpec","getRandom","rating","userPhotoUrl","useSkeletonMode","_classPrivateMethodGet","encodeURI","trend","currentContent","document","getElementById","replace","clientDetailUrl","clientFullName","round","SidePanel","Instance","getTopSlider","getWidth","screen","margin","BitrixVue","createApp","CallQualityComponent","mount","setRating","setPrevRating","setUserPhotoUrl","setSkeletonMode","Summary","Transcription","transcription","Call"],"mappings":"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"}