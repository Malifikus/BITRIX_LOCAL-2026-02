{"version":3,"file":"toolbar.bundle.js","sources":["../src/context.js","../src/item.js","../src/items/tools/base-tour.js","../src/items/booking/options.js","../src/items/booking/tour.js","../src/items/booking/util.js","../src/items/booking/analytic.js","../src/items/booking/booking.js","../src/items/call.js","../src/items/witheditor.js","../src/items/comment.js","../src/items/delivery.js","../src/items/einvoice-app.js","../src/items/email.js","../src/items/gotochat/services-config.js","../src/items/gotochat/gotochat.js","../src/items/market.js","../src/items/meeting.js","../src/components/resplacement/enums/button-type.js","../src/components/resplacement/enums/action-type.js","../src/components/resplacement/enums/event-type.js","../src/components/resplacement/action.js","../src/components/resplacement/enums/button-state.js","../src/components/resplacement/layout/button.js","../src/components/resplacement/layout.js","../src/components/resplacement/enums/block-type.js","../src/components/resplacement/enums/text-color.js","../src/components/resplacement/enums/text-size.js","../src/components/resplacement/layout/blocks/text.js","../src/components/resplacement/layout/blocks/link.js","../src/components/resplacement/enums/block-with-title-width.js","../src/components/resplacement/layout/blocks/base-blocks-collection.js","../src/components/resplacement/layout/blocks/line-of-text-blocks.js","../src/components/resplacement/layout/blocks/with-title.js","../src/components/resplacement/layout/blocks/dropdown-menu.js","../src/components/resplacement/layout/blocks/inputs/input-text.js","../src/components/resplacement/layout/blocks/inputs/select.js","../src/components/resplacement/layout/blocks/inputs/textarea.js","../src/components/resplacement/layout/blocks/base-input-wrapper.js","../src/components/resplacement/layout/blocks/text-input-wrapper.js","../src/components/resplacement/layout/blocks/select-wrapper.js","../src/components/resplacement/layout/blocks/textarea-wrapper.js","../src/components/resplacement/layout/blocks/list.js","../src/components/resplacement/enums/section-image-size.js","../src/components/resplacement/enums/section-type.js","../src/components/resplacement/layout/blocks/section.js","../src/components/resplacement/layout/blocks-collection.js","../src/items/restplacement/tour.js","../src/items/restplacement/base.js","../src/items/restplacement/layoutvalidator.js","../src/items/restplacement/placement-interface-manager.js","../src/items/restplacement/withlayout.js","../src/items/restplacement/withslider.js","../src/items/sharing.js","../src/items/sms/message.js","../src/items/sms/sms.js","../src/items/sms/internal/actions.js","../src/items/sms/internal/menu-helper.js","../src/items/sms/tour.js","../src/items/sms/whatsapp.js","../src/items/task.js","../src/items/todo/tour.js","../src/items/todo/todo.js","../src/items/visit.js","../src/items/tools/wait-configuration-dialog.js","../src/items/wait.js","../src/items/zoom.js","../src/factory.js","../src/menubar.js"],"sourcesContent":["import { Type } from 'main.core';\n\ndeclare type ContextParams = {\n\tentityTypeId: Number,\n\tentityId: Number,\n\tentityCategoryId: ?Number,\n\tisReadonly: Boolean,\n\tmenuBarContainer: HTMLElement,\n\textras: Extras,\n}\n\ndeclare type Extras = {\n\tanalytics: Analytics;\n}\n\ntype Analytics = {\n\tc_section?: string;\n\tc_sub_section?: string;\n}\n\nexport default class Context\n{\n\t#entityTypeId: Number = null;\n\t#entityId: Number = null;\n\t#entityCategoryId: ?Number = null;\n\t#isReadonly: Boolean = false;\n\t#menuBarContainer: HTMLElement = null;\n\t#extras: Extras = {};\n\n\tconstructor(params: ContextParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#entityCategoryId = Type.isNumber(params.entityCategoryId) ? params.entityCategoryId : null;\n\t\tthis.#isReadonly = params.isReadonly;\n\t\tthis.#menuBarContainer = params.menuBarContainer;\n\t\tthis.#extras = params.extras ?? {};\n\t}\n\n\tgetEntityTypeId(): Number\n\t{\n\t\treturn this.#entityTypeId;\n\t}\n\n\tgetEntityId(): Number\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\tgetEntityCategoryId(): ?Number\n\t{\n\t\treturn this.#entityCategoryId;\n\t}\n\n\tisReadonly(): Boolean\n\t{\n\t\treturn this.#isReadonly;\n\t}\n\n\tgetMenuBarContainer(): HTMLElement\n\t{\n\t\treturn this.#menuBarContainer;\n\t}\n\n\tgetExtras(): Extras\n\t{\n\t\treturn this.#extras;\n\t}\n}\n","import { Dom, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { UI } from 'ui.notification';\n\nimport Context from './context';\n\nexport default class Item\n{\n\tstatic ON_FINISH_EDIT_EVENT = 'onFinishEdit';\n\n\t#context: Context = null;\n\t#settings = {};\n\t#eventEmitter: EventEmitter = null;\n\t#isVisible: Boolean = false;\n\t#container: ?HTMLElement = null;\n\n\tinitialize(context: Context, settings: ?Object): void\n\t{\n\t\tthis.#context = context;\n\t\tthis.#settings = settings;\n\t\tthis.#eventEmitter = new EventEmitter();\n\t\tthis.#eventEmitter.setEventNamespace('BX.Crm.Timeline.MenuBar');\n\n\t\tthis.initializeSettings();\n\n\t\tif (!this.#context.isReadonly() && this.supportsLayout())\n\t\t{\n\t\t\tthis.#container = this.createLayout();\n\t\t\tDom.prepend(this.#container, this.getMenuBarContainer());\n\t\t\tthis.initializeLayout();\n\t\t}\n\n\t\tthis.showTour();\n\t}\n\n\tgetEntityTypeId(): Number\n\t{\n\t\treturn this.#context.getEntityTypeId();\n\t}\n\n\tgetEntityId(): Number\n\t{\n\t\treturn this.#context.getEntityId();\n\t}\n\n\tgetEntityCategoryId(): ?Number\n\t{\n\t\treturn this.#context.getEntityCategoryId();\n\t}\n\n\tgetMenuBarContainer(): HTMLElement\n\t{\n\t\treturn this.#context.getMenuBarContainer();\n\t}\n\n\tgetExtras(): Object\n\t{\n\t\treturn this.#context.getExtras();\n\t}\n\n\tgetContainer(): ?HTMLElement\n\t{\n\t\treturn this.#container;\n\t}\n\n\tsetContainer(container: HTMLElement): void\n\t{\n\t\tif (\n\t\t\tType.isDomNode(container)\n\t\t\t&& !this.#context.isReadonly()\n\t\t\t&& this.supportsLayout()\n\t\t)\n\t\t{\n\t\t\tif (this.#container)\n\t\t\t{\n\t\t\t\tDom.remove(this.#container);\n\t\t\t}\n\n\t\t\tthis.#container = container;\n\t\t\tDom.prepend(this.#container, this.getMenuBarContainer());\n\t\t\tthis.initializeLayout();\n\t\t}\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn true;\n\t}\n\n\tactivate(): void\n\t{\n\t\tif (this.supportsLayout())\n\t\t{\n\t\t\tthis.setVisible(true);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showSlider();\n\t\t}\n\t}\n\n\tdeactivate(): void\n\t{\n\t\tthis.setVisible(false);\n\t}\n\n\tshowSlider(): void\n\t{\n\t\tthrow new Error('Method showSlider() must be overridden');\n\t}\n\n\tgetSetting(setting: String, defaultValue = null)\n\t{\n\t\treturn this.#settings?.[setting] ?? defaultValue;\n\t}\n\n\tsetSettings(settings: ?Object): void\n\t{\n\t\tthis.#settings = settings;\n\t}\n\n\tgetSettings(): ?Object\n\t{\n\t\treturn this.#settings;\n\t}\n\n\tsetVisible(visible: Boolean): void\n\t{\n\t\tvisible = !!visible;\n\t\tif (this.#isVisible === visible)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isVisible = visible;\n\t\tconst container = this.getContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (visible)\n\t\t{\n\t\t\tDom.removeClass(container, '--hidden');\n\t\t\tthis.onShow();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.onHide();\n\t\t\tDom.addClass(container, '--hidden');\n\t\t}\n\t}\n\n\tisVisible(): Boolean\n\t{\n\t\treturn this.#isVisible;\n\t}\n\n\tsetFocused(isFocused: Boolean): void\n\t{\n\t\tconst container = this.getContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (isFocused)\n\t\t{\n\t\t\tDom.addClass(container, '--focus');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(container, '--focus');\n\t\t}\n\t}\n\n\tsetLocked(isLocked: Boolean): void\n\t{\n\t\tconst container = this.getContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (isLocked)\n\t\t{\n\t\t\tDom.addClass(container, '--locked');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(container, '--locked');\n\t\t}\n\t}\n\n\tisLocked(): Boolean\n\t{\n\t\tconst container = this.getContainer();\n\t\tif (!container)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn Dom.hasClass(container, '--locked');\n\t}\n\n\taddFinishEditListener(callback)\n\t{\n\t\tthis.#eventEmitter.subscribe(Item.ON_FINISH_EDIT_EVENT, callback);\n\t}\n\n\temitFinishEditEvent()\n\t{\n\t\tthis.#eventEmitter.emit(Item.ON_FINISH_EDIT_EVENT);\n\t}\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthrow new Error('Method createLayout() must be overridden');\n\t}\n\n\tinitializeSettings(): void\n\t{}\n\n\tinitializeLayout(): void\n\t{}\n\n\tonShow(): void\n\t{}\n\n\tonHide(): void\n\t{}\n\n\tshowTour(): void\n\t{}\n\n\tshowNotify(content: string): void\n\t{\n\t\tUI.Notification.Center.notify({ content });\n\t}\n}\n","import { TourInterface } from 'crm.tour-manager';\nimport { Dom, Event, Loc, Runtime, Type } from 'main.core';\nimport { Guide } from 'ui.tour';\n\nconst SPOTLIGHT_ID_PREFIX = 'spotlight-crm-timeline-menubar';\nconst SPOTLIGHT_TARGET_VERTEX = 'middle-center';\nconst SPOTLIGHT_Z_INDEX = 200;\n\nconst GUIDE_LINK_CLASS_NAME = 'crm-entity-stream-content-new-detail-guide-link';\nconst GUIDE_POPUP_WIDTH = 400;\nconst GUIDE_POPUP_POSITION = 'bottom';\n\nexport type MenuBarTourParams = {\n\titemCode: string,\n\ttitle: string,\n\ttext: string,\n\tarticleCode: ?number,\n\tuserOptionName: ?string,\n\tlinkTitle: ?string,\n\tguideBindElement: ?HTMLElement,\n\tguidePopupWidth: ?number,\n\tstayShowedSpotlight?: boolean,\n};\n\nexport class BaseTour implements TourInterface\n{\n\t#params: MenuBarTourParams = {};\n\n\t#spotlight: ?BX.SpotLight = null;\n\t#guide: ?Guide = null;\n\t#guideBindElement: ?HTMLElement = null;\n\t#targetElementRect: ?DOMRect = null;\n\t#observerTimeoutId: number = null;\n\n\tconstructor(params: MenuBarTourParams)\n\t{\n\t\tif (!this.#assertValidParams(params))\n\t\t{\n\t\t\tthrow new TypeError('Invalid menu bar tour params');\n\t\t}\n\n\t\tthis.#params = params;\n\t\tthis.onWindowResize = Runtime.debounce(this.onWindowResize.bind(this), 100);\n\n\t\tEvent.bind(window, 'resize', this.onWindowResize);\n\t}\n\n\tonWindowResize(): void\n\t{\n\t\tconst target = this.#getGuideBindElement(true);\n\n\t\tthis.#guide.getCurrentStep().setTarget(target);\n\t\tthis.#guide.showNextStep();\n\n\t\tthis.#spotlight.setTargetElement(target);\n\t}\n\n\tcanShow(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#spotlight = this.#getSpotlight();\n\t\tthis.#spotlight.show();\n\t\tthis.getGuide().showNextStep();\n\t}\n\n\tgetGuide(): Guide\n\t{\n\t\tif (!this.#guide)\n\t\t{\n\t\t\tconst guideCfg = {\n\t\t\t\tonEvents: true,\n\t\t\t\tsteps: [{\n\t\t\t\t\ttarget: this.#getGuideBindElement(),\n\t\t\t\t\ttitle: this.#params.title,\n\t\t\t\t\ttext: this.#params.text,\n\t\t\t\t\tposition: GUIDE_POPUP_POSITION,\n\t\t\t\t\trounded: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\tthis.saveUserOption(this.#params.userOptionName);\n\t\t\t\t\t\t\tthis.#spotlight.close();\n\t\t\t\t\t\t\tif (this.#observerTimeoutId)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tclearInterval(this.#observerTimeoutId);\n\t\t\t\t\t\t\t\tthis.#observerTimeoutId = null;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tEvent.unbind(window, 'resize', this.onWindowResize);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}],\n\t\t\t};\n\n\t\t\tif (this.#params.articleCode > 0)\n\t\t\t{\n\t\t\t\tguideCfg.steps[0].article = this.#params.articleCode;\n\t\t\t\tguideCfg.steps[0].linkTitle = this.#params.linkTitle ?? Loc.getMessage('CRM_TIMELINE_DETAILS');\n\t\t\t}\n\n\t\t\tconst guide = new Guide(guideCfg);\n\n\t\t\tconst guidePopup = guide.getPopup();\n\t\t\tguidePopup.setWidth(this.#params.guidePopupWidth ?? GUIDE_POPUP_WIDTH);\n\n\t\t\tconst link = guidePopup.contentContainer.querySelector('.ui-tour-popup-link');\n\t\t\tDom.addClass(link, GUIDE_LINK_CLASS_NAME);\n\n\t\t\tthis.#targetElementRect = Dom.getPosition(this.#getGuideBindElement());\n\t\t\tthis.#observerTimeoutId = setInterval(this.#handleTargetElementResize.bind(this), 1000);\n\n\t\t\tthis.#guide = guide;\n\t\t}\n\n\t\treturn this.#guide;\n\t}\n\n\tsaveUserOption(optionName: ?string = null): void\n\t{\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.warn('Method save is not implemented');\n\t}\n\n\t#getSpotlight(): BX.SpotLight\n\t{\n\t\tconst spotlight = new BX.SpotLight(\n\t\t\t{\n\t\t\t\tid: `${SPOTLIGHT_ID_PREFIX}-${this.#params.itemCode}-guide`,\n\t\t\t\ttargetElement: this.#getGuideBindElement(),\n\t\t\t\ttargetVertex: SPOTLIGHT_TARGET_VERTEX,\n\t\t\t\tzIndex: SPOTLIGHT_Z_INDEX,\n\t\t\t\tautoSave: 'no',\n\t\t\t},\n\t\t);\n\n\t\tspotlight.bindEvents({\n\t\t\tonTargetEnter: () => {\n\t\t\t\tif (this.#params.stayShowedSpotlight !== true)\n\t\t\t\t{\n\t\t\t\t\tspotlight.close();\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\n\t\treturn spotlight;\n\t}\n\n\t#getGuideBindElement(force: boolean = false): HTMLElement\n\t{\n\t\tif (Type.isDomNode(this.#params.guideBindElement))\n\t\t{\n\t\t\tthis.#guideBindElement = this.#params.guideBindElement;\n\n\t\t\treturn this.#guideBindElement;\n\t\t}\n\n\t\tif (!this.#guideBindElement || force)\n\t\t{\n\t\t\tthis.#guideBindElement = document.querySelector(`[data-id=\"${this.#params.itemCode}\"]`);\n\t\t\tif (this.#guideBindElement.offsetTop)\n\t\t\t{\n\t\t\t\tthis.#guideBindElement = this.#guideBindElement.parentElement.nextElementSibling;\n\t\t\t}\n\t\t}\n\n\t\treturn this.#guideBindElement;\n\t}\n\n\t#handleTargetElementResize(): void\n\t{\n\t\tconst currentRect = Dom.getPosition(this.#getGuideBindElement());\n\n\t\tif (\n\t\t\tcurrentRect.left !== this.#targetElementRect.left\n\t\t\t|| currentRect.right !== this.#targetElementRect.right\n\t\t\t|| currentRect.top !== this.#targetElementRect.top\n\t\t\t|| currentRect.bottom !== this.#targetElementRect.bottom\n\t\t)\n\t\t{\n\t\t\tthis.#targetElementRect = Dom.getPosition(this.#guideBindElement);\n\n\t\t\tconst targetElement = this.#guideBindElement;\n\t\t\tconst isVisible = Boolean(\n\t\t\t\ttargetElement.offsetWidth\n\t\t\t\t|| targetElement.offsetHeight\n\t\t\t\t|| targetElement.getClientRects().length > 0,\n\t\t\t);\n\n\t\t\tconst guidePopup = this.#guide.getPopup();\n\t\t\tif (isVisible)\n\t\t\t{\n\t\t\t\tDom.removeClass(guidePopup.popupContainer, '--hidden');\n\t\t\t\tguidePopup.adjustPosition();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.addClass(guidePopup.popupContainer, '--hidden');\n\t\t\t}\n\t\t}\n\t}\n\n\t#assertValidParams(params: MenuBarTourParams): boolean\n\t{\n\t\tif (!Type.isPlainObject(params))\n\t\t{\n\t\t\tconsole.error('\"params\" must be specified');\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(params.title))\n\t\t{\n\t\t\tconsole.error('\"title\" must be specified');\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Type.isStringFilled(params.text))\n\t\t{\n\t\t\tconsole.error('\"text\" must be specified');\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tgetParams(): MenuBarTourParams\n\t{\n\t\treturn this.#params;\n\t}\n}\n","import { Reflection } from 'main.core';\n\nconst UserOptions = Reflection.namespace('BX.userOptions');\n\nexport default class Options\n{\n\tstatic BOOKING_ADS_OPTION = 'booking_ads';\n\tstatic START_BANNER = 'start_banner';\n\tstatic BEFORE_FIRST_RESOURCE_AHA_OPTION_NAME = 'before_first_resource';\n\tstatic AFTER_FIRST_RESOURCE_AHA_OPTION_NAME = 'after_first_resource';\n\n\tsaveUserOption(optionName: string)\n\t{\n\t\tthis.#checkOption(optionName);\n\t\tUserOptions.save('crm', Options.BOOKING_ADS_OPTION, optionName, 1);\n\t}\n\n\t#checkOption(optionName: string)\n\t{\n\t\tif (![\n\t\t\tOptions.START_BANNER,\n\t\t\tOptions.BEFORE_FIRST_RESOURCE_AHA_OPTION_NAME,\n\t\t\tOptions.AFTER_FIRST_RESOURCE_AHA_OPTION_NAME,\n\t\t].includes(optionName))\n\t\t{\n\t\t\tthrow new Error(`User option with name: ${optionName} unsupported`);\n\t\t}\n\t}\n}\n","import { BaseTour } from '../tools/base-tour';\nimport Options from './options';\n\nexport default class Tour extends BaseTour\n{\n\t/**\n\t * @override\n\t * */\n\tsaveUserOption(optionName: ?string = null): void\n\t{\n\t\tnew Options().saveUserOption(optionName);\n\t}\n}\n","export function Resolvable(): Promise\n{\n\tlet resolve;\n\tconst promise = new Promise((res) => {\n\t\tresolve = res;\n\t});\n\n\tpromise.resolve = resolve;\n\n\treturn promise;\n}\n","import { sendData } from 'ui.analytics';\n\nexport default class BannerAnalytics\n{\n\tstatic ANALYTICS_TOOL_BOOKING = 'booking';\n\tstatic ANALYTICS_CATEGORY_BOOKING = 'booking';\n\tstatic ANALYTICS_SECTION_CRM = 'crm';\n\n\tstatic sendShowPopup(): void\n\t{\n\t\tconst options = {\n\t\t\ttool: BannerAnalytics.ANALYTICS_TOOL_BOOKING,\n\t\t\tcategory: BannerAnalytics.ANALYTICS_CATEGORY_BOOKING,\n\t\t\tevent: 'show_popup',\n\t\t\tc_section: BannerAnalytics.ANALYTICS_SECTION_CRM,\n\t\t};\n\t\tsendData(options);\n\t}\n\n\tstatic sendClickEnable(): void\n\t{\n\t\tconst options = {\n\t\t\ttool: BannerAnalytics.ANALYTICS_TOOL_BOOKING,\n\t\t\tcategory: BannerAnalytics.ANALYTICS_CATEGORY_BOOKING,\n\t\t\tevent: 'click_enable',\n\t\t\tc_section: BannerAnalytics.ANALYTICS_SECTION_CRM,\n\t\t};\n\t\tsendData(options);\n\t}\n}\n","import { Dom, Loc, Runtime } from 'main.core';\nimport { BitrixVue } from 'ui.vue3';\nimport { BannerDispatcher, Priority } from 'crm.integration.ui.banner-dispatcher';\nimport { TourManager } from 'crm.tour-manager';\nimport Item from '../../item';\nimport Tour from './tour';\nimport Options from './options';\nimport { Resolvable } from './util';\nimport BannerAnalytics from './analytic';\n\ninterface AhaParams {\n\titemCode: string,\n\ttitle: string,\n\tbody: string,\n}\n\nexport default class Booking extends Item\n{\n\t#bannerDispatcher: BannerDispatcher;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\n\t\tthis.#bannerDispatcher = new BannerDispatcher();\n\t}\n\n\tshowSlider(): void\n\t{\n\t\tif (!this.#isFeatureEnabled())\n\t\t{\n\t\t\tthis.#showFeaturePromoter();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst entities = this.getSettings()?.entities;\n\t\tconst embedEntities = JSON.stringify(entities);\n\n\t\tconst url = `/booking/?embed=${embedEntities}`;\n\n\t\tif (BX.SidePanel)\n\t\t{\n\t\t\tBX.SidePanel.Instance.open(url, {\n\t\t\t\tcustomLeftBoundary: 0,\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\twindow.open(url);\n\t\t}\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n\n\tshowTour(): void\n\t{\n\t\tthis.#showBanner();\n\t\tthis.#showAha();\n\t}\n\n\t#showBanner(): void\n\t{\n\t\tif (!this.#shouldShowBanner())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#bannerDispatcher.toQueue(\n\t\t\tasync (onDone: Function): void => {\n\t\t\t\tconst bannerClosed = this.#renderBannerComponent();\n\t\t\t\tthis.#setBannerShown();\n\t\t\t\tawait bannerClosed;\n\n\t\t\t\tonDone();\n\t\t\t},\n\t\t\tPriority.CRITICAL,\n\t\t);\n\t}\n\n\tasync #renderBannerComponent(): Promise\n\t{\n\t\tconst bannerClosed = new Resolvable();\n\t\tconst app = await this.#createBannerComponent(bannerClosed.resolve);\n\t\tconst content = Dom.create('div');\n\t\tDom.append(content, document.body);\n\t\tapp.mount(content);\n\n\t\treturn bannerClosed;\n\t}\n\n\tasync #createBannerComponent(onBannerClose: Function): Promise\n\t{\n\t\tconst { PromoBanner } = await Runtime.loadExtension('booking.component.promo-banner');\n\t\tconst app = BitrixVue.createApp({\n\t\t\tcomponents: { PromoBanner },\n\t\t\tdata(): Object\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\tisBannerShown: true,\n\t\t\t\t};\n\t\t\t},\n\t\t\tmethods: {\n\t\t\t\tonClose(): void\n\t\t\t\t{\n\t\t\t\t\tthis.isBannerShown = false;\n\t\t\t\t\tonBannerClose();\n\t\t\t\t},\n\t\t\t\tbuttonClick(): void\n\t\t\t\t{\n\t\t\t\t\tBannerAnalytics.sendClickEnable();\n\t\t\t\t},\n\t\t\t},\n\t\t\ttemplate: '<PromoBanner v-if=\"isBannerShown\" type=\"crm\" @buttonClick=\"buttonClick\" @close=\"onClose\" />',\n\t\t});\n\t\tapp.mixin({\n\t\t\tmethods: {\n\t\t\t\tloc(name: string, replacements?: { [key: string]: string }): string\n\t\t\t\t{\n\t\t\t\t\treturn Loc.getMessage(name, replacements);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\treturn app;\n\t}\n\n\t#shouldShowBanner(): Boolean\n\t{\n\t\treturn this.getSettings()?.shouldShowBanner || false;\n\t}\n\n\t#setBannerShown(): void\n\t{\n\t\tnew Options().saveUserOption(Options.START_BANNER);\n\t\tBannerAnalytics.sendShowPopup();\n\t}\n\n\t#showAha(): void\n\t{\n\t\tif (!this.#shouldShowAha())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst ahaParams = this.#getAhaParams();\n\t\tif (!ahaParams)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst guideBindElement = document\n\t\t\t.querySelector('.main-buttons-inner-container .main-buttons-item[data-id=\"booking\"]');\n\t\tif (!guideBindElement)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst tour = new Tour({\n\t\t\t...ahaParams,\n\t\t\tguideBindElement,\n\t\t});\n\t\ttour.getGuide().getPopup().setAutoHide(true);\n\n\t\tTourManager.getInstance().registerWithLaunch(tour);\n\t}\n\n\t#shouldShowAha(): Boolean\n\t{\n\t\treturn Boolean(this.getSettings()?.ahaMoments.length);\n\t}\n\n\t#getAhaParams(): AhaParams\n\t{\n\t\tswitch (this.getSettings()?.ahaMoments[0])\n\t\t{\n\t\t\tcase Options.BEFORE_FIRST_RESOURCE_AHA_OPTION_NAME:\n\t\t\t\treturn this.#getBeforeFirstResourceAhaParams();\n\t\t\tcase Options.AFTER_FIRST_RESOURCE_AHA_OPTION_NAME:\n\t\t\t\treturn this.#getAfterFirstResourceAhaParams();\n\t\t\tdefault:\n\t\t\t\treturn null;\n\t\t}\n\t}\n\n\t#getBeforeFirstResourceAhaParams(): AhaParams\n\t{\n\t\treturn {\n\t\t\titemCode: 'booking_before_first_resource',\n\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_BOOKING_AHA_BEFORE_RESOURCE_TITLE'),\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_BOOKING_AHA_BEFORE_RESOURCE_TEXT'),\n\t\t\tuserOptionName: Options.BEFORE_FIRST_RESOURCE_AHA_OPTION_NAME,\n\t\t\tarticleCode: 23712054,\n\t\t};\n\t}\n\n\t#getAfterFirstResourceAhaParams(): AhaParams\n\t{\n\t\treturn {\n\t\t\titemCode: 'booking_after_first_resource',\n\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_BOOKING_AHA_AFTER_RESOURCE_TITLE'),\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_BOOKING_AHA_AFTER_RESOURCE_TEXT'),\n\t\t\tuserOptionName: Options.AFTER_FIRST_RESOURCE_AHA_OPTION_NAME,\n\t\t};\n\t}\n\n\t#getFeature(): ?Object\n\t{\n\t\treturn this.getSetting('feature') || null;\n\t}\n\n\t#isFeatureEnabled(): Boolean\n\t{\n\t\treturn Boolean(this.#getFeature()?.isEnabled);\n\t}\n\n\t#showFeaturePromoter(): void\n\t{\n\t\tconst featureId = this.#getFeature()?.id;\n\t\tif (featureId)\n\t\t{\n\t\t\tRuntime.loadExtension('ui.info-helper')\n\t\t\t\t.then(({ FeaturePromotersRegistry }) => {\n\t\t\t\t\tFeaturePromotersRegistry.getPromoter({ featureId }).show();\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t})\n\t\t\t;\n\t\t}\n\t}\n}\n","import Item from '../item';\nexport default class Call extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst planner = new BX.Crm.Activity.Planner();\n\t\tplanner.showEdit(\n\t\t\t{\n\t\t\t\t'TYPE_ID': BX.CrmActivityType.call,\n\t\t\t\t'OWNER_TYPE_ID': this.getEntityTypeId(),\n\t\t\t\t'OWNER_ID': this.getEntityId(),\n\t\t\t}\n\t\t);\n\t}\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import Item from '../item';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\n\nexport default class WithEditor extends Item\n{\n\tinitializeLayout(): void\n\t{\n\t\tthis._ownerTypeId = this.getEntityTypeId();\n\t\tthis._ownerId = this.getEntityId();\n\t\tthis._ownerCategoryId = this.getEntityCategoryId();\n\n\t\tthis._ghostInput = null;\n\n\t\tthis._saveButtonHandler = BX.delegate(this.onSaveButtonClick, this);\n\t\tthis._cancelButtonHandler = BX.delegate(this.onCancelButtonClick, this);\n\t\tthis._focusHandler = BX.delegate(this.onFocus, this);\n\t\tthis._blurHandler = BX.delegate(this.onBlur, this);\n\t\tthis._keyupHandler = BX.delegate(this.resizeForm, this);\n\t\tthis._delayedKeyupHandler = BX.delegate(\n\t\t\tfunction()\n\t\t\t{\n\t\t\t\tsetTimeout(this.resizeForm.bind(this), 0);\n\t\t\t},\n\t\t\tthis\n\t\t);\n\n\t\tthis._hideButtonsOnBlur = true;\n\n\t\tthis.bindInputHandlers();\n\t\tthis.doInitialize();\n\t}\n\n\tdoInitialize()\n\t{\n\t}\n\n\tbindInputHandlers()\n\t{\n\t\tBX.bind(this._input, \"focus\", this._focusHandler);\n\t\tBX.bind(this._input, \"blur\", this._blurHandler);\n\t\tBX.bind(this._input, \"keyup\", this._keyupHandler);\n\t\tBX.bind(this._input, \"cut\", this._delayedKeyupHandler);\n\t\tBX.bind(this._input, \"paste\", this._delayedKeyupHandler);\n\t}\n\n\tonFocus(e)\n\t{\n\t\tthis.setFocused(true);\n\t}\n\n\tonBlur(e)\n\t{\n\t\tif(!this._hideButtonsOnBlur)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._input.value === \"\")\n\t\t{\n\t\t\twindow.setTimeout(\n\t\t\t\tBX.delegate(function() {\n\t\t\t\t\tthis.setFocused(false);\n\t\t\t\t\tthis._input.style.minHeight = \"\";\n\t\t\t\t}, this),\n\t\t\t\t200\n\t\t\t);\n\t\t}\n\t}\n\n\tonSaveButtonClick(e)\n\t{\n\t\tthis.setLocked(true);\n\n\t\tconst saveResult = this.save();\n\t\tif (saveResult instanceof BX.Promise || saveResult instanceof Promise)\n\t\t{\n\t\t\tsaveResult.then(\n\t\t\t\t() => this.setLocked(false),\n\t\t\t\t() => this.setLocked(false),\n\t\t\t).catch(() => this.setLocked(false));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.setLocked(false);\n\t\t}\n\t}\n\n\tonCancelButtonClick()\n\t{\n\t\tthis.cancel();\n\t\tthis.emitFinishEditEvent();\n\t}\n\n\tsave()\n\t{\n\t}\n\n\tcancel()\n\t{\n\t}\n\n\trelease()\n\t{\n\t\tif(this._ghostInput)\n\t\t{\n\t\t\tthis._ghostInput = BX.remove(this._ghostInput);\n\t\t}\n\t}\n\n\tensureGhostCreated()\n\t{\n\t\tif(this._ghostInput)\n\t\t{\n\t\t\treturn this._ghostInput;\n\t\t}\n\n\t\tthis._ghostInput = BX.create('div', {\n\t\t\tprops: { className: 'crm-entity-stream-content-new-comment-textarea-shadow' },\n\t\t\ttext: this._input.value\n\t\t});\n\n\t\tthis._ghostInput.style.width = this._input.offsetWidth + 'px';\n\t\tdocument.body.appendChild(this._ghostInput);\n\t\treturn this._ghostInput;\n\t}\n\n\tresizeForm()\n\t{\n\t\tconst ghost = this.ensureGhostCreated();\n\t\tconst computedStyle = getComputedStyle(this._input);\n\t\tconst diff = parseInt(computedStyle.paddingBottom) +\n\t\t\tparseInt(computedStyle.paddingTop) +\n\t\t\tparseInt(computedStyle.borderTopWidth) +\n\t\t\tparseInt(computedStyle.borderBottomWidth) || 0;\n\n\t\tghost.innerHTML = BX.util.htmlspecialchars(this._input.value.replace(/[\\r\\n]{1}/g, '<br>'));\n\t\tthis._input.style.minHeight = ghost.scrollHeight + diff + 'px'\n\t}\n}\n","import { ajax, Loc, Tag, Type } from 'main.core';\n\nimport WithEditor from './witheditor';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class Comment extends WithEditor\n{\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis._saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round\" >${Loc.getMessage('CRM_TIMELINE_SEND')}</button>`;\n\t\tthis._cancelButton = Tag.render`<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>`;\n\t\tthis._input = Tag.render`<textarea  rows=\"1\" class=\"crm-entity-stream-content-new-comment-textarea\" placeholder=\"${Loc.getMessage('CRM_TIMELINE_COMMENT_PLACEHOLDER')}\"></textarea>`;\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail --hidden\">\n\t\t\t\t\t${this._input}\n\t\t\t\t\t<div class=\"crm-entity-stream-content-new-comment-btn-container\">\n\t\t\t\t\t\t${this._saveButton}\n\t\t\t\t\t\t${this._cancelButton}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tthis._postForm = null;\n\t\tthis._editor = null;\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\t\tBX.unbind(this._input, \"blur\", this._blurHandler);\n\t\tBX.unbind(this._input, \"keyup\", this._keyupHandler);\n\t}\n\n\tloadEditor()\n\t{\n\t\tthis._editorName = 'CrmTimeLineComment0';\n\n\t\tif (this._postForm)\n\t\t\treturn;\n\n\t\tBX.ajax.runAction(\n\t\t\t\"crm.api.timeline.loadEditor\",\n\t\t\t{ data: { name: this._editorName } }\n\t\t).then(this.onLoadEditorSuccess.bind(this));\n\t}\n\n\tonLoadEditorSuccess(result)\n\t{\n\t\tconst html = BX.prop.getString(BX.prop.getObject(result, \"data\", {}), \"html\", '');\n\t\tBX.html(this._editorContainer, html)\n\t\t\t.then(BX.delegate(this.showEditor,this))\n\t\t\t.then(BX.delegate(this.addEvents,this));\n\t}\n\n\taddEvents()\n\t{\n\t\tBX.addCustomEvent(\n\t\t\tthis._editorContainer.firstElementChild,\n\t\t\t'onFileIsAppended',\n\t\t\tBX.delegate(function(id, item) {\n\t\t\t\tBX.addClass(this._saveButton, 'ui-btn-disabled');\n\t\t\t\tBX.addClass(this._saveButton, 'ui-btn-clock');\n\t\t\t\tthis._saveButton.removeEventListener(\"click\", this._saveButtonHandler);\n\t\t\t}, this)\n\t\t);\n\n\t\tBX.addCustomEvent(\n\t\t\tthis._editorContainer.firstElementChild,\n\t\t\t'onFileIsAdded',\n\t\t\tBX.delegate(function(file, controller, obj, blob) {\n\t\t\t\tBX.removeClass(this._saveButton, 'ui-btn-clock');\n\t\t\t\tBX.removeClass(this._saveButton, 'ui-btn-disabled');\n\t\t\t\tthis._saveButton.addEventListener(\"click\", this._saveButtonHandler);\n\t\t\t}, this)\n\t\t);\n\t}\n\n\tshowEditor()\n\t{\n\t\tif (LHEPostForm)\n\t\t{\n\t\t\twindow.setTimeout(BX.delegate(function(){\n\t\t\t\tthis._postForm = LHEPostForm.getHandler(this._editorName);\n\t\t\t\tthis._editor = BXHtmlEditor.Get(this._editorName);\n\t\t\t\tBX.onCustomEvent(this._postForm.eventNode, 'OnShowLHE', [true]);\n\t\t\t} ,this), 100);\n\t\t}\n\t}\n\n\tonFocus(e)\n\t{\n\t\tthis._input.style.display = 'none';\n\t\tif (this._editor && this._postForm)\n\t\t{\n\t\t\tthis._postForm.eventNode.style.display = 'block';\n\t\t\tthis._editor.Focus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (!BX.type.isDomNode(this._editorContainer))\n\t\t\t{\n\t\t\t\tthis._editorContainer = BX.create(\"div\", {attrs: {className: \"crm-entity-stream-section-comment-editor\"}});\n\t\t\t\tthis._editorContainer.appendChild(\n\t\t\t\t\tBX.create(\"DIV\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tattrs: { className: \"crm-timeline-wait\" }\n\t\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\tthis.getContainer().appendChild(this._editorContainer);\n\t\t\t}\n\n\t\t\twindow.setTimeout(BX.delegate(function(){\n\t\t\t\tthis.loadEditor();\n\t\t\t} ,this), 100);\n\t\t}\n\n\t\tthis.setFocused(true);\n\t}\n\n\tsave()\n\t{\n\t\tlet text = '';\n\t\tconst attachmentList = [];\n\t\tconst attachmentAllowEditOptions = {};\n\n\t\tif (this._postForm)\n\t\t{\n\t\t\ttext = this._postForm.oEditor.GetContent();\n\n\t\t\tthis._postForm.eventNode\n\t\t\t\t.querySelectorAll('input[name=\"UF_CRM_COMMENT_FILES[]\"]')\n\t\t\t\t.forEach((input) => attachmentList.push(input.value));\n\n\t\t\tif (Type.isArrayFilled(attachmentList))\n\t\t\t{\n\t\t\t\tattachmentList.forEach((id: number | string) => {\n\t\t\t\t\tconst selectorName = `input[name=\"CRM_TIMELINE_DISK_ATTACHED_OBJECT_ALLOW_EDIT[${id}]\"`;\n\t\t\t\t\tconst selector = this._postForm.eventNode.querySelector(selectorName);\n\t\t\t\t\tif (selector)\n\t\t\t\t\t{\n\t\t\t\t\t\tattachmentAllowEditOptions[id] = selector.value;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttext = this._input.value;\n\t\t}\n\n\t\tif (text === '')\n\t\t{\n\t\t\tif (!this.emptyCommentMessage)\n\t\t\t{\n\t\t\t\tthis.emptyCommentMessage = new BX.PopupWindow(\n\t\t\t\t\t'timeline_empty_new_comment_' + this.getEntityId(),\n\t\t\t\t\tthis._saveButton,\n\t\t\t\t\t{\n\t\t\t\t\t\tcontent: BX.message('CRM_TIMELINE_EMPTY_COMMENT_MESSAGE'),\n\t\t\t\t\t\tdarkMode: true,\n\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\tzIndex: 990,\n\t\t\t\t\t\tangle: {position: 'top', offset: 77},\n\t\t\t\t\t\tcloseByEsc: true,\n\t\t\t\t\t\tbindOptions: {\n\t\t\t\t\t\t\tforceBindPosition: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.emptyCommentMessage.show();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._isRequestRunning || this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isRequestRunning = this._isLocked = true;\n\n\t\tconst addedData = {\n\t\t\tfields: {\n\t\t\t\tENTITY_ID: this.getEntityId(),\n\t\t\t\tENTITY_TYPE_ID: this.getEntityTypeId(),\n\t\t\t\tCOMMENT: text,\n\t\t\t\tATTACHMENTS: attachmentList,\n\t\t\t},\n\t\t};\n\n\t\tif (Object.keys(attachmentAllowEditOptions).length > 0)\n\t\t{\n\t\t\taddedData.CRM_TIMELINE_DISK_ATTACHED_OBJECT_ALLOW_EDIT = attachmentAllowEditOptions;\n\t\t}\n\n\t\treturn ajax.runAction(\n\t\t\t'crm.timeline.comment.add',\n\t\t\t{\n\t\t\t\tdata: addedData,\n\t\t\t},\n\t\t).then((result) => {\n\t\t\tthis.onSaveSuccess();\n\n\t\t\treturn result;\n\t\t}).catch((result) => {\n\t\t\tthis.onSaveFailure();\n\n\t\t\treturn result;\n\t\t});\n\t}\n\n\tcancel()\n\t{\n\t\tthis._input.value = '';\n\t\tthis._input.style.minHeight = '';\n\t\tif (BX.type.isDomNode(this._editorContainer))\n\t\t\tthis._postForm.eventNode.style.display = 'none';\n\n\t\tthis._input.style.display = 'block';\n\t\tthis.setFocused(false);\n\t\tthis.release();\n\t}\n\n\tonSaveSuccess(data)\n\t{\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\t\tthis.release();\n\n\t\tif (this._postForm)\n\t\t{\n\t\t\tthis._postForm.reinit('', {});\n\t\t}\n\t\tthis.emitFinishEditEvent();\n\t\tthis.cancel();\n\t}\n\n\tonSaveFailure()\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\t}\n}\n","import Item from '../item';\n\nexport default class Delivery extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tBX.CrmActivityEditor.getDefault().addDelivery(\n\t\t{\n\t\t\t'ownerType': BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t'ownerID': this.getEntityId(),\n\t\t\t\"orderList\": BX.CrmTimelineManager.getDefault().getOwnerInfo()['ORDER_LIST']\n\t\t}\n\t);\n\t}\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import { SidePanel } from 'ui.sidepanel';\nimport Item from '../item';\n\nexport default class EInvoiceApp extends Item\n{\n\t#einvoiceUrl: string;\n\n\tshowSlider(): void\n\t{\n\t\tSidePanel.Instance.open(\n\t\t\tthis.#einvoiceUrl,\n\t\t\t{\n\t\t\t\twidth: 575,\n\t\t\t\tallowChangeHistory: false,\n\t\t\t},\n\t\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n\n\tinitializeSettings(): void\n\t{\n\t\tthis.#einvoiceUrl = this.getSetting('einvoiceUrl');\n\t}\n}\n","import Item from '../item';\n\nexport default class Email extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst ownerInfo = BX.CrmTimelineManager.getDefault().getOwnerInfo();\n\n\t\tBX.CrmActivityEditor.getDefault().addEmail(\n\t\t{\n\t\t\t'ownerType': BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t'ownerID': this.getEntityId(),\n\t\t\t'ownerUrl': ownerInfo['SHOW_URL'],\n\t\t\t'ownerTitle': ownerInfo['TITLE'],\n\t\t\t'subject': '',\n\t\t}\n\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import { Loc } from 'main.core';\nimport { Social } from 'ui.icon-set.api.core';\n\nimport { ChatService } from './types';\n\nconst ServicesConfig: ReadonlyMap<string, ChatService> = new Map([\n\t[\n\t\t'whatsapp',\n\t\t{\n\t\t\tid: 'whatsapp',\n\t\t\tconnectorId: 'notifications',\n\t\t\tconnectLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECT_WHATSAPP'),\n\t\t\tinviteLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_INVITE_WHATSAPP'),\n\t\t\tsoonLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SOON_WHATSAPP'),\n\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SERVICE_WHATSAPP'),\n\t\t\tregion: '!ru',\n\t\t\tcommonClass: '--whatsapp',\n\t\t\ticonClass: Social.WHATSAPP,\n\t\t\tcheckServiceId: 'virtual_whatsapp',\n\t\t},\n\t],\n\t[\n\t\t'telegrambot',\n\t\t{\n\t\t\tid: 'telegrambot',\n\t\t\tconnectorId: 'telegrambot',\n\t\t\tconnectLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECT_TELEGRAM'),\n\t\t\tinviteLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_INVITE_TELEGRAM'),\n\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SERVICE_TELEGRAM'),\n\t\t\tcommonClass: '--telegram',\n\t\t\ticonClass: Social.TELEGRAM_IN_CIRCLE,\n\t\t\ticonColor: '#2FC6F6',\n\t\t},\n\t],\n\t[\n\t\t'ru-whatsapp',\n\t\t{\n\t\t\tid: 'ru-whatsapp',\n\t\t\tconnectorId: 'notifications',\n\t\t\tconnectLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECT_WHATSAPP'),\n\t\t\tdisabledLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_INVITE_WHATSAPP'),\n\t\t\tinviteLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_INVITE_WHATSAPP'),\n\t\t\tsoonLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SOON_WHATSAPP'),\n\t\t\tdisabledHint: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_WHATSAPP_DISABLED_HINT'),\n\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SERVICE_WHATSAPP'),\n\t\t\tregion: 'ru',\n\t\t\tcommonClass: '--whatsapp',\n\t\t\ticonClass: Social.WHATSAPP,\n\t\t\tcheckServiceId: 'virtual_whatsapp',\n\t\t\thideOnBox: true,\n\t\t},\n\t],\n\t// [\n\t// \t'vkgroup',\n\t// \t{\n\t// \t\tid: 'vkgroup',\n\t// \t\tconnectorId: '',\n\t// \t\tconnectLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECT_VK'),\n\t// \t\tinviteLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_INVITE_VK'),\n\t// \t\tsoonLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SOON_VK'),\n\t// \t\ttitle: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SERVICE_VK'),\n\t// \t\tregion: 'ru',\n\t// \t\tcommonClass: '--vk',\n\t// \t\ticonClass: Social.VK,\n\t// \t},\n\t// ],\n\t[\n\t\t'facebook',\n\t\t{\n\t\t\tid: 'facebook',\n\t\t\tconnectorId: '',\n\t\t\tconnectLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECT_FACEBOOK'),\n\t\t\tinviteLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_INVITE_FACEBOOK'),\n\t\t\tsoonLabel: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SOON_FACEBOOK'),\n\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SERVICE_FACEBOOK'),\n\t\t\tregion: '!ru',\n\t\t\tcommonClass: '--facebook',\n\t\t\ticonClass: Social.FACEBOOK,\n\t\t},\n\t],\n]);\n\nexport default ServicesConfig;\n","import { ClientSelector, Communication, CommunicationItem } from 'crm.client-selector';\nimport { ConditionChecker, Types as SenderTypes } from 'crm.messagesender';\nimport { ajax, Dom, Event, Loc, Runtime, Tag, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport { Menu, MenuItem, MenuItemOptions, MenuManager } from 'main.popup';\nimport { Dialog } from 'ui.entity-selector';\nimport 'ui.icon-set.actions';\nimport { Icon } from 'ui.icon-set.api.core';\nimport 'ui.icon-set.main';\nimport 'ui.icon-set.social';\nimport Context from '../../context';\nimport Item from '../../item';\nimport './gotochat.css';\nimport ServicesConfig from './services-config';\nimport { Channel, ChatService, Config, Entity, OpenLinesList } from './types';\n\nconst MENU_ITEM_STUB_ID = 'stub';\nconst ACTIVE_MENU_ITEM_CLASS = 'menu-popup-item-accept';\nconst DEFAULT_MENU_ITEM_CLASS = 'menu-popup-item-none';\nconst TOOLBAR_CONTAINER_CLASS = 'crm-entity-stream-content-gotochat-toolbar-container';\nconst BUTTONS_CONTAINER_CLASS = 'crm-entity-stream-content-gotochat-buttons-container';\nconst CLIENTS_SELECTOR_TITLE_CLASS = 'crm-entity-stream-content-gotochat-clients-selector-title';\n\nconst HELP_ARTICLE_CODE = '18114500';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class GoToChat extends Item\n{\n\t#context: Context = null;\n\n\tselectedClient: Entity = null;\n\tsettingsMenu: Menu = null;\n\tchannels: Channel[] = [];\n\tcommunications: Communication[] = [];\n\tcurrentChannelId: ?string = null;\n\tfromPhoneId: ?string = null;\n\ttoName: ?string = null;\n\ttoPhoneId: ?string = null;\n\topenLineItems: OpenLinesList = null;\n\thasClients: boolean = false;\n\n\tisFetchedConfig: boolean = false;\n\tisSending: boolean = false;\n\n\t#chatServiceButtons: Map<string, HTMLElement> = new Map();\n\t#region: ?string = null;\n\t#isBox: ?string = null;\n\t#entityEditor: ?BX.Crm.EntityEditor = null;\n\tmarketplaceUrl: string = '';\n\t#userSelectorDialog: ?BX.UI.EntitySelector.Dialog = null;\n\t#clientSelector: ?ClientSelector = null;\n\t#services: {[key: string]: string} = {};\n\n\tinitialize(context: Context, settings: ?Object): void\n\t{\n\t\tsuper.initialize(context, settings);\n\n\t\tthis.#context = context;\n\n\t\tthis.onSelectClient = this.onSelectClient.bind(this);\n\t\tthis.onSelectClientPhone = this.onSelectClientPhone.bind(this);\n\t\tthis.onSelectSender = this.onSelectSender.bind(this);\n\t\tthis.onSelectSenderPhone = this.onSelectSenderPhone.bind(this);\n\t\tthis.onSelectTelegramOpenLineId = this.onSelectTelegramOpenLineId.bind(this);\n\t}\n\n\tinitializeLayout()\n\t{\n\t\tsuper.initializeLayout();\n\t\tthis.#subscribeToReceiversChanges();\n\t}\n\n\t#subscribeToReceiversChanges(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', (event: BaseEvent) => {\n\t\t\tconst { item } = event.getData();\n\n\t\t\tif (this.getEntityTypeId() !== item?.entityTypeId || this.getEntityId() !== item?.entityId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#hideContent();\n\t\t\tthis.#removeCurrentClient();\n\n\t\t\tthis.#fetchConfig(true);\n\t\t});\n\t}\n\n\tinitializeSettings(): void\n\t{\n\t\tthis.#region = this.getSetting('region');\n\t\tthis.#isBox = this.getSetting('isBox');\n\t}\n\n\tactivate()\n\t{\n\t\tsuper.activate();\n\n\t\tthis.#fetchConfig();\n\t}\n\n\t#fetchConfig(force: boolean = false): void\n\t{\n\t\tif (this.isFetchedConfig && !force)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isFetchedConfig = false;\n\n\t\tif (!this.#context.getEntityId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst ajaxParameters = {\n\t\t\tentityTypeId: this.#context.getEntityTypeId(),\n\t\t\tentityId: this.#context.getEntityId(),\n\t\t};\n\n\t\tajax.runAction('crm.activity.gotochat.getConfig', { data: ajaxParameters })\n\t\t\t.then(({ data }) => {\n\t\t\t\tthis.isFetchedConfig = true;\n\t\t\t\tthis.#prepareParams(data);\n\t\t\t\tthis.#hideLoader();\n\t\t\t\tthis.adjustLayout();\n\t\t\t})\n\t\t\t.catch(() => this.#showNotify(Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONFIG_ERROR')))\n\t\t;\n\t}\n\n\t#prepareParams(data: Config): void\n\t{\n\t\tconst {\n\t\t\tcurrentChannelId,\n\t\t\tchannels,\n\t\t\tcommunications,\n\t\t\topenLineItems,\n\t\t\tmarketplaceUrl,\n\t\t\tservices,\n\t\t\thasClients,\n\t\t} = data;\n\n\t\tthis.currentChannelId = currentChannelId;\n\t\tthis.channels = channels;\n\n\t\tthis.communications = communications;\n\t\tthis.hasClients = hasClients;\n\t\tthis.openLineItems = openLineItems;\n\t\tthis.marketplaceUrl = marketplaceUrl;\n\t\tthis.#services = services;\n\n\t\tthis.#setCommunicationsParams();\n\t\tthis.#setChannelDefaultPhoneId();\n\t}\n\n\t#setCommunicationsParams(): void\n\t{\n\t\tif (this.communications.length === 0)\n\t\t{\n\t\t\tthis.toPhoneId = null;\n\t\t\tthis.selectedClient = null;\n\t\t\tthis.toName = null;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst communication = this.communications[0];\n\n\t\tif (Array.isArray(communication.phones) && communication.phones.length > 0)\n\t\t{\n\t\t\tthis.toPhoneId = communication.phones[0].id;\n\t\t}\n\n\t\tthis.selectedClient = {\n\t\t\tentityId: communication.entityId,\n\t\t\tentityTypeId: communication.entityTypeId,\n\t\t};\n\n\t\tthis.toName = communication.caption;\n\t}\n\n\t#setChannelDefaultPhoneId(): void\n\t{\n\t\tconst channel = this.#getCurrentChannel();\n\n\t\tif (\n\t\t\t!channel\n\t\t\t|| !Array.isArray(channel.fromList)\n\t\t\t|| channel.fromList.length === 0\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { fromList } = channel;\n\t\tconst defaultPhone = fromList.find((item) => item.default);\n\n\t\tthis.fromPhoneId = defaultPhone ? defaultPhone.id : fromList[0].id;\n\t}\n\n\t#getCurrentChannel(): ?Channel\n\t{\n\t\tconst channel = this.channels.find((item) => item.id === this.currentChannelId);\n\n\t\treturn (channel ?? null);\n\t}\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\tfor (const tourString of this.getSetting('tours', []))\n\t\t{\n\t\t\tif (Type.isStringFilled(tourString))\n\t\t\t{\n\t\t\t\tRuntime.html(null, tourString);\n\t\t\t}\n\t\t}\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail crm-entity-stream-content-new-detail-gotochat --hidden --skeleton\">\n\t\t\t<div class=\"crm-entity-stream-content-new-detail-gotochat-container hidden\">\n\t\t\t\t<div class=\"crm-entity-stream-content-gotochat-settings-container\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-gotochat-clients-selector-container\">\n\t\t\t\t\t\t<div class=\"${CLIENTS_SELECTOR_TITLE_CLASS}\">\n\t\t\t\t\t\t\t${this.#getClientTitleHtmlElement()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-entity-stream-content-gotochat-clients-selector-description\">\n\t\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CLIENT_SELECTOR_DESCRIPTION')}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"${TOOLBAR_CONTAINER_CLASS}\">\n\t\t\t\t\t\t<button \n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-link ui-btn-xs ui-btn-icon-help\"\n\t\t\t\t\t\t\tonclick=\"${this.#showHelp}\"\n\t\t\t\t\t\t></button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"ui-btn ui-btn-link ui-btn-xs ui-btn-icon-setting\"\n\t\t\t\t\t\t\tonclick=\"${this.#showSettingsMenu.bind(this)}\"\n\t\t\t\t\t\t></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t${this.#getServiceButtons()}\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\t#getClientTitleHtmlElement(): HTMLElement\n\t{\n\t\tconst clientStart = '<span id=\"crm-gotochat-client-selector\" class=\"crm-entity-stream-content-gotochat-user-selector-link\">';\n\t\tconst clientFinish = '</span>';\n\t\tconst titleContainer = Tag.render`\n\t\t\t<span>\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CLIENT_SELECTOR_TITLE', {\n\t\t\t\t\t'[client]': clientStart,\n\t\t\t\t\t'[/client]': clientFinish,\n\t\t\t\t})}\n\t\t\t</span>\n\t\t`;\n\n\t\tEvent.bind(titleContainer.childNodes[0], 'click', this.onToggleClientSelector.bind(this));\n\n\t\treturn titleContainer;\n\t}\n\n\tonToggleClientSelector()\n\t{\n\t\tconst id = 'client-selector-dialog';\n\t\tconst { entityTypeId } = this.#getOwnerEntity();\n\t\tconst context = `CRM_TIMELINE_GOTOCHAT-${entityTypeId}`;\n\n\t\tif (!this.#userSelectorDialog)\n\t\t{\n\t\t\tthis.#userSelectorDialog = new Dialog({\n\t\t\t\tid,\n\t\t\t\tcontext,\n\t\t\t\ttargetNode: this.#getUserSelectorDialogTargetNode(),\n\t\t\t\tmultiple: false,\n\t\t\t\tdropdownMode: false,\n\t\t\t\tshowAvatars: true,\n\t\t\t\tenableSearch: true,\n\t\t\t\twidth: 450,\n\t\t\t\tzIndex: 2500,\n\t\t\t\tentities: this.#getClientSelectorEntities(),\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': this.onSelectClient,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tif (this.#userSelectorDialog.isOpen())\n\t\t{\n\t\t\tthis.#userSelectorDialog.hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#userSelectorDialog.setTargetNode(this.#getUserSelectorDialogTargetNode());\n\t\t\tthis.#userSelectorDialog.show();\n\t\t}\n\t}\n\n\t#getUserSelectorDialogTargetNode(): HTMLElement\n\t{\n\t\treturn document.getElementById('crm-gotochat-client-selector');\n\t}\n\n\t#getClientSelectorEntities(): Array\n\t{\n\t\tconst contact = {\n\t\t\tid: 'contact',\n\t\t\tdynamicLoad: true,\n\t\t\tdynamicSearch: true,\n\t\t\toptions: {\n\t\t\t\tshowTab: true,\n\t\t\t\tshowPhones: true,\n\t\t\t\tshowMails: true,\n\t\t\t},\n\t\t};\n\n\t\tconst company = {\n\t\t\tid: 'company',\n\t\t\tdynamicLoad: true,\n\t\t\tdynamicSearch: true,\n\t\t\toptions: {\n\t\t\t\texcludeMyCompany: true,\n\t\t\t\tshowTab: true,\n\t\t\t\tshowPhones: true,\n\t\t\t\tshowMails: true,\n\t\t\t},\n\t\t};\n\n\t\tconst { entityTypeId } = this.#getOwnerEntity();\n\t\tif (entityTypeId === BX.CrmEntityType.enumeration.contact)\n\t\t{\n\t\t\treturn [company];\n\t\t}\n\n\t\tif (entityTypeId === BX.CrmEntityType.enumeration.company)\n\t\t{\n\t\t\treturn [contact];\n\t\t}\n\n\t\treturn [contact, company];\n\t}\n\n\tasync onSelectClient(event: BaseEvent)\n\t{\n\t\tconst { item } = event.getData();\n\n\t\tthis.selectedClient = {\n\t\t\tentityId: item.id,\n\t\t\tentityTypeId: BX.CrmEntityType.resolveId(item.entityId),\n\t\t};\n\n\t\tconst isBound = await this.#bindClient();\n\t\tif (isBound)\n\t\t{\n\t\t\tthis.adjustLayout();\n\t\t\tBX.Crm.EntityEditor.getDefault().reload();\n\t\t}\n\t}\n\n\tasync #bindClient(): Promise\n\t{\n\t\tconst { entityId, entityTypeId } = this.#getOwnerEntity();\n\t\tconst { entityId: clientId, entityTypeId: clientTypeId } = this.selectedClient;\n\n\t\tconst ajaxParams = {\n\t\t\tentityId,\n\t\t\tentityTypeId,\n\t\t\tclientId,\n\t\t\tclientTypeId,\n\t\t};\n\n\t\treturn new Promise((resolve) => {\n\t\t\tajax.runAction('crm.activity.gotochat.bindClient', { data: ajaxParams })\n\t\t\t\t.then(({ data }) => {\n\t\t\t\t\tif (!data)\n\t\t\t\t\t{\n\t\t\t\t\t\tresolve(false);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst { channels, communications, currentChannelId } = data;\n\t\t\t\t\tthis.channels = channels;\n\t\t\t\t\tthis.communications = communications;\n\t\t\t\t\tthis.currentChannelId = currentChannelId;\n\n\t\t\t\t\tthis.#setCommunicationsParams();\n\t\t\t\t\tthis.#setChannelDefaultPhoneId();\n\n\t\t\t\t\tresolve(true);\n\t\t\t\t})\n\t\t\t\t.catch((data) => {\n\t\t\t\t\tif (data.errors.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#showNotify(data.errors[0].message);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#showNotify(Loc.getMessage('CRM_TIMELINE_GOTOCHAT_BIND_CLIENT_ERROR'));\n\t\t\t\t})\n\t\t\t;\n\t\t});\n\t}\n\n\t#getOwnerEntity(): Entity\n\t{\n\t\tconst context = this.#context;\n\n\t\treturn {\n\t\t\tentityId: context.getEntityId(),\n\t\t\tentityTypeId: context.getEntityTypeId(),\n\t\t};\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#showHelp(): void\n\t{\n\t\ttop.BX.Helper.show(`redirect=detail&code=${HELP_ARTICLE_CODE}`);\n\t}\n\n\t#showSettingsMenu(): void\n\t{\n\t\tif (!this.selectedClient)\n\t\t{\n\t\t\tthis.#showNotSelectedClientNotify();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.settingsMenu)\n\t\t{\n\t\t\tthis.initSettingsMenu();\n\t\t}\n\n\t\tthis.settingsMenu.show();\n\t}\n\n\tinitSettingsMenu(): void\n\t{\n\t\tconst menuId = 'crm-gotochat-channels-settings-menu';\n\t\tconst items = this.#getSubmenuStubItems();\n\n\t\tthis.settingsMenu = MenuManager.create({\n\t\t\tid: menuId,\n\t\t\tbindElement: document.querySelector(`.${TOOLBAR_CONTAINER_CLASS}`),\n\t\t\titems: [\n\t\t\t\t{\n\t\t\t\t\tdelimiter: true,\n\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SETTINGS'),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'channelSubmenu',\n\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SENDER_SELECTOR'),\n\t\t\t\t\titems,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSubMenuShow: (event: BaseEvent) => {\n\t\t\t\t\t\t\tthis.#onSubMenuShow(event, this.getChannelsSubmenuItems());\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'phoneSubmenu',\n\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_NUMBER_SELECTOR'),\n\t\t\t\t\titems,\n\t\t\t\t\tdisabled: !Type.isArrayFilled(this.getPhoneSubMenuItems()),\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSubMenuShow: (event: BaseEvent) => {\n\t\t\t\t\t\t\tthis.#onSubMenuShow(event, this.getPhoneSubMenuItems());\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tdelimiter: true,\n\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECTOR_SETTINGS'),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: 'telegramBotSubmenu',\n\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_TELEGRAMBOT_OPENLINE_SELECTOR'),\n\t\t\t\t\titems,\n\t\t\t\t\tdisabled: !this.openLineItems.telegrambot?.selected,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonSubMenuShow: (event: BaseEvent) => {\n\t\t\t\t\t\t\tthis.#onSubMenuShow(event, this.getTelegramOpenLinesSubMenuItems());\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#getSubmenuStubItems(): MenuItemOptions[]\n\t{\n\t\t// needed for emitted the onSubMenuShow event\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: MENU_ITEM_STUB_ID,\n\t\t\t},\n\t\t];\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#onSubMenuShow(event: BaseEvent, items: MenuItemOptions[]): void\n\t{\n\t\tconst target: MenuItem = event.getTarget();\n\n\t\tfor (const itemOptionsToAdd of items)\n\t\t{\n\t\t\ttarget.getSubMenu()?.addMenuItem(itemOptionsToAdd);\n\t\t}\n\n\t\ttarget.getSubMenu()?.removeMenuItem(MENU_ITEM_STUB_ID);\n\t}\n\n\tonShowClientPhoneSelector()\n\t{\n\t\tconst targetNode = document.getElementById('crm-gotochat-client-selector--selected');\n\n\t\tif (this.#clientSelector && this.#clientSelector.isOpen())\n\t\t{\n\t\t\tthis.#clientSelector.hide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#clientSelector = ClientSelector.createFromCommunications({\n\t\t\t\ttargetNode,\n\t\t\t\tcommunications: this.communications,\n\t\t\t\tevents: {\n\t\t\t\t\tonSelect: this.onSelectClientPhone,\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.#clientSelector\n\t\t\t\t.setSelected([this.toPhoneId])\n\t\t\t\t.show()\n\t\t\t;\n\t\t}\n\t}\n\n\tonSelectClientPhone(event: BaseEvent): void\n\t{\n\t\tconst { item: { id, customData } } = event.getData();\n\n\t\tthis.selectedClient = {\n\t\t\tentityId: customData.get('entityId'),\n\t\t\tentityTypeId: customData.get('entityTypeId'),\n\t\t};\n\n\t\tthis.toName = this.getCurrentCommunication().caption;\n\t\tthis.toPhoneId = id;\n\n\t\tthis.adjustLayout();\n\t}\n\n\tgetCurrentPhone(): ?CommunicationItem\n\t{\n\t\tconst client = this.getCurrentCommunication();\n\n\t\tif (!client || !Type.isObjectLike(client.phones))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn client.phones.find((phone) => phone.id === this.toPhoneId);\n\t}\n\n\tgetCurrentCommunication(): ?Communication\n\t{\n\t\tif (!this.selectedClient)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst { entityTypeId, entityId } = this.selectedClient;\n\n\t\treturn this.communications.find(\n\t\t\t(communication) => {\n\t\t\t\treturn (\n\t\t\t\t\tNumber(communication.entityTypeId) === Number(entityTypeId)\n\t\t\t\t\t&& Number(communication.entityId) === Number(entityId)\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\t}\n\n\tadjustLayout(): void\n\t{\n\t\tthis.#adjustClientTitle();\n\t\tthis.#adjustChatServiceButtons();\n\t\tthis.#showContent();\n\t}\n\n\t#adjustClientTitle(): void\n\t{\n\t\tconst client = this.getCurrentCommunication();\n\t\tif (!client)\n\t\t{\n\t\t\tthis.#showContent();\n\t\t\tthis.#showAddClientTitle();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst phone = this.getCurrentPhone();\n\t\tif (!phone)\n\t\t{\n\t\t\t/*\n\t\t\tnow the situation of the absence of the client's phone\n\t\t\thas not been worked out by the product manager in any way\n\n\t\t\t@todo need handle this situation\n\t\t\t */\n\t\t\tthis.#showContent();\n\t\t\tthis.#showAddClientTitle();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst clientElement = Tag.render`\n\t\t\t<span \n\t\t\t\tid=\"crm-gotochat-client-selector--selected\" \n\t\t\t\tclass=\"crm-entity-stream-content-gotochat-user-selector-link --selected\" \n\t\t\t\tonclick=\"${this.onShowClientPhoneSelector.bind(this)}\"\n\t\t\t>\n\t\t\t\t<span \n\t\t\t\t\tclass=\"crm-entity-stream-content-gotochat-client-avatar\"\n\t\t\t\t\tstyle=\"background-image: url('${this.getEntityAvatarPath(client.entityTypeName.toLowerCase())}');\"\n\t\t\t\t>\n\t\t\t\t</span>\n\t\t\t\t${Text.encode(client.caption)}, ${Text.encode(phone.valueFormatted)}\n\t\t\t\t<span class=\"crm-entity-stream-content-gotochat-client-chevron\"></span>\n\t\t\t</span>\n\t\t`;\n\t\tconst titleContainer = Tag.render`\n\t\t\t<span>\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SELECTED_CLIENT_TITLE')}\n\t\t\t</span>\n\t\t`;\n\t\tconst titleElement = titleContainer.firstChild;\n\n\t\tconst labelIndex = titleElement.textContent.indexOf('#CLIENT_NAME#');\n\t\ttitleElement.nodeValue = titleElement.nodeValue.replace('#CLIENT_NAME#', '');\n\n\t\tDom.insertBefore(clientElement, titleElement.splitText(labelIndex));\n\n\t\tconst container = document.querySelector(`.${CLIENTS_SELECTOR_TITLE_CLASS}`);\n\t\tDom.clean(container);\n\t\tDom.append(titleContainer, container);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#showContent(): void\n\t{\n\t\tDom.removeClass(\n\t\t\tdocument.querySelector('.crm-entity-stream-content-new-detail-gotochat-container'),\n\t\t\t'hidden',\n\t\t);\n\n\t\tDom.removeClass(\n\t\t\tdocument.querySelector('.crm-entity-stream-content-new-detail-gotochat'),\n\t\t\t'--skeleton',\n\t\t);\n\t}\n\n\t#showAddClientTitle(): void\n\t{\n\t\tconst container = document.querySelector(`.${CLIENTS_SELECTOR_TITLE_CLASS}`);\n\t\tDom.clean(container);\n\t\tDom.append(this.#getClientTitleHtmlElement(), container);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#hideContent(): void\n\t{\n\t\tDom.addClass(\n\t\t\tdocument.querySelector('.crm-entity-stream-content-new-detail-gotochat-container'),\n\t\t\t'hidden',\n\t\t);\n\n\t\tDom.addClass(\n\t\t\tdocument.querySelector('.crm-entity-stream-content-new-detail-gotochat'),\n\t\t\t'--skeleton',\n\t\t);\n\t}\n\n\t#removeCurrentClient(): void\n\t{\n\t\tthis.selectedClient = null;\n\t\tthis.fromPhoneId = null;\n\t}\n\n\t#adjustChatServiceButtons(): void\n\t{\n\t\tconst oldContainer = document.querySelector(`.${BUTTONS_CONTAINER_CLASS}`);\n\t\tconst newContainer = this.#getServiceButtons();\n\n\t\tDom.replace(oldContainer, newContainer);\n\t}\n\n\t#getServiceButtons(): HTMLElement\n\t{\n\t\tthis.#fillChatServiceButtons();\n\n\t\tconst buttonsContainer = Tag.render`\n\t\t\t<div class=\"${BUTTONS_CONTAINER_CLASS}\">\n\t\t\t\t${[...this.#chatServiceButtons.values()]}\n\t\t\t</div>\n\t\t`;\n\n\t\tBX.UI.Hint.init(buttonsContainer);\n\n\t\treturn buttonsContainer;\n\t}\n\n\t#fillChatServiceButtons(): void\n\t{\n\t\tServicesConfig.forEach((service: ChatService) => {\n\t\t\tif (!this.#isServiceSupportedInRegion(service))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (service.hideOnBox === true && this.#isBox)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst button = this.#createChatServiceButton(service);\n\t\t\tthis.#chatServiceButtons.set(service.id, button);\n\t\t});\n\t}\n\n\t#isServiceSupportedInRegion(service: ChatService): boolean\n\t{\n\t\tif (!service.region || !this.#region)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (service.region !== this.#region && service.region[0] !== '!')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn (service.region !== `!${this.#region}`);\n\t}\n\n\t#createChatServiceButton(service: ChatService): HTMLElement\n\t{\n\t\tlet className = service.commonClass;\n\t\tlet label = service.connectLabel;\n\t\tlet hint = null;\n\n\t\tif (!this.#isAvailableService(service.id))\n\t\t{\n\t\t\tclassName += ' --disabled';\n\t\t\tlabel = service.disabledLabel || service.soonLabel;\n\t\t\thint = service.disabledHint;\n\t\t}\n\t\telse if (this.#isServiceSelected(service))\n\t\t{\n\t\t\tclassName += ' --ready';\n\t\t\tlabel = service.inviteLabel;\n\t\t}\n\n\t\tconst button = Tag.render`\n\t\t\t<div \n\t\t\t\tclass=\"crm-entity-stream-content-gotochat-button\"\n\t\t\t\tonclick=\"${this.showRegistrarAndSend.bind(this, service.id)}\"\n\t\t\t>\n\t\t\t\t<button \n\t\t\t\t\tclass=\"crm-entity-stream-content-new-detail-gotochat_button ${className}\"\n\t\t\t\t\tdata-code=\"${service.id}\"\n\t\t\t\t>\n\t\t\t\t\t${this.#renderButtonIcon(service)}\n\t\t\t\t\t<span class=\"crm-entity-stream-content-new-detail-gotochat_button-text\">${label}</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (Type.isStringFilled(hint))\n\t\t{\n\t\t\tDom.attr(button, {\n\t\t\t\t'data-hint': hint,\n\t\t\t\t'data-hint-no-icon': 'Y',\n\t\t\t\t'data-hint-center': 'Y',\n\t\t\t});\n\t\t}\n\n\t\treturn button;\n\t}\n\n\t#renderButtonIcon(service: ChatService | undefined): HTMLElement\n\t{\n\t\tif (!service)\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\tconst icon = new Icon({\n\t\t\ticon: service.iconClass,\n\t\t\tsize: 40,\n\t\t\tcolor: this.#getButtonIconColor(service),\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<i class=\"crm-entity-stream-content-new-detail-gotochat_button-icon\">\n\t\t\t\t${icon.render()}\n\t\t\t</i>\n\t\t`;\n\t}\n\n\t#getButtonIconColor(service: ChatService): string\n\t{\n\t\tif (!this.#isAvailableService(service.id))\n\t\t{\n\t\t\treturn getComputedStyle(document.body).getPropertyValue('--ui-color-base-40');\n\t\t}\n\n\t\tif (this.#isServiceSelected(service))\n\t\t{\n\t\t\treturn getComputedStyle(document.body).getPropertyValue('--ui-color-background-primary');\n\t\t}\n\n\t\treturn service.iconColor;\n\t}\n\n\t#isServiceSelected(service: ChatService): boolean\n\t{\n\t\tconst id = service.checkServiceId ?? service.id;\n\n\t\treturn this.openLineItems?.[id]?.selected;\n\t}\n\n\tasync showRegistrarAndSend(code: string): Promise<void>\n\t{\n\t\tif (this.isSending || !this.#isAvailableService(code))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#isEntityInEditorMode())\n\t\t{\n\t\t\tawait this.#showEditorInEditModePopup();\n\t\t}\n\n\t\tif (!this.selectedClient && !this.hasClients)\n\t\t{\n\t\t\tthis.#showNotSelectedClientNotify();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.toPhoneId)\n\t\t{\n\t\t\tconst content = Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CLIENT_HAVE_NO_PHONE');\n\t\t\tthis.#showNotify(content);\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.showButtonLoader(code);\n\n\t\tconst service = this.#getServiceConfigByCode(code);\n\t\tconst { entityTypeId } = this.#getOwnerEntity();\n\t\tconst lineId = await ConditionChecker.checkAndGetLine({\n\t\t\topenLineCode: service.connectorId,\n\t\t\tsenderType: this.getSenderType(),\n\t\t\topenLineItems: this.openLineItems,\n\t\t\tserviceId: service.id,\n\t\t\tentityTypeId,\n\t\t});\n\n\t\tif (lineId === null)\n\t\t{\n\t\t\tthis.#restoreButton(code);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.send(lineId, code);\n\t\t}\n\t}\n\n\t#getServiceConfigByCode(code: string): ?ChatService\n\t{\n\t\treturn ServicesConfig.get(code) || null;\n\t}\n\n\t#isAvailableService(code: string): boolean\n\t{\n\t\treturn this.#services[code] ?? false;\n\t}\n\n\t#isEntityInEditorMode(): boolean\n\t{\n\t\treturn (this.#getEntityEditor().getMode() === BX.UI.EntityEditorMode.edit);\n\t}\n\n\tasync #showEditorInEditModePopup(): Promise\n\t{\n\t\tconst { entityTypeId } = this.#getOwnerEntity();\n\t\tconst entityType = BX.CrmEntityType.resolveName(entityTypeId);\n\t\tconst message = (\n\t\t\tLoc.getMessage(`CRM_TIMELINE_GOTOCHAT_EDITOR_HAVE_UNSAVED_CHANGES_TEXT_${entityType}`)\n\t\t\t|| Loc.getMessage('CRM_TIMELINE_GOTOCHAT_EDITOR_HAVE_UNSAVED_CHANGES_TEXT')\n\t\t);\n\n\t\treturn new Promise((resolve) => {\n\t\t\tBX.UI.Dialogs.MessageBox.show({\n\t\t\t\tmodal: true,\n\t\t\t\tmessage,\n\t\t\t\tbuttons: BX.UI.Dialogs.MessageBoxButtons.OK_CANCEL,\n\t\t\t\tokCaption: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_EDITOR_HAVE_UNSAVED_CHANGES_SAVE_AND_CONTINUE'),\n\t\t\t\tonOk: (messageBox) => {\n\t\t\t\t\tthis.saveEntityEditor();\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\tcancelCaption: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_EDITOR_HAVE_UNSAVED_CHANGES_FORCE_CONTINUE'),\n\t\t\t\tonCancel: function(messageBox) {\n\t\t\t\t\tmessageBox.close();\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tsaveEntityEditor(): void\n\t{\n\t\tthis.#getEntityEditor().saveChanged();\n\t}\n\n\t#getEntityEditor(): BX.Crm.EntityEditor\n\t{\n\t\tif (!this.#entityEditor)\n\t\t{\n\t\t\tthis.#entityEditor = BX.Crm.EntityEditor.getDefault();\n\t\t}\n\n\t\treturn this.#entityEditor;\n\t}\n\n\t#showNotSelectedClientNotify(): void\n\t{\n\t\tconst content = Loc.getMessage('CRM_TIMELINE_GOTOCHAT_NO_SELECTED_CLIENT');\n\t\tthis.#showNotify(content);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\t#showNotify(content: string): void\n\t{\n\t\tBX.UI.Notification.Center.notify({ content });\n\t}\n\n\tsend(lineId: string, code: string): void\n\t{\n\t\tthis.isSending = true;\n\n\t\tconst { entityTypeId: ownerTypeId, entityId: ownerId } = this.#getOwnerEntity();\n\t\tconst senderType = this.getSenderType();\n\t\tconst senderId = this.currentChannelId;\n\t\tconst from = this.fromPhoneId;\n\t\tconst to = this.toPhoneId;\n\t\tconst connectorId = this.#getServiceConfigByCode(code).connectorId;\n\n\t\tconst ajaxParameters = {\n\t\t\townerTypeId,\n\t\t\townerId,\n\t\t\tparams: {\n\t\t\t\tsenderType,\n\t\t\t\tsenderId,\n\t\t\t\tfrom,\n\t\t\t\tto,\n\t\t\t\tlineId,\n\t\t\t\tconnectorId,\n\t\t\t},\n\t\t};\n\n\t\tajax.runAction('crm.activity.gotochat.send', { data: ajaxParameters })\n\t\t\t.then(() => {\n\t\t\t\tthis.isSending = false;\n\n\t\t\t\tthis.#setOpenLineItemIsSelected(code);\n\t\t\t\tthis.#restoreButton(code);\n\n\t\t\t\tthis.#showNotify(Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SEND_SUCCESS'));\n\t\t\t\tthis.emitFinishEditEvent();\n\t\t\t})\n\t\t\t.catch((data) => {\n\t\t\t\tthis.isSending = false;\n\t\t\t\tthis.#restoreButton(code);\n\n\t\t\t\tif (data.errors.length > 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#showNotify(data.errors[0].message);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.#showNotify(Loc.getMessage('CRM_TIMELINE_GOTOCHAT_SEND_ERROR'));\n\t\t\t})\n\t\t;\n\t}\n\n\t#setOpenLineItemIsSelected(code: string): void\n\t{\n\t\tconst service = this.#getServiceById(code);\n\n\t\tthis.openLineItems[service?.checkServiceId ?? code].selected = true;\n\t}\n\n\t#getServiceById(id: string): ?ChatService\n\t{\n\t\treturn [...ServicesConfig.values()].find((item) => item.id === id) ?? null;\n\t}\n\n\t#restoreButton(code: string): void\n\t{\n\t\tconst oldButton = this.#chatServiceButtons.get(code);\n\t\tconst newButton = this.#createChatServiceButton(ServicesConfig.get(code));\n\n\t\tthis.#chatServiceButtons.set(code, newButton);\n\n\t\tDom.replace(oldButton, newButton);\n\t}\n\n\tshowButtonLoader(code: string): void\n\t{\n\t\tconst button = this.#chatServiceButtons.get(code);\n\t\tDom.addClass(button?.firstElementChild, '--loading');\n\t}\n\n\tgetSenderType(): string\n\t{\n\t\treturn (this.currentChannelId === SenderTypes.bitrix24 ? SenderTypes.bitrix24 : SenderTypes.sms);\n\t}\n\n\t// eslint-disable-next-line class-methods-use-this\n\tgetEntityAvatarPath(entityTypeName: string): string\n\t{\n\t\t// eslint-disable-next-line no-param-reassign\n\t\tentityTypeName = entityTypeName.toLowerCase();\n\n\t\tconst whiteList = [\n\t\t\t'contact',\n\t\t\t'company',\n\t\t\t'lead',\n\t\t];\n\n\t\tif (!whiteList.includes(entityTypeName))\n\t\t{\n\t\t\treturn '';\n\t\t}\n\n\t\treturn `/bitrix/images/crm/entity_provider_icons/${entityTypeName}.svg`;\n\t}\n\n\tgetChannelsSubmenuItems(): MenuItemOptions[]\n\t{\n\t\tconst items = [];\n\t\tthis.channels.forEach(({ id, shortName: text, canUse, fromList }) => {\n\t\t\tconst className = (id === this.currentChannelId ? ACTIVE_MENU_ITEM_CLASS : DEFAULT_MENU_ITEM_CLASS);\n\t\t\titems.push({\n\t\t\t\tid,\n\t\t\t\ttext,\n\t\t\t\tclassName,\n\t\t\t\tdisabled: !canUse || !Type.isArrayFilled(fromList),\n\t\t\t\tonclick: this.onSelectSender,\n\t\t\t});\n\t\t});\n\n\t\treturn [\n\t\t\t...items,\n\t\t\t{\n\t\t\t\tid: 'connectOtherSenderDelimiter',\n\t\t\t\tdelimiter: true,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 'connectOtherSender',\n\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONNECT_OTHER_SENDER_SERVICE'),\n\t\t\t\tclassName: DEFAULT_MENU_ITEM_CLASS,\n\t\t\t\tonclick: () => BX.SidePanel.Instance.open(this.marketplaceUrl),\n\t\t\t},\n\t\t];\n\t}\n\n\tonSelectSender(event, { id })\n\t{\n\t\tthis.currentChannelId = id;\n\n\t\tconst channel = this.#getChannelById(id);\n\t\tthis.fromPhoneId = channel.fromList[0].id;\n\n\t\tthis.#refreshSettingsMenu();\n\t}\n\n\tgetPhoneSubMenuItems(): Array\n\t{\n\t\tconst currentChannel = this.#getChannelById(this.currentChannelId);\n\t\tconst items = [];\n\n\t\tif (currentChannel)\n\t\t{\n\t\t\tcurrentChannel.fromList.forEach(({ id, name: text }) => {\n\t\t\t\tconst className = (id === this.fromPhoneId ? ACTIVE_MENU_ITEM_CLASS : DEFAULT_MENU_ITEM_CLASS);\n\t\t\t\titems.push({\n\t\t\t\t\tid,\n\t\t\t\t\ttext,\n\t\t\t\t\tclassName,\n\t\t\t\t\tonclick: this.onSelectSenderPhone,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tgetTelegramOpenLinesSubMenuItems(): Array\n\t{\n\t\tconst telegram = this.openLineItems?.telegrambot ?? {};\n\n\t\tconst items = [];\n\t\ttelegram.list.forEach(({ id, name, selected }) => {\n\t\t\tconst className = (selected ? ACTIVE_MENU_ITEM_CLASS : DEFAULT_MENU_ITEM_CLASS);\n\n\t\t\titems.push({\n\t\t\t\tid,\n\t\t\t\ttext: name,\n\t\t\t\tclassName,\n\t\t\t\tonclick: this.onSelectTelegramOpenLineId,\n\t\t\t});\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#getChannelById(id: string): Channel\n\t{\n\t\treturn this.channels.find((channel) => channel.id === id);\n\t}\n\n\tonSelectSenderPhone(event: BaseEvent, { id }): void\n\t{\n\t\tthis.fromPhoneId = id;\n\n\t\tthis.#refreshSettingsMenu();\n\t}\n\n\tonSelectTelegramOpenLineId(event: BaseEvent, { id }): void\n\t{\n\t\tconst list = this.openLineItems?.telegrambot?.list ?? null;\n\t\tif (list === null)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectedItem = list.find((item) => item.selected);\n\t\tif (!selectedItem)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (selectedItem.id === id)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// eslint-disable-next-line no-return-assign\n\t\tlist.forEach((item) => item.selected = false);\n\t\tlist.find((item) => item.id === id).selected = true;\n\n\t\tBX.userOptions.save('crm', 'gotochat-selected-openline-ids', 'telegrambot', id);\n\n\t\tthis.#refreshSettingsMenu();\n\t}\n\n\t#refreshSettingsMenu(): void\n\t{\n\t\tthis.settingsMenu.destroy();\n\t\tthis.initSettingsMenu();\n\t}\n\n\t#getLoader(): Loader\n\t{\n\t\tif (!this.loader)\n\t\t{\n\t\t\tthis.loader = new Loader({\n\t\t\t\tcolor: '#2fc6f6',\n\t\t\t\tsize: 36,\n\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tonHide(): void\n\t{\n\t\tif (this.loader)\n\t\t{\n\t\t\tthis.loader.destroy();\n\t\t}\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tif (this.loader)\n\t\t{\n\t\t\tvoid this.loader.hide();\n\t\t}\n\t}\n}\n","import Item from '../item';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\n\nexport default class Market extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tBX.rest.Marketplace.open({\n\t\t\tPLACEMENT: this.getSetting('placement', '')\n\t\t});\n\n\t\ttop.BX.addCustomEvent(top, 'Rest:AppLayout:ApplicationInstall', this.#fireUpdateEvent.bind(this));\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n\n\t#fireUpdateEvent()\n\t{\n\t\tconst entityTypeId = this.getEntityTypeId();\n\t\tconst entityId = this.getEntityId();\n\n\t\tsetTimeout(function(){\n\t\t\tconsole.log('fireUpdate', entityId, entityTypeId);\n\t\t\tBX.Crm.EntityEvent.fire(BX.Crm.EntityEvent.names.invalidate, entityTypeId, entityId, '');\n\t\t}, 3000);\n\t}\n}\n","import Item from '../item';\n\nexport default class Meeting extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst planner = new BX.Crm.Activity.Planner();\n\t\tplanner.showEdit(\n\t\t\t{\n\t\t\t\t'TYPE_ID': BX.CrmActivityType.meeting,\n\t\t\t\t'OWNER_TYPE_ID': this.getEntityTypeId(),\n\t\t\t\t'OWNER_ID': this.getEntityId(),\n\t\t\t}\n\t\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","export default class ButtonType\n{\n\tstatic PRIMARY = 'primary';\n\tstatic SECONDARY = 'secondary';\n}\n","export default class ActionType\n{\n\tstatic LAYOUT_JS_EVENT = 'layoutEvent';\n\tstatic FOOTER_BUTTON_CLICK = 'footerButtonClick';\n\tstatic OPEN_REST_APP = 'openRestApp';\n\tstatic REDIRECT = 'redirect';\n}\n","export default class EventType\n{\n\tstatic FOOTER_BUTTON_CLICK = 'footerButtonClick';\n\tstatic LAYOUT_EVENT = 'layoutEvent';\n\tstatic VALUE_CHANGED_EVENT = 'valueChangedEvent';\n}\n","import { Dom, Type } from 'main.core';\nimport EventType from './enums/event-type';\nimport ActionType from './enums/action-type';\nimport { ITEM_ACTION_EVENT } from './layout';\n\nexport class Action\n{\n\t#type: string = null;\n\t#value: string | Object = null;\n\t#sliderParams: ?Object = null;\n\n\tconstructor(params)\n\t{\n\t\tthis.#type = params.type;\n\t\tthis.#value = params.value ?? null;\n\t\tthis.#sliderParams = params.sliderParams ?? null;\n\t}\n\n\texecute(vueComponent): Promise\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.isLayoutJsEvent())\n\t\t\t{\n\t\t\t\tvueComponent.$Bitrix.eventEmitter.emit(ITEM_ACTION_EVENT, {\n\t\t\t\t\tevent: EventType.LAYOUT_EVENT,\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\tid: vueComponent.$parent?.getIdByComponentInstance\n\t\t\t\t\t\t\t? vueComponent.$parent?.getIdByComponentInstance(vueComponent)\n\t\t\t\t\t\t\t: null,\n\t\t\t\t\t\tvalue: this.#value,\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\t\tresolve(true);\n\t\t\t}\n\n\t\t\telse if (this.isOpenRestApp())\n\t\t\t{\n\t\t\t\tconst params = {\n\t\t\t\t\t...(\n\t\t\t\t\t\tType.isPlainObject(this.#value)\n\t\t\t\t\t\t\t? this.#value\n\t\t\t\t\t\t\t: { value: `${this.#value}` }\n\t\t\t\t\t),\n\t\t\t\t};\n\t\t\t\tconst appId = vueComponent.$root.getAppId();\n\n\t\t\t\tif (Type.isStringFilled(this.#sliderParams?.title ?? null))\n\t\t\t\t{\n\t\t\t\t\tparams.bx24_title = this.#sliderParams.title;\n\t\t\t\t}\n\n\t\t\t\tif (Type.isNumber(this.#sliderParams?.width ?? null))\n\t\t\t\t{\n\t\t\t\t\tparams.bx24_width = this.#sliderParams.width;\n\t\t\t\t}\n\n\t\t\t\tif (Type.isNumber(this.#sliderParams?.leftBoundary ?? null))\n\t\t\t\t{\n\t\t\t\t\tparams.bx24_leftBoundary = this.#sliderParams.leftBoundary;\n\t\t\t\t}\n\n\t\t\t\tconst labelParams = {};\n\t\t\t\tif (Type.isStringFilled(this.#sliderParams?.labelBgColor ?? null))\n\t\t\t\t{\n\t\t\t\t\tlabelParams.bgColor = this.#sliderParams.labelBgColor;\n\t\t\t\t}\n\n\t\t\t\tif (Type.isStringFilled(this.#sliderParams?.labelColor ?? null))\n\t\t\t\t{\n\t\t\t\t\tlabelParams.color = this.#sliderParams.labelColor;\n\t\t\t\t}\n\n\t\t\t\tif (Type.isStringFilled(this.#sliderParams?.labelText ?? null))\n\t\t\t\t{\n\t\t\t\t\tlabelParams.text = this.#sliderParams.labelText;\n\t\t\t\t}\n\n\t\t\t\tif (Object.keys(labelParams).length > 0)\n\t\t\t\t{\n\t\t\t\t\tparams.bx24_label = labelParams;\n\t\t\t\t}\n\n\t\t\t\tif (BX.rest && BX.rest.AppLayout)\n\t\t\t\t{\n\t\t\t\t\tBX.rest.AppLayout.openApplication(appId, params);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.isRedirect())\n\t\t\t{\n\t\t\t\tconst linkAttrs = {\n\t\t\t\t\thref: this.#value,\n\t\t\t\t};\n\n\t\t\t\t// this magic allows auto opening internal links in slider if possible:\n\t\t\t\tconst link = Dom.create('a', {\n\t\t\t\t\tattrs: linkAttrs,\n\t\t\t\t\ttext: '',\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tdisplay: 'none',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t\tDom.append(link, document.body);\n\t\t\t\tlink.click();\n\t\t\t\tsetTimeout(() => Dom.remove(link), 10);\n\n\t\t\t\tresolve(this.#value);\n\t\t\t}\n\t\t\telse if (this.isFooterButtonClick())\n\t\t\t{\n\t\t\t\tvueComponent.$Bitrix.eventEmitter.emit(ITEM_ACTION_EVENT, {\n\t\t\t\t\tevent: EventType.FOOTER_BUTTON_CLICK,\n\t\t\t\t\tvalue: this.#value,\n\t\t\t\t});\n\n\t\t\t\tresolve(true);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treject(false);\n\t\t\t}\n\t\t});\n\t}\n\n\tisFooterButtonClick(): boolean\n\t{\n\t\treturn (this.#type === ActionType.FOOTER_BUTTON_CLICK);\n\t}\n\n\tisLayoutJsEvent(): boolean\n\t{\n\t\treturn (this.#type === ActionType.LAYOUT_JS_EVENT);\n\t}\n\n\tisOpenRestApp(): boolean\n\t{\n\t\treturn (this.#type === ActionType.OPEN_REST_APP);\n\t}\n\n\tisRedirect(): boolean\n\t{\n\t\treturn (this.#type === ActionType.REDIRECT);\n\t}\n\n\tgetValue(): string | Object\n\t{\n\t\treturn this.#value;\n\t}\n}\n","export default class ButtonState\n{\n\tstatic DEFAULT = '';\n\tstatic LOADING = 'loading';\n\tstatic DISABLED = 'disabled';\n}\n","import { Button as UIButton } from 'ui.buttons';\nimport { Action } from '../action';\nimport ButtonType from '../enums/button-type';\nimport ButtonState from '../enums/button-state';\n\nexport default\n{\n\tprops: {\n\t\tid: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tstate: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: ButtonState.DEFAULT,\n\t\t},\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: ButtonType.SECONDARY,\n\t\t},\n\t\taction: Object,\n\t},\n\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tuiButton: Object.freeze(null),\n\t\t};\n\t},\n\tcomputed:\n\t{\n\t\tbuttonContainerRef(): HTMLElement | undefined {\n\t\t\treturn this.$refs.buttonContainer;\n\t\t},\n\t\titemStateToButtonStateDict(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\t[ButtonState.LOADING]: UIButton.State.WAITING,\n\t\t\t\t[ButtonState.DISABLED]: UIButton.State.DISABLED,\n\t\t\t};\n\t\t},\n\t\titemTypeToButtonColorDict(): Object {\n\t\t\treturn {\n\t\t\t\t[ButtonType.PRIMARY]: UIButton.Color.PRIMARY,\n\t\t\t\t[ButtonType.SECONDARY]: UIButton.Color.LINK,\n\t\t\t};\n\t\t},\n\t\tclassName(): Array {\n\t\t\treturn [\n\t\t\t\tUIButton.BASE_CLASS,\n\t\t\t\tthis.itemTypeToButtonColorDict[this.type] ?? UIButton.Color.LINK,\n\t\t\t\tUIButton.Size.EXTRA_SMALL,\n\t\t\t\tUIButton.Style.ROUND,\n\t\t\t\tthis.itemStateToButtonStateDict[this.state] ?? '',\n\t\t\t];\n\t\t},\n\t},\n\tmethods: {\n\t\texecuteAction(): void\n\t\t{\n\t\t\tif (this.action && ![ButtonState.LOADING, ButtonState.DISABLED].includes(this.state))\n\t\t\t{\n\t\t\t\tconst action = new Action(this.action);\n\t\t\t\taction.execute(this);\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<button :class=\"className\" @click=\"executeAction\">{{ title }}</button>\n\t`,\n};\n","import { Runtime, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport ActionType from './enums/action-type';\nimport ButtonType from './enums/button-type';\n\nimport Button from './layout/button';\n\nexport const ITEM_ACTION_EVENT = 'crm:activityplacement:item:action';\n\nexport const Layout = {\n\tcomponents: {\n\t\tButton,\n\t},\n\tprops: {\n\t\tid: String,\n\t\tappId: String,\n\t\tonAction: Function,\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tlayout: {},\n\t\t\tloader: Object.freeze(null),\n\t\t\tisLoading: true,\n\t\t\tprimaryButtonParams: this.getButtonParams(ButtonType.PRIMARY, null, this.layout?.primaryButton),\n\t\t\tsecondaryButtonParams: this.getButtonParams(ButtonType.SECONDARY, null, this.layout?.secondaryButton),\n\t\t\tprimaryButtonAction: Object.freeze({ type: ActionType.FOOTER_BUTTON_CLICK, value: ButtonType.PRIMARY }),\n\t\t\tsecondaryButtonAction: Object.freeze({ type: ActionType.FOOTER_BUTTON_CLICK, value: ButtonType.SECONDARY }),\n\t\t};\n\t},\n\tcreated(): void\n\t{\n\t\tthis.$Bitrix.eventEmitter.subscribe(ITEM_ACTION_EVENT, this.onActionEvent);\n\t},\n\tmounted() {\n\t\tthis.showLoader(true);\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.$Bitrix.eventEmitter.unsubscribe(ITEM_ACTION_EVENT, this.onActionEvent);\n\t},\n\twatch: {\n\t\tlayout(newLayout)\n\t\t{\n\t\t\tthis.primaryButtonParams = this.getButtonParams(\n\t\t\t\tButtonType.PRIMARY,\n\t\t\t\tthis.primaryButtonParams,\n\t\t\t\tnewLayout.primaryButton,\n\t\t\t);\n\t\t\tthis.secondaryButtonParams = this.getButtonParams(\n\t\t\t\tButtonType.SECONDARY,\n\t\t\t\tthis.secondaryButtonParams,\n\t\t\t\tnewLayout.secondaryButton,\n\t\t\t);\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tsetLayout(newLayout: Object): void\n\t\t{\n\t\t\tthis.layout = newLayout;\n\t\t\tthis.$Bitrix.eventEmitter.emit('layout:updated');\n\t\t},\n\t\tshowLoader(showLoader: boolean)\n\t\t{\n\t\t\tif (showLoader)\n\t\t\t{\n\t\t\t\tif (!this.loader)\n\t\t\t\t{\n\t\t\t\t\tthis.loader = new Loader({ size: 50 });\n\t\t\t\t}\n\t\t\t\tthis.loader.show(this.$refs.loader);\n\t\t\t}\n\t\t\telse if (this.loader)\n\t\t\t{\n\t\t\t\tthis.loader.hide();\n\t\t\t}\n\t\t\tthis.isLoading = showLoader;\n\t\t},\n\t\tsetLayoutItemState(id: string, visible: ?Boolean, properties: ?Object, callback: function)\n\t\t{\n\t\t\tif (this.$refs.blocks.setLayoutItemState(id, visible, properties))\n\t\t\t{\n\t\t\t\tthis.$nextTick((callback({ result: 'success' })));\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$nextTick((callback({ result: 'error', errors: ['item not found'] })));\n\t\t\t}\n\t\t},\n\t\tsetButtonState(id: string, state: ?Object, callback: function)\n\t\t{\n\t\t\tswitch (id)\n\t\t\t{\n\t\t\t\tcase ButtonType.PRIMARY:\n\t\t\t\t\tthis.primaryButtonParams = this.getButtonParams(ButtonType.PRIMARY, this.primaryButtonParams, state);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ButtonType.SECONDARY:\n\t\t\t\t\tthis.secondaryButtonParams = this.getButtonParams(ButtonType.SECONDARY, this.secondaryButtonParams, state);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tthis.$nextTick((callback({ result: 'success' })));\n\t\t},\n\t\tgetButtonParams(buttonType: string, oldValue: ?Object, newValue: ?Object): ?Object\n\t\t{\n\t\t\tif (Type.isNull(newValue))\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t...oldValue,\n\t\t\t\t...newValue,\n\t\t\t\ttype: buttonType,\n\t\t\t};\n\t\t},\n\t\tgetAppId(): string\n\t\t{\n\t\t\treturn this.appId;\n\t\t},\n\t\tonActionEvent(event: BaseEvent): void\n\t\t{\n\t\t\tconst eventData = event.getData();\n\t\t\tthis.onAction(Runtime.clone(eventData));\n\t\t},\n\t},\n\tcomputed:\n\t{\n\t\thasPrimaryButton(): Boolean\n\t\t{\n\t\t\treturn Boolean(this.primaryButtonParams);\n\t\t},\n\t\thasSecondaryButton(): Boolean\n\t\t{\n\t\t\treturn Boolean(this.secondaryButtonParams);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"crm-entity-stream-restapp-loader\" ref=\"loader\" v-show=\"isLoading\"></div>\n\t\t<BlocksCollection  \n\t\t\tv-show=\"!isLoading\" \n\t\t\tcontainerCssClass=\"crm-entity-stream-restapp-container\"\n\t\t\titemCssClass=\"crm-timeline__restapp-container_block\"\n\t\t\tref=\"blocks\"\n\t\t\t:blocks=\"layout?.blocks ?? {}\"></BlocksCollection>\n\n\t\t<div class=\"crm-entity-stream-restapp-btn-container\" v-show=\"!isLoading && (hasPrimaryButton || hasSecondaryButton)\">\n\t\t\t<Button v-if=\"hasPrimaryButton\" v-bind=\"primaryButtonParams\" :action=\"primaryButtonAction\"></Button>\n\t\t\t<Button v-if=\"hasSecondaryButton\" v-bind=\"secondaryButtonParams\" :action=\"secondaryButtonAction\"></Button>\n\t\t</div>\n\t`,\n};\n","export default class BlockType\n{\n\tstatic text = 'Text';\n\tstatic link = 'Link';\n\tstatic lineOfBlocks = 'LineOfTextBlocks';\n\tstatic withTitle = 'WithTitle';\n\tstatic section = 'Section';\n\tstatic list = 'List';\n\tstatic dropdownMenu = 'DropdownMenu';\n\tstatic input = 'Input';\n\tstatic select = 'Select';\n\tstatic textarea = 'Textarea';\n}\n","export default class TextColor\n{\n\tstatic PRIMARY = 'primary';\n\tstatic WARNING = 'warning';\n\tstatic DANGER = 'danger';\n\tstatic SUCCESS = 'success';\n\tstatic BASE_50 = 'base-50';\n\tstatic BASE_60 = 'base-60';\n\tstatic BASE_70 = 'base-70';\n\tstatic BASE_90 = 'base-90';\n}\n","export default class TextSize\n{\n\tstatic XS = 'xs';\n\tstatic SM = 'sm';\n\tstatic MD = 'md';\n\tstatic LG = 'lg';\n\tstatic XL = 'xl';\n}\n","import TextColor from '../../enums/text-color';\nimport TextSize from '../../enums/text-size';\nimport { Text } from 'main.core';\n\nexport default {\n\tinheritAttrs: false,\n\tprops: {\n\t\tvalue: String | Number,\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tcolor: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tbold: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\tsize: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: 'md',\n\t\t},\n\t\tmultiline: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed: {\n\t\tclassName(): Array {\n\t\t\treturn [\n\t\t\t\t'crm-timeline__text-block',\n\t\t\t\tthis.colorClassname,\n\t\t\t\tthis.boldClassname,\n\t\t\t\tthis.sizeClassname,\n\t\t\t];\n\t\t},\n\t\tcolorClassname(): string {\n\t\t\tconst upperCaseColorProp = this.color ? this.color.toUpperCase() : '';\n\t\t\tconst color = TextColor[upperCaseColorProp] ?? '';\n\n\t\t\treturn color ? `--color-${color}` : '';\n\t\t},\n\n\t\tboldClassname(): string {\n\t\t\tconst weight = this.bold ? 'bold' : 'normal';\n\n\t\t\treturn `--weight-${weight}`;\n\t\t},\n\n\t\tsizeClassname(): string {\n\t\t\tconst upperCaseWeightProp = this.size ? this.size.toUpperCase() : '';\n\t\t\tconst size = TextSize[upperCaseWeightProp] ?? TextSize.SM;\n\n\t\t\treturn `--size-${size}`;\n\t\t},\n\t\tencodedText(): string {\n\t\t\tlet text = Text.encode(this.value);\n\t\t\tif (this.multiline)\n\t\t\t{\n\t\t\t\ttext = text.replace(/\\n/g, '<br />');\n\t\t\t}\n\n\t\t\treturn text;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<span\n\t\t\t:title=\"title\"\n\t\t\t:class=\"className\"\n\t\t\tv-html=\"encodedText\"\n\t\t></span>`,\n};\n","import { Action } from '../../action';\nimport TextSize from '../../enums/text-size';\n\nexport default {\n\tinheritAttrs: false,\n\tprops: {\n\t\ttext: String,\n\t\taction: Object,\n\t\tsize: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: 'md',\n\t\t},\n\t\tbold: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tcomputed: {\n\t\thref(): ?string\n\t\t{\n\t\t\tif (!this.action)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst action = new Action(this.action);\n\t\t\tif (action.isRedirect())\n\t\t\t{\n\t\t\t\treturn action.getValue();\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\tlinkAttrs(): Object\n\t\t{\n\t\t\tif (!this.action)\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\t\t\tconst action = new Action(this.action);\n\t\t\tif (!action.isRedirect())\n\t\t\t{\n\t\t\t\treturn {};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\thref: action.getValue(),\n\t\t\t};\n\t\t},\n\n\t\tclassName() {\n\t\t\treturn [\n\t\t\t\t'crm-timeline__card_link',\n\t\t\t\tthis.bold ? '--bold' : '',\n\t\t\t\tthis.sizeClassname,\n\t\t\t];\n\t\t},\n\t\tsizeClassname(): string {\n\t\t\tconst upperCaseWeightProp = this.size ? this.size.toUpperCase() : '';\n\t\t\tconst size = TextSize[upperCaseWeightProp] ?? TextSize.SM;\n\n\t\t\treturn `--size-${size}`;\n\t\t},\n\t},\n\tmethods: {\n\t\texecuteAction(): void\n\t\t{\n\t\t\tif (this.action)\n\t\t\t{\n\t\t\t\tconst action = new Action(this.action);\n\t\t\t\taction.execute(this);\n\t\t\t}\n\t\t},\n\t},\n\n\ttemplate:\n\t\t`\n\t\t\t<a\n\t\t\t\tv-if=\"href\"\n\t\t\t\tv-bind=\"linkAttrs\"\n\t\t\t\t:class=\"className\"\n\t\t\t>\n\t\t\t{{text}}\n\t\t\t</a>\n\t\t\t<span\n\t\t\t\tv-else\n\t\t\t\t@click=\"executeAction\"\n\t\t\t\t:class=\"className\"\n\t\t\t>\n\t\t\t\t{{text}}\n\t\t\t</span>\n\t\t`,\n};\n","export default class BlockWithTitleWidth\n{\n\tstatic SM = 'sm';\n\tstatic MD = 'md';\n\tstatic LG = 'lg';\n}\n","import BlockType from '../../enums/block-type';\n\nexport default {\n\tinheritAttrs: false,\n\tprops: {\n\t\tblocks: Object,\n\t},\n\tcomputed: {\n\t\tallowedTypes(): Array\n\t\t{\n\t\t\treturn Object.values(BlockType);\n\t\t},\n\t\tcontainerCssClass(): string\n\t\t{\n\t\t\treturn '';\n\t\t},\n\t\tcontainerTagName(): string\n\t\t{\n\t\t\treturn 'div';\n\t\t},\n\t\titemCssClass(): string\n\t\t{\n\t\t\treturn '';\n\t\t},\n\t\titemTagName(): string\n\t\t{\n\t\t\treturn 'div';\n\t\t},\n\t\tisInline(): Boolean\n\t\t{\n\t\t\treturn false;\n\t\t},\n\t},\n\tmethods: {\n\t\tsetLayoutItemState(id: string, visible: ?Boolean, properties: ?Object): Boolean\n\t\t{\n\t\t\treturn this.$refs.blocks.setLayoutItemState(id, visible, properties);\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<BlocksCollection \n\t\t\t:containerCssClass=\"containerCssClass\"\n\t\t\t:containerTagName=\"containerTagName\"\n\t\t\t:itemCssClass=\"itemCssClass\"\n\t\t\t:itemTagName=\"itemTagName\"\n\t\t\tref=\"blocks\"\n\t\t\t:blocks=\"blocks ?? {}\" \n\t\t\t:inline=\"true\"\n\t\t\t:allowedTypes=\"allowedTypes\"\n\t\t></BlocksCollection>`,\n};\n","import { BitrixVue } from 'ui.vue3';\nimport BlockType from '../../enums/block-type';\nimport BaseBlocksCollection from './base-blocks-collection';\n\nexport const LineOfTextBlocks = BitrixVue.cloneComponent(BaseBlocksCollection, {\n\tcomputed: {\n\t\tallowedTypes(): Array\n\t\t{\n\t\t\treturn [BlockType.text, BlockType.link, BlockType.dropdownMenu];\n\t\t},\n\t\tcontainerCssClass(): string\n\t\t{\n\t\t\treturn 'crm-timeline-block-line-of-texts';\n\t\t},\n\t\tcontainerTagName(): string\n\t\t{\n\t\t\treturn 'span';\n\t\t},\n\t\titemTagName(): string\n\t\t{\n\t\t\treturn 'span';\n\t\t},\n\t\tisInline(): Boolean\n\t\t{\n\t\t\treturn true;\n\t\t},\n\t},\n});\n","import { Dom } from 'main.core';\nimport BlockType from '../../enums/block-type';\nimport BlockWithTitleWidth from '../../enums/block-with-title-width';\nimport Text from './text';\nimport Link from './link';\nimport { LineOfTextBlocks } from './line-of-text-blocks';\n\nexport default {\n\tinheritAttrs: false,\n\tcomponents: {\n\t\tText,\n\t\tLink,\n\t\tLineOfTextBlocks,\n\t},\n\tprops: {\n\t\tid: String,\n\t\ttitle: String,\n\t\tinline: Boolean,\n\t\ttitleWidth: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: BlockWithTitleWidth.MD,\n\t\t},\n\t\tblock: Object,\n\t},\n\tcomputed: {\n\t\tclassName(): Object\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-timeline__card-container_info',\n\t\t\t\t'--word-wrap',\n\t\t\t\tthis.widthClassname,\n\t\t\t\tthis.inline ? '--inline' : '',\n\t\t\t];\n\t\t},\n\t\twidthClassname(): string {\n\t\t\tconst width = BlockWithTitleWidth[this.titleWidth.toUpperCase()] ?? BlockWithTitleWidth.MD;\n\n\t\t\treturn `--width-${width}`;\n\t\t},\n\t\tisValidBlock(): Boolean\n\t\t{\n\t\t\treturn [BlockType.text, BlockType.link, BlockType.lineOfBlocks].includes(this.rendererName);\n\t\t},\n\t\trendererName(): ?string\n\t\t{\n\t\t\treturn BlockType[this.block?.type] ?? null;\n\t\t},\n\t},\n\tmethods: {\n\t\tisTitleCropped(): Boolean\n\t\t{\n\t\t\tconst titleElem: Element = this.$refs.title;\n\n\t\t\treturn titleElem.scrollWidth > titleElem.clientWidth;\n\t\t},\n\t},\n\tmounted()\n\t{\n\t\tthis.$nextTick(() => {\n\t\t\tif (this.isTitleCropped())\n\t\t\t{\n\t\t\t\tDom.attr(this.$refs.title, 'title', this.title);\n\t\t\t}\n\t\t});\n\t},\n\ttemplate:\n\t\t`\n\t\t\t<div :class=\"className\" v-if=\"isValidBlock\">\n\t\t\t\t<div ref=\"title\" class=\"crm-timeline__card-container_info-title\">{{ title }}</div>\n\t\t\t\t<div class=\"crm-timeline__card-container_info-value\">\n\t\t\t\t\t<component :is=\"rendererName\" v-bind=\"block.properties\" :id=\"id\"></component>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`,\n};\n","const MenuId = 'restapp-dropdown-menu';\n\nimport { Type } from 'main.core';\nimport { MenuManager } from 'main.popup';\nimport EventType from '../../enums/event-type';\nimport TextSize from '../../enums/text-size';\nimport { ITEM_ACTION_EVENT } from '../../layout';\n\nexport default {\n\tinheritAttrs: false,\n\tprops: {\n\t\tvalues: Object,\n\t\tid: String,\n\t\tselectedValue: {\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tsize: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: 'md',\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcurrentSelectedValue: this.selectedValue,\n\t\t};\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tconst menu = MenuManager.getMenuById(MenuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.destroy();\n\t\t}\n\t},\n\tcomputed: {\n\t\tclassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-timeline-block-dropdownmenu',\n\t\t\t\tthis.sizeClassname,\n\t\t\t];\n\t\t},\n\t\tsizeClassname(): String\n\t\t{\n\t\t\tconst upperCaseWeightProp = this.size ? this.size.toUpperCase() : '';\n\t\t\tconst size = TextSize[upperCaseWeightProp] ?? TextSize.SM;\n\n\t\t\treturn `--size-${size}`;\n\t\t},\n\t\tselectedValueCode(): String\n\t\t{\n\t\t\tlet selectedValue = this.currentSelectedValue;\n\t\t\tif (!Object.hasOwn(this.values, selectedValue))\n\t\t\t{\n\t\t\t\tconst allValues = Object.keys(this.values);\n\t\t\t\tselectedValue = allValues.length > 0 ? allValues[0] : '';\n\t\t\t}\n\n\t\t\treturn selectedValue;\n\t\t},\n\t\tselectedValueTitle(): String\n\t\t{\n\t\t\treturn String(this.values[this.selectedValueCode] ?? '');\n\t\t},\n\t\tisValid(): Boolean\n\t\t{\n\t\t\treturn Type.isPlainObject(this.values) && Object.keys(this.values).length > 0;\n\t\t},\n\t},\n\twatch: {\n\t\tselectedValue(newSelectedValue)\n\t\t{\n\t\t\tthis.currentSelectedValue = newSelectedValue;\n\t\t},\n\t},\n\tmethods: {\n\t\tonMenuItemClick(valueId): void\n\t\t{\n\t\t\tthis.currentSelectedValue = valueId;\n\t\t\tMenuManager.getCurrentMenu()?.close();\n\t\t\tthis.$Bitrix.eventEmitter.emit(ITEM_ACTION_EVENT, {\n\t\t\t\tevent: EventType.VALUE_CHANGED_EVENT,\n\t\t\t\tvalue: {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tvalue: valueId,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tshowMenu(): void\n\t\t{\n\t\t\tconst menuItems = [];\n\t\t\tObject.keys(this.values).forEach((valueId) => {\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: String(this.values[valueId]),\n\t\t\t\t\tvalue: valueId,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.onMenuItemClick(valueId);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\t\t\tMenuManager.show({\n\t\t\t\tid: MenuId,\n\t\t\t\tcacheable: false,\n\t\t\t\tbindElement: this.$el,\n\t\t\t\titems: menuItems,\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<span v-if=\"isValid\" :class=\"className\" @click=\"showMenu\"><span class=\"crm-timeline-block-dropdownmenu-content\">{{selectedValueTitle}}</span><span class=\"crm-timeline-block-dropdownmenu-arrow\"></span></span>`,\n};\n","export default\n{\n\temits: ['update:modelValue'],\n\tprops: {\n\t\tmodelValue: String,\n\t\tplaceholder: String,\n\t\tdisabled: Boolean,\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcurrentValue: this.modelValue,\n\t\t};\n\t},\n\tmethods: {\n\t\tonChange(): void\n\t\t{\n\t\t\tthis.$emit('update:modelValue', this.currentValue);\n\t\t},\n\t},\n\twatch: {\n\t\tmodelValue(newValue)\n\t\t{\n\t\t\tthis.currentValue = newValue;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\n\t\t\t<input :placeholder=\"placeholder\" :disabled=\"disabled\" v-model=\"currentValue\" @input=\"onChange\" type=\"text\" class=\"ui-ctl-element\" />\n\t\t</div>\n\t`,\n};\n","import { Type } from 'main.core';\n\nexport default\n{\n\temits: ['update:modelValue'],\n\tprops: {\n\t\tmodelValue: String,\n\t\tvalues: Array,\n\t\tdisabled: Boolean,\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcurrentValue: this.getSelectedValue(this.modelValue),\n\t\t};\n\t},\n\tmethods: {\n\t\tonChange(): void\n\t\t{\n\t\t\tthis.$emit('update:modelValue', this.currentValue);\n\t\t},\n\t\tgetSelectedValue(valueCandidate): string\n\t\t{\n\t\t\tif (!Type.isArray(this.values))\n\t\t\t{\n\t\t\t\treturn '';\n\t\t\t}\n\n\t\t\tif (this.values.some((item) => item.id === valueCandidate))\n\t\t\t{\n\t\t\t\treturn valueCandidate;\n\t\t\t}\n\n\t\t\treturn this.values.length > 0 ? this.values[0].id : '';\n\t\t},\n\t},\n\twatch: {\n\t\tmodelValue(newValue)\n\t\t{\n\t\t\tthis.currentValue = this.getSelectedValue(newValue);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\n\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t<select :disabled=\"disabled\" v-model=\"currentValue\" @change=\"onChange\" class=\"ui-ctl-element\">\n\t\t\t\t<option :value=\"option.id\" :key=\"option.id\" :selected=\"option.id===currentValue\" v-for=\"option in values\">{{ option.value }}</option>\n\t\t\t</select>\n\t\t</div>\n\t`,\n};\n","import { Dom } from 'main.core';\nexport default\n{\n\temits: ['update:modelValue'],\n\tprops: {\n\t\tmodelValue: String,\n\t\tplaceholder: String,\n\t\tdisabled: Boolean,\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcurrentValue: this.modelValue,\n\t\t};\n\t},\n\tmounted()\n\t{\n\t\tthis.adjustTextareaHeight();\n\t},\n\tmethods: {\n\t\tonChange(): void\n\t\t{\n\t\t\tthis.$emit('update:modelValue', this.currentValue);\n\t\t\tthis.adjustTextareaHeight();\n\t\t},\n\t\tadjustTextareaHeight(): void\n\t\t{\n\t\t\tconst textareaNode = this.$refs.textarea;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tDom.style(textareaNode, 'height', 0);\n\n\t\t\t\tlet height = textareaNode.scrollHeight;\n\n\t\t\t\tif (height < 120)\n\t\t\t\t{\n\t\t\t\t\theight = 120;\n\t\t\t\t}\n\n\t\t\t\tif (height > 1000)\n\t\t\t\t{\n\t\t\t\t\theight = 1000;\n\t\t\t\t}\n\n\t\t\t\theight += 12;\n\t\t\t\theight += 'px';\n\n\t\t\t\tDom.style(textareaNode, 'height', height);\n\t\t\t\tDom.style(textareaNode.parentNode, 'height', height);\n\t\t\t});\n\t\t},\n\t},\n\twatch: {\n\t\tmodelValue(newValue)\n\t\t{\n\t\t\tthis.currentValue = newValue;\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tthis.adjustTextareaHeight(this.$refs.textarea);\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"ui-ctl ui-ctl-textarea ui-ctl-w100 ui-ctl-no-resize\">\n\t\t\t<textarea ref=\"textarea\" :placeholder=\"placeholder\" :disabled=\"disabled\" v-model=\"currentValue\" @input=\"onChange\" class=\"ui-ctl-element\"></textarea>\n\t\t</div>\n\t`,\n};\n","import EventType from '../../enums/event-type';\nimport { ITEM_ACTION_EVENT } from '../../layout';\nimport Input from './inputs/input-text';\nimport Select from './inputs/select';\nimport Textarea from './inputs/textarea';\n\nexport default {\n\tinheritAttrs: false,\n\tcomponents: {\n\t\tInput,\n\t\tSelect,\n\t\tTextarea,\n\t},\n\tprops: {\n\t\tid: String,\n\t\ttitle: String,\n\t\terrorText: String,\n\t\tvalue: String,\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcurrentValue: this.getInitialValue(),\n\t\t};\n\t},\n\tcomputed: {\n\t\tclassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'ui-ctl-container',\n\t\t\t\t'ui-ctl-w100',\n\t\t\t\tthis.hasError ? 'ui-ctl-warning' : '',\n\t\t\t];\n\t\t},\n\t\thasTitle(): boolean\n\t\t{\n\t\t\treturn Boolean(this.title);\n\t\t},\n\t\thasError(): boolean\n\t\t{\n\t\t\treturn Boolean(this.errorText);\n\t\t},\n\t\tcomponentName(): String\n\t\t{\n\t\t\tthrow new Error('Must be overridden');\n\t\t},\n\t\tcomponentProps(): Object\n\t\t{\n\t\t\tthrow new Error('Must be overridden');\n\t\t},\n\t},\n\twatch: {\n\t\tvalue(newValue): void\n\t\t{\n\t\t\tthis.currentValue = newValue;\n\t\t},\n\t},\n\tmethods: {\n\t\tgetInitialValue(): string\n\t\t{\n\t\t\treturn this.value;\n\t\t},\n\t\tonChange(newValue): void\n\t\t{\n\t\t\tthis.$Bitrix.eventEmitter.emit(ITEM_ACTION_EVENT, {\n\t\t\t\tevent: EventType.VALUE_CHANGED_EVENT,\n\t\t\t\tvalue: {\n\t\t\t\t\tid: this.id,\n\t\t\t\t\tvalue: newValue,\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div :class=\"className\">\n\t\t\t<div class=\"ui-ctl-top\" v-if=\"hasTitle\">\n\t\t\t\t<div class=\"ui-ctl-title\">{{ title }}</div>\n\t\t\t</div>\n\t\t\t<component :is=\"componentName\" v-bind=\"componentProps\" :disabled=\"disabled\" v-model=\"currentValue\" @update:modelValue=\"onChange\"></component>\n\t\t\t<div v-if=\"hasError\" class=\"ui-ctl-bottom\">{{ errorText }}</div>\n\t\t</div>\n\t`,\n};\n","import { BitrixVue } from 'ui.vue3';\nimport BaseInput from './base-input-wrapper';\n\nexport const Input = BitrixVue.cloneComponent(BaseInput, {\n\tprops: {\n\t\tplaceholder: String,\n\t},\n\tcomputed: {\n\t\tcomponentName(): string\n\t\t{\n\t\t\treturn 'Input';\n\t\t},\n\t\tcomponentProps(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tplaceholder: this.placeholder,\n\t\t\t};\n\t\t},\n\t},\n});\n","import { Type } from 'main.core';\nimport { BitrixVue } from 'ui.vue3';\nimport BaseInput from './base-input-wrapper';\n\nexport const Select = BitrixVue.cloneComponent(BaseInput, {\n\tprops: {\n\t\tselectedValue: String,\n\t\tvalues: Object,\n\t},\n\tcomputed: {\n\t\tcomponentName(): string\n\t\t{\n\t\t\treturn 'Select';\n\t\t},\n\t\tcomponentProps(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tvalues: this.preparedValues,\n\t\t\t};\n\t\t},\n\t\tpreparedValues(): Array\n\t\t{\n\t\t\tif (!Type.isPlainObject(this.values))\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tconst result = [];\n\t\t\tObject.keys(this.values).forEach((key) => {\n\t\t\t\tresult.push({\n\t\t\t\t\tid: key,\n\t\t\t\t\tvalue: String(this.values[key]),\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn result;\n\t\t},\n\t},\n\twatch: {\n\t\tselectedValue(newValue): void\n\t\t{\n\t\t\tthis.currentValue = newValue;\n\t\t},\n\t},\n\tmethods: {\n\t\tgetInitialValue(): string\n\t\t{\n\t\t\treturn `${this.selectedValue}`;\n\t\t},\n\t},\n});\n","import { BitrixVue } from 'ui.vue3';\nimport BaseInput from './base-input-wrapper';\n\nexport const Textarea = BitrixVue.cloneComponent(BaseInput, {\n\tprops: {\n\t\tplaceholder: String,\n\t},\n\tcomputed: {\n\t\tcomponentName(): string\n\t\t{\n\t\t\treturn 'Textarea';\n\t\t},\n\t\tcomponentProps(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tplaceholder: this.placeholder,\n\t\t\t};\n\t\t},\n\t},\n});\n","import { BitrixVue } from 'ui.vue3';\nimport BlockType from '../../enums/block-type';\nimport BaseBlocksCollection from './base-blocks-collection';\n\nexport const List = BitrixVue.cloneComponent(BaseBlocksCollection, {\n\tcomputed: {\n\t\tallowedTypes(): Array\n\t\t{\n\t\t\treturn [BlockType.text, BlockType.link, BlockType.lineOfBlocks];\n\t\t},\n\t\tcontainerCssClass(): string\n\t\t{\n\t\t\treturn 'crm-timeline-block-list';\n\t\t},\n\t\titemCssClass(): string\n\t\t{\n\t\t\treturn 'crm-timeline-block-list-item';\n\t\t},\n\t},\n});\n","export default class SectionImageSize\n{\n\tstatic SM = 'sm';\n\tstatic MD = 'md';\n\tstatic LG = 'lg';\n}\n","export default class SectionType\n{\n\tstatic default = 'default';\n\tstatic primary = 'primary';\n\tstatic warning = 'warning';\n\tstatic danger = 'danger';\n\tstatic success = 'success';\n\tstatic withBorder = 'with-border';\n}\n","import { BitrixVue } from 'ui.vue3';\nimport BlockType from '../../enums/block-type';\nimport SectionImageSize from '../../enums/section-image-size';\nimport SectionType from '../../enums/section-type';\nimport BaseBlocksCollection from './base-blocks-collection';\n\nexport const Section = BitrixVue.cloneComponent(BaseBlocksCollection, {\n\tprops: {\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: SectionType.default,\n\t\t},\n\t\timageSrc: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\timageSize: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: SectionImageSize.LG,\n\t\t},\n\t},\n\tcomputed: {\n\t\tallowedTypes(): Array\n\t\t{\n\t\t\treturn Object.values(BlockType).filter((item) => (item !== BlockType.section));\n\t\t},\n\t\tclassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-timeline-block-section',\n\t\t\t\tthis.typeClassname,\n\t\t\t];\n\t\t},\n\t\timageClassName(): Array\n\t\t{\n\t\t\treturn [\n\t\t\t\t'crm-timeline-block-section-img',\n\t\t\t\tthis.imageSizeClassname,\n\t\t\t];\n\t\t},\n\t\ttypeClassname(): string\n\t\t{\n\t\t\tconst type = SectionType[this.type] ?? SectionType.default;\n\n\t\t\treturn type ? `--type-${type}` : '';\n\t\t},\n\t\timageSizeClassname(): string\n\t\t{\n\t\t\tconst size = SectionImageSize[this.imageSize.toUpperCase()] ?? SectionImageSize.LG;\n\n\t\t\treturn size ? `--size-${size}` : '';\n\t\t},\n\t\timageUri(): ?string\n\t\t{\n\t\t\tif (!this.imageSrc)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\tconst regex = /^(http|https):\\/\\//;\n\t\t\tif (!regex.test(this.imageSrc))\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn this.imageSrc;\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<div :class=\"className\">\n\t\t\t<div v-if=\"imageUri\" :class=\"imageClassName\">\n\t\t\t\t<img :src=\"imageUri\" />\n\t\t\t</div>\n\t\t<BlocksCollection\n\t\t\tref=\"blocks\"\n\t\t\tcontainerCssClass=\"crm-timeline-block-section-blocks\"\n\t\t\titemCssClass=\"crm-timeline__restapp-container_block\"\n\t\t\t:blocks=\"blocks ?? {}\"\n\t\t\t:allowedTypes=\"allowedTypes\"\n\t\t></BlocksCollection>\n\t\t</div>`,\n});\n","import { Type } from 'main.core';\nimport BlockType from '../enums/block-type';\n\nimport Text from './blocks/text';\nimport Link from './blocks/link';\nimport WithTitle from './blocks/with-title';\nimport DropdownMenu from './blocks/dropdown-menu';\nimport { Input } from './blocks/text-input-wrapper';\nimport { Select } from './blocks/select-wrapper';\nimport { Textarea } from './blocks/textarea-wrapper';\nimport { LineOfTextBlocks } from './blocks/line-of-text-blocks';\nimport { List } from './blocks/list';\nimport { Section } from './blocks/section';\n\nexport default {\n\tcomponents: {\n\t\tText,\n\t\tLink,\n\t\tLineOfTextBlocks,\n\t\tDropdownMenu,\n\t\tInput,\n\t\tSelect,\n\t\tTextarea,\n\t\tList,\n\t\tWithTitle,\n\t\tSection,\n\t},\n\tprops: {\n\t\tcontainerTagName: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: 'div',\n\t\t},\n\t\tcontainerCssClass: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\titemTagName: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: 'div',\n\t\t},\n\t\titemCssClass: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t\tdefault: '',\n\t\t},\n\t\tinline: {\n\t\t\ttype: Boolean,\n\t\t\trequired: false,\n\t\t\tdefault: false,\n\t\t},\n\t\tallowedTypes: {\n\t\t\ttype: Array,\n\t\t\trequired: false,\n\t\t\tdefault: Object.values(BlockType),\n\t\t},\n\t\tblocks: Object,\n\t},\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tcurrentBlocks: this.blocks,\n\t\t\tblockRefs: {},\n\t\t};\n\t},\n\tbeforeUpdate() {\n\t\tthis.blockRefs = {};\n\t},\n\tupdated() {\n\t\tthis.setDataIdAttribute();\n\t},\n\tmounted() {\n\t\tthis.setDataIdAttribute();\n\t},\n\twatch: {\n\t\tblocks(newBlocks)\n\t\t{\n\t\t\tthis.currentBlocks = newBlocks;\n\t\t},\n\t},\n\tmethods:\n\t{\n\t\tsaveRef(ref: Object, id: string): void\n\t\t{\n\t\t\tthis.blockRefs[id] = ref;\n\t\t},\n\t\tsetDataIdAttribute(): void\n\t\t{\n\t\t\tif (!this.blockRefs || this.visibleBlocks.length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.visibleBlocks.forEach((block, index) => {\n\t\t\t\tconst blockId = block.id;\n\t\t\t\tconst node = this.blockRefs[blockId]?.$el;\n\t\t\t\tif (Type.isElementNode(node))\n\t\t\t\t{\n\t\t\t\t\tnode.setAttribute('data-id', blockId);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t\tsetLayoutItemState(id: string, visible: ?Boolean, properties: ?Object): Boolean\n\t\t{\n\t\t\tif (!Object.hasOwn(this.currentBlocks, id))\n\t\t\t{\n\t\t\t\treturn Object.keys(this.currentBlocks).reduce((result, blockId) => {\n\t\t\t\t\tif (this.blockRefs[blockId] && Type.isFunction(this.blockRefs[blockId].setLayoutItemState))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.blockRefs[blockId].setLayoutItemState(id, visible, properties) || result;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn result;\n\t\t\t\t}, false);\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(properties))\n\t\t\t{\n\t\t\t\tthis.currentBlocks[id].properties = {\n\t\t\t\t\t...this.currentBlocks[id].properties,\n\t\t\t\t\t...properties,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (Type.isBoolean(visible))\n\t\t\t{\n\t\t\t\tthis.currentBlocks[id].visible = visible;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\tgetIdByComponentInstance(componentInstance: Object): ?string\n\t\t{\n\t\t\tconst id = Object.keys(this.blockRefs).find(\n\t\t\t\t(blockId) => this.blockRefs[blockId] === componentInstance,\n\t\t\t);\n\n\t\t\treturn id || null;\n\t\t},\n\t\tgetItemCssClassList(block: Object): Array\n\t\t{\n\t\t\tconst list = [];\n\n\t\t\tif (this.itemCssClass)\n\t\t\t{\n\t\t\t\tlist.push(this.itemCssClass);\n\t\t\t}\n\n\t\t\tif (!block.visible)\n\t\t\t{\n\t\t\t\tlist.push('--hidden');\n\t\t\t}\n\n\t\t\tif (block.id === this.firstVisibleBlockId)\n\t\t\t{\n\t\t\t\tlist.push('--first-visible');\n\t\t\t}\n\n\t\t\tif (block.id === this.lastVisibleBlockId)\n\t\t\t{\n\t\t\t\tlist.push('--last-visible');\n\t\t\t}\n\n\t\t\treturn list;\n\t\t}\n\t},\n\tcomputed: {\n\t\tvisibleBlocks(): Array\n\t\t{\n\t\t\tif (!this.currentBlocks)\n\t\t\t{\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\treturn Object.keys(this.currentBlocks)\n\t\t\t\t.map((id) => {\n\t\t\t\t\tconst block = this.currentBlocks[id];\n\t\t\t\t\tconst rendererName = BlockType[block.type] ?? null;\n\t\t\t\t\tconst visible = (!Type.isBoolean(block.visible) || block.visible);\n\n\t\t\t\t\treturn { id, rendererName, ...this.currentBlocks[id], visible };\n\t\t\t\t})\n\t\t\t\t.filter((item) => (this.allowedTypes.includes(item.rendererName)))\n\t\t\t;\n\t\t},\n\t\tfirstVisibleBlockId(): ?String\n\t\t{\n\t\t\tconst visibleBlocks = this.visibleBlocks.filter((item) => item.visible);\n\t\t\tif (!visibleBlocks.length)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn visibleBlocks[0].id;\n\t\t},\n\t\tlastVisibleBlockId(): ?String\n\t\t{\n\t\t\tconst visibleBlocks = this.visibleBlocks.filter((item) => item.visible);\n\t\t\tif (!visibleBlocks.length)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn visibleBlocks[visibleBlocks.length - 1].id;\n\t\t},\n\t},\n\t// language=Vue\n\ttemplate: `\n\t\t<component :is=\"containerTagName\" :class=\"containerCssClass\">\n\t\t\t<component :is=\"itemTagName\"\n\t\t\t\t:class=\"getItemCssClassList(block)\"\n\t\t\t\tv-for=\"(block) in visibleBlocks\"\n\t\t\t\t:key=\"block.id\"\n\t\t\t>\n\t\t\t\t<component :is=\"block.rendererName\"\n\t\t\t\t\t\t   :id=\"block.id\"\n\t\t\t\t\t\t   v-bind=\"block.properties\"\n\t\t\t\t\t\t   :ref=\"(el) => this.saveRef(el, block.id)\"\n\t\t\t\t/>\n\t\t\t\t<span v-if=\"inline\">&nbsp;</span>\n\t\t\t</component>\n\t\t</component>`,\n};\n","import { Guide } from 'ui.tour';\nimport { Type, Dom, Text } from 'main.core';\nimport { TourInterface } from 'crm.tour-manager';\n\nconst SPOTLIGHT_ID_PREFIX = 'rest_placement_spotlight';\nconst MODULE_ID = 'crm';\nconst USER_SEEN_OPTION = 'rest_placement_tour_viewed';\nconst REST_PLACEMENT_SLIDER_WIDTH = 800;\nconst CHECK_TARGET_CHANGE_INTERVAL = 1000;\n\ndeclare type AppContext = {\n\tapplicationId: string,\n\tplacementOptions: Object,\n\tadditionalComponentParam: Object,\n\tcloseCallback: Function,\n};\n\ndeclare type RestPlacementTourData = {\n\tid: string,\n\ttitle: string,\n\ttext: string,\n\tisCanShowTour: boolean,\n\tappContext: AppContext,\n};\n\nexport class Tour implements TourInterface\n{\n\t#id: ?string;\n\t#title: ?string;\n\t#text: ?string;\n\t#isCanShowTour: boolean;\n\t#appContext: AppContext;\n\t#isHidden: boolean = false;\n\n\t#currentTarget: ?HTMLElement = null;\n\t#guide: ?Guide = null;\n\t#spotlight: ?BX.SpotLight = null;\n\n\t#checkTargetChangeIntervalID: number = null;\n\n\tconstructor(data: RestPlacementTourData)\n\t{\n\t\tthis.#id = Type.isStringFilled(data.id) ? data.id : null;\n\t\tthis.#title = Type.isStringFilled(data.title) ? data.title : '';\n\t\tthis.#text = Type.isStringFilled(data.text) ? data.text : '';\n\t\tthis.#isCanShowTour = Type.isBoolean(data.isCanShowTour) ? data.isCanShowTour : false;\n\t\tthis.#appContext = Type.isPlainObject(data.appContext) ? data.appContext : {};\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#getSpotlight().show();\n\t\tthis.getGuide().showNextStep();\n\t\tthis.#prepareMoreDetailsLink();\n\n\t\tthis.#bindEvents();\n\t}\n\n\tcanShow(): boolean\n\t{\n\t\tlet isValidStringFields = true;\n\t\tconst stringFields = [this.#id, this.#title, this.#text];\n\t\tstringFields.forEach((field) => {\n\t\t\tif (!Type.isStringFilled(field))\n\t\t\t{\n\t\t\t\tisValidStringFields = false;\n\t\t\t}\n\t\t});\n\n\t\treturn this.#isCanShowTour\n\t\t\t&& isValidStringFields\n\t\t\t&& Type.isDomNode(this.#getTarget())\n\t\t;\n\t}\n\n\tgetGuide(): Guide\n\t{\n\t\tif (!this.#guide)\n\t\t{\n\t\t\tthis.#guide = new Guide({\n\t\t\t\tonEvents: true,\n\t\t\t\tsteps: [{\n\t\t\t\t\ttarget: this.#getTarget(),\n\t\t\t\t\ttitle: Text.encode(this.#title),\n\t\t\t\t\ttext: Text.encode(this.#text),\n\t\t\t\t\tposition: 'bottom',\n\t\t\t\t\trounded: true,\n\t\t\t\t\tlink: '##',\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\t\tBX.userOptions.save(MODULE_ID, USER_SEEN_OPTION, this.#id, true);\n\t\t\t\t\t\t\tthis.#getSpotlight().close();\n\n\t\t\t\t\t\t\tthis.#unbindEvents();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t}],\n\t\t\t});\n\t\t}\n\n\t\treturn this.#guide;\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tthis.currentTarget = this.#getTarget();\n\t\tthis.#checkTargetChangeIntervalID = setInterval(this.#onTargetChange.bind(this), CHECK_TARGET_CHANGE_INTERVAL);\n\t}\n\n\t#unbindEvents(): void\n\t{\n\t\tclearInterval(this.#checkTargetChangeIntervalID);\n\t}\n\n\t#onTargetChange(): void\n\t{\n\t\tconst possibleNewTarget = this.#getTarget();\n\n\t\tconst isTargetVisible = this.#isVisible(possibleNewTarget);\n\t\tconst isTargetChange = this.#currentTarget !== possibleNewTarget;\n\n\t\tif (isTargetVisible)\n\t\t{\n\t\t\tthis.#unHide();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#hide();\n\t\t}\n\n\t\tif (isTargetChange)\n\t\t{\n\t\t\tthis.#rebindTarget(possibleNewTarget);\n\t\t\tthis.#currentTarget = possibleNewTarget;\n\t\t}\n\t}\n\n\t#isVisible(element: HTMLElement): boolean\n\t{\n\t\treturn Boolean(\n\t\t\telement.offsetWidth\n\t\t\t|| element.offsetHeight\n\t\t\t|| element.getClientRects().length > 0,\n\t\t);\n\t}\n\n\t#hide(): void\n\t{\n\t\tif (this.#isHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst guidePopupContainer = this.getGuide().getPopup().getPopupContainer();\n\t\tDom.addClass(guidePopupContainer, '--hidden');\n\n\t\tthis.#isHidden = true;\n\t}\n\n\t#unHide(): void\n\t{\n\t\tif (!this.#isHidden)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst guidePopup = this.getGuide().getPopup();\n\t\tDom.removeClass(guidePopup.popupContainer, '--hidden');\n\t\tguidePopup.adjustPosition();\n\n\t\tthis.#isHidden = false;\n\t}\n\n\t#rebindTarget(newTarget: HTMLElement): void\n\t{\n\t\tthis.getGuide().getCurrentStep().setTarget(newTarget);\n\t\tthis.getGuide().showNextStep();\n\t\tthis.#prepareMoreDetailsLink();\n\n\t\tthis.#getSpotlight().setTargetElement(newTarget);\n\t}\n\n\t#getSpotlight(): BX.SpotLight\n\t{\n\t\tif (!this.#spotlight)\n\t\t{\n\t\t\tconst id = `${SPOTLIGHT_ID_PREFIX}_${this.#id}`;\n\n\t\t\tthis.#spotlight = new BX.SpotLight({\n\t\t\t\tid,\n\t\t\t\ttargetElement: this.#getTarget(),\n\t\t\t\tautoSave: 'no',\n\t\t\t\ttargetVertex: 'middle-center',\n\t\t\t\tzIndex: 200,\n\t\t\t});\n\t\t}\n\n\t\treturn this.#spotlight;\n\t}\n\n\t#getTarget(): HTMLElement\n\t{\n\t\tlet target = document.querySelector(`[data-id=\"${this.#id}\"]`);\n\n\t\tif (target?.offsetTop)\n\t\t{\n\t\t\ttarget = target.parentElement.nextElementSibling;\n\t\t}\n\n\t\treturn target;\n\t}\n\n\t#prepareMoreDetailsLink(): void\n\t{\n\t\tconst moreDetailsLink = this.getGuide().getLink();\n\t\tmoreDetailsLink.removeAttribute('href');\n\t\tmoreDetailsLink.removeAttribute('target');\n\n\t\tDom.style(moreDetailsLink, 'cursor', 'pointer');\n\n\t\tmoreDetailsLink.onclick = this.#openAppPlacementSlider.bind(this);\n\t}\n\n\t#openAppPlacementSlider(): void\n\t{\n\t\tconst { applicationId, placementOptions, additionalComponentParam, closeCallback } = this.#appContext;\n\n\t\tplacementOptions.newUserNotification = 'Y';\n\t\tplacementOptions.bx24_width = REST_PLACEMENT_SLIDER_WIDTH;\n\n\t\tBX.rest.AppLayout.openApplication(\n\t\t\tapplicationId,\n\t\t\tplacementOptions,\n\t\t\tadditionalComponentParam,\n\t\t\tcloseCallback,\n\t\t);\n\t}\n}\n","import Item from '../../item';\nimport { TourManager } from 'crm.tour-manager';\nimport { Tour } from './tour.js';\n\nexport default class Base extends Item\n{\n\tshowTour(): void\n\t{\n\t\tconst tour = new Tour({\n\t\t\tid: this.getSetting('id'),\n\t\t\ttitle: this.getSetting('newUserNotificationTitle'),\n\t\t\ttext: this.getSetting('newUserNotificationText'),\n\t\t\tisCanShowTour: (this.getSetting('isCanShowTour') && !BX.Crm.EntityEditor.getDefault().isNew()),\n\t\t\tappContext: {\n\t\t\t\tapplicationId: this.getSetting('appId', ''),\n\t\t\t\tplacementOptions: {\n\t\t\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\t\t\tentityId: this.getEntityId(),\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tTourManager.getInstance().registerWithLaunch(tour);\n\t}\n}\n","export class LayoutValidator\n{\n\tvalidate(layout: Object): Array\n\t{\n\t\treturn [];\n\t}\n}\n","import { Type } from 'main.core';\n\nexport default class PlacementInterfaceManager\n{\n\t#placementCode: string = null;\n\t#methodsList: Array = [];\n\t#handlers: Object = {};\n\tconstructor(placementCode: String, methodsList: Array)\n\t{\n\t\tthis.#placementCode = placementCode;\n\t\tthis.#methodsList = methodsList;\n\t\tthis.#initializeInterface();\n\t}\n\n\tstatic Instances = {};\n\tstatic getInstance(placementCode: String, methodsList: Array): PlacementInterfaceManager\n\t{\n\t\tif (!Object.hasOwn(PlacementInterfaceManager.Instances, placementCode))\n\t\t{\n\t\t\tPlacementInterfaceManager.Instances[placementCode] = new PlacementInterfaceManager(placementCode, methodsList);\n\t\t}\n\n\t\treturn PlacementInterfaceManager.Instances[placementCode];\n\t}\n\n\tregisterHandlers(placementId: string, handlers: Object): void\n\t{\n\t\tthis.#handlers[placementId] = handlers;\n\t}\n\n\t#initializeInterface(): void\n\t{\n\t\tconst PlacementInterface = BX.rest.AppLayout.initializePlacement(this.#placementCode);\n\t\tthis.#methodsList.forEach((methodName) => {\n\t\t\tPlacementInterface.prototype[methodName] = this.#interfaceCallback.bind(this, methodName);\n\t\t});\n\t}\n\n\t#interfaceCallback(): void\n\t{\n\t\tconst methodName = arguments[0] ?? null;\n\t\tconst placementId = arguments[3]?.params?.placementId ?? null;\n\t\tif (!methodName || !placementId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tconst placementHandlers = this.#handlers[placementId] ?? {};\n\t\tif (Type.isFunction(placementHandlers[methodName]))\n\t\t{\n\t\t\tplacementHandlers[methodName](arguments[1] ?? null, arguments[2] ?? null);\n\t\t}\n\t}\n}\n","import { Type, Tag, Dom, Runtime, ajax } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { BitrixVue } from 'ui.vue3';\nimport ButtonType from '../../components/resplacement/enums/button-type';\nimport { Layout } from '../../components/resplacement/layout';\nimport BlocksCollection from '../../components/resplacement/layout/blocks-collection';\nimport Base from './base';\nimport { LayoutValidator } from './layoutvalidator';\nimport EventType from '../../components/resplacement/enums/event-type';\nimport './restplacement.css';\nimport PlacementInterfaceManager from './placement-interface-manager';\n\nconst LAYOUT_EVENT_NAME = 'LayoutEvent';\nconst PRIMARY_BTN_CLICK_EVENT_NAME = 'PrimaryButtonClickEvent';\nconst SECONDARY_BTN_CLICK_EVENT_NAME = 'SecondaryButtonClickEvent';\nconst VALUE_CHANGE_EVENT_NAME = 'ValueChangeEvent';\nconst ENTITY_UPDATE_EVENT_NAME = 'entityUpdateEvent';\n\nexport default class WithLayout extends Base\n{\n\t#layoutComponent: ?Object = null;\n\t#layoutApp: ?Object = null;\n\t#activated: Boolean = false;\n\t#eventEmitter: EventEmitter = null;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.#eventEmitter = new EventEmitter();\n\t\tthis.#eventEmitter.setEventNamespace('RestPlacement');\n\t\tEventEmitter.subscribe('onCrmEntityUpdate', () => {\n\t\t\tthis.#eventEmitter.emit(ENTITY_UPDATE_EVENT_NAME, {});\n\t\t});\n\t}\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail --hidden\"></div>`;\n\t}\n\n\tinitializeLayout(): void\n\t{\n\t\tsuper.initializeLayout();\n\n\t\tthis.#layoutApp = BitrixVue.createApp(\n\t\t\tLayout,\n\t\t\t{\n\t\t\t\tid: String(this.getSetting('placementId', '')),\n\t\t\t\tappId: this.getSetting('appId', ''),\n\t\t\t\tonAction: this.#onLayoutAppAction.bind(this),\n\t\t\t},\n\t\t);\n\t\tthis.#layoutApp.component('BlocksCollection', BlocksCollection);\n\t\tthis.#layoutComponent = this.#layoutApp.mount(this.getContainer());\n\t}\n\n\tactivate(): void\n\t{\n\t\tsuper.activate();\n\t\tif (!this.#activated)\n\t\t{\n\t\t\tthis.#activated = true;\n\t\t\tthis.#initializeInterface();\n\t\t\tthis.#loadApp();\n\t\t}\n\t}\n\n\t#initializeInterface(): void\n\t{\n\t\tconst placementInterfaceManager = PlacementInterfaceManager.getInstance(\n\t\t\tthis.getSetting('placement', ''),\n\t\t\t[\n\t\t\t\t'setLayout',\n\t\t\t\t'setLayoutItemState',\n\t\t\t\t'bindLayoutEventCallback',\n\t\t\t\t'bindValueChangeCallback',\n\t\t\t\t'setPrimaryButtonState',\n\t\t\t\t'setSecondaryButtonState',\n\t\t\t\t'bindPrimaryButtonClickCallback',\n\t\t\t\t'bindSecondaryButtonClickCallback',\n\t\t\t\t'bindEntityUpdateCallback',\n\t\t\t\t'finish',\n\t\t\t\t'lock',\n\t\t\t\t'unlock',\n\t\t\t],\n\t\t);\n\n\t\tplacementInterfaceManager.registerHandlers(\n\t\t\tthis.getSetting('placementId', ''),\n\t\t\t{\n\t\t\t\tsetLayout: this.#setLayout.bind(this),\n\t\t\t\tsetLayoutItemState: this.#setLayoutItemState.bind(this),\n\t\t\t\tbindLayoutEventCallback: this.#bindEventCallback.bind(this, LAYOUT_EVENT_NAME),\n\t\t\t\tbindValueChangeCallback: this.#bindEventCallback.bind(this, VALUE_CHANGE_EVENT_NAME),\n\n\t\t\t\tsetPrimaryButtonState: this.#setButtonState.bind(this, ButtonType.PRIMARY),\n\t\t\t\tsetSecondaryButtonState: this.#setButtonState.bind(this, ButtonType.SECONDARY),\n\t\t\t\tbindPrimaryButtonClickCallback: this.#bindEventCallback.bind(this, PRIMARY_BTN_CLICK_EVENT_NAME),\n\t\t\t\tbindSecondaryButtonClickCallback: this.#bindEventCallback.bind(this, SECONDARY_BTN_CLICK_EVENT_NAME),\n\t\t\t\tbindEntityUpdateCallback: this.#bindEventCallback.bind(this, ENTITY_UPDATE_EVENT_NAME),\n\t\t\t\tfinish: this.#finish.bind(this),\n\t\t\t\tlock: this.setLocked.bind(this, true),\n\t\t\t\tunlock: this.setLocked.bind(this, false),\n\t\t\t},\n\t\t);\n\t}\n\n\t#setLayout(layout: Object, callback): void\n\t{\n\t\tconst validator = new LayoutValidator();\n\t\tconst errors = validator.validate(layout);\n\n\t\tif (errors.length > 0)\n\t\t{\n\t\t\tthis.#executeCallback(callback, { result: 'error', errors });\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#layoutComponent.showLoader(false);\n\t\t\tthis.#layoutComponent.setLayout(layout);\n\t\t\tthis.#executeCallback(callback, { result: 'success' });\n\t\t}\n\t}\n\n\t#setLayoutItemState(params: Object, callback): void\n\t{\n\t\tconst id = params.id ?? null;\n\t\tlet properties = params.properties ?? null;\n\t\tlet visible = params.visible ?? null;\n\n\t\tif (!Type.isStringFilled(id))\n\t\t{\n\t\t\tthis.#executeCallback(callback, { result: 'error', errors: ['Wrong id'] });\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst isCorrectVisible = Type.isBoolean(visible);\n\t\tconst isCorrectProps = Type.isPlainObject(properties);\n\n\t\tif (!isCorrectProps && !isCorrectVisible)\n\t\t{\n\t\t\tthis.#executeCallback(callback, { result: 'error', errors: ['Wrong state'] });\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!isCorrectVisible)\n\t\t{\n\t\t\tvisible = null;\n\t\t}\n\n\t\tif (!isCorrectProps)\n\t\t{\n\t\t\tproperties = null;\n\t\t}\n\n\t\tthis.#layoutComponent.setLayoutItemState(id, visible, properties, (result) => this.#executeCallback(callback, result));\n\t}\n\n\t#setButtonState(buttonId: string, params: ?Object, callback): void\n\t{\n\t\tif (!Type.isPlainObject(params) && !(Type.isArray(params) && params.length === 0) && !Type.isNull(params))\n\t\t{\n\t\t\tthis.#executeCallback(callback, { result: 'error', errors: ['Wrong params'] });\n\n\t\t\treturn;\n\t\t}\n\t\tlet state = params;\n\t\tif (Type.isArray(params) && params.length === 0)\n\t\t{\n\t\t\tstate = null;\n\t\t}\n\n\t\tthis.#layoutComponent.setButtonState(buttonId, state, (result) => this.#executeCallback(callback, result));\n\t}\n\n\t#bindEventCallback(eventName: string, params, callback): void\n\t{\n\t\tthis.#eventEmitter.subscribe(eventName, this.#executeEventCallback.bind(this, params, callback));\n\t}\n\n\t#finish(): void\n\t{\n\t\tthis.emitFinishEditEvent();\n\t}\n\n\t#executeEventCallback(params, callback, eventData: BaseEvent): void\n\t{\n\t\tconst data = eventData.getData();\n\t\tif (Type.isStringFilled(params)) // if need to call callback only for definite id\n\t\t{\n\t\t\tif ((data.id ?? '') === params)\n\t\t\t{\n\t\t\t\tthis.#executeCallback(callback, data);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#executeCallback(callback, data);\n\t}\n\n\t#onLayoutAppAction(eventData: ?Object)\n\t{\n\t\tconst event = eventData.event ?? null;\n\t\tconst value = eventData.value ?? null;\n\t\tif (event === EventType.FOOTER_BUTTON_CLICK && value === ButtonType.PRIMARY)\n\t\t{\n\t\t\tthis.#eventEmitter.emit(PRIMARY_BTN_CLICK_EVENT_NAME, {});\n\t\t}\n\n\t\tif (event === EventType.FOOTER_BUTTON_CLICK && value === ButtonType.SECONDARY)\n\t\t{\n\t\t\tthis.#eventEmitter.emit(SECONDARY_BTN_CLICK_EVENT_NAME, {});\n\t\t}\n\n\t\tif (event === EventType.LAYOUT_EVENT)\n\t\t{\n\t\t\tthis.#eventEmitter.emit(LAYOUT_EVENT_NAME, value);\n\t\t}\n\n\t\tif (event === EventType.VALUE_CHANGED_EVENT)\n\t\t{\n\t\t\tthis.#eventEmitter.emit(VALUE_CHANGE_EVENT_NAME, value);\n\t\t}\n\t}\n\n\t#executeCallback(callback, data): void\n\t{\n\t\tif (Type.isFunction(callback))\n\t\t{\n\t\t\tcallback(data);\n\t\t}\n\t}\n\n\t#loadApp(): void\n\t{\n\t\tajax.runComponentAction(\n\t\t\t'bitrix:app.layout',\n\t\t\t'getComponent',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tplacementId: this.getSetting('placementId', ''),\n\t\t\t\t\tplacementOptions: {\n\t\t\t\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\t\t\t\tentityId: this.getEntityId(),\n\t\t\t\t\t\tuseBuiltInInterface: 'Y',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t).then((response) => {\n\t\t\tif (!(response && response.data && response.data.componentResult))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst componentResult = response.data.componentResult;\n\n\t\t\tthis.appSid = componentResult.APP_SID;\n\n\t\t\tconst iframeNode = Tag.render`<div style=\"display: none; overflow: hidden;\"></div>`;\n\t\t\tDom.append(iframeNode, document.body);\n\t\t\tRuntime.html(iframeNode, response.data.html);\n\t\t});\n\t}\n}\n","import Base from './base.js';\n\nexport default class WithSlider extends Base\n{\n\t#interfaceInitialized: Boolean = false;\n\n\tshowSlider(): void\n\t{\n\t\tif (!this.#interfaceInitialized)\n\t\t{\n\t\t\tthis.#interfaceInitialized = true;\n\t\t\tthis.#initializeInterface();\n\t\t}\n\n\t\tconst appId = this.getSetting('appId', '');\n\n\t\tBX.rest.AppLayout.openApplication(\n\t\t\tappId,\n\t\t\t{\n\t\t\t\tID: this.getEntityId(),\n\t\t\t},\n\t\t\t{\n\t\t\t\tPLACEMENT: this.getSetting('placement', ''),\n\t\t\t\tPLACEMENT_ID: this.getSetting('placementId', ''),\n\t\t\t},\n\t\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n\n\t#initializeInterface()\n\t{\n\t\tif (top.BX.rest?.AppLayout)\n\t\t{\n\t\t\tconst PlacementInterface = top.BX.rest.AppLayout.initializePlacement(this.getSetting('placement', ''));\n\n\t\t\tif (!PlacementInterface.prototype.reloadData)\n\t\t\t{\n\t\t\t\tconst entityTypeId = this.getEntityTypeId();\n\t\t\t\tconst entityId = this.getEntityId();\n\n\t\t\t\tPlacementInterface.prototype.reloadData = function(params, cb)\n\t\t\t\t{\n\t\t\t\t\tBX.Crm.EntityEvent.fireUpdate(entityTypeId, entityId, '');\n\t\t\t\t\tcb();\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n}\n","import { Layout, SettingsModel } from 'calendar.sharing.interface';\nimport { Analytics } from 'calendar.sharing.analytics';\nimport { ConditionChecker, Types as SenderTypes } from 'crm.messagesender';\nimport { Dom, Event, Loc, Tag, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { MenuManager } from 'main.popup';\nimport { Button, ButtonColor, ButtonSize } from 'ui.buttons';\nimport { Guide } from 'ui.tour';\nimport { Loader } from 'main.loader';\nimport Context from '../context';\nimport WithEditor from './witheditor';\n\nconst DataLoadStatus = Object.freeze({\n\tloaded: 'loaded',\n\tnotLoaded: 'notLoaded',\n\tloading: 'loading',\n});\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class Sharing extends WithEditor\n{\n\t#layout: {\n\t\troot: HTMLElement,\n\t\tloader: HTMLElement,\n\t\twrap: Layout,\n\t\tmenuBarItem: HTMLElement,\n\t\tsendButton: HTMLElement,\n\t\tsettingsButton: HTMLElement,\n\t};\n\n\t#settingsModel: SettingsModel;\n\n\t/**\n\t * @override\n\t */\n\tinitialize(context: Context, settings: ?Object): void\n\t{\n\t\tthis.#layout = {};\n\n\t\tthis.dataLoadStatus = DataLoadStatus.notLoaded;\n\n\t\tsuper.initialize(context, settings);\n\n\t\tif (this.supportsLayout())\n\t\t{\n\t\t\tthis.#bindEvents();\n\t\t}\n\t}\n\n\t#bindEvents()\n\t{\n\t\tEventEmitter.subscribe('CalendarSharing:LinkCopied', ({ data: { hash } }) => this.onLinkCopied(hash));\n\t\tEventEmitter.subscribe('CalendarSharing:RuleUpdated', () => this.onRuleUpdated());\n\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', this.onContactsChangedHandler.bind(this));\n\t\tEvent.bind(window, 'beforeunload', () => this.#settingsModel?.save());\n\t}\n\n\t/**\n\t * @override\n\t */\n\tactivate()\n\t{\n\t\tif (this.supportsLayout())\n\t\t{\n\t\t\tsuper.activate();\n\t\t\tthis.#sendOpenFormAnalytics();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.UI?.InfoHelper?.show('limit_crm_calendar_free_slots');\n\t\t}\n\t}\n\n\t#sendOpenFormAnalytics()\n\t{\n\t\tAnalytics.sendPopupOpened(Analytics.contexts.crm);\n\t}\n\n\t/**\n\t * @override\n\t */\n\tdeactivate()\n\t{\n\t\tsuper.deactivate();\n\t\tthis.#layout.wrap?.reset();\n\t\tthis.setLocked(false);\n\t}\n\n\t/**\n\t * @override\n\t */\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn this.getSetting('isAvailable') && this.getEntityId() > 0;\n\t}\n\n\t/**\n\t * @override\n\t */\n\tonShow()\n\t{\n\t\tsuper.onShow();\n\n\t\tif (this.dataLoadStatus !== DataLoadStatus.notLoaded)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.loadData().then((isSuccess) => {\n\t\t\tif (isSuccess)\n\t\t\t{\n\t\t\t\tthis.#render();\n\t\t\t}\n\t\t});\n\t}\n\n\tasync loadData(): Promise\n\t{\n\t\tthis.dataLoadStatus = DataLoadStatus.loading;\n\t\tconst action = 'crm.api.timeline.calendar.sharing.getConfig';\n\t\tconst data = {\n\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\tentityId: this.getEntityId(),\n\t\t};\n\n\t\treturn BX.ajax.runAction(action, { data }).then((response) => {\n\t\t\tif (response?.data?.config)\n\t\t\t{\n\t\t\t\tthis.setConfig(response.data.config);\n\t\t\t\tthis.dataLoadStatus = DataLoadStatus.loaded;\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}, (error) => {\n\t\t\tconsole.error(error);\n\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tsetConfig(config)\n\t{\n\t\tthis.link = config.link;\n\t\tthis.isResponsible = config.isResponsible;\n\t\tthis.isNotificationsAvailable = config.isNotificationsAvailable;\n\t\tthis.dealContacts = config.contacts;\n\n\t\tthis.setCommunicationChannels(config.communicationChannels, config.selectedChannelId);\n\n\t\tthis.#settingsModel = new SettingsModel({\n\t\t\tcontext: 'crm',\n\t\t\tlinkHash: this.link.hash,\n\t\t\tsharingUrl: this.link.url,\n\t\t\tuserInfo: config.userInfo,\n\t\t\trule: this.link.rule,\n\t\t\tcalendarSettings: config.calendarSettings,\n\t\t\tcollapsed: false,\n\t\t});\n\t}\n\n\t/**\n\t * @override\n\t */\n\tsave(): Promise\n\t{\n\t\treturn this.#sendLinkAction();\n\t}\n\n\t/**\n\t * @override\n\t */\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis.#layout.menuBarItem = document.querySelector('.crm-entity-stream-section-menu [data-id=sharing]');\n\n\t\tthis.#layout.root = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-sharing crm-entity-stream-content-wait-detail --hidden\">\n\t\t\t\t${this.#renderLoader()}\n\t\t\t\t<div class=\"crm-entity-stream-calendar-sharing-btn-container\">\n\t\t\t\t\t${this.renderSendButton()}\n\t\t\t\t\t${this.renderCopyButton()}\n\t\t\t\t\t${this.renderCancelButton()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#layout.root;\n\t}\n\n\t#renderLoader(): HTMLElement\n\t{\n\t\tthis.#layout.loader = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-sharing-loader\"></div>\n\t\t`;\n\n\t\tnew Loader().show(this.#layout.loader);\n\n\t\treturn this.#layout.loader;\n\t}\n\n\t#render(): HTMLElement\n\t{\n\t\tthis.#layout.wrap = new Layout({\n\t\t\treadOnly: !this.isResponsible,\n\t\t\tsettingsModel: this.#settingsModel,\n\t\t\texternalIcon: this.createSettingsButton(),\n\t\t});\n\n\t\tconst wrapNode = this.#layout.wrap.render();\n\t\tthis.#layout.loader.replaceWith(wrapNode);\n\n\t\treturn wrapNode;\n\t}\n\n\tcreateSettingsButton()\n\t{\n\t\tthis.#layout.settingsButton = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-icon\"></div>\n\t\t`;\n\t\tthis.updateSettingsButton();\n\n\t\tEvent.bind(this.#layout.settingsButton, 'click', () => this.onSettingsButtonClick());\n\n\t\treturn this.#layout.settingsButton;\n\t}\n\n\tupdateSettingsButton()\n\t{\n\t\tif (this.hasContacts())\n\t\t{\n\t\t\tthis.#layout.settingsButton.style.display = '';\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#layout.settingsButton.style.display = 'none';\n\t\t}\n\t}\n\n\trenderSendButton()\n\t{\n\t\tthis.#layout.sendButton = new Button({\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_SEND_BUTTON_MSGVER_2'),\n\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\tround: true,\n\t\t\tonclick: () => this.onSendButtonClick(),\n\t\t}).render();\n\n\t\tthis._saveButton = this.#layout.sendButton;\n\n\t\treturn this.#layout.sendButton;\n\t}\n\n\trenderCopyButton()\n\t{\n\t\treturn new Button({\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_COPY_BUTTON'),\n\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\tcolor: ButtonColor.LIGHT_BORDER,\n\t\t\tround: true,\n\t\t\tonclick: () => this.copyLink(),\n\t\t}).render();\n\t}\n\n\trenderCancelButton()\n\t{\n\t\tconst cancelButton = new Button({\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CANCEL_BTN'),\n\t\t\tsize: ButtonSize.EXTRA_SMALL,\n\t\t\tcolor: ButtonColor.LINK,\n\t\t\tonclick: () => this.onCancelButtonClick(),\n\t\t}).render();\n\n\t\tthis._cancelButton = cancelButton;\n\n\t\treturn cancelButton;\n\t}\n\n\tonSettingsButtonClick()\n\t{\n\t\tthis.showSettingsPopup();\n\t}\n\n\tasync onSendButtonClick()\n\t{\n\t\tif (!this.hasDealContacts())\n\t\t{\n\t\t\tthis.showWarningNoContact();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isChannelAvailable(this.channel) && this.hasPhoneWithoutChannels())\n\t\t{\n\t\t\tthis.showWarningNoCommunicationChannels();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isChannelAvailable(this.channel) && this.hasEmailWithoutChannels())\n\t\t{\n\t\t\tthis.connectMailbox();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tthis.isNotificationsAvailable\n\t\t\t&& this.isChannelBitrix24(this.channel)\n\t\t)\n\t\t{\n\t\t\tconst isApproved = await this.isBitrix24Approved();\n\n\t\t\tif (isApproved)\n\t\t\t{\n\t\t\t\tthis.onSaveButtonClick();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.showWarningNoCommunicationChannels();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.onSaveButtonClick();\n\t}\n\n\tonLinkCopied(linkHash)\n\t{\n\t\tvoid this.#sendLinkAction({\n\t\t\tisActionCopy: true,\n\t\t\tlinkHash,\n\t\t});\n\t}\n\n\tonRuleUpdated()\n\t{\n\t\tthis.onRuleUpdatedAction();\n\t}\n\n\tshowSettingsPopup()\n\t{\n\t\tif (this.settingsMenu)\n\t\t{\n\t\t\tthis.settingsMenu.destroy();\n\t\t}\n\t\tthis.settingsMenu = this.getSettingsMenu();\n\t\tthis.settingsMenu.show();\n\t}\n\n\tisSettingsPopupShown()\n\t{\n\t\treturn this.settingsMenu?.popupWindow.isShown();\n\t}\n\n\tgetSettingsMenu()\n\t{\n\t\treturn MenuManager.create({\n\t\t\tid: 'crm-calendar-sharing-settings',\n\t\t\tbindElement: this.#layout.settingsButton,\n\t\t\titems: this.getSettingsMenuItems(),\n\t\t});\n\t}\n\n\tgetSettingsMenuItems()\n\t{\n\t\tconst items = [this.getSharingReceiverItem()];\n\n\t\tif (this.hasChannels())\n\t\t{\n\t\t\titems.push(this.getSharingChannelsItem());\n\t\t}\n\n\t\tif (this.isChannelAvailable(this.channel))\n\t\t{\n\t\t\titems.push(this.getSharingSenderItem());\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tgetSharingReceiverItem()\n\t{\n\t\treturn {\n\t\t\tid: 'sharing_receiver',\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_RECEIVER'),\n\t\t\titems: this.contacts.map((contact) => {\n\t\t\t\treturn this.getContactMenuItem(contact);\n\t\t\t})\n\t\t};\n\t}\n\n\tgetSharingChannelsItem()\n\t{\n\t\treturn {\n\t\t\tid: 'sharing_channels',\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_COMMUNICATION_CHANNELS'),\n\t\t\titems: this.channels.filter((channel) => channel.contacts.length > 0).map((channel) => {\n\t\t\t\treturn this.getChannelMenuItem(channel);\n\t\t\t}),\n\t\t}\n\t}\n\n\tgetSharingSenderItem()\n\t{\n\t\treturn {\n\t\t\tid: 'sharing_sender',\n\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_SENDER'),\n\t\t\titems: this.currentFromList.map((from) => {\n\t\t\t\treturn this.getFromMenuItem(from);\n\t\t\t}),\n\t\t};\n\t}\n\n\tgetContactMenuItem(contact)\n\t{\n\t\tconst isSelected = contact.entityId === this.contact.entityId && contact.entityTypeId === this.contact.entityTypeId && contact.value === this.contact.value;\n\t\tconst itemHtml = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check\">\n\t\t\t\t<div>${Text.encode(`${contact.name} (${contact.value})`)}</div>\n\t\t\t</div>\n\t\t`;\n\t\tcontact.check = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check-icon ${isSelected ? '--show' : ''}\"></div>\n\t\t`;\n\t\titemHtml.append(contact.check);\n\n\t\treturn {\n\t\t\thtml: itemHtml,\n\t\t\tonclick: () => {\n\t\t\t\tDom.removeClass(this.contact.check, '--show');\n\t\t\t\tDom.addClass(contact.check, '--show');\n\t\t\t\tthis.contact = contact;\n\t\t\t},\n\t\t};\n\t}\n\n\tgetChannelMenuItem(channel)\n\t{\n\t\tconst isSelected = channel.id === this.channel.id && this.isChannelAvailable(channel);\n\n\t\tconst itemHtml = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check\">\n\t\t\t\t<div>${Text.encode(channel.name)}</div>\n\t\t\t</div>\n\t\t`;\n\t\tchannel.check = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check-icon ${isSelected ? '--show' : ''}\"></div>\n\t\t`;\n\t\titemHtml.append(channel.check);\n\n\t\treturn {\n\t\t\thtml: itemHtml,\n\t\t\tclassName: (channel.fromList.length <= 0) ? 'crm-timeline-popup-menu-item-disabled menu-popup-no-icon' : '',\n\t\t\tonclick: () => {\n\t\t\t\tif (channel.fromList.length <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.connectMailbox();\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.channel.check, '--show');\n\t\t\t\tDom.addClass(channel.check, '--show');\n\t\t\t\tthis.setChannel(channel);\n\t\t\t},\n\t\t};\n\t}\n\n\tconnectMailbox()\n\t{\n\t\tBX.SidePanel.Instance.open('/mail/');\n\n\t\t//TODO: replace this workaround with subscribing for onPullEvent-mail \"mailbox_created\"\n\t\tconst onMailSliderClose = () => {\n\t\t\tconst previous = BX.SidePanel.Instance.openSliders[BX.SidePanel.Instance.getOpenSlidersCount() - 2];\n\t\t\tif (previous.url.includes('/crm/'))\n\t\t\t{\n\t\t\t\tthis.updateChannels();\n\n\t\t\t\ttop.BX.Event.EventEmitter.unsubscribe('SidePanel.Slider:onClose', onMailSliderClose);\n\t\t\t}\n\t\t};\n\n\t\ttop.BX.Event.EventEmitter.subscribe('SidePanel.Slider:onClose', onMailSliderClose);\n\t}\n\n\tupdateChannels()\n\t{\n\t\tconst data = {\n\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\tentityId: this.getEntityId(),\n\t\t};\n\n\t\tBX.ajax.runAction('crm.timeline.calendar.sharing.getConfig', { data })\n\t\t\t.then((response) => {\n\t\t\t\tthis.setCommunicationChannels(response.data.config.communicationChannels, this.channel.id);\n\t\t\t})\n\t\t;\n\t}\n\n\tgetFromMenuItem(from)\n\t{\n\t\tconst isSelected = from.id === this.currentFrom.id;\n\t\tconst itemHtml = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check\">\n\t\t\t\t<div>${Text.encode(from.name)}</div>\n\t\t\t</div>\n\t\t`;\n\t\tfrom.check = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-calendar-sharing-settings-check-icon ${isSelected ? '--show' : ''}\"></div>\n\t\t`;\n\t\titemHtml.append(from.check);\n\n\t\treturn {\n\t\t\thtml: itemHtml,\n\t\t\tonclick: () => {\n\t\t\t\tDom.removeClass(this.currentFrom.check, '--show');\n\t\t\t\tDom.addClass(from.check, '--show');\n\t\t\t\tthis.currentFrom = from;\n\t\t\t},\n\t\t};\n\t}\n\n\tshowWarningNoCommunicationChannels()\n\t{\n\t\tlet title;\n\t\tlet text;\n\n\t\tif (this.isNotificationsAvailable)\n\t\t{\n\t\t\ttitle = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TITLE');\n\t\t\ttext = `\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_1')}</div>\n\t\t\t\t</br>\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_2')}</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttitle = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CUSTOM_COMMUNICATION_CHANNELS_WARNING_TITLE');\n\t\t\ttext = `\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CUSTOM_COMMUNICATION_CHANNELS_WARNING_TITLE_1').replaceAll('/marketplace/', Loc.getMessage('MARKET_BASE_PATH'))}</div>\n\t\t\t\t</br>\n\t\t\t\t<div>${Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_COMMUNICATION_CHANNELS_WARNING_TEXT_2')}</div>\n\t\t\t`;\n\t\t}\n\n\t\tconst noCommunicationChannelsWarningGuide = this.getWarningGuide(title, text);\n\t\tnoCommunicationChannelsWarningGuide.showNextStep();\n\n\t\tconst guidePopup = noCommunicationChannelsWarningGuide.getPopup();\n\t\tconst guideContentContainer = guidePopup.getContentContainer();\n\t\tconst openConfigurationButton = guideContentContainer.querySelector('span[data-role=crm-timeline-calendar-sharing_open-configure-slots]');\n\t\topenConfigurationButton.addEventListener('click', () => {\n\t\t\tguidePopup.close();\n\t\t});\n\t}\n\n\tshowWarningNoContact()\n\t{\n\t\tconst title = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CONTACT_WARNING_TITLE');\n\t\tconst text = Loc.getMessage('CRM_TIMELINE_CALENDAR_SHARING_NO_CONTACT_WARNING_TEXT_V2');\n\t\tconst noContactWarningGuide = this.getWarningGuide(title, text);\n\t\tnoContactWarningGuide.showNextStep();\n\t}\n\n\tasync #sendLinkAction({ isActionCopy, linkHash } = {})\n\t{\n\t\tconst data = {\n\t\t\townerId: this.getEntityId(),\n\t\t\townerTypeId: this.getEntityTypeId(),\n\t\t\truleArray: this.#settingsModel.getRule().toArray(),\n\t\t\tmemberIds: this.#settingsModel.getMemberIds(),\n\t\t};\n\n\t\tlet action;\n\t\tif (!isActionCopy && this.isChannelAvailable(this.channel))\n\t\t{\n\t\t\taction = 'crm.api.timeline.calendar.sharing.sendLink';\n\t\t\tdata.contactId = this.contact.entityId || null;\n\t\t\tdata.contactTypeId = this.contact.entityTypeId || null;\n\t\t\tdata.channelId = this.channel.id || null;\n\t\t\tdata.senderId = this.currentFrom.id || null;\n\t\t}\n\t\telse\n\t\t{\n\t\t\taction = 'crm.api.timeline.calendar.sharing.onLinkCopied';\n\t\t\tdata.linkHash = linkHash ?? this.link.hash;\n\t\t}\n\n\t\treturn BX.ajax.runAction(action, { data }).then((response) => {\n\t\t\tif (response.data)\n\t\t\t{\n\t\t\t\tthis.emitFinishEditEvent();\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}, (error) => {\n\t\t\tconsole.error(error);\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tasync copyLink()\n\t{\n\t\tthis.setLocked(true);\n\t\tconst link = await this.#getSharingLink();\n\t\tthis.#layout.wrap.copyLink(link.url, link.hash);\n\t\tthis.#sendCopyAnalytics();\n\t}\n\n\t#sendCopyAnalytics()\n\t{\n\t\tconst params = {\n\t\t\tpeopleCount: this.#settingsModel.getMemberIds().length,\n\t\t\truleChanges: this.#settingsModel.getChanges(),\n\t\t};\n\n\t\tconst type = this.#settingsModel.getMemberIds().length === 1\n\t\t\t? Analytics.linkTypes.solo\n\t\t\t: Analytics.linkTypes.multiple\n\t\t;\n\n\t\tAnalytics.sendLinkCopied(this.#settingsModel.getContext(), type, params);\n\t}\n\n\tasync #getSharingLink(): Promise\n\t{\n\t\tif (this.#settingsModel.getMemberIds().length === 1)\n\t\t{\n\t\t\treturn {\n\t\t\t\turl: this.#settingsModel.getSharingUrl(),\n\t\t\t\thash: this.#settingsModel.getLinkHash(),\n\t\t\t};\n\t\t}\n\n\t\treturn await this.saveJointLink();\n\t}\n\n\tasync saveJointLink(): Promise\n\t{\n\t\tconst response = await BX.ajax.runAction('crm.api.timeline.calendar.sharing.generateJointSharingLink', {\n\t\t\tdata: {\n\t\t\t\tmemberIds: this.#settingsModel.getMemberIds(),\n\t\t\t\tentityId: this.getEntityId(),\n\t\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\t},\n\t\t});\n\n\t\treturn response.data;\n\t}\n\n\tonRuleUpdatedAction()\n\t{\n\t\treturn BX.ajax.runAction('crm.api.timeline.calendar.sharing.onRuleUpdated', {\n\t\t\tdata: {\n\t\t\t\tlinkHash: this.link.hash,\n\t\t\t\townerId: this.getEntityId(),\n\t\t\t\townerTypeId: this.getEntityTypeId(),\n\t\t\t},\n\t\t}).then((response) => {}, (error) => {\n\t\t\tconsole.error(error);\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tonContactsChangedHandler(event)\n\t{\n\t\tconst { item, current } = event.getData();\n\n\t\tconst isCurrentDeal = this.getEntityTypeId() === item?.entityTypeId && this.getEntityId() === item?.entityId;\n\t\tif (!isCurrentDeal || !Type.isArray(current) || !Type.isArray(this.channels))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst contacts = current.map((receiver) => ({\n\t\t\tid: receiver.address.id,\n\t\t\tentityId: receiver.addressSource.entityId,\n\t\t\tentityTypeId: receiver.addressSource.entityTypeId,\n\t\t\tname: receiver.addressSourceData?.title,\n\t\t\tvalue: receiver.address.value,\n\t\t\tvalueType: receiver.address.valueType,\n\t\t\ttypeId: receiver.address.typeId,\n\t\t}));\n\n\t\tthis.dealContacts = contacts;\n\n\t\tconst phoneContacts = contacts.filter((receiver) => receiver.typeId === 'PHONE');\n\t\tconst mailContacts = contacts.filter((receiver) => receiver.typeId === 'EMAIL');\n\n\t\tthis.channels.forEach((channel) => {\n\t\t\tif (channel.typeId === 'PHONE')\n\t\t\t{\n\t\t\t\tchannel.contacts = phoneContacts;\n\t\t\t}\n\t\t\tif (channel.typeId === 'EMAIL')\n\t\t\t{\n\t\t\t\tchannel.contacts = mailContacts;\n\t\t\t}\n\t\t});\n\n\t\tthis.setChannel(this.chooseChannel(this.channel?.id));\n\n\t\tthis.updateSettingsButton();\n\t\tif (this.isSettingsPopupShown())\n\t\t{\n\t\t\tthis.showSettingsPopup();\n\t\t}\n\t}\n\n\tsetContacts(contacts)\n\t{\n\t\tthis.contacts = contacts.filter(contact => contact.entityId && contact.entityTypeId && contact.value && contact.name)\n\t\t\t.sort((a, b) => a.entityId - b.entityId) // sort by id\n\t\t\t.sort((a, b) => a.entityTypeId - b.entityTypeId); // sort company last\n\n\t\tthis.contact = contacts.find((contact) => {\n\t\t\treturn contact.entityTypeId === this.contact?.entityTypeId && contact.entityId === this.contact?.entityId;\n\t\t}) ?? this.contacts[0];\n\t}\n\n\tsetCommunicationChannels(channels, selectedId)\n\t{\n\t\tthis.channels = channels || [];\n\n\t\tthis.setChannel(this.chooseChannel(selectedId));\n\t}\n\n\tchooseChannel(selectedId)\n\t{\n\t\tconst activeChannels = this.channels.filter((channel) => this.isChannelAvailable(channel));\n\n\t\tif (selectedId && Type.isArrayFilled(activeChannels))\n\t\t{\n\t\t\treturn activeChannels.find((channel) => channel.id === selectedId) ?? activeChannels[0];\n\t\t}\n\n\t\tconst availableChannels = this.channels.filter((channel) => channel.contacts.length > 0);\n\n\t\treturn availableChannels?.[0];\n\t}\n\n\tsetChannel(channel)\n\t{\n\t\tif (!channel)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.channel = channel;\n\n\t\tthis.setContacts(this.channel.contacts);\n\n\t\tif (this.channel && this.channel.fromList)\n\t\t{\n\t\t\tthis.currentFromList = this.channel.fromList;\n\t\t\tthis.currentFrom = this.channel.fromList[0];\n\t\t}\n\n\t\tif (this.settingsMenu)\n\t\t{\n\t\t\tfor (const item of this.getSettingsMenuItems())\n\t\t\t{\n\t\t\t\tthis.settingsMenu.removeMenuItem(item.id);\n\t\t\t\tthis.settingsMenu.addMenuItem(item);\n\t\t\t}\n\t\t}\n\t}\n\n\thasContacts()\n\t{\n\t\treturn Type.isArrayFilled(this.contacts);\n\t}\n\n\thasDealContacts()\n\t{\n\t\treturn Type.isArrayFilled(this.dealContacts);\n\t}\n\n\thasChannels()\n\t{\n\t\treturn Type.isArrayFilled(this.channels);\n\t}\n\n\thasPhoneWithoutChannels()\n\t{\n\t\tif (!this.channel)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst phoneContacts = this.dealContacts.filter((contact) => contact.typeId === 'PHONE');\n\t\tconst phoneChannels = this.channels.filter((channel) => channel.typeId === 'PHONE');\n\t\tconst channelUnavailable = this.channel.typeId === 'PHONE' && !this.isChannelAvailable(this.channel);\n\n\t\treturn Type.isArrayFilled(phoneContacts) && !Type.isArrayFilled(phoneChannels) || channelUnavailable;\n\t}\n\n\thasEmailWithoutChannels()\n\t{\n\t\tif (!this.channel)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tconst mailContacts = this.dealContacts.filter((contact) => contact.typeId === 'EMAIL');\n\t\tconst mailChannels = this.channels.filter((channel) => channel.typeId === 'EMAIL');\n\t\tconst channelUnavailable = this.channel.typeId === 'EMAIL' && !this.isChannelAvailable(this.channel);\n\n\t\treturn Type.isArrayFilled(mailContacts) && !Type.isArrayFilled(mailChannels) || channelUnavailable;\n\t}\n\n\tisChannelAvailable(channel)\n\t{\n\t\treturn Type.isArrayFilled(channel?.fromList) && Type.isArrayFilled(channel?.contacts);\n\t}\n\n\tisChannelBitrix24(channel)\n\t{\n\t\treturn channel.id === SenderTypes.bitrix24;\n\t}\n\n\tasync isBitrix24Approved()\n\t{\n\t\treturn await ConditionChecker.checkIsApproved({\n\t\t\tsenderType: SenderTypes.bitrix24,\n\t\t});\n\t}\n\n\tgetWarningGuide(title, text)\n\t{\n\t\tconst warningGuide = new Guide({\n\t\t\tsimpleMode: true,\n\t\t\tonEvents: true,\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: this.#layout.sendButton,\n\t\t\t\t\ttitle,\n\t\t\t\t\ttext,\n\t\t\t\t\tcondition: {\n\t\t\t\t\t\ttop: false,\n\t\t\t\t\t\tbottom: true,\n\t\t\t\t\t\tcolor: 'warning',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t\tconst guidePopup = warningGuide.getPopup();\n\t\tDom.addClass(guidePopup.popupContainer, 'crm-calendar-sharing-configure-slots-popup-ui-tour-animate');\n\t\tguidePopup.setWidth(430);\n\t\tconst guideContent = guidePopup.getContentContainer().firstElementChild;\n\t\tconst offsetFromCloseIcon = parseInt(getComputedStyle(guidePopup.closeIcon)['width']);\n\t\tconst existingPadding = parseInt(getComputedStyle(guideContent)['paddingRight']);\n\t\tguidePopup.getContentContainer().style.paddingRight = (offsetFromCloseIcon - existingPadding) + 'px';\n\t\tguidePopup.setAutoHide(true);\n\n\t\tguidePopup.subscribe('onAfterShow', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst arrowContainer = guidePopup.angle.element;\n\t\t\t\tconst arrow = arrowContainer.firstElementChild;\n\t\t\t\tarrow.style.border = '2px solid var(--ui-color-text-warning, #ffa900)';\n\n\t\t\t\tif (guidePopup.getContentContainer().getBoundingClientRect().top > this.#layout.sendButton.getBoundingClientRect().top)\n\t\t\t\t{\n\t\t\t\t\tconst condition = guidePopup.getContentContainer().querySelector('.ui-tour-popup-condition-bottom');\n\t\t\t\t\tcondition.className = 'ui-tour-popup-condition-top';\n\t\t\t\t\tarrowContainer.style.top = '-20px';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tarrowContainer.style.bottom = '-18px';\n\t\t\t\t}\n\t\t\t}, 0);\n\t\t});\n\n\t\treturn warningGuide;\n\t}\n}\n","import { type Receiver } from 'crm.messagesender';\nimport { type Backend, type Channel, type Editor as EditorType } from 'crm.messagesender.editor';\nimport { Runtime, Tag, Type } from 'main.core';\nimport { type BaseEvent, EventEmitter } from 'main.core.events';\nimport Item from '../../item';\n\nexport type ResendParams = {\n\tbackend: Backend,\n\tfromId: string,\n\tclient: {\n\t\tentityTypeId: number,\n\t\tentityId: number,\n\t\tvalue: string,\n\t},\n\ttext: string,\n\ttemplate: Object,\n};\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class Message extends Item\n{\n\t#isRendered: Boolean = false;\n\t#editor: EditorType = null;\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\tconst container = Tag.render`<div class=\"crm-entity-stream-content-new-detail --hidden\"></div>`;\n\t\tif (!this.#shouldRender())\n\t\t{\n\t\t\treturn container;\n\t\t}\n\n\t\tconst skeleton = new BX.Crm.MessageSender.Editor.Skeleton.Skeleton({\n\t\t\tlayout: this.getSetting('editor').layout,\n\t\t});\n\t\tskeleton.renderTo(container);\n\n\t\tfor (const tourString of this.getSetting('tours', []))\n\t\t{\n\t\t\tif (Type.isStringFilled(tourString))\n\t\t\t{\n\t\t\t\tRuntime.html(null, tourString);\n\t\t\t}\n\t\t}\n\n\t\treturn container;\n\t}\n\n\tonShow()\n\t{\n\t\tsuper.onShow();\n\n\t\tvoid this.#renderEditor();\n\t}\n\n\tasync #renderEditor(): Promise<void>\n\t{\n\t\tif (this.#isRendered)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#shouldRender())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { Editor } = await Runtime.loadExtension('crm.messagesender.editor');\n\n\t\t/** @see BX.Crm.MessageSender.Editor */\n\t\tthis.#editor = new Editor({\n\t\t\t...this.getSetting('editor'),\n\t\t\trenderTo: this.getContainer(),\n\t\t});\n\n\t\tawait this.#editor.render();\n\n\t\tthis.#isRendered = true;\n\t\tthis.#bindEvents();\n\n\t\tif (Type.isArrayFilled(this.#editor.getOptions().promoBanners))\n\t\t{\n\t\t\tEventEmitter.emit('BX.Crm.Timeline.MenuBar.Message:ShowNewChannelsAvailableTour', {\n\t\t\t\tstepId: 'menubar-message-new-channels-available',\n\t\t\t\ttarget: this.getContainer().querySelector('[data-role=\"header-left\"]'),\n\t\t\t});\n\t\t}\n\t}\n\n\t#shouldRender(): boolean\n\t{\n\t\treturn Boolean(this.getSetting('shouldRender'));\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', (event: BaseEvent) => {\n\t\t\tconst { item } = event.getData();\n\n\t\t\tif (this.getEntityTypeId() !== item?.entityTypeId || this.getEntityId() !== item?.entityId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvoid this.#editor?.reload();\n\t\t});\n\n\t\tEventEmitter.subscribeOnce('BX.Crm.Tour.EntityDetailsMenubar.Message:onConnectionsSliderClose', async () => {\n\t\t\tvoid this.#editor?.reload();\n\n\t\t\tconst analytics = this.getSetting('analytics', {});\n\n\t\t\tconst { Builder, Dictionary, sendData } = await Runtime.loadExtension('crm.integration.analytics', 'ui.analytics');\n\n\t\t\tconst event = (new Builder.Communication.Channel.ConnectEvent())\n\t\t\t\t.setSection(analytics.c_section)\n\t\t\t\t.setSubSection(analytics.c_sub_section)\n\t\t\t\t.setElement(Dictionary.ELEMENT_AHA_MOMENT)\n\t\t\t;\n\n\t\t\tsendData(event.buildData());\n\t\t});\n\n\t\tconst hide = () => {\n\t\t\tsetTimeout(() => this.emitFinishEditEvent(), 50);\n\t\t};\n\n\t\tthis.#editor.subscribe('onSendSuccess', hide);\n\t\tthis.#editor.subscribe('onCancel', hide);\n\t}\n\n\t/**\n\t * @public\n\t */\n\tshouldConfirmStateChange(params: ResendParams): boolean\n\t{\n\t\tif (!this.#isRendered)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst { text, template } = params;\n\n\t\tconst state = this.#editor?.getState() ?? {};\n\n\t\tconst isCustomTextChannel = Type.isNil(state.notificationTemplate) && Type.isNil(state.template);\n\t\tconst isWantCustomTextChannel = Type.isNil(template) && Type.isStringFilled(text);\n\n\t\tif (!isCustomTextChannel && isWantCustomTextChannel)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (isCustomTextChannel && isWantCustomTextChannel)\n\t\t{\n\t\t\treturn Type.isStringFilled(state.message.body.trim()) && state.message.body.trim() !== text.trim();\n\t\t}\n\n\t\tif (isCustomTextChannel && !isWantCustomTextChannel)\n\t\t{\n\t\t\treturn Type.isStringFilled(state.message.body.trim());\n\t\t}\n\n\t\tif (!isCustomTextChannel && !isWantCustomTextChannel)\n\t\t{\n\t\t\tconst templateId = template?.ORIGINAL_ID;\n\t\t\tconst filledPlaceholders = template?.FILLED_PLACEHOLDERS ?? [];\n\n\t\t\tconst currentTemplateId = state.template?.ORIGINAL_ID;\n\t\t\tconst currentFilledPlaceholders = state.template?.FILLED_PLACEHOLDERS ?? [];\n\n\t\t\treturn Type.isNumber(templateId) && templateId > 0\n\t\t\t\t&& Type.isNumber(currentTemplateId) && currentTemplateId > 0\n\t\t\t\t&& (\n\t\t\t\t\ttemplateId !== currentTemplateId\n\t\t\t\t\t|| JSON.stringify(filledPlaceholders) !== JSON.stringify(currentFilledPlaceholders)\n\t\t\t\t);\n\t\t}\n\n\t\tthrow new Error('Unexpected state in BX.Crm.Timeline.MenuBar.Item.Message.#shouldConfirmStateChange');\n\t}\n\n\t/**\n\t * @public\n\t */\n\tasync tryToResend(params: ResendParams): Promise<void>\n\t{\n\t\tawait this.#renderEditor();\n\n\t\tthis.#setState(params);\n\n\t\tconst editorState = this.#editor.getState();\n\t\tconst analytics = this.getSetting('analytics', {});\n\n\t\tconst { Builder, sendData } = await Runtime.loadExtension('crm.integration.analytics', 'ui.analytics');\n\n\t\tconst eventData = Builder.Communication.Editor.ResendEvent.createDefault(editorState.channel?.id)\n\t\t\t.setSection(analytics.c_section)\n\t\t\t.setSubSection(analytics.c_sub_section)\n\t\t\t.setTemplateId(editorState.template?.ORIGINAL_ID)\n\t\t\t.buildData()\n\t\t;\n\n\t\tsendData(eventData);\n\t}\n\n\t#setState(params: ResendParams): void\n\t{\n\t\tif (!this.#isRendered)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (Type.isStringFilled(params?.backend?.senderCode) && Type.isStringFilled(params?.backend.id))\n\t\t{\n\t\t\tconst chan = this.#editor.getOptions().channels.find((candidate: Channel) => {\n\t\t\t\tconst isSameBackend = (\n\t\t\t\t\tcandidate.backend.senderCode === params.backend.senderCode\n\t\t\t\t\t&& candidate.backend.id === params.backend.id\n\t\t\t\t);\n\n\t\t\t\tif (Type.isStringFilled(params?.fromId))\n\t\t\t\t{\n\t\t\t\t\treturn isSameBackend && candidate.fromList.some((from) => from.id === params.fromId);\n\t\t\t\t}\n\n\t\t\t\treturn isSameBackend;\n\t\t\t});\n\n\t\t\tif (chan)\n\t\t\t{\n\t\t\t\tthis.#editor.setChannel(chan.id);\n\n\t\t\t\tif (Type.isStringFilled(params?.fromId))\n\t\t\t\t{\n\t\t\t\t\tthis.#editor.setFrom(params.fromId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (Type.isPlainObject(params?.client))\n\t\t{\n\t\t\tconst chan = this.#editor.getState().channel;\n\n\t\t\tconst receiver: ?Receiver = chan.toList.find((candidate: Receiver) => {\n\t\t\t\treturn candidate.addressSource.entityTypeId === params.client.entityTypeId\n\t\t\t\t\t&& candidate.addressSource.entityId === params.client.entityId\n\t\t\t\t\t&& candidate.address.value === params.client.value\n\t\t\t\t;\n\t\t\t});\n\n\t\t\tif (receiver)\n\t\t\t{\n\t\t\t\tthis.#editor.setTo(receiver.address.id);\n\t\t\t}\n\t\t}\n\n\t\tif (Type.isStringFilled(params?.text))\n\t\t{\n\t\t\tthis.#editor.setMessageText(params.text);\n\t\t}\n\n\t\tif (Type.isPlainObject(params?.template))\n\t\t{\n\t\t\tthis.#editor.setTemplate(params.template.ORIGINAL_ID);\n\n\t\t\tfor (const placeholder of (params.template?.FILLED_PLACEHOLDERS ?? []))\n\t\t\t{\n\t\t\t\tthis.#editor.setFilledPlaceholder(placeholder);\n\t\t\t}\n\t\t}\n\t}\n}\n","/* eslint-disable */\n\nimport { Editor, FilledPlaceholder } from 'crm.template.editor';\nimport { ajax as Ajax, Dom, Loc, Tag, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport WithEditor from './../witheditor';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class Sms extends WithEditor\n{\n\ttplEditor: ?Editor;\n\tplaceholders: string[];\n\tfilledPlaceholders: FilledPlaceholder[];\n\n\tisFetchedConfig: boolean = false;\n\tfetchConfigPromise: ?Promise = null;\n\n\t/**\n\t * @override\n\t * */\n\tcreateLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail crm-entity-stream-content-sms --skeleton --hidden\"></div>`;\n\t}\n\n\t#renderEditor(): HTMLElement\n\t{\n\t\tconst config = this.getSetting('smsConfig', {})\n\t\tconst enableSalesCenter = BX.prop.getBoolean(config, 'isSalescenterEnabled', false);\n\t\tconst enableDocuments = BX.prop.getBoolean(config, 'isDocumentsEnabled', false);\n\t\tconst enableFiles = this.getSetting('enableFiles', false);\n\n\t\tthis._saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round\" >${Loc.getMessage('CRM_TIMELINE_SEND')}</button>`;\n\t\tthis._cancelButton = Tag.render`<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>`;\n\t\tthis._input = Tag.render`<textarea class=\"crm-entity-stream-content-new-sms-textarea\" rows='1' placeholder=\"${Loc.getMessage('CRM_TIMELINE_SMS_ENTER_MESSAGE')}\"></textarea>`;\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-buttons-container\">\n\t\t\t${enableSalesCenter ? Tag.render`\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-button\" data-role=\"salescenter-starter\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-salescenter-icon\"></div>\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SALESCENTER_STARTER')}</div>\n\t\t\t\t</div>` : null}\n\t\t\t${enableFiles ? Tag.render`\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-button\" data-role=\"sms-file-selector\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-icon\"></div>\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SEND_FILE')}</div>\n\t\t\t\t</div>` : null}\n\t\t\t${enableDocuments ? Tag.render`\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-button\" data-role=\"sms-document-selector\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-document-icon\"></div>\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SEND_DOCUMENT')}</div>\n\t\t\t\t</div>` : null}\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-detail-toggle\" data-role=\"sms-detail-switcher\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_DETAILS')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"crm-entity-stream-content-sms-conditions-container hidden\" data-role=\"sms-detail\">\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-conditions\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-conditions-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_SENDER')}\n\t\t\t\t\t\t<a href=\"#\" data-role=\"sender-selector\">sender</a><span data-role=\"from-container\">${Loc.getMessage('CRM_TIMELINE_SMS_FROM')}\n\t\t\t\t\t\t<a data-role=\"from-selector\" href=\"#\">from_number</a></span>\n\t\t\t\t\t\t<span data-role=\"client-container\"> ${Loc.getMessage('CRM_TIMELINE_SMS_TO')}\n\t\t\t\t\t\t<a data-role=\"client-selector\" href=\"#\">client_caption</a> <a data-role=\"to-selector\" href=\"#\">to_number</a></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t${this._input}\n\t\t\t${this.#renderTemplatesContainer()}\n\t\t\t${this.#renderFilesSelector()}\n\n\t\t\t<div class=\"crm-entity-stream-content-new-sms-btn-container\">\n\t\t\t\t${this._saveButton}\n\t\t\t\t${this._cancelButton}\n\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-symbol-counter\" data-role=\"message-length-counter-wrap\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_SYMBOLS')}\n\t\t\t\t\t<span class=\"crm-entity-stream-content-sms-symbol-counter-number\" data-role=\"message-length-counter\" data-length-max=\"200\">0</span>\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_SYMBOLS_FROM')}\n\t\t\t\t\t<span class=\"crm-entity-stream-content-sms-symbol-counter-number\">200</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderSetupText(): HTMLElement\n\t{\n\t\tconst enableSalesCenter = BX.prop.getBoolean(this.getSetting('smsConfig', {}), 'isSalescenterEnabled', false);\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-conditions-container\">\n\t\t\t<div class=\"crm-entity-stream-content-sms-conditions\">\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-conditions-text\">\n\t\t\t\t\t<strong>${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_TEXT_1')}</strong><br>\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_TEXT_2')}<br>\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_TEXT_3_MSGVER_1')}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"crm-entity-stream-content-new-sms-btn-container\">\n\t\t\t<a href=\"#\" data-role=\"sender-selector\" target=\"_top\" class=\"crm-entity-stream-content-new-sms-connect-link\">${Loc.getMessage('CRM_TIMELINE_SMS_MANAGE_URL')}</a>\n\t\t\t${enableSalesCenter ? Tag.render`<div class=\"crm-entity-stream-content-sms-salescenter-container-absolute\" data-role=\"salescenter-starter\">\n\t<div class=\"crm-entity-stream-content-sms-salescenter-icon\"></div>\n\t<div class=\"crm-entity-stream-content-sms-button-text\">${Loc.getMessage('CRM_TIMELINE_SMS_SALESCENTER_STARTER')}</div>\n</div>` : null}\n\t\t</div>`;\n\t}\n\n\t#renderTemplatesContainer(): HTMLElement\n\t{\n\t\tthis._templatesContainer = Tag.render`<div class=\"crm-entity-stream-content-new-sms-templates\">\n\t\t\t\t<div class=\"ui-ctl-label-text\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_TEMPLATE_LIST_TITLE')}<span class=\"ui-hint\" data-role=\"hint\"><span class=\"ui-hint-icon\"></span></span>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\" data-role=\"template-selector\">\n\t\t\t\t\t<div class=\"ui-ctl-element\" data-role=\"template-title\"></div>\n\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-new-sms-preview\" data-role=\"preview\"></div>\n\t\t\t</div>`;\n\n\t\treturn this._templatesContainer;\n\t}\n\n\t#renderFilesSelector(): ?HTMLElement\n\t{\n\t\tconst config = this.getSetting('smsConfig', {});\n\n\t\tconst showFiles = this.getSetting('showFiles', false);\n\t\tconst enableFilesExternalLink = BX.prop.getBoolean(config, 'isFilesExternalLinkEnabled', false);\n\n\t\tif (enableFilesExternalLink)\n\t\t{\n\t\t\tconst fileInputPrefix = 'crm-' + this.getEntityTypeId() + '-' + this.getEntityId();\n\t\t\tconst fileInputName = fileInputPrefix + '-sms-files';\n\t\t\tconst fileUploaderInputName = fileInputPrefix + '-sms-files-uploader';\n\t\t\tconst fileUploaderZoneId = 'diskuf-selectdialog-' + fileInputPrefix;\n\n\t\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-file-uploader-zone\" data-role=\"sms-file-upload-zone\" data-node-id=\"${fileInputPrefix}\">\n\t\t\t\t<div id=\"${fileUploaderZoneId}\" class=\"diskuf-files-entity diskuf-selectdialog bx-disk\">\n\t\t\t\t\t<div class=\"diskuf-files-block checklist-loader-files\">\n\t\t\t\t\t\t<div class=\"diskuf-placeholder\">\n\t\t\t\t\t\t\t<table class=\"files-list\">\n\t\t\t\t\t\t\t\t<tbody class=\"diskuf-placeholder-tbody\"></tbody>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"diskuf-extended\">\n\t\t\t\t\t\t<input type=\"hidden\" name=\"${fileInputName}[]\" value=\"\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"diskuf-extended-item\">\n\t\t\t\t\t\t<label for=\"${fileUploaderInputName}\" data-role=\"sms-file-upload-label\"></label>\n\t\t\t\t\t\t<input class=\"diskuf-fileUploader\" id=\"${fileUploaderInputName}\" type=\"file\" data-role=\"sms-file-upload-input\" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"diskuf-extended-item\">\n\t\t\t\t\t\t<span class=\"diskuf-selector-link\" data-role=\"sms-file-selector-bitrix\">\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\t\tif (showFiles)\n\t\t{\n\t\t\treturn Tag.render`<div class=\"crm-entity-stream-content-sms-file-external-link-popup\" data-role=\"sms-file-external-link-disabled\">\n\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-container\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-inner\">\n\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-desc\">\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-img\">\n\t\t\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-img-lock\"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-content-sms-file-external-link-popup-limit-desc-text\">\n\t\t\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_FILE_EXTERNAL_LINK_FEATURE')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tdoInitialize()\n\t{\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\n\t\tthis._senderId = null;\n\t\tthis._from = null;\n\t\tthis._commEntityTypeId = null;\n\t\tthis._commEntityId = null;\n\t\tthis._to = null;\n\n\t\tthis._fromList = [];\n\t\tthis._toList = [];\n\t\tthis._defaults = {};\n\t\tthis._communications = [];\n\n\t\tthis._menu = null;\n\t\tthis._isMenuShown = false;\n\t\tthis._shownMenuId = null;\n\t\tthis._documentSelector = null;\n\t\tthis._source = null;\n\n\t\tthis._paymentId = null;\n\t\tthis._shipmentId = null;\n\n\t\tthis._compilationProductIds = [];\n\n\t\tthis._templateId = null;\n\t\tthis.templateOriginalId = null;\n\t\tthis._templateFieldHintNode = null;\n\t\tthis._templateSelectorNode = null;\n\t\tthis._templateTemplateTitleNode = null;\n\t\tthis._templatePreviewNode = null;\n\t\tthis._templateSelectorMenuId = 'CrmTimelineSmsEditorTemplateSelector';\n\t\tthis._templateFieldHintHandler = BX.delegate(this.onTemplateHintIconClick, this);\n\t\tthis._templateSeletorClickHandler = BX.delegate(this.onTemplateSelectClick, this);\n\t\tthis._selectTemplateHandler = BX.delegate(this.onSelectTemplate, this);\n\n\t\tthis._serviceUrl = BX.util.remove_url_param(\n\t\t\tthis.getSetting(\"serviceUrl\", \"\"),\n\t\t\t['sessid', 'site']\n\t\t);\n\n\t\tconst config = this.getSetting( 'smsConfig', {});\n\n\t\tthis._canUse = BX.prop.getBoolean(config, \"canUse\", false);\n\t\tthis._canSendMessage = BX.prop.getBoolean(config, \"canSendMessage\", false);\n\t\tthis._manageUrl = BX.prop.getString(config, \"manageUrl\", '');\n\t\tthis._senders = BX.prop.getArray(config, \"senders\", []);\n\t\tthis._defaults = BX.prop.getObject(config, \"defaults\", {senderId:null,from:null});\n\t\tthis._communications = BX.prop.getArray(config, \"communications\", []);\n\t\tthis._isSalescenterEnabled = BX.prop.getBoolean(config, \"isSalescenterEnabled\", false);\n\t\tthis._isDocumentsEnabled = BX.prop.getBoolean(config, \"isDocumentsEnabled\", false);\n\t\tif(this._isDocumentsEnabled)\n\t\t{\n\t\t\tthis._documentsProvider = BX.prop.getString(config, \"documentsProvider\", '');\n\t\t\tthis._documentsValue = BX.prop.getString(config, \"documentsValue\", '');\n\t\t}\n\t\tthis._isFilesEnabled = BX.prop.getBoolean(config, \"isFilesEnabled\", false);\n\t\tif(this._isFilesEnabled)\n\t\t{\n\t\t\tthis._diskUrls = BX.prop.getObject(config, \"diskUrls\");\n\t\t\tthis._isFilesExternalLinkEnabled = BX.prop.getBoolean(config, \"isFilesExternalLinkEnabled\", true);\n\t\t}\n\n\t\tthis._senderSelectorNode = this.getContainer().querySelector('[data-role=\"sender-selector\"]');\n\t\tthis._fromContainerNode = this.getContainer().querySelector('[data-role=\"from-container\"]');\n\t\tthis._fromSelectorNode = this.getContainer().querySelector('[data-role=\"from-selector\"]');\n\t\tthis._clientContainerNode = this.getContainer().querySelector('[data-role=\"client-container\"]');\n\t\tthis._clientSelectorNode = this.getContainer().querySelector('[data-role=\"client-selector\"]');\n\t\tthis._toSelectorNode = this.getContainer().querySelector('[data-role=\"to-selector\"]');\n\t\tthis._messageLengthCounterWrapperNode = this.getContainer().querySelector('[data-role=\"message-length-counter-wrap\"]');\n\t\tthis._messageLengthCounterNode = this.getContainer().querySelector('[data-role=\"message-length-counter\"]');\n\t\tthis._salescenterStarter = this.getContainer().querySelector('[data-role=\"salescenter-starter\"]');\n\t\tthis._smsDetailSwitcher = this.getContainer().querySelector('[data-role=\"sms-detail-switcher\"]');\n\t\tthis._smsDetail = this.getContainer().querySelector('[data-role=\"sms-detail\"]');\n\t\tthis._documentSelectorButton = this.getContainer().querySelector('[data-role=\"sms-document-selector\"]');\n\t\tthis._fileSelectorButton = this.getContainer().querySelector('[data-role=\"sms-file-selector\"]');\n\t\tthis._fileUploadZone = this.getContainer().querySelector('[data-role=\"sms-file-upload-zone\"]');\n\t\tthis._fileUploadLabel = this.getContainer().querySelector('[data-role=\"sms-file-upload-label\"]');\n\t\tthis._fileSelectorBitrix = this.getContainer().querySelector('[data-role=\"sms-file-selector-bitrix\"]');\n\t\tthis._fileExternalLinkDisabledContent = this.getContainer().querySelector('[data-role=\"sms-file-external-link-disabled\"]');\n\n\t\tif (this._templatesContainer)\n\t\t{\n\t\t\tthis._templateFieldHintNode = this._templatesContainer.querySelector('[data-role=\"hint\"]');\n\t\t\tthis._templateSelectorNode = this._templatesContainer.querySelector('[data-role=\"template-selector\"]');\n\t\t\tthis._templateTemplateTitleNode = this._templatesContainer.querySelector('[data-role=\"template-title\"]');\n\t\t\tthis._templatePreviewNode = this._templatesContainer.querySelector('[data-role=\"preview\"]');\n\t\t}\n\t\tif (this._templateFieldHintNode)\n\t\t{\n\t\t\tBX.bind(this._templateFieldHintNode, \"click\", this._templateFieldHintHandler);\n\t\t}\n\t\tif (this._templateSelectorNode)\n\t\t{\n\t\t\tBX.bind(this._templateSelectorNode, \"click\", this._templateSeletorClickHandler);\n\t\t}\n\n\t\tif (this._canUse && this._senders.length > 0)\n\t\t{\n\t\t\tthis.initSenderSelector();\n\t\t}\n\t\tif (this._canUse && this._canSendMessage)\n\t\t{\n\t\t\tthis.initDetailSwitcher();\n\t\t\tthis.initFromSelector();\n\t\t\tthis.initClientContainer();\n\t\t\tthis.initClientSelector();\n\t\t\tthis.initToSelector();\n\t\t\tthis.initMessageLengthCounter();\n\t\t\tthis.setMessageLengthCounter();\n\t\t\tif(this._isDocumentsEnabled)\n\t\t\t{\n\t\t\t\tthis.initDocumentSelector();\n\t\t\t}\n\t\t\tif(this._isFilesEnabled)\n\t\t\t{\n\t\t\t\tthis.initFileSelector();\n\t\t\t}\n\t\t}\n\n\t\tthis.#subscribeToReceiversChanges();\n\n\t\tif(this._isSalescenterEnabled)\n\t\t{\n\t\t\tthis.initSalescenterApplication();\n\t\t}\n\t}\n\n\tinitDetailSwitcher()\n\t{\n\t\tBX.bind(this._smsDetailSwitcher, 'click', function()\n\t\t{\n\t\t\tif(this._smsDetail.classList.contains('hidden'))\n\t\t\t{\n\t\t\t\tthis._smsDetail.classList.remove('hidden');\n\t\t\t\tthis._smsDetailSwitcher.innerText = BX.message('CRM_TIMELINE_COLLAPSE');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._smsDetail.classList.add('hidden');\n\t\t\t\tthis._smsDetailSwitcher.innerText = BX.message('CRM_TIMELINE_DETAILS');\n\t\t\t}\n\t\t}.bind(this));\n\t}\n\n\tinitSenderSelector()\n\t{\n\t\tconst defaultSenderId = this._defaults.senderId;\n\t\tlet defaultSender = this._senders[0].canUse ? this._senders[0] : null;\n\t\tlet restSender = null;\n\t\tconst menuItems = [];\n\t\tconst handler = this.onSenderSelectorClick.bind(this);\n\n\t\tfor (let i = 0; i < this._senders.length; ++i)\n\t\t{\n\t\t\tif (this._senders[i].canUse && this._senders[i].fromList.length && (this._senders[i].id === defaultSenderId || !defaultSender))\n\t\t\t{\n\t\t\t\tdefaultSender = this._senders[i];\n\t\t\t}\n\n\t\t\tif (this._senders[i].id === 'rest')\n\t\t\t{\n\t\t\t\trestSender = this._senders[i];\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tmenuItems.push({\n\t\t\t\ttext: this._senders[i].name,\n\t\t\t\tsender: this._senders[i],\n\t\t\t\tonclick: handler,\n\t\t\t\tclassName: (!this._senders[i].canUse || !this._senders[i].fromList.length)\n\t\t\t\t\t? 'crm-timeline-popup-menu-item-disabled menu-popup-no-icon' : ''\n\t\t\t});\n\t\t}\n\n\t\tif (restSender)\n\t\t{\n\t\t\tif (restSender.fromList.length > 0)\n\t\t\t{\n\t\t\t\tmenuItems.push({delimiter: true});\n\t\t\t\tfor (let i = 0; i < restSender.fromList.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\ttext: restSender.fromList[i].name,\n\t\t\t\t\t\tsender: restSender,\n\t\t\t\t\t\tfrom: restSender.fromList[i],\n\t\t\t\t\t\tonclick: handler\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tmenuItems.push({delimiter: true}, {\n\t\t\t\ttext: BX.message('CRM_TIMELINE_SMS_REST_MARKETPLACE'),\n\t\t\t\thref: BX.message('MARKET_BASE_PATH') + 'category/crm_robot_sms/',\n\t\t\t\ttarget: '_blank'\n\t\t\t});\n\t\t}\n\n\t\tif (defaultSender)\n\t\t{\n\t\t\tthis.setSender(defaultSender);\n\t\t}\n\n\t\tBX.bind(this._senderSelectorNode, 'click', this.openMenu.bind(this, 'sender', this._senderSelectorNode, menuItems));\n\t}\n\n\tonSenderSelectorClick(e, item)\n\t{\n\t\tif (item.sender)\n\t\t{\n\t\t\tif (!item.sender.canUse || !item.sender.fromList.length)\n\t\t\t{\n\t\t\t\tconst url = BX.Uri.addParam(item.sender.manageUrl, {'IFRAME': 'Y'});\n\t\t\t\tconst slider = BX.SidePanel.Instance.getTopSlider();\n\t\t\t\tconst options = {\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonClose: function () {\n\t\t\t\t\t\t\tif (slider)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tslider.reload();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonCloseComplete: function () {\n\t\t\t\t\t\t\tif (!slider)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdocument.location.reload();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tif (item.sender.id === 'ednaru')\n\t\t\t\t{\n\t\t\t\t\toptions.width = 700;\n\t\t\t\t}\n\t\t\t\tBX.SidePanel.Instance.open(url, options);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.setSender(item.sender, true);\n\t\t\tconst from = item.from ? item.from : item.sender.fromList[0];\n\t\t\tthis.setFrom(from, true);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetSender(sender, setAsDefault)\n\t{\n\t\tthis._senderId = sender.id;\n\t\tthis._fromList = sender.fromList;\n\t\tthis._senderSelectorNode.textContent = sender.shortName ? sender.shortName : sender.name;\n\n\t\tthis._templateId = null;\n\t\tthis.templateOriginalId = null;\n\t\tif (sender.isTemplatesBased)\n\t\t{\n\t\t\tthis.showNode(this._templatesContainer);\n\t\t\tthis.hideNode(this._messageLengthCounterWrapperNode);\n\t\t\tthis.hideNode(this._fileSelectorButton);\n\t\t\tthis.hideNode(this._documentSelectorButton);\n\t\t\tthis.hideNode(this._input);\n\t\t\tthis.toggleTemplateSelectAvailability();\n\t\t\tthis.toggleSaveButton();\n\t\t\tthis._hideButtonsOnBlur = false;\n\t\t\tthis.onFocus();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.hideNode(this._templatesContainer);\n\t\t\tthis.showNode(this._messageLengthCounterWrapperNode);\n\t\t\tthis.showNode(this._fileSelectorButton);\n\t\t\tthis.showNode(this._documentSelectorButton);\n\t\t\tthis.showNode(this._input);\n\t\t\tthis.setMessageLengthCounter();\n\t\t\tthis._hideButtonsOnBlur = true;\n\t\t}\n\n\t\tconst visualFn = sender.id === 'rest' ? 'hide' : 'show';\n\t\tBX[visualFn](this._fromContainerNode);\n\n\t\tif (setAsDefault)\n\t\t{\n\t\t\tBX.userOptions.save(\"crm\", \"sms_manager_editor\", \"senderId\", this._senderId);\n\t\t}\n\t}\n\n\tinitFromSelector()\n\t{\n\t\tif (this._fromList.length > 0)\n\t\t{\n\t\t\tconst defaultFromId = this._defaults.from || this._fromList[0].id;\n\t\t\tlet defaultFrom = null;\n\t\t\tfor (let i = 0; i < this._fromList.length; ++i)\n\t\t\t{\n\t\t\t\tif (this._fromList[i].id === defaultFromId || !defaultFrom)\n\t\t\t\t{\n\t\t\t\t\tdefaultFrom = this._fromList[i];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (defaultFrom)\n\t\t\t{\n\t\t\t\tthis.setFrom(defaultFrom);\n\t\t\t}\n\t\t}\n\n\t\tBX.bind(this._fromSelectorNode, 'click', this.onFromSelectorClick.bind(this));\n\t}\n\n\tonFromSelectorClick(e)\n\t{\n\t\tconst menuItems = [];\n\t\tconst handler = this.onFromSelectorItemClick.bind(this);\n\n\t\tfor (let i = 0; i < this._fromList.length; ++i)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: this._fromList[i].name,\n\t\t\t\tfrom: this._fromList[i],\n\t\t\t\tonclick: handler\n\t\t\t});\n\t\t}\n\n\t\tthis.openMenu('from_'+this._senderId, this._fromSelectorNode, menuItems, e);\n\t}\n\n\tonFromSelectorItemClick(e, item)\n\t{\n\t\tif (item.from)\n\t\t{\n\t\t\tthis.setFrom(item.from, true);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetFrom(from, setAsDefault)\n\t{\n\t\tthis._from = from.id;\n\n\t\tif (this._senderId === 'rest')\n\t\t{\n\t\t\tthis._senderSelectorNode.textContent = from.name;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis._fromSelectorNode.textContent = from.name;\n\t\t}\n\n\t\tif (setAsDefault)\n\t\t{\n\t\t\tBX.userOptions.save(\"crm\", \"sms_manager_editor\", \"from\", this._from);\n\t\t}\n\t}\n\n\t#subscribeToReceiversChanges(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', (event: BaseEvent) => {\n\t\t\tconst { item, current } = event.getData();\n\n\t\t\tif (this.getEntityTypeId() !== item?.entityTypeId || this.getEntityId() !== item?.entityId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!Type.isArray(current))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst phoneReceivers = current.filter(receiver => receiver.address.typeId === 'PHONE');\n\n\t\t\tconst newCommunications: {[addressSourceHash: string]: Object} = {};\n\t\t\tfor (const receiver of phoneReceivers)\n\t\t\t{\n\t\t\t\tlet communication = newCommunications[receiver.addressSource.hash];\n\n\t\t\t\tif (!communication)\n\t\t\t\t{\n\t\t\t\t\tcommunication = {\n\t\t\t\t\t\tentityTypeId: receiver.addressSource.entityTypeId,\n\t\t\t\t\t\tentityTypeName: BX.CrmEntityType.resolveName(receiver.addressSource.entityTypeId),\n\t\t\t\t\t\tentityId: receiver.addressSource.entityId,\n\t\t\t\t\t\tcaption: receiver.addressSourceData?.title,\n\t\t\t\t\t\tphones: [],\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tcommunication.phones.push({\n\t\t\t\t\ttype: receiver.address.typeId,\n\t\t\t\t\tvalue: receiver.address.value,\n\t\t\t\t\tvalueFormatted: receiver.address.valueFormatted,\n\t\t\t\t});\n\n\t\t\t\tnewCommunications[receiver.addressSource.hash] = communication;\n\t\t\t}\n\n\t\t\tthis._communications = Object.values(newCommunications);\n\n\t\t\tconst oldSelectedClient = this._communications.find(communication => {\n\t\t\t\treturn communication.entityTypeId === this._commEntityTypeId && communication.entityId === this._commEntityId;\n\t\t\t});\n\t\t\tthis.setClient(oldSelectedClient ?? this._communications[0]);\n\n\t\t\tthis.initClientContainer();\n\t\t});\n\t}\n\n\tinitClientContainer()\n\t{\n\t\tif (!Type.isDomNode(this._clientContainerNode))\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (this._communications.length === 0)\n\t\t{\n\t\t\tBX.hide(this._clientContainerNode);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.show(this._clientContainerNode);\n\t\t}\n\t}\n\n\tinitClientSelector()\n\t{\n\t\tconst defaultClient = this._communications[0];\n\t\tif (defaultClient)\n\t\t{\n\t\t\tthis.setClient(defaultClient);\n\t\t}\n\n\t\tconst handler = this.onClientSelectorClick.bind(this);\n\n\t\tBX.bind(this._clientSelectorNode, 'click', (event) => {\n\t\t\tconst menuItems = [];\n\n\t\t\tfor (const communication of this._communications)\n\t\t\t{\n\t\t\t\tmenuItems.push({\n\t\t\t\t\ttext: communication.caption,\n\t\t\t\t\tclient: communication,\n\t\t\t\t\tonclick: handler,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.openMenu('comm', this._clientSelectorNode, menuItems, event);\n\t\t});\n\t}\n\n\tonClientSelectorClick(e, item)\n\t{\n\t\tif (item.client)\n\t\t{\n\t\t\tthis.setClient(item.client);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetClient(client: ?Object)\n\t{\n\t\tthis._commEntityTypeId = client?.entityTypeId;\n\t\tthis._commEntityId = client?.entityId;\n\t\tif (Type.isDomNode(this._clientSelectorNode))\n\t\t{\n\t\t\tthis._clientSelectorNode.textContent = client?.caption ?? '';\n\t\t}\n\t\tthis._toList = client?.phones ?? [];\n\t\tthis.setTo(client?.phones[0] ?? {});\n\t}\n\n\tinitToSelector()\n\t{\n\t\tBX.bind(this._toSelectorNode, 'click', this.onToSelectorClick.bind(this));\n\t}\n\n\tonToSelectorClick(e)\n\t{\n\t\tconst menuItems = [];\n\t\tconst handler = this.onToSelectorItemClick.bind(this);\n\n\t\tfor (let i = 0; i < this._toList.length; ++i)\n\t\t{\n\t\t\tmenuItems.push({\n\t\t\t\ttext: this._toList[i].valueFormatted || this._toList[i].value,\n\t\t\t\tto: this._toList[i],\n\t\t\t\tonclick: handler\n\t\t\t});\n\t\t}\n\n\t\tthis.openMenu('to_'+this._commEntityTypeId+'_'+this._commEntityId, this._toSelectorNode, menuItems, e);\n\t}\n\n\tonToSelectorItemClick(e, item)\n\t{\n\t\tif (item.to)\n\t\t{\n\t\t\tthis.setTo(item.to);\n\t\t}\n\t\tthis._menu.close();\n\t}\n\n\tsetTo(to: ?Object)\n\t{\n\t\tthis._to = to?.value;\n\t\tif (Type.isDomNode(this._toSelectorNode))\n\t\t{\n\t\t\tthis._toSelectorNode.textContent = (to?.valueFormatted || to?.value) ?? '';\n\t\t}\n\t}\n\n\topenMenu(menuId, bindElement, menuItems, e)\n\t{\n\t\tif (this._shownMenuId === menuId)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._shownMenuId !== null && this._menu)\n\t\t{\n\t\t\tthis._menu.close();\n\t\t\tthis._shownMenuId = null;\n\t\t}\n\n\t\tBX.PopupMenu.show(\n\t\t\tthis._id + menuId,\n\t\t\tbindElement,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tcacheable: false,\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 36,\n\t\t\t\tangle: { position: \"top\", offset: 0 },\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupClose: BX.delegate(this.onMenuClose, this)\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis._menu = BX.PopupMenu.currentItem;\n\t\te.preventDefault();\n\t}\n\n\tonMenuClose()\n\t{\n\t\tthis._shownMenuId = null;\n\t\tthis._menu = null;\n\t}\n\n\tinitMessageLengthCounter()\n\t{\n\t\tthis._messageLengthMax = parseInt(this._messageLengthCounterNode.getAttribute('data-length-max'));\n\t\tBX.bind(this._input, 'keyup', this.setMessageLengthCounter.bind(this));\n\t\tBX.bind(this._input, 'cut', this.setMessageLengthCounterDelayed.bind(this));\n\t\tBX.bind(this._input, 'paste', this.setMessageLengthCounterDelayed.bind(this));\n\t}\n\n\tsetMessageLengthCounterDelayed()\n\t{\n\t\tsetTimeout(this.setMessageLengthCounter.bind(this), 0);\n\t}\n\n\tsetMessageLengthCounter()\n\t{\n\t\tconst length = this._input.value.length;\n\t\tthis._messageLengthCounterNode.textContent = length;\n\n\t\tconst classFn = length >= this._messageLengthMax ? 'addClass' : 'removeClass';\n\t\tBX[classFn](this._messageLengthCounterNode, 'crm-entity-stream-content-sms-symbol-counter-number-overhead');\n\n\t\tthis.toggleSaveButton();\n\t}\n\n\ttoggleSaveButton(): void\n\t{\n\t\tconst sender = this.getSelectedSender();\n\t\tlet enabled;\n\n\t\tif (!sender || !sender.isTemplatesBased)\n\t\t{\n\t\t\tenabled = this._input.value.length > 0;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tenabled = !!this._templateId;\n\t\t}\n\n\t\tif (enabled)\n\t\t{\n\t\t\tBX.removeClass(this._saveButton, 'ui-btn-disabled');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.addClass(this._saveButton, 'ui-btn-disabled');\n\t\t}\n\t}\n\n\tsave()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\n\t\tconst { text, templateId } = this.getSendData();\n\n\t\tif (text === '')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._communications.length)\n\t\t{\n\t\t\talert(BX.message('CRM_TIMELINE_SMS_ERROR_NO_COMMUNICATIONS'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._isRequestRunning || this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isRequestRunning = true;\n\t\tthis._isLocked = true;\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tBX.ajax({\n\t\t\t\turl: this.getSendUrl(),\n\t\t\t\tmethod: 'POST',\n\t\t\t\tdataType: 'json',\n\t\t\t\tdata: {\n\t\t\t\t\tsite: BX.message('SITE_ID'),\n\t\t\t\t\tsessid: BX.bitrix_sessid(),\n\t\t\t\t\tsource: this._source,\n\t\t\t\t\tACTION: 'SAVE_SMS_MESSAGE',\n\t\t\t\t\tSENDER_ID: this._senderId,\n\t\t\t\t\tMESSAGE_FROM: this._from,\n\t\t\t\t\tMESSAGE_TO: this._to,\n\t\t\t\t\tMESSAGE_BODY: text,\n\t\t\t\t\tMESSAGE_TEMPLATE: templateId,\n\t\t\t\t\tMESSAGE_TEMPLATE_WITH_PLACEHOLDER: this.isCurrentSenderTemplateHasPlaceholders(),\n\t\t\t\t\tOWNER_TYPE_ID: this._ownerTypeId,\n\t\t\t\t\tOWNER_ID: this._ownerId,\n\t\t\t\t\tTO_ENTITY_TYPE_ID: this._commEntityTypeId,\n\t\t\t\t\tTO_ENTITY_ID: this._commEntityId,\n\t\t\t\t\tPAYMENT_ID: this._paymentId,\n\t\t\t\t\tSHIPMENT_ID: this._shipmentId,\n\t\t\t\t\tCOMPILATION_PRODUCT_IDS: this._compilationProductIds,\n\t\t\t\t},\n\t\t\t\tonsuccess: () => {\n\t\t\t\t\tthis.onSaveSuccess();\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\tonfailure: () => {\n\t\t\t\t\tthis.onSaveFailure();\n\t\t\t\t\treject();\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSendData(): ?Object\n\t{\n\t\tif (!this.isFetchedConfig)\n\t\t{\n\t\t\treturn {\n\t\t\t\ttext: '',\n\t\t\t\ttemplateId: null,\n\t\t\t};\n\t\t}\n\n\t\tlet text = '';\n\t\tlet templateId = null;\n\n\t\tif (this.isCurrentSenderIsTemplatesBased())\n\t\t{\n\t\t\tconst template = this.getSelectedTemplate();\n\t\t\tif (!template)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (this.tplEditor)\n\t\t\t{\n\t\t\t\tconst tplEditorData = this.tplEditor.getData();\n\t\t\t\tif (Type.isPlainObject(tplEditorData))\n\t\t\t\t{\n\t\t\t\t\ttext = tplEditorData.body; // @todo check position: body or preview\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (text === '')\n\t\t\t{\n\t\t\t\ttext = template.PREVIEW;\n\t\t\t}\n\n\t\t\ttemplateId = template.ID;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttext = this._input.value;\n\t\t}\n\n\t\treturn {\n\t\t\ttext,\n\t\t\ttemplateId,\n\t\t}\n\t}\n\n\tgetSendUrl(): string\n\t{\n\t\treturn BX.util.add_url_param(\n\t\t\tthis._serviceUrl,\n\t\t\t{\n\t\t\t\t'action': 'save_sms_message',\n\t\t\t\t'sender': this._senderId,\n\t\t\t}\n\t\t);\n\t}\n\n\tgetSelectedSender(): ?Object\n\t{\n\t\treturn this._senders.find((sender) => sender.id === this._senderId);\n\t}\n\n\tcancel()\n\t{\n\t\tthis._input.value = \"\";\n\t\tthis.setMessageLengthCounter();\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.release();\n\t}\n\n\tonSaveSuccess(data)\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\n\t\tconst error = BX.prop.getString(data, \"ERROR\", \"\");\n\t\tif(error !== \"\")\n\t\t{\n\t\t\talert(error);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._input.value = \"\";\n\t\tthis.setMessageLengthCounter();\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.emitFinishEditEvent();\n\t\tthis.release();\n\t}\n\n\tonSaveFailure()\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\t}\n\n\tinitSalescenterApplication()\n\t{\n\t\tBX.bind(this._salescenterStarter, 'click', this.startSalescenterApplication.bind(this));\n\t}\n\n\tstartSalescenterApplication()\n\t{\n\t\tconst isSalescenterToolEnabled = BX.prop.getBoolean(this.getSetting('smsConfig', {}), 'isSalescenterToolEnabled', false);\n\t\tif (!isSalescenterToolEnabled)\n\t\t{\n\t\t\tBX.loadExt('salescenter.tool-availability-manager').then(() =>\n\t\t\t{\n\t\t\t\tBX.Salescenter.ToolAvailabilityManager.openSalescenterToolDisabledSlider();\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\tBX.loadExt('salescenter.manager').then(function()\n\t\t{\n\t\t\tBX.Salescenter.Manager.openApplication({\n\t\t\t\tdisableSendButton: this._canSendMessage ? '' : 'y',\n\t\t\t\tcontext: 'sms',\n\t\t\t\townerTypeId: this._ownerTypeId,\n\t\t\t\townerId: this._ownerId,\n\t\t\t\tmode: this._ownerTypeId === BX.CrmEntityType.enumeration.deal ? 'payment_delivery' : 'payment',\n\t\t\t\tst: {\n\t\t\t\t\ttool: 'crm',\n\t\t\t\t\tcategory: 'payments',\n\t\t\t\t\tevent: 'payment_create_click',\n\t\t\t\t\tc_section: 'crm_sms',\n\t\t\t\t\tc_sub_section: 'web',\n\t\t\t\t\ttype: 'delivery_payment',\n\t\t\t\t}\n\t\t\t}).then(function(result)\n\t\t\t{\n\t\t\t\tif(result && result.get('action'))\n\t\t\t\t{\n\t\t\t\t\tif(result.get('action') === 'sendPage' && result.get('page') && result.get('page').url)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._input.focus();\n\t\t\t\t\t\tthis._input.value = this._input.value + result.get('page').name + ' ' + result.get('page').url;\n\t\t\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\t\t}\n\t\t\t\t\telse if (result.get('action') === 'sendPayment' && result.get('order'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._input.focus();\n\t\t\t\t\t\tthis._input.value = this._input.value + result.get('order').title;\n\t\t\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\t\t\tthis._source = 'order';\n\t\t\t\t\t\tthis._paymentId = result.get('order').paymentId;\n\t\t\t\t\t\tthis._shipmentId = result.get('order').shipmentId;\n\t\t\t\t\t}\n\t\t\t\t\telse if(result.get('action') === 'sendCompilation' && result.get('compilation'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._input.focus();\n\t\t\t\t\t\tthis._input.value = this._input.value + result.get('compilation').title;\n\t\t\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\t\t\tthis._source = 'deal';\n\t\t\t\t\t\tthis._compilationProductIds = result.get('compilation').productIds;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t}.bind(this));\n\t}\n\n\tinitDocumentSelector()\n\t{\n\t\tBX.bind(this._documentSelectorButton, 'click', this.onDocumentSelectorClick.bind(this));\n\t}\n\n\tonDocumentSelectorClick()\n\t{\n\t\tif(!this._documentSelector)\n\t\t{\n\t\t\tBX.loadExt('documentgenerator.selector').then(function()\n\t\t\t{\n\t\t\t\tthis._documentSelector = new BX.DocumentGenerator.Selector.Menu({\n\t\t\t\t\tnode: this._documentSelectorButton,\n\t\t\t\t\tmoduleId: 'crm',\n\t\t\t\t\tprovider: this._documentsProvider,\n\t\t\t\t\tvalue: this._documentsValue,\n\t\t\t\t\tanalyticsLabelPrefix: 'crmTimelineSmsEditor'\n\t\t\t\t});\n\t\t\t\tthis.selectPublicUrl();\n\t\t\t}.bind(this));\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.selectPublicUrl();\n\t\t}\n\t}\n\n\tselectPublicUrl()\n\t{\n\t\tif(!this._documentSelector)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis._documentSelector.show().then(function(object)\n\t\t{\n\t\t\tif(object instanceof BX.DocumentGenerator.Selector.Template)\n\t\t\t{\n\t\t\t\tthis._documentSelector.createDocument(object).then(function(document)\n\t\t\t\t{\n\t\t\t\t\tthis.pasteDocumentUrl(document);\n\t\t\t\t}.bind(this)).catch(function(error)\n\t\t\t\t{\n\t\t\t\t\tconsole.error(error);\n\t\t\t\t}.bind(this));\n\t\t\t}\n\t\t\telse if(object instanceof BX.DocumentGenerator.Selector.Document)\n\t\t\t{\n\t\t\t\tthis.pasteDocumentUrl(object);\n\t\t\t}\n\t\t}.bind(this)).catch(function(error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}.bind(this));\n\t}\n\n\tpasteDocumentUrl(document)\n\t{\n\t\tthis._documentSelector.getDocumentPublicUrl(document).then(function(publicUrl)\n\t\t{\n\t\t\tthis._input.focus();\n\t\t\tthis._input.value = this._input.value + ' ' + document.getTitle() + ' ' + publicUrl;\n\t\t\tthis.setMessageLengthCounter();\n\t\t\tthis._source = 'document';\n\t\t}.bind(this)).catch(function(error)\n\t\t{\n\t\t\tconsole.error(error);\n\t\t}.bind(this));\n\t}\n\n\tinitFileSelector()\n\t{\n\t\tBX.bind(this._fileSelectorButton, 'click', this.onFileSelectorClick.bind(this));\n\t}\n\n\tcloseFileSelector()\n\t{\n\t\tBX.PopupMenu.destroy('sms-file-selector');\n\t}\n\n\tonFileSelectorClick()\n\t{\n\t\tBX.PopupMenu.show('sms-file-selector', this._fileSelectorButton, [\n\t\t\t{\n\t\t\t\ttext: BX.message('CRM_TIMELINE_SMS_UPLOAD_FILE'),\n\t\t\t\tonclick: this.uploadFile.bind(this),\n\t\t\t\tclassName: this._isFilesExternalLinkEnabled ? '' : 'crm-entity-stream-content-sms-menu-item-with-lock'\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: BX.message('CRM_TIMELINE_SMS_FIND_FILE'),\n\t\t\t\tonclick: this.findFile.bind(this),\n\t\t\t\tclassName: this._isFilesExternalLinkEnabled ? '' : 'crm-entity-stream-content-sms-menu-item-with-lock'\n\t\t\t}\n\t\t])\n\t}\n\n\tgetFileUploadInput()\n\t{\n\t\treturn document.getElementById(this._fileUploadLabel.getAttribute('for'));\n\t}\n\n\tuploadFile()\n\t{\n\t\tthis.closeFileSelector();\n\t\tif(this._isFilesExternalLinkEnabled)\n\t\t{\n\t\t\tthis.initDiskUF();\n\t\t\tBX.fireEvent(this.getFileUploadInput(), 'click');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showFilesExternalLinkFeaturePopup();\n\t\t}\n\t}\n\n\tfindFile()\n\t{\n\t\tthis.closeFileSelector();\n\t\tif(this._isFilesExternalLinkEnabled)\n\t\t{\n\t\t\tthis.initDiskUF();\n\t\t\tBX.fireEvent(this._fileSelectorBitrix, 'click');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.showFilesExternalLinkFeaturePopup();\n\t\t}\n\t}\n\n\tgetLoader()\n\t{\n\t\tif(!this.loader)\n\t\t{\n\t\t\tthis.loader = new BX.Loader(\n\t\t\t\t{\n\t\t\t\t\tsize: 50\n\t\t\t\t});\n\t\t}\n\n\t\treturn this.loader;\n\t}\n\n\tshowLoader(node)\n\t{\n\t\tif(node && !this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().show(node);\n\t\t}\n\t}\n\n\thideLoader()\n\t{\n\t\tif(this.getLoader().isShown())\n\t\t{\n\t\t\tthis.getLoader().hide();\n\t\t}\n\t}\n\n\tinitDiskUF()\n\t{\n\t\tif(this.isDiskFileUploaderInited || !this._isFilesEnabled)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.isDiskFileUploaderInited = true;\n\t\tBX.addCustomEvent(this._fileUploadZone, 'OnFileUploadSuccess', this.OnFileUploadSuccess.bind(this));\n\t\tBX.addCustomEvent(this._fileUploadZone, 'DiskDLoadFormControllerInit', function(uf)\n\t\t{\n\t\t\tuf._onUploadProgress = function()\n\t\t\t{\n\t\t\t\tthis.showLoader(this._fileSelectorButton.parentNode.parentNode);\n\t\t\t}.bind(this);\n\t\t}.bind(this));\n\n\t\tBX.Disk.UF.add({\n\t\t\tUID: this._fileUploadZone.getAttribute('data-node-id'),\n\t\t\tcontrolName: this._fileUploadLabel.getAttribute('for'),\n\t\t\thideSelectDialog: false,\n\t\t\turlSelect: this._diskUrls.urlSelect,\n\t\t\turlRenameFile: this._diskUrls.urlRenameFile,\n\t\t\turlDeleteFile: this._diskUrls.urlDeleteFile,\n\t\t\turlUpload: this._diskUrls.urlUpload\n\t\t});\n\n\t\tBX.onCustomEvent(\n\t\t\tthis._fileUploadZone,\n\t\t\t'DiskLoadFormController',\n\t\t\t['show']\n\t\t);\n\t}\n\n\tOnFileUploadSuccess(fileResult, uf, file, uploaderFile)\n\t{\n\t\tthis.hideLoader();\n\t\tconst diskFileId = parseInt(fileResult.element_id.replace('n', ''));\n\t\tconst fileName = fileResult.element_name;\n\t\tthis.pasteFileUrl(diskFileId, fileName);\n\t}\n\n\tpasteFileUrl(diskFileId, fileName)\n\t{\n\t\tthis.showLoader(this._fileSelectorButton.parentNode.parentNode);\n\t\tBX.ajax.runAction('disk.file.generateExternalLink', {\n\t\t\tanalyticsLabel: 'crmTimelineSmsEditorGetFilePublicUrl',\n\t\t\tdata: {\n\t\t\t\tfileId: diskFileId\n\t\t\t}\n\t\t}).then(function(response)\n\t\t{\n\t\t\tthis.hideLoader();\n\t\t\tif(response.data.externalLink && response.data.externalLink.link)\n\t\t\t{\n\t\t\t\tthis._input.focus();\n\t\t\t\tthis._input.value = this._input.value + ' ' + fileName + ' ' + response.data.externalLink.link;\n\t\t\t\tthis.setMessageLengthCounter();\n\t\t\t\tthis._source = 'file';\n\t\t\t}\n\t\t}.bind(this)).catch(function(response)\n\t\t{\n\t\t\tconsole.error(response.errors.pop().message);\n\t\t});\n\t}\n\n\tgetFeaturePopup(content)\n\t{\n\t\tif(this.featurePopup != null)\n\t\t{\n\t\t\treturn this.featurePopup;\n\t\t}\n\t\tthis.featurePopup = new BX.PopupWindow('bx-popup-crm-sms-editor-feature-popup', null, {\n\t\t\tzIndex: 200,\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tcloseIcon: true,\n\t\t\toverlay : true,\n\t\t\tevents : {\n\t\t\t\tonPopupDestroy : function()\n\t\t\t\t{\n\t\t\t\t\tthis.featurePopup = null;\n\t\t\t\t}.bind(this)\n\t\t\t},\n\t\t\tcontent : content,\n\t\t\tcontentColor: 'white'\n\t\t});\n\n\t\treturn this.featurePopup;\n\t}\n\n\tshowFilesExternalLinkFeaturePopup()\n\t{\n\t\tthis.getFeaturePopup(this._fileExternalLinkDisabledContent).show();\n\t}\n\n\tonTemplateHintIconClick()\n\t{\n\t\tif (this._senderId === 'ednaru')\n\t\t{\n\t\t\ttop.BX.Helper.show(\"redirect=detail&code=14214014\");\n\t\t}\n\t}\n\n\tshowTemplateSelectDropdown(items)\n\t{\n\t\tconst menuItems = [];\n\t\tif (Type.isArray(items))\n\t\t{\n\t\t\tif (items.length)\n\t\t\t{\n\t\t\t\titems.forEach((item) => {\n\t\t\t\t\tmenuItems.push({\n\t\t\t\t\t\ttemplateId: item.ORIGINAL_ID ?? null,\n\t\t\t\t\t\tvalue: item.ID,\n\t\t\t\t\t\ttext: item.TITLE,\n\t\t\t\t\t\tonclick: this._selectTemplateHandler,\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tBX.PopupMenu.show({\n\t\t\t\t\tid: this._templateSelectorMenuId,\n\t\t\t\t\tbindElement: this._templateSelectorNode,\n\t\t\t\t\titems: menuItems,\n\t\t\t\t\tangle: false,\n\t\t\t\t\twidth: this._templateSelectorNode.offsetWidth,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (this._senderId)\n\t\t{\n\t\t\tconst loaderMenuId = this._templateSelectorMenuId + 'loader';\n\t\t\tconst loaderMenuLoaderId = this._templateSelectorMenuId + 'loader';\n\n\t\t\tBX.PopupMenu.show({\n\t\t\t\tid: loaderMenuId,\n\t\t\t\tbindElement: this._templateSelectorNode,\n\t\t\t\titems: [{\n\t\t\t\t\thtml: '<div id=\"' + loaderMenuLoaderId + '\"></div>',\n\t\t\t\t}],\n\t\t\t\tangle: false,\n\t\t\t\twidth: this._templateSelectorNode.offsetWidth,\n\t\t\t\theight: 60,\n\t\t\t\tevents: {\n\t\t\t\t\tonDestroy: function() {\n\t\t\t\t\t\tthis.hideLoader();\n\t\t\t\t\t}.bind(this)\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.showLoader(BX(loaderMenuLoaderId));\n\n\t\t\tif (!this._isRequestRunning)\n\t\t\t{\n\t\t\t\tthis._isRequestRunning = true;\n\t\t\t\tconst senderId = this._senderId;\n\n\t\t\t\tBX.ajax.runAction(\n\t\t\t\t\t'crm.activity.sms.getTemplates',\n\t\t\t\t\t{\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tsenderId,\n\t\t\t\t\t\t\tcontext: {\n\t\t\t\t\t\t\t\tmodule: 'crm',\n\t\t\t\t\t\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\t\t\t\t\t\tentityCategoryId: this.getEntityCategoryId(),\n\t\t\t\t\t\t\t\tentityId: this.getEntityId(),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t\t.then(function(response)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._isRequestRunning = false;\n\t\t\t\t\t\tconst sender = this._senders.find(function (sender) {\n\t\t\t\t\t\t\treturn (sender.id === senderId);\n\t\t\t\t\t\t}.bind(this));\n\n\t\t\t\t\t\tif (sender)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsender.templates = response.data.templates;\n\t\t\t\t\t\t\tthis.toggleTemplateSelectAvailability();\n\t\t\t\t\t\t\tif (BX.PopupMenu.getMenuById(loaderMenuId))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tBX.PopupMenu.getMenuById(loaderMenuId).close();\n\n\t\t\t\t\t\t\t\tif (this.isVisible())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.showTemplateSelectDropdown(sender.templates);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this))\n\t\t\t\t\t.catch(function(response)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._isRequestRunning = false;\n\t\t\t\t\t\tif (BX.PopupMenu.getMenuById(loaderMenuId))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (response && response.errors && response.errors[0] && response.errors[0].message)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\talert(response.errors[0].message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tBX.PopupMenu.getMenuById(loaderMenuId).close();\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this))\n\t\t\t\t;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tgetSelectedTemplate(): ?Object\n\t{\n\t\tconst sender = this.getSelectedSender();\n\t\tif (!this._templateId || !sender || !sender.templates)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tconst template = sender.templates.find((template) => template.ID === this._templateId);\n\n\t\treturn template ?? null;\n\t}\n\n\tpreparePlaceholdersFromTemplate(template: Object): void\n\t{\n\t\tconst templatePlaceholders = template.PLACEHOLDERS ?? null;\n\t\tif (!Type.isPlainObject(templatePlaceholders))\n\t\t{\n\t\t\tthis.placeholders = null;\n\t\t\tthis.filledPlaceholders = null;\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.placeholders = templatePlaceholders;\n\t\tif (!Type.isArray(template.FILLED_PLACEHOLDERS))\n\t\t{\n\t\t\ttemplate.FILLED_PLACEHOLDERS = [];\n\t\t}\n\n\t\tthis.filledPlaceholders = template.FILLED_PLACEHOLDERS;\n\t}\n\n\tonTemplateSelectClick()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\n\t\tif (sender)\n\t\t{\n\t\t\tthis.showTemplateSelectDropdown(sender.templates);\n\t\t}\n\t}\n\n\tonSelectTemplate(e, item)\n\t{\n\t\tthis._templateId = item.value;\n\t\tthis.templateOriginalId = item.templateId;\n\t\tthis.applySelectedTemplate();\n\t\tthis.toggleSaveButton();\n\t\tconst menu = BX.PopupMenu.getMenuById(this._templateSelectorMenuId);\n\t\tif (menu)\n\t\t{\n\t\t\tmenu.close();\n\t\t}\n\t}\n\n\ttoggleTemplateSelectAvailability()\n\t{\n\t\tconst sender = this.getSelectedSender();\n\t\tif (sender && Type.isArray(sender.templates) && !sender.templates.length)\n\t\t{\n\t\t\tBX.addClass(this._templateSelectorNode, 'ui-ctl-disabled');\n\t\t\tthis._templateTemplateTitleNode.textContent = BX.message('CRM_TIMELINE_SMS_TEMPLATES_NOT_FOUND');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tBX.removeClass(this._templateSelectorNode, 'ui-ctl-disabled');\n\t\t\tthis.applySelectedTemplate();\n\t\t}\n\t}\n\n\tapplySelectedTemplate(): void\n\t{\n\t\tif (!this.isCurrentSenderHasTemplates())\n\t\t{\n\t\t\tthis.hideTemplatePreviewNodeAndClearTitle();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst template = this.getSelectedTemplate();\n\t\tif (!Type.isPlainObject(template))\n\t\t{\n\t\t\tthis.hideTemplatePreviewNodeAndClearTitle();\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.preparePlaceholdersFromTemplate(template);\n\n\t\tthis.setTemplateNodeTitle(template.TITLE);\n\t\tthis.initTemplateEditor(template);\n\n\t\tthis.showNode(this._templatePreviewNode);\n\t}\n\n\tshowNode(node): void\n\t{\n\t\tDom.style(node, { display: ''});\n\t}\n\n\tisCurrentSenderTemplateHasPlaceholders(): boolean\n\t{\n\t\treturn (this.isCurrentSenderIsTemplatesBased() && Type.isPlainObject(this.placeholders));\n\t}\n\n\tisCurrentSenderIsTemplatesBased(): boolean\n\t{\n\t\tconst sender = this.getSelectedSender();\n\n\t\treturn (sender && sender.isTemplatesBased);\n\t}\n\n\tisCurrentSenderHasTemplates(): boolean\n\t{\n\t\tconst sender = this.getSelectedSender();\n\n\t\treturn (sender && sender.templates);\n\t}\n\n\thideTemplatePreviewNodeAndClearTitle(): void\n\t{\n\t\tthis.hideNode(this._templatePreviewNode);\n\t\tthis.setTemplateNodeTitle();\n\t}\n\n\thideNode(node): void\n\t{\n\t\tDom.style(node, { display: 'none'});\n\t}\n\n\tsetTemplateNodeTitle(title: string = ''): void\n\t{\n\t\tthis._templateTemplateTitleNode.textContent = title;\n\t}\n\n\tinitTemplateEditor(template: Object): void\n\t{\n\t\t// @todo will support other positions too, not only Preview\n\t\tconst preview = Text.encode(template.PREVIEW).replaceAll('\\n', '<br>');\n\n\t\tconst params = {\n\t\t\ttarget: this._templatePreviewNode,\n\t\t\tentityId: this._ownerId,\n\t\t\tentityTypeId: this._ownerTypeId,\n\t\t\tcategoryId: this._ownerCategoryId,\n\t\t\tonSelect: (params) => this.createOrUpdatePlaceholder(params),\n\t\t\t//onDeselect: (params) => this.deletePlaceholder(params),\n\t\t};\n\t\tthis.tplEditor = (new BX.Crm.Template.Editor(params))\n\t\t\t.setPlaceholders(this.placeholders)\n\t\t\t.setFilledPlaceholders(this.filledPlaceholders)\n\t\t;\n\n\t\t// @todo will support other positions too, not only Preview\n\t\tthis.tplEditor.setBody(preview);\n\t}\n\n\tcreateOrUpdatePlaceholder(params: Object): void\n\t{\n\t\tconst { id, value, entityType, text } = params;\n\t\tBX.ajax.runAction(\n\t\t\t'crm.activity.smsplaceholder.createOrUpdatePlaceholder',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tplaceholderId: id,\n\t\t\t\t\tfieldName: Type.isStringFilled(value) ? value : null,\n\t\t\t\t\tentityType: Type.isStringFilled(entityType) ? entityType : null,\n\t\t\t\t\tfieldValue:  Type.isStringFilled(text) ? text : null,\n\t\t\t\t\t...this.getCommonPlaceholderData(),\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t}\n\n\t/* deletePlaceholder({ placeholderId }): void\n\t{\n\t\tBX.ajax.runAction(\n\t\t\t'crm.activity.smsplaceholder.deletePlaceholder',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tplaceholderId,\n\t\t\t\t\t...this.getCommonPlaceholderData(),\n\t\t\t\t},\n\t\t\t},\n\t\t);\n\t} */\n\n\tgetCommonPlaceholderData(): Object\n\t{\n\t\treturn {\n\t\t\ttemplateId: this.templateOriginalId,\n\t\t\tentityTypeId: this._ownerTypeId,\n\t\t\tentityCategoryId: this._ownerCategoryId,\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * */\n\tactivate()\n\t{\n\t\tsuper.activate();\n\n\t\t// fetch config\n\t\tif (this.isFetchedConfig || !this.getEntityId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.isFetchedConfig = false;\n\t\tthis.fetchConfigPromise = new Promise((resolve) => {\n\t\t\tAjax.runAction('crm.api.timeline.sms.getConfig', {\n\t\t\t\tjson: {\n\t\t\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\t\t\tentityId: this.getEntityId(),\n\t\t\t\t},\n\t\t\t}).then(({ data }) => {\n\t\t\t\tthis.isFetchedConfig = true;\n\t\t\t\tthis.setSettings(data);\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst canSend = this.getSetting('canSendMessage', false);\n\n\t\t\t\t\tthis.setContainer(Tag.render`\n\t\t\t\t\t\t<div class=\"crm-entity-stream-content-new-detail --focus\">\n\t\t\t\t\t\t\t${canSend ? this.#renderEditor() : this.#renderSetupText()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`);\n\n\t\t\t\t\tif (this.isCurrentSenderIsTemplatesBased() && !this.getSelectedSender().templates)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.onTemplateSelectClick();\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve();\n\t\t\t\t}, 50);\n\t\t\t}).catch(() => {\n\t\t\t\tthis.showNotify(Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONFIG_ERROR'));\n\n\t\t\t\tsetTimeout(() => this.cancel(), 50);\n\t\t\t});\n\t\t});\n\t}\n\n\ttryToResend(senderId: string, fromId: string, clientData: Object, rawDescription: ?string): void\n\t{\n\t\tif (this.isFetchedConfig)\n\t\t{\n\t\t\tthis.#prepareToResend(senderId, fromId, clientData, rawDescription);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// eslint-disable-next-line promise/catch-or-return\n\t\t\tthis.fetchConfigPromise.then(() => this.#prepareToResend(senderId, fromId, clientData, rawDescription));\n\t\t}\n\t}\n\n\t#prepareToResend(senderId: string, fromId: string, clientData: Object, rawDescription: ?string): void\n\t{\n\t\tconst sender = this._senders.find((sender: Object) => sender.id === senderId);\n\t\tif (sender?.canUse && Type.isArrayFilled(sender?.fromList))\n\t\t{\n\t\t\tthis.setSender(sender);\n\n\t\t\tconst from = sender.fromList.find((from: Object) => String(from.id) === fromId);\n\t\t\tif (from)\n\t\t\t{\n\t\t\t\tthis.setFrom(from);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.warn('Unable to resend SMS with selected from');\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.warn('Unable to resend SMS with sender ID \"' + senderId + '\"');\n\t\t}\n\n\t\tconst client = this._communications\n\t\t\t.find((communication: Object) => communication.entityId === clientData.entityId\n\t\t\t\t&& communication.entityTypeId === clientData.entityTypeId\n\t\t\t)\n\t\t;\n\t\tif (client)\n\t\t{\n\t\t\tthis.setClient(client);\n\n\t\t\tconst to = client.phones.find((phone: Object) => phone.value === clientData.value);\n\t\t\tif (to)\n\t\t\t{\n\t\t\t\tthis.setTo(to);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.warn('Unable to resend SMS with selected client');\n\t\t}\n\n\t\tif (Type.isStringFilled(rawDescription))\n\t\t{\n\t\t\tthis._input.value = rawDescription;\n\t\t\tthis.setMessageLengthCounter();\n\n\t\t\tsetTimeout(this.resizeForm.bind(this), 0);\n\t\t}\n\n\t\tif (this._smsDetail.classList.contains('hidden'))\n\t\t{\n\t\t\tsetTimeout(() => this._smsDetailSwitcher.click(), 50);\n\t\t}\n\t}\n\n\tstatic create(id, settings)\n\t{\n\t\tconst self = new Sms();\n\t\tself.initialize(id, settings);\n\t\tSms.items[self.getId()] = self;\n\n\t\treturn self;\n\t}\n\n\tstatic items = {};\n}\n","import { ajax as Ajax, Loc, Reflection, Type, Uri } from 'main.core';\nimport { SidePanel } from 'ui.sidepanel';\n\nconst CHANNEL_MANAGER_SLIDER_WIDTH = 700;\n\nexport function saveSmsMessage(\n\tserviceUrl: string,\n\tsenderId: string,\n\tparams: Object,\n\tonSuccessHandler: Function,\n\tonFailureHandler: Function,\n): Promise\n{\n\tconst baseParams = {\n\t\tsite: Loc.getMessage('SITE_ID'),\n\t\tsessid: Loc.getMessage('bitrix_sessid'),\n\t\tACTION: 'SAVE_SMS_MESSAGE',\n\t\tSENDER_ID: senderId,\n\t};\n\n\treturn new Promise((resolve, reject): void => {\n\t\t// eslint-disable-next-line @bitrix24/bitrix24-rules/no-bx\n\t\tBX.ajax({\n\t\t\turl: getSendUrl(serviceUrl, senderId),\n\t\t\tmethod: 'POST',\n\t\t\tdataType: 'json',\n\t\t\tdata: { ...params, ...baseParams },\n\t\t\tonsuccess: () => {\n\t\t\t\tonSuccessHandler();\n\t\t\t\tresolve();\n\t\t\t},\n\t\t\tonfailure: () => {\n\t\t\t\tonFailureHandler();\n\t\t\t\treject();\n\t\t\t},\n\t\t});\n\t});\n}\n\nexport function createOrUpdatePlaceholder(\n\ttemplateId: number,\n\tentityTypeId: number,\n\tentityCategoryId: ?number,\n\tparams: Object,\n): Promise\n{\n\tconst { id, value, entityType, text } = params;\n\n\treturn Ajax.runAction(\n\t\t'crm.activity.smsplaceholder.createOrUpdatePlaceholder',\n\t\t{\n\t\t\tdata: {\n\t\t\t\tplaceholderId: id,\n\t\t\t\tfieldName: Type.isStringFilled(value) ? value : null,\n\t\t\t\tentityType: Type.isStringFilled(entityType) ? entityType : null,\n\t\t\t\tfieldValue: Type.isStringFilled(text) ? text : null,\n\t\t\t\ttemplateId,\n\t\t\t\tentityTypeId,\n\t\t\t\tentityCategoryId,\n\t\t\t},\n\t\t},\n\t);\n}\n\nexport function showChannelManagerSlider(manageUrl: string): void\n{\n\tif (!Type.isStringFilled(manageUrl))\n\t{\n\t\tthrow new Error('\"manageUrl\" parameter must be specified');\n\t}\n\n\tif (!Reflection.getClass('BX.SidePanel.Instance.getTopSlider'))\n\t{\n\t\tthrow new Error('Class \"SidePanel.Instance.getTopSlider\" not found');\n\t}\n\n\tconst url = Uri.addParam(manageUrl, { IFRAME: 'Y' });\n\tconst slider = SidePanel.Instance.getTopSlider();\n\tconst options = {\n\t\twidth: CHANNEL_MANAGER_SLIDER_WIDTH,\n\t\tevents: {\n\t\t\tonClose: () => {\n\t\t\t\tif (slider)\n\t\t\t\t{\n\t\t\t\t\tslider.reload();\n\t\t\t\t}\n\t\t\t},\n\t\t\tonCloseComplete: () => {\n\t\t\t\tif (!slider)\n\t\t\t\t{\n\t\t\t\t\tdocument.location.reload();\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t};\n\tSidePanel.Instance.open(url, options);\n}\n\nfunction getSendUrl(serviceUrl: string, senderId: string): string\n{\n\tif (!Type.isStringFilled(serviceUrl))\n\t{\n\t\tthrow new Error('\"serviceUrl\" parameter must be specified');\n\t}\n\n\tif (!Type.isStringFilled(senderId))\n\t{\n\t\tthrow new Error('\"senderId\" parameter must be specified');\n\t}\n\n\treturn BX.util.add_url_param(\n\t\tserviceUrl,\n\t\t{\n\t\t\taction: 'save_sms_message',\n\t\t\tsender: senderId,\n\t\t},\n\t);\n}\n","import { Type } from 'main.core';\nimport { MenuItemOptions } from 'main.popup';\n\nexport const MENU_ITEM_STUB_ID = 'stub';\nexport const MENU_SETTINGS_ID = 'crm-timeline-whatsapp-settings-menu';\n\nconst ACTIVE_MENU_ITEM_CLASS = 'menu-popup-item-accept';\nconst DEFAULT_MENU_ITEM_CLASS = 'menu-popup-item-none';\n\n// eslint-disable-next-line class-methods-use-this\nexport function getSubmenuStubItems(): MenuItemOptions[]\n{\n\t// needed for emitted the onSubMenuShow event\n\treturn [\n\t\t{\n\t\t\tid: MENU_ITEM_STUB_ID,\n\t\t},\n\t];\n}\n\nexport function getSendersItems(\n\tfromList: Object[],\n\tselectedPhoneId: string,\n\tonClickHandler: Function,\n): MenuItemOptions[]\n{\n\tif (!Type.isArrayFilled(fromList))\n\t{\n\t\treturn [];\n\t}\n\n\tconst result = [];\n\tfromList.forEach(({ id, name: text }) => {\n\t\tconst className = (id === selectedPhoneId ? ACTIVE_MENU_ITEM_CLASS : DEFAULT_MENU_ITEM_CLASS);\n\t\tresult.push({\n\t\t\tid,\n\t\t\ttext,\n\t\t\tclassName,\n\t\t\tonclick: onClickHandler,\n\t\t});\n\t});\n\n\treturn result;\n}\n\nexport function getCommunicationsItems(\n\tcommunications: Object[],\n\tselectedPhoneId: string,\n\tonClickHandler: Function,\n): MenuItemOptions[]\n{\n\tif (!Type.isArrayFilled(communications))\n\t{\n\t\treturn [];\n\t}\n\n\tconst result = [];\n\tcommunications.forEach((communication: Object) => {\n\t\tif (Type.isArrayFilled(communication.phones))\n\t\t{\n\t\t\tcommunication.phones.forEach((phone: Object) => {\n\t\t\t\tconst className = (phone.id === selectedPhoneId ? ACTIVE_MENU_ITEM_CLASS : DEFAULT_MENU_ITEM_CLASS);\n\t\t\t\tresult.push({\n\t\t\t\t\tid: phone.id,\n\t\t\t\t\ttext: `${communication.caption} (${phone.valueFormatted})`,\n\t\t\t\t\tclassName,\n\t\t\t\t\tonclick: onClickHandler,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\n\treturn result;\n}\n\nexport function getNewCommunications(input: Array): Array\n{\n\tconst phoneReceivers = input.filter((receiver: Object) => receiver.address.typeId === 'PHONE');\n\tconst newCommunications: {[addressSourceHash: string]: Object} = {};\n\tfor (const receiver of phoneReceivers)\n\t{\n\t\tlet communication = newCommunications[receiver.addressSource.hash];\n\n\t\tif (!communication)\n\t\t{\n\t\t\tcommunication = {\n\t\t\t\tentityTypeId: receiver.addressSource.entityTypeId,\n\t\t\t\tentityTypeName: BX.CrmEntityType.resolveName(receiver.addressSource.entityTypeId),\n\t\t\t\tentityId: receiver.addressSource.entityId,\n\t\t\t\tcaption: receiver.addressSourceData?.title,\n\t\t\t\tphones: [],\n\t\t\t};\n\t\t}\n\n\t\tcommunication.phones.push({\n\t\t\tid: receiver.address.id,\n\t\t\ttype: receiver.address.typeId,\n\t\t\tvalue: receiver.address.value,\n\t\t\tvalueFormatted: receiver.address.valueFormatted,\n\t\t});\n\n\t\tnewCommunications[receiver.addressSource.hash] = communication;\n\t}\n\n\treturn Object.values(newCommunications);\n}\n","import { Reflection } from 'main.core';\n\nimport { BaseTour } from '../tools/base-tour';\n\nconst UserOptions = Reflection.namespace('BX.userOptions');\n\n/** @memberof BX.Crm.Timeline.MenuBar.Whatsapp */\nexport default class Tour extends BaseTour\n{\n\tstatic USER_OPTION_PROVIDER_OFF: string = 'is_tour_provider_off_viewed';\n\tstatic USER_OPTION_TEMPLATES_READY: string = 'is_tour_templates_ready_viewed';\n\tstatic USER_OPTION_PROVIDER_ON: string = 'is_tour_provider_on_viewed';\n\n\t/**\n\t * @override\n\t * */\n\tsaveUserOption(optionName: ?string = null): void\n\t{\n\t\tif (![\n\t\t\tTour.USER_OPTION_PROVIDER_OFF,\n\t\t\tTour.USER_OPTION_TEMPLATES_READY,\n\t\t\tTour.USER_OPTION_PROVIDER_ON,\n\t\t].includes(optionName))\n\t\t{\n\t\t\tthrow new Error(`User option with name: ${optionName} unsupported`);\n\t\t}\n\n\t\tUserOptions.save('crm', 'whatsapp', optionName, 1);\n\t}\n}\n","import { Builder, Dictionary } from 'crm.integration.analytics';\nimport { Editor, FilledPlaceholder } from 'crm.template.editor';\nimport { TourManager } from 'crm.tour-manager';\nimport { ajax as Ajax, Dom, Event, Loc, Runtime, Tag, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { MenuItem, MenuItemOptions, MenuManager } from 'main.popup';\nimport { sendData } from 'ui.analytics';\nimport { Dialog, DialogOptions } from 'ui.entity-selector';\nimport { MessageBox } from 'ui.dialogs.messagebox';\n\nimport Item from '../../item';\nimport { createOrUpdatePlaceholder, saveSmsMessage, showChannelManagerSlider } from './internal/actions';\nimport {\n\tgetCommunicationsItems,\n\tgetNewCommunications,\n\tgetSendersItems,\n\tgetSubmenuStubItems,\n\tMENU_ITEM_STUB_ID,\n\tMENU_SETTINGS_ID,\n} from './internal/menu-helper';\nimport { Provider, TemplateItem } from './types';\nimport Tour from './tour';\n\nimport 'ui.design-tokens';\nimport './layout.css';\n\nconst ARTICLE_CODE_SEND_WITH_WHATSAPP = '20526810';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class Whatsapp extends Item\n{\n\t#serviceUrl: string = '';\n\t#provider: Provider = null;\n\t#communications: Array = [];\n\n\t#sendButton: HTMLElement = null;\n\t#cancelButton: HTMLElement = null;\n\t#selectorButton: HTMLElement = null;\n\t#templatesContainer: HTMLElement = null;\n\t#templatesContainerTitle: HTMLElement = null;\n\t#templatesContainerContent: HTMLElement = null;\n\n\t#settingsMenu: Menu = null;\n\t#tplEditor: Editor = null;\n\t#selectTplDlg: Dialog = null;\n\t#placeholders: string[];\n\t#filledPlaceholders: FilledPlaceholder[];\n\n\t#canUse: boolean = false;\n\t#isDemoTemplateSet: boolean = false;\n\t#isSendRequestRunning: boolean = false;\n\t#isLocked: boolean = false;\n\t#isFetchedConfig: boolean = false;\n\n\t#template: TemplateItem = null;\n\t#fromPhoneId: ?string = null;\n\t#toPhone: ?Object = null;\n\t#toEntityTypeId: ?number = null;\n\t#toEntityId: ?number = null;\n\n\t#unViewedTourList: string[];\n\n\t#fetchConfigPromise: ?Promise = null;\n\n\t#isHelpShown: boolean = false;\n\t#isTemplateSelectorShown: boolean = false;\n\t#isSuggestTemplateShown: boolean = false;\n\t#isResendTry: boolean = false;\n\n\t/**\n\t * @override\n\t * */\n\tinitializeSettings(): void\n\t{\n\t\tthis.#canUse = this.getSetting('canUse');\n\t\tthis.#serviceUrl = this.getSetting('serviceUrl');\n\t\tif (!this.#serviceUrl)\n\t\t{\n\t\t\tthrow new Error('Whatsapp message sending must be used with serviceUrl');\n\t\t}\n\n\t\tthis.#unViewedTourList = this.getSetting('unViewedTourList') ?? [];\n\t}\n\n\t/**\n\t * @override\n\t * */\n\tcreateLayout(): HTMLElement\n\t{\n\t\tlet iconClass = '--gray';\n\t\tlet titleMessage = Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_HEADER_TITLE_SETUP');\n\t\tlet description = Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_HEADER_DESCRIPTION_SETUP');\n\t\tlet descriptionClass = '--fixed';\n\t\tif (this.#canUse)\n\t\t{\n\t\t\ticonClass = '--green';\n\t\t\ttitleMessage = Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_HEADER_TITLE');\n\t\t\tdescription = Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_HEADER_DESCRIPTION');\n\t\t\tdescriptionClass = '';\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-whatsapp crm-entity-stream-content-wait-detail --hidden --skeleton\">\n\t\t\t\t<div class=\"crm-entity-stream-content-whatsapp-container --hidden\">\n\t\t\t\t\t<div class=\"crm-entity-stream-content-whatsapp-header\">\n\t\t\t\t\t\t<div class=\"crm-entity-stream-content-whatsapp-header-icon ${iconClass}\"></div>\n\t\t\t\t\t\t<div class=\"crm-entity-stream-content-whatsapp-header-text\">\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-content-whatsapp-header-title\">\n\t\t\t\t\t\t\t\t${titleMessage}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"crm-entity-stream-content-whatsapp-header-description ${descriptionClass}\">\n\t\t\t\t\t\t\t\t${description}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t${this.#createHelpLinkContainer()}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"crm-entity-stream-content-whatsapp-header-buttons\">\n\t\t\t\t\t\t\t${this.#createHeaderButtons()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t${this.#createTemplatesContainer()}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-entity-stream-content-whatsapp-footer --hidden\">\n\t\t\t\t\t${this.#createFooterButtons()}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * @override\n\t * */\n\tinitializeLayout()\n\t{\n\t\tsuper.initializeLayout();\n\n\t\tthis.#setTemplate(Runtime.clone(this.getSetting('demoTemplate')));\n\t\tthis.#subscribeToReceiversChanges();\n\t}\n\n\t/**\n\t * @override\n\t * */\n\tshowTour()\n\t{\n\t\tif (!this.#isTourAvailable())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#unViewedTourList.includes(Tour.USER_OPTION_PROVIDER_OFF))\n\t\t{\n\t\t\tTourManager.getInstance().registerWithLaunch(new Tour({\n\t\t\t\titemCode: 'whatsapp',\n\t\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_GUIDE_PROVIDER_OFF_TITLE'),\n\t\t\t\ttext: this.getEntityTypeId() === BX.CrmEntityType.enumeration.lead\n\t\t\t\t\t? Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_GUIDE_PROVIDER_OFF_TEXT_LEAD')\n\t\t\t\t\t: Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_GUIDE_PROVIDER_OFF_TEXT_DEAL'),\n\t\t\t\tarticleCode: ARTICLE_CODE_SEND_WITH_WHATSAPP,\n\t\t\t\tuserOptionName: Tour.USER_OPTION_PROVIDER_OFF,\n\t\t\t}));\n\t\t}\n\t\telse if (this.#unViewedTourList.includes(Tour.USER_OPTION_PROVIDER_ON))\n\t\t{\n\t\t\tTourManager.getInstance().registerWithLaunch(new Tour({\n\t\t\t\titemCode: 'whatsapp',\n\t\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_GUIDE_PROVIDER_ON_TITLE'),\n\t\t\t\ttext: this.getEntityTypeId() === BX.CrmEntityType.enumeration.lead\n\t\t\t\t\t? Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_GUIDE_PROVIDER_ON_TEXT_LEAD')\n\t\t\t\t\t: Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_GUIDE_PROVIDER_ON_TEXT_DEAL'),\n\t\t\t\tarticleCode: ARTICLE_CODE_SEND_WITH_WHATSAPP,\n\t\t\t\tuserOptionName: Tour.USER_OPTION_PROVIDER_ON,\n\t\t\t}));\n\t\t}\n\t}\n\n\t/**\n\t * @override\n\t * */\n\tactivate(): void\n\t{\n\t\tsuper.activate();\n\n\t\t// fetch config\n\t\tif (this.#isFetchedConfig || !this.getEntityId())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isFetchedConfig = false;\n\t\tthis.#fetchConfigPromise = new Promise((resolve) => {\n\t\t\tAjax.runAction('crm.api.timeline.whatsapp.getConfig', {\n\t\t\t\tjson: {\n\t\t\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\t\t\tentityId: this.getEntityId(),\n\t\t\t\t},\n\t\t\t}).then(({ data }) => {\n\t\t\t\tthis.#isFetchedConfig = true;\n\t\t\t\tthis.#prepareParams(data);\n\t\t\t\tthis.#showContent();\n\n\t\t\t\tresolve();\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.supportsLayout()\n\t\t\t\t\t\t&& this.#isTourAvailable()\n\t\t\t\t\t\t&& this.#unViewedTourList.includes(Tour.USER_OPTION_TEMPLATES_READY)\n\t\t\t\t\t)\n\t\t\t\t\t{\n\t\t\t\t\t\tTourManager.getInstance().registerWithLaunch(new Tour({\n\t\t\t\t\t\t\titemCode: 'whatsapp',\n\t\t\t\t\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_GUIDE_TEMPLATES_READY_TITLE'),\n\t\t\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_GUIDE_TEMPLATES_READY_TEXT'),\n\t\t\t\t\t\t\tarticleCode: ARTICLE_CODE_SEND_WITH_WHATSAPP,\n\t\t\t\t\t\t\tuserOptionName: Tour.USER_OPTION_TEMPLATES_READY,\n\t\t\t\t\t\t\tguideBindElement: this.#selectorButton,\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t\tthis.#unViewedTourList = this.#unViewedTourList.filter((name) => name !== Tour.USER_OPTION_TEMPLATES_READY);\n\t\t\t\t\t}\n\t\t\t\t}, 300);\n\t\t\t}).catch(() => {\n\t\t\t\tthis.showNotify(Loc.getMessage('CRM_TIMELINE_GOTOCHAT_CONFIG_ERROR'));\n\n\t\t\t\tsetTimeout(() => this.emitFinishEditEvent(), 50);\n\t\t\t});\n\t\t});\n\t}\n\n\ttryToResend(template: Object, fromId: string, clientData: Object): void\n\t{\n\t\tif (this.#isFetchedConfig)\n\t\t{\n\t\t\tthis.#prepareToResend(template, fromId, clientData);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// eslint-disable-next-line promise/catch-or-return\n\t\t\tthis.#fetchConfigPromise.then(() => this.#prepareToResend(template, fromId, clientData));\n\t\t}\n\n\t\tthis.#isResendTry = true;\n\t}\n\n\t#prepareParams(data: Object): void\n\t{\n\t\tconst { communications, provider } = data;\n\n\t\tthis.#provider = provider;\n\t\tthis.#canUse = this.#provider.canUse;\n\t\tthis.#communications = communications;\n\n\t\t// set default parameters\n\t\tthis.#setCommunicationsParams();\n\t\tthis.#setChannelDefaultPhoneId();\n\t}\n\n\t#prepareToResend(template: Object, fromId: string, clientData: Object): void\n\t{\n\t\tif (!this.#provider)\n\t\t{\n\t\t\tthrow new Error('Whatsapp provider must be defined');\n\t\t}\n\n\t\tconst client = this.#communications\n\t\t\t.find((communication: Object) => communication.entityId === clientData.entityId\n\t\t\t\t&& communication.entityTypeId === clientData.entityTypeId)\n\t\t;\n\t\tif (Type.isArrayFilled(client.phones) && Type.isStringFilled(clientData.value))\n\t\t{\n\t\t\tconst toPhone = client.phones.find((row: Object) => row.value === clientData.value);\n\t\t\tif (toPhone)\n\t\t\t{\n\t\t\t\tthis.#toPhone = toPhone;\n\t\t\t\tthis.#toEntityTypeId = client.entityTypeId;\n\t\t\t\tthis.#toEntityId = client.entityId;\n\t\t\t}\n\t\t}\n\n\t\tif (Type.isArrayFilled(this.#provider.fromList) && Type.isStringFilled(fromId))\n\t\t{\n\t\t\tconst from = this.#provider.fromList.find((row: Object) => String(row.id) === fromId);\n\t\t\tif (from)\n\t\t\t{\n\t\t\t\tthis.#fromPhoneId = from.id;\n\t\t\t}\n\t\t}\n\n\t\tif (this.#canUse && Type.isPlainObject(template))\n\t\t{\n\t\t\tthis.#initTemplateSelectDialog({ preselectedItems: [['message_template', template.ORIGINAL_ID]] });\n\t\t\tthis.#setTemplate(template);\n\t\t}\n\t}\n\n\t#subscribeToReceiversChanges(): void\n\t{\n\t\tEventEmitter.subscribe('BX.Crm.MessageSender.ReceiverRepository:OnReceiversChanged', (event: BaseEvent) => {\n\t\t\tconst { item, current } = event.getData();\n\t\t\tif (\n\t\t\t\tthis.getEntityTypeId() !== item?.entityTypeId\n\t\t\t\t|| this.getEntityId() !== item?.entityId\n\t\t\t\t|| !Type.isArray(current)\n\t\t\t\t|| !this.#isFetchedConfig\n\t\t\t)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#communications = getNewCommunications(current);\n\t\t\tthis.#setCommunicationsParams();\n\n\t\t\tMenuManager.destroy(MENU_SETTINGS_ID);\n\n\t\t\tthis.#applySendButtonState();\n\t\t\tthis.#createSettingsMenu();\n\t\t});\n\t}\n\n\t// region PRIVATE RENDERERS\n\t// region PRIVATE DOM MANIPULATIONS METHODS\n\t#createHelpLinkContainer(): HTMLElement\n\t{\n\t\tconst container = Tag.render`\n\t\t\t<a class=\"crm-entity-stream-content-whatsapp-header-help-link\" href=\"#\">\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_HEADER_HELP_LINK')}\n\t\t\t</a>\n\t\t`;\n\t\tEvent.bind(container, 'click', () => this.#handleHelpClick(ARTICLE_CODE_SEND_WITH_WHATSAPP));\n\n\t\treturn container;\n\t}\n\n\t#createHeaderButtons(): ?HTMLElement\n\t{\n\t\tif (this.#canUse)\n\t\t{\n\t\t\tthis.#selectorButton = Tag.render`\n\t\t\t\t<button class=\"crm-entity-stream-content-whatsapp-header-button-selector\">\n\t\t\t\t\t<span class=\"crm-entity-stream-content-whatsapp-header-button-text\">\n\t\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_BUTTON_SELECTOR')}\n\t\t\t\t\t</span>\n\t\t\t\t</button>\n\t\t\t`;\n\t\t\tEvent.bind(this.#selectorButton, 'click', () => this.#handleTemplateSelect());\n\n\t\t\tconst settingsButton = Tag.render`\n\t\t\t\t<button class=\"ui-btn ui-btn-link ui-btn-xs ui-btn-icon-setting crm-entity-stream-content-whatsapp-header-button-settings\">\n\t\t\t\t</button>\n\t\t\t`;\n\t\t\tEvent.bind(settingsButton, 'click', () => this.#handleSettingsMenuClick());\n\n\t\t\treturn Tag.render`\n\t\t\t\t${this.#selectorButton}\n\t\t\t\t${settingsButton}\n\t\t\t`;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t#createFooterButtons(): HTMLElement\n\t{\n\t\tif (this.#canUse)\n\t\t{\n\t\t\tthis.#sendButton = Tag.render`\n\t\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round ui-btn-disabled\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SEND')}\n\t\t\t\t</button>\n\t\t\t`;\n\t\t\tEvent.bind(this.#sendButton, 'click', () => this.#handleSendButtonClick());\n\n\t\t\tthis.#cancelButton = Tag.render`\n\t\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-link\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}\n\t\t\t\t</button>\n\t\t\t`;\n\t\t\tEvent.bind(this.#cancelButton, 'click', () => {\n\t\t\t\tthis.#setTemplate(Runtime.clone(this.getSetting('demoTemplate')));\n\t\t\t\tthis.#selectTplDlg = null;\n\t\t\t\tthis.emitFinishEditEvent();\n\t\t\t\tthis.#submitCancelButtonAnalytics(this.#template?.ORIGINAL_ID);\n\t\t\t});\n\n\t\t\treturn Tag.render`\n\t\t\t\t${this.#sendButton}\n\t\t\t\t${this.#cancelButton}\n\t\t\t`;\n\t\t}\n\n\t\tconst setupButton = Tag.render`\n\t\t\t<button class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round\">\n\t\t\t\t${Loc.getMessage('CRM_TIMELINE_CONNECT_BTN')}\n\t\t\t</button>\n\t\t`;\n\t\tEvent.bind(setupButton, 'click', () => showChannelManagerSlider(this.#provider.manageUrl));\n\n\t\treturn setupButton;\n\t}\n\n\t#createTemplatesContainer(): HTMLElement\n\t{\n\t\tthis.#templatesContainerTitle = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-new-detail-whatsapp-template-title\"></div>\n\t\t`;\n\n\t\tthis.#templatesContainerContent = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-new-detail-whatsapp-template-content\"></div>\n\t\t`;\n\n\t\tthis.#templatesContainer = Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-new-detail-whatsapp-template --demo\">\n\t\t\t\t${this.#templatesContainerTitle}\n\t\t\t\t${this.#templatesContainerContent}\n\t\t\t</div>\n\t\t`;\n\n\t\treturn this.#templatesContainer;\n\t}\n\n\t#createSettingsMenu(): Menu\n\t{\n\t\tconst items = getSubmenuStubItems();\n\n\t\tthis.#settingsMenu = MenuManager.create({\n\t\t\tid: MENU_SETTINGS_ID,\n\t\t\tbindElement: document.querySelector('.crm-entity-stream-content-whatsapp-header-button-settings'),\n\t\t\titems: [{\n\t\t\t\tdelimiter: true,\n\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_MENU_SETTINGS_HEADER'),\n\t\t\t}, {\n\t\t\t\tid: 'communicationsSubmenu',\n\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_MENU_SETTINGS_RECEIVER'),\n\t\t\t\titems,\n\t\t\t\tevents: {\n\t\t\t\t\tonSubMenuShow: (event: BaseEvent) => {\n\t\t\t\t\t\tthis.#handleShowSubMenu(\n\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\tgetCommunicationsItems(\n\t\t\t\t\t\t\t\tthis.#communications,\n\t\t\t\t\t\t\t\tthis.#toPhone.id,\n\t\t\t\t\t\t\t\tthis.#handleCommunicationSelect.bind(this),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}, {\n\t\t\t\tid: 'sendersSubmenu',\n\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_MENU_SETTINGS_SENDER'),\n\t\t\t\titems,\n\t\t\t\tdisabled: !Type.isArrayFilled(this.#provider.fromList),\n\t\t\t\tevents: {\n\t\t\t\t\tonSubMenuShow: (event: BaseEvent) => {\n\t\t\t\t\t\tthis.#handleShowSubMenu(\n\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\tgetSendersItems(\n\t\t\t\t\t\t\t\tthis.#provider.fromList,\n\t\t\t\t\t\t\t\tthis.#fromPhoneId,\n\t\t\t\t\t\t\t\tthis.#handleSenderPhoneSelect.bind(this),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}],\n\t\t});\n\t}\n\n\t#showContent(): void\n\t{\n\t\tDom.removeClass(\n\t\t\tdocument.querySelector('.crm-entity-stream-content-whatsapp-container'),\n\t\t\t'--hidden',\n\t\t);\n\n\t\tDom.removeClass(\n\t\t\tdocument.querySelector('.crm-entity-stream-content-whatsapp-footer'),\n\t\t\t'--hidden',\n\t\t);\n\n\t\tDom.removeClass(\n\t\t\tdocument.querySelector('.crm-entity-stream-content-whatsapp'),\n\t\t\t'--skeleton',\n\t\t);\n\t}\n\t// endregion\n\n\t// region SETTERS\n\t#setTemplate(template: TemplateItem): void\n\t{\n\t\tif (template.ORIGINAL_ID > 0)\n\t\t{\n\t\t\tDom.removeClass(this.#templatesContainer, '--demo');\n\t\t\tthis.#isDemoTemplateSet = false;\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// set DEMO template\n\t\t\tDom.addClass(this.#templatesContainer, '--demo');\n\t\t\tthis.#isDemoTemplateSet = true;\n\t\t}\n\n\t\tthis.#preparePlaceholdersFromTemplate(template);\n\t\tthis.#templatesContainerTitle.textContent = template.TITLE;\n\t\tthis.#initTemplateEditor(template);\n\n\t\tthis.#template = template;\n\n\t\tthis.#applySendButtonState();\n\t}\n\n\t#setCommunicationsParams(): void\n\t{\n\t\tif (this.#isClientPhoneNotSet())\n\t\t{\n\t\t\tthis.#toPhone = null;\n\t\t\tthis.#toEntityTypeId = null;\n\t\t\tthis.#toEntityId = null;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst defaultCommunication = this.#communications[0];\n\t\tif (Type.isArrayFilled(defaultCommunication.phones))\n\t\t{\n\t\t\tthis.#toPhone = defaultCommunication.phones[0];\n\t\t\tthis.#toEntityTypeId = defaultCommunication.entityTypeId;\n\t\t\tthis.#toEntityId = defaultCommunication.entityId;\n\t\t}\n\t}\n\n\t#setChannelDefaultPhoneId(): void\n\t{\n\t\tif (!this.#provider || !Type.isArrayFilled(this.#provider.fromList))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { fromList } = this.#provider;\n\t\tconst defaultPhone = fromList.find((item) => item.default);\n\n\t\tthis.#fromPhoneId = defaultPhone ? defaultPhone.id : fromList[0].id;\n\t}\n\n\t#applySendButtonState(): void\n\t{\n\t\tconst enabled = !this.#isDemoTemplateSet\n\t\t\t&& this.#communications.length > 0\n\t\t\t&& this.#toPhone !== null\n\t\t\t&& this.#template !== null\n\t\t;\n\n\t\tif (enabled)\n\t\t{\n\t\t\tDom.removeClass(this.#sendButton, 'ui-btn-disabled');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.addClass(this.#sendButton, 'ui-btn-disabled');\n\t\t}\n\t}\n\t// endregion\n\n\t// region HANDLERS\n\t#handleTemplateSelect(): void\n\t{\n\t\tif (!this.#selectTplDlg)\n\t\t{\n\t\t\tthis.#initTemplateSelectDialog();\n\t\t}\n\n\t\tthis.#selectTplDlg.show();\n\n\t\tthis.#submitTemplateSelectAnalytics();\n\t}\n\n\t#handleSettingsMenuClick(): void\n\t{\n\t\tif (this.#toPhone === null)\n\t\t{\n\t\t\tthis.showNotify(Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_NO_PHONE_ERROR'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#settingsMenu)\n\t\t{\n\t\t\tthis.#createSettingsMenu();\n\t\t}\n\n\t\tthis.#settingsMenu.show();\n\t}\n\n\t#handleHelpClick(code: number): void\n\t{\n\t\tif (top.BX.Helper && code > 0)\n\t\t{\n\t\t\ttop.BX.Helper.show(`redirect=detail&code=${code}`);\n\t\t}\n\n\t\tthis.#submitHelpShowAnalytics();\n\t}\n\n\t#handleShowSubMenu(event: BaseEvent, items: MenuItemOptions[]): void\n\t{\n\t\tconst target: MenuItem = event.getTarget();\n\n\t\tfor (const itemOptionsToAdd of items)\n\t\t{\n\t\t\ttarget.getSubMenu()?.addMenuItem(itemOptionsToAdd);\n\t\t}\n\n\t\ttarget.getSubMenu()?.removeMenuItem(MENU_ITEM_STUB_ID);\n\t}\n\n\t#handleSenderPhoneSelect(event: BaseEvent, item: Object): void\n\t{\n\t\tconst { id } = item;\n\n\t\tthis.#fromPhoneId = id;\n\t\tthis.#settingsMenu.close();\n\t}\n\n\t#handleCommunicationSelect(event: BaseEvent, item: Object): void\n\t{\n\t\tconst { id } = item;\n\n\t\tthis.#communications.forEach((communication: Object) => {\n\t\t\tconst toPhone = communication.phones.find((phone: Object) => phone.id === id);\n\t\t\tif (toPhone)\n\t\t\t{\n\t\t\t\tthis.#toPhone = toPhone;\n\t\t\t\tthis.#toEntityTypeId = communication.entityTypeId;\n\t\t\t\tthis.#toEntityId = communication.entityId;\n\t\t\t}\n\t\t});\n\n\t\tthis.#settingsMenu.close();\n\t}\n\n\t#handleApplyPlaceholder(params: Object): void\n\t{\n\t\tif (this.#isDemoTemplateSet)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcreateOrUpdatePlaceholder(\n\t\t\tthis.#template?.ORIGINAL_ID ?? null,\n\t\t\tthis.getEntityTypeId(),\n\t\t\tthis.getEntityCategoryId(),\n\t\t\tparams,\n\t\t).catch((error) => console.error(error));\n\t}\n\n\t#handleSendButtonClick(): void\n\t{\n\t\tif (this.#isClientPhoneNotSet())\n\t\t{\n\t\t\tMessageBox.alert(Loc.getMessage('CRM_TIMELINE_SMS_ERROR_NO_COMMUNICATIONS'));\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#template || this.#isDemoTemplateSet)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst text = this.#getTemplateEditorText();\n\t\tif (text === '')\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#isSendRequestRunning || this.#isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setLocked(true);\n\t\tthis.#isSendRequestRunning = true;\n\t\tthis.#isLocked = true;\n\n\t\tsaveSmsMessage(\n\t\t\tthis.#serviceUrl,\n\t\t\tthis.#provider.id,\n\t\t\t{\n\t\t\t\tMESSAGE_FROM: this.#fromPhoneId,\n\t\t\t\tMESSAGE_TO: this.#toPhone.value,\n\t\t\t\tMESSAGE_BODY: text,\n\t\t\t\tMESSAGE_TEMPLATE: this.#template.ID,\n\t\t\t\tMESSAGE_TEMPLATE_ORIGINAL_ID: this.#template.ORIGINAL_ID,\n\t\t\t\tMESSAGE_TEMPLATE_WITH_PLACEHOLDER: Type.isPlainObject(this.#placeholders),\n\t\t\t\tOWNER_TYPE_ID: this.getEntityTypeId(),\n\t\t\t\tOWNER_ID: this.getEntityId(),\n\t\t\t\tTO_ENTITY_TYPE_ID: this.#toEntityTypeId,\n\t\t\t\tTO_ENTITY_ID: this.#toEntityId,\n\t\t\t},\n\t\t\tthis.#handleSendSuccess.bind(this),\n\t\t\tthis.#handleSendFailure.bind(this),\n\t\t).then(\n\t\t\t() => this.setLocked(false),\n\t\t\t() => this.setLocked(false),\n\t\t).catch(() => this.setLocked(false));\n\n\t\tthis.#submitSendMessageAnalytics(this.#template.ORIGINAL_ID);\n\t}\n\n\t#handleSendSuccess(data: Object): void\n\t{\n\t\tthis.#isSendRequestRunning = false;\n\t\tthis.#isLocked = false;\n\n\t\tconst error = BX.prop.getString(data, 'ERROR', '');\n\t\tif (Type.isStringFilled(error))\n\t\t{\n\t\t\tMessageBox.alert(Text.encode(error));\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#setTemplate(Runtime.clone(this.getSetting('demoTemplate')));\n\t\tthis.#selectTplDlg = null;\n\t\tthis.emitFinishEditEvent();\n\t}\n\n\t#handleSendFailure(): void\n\t{\n\t\tthis.#isSendRequestRunning = false;\n\t\tthis.#isLocked = false;\n\t}\n\t// endregion\n\n\t// region TEMPLATES\n\tgetTemplate(): ?TemplateItem\n\t{\n\t\treturn this.#isDemoTemplateSet ? null : this.#template;\n\t}\n\n\t#initTemplateEditor(template: TemplateItem): void\n\t{\n\t\tconst preview = template?.PREVIEW.replaceAll('\\n', '<br>');\n\t\tconst editorParams = {\n\t\t\ttarget: this.#templatesContainerContent,\n\t\t\tentityId: this.getEntityId(),\n\t\t\tentityTypeId: this.getEntityTypeId(),\n\t\t\tcategoryId: this.getEntityCategoryId(),\n\t\t\tcanUsePreview: true,\n\t\t\tonSelect: (params) => this.#handleApplyPlaceholder(params),\n\t\t};\n\n\t\tthis.#tplEditor = (new Editor(editorParams))\n\t\t\t.setPlaceholders(this.#placeholders)\n\t\t\t.setFilledPlaceholders(this.#filledPlaceholders)\n\t\t;\n\n\t\tthis.#tplEditor.setBody(preview); // @todo will support other positions too, not only Preview\n\t\tEventEmitter.subscribeOnce('BX.Crm.Template.Editor:shown', this.#onPreviewTemplate.bind(this));\n\t}\n\n\t#initTemplateSelectDialog(additionalOptions: DialogOptions): void\n\t{\n\t\tconst entityTypeId = this.getEntityTypeId();\n\t\tconst entityId = this.getEntityId();\n\t\tconst categoryId = this.getEntityCategoryId();\n\n\t\tconst defaultOptions: DialogOptions = {\n\t\t\ttargetNode: this.#selectorButton,\n\t\t\tmultiple: false,\n\t\t\tshowAvatars: false,\n\t\t\tdropdownMode: true,\n\t\t\tenableSearch: true,\n\t\t\tcontext: `SMS-TEMPLATE-SELECTOR-$entityTypeId}-${categoryId}`,\n\t\t\ttagSelectorOptions: {\n\t\t\t\ttextBoxWidth: '100%',\n\t\t\t},\n\t\t\twidth: 450,\n\t\t\tentities: [{\n\t\t\t\tid: 'message_template',\n\t\t\t\toptions: {\n\t\t\t\t\tsenderId: this.#provider.id,\n\t\t\t\t\tentityTypeId,\n\t\t\t\t\tentityId,\n\t\t\t\t\tcategoryId,\n\t\t\t\t},\n\t\t\t}],\n\t\t\tevents: {\n\t\t\t\t'Item:onSelect': (selectEvent: BaseEvent): void => {\n\t\t\t\t\tconst item = selectEvent.getData().item;\n\n\t\t\t\t\tthis.#setTemplate(item.getCustomData().get('template'));\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst footerData = this.#getFooterData();\n\t\tif (Type.isArrayFilled(footerData))\n\t\t{\n\t\t\tdefaultOptions.footer = footerData;\n\t\t}\n\n\t\tthis.#selectTplDlg = new Dialog({ ...defaultOptions, ...additionalOptions });\n\t}\n\n\t#preparePlaceholdersFromTemplate(template: TemplateItem): void\n\t{\n\t\tconst templatePlaceholders = template.PLACEHOLDERS ?? null;\n\t\tif (!Type.isPlainObject(templatePlaceholders))\n\t\t{\n\t\t\tthis.#placeholders = null;\n\t\t\tthis.#filledPlaceholders = null;\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#placeholders = templatePlaceholders;\n\t\tif (!Type.isArray(template.FILLED_PLACEHOLDERS))\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\ttemplate.FILLED_PLACEHOLDERS = [];\n\t\t}\n\n\t\tthis.#filledPlaceholders = template.FILLED_PLACEHOLDERS;\n\t}\n\n\t#getTemplateEditorText(): string\n\t{\n\t\tlet text = '';\n\n\t\tif (this.#tplEditor)\n\t\t{\n\t\t\tconst tplEditorData = this.#tplEditor.getData();\n\t\t\tif (Type.isPlainObject(tplEditorData))\n\t\t\t{\n\t\t\t\ttext = tplEditorData.body; // @todo check position: body or preview\n\t\t\t}\n\t\t}\n\n\t\tif (text === '' && this.#template)\n\t\t{\n\t\t\ttext = this.#template.PREVIEW;\n\t\t}\n\n\t\treturn text;\n\t}\n\n\t#getFooterData(): Array\n\t{\n\t\tconst showForm = () => {\n\t\t\tBX.UI.Feedback.Form.open({\n\t\t\t\tid: 'b24_crm_timeline_whatsapp_template_suggest_form',\n\t\t\t\tforms: [{\n\t\t\t\t\tzones: ['ru', 'by', 'kz'],\n\t\t\t\t\tid: 758,\n\t\t\t\t\tlang: 'ru',\n\t\t\t\t\tsec: 'jyafqa',\n\t\t\t\t}, {\n\t\t\t\t\tzones: ['en'],\n\t\t\t\t\tid: 760,\n\t\t\t\t\tlang: 'en',\n\t\t\t\t\tsec: 'culzcq',\n\t\t\t\t}, {\n\t\t\t\t\tzones: ['de'],\n\t\t\t\t\tid: 764,\n\t\t\t\t\tlang: 'de',\n\t\t\t\t\tsec: '9h74xf',\n\t\t\t\t}, {\n\t\t\t\t\tzones: ['com.br'],\n\t\t\t\t\tid: 766,\n\t\t\t\t\tlang: 'com.br',\n\t\t\t\t\tsec: 'ddkhcc',\n\t\t\t\t}, {\n\t\t\t\t\tzones: ['es'],\n\t\t\t\t\tid: 762,\n\t\t\t\t\tlang: 'es',\n\t\t\t\t\tsec: '6ni833',\n\t\t\t\t}, {\n\t\t\t\t\tzones: ['en'],\n\t\t\t\t\tid: 760,\n\t\t\t\t\tlang: 'en',\n\t\t\t\t\tsec: 'culzcq',\n\t\t\t\t}],\n\t\t\t});\n\n\t\t\tthis.#submitSuggestTemplateAnalytics();\n\t\t};\n\n\t\treturn [\n\t\t\tTag.render`<span style=\"width: 100%;\"></span>`,\n\t\t\tTag.render`\n\t\t\t\t<span onclick=\"${showForm}\" class=\"ui-selector-footer-link\">\n\t\t\t\t\t${Loc.getMessage('CRM_TIMELINE_SMS_WHATSAPP_SELECTOR_FOOTER_BUTTON')}\n\t\t\t\t</span>\n\t\t\t`,\n\t\t];\n\t}\n\t// endregion\n\n\t// region UTILS\n\t#isTourAvailable(): boolean\n\t{\n\t\treturn Type.isArrayFilled(this.#unViewedTourList) && !BX.Crm.EntityEditor.getDefault().isNew();\n\t}\n\n\t#isClientPhoneNotSet(): boolean\n\t{\n\t\tif (this.#communications.length === 0)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn !Type.isArrayFilled(this.#communications[0].phones);\n\t}\n\t// endregion\n\n\t#onPreviewTemplate(): void\n\t{\n\t\tthis.#submitPreviewTemplateAnalytics();\n\t}\n\n\t#submitHelpShowAnalytics(): void\n\t{\n\t\tif (this.#isHelpShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst analyticsData = Builder.Communication.FormEvent.createDefault(\n\t\t\tthis.getEntityTypeId(),\n\t\t)\n\t\t\t.setElement(Dictionary.ELEMENT_WA_HELP)\n\t\t;\n\n\t\tthis.#isHelpShown = true;\n\n\t\tthis.#submitAnalyticsData(analyticsData);\n\t}\n\n\t#submitSendMessageAnalytics(templateId: ?string = null): void\n\t{\n\t\tconst analyticsData = Builder.Communication.SendEvent.createDefault(\n\t\t\tthis.getEntityTypeId(),\n\t\t)\n\t\t\t.setElement(Dictionary.ELEMENT_WA_SEND)\n\t\t\t.setContactsCount(1)\n\t\t;\n\n\t\tif (this.#isResendTry)\n\t\t{\n\t\t\tanalyticsData.setResend();\n\t\t\tthis.#isResendTry = false;\n\t\t}\n\n\t\tif (templateId)\n\t\t{\n\t\t\tanalyticsData.setTemplateId(templateId);\n\t\t}\n\n\t\tthis.#submitAnalyticsData(analyticsData);\n\t}\n\n\t#submitSuggestTemplateAnalytics(): void\n\t{\n\t\tif (this.#isSuggestTemplateShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst analyticsData = Builder.Communication.FormEvent.createDefault(\n\t\t\tthis.getEntityTypeId(),\n\t\t)\n\t\t\t.setElement(Dictionary.ELEMENT_WA_TEMPLATE_OFFER)\n\t\t;\n\n\t\tthis.#isSuggestTemplateShown = true;\n\n\t\tthis.#submitAnalyticsData(analyticsData);\n\t}\n\n\t#submitTemplateSelectAnalytics(): void\n\t{\n\t\tif (this.#isTemplateSelectorShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst analyticsData = Builder.Communication.FormEvent.createDefault(\n\t\t\tthis.getEntityTypeId(),\n\t\t)\n\t\t\t.setElement(Dictionary.ELEMENT_WA_TEMPLATE_SELECTOR)\n\t\t;\n\n\t\tthis.#isTemplateSelectorShown = true;\n\n\t\tthis.#submitAnalyticsData(analyticsData);\n\t}\n\n\t#submitCancelButtonAnalytics(templateId: ?string = null): void\n\t{\n\t\tconst analyticsData = Builder.Communication.SendEvent.createDefault(\n\t\t\tthis.getEntityTypeId(),\n\t\t)\n\t\t\t.setElement(Dictionary.ELEMENT_WA_CANCEL)\n\t\t;\n\n\t\tif (templateId)\n\t\t{\n\t\t\tanalyticsData.setTemplateId(templateId);\n\t\t}\n\n\t\tthis.#submitAnalyticsData(analyticsData);\n\t}\n\n\t#submitPreviewTemplateAnalytics(): void\n\t{\n\t\tconst analyticsData = Builder.Communication.FormEvent.createDefault(\n\t\t\tthis.getEntityTypeId(),\n\t\t)\n\t\t\t.setElement(Dictionary.ELEMENT_WA_PREVIEW)\n\t\t;\n\n\t\tthis.#submitAnalyticsData(analyticsData);\n\t}\n\n\t#submitAnalyticsData(analyticsData): void\n\t{\n\t\tanalyticsData\n\t\t\t.setEvent(Dictionary.EVENT_WA_TIMELINE)\n\t\t\t.setSubSection(Dictionary.SUB_SECTION_DETAILS);\n\n\t\tsendData(analyticsData.buildData());\n\t}\n}\n","import Item from '../item';\n\nexport default class Task extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tBX.CrmActivityEditor.getDefault().addTask(\n\t\t\t{\n\t\t\t\t'ownerType': BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t\t'ownerID': this.getEntityId(),\n\t\t\t\t'fromTimeline': true,\n\t\t\t}\n\t\t);\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","import { Dom, Reflection } from 'main.core';\nimport './tour.css';\nimport 'ui.design-tokens';\nimport { BaseTour } from '../tools/base-tour';\n\nconst UserOptions = Reflection.namespace('BX.userOptions');\n\n/** @memberof BX.Crm.Timeline.MenuBar.ToDo */\nexport default class Tour extends BaseTour\n{\n\tcanShow(): boolean\n\t{\n\t\tconst { guideBindElement } = this.getParams();\n\n\t\tconst mainSection = document.querySelector('[data-tab-id=\"main\"]');\n\t\tif (!mainSection || Dom.style(mainSection, 'display') === 'none')\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\tconst style = window.getComputedStyle(guideBindElement);\n\n\t\treturn document.contains(guideBindElement)\n\t\t\t&& style.display !== 'none'\n\t\t\t&& style.visibility !== 'hidden'\n\t\t\t&& style.opacity !== '0'\n\t\t\t&& guideBindElement.offsetWidth > 0\n\t\t\t&& guideBindElement.offsetHeight > 0\n\t\t;\n\t}\n\n\tsaveUserOption(optionName: ?string = null): void\n\t{\n\t\tUserOptions.save('crm', 'todo', 'isTimelineTourViewedInWeb', 1);\n\t}\n}\n","import type { ColorSettings } from 'crm.activity.todo-editor-v2';\nimport { TodoEditorV2 } from 'crm.activity.todo-editor-v2';\nimport { TourManager } from 'crm.tour-manager';\nimport { Dom, Loc, Tag, Type } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport Context from '../../context';\nimport Item from '../../item';\nimport Tour from './tour';\n\ntype Settings = {\n\tcalendarSettings: CalendarSettings,\n\tcopilotSettings: Object,\n\tcolorSettings: ColorSettings,\n\tcurrentUser: Object,\n\tpingSettings: Object,\n};\n\ntype CalendarSettings = {\n\townerId: string;\n\ttimezoneName: string;\n};\n\nconst ARTICLE_CODE = '21064046';\n\n/** @memberof BX.Crm.Timeline.MenuBar */\nexport default class ToDo extends Item\n{\n\t#toDoEditor: TodoEditorV2 = null;\n\t#todoEditorContainer: HTMLElement = null;\n\t#saveButton: HTMLElement = null;\n\t#isTourViewed: boolean = false;\n\n\tinitialize(context: Context, settings: Settings): void\n\t{\n\t\tsuper.initialize(context, settings);\n\t}\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis.#todoEditorContainer = Tag.render`<div></div>`;\n\n\t\tthis.#saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round ui-btn-disabled\" >${Loc.getMessage('CRM_TIMELINE_SAVE_BUTTON')}</button>`;\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-entity-stream-content-new-detail crm-entity-stream-content-new-detail-todo --hidden\">\n\t\t\t\t${this.#todoEditorContainer}\n\t\t\t\t<div class=\"crm-entity-stream-content-new-comment-btn-container\">\n\t\t\t\t\t${this.#saveButton}\n\t\t\t\t\t<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tinitializeLayout(): void\n\t{\n\t\tDom.removeClass(this.#saveButton, 'ui-btn-disabled');\n\n\t\tthis.#createEditor();\n\t}\n\n\tinitializeSettings(): void\n\t{\n\t\tthis.#isTourViewed = this.getSetting('isTourViewed');\n\t}\n\n\tonSaveButtonClick()\n\t{\n\t\tif (\n\t\t\tthis.isLocked()\n\t\t\t|| Dom.hasClass(this.#saveButton, 'ui-btn-disabled')\n\t\t)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.setLocked(true);\n\n\t\tthis.save().then(\n\t\t\t() => this.setLocked(false),\n\t\t\t() => this.setLocked(false),\n\t\t).catch(() => this.setLocked(false));\n\t}\n\n\tonCancelButtonClick()\n\t{\n\t\tthis.cancel();\n\t\tthis.emitFinishEditEvent();\n\t}\n\n\t#createEditor(): void\n\t{\n\t\tconst params = {\n\t\t\tcontainer: this.#todoEditorContainer,\n\t\t\tdefaultDescription: '',\n\t\t\townerTypeId: this.getEntityTypeId(),\n\t\t\townerId: this.getEntityId(),\n\t\t\tcurrentUser: this.getSetting('currentUser'),\n\t\t\tpingSettings: this.getSetting('pingSettings'),\n\t\t\tcopilotSettings: this.getSetting('copilotSettings'),\n\t\t\tcolorSettings: this.getSetting('colorSettings'),\n\t\t\tactionMenuSettings: this.getSetting('actionMenuSettings'),\n\t\t\tevents: {\n\t\t\t\tonCollapsingToggle: (event: BaseEvent) => {\n\t\t\t\t\tconst { isOpen } = event.getData();\n\t\t\t\t\tthis.setFocused(isOpen);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tparams.calendarSettings = this.getSetting('calendarSettings');\n\n\t\tconst extras = this.getExtras();\n\t\tif (Type.isPlainObject(extras.analytics))\n\t\t{\n\t\t\tparams.analytics = {\n\t\t\t\tsection: extras.analytics.c_section,\n\t\t\t\tsubSection: extras.analytics.c_sub_section,\n\t\t\t};\n\t\t}\n\n\t\tthis.#toDoEditor = new TodoEditorV2(params);\n\n\t\tthis.#toDoEditor.show();\n\t}\n\n\tsave(): Promise\n\t{\n\t\tif (Dom.hasClass(this.#saveButton, 'ui-btn-disabled'))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this.#toDoEditor.save().then((response) => {\n\t\t\tif (Type.isArray(response.errors) && response.errors.length > 0)\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tthis.cancel(false);\n\t\t\tthis.emitFinishEditEvent();\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tcancel(sendAnalytics: boolean = true): void\n\t{\n\t\tthis.#toDoEditor.cancel({ sendAnalytics });\n\n\t\tthis.setFocused(false);\n\t}\n\n\tbindInputHandlers(): void\n\t{\n\t\t// do nothing\n\t}\n\n\tsetParentActivityId(activityId: Number): void\n\t{\n\t\tthis.#toDoEditor.setParentActivityId(activityId);\n\t}\n\n\tsetDeadLine(deadLine: String): void\n\t{\n\t\tthis.#toDoEditor.setDeadline(deadLine);\n\t}\n\n\tsetDescription(description: String): void\n\t{\n\t\tthis.#toDoEditor.setDescription(description);\n\t}\n\n\tfocus(): void\n\t{\n\t\tthis.#toDoEditor.setFocused();\n\t}\n\n\tsetVisible(visible: Boolean): void\n\t{\n\t\tsuper.setVisible(visible);\n\n\t\tif (visible)\n\t\t{\n\t\t\tthis.showTour();\n\t\t}\n\t}\n\n\tshowTour(): void\n\t{\n\t\tif (!this.isVisible())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst guideBindElementClass = '.crm-activity__todo-show-actions-popup-button';\n\t\tconst guideBindElement = document.querySelector(guideBindElementClass);\n\n\t\tif (guideBindElement && !this.#isTourViewed && !BX.Crm.EntityEditor.getDefault().isNew())\n\t\t{\n\t\t\tconst tour = new Tour({\n\t\t\t\titemCode: 'todo',\n\t\t\t\ttitle: Loc.getMessage('CRM_TIMELINE_TODO_GUIDE_TITLE'),\n\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_TODO_GUIDE_TEXT'),\n\t\t\t\tarticleCode: ARTICLE_CODE,\n\t\t\t\tuserOptionName: 'isTimelineTourViewedInWeb',\n\t\t\t\tguideBindElement,\n\t\t\t});\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tTourManager.getInstance().registerWithLaunch(tour);\n\t\t\t});\n\t\t}\n\t}\n}\n","import Item from '../item';\n\nexport default class Visit extends Item\n{\n\tshowSlider(): void\n\t{\n\t\tconst visitParameters = this.getSettings() ?? {};\n\t\tvisitParameters['OWNER_TYPE'] = BX.CrmEntityType.resolveName(this.getEntityTypeId());\n\t\tvisitParameters['OWNER_ID'] = this.getEntityId();\n\n\t\tBX.CrmActivityVisit.create(visitParameters).showEdit();\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn false;\n\t}\n}\n","/* eslint-disable no-underscore-dangle, @bitrix24/bitrix24-rules/no-pseudo-private */\n\nimport Wait from '../wait';\nimport { Loc, Tag, Dom, Text, Runtime } from 'main.core';\n\n/** @memberof BX.Crm.Timeline.Tools */\nexport default class WaitConfigurationDialog\n{\n\t_id: string;\n\t_settings: Object;\n\t_type: number;\n\t_duration: number;\n\t_target: string;\n\t_targetDates: Array;\n\t_container: HTMLElement;\n\t_durationInput: HTMLInputElement;\n\t_targetDateNode: HTMLElement;\n\t_popup = null;\n\t_menuId = null;\n\n\tconstructor()\n\t{\n\t\tthis._id = '';\n\t\tthis._settings = {};\n\t\tthis._type = Wait.WaitingType.undefined;\n\t\tthis._duration = 0;\n\t\tthis._target = '';\n\t\tthis._targetDates = [];\n\t\tthis._container = null;\n\t\tthis._durationInput = null;\n\t\tthis._targetDateNode = null;\n\t\tthis._popup = null;\n\t}\n\n\tinitialize(id, settings)\n\t{\n\t\tthis._id = BX.type.isNotEmptyString(id) ? id : BX.util.getRandomString(4);\n\t\tthis._settings = settings || {};\n\t\tthis._type = BX.prop.getInteger(this._settings, 'type', Wait.WaitingType.after);\n\t\tthis._duration = BX.prop.getInteger(this._settings, 'duration', 1);\n\t\tthis._target = BX.prop.getString(this._settings, 'target', '');\n\t\tthis._targetDates = BX.prop.getArray(this._settings, 'targetDates', []);\n\n\t\tthis._menuId = `${this._id}_target_date_sel`;\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this._id;\n\t}\n\n\tgetType(): number\n\t{\n\t\treturn this._type;\n\t}\n\n\tsetType(type: number): void\n\t{\n\t\tthis._type = type;\n\t}\n\n\tgetDuration(): number\n\t{\n\t\treturn this._duration;\n\t}\n\n\tsetDuration(duration: number): void\n\t{\n\t\tthis._duration = duration;\n\t}\n\n\tgetTarget(): string\n\t{\n\t\treturn this._target;\n\t}\n\n\tsetTarget(target: string): void\n\t{\n\t\tthis._target = target;\n\t}\n\n\tgetMessage(name)\n\t{\n\t\tconst messages = WaitConfigurationDialog.messages;\n\n\t\treturn Object.prototype.hasOwnProperty.call(messages, name)\n\t\t\t? messages[name]\n\t\t\t: name\n\t\t;\n\t}\n\n\tgetTargetDateCaption(): string\n\t{\n\t\treturn this._targetDates.find((targetDate) => targetDate.name === this._target)?.caption ?? '';\n\t}\n\n\tisBeforeWaitingType(): boolean\n\t{\n\t\treturn this.getType() === Wait.WaitingType.before;\n\t}\n\n\topen()\n\t{\n\t\tthis._popup = new BX.PopupWindow(\n\t\t\tthis._id,\n\t\t\tnull, // this._configSelector,\n\t\t\t{\n\t\t\t\tautoHide: true,\n\t\t\t\tdraggable: false,\n\t\t\t\tbindOptions: { forceBindPosition: false },\n\t\t\t\tcloseByEsc: true,\n\t\t\t\tzIndex: 0,\n\t\t\t\tcontent: this.renderDialogContent(),\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: this.onPopupShow.bind(this),\n\t\t\t\t\t\tonPopupClose: this.onPopupClose.bind(this),\n\t\t\t\t\t\tonPopupDestroy: this.onPopupDestroy.bind(this),\n\t\t\t\t\t},\n\t\t\t\tbuttons:\n\t\t\t\t\t[\n\t\t\t\t\t\tnew BX.PopupWindowButton(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('CRM_TIMELINE_CHOOSE'),\n\t\t\t\t\t\t\t\tclassName: 'popup-window-button-accept',\n\t\t\t\t\t\t\t\tevents: { click: this.onSaveButtonClick.bind(this) },\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t),\n\t\t\t\t\t\tnew BX.PopupWindowButtonLink(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext: Loc.getMessage('JS_CORE_WINDOW_CANCEL'),\n\t\t\t\t\t\t\t\tevents: { click: this.onCancelButtonClick.bind(this) },\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t),\n\t\t\t\t\t],\n\t\t\t},\n\t\t);\n\n\t\tthis._popup.show();\n\t}\n\n\tclose()\n\t{\n\t\tif (this._popup)\n\t\t{\n\t\t\tthis._popup.close();\n\t\t}\n\t}\n\n\trenderDialogContent(): HTMLElement\n\t{\n\t\tconst container = this.getContainer();\n\t\tcontainer.innerHTML = '';\n\n\t\tconst wrapper = Tag.render`<div class=\"crm-wait-popup-select-wrapper\"></div>`;\n\n\t\tconst contentTextNode = this.getContentTextNode();\n\t\tthis.appendDurationInput(contentTextNode);\n\t\tthis.appendTargetDateNode(contentTextNode);\n\n\t\tDom.append(contentTextNode, wrapper);\n\t\tDom.append(wrapper, container);\n\n\t\treturn container;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\tif (!this._container)\n\t\t{\n\t\t\tthis._container = Tag.render`<div class=\"crm-wait-popup-select-block\"></div>`;\n\t\t}\n\n\t\treturn this._container;\n\t}\n\n\tgetContentTextNode(): HTMLElement\n\t{\n\t\tconst phraseCode = this.isBeforeWaitingType()\n\t\t\t? 'CRM_TIMELINE_WAIT_CONFIG_DIALOG_BEFORE_CONTENT_TEXT'\n\t\t\t: 'CRM_TIMELINE_WAIT_CONFIG_DIALOG_AFTER_CONTENT_TEXT'\n\t\t;\n\n\t\t// put a container so that in the future you can put the input there\n\t\tconst replacement = {\n\t\t\t'#DAY_INPUT#': `<span class=\"crm-wait-duration-input-container\" id=\"${this.getDurationInputContainerId()}\"></span>`,\n\t\t\t'#TARGET_DATE#': this.isBeforeWaitingType()\n\t\t\t\t? `<span class=\"crm-wait-target-date-container\" id=\"${this.getTargetDateNodeContainerId()}\"></span>`\n\t\t\t\t: null\n\t\t\t,\n\t\t};\n\n\t\treturn Tag.render`\n\t\t\t<span class=\"crm-wait-text-wrapper crm-wait-popup-settings-title\">\n\t\t\t\t${Loc.getMessagePlural(phraseCode, this.getDuration(), replacement)}\n\t\t\t</span>\n\t\t`;\n\t}\n\n\tgetDurationInputContainerId(): string\n\t{\n\t\treturn `crm-wait-duration-input-container-${this.getId()}`;\n\t}\n\n\tgetDurationInput(): HTMLInputElement\n\t{\n\t\tif (!this._durationInput)\n\t\t{\n\t\t\tthis._durationInput = Tag.render`\n\t\t\t\t<input type=\"text\" class=\"crm-wait-popup-settings-input\" value=\"${this.getDuration()}\">\n\t\t\t`;\n\n\t\t\tthis._durationInput.onkeyup = Runtime.debounce(this.onDurationChange.bind(this), 300);\n\t\t}\n\n\t\treturn this._durationInput;\n\t}\n\n\tappendDurationInput(contentTextNode: HTMLElement): void\n\t{\n\t\tconst containerId = this.getDurationInputContainerId();\n\t\tconst container = contentTextNode.querySelector(`#${containerId}`);\n\n\t\tDom.append(this.getDurationInput(), container);\n\t}\n\n\tonDurationChange(): void\n\t{\n\t\tlet duration = parseInt(this.getDurationInput().value, 10);\n\t\tif (Number.isNaN(duration) || duration <= 0)\n\t\t{\n\t\t\tduration = 1;\n\t\t}\n\n\t\tthis._duration = duration;\n\n\t\tthis.renderDialogContent();\n\t\tthis.getDurationInput().focus();\n\t}\n\n\tgetTargetDateNodeContainerId(): string\n\t{\n\t\treturn `crm-wait-configuration-dialog-target-date-container-${this.getId()}`;\n\t}\n\n\tgetTargetDateNode(): HTMLElement\n\t{\n\t\tif (!this._targetDateNode)\n\t\t{\n\t\t\tthis._targetDateNode = Tag.render`\n\t\t\t\t<span class=\"crm-automation-popup-settings-link\">\n\t\t\t\t\t${Text.encode(this.getTargetDateCaption(this._target))}\n\t\t\t\t</span>\n\t\t\t`;\n\n\t\t\tthis._targetDateNode.onclick = this.toggleTargetMenu.bind(this);\n\t\t}\n\n\t\treturn this._targetDateNode;\n\t}\n\n\tappendTargetDateNode(contentTextNode: HTMLElement): void\n\t{\n\t\tif (!this.isBeforeWaitingType())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst containerId = this.getTargetDateNodeContainerId();\n\t\tconst container = contentTextNode.querySelector(`#${containerId}`);\n\n\t\tDom.append(this.getTargetDateNode(), container);\n\t}\n\n\ttoggleTargetMenu(): void\n\t{\n\t\tif (this.isTargetMenuOpened())\n\t\t{\n\t\t\tthis.closeTargetMenu();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.openTargetMenu();\n\t\t}\n\t}\n\n\tisTargetMenuOpened(): boolean\n\t{\n\t\treturn Boolean(BX.PopupMenu.getMenuById(this._menuId));\n\t}\n\n\topenTargetMenu(): void\n\t{\n\t\tconst menuItems = [];\n\t\tlet i = 0;\n\t\tconst length = this._targetDates.length;\n\t\tfor (; i < length; i++)\n\t\t{\n\t\t\tconst info = this._targetDates[i];\n\n\t\t\tmenuItems.push(\n\t\t\t\t{\n\t\t\t\t\ttext: info.caption,\n\t\t\t\t\ttitle: info.caption,\n\t\t\t\t\tvalue: info.name,\n\t\t\t\t\tonclick: this.onTargetSelect.bind(this),\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tBX.PopupMenu.show(\n\t\t\tthis._menuId,\n\t\t\tthis._targetDateNode,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\tzIndex: 200,\n\t\t\t\tautoHide: true,\n\t\t\t\toffsetLeft: Dom.getPosition(this.getTargetDateNode()).width / 2,\n\t\t\t\tangle: { position: 'top', offset: 0 },\n\t\t\t},\n\t\t);\n\t}\n\n\tcloseTargetMenu(): void\n\t{\n\t\tBX.PopupMenu.destroy(this._menuId);\n\t}\n\n\tonPopupShow(e, item): void\n\t{}\n\n\tonPopupClose(): void\n\t{\n\t\tif (this._popup)\n\t\t{\n\t\t\tthis._popup.destroy();\n\t\t}\n\n\t\tthis.closeTargetMenu();\n\t}\n\n\tonPopupDestroy(): void\n\t{\n\t\tif (this._popup)\n\t\t{\n\t\t\tthis._popup = null;\n\t\t}\n\t}\n\n\tonSaveButtonClick(e): void\n\t{\n\t\tthis.onDurationChange();\n\t\tconst callback = BX.prop.getFunction(this._settings, 'onSave', null);\n\t\tif (!callback)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tcallback(this, {\n\t\t\ttype: this.getType(),\n\t\t\tduration: this.getDuration(),\n\t\t\ttarget: this.isBeforeWaitingType() ? this.getTarget() : '',\n\t\t});\n\t}\n\n\tonCancelButtonClick(e): void\n\t{\n\t\tconst callback = BX.prop.getFunction(this._settings, 'onCancel', null);\n\t\tif (callback)\n\t\t{\n\t\t\tcallback(this);\n\t\t}\n\t}\n\n\tonTargetSelect(e, item): void\n\t{\n\t\tconst fieldName = BX.prop.getString(item, 'value', '');\n\t\tif (fieldName !== '')\n\t\t{\n\t\t\tthis._target = fieldName;\n\t\t\tthis._targetDateNode.innerHTML = BX.util.htmlspecialchars(this.getTargetDateCaption(fieldName));\n\t\t}\n\n\t\tthis.closeTargetMenu();\n\t\te.preventDefault ? e.preventDefault() : (e.returnValue = false);\n\t}\n\n\tstatic create(id: string, settings: Object): WaitConfigurationDialog\n\t{\n\t\tconst self = new WaitConfigurationDialog();\n\t\tself.initialize(id, settings);\n\n\t\treturn self;\n\t}\n\n\tstatic messages = {};\n}\n","import WithEditor from \"./witheditor\";\nimport WaitConfigurationDialog from \"./tools/wait-configuration-dialog\";\nimport {Loc, Tag} from \"main.core\";\n\n/** @memberof BX.Crm.Timeline.MenuBar */\n\nexport default class Wait extends WithEditor\n{\n\t#waitConfigContainer: HTMLElement = null;\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\tthis.#waitConfigContainer = Tag.render`<div class=\"crm-entity-stream-content-wait-conditions\"></div>`;\n\n\t\tthis._saveButton = Tag.render`<button onclick=\"${this.onSaveButtonClick.bind(this)}\" class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-round\" >${Loc.getMessage('CRM_TIMELINE_CREATE_WAITING')}</button>`;\n\t\tthis._cancelButton = Tag.render`<span onclick=\"${this.onCancelButtonClick.bind(this)}\"  class=\"ui-btn ui-btn-xs ui-btn-link\">${Loc.getMessage('CRM_TIMELINE_CANCEL_BTN')}</span>`;\n\t\tthis._input = Tag.render`<textarea rows=\"1\" class=\"crm-entity-stream-content-wait-comment-textarea\" placeholder=\"${Loc.getMessage('CRM_TIMELINE_WAIT_PLACEHOLDER')}\"></textarea>`;\n\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-wait-detail --focus --hidden\">\n\t\t\t<div class=\"crm-entity-stream-content-wait-conditions-container\">\n\t\t\t\t${this.#waitConfigContainer}\n\t\t\t</div>\n\t\t\t${this._input}\n\t\t\t<div class=\"crm-entity-stream-content-wait-comment-btn-container\">\n\t\t\t\t${this._saveButton}\n\t\t\t\t${this._cancelButton}\n\t\t\t</div>\n\t\t</div>`;\n\t}\n\n\tdoInitialize(): void\n\t{\n\t\tthis._isRequestRunning = false;\n\t\tthis._isLocked = false;\n\n\t\tthis._hideButtonsOnBlur = false;\n\t\t//region Config\n\t\tthis._type = Wait.WaitingType.after;\n\t\tthis._duration = 1;\n\t\tthis._target = \"\";\n\t\tthis._configSelector = null;\n\t\t//endregion\n\n\t\tthis._isMenuShown = false;\n\t\tthis._menu = null;\n\t\tthis._configDialog = null;\n\n\t\tthis._serviceUrl = this.getSetting('serviceUrl', '');\n\n\t\tconst config = this.getSetting('config', {});\n\t\tthis._type = Wait.WaitingType.resolveTypeId(\n\t\t\tBX.prop.getString(\n\t\t\t\tconfig,\n\t\t\t\t'type',\n\t\t\t\tWait.WaitingType.names.after\n\t\t\t)\n\t\t);\n\t\tthis._duration = BX.prop.getInteger(config, 'duration', 1);\n\t\tthis._target = BX.prop.getString(config, 'target', '');\n\t\tthis._targetDates =this.getSetting('targetDates', []);\n\t\tthis.layoutConfigurationSummary();\n\t}\n\n\tgetDurationText(duration, enableNumber)\n\t{\n\t\treturn Wait.Helper.getDurationText(duration, enableNumber);\n\t}\n\n\tgetTargetDateCaption(name)\n\t{\n\t\tlet i = 0;\n\t\tconst length = this._targetDates.length;\n\t\tfor(; i < length; i++)\n\t\t{\n\t\t\tconst info = this._targetDates[i];\n\t\t\tif(info[\"name\"] === name)\n\t\t\t{\n\t\t\t\treturn info[\"caption\"];\n\t\t\t}\n\t\t}\n\n\t\treturn \"\";\n\t}\n\n\tonSelectorClick(e)\n\t{\n\t\tif(!this._isMenuShown)\n\t\t{\n\t\t\tthis.openMenu();\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.closeMenu();\n\t\t}\n\t\te.preventDefault ? e.preventDefault() : (e.returnValue = false);\n\t}\n\n\topenMenu()\n\t{\n\t\tif(this._isMenuShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst handler = BX.delegate(this.onMenuItemClick, this);\n\n\t\tconst menuItems =\n\t\t\t[\n\t\t\t\t{id: \"day_1\", text: Loc.getMessage('CRM_TIMELINE_WAIT_1D'), onclick: handler},\n\t\t\t\t{id: \"day_2\", text: Loc.getMessage('CRM_TIMELINE_WAIT_2D'), onclick: handler},\n\t\t\t\t{id: \"day_3\", text: Loc.getMessage('CRM_TIMELINE_WAIT_3D'), onclick: handler},\n\t\t\t\t{id: \"week_1\", text: Loc.getMessage('CRM_TIMELINE_WAIT_1W'), onclick: handler},\n\t\t\t\t{id: \"week_2\", text: Loc.getMessage('CRM_TIMELINE_WAIT_2W'), onclick: handler},\n\t\t\t\t{id: \"week_3\", text: Loc.getMessage('CRM_TIMELINE_WAIT_3W'), onclick: handler}\n\t\t\t];\n\n\t\tconst customMenu = {id: \"custom\", text: Loc.getMessage('CRM_TIMELINE_WAIT_CUSTOM'), items: []};\n\t\tcustomMenu[\"items\"].push({ id: \"afterDays\", text: Loc.getMessage('CRM_TIMELINE_WAIT_AFTER_CUSTOM_DAYS'), onclick: handler });\n\t\tif(this._targetDates.length > 0)\n\t\t{\n\t\t\tcustomMenu[\"items\"].push({ id: \"beforeDate\", text: Loc.getMessage('CRM_TIMELINE_WAIT_BEFORE_CUSTOM_DATE'), onclick: handler });\n\t\t}\n\t\tmenuItems.push(customMenu);\n\n\t\tBX.PopupMenu.show(\n\t\t\tthis._id,\n\t\t\tthis._configSelector,\n\t\t\tmenuItems,\n\t\t\t{\n\t\t\t\toffsetTop: 0,\n\t\t\t\toffsetLeft: 36,\n\t\t\t\tangle: { position: \"top\", offset: 0 },\n\t\t\t\tevents:\n\t\t\t\t\t{\n\t\t\t\t\t\tonPopupShow: BX.delegate(this.onMenuShow, this),\n\t\t\t\t\t\tonPopupClose: BX.delegate(this.onMenuClose, this),\n\t\t\t\t\t\tonPopupDestroy: BX.delegate(this.onMenuDestroy, this)\n\t\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis._menu = BX.PopupMenu.currentItem;\n\t}\n\n\tcloseMenu()\n\t{\n\t\tif(!this._isMenuShown)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif(this._menu)\n\t\t{\n\t\t\tthis._menu.close();\n\t\t}\n\t}\n\n\tonMenuItemClick(e, item)\n\t{\n\t\tthis.closeMenu();\n\n\t\tif(item.id === \"afterDays\" || item.id === \"beforeDate\")\n\t\t{\n\t\t\tthis.openConfigDialog(\n\t\t\t\titem.id === \"afterDays\" ? Wait.WaitingType.after : Wait.WaitingType.before\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst params = {type: Wait.WaitingType.after};\n\t\tif(item.id === \"day_1\")\n\t\t{\n\t\t\tparams[\"duration\"] = 1;\n\t\t}\n\t\telse if(item.id === \"day_2\")\n\t\t{\n\t\t\tparams[\"duration\"] = 2;\n\t\t}\n\t\telse if(item.id === \"day_3\")\n\t\t{\n\t\t\tparams[\"duration\"] = 3;\n\t\t}\n\t\tif(item.id === \"week_1\")\n\t\t{\n\t\t\tparams[\"duration\"] = 7;\n\t\t}\n\t\telse if(item.id === \"week_2\")\n\t\t{\n\t\t\tparams[\"duration\"] = 14;\n\t\t}\n\t\telse if(item.id === \"week_3\")\n\t\t{\n\t\t\tparams[\"duration\"] = 21;\n\t\t}\n\t\tthis.saveConfiguration(params);\n\t}\n\n\topenConfigDialog(type)\n\t{\n\t\tif(!this._configDialog)\n\t\t{\n\t\t\tthis._configDialog = WaitConfigurationDialog.create(\n\t\t\t\t\"\",\n\t\t\t\t{\n\t\t\t\t\ttargetDates: this._targetDates,\n\t\t\t\t\tonSave: BX.delegate(this.onConfigDialogSave, this),\n\t\t\t\t\tonCancel: BX.delegate(this.onConfigDialogCancel, this)\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tthis._configDialog.setType(type);\n\t\tthis._configDialog.setDuration(this._duration);\n\n\t\tlet target = this._target;\n\t\tif(target === \"\" && this._targetDates.length > 0)\n\t\t{\n\t\t\ttarget = this._targetDates[0][\"name\"];\n\t\t}\n\t\tthis._configDialog.setTarget(target);\n\t\tthis._configDialog.open();\n\t}\n\n\tonConfigDialogSave(sender, params)\n\t{\n\t\tthis.saveConfiguration(params);\n\t\tthis._configDialog.close();\n\t}\n\n\tonConfigDialogCancel(sender)\n\t{\n\t\tthis._configDialog.close();\n\t}\n\n\tonMenuShow()\n\t{\n\t\tthis._isMenuShown = true;\n\t}\n\n\tonMenuClose()\n\t{\n\t\tif(this._menu && this._menu.popupWindow)\n\t\t{\n\t\t\tthis._menu.popupWindow.destroy();\n\t\t}\n\t}\n\n\tonMenuDestroy()\n\t{\n\t\tthis._isMenuShown = false;\n\t\tthis._menu = null;\n\n\t\tif(typeof(BX.PopupMenu.Data[this._id]) !== \"undefined\")\n\t\t{\n\t\t\tdelete(BX.PopupMenu.Data[this._id]);\n\t\t}\n\t}\n\n\tsaveConfiguration(params)\n\t{\n\t\t//region Parse params\n\t\tthis._type = BX.prop.getInteger(params, \"type\", Wait.WaitingType.after);\n\t\tthis._duration = BX.prop.getInteger(params, \"duration\", 0);\n\t\tif(this._duration <= 0)\n\t\t{\n\t\t\tthis._duration = 1;\n\t\t}\n\t\tthis._target = this._type === Wait.WaitingType.before\n\t\t\t? BX.prop.getString(params, \"target\", \"\") : \"\";\n\t\t//endregion\n\t\t//region Save settings\n\t\tconst optionName = this.getSetting('optionName');\n\t\tBX.userOptions.save(\n\t\t\t\"crm.timeline.wait\",\n\t\t\toptionName,\n\t\t\t\"type\",\n\t\t\tthis._type === Wait.WaitingType.after ? \"after\" : \"before\"\n\t\t);\n\n\t\tBX.userOptions.save(\n\t\t\t\"crm.timeline.wait\",\n\t\t\toptionName,\n\t\t\t\"duration\",\n\t\t\tthis._duration\n\t\t);\n\n\t\tBX.userOptions.save(\n\t\t\t\"crm.timeline.wait\",\n\t\t\toptionName,\n\t\t\t\"target\",\n\t\t\tthis._target\n\t\t);\n\t\t//endregion\n\t\tthis.layoutConfigurationSummary();\n\t}\n\n\tgetSummaryHtml()\n\t{\n\t\tif(this._type === Wait.WaitingType.before)\n\t\t{\n\t\t\treturn (\n\t\t\t\tLoc.getMessage('CRM_TIMELINE_WAIT_COMPLETION_TYPE_BEFORE')\n\t\t\t\t\t.replace(\"#DURATION#\", this.getDurationText(this._duration, true))\n\t\t\t\t\t.replace(\"#TARGET_DATE#\", this.getTargetDateCaption(this._target))\n\t\t\t);\n\t\t}\n\n\t\treturn (\n\t\t\tLoc.getMessage('CRM_TIMELINE_WAIT_COMPLETION_TYPE_AFTER')\n\t\t\t\t.replace(\"#DURATION#\", this.getDurationText(this._duration, true))\n\t\t);\n\t}\n\n\tgetSummaryText()\n\t{\n\t\treturn BX.util.strip_tags(this.getSummaryHtml());\n\t}\n\n\tlayoutConfigurationSummary()\n\t{\n\t\tthis.#waitConfigContainer.innerHTML = this.getSummaryHtml();\n\t\tthis._configSelector = this.#waitConfigContainer.querySelector(\"a\");\n\t\tif(this._configSelector)\n\t\t{\n\t\t\tBX.bind(this._configSelector, 'click', this.onSelectorClick.bind(this));\n\t\t}\n\t}\n\n\tpostpone(id, offset, callback)\n\t{\n\t\tBX.ajax(\n\t\t\t{\n\t\t\t\turl: this._serviceUrl,\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tdataType: \"json\",\n\t\t\t\tdata:\n\t\t\t\t\t{\n\t\t\t\t\t\t\"ACTION\": \"POSTPONE_WAIT\",\n\t\t\t\t\t\t\"DATA\": { \"ID\": id, \"OFFSET\": offset }\n\t\t\t\t\t},\n\t\t\t\tonsuccess: callback\n\t\t\t}\n\t\t);\n\t}\n\n\tcomplete(id, completed, callback)\n\t{\n\t\tBX.ajax(\n\t\t\t{\n\t\t\t\turl: this._serviceUrl,\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tdataType: \"json\",\n\t\t\t\tdata:\n\t\t\t\t\t{\n\t\t\t\t\t\t\"ACTION\": \"COMPLETE_WAIT\",\n\t\t\t\t\t\t\"DATA\": { \"ID\": id, \"COMPLETED\": completed ? 'Y' : 'N' }\n\t\t\t\t\t},\n\t\t\t\tonsuccess: callback\n\t\t\t}\n\t\t);\n\t}\n\n\tsave()\n\t{\n\t\tif(this._isRequestRunning || this._isLocked)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tlet description = this.getSummaryText();\n\t\tconst comment = BX.util.trim(this._input.value);\n\t\tif(comment !== \"\")\n\t\t{\n\t\t\tdescription += \"\\n\" + comment;\n\t\t}\n\n\t\tconst data =\n\t\t\t{\n\t\t\t\tID: 0,\n\t\t\t\ttypeId: this._type,\n\t\t\t\tduration: this._duration,\n\t\t\t\ttargetFieldName: this._target,\n\t\t\t\tsubject: \"\",\n\t\t\t\tdescription: description,\n\t\t\t\tcompleted: 0,\n\t\t\t\townerType: BX.CrmEntityType.resolveName(this.getEntityTypeId()),\n\t\t\t\townerID: this.getEntityId()\n\t\t\t};\n\n\t\tBX.ajax(\n\t\t\t{\n\t\t\t\turl: this._serviceUrl,\n\t\t\t\tmethod: \"POST\",\n\t\t\t\tdataType: \"json\",\n\t\t\t\tdata:\n\t\t\t\t\t{\n\t\t\t\t\t\t\"ACTION\": \"SAVE_WAIT\",\n\t\t\t\t\t\t\"DATA\": data\n\t\t\t\t\t},\n\t\t\t\tonsuccess: BX.delegate(this.onSaveSuccess, this),\n\t\t\t\tonfailure: BX.delegate(this.onSaveFailure, this)\n\t\t\t}\n\t\t);\n\t\tthis._isRequestRunning = this._isLocked = true;\n\t}\n\n\tcancel()\n\t{\n\t\tthis._input.value = \"\";\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.release();\n\t}\n\n\tonSaveSuccess(data)\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\n\t\tconst error = BX.prop.getString(data, \"ERROR\", \"\");\n\t\tif(error !== \"\")\n\t\t{\n\t\t\talert(error);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._input.value = \"\";\n\t\tthis._input.style.minHeight = \"\";\n\t\tthis.emitFinishEditEvent();\n\t\tthis.release();\n\t}\n\n\tonSaveFailure()\n\t{\n\t\tthis._isRequestRunning = this._isLocked = false;\n\t}\n\n\tgetMessage(name)\n\t{\n\t\tconst m = Wait.messages;\n\t\treturn m.hasOwnProperty(name) ? m[name] : name;\n\t}\n\n\tstatic WaitingType = {\n\t\tundefined: 0,\n\t\tafter: 1,\n\t\tbefore: 2,\n\n\t\tnames:\n\t\t\t{\n\t\t\t\tafter: \"after\",\n\t\t\t\tbefore: \"before\"\n\t\t\t},\n\t\tresolveTypeId: function(name)\n\t\t{\n\t\t\tif(name === this.names.after)\n\t\t\t{\n\t\t\t\treturn this.after;\n\t\t\t}\n\t\t\telse if(name === this.names.before)\n\t\t\t{\n\t\t\t\treturn this.before;\n\t\t\t}\n\n\t\t\treturn this.undefined;\n\t\t}\n\t};\n\n\tstatic messages = {};\n\n\tstatic Helper =\n\t{\n\t\tgetDurationText: function(duration, enableNumber)\n\t\t{\n\t\t\tenableNumber = !!enableNumber;\n\n\t\t\tlet result = \"\";\n\t\t\tlet type = \"D\";\n\t\t\tif(enableNumber)\n\t\t\t{\n\t\t\t\tif((duration % 7) === 0)\n\t\t\t\t{\n\t\t\t\t\tduration = duration / 7;\n\t\t\t\t\ttype = \"W\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (type === \"W\")\n\t\t\t{\n\t\t\t\tresult = BX.Loc.getMessagePlural('CRM_TIMELINE_WAIT_WEEK', duration);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tresult = BX.Loc.getMessagePlural('CRM_TIMELINE_WAIT_DAY', duration);\n\t\t\t}\n\n\t\t\tif(enableNumber)\n\t\t\t{\n\t\t\t\tresult = duration.toString() + \" \" + result;\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t\tgetMessage: function(name)\n\t\t{\n\t\t\treturn Wait.Helper.messages.hasOwnProperty(name) ? Wait.Helper.messages[name] : name;\n\t\t},\n\t\tmessages: {},\n\t}\n}\n","import Item from '../item';\nimport { Loc, Tag } from 'main.core';\nimport { Zoom as ZoomEditor } from 'crm.zoom';\n\nexport default class Zoom extends Item\n{\n\t#editor: ZoomEditor = null;\n\n\tshowSlider(): void\n\t{\n\t\tif (this.getSetting('isAvailable'))\n\t\t{\n\t\t\tBX.Crm.Zoom.onNotConnectedHandler(Loc.getMessage('USER_ID'));\n\t\t}\n\t\telse // not available\n\t\t{\n\t\t\tBX.Crm.Zoom.onNotAvailableHandler();\n\t\t}\n\t}\n\n\tsupportsLayout(): Boolean\n\t{\n\t\treturn this.getSetting('isConnected') && this.getSetting('isAvailable');\n\t}\n\n\tcreateLayout(): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"crm-entity-stream-content-new-detail ui-timeline-zoom-editor --focus --hidden\"></div>`;\n\t}\n\n\tonFocus(e)\n\t{\n\t\tthis.setFocused(true);\n\t}\n\n\tonShow()\n\t{\n\t\tif (!this.#editor)\n\t\t{\n\t\t\tthis.#createEditor();\n\t\t}\n\t}\n\n\t#createEditor(): void\n\t{\n\t\tthis.#editor = new ZoomEditor({\n\t\t\townerTypeId: this.getEntityTypeId(),\n\t\t\townerId: this.getEntityId(),\n\t\t\tcontainer: this.getContainer(),\n\t\t\tonFinishEdit: this.#onFinishEdit.bind(this),\n\t\t\tonStartSave: () => this.setLocked(true),\n\t\t\tonFinishSave: () => this.setLocked(false),\n\t\t});\n\t}\n\n\t#onFinishEdit(): void\n\t{\n\t\tthis.emitFinishEditEvent();\n\t}\n}\n","import { Type } from 'main.core';\nimport Context from './context';\nimport Item from './item';\nimport Booking from './items/booking/booking';\nimport Call from './items/call';\nimport Comment from './items/comment';\nimport Delivery from './items/delivery';\nimport EInvoiceApp from './items/einvoice-app';\nimport Email from './items/email';\nimport GoToChat from './items/gotochat/gotochat';\nimport Market from './items/market';\nimport Meeting from './items/meeting';\nimport RestPlacementWithLayout from './items/restplacement/withlayout';\nimport RestPlacementWithSlider from './items/restplacement/withslider';\nimport Sharing from './items/sharing';\nimport Message from './items/sms/message';\nimport Sms from './items/sms/sms';\nimport Whatsapp from './items/sms/whatsapp';\nimport Task from './items/task';\nimport ToDo from './items/todo/todo';\nimport Visit from './items/visit';\nimport Wait from './items/wait';\nimport Zoom from './items/zoom';\n\nexport default class Factory\n{\n\tstatic createItem(id: String, context: Context, settings: ?Object): Item\n\t{\n\t\tlet item = null;\n\n\t\tswitch (id)\n\t\t{\n\t\t\tcase 'todo':\n\t\t\t\titem = new ToDo();\n\t\t\t\tbreak;\n\t\t\tcase 'comment':\n\t\t\t\titem = new Comment();\n\t\t\t\tbreak;\n\t\t\tcase 'sms':\n\t\t\t\titem = new Sms();\n\t\t\t\tbreak;\n\t\t\tcase 'whatsapp':\n\t\t\t\titem = new Whatsapp();\n\t\t\t\tbreak;\n\t\t\tcase 'message':\n\t\t\t\titem = new Message();\n\t\t\t\tbreak;\n\t\t\tcase 'gotochat':\n\t\t\t\titem = new GoToChat();\n\t\t\t\tbreak;\n\t\t\tcase 'call':\n\t\t\t\titem = new Call();\n\t\t\t\tbreak;\n\t\t\tcase 'email':\n\t\t\t\titem = new Email();\n\t\t\t\tbreak;\n\t\t\tcase 'meeting':\n\t\t\t\titem = new Meeting();\n\t\t\t\tbreak;\n\t\t\tcase 'task':\n\t\t\t\titem = new Task();\n\t\t\t\tbreak;\n\t\t\tcase 'sharing':\n\t\t\t\titem = new Sharing();\n\t\t\t\tbreak;\n\t\t\tcase 'wait':\n\t\t\t\titem = new Wait();\n\t\t\t\tbreak;\n\t\t\tcase 'zoom':\n\t\t\t\titem = new Zoom();\n\t\t\t\tbreak;\n\t\t\tcase 'delivery':\n\t\t\t\titem = new Delivery();\n\t\t\t\tbreak;\n\t\t\tcase 'visit':\n\t\t\t\titem = new Visit();\n\t\t\t\tbreak;\n\t\t\tcase 'activity_rest_applist':\n\t\t\t\titem = new Market();\n\t\t\t\tbreak;\n\t\t\tcase 'einvoice_app_installer':\n\t\t\t\titem = new EInvoiceApp();\n\t\t\t\tbreak;\n\t\t\tcase 'booking':\n\t\t\t\titem = new Booking();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\titem = null;\n\t\t}\n\n\t\tif (!item && id.startsWith('activity_rest_'))\n\t\t{\n\t\t\tif (Type.isPlainObject(settings) && Type.isBoolean(settings.useBuiltInInterface) && settings.useBuiltInInterface)\n\t\t\t{\n\t\t\t\titem = new RestPlacementWithLayout();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\titem = new RestPlacementWithSlider();\n\t\t\t}\n\t\t}\n\n\t\tif (item)\n\t\t{\n\t\t\titem.initialize(context, settings);\n\t\t}\n\n\t\treturn item;\n\t}\n}\n","/** @memberof BX.Crm.Timeline.MenuBar */\n\nimport { Dom } from 'main.core';\nimport Context from './context';\nimport Factory from './factory';\nimport Item from './item';\n\ndeclare type MenuBarParams = {\n\tcontainerId: String,\n\tentityTypeId: Number,\n\tentityId: Number,\n\tentityCategoryId: ?Number,\n\tisReadonly: Boolean,\n\tmenuId: String,\n\titems: MenuBarItemParams[],\n\textras?: Extras,\n}\n\ndeclare type MenuBarItemParams = {\n\tid: String,\n\tsettings: ?Object,\n}\n\ndeclare type Extras = {\n\tanalytics: Object;\n}\n\nexport class MenuBar\n{\n\t#entityTypeId: Number = null;\n\t#entityId: Number = null;\n\t#entityCategoryId: Number = null;\n\t#isReadonly: Boolean = false;\n\t#container: HTMLElement = null;\n\t#items = {};\n\t#extras: Extras = {};\n\t#selectedItemId: String = null;\n\t#menu: BX.Main.interfaceButtons = null;\n\n\tconstructor(id: String, params: MenuBarParams)\n\t{\n\t\tthis.#entityTypeId = params.entityTypeId;\n\t\tthis.#entityId = params.entityId;\n\t\tthis.#entityCategoryId = params.entityCategoryId;\n\t\tthis.#isReadonly = params.isReadonly;\n\t\tthis.#extras = params.extras ?? {};\n\n\t\tthis.#container = document.getElementById(params.containerId);\n\t\tconst menuId = params.menuId ?? (BX.CrmEntityType.resolveName(this.#entityTypeId) + '_menu').toLowerCase();\n\t\tthis.#menu = BX.Main.interfaceButtonsManager.getById(menuId);\n\n\t\tconst context = new Context({\n\t\t\tentityTypeId: this.#entityTypeId,\n\t\t\tentityId: this.#entityId,\n\t\t\tentityCategoryId: this.#entityCategoryId,\n\t\t\tisReadonly: this.#isReadonly,\n\t\t\tmenuBarContainer: this.#container,\n\t\t\textras: this.#extras,\n\t\t});\n\n\t\t(params.items).forEach((itemData) => {\n\t\t\tconst id = itemData.id;\n\t\t\tconst item = Factory.createItem(id, context, itemData.settings ?? null);\n\t\t\tif (item)\n\t\t\t{\n\t\t\t\titem.addFinishEditListener(this.#onItemFinishEdit.bind(this));\n\t\t\t\tthis.#items[id] = item;\n\t\t\t}\n\t\t});\n\n\t\tthis.setActiveItemById(this.getFirstItemIdWithLayout());\n\t}\n\n\tgetItemById(id: String): ?Item\n\t{\n\t\treturn this.#items[id] ?? null;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.#container;\n\t}\n\n\tonMenuItemClick(selectedItemId: String): void\n\t{\n\t\tif (this.#isReadonly)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tthis.setActiveItemById(selectedItemId);\n\t}\n\n\tsetActiveItemById(selectedItemId: String): Boolean\n\t{\n\t\tif (!selectedItemId || this.#selectedItemId === selectedItemId)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst menuBarItem = this.#items[selectedItemId];\n\t\tif (!menuBarItem)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tmenuBarItem.activate();\n\n\t\tif (!this.#isReadonly && menuBarItem.supportsLayout())\n\t\t{\n\t\t\tObject.keys(this.#items).forEach(itemId => {\n\t\t\t\tif (itemId !== selectedItemId)\n\t\t\t\t{\n\t\t\t\t\tthis.#items[itemId].deactivate();\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.#selectMenuItem(selectedItemId);\n\t\t\tthis.#selectedItemId = selectedItemId;\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tscrollIntoView(): void\n\t{\n\t\tthis\n\t\t\t.getContainer()\n\t\t\t.scrollIntoView({\n\t\t\t\tbehavior: 'smooth',\n\t\t\t\tblock: 'end',\n\t\t\t\tinline: 'nearest',\n\t\t\t})\n\t\t;\n\t}\n\n\t#onItemFinishEdit(): void\n\t{\n\t\tthis.setActiveItemById(this.getFirstItemIdWithLayout());\n\t}\n\n\tgetFirstItemIdWithLayout(): ?Item\n\t{\n\t\tif (this.#isReadonly)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tlet firstId = null;\n\t\tthis.#menu.getAllItems().forEach(function (itemElement) {\n\t\t\tif (firstId === null)\n\t\t\t{\n\t\t\t\tconst id = itemElement.dataset.id;\n\t\t\t\tconst item = this.#items[id];\n\t\t\t\tif (item && item.supportsLayout())\n\t\t\t\t{\n\t\t\t\t\tfirstId = id;\n\t\t\t\t}\n\t\t\t}\n\t\t}.bind(this));\n\n\t\treturn firstId;\n\t}\n\n\tstatic create(id: String, params: MenuBarParams): MenuBar\n\t{\n\t\tconst self = new MenuBar(id, params);\n\t\tMenuBar.instances[id] = self;\n\n\t\treturn self;\n\t}\n\n\tstatic getDefault(): ?MenuBar\n\t{\n\t\treturn MenuBar.#defaultInstance;\n\t}\n\tstatic setDefault(instance: MenuBar): void\n\t{\n\t\tMenuBar.#defaultInstance = instance;\n\t}\n\n\tstatic getById(id): ?MenuBar\n\t{\n\t\treturn MenuBar.instances[id] || null;\n\t}\n\n\tstatic #defaultInstance = null;\n\tstatic instances = {};\n\n\t#selectMenuItem(id: String): void\n\t{\n\t\tconst activeItem = this.#menu.getItemById(this.#selectedItemId);\n\t\tconst currentDiv = this.#menu.getItemById(id);\n\t\tlet wasActiveInMoreMenu = false;\n\t\tif (currentDiv && activeItem !== currentDiv)\n\t\t{\n\t\t\twasActiveInMoreMenu = this.#menu.isActiveInMoreMenu();\n\t\t\tDom.addClass(currentDiv, this.#menu.classes.itemActive);\n\n\t\t\tif (this.#menu.getItemData)\n\t\t\t{\n\t\t\t\tconst currentDivData = this.#menu.getItemData(currentDiv);\n\t\t\t\tcurrentDivData['IS_ACTIVE'] = true;\n\t\t\t\tif (BX.type.isDomNode(activeItem))\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(activeItem, this.#menu.classes.itemActive);\n\t\t\t\t\tconst activeItemData = this.#menu.getItemData(activeItem);\n\t\t\t\t\tactiveItemData['IS_ACTIVE'] = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst isActiveInMoreMenu = this.#menu.isActiveInMoreMenu();\n\t\t\tif (isActiveInMoreMenu || wasActiveInMoreMenu)\n\t\t\t{\n\t\t\t\tconst submenu = this.#menu.getSubmenu();\n\t\t\t\tif (submenu)\n\t\t\t\t{\n\t\t\t\t\tsubmenu.getMenuItems().forEach((menuItem) => {\n\t\t\t\t\t\tconst container = menuItem.getContainer();\n\t\t\t\t\t\tif (isActiveInMoreMenu && container.title === currentDiv.title)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDom.addClass(container, this.#menu.classes.itemActive);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (wasActiveInMoreMenu && container.title === activeItem.title)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tDom.removeClass(container, this.#menu.classes.itemActive);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (isActiveInMoreMenu)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.#menu.getMoreButton(), this.#menu.classes.itemActive);\n\t\t\t\t}\n\t\t\t\telse if (wasActiveInMoreMenu)\n\t\t\t\t{\n\t\t\t\t\tDom.removeClass(this.#menu.getMoreButton(), this.#menu.classes.itemActive);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.#menu.closeSubmenu();\n\t}\n}\n"],"names":["Context","constructor","params","entityTypeId","entityId","Type","isNumber","entityCategoryId","isReadonly","menuBarContainer","extras","getEntityTypeId","getEntityId","getEntityCategoryId","getMenuBarContainer","getExtras","Item","initialize","context","settings","EventEmitter","setEventNamespace","initializeSettings","supportsLayout","createLayout","Dom","prepend","initializeLayout","showTour","getContainer","setContainer","container","isDomNode","remove","activate","setVisible","showSlider","deactivate","Error","getSetting","setting","defaultValue","setSettings","getSettings","visible","removeClass","onShow","onHide","addClass","isVisible","setFocused","isFocused","setLocked","isLocked","hasClass","addFinishEditListener","callback","subscribe","ON_FINISH_EDIT_EVENT","emitFinishEditEvent","emit","showNotify","content","UI","Notification","Center","notify","SPOTLIGHT_ID_PREFIX","SPOTLIGHT_TARGET_VERTEX","SPOTLIGHT_Z_INDEX","GUIDE_LINK_CLASS_NAME","GUIDE_POPUP_WIDTH","GUIDE_POPUP_POSITION","BaseTour","TypeError","onWindowResize","Runtime","debounce","bind","Event","window","target","getCurrentStep","setTarget","showNextStep","setTargetElement","canShow","show","getGuide","guideCfg","onEvents","steps","title","text","position","rounded","events","onClose","saveUserOption","userOptionName","close","clearInterval","unbind","articleCode","article","linkTitle","Loc","getMessage","guide","Guide","guidePopup","getPopup","setWidth","guidePopupWidth","link","contentContainer","querySelector","getPosition","setInterval","optionName","console","warn","getParams","spotlight","BX","SpotLight","id","itemCode","targetElement","targetVertex","zIndex","autoSave","bindEvents","onTargetEnter","stayShowedSpotlight","force","guideBindElement","document","offsetTop","parentElement","nextElementSibling","currentRect","left","right","top","bottom","Boolean","offsetWidth","offsetHeight","getClientRects","length","popupContainer","adjustPosition","isPlainObject","error","isStringFilled","UserOptions","Reflection","namespace","Options","save","BOOKING_ADS_OPTION","START_BANNER","BEFORE_FIRST_RESOURCE_AHA_OPTION_NAME","AFTER_FIRST_RESOURCE_AHA_OPTION_NAME","includes","Tour","Resolvable","resolve","promise","Promise","res","BannerAnalytics","sendShowPopup","options","tool","ANALYTICS_TOOL_BOOKING","category","ANALYTICS_CATEGORY_BOOKING","event","c_section","ANALYTICS_SECTION_CRM","sendData","sendClickEnable","Booking","BannerDispatcher","entities","embedEntities","JSON","stringify","url","SidePanel","Instance","open","customLeftBoundary","toQueue","onDone","bannerClosed","Priority","CRITICAL","app","create","append","body","mount","onBannerClose","PromoBanner","loadExtension","BitrixVue","createApp","components","data","isBannerShown","methods","buttonClick","template","mixin","loc","name","replacements","shouldShowBanner","ahaParams","tour","setAutoHide","TourManager","getInstance","registerWithLaunch","ahaMoments","isEnabled","featureId","then","FeaturePromotersRegistry","getPromoter","catch","Call","planner","Crm","Activity","Planner","showEdit","CrmActivityType","call","WithEditor","_ownerTypeId","_ownerId","_ownerCategoryId","_ghostInput","_saveButtonHandler","delegate","onSaveButtonClick","_cancelButtonHandler","onCancelButtonClick","_focusHandler","onFocus","_blurHandler","onBlur","_keyupHandler","resizeForm","_delayedKeyupHandler","setTimeout","_hideButtonsOnBlur","bindInputHandlers","doInitialize","_input","e","value","style","minHeight","saveResult","cancel","release","ensureGhostCreated","props","className","width","appendChild","ghost","computedStyle","getComputedStyle","diff","parseInt","paddingBottom","paddingTop","borderTopWidth","borderBottomWidth","innerHTML","util","htmlspecialchars","replace","scrollHeight","Comment","_saveButton","Tag","render","_cancelButton","_postForm","_editor","_isRequestRunning","_isLocked","loadEditor","_editorName","ajax","runAction","onLoadEditorSuccess","result","html","prop","getString","getObject","_editorContainer","showEditor","addEvents","addCustomEvent","firstElementChild","item","removeEventListener","file","controller","obj","blob","addEventListener","LHEPostForm","getHandler","BXHtmlEditor","Get","onCustomEvent","eventNode","display","Focus","type","attrs","attachmentList","attachmentAllowEditOptions","oEditor","GetContent","querySelectorAll","forEach","input","push","isArrayFilled","selectorName","selector","emptyCommentMessage","PopupWindow","message","darkMode","autoHide","angle","offset","closeByEsc","bindOptions","forceBindPosition","addedData","fields","ENTITY_ID","ENTITY_TYPE_ID","COMMENT","ATTACHMENTS","Object","keys","CRM_TIMELINE_DISK_ATTACHED_OBJECT_ALLOW_EDIT","onSaveSuccess","onSaveFailure","reinit","Delivery","CrmActivityEditor","getDefault","addDelivery","CrmEntityType","resolveName","CrmTimelineManager","getOwnerInfo","EInvoiceApp","allowChangeHistory","Email","ownerInfo","addEmail","ServicesConfig","Map","connectorId","connectLabel","inviteLabel","soonLabel","region","commonClass","iconClass","Social","WHATSAPP","checkServiceId","TELEGRAM_IN_CIRCLE","iconColor","disabledLabel","disabledHint","hideOnBox","FACEBOOK","MENU_ITEM_STUB_ID","ACTIVE_MENU_ITEM_CLASS","DEFAULT_MENU_ITEM_CLASS","TOOLBAR_CONTAINER_CLASS","BUTTONS_CONTAINER_CLASS","CLIENTS_SELECTOR_TITLE_CLASS","HELP_ARTICLE_CODE","GoToChat","selectedClient","settingsMenu","channels","communications","currentChannelId","fromPhoneId","toName","toPhoneId","openLineItems","hasClients","isFetchedConfig","isSending","marketplaceUrl","onSelectClient","onSelectClientPhone","onSelectSender","onSelectSenderPhone","onSelectTelegramOpenLineId","tourString","onToggleClientSelector","Dialog","targetNode","multiple","dropdownMode","showAvatars","enableSearch","isOpen","hide","setTargetNode","getData","resolveId","isBound","adjustLayout","EntityEditor","reload","initSettingsMenu","menuId","items","MenuManager","bindElement","delimiter","onSubMenuShow","getChannelsSubmenuItems","disabled","getPhoneSubMenuItems","telegrambot","selected","getTelegramOpenLinesSubMenuItems","onShowClientPhoneSelector","getElementById","ClientSelector","createFromCommunications","onSelect","setSelected","customData","get","getCurrentCommunication","caption","getCurrentPhone","client","isObjectLike","phones","find","phone","communication","Number","showRegistrarAndSend","code","showButtonLoader","service","lineId","ConditionChecker","checkAndGetLine","openLineCode","senderType","getSenderType","serviceId","send","saveEntityEditor","saveChanged","ownerTypeId","ownerId","senderId","from","to","ajaxParameters","errors","button","SenderTypes","bitrix24","sms","getEntityAvatarPath","entityTypeName","toLowerCase","whiteList","shortName","canUse","fromList","onclick","channel","currentChannel","telegram","list","selectedItem","userOptions","loader","destroy","services","Array","isArray","defaultPhone","default","clientStart","clientFinish","titleContainer","childNodes","contact","dynamicLoad","dynamicSearch","showTab","showPhones","showMails","company","excludeMyCompany","enumeration","clientId","clientTypeId","ajaxParams","Helper","getTarget","itemOptionsToAdd","getSubMenu","addMenuItem","removeMenuItem","clientElement","Text","encode","valueFormatted","titleElement","firstChild","labelIndex","textContent","indexOf","nodeValue","insertBefore","splitText","clean","oldContainer","newContainer","buttonsContainer","values","Hint","init","set","label","hint","attr","icon","Icon","size","color","getPropertyValue","getMode","EntityEditorMode","edit","entityType","Dialogs","MessageBox","modal","buttons","MessageBoxButtons","OK_CANCEL","okCaption","onOk","messageBox","cancelCaption","onCancel","oldButton","newButton","Loader","Market","rest","Marketplace","PLACEMENT","log","EntityEvent","fire","names","invalidate","Meeting","meeting","ButtonType","PRIMARY","SECONDARY","ActionType","LAYOUT_JS_EVENT","FOOTER_BUTTON_CLICK","OPEN_REST_APP","REDIRECT","EventType","LAYOUT_EVENT","VALUE_CHANGED_EVENT","Action","sliderParams","execute","vueComponent","reject","isLayoutJsEvent","$Bitrix","eventEmitter","ITEM_ACTION_EVENT","$parent","getIdByComponentInstance","isOpenRestApp","appId","$root","getAppId","bx24_title","bx24_width","leftBoundary","bx24_leftBoundary","labelParams","labelBgColor","bgColor","labelColor","labelText","bx24_label","AppLayout","openApplication","isRedirect","linkAttrs","href","click","isFooterButtonClick","getValue","ButtonState","DEFAULT","LOADING","DISABLED","String","required","state","action","uiButton","freeze","computed","buttonContainerRef","$refs","buttonContainer","itemStateToButtonStateDict","UIButton","State","WAITING","itemTypeToButtonColorDict","Color","LINK","BASE_CLASS","Size","EXTRA_SMALL","Style","ROUND","executeAction","Layout","Button","onAction","Function","layout","isLoading","primaryButtonParams","getButtonParams","primaryButton","secondaryButtonParams","secondaryButton","primaryButtonAction","secondaryButtonAction","created","onActionEvent","mounted","showLoader","beforeUnmount","unsubscribe","watch","newLayout","setLayout","setLayoutItemState","properties","blocks","$nextTick","setButtonState","buttonType","oldValue","newValue","isNull","eventData","clone","hasPrimaryButton","hasSecondaryButton","BlockType","lineOfBlocks","withTitle","section","dropdownMenu","select","textarea","TextColor","WARNING","DANGER","SUCCESS","BASE_50","BASE_60","BASE_70","BASE_90","TextSize","XS","SM","MD","LG","XL","inheritAttrs","bold","multiline","colorClassname","boldClassname","sizeClassname","upperCaseColorProp","toUpperCase","weight","upperCaseWeightProp","encodedText","BlockWithTitleWidth","allowedTypes","containerCssClass","containerTagName","itemCssClass","itemTagName","isInline","LineOfTextBlocks","cloneComponent","BaseBlocksCollection","Link","inline","titleWidth","block","widthClassname","isValidBlock","rendererName","isTitleCropped","titleElem","scrollWidth","clientWidth","MenuId","selectedValue","currentSelectedValue","menu","getMenuById","selectedValueCode","hasOwn","allValues","selectedValueTitle","isValid","newSelectedValue","onMenuItemClick","valueId","getCurrentMenu","showMenu","menuItems","cacheable","$el","emits","modelValue","placeholder","currentValue","onChange","$emit","getSelectedValue","valueCandidate","some","adjustTextareaHeight","textareaNode","height","parentNode","Input","Select","Textarea","errorText","getInitialValue","hasError","hasTitle","componentName","componentProps","BaseInput","preparedValues","key","List","SectionImageSize","SectionType","primary","warning","danger","success","withBorder","Section","imageSrc","imageSize","filter","typeClassname","imageClassName","imageSizeClassname","imageUri","regex","test","DropdownMenu","WithTitle","currentBlocks","blockRefs","beforeUpdate","updated","setDataIdAttribute","newBlocks","saveRef","ref","visibleBlocks","index","blockId","node","isElementNode","setAttribute","reduce","isFunction","isBoolean","componentInstance","getItemCssClassList","firstVisibleBlockId","lastVisibleBlockId","map","MODULE_ID","USER_SEEN_OPTION","REST_PLACEMENT_SLIDER_WIDTH","CHECK_TARGET_CHANGE_INTERVAL","isCanShowTour","appContext","isValidStringFields","stringFields","field","currentTarget","possibleNewTarget","isTargetVisible","isTargetChange","element","guidePopupContainer","getPopupContainer","newTarget","moreDetailsLink","getLink","removeAttribute","applicationId","placementOptions","additionalComponentParam","closeCallback","newUserNotification","Base","isNew","LayoutValidator","validate","PlacementInterfaceManager","placementCode","methodsList","Instances","registerHandlers","placementId","handlers","PlacementInterface","initializePlacement","methodName","prototype","arguments","placementHandlers","LAYOUT_EVENT_NAME","PRIMARY_BTN_CLICK_EVENT_NAME","SECONDARY_BTN_CLICK_EVENT_NAME","VALUE_CHANGE_EVENT_NAME","ENTITY_UPDATE_EVENT_NAME","WithLayout","component","BlocksCollection","placementInterfaceManager","bindLayoutEventCallback","bindValueChangeCallback","setPrimaryButtonState","setSecondaryButtonState","bindPrimaryButtonClickCallback","bindSecondaryButtonClickCallback","bindEntityUpdateCallback","finish","lock","unlock","validator","isCorrectVisible","isCorrectProps","buttonId","eventName","runComponentAction","useBuiltInInterface","response","componentResult","appSid","APP_SID","iframeNode","WithSlider","ID","PLACEMENT_ID","reloadData","cb","fireUpdate","DataLoadStatus","loaded","notLoaded","loading","Sharing","dataLoadStatus","InfoHelper","wrap","reset","loadData","isSuccess","config","setConfig","isResponsible","isNotificationsAvailable","dealContacts","contacts","setCommunicationChannels","communicationChannels","selectedChannelId","SettingsModel","linkHash","hash","sharingUrl","userInfo","rule","calendarSettings","collapsed","menuBarItem","root","renderSendButton","renderCopyButton","renderCancelButton","createSettingsButton","settingsButton","updateSettingsButton","onSettingsButtonClick","hasContacts","sendButton","ButtonSize","ButtonColor","round","onSendButtonClick","LIGHT_BORDER","copyLink","cancelButton","showSettingsPopup","hasDealContacts","showWarningNoContact","isChannelAvailable","hasPhoneWithoutChannels","showWarningNoCommunicationChannels","hasEmailWithoutChannels","connectMailbox","isChannelBitrix24","isApproved","isBitrix24Approved","onLinkCopied","isActionCopy","onRuleUpdated","onRuleUpdatedAction","getSettingsMenu","isSettingsPopupShown","popupWindow","isShown","getSettingsMenuItems","getSharingReceiverItem","hasChannels","getSharingChannelsItem","getSharingSenderItem","getContactMenuItem","getChannelMenuItem","currentFromList","getFromMenuItem","isSelected","itemHtml","check","setChannel","onMailSliderClose","previous","openSliders","getOpenSlidersCount","updateChannels","currentFrom","replaceAll","noCommunicationChannelsWarningGuide","getWarningGuide","guideContentContainer","getContentContainer","openConfigurationButton","noContactWarningGuide","saveJointLink","memberIds","getMemberIds","onContactsChangedHandler","current","isCurrentDeal","receiver","address","addressSource","addressSourceData","valueType","typeId","phoneContacts","mailContacts","chooseChannel","setContacts","sort","a","b","selectedId","activeChannels","availableChannels","phoneChannels","channelUnavailable","mailChannels","checkIsApproved","warningGuide","simpleMode","condition","guideContent","offsetFromCloseIcon","closeIcon","existingPadding","paddingRight","arrowContainer","arrow","border","getBoundingClientRect","Analytics","sendPopupOpened","contexts","crm","readOnly","settingsModel","externalIcon","wrapNode","replaceWith","ruleArray","getRule","toArray","contactId","contactTypeId","channelId","peopleCount","ruleChanges","getChanges","linkTypes","solo","sendLinkCopied","getContext","getSharingUrl","getLinkHash","Message","skeleton","MessageSender","Editor","Skeleton","renderTo","shouldConfirmStateChange","getState","isCustomTextChannel","isNil","notificationTemplate","isWantCustomTextChannel","trim","templateId","ORIGINAL_ID","filledPlaceholders","FILLED_PLACEHOLDERS","currentTemplateId","currentFilledPlaceholders","tryToResend","editorState","analytics","Builder","Communication","ResendEvent","createDefault","setSection","setSubSection","c_sub_section","setTemplateId","buildData","getOptions","promoBanners","stepId","subscribeOnce","Dictionary","Channel","ConnectEvent","setElement","ELEMENT_AHA_MOMENT","backend","senderCode","chan","candidate","isSameBackend","fromId","setFrom","toList","setTo","setMessageText","setTemplate","setFilledPlaceholder","Sms","fetchConfigPromise","_senderId","_from","_commEntityTypeId","_commEntityId","_to","_fromList","_toList","_defaults","_communications","_menu","_isMenuShown","_shownMenuId","_documentSelector","_source","_paymentId","_shipmentId","_compilationProductIds","_templateId","templateOriginalId","_templateFieldHintNode","_templateSelectorNode","_templateTemplateTitleNode","_templatePreviewNode","_templateSelectorMenuId","_templateFieldHintHandler","onTemplateHintIconClick","_templateSeletorClickHandler","onTemplateSelectClick","_selectTemplateHandler","onSelectTemplate","_serviceUrl","remove_url_param","_canUse","getBoolean","_canSendMessage","_manageUrl","_senders","getArray","_isSalescenterEnabled","_isDocumentsEnabled","_documentsProvider","_documentsValue","_isFilesEnabled","_diskUrls","_isFilesExternalLinkEnabled","_senderSelectorNode","_fromContainerNode","_fromSelectorNode","_clientContainerNode","_clientSelectorNode","_toSelectorNode","_messageLengthCounterWrapperNode","_messageLengthCounterNode","_salescenterStarter","_smsDetailSwitcher","_smsDetail","_documentSelectorButton","_fileSelectorButton","_fileUploadZone","_fileUploadLabel","_fileSelectorBitrix","_fileExternalLinkDisabledContent","_templatesContainer","initSenderSelector","initDetailSwitcher","initFromSelector","initClientContainer","initClientSelector","initToSelector","initMessageLengthCounter","setMessageLengthCounter","initDocumentSelector","initFileSelector","initSalescenterApplication","classList","contains","innerText","add","defaultSenderId","defaultSender","restSender","handler","onSenderSelectorClick","i","sender","setSender","openMenu","Uri","addParam","manageUrl","slider","getTopSlider","onCloseComplete","location","setAsDefault","isTemplatesBased","showNode","hideNode","toggleTemplateSelectAvailability","toggleSaveButton","visualFn","defaultFromId","defaultFrom","onFromSelectorClick","onFromSelectorItemClick","defaultClient","setClient","onClientSelectorClick","onToSelectorClick","onToSelectorItemClick","PopupMenu","_id","offsetLeft","onPopupClose","onMenuClose","currentItem","preventDefault","_messageLengthMax","getAttribute","setMessageLengthCounterDelayed","classFn","getSelectedSender","enabled","getSendData","alert","getSendUrl","method","dataType","site","sessid","bitrix_sessid","source","ACTION","SENDER_ID","MESSAGE_FROM","MESSAGE_TO","MESSAGE_BODY","MESSAGE_TEMPLATE","MESSAGE_TEMPLATE_WITH_PLACEHOLDER","isCurrentSenderTemplateHasPlaceholders","OWNER_TYPE_ID","OWNER_ID","TO_ENTITY_TYPE_ID","TO_ENTITY_ID","PAYMENT_ID","SHIPMENT_ID","COMPILATION_PRODUCT_IDS","onsuccess","onfailure","isCurrentSenderIsTemplatesBased","getSelectedTemplate","tplEditor","tplEditorData","PREVIEW","add_url_param","startSalescenterApplication","isSalescenterToolEnabled","loadExt","Salescenter","ToolAvailabilityManager","openSalescenterToolDisabledSlider","Manager","disableSendButton","mode","deal","st","focus","paymentId","shipmentId","productIds","onDocumentSelectorClick","DocumentGenerator","Selector","Menu","moduleId","provider","analyticsLabelPrefix","selectPublicUrl","object","Template","createDocument","pasteDocumentUrl","Document","getDocumentPublicUrl","publicUrl","getTitle","onFileSelectorClick","closeFileSelector","uploadFile","findFile","getFileUploadInput","initDiskUF","fireEvent","showFilesExternalLinkFeaturePopup","getLoader","hideLoader","isDiskFileUploaderInited","OnFileUploadSuccess","uf","_onUploadProgress","Disk","UF","UID","controlName","hideSelectDialog","urlSelect","urlRenameFile","urlDeleteFile","urlUpload","fileResult","uploaderFile","diskFileId","element_id","fileName","element_name","pasteFileUrl","analyticsLabel","fileId","externalLink","pop","getFeaturePopup","featurePopup","overlay","onPopupDestroy","contentColor","showTemplateSelectDropdown","TITLE","loaderMenuId","loaderMenuLoaderId","onDestroy","module","templates","preparePlaceholdersFromTemplate","templatePlaceholders","PLACEHOLDERS","placeholders","applySelectedTemplate","isCurrentSenderHasTemplates","hideTemplatePreviewNodeAndClearTitle","setTemplateNodeTitle","initTemplateEditor","preview","categoryId","createOrUpdatePlaceholder","setPlaceholders","setFilledPlaceholders","setBody","placeholderId","fieldName","fieldValue","getCommonPlaceholderData","Ajax","json","canSend","clientData","rawDescription","self","getId","enableSalesCenter","enableDocuments","enableFiles","showFiles","enableFilesExternalLink","fileInputPrefix","fileInputName","fileUploaderInputName","fileUploaderZoneId","phoneReceivers","newCommunications","oldSelectedClient","CHANNEL_MANAGER_SLIDER_WIDTH","saveSmsMessage","serviceUrl","onSuccessHandler","onFailureHandler","baseParams","showChannelManagerSlider","getClass","IFRAME","MENU_SETTINGS_ID","getSubmenuStubItems","getSendersItems","selectedPhoneId","onClickHandler","getCommunicationsItems","getNewCommunications","USER_OPTION_PROVIDER_OFF","USER_OPTION_TEMPLATES_READY","USER_OPTION_PROVIDER_ON","ARTICLE_CODE_SEND_WITH_WHATSAPP","Whatsapp","titleMessage","description","descriptionClass","lead","getTemplate","toPhone","row","preselectedItems","setupButton","defaultCommunication","MESSAGE_TEMPLATE_ORIGINAL_ID","editorParams","canUsePreview","additionalOptions","defaultOptions","tagSelectorOptions","textBoxWidth","selectEvent","getCustomData","footerData","footer","showForm","Feedback","Form","forms","zones","lang","sec","analyticsData","FormEvent","ELEMENT_WA_HELP","SendEvent","ELEMENT_WA_SEND","setContactsCount","setResend","ELEMENT_WA_TEMPLATE_OFFER","ELEMENT_WA_TEMPLATE_SELECTOR","ELEMENT_WA_CANCEL","ELEMENT_WA_PREVIEW","setEvent","EVENT_WA_TIMELINE","SUB_SECTION_DETAILS","Task","addTask","mainSection","visibility","opacity","ARTICLE_CODE","ToDo","sendAnalytics","setParentActivityId","activityId","setDeadLine","deadLine","setDeadline","setDescription","guideBindElementClass","defaultDescription","currentUser","pingSettings","copilotSettings","colorSettings","actionMenuSettings","onCollapsingToggle","subSection","TodoEditorV2","Visit","visitParameters","CrmActivityVisit","WaitConfigurationDialog","_popup","_menuId","_settings","_type","Wait","WaitingType","undefined","_duration","_target","_targetDates","_container","_durationInput","_targetDateNode","isNotEmptyString","getRandomString","getInteger","after","getType","setType","getDuration","setDuration","duration","messages","hasOwnProperty","getTargetDateCaption","targetDate","isBeforeWaitingType","before","draggable","renderDialogContent","onPopupShow","PopupWindowButton","PopupWindowButtonLink","wrapper","contentTextNode","getContentTextNode","appendDurationInput","appendTargetDateNode","phraseCode","replacement","getDurationInputContainerId","getTargetDateNodeContainerId","getMessagePlural","getDurationInput","onkeyup","onDurationChange","containerId","isNaN","getTargetDateNode","toggleTargetMenu","isTargetMenuOpened","closeTargetMenu","openTargetMenu","info","onTargetSelect","getFunction","returnValue","_configSelector","_configDialog","resolveTypeId","layoutConfigurationSummary","getDurationText","enableNumber","onSelectorClick","closeMenu","customMenu","onMenuShow","onMenuDestroy","openConfigDialog","saveConfiguration","targetDates","onSave","onConfigDialogSave","onConfigDialogCancel","Data","getSummaryHtml","getSummaryText","strip_tags","postpone","complete","completed","comment","targetFieldName","subject","ownerType","ownerID","m","toString","Zoom","onNotConnectedHandler","onNotAvailableHandler","ZoomEditor","onFinishEdit","onStartSave","onFinishSave","Factory","createItem","startsWith","RestPlacementWithLayout","RestPlacementWithSlider","MenuBar","Main","interfaceButtonsManager","getById","itemData","setActiveItemById","getFirstItemIdWithLayout","getItemById","selectedItemId","itemId","scrollIntoView","behavior","firstId","getAllItems","itemElement","dataset","instances","setDefault","instance","activeItem","currentDiv","wasActiveInMoreMenu","isActiveInMoreMenu","classes","itemActive","getItemData","currentDivData","activeItemData","submenu","getSubmenu","getMenuItems","menuItem","getMoreButton","closeSubmenu"],"mappings":"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"}