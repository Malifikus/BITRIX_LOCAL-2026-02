this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,s,l,a,t,i,r,o,b,n,d){"use strict";var c=babelHelpers.classPrivateFieldLooseKey("menu");var p=babelHelpers.classPrivateFieldLooseKey("bindElement");var v=babelHelpers.classPrivateFieldLooseKey("isTextItemFirst");var P=babelHelpers.classPrivateFieldLooseKey("onEditorItemClick");var h=babelHelpers.classPrivateFieldLooseKey("onTextItemClick");var u=babelHelpers.classPrivateFieldLooseKey("getMenuPopup");var L=babelHelpers.classPrivateFieldLooseKey("getItems");var F=babelHelpers.classPrivateFieldLooseKey("getEditorItem");var H=babelHelpers.classPrivateFieldLooseKey("getTextItem");var y=babelHelpers.classPrivateFieldLooseKey("getItemTitle");class B{constructor({bindElement:e,isTextItemFirst:s,onEditorItemClick:l,onTextItemClick:a}){Object.defineProperty(this,y,{value:w});Object.defineProperty(this,H,{value:m});Object.defineProperty(this,F,{value:T});Object.defineProperty(this,L,{value:E});Object.defineProperty(this,u,{value:f});Object.defineProperty(this,c,{writable:true,value:null});Object.defineProperty(this,p,{writable:true,value:null});Object.defineProperty(this,v,{writable:true,value:false});Object.defineProperty(this,P,{writable:true,value:()=>{}});Object.defineProperty(this,h,{writable:true,value:()=>{}});babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=s;babelHelpers.classPrivateFieldLooseBase(this,P)[P]=l;babelHelpers.classPrivateFieldLooseBase(this,h)[h]=a}show(){babelHelpers.classPrivateFieldLooseBase(this,u)[u]().show()}destroy(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,c)[c])==null?void 0:e.destroy();babelHelpers.classPrivateFieldLooseBase(this,c)[c]=null;d.Runtime.destroy(this)}}function f(){if(babelHelpers.classPrivateFieldLooseBase(this,c)[c]===null){babelHelpers.classPrivateFieldLooseBase(this,c)[c]=b.MenuManager.create({id:"crm-template-editor-placeholder-selector",bindElement:babelHelpers.classPrivateFieldLooseBase(this,p)[p],autoHide:true,offsetLeft:20,angle:true,closeByEsc:false,cacheable:false,items:babelHelpers.classPrivateFieldLooseBase(this,L)[L]()})}return babelHelpers.classPrivateFieldLooseBase(this,c)[c]}function E(){const e=babelHelpers.classPrivateFieldLooseBase(this,F)[F]();const s=babelHelpers.classPrivateFieldLooseBase(this,H)[H]();if(babelHelpers.classPrivateFieldLooseBase(this,v)[v]){return[s,e]}return[e,s]}function T(){return{html:babelHelpers.classPrivateFieldLooseBase(this,y)[y]("CRM_TEMPLATE_EDITOR_SELECT_FIELD"),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,P)[P](babelHelpers.classPrivateFieldLooseBase(this,p)[p])}}}function m(){const e=babelHelpers.classPrivateFieldLooseBase(this,v)[v]?"CRM_TEMPLATE_EDITOR_UPDATE_TEXT":"CRM_TEMPLATE_EDITOR_CREATE_TEXT";return{html:babelHelpers.classPrivateFieldLooseBase(this,y)[y](e),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,u)[u]().close();babelHelpers.classPrivateFieldLooseBase(this,h)[h](babelHelpers.classPrivateFieldLooseBase(this,p)[p])}}}function w(e){const s='<span class="crm-template-editor-placeholder-selector-menu-item">#ITEM_TEXT#</span>';return s.replace("#ITEM_TEXT#",d.Text.encode(d.Loc.getMessage(e)))}let g=e=>e,I,O;const D={LOADING:1,SUCCESS:2,FAILED:3};var j=babelHelpers.classPrivateFieldLooseKey("popup");var C=babelHelpers.classPrivateFieldLooseKey("bindElement");var K=babelHelpers.classPrivateFieldLooseKey("previewContentContainer");var _=babelHelpers.classPrivateFieldLooseKey("previewLoader");var A=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var S=babelHelpers.classPrivateFieldLooseKey("entityId");var R=babelHelpers.classPrivateFieldLooseKey("getPopup");var M=babelHelpers.classPrivateFieldLooseKey("getContent");class x{constructor(e,s,l){Object.defineProperty(this,M,{value:U});Object.defineProperty(this,R,{value:N});Object.defineProperty(this,j,{writable:true,value:null});Object.defineProperty(this,C,{writable:true,value:null});Object.defineProperty(this,K,{writable:true,value:null});Object.defineProperty(this,_,{writable:true,value:null});Object.defineProperty(this,A,{writable:true,value:null});Object.defineProperty(this,S,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,C)[C]=e;babelHelpers.classPrivateFieldLooseBase(this,A)[A]=s;babelHelpers.classPrivateFieldLooseBase(this,S)[S]=l}destroy(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,R)[R]())==null?void 0:e.destroy()}isShown(){var e,s;return(e=(s=babelHelpers.classPrivateFieldLooseBase(this,R)[R]())==null?void 0:s.isShown())!=null?e:false}show(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,R)[R]())==null?void 0:e.show()}apply(e,s=""){const l=babelHelpers.classPrivateFieldLooseBase(this,R)[R]().getPopupContainer().querySelector(".popup-window-close-icon");switch(e){case D.LOADING:{d.Dom.addClass(l,"--hidden");babelHelpers.classPrivateFieldLooseBase(this,K)[K].innerText="";if(!babelHelpers.classPrivateFieldLooseBase(this,_)[_]){babelHelpers.classPrivateFieldLooseBase(this,_)[_]=new r.ProgressBar({color:r.ProgressBar.Color.PRIMARY,size:10,maxValue:100,value:30,infiniteLoading:true})}babelHelpers.classPrivateFieldLooseBase(this,R)[R]().setHeight(75);babelHelpers.classPrivateFieldLooseBase(this,_)[_].renderTo(babelHelpers.classPrivateFieldLooseBase(this,K)[K]);break}case D.SUCCESS:{babelHelpers.classPrivateFieldLooseBase(this,R)[R]().setHeight(null);babelHelpers.classPrivateFieldLooseBase(this,R)[R]().setAutoHide(true);babelHelpers.classPrivateFieldLooseBase(this,K)[K].innerText=s;d.Dom.removeClass(l,"--hidden");d.Dom.addClass(babelHelpers.classPrivateFieldLooseBase(this,K)[K],"--loaded");break}case D.FAILED:{babelHelpers.classPrivateFieldLooseBase(this,R)[R]().destroy();i.UI.Notification.Center.notify({content:d.Text.encode(s),autoHideDelay:5e3});break}default:throw new TypeError(`Unsupported preview popup content status ${e}`)}}}function N(){if(babelHelpers.classPrivateFieldLooseBase(this,j)[j]===null){babelHelpers.classPrivateFieldLooseBase(this,j)[j]=b.PopupWindowManager.create({id:`crm-template-editor-preview-popup-${babelHelpers.classPrivateFieldLooseBase(this,A)[A]}-${babelHelpers.classPrivateFieldLooseBase(this,S)[S]}`,bindElement:babelHelpers.classPrivateFieldLooseBase(this,C)[C],closeIcon:{top:"10px"},cacheable:false,closeByEsc:false,autoHide:false,angle:{position:"top",offset:70},content:babelHelpers.classPrivateFieldLooseBase(this,M)[M]()})}return babelHelpers.classPrivateFieldLooseBase(this,j)[j]}function U(){babelHelpers.classPrivateFieldLooseBase(this,K)[K]=d.Tag.render(I||(I=g`<div class="crm-template-editor-preview-popup-content"></div>`));return d.Tag.render(O||(O=g`
			<div class="crm-template-editor-preview-popup-wrapper">
				<div class="crm-template-editor-preview-popup-title">
					${0}
				</div>
				${0}
			</div>
		`),d.Loc.getMessage("CRM_TEMPLATE_EDITOR_PREVIEW_POPUP_TITLE"),babelHelpers.classPrivateFieldLooseBase(this,K)[K])}var X=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var k=babelHelpers.classPrivateFieldLooseKey("entityId");var V=babelHelpers.classPrivateFieldLooseKey("categoryId");var $=babelHelpers.classPrivateFieldLooseKey("bindElement");var W=babelHelpers.classPrivateFieldLooseKey("isDisplayFormat");var Y=babelHelpers.classPrivateFieldLooseKey("isUsePreviewRequestRunning");var G=babelHelpers.classPrivateFieldLooseKey("previewCache");var q=babelHelpers.classPrivateFieldLooseKey("previewPopup");var z=babelHelpers.classPrivateFieldLooseKey("unsubscribe");class J{constructor(e){Object.defineProperty(this,X,{writable:true,value:null});Object.defineProperty(this,k,{writable:true,value:null});Object.defineProperty(this,V,{writable:true,value:null});Object.defineProperty(this,$,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:false});Object.defineProperty(this,Y,{writable:true,value:false});Object.defineProperty(this,G,{writable:true,value:new Map});Object.defineProperty(this,q,{writable:true,value:null});Object.defineProperty(this,z,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,X)[X]=d.Text.toInteger(e.entityTypeId);if(!BX.CrmEntityType.isDefined(babelHelpers.classPrivateFieldLooseBase(this,X)[X])){throw new Error("Previewer: entityTypeId must be a valid entity type ID")}babelHelpers.classPrivateFieldLooseBase(this,k)[k]=d.Text.toInteger(e.entityId);if(e.entityId<=0){throw new Error("Previewer: entityId must be greater than 0")}babelHelpers.classPrivateFieldLooseBase(this,V)[V]=d.Type.isNil(e.categoryId)?null:d.Text.toInteger(e.categoryId);if(!d.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,V)[V])&&babelHelpers.classPrivateFieldLooseBase(this,V)[V]<0){throw new Error("Previewer: categoryId must be a non-negative integer")}babelHelpers.classPrivateFieldLooseBase(this,$)[$]=d.Type.isDomNode(e.bindElement)?e.bindElement:null;babelHelpers.classPrivateFieldLooseBase(this,W)[W]=d.Type.isBoolean(e.isDisplayFormat)?e.isDisplayFormat:babelHelpers.classPrivateFieldLooseBase(this,W)[W];babelHelpers.classPrivateFieldLooseBase(this,z)[z]=BX.Crm.EntityEvent.subscribeToItem(babelHelpers.classPrivateFieldLooseBase(this,X)[X],babelHelpers.classPrivateFieldLooseBase(this,k)[k],(()=>{babelHelpers.classPrivateFieldLooseBase(this,G)[G].clear()}))}preview(e,s){var l,a;const t=d.Type.isDomNode(s)?s:babelHelpers.classPrivateFieldLooseBase(this,$)[$];if(!d.Type.isDomNode(t)){throw new Error("Previewer: bindElement must be a valid DOM element")}if((l=babelHelpers.classPrivateFieldLooseBase(this,q)[q])!=null&&l.isShown()){return}if(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]){var i;(i=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:i.show();return}(a=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:a.destroy();const r=babelHelpers.classPrivateFieldLooseBase(this,G)[G].get(e);if(r){babelHelpers.classPrivateFieldLooseBase(this,q)[q]=new x(t,babelHelpers.classPrivateFieldLooseBase(this,X)[X],babelHelpers.classPrivateFieldLooseBase(this,k)[k]);babelHelpers.classPrivateFieldLooseBase(this,q)[q].apply(D.SUCCESS,r);babelHelpers.classPrivateFieldLooseBase(this,q)[q].show();return}babelHelpers.classPrivateFieldLooseBase(this,q)[q]=new x(t,babelHelpers.classPrivateFieldLooseBase(this,X)[X],babelHelpers.classPrivateFieldLooseBase(this,k)[k]);babelHelpers.classPrivateFieldLooseBase(this,q)[q].apply(D.LOADING);babelHelpers.classPrivateFieldLooseBase(this,q)[q].show();babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=true;d.ajax.runAction("crm.activity.smsplaceholder.preview",{data:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,X)[X],entityId:babelHelpers.classPrivateFieldLooseBase(this,k)[k],message:e,entityCategoryId:babelHelpers.classPrivateFieldLooseBase(this,V)[V],isDisplayFormat:babelHelpers.classPrivateFieldLooseBase(this,W)[W]}}).then((s=>{var l;(l=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:l.apply(D.SUCCESS,s.data.preview);babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=false;babelHelpers.classPrivateFieldLooseBase(this,G)[G].set(e,s.data.preview)})).catch((e=>{var s,l;(s=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:s.apply(D.FAILED,(l=e.errors[0].message)!=null?l:"Unknown error");babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=false}))}isShown(){var e,s;return(e=(s=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:s.isShown())!=null?e:false}close(){var e;babelHelpers.classPrivateFieldLooseBase(this,Y)[Y]=false;(e=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:e.destroy();babelHelpers.classPrivateFieldLooseBase(this,q)[q]=null}destroy(){var e,s,l;(e=babelHelpers.classPrivateFieldLooseBase(this,q)[q])==null?void 0:e.destroy();babelHelpers.classPrivateFieldLooseBase(this,q)[q]=null;(s=(l=babelHelpers.classPrivateFieldLooseBase(this,z))[z])==null?void 0:s.call(l);babelHelpers.classPrivateFieldLooseBase(this,G)[G]=null;d.Runtime.destroy(this)}}let Q=e=>e,Z,ee;var se=babelHelpers.classPrivateFieldLooseKey("popup");var le=babelHelpers.classPrivateFieldLooseKey("input");var ae=babelHelpers.classPrivateFieldLooseKey("bindElement");var te=babelHelpers.classPrivateFieldLooseKey("value");var ie=babelHelpers.classPrivateFieldLooseKey("onApply");var re=babelHelpers.classPrivateFieldLooseKey("getPopup");var oe=babelHelpers.classPrivateFieldLooseKey("getContent");var be=babelHelpers.classPrivateFieldLooseKey("bindInputEvents");var ne=babelHelpers.classPrivateFieldLooseKey("getMenuButtons");var de=babelHelpers.classPrivateFieldLooseKey("getApplyButton");var ce=babelHelpers.classPrivateFieldLooseKey("adjustButtonState");var pe=babelHelpers.classPrivateFieldLooseKey("getApplyButtonText");var ve=babelHelpers.classPrivateFieldLooseKey("onApplyButtonClick");var Pe=babelHelpers.classPrivateFieldLooseKey("getApplyButtonInstance");var he=babelHelpers.classPrivateFieldLooseKey("getCancelButton");var ue=babelHelpers.classPrivateFieldLooseKey("setCursorToEnd");class Le{constructor({bindElement:e,value:s,onApply:l}){Object.defineProperty(this,ue,{value:Ie});Object.defineProperty(this,he,{value:ge});Object.defineProperty(this,Pe,{value:we});Object.defineProperty(this,ve,{value:me});Object.defineProperty(this,pe,{value:Te});Object.defineProperty(this,ce,{value:Ee});Object.defineProperty(this,de,{value:fe});Object.defineProperty(this,ne,{value:Be});Object.defineProperty(this,be,{value:ye});Object.defineProperty(this,oe,{value:He});Object.defineProperty(this,re,{value:Fe});Object.defineProperty(this,se,{writable:true,value:null});Object.defineProperty(this,le,{writable:true,value:null});Object.defineProperty(this,ae,{writable:true,value:null});Object.defineProperty(this,te,{writable:true,value:null});Object.defineProperty(this,ie,{writable:true,value:()=>{}});babelHelpers.classPrivateFieldLooseBase(this,ae)[ae]=e;babelHelpers.classPrivateFieldLooseBase(this,te)[te]=s;babelHelpers.classPrivateFieldLooseBase(this,ie)[ie]=l}destroy(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,se)[se])==null?void 0:e.destroy()}show(){babelHelpers.classPrivateFieldLooseBase(this,re)[re]().show()}}function Fe(){if(babelHelpers.classPrivateFieldLooseBase(this,se)[se]===null){babelHelpers.classPrivateFieldLooseBase(this,se)[se]=b.PopupWindowManager.create("crm-template-editor-text-popup",babelHelpers.classPrivateFieldLooseBase(this,ae)[ae],{autoHide:true,content:babelHelpers.classPrivateFieldLooseBase(this,oe)[oe](),closeByEsc:true,closeIcon:false,buttons:babelHelpers.classPrivateFieldLooseBase(this,ne)[ne](),cacheable:false});babelHelpers.classPrivateFieldLooseBase(this,se)[se].subscribe("onShow",(()=>{setTimeout((()=>{babelHelpers.classPrivateFieldLooseBase(this,le)[le].focus();babelHelpers.classPrivateFieldLooseBase(this,ue)[ue]()}),0)}))}return babelHelpers.classPrivateFieldLooseBase(this,se)[se]}function He(){const e=d.Tag.render(Z||(Z=Q`<div class="crm-template-editor-text-popup-wrapper"></div>`));babelHelpers.classPrivateFieldLooseBase(this,le)[le]=d.Tag.render(ee||(ee=Q`
			<input 
				type="text" 
				value="${0}"
				maxlength="255"
				placeholder="${0}
			">
		`),d.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,te)[te]),d.Loc.getMessage("CRM_TEMPLATE_EDITOR_SELECT_FIELD_PLACEHOLDER"));d.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,le)[le],e);babelHelpers.classPrivateFieldLooseBase(this,be)[be]();return e}function ye(){d.Event.bind(babelHelpers.classPrivateFieldLooseBase(this,le)[le],"keyup",(e=>{const s=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();if(!s){return}const{value:l}=e.target;babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](s,l)}))}function Be(){return[babelHelpers.classPrivateFieldLooseBase(this,de)[de](),babelHelpers.classPrivateFieldLooseBase(this,he)[he]()]}function fe(){const e=new n.Button({id:"apply-button",text:babelHelpers.classPrivateFieldLooseBase(this,pe)[pe](),className:"ui-btn ui-btn-xs ui-btn-primary ui-btn-round",onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,ve)[ve]()}});const{value:s}=babelHelpers.classPrivateFieldLooseBase(this,le)[le];babelHelpers.classPrivateFieldLooseBase(this,ce)[ce](e,s);return e}function Ee(e,s){e.setState(d.Type.isStringFilled(s)&&d.Type.isStringFilled(s.trim())?n.ButtonState.ACTIVE:n.ButtonState.DISABLED)}function Te(){if(d.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,te)[te])){return d.Loc.getMessage("CRM_TEMPLATE_EDITOR_TEXT_POPUP_UPDATE")}return d.Loc.getMessage("CRM_TEMPLATE_EDITOR_TEXT_POPUP_ADD")}function me(){const e=babelHelpers.classPrivateFieldLooseBase(this,Pe)[Pe]();if(e.getState()!==n.ButtonState.ACTIVE){return}this.destroy();const{value:s}=babelHelpers.classPrivateFieldLooseBase(this,le)[le];babelHelpers.classPrivateFieldLooseBase(this,ae)[ae].textContent=d.Text.encode(s);babelHelpers.classPrivateFieldLooseBase(this,ie)[ie](s.trim())}function we(){return babelHelpers.classPrivateFieldLooseBase(this,se)[se].getButton("apply-button")}function ge(){return new n.Button({text:d.Loc.getMessage("CRM_TEMPLATE_EDITOR_TEXT_POPUP_CANCEL"),className:"ui-btn ui-btn-xs ui-btn-light ui-btn-round",onclick:()=>{this.destroy()}})}function Ie(){const{length:e}=babelHelpers.classPrivateFieldLooseBase(this,le)[le].value;babelHelpers.classPrivateFieldLooseBase(this,le)[le].selectionStart=e;babelHelpers.classPrivateFieldLooseBase(this,le)[le].selectionEnd=e}function Oe(e,s,l){let a=e;if(d.Type.isArrayFilled(l)){l.forEach((e=>{if(d.Type.isStringFilled(e.FIELD_NAME)){a=a.replace(e.PLACEHOLDER_ID,`{${e.FIELD_NAME}}`)}else if(d.Type.isStringFilled(e.FIELD_VALUE)){const s=e.FIELD_VALUE.replaceAll("{","&#123;").replaceAll("}","&#125;");a=a.replace(e.PLACEHOLDER_ID,s)}}))}if(d.Type.isArrayFilled(s)){s.forEach((e=>{a=a.replace(e," ")}))}return a}let De=e=>e,je,Ce,Ke,_e,Ae,Se;const Re="update";const Me="delete";const xe="HEADER";const Ne="PREVIEW";const Ue="FOOTER";var Xe=babelHelpers.classPrivateFieldLooseKey("id");var ke=babelHelpers.classPrivateFieldLooseKey("target");var Ve=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var $e=babelHelpers.classPrivateFieldLooseKey("entityId");var We=babelHelpers.classPrivateFieldLooseKey("categoryId");var Ye=babelHelpers.classPrivateFieldLooseKey("canUseFieldsDialog");var Ge=babelHelpers.classPrivateFieldLooseKey("canUseFieldValueInput");var qe=babelHelpers.classPrivateFieldLooseKey("isReadOnly");var ze=babelHelpers.classPrivateFieldLooseKey("previewer");var Je=babelHelpers.classPrivateFieldLooseKey("headerContainerEl");var Qe=babelHelpers.classPrivateFieldLooseKey("bodyContainerEl");var Ze=babelHelpers.classPrivateFieldLooseKey("footerContainerEl");var es=babelHelpers.classPrivateFieldLooseKey("placeHoldersDialogDefaultOptions");var ss=babelHelpers.classPrivateFieldLooseKey("headerRaw");var ls=babelHelpers.classPrivateFieldLooseKey("bodyRaw");var as=babelHelpers.classPrivateFieldLooseKey("footerRaw");var ts=babelHelpers.classPrivateFieldLooseKey("popupMenu");var is=babelHelpers.classPrivateFieldLooseKey("inputPopup");var rs=babelHelpers.classPrivateFieldLooseKey("dialogsCache");var os=babelHelpers.classPrivateFieldLooseKey("createContainer");var bs=babelHelpers.classPrivateFieldLooseKey("createContainerWithSelectors");var ns=babelHelpers.classPrivateFieldLooseKey("getDialog");var ds=babelHelpers.classPrivateFieldLooseKey("onApplyInputPopup");var cs=babelHelpers.classPrivateFieldLooseKey("onPreviewTemplate");var ps=babelHelpers.classPrivateFieldLooseKey("getInputContainer");var vs=babelHelpers.classPrivateFieldLooseKey("getPlaceholders");var Ps=babelHelpers.classPrivateFieldLooseKey("prepareDlgOptions");var hs=babelHelpers.classPrivateFieldLooseKey("adjustFilledPlaceholders");var us=babelHelpers.classPrivateFieldLooseKey("deleteFromFilledPlaceholders");var Ls=babelHelpers.classPrivateFieldLooseKey("updateForFilledPlaceholders");var Fs=babelHelpers.classPrivateFieldLooseKey("getFilledPlaceholderByElement");var Hs=babelHelpers.classPrivateFieldLooseKey("getPlaceholderIdByElement");var ys=babelHelpers.classPrivateFieldLooseKey("getFilledPlaceholderById");var Bs=babelHelpers.classPrivateFieldLooseKey("getPlainText");var fs=babelHelpers.classPrivateFieldLooseKey("getRawTextByPosition");var Es=babelHelpers.classPrivateFieldLooseKey("assertValidParams");var Ts=babelHelpers.classPrivateFieldLooseKey("canUsePlaceholderProvider");class ms{constructor(e){var s,l,a,t;Object.defineProperty(this,Ts,{value:ks});Object.defineProperty(this,Es,{value:Xs});Object.defineProperty(this,fs,{value:Us});Object.defineProperty(this,Bs,{value:Ns});Object.defineProperty(this,ys,{value:xs});Object.defineProperty(this,Hs,{value:Ms});Object.defineProperty(this,Fs,{value:Rs});Object.defineProperty(this,Ls,{value:Ss});Object.defineProperty(this,us,{value:As});Object.defineProperty(this,hs,{value:_s});Object.defineProperty(this,Ps,{value:Ks});Object.defineProperty(this,vs,{value:Cs});Object.defineProperty(this,ps,{value:js});Object.defineProperty(this,cs,{value:Ds});Object.defineProperty(this,ds,{value:Os});Object.defineProperty(this,ns,{value:Is});Object.defineProperty(this,bs,{value:gs});Object.defineProperty(this,os,{value:ws});Object.defineProperty(this,Xe,{writable:true,value:void 0});Object.defineProperty(this,ke,{writable:true,value:null});Object.defineProperty(this,Ve,{writable:true,value:null});Object.defineProperty(this,$e,{writable:true,value:null});Object.defineProperty(this,We,{writable:true,value:null});Object.defineProperty(this,Ye,{writable:true,value:true});Object.defineProperty(this,Ge,{writable:true,value:true});Object.defineProperty(this,qe,{writable:true,value:false});Object.defineProperty(this,ze,{writable:true,value:null});this.placeholders=[];this.filledPlaceholders=[];this.onSelect=()=>{};Object.defineProperty(this,Je,{writable:true,value:null});Object.defineProperty(this,Qe,{writable:true,value:null});Object.defineProperty(this,Ze,{writable:true,value:null});Object.defineProperty(this,es,{writable:true,value:null});Object.defineProperty(this,ss,{writable:true,value:null});Object.defineProperty(this,ls,{writable:true,value:null});Object.defineProperty(this,as,{writable:true,value:null});Object.defineProperty(this,ts,{writable:true,value:null});Object.defineProperty(this,is,{writable:true,value:null});Object.defineProperty(this,rs,{writable:true,value:new WeakMap});babelHelpers.classPrivateFieldLooseBase(this,Es)[Es](e);babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]=e.id||`crm-template-editor-${d.Text.getRandom()}`;babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]=e.target;babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]=e.entityTypeId;babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]=e.entityId;babelHelpers.classPrivateFieldLooseBase(this,We)[We]=d.Type.isNumber(e.categoryId)?e.categoryId:null;this.onSelect=e.onSelect;babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]=Boolean((s=e.canUseFieldsDialog)!=null?s:true);babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]=Boolean((l=e.canUseFieldValueInput)!=null?l:true);babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]=Boolean((a=e.isReadOnly)!=null?a:false);const i=Boolean((t=e.canUsePreview)!=null?t:false);if(i&&babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]>0){babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=new J({entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve],entityId:babelHelpers.classPrivateFieldLooseBase(this,$e)[$e],categoryId:babelHelpers.classPrivateFieldLooseBase(this,We)[We]})}this.onPlaceholderClick=this.onPlaceholderClick.bind(this);this.onShowInputPopup=this.onShowInputPopup.bind(this);babelHelpers.classPrivateFieldLooseBase(this,es)[es]={multiple:false,showAvatars:false,dropdownMode:true,compactView:true,enableSearch:true,tagSelectorOptions:{textBoxWidth:"100%"}};if(!babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]&&babelHelpers.classPrivateFieldLooseBase(this,Ts)[Ts](e.usePlaceholderProvider)){var r;babelHelpers.classPrivateFieldLooseBase(this,es)[es].entities=[{id:"placeholder",options:{entityTypeId:babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve],entityId:babelHelpers.classPrivateFieldLooseBase(this,$e)[$e],categoryId:(r=babelHelpers.classPrivateFieldLooseBase(this,We)[We])!=null?r:null}}]}if(d.Type.isPlainObject(e.dialogOptions)){babelHelpers.classPrivateFieldLooseBase(this,es)[es]={...babelHelpers.classPrivateFieldLooseBase(this,es)[es],...e.dialogOptions}}babelHelpers.classPrivateFieldLooseBase(this,os)[os]()}setPlaceholders(e){this.placeholders=e;return this}setFilledPlaceholders(e){this.filledPlaceholders=e;return this}setHeader(e){if(!d.Type.isStringFilled(e)){return}babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]=e;d.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]);d.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,bs)[bs](e),babelHelpers.classPrivateFieldLooseBase(this,Je)[Je])}setBody(e){if(!d.Type.isStringFilled(e)){return}babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]=e;d.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]);d.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,bs)[bs](e),babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe])}setFooter(e){if(!d.Type.isStringFilled(e)){return}babelHelpers.classPrivateFieldLooseBase(this,as)[as]=e;d.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]);d.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,bs)[bs](e),babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze])}getData(){if(this.placeholders===null){return null}return{header:babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs](xe),body:babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs](Ne),footer:babelHelpers.classPrivateFieldLooseBase(this,Bs)[Bs](Ue)}}getRawData(){return{header:babelHelpers.classPrivateFieldLooseBase(this,ss)[ss],body:babelHelpers.classPrivateFieldLooseBase(this,ls)[ls],footer:babelHelpers.classPrivateFieldLooseBase(this,as)[as]}}destroy(){var e,s,l;(e=babelHelpers.classPrivateFieldLooseBase(this,ze)[ze])==null?void 0:e.destroy();babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]=null;(s=babelHelpers.classPrivateFieldLooseBase(this,is)[is])==null?void 0:s.destroy();babelHelpers.classPrivateFieldLooseBase(this,is)[is]=null;(l=babelHelpers.classPrivateFieldLooseBase(this,ts)[ts])==null?void 0:l.destroy();babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]=null;d.Runtime.destroy(this)}onPlaceholderClick({dialogOptions:e,event:s}){var l;(l=babelHelpers.classPrivateFieldLooseBase(this,is)[is])==null?void 0:l.destroy();const a=babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs](s.target,Ne);const t=d.Type.isStringFilled(a==null?void 0:a.FIELD_VALUE);if(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]&&babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]){babelHelpers.classPrivateFieldLooseBase(this,ts)[ts]=new B({bindElement:s.target,isTextItemFirst:t,onEditorItemClick:()=>{this.onShowDialogPopup(a,e)},onTextItemClick:e=>{this.onShowInputPopup(e)}});babelHelpers.classPrivateFieldLooseBase(this,ts)[ts].show()}else if(babelHelpers.classPrivateFieldLooseBase(this,Ye)[Ye]){this.onShowDialogPopup(a,e)}else if(babelHelpers.classPrivateFieldLooseBase(this,Ge)[Ge]){this.onShowInputPopup(s.target)}}onShowDialogPopup(e,s){const l=babelHelpers.classPrivateFieldLooseBase(this,ns)[ns](s);if(d.Type.isStringFilled(e==null?void 0:e.FIELD_VALUE)){l.getPreselectedItems().forEach((e=>{const s=l.getItem(e);if(s){s.deselect()}}))}l.show()}onShowInputPopup(e){const s=babelHelpers.classPrivateFieldLooseBase(this,Fs)[Fs](e);const l=d.Type.isStringFilled(s==null?void 0:s.FIELD_VALUE)?s.FIELD_VALUE:"";babelHelpers.classPrivateFieldLooseBase(this,is)[is]=new Le({bindElement:e,value:l,onApply:s=>{babelHelpers.classPrivateFieldLooseBase(this,ds)[ds](s,e)}});babelHelpers.classPrivateFieldLooseBase(this,is)[is].show()}}function ws(){if(!babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]){return}const e=d.Tag.render(je||(je=De`
			<div id="${0}" class="crm-template-editor crm-template-editor__scope"></div>
		`),babelHelpers.classPrivateFieldLooseBase(this,Xe)[Xe]);if(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]){d.Dom.addClass(e,"--read-only")}babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=d.Tag.render(Ce||(Ce=De`<div class="crm-template-editor-header"></div>`));d.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Je)[Je],e);babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]=d.Tag.render(Ke||(Ke=De`<div class="crm-template-editor-body"></div>`));d.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe],e);babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze]=d.Tag.render(_e||(_e=De`<div class="crm-template-editor-footer"></div>`));d.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,Ze)[Ze],e);if(babelHelpers.classPrivateFieldLooseBase(this,ze)[ze]){const s=d.Tag.render(Ae||(Ae=De`
				<div class="crm-template-editor-preview-link" href="#">
					${0}
				</div>
			`),d.Loc.getMessage("CRM_TEMPLATE_EDITOR_PREVIEW_LINK_TITLE"));d.Event.bind(s,"click",babelHelpers.classPrivateFieldLooseBase(this,cs)[cs].bind(this));d.Dom.append(s,e)}d.Dom.clean(babelHelpers.classPrivateFieldLooseBase(this,ke)[ke]);d.Dom.append(e,babelHelpers.classPrivateFieldLooseBase(this,ke)[ke])}function gs(e,s=Ne){const l=babelHelpers.classPrivateFieldLooseBase(this,vs)[vs](s);if(l===null){return null}const a=babelHelpers.classPrivateFieldLooseBase(this,ps)[ps](e,s);l.forEach(((e,l)=>{const t=[...a.childNodes].find((e=>e.dataset&&Number(e.dataset.templatePlaceholder)===l));if(!t){return}if(babelHelpers.classPrivateFieldLooseBase(this,qe)[qe]){return}const i=d.Runtime.clone(babelHelpers.classPrivateFieldLooseBase(this,es)[es]);babelHelpers.classPrivateFieldLooseBase(this,Ps)[Ps](i,t,s);d.Event.bind(t,"click",(e=>{this.onPlaceholderClick({dialogOptions:i,event:e})}))}));return a}function Is(e){if(babelHelpers.classPrivateFieldLooseBase(this,rs)[rs].has(e)){return babelHelpers.classPrivateFieldLooseBase(this,rs)[rs].get(e)}const l=new s.Dialog(e);babelHelpers.classPrivateFieldLooseBase(this,rs)[rs].set(e,l);return l}function Os(e,s){const l=babelHelpers.classPrivateFieldLooseBase(this,Hs)[Hs](s,Ne);const a={id:l,parentTitle:null,text:e,title:e,entityType:BX.CrmEntityType.resolveName(babelHelpers.classPrivateFieldLooseBase(this,Ve)[Ve]).toLowerCase()};s.textContent=e;d.Dom.addClass(s,"--selected");babelHelpers.classPrivateFieldLooseBase(this,hs)[hs](a);this.onSelect(a)}function Ds(e){const s=this.placeholders===null?this.getRawData().body:this.getData().body;babelHelpers.classPrivateFieldLooseBase(this,ze)[ze].preview(s,e.target);l.EventEmitter.emit("BX.Crm.Template.Editor:shown")}function js(e,s){const l=babelHelpers.classPrivateFieldLooseBase(this,vs)[vs](s);if(l===null){return null}let a=0;l.forEach((s=>{const l=babelHelpers.classPrivateFieldLooseBase(this,ys)[ys](s);let t=d.Loc.getMessage("CRM_TEMPLATE_EDITOR_EMPTY_PLACEHOLDER_LABEL");let i="crm-template-editor-element-pill";if(l){if(d.Type.isStringFilled(l.PARENT_TITLE)&&d.Type.isStringFilled(l.TITLE)){t=`${l.PARENT_TITLE}: ${l.TITLE}`}else if(d.Type.isStringFilled(l.TITLE)){t=l.TITLE}else if(d.Type.isStringFilled(l.FIELD_NAME)){t=l.FIELD_NAME}else{t=l.FIELD_VALUE}t=d.Text.encode(t);i+=" --selected"}const r=`<span class="${i}" data-test-role="placeholder" data-template-placeholder="${a++}">${t}</span>`;e=e.replace(s,r)}));return d.Tag.render(Se||(Se=De`<div>${0}</div>`),e)}function Cs(e){const s=d.Type.isPlainObject(this.placeholders)?this.placeholders:{};const l=d.Type.isArrayFilled(s[e])?s[e]:[];return d.Type.isArrayLike(l)?l:null}function Ks(e,s,l){var a;const t=babelHelpers.classPrivateFieldLooseBase(this,vs)[vs](l);const i=(a=t[s.dataset.templatePlaceholder])!=null?a:null;if(i){const s=babelHelpers.classPrivateFieldLooseBase(this,ys)[ys](i);if(s){e.preselectedItems=[[s.FIELD_ENTITY_TYPE,s.FIELD_NAME]]}}e.events={onShow:()=>{const e=[{transform:"rotate(0)"},{transform:"rotate(90deg)"},{transform:"rotate(180deg)"}];const l={duration:200,pseudoElement:"::after"};s.animate(e,l);d.Dom.addClass(s,"--flipped")},onHide:()=>{const e=[{transform:"rotate(180deg)"},{transform:"rotate(90deg)"},{transform:"rotate(0)"}];const l={duration:200,pseudoElement:"::after"};s.animate(e,l);d.Dom.removeClass(s,"--flipped")},"Item:onSelect":e=>{d.Dom.addClass(s,"--selected");const l=e.getData().item;const a=l.supertitle.text;const t=l.title.text;s.textContent=`${a}: ${t}`;const r=l.id;const o=l.entityId;const b={id:i,value:r,parentTitle:a,title:t,entityType:o};babelHelpers.classPrivateFieldLooseBase(this,hs)[hs](b);this.onSelect(b)}};e.targetNode=s}function _s({id:e,value:s,text:l,parentTitle:a,title:t},i=Re){if(i===Me){babelHelpers.classPrivateFieldLooseBase(this,us)[us](e,s);return}babelHelpers.classPrivateFieldLooseBase(this,Ls)[Ls]({id:e,value:s,text:l,parentTitle:a,title:t})}function As(e,s){this.filledPlaceholders=this.filledPlaceholders.filter((l=>l.PLACEHOLDER_ID!==e||l.FIELD_NAME!==s))}function Ss({id:e,value:s,text:l,parentTitle:a,title:t}){const i=babelHelpers.classPrivateFieldLooseBase(this,ys)[ys](e);if(i){i.FIELD_NAME=s!=null?s:null;i.FIELD_VALUE=l!=null?l:null;i.PARENT_TITLE=a;i.TITLE=t}else{this.filledPlaceholders.push({PLACEHOLDER_ID:e,FIELD_NAME:s,FIELD_VALUE:l,PARENT_TITLE:a,TITLE:t})}}function Rs(e,s=Ne){const l=babelHelpers.classPrivateFieldLooseBase(this,Hs)[Hs](e,s);return babelHelpers.classPrivateFieldLooseBase(this,ys)[ys](l)}function Ms(e,s=Ne){var l;const a=babelHelpers.classPrivateFieldLooseBase(this,vs)[vs](s);return(l=a[e.dataset.templatePlaceholder])!=null?l:null}function xs(e){return this.filledPlaceholders.find((s=>s.PLACEHOLDER_ID===e))}function Ns(e){const s=babelHelpers.classPrivateFieldLooseBase(this,fs)[fs](e);if(s===null){return null}return Oe(s,this.placeholders[e],this.filledPlaceholders)}function Us(e){if(e===xe){return babelHelpers.classPrivateFieldLooseBase(this,ss)[ss]}if(e===Ne){return babelHelpers.classPrivateFieldLooseBase(this,ls)[ls]}if(e===Ue){return babelHelpers.classPrivateFieldLooseBase(this,as)[as]}return null}function Xs(e){var s;if(!d.Type.isPlainObject(e)){throw new TypeError('BX.Crm.Template.Editor: The "params" argument must be object')}if(!d.Type.isDomNode(e.target)){throw new Error('BX.Crm.Template.Editor: The "target" argument must be DOM node')}const l=Boolean((s=e.isReadOnly)!=null?s:false);if(!l&&babelHelpers.classPrivateFieldLooseBase(this,Ts)[Ts](e.usePlaceholderProvider)&&!BX.CrmEntityType.isDefined(e.entityTypeId)){throw new TypeError('BX.Crm.Template.Editor: The "entityTypeId" argument is not correct')}if(!l&&!d.Type.isFunction(e.onSelect)){throw new TypeError('BX.Crm.Template.Editor: The "onSelect" argument is not correct')}}function ks(e){return d.Type.isNil(e)||e===true}e.Editor=ms;e.Previewer=J;e.getPlainText=Oe})(this.BX.Crm.Template=this.BX.Crm.Template||{},BX.Crm.EntitySelectorEx,BX.Event,BX,BX.UI.EntitySelector,BX,BX.UI,BX,BX.Main,BX.UI,BX);
//# sourceMappingURL=editor.bundle.map.js