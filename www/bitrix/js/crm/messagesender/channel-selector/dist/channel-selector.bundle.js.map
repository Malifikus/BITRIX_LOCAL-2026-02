{"version":3,"file":"channel-selector.bundle.js","sources":["../src/selector.js"],"sourcesContent":["import { type Appearance, type ChannelPosition, type PromoBanner } from 'crm.messagesender.editor';\nimport { Dom, Extension, Loc, Runtime, Tag, Text, Type } from 'main.core';\nimport { EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport './selector.css';\nimport { AirButtonStyle, Button, ButtonSize } from 'ui.buttons';\nimport { Icon, Outline } from 'ui.icon-set.api.core';\n\nexport type SelectorOptions = {\n\titems: SelectorItem[],\n\tbanners: PromoBanner[],\n\tbindElement: HTMLElement,\n\titemsSort: ChannelPosition[],\n\tevents: ?Object,\n\tanalytics: ?Object,\n};\n\nexport type SelectorItem = {\n\tid: string,\n\tappearance: Appearance,\n\tonclick: (SelectorItem) => void,\n}\n\n/**\n * @emits BX.Crm.MessageSender.ChannelSelector.Selector:onShow\n * @emits BX.Crm.MessageSender.ChannelSelector.Selector:onClose\n * @emits BX.Crm.MessageSender.ChannelSelector.Selector:onDestroy\n * @emits BX.Crm.MessageSender.ChannelSelector.Selector:onSave\n * @emits BX.Crm.MessageSender.ChannelSelector.Selector:onConnectionsSliderClose\n * @emits BX.Crm.MessageSender.ChannelSelector.Selector:onPromoBannerSliderClose\n */\nexport class Selector extends EventEmitter\n{\n\t#bindElement: ?HTMLElement;\n\t#items: SelectorItem[];\n\t#banners: PromoBanner[];\n\t#itemsSort: ChannelPosition[];\n\t#analytics: ?Object;\n\t#popup: Popup | null;\n\n\tconstructor(options: SelectorOptions = {})\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Crm.MessageSender.ChannelSelector.Selector');\n\n\t\tthis.#items = Type.isArray(options.items) ? options.items : [];\n\t\tthis.#banners = Type.isArray(options.banners) ? options.banners : [];\n\t\tthis.#itemsSort = Type.isArray(options.itemsSort) ? options.itemsSort : [];\n\n\t\tthis.#normalizeItemsSort(this.#items, this.#itemsSort);\n\t\tthis.#sortItems(this.#items);\n\n\t\tthis.#bindElement = Type.isDomNode(options.bindElement) ? options.bindElement : null;\n\t\tthis.#analytics = Type.isPlainObject(options.analytics) ? options.analytics : null;\n\t\tthis.subscribeFromOptions(options.events ?? {});\n\t}\n\n\tisShown(): boolean\n\t{\n\t\treturn Boolean(this.#popup?.isShown());\n\t}\n\n\tshow(): void\n\t{\n\t\tthis.#popup ??= this.#buildPopup();\n\n\t\tthis.#popup.show();\n\t}\n\n\tclose(): void\n\t{\n\t\tthis.#popup?.close();\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#popup?.destroy();\n\t\tthis.unsubscribeAll();\n\t\tthis.#popup = null;\n\t\tRuntime.destroy(this);\n\t}\n\n\t#buildPopup(): Popup\n\t{\n\t\treturn new Popup({\n\t\t\tbindElement: this.#bindElement,\n\t\t\tcontent: this.#renderContent(),\n\t\t\tautoHide: true,\n\t\t\tcloseByEsc: true,\n\t\t\tpadding: 0,\n\t\t\tborderRadius: '24px',\n\t\t\tminWidth: 350,\n\t\t\tmaxWidth: 650,\n\t\t\tevents: {\n\t\t\t\tonShow: () => {\n\t\t\t\t\tthis.emit('onShow');\n\t\t\t\t},\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.emit('onClose');\n\t\t\t\t},\n\t\t\t\tonDestroy: () => {\n\t\t\t\t\tthis.emit('onDestroy');\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t#renderContent(): HTMLElement\n\t{\n\t\tconst container = Tag.render`<div class=\"crm-messagesender-channel-selector\"></div>`;\n\n\t\tDom.append(this.#renderBody(), container);\n\n\t\tif (Type.isArrayFilled(this.#banners))\n\t\t{\n\t\t\tDom.append(this.#renderBanners(), container);\n\t\t}\n\n\t\tDom.append(this.#renderFooter(), container);\n\n\t\treturn container;\n\t}\n\n\t#renderBody(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-messagesender-channel-selector-body\">\n\t\t\t\t<div class=\"crm-messagesender-channel-selector-title\">${Loc.getMessage('CRM_MESSAGESENDER_CHANNEL_SELECTOR_ALL_CHANNELS')}</div>\n\t\t\t\t<div class=\"crm-messagesender-channel-selector-list\">${this.#renderVisibleItems()}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderVisibleItems(): HTMLElement[]\n\t{\n\t\tconst visible = this.#items.filter((item: SelectorItem) => !this.#isHidden(item));\n\n\t\treturn visible.map((options: SelectorItem) => this.#renderItem(options));\n\t}\n\n\t#renderItem(options: SelectorItem): HTMLElement\n\t{\n\t\tconst icon = new Icon({\n\t\t\ticon: options.appearance.icon.title,\n\t\t\tcolor: options.appearance.icon.color,\n\t\t});\n\n\t\tconst onClick = () => {\n\t\t\toptions.onclick?.(options);\n\t\t};\n\n\t\tconst contentContainer = Tag.render`\n\t\t\t<div class=\"crm-messagesender-channel-selector-content\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"\n\t\t\t\t\t\tcrm-messagesender-channel-selector-item-title\n\t\t\t\t\t\tcrm-messagesender-channel-selector-ellipsis\n\t\t\t\t\t\"\n\t\t\t\t\ttitle=\"${Text.encode(options.appearance.title)}\"\n\t\t\t\t>${Text.encode(options.appearance.title)}</div>\n\t\t\t</div>\n\t\t`;\n\n\t\tif (Type.isStringFilled(options.appearance.subtitle))\n\t\t{\n\t\t\tDom.append(\n\t\t\t\tTag.render`\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"\n\t\t\t\t\t\t\tcrm-messagesender-channel-selector-item-subtitle \n\t\t\t\t\t\t\tcrm-messagesender-channel-selector-ellipsis\n\t\t\t\t\t\t\"\n\t\t\t\t\t\ttitle=\"${Text.encode(options.appearance.subtitle)}\"\n\t\t\t\t\t>${Text.encode(options.appearance.subtitle)}</div>\n\t\t\t\t`,\n\t\t\t\tcontentContainer,\n\t\t\t);\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-messagesender-channel-selector-item\" onclick=\"${onClick}\">\n\t\t\t\t<div\n\t\t\t\t\tclass=\"crm-messagesender-channel-selector-icon\"\n\t\t\t\t\tstyle=\"background: ${Text.encode(options.appearance.icon.background)};\"\n\t\t\t\t>${icon.render()}</div>\n\t\t\t\t${contentContainer}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#normalizeItemsSort(items: SelectorItem[], itemsSort: ChannelPosition[]): void\n\t{\n\t\tfor (const item of items)\n\t\t{\n\t\t\tif (!itemsSort.some((x) => x.channelId === item.id))\n\t\t\t{\n\t\t\t\titemsSort.unshift({\n\t\t\t\t\tchannelId: item.id,\n\t\t\t\t\tisHidden: false,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#ensureMaxVisibleChannels(itemsSort);\n\t\tthis.#ensureMinVisibleChannels(itemsSort);\n\t}\n\n\t#isHidden(item: SelectorItem): boolean\n\t{\n\t\tconst position: ?ChannelPosition = this.#itemsSort.find((x) => x.channelId === item.id);\n\t\tif (!position)\n\t\t{\n\t\t\tthrow new Error(`Position not found for item: ${item.id}`);\n\t\t}\n\n\t\treturn position.isHidden;\n\t}\n\n\t#sortItems(items: {id: string}[]): void\n\t{\n\t\titems.sort((a: SelectorItem, b: SelectorItem) => {\n\t\t\tconst positionA: ?ChannelPosition = this.#itemsSort.find((x) => x.channelId === a.id);\n\t\t\tconst positionB: ?ChannelPosition = this.#itemsSort.find((x) => x.channelId === b.id);\n\n\t\t\tif (positionA.isHidden && !positionB.isHidden)\n\t\t\t{\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tif (!positionA.isHidden && positionB.isHidden)\n\t\t\t{\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tconst positionIndexA = Type.isNil(positionA) ? -1 : this.#itemsSort.indexOf(positionA);\n\t\t\tconst positionIndexB = Type.isNil(positionB) ? -1 : this.#itemsSort.indexOf(positionB);\n\n\t\t\treturn positionIndexA - positionIndexB;\n\t\t});\n\t}\n\n\t#renderBanners(): HTMLElement\n\t{\n\t\tconst banners = this.#banners.map((options: PromoBanner) => this.#renderSingleBanner(options));\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-messagesender-channel-selector-banner-container\">\n\t\t\t\t<div class=\"crm-messagesender-channel-selector-banner-title\">${\n\t\t\t\t\tLoc.getMessage('CRM_MESSAGESENDER_CHANNEL_SELECTOR_RECOMMENDED')\n\t\t\t\t}</div>\n\t\t\t\t<div class=\"crm-messagesender-channel-selector-banner-list\">${banners}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderSingleBanner(banner: PromoBanner): HTMLElement\n\t{\n\t\tlet icon: HTMLElement = null;\n\t\tif (Type.isStringFilled(banner.customIconName) && /^[\\w-]+$/.test(banner.customIconName))\n\t\t{\n\t\t\tconst url = `/bitrix/js/crm/messagesender/channel-selector/images/custom-icons/${\n\t\t\t\tText.encode(banner.customIconName)\n\t\t\t}.svg`;\n\n\t\t\ticon = Tag.render`\n\t\t\t\t<div class=\"crm-messagesender-channel-selector-icon\">\n\t\t\t\t\t<img alt=\"${Text.encode(banner.title)}\" src=\"${url}\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse if (Type.isPlainObject(banner.icon))\n\t\t{\n\t\t\tconst iconApi = new Icon({\n\t\t\t\ticon: banner.icon.title,\n\t\t\t\tcolor: banner.icon.color,\n\t\t\t});\n\n\t\t\ticon = Tag.render`\n\t\t\t\t<div\n\t\t\t\t\tclass=\"crm-messagesender-channel-selector-icon\"\n\t\t\t\t\tstyle=\"background: ${Text.encode(banner.icon.background)};\"\n\t\t\t\t>${iconApi.render()}</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthrow new TypeError('Banner icon is not defined');\n\t\t}\n\n\t\tconst button = new Button({\n\t\t\ttext: Loc.getMessage('CRM_MESSAGESENDER_CHANNEL_SELECTOR_CONNECT'),\n\t\t\tuseAirDesign: true,\n\t\t\tstyle: AirButtonStyle.OUTLINE,\n\t\t\tsize: ButtonSize.SMALL,\n\t\t\tonclick: async () => {\n\t\t\t\tconst slider = await this.#openSlider(banner.connectionUrl, {\n\t\t\t\t\twidth: 700,\n\t\t\t\t});\n\n\t\t\t\tthis.emit('onPromoBannerSliderClose', {\n\t\t\t\t\tbannerId: banner.id,\n\t\t\t\t\tconnectStatus: slider.getData().get('status'),\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-messagesender-channel-selector-item\" style=\"background: ${Text.encode(banner.background)};\">\n\t\t\t\t${icon}\n\t\t\t\t<div class=\"crm-messagesender-channel-selector-content\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"\n\t\t\t\t\t\t\tcrm-messagesender-channel-selector-item-title \n\t\t\t\t\t\t\tcrm-messagesender-channel-selector-ellipsis\n\t\t\t\t\t\t\"\n\t\t\t\t\t\ttitle=\"${Text.encode(banner.title)}\"\n\t\t\t\t\t>${Text.encode(banner.title)}</div>\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass=\"\n\t\t\t\t\t\t\tcrm-messagesender-channel-selector-item-subtitle \n\t\t\t\t\t\t\tcrm-messagesender-channel-selector-ellipsis\n\t\t\t\t\t\t\"\n\t\t\t\t\t\ttitle=\"${Text.encode(banner.subtitle)}\"\n\t\t\t\t\t>${Text.encode(banner.subtitle)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"crm-messagesender-channel-selector-banner-link\">${\n\t\t\t\t\tbutton.render()\n\t\t\t\t}</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#renderFooter(): HTMLElement\n\t{\n\t\tconst addButton = new Button({\n\t\t\ttext: Loc.getMessage('CRM_MESSAGESENDER_CHANNEL_SELECTOR_ADD_CHANNEL'),\n\t\t\tuseAirDesign: true,\n\t\t\tstyle: AirButtonStyle.PLAIN_NO_ACCENT,\n\t\t\tsize: ButtonSize.SMALL,\n\t\t\ticon: Outline.PLUS_L,\n\t\t\tonclick: async () => {\n\t\t\t\tawait this.#openMessageSenderConnectionsSlider();\n\n\t\t\t\tthis.emit('onConnectionsSliderClose');\n\t\t\t},\n\t\t});\n\n\t\tconst configureButton = new Button({\n\t\t\ttext: Loc.getMessage('CRM_MESSAGESENDER_CHANNEL_SELECTOR_CONFIGURE'),\n\t\t\tuseAirDesign: true,\n\t\t\tstyle: AirButtonStyle.PLAIN_NO_ACCENT,\n\t\t\tsize: ButtonSize.SMALL,\n\t\t\ticon: Outline.SETTINGS,\n\t\t\tonclick: () => {\n\t\t\t\tthis.#enterEditMode();\n\t\t\t},\n\t\t});\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"crm-messagesender-channel-selector-footer\">\n\t\t\t\t${addButton.render()}\n\t\t\t\t${configureButton.render()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tasync #openMessageSenderConnectionsSlider(): Promise<?BX.SidePanel.Slider>\n\t{\n\t\tconst { Router } = await Runtime.loadExtension('crm.router');\n\n\t\t/** @see BX.Crm.Router.openMessageSenderConnectionsSlider */\n\t\treturn Router.Instance.openMessageSenderConnectionsSlider(this.#analytics);\n\t}\n\n\t/**\n\t * Resolves when the slider is closed.\n\t */\n\t#openSlider(url: string, options: ?Object = null): Promise<?BX.SidePanel.Slider>\n\t{\n\t\treturn Runtime.loadExtension('crm.router')\n\t\t\t.then(({ Router }) => {\n\t\t\t\t/** @see BX.Crm.Router.openSlider */\n\t\t\t\treturn Router.openSlider(url, options);\n\t\t\t}).catch((error) => {\n\t\t\t\tconsole.error('cant load crm.router', error);\n\n\t\t\t\tthrow error;\n\t\t\t})\n\t\t;\n\t}\n\n\t#enterEditMode(): void\n\t{\n\t\tconst wasShown = this.isShown();\n\n\t\tRuntime.loadExtension('ui.menu-configurable')\n\t\t\t.then(({ Menu }) => {\n\t\t\t\tconst items = this.#items.map((item: SelectorItem) => {\n\t\t\t\t\tconst html = Tag.render`\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclass=\"crm-messagesender-channel-selector-ellipsis\"\n\t\t\t\t\t\t\t\ttitle=\"${Text.encode(item.appearance.title)}\"\n\t\t\t\t\t\t\t>${Text.encode(item.appearance.title)}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t`;\n\n\t\t\t\t\tif (Type.isStringFilled(item.appearance.subtitle))\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.append(\n\t\t\t\t\t\t\tTag.render`\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\tclass=\"\n\t\t\t\t\t\t\t\t\t\tcrm-messagesender-channel-selector-edit-item-subtitle \n\t\t\t\t\t\t\t\t\t\tcrm-messagesender-channel-selector-ellipsis\n\t\t\t\t\t\t\t\t\t\"\n\t\t\t\t\t\t\t\t\ttitle=\"${Text.encode(item.appearance.subtitle)}\"\n\t\t\t\t\t\t\t\t>${Text.encode(item.appearance.subtitle)}</span>\n\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\thtml,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tid: item.id,\n\t\t\t\t\t\tisHidden: this.#isHidden(item),\n\t\t\t\t\t\thtml,\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\t/** @see BX.UI.MenuConfigurable.Menu */\n\t\t\t\tconst menu = new Menu({\n\t\t\t\t\titems,\n\t\t\t\t\tbindElement: this.#bindElement,\n\t\t\t\t\tmaxVisibleItems: this.#getMaxVisibleChannels(),\n\t\t\t\t\tmaxWidth: 600,\n\t\t\t\t});\n\n\t\t\t\tthis.close();\n\n\t\t\t\treturn menu.open();\n\t\t\t})\n\t\t\t.then((openResult) => {\n\t\t\t\tif (!openResult.isCanceled && Type.isArray(openResult?.items))\n\t\t\t\t{\n\t\t\t\t\tthis.#save(openResult.items);\n\t\t\t\t}\n\n\t\t\t\tif (wasShown)\n\t\t\t\t{\n\t\t\t\t\tthis.show();\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.error('cant load ui.menu-configurable', error);\n\t\t\t});\n\t}\n\n\t#getMaxVisibleChannels(): number\n\t{\n\t\tconst settings = Extension.getSettings('crm.messagesender.channel-selector');\n\n\t\treturn Text.toInteger(settings.get('maxVisibleChannels'));\n\t}\n\n\t#getMinVisibleChannels(): number\n\t{\n\t\tconst settings = Extension.getSettings('crm.messagesender.channel-selector');\n\n\t\treturn Text.toInteger(settings.get('minVisibleChannels'));\n\t}\n\n\t#save(editItems: Array): void\n\t{\n\t\tthis.#ensureMinVisibleChannels(editItems);\n\t\tthis.#updateItemsSort(editItems);\n\n\t\tthis.#popup?.setContent(this.#renderContent());\n\n\t\tthis.emit('onSave', { itemsSort: this.#itemsSort });\n\t}\n\n\t#ensureMinVisibleChannels(positions: Array<{isHidden: boolean}>): void\n\t{\n\t\tconst visibleCount = positions.filter((item) => !item.isHidden).length;\n\t\tif (visibleCount >= this.#getMinVisibleChannels())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst toShow = this.#getMinVisibleChannels() - visibleCount;\n\n\t\tlet shown = 0;\n\t\tfor (const item of positions)\n\t\t{\n\t\t\tif (item.isHidden)\n\t\t\t{\n\t\t\t\titem.isHidden = false;\n\t\t\t\tshown += 1;\n\t\t\t}\n\n\t\t\tif (shown >= toShow)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\t#ensureMaxVisibleChannels(positions: Array<{isHidden: boolean}>): void\n\t{\n\t\tconst visible = positions.filter((item) => !item.isHidden);\n\t\tif (visible.length <= this.#getMaxVisibleChannels())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst toHide = visible.slice(this.#getMaxVisibleChannels(), visible.length);\n\t\tfor (const item of toHide)\n\t\t{\n\t\t\titem.isHidden = true;\n\t\t}\n\t}\n\n\t#updateItemsSort(editItems: Array): void\n\t{\n\t\tthis.#itemsSort = editItems\n\t\t\t.map((item) => {\n\t\t\t\treturn {\n\t\t\t\t\tchannelId: item.id,\n\t\t\t\t\tisHidden: item.isHidden,\n\t\t\t\t};\n\t\t\t})\n\t\t;\n\t\tthis.#normalizeItemsSort(this.#items, this.#itemsSort);\n\t\tthis.#sortItems(this.#items);\n\t}\n}\n"],"names":["Selector","EventEmitter","constructor","options","setEventNamespace","Type","isArray","items","banners","itemsSort","isDomNode","bindElement","isPlainObject","analytics","subscribeFromOptions","events","isShown","Boolean","show","close","destroy","unsubscribeAll","Runtime","Popup","content","autoHide","closeByEsc","padding","borderRadius","minWidth","maxWidth","onShow","emit","onClose","onDestroy","container","Tag","render","Dom","append","isArrayFilled","Loc","getMessage","visible","filter","item","map","icon","Icon","appearance","title","color","onClick","onclick","contentContainer","Text","encode","isStringFilled","subtitle","background","some","x","channelId","id","unshift","isHidden","position","find","Error","sort","a","b","positionA","positionB","positionIndexA","isNil","indexOf","positionIndexB","banner","customIconName","test","url","iconApi","TypeError","button","Button","text","useAirDesign","style","AirButtonStyle","OUTLINE","size","ButtonSize","SMALL","slider","connectionUrl","width","bannerId","connectStatus","getData","get","addButton","PLAIN_NO_ACCENT","Outline","PLUS_L","configureButton","SETTINGS","Router","loadExtension","Instance","openMessageSenderConnectionsSlider","then","openSlider","catch","error","console","wasShown","Menu","html","menu","maxVisibleItems","open","openResult","isCanceled","settings","Extension","getSettings","toInteger","editItems","setContent","positions","visibleCount","length","toShow","shown","toHide","slice"],"mappings":"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"}