{"version":3,"file":"editor.bundle.js","sources":["../src/components/content/custom-message-content/length-counter.js","../src/components/content/layout/content-body.js","../src/components/content/layout/content-footer.js","../src/components/content/message-preview.js","../src/components/content/custom-message-content.js","../src/components/content/layout/content-container.js","../src/components/content/notification-message-content.js","../src/components/content/template-message-content.js","../src/components/editor-alert.js","../src/components/editor-footer.js","../src/components/editor-header/channel-selector.js","../src/components/editor-header/receiver-selector.js","../src/components/editor-header/template-selector.js","../src/components/editor-header.js","../src/components/message-editor.js","../src/model/analytics-model.js","../src/model/helpers.js","../src/model/application-model.js","../src/model/channels-model.js","../src/model/message-model.js","../src/model/preferences-model.js","../src/model/templates-model.js","../src/service/alert-service.js","../src/service/analytics-service.js","../src/service/copilot-service.js","../src/service/document-service.js","../src/service/file-service.js","../src/service/logger.js","../src/service/preferences-service.js","../src/service/salescenter-service.js","../src/service/send-service.js","../src/service/template-service.js","../src/service/service-locator.js","../src/state-exporter.js","../src/editor.js"],"sourcesContent":["import { Extension, Loc, Text } from 'main.core';\nimport { Text as BText } from 'ui.system.typography.vue';\nimport { mapState } from 'ui.vue3.vuex';\n\n// @vue/component\nexport const LengthCounter = {\n\tname: 'LengthCounter',\n\tcomponents: {\n\t\tBText,\n\t},\n\tcomputed: {\n\t\t...mapState({\n\t\t\tmessage: (state) => state.message.text,\n\t\t}),\n\t\tmessageLengthCounter(): string\n\t\t{\n\t\t\tconst colorStart = this.isOverflow ? '<span style=\"color: #d0011b;\">' : '<span>';\n\t\t\tconst colorEnd = '</span>';\n\n\t\t\treturn Loc.getMessage(\n\t\t\t\t'CRM_MESSAGESENDER_EDITOR_COUNTER',\n\t\t\t\t{\n\t\t\t\t\t'[color]': colorStart,\n\t\t\t\t\t'#COUNT#': Text.toInteger(this.message.length),\n\t\t\t\t\t'[/color]': colorEnd,\n\t\t\t\t\t'#MAX#': this.recommendedMaxMessageLength,\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tisOverflow(): boolean\n\t\t{\n\t\t\treturn this.message.length > this.recommendedMaxMessageLength;\n\t\t},\n\t\trecommendedMaxMessageLength(): number\n\t\t{\n\t\t\treturn Text.toInteger(\n\t\t\t\tExtension.getSettings('crm.messagesender.editor').get('recommendedMaxMessageLength'),\n\t\t\t);\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BText \n\t\t\tsize=\"sm\"\n\t\t\ttag=\"div\"\n\t\t\tclassName=\"crm-messagesender-editor__content__footer__text\"\n\t\t><span v-html=\"messageLengthCounter\"></span></BText>\n\t`,\n};\n","// @vue/component\nexport const ContentBody = {\n\tname: 'ContentBody',\n\tprops: {\n\t\tbgColor: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tborderColor: {\n\t\t\ttype: String,\n\t\t\tdefault: 'var(--ui-color-divider-accent)',\n\t\t},\n\t\tpadding: {\n\t\t\ttype: String,\n\t\t\tdefault: 'var(--ui-space-inset-md)',\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div\n\t\t\tclass=\"crm-messagesender-editor__content__body\"\n\t\t\t:style=\"{\n\t\t\t\tbackgroundColor: bgColor,\n\t\t\t\tborder: 'var(--ui-border-width-thin) var(--ui-text-decoration-style-solid) ' + borderColor,\n\t\t\t\tpadding: padding,\n\t\t\t}\"\n\t\t>\n\t\t\t<slot/>\n\t\t</div>\n\t`,\n};\n","// @vue/component\nexport const ContentFooter = {\n\tname: 'ContentFooter',\n\ttemplate: `\n\t\t<div class=\"crm-messagesender-editor__content__footer\">\n\t\t\t<slot/>\n\t\t</div>\n\t`,\n};\n","import { Previewer } from 'crm.template.editor';\nimport { Text as BText } from 'ui.system.typography.vue';\nimport { mapGetters, mapState } from 'ui.vue3.vuex';\n\n// @vue/component\nexport const MessagePreview = {\n\tname: 'MessagePreview',\n\tcomponents: {\n\t\tBText,\n\t},\n\tplaceholdersPreviewer: null,\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\t/** @type boolean */\n\t\t\tisProgress: 'application/isProgress',\n\t\t\t/** @type string */\n\t\t\tmessageBody: 'message/body',\n\t\t\t/** @type Channel */\n\t\t\tcurrentChannel: 'channels/current',\n\t\t}),\n\t\t...mapState({\n\t\t\tcontext: (state) => state.application.context,\n\t\t}),\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.placeholdersPreviewer?.destroy();\n\t},\n\tmethods: {\n\t\ttogglePreviewer(): void\n\t\t{\n\t\t\tif (this.isProgress || this.messageBody.trim().length === 0)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.placeholdersPreviewer ??= new Previewer({\n\t\t\t\t...this.context,\n\t\t\t\tbindElement: this.$refs.preview.$el,\n\t\t\t\tisDisplayFormat: !this.currentChannel?.isTemplatesBased,\n\t\t\t});\n\n\t\t\tif (this.placeholdersPreviewer.isShown())\n\t\t\t{\n\t\t\t\tthis.placeholdersPreviewer.close();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.$Bitrix.Data.get('locator').getAnalyticsService().onPreviewShow();\n\n\t\t\t\tthis.placeholdersPreviewer.preview(this.messageBody);\n\t\t\t}\n\t\t},\n\t},\n\ttemplate: `\n\t\t<BText\n\t\t\tref=\"preview\"\n\t\t\tsize=\"sm\"\n\t\t\ttag=\"div\"\n\t\t\t:className=\"{\n\t\t\t\t'crm-messagesender-editor__content__footer__text': true, \n\t\t\t\t'--pointer': !isProgress && messageBody.trim().length > 0,\n\t\t\t\t'--disabled': isProgress || messageBody.trim().length <= 0,\n\t\t\t}\"\n\t\t\tdata-test-role=\"preview\"\n\t\t\t@click=\"togglePreviewer\"\n\t\t>{{ $Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_PREVIEW') }}</BText>\n\t`,\n};\n","import { Runtime, Type } from 'main.core';\nimport { type BaseEvent } from 'main.core.events';\nimport { Dialog } from 'ui.entity-selector';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport { type MenuItemOptions, type MenuOptions } from 'ui.system.menu.vue';\nimport { Text as BText } from 'ui.system.typography.vue';\nimport { BitrixVue } from 'ui.vue3';\nimport { AirButtonStyle, Button as BButton } from 'ui.vue3.components.button';\nimport { mapGetters, mapState } from 'ui.vue3.vuex';\nimport type { Document, DocumentService } from '../../service/document-service';\nimport { type File, type FileService } from '../../service/file-service';\nimport { type ApplicationResult, type SalescenterService } from '../../service/salescenter-service';\nimport { LengthCounter } from './custom-message-content/length-counter';\nimport { ContentBody } from './layout/content-body';\nimport { ContentFooter } from './layout/content-footer';\nimport { MessagePreview } from './message-preview';\n\nconst MAX_TEXTAREA_HEIGHT = 150;\n\n// @vue/component\nexport const CustomMessageContent = {\n\tname: 'CustomMessageContent',\n\tcomponents: {\n\t\tBButton,\n\t\tBText,\n\t\tBMenu: BitrixVue.defineAsyncComponent('ui.system.menu.vue', 'BMenu'),\n\t\tPopup: BitrixVue.defineAsyncComponent('ui.vue3.components.popup', 'Popup'),\n\t\tSmiles: BitrixVue.defineAsyncComponent('ui.vue3.components.smiles', 'Smiles'),\n\t\tMessagePreview,\n\t\tContentBody,\n\t\tContentFooter,\n\t\tLengthCounter,\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tAirButtonStyle,\n\t\t\tOutline,\n\t\t};\n\t},\n\tplaceholdersDialog: null,\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisAddMenuShown: false,\n\t\t\tisSmilesShown: false,\n\t\t\ttextAreaHeight: 'auto',\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\t/** @type boolean */\n\t\t\tisProgress: 'application/isProgress',\n\t\t}),\n\t\t...mapState({\n\t\t\tcontentProviders: (state) => state.application.contentProviders,\n\t\t\t/** @type {Layout} */\n\t\t\tlayout: (state) => state.application.layout,\n\t\t\tcontext: (state) => state.application.context,\n\t\t}),\n\t\tmessage: {\n\t\t\tget(): string\n\t\t\t{\n\t\t\t\treturn this.$store.state.message.text;\n\t\t\t},\n\t\t\tset(text: string): void\n\t\t\t{\n\t\t\t\tthis.$store.dispatch('message/setText', { text });\n\t\t\t},\n\t\t},\n\t\tisShowActionsButton(): boolean\n\t\t{\n\t\t\treturn this.layout.isContentProvidersShown && this.menuItems.length > 0;\n\t\t},\n\t\tisShowCopilot(): boolean\n\t\t{\n\t\t\treturn this.layout.isContentProvidersShown && this.contentProviders.copilot?.isShown;\n\t\t},\n\t\tmenuOptions(): MenuOptions\n\t\t{\n\t\t\treturn {\n\t\t\t\tbindElement: this.$refs.actions,\n\t\t\t\tsections: [\n\t\t\t\t\t{\n\t\t\t\t\t\tcode: 'crmValues',\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\titems: this.menuItems,\n\t\t\t};\n\t\t},\n\t\tmenuItems(): MenuItemOptions[]\n\t\t{\n\t\t\tconst items = [];\n\t\t\tif (this.contentProviders.files?.isShown)\n\t\t\t{\n\t\t\t\tconst item = {\n\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_ADD_FILE'),\n\t\t\t\t\ticon: Outline.ATTACH,\n\t\t\t\t\tisLocked: this.contentProviders.files.isLocked,\n\t\t\t\t};\n\n\t\t\t\tif (this.contentProviders.files.isEnabled && !this.contentProviders.files.isLocked)\n\t\t\t\t{\n\t\t\t\t\titem.subMenu = {};\n\t\t\t\t\titem.subMenu.items = [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_ADD_FILE_UPLOAD'),\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\tif (this.isProgress)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.getFileService().uploadNewFile(this.processFileResult);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_ADD_FILE_DISK'),\n\t\t\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\t\t\tif (this.isProgress)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.getFileService().pickFromDisk(this.processFileResult);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t\telse if (this.contentProviders.files.isLocked)\n\t\t\t\t{\n\t\t\t\t\titem.onClick = () => {\n\t\t\t\t\t\tvoid this.showLimitSlider(this.contentProviders.files.sliderCode);\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\titems.push(item);\n\t\t\t}\n\n\t\t\tif (this.contentProviders.salescenter?.isShown)\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_ADD_PAYMENT'),\n\t\t\t\t\ticon: Outline.MONEY,\n\t\t\t\t\tisLocked: this.contentProviders.salescenter.isLocked,\n\t\t\t\t\tonClick: async () => {\n\t\t\t\t\t\tif (this.isProgress)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.contentProviders.salescenter.isLocked)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.getSalescenterService().showSalescenterDisabledSlider();\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!this.contentProviders.salescenter.isEnabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$Bitrix.Data.get('locator').getLogger().warn('salescenter is not enabled');\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst result = await this.getSalescenterService().openApplication();\n\t\t\t\t\t\tthis.processSalescenterResult(result);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.contentProviders.documents?.isEnabled)\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_ADD_DOCUMENT'),\n\t\t\t\t\ticon: Outline.FILE,\n\t\t\t\t\tonClick: async () => {\n\t\t\t\t\t\tif (this.isProgress)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst document = await this.getDocumentService().selectOrCreateDocument(this.$refs.actions);\n\t\t\t\t\t\tif (!Type.isNil(document))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.processDocumentResult(document);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (this.contentProviders.crmValues?.isEnabled)\n\t\t\t{\n\t\t\t\titems.push({\n\t\t\t\t\ttitle: this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_ADD_CRM'),\n\t\t\t\t\tsectionCode: 'crmValues',\n\t\t\t\t\ticon: Outline.PROMPT_VAR,\n\t\t\t\t\tonClick: () => {\n\t\t\t\t\t\tif (this.isProgress)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.openPlaceholdersDialog();\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn items;\n\t\t},\n\t\tbgColor(): string\n\t\t{\n\t\t\treturn this.layout.isMessageTextReadOnly ? 'var(--ui-color-accent-soft-blue-3)' : undefined;\n\t\t},\n\t},\n\twatch: {\n\t\t'message.length': function(): void\n\t\t{\n\t\t\tthis.textAreaHeight = 'auto';\n\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tconst height = Math.min(this.$refs.textarea.scrollHeight, MAX_TEXTAREA_HEIGHT);\n\n\t\t\t\tthis.textAreaHeight = `${height}px`;\n\t\t\t});\n\t\t},\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.placeholdersDialog?.destroy();\n\t},\n\tmethods: {\n\t\tgetFileService(): FileService\n\t\t{\n\t\t\treturn this.$Bitrix.Data.get('locator').getFileService();\n\t\t},\n\t\tgetSalescenterService(): SalescenterService\n\t\t{\n\t\t\treturn this.$Bitrix.Data.get('locator').getSalescenterService();\n\t\t},\n\t\tgetDocumentService(): DocumentService\n\t\t{\n\t\t\treturn this.$Bitrix.Data.get('locator').getDocumentService();\n\t\t},\n\t\tgetAnalyticsService(): AnalyticsService\n\t\t{\n\t\t\treturn this.$Bitrix.Data.get('locator').getAnalyticsService();\n\t\t},\n\t\tprocessFileResult(file: File): void\n\t\t{\n\t\t\tthis.$store.dispatch('message/setSource', { source: 'file' });\n\n\t\t\tthis.insertText(`${file.name} ${file.externalLink}`);\n\n\t\t\tthis.getAnalyticsService().onAddFile();\n\t\t},\n\t\tprocessDocumentResult(document: Document): void\n\t\t{\n\t\t\tthis.$store.dispatch('message/setSource', { source: 'document' });\n\n\t\t\tthis.insertText(`${document.title} ${document.publicUrl}`);\n\n\t\t\tthis.getAnalyticsService().onAddDocument();\n\t\t},\n\t\tprocessSalescenterResult(result: ApplicationResult): void\n\t\t{\n\t\t\tif (Type.isStringFilled(result.source))\n\t\t\t{\n\t\t\t\tthis.$store.dispatch('message/setSource', { source: result.source });\n\t\t\t}\n\n\t\t\tif (Type.isPlainObject(result.page))\n\t\t\t{\n\t\t\t\tthis.insertText(`${result.page.name} ${result.page.url}`);\n\n\t\t\t\tthis.getAnalyticsService().onAddSalescenterPage();\n\t\t\t}\n\t\t\telse if (Type.isPlainObject(result.payment))\n\t\t\t{\n\t\t\t\tthis.insertText(result.payment.name);\n\n\t\t\t\tif (!Type.isNil(result.payment.paymentId))\n\t\t\t\t{\n\t\t\t\t\tthis.$store.dispatch('message/setPaymentId', { paymentId: result.payment.paymentId });\n\t\t\t\t}\n\n\t\t\t\tif (!Type.isNil(result.payment.shipmentId))\n\t\t\t\t{\n\t\t\t\t\tthis.$store.dispatch('message/setShipmentId', { shipmentId: result.payment.shipmentId });\n\t\t\t\t}\n\n\t\t\t\tthis.getAnalyticsService().onAddSalescenterPayment();\n\t\t\t}\n\t\t\telse if (Type.isPlainObject(result.compilation))\n\t\t\t{\n\t\t\t\tthis.insertText(result.compilation.name);\n\n\t\t\t\tif (Type.isArray(result.compilation.productIds))\n\t\t\t\t{\n\t\t\t\t\tthis.$store.dispatch(\n\t\t\t\t\t\t'message/setCompilationProductIds',\n\t\t\t\t\t\t{ compilationProductIds: result.compilation.productIds },\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.getAnalyticsService().onAddSalescenterCompilation();\n\t\t\t}\n\t\t},\n\t\topenPlaceholdersDialog(): void\n\t\t{\n\t\t\tthis.placeholdersDialog ??= new Dialog({\n\t\t\t\ttargetNode: this.$refs.actions,\n\t\t\t\tmultiple: false,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tcompactView: true,\n\t\t\t\tenableSearch: true,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'placeholder',\n\t\t\t\t\t\tdynamicLoad: true,\n\t\t\t\t\t\tdynamicSearch: false,\n\t\t\t\t\t\tsearchable: true,\n\t\t\t\t\t\toptions: this.context,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event: BaseEvent) => {\n\t\t\t\t\t\tconst { item: selectedItem } = event.getData();\n\n\t\t\t\t\t\tthis.insertText(`{${selectedItem.getCustomData().get('text')}}`);\n\n\t\t\t\t\t\tthis.getAnalyticsService().onAddCrmValue();\n\n\t\t\t\t\t\tselectedItem.deselect();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.placeholdersDialog.show();\n\t\t},\n\t\tasync showCopilot(): void\n\t\t{\n\t\t\tif (this.isProgress)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.contentProviders.copilot?.isLocked)\n\t\t\t{\n\t\t\t\tvoid this.showLimitSlider(this.contentProviders.copilot.sliderCode);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.contentProviders.copilot?.isEnabled)\n\t\t\t{\n\t\t\t\tthis.$Bitrix.Data.get('locator').getLogger().warn('copilot is not enabled');\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst result = await this.$Bitrix.Data.get('locator').getCopilotService().showCopilot(\n\t\t\t\tthis.$refs.textarea,\n\t\t\t\t'',\n\t\t\t\tthis.message,\n\t\t\t);\n\t\t\tif (Type.isStringFilled(result.textReplace))\n\t\t\t{\n\t\t\t\tthis.message = result.textReplace;\n\t\t\t\tthis.getAnalyticsService().onAddCopilot();\n\t\t\t}\n\t\t\telse if (Type.isStringFilled(result.textBelow))\n\t\t\t{\n\t\t\t\tthis.message = `${this.message}\\n${result.textBelow}`;\n\t\t\t\tthis.getAnalyticsService().onAddCopilot();\n\t\t\t}\n\t\t},\n\t\tasync showLimitSlider(code: string): Promise<void>\n\t\t{\n\t\t\ttry\n\t\t\t{\n\t\t\t\t/** @see BX.UI.FeaturePromotersRegistry */\n\t\t\t\tconst { FeaturePromotersRegistry } = await Runtime.loadExtension('ui.info-helper');\n\t\t\t\tFeaturePromotersRegistry.getPromoter({ code }).show();\n\t\t\t}\n\t\t\tcatch (error)\n\t\t\t{\n\t\t\t\tthis.$Bitrix.Data.get('locator').getLogger().error('failed to show ui.info-helper', error);\n\t\t\t}\n\t\t},\n\t\ttoggleSmiles(): void\n\t\t{\n\t\t\tif (this.isProgress)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.isSmilesShown = !this.isSmilesShown;\n\t\t},\n\t\t// inserts text at the cursor position\n\t\tinsertText(text: string): void\n\t\t{\n\t\t\tconst start = this.$refs.textarea.selectionStart;\n\t\t\tconst end = this.$refs.textarea.selectionEnd;\n\n\t\t\tconst messageStart = this.message.slice(0, start);\n\t\t\tconst messageEnd = this.message.slice(end);\n\n\t\t\tlet paddedText = text;\n\n\t\t\tif (messageStart.length > 0 && !messageStart.endsWith(' ') && !paddedText.startsWith(' '))\n\t\t\t{\n\t\t\t\tpaddedText = ` ${paddedText}`;\n\t\t\t}\n\n\t\t\tif (messageEnd.length > 0 && !messageEnd.startsWith(' ') && !paddedText.endsWith(' '))\n\t\t\t{\n\t\t\t\tpaddedText = `${paddedText} `;\n\t\t\t}\n\n\t\t\tthis.message = messageStart + paddedText + messageEnd;\n\n\t\t\tvoid this.$nextTick(() => {\n\t\t\t\tconst position = start + paddedText.length;\n\n\t\t\t\tthis.$refs.textarea.selectionStart = position;\n\t\t\t\tthis.$refs.textarea.selectionEnd = position;\n\t\t\t\tthis.$refs.textarea.focus();\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ContentBody\n\t\t\tpadding=\"0 0 var(--ui-space-inset-xs) 0\"\n\t\t\t:bgColor=\"bgColor\"\n\t\t\t:borderColor=\"bgColor\"\n\t\t>\n\t\t\t\t<div class=\"crm-messagesender-editor__content__body__textarea-container\">\n\t\t\t\t\t<textarea\n\t\t\t\t\t\tref=\"textarea\"\n\t\t\t\t\t\tv-model=\"message\"\n\t\t\t\t\t\tclass=\"crm-messagesender-editor__content__body__textarea\"\n\t\t\t\t\t\t:placeholder=\"$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_PLACEHOLDER')\"\n\t\t\t\t\t\t:disabled=\"isProgress || layout.isMessageTextReadOnly\"\n\t\t\t\t\t\t:style=\"{ \n\t\t\t\t\t\t\theight: textAreaHeight,\n\t\t\t\t\t\t\tbackgroundColor: bgColor, \n\t\t\t\t\t\t}\"\n\t\t\t\t\t\tdata-test-role=\"message-text-input\"\n\t\t\t\t\t></textarea>\n\t\t\t\t</div>\n\t\t\t<div ref=\"actions\" v-if=\"isShowActionsButton || isShowCopilot || layout.isEmojiButtonShown\" class=\"crm-messagesender-editor__content__body__actions\">\n\t\t\t\t<div class=\"crm-messagesender-editor__content__body__actions__left\">\n\t\t\t\t\t<BButton\n\t\t\t\t\t\tv-if=\"isShowActionsButton\"\n\t\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_BUTTON_ADD')\"\n\t\t\t\t\t\t:style=\"AirButtonStyle.PLAIN\"\n\t\t\t\t\t\t:leftIcon=\"Outline.PLUS_M\"\n\t\t\t\t\t\t:disabled=\"isProgress || layout.isMessageTextReadOnly\"\n\t\t\t\t\t\t@click=\"isAddMenuShown = true\"\n\t\t\t\t\t/>\n\t\t\t\t\t<BMenu v-if=\"isAddMenuShown && !isProgress\" :options=\"menuOptions\" @close=\"isAddMenuShown = false\"/>\n\t\t\t\t\t<BButton\n\t\t\t\t\t\tv-if=\"isShowCopilot\"\n\t\t\t\t\t\t@click=\"showCopilot\"\n\t\t\t\t\t\t:style=\"AirButtonStyle.PLAIN\"\n\t\t\t\t\t\t:leftIcon=\"Outline.COPILOT\"\n\t\t\t\t\t\t:disabled=\"isProgress || layout.isMessageTextReadOnly\"\n\t\t\t\t\t\tclass=\"crm-messagesender-editor__content__body__actions__copilot\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div ref=\"buttons-right\">\n\t\t\t\t\t<BButton\n\t\t\t\t\t\tv-if=\"layout.isEmojiButtonShown\"\n\t\t\t\t\t\t:style=\"AirButtonStyle.PLAIN\"\n\t\t\t\t\t\t:leftIcon=\"Outline.SMILE\"\n\t\t\t\t\t\t@click=\"toggleSmiles\"\n\t\t\t\t\t\t:disabled=\"isProgress || layout.isMessageTextReadOnly\"\n\t\t\t\t\t/>\n\t\t\t\t\t<Popup\n\t\t\t\t\t\tv-if=\"isSmilesShown && !isProgress\"\n\t\t\t\t\t\t:options=\"{ \n\t\t\t\t\t\t\t\tbindElement: $refs['buttons-right'],\n\t\t\t\t\t\t\t\twidth: 300,\n\t\t\t\t\t\t\t\theight: 300,\n\t\t\t\t\t\t\t\toffsetLeft: -133,\n\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t@close=\"isSmilesShown = false\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<Smiles :isOnlyEmoji=\"true\" @selectSmile=\"insertText($event.text)\"/>\n\t\t\t\t\t</Popup>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</ContentBody>\n\t\t<ContentFooter>\n\t\t\t<MessagePreview v-if=\"layout.isMessagePreviewShown\"/>\n\t\t\t<div v-else></div>\n\t\t\t<LengthCounter/>\n\t\t</ContentFooter>\n\t`,\n};\n","// @vue/component\nexport const ContentContainer = {\n\tname: 'ContentContainer',\n\ttemplate: `\n\t\t<div class=\"crm-messagesender-editor__content\" data-role=\"content-container\">\n\t\t\t<slot/>\n\t\t</div>\n\t`,\n};\n","import { Editor, type FilledPlaceholder } from 'crm.template.editor';\nimport { Type } from 'main.core';\nimport { Text } from 'ui.system.typography.vue';\nimport { hint } from 'ui.vue3.directives.hint';\nimport { mapState } from 'ui.vue3.vuex';\nimport { type NotificationTemplate } from '../../editor';\nimport { ContentBody } from './layout/content-body';\n\n// @vue/component\nexport const NotificationMessageContent = {\n\tname: 'NotificationMessageContent',\n\tcomponents: {\n\t\tBText: Text,\n\t\tContentBody,\n\t},\n\tdirectives: {\n\t\thint,\n\t},\n\teditor: null,\n\tcomputed: {\n\t\t...mapState({\n\t\t\tnotificationTemplate: (state) => state.application.notificationTemplate,\n\t\t}),\n\t\ttitle(): string\n\t\t{\n\t\t\treturn this.notificationTemplate?.translation?.TITLE || '';\n\t\t},\n\t\tplaceholders(): NotificationTemplate['placeholders']\n\t\t{\n\t\t\treturn this.notificationTemplate?.placeholders ?? [];\n\t\t},\n\t\tpreviewPlaceholders(): string[]\n\t\t{\n\t\t\treturn this.placeholders.map((placeholder) => this.makeTranslationPlaceholderName(placeholder.name));\n\t\t},\n\t\tfilledPlaceholders(): FilledPlaceholder[]\n\t\t{\n\t\t\treturn this.placeholders\n\t\t\t\t.map((placeholder) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tPLACEHOLDER_ID: this.makeTranslationPlaceholderName(placeholder.name),\n\t\t\t\t\t\tFIELD_VALUE: placeholder.value ?? placeholder.caption ?? '',\n\t\t\t\t\t};\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\thasNotFilledPlaceholders(): boolean\n\t\t{\n\t\t\treturn this.placeholders.some((placeholder) => Type.isNil(placeholder.value));\n\t\t},\n\t\thint(): ?Object\n\t\t{\n\t\t\tif (!this.hasNotFilledPlaceholders)\n\t\t\t{\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\ttext: this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_PLACEHOLDER_FILLED_LATER_HINT'),\n\t\t\t\tposition: 'top',\n\t\t\t};\n\t\t},\n\t},\n\tmounted(): void\n\t{\n\t\tthis.editor = new Editor({\n\t\t\t...this.context,\n\t\t\ttarget: this.$refs.body,\n\t\t\tcanUsePreview: false,\n\t\t\tisReadOnly: true,\n\t\t});\n\n\t\tthis.editor\n\t\t\t.setPlaceholders({\n\t\t\t\tPREVIEW: this.previewPlaceholders,\n\t\t\t})\n\t\t\t.setFilledPlaceholders(this.filledPlaceholders)\n\t\t\t.setBody(this.notificationTemplate?.translation?.TEXT || this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_TEMPLATE_MESSAGE'))\n\t\t;\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.editor?.destroy();\n\t},\n\tmethods: {\n\t\tmakeTranslationPlaceholderName(placeholderName: string): string\n\t\t{\n\t\t\treturn `#${placeholderName}#`;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ContentBody bgColor=\"var(--ui-color-accent-soft-blue-3)\" borderColor=\"var(--ui-color-accent-soft-blue-3)\">\n\t\t\t<BText\n\t\t\t\tv-if=\"title\"\n\t\t\t\ttag=\"div\"\n\t\t\t\tsize=\"md\"\n\t\t\t\tstyle=\"\n\t\t\t\t\tcolor: var(--ui-color-base-4);\n\t\t\t\t\tmargin-bottom: 8px;\n\t\t\t\t\"\n\t\t\t>{{ title }}</BText>\n\t\t\t<div\n\t\t\t\tref=\"body\"\n\t\t\t\tv-hint=\"hint\"\n\t\t\t></div>\n\t\t</ContentBody>\n\t`,\n};\n","import { Editor, type OnSelectParams } from 'crm.template.editor';\nimport { Runtime, Type } from 'main.core';\nimport { Text } from 'ui.system.typography.vue';\nimport { mapGetters, mapState } from 'ui.vue3.vuex';\nimport type { Template } from '../../model/templates-model';\nimport { ContentBody } from './layout/content-body';\nimport { ContentFooter } from './layout/content-footer';\nimport { MessagePreview } from './message-preview';\n\n// @vue/component\nexport const TemplateMessageContent = {\n\tname: 'TemplateMessageContent',\n\tcomponents: {\n\t\tBText: Text,\n\t\tContentBody,\n\t\tContentFooter,\n\t\tMessagePreview,\n\t},\n\teditor: null,\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\t/** @type Channel */\n\t\t\tcurrentChannel: 'channels/current',\n\t\t\t/** @type ?Template */\n\t\t\ttemplate: 'templates/current',\n\t\t}),\n\t\t...mapState({\n\t\t\tcontext: (state) => state.application.context,\n\t\t\tisMessagePreviewShown: (state) => state.application.layout.isMessagePreviewShown,\n\t\t}),\n\t\ttemplateTitle(): string\n\t\t{\n\t\t\tif (Type.isNil(this.template))\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_NO_TEMPLATE_TITLE');\n\t\t\t}\n\n\t\t\treturn this.template.TITLE ?? '';\n\t\t},\n\t\ttemplateBody(): string\n\t\t{\n\t\t\tif (Type.isNil(this.template))\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_NO_TEMPLATE_BODY');\n\t\t\t}\n\n\t\t\treturn this.template.PREVIEW.replaceAll('\\n', '<br>') ?? '';\n\t\t},\n\t},\n\twatch: {\n\t\t'currentChannel.id': function(): void\n\t\t{\n\t\t\tthis.ensureTemplatesLoaded();\n\t\t},\n\t\ttemplate(): void\n\t\t{\n\t\t\tthis.adjustEditor();\n\t\t},\n\t},\n\tcreated()\n\t{\n\t\tthis.ensureTemplatesLoaded();\n\t},\n\tmounted(): void\n\t{\n\t\tthis.editor = new Editor({\n\t\t\t...this.context,\n\t\t\ttarget: this.$refs.body,\n\t\t\tcanUsePreview: false, // we render it ourselves\n\t\t\tcanUseFieldsDialog: true,\n\t\t\tcanUseFieldValueInput: true,\n\t\t\tonSelect: (params: OnSelectParams) => {\n\t\t\t\tthis.createOrUpdatePlaceholder(params);\n\n\t\t\t\tthis.$store.dispatch('templates/setFilledPlaceholder', {\n\t\t\t\t\tfilledPlaceholder: {\n\t\t\t\t\t\tPLACEHOLDER_ID: params.id,\n\t\t\t\t\t\tFIELD_NAME: params.value,\n\t\t\t\t\t\tFIELD_VALUE: params.text,\n\t\t\t\t\t\tPARENT_TITLE: params.parentTitle,\n\t\t\t\t\t\tTITLE: params.title,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\n\t\tthis.adjustEditor();\n\t},\n\tbeforeUnmount(): void\n\t{\n\t\tthis.editor?.destroy();\n\t},\n\tmethods: {\n\t\tensureTemplatesLoaded(): void\n\t\t{\n\t\t\t// hack to load templates only when we start working with the specific channel\n\t\t\tthis.$Bitrix.Data.get('locator').getTemplateService().loadTemplates();\n\t\t},\n\t\tcreateOrUpdatePlaceholder(params: OnSelectParams): void\n\t\t{\n\t\t\tthis.$Bitrix.Data.get('locator').getTemplateService().createOrUpdatePlaceholder(params);\n\t\t},\n\t\tadjustEditor(): void\n\t\t{\n\t\t\tthis.editor\n\t\t\t\t.setPlaceholders(Runtime.clone(this.template?.PLACEHOLDERS ?? []))\n\t\t\t\t.setFilledPlaceholders(Runtime.clone(this.template?.FILLED_PLACEHOLDERS ?? []))\n\t\t\t\t.setBody(this.templateBody)\n\t\t\t;\n\t\t},\n\t},\n\ttemplate: `\n\t\t<ContentBody bgColor=\"var(--ui-color-accent-soft-blue-3)\" borderColor=\"var(--ui-color-accent-soft-blue-3)\">\n\t\t\t<BText\n\t\t\t\ttag=\"div\"\n\t\t\t\tsize=\"md\"\n\t\t\t\tstyle=\"\n\t\t\t\t\t\tcolor: var(--ui-color-base-4);\n\t\t\t\t\t\tmargin-bottom: 8px;\n\t\t\t\t\t\"\n\t\t\t>{{ templateTitle }}</BText>\n\t\t\t<div ref=\"body\"></div>\n\t\t</ContentBody>\n\t\t<ContentFooter>\n\t\t\t<MessagePreview v-if=\"isMessagePreviewShown\"/>\n\t\t</ContentFooter>\n\t`,\n};\n","import { Text, Type } from 'main.core';\nimport { Alert, AlertColor, AlertIcon } from 'ui.alerts';\nimport { mapState } from 'ui.vue3.vuex';\nimport type { AlertState } from '../model/application-model';\n\n// @vue/component\nexport const EditorAlert = {\n\tname: 'EditorAlert',\n\talertInstance: null,\n\tdata(): Object\n\t{\n\t\treturn {\n\t\t\tisAlertRendered: false,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapState({\n\t\t\t/** @type AlertState */\n\t\t\talert: (state) => state.application.alert,\n\t\t}),\n\t\tisAlertShown(): boolean\n\t\t{\n\t\t\treturn Type.isStringFilled(this.alert?.error);\n\t\t},\n\t},\n\twatch: {\n\t\talert(newAlert: AlertState, oldAlert: AlertState): void\n\t\t{\n\t\t\tif (!Type.isStringFilled(newAlert?.error))\n\t\t\t{\n\t\t\t\tthis.alertInstance?.hide();\n\t\t\t\tthis.isAlertRendered = false;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.alertInstance)\n\t\t\t{\n\t\t\t\tthis.alertInstance = new Alert({\n\t\t\t\t\tcolor: AlertColor.DANGER,\n\t\t\t\t\ticon: AlertIcon.DANGER,\n\t\t\t\t\t// closeBtn: true,\n\t\t\t\t\tanimated: false,\n\t\t\t\t});\n\n\t\t\t\t// Event.bind(this.alertInstance.getCloseBtn(), 'click', () => {\n\t\t\t\t// \tthis.$store.dispatch('application/resetAlert');\n\t\t\t\t// });\n\t\t\t}\n\n\t\t\tif (newAlert.error !== oldAlert.error)\n\t\t\t{\n\t\t\t\tthis.alertInstance.setText(Text.encode(newAlert.error));\n\t\t\t}\n\n\t\t\tif (!this.isAlertRendered)\n\t\t\t{\n\t\t\t\tthis.alertInstance.show();\n\t\t\t\tthis.alertInstance.renderTo(this.$el);\n\t\t\t\tthis.isAlertRendered = true;\n\t\t\t}\n\t\t},\n\t},\n\tbeforeUnmount(): any\n\t{\n\t\tthis.alertInstance?.destroy();\n\t},\n\ttemplate: `\n\t\t<div class=\"crm-messagesender-editor__alert\" data-test-role=\"alert\" :style=\"{\n\t\t\tmarginTop: isAlertShown ? 'var(--ui-space-stack-xs2)' : null,\n\t\t}\"></div>\n\t`,\n};\n","import { type AjaxResponse } from 'main.core';\nimport { Dialog, type ItemOptions } from 'ui.entity-selector';\nimport { BIcon, Outline } from 'ui.icon-set.api.vue';\nimport { Text } from 'ui.system.typography.vue';\nimport { AirButtonStyle, Button } from 'ui.vue3.components.button';\nimport { mapGetters, mapState } from 'ui.vue3.vuex';\n// eslint-disable-next-line no-unused-vars\nimport { type Channel, type From } from '../editor';\n\nconst ENTITY_ID = 'crm-from';\n\n// @vue/component\nexport const EditorFooter = {\n\tname: 'EditorFooter',\n\tcomponents: {\n\t\tBButton: Button,\n\t\tBIcon,\n\t\tBText: Text,\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tAirButtonStyle,\n\t\t\tOutline,\n\t\t};\n\t},\n\tdialog: null,\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\t/** @type Channel */\n\t\t\tchannel: 'channels/current',\n\t\t\t/** @type From */\n\t\t\tfrom: 'channels/from',\n\t\t\treceiver: 'channels/receiver',\n\t\t\t/** @type boolean */\n\t\t\tisReadyToSend: 'message/isReadyToSend',\n\t\t\tisProgress: 'application/isProgress',\n\t\t}),\n\t\t...mapState({\n\t\t\t/** @type boolean */\n\t\t\tisSending: (state) => state.application.progress.isSending,\n\t\t\t/** @type Layout */\n\t\t\tlayout: (state) => state.application.layout,\n\t\t}),\n\t\tfromText(): string\n\t\t{\n\t\t\treturn this.$Bitrix.Loc.getMessage(\n\t\t\t\t'CRM_MESSAGESENDER_EDITOR_FROM',\n\t\t\t\t{\n\t\t\t\t\t'#FROM#': this.from.name || '',\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t\tisSelectable(): boolean\n\t\t{\n\t\t\treturn this.fromList.length > 1;\n\t\t},\n\t\tfromList(): From[]\n\t\t{\n\t\t\treturn this.channel?.fromList ?? [];\n\t\t},\n\t\tdialogItems(): ItemOptions[]\n\t\t{\n\t\t\treturn this.fromList.map((from: From) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: from.id,\n\t\t\t\t\tentityId: ENTITY_ID,\n\t\t\t\t\ttitle: from.name,\n\t\t\t\t\tsubtitle: from.description,\n\t\t\t\t\tselected: from.id === this.from.id,\n\t\t\t\t\ttabs: ['recents'],\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t},\n\tmethods: {\n\t\ttoggleDialog(): void\n\t\t{\n\t\t\tif (!this.isSelectable)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dialog)\n\t\t\t{\n\t\t\t\tthis.dialog.hide();\n\t\t\t\tthis.dialog = null;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\ttargetNode: this.$refs.from,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: ENTITY_ID,\n\t\t\t\t\t\tsearchable: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\titems: this.dialogItems,\n\t\t\t\twidth: 400,\n\t\t\t\theight: 300,\n\t\t\t\tenableSearch: true,\n\t\t\t\thideOnSelect: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tshowAvatars: false,\n\t\t\t\tmultiple: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\t\tthis.$store.dispatch('channels/setFrom', { fromId: event.getData().item.id });\n\t\t\t\t\t},\n\t\t\t\t\tonDestroy: () => {\n\t\t\t\t\t\tthis.dialog = null;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.dialog.show();\n\t\t},\n\t\tsend(): void\n\t\t{\n\t\t\tif (this.isProgress)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$Bitrix.Data.get('locator').getSendService().sendMessage()\n\t\t\t\t.catch((response: AjaxResponse | any) => {\n\t\t\t\t\tthis.$Bitrix.Data.get('locator').getAlertService().showError(response?.errors?.[0]?.message);\n\t\t\t\t})\n\t\t\t;\n\t\t},\n\t\tcancel(): void\n\t\t{\n\t\t\tif (this.isProgress)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.$Bitrix.Data.get('locator').getAnalyticsService().onCancel();\n\t\t\tthis.$Bitrix.Data.get('locator').getMessageModel().clearState();\n\t\t\tthis.$store.dispatch('application/resetAlert');\n\t\t\tthis.$Bitrix.eventEmitter.emit('crm:messagesender:editor:onCancel');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"crm-messagesender-editor__footer\">\n\t\t\t<div class=\"crm-messagesender-editor__footer__buttons\">\n\t\t\t\t<BButton\n\t\t\t\t\tv-if=\"layout.isSendButtonShown\"\n\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_BUTTON_SEND')\"\n\t\t\t\t\t@click=\"send\"\n\t\t\t\t\t:disabled=\"!isReadyToSend || (isProgress && !isSending)\" \n\t\t\t\t\t:loading=\"isSending\"\n\t\t\t\t/>\n\t\t\t\t<BButton\n\t\t\t\t\tv-if=\"layout.isCancelButtonShown\"\n\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_BUTTON_CANCEL')\"\n\t\t\t\t\t@click=\"cancel\"\n\t\t\t\t\t:style=\"AirButtonStyle.PLAIN\"\n\t\t\t\t\t:disabled=\"isProgress\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div v-if=\"from\" ref=\"from\" class=\"crm-messagesender-editor__footer__from\" data-test-role=\"from-selector\" @click=\"toggleDialog\" :style=\"{\n\t\t\t\tcursor: isSelectable ? 'pointer' : 'default',\n\t\t\t}\">\n\t\t\t\t<BText \n\t\t\t\t\ttag=\"div\"\n\t\t\t\t\tsize=\"xs\"\n\t\t\t\t\talign=\"right\"\n\t\t\t\t\tclassName=\"crm-messagesender-editor__footer__from__text\"\n\t\t\t\t>{{ fromText }}</BText>\n\t\t\t\t<BIcon v-if=\"isSelectable\" :name=\"Outline.CHEVRON_DOWN_S\"/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { Selector, type SelectorItem } from 'crm.messagesender.channel-selector';\nimport 'ui.icon-set.outline';\nimport { Runtime } from 'main.core';\nimport { Chip } from 'ui.system.chip.vue';\nimport { mapGetters, mapState } from 'ui.vue3.vuex';\nimport { type Channel } from '../../editor';\nimport 'ui.icon-set.social';\nimport { type PreferencesService } from '../../service/preferences-service';\n\n// @vue/component\nexport const ChannelSelector = {\n\tname: 'ChannelSelector',\n\tcomponents: {\n\t\tChip,\n\t},\n\tselector: null,\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\t/** @type Channel */\n\t\t\tcurrentChannel: 'channels/current',\n\t\t\titemsSort: 'preferences/channelsSortOrDefault',\n\t\t}),\n\t\t...mapState({\n\t\t\t/** @type Channel[] */\n\t\t\tallChannels: (state) => state.channels.collection,\n\t\t\tpromoBanners: (state) => state.application.promoBanners,\n\t\t}),\n\t\tselectorItems(): SelectorItem[]\n\t\t{\n\t\t\treturn this.allChannels.map((channel: Channel) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: channel.id,\n\t\t\t\t\tappearance: channel.appearance,\n\t\t\t\t\tonclick: (item: SelectorItem) => {\n\t\t\t\t\t\tthis.$store.dispatch('channels/setChannel', { channelId: item.id });\n\n\t\t\t\t\t\tthis.$Bitrix.Data.get('locator').getAnalyticsService().onSelectChannel();\n\n\t\t\t\t\t\tthis.selector?.close();\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t},\n\twatch: {\n\t\tallChannels(): void\n\t\t{\n\t\t\tthis.destroySelector();\n\t\t},\n\t\tpromoBanners(): void\n\t\t{\n\t\t\tthis.destroySelector();\n\t\t},\n\t},\n\tbeforeUnmount()\n\t{\n\t\tthis.destroySelector();\n\t},\n\tmethods: {\n\t\ttoggleSelector(): void\n\t\t{\n\t\t\tif (this.selector?.isShown())\n\t\t\t{\n\t\t\t\tthis.selector.close();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.selector ??= new Selector({\n\t\t\t\tbindElement: this.$el,\n\t\t\t\titems: Runtime.clone(this.selectorItems),\n\t\t\t\tbanners: Runtime.clone(this.promoBanners),\n\t\t\t\titemsSort: Runtime.clone(this.itemsSort),\n\t\t\t\tanalytics: Runtime.clone(this.$store.state.analytics.analytics),\n\t\t\t\tevents: {\n\t\t\t\t\tonSave: (event) => {\n\t\t\t\t\t\tconst { itemsSort } = event.getData();\n\n\t\t\t\t\t\tif (this.isSortChanged(itemsSort))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$Bitrix.Data.get('locator').getAnalyticsService().onSaveChannelsSort();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.getPreferencesService().saveChannelsSort(itemsSort);\n\t\t\t\t\t},\n\t\t\t\t\tonConnectionsSliderClose: () => {\n\t\t\t\t\t\tthis.$Bitrix.Data.get('locator').getAnalyticsService().onAddChannelClick();\n\n\t\t\t\t\t\tthis.$Bitrix.eventEmitter.emit('crm:messagesender:editor:onConnectionsSliderClose');\n\t\t\t\t\t},\n\t\t\t\t\tonPromoBannerSliderClose: (event: BaseEvent) => {\n\t\t\t\t\t\tconst { bannerId, connectStatus } = event.getData();\n\t\t\t\t\t\tthis.$Bitrix.Data.get('locator').getAnalyticsService().onBannerConnectClick(bannerId, connectStatus);\n\n\t\t\t\t\t\tthis.$Bitrix.eventEmitter.emit('crm:messagesender:editor:onPromoBannerSliderClose');\n\t\t\t\t\t},\n\t\t\t\t\tonDestroy: () => {\n\t\t\t\t\t\tthis.selector = null;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.selector.show();\n\t\t},\n\t\tisSortChanged(newSort: string[]): boolean\n\t\t{\n\t\t\tif (newSort.length !== this.itemsSort.length)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn !this.itemsSort.every((channelId, index) => channelId === newSort[index]);\n\t\t},\n\t\tdestroySelector(): void\n\t\t{\n\t\t\tthis.selector?.destroy();\n\t\t\tthis.selector = null;\n\t\t},\n\t\tgetPreferencesService(): PreferencesService\n\t\t{\n\t\t\treturn this.$Bitrix.Data.get('locator').getPreferencesService();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip\n\t\t\t:icon=\"currentChannel.appearance.icon.title\"\n\t\t\t:iconColor=\"currentChannel.appearance.icon.color\"\n\t\t\t:iconBackground=\"currentChannel.appearance.icon.background\"\n\t\t\t:dropdown=\"true\"\n\t\t\t:text=\"currentChannel.appearance.title\"\n\t\t\t:trimmable=\"true\"\n\t\t\tdata-test-role=\"channel-selector\"\n\t\t\t@click=\"toggleSelector\"\n\t\t/>\n\t`,\n};\n","import type { Receiver } from 'crm.messagesender';\nimport { Type } from 'main.core';\nimport { Dialog, type ItemOptions } from 'ui.entity-selector';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport { Chip, ChipDesign } from 'ui.system.chip.vue';\nimport { mapGetters } from 'ui.vue3.vuex';\n\nconst ENTITY_ID = 'crm-receiver';\n\n// @vue/component\nexport const ReceiverSelector = {\n\tname: 'ReceiverSelector',\n\tcomponents: {\n\t\tChip,\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t\tChipDesign,\n\t\t};\n\t},\n\tdialog: null,\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\t/** @type Channel */\n\t\t\tchannel: 'channels/current',\n\t\t\t/** @type ?Receiver */\n\t\t\treceiver: 'channels/receiver',\n\t\t}),\n\t\thasReceivers(): boolean\n\t\t{\n\t\t\treturn Type.isArrayFilled(this.channel?.toList);\n\t\t},\n\t\tchipText(): string\n\t\t{\n\t\t\tif (!this.hasReceivers)\n\t\t\t{\n\t\t\t\treturn this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_NO_RECEIVER');\n\t\t\t}\n\n\t\t\treturn `${this.receiver.addressSourceData.title} ${this.receiver.address.valueFormatted}`;\n\t\t},\n\t\tdialogItems(): ItemOptions[]\n\t\t{\n\t\t\treturn this.channel.toList.map((receiver: Receiver) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: receiver.address.id,\n\t\t\t\t\tentityId: ENTITY_ID,\n\t\t\t\t\ttitle: receiver.addressSourceData.title,\n\t\t\t\t\tsubtitle: this.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_RECEIVER_SUBTITLE_TEMPLATE', {\n\t\t\t\t\t\t'#ADDRESS#': receiver.address.valueFormatted,\n\t\t\t\t\t\t'#TYPE#': receiver.address.valueTypeCaption,\n\t\t\t\t\t}),\n\t\t\t\t\tavatar: `/bitrix/js/crm/messagesender/editor/images/${receiver.addressSource.entityTypeName.toLowerCase()}.svg`,\n\t\t\t\t\tselected: this.receiver?.address.id === receiver.address.id,\n\t\t\t\t\ttabs: ['recents'],\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t},\n\tmethods: {\n\t\ttoggleDialog(): void\n\t\t{\n\t\t\tif (!this.hasReceivers)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.dialog)\n\t\t\t{\n\t\t\t\tthis.dialog.hide();\n\t\t\t\tthis.dialog = null;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\ttargetNode: this.$el,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: ENTITY_ID,\n\t\t\t\t\t\tsearchable: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\titems: this.dialogItems,\n\t\t\t\twidth: 400,\n\t\t\t\theight: 300,\n\t\t\t\tenableSearch: true,\n\t\t\t\thideOnSelect: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tmultiple: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\t\tthis.$store.dispatch('channels/setReceiver', { receiverAddressId: event.getData().item.id });\n\t\t\t\t\t},\n\t\t\t\t\tonDestroy: () => {\n\t\t\t\t\t\tthis.dialog = null;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.dialog.show();\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip \n\t\t\t:icon=\"Outline.PERSON\" \n\t\t\ticonColor=\"var(--ui-color-accent-main-primary-alt)\"\n\t\t\ticonBackground=\"var(--ui-color-accent-soft-blue-3)\"\n\t\t\t:design=\"hasReceivers ? ChipDesign.Outline : ChipDesign.ShadowDisabled\"\n\t\t\t:dropdown=\"true\"\n\t\t\t:trimmable=\"true\"\n\t\t\t:text=\"chipText\"\n\t\t\tdata-test-role=\"receiver-selector\"\n\t\t\t@click=\"toggleDialog\"\n\t\t/>\n\t`,\n};\n","import { Runtime, Tag } from 'main.core';\nimport { Dialog, type ItemOptions } from 'ui.entity-selector';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport { Chip } from 'ui.system.chip.vue';\nimport { mapGetters } from 'ui.vue3.vuex';\nimport type { Template } from '../../model/templates-model';\n\nconst ENTITY_ID = 'crm-hsm';\n\n// @vue/component\nexport const TemplateSelector = {\n\tname: 'TemplateSelector',\n\tcomponents: {\n\t\tChip,\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tOutline,\n\t\t};\n\t},\n\tdialog: null,\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\t/** @type Template[] */\n\t\t\ttemplates: 'templates/listForChannel',\n\t\t\t/** @type ?Template */\n\t\t\tcurrent: 'templates/current',\n\t\t}),\n\t\tdialogItems(): ItemOptions[]\n\t\t{\n\t\t\treturn this.templates.map((template: Template) => {\n\t\t\t\treturn {\n\t\t\t\t\tid: template.ORIGINAL_ID,\n\t\t\t\t\tentityId: ENTITY_ID,\n\t\t\t\t\ttitle: template.TITLE,\n\t\t\t\t\tsubtitle: template.PREVIEW,\n\t\t\t\t\tavatar: '/bitrix/js/crm/messagesender/editor/images/template.svg',\n\t\t\t\t\tavatarOptions: {\n\t\t\t\t\t\tbgColor: 'var(--ui-color-accent-soft-blue-3)',\n\t\t\t\t\t},\n\t\t\t\t\tselected: this.current?.ORIGINAL_ID === template.ORIGINAL_ID,\n\t\t\t\t\ttabs: ['recents'],\n\t\t\t\t};\n\t\t\t});\n\t\t},\n\t\tdialogFooter(): Array<HTMLElement>\n\t\t{\n\t\t\treturn [\n\t\t\t\tTag.render`<span style=\"width: 100%;\"></span>`,\n\t\t\t\tTag.render`\n\t\t\t\t\t<span onclick=\"${this.showFeedbackForm}\" class=\"ui-selector-footer-link\">${\n\t\t\t\t\t\tthis.$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_SUGGEST_TEMPLATE')\n\t\t\t\t\t}</span>\n\t\t\t\t`,\n\t\t\t];\n\t\t},\n\t},\n\tmethods: {\n\t\ttoggleDialog(): void\n\t\t{\n\t\t\tif (this.dialog)\n\t\t\t{\n\t\t\t\tthis.dialog.hide();\n\t\t\t\tthis.dialog = null;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dialog = new Dialog({\n\t\t\t\ttargetNode: this.$el,\n\t\t\t\tentities: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: ENTITY_ID,\n\t\t\t\t\t\tsearchable: true,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\titems: this.dialogItems,\n\t\t\t\twidth: 400,\n\t\t\t\theight: 350,\n\t\t\t\tenableSearch: true,\n\t\t\t\thideOnSelect: true,\n\t\t\t\tautoHide: true,\n\t\t\t\tdropdownMode: true,\n\t\t\t\tmultiple: false,\n\t\t\t\tcacheable: false,\n\t\t\t\tfooter: this.dialogFooter,\n\t\t\t\tevents: {\n\t\t\t\t\t'Item:onSelect': (event) => {\n\t\t\t\t\t\tthis.$store.dispatch('templates/setTemplate', { templateOriginalId: event.getData().item.id });\n\n\t\t\t\t\t\tthis.$Bitrix.Data.get('locator').getAnalyticsService().onSelectTemplate();\n\t\t\t\t\t},\n\t\t\t\t\tonDestroy: () => {\n\t\t\t\t\t\tthis.dialog = null;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tthis.dialog.show();\n\t\t},\n\t\tasync showFeedbackForm(): Promise<void>\n\t\t{\n\t\t\tthis.$Bitrix.Data.get('locator').getAnalyticsService().onSuggestTemplate();\n\n\t\t\tconst { Form } = await Runtime.loadExtension('ui.feedback.form');\n\n\t\t\t/** @see BX.UI.Feedback.Form.open */\n\t\t\tForm.open({\n\t\t\t\tid: 'b24_crm_timeline_whatsapp_template_suggest_form',\n\t\t\t\tforms: [{\n\t\t\t\t\tzones: ['ru', 'by', 'kz'],\n\t\t\t\t\tid: 758,\n\t\t\t\t\tlang: 'ru',\n\t\t\t\t\tsec: 'jyafqa',\n\t\t\t\t}, {\n\t\t\t\t\tzones: ['en'],\n\t\t\t\t\tid: 760,\n\t\t\t\t\tlang: 'en',\n\t\t\t\t\tsec: 'culzcq',\n\t\t\t\t}, {\n\t\t\t\t\tzones: ['de'],\n\t\t\t\t\tid: 764,\n\t\t\t\t\tlang: 'de',\n\t\t\t\t\tsec: '9h74xf',\n\t\t\t\t}, {\n\t\t\t\t\tzones: ['com.br'],\n\t\t\t\t\tid: 766,\n\t\t\t\t\tlang: 'com.br',\n\t\t\t\t\tsec: 'ddkhcc',\n\t\t\t\t}, {\n\t\t\t\t\tzones: ['es'],\n\t\t\t\t\tid: 762,\n\t\t\t\t\tlang: 'es',\n\t\t\t\t\tsec: '6ni833',\n\t\t\t\t}, {\n\t\t\t\t\tzones: ['en'],\n\t\t\t\t\tid: 760,\n\t\t\t\t\tlang: 'en',\n\t\t\t\t\tsec: 'culzcq',\n\t\t\t\t}],\n\t\t\t});\n\t\t},\n\t},\n\ttemplate: `\n\t\t<Chip \n\t\t\t:icon=\"Outline.TEXT_FORMAT_BOTTOM\"\n\t\t\t:dropdown=\"true\"\n\t\t\t:text=\"$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_TEMPLATES')\"\n\t\t\tdata-test-role=\"template-selector\"\n\t\t\t@click=\"toggleDialog\"\n\t\t/>\n\t`,\n};\n","import { Runtime, Type } from 'main.core';\nimport { Outline } from 'ui.icon-set.api.vue';\nimport { AirButtonStyle, Button as BButton } from 'ui.vue3.components.button';\nimport { mapGetters } from 'ui.vue3.vuex';\nimport { ChannelSelector } from './editor-header/channel-selector';\nimport { ReceiverSelector } from './editor-header/receiver-selector';\nimport { TemplateSelector } from './editor-header/template-selector';\n\n// @vue/component\nexport const EditorHeader = {\n\tname: 'EditorHeader',\n\tcomponents: {\n\t\tBButton,\n\t\tChannelSelector,\n\t\tReceiverSelector,\n\t\tTemplateSelector,\n\t},\n\tsetup(): Object\n\t{\n\t\treturn {\n\t\t\tAirButtonStyle,\n\t\t\tOutline,\n\t\t};\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\t/** @type Channel */\n\t\t\tcurrentChannel: 'channels/current',\n\t\t}),\n\t\thasChannels(): boolean\n\t\t{\n\t\t\treturn !Type.isNil(this.currentChannel);\n\t\t},\n\t\tisTemplatesSelectorShown(): boolean\n\t\t{\n\t\t\t// todo templates for custom text\n\t\t\treturn Boolean(this.currentChannel?.isTemplatesBased);\n\t\t},\n\t},\n\tmethods: {\n\t\tasync openConnectionsSlider(): Promise<void>\n\t\t{\n\t\t\tconst { Router } = await Runtime.loadExtension('crm.router');\n\n\t\t\t/** @see BX.Crm.Router.openMessageSenderConnectionsSlider */\n\t\t\tawait Router.Instance.openMessageSenderConnectionsSlider(this.$store.state.analytics.analytics);\n\n\t\t\tthis.$Bitrix.Data.get('locator').getAnalyticsService().onNoChannelsButtonClick();\n\n\t\t\tthis.$Bitrix.eventEmitter.emit('crm:messagesender:editor:onConnectionsSliderClose');\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"crm-messagesender-editor__header\">\n\t\t\t<div class=\"crm-messagesender-editor__header-left\" data-role=\"header-left\">\n\t\t\t\t<ChannelSelector v-if=\"hasChannels\"/>\n\t\t\t\t<BButton\n\t\t\t\t\tv-else\n\t\t\t\t\t:style=\"AirButtonStyle.FILLED\"\n\t\t\t\t\t:leftIcon=\"Outline.MESSAGES\"\n\t\t\t\t\t:shimmer=\"true\"\n\t\t\t\t\t:text=\"$Bitrix.Loc.getMessage('CRM_MESSAGESENDER_EDITOR_BUTTON_NO_CHANNELS')\"\n\t\t\t\t\t@click=\"openConnectionsSlider\"\n\t\t\t\t/>\n\t\t\t\t<ReceiverSelector v-if=\"hasChannels\"/>\n\t\t\t</div>\n\t\t\t<div class=\"crm-messagesender-editor__header-right\">\n\t\t\t\t<TemplateSelector v-if=\"isTemplatesSelectorShown\"/>\n\t\t\t</div>\n\t\t</div>\n\t`,\n};\n","import { mapGetters, mapState } from 'ui.vue3.vuex';\nimport { type Layout } from '../editor';\nimport { CustomMessageContent } from './content/custom-message-content';\nimport { ContentContainer } from './content/layout/content-container';\nimport { NotificationMessageContent } from './content/notification-message-content';\nimport { TemplateMessageContent } from './content/template-message-content';\nimport { EditorAlert } from './editor-alert';\nimport { EditorFooter } from './editor-footer';\nimport { EditorHeader } from './editor-header';\n\n// @vue/component\nexport const MessageEditor = {\n\tname: 'MessageEditor',\n\tcomponents: {\n\t\tEditorHeader,\n\t\tContentContainer,\n\t\tCustomMessageContent,\n\t\tTemplateMessageContent,\n\t\tNotificationMessageContent,\n\t\tEditorFooter,\n\t\tEditorAlert,\n\t},\n\tcomputed: {\n\t\t...mapGetters({\n\t\t\t/** @type Channel */\n\t\t\tcurrentChannel: 'channels/current',\n\t\t}),\n\t\t...mapState({\n\t\t\t/** @type Layout */\n\t\t\tlayout: (state) => state.application.layout,\n\t\t}),\n\t\tcontentComponent(): string\n\t\t{\n\t\t\tif (this.currentChannel?.backend.senderCode === 'bitrix24')\n\t\t\t{\n\t\t\t\treturn 'NotificationMessageContent';\n\t\t\t}\n\n\t\t\tif (this.currentChannel?.isTemplatesBased)\n\t\t\t{\n\t\t\t\treturn 'TemplateMessageContent';\n\t\t\t}\n\n\t\t\treturn 'CustomMessageContent';\n\t\t},\n\t\tpaddingStyle(): Object\n\t\t{\n\t\t\treturn {\n\t\t\t\tpaddingTop: this.layout.paddingTop ?? this.layout.padding,\n\t\t\t\tpaddingBottom: this.layout.paddingBottom ?? this.layout.padding,\n\t\t\t\tpaddingLeft: this.layout.paddingLeft ?? this.layout.padding,\n\t\t\t\tpaddingRight: this.layout.paddingRight ?? this.layout.padding,\n\t\t\t};\n\t\t},\n\t},\n\ttemplate: `\n\t\t<div class=\"crm-messagesender-editor\" data-test-role=\"crm-messagesender-editor\" :style=\"paddingStyle\">\n\t\t\t<EditorHeader v-if=\"layout.isHeaderShown\"/>\n\t\t\t<ContentContainer>\n\t\t\t\t<component :is=\"contentComponent\"/>\n\t\t\t</ContentContainer>\n\t\t\t<EditorFooter v-if=\"layout.isFooterShown\"/>\n\t\t\t<EditorAlert/>\n\t\t</div>\n\t`,\n};\n","import { BuilderModel } from 'ui.vue3.vuex';\nimport { type Logger } from '../service/logger';\n\ntype AnalyticsState = {\n\tanalytics: {\n\t\tc_section: ?string,\n\t\tc_sub_section: ?string,\n\t},\n};\n\nexport class AnalyticsModel extends BuilderModel\n{\n\t#logger: Logger;\n\n\tgetName(): string\n\t{\n\t\treturn 'analytics';\n\t}\n\n\tsetLogger(logger: Logger): this\n\t{\n\t\tthis.#logger = logger;\n\n\t\treturn this;\n\t}\n\n\tgetState(): AnalyticsState\n\t{\n\t\treturn {\n\t\t\tanalytics: {\n\t\t\t\tc_section: this.getVariable('analytics.c_section', null),\n\t\t\t\tc_sub_section: this.getVariable('analytics.c_sub_section', null),\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Runtime, Type } from 'main.core';\n\nexport function makeFrozenClone(source: any): any\n{\n\treturn deepFreeze(Runtime.clone(source));\n}\n\nexport function deepFreeze(target: {[key: string]: any})\n{\n\tif (Type.isObject(target))\n\t{\n\t\tObject.values(target).forEach((value) => {\n\t\t\tdeepFreeze(value);\n\t\t});\n\n\t\treturn Object.freeze(target);\n\t}\n\n\treturn target;\n}\n","import { Type } from 'main.core';\nimport type { ActionTree, GetterTree, MutationTree } from 'ui.vue3.vuex';\nimport { BuilderModel } from 'ui.vue3.vuex';\nimport { type ContentProvider, type Layout, type NotificationTemplate, type PromoBanner, type Scene } from '../editor';\nimport { type Logger } from '../service/logger';\nimport { makeFrozenClone } from './helpers';\n\ntype ApplicationState = {\n\tcontext: Readonly<{\n\t\tentityTypeId: ?number,\n\t\tentityId: ?number,\n\t\tcategoryId: ?number,\n\t\tuserId: ?number,\n\t}>,\n\tcontentProviders: Readonly<{[key: string]: ContentProvider}>,\n\tnotificationTemplate?: Readonly<NotificationTemplate>,\n\tpromoBanners?: Readonly<Array<PromoBanner>>,\n\tlayout: Readonly<Layout>,\n\tscene: Readonly<Scene>,\n\tprogress: ProgressState,\n\talert: AlertState,\n};\n\nexport type ProgressState = {\n\tisSending: boolean,\n\tisLoading: boolean,\n};\n\nexport type AlertState = {\n\terror: string,\n};\n\nexport class ApplicationModel extends BuilderModel\n{\n\t#logger: Logger;\n\n\tgetName(): string\n\t{\n\t\treturn 'application';\n\t}\n\n\tsetLogger(logger: Logger): this\n\t{\n\t\tthis.#logger = logger;\n\n\t\treturn this;\n\t}\n\n\tgetState(): ApplicationState\n\t{\n\t\treturn {\n\t\t\tcontext: makeFrozenClone(this.getVariable('context', {})),\n\t\t\tcontentProviders: makeFrozenClone(this.getVariable('contentProviders', {})),\n\t\t\tnotificationTemplate: makeFrozenClone(this.getVariable('notificationTemplate', null)),\n\t\t\tpromoBanners: makeFrozenClone(this.getVariable('promoBanners', null)),\n\t\t\tlayout: makeFrozenClone(this.getVariable('layout', {\n\t\t\t\tisHeaderShown: true,\n\t\t\t\tisFooterShown: true,\n\t\t\t\tisSendButtonShown: true,\n\t\t\t\tisCancelButtonShown: true,\n\t\t\t\tisMessagePreviewShown: true,\n\t\t\t\tisContentProvidersShown: true,\n\t\t\t\tisEmojiButtonShown: true,\n\t\t\t\tisMessageTextReadOnly: false,\n\t\t\t\tpadding: 'var(--ui-space-inset-lg)',\n\t\t\t})),\n\t\t\tscene: makeFrozenClone(this.getVariable('scene', { id: '' })),\n\t\t\tprogress: {\n\t\t\t\tisSending: false,\n\t\t\t\tisLoading: false,\n\t\t\t},\n\t\t\talert: {\n\t\t\t\terror: '',\n\t\t\t},\n\t\t};\n\t}\n\n\tgetGetters(): GetterTree<ApplicationState>\n\t{\n\t\treturn {\n\t\t\t/** @function application/isProgress */\n\t\t\tisProgress: (state): boolean => {\n\t\t\t\tfor (const value of Object.values(state.progress))\n\t\t\t\t{\n\t\t\t\t\tif (value)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t},\n\t\t};\n\t}\n\n\tgetActions(): ActionTree<ApplicationState>\n\t{\n\t\treturn {\n\t\t\t/** @function application/actualizeState */\n\t\t\tactualizeState: (store, payload: ApplicationState) => {\n\t\t\t\tstore.commit('actualizeState', makeFrozenClone(payload));\n\t\t\t},\n\t\t\t/** @function application/setProgress */\n\t\t\tsetProgress: (store, payload: ProgressState) => {\n\t\t\t\tconst allowedKeys = new Set(['isSending', 'isLoading']);\n\n\t\t\t\tconst filteredPayload = {};\n\t\t\t\tfor (const key of Object.keys(payload))\n\t\t\t\t{\n\t\t\t\t\tif (allowedKeys.has(key))\n\t\t\t\t\t{\n\t\t\t\t\t\tfilteredPayload[key] = payload[key];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfor (const [key, value] of Object.entries(filteredPayload))\n\t\t\t\t{\n\t\t\t\t\tif (!Type.isBoolean(value))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#logger.warn(`setProgress: ${key} should be boolean`, { payload });\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tstore.commit('updateProgress', {\n\t\t\t\t\tprogress: filteredPayload,\n\t\t\t\t});\n\t\t\t},\n\t\t\t/** @function application/setAlert */\n\t\t\tsetAlert: (store, payload: { error: string }) => {\n\t\t\t\tif (!Type.isString(payload.error))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setError: error should be string', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('actualizeState', { alert: { error: payload.error } });\n\t\t\t},\n\t\t\tresetAlert: (store) => {\n\t\t\t\tstore.commit('actualizeState', {\n\t\t\t\t\talert: {\n\t\t\t\t\t\terror: '',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\t}\n\n\t/* eslint-disable no-param-reassign */\n\tgetMutations(): MutationTree<ApplicationState>\n\t{\n\t\treturn {\n\t\t\tactualizeState: (state, payload) => {\n\t\t\t\tfor (const [key, value] of Object.entries(payload))\n\t\t\t\t{\n\t\t\t\t\tif (key in state)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate[key] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdateProgress: (state, payload: {progress: ProgressState}) => {\n\t\t\t\tstate.progress = { ...state.progress, ...payload.progress };\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Type } from 'main.core';\nimport type { ActionTree, GetterTree, MutationTree } from 'ui.vue3.vuex';\nimport { BuilderModel } from 'ui.vue3.vuex';\n\nimport type { Channel, From } from '../editor';\nimport { type Logger } from '../service/logger';\nimport { deepFreeze } from './helpers';\n\ntype ChannelsState = {\n\tcollection: Readonly<Channel[]>,\n\tselected: {\n\t\tchannelId: ?string,\n\t\tfromId: ?string,\n\t\treceiverAddressId: ?number,\n\t},\n};\n\nexport class ChannelsModel extends BuilderModel\n{\n\t#logger: Logger;\n\n\tgetName(): string\n\t{\n\t\treturn 'channels';\n\t}\n\n\tsetLogger(logger: Logger): this\n\t{\n\t\tthis.#logger = logger;\n\n\t\treturn this;\n\t}\n\n\tgetState(): ChannelsState\n\t{\n\t\tconst collection: Channel[] = this.getVariable('collection', []);\n\t\tdeepFreeze(collection);\n\n\t\treturn {\n\t\t\tcollection,\n\t\t\tselected: {\n\t\t\t\tchannelId: this.getVariable('selected.channelId'),\n\t\t\t\tfromId: this.getVariable('selected.fromId', collection[0]?.fromList[0]?.id),\n\t\t\t\treceiverAddressId: this.getVariable('selected.receiverAddressId', collection[0]?.toList[0]?.address.id),\n\t\t\t},\n\t\t};\n\t}\n\n\tgetGetters(): GetterTree<ChannelsState>\n\t{\n\t\treturn {\n\t\t\t/** @function channels/canSendMessage */\n\t\t\tcanSendMessage: (state): boolean => {\n\t\t\t\treturn state.collection.some((chan: Channel) => chan.isConnected);\n\t\t\t},\n\t\t\t/** @function channels/current */\n\t\t\tcurrent: (state, getters, rootState, rootGetters): ?Channel => {\n\t\t\t\tconst selected = state.collection.find((channel) => channel.id === state.selected.channelId);\n\t\t\t\tif (selected)\n\t\t\t\t{\n\t\t\t\t\treturn selected;\n\t\t\t\t}\n\n\t\t\t\tconst firstId = rootGetters['preferences/firstVisibleChannelId'];\n\n\t\t\t\treturn state.collection.find((chan) => chan.id === firstId) || state.collection[0];\n\t\t\t},\n\t\t\t/** @function channels/from */\n\t\t\tfrom: (state, getters): ?From => {\n\t\t\t\tconst channel: Channel = getters.current;\n\t\t\t\tif (!channel)\n\t\t\t\t{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn channel.fromList.find((from) => from.id === state.selected.fromId) || channel.fromList[0];\n\t\t\t},\n\t\t\t/** @function channels/receiver */\n\t\t\treceiver: (state, getters): ?Receiver => {\n\t\t\t\tconst channel: Channel = getters.current;\n\t\t\t\tif (!channel)\n\t\t\t\t{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tconst selected = channel.toList.find((receiver) => receiver.address.id === state.selected.receiverAddressId);\n\t\t\t\tif (selected)\n\t\t\t\t{\n\t\t\t\t\treturn selected;\n\t\t\t\t}\n\n\t\t\t\treturn channel.toList[0];\n\t\t\t},\n\t\t};\n\t}\n\n\tgetActions(): ActionTree<ChannelsState>\n\t{\n\t\treturn {\n\t\t\t/** @function channels/actualizeState */\n\t\t\tactualizeState: (store, payload: ChannelsState) => {\n\t\t\t\tstore.commit('actualizeState', deepFreeze(payload));\n\t\t\t},\n\t\t\t/** @function channels/setChannel */\n\t\t\tsetChannel: (store, payload: {channelId: string}) => {\n\t\t\t\tconst { channelId } = payload;\n\t\t\t\tif (!Type.isStringFilled(channelId))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setChannel: channelId should be a string', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst channel: ?Channel = store.state.collection.find((ch) => ch.id === channelId);\n\t\t\t\tif (!channel)\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setChannel: channel not found', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('updateSelected', {\n\t\t\t\t\tselected: {\n\t\t\t\t\t\tchannelId,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t/** @function channels/setFrom */\n\t\t\tsetFrom: (store, payload: {fromId: number}) => {\n\t\t\t\tconst { fromId } = payload;\n\t\t\t\tif (!Type.isStringFilled(fromId))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setFrom: fromId should be a string', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst currentChannel: Channel = store.getters.current;\n\t\t\t\tconst from: ?From = currentChannel.fromList.find((fc) => fc.id === fromId);\n\t\t\t\tif (!from)\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setFrom: from not found', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('updateSelected', {\n\t\t\t\t\tselected: {\n\t\t\t\t\t\tfromId,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t\t/** @function channels/setReceiver */\n\t\t\tsetReceiver: (store, payload: {receiverAddressId: number}) => {\n\t\t\t\tconst { receiverAddressId } = payload;\n\t\t\t\tif (!Type.isInteger(receiverAddressId))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setReceiver: receiverAddressId should be an integer', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst currentChannel: Channel = store.getters.current;\n\t\t\t\tconst receiver: ?Receiver = currentChannel.toList.find((rc) => rc.address.id === receiverAddressId);\n\t\t\t\tif (!receiver)\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setReceiver: receiver not found', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('updateSelected', {\n\t\t\t\t\tselected: {\n\t\t\t\t\t\treceiverAddressId,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\t}\n\n\t/* eslint-disable no-param-reassign */\n\tgetMutations(): MutationTree<ChannelsState>\n\t{\n\t\treturn {\n\t\t\tactualizeState: (state, payload) => {\n\t\t\t\tfor (const [key, value] of Object.entries(payload))\n\t\t\t\t{\n\t\t\t\t\tif (key in state)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate[key] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdateSelected: (state, payload) => {\n\t\t\t\tstate.selected = { ...state.selected, ...payload.selected };\n\t\t\t},\n\t\t};\n\t}\n}\n","import { getPlainText } from 'crm.template.editor';\nimport { Type } from 'main.core';\nimport type { ActionTree, GetterTree, MutationTree } from 'ui.vue3.vuex';\nimport { BuilderModel } from 'ui.vue3.vuex';\n\nimport type { Channel, NotificationTemplate } from '../editor';\nimport { type Logger } from '../service/logger';\nimport type { Template } from './templates-model';\n\ntype MessageState = {\n\ttext: string,\n\t// something like 'message scenario'. set when content providers are used and influences flow on backend\n\tsource: ?string,\n\tpaymentId: ?number,\n\tshipmentId: ?number,\n\tcompilationProductIds: ?Array<number>,\n};\n\nexport class MessageModel extends BuilderModel\n{\n\t#logger: Logger;\n\n\tgetName(): string\n\t{\n\t\treturn 'message';\n\t}\n\n\tsetLogger(logger: Logger): this\n\t{\n\t\tthis.#logger = logger;\n\n\t\treturn this;\n\t}\n\n\tgetState(): MessageState\n\t{\n\t\treturn {\n\t\t\ttext: String(this.getVariable('text', '') ?? ''),\n\t\t\tsource: null,\n\t\t\tpaymentId: null,\n\t\t\tshipmentId: null,\n\t\t\tcompilationProductIds: null,\n\t\t};\n\t}\n\n\tgetGetters(): GetterTree<MessageState>\n\t{\n\t\treturn {\n\t\t\t/** @function message/body */\n\t\t\tbody: (state, getters, rootState, rootGetters): string => {\n\t\t\t\tconst channel: Channel = rootGetters['channels/current'];\n\n\t\t\t\tif (channel?.backend.senderCode === 'bitrix24')\n\t\t\t\t{\n\t\t\t\t\tconst notificationTemplate = rootState.application.notificationTemplate;\n\t\t\t\t\tif (Type.isNil(notificationTemplate))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.#compileNotificationBody(notificationTemplate);\n\t\t\t\t}\n\n\t\t\t\tif (!channel?.isTemplatesBased)\n\t\t\t\t{\n\t\t\t\t\treturn state.text.trim();\n\t\t\t\t}\n\n\t\t\t\tconst template: ?Template = rootGetters['templates/current'];\n\t\t\t\tif (Type.isNil(template))\n\t\t\t\t{\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\treturn this.#compileTemplateBody(template);\n\t\t\t},\n\t\t\t/** @function message/isReadyToSend */\n\t\t\tisReadyToSend: (state, getters, rootState, rootGetters): boolean => {\n\t\t\t\tif (\n\t\t\t\t\tType.isNil(rootGetters['channels/current'])\n\t\t\t\t\t|| Type.isNil(rootGetters['channels/from'])\n\t\t\t\t\t|| Type.isNil(rootGetters['channels/receiver'])\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst channel: Channel = rootGetters['channels/current'];\n\t\t\t\tif (channel.backend.senderCode === 'bitrix24')\n\t\t\t\t{\n\t\t\t\t\treturn Type.isStringFilled(rootState.application.notificationTemplate?.code);\n\t\t\t\t}\n\n\t\t\t\treturn Type.isStringFilled(getters.body);\n\t\t\t},\n\t\t};\n\t}\n\n\t#compileNotificationBody(notificationTemplate: NotificationTemplate): string\n\t{\n\t\tlet text = notificationTemplate.translation?.TEXT || '';\n\t\tfor (const placeholder of notificationTemplate.placeholders || [])\n\t\t{\n\t\t\tif (!Type.isNil(placeholder.value))\n\t\t\t{\n\t\t\t\ttext = text.replace(`#${placeholder.name}#`, placeholder.value);\n\t\t\t}\n\t\t\telse if (!Type.isNil(placeholder.caption))\n\t\t\t{\n\t\t\t\ttext = text.replace(`#${placeholder.name}#`, placeholder.caption);\n\t\t\t}\n\t\t}\n\n\t\treturn text;\n\t}\n\n\t#compileTemplateBody(template: Template): string\n\t{\n\t\t// todo position\n\t\t// todo tight coupling with template editor\n\t\treturn getPlainText(\n\t\t\ttemplate.PREVIEW,\n\t\t\ttemplate.PLACEHOLDERS?.PREVIEW ?? [],\n\t\t\ttemplate.FILLED_PLACEHOLDERS ?? [],\n\t\t);\n\t}\n\n\tgetActions(): ActionTree<MessageState>\n\t{\n\t\treturn {\n\t\t\t/** @function message/setText */\n\t\t\tsetText: (store, payload: {text: string}) => {\n\t\t\t\tconst { text } = payload;\n\t\t\t\tif (!Type.isString(text))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setText: text should be a string', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('setText', {\n\t\t\t\t\ttext,\n\t\t\t\t});\n\t\t\t},\n\t\t\t/** @function message/setSource */\n\t\t\tsetSource: (store, payload: {source: string}) => {\n\t\t\t\tconst { source } = payload;\n\t\t\t\tif (!Type.isStringFilled(source))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setSource: source should be a string', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('setSource', {\n\t\t\t\t\tsource,\n\t\t\t\t});\n\t\t\t},\n\t\t\t/** @function message/setPaymentId */\n\t\t\tsetPaymentId: (store, payload: {paymentId: number}) => {\n\t\t\t\tconst { paymentId } = payload;\n\t\t\t\tif (!Type.isInteger(paymentId))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setPaymentId: paymentId should be an int', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('setPaymentId', {\n\t\t\t\t\tpaymentId,\n\t\t\t\t});\n\t\t\t},\n\t\t\t/** @function message/setShipmentId */\n\t\t\tsetShipmentId: (store, payload: {shipmentId: number}) => {\n\t\t\t\tconst { shipmentId } = payload;\n\t\t\t\tif (!Type.isInteger(shipmentId))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setShipmentId: shipmentId should be an int', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('setShipmentId', {\n\t\t\t\t\tshipmentId,\n\t\t\t\t});\n\t\t\t},\n\t\t\t/** @function message/setCompilationProductIds */\n\t\t\tsetCompilationProductIds: (store, payload: {compilationProductIds: Array<number>}) => {\n\t\t\t\tconst { compilationProductIds } = payload;\n\t\t\t\tif (!Type.isArray(compilationProductIds))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn(\n\t\t\t\t\t\t'setCompilationProductIds: compilationProductIds should be an array',\n\t\t\t\t\t\t{ payload },\n\t\t\t\t\t);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (compilationProductIds.some((id) => !Type.isInteger(id)))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn(\n\t\t\t\t\t\t'setCompilationProductIds: compilationProductIds should contain only integers',\n\t\t\t\t\t\t{ payload },\n\t\t\t\t\t);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('setCompilationProductIds', {\n\t\t\t\t\tcompilationProductIds,\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\t}\n\n\t/* eslint-disable no-param-reassign */\n\tgetMutations(): MutationTree<MessageState>\n\t{\n\t\treturn {\n\t\t\tsetText: (state, payload) => {\n\t\t\t\tstate.text = payload.text;\n\t\t\t},\n\t\t\tsetSource: (state, payload) => {\n\t\t\t\tstate.source = payload.source;\n\t\t\t},\n\t\t\tsetPaymentId: (state, payload) => {\n\t\t\t\tstate.paymentId = payload.paymentId;\n\t\t\t},\n\t\t\tsetShipmentId: (state, payload) => {\n\t\t\t\tstate.shipmentId = payload.shipmentId;\n\t\t\t},\n\t\t\tsetCompilationProductIds: (state, payload) => {\n\t\t\t\tstate.compilationProductIds = payload.compilationProductIds;\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Runtime, Type } from 'main.core';\nimport type { ActionTree, GetterTree, MutationTree } from 'ui.vue3.vuex';\nimport { BuilderModel } from 'ui.vue3.vuex';\nimport { type Channel, type ChannelPosition, type Preferences } from '../editor';\nimport { type Logger } from '../service/logger';\n\ntype PreferencesState = Preferences;\n\nexport class PreferencesModel extends BuilderModel\n{\n\t#logger: Logger;\n\n\tgetName(): string\n\t{\n\t\treturn 'preferences';\n\t}\n\n\tsetLogger(logger: Logger): this\n\t{\n\t\tthis.#logger = logger;\n\n\t\treturn this;\n\t}\n\n\tgetState(): PreferencesState\n\t{\n\t\treturn {\n\t\t\tchannelsSort: Runtime.clone(this.getVariable('channelsSort', null)),\n\t\t};\n\t}\n\n\tgetGetters(): GetterTree<PreferencesState>\n\t{\n\t\treturn {\n\t\t\t/** @function preferences/channelsSortOrDefault */\n\t\t\tchannelsSortOrDefault: (state, getters, rootState): ChannelPosition[] => {\n\t\t\t\tconst savedSort = Runtime.clone(state.channelsSort ?? []);\n\n\t\t\t\tfor (const channel: Channel of rootState.channels.collection)\n\t\t\t\t{\n\t\t\t\t\tif (!savedSort.some((x: ChannelPosition) => x.channelId === channel.id))\n\t\t\t\t\t{\n\t\t\t\t\t\tsavedSort.unshift({\n\t\t\t\t\t\t\tchannelId: channel.id,\n\t\t\t\t\t\t\tisHidden: false,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn savedSort;\n\t\t\t},\n\t\t\tfirstVisibleChannelId: (state, getters): ?string => {\n\t\t\t\tconst sort: ChannelPosition[] = getters.channelsSortOrDefault;\n\n\t\t\t\tconst visible: ChannelPosition[] = sort.filter((position) => !position.isHidden);\n\t\t\t\tif (Type.isArrayFilled(visible))\n\t\t\t\t{\n\t\t\t\t\treturn visible[0].channelId;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t},\n\t\t};\n\t}\n\n\tgetActions(): ActionTree<PreferencesState>\n\t{\n\t\treturn {\n\t\t\t/** @function preferences/actualizeState */\n\t\t\tactualizeState: (store, payload: PreferencesState) => {\n\t\t\t\tstore.commit('actualizeState', Runtime.clone(payload));\n\t\t\t},\n\t\t\t/** @function preferences/setChannelsSort */\n\t\t\tsetChannelsSort: (store, payload: { channelsSort: ChannelPosition[] }) => {\n\t\t\t\tconst { channelsSort } = payload;\n\t\t\t\tif (!Type.isArray(channelsSort))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setChannelsSort: channelsSort should be an array', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst normalized = channelsSort\n\t\t\t\t\t.filter((position) => Type.isPlainObject(position))\n\t\t\t\t\t.map((position) => Runtime.clone(position))\n\t\t\t\t;\n\t\t\t\tif (!Type.isArrayFilled(normalized))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn(\n\t\t\t\t\t\t'setChannelsSort: channelsSort should contain at least one position',\n\t\t\t\t\t\t{ payload },\n\t\t\t\t\t);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('setChannelsSort', {\n\t\t\t\t\tchannelsSort: normalized,\n\t\t\t\t});\n\t\t\t},\n\t\t};\n\t}\n\n\t/* eslint-disable no-param-reassign */\n\tgetMutations(): MutationTree<PreferencesState>\n\t{\n\t\treturn {\n\t\t\tactualizeState: (state, payload) => {\n\t\t\t\tfor (const [key, value] of Object.entries(payload))\n\t\t\t\t{\n\t\t\t\t\tif (key in state)\n\t\t\t\t\t{\n\t\t\t\t\t\tstate[key] = value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tsetChannelsSort: (state, { channelsSort }) => {\n\t\t\t\tstate.channelsSort = channelsSort;\n\t\t\t},\n\t\t};\n\t}\n}\n","import { type FilledPlaceholder } from 'crm.template.editor';\nimport { Runtime, Type } from 'main.core';\nimport type { ActionTree, GetterTree, MutationTree } from 'ui.vue3.vuex';\nimport { BuilderModel } from 'ui.vue3.vuex';\nimport { type Channel } from '../editor';\nimport { type Logger } from '../service/logger';\nimport { makeFrozenClone } from './helpers';\n\ntype TemplatesState = {\n\tcollection: { [contextId: string]: Template[] },\n\tselected: { [channelId: string]: number },\n};\n\nexport type Template = {\n\tID: string,\n\tORIGINAL_ID: number,\n\tTITLE: string,\n\tHEADER?: string,\n\tFOOTER?: string,\n\tPREVIEW?: string,\n\tPLACEHOLDERS?: Array,\n\tFILLED_PLACEHOLDERS?: Array,\n};\n\nconst POSITION = 'PREVIEW';\nconst MAX_COLLECTION_SIZE = 100;\n\n/**\n * This model uses in-browser DB for caching and can contain data from other (previous) instances of the application.\n * Be careful.\n */\nexport class TemplatesModel extends BuilderModel\n{\n\t#logger: Logger;\n\n\tgetName(): string\n\t{\n\t\treturn 'templates';\n\t}\n\n\tsetLogger(logger: Logger): this\n\t{\n\t\tthis.#logger = logger;\n\n\t\treturn this;\n\t}\n\n\tgetState(): TemplatesState\n\t{\n\t\treturn {\n\t\t\tcollection: {},\n\t\t\tselected: {},\n\t\t};\n\t}\n\n\tgetGetters(): GetterTree<TemplatesState>\n\t{\n\t\treturn {\n\t\t\t/** @function templates/listForChannel */\n\t\t\tlistForChannel: (state, getters, rootState, rootGetters): Template[] => {\n\t\t\t\tconst chan = rootGetters['channels/current'];\n\t\t\t\tif (!chan?.isTemplatesBased)\n\t\t\t\t{\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\n\t\t\t\treturn state.collection[getters.cacheContextId] ?? [];\n\t\t\t},\n\t\t\t/** @function templates/current */\n\t\t\tcurrent: (state, getters, rootState, rootGetters): ?Template => {\n\t\t\t\tconst list = getters.listForChannel;\n\n\t\t\t\tconst templateOriginalId = state.selected[rootGetters['channels/current']?.id];\n\t\t\t\tif (Type.isNil(templateOriginalId))\n\t\t\t\t{\n\t\t\t\t\treturn list[0];\n\t\t\t\t}\n\n\t\t\t\treturn list.find((template) => template.ORIGINAL_ID === templateOriginalId) || list[0];\n\t\t\t},\n\t\t\t/** @function templates/cacheContextId */\n\t\t\tcacheContextId: (state, getters, rootState, rootGetters): string => {\n\t\t\t\tconst chan: Channel = rootGetters['channels/current'];\n\t\t\t\tif (Type.isNil(chan))\n\t\t\t\t{\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t\tconst context: JsonObject = rootState.application.context;\n\n\t\t\t\tconst parts = [\n\t\t\t\t\tchan.backend.senderCode,\n\t\t\t\t\tchan.backend.id,\n\t\t\t\t\tcontext.entityTypeId,\n\t\t\t\t\tcontext.entityId,\n\t\t\t\t\tcontext.categoryId,\n\t\t\t\t];\n\n\t\t\t\treturn parts.filter((part) => !Type.isNil(part)).join('_');\n\t\t\t},\n\t\t};\n\t}\n\n\tgetActions(): ActionTree<TemplatesState>\n\t{\n\t\treturn {\n\t\t\t/** @function templates/addTemplates */\n\t\t\taddTemplates: (store, payload: { templates: Template[] }) => {\n\t\t\t\tconst { templates } = payload;\n\t\t\t\tif (!Type.isArray(templates))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('addTemplates: templates should be a empty array', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (Object.keys(store.state.collection).length >= MAX_COLLECTION_SIZE)\n\t\t\t\t{\n\t\t\t\t\t// dont overflow browser DB and memory\n\t\t\t\t\tstore.commit('clearCollection');\n\t\t\t\t}\n\n\t\t\t\tstore.commit('addTemplates', {\n\t\t\t\t\tcontextId: store.getters.cacheContextId,\n\t\t\t\t\ttemplates: Runtime.clone(templates),\n\t\t\t\t});\n\n\t\t\t\tthis.saveState(store.state);\n\t\t\t},\n\t\t\t/** @function templates/setTemplate */\n\t\t\tsetTemplate: (store, payload: { templateOriginalId: number }) => {\n\t\t\t\tconst { templateOriginalId } = payload;\n\t\t\t\tif (!Type.isInteger(templateOriginalId) || templateOriginalId <= 0)\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setTemplate: templateOriginalId should be a positive int', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst chan = store.rootGetters['channels/current'];\n\t\t\t\tif (Type.isNil(chan))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setTemplate: no current channel');\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!chan.isTemplatesBased)\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setTemplate: channel is not templates based', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('select', {\n\t\t\t\t\tchannelId: chan.id,\n\t\t\t\t\ttemplateOriginalId,\n\t\t\t\t});\n\n\t\t\t\tthis.saveState(store.state);\n\t\t\t},\n\t\t\t/** @function templates/setFilledPlaceholder */\n\t\t\tsetFilledPlaceholder: (store, payload: { filledPlaceholder: FilledPlaceholder }) => {\n\t\t\t\tconst { filledPlaceholder } = payload;\n\t\t\t\tif (!Type.isPlainObject(filledPlaceholder))\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setFilledPlaceholder: filledPlaceholder should be a valid object', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst template = store.getters.current;\n\t\t\t\tif (!template)\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn('setFilledPlaceholder: current template is not set', { payload });\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst isPlaceholderExists = template.PLACEHOLDERS[POSITION].includes(filledPlaceholder.PLACEHOLDER_ID);\n\t\t\t\tif (!isPlaceholderExists)\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.warn(\n\t\t\t\t\t\t'setFilledPlaceholder: filledPlaceholder.PLACEHOLDER_ID references non-existent placeholder',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpayload,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstore.commit('upsertFilledPlaceholder', {\n\t\t\t\t\tcontextId: store.getters.cacheContextId,\n\t\t\t\t\ttemplateOriginalId: template.ORIGINAL_ID,\n\t\t\t\t\tfilledPlaceholder: makeFrozenClone(filledPlaceholder),\n\t\t\t\t});\n\n\t\t\t\tthis.saveState(store.state);\n\t\t\t},\n\t\t};\n\t}\n\n\t/* eslint-disable no-param-reassign */\n\tgetMutations(): MutationTree<TemplatesState>\n\t{\n\t\treturn {\n\t\t\taddTemplates: (state, { contextId, templates }) => {\n\t\t\t\tstate.collection[contextId] = templates;\n\t\t\t},\n\t\t\tclearCollection: (state) => {\n\t\t\t\tstate.collection = {};\n\t\t\t},\n\t\t\tselect: (state, { channelId, templateOriginalId }) => {\n\t\t\t\tstate.selected[channelId] = templateOriginalId;\n\t\t\t},\n\t\t\tupsertFilledPlaceholder: (state, { contextId, templateOriginalId, filledPlaceholder }) => {\n\t\t\t\tconst templates = state.collection[contextId];\n\n\t\t\t\tconst template = templates.find((t) => t.ORIGINAL_ID === templateOriginalId);\n\n\t\t\t\ttemplate.FILLED_PLACEHOLDERS ??= [];\n\t\t\t\ttemplate.FILLED_PLACEHOLDERS = template.FILLED_PLACEHOLDERS.filter(\n\t\t\t\t\t(fp) => fp.PLACEHOLDER_ID !== filledPlaceholder.PLACEHOLDER_ID,\n\t\t\t\t);\n\t\t\t\ttemplate.FILLED_PLACEHOLDERS.push(filledPlaceholder);\n\t\t\t},\n\t\t};\n\t}\n}\n","import { Loc } from 'main.core';\nimport type { Store } from 'ui.vue3.vuex';\n\nexport class AlertService\n{\n\t#store: Store;\n\n\tconstructor(params: { store: Store })\n\t{\n\t\tthis.#store = params.store;\n\t}\n\n\tshowError(message: ?string = null): void\n\t{\n\t\tvoid this.#store.dispatch('application/setAlert', {\n\t\t\terror: message || Loc.getMessage('CRM_MESSAGESENDER_EDITOR_GENERIC_ERROR'),\n\t\t});\n\t}\n}\n","import { Builder, Dictionary } from 'crm.integration.analytics';\nimport { sendData } from 'ui.analytics';\nimport type { Store } from 'ui.vue3.vuex';\n\nexport class AnalyticsService\n{\n\t#store: Store;\n\n\tconstructor(params: { store: Store })\n\t{\n\t\tthis.#store = params.store;\n\t}\n\n\tonRender(): void\n\t{\n\t\tconst event = new Builder.Communication.Editor.ViewEvent();\n\n\t\tevent\n\t\t\t.setSection(this.#store.state.analytics.analytics.c_section)\n\t\t\t.setSubSection(this.#store.state.analytics.analytics.c_sub_section)\n\t\t;\n\n\t\tsendData(event.buildData());\n\t}\n\n\tonAddChannelClick(): void\n\t{\n\t\tthis.#sendChannelConnect(Dictionary.ELEMENT_MENU_BUTTON);\n\t}\n\n\tonBannerConnectClick(id: string, connectStatus: ?string): void\n\t{\n\t\tthis.#sendChannelConnect(Dictionary.ELEMENT_BANNER_BUTTON, id, connectStatus);\n\t}\n\n\tonNoChannelsButtonClick(): void\n\t{\n\t\tthis.#sendChannelConnect(Dictionary.ELEMENT_NO_CONNECTION_BUTTON);\n\t}\n\n\t#sendChannelConnect(element: string, id: string, connectStatus: ?string): void\n\t{\n\t\tconst event = new Builder.Communication.Channel.ConnectEvent();\n\n\t\tevent\n\t\t\t.setSection(this.#store.state.analytics.analytics.c_section)\n\t\t\t.setSubSection(this.#store.state.analytics.analytics.c_sub_section)\n\t\t\t.setElement(element)\n\t\t\t.setChannelId(id)\n\t\t\t.setConnectStatus(connectStatus)\n\t\t;\n\n\t\tsendData(event.buildData());\n\t}\n\n\tonPreviewShow(): void\n\t{\n\t\tthis.#sendEditorInteraction(Dictionary.ELEMENT_PREVIEW);\n\t}\n\n\tonSelectTemplate(): void\n\t{\n\t\tthis.#sendEditorInteraction(Dictionary.ELEMENT_TEMPLATE_SELECTOR);\n\t}\n\n\tonSuggestTemplate(): void\n\t{\n\t\tthis.#sendEditorInteraction(Dictionary.ELEMENT_TEMPLATE_OFFER);\n\t}\n\n\tonSelectChannel(): void\n\t{\n\t\tthis.#sendEditorInteraction(Dictionary.ELEMENT_CHANNEL_SELECTOR);\n\t}\n\n\tonSaveChannelsSort(): void\n\t{\n\t\tthis.#sendEditorInteraction(Dictionary.ELEMENT_CHANNEL_LIST_CHANGE);\n\t}\n\n\tonAddFile(): void\n\t{\n\t\tthis.#sendEditorInteraction(Dictionary.ELEMENT_ELEMENT_ADD, 'file');\n\t}\n\n\tonAddDocument(): void\n\t{\n\t\tthis.#sendEditorInteraction(Dictionary.ELEMENT_ELEMENT_ADD, 'document');\n\t}\n\n\tonAddSalescenterPage(): void\n\t{\n\t\tthis.#sendEditorInteraction(Dictionary.ELEMENT_ELEMENT_ADD, 'salescenterPage');\n\t}\n\n\tonAddSalescenterPayment(): void\n\t{\n\t\tthis.#sendEditorInteraction(Dictionary.ELEMENT_ELEMENT_ADD, 'salescenterPayment');\n\t}\n\n\tonAddSalescenterCompilation(): void\n\t{\n\t\tthis.#sendEditorInteraction(Dictionary.ELEMENT_ELEMENT_ADD, 'salescenterCompilation');\n\t}\n\n\tonAddCrmValue(): void\n\t{\n\t\tthis.#sendEditorInteraction(Dictionary.ELEMENT_ELEMENT_ADD, 'crmValue');\n\t}\n\n\t#sendEditorInteraction(element: string, addedElement?: string): void\n\t{\n\t\tconst event = Builder.Communication.Editor.InteractionEvent.createDefault(\n\t\t\tthis.#store.getters['channels/current']?.id,\n\t\t);\n\n\t\tevent\n\t\t\t.setSection(this.#store.state.analytics.analytics.c_section)\n\t\t\t.setSubSection(this.#store.state.analytics.analytics.c_sub_section)\n\t\t\t.setElement(element)\n\t\t\t.setAddedElement(addedElement)\n\t\t;\n\n\t\tsendData(event.buildData());\n\t}\n\n\tonAddCopilot(): void\n\t{\n\t\tconst event = new Builder.Communication.Editor.CopilotEvent();\n\n\t\tevent\n\t\t\t.setSection(this.#store.state.analytics.analytics.c_section)\n\t\t\t.setSubSection(this.#store.state.analytics.analytics.c_sub_section)\n\t\t;\n\n\t\tsendData(event.buildData());\n\t}\n\n\tonSend(): void\n\t{\n\t\tconst event = Builder.Communication.Editor.SendEvent.createDefault(\n\t\t\tthis.#store.getters['channels/current']?.id,\n\t\t);\n\n\t\tevent\n\t\t\t.setSection(this.#store.state.analytics.analytics.c_section)\n\t\t\t.setSubSection(this.#store.state.analytics.analytics.c_sub_section)\n\t\t;\n\n\t\tif (this.#store.getters['channels/current']?.isTemplatesBased)\n\t\t{\n\t\t\tevent.setTemplateId(this.#store.getters['templates/current']?.ORIGINAL_ID);\n\t\t}\n\n\t\tsendData(event.buildData());\n\t}\n\n\tonCancel(): void\n\t{\n\t\tconst event = new Builder.Communication.Editor.CancelEvent();\n\n\t\tevent\n\t\t\t.setSection(this.#store.state.analytics.analytics.c_section)\n\t\t\t.setSubSection(this.#store.state.analytics.analytics.c_sub_section)\n\t\t;\n\n\t\tsendData(event.buildData());\n\t}\n}\n","import type { Copilot, CopilotEvents } from 'ai.copilot';\nimport { Runtime, Type } from 'main.core';\nimport type { BaseEvent } from 'main.core.events';\nimport type { Store } from 'ui.vue3.vuex';\nimport type { Logger } from './logger';\n\nexport type CopilotResult = {\n\ttextReplace?: string,\n\ttextBelow?: string,\n};\n\ntype CopilotHandler = (copilot: Copilot, resolve: (any) => void, event: BaseEvent) => void;\n\nexport class CopilotService\n{\n\t#logger: Logger;\n\t#store: Store;\n\n\t#copilot: ?Copilot = null;\n\t#copilotEvents: ?CopilotEvents = null;\n\n\tconstructor(params: { logger: Logger, store: Store })\n\t{\n\t\tthis.#logger = params.logger;\n\t\tthis.#store = params.store;\n\t}\n\n\t/**\n\t * Show copilot dialog and resolve when it's closed. Resolve result will contain text that should be added to the\n\t * message.\n\t */\n\tshowCopilot(bindElement: HTMLElement, selectedText: string, allText: string): Promise<CopilotResult>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.#getCopilot().then((copilot: Copilot) => {\n\t\t\t\tconst handlers = this.#getHandlers();\n\t\t\t\tfor (const [event, handler] of Object.entries(handlers))\n\t\t\t\t{\n\t\t\t\t\t// mega-hack to remember all references to the handler functions so we can unsubscribe them later\n\t\t\t\t\thandlers[event] = handler.bind(this, copilot, resolve);\n\t\t\t\t}\n\n\t\t\t\tfor (const [event, handler] of Object.entries(handlers))\n\t\t\t\t{\n\t\t\t\t\tcopilot.subscribeOnce(event, handler);\n\t\t\t\t}\n\n\t\t\t\tif (Type.isStringFilled(selectedText.trim()))\n\t\t\t\t{\n\t\t\t\t\tcopilot.setSelectedText(selectedText.trim());\n\t\t\t\t}\n\t\t\t\telse if (Type.isStringFilled(allText.trim()))\n\t\t\t\t{\n\t\t\t\t\tcopilot.setContext(allText.trim());\n\t\t\t\t}\n\n\t\t\t\tcopilot.show({\n\t\t\t\t\tbindElement,\n\t\t\t\t});\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.#logger.error('CopilotService: Failed to show AI Copilot', error);\n\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t}\n\n\t#getCopilot(): Promise<Copilot>\n\t{\n\t\tif (this.#copilot)\n\t\t{\n\t\t\treturn Promise.resolve(this.#copilot);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.#loadExtension()\n\t\t\t\t.then((exports) => {\n\t\t\t\t\t/** @see BX.AI.CopilotEvents */\n\t\t\t\t\tthis.#copilotEvents = exports.CopilotEvents;\n\n\t\t\t\t\t/** @see BX.AI.Copilot */\n\t\t\t\t\t/** @see BX.AI.CopilotMode */\n\t\t\t\t\tthis.#copilot = new exports.Copilot({\n\t\t\t\t\t\tmoduleId: 'crm',\n\t\t\t\t\t\tcontextId: 'crm.messagesender.editor',\n\t\t\t\t\t\tcategory: this.#store.state.application.contentProviders.copilot?.category,\n\t\t\t\t\t\tmode: exports.CopilotMode.TEXT,\n\t\t\t\t\t\tautoHide: true,\n\t\t\t\t\t\tshowResultInCopilot: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#copilot.subscribeOnce(this.#copilotEvents.START_INIT, () => {\n\t\t\t\t\t\tvoid this.#store.dispatch('application/setProgress', { isLoading: true });\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#copilot.subscribeOnce(this.#copilotEvents.FINISH_INIT, () => {\n\t\t\t\t\t\tvoid this.#store.dispatch('application/setProgress', { isLoading: false });\n\n\t\t\t\t\t\tresolve(this.#copilot);\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#copilot.subscribeOnce(this.#copilotEvents.FAILED_INIT, () => {\n\t\t\t\t\t\tvoid this.#store.dispatch('application/setProgress', { isLoading: false });\n\n\t\t\t\t\t\treject(this.#copilot);\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.#copilot.init();\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tthis.#logger.error('CopilotService: Failed to initialize AI Copilot', error);\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t});\n\t}\n\n\t#loadExtension(): Promise<Object>\n\t{\n\t\treturn Runtime.loadExtension('ai.copilot')\n\t\t\t.catch((error) => {\n\t\t\t\tthis.#logger.error('CopilotService: Failed to load AI Copilot extension', error);\n\t\t\t\tthrow error;\n\t\t\t});\n\t}\n\n\t#getHandlers(): { [eventName: string]: CopilotHandler }\n\t{\n\t\t// whichever fires first will resolve the promise and unsubscribe all handlers\n\t\tconst handlers = {\n\t\t\t[this.#copilotEvents.TEXT_SAVE]: (copilot, resolve, event) => {\n\t\t\t\tconst { result } = event.getData();\n\n\t\t\t\tunsubscribeAllHandlers(copilot);\n\n\t\t\t\tresolve({\n\t\t\t\t\ttextReplace: result,\n\t\t\t\t});\n\n\t\t\t\tcopilot.hide();\n\t\t\t},\n\t\t\t[this.#copilotEvents.TEXT_PLACE_BELOW]: (copilot, resolve, event) => {\n\t\t\t\tconst { result } = event.getData();\n\n\t\t\t\tunsubscribeAllHandlers(copilot);\n\n\t\t\t\tresolve({\n\t\t\t\t\ttextBelow: result,\n\t\t\t\t});\n\n\t\t\t\tcopilot.hide();\n\t\t\t},\n\t\t\t[this.#copilotEvents.HIDE]: (copilot, resolve) => {\n\t\t\t\tunsubscribeAllHandlers(copilot);\n\n\t\t\t\tresolve({});\n\t\t\t},\n\t\t};\n\n\t\tconst unsubscribeAllHandlers = (copilot: Copilot) => {\n\t\t\tfor (const [event, handler] of Object.entries(handlers))\n\t\t\t{\n\t\t\t\tcopilot.unsubscribe(event, handler);\n\t\t\t}\n\t\t};\n\n\t\treturn handlers;\n\t}\n}\n","import { type Selector } from 'documentgenerator.selector';\nimport { Runtime, Type } from 'main.core';\nimport type { Store } from 'ui.vue3.vuex';\nimport { type Logger } from './logger';\n\nexport type Document = {\n\ttitle: string,\n\tpublicUrl: string,\n};\n\nexport class DocumentService\n{\n\t#logger: Logger;\n\t#store: Store;\n\n\t#menu: ?Selector.Menu = null;\n\n\tconstructor(params: { logger: Logger, store: Store })\n\t{\n\t\tthis.#logger = params.logger;\n\t\tthis.#store = params.store;\n\t}\n\n\tasync selectOrCreateDocument(bindElement: HTMLElement): Promise<?Document>\n\t{\n\t\tvoid this.#store.dispatch('application/setProgress', { isLoading: true });\n\n\t\ttry\n\t\t{\n\t\t\tconst menu = await this.#getMenu();\n\n\t\t\tconst result = await menu.show(bindElement);\n\n\t\t\tif (await this.#isDocument(result))\n\t\t\t{\n\t\t\t\treturn {\n\t\t\t\t\ttitle: result.getTitle(),\n\t\t\t\t\tpublicUrl: await this.#getPublicUrl(result),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (await this.#isTemplate(result))\n\t\t\t{\n\t\t\t\tlet document = null;\n\t\t\t\ttry\n\t\t\t\t{\n\t\t\t\t\tdocument = await menu.createDocument(result);\n\t\t\t\t}\n\t\t\t\tcatch (error)\n\t\t\t\t{\n\t\t\t\t\tthis.#logger.error('Failed to create document from template', { template: result, error });\n\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\n\t\t\t\tif (Type.isNil(document))\n\t\t\t\t{\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\ttitle: document.getTitle(),\n\t\t\t\t\tpublicUrl: await this.#getPublicUrl(document),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t\tfinally\n\t\t{\n\t\t\tvoid this.#store.dispatch('application/setProgress', { isLoading: false });\n\t\t}\n\t}\n\n\tasync #getMenu(): Promise<Selector.Menu>\n\t{\n\t\tif (this.#menu)\n\t\t{\n\t\t\treturn this.#menu;\n\t\t}\n\n\t\tconst exports = await this.#loadExtension();\n\n\t\t/** @see BX.DocumentGenerator.Selector.Menu */\n\t\tthis.#menu = new exports.Selector.Menu({\n\t\t\tmoduleId: 'crm',\n\t\t\tprovider: this.#store.state.application.contentProviders.documents.provider,\n\t\t\tvalue: this.#store.state.application.context.entityId,\n\t\t\tanalyticsLabelPrefix: 'crmTimelineSmsEditor',\n\t\t});\n\n\t\treturn this.#menu;\n\t}\n\n\t#getPublicUrl(document: Selector.Document): Promise<string>\n\t{\n\t\treturn this.#getMenu()\n\t\t\t.then((menu) => {\n\t\t\t\treturn menu.getDocumentPublicUrl(document);\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tthis.#logger.error('Failed to get document public URL', { document, error });\n\n\t\t\t\tthrow error;\n\t\t\t})\n\t\t;\n\t}\n\n\tasync #isDocument(object: any): Promise<boolean>\n\t{\n\t\tconst exports = await this.#loadExtension();\n\n\t\t/** @see BX.DocumentGenerator.Selector.Document */\n\t\treturn object instanceof exports.Selector.Document;\n\t}\n\n\tasync #isTemplate(object: any): Promise<boolean>\n\t{\n\t\tconst exports = await this.#loadExtension();\n\n\t\t/** @see BX.DocumentGenerator.Selector.Template */\n\t\treturn object instanceof exports.Selector.Template;\n\t}\n\n\t#loadExtension(): Promise<Object>\n\t{\n\t\treturn Runtime.loadExtension('documentgenerator.selector')\n\t\t\t.catch((error) => {\n\t\t\t\tthis.#logger.error('Failed to load documentgenerator.selector', error);\n\n\t\t\t\tthrow error;\n\t\t\t})\n\t\t;\n\t}\n}\n","import { ajax as Ajax, type AjaxResponse, Runtime, Type } from 'main.core';\nimport { type Uploader, type UploaderFile } from 'ui.uploader.core';\nimport type { Store } from 'ui.vue3.vuex';\nimport { type Logger } from './logger';\n\nexport type File = {\n\tname: string,\n\texternalLink: string,\n};\n\ntype FileWatcher = (File) => void;\n\nexport class FileService\n{\n\t#logger: Logger;\n\t#store: Store;\n\n\t#uploader: ?Uploader = null;\n\t#browseElement: ?HTMLDivElement = null;\n\t#fileWatcher: ?FileWatcher = null;\n\n\tconstructor(params: { logger: Logger, store: Store })\n\t{\n\t\tthis.#logger = params.logger;\n\t\tthis.#store = params.store;\n\t}\n\n\t/**\n\t * @param onSuccess can be called multiple times if user selects multiple files\n\t */\n\tuploadNewFile(onSuccess: (File) => void): void\n\t{\n\t\tif (this.#store.getters['application/isProgress'])\n\t\t{\n\t\t\tthis.#logger.warn('Cannot upload file while in progress');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#fileWatcher = onSuccess;\n\n\t\tvoid this.#openFileBrowser();\n\t}\n\n\t/**\n\t * @param onSuccess can be called multiple times if user selects multiple files\n\t */\n\tpickFromDisk(onSuccess: (File) => void): void\n\t{\n\t\tif (this.#store.getters['application/isProgress'])\n\t\t{\n\t\t\tthis.#logger.warn('Cannot pick file from disk while in progress');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#fileWatcher = onSuccess;\n\n\t\tvoid this.#openDiskFileDialog();\n\t}\n\n\tasync #openFileBrowser(): void\n\t{\n\t\tif (this.#browseElement)\n\t\t{\n\t\t\tthis.#browseElement.click();\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst uploader = await this.#getUploader();\n\n\t\tthis.#browseElement = document.createElement('div');\n\t\tuploader.assignBrowse(this.#browseElement);\n\n\t\tthis.#browseElement.click();\n\t}\n\n\tasync #openDiskFileDialog(): Promise<void>\n\t{\n\t\tconst uploader = await this.#getUploader();\n\n\t\tconst { openDiskFileDialog } = await Runtime.loadExtension('disk.uploader.user-field-widget');\n\n\t\topenDiskFileDialog({\n\t\t\tdialogId: 'crm-messagesender-editor',\n\t\t\tuploader,\n\t\t});\n\t}\n\n\t#getUploader(): Promise<Uploader>\n\t{\n\t\tif (this.#uploader)\n\t\t{\n\t\t\treturn Promise.resolve(this.#uploader);\n\t\t}\n\n\t\treturn Runtime.loadExtension('ui.uploader.core').then((exports) => {\n\t\t\tlet linkLoadsCount = 0;\n\n\t\t\t/** @see { BX.UI.Uploader.Uploader } */\n\t\t\tthis.#uploader = new exports.Uploader({\n\t\t\t\tcontroller: 'disk.uf.integration.diskUploaderController',\n\t\t\t\tmultiple: true,\n\t\t\t\tevents: {\n\t\t\t\t\t[exports.UploaderEvent.FILE_ADD_START]: () => {\n\t\t\t\t\t\tvoid this.#store.dispatch('application/setProgress', { isLoading: true });\n\t\t\t\t\t},\n\t\t\t\t\t[exports.UploaderEvent.FILE_ERROR]: (event) => {\n\t\t\t\t\t\tthis.#logger.error('Failed to upload file', event.getData());\n\n\t\t\t\t\t\tif (linkLoadsCount <= 0 && !this.#isUploaderBusy(this.#uploader))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvoid this.#store.dispatch('application/setProgress', { isLoading: false });\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t// fires both on upload complete (from browser) and load complete (from disk dialog)\n\t\t\t\t\t[exports.UploaderEvent.FILE_COMPLETE]: (event) => {\n\t\t\t\t\t\tconst file: UploaderFile = event.getData().file;\n\n\t\t\t\t\t\tlinkLoadsCount++;\n\n\t\t\t\t\t\tvoid this.#getExternalLink(file.getCustomData('fileId'))\n\t\t\t\t\t\t\t// eslint-disable-next-line promise/no-nesting\n\t\t\t\t\t\t\t.then((link) => {\n\t\t\t\t\t\t\t\tthis.#fileWatcher?.({\n\t\t\t\t\t\t\t\t\tname: file.getName(),\n\t\t\t\t\t\t\t\t\texternalLink: link,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.finally(() => {\n\t\t\t\t\t\t\t\tlinkLoadsCount--;\n\n\t\t\t\t\t\t\t\tif (linkLoadsCount <= 0 && !this.#isUploaderBusy(this.#uploader))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvoid this.#store.dispatch('application/setProgress', { isLoading: false });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn this.#uploader;\n\t\t}).catch((error) => {\n\t\t\tthis.#logger.error('Failed to load ui.uploader.core', error);\n\n\t\t\tthrow error;\n\t\t});\n\t}\n\n\t#isUploaderBusy(uploader: Uploader): boolean\n\t{\n\t\tif (!Type.isFunction(uploader.getUploadingFileCount))\n\t\t{\n\t\t\t// already destroyed\n\n\t\t\treturn false;\n\t\t}\n\n\t\tif (uploader.getUploadingFileCount() > 0)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\tif (uploader.getPendingFileCount() > 0)\n\t\t{\n\t\t\treturn true;\n\t\t}\n\n\t\treturn uploader.getFiles().some((file: UploaderFile) => file.isLoading());\n\t}\n\n\t#getExternalLink(fileId: number): Promise<string>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction(\n\t\t\t\t'disk.file.generateExternalLink',\n\t\t\t\t{\n\t\t\t\t\tanalyticsLabel: 'crmTimelineSmsEditorGetFilePublicUrl',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tfileId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t).then((response: AjaxResponse<{ externalLink: { link: string }}>) => {\n\t\t\t\tif (Type.isStringFilled(response?.data?.externalLink?.link))\n\t\t\t\t{\n\t\t\t\t\tresolve(response.data.externalLink.link);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treject(new Error('No external link in response'));\n\t\t\t\t}\n\t\t\t}).catch((error) => {\n\t\t\t\tthis.#logger.error('Failed to get external link', error);\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t}\n}\n","import { Type } from 'main.core';\n\nexport class Logger\n{\n\t#prefix: string;\n\n\tconstructor(params: {prefix?: string} = {})\n\t{\n\t\tthis.#prefix = params.prefix || '';\n\t}\n\n\terror(...args)\n\t{\n\t\tthis.#prepareArgs(args);\n\n\t\tconsole.error(...args);\n\t}\n\n\twarn(...args)\n\t{\n\t\tthis.#prepareArgs(args);\n\n\t\t// eslint-disable-next-line no-console\n\t\tconsole.warn(...args);\n\t}\n\n\t#prepareArgs(args: any[]): void\n\t{\n\t\tconst [message] = args;\n\t\tif (Type.isString(message))\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\targs[0] = `${this.#prefix}${message}`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\targs.unshift(this.#prefix);\n\t\t}\n\t}\n}\n\n// default logger\nexport const logger = new Logger({\n\tprefix: 'crm.messagesender.editor: ',\n});\n","import type { Store } from 'ui.vue3.vuex';\nimport { type ChannelPosition } from '../editor';\n\nconst OPTIONS_CATEGORY = 'crm';\nconst OPTIONS_NAME = 'crm.messagesender.editor';\n\nexport class PreferencesService\n{\n\t#store: Store;\n\n\tconstructor(params: { store: Store })\n\t{\n\t\tthis.#store = params.store;\n\t}\n\n\tsaveChannelsSort(sort: ChannelPosition[]): void\n\t{\n\t\tvoid this.#store.dispatch('preferences/setChannelsSort', { channelsSort: sort });\n\n\t\tthis.#savePreferences();\n\t}\n\n\t#savePreferences(): void\n\t{\n\t\tconst scene = this.#store.state.application.scene;\n\n\t\tBX.userOptions.save(OPTIONS_CATEGORY, OPTIONS_NAME, scene.id, JSON.stringify(this.#store.state.preferences));\n\t}\n}\n","import { Runtime, Text, Type } from 'main.core';\nimport type { Store } from 'ui.vue3.vuex';\nimport { type Logger } from './logger';\n\nexport type ApplicationResult = {\n\tsource?: string,\n\tpage?: {\n\t\tname: string,\n\t\turl: string,\n\t},\n\tpayment?: {\n\t\tname: string,\n\t\tpaymentId: ?number,\n\t\tshipmentId: ?number,\n\t},\n\tcompilation?: {\n\t\tname: string,\n\t\tproductIds: Array<number>,\n\t}\n};\n\nexport class SalescenterService\n{\n\t#logger: Logger;\n\t#store: Store;\n\n\tconstructor(params: { logger: Logger, store: Store })\n\t{\n\t\tthis.#logger = params.logger;\n\t\tthis.#store = params.store;\n\t}\n\n\tshowSalescenterDisabledSlider(): void\n\t{\n\t\tRuntime.loadExtension('salescenter.tool-availability-manager')\n\t\t\t.then(({ ToolAvailabilityManager }) => {\n\t\t\t\t/** @see BX.Salescenter.ToolAvailabilityManager.openSalescenterToolDisabledSlider */\n\t\t\t\tToolAvailabilityManager.openSalescenterToolDisabledSlider();\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tthis.#logger.error('Failed to load salescenter.tool-availability-manager', error);\n\t\t\t});\n\t}\n\n\topenApplication(): Promise<ApplicationResult>\n\t{\n\t\treturn Runtime.loadExtension('salescenter.manager')\n\t\t\t.then(({ Manager }) => {\n\t\t\t\t/** @see BX.Salescenter.Manager.openApplication */\n\t\t\t\treturn Manager.openApplication({\n\t\t\t\t\tdisableSendButton: this.#store.getters['channels/canSendMessage'] ? '' : 'y',\n\t\t\t\t\tcontext: 'sms',\n\t\t\t\t\townerTypeId: this.#store.state.application.context.entityTypeId,\n\t\t\t\t\townerId: this.#store.state.application.context.entityId,\n\t\t\t\t\tmode: this.#store.state.application.contentProviders.salescenter.mode,\n\t\t\t\t\tst: {\n\t\t\t\t\t\ttool: 'crm',\n\t\t\t\t\t\tcategory: 'payments',\n\t\t\t\t\t\tevent: 'payment_create_click',\n\t\t\t\t\t\tc_section: 'crm_sms',\n\t\t\t\t\t\tc_sub_section: 'web',\n\t\t\t\t\t\ttype: 'delivery_payment',\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then((result: BX.SidePanel.Dictionary): ApplicationResult => {\n\t\t\t\tif (result.get('action') === 'sendPage' && Type.isStringFilled(result.get('page')?.url))\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tpage: {\n\t\t\t\t\t\t\tname: String(result.get('page').name),\n\t\t\t\t\t\t\turl: String(result.get('page').url),\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (result.get('action') === 'sendPayment' && Type.isObject(result.get('order')))\n\t\t\t\t{\n\t\t\t\t\tconst order = result.get('order');\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsource: 'order',\n\t\t\t\t\t\tpayment: {\n\t\t\t\t\t\t\tname: String(order.title),\n\t\t\t\t\t\t\tpaymentId: Type.isNil(order.paymentId) ? null : Text.toInteger(order.paymentId),\n\t\t\t\t\t\t\tshipmentId: Type.isNil(order.shipmentId) ? null : Text.toInteger(order.shipmentId),\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (result.get('action') === 'sendCompilation' && Type.isObject(result.get('compilation')))\n\t\t\t\t{\n\t\t\t\t\tconst compilation = result.get('compilation');\n\n\t\t\t\t\tlet productIds = null;\n\t\t\t\t\tif (Type.isArray(compilation.productIds))\n\t\t\t\t\t{\n\t\t\t\t\t\tproductIds = compilation.productIds.map((id) => Text.toInteger(id));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsource: 'deal',\n\t\t\t\t\t\tcompilation: {\n\t\t\t\t\t\t\tname: String(compilation.title),\n\t\t\t\t\t\t\tproductIds,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn {};\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tthis.#logger.error('Failed to open salescenter application', error);\n\t\t\t\tthrow error;\n\t\t\t});\n\t}\n}\n","import { type Receiver } from 'crm.messagesender';\nimport { ajax as Ajax, type JsonObject, Type } from 'main.core';\nimport { type EventEmitter } from 'main.core.events';\nimport { type Store } from 'ui.vue3.vuex';\nimport { type Channel, type From } from '../editor';\nimport { type MessageModel } from '../model/message-model';\nimport { type Template } from '../model/templates-model';\nimport { type AnalyticsService } from './analytics-service';\nimport { type Logger } from './logger';\n\ntype Params = {\n\tlogger: Logger,\n\tstore: Store,\n\tmessageModel: MessageModel,\n\teventEmitter: EventEmitter,\n\tanalyticsService: AnalyticsService,\n};\n\nexport class SendService\n{\n\t#logger: Logger;\n\t#store: Store;\n\t#messageModel: MessageModel;\n\t#emitter: EventEmitter;\n\t#analyticsService: AnalyticsService;\n\n\tconstructor(params: Params)\n\t{\n\t\tthis.#logger = params.logger;\n\t\tthis.#store = params.store;\n\t\tthis.#messageModel = params.messageModel;\n\t\tthis.#emitter = params.eventEmitter;\n\t\tthis.#analyticsService = params.analyticsService;\n\t}\n\n\tsendMessage(): Promise<void>\n\t{\n\t\tif (this.#store.getters['application/isProgress'])\n\t\t{\n\t\t\tthis.#logger.warn('sendMessage: already in progress');\n\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tvoid this.#store.dispatch('application/setProgress', { isSending: true });\n\n\t\tconst channel: Channel = this.#store.getters['channels/current'];\n\t\tconst from: From = this.#store.getters['channels/from'];\n\t\tconst receiver: Receiver = this.#store.getters['channels/receiver'];\n\n\t\tconst params = this.#prepareParams(channel, from, receiver);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('crm.activity.sms.send', {\n\t\t\t\tdata: {\n\t\t\t\t\townerTypeId: this.#store.state.application.context.entityTypeId,\n\t\t\t\t\townerId: this.#store.state.application.context.entityId,\n\t\t\t\t\tparams,\n\t\t\t\t},\n\t\t\t})\n\t\t\t\t.then(resolve)\n\t\t\t\t.catch(reject)\n\t\t\t;\n\t\t}).then(() => {\n\t\t\tthis.#analyticsService.onSend();\n\t\t\tthis.#messageModel.clearState();\n\t\t\tvoid this.#store.dispatch('application/resetAlert');\n\t\t\tthis.#emitter.emit('crm:messagesender:editor:onSendSuccess');\n\t\t}).catch((response) => {\n\t\t\tthis.#logger.error('sendMessage: error', { response });\n\n\t\t\tthrow response;\n\t\t}).finally(() => {\n\t\t\tvoid this.#store.dispatch('application/setProgress', { isSending: false });\n\t\t});\n\t}\n\n\t#prepareParams(channel: Channel, from: From, receiver: Receiver): JsonObject\n\t{\n\t\tif (channel.backend.senderCode === 'bitrix24')\n\t\t{\n\t\t\treturn this.#prepareNotificationParams(channel, from, receiver);\n\t\t}\n\n\t\tif (channel.isTemplatesBased)\n\t\t{\n\t\t\treturn this.#prepareTemplateParams(channel, from, receiver);\n\t\t}\n\n\t\treturn this.#prepareCustomTextParams(channel, from, receiver);\n\t}\n\n\t#prepareNotificationParams(channel: Channel, from: From, receiver: Receiver): JsonObject\n\t{\n\t\treturn {\n\t\t\t...this.#prepareCommonParams(channel, from, receiver),\n\t\t\tsignedTemplate: this.#store.state.application.notificationTemplate.signed,\n\t\t};\n\t}\n\n\t#prepareTemplateParams(channel: Channel, from: From, receiver: Receiver): JsonObject\n\t{\n\t\tconst template: ?Template = this.#store.getters['templates/current'];\n\n\t\treturn {\n\t\t\t...this.#prepareCommonParams(channel, from, receiver),\n\t\t\tbody: this.#store.getters['message/body'],\n\t\t\ttemplate: template.ID,\n\t\t\ttemplateOriginalId: template.ORIGINAL_ID,\n\t\t\tisTemplateWithPlaceholders: Type.isPlainObject(template.PLACEHOLDERS),\n\t\t\tisReplacePlaceholders: true,\n\t\t\tisPlaceholdersInDisplayFormat: false,\n\t\t};\n\t}\n\n\t#prepareCustomTextParams(channel: Channel, from: From, receiver: Receiver): JsonObject\n\t{\n\t\treturn {\n\t\t\t...this.#prepareCommonParams(channel, from, receiver),\n\t\t\tbody: this.#store.getters['message/body'],\n\t\t\tpaymentId: this.#store.state.message.paymentId,\n\t\t\tshipmentId: this.#store.state.message.shipmentId,\n\t\t\tsource: this.#store.state.message.source,\n\t\t\tcompilationProductIds: this.#store.state.message.compilationProductIds,\n\t\t\tisReplacePlaceholders: true,\n\t\t\tisPlaceholdersInDisplayFormat: true,\n\t\t};\n\t}\n\n\t#prepareCommonParams(channel: Channel, from: From, receiver: Receiver): JsonObject\n\t{\n\t\treturn {\n\t\t\tsenderId: channel.backend.id,\n\t\t\tfrom: from.id,\n\t\t\tto: receiver.address.value,\n\t\t\tentityTypeId: receiver.addressSource.entityTypeId,\n\t\t\tentityId: receiver.addressSource.entityId,\n\t\t};\n\t}\n}\n","import type { OnSelectParams } from 'crm.template.editor';\nimport { ajax as Ajax, type AjaxResponse, Cache, Type } from 'main.core';\nimport type { Store } from 'ui.vue3.vuex';\nimport { type Channel, type EditorOptions } from '../editor';\nimport { type Template } from '../model/templates-model';\nimport { type Logger } from './logger';\n\ntype TemplatesAjaxResponse = AjaxResponse<{templates: Template[]}>;\n\nexport class TemplateService\n{\n\t#sessionCache: Cache.MemoryCache = new Cache.MemoryCache();\n\t#logger: Logger;\n\t#store: Store;\n\n\tconstructor(params: { logger: Logger, store: Store })\n\t{\n\t\tthis.#logger = params.logger;\n\t\tthis.#store = params.store;\n\t}\n\n\tloadTemplates(): void\n\t{\n\t\tthis.#doOnce(() => {\n\t\t\tconst chan = this.#getCurrentChannel();\n\t\t\tif (!chan || !chan.isTemplatesBased || !chan.backend.senderCode === 'sms_provider')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tAjax.runAction('crm.activity.sms.getTemplates', {\n\t\t\t\tdata: {\n\t\t\t\t\tsenderId: chan.backend.id,\n\t\t\t\t\tcontext: {\n\t\t\t\t\t\tentityTypeId: this.#getContext().entityTypeId,\n\t\t\t\t\t\tentityId: this.#getContext().entityId,\n\t\t\t\t\t\tentityCategoryId: this.#getContext().categoryId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}).then((response: TemplatesAjaxResponse) => {\n\t\t\t\tthis.#cacheTemplates(response.data.templates);\n\t\t\t}).catch((response: TemplatesAjaxResponse | any) => {\n\t\t\t\tthis.#logger.error('Error while loading templates', response);\n\n\t\t\t\tthrow response;\n\t\t\t});\n\t\t});\n\t}\n\n\t#doOnce(callback: () => void): void\n\t{\n\t\tthis.#sessionCache.remember(this.#store.getters['templates/cacheContextId'], callback);\n\t}\n\n\t#getCurrentChannel(): ?Channel\n\t{\n\t\treturn this.#store.getters['channels/current'];\n\t}\n\n\t#getCurrentTemplate(): ?Template\n\t{\n\t\treturn this.#store.getters['templates/current'];\n\t}\n\n\t#getContext(): EditorOptions['context']\n\t{\n\t\treturn this.#store.state.application.context;\n\t}\n\n\t#cacheTemplates(templates: Template[]): void\n\t{\n\t\tvoid this.#store.dispatch('templates/addTemplates', { templates });\n\t}\n\n\tcreateOrUpdatePlaceholder(params: OnSelectParams): void\n\t{\n\t\tconst template = this.#getCurrentTemplate();\n\t\tif (!template)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst context = this.#getContext();\n\t\tif (Type.isNil(context.entityTypeId))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { id, value, entityType, text } = params;\n\n\t\tAjax.runAction(\n\t\t\t'crm.activity.smsplaceholder.createOrUpdatePlaceholder',\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tplaceholderId: id,\n\t\t\t\t\tfieldName: Type.isStringFilled(value) ? value : null,\n\t\t\t\t\tentityType: Type.isStringFilled(entityType) ? entityType : null,\n\t\t\t\t\tfieldValue: Type.isStringFilled(text) ? text : null,\n\t\t\t\t\ttemplateId: template.ORIGINAL_ID,\n\t\t\t\t\tentityTypeId: context.entityTypeId,\n\t\t\t\t\tentityCategoryId: context.categoryId,\n\t\t\t\t},\n\t\t\t},\n\t\t).catch((response: AjaxResponse | any) => {\n\t\t\tthis.#logger.warn('Error while remembering placeholder', response);\n\t\t});\n\t}\n}\n","import { Cache } from 'main.core';\nimport type { Store } from 'ui.vue3.vuex';\nimport { type MessageModel } from '../model/message-model';\nimport { AlertService } from './alert-service';\nimport { AnalyticsService } from './analytics-service';\nimport { CopilotService } from './copilot-service';\nimport { DocumentService } from './document-service';\nimport { FileService } from './file-service';\nimport { logger, type Logger } from './logger';\nimport { PreferencesService } from './preferences-service';\nimport { SalescenterService } from './salescenter-service';\nimport { SendService } from './send-service';\nimport { TemplateService } from './template-service';\n\n/**\n * One instance of this class per editor instance. Some services can be shared between editors.\n */\nexport class ServiceLocator\n{\n\t#services = new Cache.MemoryCache();\n\t#store: ?Store = null;\n\t#messageModel: ?MessageModel = null;\n\t#emitter: ?EventEmitter = null;\n\n\tsetStore(store: Store): this\n\t{\n\t\tthis.#store = store;\n\n\t\treturn this;\n\t}\n\n\tsetMessageModel(messageModel: MessageModel): this\n\t{\n\t\tthis.#messageModel = messageModel;\n\n\t\treturn this;\n\t}\n\n\tgetMessageModel(): ?MessageModel\n\t{\n\t\treturn this.#messageModel;\n\t}\n\n\tsetEventEmitter(emitter: EventEmitter): this\n\t{\n\t\tthis.#emitter = emitter;\n\n\t\treturn this;\n\t}\n\n\tgetLogger(): Logger\n\t{\n\t\treturn logger;\n\t}\n\n\tgetSendService(): SendService\n\t{\n\t\treturn this.#services.remember('sendService', () => {\n\t\t\treturn new SendService({\n\t\t\t\tlogger: this.getLogger(),\n\t\t\t\tstore: this.#store,\n\t\t\t\tmessageModel: this.getMessageModel(),\n\t\t\t\teventEmitter: this.#emitter,\n\t\t\t\tanalyticsService: this.getAnalyticsService(),\n\t\t\t});\n\t\t});\n\t}\n\n\tgetAlertService(): AlertService\n\t{\n\t\treturn this.#services.remember('alertService', () => {\n\t\t\treturn new AlertService({\n\t\t\t\tstore: this.#store,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetFileService(): FileService\n\t{\n\t\treturn this.#services.remember('fileService', () => {\n\t\t\treturn new FileService({\n\t\t\t\tlogger: this.getLogger(),\n\t\t\t\tstore: this.#store,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetSalescenterService(): SalescenterService\n\t{\n\t\treturn this.#services.remember('salescenterService', () => {\n\t\t\treturn new SalescenterService({\n\t\t\t\tlogger: this.getLogger(),\n\t\t\t\tstore: this.#store,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDocumentService(): DocumentService\n\t{\n\t\treturn this.#services.remember('documentService', () => {\n\t\t\treturn new DocumentService({\n\t\t\t\tlogger: this.getLogger(),\n\t\t\t\tstore: this.#store,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetCopilotService(): CopilotService\n\t{\n\t\treturn this.#services.remember('copilotService', () => {\n\t\t\treturn new CopilotService({\n\t\t\t\tlogger: this.getLogger(),\n\t\t\t\tstore: this.#store,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetTemplateService(): TemplateService\n\t{\n\t\treturn this.#services.remember('templateService', () => {\n\t\t\treturn new TemplateService({\n\t\t\t\tlogger: this.getLogger(),\n\t\t\t\tstore: this.#store,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPreferencesService(): PreferencesService\n\t{\n\t\treturn this.#services.remember('preferencesService', () => {\n\t\t\treturn new PreferencesService({\n\t\t\t\tstore: this.#store,\n\t\t\t});\n\t\t});\n\t}\n\n\tgetAnalyticsService(): AnalyticsService\n\t{\n\t\treturn this.#services.remember('analyticsService', () => {\n\t\t\treturn new AnalyticsService({\n\t\t\t\tstore: this.#store,\n\t\t\t});\n\t\t});\n\t}\n}\n","import { Runtime } from 'main.core';\nimport { type Store } from 'ui.vue3.vuex';\nimport type { State } from './editor';\n\nexport class StateExporter\n{\n\t#store: Store;\n\t#emitter: EventEmitter;\n\t#unwatches: Array<() => void> = [];\n\t#emitStateChangeDebounced: ?() => void = null;\n\n\tconstructor({ store, eventEmitter })\n\t{\n\t\tthis.#store = store;\n\t\tthis.#emitter = eventEmitter;\n\n\t\tthis.#bindEvents();\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tthis.#watchChannel();\n\t\tthis.#watchFrom();\n\t\tthis.#watchReceiver();\n\t\tthis.#watchMessageBody();\n\t\tthis.#watchTemplate();\n\t}\n\n\t#watchChannel(): void\n\t{\n\t\tthis.#unwatches.push(\n\t\t\tthis.#store.watch(\n\t\t\t\t(state, getters) => getters['channels/current'],\n\t\t\t\t(newValue: ?Channel, oldValue: ?Channel) => {\n\t\t\t\t\tif (newValue?.id !== oldValue?.id)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#emitOnStateChange();\n\t\t\t\t\t\tthis.#emit('onChannelChange', { channel: newValue, oldChannel: oldValue });\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t#watchFrom(): void\n\t{\n\t\tthis.#unwatches.push(\n\t\t\tthis.#store.watch(\n\t\t\t\t(state, getters) => getters['channels/from'],\n\t\t\t\t(newValue, oldValue) => {\n\t\t\t\t\tif (newValue?.id !== oldValue?.id)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#emitOnStateChange();\n\t\t\t\t\t\tthis.#emit('onFromChange', { from: newValue, oldFrom: oldValue });\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t#watchReceiver(): void\n\t{\n\t\tconst emit = (newValue, oldValue) => {\n\t\t\tthis.#emitOnStateChange();\n\t\t\tthis.#emit('onToChange', { to: newValue, oldTo: oldValue });\n\t\t};\n\n\t\tthis.#unwatches.push(\n\t\t\tthis.#store.watch(\n\t\t\t\t(state, getters) => getters['channels/receiver'],\n\t\t\t\t(newValue, oldValue) => {\n\t\t\t\t\tif (!newValue && oldValue)\n\t\t\t\t\t{\n\t\t\t\t\t\temit(newValue, oldValue);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (newValue && !oldValue)\n\t\t\t\t\t{\n\t\t\t\t\t\temit(newValue, oldValue);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (newValue && oldValue && !newValue.isEqualTo(oldValue))\n\t\t\t\t\t{\n\t\t\t\t\t\temit(newValue, oldValue);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t#watchMessageBody(): void\n\t{\n\t\tlet lastNewValue = null;\n\t\tlet lastOldValue = null;\n\n\t\tconst throttledWatcher = Runtime.throttle(() => {\n\t\t\tif (lastNewValue !== lastOldValue)\n\t\t\t{\n\t\t\t\tthis.#emitOnStateChange();\n\t\t\t\tthis.#emit('onMessageBodyChange', { body: lastNewValue, oldBody: lastOldValue });\n\t\t\t}\n\t\t}, 200);\n\n\t\tthis.#unwatches.push(\n\t\t\tthis.#store.watch(\n\t\t\t\t(state, getters) => getters['message/body'],\n\t\t\t\t(newValue, oldValue) => {\n\t\t\t\t\t// noinspection ReuseOfLocalVariableJS\n\t\t\t\t\tlastNewValue = newValue;\n\t\t\t\t\t// noinspection ReuseOfLocalVariableJS\n\t\t\t\t\tlastOldValue = oldValue;\n\n\t\t\t\t\tthrottledWatcher();\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t#watchTemplate(): void\n\t{\n\t\tthis.#unwatches.push(\n\t\t\tthis.#store.watch(\n\t\t\t\t(state, getters) => getters['templates/current'],\n\t\t\t\t(newValue, oldValue) => {\n\t\t\t\t\tif (newValue?.ORIGINAL_ID !== oldValue?.ORIGINAL_ID)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#emitOnStateChange();\n\t\t\t\t\t\tthis.#emit('onTemplateChange', {\n\t\t\t\t\t\t\t// clone mutable data to avoid external mutations\n\t\t\t\t\t\t\ttemplate: Runtime.clone(newValue),\n\t\t\t\t\t\t\toldTemplate: Runtime.clone(oldValue),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t#emitOnStateChange(): void\n\t{\n\t\t// on channel change there usually from, to, template and message body changes\n\t\t// fire only one event in such cases\n\t\tthis.#emitStateChangeDebounced ??= Runtime.debounce(() => {\n\t\t\tthis.#emit('onStateChange');\n\t\t}, 25);\n\n\t\tthis.#emitStateChangeDebounced();\n\t}\n\n\t#emit(eventName: string, eventData: Object = {}): void\n\t{\n\t\tthis.#emitter.emit(eventName, eventData);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#unwatches.forEach((unwatch) => unwatch());\n\t\tthis.#unwatches = null;\n\n\t\tthis.#emitter = null;\n\n\t\tRuntime.destroy(this);\n\t}\n\n\tgetState(): ?State\n\t{\n\t\tconst state = {\n\t\t\tchannel: this.#store.getters['channels/current'],\n\t\t\tfrom: this.#store.getters['channels/from'],\n\t\t\tto: this.#store.getters['channels/receiver'],\n\t\t\tmessage: {\n\t\t\t\tbody: this.#store.getters['message/body'],\n\t\t\t},\n\t\t};\n\n\t\tconst chan = this.#store.getters['channels/current'];\n\t\tif (chan?.backend.senderCode === 'bitrix24')\n\t\t{\n\t\t\tstate.notificationTemplate = this.#store.state.application.notificationTemplate;\n\t\t}\n\t\telse if (chan?.isTemplatesBased)\n\t\t{\n\t\t\t// clone mutable data to avoid external mutations\n\t\t\tstate.template = Runtime.clone(this.#store.getters['templates/current']);\n\t\t}\n\n\t\treturn state;\n\t}\n}\n","import { Receiver } from 'crm.messagesender';\nimport { Skeleton } from 'crm.messagesender.editor.skeleton';\nimport { type FilledPlaceholder } from 'crm.template.editor';\nimport type { JsonObject } from 'main.core';\nimport { ajax as Ajax, Dom, Loc, Runtime, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport type { VueCreateAppResult } from 'ui.vue3';\nimport { BitrixVue } from 'ui.vue3';\nimport { Builder, BuilderDatabaseType, type Store } from 'ui.vue3.vuex';\nimport { MessageEditor } from './components/message-editor';\nimport { AnalyticsModel } from './model/analytics-model';\nimport { ApplicationModel } from './model/application-model';\nimport { ChannelsModel } from './model/channels-model';\nimport { MessageModel } from './model/message-model';\nimport { PreferencesModel } from './model/preferences-model';\nimport { type Template, TemplatesModel } from './model/templates-model';\nimport { ServiceLocator } from './service/service-locator';\nimport { StateExporter } from './state-exporter';\n\nexport type EditorOptions = {\n\trenderTo: HTMLElement | string,\n\tscene: Scene,\n\tcontext: {\n\t\tentityTypeId: ?number,\n\t\tentityId: ?number,\n\t\tcategoryId: ?number,\n\t\tuserId: ?number,\n\t},\n\tchannels?: Channel[],\n\tpromoBanners?: PromoBanner[],\n\tdynamicLoad?: boolean,\n\tcontentProviders: {[key: string]: ContentProvider},\n\tnotificationTemplate?: NotificationTemplate,\n\tlayout: Layout,\n\tpreferences: Preferences,\n\tanalytics: {\n\t\tc_section: ?string,\n\t\tc_sub_section: ?string,\n\t},\n\tmessage: {\n\t\ttext: ?string,\n\t}\n};\n\nexport type Scene = { id: string };\n\nexport type Channel = {\n\tid: string,\n\tbackend: Backend,\n\ttype: string,\n\tappearance: Appearance,\n\tfromList: From[],\n\ttoList: Receiver[],\n\tisConnected: boolean,\n\tconnectionUrl: string,\n\tisPromo: boolean,\n\tisTemplatesBased: boolean,\n};\n\nexport type Backend = { senderCode: string, id: string };\n\nexport type Appearance = {\n\ticon: Icon,\n\ttitle: string,\n\tsubtitle: string | null,\n\tdescription?: string | null,\n};\n\nexport type Icon = {\n\ttitle: string,\n\tcolor: string,\n\tbackground: string,\n}\n\nexport type From = {\n\tid: string,\n\tname: string,\n\tdescription?: string | null,\n\tisDefault: boolean,\n\tisAvailable: boolean,\n\ttype?: string | null,\n};\n\nexport type PromoBanner = {\n\tid: string,\n\ttitle: string,\n\tsubtitle: string,\n\tbackground: string,\n\ticon: ?Icon,\n\tcustomIconName: ?string,\n\tconnectionUrl: string,\n}\n\nexport type ContentProvider = {\n\tisShown: boolean,\n\tisLocked: boolean,\n\tisEnabled: boolean,\n};\n\nexport type NotificationTemplate = {\n\tcode: string,\n\ttranslation?: {\n\t\tLANGUAGE_ID: string,\n\t\tTITLE: string,\n\t\tTEXT: string,\n\t\tTEXT_SMS: string,\n\t},\n\tplaceholders: {name: string, value?: string, caption?: string}[],\n\tsigned: string,\n};\n\nexport type Layout = {\n\tisHeaderShown: boolean,\n\tisFooterShown: boolean,\n\tisSendButtonShown: boolean,\n\tisCancelButtonShown: boolean,\n\tisMessagePreviewShown: boolean,\n\tisContentProvidersShown: boolean,\n\tisEmojiButtonShown: boolean,\n\tisMessageTextReadOnly: boolean,\n\tpadding: string,\n\tpaddingTop: ?string,\n\tpaddingBottom: ?string,\n\tpaddingLeft: ?string,\n\tpaddingRight: ?string,\n};\n\nexport type Preferences = {\n\tchannelsSort: ChannelPosition[],\n};\n\nexport type ChannelPosition = {\n\tchannelId: string,\n\tisHidden: boolean,\n};\n\nexport type State = {\n\tchannel: ?Channel,\n\tfrom: ?From,\n\tto: ?Receiver,\n\tnotificationTemplate?: NotificationTemplate,\n\ttemplate?: Template,\n\tmessage: {\n\t\tbody: string,\n\t}\n};\n\n// to avoid skeleton flickering for fast loads\nconst SKELETON_SHOW_DELAY = 200;\n\n/**\n * @memberOf BX.Crm.MessageSender\n *\n * @emits BX.Crm.MessageSender.Editor:onBeforeReload\n * @emits BX.Crm.MessageSender.Editor:onSendSuccess\n * @emits BX.Crm.MessageSender.Editor:onCancel\n * @emits BX.Crm.MessageSender.Editor:onChannelChange\n * @emits BX.Crm.MessageSender.Editor:onFromChange\n * @emits BX.Crm.MessageSender.Editor:onToChange\n * @emits BX.Crm.MessageSender.Editor:onMessageBodyChange\n * @emits BX.Crm.MessageSender.Editor:onTemplateChange\n * @emits BX.Crm.MessageSender.Editor:onStateChange\n */\nexport class Editor extends EventEmitter\n{\n\t#options: EditorOptions;\n\t#skeleton: ?Skeleton = null;\n\t#locator: ?ServiceLocator = null;\n\t#store: ?Store = null;\n\t#app: ?VueCreateAppResult = null;\n\t#rootComponent: ?Object = null;\n\t#stateExporter: ?StateExporter = null;\n\n\tconstructor(options: EditorOptions)\n\t{\n\t\tsuper();\n\n\t\tthis.setEventNamespace('BX.Crm.MessageSender.Editor');\n\n\t\tthis.#options = options;\n\t\tthis.#normalizeOptions(this.#options);\n\t}\n\n\t#normalizeOptions(options: EditorOptions): void\n\t{\n\t\tif (!Type.isArray(options.channels))\n\t\t{\n\t\t\t// eslint-disable-next-line no-param-reassign\n\t\t\toptions.channels = [];\n\t\t}\n\n\t\tfor (const channel of options.channels)\n\t\t{\n\t\t\tif (!Type.isArray(channel.toList))\n\t\t\t{\n\t\t\t\tchannel.toList = [];\n\t\t\t}\n\n\t\t\tchannel.toList = channel.toList.map((to: JsonObject | Receiver) => {\n\t\t\t\tif (Type.isPlainObject(to))\n\t\t\t\t{\n\t\t\t\t\treturn Receiver.fromJSON(to);\n\t\t\t\t}\n\n\t\t\t\treturn to;\n\t\t\t});\n\t\t}\n\t}\n\n\t#mergeOptions(newOptions: EditorOptions, oldOptions: EditorOptions): EditorOptions\n\t{\n\t\tconst overrideKeys = new Set([\n\t\t\t'channels',\n\t\t\t'promoBanners',\n\t\t\t'dynamicLoad',\n\t\t\t'contentProviders',\n\t\t\t'preferences',\n\t\t]);\n\n\t\t// shared references ok, but don't modify the original\n\t\tconst result = { ...oldOptions };\n\n\t\tfor (const [key, value] of Object.entries(newOptions))\n\t\t{\n\t\t\tif (overrideKeys.has(key))\n\t\t\t{\n\t\t\t\tresult[key] = value;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tgetOptions(): EditorOptions\n\t{\n\t\treturn this.#options;\n\t}\n\n\t/**\n\t * Export current editor state.\n\t */\n\tgetState(): ?State\n\t{\n\t\treturn this.#stateExporter?.getState() ?? null;\n\t}\n\n\t/**\n\t * WARNING! Don't modify the element, don't style.\n\t * You can only use it for popup binding.\n\t *\n\t * Returns null if not rendered.\n\t */\n\tgetContainer(): ?HTMLElement\n\t{\n\t\treturn this.#rootComponent?.$el ?? null;\n\t}\n\n\t/**\n\t * WARNING! Don't modify the element, don't style.\n\t * You can only use it for popup binding.\n\t *\n\t * Returns null if not rendered.\n\t */\n\tgetContentContainer(): ?HTMLElement\n\t{\n\t\treturn this.getContainer()?.querySelector('[data-role=\"content-container\"]') ?? null;\n\t}\n\n\tsetChannel(id: string): this\n\t{\n\t\tvoid this.#store?.dispatch('channels/setChannel', {\n\t\t\tchannelId: id,\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tsetFrom(id: string): this\n\t{\n\t\tvoid this.#store?.dispatch('channels/setFrom', {\n\t\t\tfromId: id,\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tsetTo(addressId: number): this\n\t{\n\t\tvoid this.#store?.dispatch('channels/setReceiver', {\n\t\t\treceiverAddressId: addressId,\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tsetMessageText(text: string): this\n\t{\n\t\tvoid this.#store?.dispatch('message/setText', {\n\t\t\ttext,\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tsetTemplate(templateOriginalId: number): this\n\t{\n\t\tvoid this.#store?.dispatch('templates/setTemplate', {\n\t\t\ttemplateOriginalId,\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tsetFilledPlaceholder(filledPlaceholder: FilledPlaceholder): this\n\t{\n\t\tvoid this.#store?.dispatch('templates/setFilledPlaceholder', {\n\t\t\tfilledPlaceholder,\n\t\t});\n\n\t\treturn this;\n\t}\n\n\tsetError(error: string): this\n\t{\n\t\tvoid this.#store?.dispatch('application/setAlert', { error });\n\n\t\treturn this;\n\t}\n\n\tresetAlert(): this\n\t{\n\t\tvoid this.#store?.dispatch('application/resetAlert');\n\n\t\treturn this;\n\t}\n\n\tasync render(): Promise<void>\n\t{\n\t\tconst target = Type.isElementNode(this.#options.renderTo)\n\t\t\t? this.#options.renderTo\n\t\t\t: document.querySelector(this.#options.renderTo)\n\t\t;\n\t\tif (Type.isNil(target))\n\t\t{\n\t\t\tthrow new TypeError(`Render container \"${this.#options.renderTo}\" not found`);\n\t\t}\n\n\t\tconst skeletonTimeoutId = setTimeout(() => {\n\t\t\tDom.clean(target);\n\n\t\t\tthis.#skeleton ??= new Skeleton({ layout: this.#options.layout });\n\t\t\tthis.#skeleton.renderTo(target);\n\t\t}, SKELETON_SHOW_DELAY);\n\n\t\tawait this.#load();\n\n\t\tthis.#locator = new ServiceLocator();\n\n\t\tconst locator = this.#locator;\n\t\tthis.#app = BitrixVue.createApp({\n\t\t\tname: 'CrmMessageSenderEditor',\n\t\t\tcomponents: {\n\t\t\t\tMessageEditor,\n\t\t\t},\n\t\t\tbeforeCreate(): void\n\t\t\t{\n\t\t\t\tthis.$bitrix.Data.set('locator', locator);\n\t\t\t},\n\t\t\ttemplate: '<MessageEditor/>',\n\t\t});\n\n\t\tconst { store, models: { messageModel } } = await this.#buildStore();\n\n\t\tthis.#store = store;\n\n\t\tthis.#locator.setStore(store);\n\t\tthis.#locator.setMessageModel(messageModel);\n\n\t\tthis.#app.use(store);\n\n\t\tclearTimeout(skeletonTimeoutId);\n\t\tDom.clean(target);\n\t\tthis.#rootComponent = this.#app.mount(target);\n\n\t\tthis.#locator.setEventEmitter(this.#rootComponent.$Bitrix.eventEmitter);\n\t\tthis.#stateExporter = new StateExporter({ store, eventEmitter: this });\n\n\t\tthis.#bindEvents();\n\n\t\tthis.#locator.getAnalyticsService().onRender();\n\t}\n\n\tasync #buildStore(): Promise<{store: Store, models: {messageModel: MessageModel}}>\n\t{\n\t\tconst messageModel = MessageModel.create()\n\t\t\t.useDatabase(false)\n\t\t\t.setLogger(this.#locator.getLogger())\n\t\t\t.setVariables({\n\t\t\t\ttext: this.#options.message.text,\n\t\t\t})\n\t\t;\n\n\t\tconst { store } = await Builder\n\t\t\t.init()\n\t\t\t.addModel(\n\t\t\t\tApplicationModel.create()\n\t\t\t\t\t.useDatabase(false)\n\t\t\t\t\t.setLogger(this.#locator.getLogger())\n\t\t\t\t\t.setVariables({\n\t\t\t\t\t\tcontext: this.#options.context,\n\t\t\t\t\t\tcontentProviders: this.#options.contentProviders,\n\t\t\t\t\t\tnotificationTemplate: this.#options.notificationTemplate,\n\t\t\t\t\t\tpromoBanners: this.#options.promoBanners,\n\t\t\t\t\t\tlayout: this.#options.layout,\n\t\t\t\t\t\tscene: this.#options.scene,\n\t\t\t\t\t}),\n\t\t\t).addModel(\n\t\t\t\tChannelsModel.create()\n\t\t\t\t\t.useDatabase(false)\n\t\t\t\t\t.setLogger(this.#locator.getLogger())\n\t\t\t\t\t.setVariables({\n\t\t\t\t\t\tcollection: this.#options.channels,\n\t\t\t\t\t}),\n\t\t\t)\n\t\t\t.addModel(\n\t\t\t\tmessageModel,\n\t\t\t)\n\t\t\t.addModel(\n\t\t\t\tTemplatesModel.create()\n\t\t\t\t\t.useDatabase(true) // cache for faster render, actualize on template load\n\t\t\t\t\t.setLogger(this.#locator.getLogger())\n\t\t\t\t,\n\t\t\t)\n\t\t\t.addModel(\n\t\t\t\tPreferencesModel.create()\n\t\t\t\t\t.useDatabase(false)\n\t\t\t\t\t.setLogger(this.#locator.getLogger())\n\t\t\t\t\t.setVariables({\n\t\t\t\t\t\tchannelsSort: this.#options.preferences?.channelsSort,\n\t\t\t\t\t}),\n\t\t\t)\n\t\t\t.addModel(\n\t\t\t\tAnalyticsModel.create()\n\t\t\t\t\t.useDatabase(false)\n\t\t\t\t\t.setLogger(this.#locator.getLogger())\n\t\t\t\t\t.setVariables({\n\t\t\t\t\t\tanalytics: this.#options.analytics,\n\t\t\t\t\t}),\n\t\t\t)\n\t\t\t.setDatabaseConfig({\n\t\t\t\tname: 'crm-messagesender-editor',\n\t\t\t\ttype: BuilderDatabaseType.indexedDb,\n\t\t\t\tsiteId: Loc.getMessage('SITE_ID'),\n\t\t\t\tuserId: Loc.getMessage('USER_ID'),\n\t\t\t})\n\t\t\t.build()\n\t\t;\n\n\t\treturn { store, models: { messageModel } };\n\t}\n\n\t#load(): Promise<void>\n\t{\n\t\tif (!this.#options.dynamicLoad)\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\treturn this.#actualizeOptions()\n\t\t\t.then(() => {\n\t\t\t\tthis.#options.dynamicLoad = false;\n\t\t\t});\n\t}\n\n\t/**\n\t * Actualize editor options from the server.\n\t * Editor state is not lost.\n\t */\n\treload(): Promise<void>\n\t{\n\t\tconst event = new BaseEvent();\n\t\tthis.emit('onBeforeReload', event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tvoid this.#store?.dispatch('application/setProgress', { isLoading: true });\n\n\t\treturn this.#actualizeOptions()\n\t\t\t.then(() => {\n\t\t\t\tvoid this.#store?.dispatch('application/actualizeState', {\n\t\t\t\t\tcontext: this.#options.context,\n\t\t\t\t\tcontentProviders: this.#options.contentProviders,\n\t\t\t\t\tnotificationTemplate: this.#options.notificationTemplate,\n\t\t\t\t\tpromoBanners: this.#options.promoBanners,\n\t\t\t\t\tlayout: this.#options.layout,\n\t\t\t\t\tscene: this.#options.scene,\n\t\t\t\t});\n\t\t\t\tvoid this.#store?.dispatch('channels/actualizeState', {\n\t\t\t\t\tcollection: this.#options.channels,\n\t\t\t\t});\n\t\t\t\tvoid this.#store?.dispatch('preferences/actualizeState', {\n\t\t\t\t\tchannelsSort: this.#options.preferences?.channelsSort,\n\t\t\t\t});\n\t\t\t}).finally(() => {\n\t\t\t\tvoid this.#store?.dispatch('application/setProgress', { isLoading: false });\n\t\t\t});\n\t}\n\n\t#actualizeOptions(): Promise<void>\n\t{\n\t\treturn this.#loadOptions()\n\t\t\t.then((options) => {\n\t\t\t\tthis.#options = this.#mergeOptions(options, this.#options);\n\t\t\t});\n\t}\n\n\t#loadOptions(): Promise<EditorOptions>\n\t{\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tAjax.runAction('crm.messagesender.editor.load', {\n\t\t\t\tjson: {\n\t\t\t\t\tsceneId: this.#options.scene?.id,\n\t\t\t\t\tentityTypeId: this.#options.context.entityTypeId,\n\t\t\t\t\tentityId: this.#options.context.entityId,\n\t\t\t\t\tcategoryId: this.#options.context.categoryId,\n\t\t\t\t},\n\t\t\t}).then((response) => {\n\t\t\t\tconst options = response.data.editor;\n\n\t\t\t\tthis.#normalizeOptions(options);\n\n\t\t\t\tresolve(options);\n\t\t\t}).catch(reject);\n\t\t});\n\t}\n\n\t#bindEvents(): void\n\t{\n\t\tthis.#rootComponent.$Bitrix.eventEmitter.subscribe(\n\t\t\t'crm:messagesender:editor:onConnectionsSliderClose',\n\t\t\tthis.reload.bind(this),\n\t\t);\n\t\tthis.#rootComponent.$Bitrix.eventEmitter.subscribe(\n\t\t\t'crm:messagesender:editor:onPromoBannerSliderClose',\n\t\t\tthis.reload.bind(this),\n\t\t);\n\t\tthis.#rootComponent.$Bitrix.eventEmitter.subscribe(\n\t\t\t'crm:messagesender:editor:onSendSuccess',\n\t\t\t() => {\n\t\t\t\tthis.emit('onSendSuccess');\n\t\t\t},\n\t\t);\n\t\tthis.#rootComponent.$Bitrix.eventEmitter.subscribe(\n\t\t\t'crm:messagesender:editor:onCancel',\n\t\t\t() => {\n\t\t\t\tthis.emit('onCancel');\n\t\t\t},\n\t\t);\n\t}\n\n\tdestroy(): void\n\t{\n\t\tthis.#app?.unmount();\n\t\tthis.#app = null;\n\n\t\tthis.#rootComponent.$Bitrix.eventEmitter.unsubscribeAll();\n\t\tthis.#rootComponent = null;\n\n\t\tthis.#stateExporter?.destroy();\n\t\tthis.#stateExporter = null;\n\n\t\tthis.unsubscribeAll();\n\n\t\tthis.#store = null;\n\t\tthis.#locator = null;\n\n\t\tRuntime.destroy(this);\n\t}\n}\n"],"names":["LengthCounter","name","components","BText","computed","mapState","message","state","text","messageLengthCounter","colorStart","isOverflow","colorEnd","Loc","getMessage","Text","toInteger","length","recommendedMaxMessageLength","Extension","getSettings","get","template","ContentBody","props","bgColor","type","String","default","borderColor","padding","ContentFooter","MessagePreview","placeholdersPreviewer","mapGetters","isProgress","messageBody","currentChannel","context","application","beforeUnmount","destroy","methods","togglePreviewer","trim","Previewer","bindElement","$refs","preview","$el","isDisplayFormat","isTemplatesBased","isShown","close","$Bitrix","Data","getAnalyticsService","onPreviewShow","MAX_TEXTAREA_HEIGHT","CustomMessageContent","BButton","BMenu","BitrixVue","defineAsyncComponent","Popup","Smiles","setup","AirButtonStyle","Outline","placeholdersDialog","data","isAddMenuShown","isSmilesShown","textAreaHeight","contentProviders","layout","$store","set","dispatch","isShowActionsButton","isContentProvidersShown","menuItems","isShowCopilot","copilot","menuOptions","actions","sections","code","items","files","item","title","icon","ATTACH","isLocked","isEnabled","subMenu","onClick","getFileService","uploadNewFile","processFileResult","pickFromDisk","showLimitSlider","sliderCode","push","salescenter","MONEY","getSalescenterService","showSalescenterDisabledSlider","getLogger","warn","result","openApplication","processSalescenterResult","documents","FILE","document","getDocumentService","selectOrCreateDocument","Type","isNil","processDocumentResult","crmValues","sectionCode","PROMPT_VAR","openPlaceholdersDialog","isMessageTextReadOnly","undefined","watch","$nextTick","height","Math","min","textarea","scrollHeight","file","source","insertText","externalLink","onAddFile","publicUrl","onAddDocument","isStringFilled","isPlainObject","page","url","onAddSalescenterPage","payment","paymentId","shipmentId","onAddSalescenterPayment","compilation","isArray","productIds","compilationProductIds","onAddSalescenterCompilation","Dialog","targetNode","multiple","showAvatars","dropdownMode","compactView","enableSearch","entities","id","dynamicLoad","dynamicSearch","searchable","options","events","event","selectedItem","getData","getCustomData","onAddCrmValue","deselect","show","showCopilot","getCopilotService","textReplace","onAddCopilot","textBelow","FeaturePromotersRegistry","Runtime","loadExtension","getPromoter","error","toggleSmiles","start","selectionStart","end","selectionEnd","messageStart","slice","messageEnd","paddedText","endsWith","startsWith","position","focus","ContentContainer","NotificationMessageContent","directives","hint","editor","notificationTemplate","translation","TITLE","placeholders","previewPlaceholders","map","placeholder","makeTranslationPlaceholderName","filledPlaceholders","PLACEHOLDER_ID","FIELD_VALUE","value","caption","hasNotFilledPlaceholders","some","mounted","Editor","target","body","canUsePreview","isReadOnly","setPlaceholders","PREVIEW","setFilledPlaceholders","setBody","TEXT","placeholderName","TemplateMessageContent","isMessagePreviewShown","templateTitle","templateBody","replaceAll","ensureTemplatesLoaded","adjustEditor","created","canUseFieldsDialog","canUseFieldValueInput","onSelect","params","createOrUpdatePlaceholder","filledPlaceholder","FIELD_NAME","PARENT_TITLE","parentTitle","getTemplateService","loadTemplates","clone","PLACEHOLDERS","FILLED_PLACEHOLDERS","EditorAlert","alertInstance","isAlertRendered","alert","isAlertShown","newAlert","oldAlert","hide","Alert","color","AlertColor","DANGER","AlertIcon","animated","setText","encode","renderTo","ENTITY_ID","EditorFooter","Button","BIcon","dialog","channel","from","receiver","isReadyToSend","isSending","progress","fromText","isSelectable","fromList","dialogItems","entityId","subtitle","description","selected","tabs","toggleDialog","width","hideOnSelect","autoHide","cacheable","fromId","onDestroy","send","getSendService","sendMessage","catch","response","getAlertService","showError","errors","cancel","onCancel","getMessageModel","clearState","eventEmitter","emit","ChannelSelector","Chip","selector","itemsSort","allChannels","channels","collection","promoBanners","selectorItems","appearance","onclick","channelId","onSelectChannel","destroySelector","toggleSelector","Selector","banners","analytics","onSave","isSortChanged","onSaveChannelsSort","getPreferencesService","saveChannelsSort","onConnectionsSliderClose","onAddChannelClick","onPromoBannerSliderClose","bannerId","connectStatus","onBannerConnectClick","newSort","every","index","ReceiverSelector","ChipDesign","hasReceivers","isArrayFilled","toList","chipText","addressSourceData","address","valueFormatted","valueTypeCaption","avatar","addressSource","entityTypeName","toLowerCase","receiverAddressId","TemplateSelector","templates","current","ORIGINAL_ID","avatarOptions","dialogFooter","Tag","render","showFeedbackForm","footer","templateOriginalId","onSelectTemplate","onSuggestTemplate","Form","open","forms","zones","lang","sec","EditorHeader","hasChannels","isTemplatesSelectorShown","Boolean","openConnectionsSlider","Router","Instance","openMessageSenderConnectionsSlider","onNoChannelsButtonClick","MessageEditor","contentComponent","backend","senderCode","paddingStyle","paddingTop","paddingBottom","paddingLeft","paddingRight","AnalyticsModel","BuilderModel","getName","setLogger","logger","getState","c_section","getVariable","c_sub_section","makeFrozenClone","deepFreeze","isObject","Object","values","forEach","freeze","ApplicationModel","isHeaderShown","isFooterShown","isSendButtonShown","isCancelButtonShown","isEmojiButtonShown","scene","isLoading","getGetters","getActions","actualizeState","store","payload","commit","setProgress","allowedKeys","Set","filteredPayload","key","keys","has","entries","isBoolean","setAlert","isString","resetAlert","getMutations","updateProgress","ChannelsModel","canSendMessage","chan","isConnected","getters","rootState","rootGetters","find","firstId","setChannel","ch","setFrom","fc","setReceiver","isInteger","rc","updateSelected","MessageModel","setSource","setPaymentId","setShipmentId","setCompilationProductIds","replace","getPlainText","PreferencesModel","channelsSort","channelsSortOrDefault","savedSort","x","unshift","isHidden","firstVisibleChannelId","sort","visible","filter","setChannelsSort","normalized","POSITION","MAX_COLLECTION_SIZE","TemplatesModel","listForChannel","cacheContextId","list","parts","entityTypeId","categoryId","part","join","addTemplates","contextId","saveState","setTemplate","setFilledPlaceholder","isPlaceholderExists","includes","clearCollection","select","upsertFilledPlaceholder","t","fp","AlertService","constructor","AnalyticsService","onRender","Builder","Communication","ViewEvent","setSection","setSubSection","sendData","buildData","Dictionary","ELEMENT_MENU_BUTTON","ELEMENT_BANNER_BUTTON","ELEMENT_NO_CONNECTION_BUTTON","ELEMENT_PREVIEW","ELEMENT_TEMPLATE_SELECTOR","ELEMENT_TEMPLATE_OFFER","ELEMENT_CHANNEL_SELECTOR","ELEMENT_CHANNEL_LIST_CHANGE","ELEMENT_ELEMENT_ADD","CopilotEvent","onSend","SendEvent","createDefault","setTemplateId","CancelEvent","element","Channel","ConnectEvent","setElement","setChannelId","setConnectStatus","addedElement","InteractionEvent","setAddedElement","CopilotService","selectedText","allText","Promise","resolve","reject","then","handlers","handler","bind","subscribeOnce","setSelectedText","setContext","exports","CopilotEvents","Copilot","moduleId","category","mode","CopilotMode","showResultInCopilot","START_INIT","FINISH_INIT","FAILED_INIT","init","TEXT_SAVE","unsubscribeAllHandlers","TEXT_PLACE_BELOW","HIDE","unsubscribe","DocumentService","menu","getTitle","createDocument","Menu","provider","analyticsLabelPrefix","getDocumentPublicUrl","object","Document","Template","FileService","onSuccess","click","uploader","createElement","assignBrowse","openDiskFileDialog","dialogId","linkLoadsCount","Uploader","controller","UploaderEvent","FILE_ADD_START","FILE_ERROR","FILE_COMPLETE","link","finally","isFunction","getUploadingFileCount","getPendingFileCount","getFiles","fileId","Ajax","runAction","analyticsLabel","Error","Logger","prefix","args","console","OPTIONS_CATEGORY","OPTIONS_NAME","PreferencesService","BX","userOptions","save","JSON","stringify","preferences","SalescenterService","ToolAvailabilityManager","openSalescenterToolDisabledSlider","Manager","disableSendButton","ownerTypeId","ownerId","st","tool","order","SendService","messageModel","analyticsService","signedTemplate","signed","ID","isTemplateWithPlaceholders","isReplacePlaceholders","isPlaceholdersInDisplayFormat","senderId","to","TemplateService","Cache","MemoryCache","entityCategoryId","entityType","placeholderId","fieldName","fieldValue","templateId","callback","remember","ServiceLocator","setStore","setMessageModel","setEventEmitter","emitter","StateExporter","unwatch","newValue","oldValue","oldChannel","oldFrom","oldTo","isEqualTo","lastNewValue","lastOldValue","throttledWatcher","throttle","oldBody","oldTemplate","debounce","eventName","eventData","SKELETON_SHOW_DELAY","EventEmitter","setEventNamespace","getOptions","getContainer","getContentContainer","querySelector","setTo","addressId","setMessageText","setError","isElementNode","TypeError","skeletonTimeoutId","setTimeout","Dom","clean","Skeleton","locator","createApp","beforeCreate","$bitrix","models","use","clearTimeout","mount","reload","BaseEvent","isDefaultPrevented","unmount","unsubscribeAll","Receiver","fromJSON","newOptions","oldOptions","overrideKeys","create","useDatabase","setVariables","addModel","setDatabaseConfig","BuilderDatabaseType","indexedDb","siteId","userId","build","json","sceneId","subscribe"],"mappings":"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"}