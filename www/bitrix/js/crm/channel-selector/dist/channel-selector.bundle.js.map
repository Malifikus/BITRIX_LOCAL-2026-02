{"version":3,"file":"channel-selector.bundle.js","sources":["../src/channel-selector.js"],"sourcesContent":["import { Router } from 'crm.router';\nimport { Dom, Loc, Reflection, Tag, Text, Type } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Loader } from 'main.loader';\nimport { Menu, MenuItem, MenuManager } from 'main.popup';\nimport 'ui.icons.service';\nimport { AirButtonStyle, Button, ButtonSize, ButtonIcon } from 'ui.buttons';\nimport { Icon, Outline } from 'ui.icon-set.api.core';\nimport { Menu as MenuConfigurable } from 'ui.menu-configurable';\nimport 'ui.notification';\n\nconst CrmActivityEditor = Reflection.namespace('BX.CrmActivityEditor');\nconst UserOptions = Reflection.namespace('BX.userOptions');\nconst NotificationCenter = Reflection.namespace('BX.UI.Notification.Center');\n\nconst CHANNEL_TYPE_PHONE = 'PHONE';\nconst CHANNEL_TYPE_EMAIL = 'EMAIL';\nconst CHANNEL_TYPE_IM = 'IM';\n\nconst MAX_VISIBLE_ITEMS = 4;\nconst MARKET_LINK = 'category/crm_robot_sms/';\n\nconst LINK_IN_MESSAGE_PLACEHOLDER = '#LINK#';\n\nexport type ChannelSelectorParameters = {\n\tid: ?string,\n\ttitle: ?string,\n\tdocumentTitle: ?string,\n\tbody: ?string,\n\tfullBody?: string,\n\tentityTypeId: number,\n\tentityId: number,\n\tchannels: Array<ChannelData>,\n\tcommunications: Object<string, CommunicationData>,\n\tlink: ?string,\n\tisLinkObtainable: boolean,\n\tfiles: Array<number>,\n\tstorageTypeId: ?number,\n\tactivityEditorId: ?string,\n\tsmsUrl: ?string,\n\tisCombineMessageWithLink?: boolean,\n\tisInsertLinkInMessage?: boolean,\n\thasVisibleChannels: boolean,\n\tchannelIcons: Array<string>,\n\tcontactCenterUrl: ?string,\n\tmessageSenderSceneId?: string,\n\tanalytics: Object,\n};\n\nexport type ChannelData = {\n\tid: string,\n\ttitle: string,\n\ttype: string,\n\tisAvailable: boolean,\n\tisHidden: ?boolean,\n\ticon: ?string,\n\tsignedTemplate?: string,\n\tcategoryTitle?: string,\n\tstatus?: string,\n}\n\nexport type CommunicationData = {\n\tENTITY_ID: string,\n\tELEMENT_ID: number,\n\tTYPE_ID: string,\n\tVALUE: string,\n};\n\nconst items = new Map();\n\n/**\n * @memberof BX.Crm.ChannelSelector\n */\nexport class List extends EventEmitter\n{\n\tlayout: {\n\t\tcontainer: HTMLElement,\n\t\tlist: HTMLElement,\n\t\ttitle: HTMLElement,\n\t\tsettings: HTMLElement,\n\t\tfooter: HTMLElement,\n\t\tlink: ?HTMLElement,\n\t\tchannels: Object<string,HTMLElement>,\n\t};\n\n\ttitle: string;\n\tdocumentTitle: string;\n\tbody: string;\n\tfullBody: string;\n\t#link: string;\n\tisLinkObtainable: boolean;\n\tentityTypeId: number;\n\tentityId: number;\n\tchannels: Array<ChannelData>;\n\tfiles: Array<number>;\n\tstorageTypeId: number;\n\tactivityEditorId: string;\n\tsmsUrl: string;\n\tisCombineMessageWithLink: boolean = true;\n\t#isInsertLinkInMessage: boolean = false;\n\tcommunications: Object<string, CommunicationData>;\n\t#loader: ?Loader;\n\t#getLinkPromise: ?Promise;\n\t#menu: Menu;\n\t#menuConfigurable: MenuConfigurable;\n\t#analytics: Object;\n\n\tconstructor(parameters: ChannelSelectorParameters)\n\t{\n\t\tsuper();\n\t\tthis.title = Type.isStringFilled(parameters.title) ? parameters.title : Loc.getMessage('CRM_CHANNEL_SELECTOR_DEFAULT_TITLE_MSGVER_1');\n\t\tthis.documentTitle = String(parameters.documentTitle);\n\t\tthis.body = String(parameters.body);\n\t\tthis.fullBody = String(parameters.fullBody);\n\t\tthis.#link = String(parameters.link);\n\t\tthis.isLinkObtainable = Text.toBoolean(parameters.isLinkObtainable);\n\t\tthis.entityTypeId = Text.toInteger(parameters.entityTypeId);\n\t\tthis.entityId = Text.toInteger(parameters.entityId);\n\t\tthis.id = Type.isStringFilled(parameters.id) ? parameters.id : this.entityTypeId + '_' + this.entityId + '_' + Math.random().toString().substring(2)\n\t\tthis.storageTypeId = Text.toInteger(parameters.storageTypeId);\n\t\tthis.files = Type.isArray(parameters.files) ? parameters.files : [];\n\t\tthis.activityEditorId = String(parameters.activityEditorId);\n\t\tthis.smsUrl = String(parameters.smsUrl);\n\t\tthis.isCombineMessageWithLink = Type.isBoolean(parameters.isCombineMessageWithLink) ? parameters.isCombineMessageWithLink : true;\n\t\tthis.#isInsertLinkInMessage = Type.isBoolean(parameters.isInsertLinkInMessage) ? parameters.isInsertLinkInMessage : false;\n\t\tthis.setChannels(parameters.channels);\n\t\tthis.communications = Type.isPlainObject(parameters.communications) ? parameters.communications : {};\n\t\tthis.hasVisibleChannels = Text.toBoolean(parameters.hasVisibleChannels);\n\t\tthis.channelIcons = Type.isArray(parameters.channelIcons) ? parameters.channelIcons : [];\n\t\tthis.contactCenterUrl = Type.isStringFilled(parameters.contactCenterUrl) ? parameters.contactCenterUrl : '/contact_center/';\n\t\tthis.layout = {\n\t\t\tchannels: {},\n\t\t};\n\t\tthis.messageSenderSceneId = String(parameters.messageSenderSceneId);\n\t\tthis.#analytics = parameters.analytics;\n\t\tthis.setEventNamespace('BX.Crm.ChannelSelector.List');\n\n\t\tif (items.size === 0)\n\t\t{\n\t\t\titems.set('default', this);\n\t\t}\n\t\titems.set(this.id, this);\n\t}\n\n\tsetChannels(channels: Array<ChannelData>)\n\t{\n\t\tthis.channels = [];\n\t\tif (Type.isArray(channels))\n\t\t{\n\t\t\tchannels.forEach((channel: ChannelData) => {\n\t\t\t\tthis.channels.push(channel);\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n\n\trender(): HTMLElement\n\t{\n\t\tif (this.layout.container)\n\t\t{\n\t\t\treturn this.layout.container;\n\t\t}\n\t\tthis.layout.title = Tag.render`<div class=\"crm__channel-selector--title\">${Text.encode(this.title)}</div>`;\n\t\tif (this.#link || this.isLinkObtainable)\n\t\t{\n\t\t\tthis.layout.link = Tag.render`<input type=\"text\" class=\"crm__channel-selector--footer-link-hidden\" value=\"${Text.encode(this.#link)}\" />`\n\t\t\tconst copyLinkButton = (new Button({\n\t\t\t\tsize: ButtonSize.LARGE,\n\t\t\t\tstyle: AirButtonStyle.OUTLINE,\n\t\t\t\tuseAirDesign: true,\n\t\t\t\ticon: ButtonIcon.COPY,\n\t\t\t\twide: true,\n\t\t\t\ttext: Loc.getMessage('CRM_CHANNEL_FOOTER_TITLE'),\n\t\t\t\tonclick: () => this.#handleFooterClick(),\n\t\t\t})).getContainer();\n\n\t\t\tthis.layout.footer = Tag.render`\n\t\t\t\t<div class=\"crm__channel-selector--footer\">\n\t\t\t\t\t${copyLinkButton}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.footer = null;\n\t\t}\n\n\t\tthis.layout.settings = null;\n\t\tif (this.hasVisibleChannels)\n\t\t{\n\t\t\tconst icon = (new Icon({\n\t\t\t\ticon: Outline.SETTINGS,\n\t\t\t\tsize: 19,\n\t\t\t})).render();\n\n\t\t\tthis.layout.settings = Tag.render`<div class=\"crm__channel-selector--setting-btn\" onclick=\"${this.#handleSettingsClick.bind(this)}\">${icon}</div>`;\n\t\t\tthis.layout.list = Tag.render`<div class=\"crm__channel-selector--list\"></div>`;\n\n\t\t\tthis.channels.forEach((channel: ChannelData) => {\n\t\t\t\tconst channelNode = this.renderChannel(channel);\n\t\t\t\tif (channelNode)\n\t\t\t\t{\n\t\t\t\t\tthis.layout.channels[channel.id] = channelNode;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.layout.list = Tag.render`<div class=\"crm__channel-selector--body\">\n\t\t\t<div class=\"crm__channel-selector--networks\">\n\t\t\t\t<div class=\"crm__channel-selector--networks-title\">${Loc.getMessage('CRM_CHANNEL_SELECTOR_NO_ACTIVE_CHANNELS_TEXT')}</div>\n\t\t\t\t<div class=\"crm__channel-selector--networks-block\">\n\t\t\t\t\t${this.channelIcons.map(icon => Tag.render`<span class=\"crm__channel-selector--network-link --${icon}\" onclick=\"${this.#openContactCenter.bind(this)}\"></span>`)}\n\t\t\t\t\t<span class=\"crm__channel-selector--network-link --link\" onclick=\"${this.#openContactCenter.bind(this)}\">+ 15</span>\n\t\t\t\t</div>\n\t\t\t\t<span class=\"ui-btn ui-btn-xs ui-btn-primary ui-btn-no-caps ui-btn-round\" onclick=\"${this.#openContactCenter.bind(this)};\">${Loc.getMessage('CRM_CHANNEL_SELECTOR_ACTIVATE_CHANNELS')}</span>\n\t\t\t</div>\n\t\t</div>`\n\t\t}\n\n\t\tthis.layout.container = Tag.render`<div class=\"crm__channel-selector--container\">\n\t\t\t<div class=\"crm__channel-selector--header\">\n\t\t\t\t${this.layout.title}\n\t\t\t\t${this.layout.settings}\n\t\t\t</div>\n\t\t\t${this.layout.list}\n\t\t</div>`;\n\n\t\tif (this.layout.footer)\n\t\t{\n\t\t\tthis.layout.container.appendChild(this.layout.footer);\n\t\t}\n\n\t\tthis.adjustAppearance();\n\n\t\treturn this.layout.container;\n\t}\n\n\trenderChannel(channel: ChannelData): HTMLElement\n\t{\n\t\tconst channelHandler = (() => {\n\t\t\tthis.#handleChannelClick(channel);\n\t\t});\n\t\tconst chevronIcon = (new Icon({\n\t\t\ticon: Outline.CHEVRON_RIGHT_M,\n\t\t\tsize: 24,\n\t\t\tcolor: 'var(--crm-channel-selector-chevron-color)',\n\t\t})).render();\n\n\t\tconst icon = List.getChannelIcon(channel);\n\n\t\treturn Tag.render`<div \n\t\t\tclass=\"crm__channel-selector--channel\"\n\t\t\tonclick=\"${channelHandler}\"\n\t\t>\n\t\t\t${(icon ? Tag.render`<div class=\"crm__channel-selector--channel-icon ${icon}\"></div>` : '')}\n\t\t\t<div class=\"crm__channel-selector--channel-content\">\n\t\t\t\t${this.renderChannelMainTitle(channel)}\n\t\t\t\t${this.renderChannelTitle(channel)}\n\t\t\t</div>\n\t\t\t<div class=\"crm__channel-selector--channel-helper\">${chevronIcon}</div>\n\t\t</div>`;\n\t}\n\n\trenderChannelMainTitle(channel: ChannelData): HTMLElement\n\t{\n\t\treturn Tag.render`<div class=\"crm__channel-selector--channel-main-title\">\n\t\t\t${Text.encode(channel.categoryTitle ?? channel.title)}\n\t\t</div>`;\n\t}\n\n\trenderChannelTitle(channel: ChannelData): ?HTMLElement\n\t{\n\t\tconst text = channel.categoryTitle ? channel.title : channel.status;\n\n\t\tif (!text)\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div \n\t\t\t\tclass=\"crm__channel-selector--channel-title\" \n\t\t\t\tstyle=\"${channel.type === 'IM' && channel.isAvailable ? 'color: var(--ui-color-accent-main-primary);' : ''}\"\n\t\t\t>\n\t\t\t\t${Text.encode(text)}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tadjustAppearance(): void\n\t{\n\t\tif (this.hasVisibleChannels)\n\t\t{\n\t\t\tDom.clean(this.layout.list);\n\t\t\tlet allChannelsAreHidden = true;\n\t\t\tthis.channels.forEach((channel: ChannelData) =>\n\t\t\t{\n\t\t\t\tconst node = this.layout.channels[channel.id];\n\t\t\t\tif (node)\n\t\t\t\t{\n\t\t\t\t\tthis.layout.list.append(node);\n\t\t\t\t\tif (this.#isChannelAvailable(channel))\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.removeClass(node, 'crm__channel-selector--channel-disabled');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(node, 'crm__channel-selector--channel-disabled');\n\t\t\t\t\t}\n\t\t\t\t\tif (channel.isHidden)\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.addClass(node, 'crm__channel-selector--channel-hidden');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tDom.removeClass(node, 'crm__channel-selector--channel-hidden');\n\t\t\t\t\t\tallChannelsAreHidden = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (allChannelsAreHidden)\n\t\t\t{\n\t\t\t\tDom.addClass(this.layout.list, '--empty');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(this.layout.list, '--empty');\n\t\t\t}\n\t\t}\n\t}\n\n\t#getChannelById(id: string): ?ChannelData\n\t{\n\t\treturn this.channels.find(channel => channel.id === id);\n\t}\n\n\t#isChannelAvailable(channel: ChannelData): boolean\n\t{\n\t\tif (!channel.isAvailable)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tconst hasLink = this.isLinkObtainable || Boolean(this.#link);\n\t\tconst hasFiles = CrmActivityEditor && this.storageTypeId > 0 && this.files.length > 0;\n\t\tif (channel.type === CHANNEL_TYPE_PHONE || channel.type === CHANNEL_TYPE_IM)\n\t\t{\n\t\t\treturn hasLink;\n\t\t}\n\t\tif (channel.type === CHANNEL_TYPE_EMAIL)\n\t\t{\n\t\t\treturn hasLink || hasFiles;\n\t\t}\n\t\tif (\n\t\t\tchannel.type === CHANNEL_TYPE_EMAIL\n\t\t\t&& !CrmActivityEditor?.items[this.activityEditorId]\n\t\t)\n\t\t{\n\t\t\tconsole.log('Email channel is disabled because the CrmActivityEditor instance is not found');\n\t\t\treturn false;\n\t\t}\n\n\t\treturn channel.isAvailable;\n\t}\n\n\t#getLink(): Promise<string>\n\t{\n\t\tif (this.#link)\n\t\t{\n\t\t\treturn Promise.resolve(this.#link);\n\t\t}\n\t\tif (!this.isLinkObtainable)\n\t\t{\n\t\t\treturn Promise.reject();\n\t\t}\n\t\tif (this.#getLinkPromise)\n\t\t{\n\t\t\treturn this.#getLinkPromise;\n\t\t}\n\t\tthis.#getLinkPromise = new Promise((resolve, reject) => {\n\t\t\tthis.#showLoader();\n\t\t\tthis.emitAsync('getLink').then((result: Array) => {\n\t\t\t\tresult.forEach((link) => {\n\t\t\t\t\tthis.setLink(link);\n\t\t\t\t});\n\t\t\t\tif (!this.#link)\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(this.#link);\n\t\t\t\t}\n\t\t\t}).catch(reject)\n\t\t\t.finally(() => {\n\t\t\t\tthis.#getLinkPromise = null;\n\t\t\t\tthis.#hideLoader();\n\t\t\t});\n\t\t});\n\n\t\treturn this.#getLinkPromise;\n\t}\n\n\t#getSignedTemplate(channel): Promise<string>\n\t{\n\t\tif (channel.signedTemplate)\n\t\t{\n\t\t\treturn Promise.resolve(channel.signedTemplate);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.#showLoader();\n\t\t\tthis.emitAsync('getSignedTemplate').then((result) => {\n\t\t\t\tconst signedParams = result[0]\n\n\t\t\t\tif (!signedParams)\n\t\t\t\t{\n\t\t\t\t\treject();\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tresolve(signedParams);\n\t\t\t\t}\n\t\t\t}).catch(reject)\n\t\t\t.finally(() => {\n\t\t\t\tthis.#hideLoader();\n\t\t\t});\n\t\t});\n\t}\n\n\t#handleFooterClick(): void\n\t{\n\t\tthis.#getLink().then((link) => {\n\t\t\tif (BX.clipboard.isCopySupported() && this.#link)\n\t\t\t{\n\t\t\t\tBX.clipboard.copy(link);\n\t\t\t}\n\n\t\t\tthis.#showNotice(Loc.getMessage('CRM_CHANNEL_PUBLIC_LINK_COPIED_NOTIFICATION_MESSAGE'));\n\t\t}).catch((reason: ?string) => {\n\t\t\tthis.#showGetLinkErrorNotification(this.layout.footer, reason);\n\t\t});\n\t}\n\n\t#handleSettingsClick(): void\n\t{\n\t\tconst event = new BaseEvent();\n\t\tthis.emit('onSettingsClick', event);\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#openMenu();\n\t}\n\n\t#openMenu(): void\n\t{\n\t\tthis.#getMenu().show();\n\t}\n\n\t#getMenuItemsInViewMode(): Array\n\t{\n\t\tconst settingsItems = [];\n\t\tthis.channels.forEach((channel: ChannelData) => {\n\t\t\tif (channel.isHidden)\n\t\t\t{\n\t\t\t\tsettingsItems.push({\n\t\t\t\t\ttext: channel.title,\n\t\t\t\t\tid: channel.id,\n\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\tthis.#handleChannelClick(channel);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tsettingsItems.push({\n\t\t\tdelimiter: true,\n\t\t});\n\t\tsettingsItems.push({\n\t\t\ttext: Loc.getMessage('CRM_CHANNEL_SELECTOR_CHOOSE_FROM_MARKET'),\n\t\t\tid: 'market',\n\t\t\thref: Loc.getMessage('MARKET_BASE_PATH') + MARKET_LINK,\n\t\t\tonclick: (event: PointerEvent, item: MenuItem) => {\n\t\t\t\tconst menu = item.getMenuWindow()?.getRootMenuWindow() || item.getMenuWindow();\n\t\t\t\tmenu?.close();\n\t\t\t},\n\t\t});\n\n\t\tsettingsItems.push({\n\t\t\tdelimiter: true\n\t\t});\n\t\tsettingsItems.push({\n\t\t\ttext: Loc.getMessage('CRM_COMMON_ACTION_CONFIG'),\n\t\t\tid: 'configure',\n\t\t\tonclick: this.#switchMenuToEditMode.bind(this),\n\t\t});\n\n\t\treturn settingsItems;\n\t}\n\n\t#getMenu(): Menu\n\t{\n\t\tif (!this.#menu)\n\t\t{\n\t\t\tthis.#menu = MenuManager.create({\n\t\t\t\tid: this.id + '-settings-popup',\n\t\t\t\tbindElement: this.layout.settings,\n\t\t\t\titems: this.#getMenuItemsInViewMode(),\n\t\t\t});\n\t\t}\n\n\t\treturn this.#menu;\n\t}\n\n\t#switchMenuToEditMode(): void\n\t{\n\t\tthis.#getMenu().close();\n\t\tthis.#getMenuConfigurable().open().then((result) => {\n\t\t\tif (result.isCanceled)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (Type.isArray(result.items))\n\t\t\t{\n\t\t\t\tthis.#saveSettings(result.items);\n\t\t\t\tthis.#openMenu();\n\t\t\t}\n\t\t});\n\t}\n\n\t#saveSettings(items: Array<{id: string, isHidden: boolean}>): void\n\t{\n\t\tconst channels = [];\n\t\titems.forEach((item) => {\n\t\t\tconst channel = this.#getChannelById(item.id);\n\t\t\tif (channel)\n\t\t\t{\n\t\t\t\tchannel.isHidden = item.isHidden;\n\t\t\t\tchannels.push(channel);\n\t\t\t}\n\t\t});\n\t\tthis.setChannels(channels);\n\t\tthis.adjustAppearance();\n\t\tthis.#menu.destroy();\n\t\tthis.#menu = null;\n\n\t\tUserOptions.save(\"crm\", \"channel-selector\", \"items\", JSON.stringify(items));\n\t}\n\n\t#switchMenuToViewMode(): void\n\t{\n\t\tthis.#menuConfigurable?.close();\n\t\tthis.#getMenu().show();\n\t}\n\n\t#getMenuItemsInEditMode(): Array\n\t{\n\t\tconst items = [];\n\t\tthis.channels.forEach((channel: ChannelData) => {\n\t\t\titems.push({\n\t\t\t\ttext: channel.title,\n\t\t\t\tid: channel.id,\n\t\t\t\tisHidden: channel.isHidden,\n\t\t\t});\n\t\t});\n\n\t\treturn items;\n\t}\n\n\t#getMenuConfigurable(): MenuConfigurable\n\t{\n\t\tconst items = this.#getMenuItemsInEditMode();\n\t\tif (!this.#menuConfigurable)\n\t\t{\n\t\t\tthis.#menuConfigurable = new MenuConfigurable({\n\t\t\t\titems,\n\t\t\t\tbindElement: this.layout.settings,\n\t\t\t\tmaxVisibleItems: MAX_VISIBLE_ITEMS,\n\t\t\t});\n\t\t\tthis.#menuConfigurable.subscribe('Cancel', () => {\n\t\t\t\tthis.#openMenu();\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.#menuConfigurable.setItems(items);\n\t\t}\n\n\t\treturn this.#menuConfigurable;\n\t}\n\n\t#showGetLinkErrorNotification(bindElement: HTMLElement, text: ?string)\n\t{\n\t\tif (!Type.isStringFilled(text))\n\t\t{\n\t\t\ttext = Loc.getMessage('CRM_CHANNEL_PUBLIC_LINK_NOT_AVAILABLE_NOTIFICATION_MESSAGE');\n\t\t}\n\n\t\tthis.#showNotice(text);\n\t}\n\n\t#showNotice(content: string)\n\t{\n\t\tif (NotificationCenter)\n\t\t{\n\t\t\tNotificationCenter.notify({\n\t\t\t\tcontent,\n\t\t\t});\n\t\t}\n\t};\n\n\t#handleChannelClick(channel: ChannelData): void\n\t{\n\t\tconst event = new BaseEvent();\n\t\tevent.setData({channel, communications: this.communications[channel.type]});\n\t\tthis.emit('onChannelClick', event);\n\n\t\tif (event.isDefaultPrevented())\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.#isChannelAvailable(channel))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (channel.type === CHANNEL_TYPE_EMAIL)\n\t\t{\n\t\t\tthis.sendEmail(channel);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (channel.type === CHANNEL_TYPE_PHONE)\n\t\t{\n\t\t\tthis.sendSms(channel);\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (channel.type === CHANNEL_TYPE_IM)\n\t\t{\n\t\t\tthis.openMessenger(channel);\n\t\t}\n\t}\n\n\tsetFiles(files: number[]): this\n\t{\n\t\tthis.files = Type.isArray(files) ? files : [];\n\n\t\tthis.adjustAppearance();\n\n\t\treturn this;\n\t}\n\n\tsetLink(link: string): this\n\t{\n\t\tthis.#link = link ?? null;\n\n\t\tthis.adjustAppearance();\n\n\t\treturn this;\n\t}\n\n\tsendEmail(channel: ChannelData): void\n\t{\n\t\tif (this.files.length <= 0 || Number(this.storageTypeId) <= 0)\n\t\t{\n\t\t\tconst channelNode = this.layout.channels[channel.id];\n\t\t\tthis.#getLink().then((link) => {\n\t\t\t\tCrmActivityEditor?.items[this.activityEditorId]?.addEmail({\n\t\t\t\t\tsubject: this.documentTitle,\n\t\t\t\t\tbody: Loc.getMessage('CRM_CHANNEL_SELECTOR_MESSAGE_WITH_LINK', {\n\t\t\t\t\t\t'#MESSAGE#': this.documentTitle,\n\t\t\t\t\t\t'#LINK#': link,\n\t\t\t\t\t}),\n\t\t\t\t});\n\t\t\t}).catch((reason) => {\n\t\t\t\tthis.#showGetLinkErrorNotification(channelNode, reason);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tCrmActivityEditor?.items[this.activityEditorId]?.addEmail({\n\t\t\t\tsubject: this.documentTitle,\n\t\t\t\tdiskfiles: this.files,\n\t\t\t\tstorageTypeID: this.storageTypeId,\n\t\t\t});\n\t\t}\n\t}\n\n\tsendSms(channel: ChannelData): void\n\t{\n\t\tconst channelNode = this.layout.channels[channel.id];\n\t\tif (!this.smsUrl)\n\t\t{\n\t\t\tthis.#showGetLinkErrorNotification(channelNode, 'No sms url');\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#getLink().then((link) => {\n\t\t\tconst requestParams = {\n\t\t\t\tentityTypeId: this.entityTypeId,\n\t\t\t\tentityId: this.entityId,\n\t\t\t\ttext: this.#getSmsText(channel, link),\n\t\t\t\tproviderId: channel.id,\n\t\t\t\tisProviderFixed: 'N',\n\t\t\t\tcanUseBitrix24Provider: 'Y',\n\t\t\t\tmessageSenderSceneId: this.messageSenderSceneId,\n\t\t\t\tanalytics: this.#analytics,\n\t\t\t};\n\n\t\t\tthis.#getSignedTemplate(channel).then((signedTemplate) => {\n\t\t\t\tif (signedTemplate)\n\t\t\t\t{\n\t\t\t\t\trequestParams.signedTemplate = signedTemplate;\n\t\t\t\t\trequestParams.isEditable = 'N';\n\t\t\t\t}\n\t\t\t}).catch().finally(() => {\n\t\t\t\tRouter.openSlider(this.smsUrl, {\n\t\t\t\t\twidth: 900,\n\t\t\t\t\trequestMethod: 'post',\n\t\t\t\t\trequestParams,\n\t\t\t\t});\n\t\t\t});\n\t\t}).catch((reason) => {\n\t\t\tthis.#showGetLinkErrorNotification(channelNode, reason);\n\t\t});\n\t}\n\n\t#getSmsText(channel: ChannelData, link: string): string\n\t{\n\t\tconst message = (channel.id === 'bitrix24' && this.fullBody) ? this.fullBody : this.body;\n\t\tif (this.isCombineMessageWithLink)\n\t\t{\n\t\t\treturn Loc.getMessage('CRM_CHANNEL_SELECTOR_MESSAGE_WITH_LINK', {\n\t\t\t\t'#MESSAGE#': message,\n\t\t\t\t'#LINK#': link,\n\t\t\t});\n\t\t}\n\n\t\tif (this.#isInsertLinkInMessage)\n\t\t{\n\t\t\treturn message.replace(LINK_IN_MESSAGE_PLACEHOLDER, link);\n\t\t}\n\n\t\treturn message;\n\t}\n\n\topenMessenger(channel: ChannelData): void\n\t{\n\t\tif (!top.BXIM)\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\tif (!this.communications[channel.type])\n\t\t{\n\t\t\treturn;\n\t\t}\n\t\ttop.BXIM.openMessenger(this.communications[channel.type].VALUE, {RECENT: \"N\", MENU: \"N\"});\n\t}\n\n\t#openContactCenter(): void\n\t{\n\t\tRouter.openSlider(this.contactCenterUrl).then(() => {\n\t\t\tlocation.reload();\n\t\t});\n\t}\n\n\tgetId(): string\n\t{\n\t\treturn this.id;\n\t}\n\n\tstatic getDefault(): ?List\n\t{\n\t\treturn items.get('default');\n\t}\n\n\tstatic getById(id: string): ?List\n\t{\n\t\treturn items.get(id);\n\t}\n\n\t#showLoader(): void\n\t{\n\t\tconst loader = this.#getLoader();\n\t\tif (loader)\n\t\t{\n\t\t\tloader.show(this.layout.container);\n\t\t}\n\t}\n\n\t#hideLoader(): void\n\t{\n\t\tconst loader = this.#getLoader();\n\t\tif (loader)\n\t\t{\n\t\t\tloader.hide();\n\t\t}\n\t}\n\n\t#getLoader(): ?Loader\n\t{\n\t\tif(!this.#loader && Loader)\n\t\t{\n\t\t\tthis.#loader = new Loader({size: 100, offset: {left: \"35%\", top: \"-25%\"}});\n\t\t}\n\n\t\treturn this.#loader;\n\t}\n\n\tstatic getChannelIcon(channel: ChannelData): ?string\n\t{\n\t\treturn (channel.icon || List.getIconByChannelId(channel.id));\n\t}\n\n\tstatic getIconByChannelId(id: string): ?string\n\t{\n\t\tif (id === 'bitrix24')\n\t\t{\n\t\t\treturn '--service-bitrix24';\n\t\t}\n\n\t\tif (id === CHANNEL_TYPE_EMAIL)\n\t\t{\n\t\t\treturn '--service-email';\n\t\t}\n\n\t\tif (id === CHANNEL_TYPE_IM)\n\t\t{\n\t\t\treturn '--service-livechat';\n\t\t}\n\n\t\tif (id === 'twilio')\n\t\t{\n\t\t\treturn '--service-whatsapp';\n\t\t}\n\n\t\tif (id === 'ednaru' || id === 'ednaruimhpx')\n\t\t{\n\t\t\treturn '--service-edna';\n\t\t}\n\n\t\treturn '--service-sms';\n\t}\n}\n"],"names":["CrmActivityEditor","Reflection","namespace","UserOptions","NotificationCenter","CHANNEL_TYPE_PHONE","CHANNEL_TYPE_EMAIL","CHANNEL_TYPE_IM","MAX_VISIBLE_ITEMS","MARKET_LINK","LINK_IN_MESSAGE_PLACEHOLDER","items","Map","List","EventEmitter","constructor","parameters","isCombineMessageWithLink","title","Type","isStringFilled","Loc","getMessage","documentTitle","String","body","fullBody","link","isLinkObtainable","Text","toBoolean","entityTypeId","toInteger","entityId","id","Math","random","toString","substring","storageTypeId","files","isArray","activityEditorId","smsUrl","isBoolean","isInsertLinkInMessage","setChannels","channels","communications","isPlainObject","hasVisibleChannels","channelIcons","contactCenterUrl","layout","messageSenderSceneId","analytics","setEventNamespace","size","set","forEach","channel","push","render","container","Tag","encode","copyLinkButton","Button","ButtonSize","LARGE","style","AirButtonStyle","OUTLINE","useAirDesign","icon","ButtonIcon","COPY","wide","text","onclick","getContainer","footer","settings","Icon","Outline","SETTINGS","bind","list","channelNode","renderChannel","map","appendChild","adjustAppearance","channelHandler","chevronIcon","CHEVRON_RIGHT_M","color","getChannelIcon","renderChannelMainTitle","renderChannelTitle","categoryTitle","status","type","isAvailable","Dom","clean","allChannelsAreHidden","node","append","removeClass","addClass","isHidden","setFiles","setLink","sendEmail","length","Number","then","addEmail","subject","catch","reason","diskfiles","storageTypeID","sendSms","requestParams","providerId","isProviderFixed","canUseBitrix24Provider","signedTemplate","isEditable","finally","Router","openSlider","width","requestMethod","openMessenger","top","BXIM","VALUE","RECENT","MENU","getId","getDefault","get","getById","getIconByChannelId","find","hasLink","Boolean","hasFiles","console","log","Promise","resolve","reject","emitAsync","result","signedParams","BX","clipboard","isCopySupported","copy","event","BaseEvent","emit","isDefaultPrevented","show","settingsItems","delimiter","href","item","menu","getMenuWindow","getRootMenuWindow","close","MenuManager","create","bindElement","open","isCanceled","destroy","save","JSON","stringify","MenuConfigurable","maxVisibleItems","subscribe","setItems","content","notify","setData","message","replace","location","reload","loader","hide","Loader","offset","left"],"mappings":"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"}