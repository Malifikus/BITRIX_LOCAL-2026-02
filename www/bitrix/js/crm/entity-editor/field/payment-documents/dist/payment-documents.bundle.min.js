this.BX=this.BX||{};(function(t,e,n,i,a,r,s,o,l){"use strict";function _(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_(Object(n),!0).forEach((function(e){babelHelpers.defineProperty(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var E=function(){function t(){babelHelpers.classCallCheck(this,t)}babelHelpers.createClass(t,null,[{key:"openRealizationDetailDocument",value:function e(n){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var a=t.getRealizationDocumentDetailUrl(n,i);var r=i.hasOwnProperty("sliderOptions")?i.sliderOptions:{};return new Promise((function(e,n){t.openSlider(a.toString(),r).then((function(t){e(t.getData())}))["catch"]((function(t){}))}))}},{key:"openNewRealizationDocument",value:function e(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i={};if(n.hasOwnProperty("sliderOptions")){i=n.sliderOptions;delete n.sliderOptions}var a=t.getNewRealizationDocumentUrl(n);return new Promise((function(e,n){t.openSlider(a.toString(),i).then((function(t){e(t.getData())}))["catch"]((function(t){}))}))}},{key:"openSlider",value:function t(e,n){if(!r.Type.isPlainObject(n)){n={}}n=c(c({},{cacheable:false,allowChangeHistory:false,events:{}}),n);return new Promise((function(t){if(r.Type.isString(e)&&e.length>1){n.events.onClose=function(e){t(e.getSlider())};BX.SidePanel.Instance.open(e,n)}else{t()}}))}},{key:"getRealizationDocumentDetailUrl",value:function t(e,n){var i=new r.Uri("/shop/documents/details/sales_order/"+e+"/");if(r.Type.isPlainObject(n)){i.setQueryParams(n)}return i}},{key:"getNewRealizationDocumentUrl",value:function t(e){var n=new r.Uri("/shop/documents/details/sales_order/0/?DOCUMENT_TYPE=W");if(r.Type.isPlainObject(e)){n.setQueryParams(e)}return n}}]);return t}();var T,d,u,m,D,M,p,N,h,y,v;function C(t,e){I(t,e);e.add(t)}function I(t,e){if(e.has(t)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}function g(t,e,n){if(!e.has(t)){throw new TypeError("attempted to get private field on non-instance")}return n}var f=["REALIZATION_ACCESS_DENIED","REALIZATION_CANNOT_DELETE","REALIZATION_ALREADY_DEDUCTED","REALIZATION_NOT_DEDUCTED","REALIZATION_PRODUCT_NOT_FOUND","SHIPMENT_ACCESS_DENIED","PAYMENT_ACCESS_DENIED"];var S=[].concat(f,["DEDUCTION_STORE_ERROR1","SALE_PROVIDER_SHIPMENT_QUANTITY_NOT_ENOUGH","SALE_SHIPMENT_EXIST_SHIPPED","SALE_PAYMENT_DELETE_EXIST_PAID","DDCT_DEDUCTION_QUANTITY_STORE_ERROR","CRM_REALIZATION_NOT_ENOUGH_PRODUCTS","BX_ERROR"]);var O=new WeakSet;var A=function(){function t(e){babelHelpers.classCallCheck(this,t);C(this,O);this._options=e;this._phrases={};if(r.Type.isPlainObject(e.PHRASES)){this._phrases=e.PHRASES}this._isDeliveryAvailable=this._options.IS_DELIVERY_AVAILABLE;this._isTerminalAvailable=this._options.IS_TERMINAL_AVAILABLE;this._parentContext=e.PARENT_CONTEXT;this._callContext=e.CONTEXT;this._rootNode=r.Tag.render(T||(T=babelHelpers.taggedTemplateLiteral(['<div class="','"></div>'])),this.constructor._rootNodeClass);this._menus=[];this._isUsedInventoryManagement=this._options.IS_USED_INVENTORY_MANAGEMENT;this._salesOrderRights=this._options.SALES_ORDERS_RIGHTS;this._isInventoryManagementRestricted=this._options.IS_INVENTORY_MANAGEMENT_RESTRICTED;this._isInventoryManagement1cRestricted=this._options.IS_1C_PLAN_RESTRICTED;this._isWithOrdersMode=this._options.IS_WITH_ORDERS_MODE;this._isInventoryManagementToolEnabled=this._options.IS_INVENTORY_MANAGEMENT_TOOL_ENABLED;this._isOnecMode=this._options.IS_ONEC_MODE;this._isSalescenterToolEnabled=this._options.IS_SALESCENTER_TOOL_ENABLED;this._isTerminalToolEnabled=this._options.IS_TERMINAL_TOOL_ENABLED;this._shouldShowCashboxChecks=this._options.SHOULD_SHOW_CASHBOX_CHECKS;this._subscribeToGlobalEvents()}babelHelpers.createClass(t,[{key:"hasContent",value:function t(){return this._docs().length>0}},{key:"canAddRealization",value:function t(){var e;return this._isUsedInventoryManagement&&!this._isWithOrdersMode&&((e=this._salesOrderRights)===null||e===void 0?void 0:e.modify)}},{key:"setVisible",value:function t(e){var n=this._rootNode.classList.contains("is-hidden");if(e&&n){this._rootNode.classList.remove("is-hidden")}else if(!e&&!n){this._rootNode.classList.add("is-hidden")}}},{key:"render",value:function t(){this._menus.forEach((function(t){return t.destroy()}));this._rootNode.innerHTML="";this._setupCurrencyFormat();this._setEmptyState();this._rootNode.append(r.Tag.render(d||(d=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-widget-content-block-inner-container">\n\t\t\t\t<div class="crm-entity-widget-payment">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),this._renderDetail(),this._renderDocuments(),this._renderAddDocument(),this._renderDelimiter(),this._renderTotalSum()));return this._rootNode}},{key:"setOptions",value:function t(e){this._options=e}},{key:"reloadModel",value:function t(e,n){var i=this;if(!this._options.OWNER_ID){return}var a={data:{ownerTypeId:this._options.OWNER_TYPE_ID,ownerId:this._options.OWNER_ID}};var s=function t(a){i._loading(false);if(a.data){i.setOptions(a.data);i.render();if(e&&r.Type.isFunction(e)){e(a)}i._emitChangeDocumentsEvent()}else{i._showCommonError();if(n&&r.Type.isFunction(n)){n()}}};var o=function t(){i._loading(false);i._showCommonError();if(n&&r.Type.isFunction(n)){n()}};this._loading(true);r.ajax.runAction("crm.api.entity.fetchPaymentDocuments",a).then(s,o)}},{key:"_renderDetail",value:function t(){return r.Tag.render(u||(u=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-widget-payment-detail">\n\t\t\t\t<div class="crm-entity-widget-payment-detail-caption">',"</div>\n\t\t\t\t","\n\t\t\t</div>\n\t\t"])),this._getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TITLE_MSGVER_2"),!this.hasContent()?this._renderEmptyStateDescription():"")}},{key:"_renderEmptyStateDescription",value:function t(){var e=this.canAddRealization()?r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_EMPTYSTATE_DESCRIPTION_WITH_REALIZATION"):r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_EMPTYSTATE_DESCRIPTION");return r.Tag.render(m||(m=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-widget-payment-detail-description">',"</div>\n\t\t"])),e)}},{key:"_renderDelimiter",value:function t(){return r.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['<div class="ui-entity-editor-delimiter"></div>'])))}},{key:"_setEmptyState",value:function t(){var e=this._rootNode.classList.contains("is-empty");if(!this.hasContent()&&!e){this._rootNode.classList.add("is-empty")}else if(this.hasContent()&&e){this._rootNode.classList.remove("is-empty")}}},{key:"_renderDocuments",value:function t(){var e=this;var n=[];this._docs().forEach((function(t){if(t.TYPE==="PAYMENT"||t.TYPE==="TERMINAL_PAYMENT"){n.push(e._renderPaymentDocument(t))}else if(t.TYPE==="SHIPMENT"){n.push(e._renderDeliveryDocument(t))}else if(t.TYPE==="SHIPMENT_DOCUMENT"){n.push(e._renderRealizationDocument(t))}}));return n}},{key:"_renderPaymentDocument",value:function t(i){var a=this;var s=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_DATE_MSGVER_2").replaceAll(/#date#/gi,i.FORMATTED_DATE).replaceAll(/#account_number#/gi,i.ACCOUNT_NUMBER).replaceAll(/#sum#/gi,this._renderMoney(i.SUM));var l={text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_".concat(i.STAGE)),customClass:"crm-entity-widget-payment-label",color:o.LabelColor.LIGHT,fill:true};if(i.STAGE&&i.STAGE==="PAID"){l.color=o.LabelColor.LIGHT_GREEN}else if(i.STAGE&&i.STAGE==="VIEWED_NO_PAID"){l.color=o.LabelColor.LIGHT_BLUE}if(!l.text){l.text=i.PAID==="Y"?r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_PAID"):r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_NOT_PAID")}var _;var c=[];if(this._isDeliveryAvailable&&i.TYPE==="PAYMENT"){c.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHOOSE_DELIVERY"),title:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHOOSE_DELIVERY"),onclick:function t(){return a._chooseDeliverySlider(i.ORDER_ID)}})}var E=this._getRealizationMenuItem(r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CREATE_REALIZATION"),(function(){return a._createRealizationSlider({paymentId:i.ID})}));if(E){c.push(E)}if(i.TYPE==="PAYMENT"){c.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_RESEND"),onclick:function t(){return a._resendPaymentSlider(i.ORDER_ID,i.ID)}})}c.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHANGE_PAYMENT_STATUS"),items:[{text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_PAID"),className:i.PAID==="Y"?"menu-popup-item-accept-sm":"",onclick:function t(){a._setPaymentPaidStatus(i,true);_.close()}},{text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_NOT_PAID"),className:i.PAID==="Y"?"":"menu-popup-item-accept-sm",onclick:function t(){a._setPaymentPaidStatus(i,false);_.close()}}]});if(this._shouldShowCashboxChecks){c.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CASHBOX_CHECKS"),onclick:function t(){return a._openPaymentChecksListSlider(i.ID)}})}c.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE"),className:i.PAID==="Y"?"menu-popup-no-icon crm-entity-widget-payment-menu-item-remove":"",onclick:function t(){if(i.PAID==="Y"){return false}_.close();n.MessageBox.confirm(r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_PAYMENT_CONFIRM_TEXT_MSGVER_2"),(function(t){t.close();a._removeDocument(i)}),r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_PAYMENT_BUTTON_CONFIRM"),(function(t){return t.close()}),r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_PAYMENT_BUTTON_BACK"))}});var T=function t(){if(i.TYPE==="TERMINAL_PAYMENT"){a._viewTerminalPaymentSlider(i.ORDER_ID,i.ID)}else{a._resendPaymentSlider(i.ORDER_ID,i.ID)}};var d=function t(n){n.preventDefault();_=e.MenuManager.create({id:"payment-documents-payment-action-".concat(i.ID),bindElement:n.target,items:c});_.show();var s=_.itemsContainer.querySelector(".crm-entity-widget-payment-menu-item-remove");if(s){s.setAttribute("data-hint",r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_REMOVE_TIP_MSGVER_1"));s.setAttribute("data-hint-no-icon","");BX.UI.Hint.init(_.itemsContainer)}a._menus.push(_)};return r.Tag.render(M||(M=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-widget-payment-detail">\n\t\t\t\t<a class="ui-link" onclick="','">','</a>\n\t\t\t\t<div class="crm-entity-widget-payment-detail-inner">\n\t\t\t\t\t<div class="ui-label ui-label-md ui-label-light crm-entity-widget-payment-action" onclick="','">\n\t\t\t\t\t\t<span class="ui-label-inner">',"</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),T,s,d,r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ACTIONS_MENU"),new o.Label(l).render())}},{key:"_renderDeliveryDocument",value:function t(i){var a=this;var s={text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING_MSGVER_1"),customClass:"crm-entity-widget-payment-label",color:o.LabelColor.LIGHT,fill:true};if(i.DEDUCTED==="Y"){s.text=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED");s.color=o.LabelColor.LIGHT_GREEN}var l=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DELIVERY_DATE_MSGVER_2").replaceAll(/#date#/gi,i.FORMATTED_DATE).replaceAll(/#account_number#/gi,i.ACCOUNT_NUMBER).replaceAll(/#sum#/gi,this._renderMoney(i.SUM)).replaceAll(/#delivery_name#/gi,i.DELIVERY_NAME);var _;var c=[{text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CHANGE_DELIVERY_STATUS"),items:[{text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED"),className:i.DEDUCTED==="Y"?"menu-popup-item-accept-sm":"",onclick:function t(){a._setShipmentShippedStatus(i,true);_.close()}},{text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING_MSGVER_1"),className:i.DEDUCTED==="Y"?"":"menu-popup-item-accept-sm",onclick:function t(){a._setShipmentShippedStatus(i,false);_.close()}}]},{text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE"),className:i.DEDUCTED==="Y"?"menu-popup-no-icon crm-entity-widget-shipment-menu-item-remove":"",onclick:function t(){if(i.DEDUCTED==="Y"){return false}_.close();n.MessageBox.confirm(r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_DELIVERY_CONFIRM_TEXT_MSGVER_2"),(function(t){t.close();a._removeDocument(i)}),r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_DELIVERY_BUTTON_CONFIRM"),(function(t){return t.close()}),r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE_DELIVERY_BUTTON_BACK"))}}];var E=function t(){return a._viewDeliverySlider(i.ORDER_ID,i.ID)};var T=function t(n){n.preventDefault();_=e.MenuManager.create({id:"payment-documents-delivery-action-".concat(i.ID),bindElement:n.target,items:c});_.show();var s=_.itemsContainer.querySelector(".crm-entity-widget-shipment-menu-item-remove");if(s){s.setAttribute("data-hint",r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_REMOVE_TIP_MSGVER_1"));s.setAttribute("data-hint-no-icon","");BX.UI.Hint.init(_.itemsContainer)}a._menus.push(_)};return r.Tag.render(p||(p=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-widget-payment-detail">\n\t\t\t\t<a class="ui-link" onclick="','">\n\t\t\t\t\t','\n\t\t\t\t</a>\n\t\t\t\t<div class="crm-entity-widget-payment-detail-inner">\n\t\t\t\t\t<div class="ui-label ui-label-md ui-label-light crm-entity-widget-payment-action" onclick="','">\n\t\t\t\t\t\t<span class="ui-label-inner">',"</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),E,l,T,r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ACTIONS_MENU"),new o.Label(s).render())}},{key:"_renderRealizationDocument",value:function t(i){var a,s=this;var l={customClass:"crm-entity-widget-payment-label",fill:true};if(i.DEDUCTED==="Y"){l.text=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DEDUCTED");l.color=o.LabelColor.LIGHT_GREEN}else if(i.EMP_DEDUCTED_ID){l.text=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CANCELLED");l.color=o.LabelColor.LIGHT_ORANGE}else{l.text=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DRAFT");l.color=o.LabelColor.LIGHT}var _=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_DATE_MSGVER_2").replaceAll(/#date#/gi,i.FORMATTED_DATE).replaceAll(/#document_id#/gi,i.ACCOUNT_NUMBER);_=BX.util.htmlspecialchars(_);_=_.replaceAll(/#sum#/gi,this._renderMoney(i.SUM));var c;var E=[];if((a=this._salesOrderRights)!==null&&a!==void 0&&a.view){var T,d,u;if(i.DEDUCTED==="Y"&&(T=this._salesOrderRights)!==null&&T!==void 0&&T.conduct&&!this._isOnecMode){var m;if((m=this._salesOrderRights)!==null&&m!==void 0&&m.conduct){E.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CANCEL"),className:i.DEDUCTED==="Y"?"":"menu-popup-item-accept-sm",onclick:function t(){s._setRealizationDeductedStatus(i,false);c.close()}})}}else if(i.DEDUCTED!=="Y"&&(d=this._salesOrderRights)!==null&&d!==void 0&&d.cancel){E.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CONDUCT"),className:i.DEDUCTED==="Y"?"menu-popup-item-accept-sm":"",onclick:function t(){s._setRealizationDeductedStatus(i,true);c.close()}})}if((u=this._salesOrderRights)!==null&&u!==void 0&&u["delete"]&&!(this._isOnecMode&&i.DEDUCTED==="Y")){E.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REMOVE"),className:i.DEDUCTED==="Y"?"menu-popup-no-icon crm-entity-widget-realization-menu-item-remove":"",onclick:function t(){if(i.DEDUCTED==="Y"){return false}c.close();n.MessageBox.confirm(r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_CONFIRM_REMOVE_TEXT_MSGVER_1"),(function(t){t.close();s._removeDocument(i)}),r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_CONFIRM_REMOVE_BUTTON_CONFIRM"),(function(t){return t.close()}),r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_CONFIRM_REMOVE_BUTTON_BACK"))}})}if(this._isOnecMode&&i.DEDUCTED==="Y"){E.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_OPEN"),onclick:function t(){c.close();s._viewRealizationSlider(i.ID)}})}}var D=function t(){return s._viewRealizationSlider(i.ID)};var M=function t(n){n.preventDefault();c=e.MenuManager.create({id:"payment-documents-realization-action-".concat(i.ID),bindElement:n.target,items:E});c.show();var a=c.itemsContainer.querySelector(".crm-entity-widget-realization-menu-item-remove");if(a){a.setAttribute("data-hint",r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_REALIZATION_REMOVE_TIP_MSGVER_1"));a.setAttribute("data-hint-no-icon","");BX.UI.Hint.init(c.itemsContainer)}s._menus.push(c)};var p=E.length>0?r.Tag.render(N||(N=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="ui-label ui-label-md ui-label-light crm-entity-widget-payment-action" onclick="','">\n\t\t\t\t\t<span class="ui-label-inner">',"</span>\n\t\t\t\t</div>\n\t\t\t"])),M,r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ACTIONS_MENU")):"";return r.Tag.render(h||(h=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-widget-payment-detail">\n\t\t\t\t<a class="ui-link" onclick="','">\n\t\t\t\t\t','\n\t\t\t\t</a>\n\t\t\t\t<div class="crm-entity-widget-payment-detail-inner">\n\t\t\t\t\t',"\n\t\t\t\t\t","\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),D,_,p,new o.Label(l).render())}},{key:"_renderAddDocument",value:function t(){var n=this;var i=this._latestOrderId();var a=[{text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_PAYMENT"),onclick:function t(){return n._createPaymentSlider(i)}}];if(this._isDeliveryAvailable){a.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_PAYMENT_DELIVERY"),onclick:function t(){return n._createPaymentDeliverySlider(i)}})}if(this._isTerminalAvailable){a.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_TERMINAL_PAYMENT"),onclick:function t(){return n._createTerminalPaymentSlider(i)}})}if(this._isDeliveryAvailable){a.push({text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_DELIVERY"),onclick:function t(){return n._createDeliverySlider(i)}})}var s=this._getRealizationMenuItem(r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DOCUMENT_TYPE_SHIPMENT_DOCUMENT"),(function(){return n._createRealizationSlider({orderId:i})}));if(s){a.push(s)}var o=function t(i){i.preventDefault();var r=e.MenuManager.create({id:"payment-documents-create-document-action",bindElement:i.target,items:a});r.show();n._menus.push(r)};return r.Tag.render(y||(y=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-widget-payment-add-box">\n\t\t\t\t<a href="#" class="ui-entity-editor-content-add-lnk" onclick="','">\n\t\t\t\t\t',"\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t"])),o,r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_CREATE_DOCUMENT_MSGVER_2"))}},{key:"_getRealizationMenuItem",value:function t(e,n){var a;var s=this._isUsedInventoryManagement&&!this._isWithOrdersMode;if(s&&(a=this._salesOrderRights)!==null&&a!==void 0&&a.modify){var o={text:e};if(this._isOnecMode&&this._isInventoryManagement1cRestricted){o.onclick=function(){i.OneCPlanRestrictionSlider.show()};o.className="realization-document-tariff-lock"}else if(!this._isOnecMode&&this._isInventoryManagementRestricted){o.onclick=function(){return top.BX.UI.InfoHelper.show("limit_store_crm_integration")};o.className="realization-document-tariff-lock"}else if(!this._isInventoryManagementToolEnabled){o.onclick=function(){r.Runtime.loadExtension("catalog.tool-availability-manager").then((function(t){var e=t.ToolAvailabilityManager;e.openInventoryManagementToolDisabledSlider()}))}}else{o.onclick=n}return o}return null}},{key:"_renderTotalSum",value:function t(){var e=this._options.TOTAL_AMOUNT;var n=r.Tag.render(v||(v=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-widget-payment-total">\n\t\t\t\t<span>\n\t\t\t\t\t','\n\t\t\t\t\t<span data-hint="','"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="crm-entity-widget-payment-text">',"</span>\n\t\t\t</div>\n\t\t"])),this._getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM"),this._getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM_TOOLTIP"),this._renderMoney(e));BX.UI.Hint.init(n);return n}},{key:"_renderMoney",value:function t(e){var n=l.CurrencyCore.currencyFormat(e,this._options.CURRENCY_ID,true);var i=l.CurrencyCore.currencyFormat(e,this._options.CURRENCY_ID,false);var a=n.replace(i,"").trim();return n.replace(a,'<span class="crm-entity-widget-payment-currency">'.concat(a,"</span>"))}},{key:"_docs",value:function t(){if(this._options&&this._options.DOCUMENTS&&this._options.DOCUMENTS.length>0){return this._options.DOCUMENTS}return[]}},{key:"_orders",value:function t(){if(this._options&&this._options.ORDERS&&this._options.ORDERS.length>0){return this._options.ORDERS}return[]}},{key:"_context",value:function t(){return this._parentContext}},{key:"_orderIds",value:function t(){if(this._options&&this._options.ORDER_IDS&&this._options.ORDER_IDS.length>0){return this._options.ORDER_IDS.map((function(t){return parseInt(t)}))}return[]}},{key:"_latestOrderId",value:function t(){var e=parseInt(Math.max.apply(Math,babelHelpers.toConsumableArray(this._orderIds())));return e>0?e:0}},{key:"_ownerTypeId",value:function t(){return this._options.OWNER_TYPE_ID||BX.CrmEntityType.enumeration.deal}},{key:"_defaultCreatePaymentDocumentOptions",value:function t(){return{context:this._callContext,templateMode:"create",ownerTypeId:this._ownerTypeId(),ownerId:this._options.OWNER_ID}}},{key:"_generateAnalyticsLabel",value:function t(e){var n="crm#TYPE#PaymentDocuments#MODE#Slider";var i="Deal";if(BX.CrmEntityType.isDynamicTypeByTypeId(this._ownerTypeId())){i="DynamicType"}var a=r.Text.toPascalCase(e);return n.replace("#TYPE#",i).replace("#MODE#",a)}},{key:"_createPaymentSlider",value:function t(e){if(!this._isSalescenterToolEnabled){r.Runtime.loadExtension("salescenter.tool-availability-manager").then((function(t){var e=t.ToolAvailabilityManager;e.openSalescenterToolDisabledSlider()}));return}var n=this._defaultCreatePaymentDocumentOptions();n.mode="payment";n.analyticsLabel=this._generateAnalyticsLabel("create_payment");n.st=g(this,O,R).call(this,"payment");n.orderId=e;this._context().startSalescenterApplication(e,n)}},{key:"_createDeliverySlider",value:function t(e){if(!this._isSalescenterToolEnabled){r.Runtime.loadExtension("salescenter.tool-availability-manager").then((function(t){var e=t.ToolAvailabilityManager;e.openSalescenterToolDisabledSlider()}));return}var n=this._defaultCreatePaymentDocumentOptions();n.mode="delivery";n.analyticsLabel=this._generateAnalyticsLabel("create_delivery");n.orderId=e;this._context().startSalescenterApplication(e,n)}},{key:"_createPaymentDeliverySlider",value:function t(e){if(!this._isSalescenterToolEnabled){r.Runtime.loadExtension("salescenter.tool-availability-manager").then((function(t){var e=t.ToolAvailabilityManager;e.openSalescenterToolDisabledSlider()}));return}var n=this._defaultCreatePaymentDocumentOptions();n.mode="payment_delivery";n.analyticsLabel=this._generateAnalyticsLabel("create_payment_delivery");n.st=g(this,O,R).call(this,"delivery_payment");n.orderId=e;this._context().startSalescenterApplication(e,n)}},{key:"_createRealizationSlider",value:function t(e){var n=this;var i={context:{OWNER_TYPE_ID:this._ownerTypeId(),OWNER_ID:this._options.OWNER_ID,ORDER_ID:e.orderId||0,PAYMENT_ID:e.paymentId||0},analyticsLabel:this._generateAnalyticsLabel("create_realization"),documentType:"W",sliderOptions:{customLeftBoundary:0,loader:"crm-entity-details-loader",requestMethod:"post"}};E.openNewRealizationDocument(i).then((function(t){n.reloadModel();n._reloadOwner()}))}},{key:"_createTerminalPaymentSlider",value:function t(e){if(!this._isTerminalToolEnabled){r.Runtime.loadExtension("ui.info-helper").then((function(){top.BX.UI.InfoHelper.show("limit_crm_terminal_off")}));return}var n=this._defaultCreatePaymentDocumentOptions();n.mode="terminal_payment";n.analyticsLabel=this._generateAnalyticsLabel("create_terminal_payment");n.st=g(this,O,R).call(this,"terminal_payment");n.orderId=e;this._context().startSalescenterApplication(e,n)}},{key:"_chooseDeliverySlider",value:function t(e){var n=this._defaultCreatePaymentDocumentOptions();n.mode="delivery";n.analyticsLabel=this._generateAnalyticsLabel("choose_delivery");n.orderId=e;this._context().startSalescenterApplication(e,n)}},{key:"_openPaymentChecksListSlider",value:function t(e){BX.SidePanel.Instance.open(BX.Uri.addParam("/crm/payment/checks/list.php",{owner_id:e,owner_type:BX.CrmEntityType.enumeration.orderpayment}),{width:1500,allowChangeHistory:false,cacheable:false})}},{key:"_resendPaymentSlider",value:function t(e,n){var i={disableSendButton:"",context:"deal",mode:this._ownerTypeId()===BX.CrmEntityType.enumeration.deal?"payment_delivery":"payment",analyticsLabel:this._generateAnalyticsLabel("resend_payment"),templateMode:"view",ownerTypeId:this._ownerTypeId(),ownerId:this._options.OWNER_ID,orderId:e,paymentId:n};this._context().startSalescenterApplication(e,i)}},{key:"_viewDeliverySlider",value:function t(e,n){var i={context:this._callContext,templateMode:"view",mode:"delivery",analyticsLabel:this._generateAnalyticsLabel("view_delivery"),ownerTypeId:this._ownerTypeId(),ownerId:this._options.OWNER_ID,orderId:e,shipmentId:n};this._context().startSalescenterApplication(e,i)}},{key:"_viewRealizationSlider",value:function t(e){var n=this;var i={ownerTypeId:this._ownerTypeId(),ownerId:this._options.OWNER_ID,analyticsLabel:this._generateAnalyticsLabel("view_realization"),documentId:e,sliderOptions:{customLeftBoundary:0,loader:"crm-entity-details-loader"}};E.openRealizationDetailDocument(e,i).then((function(t){n._reloadOwner()}))}},{key:"_viewTerminalPaymentSlider",value:function t(e,n){var i={context:"deal",mode:"terminal_payment",analyticsLabel:this._generateAnalyticsLabel("view_terminal_payment"),templateMode:"view",ownerTypeId:this._ownerTypeId(),ownerId:this._options.OWNER_ID,orderId:e,paymentId:n};this._context().startSalescenterApplication(e,i)}},{key:"_setPaymentPaidStatus",value:function t(e,n){var i=this;var a=n?"Y":"N";var o=n?"PAID":"CANCEL";if(e.PAID&&e.PAID===a){return}this._docs().forEach((function(t){if(t.TYPE==="PAYMENT"&&t.ID===e.ID){t.PAID=a;t.STAGE=o}}));this.render();var l=function t(e){s.EventEmitter.emit("PaymentDocuments.EntityEditor:changePaymentPaidStatus",{entityTypeId:i._options.OWNER_TYPE_ID,entityId:i._options.OWNER_ID});i._emitChangeDocumentsEvent()};var _=function t(e){i._showErrorOnAction(e);i.reloadModel()};r.ajax.runAction("crm.order.payment.setPaid",{data:{id:e.ID,value:a}}).then(l,_)}},{key:"_setShipmentShippedStatus",value:function t(e,n){var i=this;var a=n?"Y":"N";if(e.DEDUCTED&&e.DEDUCTED===a){return}this._docs().forEach((function(t){if(t.TYPE==="SHIPMENT"&&t.ID===e.ID){t.DEDUCTED=a}}));this.render();var o=function t(e){s.EventEmitter.emit("PaymentDocuments.EntityEditor:changeShipmentShippedStatus",{entityTypeId:i._options.OWNER_TYPE_ID,entityId:i._options.OWNER_ID});i._emitChangeDocumentsEvent()};var l=function t(n){i._showShipmentStatusError(n,e.ID);i.reloadModel()};var _="crm.order.shipment.setShipped";if(this._isUsedInventoryManagement){_="crm.api.realizationdocument.setShipped"}r.ajax.runAction(_,{data:{id:e.ID,value:a}}).then(o,l)}},{key:"_setRealizationDeductedStatus",value:function t(e,n){var i=this;var a=n?"Y":"N";if(e.DEDUCTED&&e.DEDUCTED===a){return}this._docs().forEach((function(t){if(t.TYPE==="SHIPMENT_DOCUMENT"&&t.ID===e.ID){t.DEDUCTED=a}}));this.render();var o=function t(e){s.EventEmitter.emit("PaymentDocuments.EntityEditor:changeRealizationDeductedStatus",{entityTypeId:i._options.OWNER_TYPE_ID,entityId:i._options.OWNER_ID});i._emitChangeDocumentsEvent()};var l=function t(e){i._showErrorOnAction(e);i.reloadModel()};r.ajax.runAction("crm.api.realizationdocument.setShipped",{data:{id:e.ID,value:a}}).then(o,l)}},{key:"_removeDocument",value:function t(e){var n=this;var i;var a={id:e.ID};i=this._resolveRemoveDocumentActionName(e.TYPE);if(!i){return}if(e.TYPE==="SHIPMENT_DOCUMENT"){a.value="N"}this._options.DOCUMENTS=this._options.DOCUMENTS.filter((function(t){return!(t.TYPE===e.TYPE&&t.ID===e.ID)}));this.render();var s=function t(e){n._reloadOwner();n._emitChangeDocumentsEvent()};var o=function t(e){n._showErrorOnAction(e);n.reloadModel()};r.ajax.runAction(i,{data:a}).then(s,o)}},{key:"_resolveRemoveDocumentActionName",value:function t(e){var n="";if(e==="PAYMENT"||e==="TERMINAL_PAYMENT"){n="crm.order.payment.delete"}else if(e==="SHIPMENT"){n="crm.order.shipment.delete"}else if(e==="SHIPMENT_DOCUMENT"){n="crm.api.realizationdocument.setRealization"}return n}},{key:"_showShipmentStatusError",value:function t(e,n){var i=this;var a=true;if(this._isUsedInventoryManagement){e.errors.forEach((function(t){if(S.has(t.code)){a=false;var e=t.message;if(!f.includes(t.code)){e=BX.util.htmlspecialchars(e)}BX.UI.Notification.Center.notify({content:e,width:"auto",actions:[{title:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_OPEN_REALIZATION_DOCUMENT"),events:{click:function t(e,a,r){i._viewRealizationSlider(n);a.close()}}}]})}}))}if(a){this._showCommonError()}}},{key:"_showErrorOnAction",value:function t(e){var n=this;var i=true;e.errors.forEach((function(t){if(S.includes(t.code)){i=false;n._showSpecificError(t.code,t.message)}}));if(i){this._showCommonError()}}},{key:"_showSpecificError",value:function t(e,n){var i=n;if(!f.includes(e)){i=BX.util.htmlspecialchars(i)}BX.UI.Notification.Center.notify({content:i})}},{key:"_showCommonError",value:function t(){BX.UI.Notification.Center.notify({content:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_COMMON_ERROR_MSGVER_1")})}},{key:"_loading",value:function t(e){if(this._rootNode&&this._rootNode.classList){if(e){this._rootNode.classList.add("is-loading")}else{this._rootNode.classList.remove("is-loading")}}}},{key:"_emitChangeDocumentsEvent",value:function t(){s.EventEmitter.emit("PaymentDocuments.EntityEditor:changeDocuments",{entityTypeId:this._options.OWNER_TYPE_ID,entityId:this._options.OWNER_ID})}},{key:"_subscribeToGlobalEvents",value:function t(){var e=this;var n=new Set(["salescenter.app:onshipmentcreated","salescenter.app:onpaymentcreated","salescenter.app:onpaymentresend","salescenter.app:onterminalpaymentcreated"]);var i=500;var a=r.debounce((function(){e.reloadModel()}),i);var o={compatMode:true};var l=false;s.EventEmitter.subscribe("SidePanel.Slider:onMessage",(function(t){var e=t.getEventId();if(n.has(e)){a();l=true;setTimeout((function(){l=false}),2e3)}}),o);s.EventEmitter.subscribe("oncrmentityupdate",(function(){a()}),o);s.EventEmitter.subscribe("onPullEvent-crm",(function(t,n){if(t!=="onOrderSave"||l){return}var i=false;var s=e._orderIds();if(r.Type.isPlainObject(n)&&r.Type.isPlainObject(n.FIELDS)){i=parseInt(n.FIELDS.ID||0,10);if(s.includes(i)){a()}}}),o);s.EventEmitter.subscribe("onPullEvent-salescenter",(function(t,n){if(t!=="onOrderPaymentViewed"){return}var i=false;var r=e._orderIds();if(n&&n.ORDER_ID){i=parseInt(n.ORDER_ID);if(r.includes(i)){a()}}}),o)}},{key:"_setupCurrencyFormat",value:function t(){if(this._options&&this._options.CURRENCY_ID&&this._options.CURRENCY_FORMAT){l.CurrencyCore.setCurrencyFormat(this._options.CURRENCY_ID,this._options.CURRENCY_FORMAT)}}},{key:"_reloadOwner",value:function t(){if(this._parentContext instanceof BX.Crm.EntityEditorMoneyPay){this._parentContext._editor.reload();this._parentContext._editor.tapController("PRODUCT_LIST",(function(t){t.reinitializeProductList()}))}}},{key:"_getMessage",value:function t(e){if(r.Type.isPlainObject(this._phrases)&&r.Type.isString(this._phrases[e])){e=this._phrases[e]}return r.Loc.getMessage(e)}}]);return t}();function R(t){var e={tool:"crm",category:"payments",event:"payment_create_click",c_section:"crm",c_sub_section:"web",type:t};return e}babelHelpers.defineProperty(A,"_rootNodeClass","crm-entity-widget-inner crm-entity-widget-inner--payment");var P,Y,b,U,L,w,k,H,x,B,G,V,X,z;var W=function(t){babelHelpers.inherits(e,t);function e(){babelHelpers.classCallCheck(this,e);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(e).apply(this,arguments))}babelHelpers.createClass(e,[{key:"render",value:function t(){this._menus.forEach((function(t){return t.destroy()}));this._rootNode.innerHTML="";this._setupCurrencyFormat();this._filterSuccessfulDocuments();this._rootNode.classList.remove("is-hidden");if(this._isWithOrdersMode){this._renderDocumentWithOrdersMode()}else{this._renderDocumentWithoutOrdersMode()}var e=this._isCheckExists();if(e){this._rootNode.append(r.Tag.render(P||(P=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t\t<div class="crm-entity-stream-content-document-table-group">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</div>\n\t\t\t\t"])),this._renderChecksDocument()))}s.EventEmitter.emit("PaymentDocuments:render",[this]);return this._rootNode}},{key:"_renderDocumentWithOrdersMode",value:function t(){var e=this;var n=r.Tag.render(Y||(Y=babelHelpers.taggedTemplateLiteral(["<div></div>"])));this._orders().forEach((function(t){var i=e._renderDocumentsByOrder(t.ID);if(i.length>0){n.append(e._renderOrderDetailBlock(t));i.forEach((function(t){n.append(t)}))}}));this._rootNode.append(r.Tag.render(b||(b=babelHelpers.taggedTemplateLiteral(["\n\t\t\t<div>\n\t\t\t\t",'\n\t\t\t\t<div class="crm-entity-stream-content-document-table-group">\n\t\t\t\t\t',"\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-entity-stream-content-document-table-group">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),n,this._renderEntityTotalSum(),this._renderEntityPaidSum(),this._renderTotalSum()))}},{key:"_renderDocumentWithoutOrdersMode",value:function t(){this._rootNode.append(r.Tag.render(U||(U=babelHelpers.taggedTemplateLiteral(["\n\t\t\t<div>\n\t\t\t\t",'\n\t\t\t\t<div class="crm-entity-stream-content-document-table-group">\n\t\t\t\t\t',"\n\t\t\t\t\t",'\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-entity-stream-content-document-table-group">\n\t\t\t\t\t',"\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),this._renderDocuments(),this._renderEntityTotalSum(),this._renderEntityPaidSum(),this._renderTotalSum()))}},{key:"_renderDocumentsByOrder",value:function t(e){var n=this;var i=[];var a=this._docs().filter((function(t){return t.ORDER_ID===e}));a.forEach((function(t){if(t.TYPE==="PAYMENT"){i.push(n._renderPaymentDocument(t))}else if(t.TYPE==="SHIPMENT"){i.push(n._renderDeliveryDocument(t))}else if(t.TYPE==="SHIPMENT_DOCUMENT"){i.push(n._renderRealizationDocument(t))}}));return i}},{key:"_renderEntityTotalSum",value:function t(){var e="CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DEAL_SUM";if(Number(this._options.OWNER_TYPE_ID)===BX.CrmEntityType.enumeration.smartinvoice){e="CRM_ENTITY_ED_PAYMENT_DOCUMENTS_INVOICE_SUM"}return r.Tag.render(L||(L=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-stream-content-detail-table-row crm-entity-stream-content-document-table-row">\n\t\t\t\t<div class="crm-entity-stream-content-detail-description">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-entity-stream-content-detail-cost">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),r.Loc.getMessage(e),this._renderMoney(this._options.ENTITY_AMOUNT))}},{key:"_renderEntityPaidSum",value:function t(){return r.Tag.render(w||(w=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-stream-content-detail-table-row crm-entity-stream-content-document-table-row">\n\t\t\t\t<div class="crm-entity-stream-content-detail-description">\n\t\t\t\t\t','\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-entity-stream-content-detail-cost">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_ENTITY_PAID_SUM"),this._renderMoney(this._options.PAID_AMOUNT))}},{key:"_renderPaymentDocument",value:function t(e){var n=this;var i=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_PAYMENT_DATE_MSGVER_2",{"#DATE#":e.FORMATTED_DATE,"#ACCOUNT_NUMBER#":e.ACCOUNT_NUMBER,"#SUM#":this._renderMoney(e.SUM)});var a={text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_".concat(e.STAGE)),customClass:"crm-entity-widget-payment-label",color:o.LabelColor.LIGHT,fill:true};if(e.STAGE&&e.STAGE==="PAID"){a.color=o.LabelColor.LIGHT_GREEN}else if(e.STAGE&&e.STAGE==="VIEWED_NO_PAID"){a.color=o.LabelColor.LIGHT_BLUE}if(!a.text){a.text=e.PAID==="Y"?r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_PAID"):r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STAGE_NOT_PAID")}var s=function t(){return n._resendPaymentSlider(e.ORDER_ID,e.ID)};return r.Tag.render(k||(k=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-stream-content-detail-table-row">\n\t\t\t\t<div class="crm-entity-stream-content-document-description">\n\t\t\t\t\t<a class="ui-link" onclick="','">','</a>\n\t\t\t\t\t<span class="crm-entity-stream-content-document-description__label">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),s,i,new o.Label(a).render())}},{key:"_renderDeliveryDocument",value:function t(e){var n=this;var i={text:r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_WAITING_MSGVER_1"),customClass:"crm-entity-widget-payment-label",color:o.LabelColor.LIGHT,fill:true};if(e.DEDUCTED==="Y"){i.text=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_STATUS_DELIVERED");i.color=o.LabelColor.LIGHT_GREEN}var a=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_DELIVERY_DATE_MSGVER_2",{"#DATE#":e.FORMATTED_DATE,"#ACCOUNT_NUMBER#":e.ACCOUNT_NUMBER,"#SUM#":this._renderMoney(e.SUM),"#DELIVERY_NAME#":e.DELIVERY_NAME});var s=function t(){return n._viewDeliverySlider(e.ORDER_ID,e.ID)};return r.Tag.render(H||(H=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-stream-content-detail-table-row">\n\t\t\t\t<div class="crm-entity-stream-content-document-description">\n\t\t\t\t\t<a class="ui-link" onclick="','">\n\t\t\t\t\t\t','\n\t\t\t\t\t</a>\n\t\t\t\t\t<span class="crm-entity-stream-content-document-description__label">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),s,a,new o.Label(i).render())}},{key:"_renderRealizationDocument",value:function t(e){var n=this;var i={fill:true,customClass:"crm-entity-widget-payment-label"};if(e.DEDUCTED==="Y"){i.text=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DEDUCTED");i.color=o.LabelColor.LIGHT_GREEN}else{if(e.EMP_DEDUCTED_ID){i.text=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_CANCELLED");i.color=o.LabelColor.LIGHT_ORANGE}else{i.text=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_STATUS_DRAFT");i.color=o.LabelColor.LIGHT}}var a=r.Loc.getMessage("CRM_ENTITY_ED_PAYMENT_DOCUMENTS_SHIPMENT_DOCUMENT_DATE_MSGVER_2",{"#DATE#":e.FORMATTED_DATE,"#DOCUMENT_ID#":e.ACCOUNT_NUMBER});a=BX.util.htmlspecialchars(a);a=a.replaceAll(/#sum#/gi,this._renderMoney(e.SUM));var s=function t(){return n._viewRealizationSlider(e.ID)};return r.Tag.render(x||(x=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-stream-content-detail-table-row">\n\t\t\t\t<div class="crm-entity-stream-content-document-description">\n\t\t\t\t\t<a class="ui-link" onclick="','">\n\t\t\t\t\t\t','\n\t\t\t\t\t</a>\n\t\t\t\t\t<span class="crm-entity-stream-content-document-description__label">\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),s,a,new o.Label(i).render())}},{key:"_renderTotalSum",value:function t(){var e="CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_SUM";if(Number(this._options.OWNER_TYPE_ID)===BX.CrmEntityType.enumeration.smartinvoice){e="CRM_ENTITY_ED_PAYMENT_DOCUMENTS_TOTAL_INVOICE_SUM"}return r.Tag.render(B||(B=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-stream-content-detail-table-row crm-entity-stream-content-detail-table-row-total">\n\t\t\t\t<div class="crm-entity-stream-content-detail-description">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t','\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-entity-stream-content-detail-cost">\n\t\t\t\t\t<span>\n\t\t\t\t\t\t',"\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),r.Loc.getMessage(e),this._renderTotalMoney(this._options.TOTAL_AMOUNT))}},{key:"_renderTotalMoney",value:function t(e){var n=l.CurrencyCore.currencyFormat(e,this._options.CURRENCY_ID,true);var i=l.CurrencyCore.currencyFormat(e,this._options.CURRENCY_ID,false);var a=n.replace(i,"").trim();n=n.replace(a,'<span class="crm-entity-widget-payment-currency">'.concat(a,"</span>"));n=n.replace(i,"<b>".concat(i,"</b>"));return n}},{key:"_renderChecksDocument",value:function t(){var e=this;var n=[];this._docs().forEach((function(t){if(t.TYPE==="CHECK"){n.push(e._renderCheckDocument(t))}}));return n}},{key:"_renderCheckDocument",value:function t(e){var n;if(e.URL){n=r.Tag.render(G||(G=babelHelpers.taggedTemplateLiteral(['<a href="','" target="_blank">',"</a>"])),e.URL,e.TITLE)}else{n=r.Tag.render(V||(V=babelHelpers.taggedTemplateLiteral(["<span>","</span>"])),e.TITLE)}return r.Tag.render(X||(X=babelHelpers.taggedTemplateLiteral(['<div class="crm-entity-stream-content-detail-notice">',"</div>"])),n)}},{key:"_renderOrderDetailBlock",value:function t(e){return r.Tag.render(z||(z=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div class="crm-entity-stream-content-document-table-order-group crm-entity-stream-content-detail-table-row">\n\t\t\t\t<div class="crm-entity-stream-content-detail-description">\n\t\t\t\t\t<span>','</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="crm-entity-stream-content-detail-cost">\n\t\t\t\t\t<span class="crm-entity-stream-content-detail-cost-current">',"</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t"])),e.TITLE,e.PRICE_FORMAT)}},{key:"_filterSuccessfulDocuments",value:function t(){this._options.DOCUMENTS=this._docs().filter((function(t){return t.TYPE==="PAYMENT"&&t.PAID==="Y"||t.TYPE==="SHIPMENT"&&t.DEDUCTED==="Y"||t.TYPE==="SHIPMENT_DOCUMENT"&&t.DEDUCTED==="Y"||t.TYPE==="CHECK"&&t.STATUS==="Y"}))}},{key:"_isCheckExists",value:function t(){var e=this._docs().filter((function(t){return t.TYPE==="CHECK"&&t.STATUS==="Y"}));return e.length>1}}]);return e}(A);babelHelpers.defineProperty(W,"_rootNodeClass","crm-entity-stream-content-detail-table crm-entity-stream-content-documents-table");t.EntityEditorPaymentDocuments=A;t.TimelineSummaryDocuments=W})(this.BX.Crm=this.BX.Crm||{},BX.Main,BX.UI.Dialogs,BX.Catalog,BX,BX,BX.Event,BX.UI,BX.Currency);
//# sourceMappingURL=payment-documents.bundle.map.js