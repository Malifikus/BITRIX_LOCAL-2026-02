this.BX=this.BX||{};this.BX.Crm=this.BX.Crm||{};(function(e,s,t,l,a){"use strict";let i=e=>e,r,o;const b="save";const c="cancel";var n=babelHelpers.classPrivateFieldLooseKey("entityTypeId");var d=babelHelpers.classPrivateFieldLooseKey("entityId");var v=babelHelpers.classPrivateFieldLooseKey("files");var p=babelHelpers.classPrivateFieldLooseKey("ownerTypeId");var u=babelHelpers.classPrivateFieldLooseKey("ownerId");var P=babelHelpers.classPrivateFieldLooseKey("popup");var h=babelHelpers.classPrivateFieldLooseKey("fileUploader");var B=babelHelpers.classPrivateFieldLooseKey("updateFiles");var L=babelHelpers.classPrivateFieldLooseKey("revertButtonsState");var F=babelHelpers.classPrivateFieldLooseKey("closePopup");var H=babelHelpers.classPrivateFieldLooseKey("getPopupContent");var y=babelHelpers.classPrivateFieldLooseKey("getSaveButton");var f=babelHelpers.classPrivateFieldLooseKey("getCancelButton");var I=babelHelpers.classPrivateFieldLooseKey("getPopupTitle");var S=babelHelpers.classPrivateFieldLooseKey("getPopupButtons");var g=babelHelpers.classPrivateFieldLooseKey("changeUploaderContainerSize");class w{constructor(e){Object.defineProperty(this,g,{value:E});Object.defineProperty(this,S,{value:A});Object.defineProperty(this,I,{value:T});Object.defineProperty(this,f,{value:K});Object.defineProperty(this,y,{value:C});Object.defineProperty(this,H,{value:j});Object.defineProperty(this,F,{value:_});Object.defineProperty(this,L,{value:m});Object.defineProperty(this,B,{value:O});Object.defineProperty(this,n,{writable:true,value:null});Object.defineProperty(this,d,{writable:true,value:null});Object.defineProperty(this,v,{writable:true,value:[]});Object.defineProperty(this,p,{writable:true,value:null});Object.defineProperty(this,u,{writable:true,value:null});Object.defineProperty(this,P,{writable:true,value:null});Object.defineProperty(this,h,{writable:true,value:null});babelHelpers.classPrivateFieldLooseBase(this,n)[n]=e.entityTypeId;babelHelpers.classPrivateFieldLooseBase(this,d)[d]=e.entityId;babelHelpers.classPrivateFieldLooseBase(this,v)[v]=t.Type.isArrayFilled(e.files)?e.files:[];babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e.ownerTypeId;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e.ownerId}show(){if(!babelHelpers.classPrivateFieldLooseBase(this,P)[P]){const e=getComputedStyle(document.documentElement);const s=e.getPropertyValue("--ui-space-inset-sm");const t=parseFloat(s)||12;const a=e.getPropertyValue("--ui-color-base-solid")||"#000000";babelHelpers.classPrivateFieldLooseBase(this,P)[P]=new l.Popup({className:"crm-activity__file-uploader-popup",closeIcon:true,closeByEsc:true,padding:t,overlay:{opacity:40,backgroundColor:a},cacheable:false,content:babelHelpers.classPrivateFieldLooseBase(this,H)[H](),buttons:babelHelpers.classPrivateFieldLooseBase(this,S)[S](),minWidth:650,width:650,maxHeight:650})}babelHelpers.classPrivateFieldLooseBase(this,P)[P].show()}}function O(){var e,s,l;if(((e=babelHelpers.classPrivateFieldLooseBase(this,y)[y]())==null?void 0:e.getState())===a.ButtonState.DISABLED){return}(s=babelHelpers.classPrivateFieldLooseBase(this,y)[y]())==null?void 0:s.setState(a.ButtonState.WAITING);(l=babelHelpers.classPrivateFieldLooseBase(this,f)[f]())==null?void 0:l.setState(a.ButtonState.DISABLED);t.ajax.runAction("crm.activity.todo.updateFiles",{data:{ownerTypeId:babelHelpers.classPrivateFieldLooseBase(this,p)[p],ownerId:babelHelpers.classPrivateFieldLooseBase(this,u)[u],id:babelHelpers.classPrivateFieldLooseBase(this,d)[d],fileTokens:babelHelpers.classPrivateFieldLooseBase(this,h)[h]?babelHelpers.classPrivateFieldLooseBase(this,h)[h].getServerFileIds():[]}}).then((e=>{babelHelpers.classPrivateFieldLooseBase(this,L)[L]();if(!(e.hasOwnProperty("errors")&&e.errors.length)){babelHelpers.classPrivateFieldLooseBase(this,F)[F]()}})).catch((()=>{babelHelpers.classPrivateFieldLooseBase(this,L)[L]()}))}function m(){var e,s;(e=babelHelpers.classPrivateFieldLooseBase(this,y)[y]())==null?void 0:e.setState(null);(s=babelHelpers.classPrivateFieldLooseBase(this,f)[f]())==null?void 0:s.setState(null)}function _(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:e.close()}function j(){const e=t.Tag.render(r||(r=i`<div></div>`));const l=t.Tag.render(o||(o=i`<div class="crm-activity__file-uploader">
			<div class="crm-activity__file-uploader_title">${0}</div>
			<div class="crm-activity__file-uploader_content">
				${0}
			</div>
		</div>`),babelHelpers.classPrivateFieldLooseBase(this,I)[I](),e);babelHelpers.classPrivateFieldLooseBase(this,h)[h]=new s.FileUploader({events:{"File:onComplete":e=>{babelHelpers.classPrivateFieldLooseBase(this,L)[L]()},"File:onRemove":e=>{babelHelpers.classPrivateFieldLooseBase(this,g)[g]();babelHelpers.classPrivateFieldLooseBase(this,L)[L]()},onUploadStart:e=>{var s,t;babelHelpers.classPrivateFieldLooseBase(this,g)[g]();(s=babelHelpers.classPrivateFieldLooseBase(this,y)[y]())==null?void 0:s.setState(a.ButtonState.DISABLED);(t=babelHelpers.classPrivateFieldLooseBase(this,f)[f]())==null?void 0:t.setState(a.ButtonState.DISABLED)}},ownerId:babelHelpers.classPrivateFieldLooseBase(this,u)[u],ownerTypeId:babelHelpers.classPrivateFieldLooseBase(this,p)[p],activityId:babelHelpers.classPrivateFieldLooseBase(this,d)[d],files:babelHelpers.classPrivateFieldLooseBase(this,v)[v]});babelHelpers.classPrivateFieldLooseBase(this,h)[h].renderTo(e);return l}function C(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:e.getButton(b)}function K(){var e;return(e=babelHelpers.classPrivateFieldLooseBase(this,P)[P])==null?void 0:e.getButton(c)}function T(){return t.Loc.getMessage("CRM_FILE_UPLOADER_POPUP_TITLE_2")}function A(){return[new a.SaveButton({id:b,round:true,state:a.ButtonState.DISABLED,events:{click:babelHelpers.classPrivateFieldLooseBase(this,B)[B].bind(this)}}),new a.CancelButton({id:c,round:true,events:{click:babelHelpers.classPrivateFieldLooseBase(this,F)[F].bind(this)},text:t.Loc.getMessage("CRM_FILE_UPLOADER_POPUP_CANCEL"),color:a.ButtonColor.LIGHT_BORDER})]}function E(){if(babelHelpers.classPrivateFieldLooseBase(this,P)[P]){babelHelpers.classPrivateFieldLooseBase(this,P)[P].adjustPosition()}}e.FileUploaderPopup=w})(this.BX.Crm.Activity=this.BX.Crm.Activity||{},BX.Crm.Activity,BX,BX.Main,BX.UI);
//# sourceMappingURL=file-uploader-popup.bundle.map.js