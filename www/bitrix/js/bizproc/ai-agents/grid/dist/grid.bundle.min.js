this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};this.BX.Bizproc.Ai=this.BX.Bizproc.Ai||{};(function(e,t,s,a,i,n,r,l,o,d,c){"use strict";var p=babelHelpers.classPrivateFieldLooseKey("fieldId");var g=babelHelpers.classPrivateFieldLooseKey("gridId");var u=babelHelpers.classPrivateFieldLooseKey("fieldNode");class h{constructor(e){Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e==null?void 0:e.fieldId;babelHelpers.classPrivateFieldLooseBase(this,g)[g]=e==null?void 0:e.gridId;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e==null?void 0:e.fieldNode}setFieldNode(e){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=e}getGridId(){return babelHelpers.classPrivateFieldLooseBase(this,g)[g]}getFieldId(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}getGrid(){var e;let t=null;if(babelHelpers.classPrivateFieldLooseBase(this,g)[g]){t=BX.Main.gridManager.getById(babelHelpers.classPrivateFieldLooseBase(this,g)[g])}return(e=t)==null?void 0:e.instance}getFieldNode(){if(!babelHelpers.classPrivateFieldLooseBase(this,u)[u]){babelHelpers.classPrivateFieldLooseBase(this,u)[u]=document.getElementById(this.getFieldId())}return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}appendToFieldNode(e){c.Dom.append(e,this.getFieldNode())}}class b extends h{render(e){var t,s;const a=l.Text.render((t=e.name)!=null?t:"",{size:"md",accent:true,tag:"div",className:"bizproc-ai-agents-grid-agent-name bizproc-ai-agents-one-line-height"});c.Dom.attr(a,"data-test-id","bizproc-ai-agents-grid-agent-title");const i=l.Text.render((s=e.description)!=null?s:"",{size:"xs",accent:false,tag:"div",className:"bizproc-ai-agents-grid-agent-description bizproc-ai-agents-two-lines-height"});this.appendToFieldNode(a);this.appendToFieldNode(i)}}class v{}v.LOAD=`\n\t\t<svg class="agent-grid-load-icon" width="28" height="20" viewBox="0 0 28 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t<g clip-path="url(#clip0_762_45517)">\n\t\t\t\t<rect class="agent-grid-load-bar" y="16" width="4" height="5"/>\n\t\t\t</g>\n\t\t\t<g clip-path="url(#clip1_762_45517)">\n\t\t\t\t<rect class="agent-grid-load-bar" x="6" y="12" width="4" height="10"/>\n\t\t\t</g>\n\t\t\t<g clip-path="url(#clip2_762_45517)">\n\t\t\t\t<rect class="agent-grid-load-bar" x="12" y="8" width="4" height="20"/>\n\t\t\t</g>\n\t\t\t<g clip-path="url(#clip3_762_45517)">\n\t\t\t\t<rect class="agent-grid-load-bar" x="18" y="-8" width="4" height="28"/>\n\t\t\t</g>\n\t\t\t<g clip-path="url(#clip4_762_45517)">\n\t\t\t\t<rect class="agent-grid-load-bar" x="24" width="4" height="38"/>\n\t\t\t</g>\n\t\t\t<defs>\n\t\t\t\t<clipPath id="clip0_762_45517">\n\t\t\t\t<path d="M0 18C0 16.8954 0.895431 16 2 16C3.10457 16 4 16.8954 4 18V20H0V18Z" fill="white" />\n\t\t\t\t</clipPath>\n\t\t\t\t<clipPath id="clip1_762_45517">\n\t\t\t\t<path d="M6 14C6 12.8954 6.89543 12 8 12C9.10457 12 10 12.8954 10 14V20H6V14Z" fill="white" />\n\t\t\t\t</clipPath>\n\t\t\t\t<clipPath id="clip2_762_45517">\n\t\t\t\t<path d="M12 10C12 8.89543 12.8954 8 14 8C15.1046 8 16 8.89543 16 10V20H12V10Z" fill="white" />\n\t\t\t\t</clipPath>\n\t\t\t\t<clipPath id="clip3_762_45517">\n\t\t\t\t<path d="M18 6C18 4.89543 18.8954 4 20 4C21.1046 4 22 4.89543 22 6V20H18V6Z" fill="white" />\n\t\t\t\t</clipPath>\n\t\t\t\t<clipPath id="clip4_762_45517">\n\t\t\t\t<path d="M24 2C24 0.895431 24.8954 0 26 0C27.1046 0 28 0.895431 28 2V20H24V2Z" fill="white" />\n\t\t\t\t</clipPath>\n\t\t\t</defs>\n\t\t</svg>\n\t`;v.AGENT_CHAT=`\n\t\t<svg class="agent-grid-chat-icon-img" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t<path\n\t\t\td="M10.1064 3.64648C11.349 3.64655 12.3564 4.65388 12.3564 5.89648V6.49707H13.0693C14.229 6.49707 15.1697 7.43706 15.1699 8.59668V11.3604C15.1699 12.1141 14.7723 12.7751 14.1758 13.1455V13.7129C14.1756 14.6424 13.0518 15.1075 12.3945 14.4502L11.4043 13.4609H8.83984C7.6802 13.4608 6.74023 12.52 6.74023 11.3604V8.59668C6.74045 7.43718 7.68033 6.49726 8.83984 6.49707H11.3066V5.89648C11.3066 5.23378 10.7691 4.69635 10.1064 4.69629H5.08008C4.41751 4.69649 3.88086 5.23386 3.88086 5.89648V8.82227C3.8809 9.26438 4.11903 9.65203 4.47949 9.86133L5.00293 10.165V11.6611L5.89355 10.7715V11.3203C5.89355 11.5894 5.96379 11.8422 6.08789 12.0605L5.73438 12.415C5.07702 13.0724 3.95312 12.6064 3.95312 11.6768V10.7695C3.28205 10.3802 2.83012 9.65397 2.83008 8.82227V5.89648C2.83008 4.65397 3.83761 3.64668 5.08008 3.64648H10.1064ZM8.83984 7.54688C8.26023 7.54706 7.79025 8.01707 7.79004 8.59668V11.3604C7.79004 11.9401 8.2601 12.41 8.83984 12.4102H11.8389L13.126 13.6973V12.5615L13.6221 12.2539C13.923 12.067 14.1191 11.7361 14.1191 11.3604V8.59668C14.1189 8.01696 13.6491 7.54688 13.0693 7.54688H8.83984Z"\n\t\t\tfill="#525C69"/>\n\t\t</svg>\n\t`;v.DEPARTMENT=`\n\t\t\t<svg width="12" height="10" viewBox="0 0 12 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t    <path fill-rule="evenodd" clip-rule="evenodd"\n\t\t        d="M1.95676 6.28648C2.77587 5.81165 3.78874 5.66414 4.70642 5.66414C5.62411 5.66414 6.63698 5.81165 7.45609 6.28648C8.29896 6.77509 8.90893 7.59628 9.0059 8.85475C9.03899 9.28426 8.68791 9.61043 8.29506 9.61043H1.11778C0.724933 9.61043 0.373856 9.28426 0.406952 8.85474C0.503923 7.59628 1.11389 6.77509 1.95676 6.28648ZM1.20349 8.82018H8.20935C8.11169 7.88548 7.66355 7.32017 7.05977 6.97016C6.41198 6.59465 5.55879 6.45438 4.70642 6.45438C3.85406 6.45438 3.00086 6.59465 2.35308 6.97016C1.7493 7.32017 1.30116 7.88548 1.20349 8.82018Z"\n\t\t        fill="white" />\n\t\t    <path fill-rule="evenodd" clip-rule="evenodd"\n\t\t        d="M4.27024 0.867925C4.10176 0.923778 3.97998 0.989802 3.92655 1.02913C3.41436 1.40617 3.16091 2.22309 3.34019 3.03986C3.51311 3.82762 4.00839 4.31314 4.70162 4.31314C5.1431 4.31314 5.46803 4.12537 5.70647 3.81951C5.95916 3.49536 6.11633 3.02833 6.12825 2.53082C6.14018 2.03261 6.00512 1.58104 5.77044 1.2737C5.5543 0.990653 5.22474 0.786338 4.70165 0.786338C4.59177 0.786338 4.43616 0.812924 4.27024 0.867925ZM3.45807 0.392728C1.78723 1.62268 2.34174 5.10338 4.70162 5.10338C7.53484 5.10338 7.77944 -0.00390625 4.70165 -0.00390625C4.2688 -0.00390625 3.73551 0.188492 3.45807 0.392728Z"\n\t\t        fill="white" />\n\t\t    <path fill-rule="evenodd" clip-rule="evenodd"\n\t\t        d="M7.35878 0.787574C7.84175 0.804938 8.15155 1.00343 8.35793 1.2737C8.59262 1.58104 8.72768 2.03261 8.71574 2.53082C8.70383 3.02833 8.54666 3.49536 8.29396 3.81951C8.05552 4.12537 7.73059 4.31314 7.28912 4.31314C7.25733 4.31314 7.22596 4.31212 7.19502 4.31009L6.67579 5.01706C6.86428 5.07305 7.06883 5.10338 7.28912 5.10338C10.1223 5.10338 10.3669 -0.00390625 7.28914 -0.00390625C7.10718 -0.00390625 6.90747 0.0300948 6.71648 0.084683L7.35878 0.787574ZM9.66755 9.61073H10.8825C11.2754 9.61073 11.6265 9.28456 11.5934 8.85505C11.4964 7.59658 10.8864 6.77539 10.0436 6.28678C9.43126 5.93184 8.71069 5.75979 8.00254 5.69554L9.00673 6.691C9.2353 6.76427 9.45073 6.85654 9.64725 6.97046C10.251 7.32047 10.6992 7.88578 10.7968 8.82049H9.66755V9.61073Z"\n\t\t        fill="white" />\n\t\t    <path fill-rule="evenodd" clip-rule="evenodd"\n\t\t        d="M1.95676 6.28648C2.77587 5.81165 3.78874 5.66414 4.70642 5.66414C5.62411 5.66414 6.63698 5.81165 7.45609 6.28648C8.29896 6.77509 8.90893 7.59628 9.0059 8.85475C9.03899 9.28426 8.68791 9.61043 8.29506 9.61043H1.11778C0.724933 9.61043 0.373856 9.28426 0.406952 8.85474C0.503923 7.59628 1.11389 6.77509 1.95676 6.28648ZM1.20349 8.82018H8.20935C8.11169 7.88548 7.66355 7.32017 7.05977 6.97016C6.41198 6.59465 5.55879 6.45438 4.70642 6.45438C3.85406 6.45438 3.00086 6.59465 2.35308 6.97016C1.7493 7.32017 1.30116 7.88548 1.20349 8.82018Z"\n\t\t        fill="white" />\n\t\t    <path fill-rule="evenodd" clip-rule="evenodd"\n\t\t        d="M4.27024 0.867925C4.10176 0.923778 3.97998 0.989802 3.92655 1.02913C3.41436 1.40617 3.16091 2.22309 3.34019 3.03986C3.51311 3.82762 4.00839 4.31314 4.70162 4.31314C5.1431 4.31314 5.46803 4.12537 5.70647 3.81951C5.95916 3.49536 6.11633 3.02833 6.12825 2.53082C6.14018 2.03261 6.00512 1.58104 5.77044 1.2737C5.5543 0.990653 5.22474 0.786338 4.70165 0.786338C4.59177 0.786338 4.43616 0.812924 4.27024 0.867925ZM3.45807 0.392728C1.78723 1.62268 2.34174 5.10338 4.70162 5.10338C7.53484 5.10338 7.77944 -0.00390625 4.70165 -0.00390625C4.2688 -0.00390625 3.73551 0.188492 3.45807 0.392728Z"\n\t\t        fill="white" />\n\t\t    <path fill-rule="evenodd" clip-rule="evenodd"\n\t\t        d="M7.35878 0.787574C7.84175 0.804938 8.15155 1.00343 8.35793 1.2737C8.59262 1.58104 8.72768 2.03261 8.71574 2.53082C8.70383 3.02833 8.54666 3.49536 8.29396 3.81951C8.05552 4.12537 7.73059 4.31314 7.28912 4.31314C7.25733 4.31314 7.22596 4.31212 7.19502 4.31009L6.67579 5.01706C6.86428 5.07305 7.06883 5.10338 7.28912 5.10338C10.1223 5.10338 10.3669 -0.00390625 7.28914 -0.00390625C7.10718 -0.00390625 6.90747 0.0300948 6.71648 0.084683L7.35878 0.787574ZM9.66755 9.61073H10.8825C11.2754 9.61073 11.6265 9.28456 11.5934 8.85505C11.4964 7.59658 10.8864 6.77539 10.0436 6.28678C9.43126 5.93184 8.71069 5.75979 8.00254 5.69554L9.00673 6.691C9.2353 6.76427 9.45073 6.85654 9.64725 6.97046C10.251 7.32047 10.6992 7.88578 10.7968 8.82049H9.66755V9.61073Z"\n\t\t        fill="white" />\n\t\t</svg>\n\t`;const f={COMPONENT:"component",CONTROLLER:"controller"};const C={DELETE:"delete",GROUP_DELETE:"group-delete",EDIT:"edit",RESTART:"restart"};const m={SUCCESS:"Bizproc.AiAgentsGrid.TemplateSetup:success"};const P={USER_ID:"bx-tooltip-user-id",CONTEXT:"bx-tooltip-context"};const L={B24:"b24"};class A extends h{render(e){var t;const s={size:24,userpicPath:e==null?void 0:(t=e.user)==null?void 0:t.photoUrl};const a=new i.AvatarRound(s);this.addMiniProfile(e);a==null?void 0:a.renderTo(this.getFieldNode());c.Dom.addClass(this.getFieldNode(),"agent-grid_user-photo")}addMiniProfile(e){var t;c.Dom.attr(this.getFieldNode(),"bx-tooltip-user-id",e==null?void 0:(t=e.user)==null?void 0:t.id);c.Dom.attr(this.getFieldNode(),"bx-tooltip-context","b24")}}let T=e=>e,I,B,_,F,E,y,N,H,O,w,D;var R=babelHelpers.classPrivateFieldLooseKey("combinedPopup");var M=babelHelpers.classPrivateFieldLooseKey("renderCombinedView");var S=babelHelpers.classPrivateFieldLooseKey("renderUsersOnlyView");var x=babelHelpers.classPrivateFieldLooseKey("renderDepartmentsOnlyView");var U=babelHelpers.classPrivateFieldLooseKey("createAvatarsContainer");var G=babelHelpers.classPrivateFieldLooseKey("createDepartmentsCounter");var j=babelHelpers.classPrivateFieldLooseKey("createDepartmentsNode");var V=babelHelpers.classPrivateFieldLooseKey("getDisplayedNumber");var X=babelHelpers.classPrivateFieldLooseKey("createCounterNode");var K=babelHelpers.classPrivateFieldLooseKey("toggleCombinedPopup");var Z=babelHelpers.classPrivateFieldLooseKey("createChatNode");var z=babelHelpers.classPrivateFieldLooseKey("openCombinedPopup");var k=babelHelpers.classPrivateFieldLooseKey("fillDepartmentsListContent");var $=babelHelpers.classPrivateFieldLooseKey("getDepartmentNode");var q=babelHelpers.classPrivateFieldLooseKey("fillUsersListContent");var W=babelHelpers.classPrivateFieldLooseKey("getUserWithNameNode");var Y=babelHelpers.classPrivateFieldLooseKey("openUserProfile");class J extends h{constructor(...e){super(...e);Object.defineProperty(this,Y,{value:he});Object.defineProperty(this,W,{value:ue});Object.defineProperty(this,q,{value:ge});Object.defineProperty(this,$,{value:pe});Object.defineProperty(this,k,{value:ce});Object.defineProperty(this,z,{value:de});Object.defineProperty(this,Z,{value:oe});Object.defineProperty(this,K,{value:le});Object.defineProperty(this,X,{value:re});Object.defineProperty(this,V,{value:ne});Object.defineProperty(this,j,{value:ie});Object.defineProperty(this,G,{value:ae});Object.defineProperty(this,U,{value:se});Object.defineProperty(this,x,{value:te});Object.defineProperty(this,S,{value:ee});Object.defineProperty(this,M,{value:Q});Object.defineProperty(this,R,{writable:true,value:void 0})}render(e){const{users:t=[],chatId:s,chatName:a,departments:i={}}=e;const n=c.Tag.render(I||(I=T`
			<div class="agent-grid-used-by-container"></div>
		`));const r=t&&t.length>0;const l=i&&Object.keys(i).length>0;if(r&&l){babelHelpers.classPrivateFieldLooseBase(this,M)[M](n,i,t)}else if(l){babelHelpers.classPrivateFieldLooseBase(this,x)[x](n,i,t)}else{babelHelpers.classPrivateFieldLooseBase(this,S)[S](n,i,t)}babelHelpers.classPrivateFieldLooseBase(this,Z)[Z](n,s,a);this.appendToFieldNode(n)}openChat(e){if(!e){return}s.Messenger.openChat(e)}}function Q(e,t,s){c.Dom.addClass(e,"agent-grid-used-by-container-with-users-and-departments");babelHelpers.classPrivateFieldLooseBase(this,G)[G](e,t,s,J.MAX_VISIBLE_AVATARS_COMBINED);babelHelpers.classPrivateFieldLooseBase(this,U)[U](e,t,s,J.MAX_VISIBLE_AVATARS_COMBINED)}function ee(e,t,s){babelHelpers.classPrivateFieldLooseBase(this,U)[U](e,t,s,J.MAX_VISIBLE_AVATARS_USERS_ONLY)}function te(e,t,s){babelHelpers.classPrivateFieldLooseBase(this,j)[j](e,t,s)}function se(e,t,s,a){const i=3;const n=c.Tag.render(B||(B=T`<div data-test-id="bizproc-ai-agents-grid-used-by-avatars-container" class="agent-grid-user-avatars"></div>`));if(!s||s.length===0){for(let e=0;e<i;e++){const e=c.Tag.render(_||(_=T`<span></span>`));c.Dom.append(e,n);new A({fieldNode:e}).render({})}c.Dom.append(n,e);return}s.slice(0,a).forEach((e=>{const t=c.Tag.render(F||(F=T`<span></span>`));c.Dom.append(t,n);new A({fieldNode:t}).render({user:e})}));if(s.length>a){const e=s.length-a;const i="agent-grid-avatar-counter-number";const r="agent-grid-avatar-counter";const l=babelHelpers.classPrivateFieldLooseBase(this,X)[X](e,t,s,i,r);c.Dom.append(l,n)}c.Dom.append(n,e)}function ae(e,t,s,a){const i=Object.keys(t).length;if(i===0){return}let n=true;if(a&&(s==null?void 0:s.length)>a){n=false}const r="agent-grid-department-counter agent-grid-department-counter-with-users";const l="";const o=false;const d=babelHelpers.classPrivateFieldLooseBase(this,X)[X](i,t,s,r,l,o,n);if(d){c.Dom.append(d,e)}}function ie(e,t,s){var a;if(!t){return}const i=Object.keys(t);const n=i.length;if(n===0){return}const r=c.Text.toInteger(i[0]);const l=(a=t[r])!=null?a:"";const o=babelHelpers.classPrivateFieldLooseBase(this,$)[$](l,r);if(n>1){const e=n-1;const a="agent-grid-department-counter-number";const i="agent-grid-department-counter";const r=babelHelpers.classPrivateFieldLooseBase(this,X)[X](e,t,s,a,i);if(r){c.Dom.append(r,o)}}c.Dom.append(o,e)}function ne(e){return e>J.MAX_COUNTER_VALUE?J.MAX_COUNTER_VALUE:e}function re(e,t,s,a="",i="",n=true,r=true){if(e<=0){return null}const o=c.Tag.render(E||(E=T`<div class="${0}"></div>`),i);const d=babelHelpers.classPrivateFieldLooseBase(this,V)[V](e);let p=String(d);if(n){p=`+${p}`}const g=l.Text.render(p,{size:"3xs",accent:false,tag:"span",className:a});c.Dom.append(g,o);if(r){c.Event.bind(o,"click",(e=>{e.stopPropagation();babelHelpers.classPrivateFieldLooseBase(this,K)[K](t,s,o)}))}else{c.Dom.addClass(g,"agent-grid-counter-default-cursor")}return o}function le(e,t,s){if(babelHelpers.classPrivateFieldLooseBase(this,R)[R]&&babelHelpers.classPrivateFieldLooseBase(this,R)[R].isShown()){babelHelpers.classPrivateFieldLooseBase(this,R)[R].close()}else{babelHelpers.classPrivateFieldLooseBase(this,z)[z](e,t,s)}}function oe(e,t,s){if(!t){return}const a=l.Text.render(s||"",{size:"2xs",accent:false,tag:"span",className:"agent-grid-chat-name"});const i=c.Text.encode(s||"");const n=c.Tag.render(y||(y=T`
			<div class="agent-grid-chat-container" title="${0}">
				${0}
				<a href="#" class="agent-grid-chat-link">
					${0}
				</a>
			</div>
		`),i,v.AGENT_CHAT,a);c.Event.bind(n,"click",(e=>{e.preventDefault();this.openChat(t)}));c.Dom.append(n,e)}function de(e,s,a){const i=c.Tag.render(N||(N=T`<div class="agent-grid-departments-list-wrapper"></div>`));babelHelpers.classPrivateFieldLooseBase(this,k)[k](e,i);babelHelpers.classPrivateFieldLooseBase(this,q)[q](s,i);babelHelpers.classPrivateFieldLooseBase(this,R)[R]=new t.Popup({content:i,bindElement:a,cacheable:false,minWidth:300,minHeight:50,maxWidth:400,maxHeight:200,padding:0,autoHide:true,className:"agents-grid-popup"});babelHelpers.classPrivateFieldLooseBase(this,R)[R].show();babelHelpers.classPrivateFieldLooseBase(this,R)[R].subscribe("onClose",(()=>{babelHelpers.classPrivateFieldLooseBase(this,R)[R]=null}))}function ce(e,t){if(!e||Object.keys(e).length===0){return t}Object.entries(e).forEach((([e,s])=>{const a=c.Text.toInteger(e);const i=babelHelpers.classPrivateFieldLooseBase(this,$)[$](s,a,true);c.Dom.append(i,t)}));return t}function pe(e,t,s=false){const i=c.Tag.render(H||(H=T`
			<div class="${0}"></div>
		`),s?"agent-grid-department-in-list":"agent-grid-department");const n=c.Tag.render(O||(O=T`<div class="agent-grid-department-circle">${0}</div>`),v.DEPARTMENT);const r=l.Text.render(e,{size:"xs",accent:false,tag:"span",className:"agent-grid-department-label"});c.Dom.attr(r,"title",e);c.Dom.append(n,i);c.Dom.append(r,i);c.Event.bind(i,"click",(e=>{e.stopPropagation();a.Structure==null?void 0:a.Structure.open({focusNodeId:t})}));return i}function ge(e,t){if(!e||e.length===0){return t}e.forEach((e=>{const s=babelHelpers.classPrivateFieldLooseBase(this,W)[W](e,true);c.Dom.append(s,t)}));return t}function ue(e){const t=(e==null?void 0:e.fullName)||"";const s=c.Tag.render(w||(w=T`<div title="${0}" class="agent-grid-user-in-list"></div>`),t);const a=c.Tag.render(D||(D=T`<div class="agent-grid-user-img-container"></div>`));new A({fieldNode:a}).render({user:e});const i=l.Text.render(t,{size:"xs",accent:false,tag:"span",className:"agent-grid-user-full-name"});c.Event.bind(s,"click",(()=>babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](e==null?void 0:e.profileLink)));c.Dom.append(a,s);c.Dom.append(i,s);return s}function he(e){if(c.Type.isStringFilled(e)){BX.SidePanel.Instance.open(e)}}J.MAX_VISIBLE_AVATARS_COMBINED=3;J.MAX_VISIBLE_AVATARS_USERS_ONLY=5;J.MAX_COUNTER_VALUE=99;let be=e=>e,ve,fe;var Ce=babelHelpers.classPrivateFieldLooseKey("createFullNameElement");class me extends h{constructor(...e){super(...e);Object.defineProperty(this,Ce,{value:Pe})}render(e){var t,s,a,i;const n=(t=e==null?void 0:e.user)!=null?t:{};const r=(s=n.fullName)!=null?s:c.Loc.getMessage("BIZPROC_AI_AGENTS_LAUNCHED_BY_PLACEHOLDER");const l=(a=n.profileLink)!=null?a:null;const o=(i=n.id)!=null?i:null;const d=babelHelpers.classPrivateFieldLooseBase(this,Ce)[Ce](r,o,l);const p=c.Tag.render(ve||(ve=be`
			<div class="agent-grid_full-name-container">${0}</div>
		`),d);this.appendToFieldNode(p)}}function Pe(e,t,s){const a={size:"xs",accent:false,tag:"span",className:"agent-grid_full-name-label"};const i=l.Text.render(e,a);c.Dom.attr(i,P.USER_ID,t);c.Dom.attr(i,P.CONTEXT,L.B24);if(!s){c.Dom.addClass(i,"agent-grid_full-name-label-placeholder");return i}return c.Tag.render(fe||(fe=be`
			<a href="${0}" class="agent-grid_full-name-link">
				${0}
			</a>
		`),s,i)}let Le=e=>e,Ae,Te;class Ie extends h{render(e){const t=c.Text.getRandom(6);const s=c.Text.getRandom(6);this.appendToFieldNode(c.Tag.render(Ae||(Ae=Le`<span id="${0}"></span>`),t));this.appendToFieldNode(c.Tag.render(Te||(Te=Le`<span class="agent-grid_full-name-wrapper" id="${0}"></span>`),s));new A({fieldId:t}).render(e);new me({fieldId:s}).render(e);c.Dom.addClass(this.getFieldNode(),"agent-grid_employee-card-container");c.Dom.attr(this.getFieldNode(),"data-test-id","bizproc-ai-agents-grid-started-by-employee-card")}}const Be=async(e,t)=>{const s=await c.ajax.runAction(`bizproc.v2.${e}`,{method:"POST",json:t||{}});if(s.status==="success"){return s.data}return null};const _e={startTemplate:e=>Be("Integration.AiAgent.Template.start",{templateId:e}),copyAndStartTemplate:e=>Be("Integration.AiAgent.Template.copyAndStart",{templateId:e}),fetchRow:e=>Be("Integration.AiAgent.Template.fetchRow",{templateId:e})};var Fe=babelHelpers.classPrivateFieldLooseKey("grid");class Ee{constructor(e){Object.defineProperty(this,Fe,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=e}setGrid(e){babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe]=e}static prepareNewRowParams(e,t){return{id:e==null?void 0:e.ID,columns:e,actions:t,prepend:true,animation:true}}getByTemplateId(e){var t;const s=(t=babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe])==null?void 0:t.getRows();return s==null?void 0:s.getById(e)}markAsLoading(e){if(!e){return}e.stateLoad()}markAsLoaded(e){if(!e){return}e.stateUnload()}addToGrid(e){var t,s;(t=babelHelpers.classPrivateFieldLooseBase(this,Fe)[Fe])==null?void 0:(s=t.getRealtime())==null?void 0:s.addRow(e)}update(e,t){if(!e){return}e.setCellsContent(t)}highlight(e){if(!e){return}c.Dom.addClass(e.getNode(),"ai-agents-grid-row-highlighted");setTimeout((()=>{c.Dom.removeClass(e,"ai-agents-grid-row-highlighted")}),2500)}}var ye=babelHelpers.classPrivateFieldLooseKey("renderLaunchButton");var Ne=babelHelpers.classPrivateFieldLooseKey("renderLaunchedDate");class He extends h{constructor(...e){super(...e);Object.defineProperty(this,Ne,{value:we});Object.defineProperty(this,ye,{value:Oe})}render(e){if(c.Type.isNumber(e.launchedAt)&&e.launchedAt>0){babelHelpers.classPrivateFieldLooseBase(this,Ne)[Ne](e.launchedAt)}else if(c.Type.isNumber(e.agentId)){babelHelpers.classPrivateFieldLooseBase(this,ye)[ye](e)}}}function Oe(e){const t=new r.Button({text:c.Loc.getMessage("BIZPROC_AI_AGENTS_BUTTON_LAUNCH"),size:r.ButtonSize.SMALL,tag:r.Button.Tag.DIV,useAirDesign:true,onclick:async(t,s)=>{const a=this.getGrid();s.stopPropagation();t.setWaiting(true);a==null?void 0:a.tableFade();try{const s=await _e.copyAndStartTemplate(e.agentId);t.setWaiting(false);const i=s==null?void 0:s.columns;const n=s==null?void 0:s.actions;const r=Ee.prepareNewRowParams(i,n);a==null?void 0:a.tableUnfade();new Ee(a).addToGrid(r)}catch(e){var i,n;t.setWaiting(false);let s=e==null?void 0:(i=e.errors)==null?void 0:(n=i[0])==null?void 0:n.message;if(!s){s=c.Loc.getMessage("BIZPROC_AI_AGENTS_BUTTON_LAUNCH_ERROR")}a==null?void 0:a.tableUnfade();BX.UI.Notification.Center.notify({content:s})}}});c.Dom.attr(t.getContainer(),"data-test-id","bizproc-ai-agents-grid-action-start-button");this.appendToFieldNode(t.render())}function we(e){const t=n.DateTimeFormat.format("j F, G:i",e);const s=l.Text.render(t,{size:"xs",tag:"div",className:"launch-control-field-date"});c.Dom.attr(s,"data-test-id","bizproc-ai-agents-grid-started-at");this.appendToFieldNode(s)}let De=e=>e,Re,Me;class Se extends h{render(e){var t;const s=Number.isFinite(e==null?void 0:e.percentage)?e.percentage:0;const a=s>0;let i=null;const n=20;const r=Math.ceil(s/n);const o=c.Tag.render(Re||(Re=De`<div>${0}</div>`),v.LOAD);const d=o.querySelectorAll(".agent-grid-load-bar");d.forEach(((e,t)=>{const a=t+1;if(a<=r&&s>0){c.Dom.addClass(e,"--active")}c.Dom.style(e,"--level",a)}));if(a){const e=`${s}%`;i=l.Text.render(e,{size:"xs",accent:false,tag:"div",className:"agent-grid-load-percentage"})}const p=c.Tag.render(Me||(Me=De`
			<div class="agent-grid-load-indicator">
			  ${0}
			  <div
				class="agent-grid-load-container"
			  >
				${0}
			  </div>
			</div>
		`),(t=i)!=null?t:"",o);this.appendToFieldNode(p)}}class xe{static getActionId(){throw new Error("not implemented")}getActionConfig(){throw new Error("not implemented")}constructor(e){var t;this.grid=e.grid;this.filter=e.filter;this.showPopups=(t=e.showPopups)!=null?t:true}setActionParams(e){}getActionData(){return{}}async execute(){await this.onBeforeActionRequest();const e=this.showPopups?this.getConfirmationPopup():null;if(e){e.setOkCallback((async()=>{e.close();await this.run()}));e.show()}else{await this.run()}}async run(){}async onBeforeActionRequest(){}onAfterActionRequest(){this.grid.reload((()=>{this.grid.tableUnfade()}))}async sendActionRequest(){try{this.grid.tableFade();const e=this.getActionConfig();const t=this.getActionData();const s={...e.options,json:t,method:"POST"};let a=null;switch(e.type){case f.CONTROLLER:a=await BX.ajax.runAction(`bizproc.v2.${e.name}`,s);break;case f.COMPONENT:a=await BX.ajax.runComponentAction(e.component,e.name,s);break;default:{const t=`Unknown action type: ${e.type}`;this.handleError(t)}}this.handleSuccess(a)}catch(e){this.handleError(e)}finally{await this.onAfterActionRequest()}}handleSuccess(e){}handleError(e){BX.UI.Notification.Center.notify({content:this.getErrorMessageFromResult(e)})}getConfirmationPopup(){return null}getErrorMessageFromResult(e){var t,s;if(c.Type.isStringFilled(e)){return e}if(c.Type.isStringFilled(e==null?void 0:(t=e.errors)==null?void 0:(s=t[0])==null?void 0:s.message)){return e.errors[0].message}console.error(e);return c.Loc.getMessage("BIZPROC_AI_AGENTS_GRID_DEFAULT_ACTION_ERROR")}}var Ue=babelHelpers.classPrivateFieldLooseKey("openDesigner");class Ge extends xe{constructor(...e){super(...e);Object.defineProperty(this,Ue,{value:je})}static getActionId(){return C.EDIT}async run(){await super.run();babelHelpers.classPrivateFieldLooseBase(this,Ue)[Ue]()}setActionParams(e){this.editUri=e.editUri}}function je(){if(!this.editUri){return}window.open(this.editUri,"_blank")}class Ve extends xe{static getActionId(){return C.DELETE}async run(){await this.sendActionRequest()}setActionParams(e){this.templateId=Number.parseInt(e.templateId,10)}getActionConfig(){return{type:f.CONTROLLER,name:"Integration.AiAgent.Template.delete"}}getActionData(){const e={...super.getActionData()};if(!this.templateId||!c.Type.isNumber(this.templateId)){return e}e.agentIds=[this.templateId];return e}getConfirmationPopup(){const e=c.Loc.getMessage("BIZPROC_AI_AGENTS_GRID_DELETE_ACTION_CONFIRM_MESSAGE");const t=c.Loc.getMessage("BIZPROC_AI_AGENTS_GRID_DELETE_ACTION_CONFIRM_TITLE");const s=d.MessageBoxButtons.OK_CANCEL;const a=c.Loc.getMessage("BIZPROC_AI_AGENTS_GRID_DELETE_ACTION_BUTTON_OK");const i=c.Loc.getMessage("BIZPROC_AI_AGENTS_GRID_DELETE_ACTION_BUTTON_CANCEL");return new d.MessageBox({message:e,title:t,buttons:s,okCaption:a,onCancel:e=>{e.close()},cancelCaption:i})}}class Xe extends xe{static getActionId(){return C.RESTART}async run(){await this.sendActionRequest()}setActionParams(e){this.templateId=Number.parseInt(e.templateId,10)}getActionConfig(){return{type:f.CONTROLLER,name:"Integration.AiAgent.Template.start"}}getActionData(){const e={...super.getActionData()};if(!this.templateId||!c.Type.isNumber(this.templateId)){return e}e.templateId=this.templateId;return e}handleSuccess(e){}}class Ke extends Ve{static getActionId(){return C.GROUP_DELETE}getSelectedIds(){return this.grid.getRows().getSelectedIds()}getActionData(){const e={...super.getActionData()};e.agentIds=this.getSelectedIds();return e}getConfirmationPopup(){var e;if(((e=this.getSelectedIds())==null?void 0:e.length)===1){return super.getConfirmationPopup()}const t=c.Loc.getMessage("BIZPROC_AI_AGENTS_GRID_GROUP_DELETE_ACTION_CONFIRM_MESSAGE");const s=c.Loc.getMessage("BIZPROC_AI_AGENTS_GRID_GROUP_DELETE_ACTION_CONFIRM_TITLE");const a=d.MessageBoxButtons.OK_CANCEL;const i=c.Loc.getMessage("BIZPROC_AI_AGENTS_GRID_DELETE_ACTION_BUTTON_OK");const n=c.Loc.getMessage("BIZPROC_AI_AGENTS_GRID_DELETE_ACTION_BUTTON_CANCEL");return new d.MessageBox({message:t,title:s,buttons:a,okCaption:i,onCancel:e=>{e.close()},cancelCaption:n})}}const Ze=new Map([[Ge.getActionId(),Ge],[Ve.getActionId(),Ve],[Xe.getActionId(),Xe]]);const ze=new Map([[Ke.getActionId(),Ke]]);class ke{static createFromMap(e,t,s){const a=e.get(t);return a?new a(s):null}static create(e,t){return this.createFromMap(Ze,e,t)}static createGroupAction(e,t){return this.createFromMap(ze,e,t)}}var $e=babelHelpers.classPrivateFieldLooseKey("grid");var qe=babelHelpers.classPrivateFieldLooseKey("notifyUser");class We{constructor(e){Object.defineProperty(this,qe,{value:Ye});Object.defineProperty(this,$e,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]=e}async handle(e){const t=e.getData();const s=t==null?void 0:t.templateId;if(!s){return}const a=new Ee(babelHelpers.classPrivateFieldLooseBase(this,$e)[$e]);const i=a.getByTemplateId(s);if(!i){return}try{a.markAsLoading(i);const e=await _e.fetchRow(s);if(!e){throw new Error(c.Loc.getMessage("BIZPROC_AI_AGENTS_GRID_DEFAULT_ACTION_ERROR"))}a.update(i,e.columns);a.markAsLoaded(i);a.highlight(i)}catch(e){a.markAsLoaded(i);babelHelpers.classPrivateFieldLooseBase(this,qe)[qe](e.message||c.Loc.getMessage("BIZPROC_AI_AGENTS_GRID_DEFAULT_ACTION_ERROR"));babelHelpers.classPrivateFieldLooseBase(this,$e)[$e].reload()}}}function Ye(e){BX.UI.Notification.Center.notify({content:e})}var Je=babelHelpers.classPrivateFieldLooseKey("grid");var Qe=babelHelpers.classPrivateFieldLooseKey("subscribeToEvents");class et{constructor(e){var t;Object.defineProperty(this,Qe,{value:tt});Object.defineProperty(this,Je,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]=(t=BX.Main.gridManager.getById(e))==null?void 0:t.instance;babelHelpers.classPrivateFieldLooseBase(this,Qe)[Qe]()}static getInstance(e){if(!this.instances[e]){this.instances[e]=new et(e)}return this.instances[e]}static setSort(e){var t;const s=(t=BX.Main.gridManager.getById(e.gridId))==null?void 0:t.instance;if(c.Type.isObject(s)){s.tableFade();s.getUserOptions().setSort(e.sortBy,e.order,(()=>{s.reload()}))}}static setFilter(e){var t;const s=(t=BX.Main.gridManager.getById(e.gridId))==null?void 0:t.instance;const a=BX.Main.filterManager.getById(e.gridId);if(c.Type.isObject(s)&&c.Type.isObject(a)){a.getApi().extendFilter(e.filter)}}getGrid(){return babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]}runAction(e){const t=e.actionId;const s=e.options;s.grid=babelHelpers.classPrivateFieldLooseBase(this,Je)[Je];const a=ke.create(t,s);if(a){a.setActionParams({...e.params});a.execute()}}reload(){var e;(e=babelHelpers.classPrivateFieldLooseBase(this,Je)[Je])==null?void 0:e.reload()}}function tt(){o.EventEmitter.subscribe(m.SUCCESS,(e=>new We(babelHelpers.classPrivateFieldLooseBase(this,Je)[Je]).handle(e)))}et.instances=[];class st{static executeAction(e){try{var t;const s=ke.createGroupAction(e.actionId,{grid:(t=BX.Main.gridManager.getById(e.gridId))==null?void 0:t.instance,filter:e.filter});s.execute()}catch(e){console.error("Error executing action:",e)}}}e.BaseField=h;e.AgentInfoField=b;e.UsedByField=J;e.EmployeeField=Ie;e.LaunchControlField=He;e.LoadIndicatorField=Se;e.GridManager=et;e.Panel=st})(this.BX.Bizproc.Ai.Agents=this.BX.Bizproc.Ai.Agents||{},BX.Main,BX.Messenger.v2.Lib,BX.Humanresources.CompanyStructure,BX.UI,BX.Main,BX.UI,BX.UI.System.Typography,BX.Event,BX.UI.Dialogs,BX);
//# sourceMappingURL=grid.bundle.map.js