this.BX=this.BX||{};this.BX.Bizproc=this.BX.Bizproc||{};(function(e,s,t,l,i,a,r){"use strict";var o=babelHelpers.classPrivateFieldLooseKey("moduleId");var c=babelHelpers.classPrivateFieldLooseKey("entity");var n=babelHelpers.classPrivateFieldLooseKey("documentId");class d{constructor(e,s,t){Object.defineProperty(this,o,{writable:true,value:void 0});Object.defineProperty(this,c,{writable:true,value:void 0});Object.defineProperty(this,n,{writable:true,value:void 0});if(!i.Type.isStringFilled(e)||!i.Type.isStringFilled(s)||!(i.Type.isStringFilled(t)||i.Type.isNumber(t))){throw new TypeError("incorrect complex document id")}babelHelpers.classPrivateFieldLooseBase(this,o)[o]=e;babelHelpers.classPrivateFieldLooseBase(this,c)[c]=s;babelHelpers.classPrivateFieldLooseBase(this,n)[n]=t}get moduleId(){return babelHelpers.classPrivateFieldLooseBase(this,o)[o]}get entity(){return babelHelpers.classPrivateFieldLooseBase(this,c)[c]}get documentId(){return babelHelpers.classPrivateFieldLooseBase(this,n)[n]}}var p=babelHelpers.classPrivateFieldLooseKey("moduleId");var b=babelHelpers.classPrivateFieldLooseKey("entity");var u=babelHelpers.classPrivateFieldLooseKey("documentType");class v{constructor(e,s,t){Object.defineProperty(this,p,{writable:true,value:void 0});Object.defineProperty(this,b,{writable:true,value:void 0});Object.defineProperty(this,u,{writable:true,value:void 0});if(!i.Type.isStringFilled(e)||!i.Type.isStringFilled(s)||!i.Type.isStringFilled(t)){throw new TypeError("incorrect complex document type")}babelHelpers.classPrivateFieldLooseBase(this,p)[p]=e;babelHelpers.classPrivateFieldLooseBase(this,b)[b]=s;babelHelpers.classPrivateFieldLooseBase(this,u)[u]=t}get moduleId(){return babelHelpers.classPrivateFieldLooseBase(this,p)[p]}get entity(){return babelHelpers.classPrivateFieldLooseBase(this,b)[b]}get documentType(){return babelHelpers.classPrivateFieldLooseBase(this,u)[u]}isEqual(e){if(i.Type.isString(e)){return e.includes(this.moduleId)&&e.includes(this.entity)&&e.includes(this.documentType)}if(i.Type.isObjectLike(e)){return this.moduleId===e.moduleId&&this.entity===e.entity&&this.documentType===e.documentType}return false}}const y=Object.freeze({load:"get_templates",start:"start_workflow",check_parameters:"check_parameters"});const h=Object.freeze({load:"getTemplates",start:"startWorkflow",check_parameters:"checkParameters"});var m=babelHelpers.classPrivateFieldLooseKey("defaultData");var P=babelHelpers.classPrivateFieldLooseKey("ajaxUrl");var F=babelHelpers.classPrivateFieldLooseKey("controller");var f=babelHelpers.classPrivateFieldLooseKey("fillDefaultData");var T=babelHelpers.classPrivateFieldLooseKey("hasAjaxUrl");var L=babelHelpers.classPrivateFieldLooseKey("callAjax");var g=babelHelpers.classPrivateFieldLooseKey("callController");class H{constructor(e){Object.defineProperty(this,g,{value:S});Object.defineProperty(this,L,{value:I});Object.defineProperty(this,T,{get:w,set:void 0});Object.defineProperty(this,f,{value:B});Object.defineProperty(this,m,{writable:true,value:{}});Object.defineProperty(this,P,{writable:true,value:""});Object.defineProperty(this,F,{writable:true,value:"bizproc.workflow.starter"});babelHelpers.classPrivateFieldLooseBase(this,f)[f](e);if(i.Type.isStringFilled(e.customAjaxUrl)){babelHelpers.classPrivateFieldLooseBase(this,P)[P]=e.customAjaxUrl}else if(!i.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,m)[m].signed_document_type)){console.warn(`\n\t\t\t\tBizproc.Workflow.Starter: \n\t\t\t\tUsing the document type in parts has been deprecated and will soon cease to be supported. \n\t\t\t\tPlease use a signed document type\n\t\t\t`);babelHelpers.classPrivateFieldLooseBase(this,P)[P]="/bitrix/components/bitrix/bizproc.workflow.start/ajax.php"}}callAction(e,s={}){const t=babelHelpers.classPrivateFieldLooseBase(this,T)[T]?y[e]:h[e];if(!i.Type.isStringFilled(t)){return Promise.reject(new Error("incorrect action"))}const l=this.addData(babelHelpers.classPrivateFieldLooseBase(this,m)[m],s);return babelHelpers.classPrivateFieldLooseBase(this,T)[T]?babelHelpers.classPrivateFieldLooseBase(this,L)[L](t,l):babelHelpers.classPrivateFieldLooseBase(this,g)[g](t,l)}addData(e,s={}){const t=s;const l=i.Type.isPlainObject(t);Object.entries(e).forEach((([e,s])=>{const a=babelHelpers.classPrivateFieldLooseBase(this,T)[T]?e:i.Text.toCamelCase(e);if(l){t[a]=s;return}t.set(a,s)}));return t}}function B(e){var s,t,l,a;if(!i.Type.isNil(e.signedDocumentType)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].signed_document_type=e.signedDocumentType}if(!i.Type.isNil(e.signedDocumentId)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].signed_document_id=e.signedDocumentId}if(!i.Type.isNil((s=e.complexDocumentType)==null?void 0:s.moduleId)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].module_id=e.complexDocumentType.moduleId}if(!i.Type.isNil((t=e.complexDocumentType)==null?void 0:t.entity)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].entity=e.complexDocumentType.entity}if(!i.Type.isNil((l=e.complexDocumentType)==null?void 0:l.documentType)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].document_type=e.complexDocumentType.documentType}if(!i.Type.isNil((a=e.complexDocumentId)==null?void 0:a.documentId)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].document_id=e.complexDocumentId.documentId}if(!i.Type.isNil(e.triggerType)){babelHelpers.classPrivateFieldLooseBase(this,m)[m].trigger_type=e.triggerType}}function w(){return i.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,P)[P])}function I(e,s={}){const t=this.addData({sessid:i.Loc.getMessage("bitrix_sessid"),site:i.Loc.getMessage("SITE_ID"),ajax_action:e},s);return new Promise(((e,s)=>{const l={method:"POST",dataType:"json",url:babelHelpers.classPrivateFieldLooseBase(this,P)[P],data:t,onsuccess:t=>{if(t.success){e(t)}else{s(t)}},onfailure:()=>{s()}};if(!i.Type.isPlainObject(t)){l.preparePost=false}i.ajax(l)}))}function S(e,s={}){return new Promise(((t,l)=>{i.ajax.runAction(`${babelHelpers.classPrivateFieldLooseBase(this,F)[F]}.${e}`,{data:s}).then(t).catch(l)}))}var D=babelHelpers.classPrivateFieldLooseKey("messages");var j=babelHelpers.classPrivateFieldLooseKey("setMessages");var x=babelHelpers.classPrivateFieldLooseKey("showMessages");var O=babelHelpers.classPrivateFieldLooseKey("defaultErrorMessage");class E{constructor(e){Object.defineProperty(this,O,{get:_,set:void 0});Object.defineProperty(this,x,{value:k});Object.defineProperty(this,j,{value:K});Object.defineProperty(this,D,{writable:true,value:[]});if(i.Type.isArrayFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,j)[j](e)}}show(){babelHelpers.classPrivateFieldLooseBase(this,x)[x](a.MessageBox)}showToWindow(e){e.BX.Runtime.loadExtension("ui.dialogs.messagebox").then((()=>{babelHelpers.classPrivateFieldLooseBase(this,x)[x](e.BX.UI.Dialogs.MessageBox)})).catch((()=>{}))}}function K(e){e.forEach((e=>{if(i.Type.isStringFilled(e)){babelHelpers.classPrivateFieldLooseBase(this,D)[D].push(i.Text.encode(e))}else if(i.Type.isPlainObject(e)&&i.Type.isStringFilled(e.message)){if(i.Type.isStringFilled(e.code)&&e.code==="NETWORK_ERROR"){babelHelpers.classPrivateFieldLooseBase(this,D)[D].push(i.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,O)[O]))}else{babelHelpers.classPrivateFieldLooseBase(this,D)[D].push(i.Text.encode(e.message))}}}))}function k(e){if(!e){return}if(i.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,D)[D])){e.alert(babelHelpers.classPrivateFieldLooseBase(this,D)[D].join("<br>"));return}e.alert(i.Text.encode(babelHelpers.classPrivateFieldLooseBase(this,O)[O]))}function _(){return i.Loc.getMessage("BIZPROC_JS_WORKFLOW_STARTER_REQUEST_FAILED")}var A=babelHelpers.classPrivateFieldLooseKey("templates");var U=babelHelpers.classPrivateFieldLooseKey("signedDocumentType");var N=babelHelpers.classPrivateFieldLooseKey("signedDocumentId");var W=babelHelpers.classPrivateFieldLooseKey("complexDocumentType");var M=babelHelpers.classPrivateFieldLooseKey("complexDocumentId");var R=babelHelpers.classPrivateFieldLooseKey("triggerType");var X=babelHelpers.classPrivateFieldLooseKey("templatesSelector");var z=babelHelpers.classPrivateFieldLooseKey("callActionHelper");var C=babelHelpers.classPrivateFieldLooseKey("hasCustomAjaxUrl");var q=babelHelpers.classPrivateFieldLooseKey("setDocumentType");var J=babelHelpers.classPrivateFieldLooseKey("setDocumentId");var Z=babelHelpers.classPrivateFieldLooseKey("showTemplatesSlider");var $=babelHelpers.classPrivateFieldLooseKey("loadTemplates");var G=babelHelpers.classPrivateFieldLooseKey("initTemplateSelector");var Q=babelHelpers.classPrivateFieldLooseKey("onTemplateSelect");var V=babelHelpers.classPrivateFieldLooseKey("showStepByStepSlider");var Y=babelHelpers.classPrivateFieldLooseKey("createStepByStepSliderUrl");var ee=babelHelpers.classPrivateFieldLooseKey("callAction");var se=babelHelpers.classPrivateFieldLooseKey("showErrors");class te extends r.EventEmitter{constructor(e){super();Object.defineProperty(this,se,{value:be});Object.defineProperty(this,ee,{value:pe});Object.defineProperty(this,Y,{value:de});Object.defineProperty(this,V,{value:ne});Object.defineProperty(this,Q,{value:ce});Object.defineProperty(this,G,{value:oe});Object.defineProperty(this,$,{value:re});Object.defineProperty(this,Z,{value:ae});Object.defineProperty(this,J,{value:ie});Object.defineProperty(this,q,{value:le});Object.defineProperty(this,A,{writable:true,value:null});Object.defineProperty(this,U,{writable:true,value:null});Object.defineProperty(this,N,{writable:true,value:null});Object.defineProperty(this,W,{writable:true,value:null});Object.defineProperty(this,M,{writable:true,value:null});Object.defineProperty(this,R,{writable:true,value:null});Object.defineProperty(this,X,{writable:true,value:null});Object.defineProperty(this,z,{writable:true,value:void 0});Object.defineProperty(this,C,{writable:true,value:false});this.setEventNamespace("BX.Bizproc.Workflow.Starter");babelHelpers.classPrivateFieldLooseBase(this,q)[q](e);babelHelpers.classPrivateFieldLooseBase(this,R)[R]=e.triggerType||null;if(i.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,W)[W])&&i.Type.isNil(babelHelpers.classPrivateFieldLooseBase(this,U)[U])){throw new TypeError("document type is empty")}babelHelpers.classPrivateFieldLooseBase(this,J)[J](e);if(i.Type.isArray(e.templates)){babelHelpers.classPrivateFieldLooseBase(this,A)[A]=e.templates}babelHelpers.classPrivateFieldLooseBase(this,C)[C]=i.Type.isStringFilled(e.ajaxUrl);babelHelpers.classPrivateFieldLooseBase(this,z)[z]=new H({complexDocumentType:babelHelpers.classPrivateFieldLooseBase(this,W)[W],signedDocumentType:babelHelpers.classPrivateFieldLooseBase(this,U)[U],complexDocumentId:babelHelpers.classPrivateFieldLooseBase(this,M)[M],signedDocumentId:babelHelpers.classPrivateFieldLooseBase(this,N)[N],triggerType:e.triggerType||"",customAjaxUrl:babelHelpers.classPrivateFieldLooseBase(this,C)[C]?e.ajaxUrl:null});Fe.put(this)}static singleStart(e,s){const t=i.Text.toInteger(e==null?void 0:e.templateId);if(t<=0){return}let l=null;try{l=new te({moduleId:e.moduleId,entity:e.entity,documentType:e.documentType,documentId:e.documentId,signedDocumentType:e.signedDocumentType,signedDocumentId:e.signedDocumentId,templates:e.templates||null,triggerType:e.triggerType||null,ajaxUrl:e.ajaxUrl||""})}catch(e){console.error(e);return}if(i.Type.isFunction(s)){r.EventEmitter.subscribe(l,"onAfterStartWorkflow",s)}l.beginStartWorkflow(t).then((()=>{Fe.remove(l)})).catch((()=>{}))}static showTemplates(e,s){let t=null;try{t=new te({signedDocumentType:e.signedDocumentType,signedDocumentId:e.signedDocumentId})}catch(e){console.error(e);return}babelHelpers.classPrivateFieldLooseBase(t,Z)[Z]((()=>{if(i.Type.isFunction(s.callback)){s.callback()}Fe.remove(t)}))}get signedDocumentType(){return babelHelpers.classPrivateFieldLooseBase(this,U)[U]}get complexDocumentType(){return babelHelpers.classPrivateFieldLooseBase(this,W)[W]}showTemplatesMenu(e){if(i.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,U)[U])&&!babelHelpers.classPrivateFieldLooseBase(this,C)[C]){babelHelpers.classPrivateFieldLooseBase(this,Z)[Z]();return}if(!i.Type.isElementNode(e)&&!i.Type.isNull(e)){return}if(i.Type.isArray(babelHelpers.classPrivateFieldLooseBase(this,A)[A])){if(!babelHelpers.classPrivateFieldLooseBase(this,X)[X]){babelHelpers.classPrivateFieldLooseBase(this,G)[G](e)}babelHelpers.classPrivateFieldLooseBase(this,X)[X].show();return}babelHelpers.classPrivateFieldLooseBase(this,$)[$]().then((()=>{this.showTemplatesMenu(e)})).catch((e=>{babelHelpers.classPrivateFieldLooseBase(this,se)[se](e==null?void 0:e.errors)}))}showParametersPopup(e){this.beginStartWorkflow(e).then((()=>{})).catch((()=>{}))}beginStartWorkflow(e){if(i.Text.toInteger(e)<=0){return Promise.resolve()}return new Promise(((s,t)=>{babelHelpers.classPrivateFieldLooseBase(this,V)[V]({templateId:e,autoExecuteType:null}).then((e=>{if(i.Type.isStringFilled(e.workflowId)){Fe.fireEvent(this,"onAfterStartWorkflow",{workflowId:e.workflowId})}s()})).catch(t)}))}showAutoStartParametersPopup(e,s={}){babelHelpers.classPrivateFieldLooseBase(this,V)[V]({templateId:null,autoExecuteType:e}).then((e=>{if(i.Type.isFunction(s==null?void 0:s.callback)){if(i.Type.isString(e.signedParameters)){s.callback({parameters:e.signedParameters});return}s.callback({parameters:null})}})).catch((()=>{}))}}function le(e){if(i.Type.isStringFilled(e.moduleId)&&i.Type.isStringFilled(e.entity)&&i.Type.isStringFilled(e.documentType)){babelHelpers.classPrivateFieldLooseBase(this,W)[W]=new v(e.moduleId,e.entity,e.documentType)}if(i.Type.isStringFilled(e.signedDocumentType)){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=e.signedDocumentType}}function ie(e){if(i.Type.isStringFilled(e.moduleId)&&i.Type.isStringFilled(e.entity)&&(i.Type.isStringFilled(e.documentId)||i.Type.isNumber(e.documentId))){babelHelpers.classPrivateFieldLooseBase(this,M)[M]=new d(e.moduleId,e.entity,e.documentId)}if(i.Type.isStringFilled(e.signedDocumentId)){babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e.signedDocumentId}}function ae(e=null){i.Runtime.loadExtension("bizproc.router").then((({Router:s})=>{const t={requestMethod:"get",requestParams:{signedDocumentType:babelHelpers.classPrivateFieldLooseBase(this,U)[U],signedDocumentId:babelHelpers.classPrivateFieldLooseBase(this,N)[N]},events:{onCloseComplete:i.Type.isFunction(e)?e:()=>{}}};s.openWorkflowStartList(t)})).catch((e=>console.error(e)))}function re(){return new Promise(((e,s)=>{babelHelpers.classPrivateFieldLooseBase(this,ee)[ee]("load").then((s=>{babelHelpers.classPrivateFieldLooseBase(this,A)[A]=i.Type.isArray(s.data.templates)?s.data.templates:[];e(s)})).catch(s)}))}function oe(e){const t=[];if(i.Type.isArrayFilled(babelHelpers.classPrivateFieldLooseBase(this,A)[A])){babelHelpers.classPrivateFieldLooseBase(this,A)[A].forEach((e=>{if(i.Text.toInteger(e.id)>0&&i.Type.isStringFilled(e.name)){t.push({id:e.id,title:e.name,subtitle:e.description||"",entityId:"template",tabs:"recents",customData:e})}}))}babelHelpers.classPrivateFieldLooseBase(this,X)[X]=new s.Dialog({targetNode:e,context:"bp_workflow_starter",items:t,multiple:false,dropdownMode:true,enableSearch:true,hideOnSelect:true,clearSearchOnSelect:true,hideByEsc:true,cacheable:true,focusOnFirst:true,showAvatars:false,compactView:false,events:{"Item:onSelect":e=>{var s;babelHelpers.classPrivateFieldLooseBase(this,X)[X].deselectAll();const t=(s=e.getData().item)==null?void 0:s.getCustomData();if(t){babelHelpers.classPrivateFieldLooseBase(this,Q)[Q](t)}}},recentTabOptions:{stub:true,stubOptions:{title:i.Loc.getMessage("BIZPROC_JS_WORKFLOW_STARTER_EMPTY_TEMPLATES")}}})}function ce(e){this.beginStartWorkflow(e.get("id")).then((()=>{})).catch((()=>{}))}function ne(e){return new Promise((s=>{BX.SidePanel.Instance.open(babelHelpers.classPrivateFieldLooseBase(this,Y)[Y](e),{width:900,cacheable:false,allowChangeHistory:false,events:{onCloseComplete:e=>{const t=e.getSlider();const l=t?t.getData():null;let i={};if(l&&l.has("data")){i={workflowId:l.get("data").workflowId||null,signedParameters:l.get("data").signedParameters||null}}s(i)}}})}))}function de(e){var s,t;let l=i.Uri.addParam("/bitrix/components/bitrix/bizproc.workflow.start/",{sessid:i.Loc.getMessage("bitrix_sessid")});const a=i.Text.toInteger(e.templateId);if(a>0){l=i.Uri.addParam(l,{templateId:a})}const r=i.Text.toInteger(e.autoExecuteType);if(!i.Type.isNil(e.autoExecuteType)&&r>=0){l=i.Uri.addParam(l,{autoExecuteType:r})}if((s=babelHelpers.classPrivateFieldLooseBase(this,W)[W])!=null&&s.moduleId){l=i.Uri.addParam(l,{moduleId:babelHelpers.classPrivateFieldLooseBase(this,W)[W].moduleId,entity:babelHelpers.classPrivateFieldLooseBase(this,W)[W].entity,documentType:babelHelpers.classPrivateFieldLooseBase(this,W)[W].documentType})}if(babelHelpers.classPrivateFieldLooseBase(this,U)[U]){l=i.Uri.addParam(l,{signedDocumentType:babelHelpers.classPrivateFieldLooseBase(this,U)[U]})}if((t=babelHelpers.classPrivateFieldLooseBase(this,M)[M])!=null&&t.documentId){l=i.Uri.addParam(l,{documentId:babelHelpers.classPrivateFieldLooseBase(this,M)[M].documentId})}if(babelHelpers.classPrivateFieldLooseBase(this,N)[N]){l=i.Uri.addParam(l,{signedDocumentId:babelHelpers.classPrivateFieldLooseBase(this,N)[N]})}if(i.Type.isStringFilled(babelHelpers.classPrivateFieldLooseBase(this,R)[R])){l=i.Uri.addParam(l,{triggerType:babelHelpers.classPrivateFieldLooseBase(this,R)[R]})}return l}function pe(e,s={},t={}){return babelHelpers.classPrivateFieldLooseBase(this,z)[z].callAction(e,babelHelpers.classPrivateFieldLooseBase(this,z)[z].addData(t,s))}function be(e,s){const t=new E(e);const l=i.Type.isNil(s)?"show":"showToWindow";t[l](s)}var ue=babelHelpers.classPrivateFieldLooseKey("instances");var ve=babelHelpers.classPrivateFieldLooseKey("findSimilar");var ye=babelHelpers.classPrivateFieldLooseKey("isEqual");class he{constructor(){Object.defineProperty(this,ye,{value:Pe});Object.defineProperty(this,ve,{value:me});Object.defineProperty(this,ue,{writable:true,value:new Set})}put(e){babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].add(e);return this}remove(e){babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].delete(e)}fireEvent(e,s,t){const l=babelHelpers.classPrivateFieldLooseBase(this,ve)[ve](e);l.forEach((e=>{e.emit(s,t);r.EventEmitter.emit(e,s,t,{useGlobalNaming:true})}))}}function me(e){const s=[e];babelHelpers.classPrivateFieldLooseBase(this,ue)[ue].forEach((t=>{if(t!==e&&babelHelpers.classPrivateFieldLooseBase(this,ye)[ye](e,t)){s.push(t)}}));return s}function Pe(e,s){if(e.signedDocumentType&&s.signedDocumentType){return e.signedDocumentType===s.signedDocumentType}if(e.complexDocumentType){return e.complexDocumentType.isEqual(s.complexDocumentType||s.signedDocumentType)}return s.complexDocumentType.isEqual(e.complexDocumentType||e.signedDocumentType)}const Fe=new he;e.Starter=te;e.managerInstance=Fe})(this.BX.Bizproc.Workflow=this.BX.Bizproc.Workflow||{},BX.UI.EntitySelector,BX,BX,BX,BX.UI.Dialogs,BX.Event);
//# sourceMappingURL=starter.bundle.map.js