this.BX=this.BX||{};(function(t,e,i,n,s,a,l,o,r){"use strict";const p=Object.freeze({DELIMITER:"delimiter",TITLE:"title",TITLE_WITH_ICON:"titleWithIcon",DESCRIPTION:"description",CONSTANT:"constant"});const u=Object.freeze({STRING:"string",INT:"int",USER:"user",FILE:"file",TEXT:"text",SELECT:"select",KNOWLEDGE:"rag_knowledge_base",PROJECT:"project"});const d=Object.freeze({LINE:"line"});const m={SUCCESS:"Bizproc.AiAgentsGrid.TemplateSetup:success"};const c={IMAGE:"o-image",ATTACH:"o-attach",SETTINGS:"o-settings",STARS:"o-ai-stars"};const h={name:"ConstantTextual",props:{item:{type:Object,required:true},modelValue:{type:[String,Array],default:""}},emits:["update:modelValue"],computed:{multipleValues(){const t=this.modelValue;return l.Type.isArray(t)&&t.length>0?t:[""]},showRemoveIcon(){return this.item.multiple&&this.multipleValues.length>1}},methods:{updateConstant(t){this.$emit("update:modelValue",t)},updateSingleValue(t){this.updateConstant(t.target.value)},updateValueAtIndex(t,e){const i=[...this.multipleValues];i[t]=e.target.value;this.updateConstant(i)},async addField(){const t=[...this.multipleValues,""];this.updateConstant(t);await this.$nextTick();const e=this.$refs.inputFields;if(e&&e.length>0){const t=e[e.length-1];t.focus()}},removeField(t){const e=[...this.multipleValues];e.splice(t,1);this.updateConstant(e)}},template:`\n\t\t<div>\n\t\t\t<template v-if="item.multiple">\n\t\t\t\t<div v-for="(val, index) in multipleValues" :key="index" class="bizproc-setup-template__field-item">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tref="inputFields"\n\t\t\t\t\t\t\t:value="val"\n\t\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t@input="updateValueAtIndex(index, $event)"\n\t\t\t\t\t\t\tdata-test-id="bizproc-setup-template__form-text-multiple"\n\t\t\t\t\t\t>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if="showRemoveIcon"\n\t\t\t\t\t\t@click="removeField(index)"\n\t\t\t\t\t\tdata-test-id="bizproc-setup-template__form-text-delete-btn"\n\t\t\t\t\t\tclass="bizproc-setup-template__field-remove ui-icon-set --cross-m"\n\t\t\t\t\t></span>\n\t\t\t\t</div>\n\t\t\t\t<button\n\t\t\t\t\t@click="addField"\n\t\t\t\t\tclass="bizproc-setup-template__add-btn"\n\t\t\t\t\ttype="button"\n\t\t\t\t\tdata-test-id="bizproc-setup-template__form-text-add-btn"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_JS_AI_AGENTS_ACTIVATOR_FORM_ADD_FIELD') }}\n\t\t\t\t</button>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div class="ui-ctl ui-ctl-textbox ui-ctl-w100">\n\t\t\t\t\t<input\n\t\t\t\t\t\t:value="modelValue"\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t@input="updateSingleValue"\n\t\t\t\t\t\tdata-test-id="bizproc-setup-template__form-text-single"\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const v={name:"ConstantSelect",props:{item:{type:Object,required:true},modelValue:{type:[String,Array],default:""}},emits:["update:modelValue"],computed:{selectedValue:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},options(){return this.item.options||[]},showScroll(){return this.options.length>7}},methods:{getFieldId(t){return`select-opt-${this.item.id}-${t.id}`}},template:`\n\t\t<div :class="{ 'bizproc-setup-template__field-select': showScroll }">\n\t\t\t<template v-if="item.multiple">\n\t\t\t\t<div v-for="option in options" :key="option.id" class="ui-ctl ui-ctl-checkbox">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="checkbox"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t:value="option.name"\n\t\t\t\t\t\tv-model="selectedValue"\n\t\t\t\t\t\t:id="getFieldId(option)"\n\t\t\t\t\t>\n\t\t\t\t\t<label class="ui-ctl-label-text" :for="getFieldId(option)">{{ option.name }}</label>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div v-for="option in options" :key="option.id" class="ui-ctl ui-ctl-radio">\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype="radio"\n\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t:value="option.name"\n\t\t\t\t\t\tv-model="selectedValue"\n\t\t\t\t\t\t:id="getFieldId(option)"\n\t\t\t\t\t>\n\t\t\t\t\t<label class="ui-ctl-label-text" :for="getFieldId(option)">{{ option.name }}</label>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t</div>\n\t`};const b=Object.freeze({USER:"user",DEPARTMENT:"structure-node"});const f=[{template:/^group_hrr(\d+)$/,format:t=>[b.DEPARTMENT,t[1]]},{template:/^group_hr(\d+)$/,format:t=>[b.DEPARTMENT,`${t[1]}:F`]},{template:/^user_(\d+)$/,format:t=>[b.USER,t[1]]}];const g={name:"ConstantUser",props:{item:{type:Object,required:true},modelValue:{type:[String,Array],default:""}},emits:["update:modelValue"],mounted(){this.initializeSelector()},beforeUnmount(){if(this.tagSelector){this.tagSelector.getDialog().destroy();this.tagSelector=null}},methods:{syncValue(){if(!this.tagSelector){return}const t=this.tagSelector.getTags();const e=t.map((t=>{const e=t.getId();const i=t.getTitle();const n=t.getEntityId();if(n===b.USER){return`${i}[${e}]`}if(n===b.DEPARTMENT){if(l.Type.isString(e)&&e.endsWith(":F")){const t=e.replace(":F","");return`${i}[HR${t}]`}return`${i}[HRR${e}]`}return null})).filter(Boolean);if(this.item.multiple){this.$emit("update:modelValue",e.join(";"))}else{this.$emit("update:modelValue",e.length>0?e[0]:"")}},getPreselectedItems(){const t=this.normalizeModelValue();if(t.length===0){return[]}const e=t.map((t=>this.parseValue(t)));return e.filter(Boolean)},normalizeModelValue(){const{modelValue:t,item:e}=this;if(e.multiple&&l.Type.isStringFilled(t)){return t.split(";")}if(l.Type.isArray(t)){return t}return t?[String(t)]:[]},parseValue(t){const e=String(t).trim();if(!e){return null}for(const t of f){const i=e.match(t.template);if(i){return t.format(i)}}return[b.USER,e]},initializeSelector(){this.tagSelector=new a.TagSelector({multiple:this.item.multiple,showCreateButton:false,dialogOptions:{context:`BIZPROC_USER_SELECTOR_${this.item.id}`,preselectedItems:this.getPreselectedItems(),popupOptions:{className:"bizproc-setup-template__no-tabs-selector-popup"},width:500,entities:[{id:b.USER,options:{inviteEmployeeLink:false}},{id:b.DEPARTMENT,options:{selectMode:"usersAndDepartments",allowSelectRootDepartment:true,allowFlatDepartments:true}}],multiple:this.item.multiple,showAvatars:true,dropdownMode:true,compactView:true,height:250},addButtonCaption:l.Loc.getMessage("BIZPROC_JS_AI_AGENTS_ACTIVATOR_FORM_ADD_USER"),events:{onAfterTagAdd:this.syncValue,onAfterTagRemove:this.syncValue}});this.tagSelector.renderTo(this.$refs.container)}},template:`\n\t\t<div ref="container" data-test-id="bizproc-setup-template__form-user"></div>\n\t`};const T=2e3;const _={name:"ConstantTextarea",props:{item:{type:Object,required:true},modelValue:{type:[String,Array],default:""}},emits:["update:modelValue"],computed:{multipleValues(){const t=this.modelValue;if(l.Type.isArray(t)&&t.length>0){return t}return[""]},maxTextLength(){return T},showRemoveIcon(){return this.item.multiple&&this.multipleValues.length>1}},methods:{getCounterText(t){const e=(t||"").length;return`${e}/${this.maxTextLength}`},onSingleInput(t){let e=t.target.value;if(e.length>this.maxTextLength){e=e.slice(0,this.maxTextLength);t.target.value=e}this.$emit("update:modelValue",e)},onMultipleInput(t,e){let i=t.target.value;if(i.length>this.maxTextLength){i=i.slice(0,this.maxTextLength);t.target.value=i}const n=[...this.multipleValues];n[e]=i;this.$emit("update:modelValue",n)},async addField(){if(!this.item.multiple){return}const t=[...this.multipleValues,""];this.$emit("update:modelValue",t);await this.$nextTick();const e=this.$refs.textareaFields;if(e&&e.length>0){const t=e[e.length-1];t.focus()}},removeField(t){if(!this.showRemoveIcon){return}const e=[...this.multipleValues];e.splice(t,1);this.$emit("update:modelValue",e)}},template:`\n\t\t<div class="bizproc-setup-template__multiple-wrapper">\n\t\t\t<template v-if="!item.multiple">\n\t\t\t\t<div class="bizproc-setup-template__textarea-wrapper">\n\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-w100">\n\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t:value="modelValue"\n\t\t\t\t\t\t\t:maxlength="maxTextLength"\n\t\t\t\t\t\t\t@input="onSingleInput"\n\t\t\t\t\t\t\tdata-test-id="bizproc-setup-template__form-textarea-single"\n\t\t\t\t\t\t></textarea>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="bizproc-setup-template__char-counter">\n\t\t\t\t\t\t{{ getCounterText(modelValue) }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</template>\n\t\t\t<template v-else>\n\t\t\t\t<div\n\t\t\t\t\tv-for="(value, index) in multipleValues"\n\t\t\t\t\t:key="index"\n\t\t\t\t\tclass="bizproc-setup-template__field-item"\n\t\t\t\t>\n\t\t\t\t\t<div class="bizproc-setup-template__textarea-wrapper">\n\t\t\t\t\t\t<div class="ui-ctl ui-ctl-textarea ui-ctl-w100">\n\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\tref="textareaFields"\n\t\t\t\t\t\t\t\tclass="ui-ctl-element"\n\t\t\t\t\t\t\t\t:value="value"\n\t\t\t\t\t\t\t\t:maxlength="maxTextLength"\n\t\t\t\t\t\t\t\t@input="onMultipleInput($event, index)"\n\t\t\t\t\t\t\t\tdata-test-id="bizproc-setup-template__form-textarea-multiple"\n\t\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="bizproc-setup-template__char-counter">\n\t\t\t\t\t\t\t{{ getCounterText(value) }}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span\n\t\t\t\t\t\tv-if="showRemoveIcon"\n\t\t\t\t\t\t@click="removeField(index)"\n\t\t\t\t\t\tdata-test-id="bizproc-setup-template__form-textarea-delete-btn"\n\t\t\t\t\t\tclass="bizproc-setup-template__field-remove ui-icon-set --cross-m"\n\t\t\t\t\t></span>\n\t\t\t\t</div>\n\t\t\t\t<button\n\t\t\t\t\t@click="addField"\n\t\t\t\t\tclass="bizproc-setup-template__add-btn"\n\t\t\t\t\ttype="button"\n\t\t\t\t\tdata-test-id="bizproc-setup-template__form-textarea-add-btn"\n\t\t\t\t>\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_JS_AI_AGENTS_ACTIVATOR_FORM_ADD_FIELD') }}\n\t\t\t\t</button>\n\t\t\t</template>\n\t\t</div>\n\t`};const y={name:"ConstantKnowledge",components:{RagAppComponent:s.RagAppComponent},props:{item:{type:Object,required:true},modelValue:{type:[Array,String],default:()=>[]},isRequired:{type:Boolean,default:false}},emits:["update:modelValue"],computed:{value:{get(){return this.modelValue},set(t){this.$emit("update:modelValue",t)}},showDescription(){return this.item.description&&this.item.description.length>0}},template:`\n\t\t<div class="ui-form-row" data-test-id="bizproc-setup-template__form-knowledge">\n\t\t\t<div class="bizproc-setup-template__knowledge-title">\n\t\t\t\t{{ item.name }}\n\t\t\t</div>\n\t\t\t<div v-if="showDescription" class="bizproc-setup-template__text">\n\t\t\t\t{{ item.description }}\n\t\t\t</div>\n\t\t\t<RagAppComponent\n\t\t\t\tv-model="value"\n\t\t\t\t:isMultiple="item.multiple"\n\t\t\t\t:isRequired="isRequired"\n\t\t\t/>\n\t\t</div>\n\t`};const C=Object.freeze({PROJECT:"project"});const E={name:"ConstantProject",props:{item:{type:Object,required:true},modelValue:{type:[String,Array,Number],default:""},disabled:{type:Boolean,default:false}},emits:["update:modelValue"],mounted(){this.initializeSelector()},beforeUnmount(){if(this.tagSelector){this.tagSelector.getDialog().destroy();this.tagSelector=null}},methods:{syncValue(){if(!this.tagSelector){return}const t=this.tagSelector.getTags();const e=t.map((t=>t.getId())).filter(Boolean);if(this.item.multiple){this.$emit("update:modelValue",e)}else{this.$emit("update:modelValue",e.length>0?e[0]:"")}},getPreselectedItems(){return this.normalizeModelValues().map((t=>[C.PROJECT,t]))},normalizeModelValues(){if(l.Type.isArray(this.modelValue)){return this.modelValue.map((t=>Number(t))).filter((t=>l.Type.isNumber(t)))}return this.modelValue?[Number(this.modelValue)].filter((t=>l.Type.isNumber(t))):[]},initializeSelector(){this.tagSelector=new a.TagSelector({multiple:this.item.multiple,dialogOptions:{context:`BIZPROC_PROJECT_SELECTOR_${this.item.id}`,popupOptions:{className:"bizproc-setup-template__no-tabs-selector-popup"},width:500,entities:[{id:C.PROJECT}],multiple:this.item.multiple,dropdownMode:true,compactView:true,height:250,preselectedItems:this.getPreselectedItems()},events:{onAfterTagAdd:this.syncValue,onAfterTagRemove:this.syncValue}});this.tagSelector.renderTo(this.$refs.container)}},template:`\n\t\t<div ref="container" data-test-id="bizproc-setup-template__form-project"></div>\n\t`};const I={name:"ConstantFile",components:{TileWidgetComponent:o.TileWidgetComponent},inject:["templateId"],props:{item:{type:Object,required:true},modelValue:{type:[String,Array,Number],default:""},disabled:{type:Boolean,default:false}},emits:["update:modelValue"],computed:{uploaderOptions(){return{controller:"bizproc.fileUploader.setupTemplateUploaderController",controllerOptions:{templateId:this.templateId},files:this.normalizeModelValues(),multiple:this.item.multiple,autoUpload:true,hiddenFieldsContainer:this.$refs.uploaderHiddenFields,events:{[r.UploaderEvent.FILE_COMPLETE]:()=>{this.syncValue()},[r.UploaderEvent.FILE_REMOVE]:()=>{this.syncValue()}}}},widgetOptions(){return{readonly:this.disabled,hideDropArea:this.disabled}}},methods:{syncValue(){var t,e;const i=(t=this.$refs)==null?void 0:(e=t.tileWidget)==null?void 0:e.uploader;if(!i){return}const n=i.getFiles().map((t=>t.getServerFileId())).filter((t=>l.Type.isStringFilled(t)||l.Type.isNumber(t)));if(this.item.multiple){this.$emit("update:modelValue",n)}else{this.$emit("update:modelValue",n.length>0?n[0]:"")}},normalizeModelValues(){if(l.Type.isArray(this.modelValue)){return this.modelValue}return this.modelValue?[this.modelValue]:[]}},template:`\n\t\t<div ref="uploaderHiddenFields"></div>\n\t\t<TileWidgetComponent :uploaderOptions="uploaderOptions" :widgetOptions="widgetOptions" ref="tileWidget"/>\n\t`};const S={[u.TEXT]:"ConstantTextarea",[u.STRING]:"ConstantTextual",[u.INT]:"ConstantTextual",[u.SELECT]:"ConstantSelect",[u.USER]:"ConstantUser",[u.KNOWLEDGE]:"ConstantKnowledge",[u.PROJECT]:"ConstantProject",[u.FILE]:"ConstantFile"};const V={name:"ConstantComponent",components:{ConstantTextual:h,ConstantSelect:v,ConstantUser:g,ConstantTextarea:_,ConstantKnowledge:y,ConstantProject:E,ConstantFile:I},props:{item:{type:Object,required:true},formData:{type:Object,required:true},error:{type:String,default:""}},emits:["constantUpdate"],computed:{constantValue:{get(){return this.getCurrentConstantValue()},set(t){this.$emit("constantUpdate",this.item.id,t)}},fieldComponent(){return S[this.item.constantType]||null},isRequired(){return this.item.required},isKnowledgeField(){return this.item.constantType===u.KNOWLEDGE}},methods:{getCurrentConstantValue(){const t=this.formData[this.item.id];if(this.item.multiple){if(l.Type.isArray(t)){return t}if(t){return[t]}return[]}return t!=null?t:""}},template:`\n\t\t<template v-if="isKnowledgeField">\n\t\t\t<component\n\t\t\t\t:is="fieldComponent"\n\t\t\t\t:item="item"\n\t\t\t\tv-model="constantValue"\n\t\t\t\t:isRequired="isRequired"\n\t\t\t/>\n\t\t</template>\n\t\t<template v-else>\n\t\t\t<div class="ui-form-row" :class="{ '--error': error }">\n\t\t\t\t<div\n\t\t\t\t\t:class="{ '--required': isRequired }"\n\t\t\t\t\tclass="ui-form-label bizproc-setup-template__label"\n\t\t\t\t>\n\t\t\t\t\t<div class="ui-ctl-label-text bizproc-setup-template__label-text">{{ item.name }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="ui-form-content">\n\t\t\t\t\t<component\n\t\t\t\t\t\tv-if="fieldComponent"\n\t\t\t\t\t\t:is="fieldComponent"\n\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\tv-model="constantValue"\n\t\t\t\t\t/>\n\t\t\t\t\t<div v-if="error" class="bizproc-setup-template__error-text">\n\t\t\t\t\t\t<div class="ui-icon-set --warning"></div>\n\t\t\t\t\t\t{{ error }}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t`};const A={name:"DelimiterComponent",props:{item:{type:Object,required:true}},template:`\n\t\t<div class="bizproc-setup-template__delimiter"></div>\n\t`};const x={name:"DescriptionComponent",props:{item:{type:Object,required:true}},template:`\n\t\t<div class="bizproc-setup-template__text --with-linebreak">\n\t\t\t{{ item.text }}\n\t\t</div>\n\t`};const O={name:"TitleComponent",props:{item:{type:Object,required:true}},template:`\n\t\t<div class="bizproc-setup-template__heading">\n\t\t\t{{ item.text }}\n\t\t</div>\n\t`};const R={name:"TitleIconComponent",props:{item:{type:Object,required:true}},computed:{currentIconCssClass(){return c[this.item.icon]||c.IMAGE}},template:`\n\t\t<div class="bizproc-setup-template__heading --icon">\n\t\t\t<i class="ui-icon-set" :class="'--' + currentIconCssClass"></i>\n\t\t\t<div class="bizproc-setup-template__heading-text">\n\t\t\t\t{{ item.text }}\n\t\t\t</div>\n\t\t</div>\n\n\t`};const N={[p.TITLE]:"TitleComponent",[p.TITLE_WITH_ICON]:"TitleIconComponent",[p.DESCRIPTION]:"DescriptionComponent",[p.DELIMITER]:"DelimiterComponent",[p.CONSTANT]:"ConstantComponent"};const F={name:"FormElement",components:{TitleComponent:O,TitleIconComponent:R,DelimiterComponent:A,DescriptionComponent:x,ConstantComponent:V},props:{item:{type:Object,required:true},formData:{type:Object,required:true},errors:{type:Object,required:true}},emits:["constantUpdate"],computed:{componentName(){return N[this.item.itemType]||null},constantFormData(){if(this.item.itemType===p.CONSTANT){return this.formData}return undefined}},methods:{constantUpdate(t,e){this.$emit("constantUpdate",t,e)}},template:`\n\t\t<component\n\t\t\tv-if="componentName"\n\t\t\t:is="componentName"\n\t\t\t:item="item"\n\t\t\t:formData="constantFormData"\n\t\t\t:error="errors[item.id]"\n\t\t\t@constantUpdate="constantUpdate"\n\t\t/>\n\t`};const L=2;const B="Bizproc:SetupTemplate:beforeSubmit";const z={name:"ActivatorAppComponent",components:{FormElement:F},provide(){return{templateId:this.templateId}},props:{templateId:{type:Number,required:true},templateName:{type:String,required:true},templateDescription:{type:String,default:""},instanceId:{type:String,required:true},blocks:{type:Array,required:true}},data(){return{currentStep:1,isLoading:false,submitError:"",validationErrors:{},formData:this.getFormDataWithDefaultValues()}},computed:{allConstants(){return this.blocks.flatMap((t=>t.items)).filter((t=>t.itemType===p.CONSTANT))},isBtnDisabled(){return this.isLoading},isFirstStep(){return this.currentStep===1},totalSteps(){return L},buttonText(){const t=this.isFirstStep?"BIZPROC_JS_AI_AGENTS_ACTIVATOR_CONTINUE_BUTTON":"BIZPROC_JS_AI_AGENTS_ACTIVATOR_RUN_BUTTON";return this.$Bitrix.Loc.getMessage(t)},buttonClickHandler(){return this.isFirstStep?this.proceedToNextStep:this.handleSubmit}},methods:{getFormDataWithDefaultValues(){const t={};this.blocks.forEach((e=>{e.items.forEach((e=>{if(e.itemType===p.CONSTANT){var i;t[e.id]=(i=e.default)!=null?i:""}}))}));return t},getPreparedDataForRequest(){const t={};this.allConstants.forEach((e=>{const i=e.id;const n=this.formData[i];if(this.isValueEmpty(n)){return}if(l.Type.isArray(n)){let s=n.filter((t=>!this.isValueEmpty(t)));if(s.length===0){return}if(e.constantType===u.INT){s=s.map(Number)}t[i]=s}else if(e.constantType===u.INT){t[i]=Number(n)}else{t[i]=n}}));return t},activateTemplateRequest(){const t="bizproc.v2.SetupTemplate.fill";const e=this.getPreparedDataForRequest();return l.ajax.runAction(t,{data:{templateId:this.templateId,instanceId:this.instanceId,constantValues:e}})},getErrorFromResponse(t){if(!t.errors){return""}if(!l.Type.isArrayFilled(t.errors)){return this.$Bitrix.Loc.getMessage("BIZPROC_JS_AI_AGENTS_ACTIVATOR_UNEXPECTED_ERROR")}const[e]=t.errors;return e.message},async handleSubmit(){if(!this.validateForm()){return}this.isLoading=true;this.submitError="";try{const t=await n.EventEmitter.emitAsync(B);if(t.includes(false)){this.isLoading=false;return}await this.activateTemplateRequest();const e=new n.BaseEvent({data:{templateId:this.templateId}});n.EventEmitter.emit(m.SUCCESS,e);BX.SidePanel.Instance.close()}catch(t){this.submitError=this.getErrorFromResponse(t)}this.isLoading=false},handleCancel(){BX.SidePanel.Instance.close()},onConstantUpdate(t,e){this.formData[t]=e;if(this.validationErrors[t]&&!this.isValueEmpty(e)){delete this.validationErrors[t]}},isValueEmpty(t){if(l.Type.isArray(t)&&t.length===0){return true}const e=(t!=null?t:"").toString();return e.trim().length===0},validateForm(){this.validationErrors={};const t=this.allConstants.filter((t=>t.constantType!==u.KNOWLEDGE));t.forEach((t=>{const e=this.formData[t.id];if(t.required&&this.isValueEmpty(e)){this.validationErrors[t.id]=this.$Bitrix.Loc.getMessage("BIZPROC_JS_AI_AGENTS_ACTIVATOR_FORM_VALIDATION_ERROR")}else if(t.constantType===u.INT&&this.isNotNumber(e)){this.validationErrors[t.id]=this.$Bitrix.Loc.getMessage("BIZPROC_JS_AI_AGENTS_ACTIVATOR_FORM_VALIDATION_ERROR_INT",{"#FIELD_NAME#":t.name})}}));return Object.keys(this.validationErrors).length===0},isNotNumber(t){const e=t=>{if(this.isValueEmpty(t)){return false}return Number.isNaN(Number(t))};if(l.Type.isArray(t)){return t.some((t=>e(t)))}return e(t)},proceedToNextStep(){this.currentStep++},isCurrentStep(t){return this.currentStep===t}},template:`\n\t\t<div class="bizproc-setup-template__form" data-test-id="bizproc-setup-template__form-container">\n\t\t\t<div class="ui-sidepanel-layout-header">\n\t\t\t\t<div class="ui-sidepanel-layout-title">\n\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_JS_AI_AGENTS_ACTIVATOR_TITLE') }}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui-sidepanel-layout-content ui-sidepanel-layout-content-margin">\n\t\t\t\t<div class="ui-sidepanel-layout-content-inner">\n\t\t\t\t\t<div class="bizproc-setup-template__progress-bar">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tv-for="step in totalSteps"\n\t\t\t\t\t\t\t:key="step"\n\t\t\t\t\t\t\tclass="bizproc-setup-template__progress-item"\n\t\t\t\t\t\t\t:class="{ '--active': isCurrentStep(step) }"\n\t\t\t\t\t\t></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<template v-if="isFirstStep">\n\t\t\t\t\t\t<div class="ui-slider-section">\n\t\t\t\t\t\t\t<div class="bizproc-setup-template__heading">\n\t\t\t\t\t\t\t\t{{ templateName }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="bizproc-setup-template__subject">\n\t\t\t\t\t\t\t\t{{ templateDescription }}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<div v-if="submitError" class="ui-alert ui-alert-danger">\n\t\t\t\t\t\t\t<span class="ui-alert-message">{{ submitError }}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<template v-for="block in blocks" :key="block.id">\n\t\t\t\t\t\t\t<div class="ui-slider-section">\n\t\t\t\t\t\t\t\t<div class="ui-slider-content-box">\n\t\t\t\t\t\t\t\t\t<FormElement\n\t\t\t\t\t\t\t\t\t\tv-for="item in block.items"\n\t\t\t\t\t\t\t\t\t\t:key="item.id"\n\t\t\t\t\t\t\t\t\t\t:item="item"\n\t\t\t\t\t\t\t\t\t\t:formData="formData"\n\t\t\t\t\t\t\t\t\t\t:errors="validationErrors"\n\t\t\t\t\t\t\t\t\t\t@constantUpdate="onConstantUpdate"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</template>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui-sidepanel-layout-footer-anchor"></div>\n\t\t\t<div class="ui-sidepanel-layout-footer">\n\t\t\t\t<div class="ui-sidepanel-layout-buttons ui-sidepanel-layout-buttons-align-left">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="ui-btn --air ui-btn-lg --style-filled ui-btn-no-caps"\n\t\t\t\t\t\t:class="{'ui-btn-wait': isLoading}"\n\t\t\t\t\t\t:disabled="isBtnDisabled"\n\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\t@click="buttonClickHandler"\n\t\t\t\t\t\tdata-test-id="bizproc-setup-template__form-submit-button"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t<span class="ui-btn-text-inner">\n\t\t\t\t\t\t\t\t{{ buttonText }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass="ui-btn --air ui-btn-lg --style-plain ui-btn-no-caps"\n\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\t@click="handleCancel"\n\t\t\t\t\t\tdata-test-id="bizproc-setup-template__form-cancel-button"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span class="ui-btn-text">\n\t\t\t\t\t\t\t<span class="ui-btn-text-inner">\n\t\t\t\t\t\t\t\t{{ $Bitrix.Loc.getMessage('BIZPROC_JS_AI_AGENTS_ACTIVATOR_CANCEL_BUTTON') }}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t`};let D=t=>t,P;var w=babelHelpers.classPrivateFieldLooseKey("pushData");var $=babelHelpers.classPrivateFieldLooseKey("container");var U=babelHelpers.classPrivateFieldLooseKey("application");class M{constructor(t){Object.defineProperty(this,w,{writable:true,value:void 0});Object.defineProperty(this,$,{writable:true,value:void 0});Object.defineProperty(this,U,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,$)[$]=t.container;babelHelpers.classPrivateFieldLooseBase(this,w)[w]=t.pushData}mount(){babelHelpers.classPrivateFieldLooseBase(this,U)[U]=i.BitrixVue.createApp(z,{templateId:babelHelpers.classPrivateFieldLooseBase(this,w)[w].templateId,templateName:babelHelpers.classPrivateFieldLooseBase(this,w)[w].templateName,templateDescription:babelHelpers.classPrivateFieldLooseBase(this,w)[w].templateDescription,instanceId:babelHelpers.classPrivateFieldLooseBase(this,w)[w].instanceId,blocks:babelHelpers.classPrivateFieldLooseBase(this,w)[w].blocks});babelHelpers.classPrivateFieldLooseBase(this,U)[U].mount(babelHelpers.classPrivateFieldLooseBase(this,$)[$])}unmount(){if(babelHelpers.classPrivateFieldLooseBase(this,U)[U]){babelHelpers.classPrivateFieldLooseBase(this,U)[U].unmount()}}static createLayout(t){const e=l.Tag.render(P||(P=D`<div class="ui-sidepanel-layout"></div>`));const i=new M({container:e,pushData:t});i.mount();return e}static showSidePanel(t){BX.SidePanel.Instance.open("bizproc:setup-template-fill",{width:700,cacheable:false,contentCallback:()=>M.createLayout(t)})}static subscribeOnPull(){e.PULL.subscribe({moduleId:"bizproc",command:"setupTemplateActivityBlocks",callback:t=>{M.showSidePanel(t)}})}}t.SetupTemplate=M;t.ActivatorAppComponent=z;t.FormElement=F})(this.BX.Bizproc=this.BX.Bizproc||{},BX,BX.Vue3,BX.Event,BX.Bizproc.RagSelector,BX.UI.EntitySelector,BX,BX.UI.Uploader,BX.UI.Uploader);
//# sourceMappingURL=setup-template.bundle.map.js