this.BX=this.BX||{};(function(e,t,n,a,i,r,o){"use strict";var s=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"setStyle",value:function e(t,n){Object.entries(n).forEach((function(e){var n=babelHelpers.slicedToArray(e,2),a=n[0],i=n[1];t.style[a]=i}))}}]);return e}();var l;function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this["class"]={pin:"feed-post-pin",post:"feed-item-wrap",postHide:"feed-item-wrap-hide",postComments:"feed-comments-block",postPinned:"feed-post-block-pinned",postPinnedHide:"feed-post-block-pinned-hide",postPinActive:"feed-post-block-pin-active",postUnfollowed:"feed-post-block-unfollowed",postExpanding:"feed-post-block-expand",panelCollapsed:"feed-pinned-panel-collapsed",panelNonEmpty:"feed-pinned-panel-nonempty",panelPosts:"feed-pinned-panel-posts",collapsedPanel:"feed-post-collapsed-panel",collapsedPanelExpand:"feed-post-collapsed-panel-right",collapsedPanelCounterPostsValue:"feed-post-collapsed-panel-count-posts",collapsedPanelCounterComments:"feed-post-collapsed-panel-box-comments",collapsedPanelCounterCommentsValue:"feed-post-collapsed-panel-count-comments-value",collapsedPanelCounterCommentsShown:"feed-post-collapsed-panel-box-shown",collapsedPanelCounterCommentsValueNew:"feed-inform-comments-pinned-new",collapsedPanelCounterCommentsValueNewValue:"feed-inform-comments-pinned-new-value",collapsedPanelCounterCommentsValueNewActive:"feed-inform-comments-pinned-new-active",collapsedPanelCounterCommentsValueOld:"feed-inform-comments-pinned-old",collapsedPanelCounterCommentsValueAll:"feed-inform-comments-pinned-all",collapsedPanelShow:"feed-post-collapsed-panel--show",collapsedPanelHide:"feed-post-collapsed-panel--hide",cancelPanel:"feed-post-cancel-pinned-panel",cancelPanelButton:"feed-post-cancel-pinned-btn",cancelPanelLabel:"feed-post-cancel-pinned-label"};this.panelInitialized=false;this.postsInitialized=false;this.handlePostClick=this.handlePostClick.bind(this);this.options={};i.Event.ready((function(){t.initPosts()}))}babelHelpers.createClass(e,[{key:"resetFlags",value:function e(){this.panelInitialized=false;this.postsInitialized=false}},{key:"init",value:function e(){this.initPanel();this.initPosts();this.initEvents()}},{key:"setOptions",value:function e(t){this.options=u(u({},this.options),t)}},{key:"getOption",value:function e(t){return this.options[t]}},{key:"initPanel",value:function e(){var t=this;if(this.panelInitialized){return}var n=this.getPanelNode();if(!n){return}this.panelInitialized=true;this.adjustCollapsedPostsPanel();i.Event.bind(this.getCollapsedPanelNode(),"click",(function(){var e=t.getPanelNode();if(!e){return}var n=e.offsetHeight;s.setStyle(e,{height:n+"px",transition:"height .5s"});setTimeout((function(){e.style=""}),550);t.hideCollapsedPanel()}));i.Event.bind(n,"click",(function(e){var n=e.target.classList.contains("feed-inform-ilike")||e.target.closest(".feed-inform-ilike")!==null;var o=e.target.classList.contains("feed-inform-follow")||e.target.closest(".feed-inform-follow")!==null;var s=e.target.classList.contains("feed-post-more-link")||e.target.closest(".feed-post-more-link")!==null||e.target.classList.contains("feed-post-right-top-menu");var l=e.target.classList.contains("feed-inform-contentview")||e.target.closest(".feed-inform-contentview")!==null;var c=e.target.classList.contains("".concat(t["class"].pin))||e.target.closest(".".concat(t["class"].pin))!==null;var u=e.target.classList.contains("feed-post-pinned-link-collapse");var d=e.target.classList.contains("feed-inform-comments-pinned")||e.target.closest(".feed-inform-comments-pinned")!==null;var f=null;if(e.target.classList.contains("feed-post-block")){f=e.target}else{f=e.target.closest(".feed-post-block")}if(!f){return}if(f.classList.contains("".concat(t["class"].postPinned))){if(!n&&!o&&!s&&!l&&!c){f.classList.remove("".concat(t["class"].postPinned));var p=f.getAttribute("data-menu-id");if(p){a.MenuManager.destroy(p)}var h=new r.BaseEvent({compatData:[{rootNode:f}],data:{rootNode:f}});r.EventEmitter.emit("BX.Livefeed:recalculateComments",h)}if(d){var m=f.querySelector(".".concat(t["class"].postComments," a[name=comments]"));if(m){var y=i.Dom.getPosition(m);window.scrollTo(0,y.top-200)}}e.stopPropagation();e.preventDefault()}else if(u){f.classList.add("".concat(t["class"].postPinned));e.stopPropagation();e.preventDefault()}}))}},{key:"initPosts",value:function e(){var t=this;if(this.postsInitialized){return}var n=document.querySelectorAll("[data-livefeed-post-pinned]");if(n.length>0){this.postsInitialized=true}Array.from(n).forEach((function(e){i.Event.unbind(e,"click",t.handlePostClick);i.Event.bind(e,"click",t.handlePostClick)}))}},{key:"handlePostClick",value:function e(t){if(!t.target.classList.contains("".concat(this["class"].pin))){return}var n=t.target.closest("[data-livefeed-id]");if(!n){return}var a=n.getAttribute("data-livefeed-post-pinned")==="Y"?"N":"Y";var i=parseInt(n.getAttribute("data-livefeed-id"));if(i<=0){return}this.changePinned({logId:i,newState:a,event:t}).then((function(){}))}},{key:"initEvents",value:function e(){var t=this;r.EventEmitter.subscribe("OnUCCommentWasRead",(function(e){var n=e.getData(),a=babelHelpers.slicedToArray(n,3),r=a[0],o=a[1],s=a[2];var l=t.getCommentsData(r),c=l.oldValue,u=l.newValue;if(!!s["new"]){t.setCommentsData(r,{newValue:i.Type.isInteger(u)?u-1:0,oldValue:i.Type.isInteger(c)?c+1:1})}}));r.EventEmitter.incrementMaxListeners("OnUCCommentWasPulled");r.EventEmitter.subscribe("OnUCCommentWasPulled",(function(e){var n=e.getData(),a=babelHelpers.slicedToArray(n,3),r=a[0],o=a[1],s=a[2];var l=babelHelpers.slicedToArray(r,2),c=l[0],u=l[1];var d=t.getCommentsData(c),f=d.newValue,p=d.oldValue,h=d.allValue,m=d.follow;var y={allValue:i.Type.isInteger(h)?h+1:1};if(parseInt(s.AUTHOR.ID)!==parseInt(BX.message("USER_ID"))){y.newValue=i.Type.isInteger(f)?f+1:1}else{y.oldValue=i.Type.isInteger(p)?p+1:1}t.setCommentsData(c,y)}));r.EventEmitter.subscribe("OnUCommentWasDeleted",(function(e){var n=e.getData(),a=babelHelpers.slicedToArray(n,3),r=a[0],o=a[1],s=a[2];var l=t.getCommentsData(r),c=l.oldValue,u=l.allValue;t.setCommentsData(r,{allValue:i.Type.isInteger(u)?u-1:0,oldValue:i.Type.isInteger(c)?c-1:0})}))}},{key:"changePinned",value:function e(t){var n=this;var a=t.logId?parseInt(t.logId):0;var r=t.event?t.event:null;var o=t.node?t.node:null;var s=t.newState?t.newState:null;var l=this.getPanelNode();if(!o&&!r&&a>0&&l){o=l.querySelector(".".concat(this["class"].post,' > [data-livefeed-id="').concat(a,'"]'))}if(!o&&r){o=r.target}return new Promise((function(e,t){if(!!n.getOption("pinBlocked")||!o||!s){return e()}n.setPostState({node:o,state:s});var r=s==="Y"?"socialnetwork.api.livefeed.logentry.pin":"socialnetwork.api.livefeed.logentry.unpin";i.ajax.runAction(r,{data:{params:{logId:a}},analyticsLabel:{b24statAction:s==="Y"?"pinLivefeedEntry":"unpinLivefeedEntry"}}).then((function(t){if(!t.data.success){n.setPostState({node:o,state:s==="Y"?"N":"Y"});return e()}else{n.movePost({node:o,state:s}).then((function(){return e()}))}}),(function(t){n.setPostState({node:o,state:s==="Y"?"N":"Y"});return e()}))}))}},{key:"setPostState",value:function e(t){var n=t.state?t.state:null;var a=t.node?t.node:null;if(!a||!["Y","N"].includes(n)){return}var r=a.closest("[data-livefeed-post-pinned]");if(!r){return}r.setAttribute("data-livefeed-post-pinned",n);if(n==="Y"){r.classList.add("".concat(this["class"].postPinActive))}else{r.classList.remove("".concat(this["class"].postPinActive))}var o=r.querySelector(".".concat(this["class"].pin));if(o){o.setAttribute("title",i.Loc.getMessage("SONET_EXT_LIVEFEED_PIN_TITLE_".concat(n)))}}},{key:"getPanelNode",value:function e(){return document.querySelector("[data-livefeed-pinned-panel]")}},{key:"getPinnedData",value:function e(t){var n=t.logId?parseInt(t.logId):0;if(n<=0){return Promise.reject()}return new Promise((function(e,a){i.ajax.runAction("socialnetwork.api.livefeed.logentry.getPinData",{data:{params:{logId:n}},headers:[{name:i.Loc.getMessage("SONET_EXT_LIVEFEED_AJAX_ENTITY_HEADER_NAME"),value:t.entityValue||""},{name:i.Loc.getMessage("SONET_EXT_LIVEFEED_AJAX_TOKEN_HEADER_NAME"),value:t.tokenValue||""}]}).then((function(t){return e(t.data)}),(function(e){return a()}))}))}},{key:"movePost",value:function e(t){var n=this;var a=t.state?t.state:null;var r=t.node?t.node:null;return new Promise((function(e,t){if(!r||!["Y","N"].includes(a)){return e()}var o=r.closest("[data-livefeed-post-pinned]");if(!o){return e()}var l=parseInt(o.getAttribute("data-livefeed-id"));if(!l){return e()}var c=n.getPanelNode();if(!c){return e()}var u=o.parentNode.classList.contains("".concat(n["class"].post))?o.parentNode:o;var d=o.getAttribute("data-security-entity-pin");var f=o.getAttribute("data-security-token-pin");if(a==="Y"){var p=u.offsetHeight;u.setAttribute("bx-data-height",p);n.getPinnedData({logId:l,entityValue:d,tokenValue:f}).then((function(t){var a=o.querySelector(".feed-post-pinned-title");var r=o.querySelector(".feed-post-pinned-desc");var d=o.querySelector(".".concat(n["class"].pin));if(a){a.innerHTML=t.TITLE}if(r){r.innerHTML=t.DESCRIPTION}if(d){d.title=i.Loc.getMessage("SONET_EXT_LIVEFEED_PIN_TITLE_Y")}o.classList.add("".concat(n["class"].postPinnedHide));var f=n.getCancelPinnedPanel({logId:l});var h=u.nextSibling;h.parentNode.insertBefore(f,h);n.centerCancelPinnedPanelElements({cancelPinnedPanel:f});f.setAttribute("bx-data-height",p);var m=f.getAttribute("bx-data-height");s.setStyle(f,{height:m+"px"});s.setStyle(u,{position:"absolute",width:"100%",height:p+"px",backgroundColor:"transparent",opacity:0});var y=n.getPanelNode();if(y){n.setOptions({panelHeight:y.offsetHeight})}setTimeout((function(){u.classList.add("".concat(n["class"].postHide));s.setStyle(f,{height:"53px"});s.setStyle(u,{height:0,opacity:0});n.setOptions({pinBlocked:true})}),100);i.Event.unbindAll(u,"transitionend");i.Event.bind(u,"transitionend",(function(e){if(!n.checkTransitionProperty(e,"height")){return}i.Event.unbindAll(u,"transitionend");var t=c.querySelector(".".concat(n["class"].panelPosts));t.insertBefore(u,t.firstChild);n.adjustCollapsedPostsPanel();u.classList.remove("".concat(n["class"].postHide));o.classList.remove("".concat(n["class"].postPinnedHide));n.adjustPanel();n.showCollapsedPostsPanel();setTimeout((function(){o.classList.add("".concat(n["class"].postPinned));s.setStyle(u,{position:"",width:"",height:"80px",backgroundColor:"",opacity:1});n.setOptions({pinBlocked:false});setTimeout((function(){u.classList.remove("".concat(n["class"].postHide));s.setStyle(u,{position:"",width:"",height:"",backgroundColor:"",opacity:""})}),600)}),300)}));return e()}))}else{var h=u.getAttribute("bx-data-height");var m=u.scrollHeight;s.setStyle(u,{transition:""});var y=document.querySelector(".".concat(n["class"].cancelPanel,'[bx-data-log-id="').concat(l,'"]'));if(i.Type.isDomNode(y)){s.setStyle(u,{height:m+"px"});requestAnimationFrame((function(){u.classList.add("".concat(n["class"].postExpanding));y.classList.add("".concat(n["class"].postExpanding));s.setStyle(u,{opacity:0,height:0});s.setStyle(y,{opacity:0,height:0})}));var v=c.classList.contains("".concat(n["class"].panelCollapsed));if(v){y.parentNode.insertBefore(u,y.nextSibling);n.adjustCollapsedPostsPanel();n.adjustPanel()}var g=n.getCollapsedPanelNode().classList.contains("".concat(n["class"].collapsedPanelShow));if(g){n.hideCollapsedPostsPanel();i.Event.unbindAll(y,"transitionend");i.Event.bind(y,"transitionend",(function(e){if(!n.checkTransitionProperty(e,"height")){return}s.setStyle(u,{transform:"",display:"block"});n.animateCancel({post:o,postToMove:u,cancelPinnedPanel:y,height:h})}))}i.Event.unbindAll(u,"transitionend");i.Event.bind(u,"transitionend",(function(e){if(!n.checkTransitionProperty(e,"opacity")){return}if(!v){y.parentNode.insertBefore(u,y.nextSibling);n.adjustCollapsedPostsPanel();n.adjustPanel()}n.animateCancel({post:o,postToMove:u,cancelPinnedPanel:y,height:h})}))}else{o.classList.remove("".concat(n["class"].postPinned));c.parentNode.insertBefore(u,c.nextSibling);n.adjustPanel();var E=u.scrollHeight;u.setAttribute("bx-data-height",E);s.setStyle(u,{opacity:0,height:"80px"});setTimeout((function(){s.setStyle(u,{opacity:1,height:E+"px"})}),100);i.Event.unbindAll(u,"transitionend");i.Event.bind(u,"transitionend",(function(e){if(!n.checkTransitionProperty(e,"height")){return}s.setStyle(u,{height:""})}))}return e()}}))}},{key:"animateCancel",value:function e(t){var n=this;var a=t.post,r=t.postToMove,o=t.cancelPinnedPanel,l=t.height;a.classList.remove("".concat(this["class"].postPinned));setTimeout((function(){s.setStyle(r,{opacity:1,height:l+"px"});s.setStyle(o,{height:0});setTimeout((function(){o.remove()}),100)}),100);i.Event.unbindAll(r,"transitionend");i.Event.bind(r,"transitionend",(function(e){if(!n.checkTransitionProperty(e,"height")){return}a.classList.remove("".concat(n["class"].postPinnedHide));s.setStyle(r,{marginBottom:"",height:""});s.setStyle(o,{marginBottom:"",height:""});r.classList.remove("".concat(n["class"].postExpanding));o.classList.remove("".concat(n["class"].postExpanding))}))}},{key:"getCancelPinnedPanel",value:function e(t){var n=this;var a=t.logId?parseInt(t.logId):0;if(a<=0){return null}var r=document.querySelector(".".concat(this["class"].cancelPanel,'[bx-data-log-id="').concat(a,'"]'));if(!i.Type.isDomNode(r)){r=i.Tag.render(l||(l=babelHelpers.taggedTemplateLiteral(['\n\t\t\t\t<div class="','" bx-data-log-id="','">\n\t\t\t\t\t<div class="feed-post-cancel-pinned-panel-inner">\n\t\t\t\t\t\t<div class="feed-post-cancel-pinned-content">\n\t\t\t\t\t\t\t<span class="','">','</span>\n\t\t\t\t\t\t\t<span class="feed-post-cancel-pinned-text">','</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button class="ui-btn ui-btn-light-border ui-btn-round ui-btn-sm ','">',"</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\t\n\t\t\t\t"])),this["class"].cancelPanel,a,this["class"].cancelPanelLabel,i.Loc.getMessage("SONET_EXT_LIVEFEED_PINNED_CANCEL_TITLE"),i.Loc.getMessage("SONET_EXT_LIVEFEED_PINNED_CANCEL_DESCRIPTION"),this["class"].cancelPanelButton,i.Loc.getMessage("SONET_EXT_LIVEFEED_PINNED_CANCEL_BUTTON"));i.Event.bind(r.querySelector(".".concat(this["class"].cancelPanelButton)),"click",(function(){n.changePinned({logId:a,newState:"N"}).then((function(){s.setStyle(r,{opacity:0,height:0})}))}))}return r}},{key:"centerCancelPinnedPanelElements",value:function e(t){var n=t.cancelPinnedPanel;if(!i.Type.isDomNode(n)){return}setTimeout((function(){s.setStyle(n,{opacity:1})}),100);s.setStyle(n.querySelector(".".concat(this["class"].cancelPanelLabel)),{marginLeft:n.querySelector(".".concat(this["class"].cancelPanelButton)).getBoundingClientRect().width+"px"})}},{key:"getPostsCount",value:function e(){var t=this.getPanelNode();return t?Array.from(t.getElementsByClassName("".concat(this["class"].post))).length:0}},{key:"hidePinnedItems",value:function e(){var t=this;var n=this.getPanelNode();if(!n){return}s.setStyle(n,{height:parseInt(this.getOption("panelHeight"))+"px"});Array.from(n.getElementsByClassName("".concat(this["class"].post))).reduce((function(e,a){e+=a.offsetHeight;s.setStyle(a,{transition:"opacity .1s linear, transform .2s .1s linear, height .5s linear"});s.setStyle(n,{transition:"height .5s .1s linear"});requestAnimationFrame((function(){s.setStyle(a,{opacity:"0!important",transform:"translateY(-".concat(e,"px)")});s.setStyle(n,{height:"58px"})}));i.Event.unbindAll(a,"transitionend");i.Event.bind(a,"transitionend",(function(e){if(!t.checkTransitionProperty(e,"transform")){return}s.setStyle(a,{display:"none",opacity:"",transform:"",transition:""});s.setStyle(n,{transition:""})}));return e}),0)}},{key:"showPinnedItems",value:function e(){var t=this;var n=this.getPanelNode();if(!n){return}Array.from(n.getElementsByClassName("".concat(this["class"].post))).map((function(e,a,r){s.setStyle(e,{display:"block",opacity:0});requestAnimationFrame((function(){s.setStyle(n,{height:84*(a+1)-4+"px"});s.setStyle(e,{transform:"translateY(".concat(0,"px)"),opacity:1})}));i.Event.unbindAll(e,"transitionend");i.Event.bind(e,"transitionend",(function(i){if(!t.checkTransitionProperty(i,"transform")){return}s.setStyle(e,{display:"block",height:"",transform:""});s.setStyle(n,{height:""});if(a+1===r.length){s.setStyle(n,{transition:"",height:""})}}))}))}},{key:"animateCollapsedPanel",value:function e(){var t=this;requestAnimationFrame((function(){var e=t.getCollapsedPanelNode();s.setStyle(e,{position:"absolute",top:0,width:"100%",opacity:0});e.classList.remove("".concat(t["class"].collapsedPanelHide));e.classList.add("".concat(t["class"].collapsedPanelShow));requestAnimationFrame((function(){s.setStyle(e,{position:"relative",opacity:1})}))}))}},{key:"adjustCollapsedPostsPanel",value:function e(){var t=this;var n=this.getPostsCount();var a=this.getCollapsedPanelNode().querySelector(".".concat(this["class"].collapsedPanelCounterPostsValue));if(a){a.innerHTML=parseInt(n)}var i=this.getCollapsedPanelNode().querySelector(".".concat(this["class"].collapsedPanelCounterComments));var r=this.getCollapsedPanelNode().querySelector(".".concat(this["class"].collapsedPanelCounterCommentsValue));var o=this.getPanelNode();if(i&&r&&o){var s=Array.from(o.querySelectorAll(".".concat(this["class"].collapsedPanelCounterCommentsValueNewValue))).reduce((function(e,n){return e+(n.closest(".".concat(t["class"].postUnfollowed))?0:parseInt(n.innerHTML))}),0);r.innerHTML=s;if(s>0){i.classList.add("".concat(this["class"].collapsedPanelCounterCommentsShown))}else{i.classList.remove("".concat(this["class"].collapsedPanelCounterCommentsShown))}}}},{key:"adjustPanel",value:function e(){var t=this;var n=this.getPanelNode();if(!n){return}setTimeout((function(){if(t.getPostsCount()>0){n.classList.add("".concat(t["class"].panelNonEmpty))}else{n.classList.remove("".concat(t["class"].panelNonEmpty))}}),0)}},{key:"showCollapsedPostsPanel",value:function e(){if(this.getPostsCount()>=i.Loc.getMessage("SONET_EXT_LIVEFEED_COLLAPSED_PINNED_PANEL_ITEMS_LIMIT")){this.showCollapsedPanel();this.hidePinnedItems()}}},{key:"hideCollapsedPostsPanel",value:function e(){if(this.getPostsCount()<i.Loc.getMessage("SONET_EXT_LIVEFEED_COLLAPSED_PINNED_PANEL_ITEMS_LIMIT")){this.getPanelNode().classList.remove("".concat(this["class"].panelCollapsed));this.removeCollapsedPanel();this.showPinnedItems()}}},{key:"showCollapsedPanel",value:function e(){this.getPanelNode().classList.add("".concat(this["class"].panelCollapsed));this.animateCollapsedPanel()}},{key:"hideCollapsedPanel",value:function e(){this.getPanelNode().classList.remove("".concat(this["class"].panelCollapsed));this.showPinnedItems();this.removeCollapsedPanel()}},{key:"removeCollapsedPanel",value:function e(){var t=this.getCollapsedPanelNode();s.setStyle(t,{position:"absolute",top:0,width:"100%"});t.classList.remove("".concat(this["class"].collapsedPanelShow));t.classList.add("".concat(this["class"].collapsedPanelHide))}},{key:"getCommentsNodes",value:function e(t){var n={follow:true,newNode:null,newValueNode:null,oldNode:null,allNode:null};if(!i.Type.isStringFilled(t)){return n}var a=document.querySelector(".".concat(this["class"].postComments,'[data-bx-comments-entity-xml-id="').concat(t,'"]'));if(!a){return n}var r=a.closest(".".concat(this["class"].postPinActive));if(!r){return n}var o=r.querySelector(".".concat(this["class"].collapsedPanelCounterCommentsValueNew));var s=r.querySelector(".".concat(this["class"].collapsedPanelCounterCommentsValueNewValue));var l=r.querySelector(".".concat(this["class"].collapsedPanelCounterCommentsValueOld));var c=r.querySelector(".".concat(this["class"].collapsedPanelCounterCommentsValueAll));if(!o||!s||!l||!c){return n}n.newNode=o;n.newValueNode=s;n.oldNode=l;n.allNode=c;n.follow=a.getAttribute("data-bx-follow")!=="N";return n}},{key:"getCommentsData",value:function e(t){var n={newValue:null,oldValue:null,allValue:null};if(!i.Type.isStringFilled(t)){return n}var a=this.getCommentsNodes(t),r=a.newValueNode,o=a.oldNode,s=a.allNode,l=a.follow;n.follow=l;if(!i.Type.isDomNode(r)||!i.Type.isDomNode(o)){return n}var c=0;var u=0;var d=0;var f=r.innerHTML.match(/(\d+)/);if(f){c=parseInt(f[1])}f=o.innerHTML.match(/(\d+)/);if(f){u=parseInt(f[1])}f=s.innerHTML.match(/(\d+)/);if(f){d=parseInt(f[1])}n.oldValue=u;n.newValue=c;n.allValue=d;return n}},{key:"setCommentsData",value:function e(t,n){if(!i.Type.isStringFilled(t)){return}var a=this.getCommentsNodes(t),r=a.newNode,o=a.newValueNode,s=a.oldNode,l=a.allNode;if(!i.Type.isDomNode(r)||!i.Type.isDomNode(o)||!i.Type.isDomNode(s)||!i.Type.isDomNode(l)){return}if(i.Type.isInteger(n.newValue)){o.innerHTML="".concat(n.newValue);if(n.newValue>0&&!r.classList.contains("".concat(this["class"].collapsedPanelCounterCommentsValueNewActive))){r.classList.add("".concat(this["class"].collapsedPanelCounterCommentsValueNewActive))}else if(n.newValue<=0&&r.classList.contains("".concat(this["class"].collapsedPanelCounterCommentsValueNewActive))){r.classList.remove("".concat(this["class"].collapsedPanelCounterCommentsValueNewActive))}}if(i.Type.isInteger(n.oldValue)){s.innerHTML=n.oldValue}if(i.Type.isInteger(n.allValue)){l.innerHTML=n.allValue}this.adjustCollapsedPostsPanel()}},{key:"getCollapsedPanelNode",value:function e(){return this.getPanelNode().querySelector(".".concat(this["class"].collapsedPanel))}},{key:"checkTransitionProperty",value:function e(t,n){return t.propertyName===n}}]);return e}();function f(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */f=function t(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function e(t,n,a){return t[n]=a}}function c(e,t,n,i){var r=t&&t.prototype instanceof p?t:p,o=Object.create(r.prototype),s=new w(i||[]);return a(o,"_invoke",{value:I(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function p(){}function h(){}function m(){}var y={};l(y,r,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(S([])));g&&g!==t&&n.call(g,r)&&(y=g);var E=m.prototype=p.prototype=Object.create(y);function T(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function i(a,r,o,s){var l=u(e[a],e,r);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==babelHelpers["typeof"](d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var r;a(this,"_invoke",{value:function e(n,a){function o(){return new t((function(e,t){i(n,a,e,t)}))}return r=r?r.then(o,o):o()}})}function I(e,t,n){var a="suspendedStart";return function(i,r){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw r;return C()}for(n.method=i,n.arg=r;;){var o=n.delegate;if(o){var s=_(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var l=u(e,t,n);if("normal"===l.type){if(a=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(a="completed",n.method="throw",n.arg=l.arg)}}}function _(e,t){var n=t.method,a=e.iterator[n];if(undefined===a)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=undefined,_(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=u(a,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function S(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=undefined,t.done=!0,t};return i.next=i}}return{next:C}}function C(){return{value:undefined,done:!0}}return h.prototype=m,a(E,"constructor",{value:m,configurable:!0}),a(m,"constructor",{value:h,configurable:!0}),h.displayName=l(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,s,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},T(b.prototype),l(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,a,i,r){void 0===r&&(r=Promise);var o=new b(c(t,n,a,i),r);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},T(E),l(E,s,"Generator"),l(E,r,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=S,w.prototype={constructor:w,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(k),!t)for(var a in this)"t"===a.charAt(0)&&n.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var a=this;function i(e,n){return s.type="throw",s.arg=t,a.next=e,n&&(a.method="next",a.arg=undefined),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function e(t,a){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=a&&a<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=a,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(s)},complete:function e(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),d},finish:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),k(a),d}},catch:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc===t){var i=a.completion;if("throw"===i.type){var r=i.arg;k(a)}return r}}throw new Error("illegal catch attempt")},delegateYield:function e(t,n,a){return this.delegate={iterator:S(t),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=undefined),d}},e}var p=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"getTaskLinkData",value:function(){var e=babelHelpers.asyncToGenerator(f().mark((function e(t){var n,a;return f().wrap((function e(r){while(1)switch(r.prev=r.next){case 0:r.prev=0;r.next=3;return i.ajax.runAction("intranet.controlbutton.getTaskLink",{data:{entityType:t.entityType,entityId:t.entityId,postEntityType:t.postEntityType}});case 3:n=r.sent;a=n.data;return r.abrupt("return",a);case 8:r.prev=8;r.t0=r["catch"](0);console.error("TaskCreator: getTaskLinkData error",r.t0);return r.abrupt("return",null);case 12:case"end":return r.stop()}}),e,null,[[0,8]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"clearNewTaskFiles",value:function(){var e=babelHelpers.asyncToGenerator(f().mark((function e(t){return f().wrap((function e(n){while(1)switch(n.prev=n.next){case 0:n.prev=0;n.next=3;return i.ajax.runAction("intranet.controlbutton.clearNewTaskFiles",{data:{signedFiles:t}});case 3:n.next=8;break;case 5:n.prev=5;n.t0=n["catch"](0);console.error("TaskCreator: Failed to clear files:",n.t0);case 8:case"end":return n.stop()}}),e,null,[[0,5]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"createEntityComment",value:function(){var e=babelHelpers.asyncToGenerator(f().mark((function e(t,n){var a;return f().wrap((function e(r){while(1)switch(r.prev=r.next){case 0:r.prev=0;a=n.postEntityType;r.next=4;return i.ajax.runAction("socialnetwork.api.livefeed.createEntityComment",{data:{params:{postEntityType:i.Type.isStringFilled(a)?a:n.entityType,sourceEntityType:n.entityType,sourceEntityId:n.entityId,entityType:"TASK",entityId:t,logId:n.logId}}});case 4:r.next=9;break;case 6:r.prev=6;r.t0=r["catch"](0);console.error("TaskCreator: createEntityComment error",r.t0);case 9:case"end":return r.stop()}}),e,null,[[0,6]])})));function t(t,n){return e.apply(this,arguments)}return t}()}]);return e}();var h=Object.freeze({CalendarEvent:"CALENDAR_EVENT",BlogPost:"BLOG_POST",BlogComment:"BLOG_COMMENT"});var m=Object.freeze({Feed:"feed"});var y=Object.freeze({PostContextMenu:"post_context_menu",CommentContextMenu:"comment_context_menu"});var v=Object.freeze({Context:m,Element:y});function g(e,t,n){E(e,t);return n}function E(e,t){if(e!==t){throw new TypeError("Private static access of wrong provenance")}}var T=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"buildCardParams",value:function t(n,a){var i=n.entityType===h.BlogComment;return{taskId:"".concat(n.entityType,"_").concat(Date.now()),createParams:n,requestData:a,description:g(this,e,_).call(this,n.entityType,a),groupId:Number(a.GROUP_ID)||null,parentId:Number(a.PARENT_ID)||null,auditorsIds:a.AUDITORS.split(",").filter((function(e){return e})).map(Number),fileIds:a.UF_TASK_WEBDAV_FILES,source:g(this,e,I).call(this,n),analytics:g(this,e,b).call(this,i)}}}]);return e}();function b(e){return{context:v.Context.Feed,element:e?v.Element.CommentContextMenu:v.Element.PostContextMenu}}function I(e){return{type:e.entityType,entityId:Number(e.entityId),subEntityId:Number(e.logId)||null}}function _(e,t){var n=i.Text.decode(t.DESCRIPTION);var a=t.TITLE;var r=new URL(t.URL,location).toString();var o=i.Type.isStringFilled(t.SUFFIX)?"_".concat(t.SUFFIX):"";var s="SONET_EXT_COMMENTAUX_CREATE_TASK_".concat(e).concat(o);var l=i.Loc.getMessage(s).replace("#A_BEGIN#","[URL=".concat(r,"]")).replace("#A_END#","[/URL]");if(e===h.BlogPost&&i.Type.isStringFilled(a)){return"[QUOTE]".concat(l,"\n\n[B]").concat(a,"[/B]\n\n").concat(n,"[/QUOTE]")}return"[QUOTE]".concat(l,"\n\n").concat(n,"[/QUOTE]")}var L,k,w;function S(e,t,n){C(e,t);t.set(e,n)}function C(e,t){if(t.has(e)){throw new TypeError("Cannot initialize the same private elements twice on an object")}}var P=new Set;var N=new(L=new WeakMap,k=new WeakMap,w=new WeakMap,function(){function e(){babelHelpers.classCallCheck(this,e);S(this,L,{writable:true,value:false});S(this,k,{writable:true,value:function e(t){var n=t.getData(),a=n.task,i=n.initialTask;P.add(i.id);void p.createEntityComment(a.id,i.createParams)}});S(this,w,{writable:true,value:function e(t){var n=t.getData();if(P.has(n.taskId)){return}void p.clearNewTaskFiles(n.requestData.UF_TASK_WEBDAV_FILES_SIGN)}})}babelHelpers.createClass(e,[{key:"init",value:function e(){if(babelHelpers.classPrivateFieldGet(this,L)){return}r.EventEmitter.subscribe("tasks:card:taskAdded",babelHelpers.classPrivateFieldGet(this,k));r.EventEmitter.subscribe("tasks:full-card:closed",babelHelpers.classPrivateFieldGet(this,w));r.EventEmitter.subscribe("tasks:card:closed",babelHelpers.classPrivateFieldGet(this,w));babelHelpers.classPrivateFieldSet(this,L,true)}}]);return e}());function A(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */A=function t(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function e(t,n,a){return t[n]=a}}function c(e,t,n,i){var r=t&&t.prototype instanceof f?t:f,o=Object.create(r.prototype),s=new k(i||[]);return a(o,"_invoke",{value:b(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function f(){}function p(){}function h(){}var m={};l(m,r,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(w([])));v&&v!==t&&n.call(v,r)&&(m=v);var g=h.prototype=f.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function i(a,r,o,s){var l=u(e[a],e,r);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==babelHelpers["typeof"](d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var r;a(this,"_invoke",{value:function e(n,a){function o(){return new t((function(e,t){i(n,a,e,t)}))}return r=r?r.then(o,o):o()}})}function b(e,t,n){var a="suspendedStart";return function(i,r){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw r;return S()}for(n.method=i,n.arg=r;;){var o=n.delegate;if(o){var s=I(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var l=u(e,t,n);if("normal"===l.type){if(a=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(a="completed",n.method="throw",n.arg=l.arg)}}}function I(e,t){var n=t.method,a=e.iterator[n];if(undefined===a)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=undefined,I(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=u(a,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function w(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=undefined,t.done=!0,t};return i.next=i}}return{next:S}}function S(){return{value:undefined,done:!0}}return p.prototype=h,a(g,"constructor",{value:h,configurable:!0}),a(h,"constructor",{value:p,configurable:!0}),p.displayName=l(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,l(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},E(T.prototype),l(T.prototype,o,(function(){return this})),e.AsyncIterator=T,e.async=function(t,n,a,i,r){void 0===r&&(r=Promise);var o=new T(c(t,n,a,i),r);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},E(g),l(g,s,"Generator"),l(g,r,(function(){return this})),l(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=w,k.prototype={constructor:k,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(L),!t)for(var a in this)"t"===a.charAt(0)&&n.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var a=this;function i(e,n){return s.type="throw",s.arg=t,a.next=e,n&&(a.method="next",a.arg=undefined),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function e(t,a){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=a&&a<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=a,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(s)},complete:function e(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),d},finish:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),L(a),d}},catch:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc===t){var i=a.completion;if("throw"===i.type){var r=i.arg;L(a)}return r}}throw new Error("illegal catch attempt")},delegateYield:function e(t,n,a){return this.delegate={iterator:w(t),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=undefined),d}},e}var F=function(){var e=babelHelpers.asyncToGenerator(A().mark((function e(t){var n,a,r,o,s;return A().wrap((function e(l){while(1)switch(l.prev=l.next){case 0:N.init();l.next=3;return p.getTaskLinkData(t);case 3:n=l.sent;a=T.buildCardParams(t,n);l.next=7;return top.BX.Runtime.loadExtension("tasks.v2.application.task-card");case 7:r=l.sent;o=r.TaskCard;s=i.Type.isStringFilled(t.postEntityType);if(s){o.showCompactCard(a)}else{o.showFullCard(a)}case 11:case"end":return l.stop()}}),e)})));return function t(n){return e.apply(this,arguments)}}();var x,D,O;function B(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */B=function t(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function e(t,n,a){return t[n]=a}}function c(e,t,n,i){var r=t&&t.prototype instanceof f?t:f,o=Object.create(r.prototype),s=new k(i||[]);return a(o,"_invoke",{value:b(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var d={};function f(){}function p(){}function h(){}var m={};l(m,r,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(w([])));v&&v!==t&&n.call(v,r)&&(m=v);var g=h.prototype=f.prototype=Object.create(m);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function i(a,r,o,s){var l=u(e[a],e,r);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==babelHelpers["typeof"](d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return i("throw",e,o,s)}))}s(l.arg)}var r;a(this,"_invoke",{value:function e(n,a){function o(){return new t((function(e,t){i(n,a,e,t)}))}return r=r?r.then(o,o):o()}})}function b(e,t,n){var a="suspendedStart";return function(i,r){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===i)throw r;return S()}for(n.method=i,n.arg=r;;){var o=n.delegate;if(o){var s=I(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var l=u(e,t,n);if("normal"===l.type){if(a=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(a="completed",n.method="throw",n.arg=l.arg)}}}function I(e,t){var n=t.method,a=e.iterator[n];if(undefined===a)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=undefined,I(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=u(a,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=undefined),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function w(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=undefined,t.done=!0,t};return i.next=i}}return{next:S}}function S(){return{value:undefined,done:!0}}return p.prototype=h,a(g,"constructor",{value:h,configurable:!0}),a(h,"constructor",{value:p,configurable:!0}),p.displayName=l(h,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,h):(e.__proto__=h,l(e,s,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},E(T.prototype),l(T.prototype,o,(function(){return this})),e.AsyncIterator=T,e.async=function(t,n,a,i,r){void 0===r&&(r=Promise);var o=new T(c(t,n,a,i),r);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},E(g),l(g,s,"Generator"),l(g,r,(function(){return this})),l(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=w,k.prototype={constructor:k,reset:function e(t){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(L),!t)for(var a in this)"t"===a.charAt(0)&&n.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=undefined)},stop:function e(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function e(t){if(this.done)throw t;var a=this;function i(e,n){return s.type="throw",s.arg=t,a.next=e,n&&(a.method="next",a.arg=undefined),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function e(t,a){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=a&&a<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=a,o?(this.method="next",this.next=o.finallyLoc,d):this.complete(s)},complete:function e(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),d},finish:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),L(a),d}},catch:function e(t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc===t){var i=a.completion;if("throw"===i.type){var r=i.arg;L(a)}return r}}throw new Error("illegal catch attempt")},delegateYield:function e(t,n,a){return this.delegate={iterator:w(t),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=undefined),d}},e}var M=function(){function e(){babelHelpers.classCallCheck(this,e);this.initEvents()}babelHelpers.createClass(e,[{key:"initEvents",value:function t(){if(i.Loc.getMessage("SONET_EXT_LIVEFEED_INTRANET_INSTALLED")==="Y"&&i.Loc.getMessage("SONET_EXT_LIVEFEED_isV2Form")==="Y"){return}r.EventEmitter.subscribe("tasksTaskEvent",(function(t){var n=t.getCompatData(),a=babelHelpers.slicedToArray(n,2),r=a[0],o=a[1];if(r!=="ADD"||!i.Type.isPlainObject(o.options)||!i.Type.isBoolean(o.options.STAY_AT_PAGE)||o.options.STAY_AT_PAGE){return}e.signedFiles=null}));r.EventEmitter.subscribe("SidePanel.Slider:onCloseComplete",(function(t){var n=t.getTarget();if(!n){return}var a=n.getUrl();if(!i.Type.isStringFilled(a)||a!==e.sliderUrl||!i.Type.isStringFilled(e.signedFiles)){return}i.ajax.runAction("intranet.controlbutton.clearNewTaskFiles",{data:{signedFiles:e.signedFiles}}).then((function(){e.signedFiles=null}))}))}}],[{key:"create",value:function(){var e=babelHelpers.asyncToGenerator(B().mark((function e(t){var n=this;return B().wrap((function e(r){while(1)switch(r.prev=r.next){case 0:if(!(i.Loc.getMessage("SONET_EXT_LIVEFEED_INTRANET_INSTALLED")==="Y"&&i.Loc.getMessage("SONET_EXT_LIVEFEED_isV2Form")==="Y")){r.next=3;break}void F(t);return r.abrupt("return");case 3:if(i.Loc.getMessage("SONET_EXT_LIVEFEED_INTRANET_INSTALLED")==="Y"){i.ajax.runAction("intranet.controlbutton.getTaskLink",{data:{entityType:t.entityType,entityId:t.entityId,postEntityType:i.Type.isStringFilled(t.postEntityType)?t.postEntityType:t.entityType,entityData:{}}}).then((function(e){if(!i.Type.isStringFilled(e.data.SUFFIX)){e.data.SUFFIX=""}var a=e.data;a.DESCRIPTION=n.formatTaskDescription(a.DESCRIPTION,a.URL,t.entityType,a.SUFFIX);if(parseInt(t.parentTaskId)>0){a.PARENT_ID=parseInt(t.parentTaskId)}if(i.Type.isStringFilled(a.UF_TASK_WEBDAV_FILES_SIGN)){n.signedFiles=a.UF_TASK_WEBDAV_FILES_SIGN}n.sliderUrl=e.data.link;var r=n.getLinkWithAnalytics(e.data.link,t);BX.SidePanel.Instance.open(r,{requestMethod:"post",requestParams:a,cacheable:false})}))}else{this.createTaskPopup=new a.Popup("BXCTP",null,{autoHide:false,zIndex:0,offsetLeft:0,offsetTop:0,overlay:false,lightShadow:true,closeIcon:{right:"12px",top:"10px"},draggable:{restrict:true},closeByEsc:false,contentColor:"white",contentNoPaddings:true,buttons:[],content:i.Tag.render(x||(x=babelHelpers.taggedTemplateLiteral(['<div id="BXCTP_content" class="','"></div>'])),this.cssClass.popupContent),events:{onAfterPopupShow:function e(){n.createTaskSetContent(i.Tag.render(D||(D=babelHelpers.taggedTemplateLiteral(['<div class="','">',"</div>"])),n.cssClass.popupTitle,i.Loc.getMessage("SONET_EXT_LIVEFEED_CREATE_TASK_WAIT")));i.ajax.runAction("socialnetwork.api.livefeed.getRawEntryData",{data:{params:{entityType:t.entityType,entityId:t.entityId,logId:i.Type.isNumber(t.logId)?t.logId:null,additionalParams:{getSonetGroupAvailable:"Y",getLivefeedUrl:"Y",checkPermissions:{feature:"tasks",operation:"create_tasks"}}}}}).then((function(e){var a=i.Type.isStringFilled(e.data.TITLE)?e.data.TITLE:"";var r=i.Type.isStringFilled(e.data.DESCRIPTION)?e.data.DESCRIPTION:"";var o=i.Type.isPlainObject(e.data.DISK_OBJECTS)?e.data.DISK_OBJECTS:[];var s=i.Type.isStringFilled(e.data.LIVEFEED_URL)?e.data.LIVEFEED_URL:"";var l=i.Type.isStringFilled(e.data.SUFFIX)?e.data.SUFFIX:"";var c=i.Type.isPlainObject(e.data.GROUPS_AVAILABLE)?e.data.GROUPS_AVAILABLE:[];var u=i.Type.isUndefined(e.data.LOG_ID)?0:parseInt(e.data.LOG_ID);if((i.Type.isStringFilled(a)||i.Type.isStringFilled(r))&&i.Type.isStringFilled(s)){var d=n.formatTaskDescription(r,s,t.entityType,l);var f={TITLE:a,DESCRIPTION:d,RESPONSIBLE_ID:i.Loc.getMessage("USER_ID"),CREATED_BY:i.Loc.getMessage("USER_ID"),UF_TASK_WEBDAV_FILES:o};var p=[];for(var h=0,m=Object.entries(c);h<m.length;h++){var y=babelHelpers.slicedToArray(m[h],2),v=y[0],g=y[1];p.push(g)}if(p.length==1){f.GROUP_ID=parseInt(p[0])}if(parseInt(t.entityType)>0){f.PARENT_ID=parseInt(t.entityType)}i.ajax.runComponentAction("bitrix:tasks.task","legacyAdd",{mode:"class",data:{data:f}}).then((function(e){var a=e.data;n.createTaskSetContentSuccess(a.DATA.ID);i.ajax.runAction("socialnetwork.api.livefeed.createEntityComment",{data:{params:{postEntityType:i.Type.isStringFilled(t.postEntityType)?t.postEntityType:t.entityType,sourceEntityType:t.entityType,sourceEntityId:t.entityId,entityType:"TASK",entityId:a.DATA.ID,logId:i.Type.isNumber(t.logId)?t.logId:u>0?u:null}}}).then((function(){}),(function(){}))}),(function(e){if(e.errors&&e.errors.length>0){var t=[];e.errors.forEach((function(e){t.push(e.message)}));n.createTaskSetContentFailure(t)}}))}else{n.createTaskSetContentFailure([i.Loc.getMessage("SONET_EXT_LIVEFEED_CREATE_TASK_ERROR_GET_DATA")])}}),(function(){n.createTaskSetContentFailure([i.Loc.getMessage("SONET_EXT_LIVEFEED_CREATE_TASK_ERROR_GET_DATA")])}))},onPopupClose:function e(){n.createTaskPopup.destroy()}}});this.createTaskPopup.show()}case 4:case"end":return r.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getLinkWithAnalytics",value:function e(t,n){var a=i.Type.isStringFilled(n.postEntityType)?n.postEntityType:n.entityType;var r=i.Type.isNil(n.postEntityType)?"context_menu":"comment_context_menu";var o;switch(a){case"TASK":o="tasks";break;case"CALENDAR_EVENT":o="calendar";break;default:o="feed";break}return BX.Uri.addParam(t,{ta_sec:o,ta_el:r})}},{key:"createTaskSetContentSuccess",value:function e(t){var n=i.Loc.getMessage("SONET_EXT_LIVEFEED_CREATE_TASK_PATH").replace("#user_id#",i.Loc.getMessage("USER_ID")).replace("#task_id#",t);this.createTaskPopup.destroy();window.top.BX.UI.Notification.Center.notify({content:i.Loc.getMessage("SONET_EXT_LIVEFEED_CREATE_TASK_SUCCESS_TITLE"),actions:[{title:i.Loc.getMessage("SONET_EXT_LIVEFEED_CREATE_TASK_VIEW"),events:{click:function e(t,a,i){a.close();window.top.BX.SidePanel.Instance.open(n)}}}]})}},{key:"createTaskSetContentFailure",value:function e(t){this.createTaskSetContent(i.Tag.render(O||(O=babelHelpers.taggedTemplateLiteral(['\n\t\t\t<div>\n\t\t\t\t\t\t<div class="','">','</div>\n\t\t\t\t\t\t<div class="','">',"</div>\n\t\t\t\t\t</div>\n\t\t"])),this.cssClass.popupTitle,i.Loc.getMessage("SONET_EXT_LIVEFEED_CREATE_TASK_FAILURE_TITLE"),this.cssClass.popupDescription,t.join("<br>")))}},{key:"createTaskSetContent",value:function e(t){var n=document.getElementById("BXCTP_content");if(!n){return}i.Dom.clean(n);n.appendChild(t)}},{key:"formatTaskDescription",value:function e(t,n,a,r){var o=t;r=i.Type.isStringFilled(r)?"_".concat(r):"";if(Boolean(n)&&Boolean(a)&&n.length>0){o+="\n\n".concat(i.Loc.getMessage("SONET_EXT_COMMENTAUX_CREATE_TASK_".concat(a).concat(r)).replace("#A_BEGIN#","[URL=".concat(n,"]")).replace("#A_END#","[/URL]"))}return o}}]);return e}();babelHelpers.defineProperty(M,"createTaskPopup",null);babelHelpers.defineProperty(M,"cssClass",{popupContent:"feed-create-task-popup-content",popupTitle:"feed-create-task-popup-title",popupDescription:"feed-create-task-popup-description"});babelHelpers.defineProperty(M,"signedFiles",null);babelHelpers.defineProperty(M,"sliderUrl","");var R;var U=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"showBackgroundWarning",value:function e(n){var r=n.urlToEdit,o=n.menuPopupWindow;var s=i.Tag.render(R||(R=babelHelpers.taggedTemplateLiteral(["<div>","</div>"])),i.Loc.getMessage("SONET_EXT_LIVEFEED_POST_BACKGROUND_EDIT_WARNING_DESCRIPTION"));var l=new a.Popup("backgroundWarning",null,{autoHide:true,closeByEsc:true,offsetLeft:0,offsetTop:0,draggable:true,bindOnResize:false,titleBar:i.Loc.getMessage("SONET_EXT_LIVEFEED_POST_BACKGROUND_EDIT_WARNING_TITLE"),closeIcon:true,className:"sonet-livefeed-popup-warning",content:s,events:{},cacheable:false,buttons:[new t.Button({text:i.Loc.getMessage("SONET_EXT_LIVEFEED_POST_BACKGROUND_EDIT_WARNING_BUTTON_SUBMIT"),className:"ui-btn ui-btn-primary",events:{click:function e(){window.location=r;l.close();if(o){o.close()}}}}),new t.Button({text:i.Loc.getMessage("SONET_EXT_LIVEFEED_POST_BACKGROUND_EDIT_WARNING_BUTTON_CANCEL"),className:"ui-btn ui-btn-light",events:{click:function e(){l.close();if(o){o.close()}}}})]});l.show();return false}},{key:"showMenu",value:function e(t){var n=this;if(!i.Type.isPlainObject(t)){t={}}var r=t.menuElement;var o=t.ind;var s=this.getMenuId(o);a.MenuManager.destroy(s);var l=!i.Type.isUndefined(t.log_id)?parseInt(t.log_id):0;if(l<=0){l=parseInt(r.getAttribute("data-log-entry-log-id"))}if(l<=0){return false}var c=t.bFavorites;if(i.Type.isUndefined(c)){c=r.getAttribute("data-log-entry-favorites")==="Y"}var u=t.arMenuItemsAdditional;if(i.Type.isUndefined(u)){u=r.getAttribute("data-bx-items");try{u=JSON.parse(u);if(!i.Type.isPlainObject(u)){u={}}}catch(e){u={}}}var d=t.bindElement;var f=null;var p=d.closest("[data-livefeed-post-pinned]");if(p){var h=p.getAttribute("data-livefeed-post-pinned")==="Y";f={text:h?i.Loc.getMessage("SONET_EXT_LIVEFEED_MENU_TITLE_PINNED_Y"):i.Loc.getMessage("SONET_EXT_LIVEFEED_MENU_TITLE_PINNED_N"),className:"menu-popup-no-icon",onclick:function e(t){ie.changePinned({logId:l,newState:h?"N":"Y",event:t,node:d});a.MenuManager.getMenuById(n.getMenuId(o)).popupWindow.close();t.preventDefault()}}}var m=i.Loc.getMessage("sonetLbUseFavorites")!=="N"?{text:c?i.Loc.getMessage("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_Y"):i.Loc.getMessage("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_N"),className:"menu-popup-no-icon",onclick:function e(t){__logChangeFavorites(l,"log_entry_favorites_".concat(l),c?"N":"Y",true,t);t.preventDefault();t.stopPropagation()}}:null;var y=[f,m,i.Type.isStringFilled(r.getAttribute("data-log-entry-url"))?{html:'<span id="'.concat(s,'-href-text">').concat(i.Loc.getMessage("sonetLMenuHref"),"</span>"),className:"menu-popup-no-icon feed-entry-popup-menu feed-entry-popup-menu-href",href:r.getAttribute("data-log-entry-url")}:null,i.Type.isStringFilled(r.getAttribute("data-log-entry-url"))?{html:'<span id="'.concat(s,'-link-text">').concat(i.Loc.getMessage("sonetLMenuLink"),"</span>")+'<span id="'.concat(s,'-link-icon-animate" class="post-menu-link-icon-wrap">')+'<span class="post-menu-link-icon" id="'.concat(s,'-link-icon-done" style="display: none;">')+"</span>"+"</span>",className:"menu-popup-no-icon feed-entry-popup-menu feed-entry-popup-menu-link",onclick:function e(t){var n=document.getElementById("".concat(s,"-link-text"));var a=document.getElementById("".concat(s,"-link-icon-done"));if(BX.clipboard.isCopySupported()){if(n&&n.getAttribute("data-block-click")==="Y"){return}BX.clipboard.copy(r.getAttribute("data-log-entry-url"));if(n&&a){a.style.display="inline-block";document.getElementById("".concat(s,"-link-icon-animate")).classList.remove("post-menu-link-icon-animate");i.Dom.adjust(document.getElementById("".concat(s,"-link-text")),{attrs:{"data-block-click":"Y"}});setTimeout((function(){document.getElementById("".concat(s,"-link-icon-animate")).classList.add("post-menu-link-icon-animate")}),1);setTimeout((function(){i.Dom.adjust(document.getElementById("".concat(s,"-link-text")),{attrs:{"data-block-click":"N"}})}),500)}return}var o=t.currentTarget;var l=parseInt(!!o.getAttribute("bx-height")?o.getAttribute("bx-height"):o.offsetHeight);if(o.getAttribute("bx-status")!=="shown"){o.setAttribute("bx-status","shown");var c=document.getElementById("".concat(s,"-link-text"));if(!document.getElementById("".concat(s,"-link"))&&!!c){var u=BX.pos(c);var d=BX.pos(c.parentNode);var f=BX.pos(c.closest(".menu-popup-item"));u.height=d.height-1;i.Dom.adjust(o,{attrs:{"bx-height":o.offsetHeight},style:{overflow:"hidden",display:"block"},children:[i.Dom.create("BR"),i.Dom.create("DIV",{attrs:{id:"".concat(s,"-link")},children:[i.Dom.create("SPAN",{attrs:{className:"menu-popup-item-left"}}),i.Dom.create("SPAN",{attrs:{className:"menu-popup-item-icon"}}),i.Dom.create("SPAN",{attrs:{className:"menu-popup-item-text"},children:[i.Dom.create("INPUT",{attrs:{id:"".concat(s,"-link-input"),type:"text",value:r.getAttribute("data-log-entry-url")},style:{height:"".concat(u.height,"px"),width:"".concat(f.width-21,"px")},events:{click:function e(t){t.currentTarget.select();t.stopPropagation();t.preventDefault()}}})]})]}),i.Dom.create("SPAN",{attrs:{className:"menu-popup-item-right"}})]});Event.bind(document.getElementById("".concat(s,"-link-input")),"click",(function(e){e.currentTarget.select();e.preventDefault();e.stopPropagation()}))}new BX.fx({time:.2,step:.05,type:"linear",start:l,finish:l*2,callback:function(e){this.style.height="".concat(e,"px")}.bind(o)}).start();BX.fx.show(document.getElementById("".concat(s,"-link")),.2);document.getElementById("".concat(s,"-link-input")).select()}else{o.setAttribute("bx-status","hidden");new BX.fx({time:.2,step:.05,type:"linear",start:o.offsetHeight,finish:l,callback:function(e){this.style.height="".concat(e,"px")}.bind(o)}).start();BX.fx.hide(document.getElementById("".concat(s,"-link")),.2)}}}:null,i.Loc.getMessage("sonetLCanDelete")==="Y"?{text:i.Loc.getMessage("sonetLMenuDelete"),className:"menu-popup-no-icon",onclick:function e(t){if(confirm(i.Loc.getMessage("sonetLMenuDeleteConfirm"))){ae["delete"]({logId:l,nodeId:"log-entry-".concat(l),ind:o})}t.stopPropagation();t.preventDefault()}}:null,r.getAttribute("data-log-entry-createtask")==="Y"?{text:i.Loc.getMessage("sonetLMenuCreateTask"),className:"menu-popup-no-icon",onclick:function e(t){M.create({entryEntityType:r.getAttribute("data-log-entry-entity-type"),entityType:r.getAttribute("data-log-entry-entity-type"),entityId:r.getAttribute("data-log-entry-entity-id"),logId:parseInt(r.getAttribute("data-log-entry-log-id"))});a.MenuManager.getMenuById(n.getMenuId(o)).popupWindow.close();return t.preventDefault()}}:null,r.getAttribute("data-log-entry-createtask")==="Y"&&r.getAttribute("data-log-entry-entity-type")==="TASK"?{text:i.Loc.getMessage("sonetLMenuCreateSubTask"),className:"menu-popup-no-icon",onclick:function e(t){M.create({entryEntityType:r.getAttribute("data-log-entry-entity-type"),entityType:r.getAttribute("data-log-entry-entity-type"),entityId:r.getAttribute("data-log-entry-entity-id"),logId:parseInt(r.getAttribute("data-log-entry-log-id")),parentTaskId:parseInt(r.getAttribute("data-log-entry-entity-id"))});a.MenuManager.getMenuById(n.getMenuId(o)).popupWindow.close();return t.preventDefault()}}:null];if(!!u&&i.Type.isArray(u)){u.forEach((function(e){if(i.Type.isUndefined(e.className)){e.className="menu-popup-no-icon"}}));y=y.concat(u)}var v={offsetLeft:-14,offsetTop:4,lightShadow:false,angle:{position:"top",offset:50},events:{onPopupShow:function e(t){if(document.getElementById("log_entry_favorites_".concat(l))){var n=null;var a=t.contentContainer.querySelectorAll(".menu-popup-item-text");a.forEach((function(e){if(e.innerHTML===i.Loc.getMessage("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_Y")||e.innerHTML===i.Loc.getMessage("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_N")){n=e}}));if(i.Type.isDomNode(n)){n.innerHTML=document.getElementById("log_entry_favorites_".concat(l)).classList.contains("feed-post-important-switch-active")?i.Loc.getMessage("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_Y"):i.Loc.getMessage("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_N")}}if(document.getElementById("".concat(s,"-link"))){var r=t.popupContainer.querySelector(".feed-entry-popup-menu-link");if(r){var o=parseInt(!!r.getAttribute("bx-height")?r.getAttribute("bx-height"):0);if(o>0){document.getElementById("".concat(s,"-link")).style.display="none";r.setAttribute("bx-status","hidden");r.style.height="".concat(o,"px")}}}}}};a.MenuManager.show(this.getMenuId(o),d,y,v)}},{key:"getMenuId",value:function e(t){return"post-menu-".concat(t)}},{key:"editSpacesPost",value:function e(t,a){var i=new n.PostForm({postId:t,groupId:a});i.show()}}]);return e}();var H=function(){function e(){babelHelpers.classCallCheck(this,e);this.container=null;this.wrap=null;this.plus=null;this.value=null;this.currentSiteId=null;this.currentCounterType=null;this.counterDecrementStack=0;this.counterValue=0;this.lockCounterAnimation=null;this.isSpaceFeatureEnabled=null;this.currentUserId=null;this.currentSpaceId=null;this["class"]={informerFixed:"feed-new-message-informer-fixed",informerAnimation:"feed-new-message-informer-anim",informerFixedAnimation:"feed-new-message-informer-fix-anim",counterText:"feed-new-message-inf-text",counterContainer:"feed-new-message-inf-text-counter",reloadContainer:"feed-new-message-inf-text-reload",icon:"feed-new-message-icon",iconRotating:"new-message-balloon-icon-rotating",plusHidden:"feed-new-message-informer-counter-plus-hidden"}}babelHelpers.createClass(e,[{key:"init",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var n={isSpaceFeatureEnabled:false,userId:null,spaceId:null};var a=t||n,i=a.isSpaceFeatureEnabled,r=a.userId,o=a.spaceId;this.isSpaceFeatureEnabled=i;this.currentUserId=r;this.currentSpaceId=o;this.initNodes();this.initEvents()}},{key:"initNodes",value:function e(){this.currentCounterType=i.Loc.hasMessage("sonetLCounterType")?i.Loc.getMessage("sonetLCounterType"):"**";this.currentSiteId=i.Loc.getMessage("SITE_ID");this.container=document.getElementById("sonet_log_counter_2_container");if(this.container){this.container.addEventListener("click",this.showReloadAnimation.bind(this))}this.wrap=document.getElementById("sonet_log_counter_2_wrap");this.plus=document.getElementById("sonet_log_counter_2_plus");this.value=document.getElementById("sonet_log_counter_2")}},{key:"initEvents",value:function e(){var t=this;r.EventEmitter.subscribe("onGoUp",(function(e){t.unfixWrap()}));this.isSpaceFeatureEnabled?this.subscribeOnSpaceCounters():this.subscribeOnLiveFeedCounters();r.EventEmitter.subscribe("onImUpdateCounter",(function(e){var n=e.getCompatData(),a=babelHelpers.slicedToArray(n,1),r=a[0];if(t.isSpaceFeatureEnabled||!i.Type.isObjectLike(r)||i.Type.isUndefined(r[t.currentCounterType])){return}t.changeCounter(r[t.currentCounterType])}));r.EventEmitter.subscribe("OnUCCommentWasRead",(function(e){if(t.isSpaceFeatureEnabled){return}var n=e.getData(),a=babelHelpers.slicedToArray(n,3),o=a[0],s=a[1],l=a[2];if(!i.Type.isObjectLike(l)||!l.live||!l["new"]){return}r.EventEmitter.emit("onCounterDecrement",new r.BaseEvent({compatData:[1]}));t.decrementCounter(1)}))}},{key:"subscribeOnSpaceCounters",value:function e(){var t=this;r.EventEmitter.subscribe("onPullEvent-socialnetwork",(function(e){var n,a;var i=e.getData(),r=babelHelpers.slicedToArray(i,2),o=r[0],s=r[1];var l=(n=s.userId)!==null&&n!==void 0?n:null;var c=(a=s.spaces)!==null&&a!==void 0?a:[];if(o!=="user_spaces_counter"||parseInt(t.currentUserId)!==parseInt(l)){return}var u=c.find((function(e){return e.id===parseInt(t.currentSpaceId)}));var d=u&&u.metrics&&u.metrics.countersLiveFeedTotal?u.metrics.countersLiveFeedTotal:0;t.changeCounter(d)}))}},{key:"subscribeOnLiveFeedCounters",value:function e(){var t=this;r.EventEmitter.subscribe("onPullEvent-main",(function(e){var n=e.getData(),a=babelHelpers.slicedToArray(n,2),r=a[0],o=a[1];if(r!=="user_counter"||!o[t.currentSiteId]||!o[t.currentSiteId][t.currentCounterType]){return}t.changeCounter(i.Runtime.clone(o[t.currentSiteId][t.currentCounterType]))}))}},{key:"changeCounter",value:function e(t){this.counterValue=parseInt(t);if(this.counterValue<=0){this.counterDecrementStack=0}var n=this.counterValue-this.counterDecrementStack;this.changeAnimate({show:n>0,counter:n,zeroCounterFromDb:n<=0})}},{key:"changeAnimate",value:function e(t){var n=this;var a=!!t.show;var i=parseInt(t.counter);var r=!!t.zeroCounterFromDb;if(!this.container){return}var o=this.container.querySelector("span.".concat(this["class"].counterText));var s=this.container.querySelector("span.".concat(this["class"].reloadContainer));if(this.lockCounterAnimation){setTimeout((function(){n.changeAnimate({show:a,counter:i})}),200);return false}if(a){if(this.value){this.value.innerHTML=i}this.showWrapAnimation();if(this.plus&&s&&!s.classList.contains("--hidden")&&o){s.classList.add("--hidden");o.classList.remove("--hidden");this.plus.classList.remove("".concat(this["class"].plusHidden))}}else if(this.wrap){if(r&&this.wrap.classList.contains("".concat(this["class"].informerAnimation))){if(o&&s){o.classList.add("--hidden");s.classList.remove("--hidden");this.hideReloadAnimation()}}else{setTimeout((function(){n.hideWrapAnimation()}),400)}}}},{key:"showWrapAnimation",value:function e(){if(!this.wrap){return}this.wrap.style.visibility="visible";this.wrap.classList.add("".concat(this["class"].informerAnimation))}},{key:"hideWrapAnimation",value:function e(){if(!this.wrap){return}this.wrap.classList.remove("".concat(this["class"].informerAnimation));this.wrap.style.visibility="hidden"}},{key:"showReloadAnimation",value:function e(){if(!this.container){return}var t=this.container.querySelector("span.".concat(this["class"].icon));if(t){t.classList.add(this["class"].iconRotating)}}},{key:"hideReloadAnimation",value:function e(){if(!this.container){return}var t=this.container.querySelector("span.".concat(this["class"].icon));if(t){t.classList.remove(this["class"].iconRotating)}}},{key:"onFeedScroll",value:function e(){if(!this.container||!this.wrap){return}var t=this.wrap.parentNode.getBoundingClientRect().top;if(t<=53){this.fixWrap()}else{this.unfixWrap()}}},{key:"fixWrap",value:function e(){if(!this.wrap){return}this.wrap.classList.add("".concat(this["class"].informerFixed),"".concat(this["class"].informerFixedAnimation))}},{key:"unfixWrap",value:function e(){if(!this.wrap){return}this.wrap.classList.remove("".concat(this["class"].informerFixed),"".concat(this["class"].informerFixedAnimation))}},{key:"recover",value:function e(){if(!this.container){return}var t=this.container.querySelector("span.".concat(this["class"].counterContainer));if(!t){return}t.classList.remove("--hidden");this.hideReloadNode();if(this.plus){this.plus.classList.add("".concat(this["class"].plusHidden))}}},{key:"hideReloadNode",value:function e(){if(!this.container){return}var t=this.container.querySelector("span.".concat(this["class"].reloadContainer));if(!t){return}t.classList.add("--hidden")}},{key:"decrementCounter",value:function e(t){this.counterDecrementStack+=parseInt(t);if(!this.value){return}var n=this.counterValue-this.counterDecrementStack;if(n>0){this.value.innerHTML=n}else{this.changeAnimate({show:false,counter:0})}}},{key:"getWrap",value:function e(){return this.wrap}}]);return e}();var V=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"showRefreshFade",value:function e(){var t=this;var n=document.getElementById("log_internal_container");if(n){n.classList.add(this.cssClass.feedMask);n.classList.remove(this.cssClass.feedNoMask)}var a=document.getElementById("feed-loader-container");if(a){a.style.display="block";a.classList.remove(this.cssClass.hideLoader);setTimeout((function(){a.classList.add(t.cssClass.showLoader)}),0)}}},{key:"hideRefreshFade",value:function e(){var t=document.getElementById("log_internal_container");if(t){t.classList.remove(this.cssClass.feedMask);t.classList.add(this.cssClass.feedNoMask)}var n=document.getElementById("feed-loader-container");if(n){n.classList.remove(this.cssClass.showLoader);n.classList.add(this.cssClass.hideLoader)}}}]);return e}();babelHelpers.defineProperty(V,"cssClass",{feedMask:"log-internal-mask",feedNoMask:"log-internal-nomask",showLoader:"livefeed-show-loader",hideLoader:"livefeed-hide-loader"});babelHelpers.defineProperty(V,"onAnimationEnd",(function(e){if("animationName"in e&&e.animationName&&e.animationName==="hideLoader"){var t=document.getElementById("feed-loader-container");if(!t){return}t.classList.remove(V.cssClass.showLoader);t.classList.remove(V.cssClass.hideLoader);t.style.display=""}}));var j=function(){function e(){babelHelpers.classCallCheck(this,e);r.EventEmitter.subscribe("BX.Livefeed:recalculateComments",this.onRecalculateLivefeedComments.bind(this))}babelHelpers.createClass(e,[{key:"onRecalculateLivefeedComments",value:function t(n){var a=n.getCompatData(),r=babelHelpers.slicedToArray(a,1),o=r[0];if(!i.Type.isDomNode(o.rootNode)){return}var s=o.rootNode;var l=s.querySelector(".".concat(e.cssClass.more));if(l){s.classList.remove(e.cssClass.postSeparator)}e.recalcPost({arPos:{height:o.rootNode.offsetHeight+o.rootNode.offsetTop},informerBlock:s})}}],[{key:"recalcPost",value:function e(t){if(!i.Type.isDomNode(t.informerBlock)){return}var n=!i.Type.isUndefined(t.arPos)?t.arPos.height:t.bodyBlock.offsetHeight;var a=t.informerBlock.closest(".".concat(this.cssClass.post));if(!a){return}if(n<=284){a.classList.add(this.cssClass.postShort);a.classList.add(this.cssClass.postSeparator)}else{a.classList.remove(this.cssClass.postShort)}}},{key:"recalcPostsList",value:function e(){var t=this;var n=ae.getMoreButtons();n.forEach((function(e,a){if(!i.Type.isPlainObject(e)||!i.Type.isStringFilled(e.bodyBlockID)){return}var r=document.getElementById(e.bodyBlockID);if(!r){return}if(i.Type.isStringFilled(e.outerBlockID)){var o=document.getElementById(e.outerBlockID);if(o){if(o.offsetWidth<r.offsetWidth){var s=o.querySelector("div.".concat(t.cssClass.postTextInner));s.style.overflowX="scroll"}var l=o.querySelector(".".concat(t.cssClass.more));if(l){i.Event.unbindAll(l,"click");i.Event.bind(l,"click",(function(e){BX.UI.Animations.expand({moreButtonNode:e.currentTarget,type:"post",classBlock:t.cssClass.postText,classOuter:t.cssClass.postTextInner,classInner:t.cssClass.postTextInnerInner,heightLimit:300,callback:function e(n){t.expand(n)}})}));l.hasClickListener=true}}}t.recalcPost({arPos:{height:r.offsetHeight+r.offsetTop},informerBlock:i.Type.isStringFilled(e.informerBlockID)?document.getElementById(e.informerBlockID):null});n["delete"](a)}));ae.setMoreButtons(n);var a=document.getElementById("log_internal_container");if(!a){return}var r=a.querySelectorAll('[data-bx-onload="Y"]');r.forEach((function(e){e.addEventListener("load",(function(e){var n=e.currentTarget.closest(".".concat(t.cssClass.comment));if(!n){n=e.currentTarget.closest(".".concat(t.cssClass.post));if(n){var a=n.querySelector(".".concat(t.cssClass.postTextInnerInner));if(a){t.recalcPost({bodyBlock:a,informerBlock:n.querySelector(".".concat(t.cssClass.more))})}}}e.currentTarget.setAttribute("data-bx-onload","N")}))}))}},{key:"recalcCommentsList",value:function e(){r.EventEmitter.emit("OnUCMoreButtonListRecalc",new r.BaseEvent({compatData:[]}))}},{key:"clearCommentsList",value:function e(){r.EventEmitter.emit("OnUCMoreButtonListClear",new r.BaseEvent({compatData:[]}))}},{key:"expand",value:function e(t){if(!i.Type.isDomNode(t)){return}var n=t.closest(".".concat(this.cssClass.post));if(!n){return}n.classList.add(this.cssClass.postShort);n.classList.add(this.cssClass.postSeparator)}},{key:"lazyLoadCheckVisibility",value:function e(t){if(!i.Type.isPlainObject(t)||!i.Type.isDomNode(t.node)){return true}var n=t.node;var a="comment";var r=n.closest(".".concat(this.cssClass.comment));if(!r){a="post";r=n.closest(".".concat(this.cssClass.postText))}if(!r){return true}var o=r.querySelector("div.".concat(this.cssClass.more));if(!o||o.style.display==="none"){return true}return n.parentNode.parentNode.offsetTop<(a==="comment"?220:270)}}]);return e}();babelHelpers.defineProperty(j,"cssClass",{post:"feed-post-block",postShort:"feed-post-block-short",postSeparator:"feed-post-block-separator",postText:"feed-post-text-block",postTextInner:"feed-post-text-block-inner",postTextInnerInner:"feed-post-text-block-inner-inner",more:"feed-post-text-more",comment:"feed-com-text"});var X=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"processSpoilerToggle",value:function e(t){var n=t.getCompatData(),a=babelHelpers.slicedToArray(n,1),r=a[0];if(!i.Type.isPlainObject(r)){r={}}if(!i.Type.isDomNode(r.node)){return}var o=r.node.closest(".feed-post-block");if(!o){return}var s=o.querySelector(".feed-post-text-block-inner-inner");if(!s){return}var l=o.querySelector(".feed-post-text-more");j.recalcPost({bodyBlock:s,informerBlock:l})}}]);return e}();babelHelpers.defineProperty(X,"cssClass",{});var Y=function(){function e(){babelHelpers.classCallCheck(this,e);this.filterId="";this.filterApi=null}babelHelpers.createClass(e,[{key:"init",value:function e(t){if(!i.Type.isPlainObject(t)){t={}}if(i.Type.isStringFilled(t.filterId)&&!i.Type.isUndefined(BX.Main)&&!i.Type.isUndefined(BX.Main.filterManager)){var n=BX.Main.filterManager.getById(t.filterId);this.filterId=t.filterId;if(n){this.filterApi=n.getApi()}}this.initEvents()}},{key:"initEvents",value:function e(){r.EventEmitter.subscribe("BX.Livefeed.Filter:beforeApply",(function(e){V.showRefreshFade()}));r.EventEmitter.subscribe("BX.Livefeed.Filter:apply",(function(e){var t=e.getCompatData(),n=babelHelpers.slicedToArray(t,3),a=n[0],i=n[1],r=n[2];if(typeof r!="undefined"){r.autoResolve=false}se.refresh({useBXMainFilter:"Y"},i)}));r.EventEmitter.subscribe("BX.Livefeed.Filter:searchInput",(function(e){var t=e.getCompatData(),n=babelHelpers.slicedToArray(t,1),a=n[0];if(i.Type.isStringFilled(a)){V.showRefreshFade()}else{V.hideRefreshFade()}}))}},{key:"initEventsCrm",value:function e(){r.EventEmitter.subscribe("BX.Livefeed.Filter:searchInput",(function(){se.refresh()}))}},{key:"clickTag",value:function e(t){if(!i.Type.isStringFilled(t)||!this.filterApi){return false}this.filterApi.setFields({TAG:t});this.filterApi.apply();if(i.Type.isStringFilled(this.filterId)&&!i.Type.isUndefined(BX.Main)&&!i.Type.isUndefined(BX.Main.filterManager)){var n=document.getElementById("".concat(this.filterId,"_filter_container"));if(n&&BX.Main.filterManager.getById(this.filterId)&&(BX.Main.filterManager.getById(this.filterId).getSearch().getSquares().length>0||BX.Main.filterManager.getById(this.filterId).getSearch().getSearchString().length>0)){var a=n.closest(".pagetitle-wrap");if(a){a.classList.add("pagetitle-wrap-filter-opened")}}}new BX.easing({duration:500,start:{scroll:window.pageYOffset},finish:{scroll:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){window.scrollTo(0,t.scroll)},complete:function e(){}}).animate();return true}}]);return e}();var q=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"registerAreaList",value:function e(){var t=BX("log_internal_container"),n=null;if(t){var a=BX.findChildren(t,{tag:"div",className:"feed-post-contentview"},true);for(var i=0,r=a.length;i<r;i++){if(a[i].id.length>0){n=BX.findChild(a[i],{tag:"div",className:"feed-post-text-block-inner-inner"});BX.UserContentView.registerViewArea(a[i].id,n?n:null)}}}}}]);return e}();var G,W;var z=function(){function e(){var t=this;babelHelpers.classCallCheck(this,e);this.loadStarted=null;this.stopTrackNextPage=null;this.requestMode=null;this.nextPageFirst=null;this.nextPageUrl=null;this.scrollInitialized=null;this.firstPageLastTS=0;this.firstPageLastId=0;this.useBXMainFilter="N";this.commentFormUID="";this.blogCommentFormUID="";this.signedParameters="";this.componentName="";this.context="";this["class"]={};i.Event.ready((function(){t.init()}))}babelHelpers.createClass(e,[{key:"init",value:function e(){this.loadStarted=false;this.stopTrackNextPage=false;this.requestMode=false;this.nextPageFirst=true;this.nextPageUrl=false;this.scrollInitialized=false}},{key:"refresh",value:function e(t,n){var a=this;if(this.loadStarted){return}this.setRequestModeNew();t=i.Type.isPlainObject(t)?t:{};t.siteTemplateId=i.Loc.getMessage("SONET_EXT_LIVEFEED_SITE_TEMPLATE_ID");t.assetsCheckSum=i.Loc.getMessage("sonetLAssetsCheckSum");t.context=i.Type.isStringFilled(t.context)?t.context:this.context;this.loadStarted=true;V.showRefreshFade();j.clearCommentsList();ae.clearMoreButtons();if(i.Type.isStringFilled(this.commentFormUID)){t.commentFormUID=this.commentFormUID}if(!i.Type.isStringFilled(t.useBXMainFilter)||t.useBXMainFilter!=="Y"){r.EventEmitter.emit("BX.Livefeed:refresh",new r.BaseEvent({compatData:[]}))}re.hideReloadNode();re.lockCounterAnimation=true;this.loadStarted=false;i.ajax.runAction("socialnetwork.api.livefeed.refresh",{signedParameters:this.getSignedParameters(),data:{c:this.getComponentName(),logajax:"Y",RELOAD:"Y",params:t}}).then((function(e){var t=i.Type.isPlainObject(e.data)?e.data:{};a.loadStarted=false;V.hideRefreshFade();if(n){n.fulfill()}var o=i.Type.isPlainObject(t.componentResult)&&i.Type.isStringFilled(t.componentResult.EMPTY)?t.componentResult.EMPTY:"N";var s=i.Type.isPlainObject(t.componentResult)&&i.Type.isStringFilled(t.componentResult.FORCE_PAGE_REFRESH)?t.componentResult.FORCE_PAGE_REFRESH:"N";var l=i.Type.isPlainObject(t.componentResult)&&i.Type.isStringFilled(t.componentResult.FILTER_USED)&&t.componentResult.FILTER_USED==="Y";if(s==="Y"){top.window.location.reload();return}var c=document.getElementById("feed-loader-container");re.lockCounterAnimation=false;var u=document.getElementById("log_internal_container");if(!u){return}i.Dom.clean(u);var d=document.getElementById("feed-empty-wrap");if(d){if(o==="Y"){d.style.display="block";var f=d.querySelector(".feed-wrap-empty");if(f){f.innerHTML=l?i.Loc.getMessage("SONET_C30_T_EMPTY_SEARCH"):i.Loc.getMessage("SONET_C30_T_EMPTY")}}else{d.style.display="none"}}if(c){u.appendChild(c)}if(t.html.length>0){a.clearContainerExternal();BX.LazyLoad.clearImages();var p=i.Tag.render(G||(G=babelHelpers.taggedTemplateLiteral(['<div id="content_block_','" class="feed-wrap" style="display: block;"></div>'])),Math.floor(Math.random()*1e3));u.appendChild(p);i.Runtime.html(p,t.html).then((function(){j.recalcPostsList();j.recalcCommentsList();q.registerAreaList();ie.resetFlags();ie.initPanel();ie.initPosts()}));a.stopTrackNextPage=false;j.clearCommentsList();var h=re.getWrap();if(h&&h.classList.contains(re["class"].informerFixed)){new BX.easing({duration:500,start:{scroll:window.pageYOffset},finish:{scroll:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quart),step:function e(t){window.scrollTo(0,t.scroll)},complete:function e(){r.EventEmitter.emit("onGoUp",[])}}).animate()}}}),(function(){a.loadStarted=false;if(n){n.reject()}V.hideRefreshFade();a.showRefreshError()}));return false}},{key:"getNextPage",value:function e(){var t=this;var n=document.getElementById("feed-new-message-inf-wrap");var a=document.getElementById("feed-new-message-inf-wrap-first");if(this.loadStarted){return false}this.setRequestModeMore();this.loadStarted=true;re.lockCounterAnimation=true;ae.clearMoreButtons();if(!this.nextPageFirst&&n){n.style.display="block"}else if(this.nextPageFirst&&a){a.classList.add("feed-new-message-inf-wrap-first-visible")}var o=new i.Uri(this.getNextPageUrl()).getQueryParams();var s=1;var l="";var c=0;var u="N";Object.entries(o).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],a=t[1];if(n.match(/^PAGEN_(\d+)$/i)){s=parseInt(a)}else if(n==="pplogid"){l=decodeURI(a)}else if(n==="ts"){c=a}else if(n==="noblog"){u=a}}));var d={PAGE_NUMBER:s,LAST_LOG_TIMESTAMP:c,PREV_PAGE_LOG_ID:l,siteTemplateId:i.Loc.getMessage("SONET_EXT_LIVEFEED_SITE_TEMPLATE_ID"),useBXMainFilter:this.useBXMainFilter,preset_filter_top_id:i.Type.isStringFilled(o.preset_filter_top_id)&&o.preset_filter_top_id!=="0"?o.preset_filter_top_id:"",preset_filter_id:i.Type.isStringFilled(o.preset_filter_id)&&o.preset_filter_id!=="0"?o.preset_filter_id:""};if(i.Type.isStringFilled(this.commentFormUID)){d.commentFormUID=this.commentFormUID}if(i.Type.isStringFilled(this.blogCommentFormUID)){d.blogCommentFormUID=this.blogCommentFormUID}d.context=this.context;var f={c:this.getComponentName(),logajax:"Y",noblog:u,params:d};if(!i.Type.isUndefined(o.CREATED_BY_ID)){f.flt_created_by_id=parseInt(o.CREATED_BY_ID)}if(!i.Type.isUndefined(o.flt_date_datesel)){f.flt_date_datesel=o.flt_date_datesel}if(!i.Type.isUndefined(o.flt_date_from)){f.flt_date_from=decodeURIComponent(o.flt_date_from)}if(!i.Type.isUndefined(o.flt_date_to)){f.flt_date_to=decodeURIComponent(o.flt_date_to)}i.ajax.runAction("socialnetwork.api.livefeed.getNextPage",{signedParameters:this.getSignedParameters(),data:f}).then((function(e){var n=i.Type.isPlainObject(e.data)?e.data:{};t.loadStarted=false;var o=document.getElementById("feed-new-message-inf-wrap");if(o){i.Dom.clean(o);i.Dom.remove(o)}re.lockCounterAnimation=false;var l=i.Type.isPlainObject(n.componentResult)&&!i.Type.isUndefined(n.componentResult.LAST_TS)?parseInt(n.componentResult.LAST_TS):0;var c=i.Type.isPlainObject(n.componentResult)&&!i.Type.isUndefined(n.componentResult.LAST_ID)?parseInt(n.componentResult.LAST_ID):null;if(n.html.length>0&&l>0&&(parseInt(t.firstPageLastTS)<=0||l<parseInt(t.firstPageLastTS)||l==parseInt(t.firstPageLastTS)&&!i.Type.isNull(c)&&c<parseInt(t.firstPageLastId))){j.clearCommentsList();var u="content_block_".concat(Math.floor(Math.random()*1e3));var d=i.Tag.render(W||(W=babelHelpers.taggedTemplateLiteral(['<div id="','" class="feed-wrap" style="display:',';"></div>'])),u,t.nextPageFirst?"none":"block");var f=document.getElementById("log_internal_container");if(!f){return}f.appendChild(d);i.Runtime.html(d,n.html).then((function(){if(s>2){t.stopTrackNextPage=false;j.recalcPostsList();q.registerAreaList();j.recalcCommentsList();ie.resetFlags();ie.initPosts()}}));t.clearContainerExternal();if(s===2){document.getElementById("feed-new-message-inf-text-first").style.display="block";document.getElementById("feed-new-message-inf-loader-first").style.display="none";a.classList.add("feed-new-message-inf-wrap-first-active");var p=function e(){t.stopTrackNextPage=false;if(d){d.style.display="block"}i.Event.unbind(document.getElementById("sonet_log_more_container_first"),"click",e);a.style.display="none";j.recalcPostsList();q.registerAreaList();j.recalcCommentsList();r.EventEmitter.emit("BX.Livefeed:recalculateComments",new r.BaseEvent({compatData:[{rootNode:d}]}));ie.resetFlags();ie.initPosts()};i.Event.bind(document.getElementById("sonet_log_more_container_first"),"click",p)}else{if(d){d.style.display="block"}}t.nextPageFirst=false}else if(document.getElementById("feed-new-message-inf-wrap-first")){document.getElementById("feed-new-message-inf-wrap-first").style.display="none"}}),(function(){t.loadStarted=false;t.stopTrackNextPage=false;var e=document.getElementById("feed-new-message-inf-wrap");if(e){e.style.display="none"}re.lockCounterAnimation=false;t.clearContainerExternal()}));return false}},{key:"clearContainerExternal",value:function e(){if(this.requestMode==="new"){re.hideWrapAnimation();re.recover()}re.hideReloadAnimation();var t=document.getElementById("sonet_log_counter_preset");if(t&&this.requestMode==="new"){t.style.display="none"}}},{key:"setRequestModeNew",value:function e(){this.requestMode="new"}},{key:"setRequestModeMore",value:function e(){this.requestMode="more"}},{key:"showRefreshError",value:function e(){re.lockCounterAnimation=false;this.clearContainerExternal()}},{key:"setSignedParameters",value:function e(t){this.signedParameters=t}},{key:"setContext",value:function e(t){this.context=t}},{key:"getSignedParameters",value:function e(){return this.signedParameters}},{key:"setComponentName",value:function e(t){this.componentName=t}},{key:"getComponentName",value:function e(){return this.componentName}},{key:"setNextPageUrl",value:function e(t){this.nextPageUrl=t}},{key:"getNextPageUrl",value:function e(){return this.nextPageUrl}},{key:"initScroll",value:function e(){if(this.scrollInitialized){return}this.scrollInitialized=true;document.addEventListener("scroll",this.onFeedScroll.bind(this),true)}},{key:"onFeedScroll",value:function e(){if(!this.stopTrackNextPage){var t=document.documentElement.scrollHeight-window.innerHeight-500;if(window.pageYOffset>=t&&this.getNextPageUrl()){this.stopTrackNextPage=true;this.getNextPage()}}re.onFeedScroll()}}]);return e}();var K;var J=function(){function e(){babelHelpers.classCallCheck(this,e)}babelHelpers.createClass(e,null,[{key:"appendResultFieldTaskIds",value:function e(t){if(!i.Type.isArray(t)){return}t=t.map((function(e){return parseInt(e)}));this.resultFieldTaskIdList=[].concat(babelHelpers.toConsumableArray(this.resultFieldTaskIdList),babelHelpers.toConsumableArray(t))}},{key:"appendTaskResultComments",value:function e(t){if(i.Type.isUndefined(o.ResultManager)){return}this.taskResultCommentsData=Object.assign(this.taskResultCommentsData,t);Object.entries(this.taskResultCommentsData).forEach((function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],a=t[1];o.ResultManager.getInstance().initResult({context:"task",taskId:parseInt(n),comments:a})}))}},{key:"onAfterShow",value:function e(t,n,a){if(!i.Type.isPlainObject(a)){a={}}r.EventEmitter.emit("OnBeforeSocialnetworkCommentShowedUp",new r.BaseEvent({compatData:["socialnetwork"]}));var o={ENTITY_XML_ID:t.currentEntity.ENTITY_XML_ID,ENTITY_TYPE:t.currentEntity.ENTITY_XML_ID.split("_")[0],ENTITY_ID:t.currentEntity.ENTITY_XML_ID.split("_")[1],parentId:t.id[1],comment_post_id:t.currentEntity.ENTITY_XML_ID.split("_")[1],edit_id:t.id[1],act:t.id[1]>0?"edit":"add"};Object.entries(o).forEach((function(e){var n=babelHelpers.slicedToArray(e,2),a=n[0],r=n[1];if(!t.form[a]){t.form.appendChild(i.Tag.render(K||(K=babelHelpers.taggedTemplateLiteral(['<input type="hidden" name="','">'])),a))}t.form[a].value=r}));this.onLightEditorShow(n,a);if(!BX.Type.isUndefined(BX.Tasks)){var s=t.currentEntity.ENTITY_XML_ID.match(/^TASK_(\d+)$/i);if(s&&this.resultFieldTaskIdList.includes(parseInt(s[1]))){BX.Tasks.ResultManager.showField()}else{BX.Tasks.ResultManager.hideField()}}}},{key:"onLightEditorShow",value:function e(t,n){if(!i.Type.isPlainObject(n)){n={}}var a={};if(i.Type.isPlainObject(n.UF)){a=n.UF}else{if(n.arFiles){var r={};n.arFiles.forEach((function(e,t){var n=document.getElementById("wdif-doc-".concat(e));var a=n.querySelector(".feed-com-file-name");var i=n.querySelector(".feed-con-file-size");r["F".concat(t)]={FILE_ID:e,FILE_NAME:a?a.innerHTML:"noname",FILE_SIZE:i?i.innerHTML:"unknown",CONTENT_TYPE:"notimage/xyz"}}));a.UF_SONET_COM_DOC={USER_TYPE_ID:"file",FIELD_NAME:"UF_SONET_COM_FILE[]",VALUE:r}}if(n.arDocs){a.UF_SONET_COM_FILE={USER_TYPE_ID:"webdav_element",FIELD_NAME:"UF_SONET_COM_DOC[]",VALUE:i.Runtime.clone(n.arDocs)}}if(n.arDFiles){a.UF_SONET_COM_FILE={USER_TYPE_ID:"disk_file",FIELD_NAME:"UF_SONET_COM_DOC[]",VALUE:i.Runtime.clone(n.arDFiles)}}}LHEPostForm.reinitData(window.SLEC.editorId,t,a)}}]);return e}();babelHelpers.defineProperty(J,"resultFieldTaskIdList",[]);babelHelpers.defineProperty(J,"taskResultCommentsData",{});var Q,$;function Z(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=ee(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var a=0;var i=function e(){};return{s:i,n:function t(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function e(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,s;return{s:function t(){n=n.call(e)},n:function e(){var t=n.next();r=t.done;return t},e:function e(t){o=true;s=t},f:function e(){try{if(!r&&n["return"]!=null)n["return"]()}finally{if(o)throw s}}}}function ee(e,t){if(!e)return;if(typeof e==="string")return te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return te(e,t)}function te(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var ne=function(){function e(){babelHelpers.classCallCheck(this,e);this.entryData={};this.feedInitialized=false;this.moreButtonDataList=new Map;this.currentScrollPosition=0}babelHelpers.createClass(e,[{key:"initOnce",value:function e(t){var n=document.getElementById("feed-loader-container");if(!i.Type.isPlainObject(t)){t={}}if(i.Type.isStringFilled(t.signedParameters)){se.setSignedParameters(t.signedParameters)}if(i.Type.isStringFilled(t.context)){se.setContext(t.context)}if(i.Type.isStringFilled(t.componentName)){se.setComponentName(t.componentName)}if(i.Type.isStringFilled(t.commentFormUID)){se.commentFormUID=t.commentFormUID}if(n){i.Event.bind(n,"animationend",V.onAnimationEnd);i.Event.bind(n,"webkitAnimationEnd",V.onAnimationEnd);i.Event.bind(n,"oanimationend",V.onAnimationEnd);i.Event.bind(n,"MSAnimationEnd",V.onAnimationEnd)}r.EventEmitter.subscribe("BX.Forum.Spoiler:toggle",X.processSpoilerToggle);oe.init({filterId:t.filterId});re.init({isSpaceFeatureEnabled:t.isSpaceEnabled,userId:t.userId,spaceId:t.spaceId});if(i.Type.isStringFilled(t.crmEntityTypeName)&&!i.Type.isUndefined(t.crmEntityId)&&parseInt(t.crmEntityId)>0){oe.initEventsCrm()}BX.UserContentView.init();document.getElementById("log_internal_container").addEventListener("click",(function(e){var t=e.target.getAttribute("bx-tag-value");if(!i.Type.isStringFilled(t)){return}if(oe.clickTag(t)){e.preventDefault();e.stopPropagation()}}),true);var a=document.getElementById("feed-notification-notasks-close-btn");var o=document.getElementById("feed-notification-notasks-read-btn");if(a){i.Event.bind(a,"click",this.setNoTasksNotificationRead.bind(this))}if(o){i.Event.bind(o,"click",this.setNoTasksNotificationRead.bind(this))}i.Event.bind(document,"fullscreenchange",this.handleFullScreenChange.bind(this));i.Event.bind(document,"scroll",this.handleScrollChange.bind(this))}},{key:"handleFullScreenChange",value:function e(){if(!this.getFullScreenElement()){window.scrollTo(0,this.currentScrollPosition)}}},{key:"handleScrollChange",value:function e(){if(!this.getFullScreenElement()){this.currentScrollPosition=window.scrollY}}},{key:"getFullScreenElement",value:function e(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||null}},{key:"init",value:function e(){if(this.feedInitialized){return}ie.init();this.feedInitialized=true}},{key:"changeFollow",value:function e(t){var n=this;var a=t.logId?parseInt(t.logId):0;if(!a){return false}var r=document.getElementById("log_entry_follow_"+a);var o=r&&r.getAttribute("data-follow")==="Y"?"Y":"N";var s=o==="Y"?"N":"Y";this.renderFollow({logId:a,value:s});i.ajax.runAction("socialnetwork.api.livefeed.changeFollow",{data:{logId:a,value:s},analyticsLabel:{b24statAction:s==="Y"?"setFollow":"setUnfollow"}}).then((function(e){if(!e.data.success){n.renderFollow({logId:a,value:o})}}),(function(){n.renderFollow({logId:a,value:o})}));return false}},{key:"renderFollow",value:function e(t){var n=t.logId?parseInt(t.logId):0;if(!n){return}var a=document.getElementById("log_entry_follow_"+n);var r=t.value&&t.value==="Y"?"Y":"N";if(a){a.setAttribute("data-follow",r)}var o=a?a.querySelector("a"):null;if(o){o.innerHTML=i.Loc.getMessage("SONET_EXT_LIVEFEED_FOLLOW_TITLE_"+r)}var s=a?a.closest(".feed-post-block"):null;if(s){if(r==="N"){s.classList.add("feed-post-block-unfollowed")}else if(r==="Y"){s.classList.remove("feed-post-block-unfollowed")}}}},{key:"changeFavorites",value:function e(t){var n=this;var a=t.logId?parseInt(t.logId):0;var r=t.event?t.event:null;var o=t.node?t.node:null;var s=t.newState?t.newState:null;if(i.Type.isStringFilled(o)){o=document.getElementById(o)}if(!a){return}var l=null;if(r){l=r.target;if(!l.classList.contains("menu-popup-item-text")){l=l.querySelector(".menu-popup-item-text")}}var c=null;if(i.Type.isDomNode(o)){c=o.classList.contains("feed-post-important-switch")?o:o.querySelector(".feed-post-important-switch")}if(typeof this.entryData[a]=="undefined"){this.entryData[a]={}}if(typeof this.entryData[a].favorites!="undefined"){s=this.entryData[a].favorites?"N":"Y";this.entryData[a].favorites=!this.entryData[a].favorites}else if(c){s=c.classList.contains("feed-post-important-switch-active")?"N":"Y";this.entryData[a].favorites=s=="Y"}if(!s){return}this.adjustFavoritesControlItem(c,s);this.adjustFavoritesMenuItem(l,s);i.ajax.runAction("socialnetwork.api.livefeed.changeFavorites",{data:{logId:a,value:s},analyticsLabel:{b24statAction:s=="Y"?"addFavorites":"removeFavorites"}}).then((function(e){if(i.Type.isStringFilled(e.data.newValue)&&["Y","N"].includes(e.data.newValue)){n.entryData[a].favorites=e.data.newValue=="Y"}n.adjustFavoritesControlItem(c,e.data.newValue);n.adjustFavoritesMenuItem(l,e.data.newValue)}),(function(){n.entryData[a].favorites=!n.entryData[a].favorites}))}},{key:"adjustFavoritesMenuItem",value:function e(t,n){if(!i.Type.isDomNode(t)||!["Y","N"].includes(n)){return}t.innerHTML=this.getMenuTitle(n==="Y")}},{key:"adjustFavoritesControlItem",value:function e(t,n){if(!i.Type.isDomNode(t)||!["Y","N"].includes(n)){return}t.title=this.getMenuTitle(n==="Y");if(n=="Y"){t.classList.add("feed-post-important-switch-active")}else{t.classList.remove("feed-post-important-switch-active")}}},{key:"getMenuTitle",value:function e(t){return i.Loc.getMessage("SONET_EXT_LIVEFEED_MENU_TITLE_FAVORITES_".concat(t?"Y":"N"))}},{key:"delete",value:function e(t){var n=this;var r=t.logId?parseInt(t.logId):0;var o=i.Type.isStringFilled(t.nodeId)?document.getElementById(t.nodeId):null;var s=t.ind?t.ind:"";if(r<=0||!o){return}i.ajax.runAction("socialnetwork.api.livefeed.deleteEntry",{data:{logId:r},analyticsLabel:{b24statAction:"deleteLogEntry"}}).then((function(e){if(e.data.success){if(!i.Type.isUndefined(s)){a.MenuManager.destroy(U.getMenuId(s))}n.deleteSuccess(o)}else{n.deleteFailure(o)}}),(function(){n.deleteFailure(o)}))}},{key:"deleteSuccess",value:function e(t){if(!i.Type.isDomNode(t)){return}new BX.fx({time:.5,step:.05,type:"linear",start:t.offsetHeight,finish:56,callback:function e(n){t.style.height="".concat(n,"px")},callback_start:function e(){t.style.overflow="hidden";t.style.minHeight=0},callback_complete:function e(){t.style.marginBottom=0;i.Dom.clean(t);t.classList.add("feed-post-block-deleted");t.appendChild(i.Tag.render(Q||(Q=babelHelpers.taggedTemplateLiteral(['<div class="feed-add-successfully"><span class="feed-add-info-text"><span class="feed-add-info-icon"></span><span>',"</span></span></span></div>"])),i.Loc.getMessage("SONET_EXT_LIVEFEED_DELETE_SUCCESS")))}}).start()}},{key:"deleteFailure",value:function e(t){if(!i.Type.isDomNode(t)){return}t.insertBefore(i.Tag.render($||($=babelHelpers.taggedTemplateLiteral(['<div class="feed-add-error" style="margin: 18px 37px 4px 84px;"><span class="feed-add-info-text"><span class="feed-add-info-icon"></span><span>',"</span></span></div>"])),i.Loc.getMessage("sonetLMenuDeleteFailure")),t.firstChild)}},{key:"setMoreButtons",value:function e(t){this.moreButtonDataList=t}},{key:"getMoreButtons",value:function e(){return this.moreButtonDataList}},{key:"clearMoreButtons",value:function e(){var t=Z(this.moreButtonDataList),n;try{for(t.s();!(n=t.n()).done;){var a;var i=n.value;var r=(a=document.getElementById(i.outerBlockID))===null||a===void 0?void 0:a.querySelector(".".concat(j.cssClass.more));if(!(r!==null&&r!==void 0&&r.hasClickListener)){return}}}catch(e){t.e(e)}finally{t.f()}this.moreButtonDataList.clear()}},{key:"addMoreButton",value:function e(t,n){this.moreButtonDataList.set(t,n)}},{key:"setNoTasksNotificationRead",value:function e(t){var n=t.currentTarget.closest(".feed-notification-container");if(!n){return}i.ajax.runAction("socialnetwork.api.livefeed.readNoTasksNotification",{data:{}}).then((function(e){if(!e.data.success){return}n.style.height=n.offsetHeight+"px";setTimeout((function(){n.classList.add("feed-notification-container-collapsed")}),10);setTimeout((function(){n.parentNode.removeChild(n)}),250)}),(function(){}))}}]);return e}();var ae=new ne;var ie=new d;var re=new H;var oe=new Y;var se=new z;var le=new j;new M;e.FeedInstance=ae;e.PinnedPanelInstance=ie;e.InformerInstance=re;e.FilterInstance=oe;e.PageInstance=se;e.MoreButtonInstance=le;e.Post=U;e.TaskCreator=M;e.Loader=V;e.MoreButton=j;e.ContentView=q;e.CommentForm=J})(this.BX.Livefeed=this.BX.Livefeed||{},BX.UI,BX.Socialnetwork,BX.Main,BX,BX.Event,BX.Tasks);
//# sourceMappingURL=livefeed.bundle.map.js